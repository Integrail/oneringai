{"version":3,"sources":["../src/index.ts"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["#!/usr/bin/env node\n\nimport { DocumentReader } from '@everworker/oneringai';\nimport type {\n  DocumentReadOptions,\n  DocumentResult,\n  DocumentTextPiece,\n  DocumentImagePiece,\n} from '@everworker/oneringai';\nimport path from 'node:path';\n\n// ── CLI Argument Parsing ────────────────────────────────────────────\n\ninterface CLIOptions {\n  source: string;\n  images: boolean;\n  format?: 'csv' | 'json' | 'markdown';\n  noHeader: boolean;\n  maxTokens?: number;\n}\n\nfunction parseArgs(argv: string[]): CLIOptions | null {\n  const args = argv.slice(2);\n\n  if (args.length === 0 || args.includes('--help') || args.includes('-h')) {\n    printUsage();\n    return null;\n  }\n\n  const opts: CLIOptions = {\n    source: '',\n    images: false,\n    noHeader: false,\n  };\n\n  for (let i = 0; i < args.length; i++) {\n    const arg = args[i];\n    if (arg === '--images') {\n      opts.images = true;\n    } else if (arg === '--no-header') {\n      opts.noHeader = true;\n    } else if (arg === '--format') {\n      const val = args[++i];\n      if (!val || !['csv', 'json', 'markdown'].includes(val)) {\n        console.error('Error: --format must be one of: csv, json, markdown');\n        process.exit(1);\n      }\n      opts.format = val as 'csv' | 'json' | 'markdown';\n    } else if (arg === '--max-tokens') {\n      const val = args[++i];\n      const n = Number(val);\n      if (!val || isNaN(n) || n <= 0) {\n        console.error('Error: --max-tokens must be a positive number');\n        process.exit(1);\n      }\n      opts.maxTokens = n;\n    } else if (arg.startsWith('-')) {\n      console.error(`Unknown flag: ${arg}`);\n      process.exit(1);\n    } else if (!opts.source) {\n      opts.source = arg;\n    } else {\n      console.error(`Unexpected argument: ${arg}`);\n      process.exit(1);\n    }\n  }\n\n  if (!opts.source) {\n    console.error('Error: No file path or URL provided.\\n');\n    printUsage();\n    return null;\n  }\n\n  return opts;\n}\n\nfunction printUsage(): void {\n  console.log(`\nUsage: convert <file-or-url> [options]\n\nArguments:\n  file-or-url          Path to a file or URL to convert\n\nOptions:\n  --images             Include image pieces (metadata only, no base64)\n  --format <fmt>       Excel table format: csv, json, markdown (default: markdown)\n  --no-header          Skip document header transformer\n  --max-tokens <n>     Maximum estimated tokens in output\n  -h, --help           Show this help message\n\nExamples:\n  convert ./report.pdf\n  convert https://example.com/doc.xlsx\n  convert ./slides.pptx --images\n  convert ./data.xlsx --format csv\n  convert ./big-doc.pdf --max-tokens 5000\n`);\n}\n\n// ── Formatting Helpers ──────────────────────────────────────────────\n\nconst SEPARATOR = '\\u2550'.repeat(50);\n\nfunction formatBytes(bytes: number): string {\n  if (bytes < 1024) return `${bytes} B`;\n  if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`;\n  return `${(bytes / (1024 * 1024)).toFixed(1)} MB`;\n}\n\nfunction printHeader(result: DocumentResult): void {\n  const m = result.metadata;\n  console.log(`\\n${SEPARATOR}`);\n  console.log(`  Document: ${m.filename}`);\n  console.log(`  Format: ${m.format} | Family: ${m.family} | MIME: ${m.mimeType}`);\n  console.log(SEPARATOR);\n}\n\nfunction printTextPiece(piece: DocumentTextPiece, index: number, total: number): void {\n  const meta = piece.metadata;\n  const section = meta.section ? ` \\u2014 ${meta.section}` : '';\n  const tokens = meta.estimatedTokens > 0 ? ` (${meta.estimatedTokens} tokens)` : '';\n  console.log(`\\n--- Piece ${index + 1}/${total} [text]${section}${tokens} ---`);\n  console.log(piece.content);\n}\n\nfunction printImagePiece(piece: DocumentImagePiece, index: number, total: number): void {\n  const meta = piece.metadata;\n  const section = meta.section ? ` \\u2014 ${meta.section}` : '';\n  console.log(`\\n--- Piece ${index + 1}/${total} [image]${section} ---`);\n  const label = meta.label ? ` | Label: ${meta.label}` : '';\n  const dims = piece.width && piece.height ? `  Dimensions: ${piece.width}x${piece.height}\\n` : '';\n  console.log(`  Type: ${piece.mimeType} | Size: ${formatBytes(meta.sizeBytes)}${label}`);\n  if (dims) process.stdout.write(dims);\n}\n\nfunction printFooter(result: DocumentResult): void {\n  const m = result.metadata;\n  const breakdown =\n    m.totalImagePieces > 0\n      ? ` (${m.totalTextPieces} text, ${m.totalImagePieces} images)`\n      : '';\n  console.log(`\\n${SEPARATOR}`);\n  console.log(`  Summary: ${m.totalPieces} pieces${breakdown}`);\n  console.log(\n    `  Total: ~${m.estimatedTokens.toLocaleString()} tokens | ${formatBytes(m.totalSizeBytes)} | ${m.processingTimeMs}ms`\n  );\n  if (result.warnings.length > 0) {\n    console.log(`  Warnings: ${result.warnings.length}`);\n    for (const w of result.warnings) {\n      console.log(`    - ${w}`);\n    }\n  }\n  console.log(SEPARATOR + '\\n');\n}\n\n// ── Main ────────────────────────────────────────────────────────────\n\nasync function main(): Promise<void> {\n  const opts = parseArgs(process.argv);\n  if (!opts) {\n    process.exit(0);\n  }\n\n  // Build read options\n  const readOptions: DocumentReadOptions = {\n    extractImages: opts.images,\n  };\n\n  if (opts.maxTokens) {\n    readOptions.maxTokens = opts.maxTokens;\n  }\n\n  if (opts.noHeader) {\n    readOptions.skipDefaultTransformers = true;\n  }\n\n  if (opts.format) {\n    readOptions.formatOptions = {\n      excel: { tableFormat: opts.format },\n    };\n  }\n\n  // Resolve source — if it looks like a URL, pass as-is; otherwise resolve the path\n  let source = opts.source;\n  if (!source.startsWith('http://') && !source.startsWith('https://')) {\n    source = path.resolve(source);\n  }\n\n  try {\n    const reader = DocumentReader.create();\n    const result = await reader.read(source, readOptions);\n\n    if (!result.success) {\n      console.error(`Error: ${result.error ?? 'Unknown error reading document'}`);\n      process.exit(1);\n    }\n\n    printHeader(result);\n\n    const total = result.pieces.length;\n    for (const piece of result.pieces) {\n      if (piece.type === 'text') {\n        printTextPiece(piece, piece.metadata.index, total);\n      } else if (piece.type === 'image') {\n        if (opts.images) {\n          printImagePiece(piece, piece.metadata.index, total);\n        }\n      }\n    }\n\n    printFooter(result);\n  } catch (err: unknown) {\n    const msg = err instanceof Error ? err.message : String(err);\n    console.error(`Fatal: ${msg}`);\n    process.exit(1);\n  }\n}\n\nmain();\n"]}