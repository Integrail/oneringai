{"version":3,"sources":["../src/domain/entities/Memory.ts","../src/connectors/oauth/utils/encryption.ts","../src/connectors/oauth/infrastructure/storage/MemoryStorage.ts","../src/connectors/oauth/domain/TokenStore.ts","../src/connectors/oauth/utils/pkce.ts","../src/connectors/oauth/flows/AuthCodePKCE.ts","../src/connectors/oauth/flows/ClientCredentials.ts","../src/connectors/oauth/flows/JWTBearer.ts","../src/connectors/oauth/flows/StaticToken.ts","../src/connectors/oauth/OAuthManager.ts","../src/core/Connector.ts","../src/core/Vendor.ts","../src/domain/errors/AIErrors.ts","../src/infrastructure/providers/base/BaseProvider.ts","../src/infrastructure/resilience/CircuitBreaker.ts","../src/infrastructure/observability/Logger.ts","../src/infrastructure/observability/Metrics.ts","../src/infrastructure/providers/base/BaseTextProvider.ts","../src/domain/entities/Message.ts","../src/domain/entities/StreamEvent.ts","../src/infrastructure/providers/openai/OpenAITextProvider.ts","../src/domain/entities/Content.ts","../src/infrastructure/providers/shared/ToolConversionUtils.ts","../src/infrastructure/providers/anthropic/AnthropicConverter.ts","../src/infrastructure/providers/anthropic/AnthropicStreamConverter.ts","../src/infrastructure/providers/anthropic/AnthropicTextProvider.ts","../src/utils/imageUtils.ts","../src/infrastructure/providers/google/GoogleConverter.ts","../src/infrastructure/providers/google/GoogleStreamConverter.ts","../src/infrastructure/providers/google/GoogleTextProvider.ts","../src/infrastructure/providers/vertex/VertexAITextProvider.ts","../src/infrastructure/providers/generic/GenericOpenAIProvider.ts","../src/core/createProvider.ts","../src/core/ToolManager.ts","../src/core/SessionManager.ts","../src/capabilities/agents/ToolRegistry.ts","../src/domain/entities/Tool.ts","../src/capabilities/agents/ExecutionContext.ts","../src/capabilities/agents/HookManager.ts","../src/domain/entities/StreamState.ts","../src/capabilities/agents/AgenticLoop.ts","../src/domain/interfaces/IDisposable.ts","../src/core/Agent.ts","../src/infrastructure/providers/base/BaseMediaProvider.ts","../src/domain/entities/SharedVoices.ts","../src/infrastructure/providers/openai/OpenAITTSProvider.ts","../src/infrastructure/providers/openai/OpenAISTTProvider.ts","../src/infrastructure/providers/google/GoogleTTSProvider.ts","../src/core/createAudioProvider.ts","../src/domain/entities/RegistryUtils.ts","../src/domain/entities/TTSModel.ts","../src/core/TextToSpeech.ts","../src/domain/entities/STTModel.ts","../src/core/SpeechToText.ts","../src/infrastructure/providers/openai/OpenAIImageProvider.ts","../src/infrastructure/providers/google/GoogleImageProvider.ts","../src/core/createImageProvider.ts","../src/domain/entities/ImageModel.ts","../src/capabilities/images/ImageGeneration.ts","../src/infrastructure/providers/openai/OpenAISoraProvider.ts","../src/infrastructure/providers/google/GoogleVeoProvider.ts","../src/core/createVideoProvider.ts","../src/domain/entities/VideoModel.ts","../src/capabilities/video/VideoGeneration.ts","../src/domain/entities/Task.ts","../src/domain/entities/AgentState.ts","../src/capabilities/taskAgent/TaskAgent.ts","../src/infrastructure/storage/InMemoryStorage.ts","../src/capabilities/taskAgent/WorkingMemory.ts","../src/capabilities/taskAgent/ContextManager.ts","../src/capabilities/taskAgent/IdempotencyCache.ts","../src/capabilities/taskAgent/HistoryManager.ts","../src/capabilities/taskAgent/ExternalDependencyHandler.ts","../src/domain/entities/Model.ts","../src/capabilities/taskAgent/PlanExecutor.ts","../src/capabilities/taskAgent/CheckpointManager.ts","../src/capabilities/taskAgent/memoryTools.ts","../src/capabilities/taskAgent/contextTools.ts","../src/capabilities/taskAgent/PlanningAgent.ts","../src/core/context/types.ts","../src/core/context/strategies/ProactiveStrategy.ts","../src/core/context/strategies/AggressiveStrategy.ts","../src/core/context/strategies/LazyStrategy.ts","../src/core/context/strategies/RollingWindowStrategy.ts","../src/core/context/strategies/AdaptiveStrategy.ts","../src/core/context/strategies/index.ts","../src/core/context/ContextManager.ts","../src/infrastructure/context/providers/TaskAgentContextProvider.ts","../src/infrastructure/context/compactors/TruncateCompactor.ts","../src/infrastructure/context/compactors/SummarizeCompactor.ts","../src/infrastructure/context/compactors/MemoryEvictionCompactor.ts","../src/infrastructure/context/estimators/ApproximateEstimator.ts","../src/infrastructure/context/estimators/index.ts","../src/index.ts","../src/infrastructure/storage/InMemorySessionStorage.ts","../src/infrastructure/storage/FileSessionStorage.ts","../src/capabilities/agents/StreamHelpers.ts","../src/infrastructure/providers/base/ProviderErrorMapper.ts","../src/connectors/oauth/infrastructure/storage/FileStorage.ts","../src/connectors/authenticatedFetch.ts","../src/connectors/toolGenerator.ts","../src/domain/interfaces/IConnectorConfigStorage.ts","../src/connectors/storage/ConnectorConfigStore.ts","../src/connectors/storage/MemoryConnectorStorage.ts","../src/connectors/storage/FileConnectorStorage.ts","../src/infrastructure/resilience/BackoffStrategy.ts","../src/utils/messageBuilder.ts","../src/utils/clipboardImage.ts","../src/tools/index.ts","../src/tools/json/pathUtils.ts","../src/tools/json/jsonManipulator.ts","../src/tools/web/contentDetector.ts","../src/tools/web/webFetch.ts","../src/tools/web/webFetchJS.ts","../src/tools/web/searchProviders/serper.ts","../src/tools/web/searchProviders/brave.ts","../src/tools/web/searchProviders/tavily.ts","../src/tools/web/webSearch.ts","../src/tools/code/executeJavaScript.ts","../src/agents/ProviderConfigAgent.ts","../src/capabilities/universalAgent/UniversalAgent.ts","../src/capabilities/universalAgent/ModeManager.ts","../src/capabilities/universalAgent/metaTools.ts"],"names":["DEFAULT_MEMORY_CONFIG","crypto","crypto2","fs","importPKCS8","SignJWT","EventEmitter","path","fs2","MessageRole","StreamEventType","OpenAI","ContentType","Anthropic","randomUUID","GoogleGenAI","ToolCallState","fs3","fs4","helpers","fs5","fs6","extractOpenAIConfig","extractGoogleConfig","createMemoryEntry","formatSizeHuman","formatMemoryIndex","DEFAULT_CONTEXT_CONFIG","ContextManager","join","fs8","crypto3","path2","path3","fs9","crypto4","promisify","exec","fs10","platform","os","path4","load","vm","plan"],"mappings":"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","file":"index.cjs","sourcesContent":["/**\n * Memory entities for TaskAgent working memory\n *\n * This file defines the data structures for the indexed working memory system.\n */\n\n/**\n * Scope determines memory lifecycle\n */\nexport type MemoryScope = 'task' | 'persistent';\n\n/**\n * Single memory entry stored in working memory\n */\nexport interface MemoryEntry {\n  key: string;                    // Namespaced key: \"user.profile\"\n  description: string;            // Short description for index (max 150 chars)\n  value: unknown;                 // The actual data\n  sizeBytes: number;              // Computed size for tracking\n  scope: MemoryScope;\n  createdAt: number;              // Unix timestamp\n  lastAccessedAt: number;\n  accessCount: number;\n}\n\n/**\n * Index entry (lightweight, always in context)\n */\nexport interface MemoryIndexEntry {\n  key: string;\n  description: string;\n  size: string;                   // Human readable: \"4.2KB\"\n  scope: MemoryScope;\n}\n\n/**\n * Full memory index with metadata\n */\nexport interface MemoryIndex {\n  entries: MemoryIndexEntry[];\n  totalSizeBytes: number;\n  totalSizeHuman: string;         // \"42KB\"\n  limitBytes: number;\n  limitHuman: string;             // \"1MB\"\n  utilizationPercent: number;\n}\n\n/**\n * Configuration for working memory\n */\nexport interface WorkingMemoryConfig {\n  /** Max memory size in bytes. If not set, calculated from model context */\n  maxSizeBytes?: number;\n\n  /** Max description length */\n  descriptionMaxLength: number;\n\n  /** Percentage at which to warn agent */\n  softLimitPercent: number;\n\n  /** Percentage of model context to allocate to memory */\n  contextAllocationPercent: number;\n}\n\n/**\n * Input for creating a memory entry\n */\nexport interface MemoryEntryInput {\n  key: string;\n  description: string;\n  value: unknown;\n  scope?: MemoryScope;\n}\n\n/**\n * Default configuration values\n */\nexport const DEFAULT_MEMORY_CONFIG: WorkingMemoryConfig = {\n  descriptionMaxLength: 150,\n  softLimitPercent: 80,\n  contextAllocationPercent: 20,\n};\n\n/**\n * Validate memory key format\n * Valid: \"simple\", \"user.profile\", \"order.items.123\"\n * Invalid: \"\", \".invalid\", \"invalid.\", \"with spaces\"\n */\nexport function validateMemoryKey(key: string): void {\n  if (!key || key.length === 0) {\n    throw new Error('Memory key cannot be empty');\n  }\n\n  // Check for invalid patterns\n  if (key.startsWith('.') || key.endsWith('.') || key.includes('..')) {\n    throw new Error('Invalid memory key format: keys cannot start/end with dots or contain consecutive dots');\n  }\n\n  // Check for invalid characters (only alphanumeric, dots, dashes, underscores)\n  if (!/^[a-zA-Z0-9._-]+$/.test(key)) {\n    throw new Error('Invalid memory key format: only alphanumeric, dots, dashes, and underscores allowed');\n  }\n}\n\n/**\n * Calculate the size of a value in bytes (JSON serialization)\n */\nexport function calculateEntrySize(value: unknown): number {\n  if (value === undefined) {\n    return 0;\n  }\n\n  const serialized = JSON.stringify(value);\n  return serialized.length;\n}\n\n/**\n * Create a memory entry with defaults and validation\n */\nexport function createMemoryEntry(\n  input: MemoryEntryInput,\n  config: WorkingMemoryConfig = DEFAULT_MEMORY_CONFIG\n): MemoryEntry {\n  // Validate key\n  validateMemoryKey(input.key);\n\n  // Validate description length\n  if (input.description.length > config.descriptionMaxLength) {\n    throw new Error(`Description exceeds maximum length of ${config.descriptionMaxLength} characters`);\n  }\n\n  const now = Date.now();\n  const sizeBytes = calculateEntrySize(input.value);\n\n  return {\n    key: input.key,\n    description: input.description,\n    value: input.value,\n    sizeBytes,\n    scope: input.scope ?? 'task',\n    createdAt: now,\n    lastAccessedAt: now,\n    accessCount: 0,\n  };\n}\n\n/**\n * Format bytes to human-readable string\n */\nexport function formatSizeHuman(bytes: number): string {\n  if (bytes === 0) return '0B';\n  if (bytes < 1024) return `${bytes}B`;\n\n  const kb = bytes / 1024;\n  if (bytes < 1024 * 1024) {\n    // Show 1 decimal place, but remove .0\n    return `${kb.toFixed(1).replace(/\\.0$/, '')}KB`;\n  }\n\n  const mb = bytes / (1024 * 1024);\n  if (bytes < 1024 * 1024 * 1024) {\n    return `${mb.toFixed(1).replace(/\\.0$/, '')}MB`;\n  }\n\n  const gb = bytes / (1024 * 1024 * 1024);\n  return `${gb.toFixed(1).replace(/\\.0$/, '')}GB`;\n}\n\n/**\n * Format memory index for context injection\n */\nexport function formatMemoryIndex(index: MemoryIndex): string {\n  const lines: string[] = [];\n\n  // Format utilization percent without unnecessary decimals\n  const utilPercent = Number.isInteger(index.utilizationPercent)\n    ? index.utilizationPercent.toString()\n    : index.utilizationPercent.toFixed(1).replace(/\\.0$/, '');\n\n  lines.push(`## Working Memory (${index.totalSizeHuman} / ${index.limitHuman} - ${utilPercent}%)`);\n  lines.push('');\n\n  if (index.entries.length === 0) {\n    lines.push('Memory is empty.');\n  } else {\n    // Group by scope\n    const persistent = index.entries.filter((e) => e.scope === 'persistent');\n    const task = index.entries.filter((e) => e.scope === 'task');\n\n    if (persistent.length > 0) {\n      lines.push('**Persistent:**');\n      for (const entry of persistent) {\n        lines.push(`- \\`${entry.key}\\` (${entry.size}): ${entry.description} [scope: persistent]`);\n      }\n      lines.push('');\n    }\n\n    if (task.length > 0) {\n      lines.push('**Task-scoped:**');\n      for (const entry of task) {\n        lines.push(`- \\`${entry.key}\\` (${entry.size}): ${entry.description} [scope: task]`);\n      }\n      lines.push('');\n    }\n\n    // Add warning if utilization is high\n    if (index.utilizationPercent > 80) {\n      lines.push(' **Warning:** Memory utilization is high. Consider deleting unused entries.');\n      lines.push('');\n    }\n  }\n\n  lines.push('Use `memory_retrieve(\"key\")` to load full content.');\n  lines.push('Use `memory_persist(\"key\")` to keep data after task completion.');\n\n  return lines.join('\\n');\n}\n","/**\n * Encryption utilities for OAuth tokens\n * Uses AES-256-GCM for secure token storage\n */\n\nimport * as crypto from 'crypto';\n\nconst ALGORITHM = 'aes-256-gcm';\nconst IV_LENGTH = 16;\nconst SALT_LENGTH = 64;\nconst TAG_LENGTH = 16;\nconst KEY_LENGTH = 32;\n\n/**\n * Encrypt data using AES-256-GCM with PBKDF2 key derivation\n *\n * @param text - Plaintext to encrypt\n * @param password - Encryption key/password\n * @returns Base64-encoded encrypted data\n */\nexport function encrypt(text: string, password: string): string {\n  // Generate random salt\n  const salt = crypto.randomBytes(SALT_LENGTH);\n\n  // Derive key from password using PBKDF2\n  const key = crypto.pbkdf2Sync(password, salt, 100000, KEY_LENGTH, 'sha512');\n\n  // Generate random IV\n  const iv = crypto.randomBytes(IV_LENGTH);\n\n  // Create cipher\n  const cipher = crypto.createCipheriv(ALGORITHM, key, iv);\n\n  // Encrypt\n  let encrypted = cipher.update(text, 'utf8', 'hex');\n  encrypted += cipher.final('hex');\n\n  // Get authentication tag\n  const tag = cipher.getAuthTag();\n\n  // Combine: salt + iv + tag + encrypted\n  const result = Buffer.concat([salt, iv, tag, Buffer.from(encrypted, 'hex')]);\n\n  // Return as base64\n  return result.toString('base64');\n}\n\n/**\n * Decrypt data using AES-256-GCM\n *\n * @param encryptedData - Base64-encoded encrypted data\n * @param password - Encryption key/password\n * @returns Decrypted plaintext\n */\nexport function decrypt(encryptedData: string, password: string): string {\n  const buffer = Buffer.from(encryptedData, 'base64');\n\n  // Extract components\n  const salt = buffer.subarray(0, SALT_LENGTH);\n  const iv = buffer.subarray(SALT_LENGTH, SALT_LENGTH + IV_LENGTH);\n  const tag = buffer.subarray(SALT_LENGTH + IV_LENGTH, SALT_LENGTH + IV_LENGTH + TAG_LENGTH);\n  const encrypted = buffer.subarray(SALT_LENGTH + IV_LENGTH + TAG_LENGTH);\n\n  // Derive key from password\n  const key = crypto.pbkdf2Sync(password, salt, 100000, KEY_LENGTH, 'sha512');\n\n  // Create decipher\n  const decipher = crypto.createDecipheriv(ALGORITHM, key, iv);\n  decipher.setAuthTag(tag);\n\n  // Decrypt\n  let decrypted = decipher.update(encrypted);\n  decrypted = Buffer.concat([decrypted, decipher.final()]);\n\n  return decrypted.toString('utf8');\n}\n\n/**\n * Get encryption key from environment or generate temporary one\n *\n * For production, always set OAUTH_ENCRYPTION_KEY environment variable!\n */\nexport function getEncryptionKey(): string {\n  // Use environment variable if available (RECOMMENDED)\n  if (process.env.OAUTH_ENCRYPTION_KEY) {\n    return process.env.OAUTH_ENCRYPTION_KEY;\n  }\n\n  // For in-memory storage: use process-specific key (not persistent across restarts)\n  // This is acceptable for MemoryStorage but NOT for FileStorage or DatabaseStorage!\n  if (!(global as any).__oauthEncryptionKey) {\n    (global as any).__oauthEncryptionKey = crypto.randomBytes(32).toString('hex');\n\n    console.warn(\n      'WARNING: Using auto-generated encryption key. Tokens will not persist across restarts. ' +\n        'Set OAUTH_ENCRYPTION_KEY environment variable for production!'\n    );\n  }\n\n  return (global as any).__oauthEncryptionKey;\n}\n\n/**\n * Generate a secure random encryption key\n * Use this to generate OAUTH_ENCRYPTION_KEY for your .env file\n */\nexport function generateEncryptionKey(): string {\n  return crypto.randomBytes(32).toString('hex');\n}\n","/**\n * In-memory token storage (default)\n * Tokens are encrypted in memory using AES-256-GCM\n */\n\nimport { ITokenStorage, StoredToken } from '../../domain/ITokenStorage.js';\nimport { encrypt, decrypt, getEncryptionKey } from '../../utils/encryption.js';\n\nexport class MemoryStorage implements ITokenStorage {\n  private tokens: Map<string, string> = new Map(); // Stores encrypted tokens\n\n  async storeToken(key: string, token: StoredToken): Promise<void> {\n    const encryptionKey = getEncryptionKey();\n    const plaintext = JSON.stringify(token);\n    const encrypted = encrypt(plaintext, encryptionKey);\n\n    this.tokens.set(key, encrypted);\n  }\n\n  async getToken(key: string): Promise<StoredToken | null> {\n    const encrypted = this.tokens.get(key);\n    if (!encrypted) {\n      return null;\n    }\n\n    try {\n      const encryptionKey = getEncryptionKey();\n      const decrypted = decrypt(encrypted, encryptionKey);\n      return JSON.parse(decrypted) as StoredToken;\n    } catch (error) {\n      console.error('Failed to decrypt token from memory:', error);\n      // Remove corrupted token\n      this.tokens.delete(key);\n      return null;\n    }\n  }\n\n  async deleteToken(key: string): Promise<void> {\n    this.tokens.delete(key);\n  }\n\n  async hasToken(key: string): Promise<boolean> {\n    return this.tokens.has(key);\n  }\n\n  /**\n   * Clear all tokens (useful for testing)\n   */\n  clearAll(): void {\n    this.tokens.clear();\n  }\n\n  /**\n   * Get number of stored tokens\n   */\n  size(): number {\n    return this.tokens.size;\n  }\n}\n","/**\n * Token Store (Domain Layer)\n * Manages token lifecycle using pluggable storage backend\n */\n\nimport { ITokenStorage, StoredToken } from './ITokenStorage.js';\nimport { MemoryStorage } from '../infrastructure/storage/MemoryStorage.js';\n\nexport class TokenStore {\n  private storage: ITokenStorage;\n  private baseStorageKey: string;\n\n  constructor(storageKey: string = 'default', storage?: ITokenStorage) {\n    this.baseStorageKey = storageKey;\n    // Default to in-memory storage (encrypted)\n    this.storage = storage || new MemoryStorage();\n  }\n\n  /**\n   * Get user-scoped storage key\n   * For multi-user support, keys are scoped per user: \"provider:userId\"\n   * For single-user (backward compatible), userId is omitted or \"default\"\n   *\n   * @param userId - User identifier (optional, defaults to single-user mode)\n   * @returns Storage key scoped to user\n   */\n  private getScopedKey(userId?: string): string {\n    if (!userId || userId === 'default') {\n      // Single-user mode (backward compatible)\n      return this.baseStorageKey;\n    }\n    // Multi-user mode: scope by userId\n    return `${this.baseStorageKey}:${userId}`;\n  }\n\n  /**\n   * Store token (encrypted by storage layer)\n   * @param tokenResponse - Token response from OAuth provider\n   * @param userId - Optional user identifier for multi-user support\n   */\n  async storeToken(tokenResponse: any, userId?: string): Promise<void> {\n    // Validate required fields\n    if (!tokenResponse.access_token) {\n      throw new Error('OAuth response missing required access_token field');\n    }\n\n    if (typeof tokenResponse.access_token !== 'string') {\n      throw new Error('access_token must be a string');\n    }\n\n    if (tokenResponse.expires_in !== undefined && tokenResponse.expires_in < 0) {\n      throw new Error('expires_in must be positive');\n    }\n\n    const token: StoredToken = {\n      access_token: tokenResponse.access_token,\n      refresh_token: tokenResponse.refresh_token,\n      expires_in: tokenResponse.expires_in || 3600,\n      token_type: tokenResponse.token_type || 'Bearer',\n      scope: tokenResponse.scope,\n      obtained_at: Date.now(),\n    };\n\n    const key = this.getScopedKey(userId);\n    await this.storage.storeToken(key, token);\n  }\n\n  /**\n   * Get access token\n   * @param userId - Optional user identifier for multi-user support\n   */\n  async getAccessToken(userId?: string): Promise<string> {\n    const key = this.getScopedKey(userId);\n    const token = await this.storage.getToken(key);\n    if (!token) {\n      throw new Error(`No token stored for ${userId ? `user: ${userId}` : 'default user'}`);\n    }\n    return token.access_token;\n  }\n\n  /**\n   * Get refresh token\n   * @param userId - Optional user identifier for multi-user support\n   */\n  async getRefreshToken(userId?: string): Promise<string> {\n    const key = this.getScopedKey(userId);\n    const token = await this.storage.getToken(key);\n    if (!token?.refresh_token) {\n      throw new Error(`No refresh token available for ${userId ? `user: ${userId}` : 'default user'}`);\n    }\n    return token.refresh_token;\n  }\n\n  /**\n   * Check if has refresh token\n   * @param userId - Optional user identifier for multi-user support\n   */\n  async hasRefreshToken(userId?: string): Promise<boolean> {\n    const key = this.getScopedKey(userId);\n    const token = await this.storage.getToken(key);\n    return !!token?.refresh_token;\n  }\n\n  /**\n   * Check if token is valid (not expired)\n   *\n   * @param bufferSeconds - Refresh this many seconds before expiry (default: 300 = 5 min)\n   * @param userId - Optional user identifier for multi-user support\n   */\n  async isValid(bufferSeconds: number = 300, userId?: string): Promise<boolean> {\n    const key = this.getScopedKey(userId);\n    const token = await this.storage.getToken(key);\n    if (!token) {\n      return false;\n    }\n\n    const expiresAt = token.obtained_at + token.expires_in * 1000;\n    const bufferMs = bufferSeconds * 1000;\n\n    return Date.now() < expiresAt - bufferMs;\n  }\n\n  /**\n   * Clear stored token\n   * @param userId - Optional user identifier for multi-user support\n   */\n  async clear(userId?: string): Promise<void> {\n    const key = this.getScopedKey(userId);\n    await this.storage.deleteToken(key);\n  }\n\n  /**\n   * Get full token info\n   * @param userId - Optional user identifier for multi-user support\n   */\n  async getTokenInfo(userId?: string): Promise<StoredToken | null> {\n    const key = this.getScopedKey(userId);\n    return this.storage.getToken(key);\n  }\n}\n","/**\n * PKCE (Proof Key for Code Exchange) utilities\n * RFC 7636 - https://tools.ietf.org/html/rfc7636\n */\n\nimport * as crypto from 'crypto';\n\nexport interface PKCEPair {\n  codeVerifier: string;\n  codeChallenge: string;\n}\n\n/**\n * Generate PKCE code verifier and challenge pair\n *\n * code_challenge = BASE64URL(SHA256(code_verifier))\n */\nexport function generatePKCE(): PKCEPair {\n  // Generate random code verifier (43-128 characters as per RFC)\n  const codeVerifier = base64URLEncode(crypto.randomBytes(32));\n\n  // Create code challenge = BASE64URL(SHA256(code_verifier))\n  const hash = crypto.createHash('sha256').update(codeVerifier).digest();\n  const codeChallenge = base64URLEncode(hash);\n\n  return {\n    codeVerifier,\n    codeChallenge,\n  };\n}\n\n/**\n * Base64 URL encode (RFC 4648 Section 5)\n * Used for PKCE code_verifier and code_challenge\n */\nfunction base64URLEncode(buffer: Buffer): string {\n  return buffer\n    .toString('base64')\n    .replace(/\\+/g, '-') // Replace + with -\n    .replace(/\\//g, '_') // Replace / with _\n    .replace(/=/g, ''); // Remove padding\n}\n\n/**\n * Generate random state for CSRF protection\n */\nexport function generateState(): string {\n  return crypto.randomBytes(16).toString('hex');\n}\n","/**\n * OAuth 2.0 Authorization Code Flow with PKCE (RFC 7636)\n * User authentication for web and mobile apps\n */\n\nimport { TokenStore } from '../domain/TokenStore.js';\nimport { generatePKCE, generateState } from '../utils/pkce.js';\nimport type { OAuthConfig } from '../types.js';\n\nexport class AuthCodePKCEFlow {\n  private tokenStore: TokenStore;\n  // Store PKCE data per user with timestamps for cleanup\n  private codeVerifiers: Map<string, { verifier: string; timestamp: number }> = new Map();\n  private states: Map<string, { state: string; timestamp: number }> = new Map();\n  // Store refresh locks per user to prevent concurrent refresh\n  private refreshLocks: Map<string, Promise<string>> = new Map();\n  // PKCE data TTL: 15 minutes (auth flows should complete within this time)\n  private readonly PKCE_TTL = 15 * 60 * 1000;\n\n  constructor(private config: OAuthConfig) {\n    const storageKey = config.storageKey || `auth_code:${config.clientId}`;\n    this.tokenStore = new TokenStore(storageKey, config.storage);\n  }\n\n  /**\n   * Generate authorization URL for user to visit\n   * Opens browser or redirects user to this URL\n   *\n   * @param userId - User identifier for multi-user support (optional)\n   */\n  async getAuthorizationUrl(userId?: string): Promise<string> {\n    if (!this.config.authorizationUrl) {\n      throw new Error('authorizationUrl is required for authorization_code flow');\n    }\n\n    if (!this.config.redirectUri) {\n      throw new Error('redirectUri is required for authorization_code flow');\n    }\n\n    // Clean up expired PKCE data before creating new flow\n    this.cleanupExpiredPKCE();\n\n    const userKey = userId || 'default';\n\n    // Generate PKCE pair\n    const { codeVerifier, codeChallenge } = generatePKCE();\n    this.codeVerifiers.set(userKey, { verifier: codeVerifier, timestamp: Date.now() });\n\n    // Generate state for CSRF protection\n    const state = generateState();\n    this.states.set(userKey, { state, timestamp: Date.now() });\n\n    // Build authorization URL\n    const params = new URLSearchParams({\n      response_type: 'code',\n      client_id: this.config.clientId,\n      redirect_uri: this.config.redirectUri,\n      state,\n    });\n\n    // Add scope if provided\n    if (this.config.scope) {\n      params.append('scope', this.config.scope);\n    }\n\n    // Add PKCE parameters (if enabled, default true)\n    if (this.config.usePKCE !== false) {\n      params.append('code_challenge', codeChallenge);\n      params.append('code_challenge_method', 'S256');\n    }\n\n    // Add user_id as state metadata (encode in state for retrieval in callback)\n    // The state will be: `{random_state}::{userId}`\n    const stateWithUser = userId ? `${state}::${userId}` : state;\n    params.set('state', stateWithUser);\n\n    return `${this.config.authorizationUrl}?${params.toString()}`;\n  }\n\n  /**\n   * Exchange authorization code for access token\n   *\n   * @param code - Authorization code from callback\n   * @param state - State parameter from callback (for CSRF verification, may include userId)\n   * @param userId - User identifier (optional, can be extracted from state)\n   */\n  async exchangeCode(code: string, state: string, userId?: string): Promise<void> {\n    // Extract userId from state if embedded\n    let actualState = state;\n    let actualUserId = userId;\n\n    if (state.includes('::')) {\n      const parts = state.split('::');\n      actualState = parts[0]!;\n      actualUserId = parts[1];\n    }\n\n    const userKey = actualUserId || 'default';\n\n    // Verify state to prevent CSRF attacks\n    const stateData = this.states.get(userKey);\n    if (!stateData) {\n      throw new Error(`No PKCE state found for user ${actualUserId}. Authorization flow may have expired (15 min TTL).`);\n    }\n\n    const expectedState = stateData.state;\n    if (actualState !== expectedState) {\n      throw new Error(`State mismatch for user ${actualUserId} - possible CSRF attack. Expected: ${expectedState}, Got: ${actualState}`);\n    }\n\n    if (!this.config.redirectUri) {\n      throw new Error('redirectUri is required');\n    }\n\n    // Build token request\n    const params = new URLSearchParams({\n      grant_type: 'authorization_code',\n      code,\n      redirect_uri: this.config.redirectUri,\n      client_id: this.config.clientId,\n    });\n\n    // Add client secret if provided (confidential clients)\n    if (this.config.clientSecret) {\n      params.append('client_secret', this.config.clientSecret);\n    }\n\n    // Add code_verifier if PKCE was used\n    const verifierData = this.codeVerifiers.get(userKey);\n    if (this.config.usePKCE !== false && verifierData) {\n      params.append('code_verifier', verifierData.verifier);\n    }\n\n    const response = await fetch(this.config.tokenUrl, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n      },\n      body: params,\n    });\n\n    if (!response.ok) {\n      const error = await response.text();\n      throw new Error(`Token exchange failed: ${response.status} ${response.statusText} - ${error}`);\n    }\n\n    const data: any = await response.json();\n\n    // Store token (encrypted) with user scoping\n    await this.tokenStore.storeToken(data, actualUserId);\n\n    // Clear PKCE data (one-time use)\n    this.codeVerifiers.delete(userKey);\n    this.states.delete(userKey);\n  }\n\n  /**\n   * Get valid token (auto-refreshes if needed)\n   * @param userId - User identifier for multi-user support\n   */\n  async getToken(userId?: string): Promise<string> {\n    const key = userId || 'default';\n\n    // If already refreshing for this user, wait for the existing refresh\n    if (this.refreshLocks.has(key)) {\n      return this.refreshLocks.get(key)!;\n    }\n\n    // Return cached token if valid\n    if (await this.tokenStore.isValid(this.config.refreshBeforeExpiry, userId)) {\n      return this.tokenStore.getAccessToken(userId);\n    }\n\n    // Try to refresh if we have a refresh token\n    if (await this.tokenStore.hasRefreshToken(userId)) {\n      // Start refresh and lock it\n      const refreshPromise = this.refreshToken(userId);\n      this.refreshLocks.set(key, refreshPromise);\n\n      try {\n        return await refreshPromise;\n      } finally {\n        // Always clean up lock, even on error\n        this.refreshLocks.delete(key);\n      }\n    }\n\n    // No valid token and can't refresh\n    throw new Error(`No valid token available for ${userId ? `user: ${userId}` : 'default user'}. User needs to authorize (call startAuthFlow).`);\n  }\n\n  /**\n   * Refresh access token using refresh token\n   * @param userId - User identifier for multi-user support\n   */\n  async refreshToken(userId?: string): Promise<string> {\n    const refreshToken = await this.tokenStore.getRefreshToken(userId);\n\n    const params = new URLSearchParams({\n      grant_type: 'refresh_token',\n      refresh_token: refreshToken,\n      client_id: this.config.clientId,\n    });\n\n    // Add client secret if provided\n    if (this.config.clientSecret) {\n      params.append('client_secret', this.config.clientSecret);\n    }\n\n    const response = await fetch(this.config.tokenUrl, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n      },\n      body: params,\n    });\n\n    if (!response.ok) {\n      const error = await response.text();\n      throw new Error(`Token refresh failed: ${response.status} ${response.statusText} - ${error}`);\n    }\n\n    const data: any = await response.json();\n\n    // Store new token with user scoping\n    await this.tokenStore.storeToken(data, userId);\n\n    return data.access_token;\n  }\n\n  /**\n   * Check if token is valid\n   * @param userId - User identifier for multi-user support\n   */\n  async isTokenValid(userId?: string): Promise<boolean> {\n    return this.tokenStore.isValid(this.config.refreshBeforeExpiry, userId);\n  }\n\n  /**\n   * Revoke token (if supported by provider)\n   * @param revocationUrl - Optional revocation endpoint\n   * @param userId - User identifier for multi-user support\n   */\n  async revokeToken(revocationUrl?: string, userId?: string): Promise<void> {\n    if (!revocationUrl) {\n      // Just clear from storage\n      await this.tokenStore.clear(userId);\n      return;\n    }\n\n    try {\n      const token = await this.tokenStore.getAccessToken(userId);\n\n      await fetch(revocationUrl, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/x-www-form-urlencoded',\n        },\n        body: new URLSearchParams({\n          token,\n          client_id: this.config.clientId,\n        }),\n      });\n    } finally {\n      // Always clear from storage\n      await this.tokenStore.clear(userId);\n    }\n  }\n\n  /**\n   * Clean up expired PKCE data to prevent memory leaks\n   * Removes verifiers and states older than PKCE_TTL (15 minutes)\n   */\n  private cleanupExpiredPKCE(): void {\n    const now = Date.now();\n\n    // Clean up expired code verifiers\n    for (const [key, data] of this.codeVerifiers) {\n      if (now - data.timestamp > this.PKCE_TTL) {\n        this.codeVerifiers.delete(key);\n        this.states.delete(key);\n      }\n    }\n  }\n}\n","/**\n * OAuth 2.0 Client Credentials Flow\n * Machine-to-machine authentication\n */\n\nimport { TokenStore } from '../domain/TokenStore.js';\nimport type { OAuthConfig } from '../types.js';\n\nexport class ClientCredentialsFlow {\n  private tokenStore: TokenStore;\n\n  constructor(private config: OAuthConfig) {\n    const storageKey = config.storageKey || `client_credentials:${config.clientId}`;\n    this.tokenStore = new TokenStore(storageKey, config.storage);\n  }\n\n  /**\n   * Get token using client credentials\n   */\n  async getToken(): Promise<string> {\n    // Return cached token if valid\n    if (await this.tokenStore.isValid(this.config.refreshBeforeExpiry)) {\n      return this.tokenStore.getAccessToken();\n    }\n\n    // Request new token\n    return this.requestToken();\n  }\n\n  /**\n   * Request a new token from the authorization server\n   */\n  private async requestToken(): Promise<string> {\n    // Create Basic Auth header\n    const auth = Buffer.from(`${this.config.clientId}:${this.config.clientSecret}`).toString(\n      'base64'\n    );\n\n    const params = new URLSearchParams({\n      grant_type: 'client_credentials',\n    });\n\n    // Add scope if provided\n    if (this.config.scope) {\n      params.append('scope', this.config.scope);\n    }\n\n    const response = await fetch(this.config.tokenUrl, {\n      method: 'POST',\n      headers: {\n        Authorization: `Basic ${auth}`,\n        'Content-Type': 'application/x-www-form-urlencoded',\n      },\n      body: params,\n    });\n\n    if (!response.ok) {\n      const error = await response.text();\n      throw new Error(`Token request failed: ${response.status} ${response.statusText} - ${error}`);\n    }\n\n    const data: any = await response.json();\n\n    // Store token (encrypted)\n    await this.tokenStore.storeToken(data);\n\n    return data.access_token;\n  }\n\n  /**\n   * Refresh token (client credentials don't use refresh tokens)\n   * Just requests a new token\n   */\n  async refreshToken(): Promise<string> {\n    await this.tokenStore.clear();\n    return this.requestToken();\n  }\n\n  /**\n   * Check if token is valid\n   */\n  async isTokenValid(): Promise<boolean> {\n    return this.tokenStore.isValid(this.config.refreshBeforeExpiry);\n  }\n}\n","/**\n * OAuth 2.0 JWT Bearer Flow (RFC 7523)\n * Service account authentication using private key signing\n */\n\nimport { SignJWT, importPKCS8 } from 'jose';\nimport * as fs from 'fs';\nimport { TokenStore } from '../domain/TokenStore.js';\nimport type { OAuthConfig } from '../types.js';\n\nexport class JWTBearerFlow {\n  private tokenStore: TokenStore;\n  private privateKey: string;\n\n  constructor(private config: OAuthConfig) {\n    const storageKey = config.storageKey || `jwt_bearer:${config.clientId}`;\n    this.tokenStore = new TokenStore(storageKey, config.storage);\n\n    // Load private key\n    if (config.privateKey) {\n      this.privateKey = config.privateKey;\n    } else if (config.privateKeyPath) {\n      try {\n        this.privateKey = fs.readFileSync(config.privateKeyPath, 'utf8');\n      } catch (error) {\n        throw new Error(`Failed to read private key from ${config.privateKeyPath}: ${(error as Error).message}`);\n      }\n    } else {\n      throw new Error('JWT Bearer flow requires privateKey or privateKeyPath');\n    }\n  }\n\n  /**\n   * Generate signed JWT assertion\n   */\n  private async generateJWT(): Promise<string> {\n    const now = Math.floor(Date.now() / 1000);\n    const alg = this.config.tokenSigningAlg || 'RS256';\n\n    // Parse private key\n    const key = await importPKCS8(this.privateKey, alg);\n\n    // Create JWT\n    const jwt = await new SignJWT({\n      scope: this.config.scope || '',\n    })\n      .setProtectedHeader({ alg })\n      .setIssuer(this.config.clientId)\n      .setSubject(this.config.clientId)\n      .setAudience(this.config.audience || this.config.tokenUrl)\n      .setIssuedAt(now)\n      .setExpirationTime(now + 3600) // 1 hour\n      .sign(key);\n\n    return jwt;\n  }\n\n  /**\n   * Get token using JWT Bearer assertion\n   */\n  async getToken(): Promise<string> {\n    // Return cached token if valid\n    if (await this.tokenStore.isValid(this.config.refreshBeforeExpiry)) {\n      return this.tokenStore.getAccessToken();\n    }\n\n    // Request new token\n    return this.requestToken();\n  }\n\n  /**\n   * Request token using JWT assertion\n   */\n  private async requestToken(): Promise<string> {\n    // Generate JWT assertion\n    const assertion = await this.generateJWT();\n\n    // Exchange JWT for access token\n    const params = new URLSearchParams({\n      grant_type: 'urn:ietf:params:oauth:grant-type:jwt-bearer',\n      assertion,\n    });\n\n    const response = await fetch(this.config.tokenUrl, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n      },\n      body: params,\n    });\n\n    if (!response.ok) {\n      const error = await response.text();\n      throw new Error(`JWT Bearer token request failed: ${response.status} ${response.statusText} - ${error}`);\n    }\n\n    const data: any = await response.json();\n\n    // Store token (encrypted)\n    await this.tokenStore.storeToken(data);\n\n    return data.access_token;\n  }\n\n  /**\n   * Refresh token (generate new JWT and request new token)\n   */\n  async refreshToken(): Promise<string> {\n    await this.tokenStore.clear();\n    return this.requestToken();\n  }\n\n  /**\n   * Check if token is valid\n   */\n  async isTokenValid(): Promise<boolean> {\n    return this.tokenStore.isValid(this.config.refreshBeforeExpiry);\n  }\n}\n","/**\n * Static Token Flow - For APIs that use static API keys\n * Examples: OpenAI, Anthropic, many SaaS APIs\n */\n\nimport type { OAuthConfig } from '../types.js';\n\nexport class StaticTokenFlow {\n  private token: string;\n\n  constructor(config: OAuthConfig) {\n    if (!config.staticToken) {\n      throw new Error('Static token flow requires staticToken in config');\n    }\n\n    this.token = config.staticToken;\n  }\n\n  /**\n   * Get token (always returns the static token)\n   */\n  async getToken(): Promise<string> {\n    return this.token;\n  }\n\n  /**\n   * Refresh token (no-op for static tokens)\n   */\n  async refreshToken(): Promise<string> {\n    return this.token;\n  }\n\n  /**\n   * Token is always valid for static tokens\n   */\n  async isTokenValid(): Promise<boolean> {\n    return true;\n  }\n\n  /**\n   * Update the static token\n   */\n  updateToken(newToken: string): void {\n    this.token = newToken;\n  }\n}\n","/**\n * OAuth Manager - Main entry point for OAuth 2.0 authentication\n * Supports multiple flows: Authorization Code (with PKCE), Client Credentials, JWT Bearer, Static Token\n */\n\nimport { AuthCodePKCEFlow } from './flows/AuthCodePKCE.js';\nimport { ClientCredentialsFlow } from './flows/ClientCredentials.js';\nimport { JWTBearerFlow } from './flows/JWTBearer.js';\nimport { StaticTokenFlow } from './flows/StaticToken.js';\nimport type { OAuthConfig } from './types.js';\n\nexport class OAuthManager {\n  private flow: AuthCodePKCEFlow | ClientCredentialsFlow | JWTBearerFlow | StaticTokenFlow;\n\n  constructor(config: OAuthConfig) {\n    // Validate configuration\n    this.validateConfig(config);\n\n    // Create appropriate flow implementation\n    switch (config.flow) {\n      case 'authorization_code':\n        this.flow = new AuthCodePKCEFlow(config);\n        break;\n\n      case 'client_credentials':\n        this.flow = new ClientCredentialsFlow(config);\n        break;\n\n      case 'jwt_bearer':\n        this.flow = new JWTBearerFlow(config);\n        break;\n\n      case 'static_token':\n        this.flow = new StaticTokenFlow(config);\n        break;\n\n      default:\n        throw new Error(`Unknown OAuth flow: ${(config as any).flow}`);\n    }\n  }\n\n  /**\n   * Get valid access token\n   * Automatically refreshes if expired\n   *\n   * @param userId - User identifier for multi-user support (optional)\n   */\n  async getToken(userId?: string): Promise<string> {\n    return this.flow.getToken(userId);\n  }\n\n  /**\n   * Force refresh the token\n   *\n   * @param userId - User identifier for multi-user support (optional)\n   */\n  async refreshToken(userId?: string): Promise<string> {\n    return this.flow.refreshToken(userId);\n  }\n\n  /**\n   * Check if current token is valid\n   *\n   * @param userId - User identifier for multi-user support (optional)\n   */\n  async isTokenValid(userId?: string): Promise<boolean> {\n    return this.flow.isTokenValid(userId);\n  }\n\n  // ==================== Authorization Code Flow Methods ====================\n\n  /**\n   * Start authorization flow (Authorization Code only)\n   * Returns URL for user to visit\n   *\n   * @param userId - User identifier for multi-user support (optional)\n   * @returns Authorization URL for the user to visit\n   */\n  async startAuthFlow(userId?: string): Promise<string> {\n    if (!(this.flow instanceof AuthCodePKCEFlow)) {\n      throw new Error('startAuthFlow() is only available for authorization_code flow');\n    }\n\n    return this.flow.getAuthorizationUrl(userId);\n  }\n\n  /**\n   * Handle OAuth callback (Authorization Code only)\n   * Call this with the callback URL after user authorizes\n   *\n   * @param callbackUrl - Full callback URL with code and state parameters\n   * @param userId - Optional user identifier (can be extracted from state if embedded)\n   */\n  async handleCallback(callbackUrl: string, userId?: string): Promise<void> {\n    if (!(this.flow instanceof AuthCodePKCEFlow)) {\n      throw new Error('handleCallback() is only available for authorization_code flow');\n    }\n\n    const url = new URL(callbackUrl);\n    const code = url.searchParams.get('code');\n    const state = url.searchParams.get('state');\n\n    if (!code) {\n      throw new Error('Missing authorization code in callback URL');\n    }\n\n    if (!state) {\n      throw new Error('Missing state parameter in callback URL');\n    }\n\n    await this.flow.exchangeCode(code, state, userId);\n  }\n\n  /**\n   * Revoke token (if supported by provider)\n   *\n   * @param revocationUrl - Optional revocation endpoint URL\n   * @param userId - User identifier for multi-user support (optional)\n   */\n  async revokeToken(revocationUrl?: string, userId?: string): Promise<void> {\n    if (this.flow instanceof AuthCodePKCEFlow) {\n      await this.flow.revokeToken(revocationUrl, userId);\n    } else {\n      throw new Error('Token revocation not implemented for this flow');\n    }\n  }\n\n  // ==================== Validation ====================\n\n  private validateConfig(config: OAuthConfig): void {\n    // Required fields\n    if (!config.flow) {\n      throw new Error('OAuth flow is required (authorization_code, client_credentials, jwt_bearer, or static_token)');\n    }\n\n    // tokenUrl and clientId not required for static_token\n    if (config.flow !== 'static_token') {\n      if (!config.tokenUrl) {\n        throw new Error('tokenUrl is required');\n      }\n\n      if (!config.clientId) {\n        throw new Error('clientId is required');\n      }\n    }\n\n    // Flow-specific validation\n    switch (config.flow) {\n      case 'authorization_code':\n        if (!config.authorizationUrl) {\n          throw new Error('authorizationUrl is required for authorization_code flow');\n        }\n        if (!config.redirectUri) {\n          throw new Error('redirectUri is required for authorization_code flow');\n        }\n        break;\n\n      case 'client_credentials':\n        if (!config.clientSecret) {\n          throw new Error('clientSecret is required for client_credentials flow');\n        }\n        break;\n\n      case 'jwt_bearer':\n        if (!config.privateKey && !config.privateKeyPath) {\n          throw new Error(\n            'privateKey or privateKeyPath is required for jwt_bearer flow'\n          );\n        }\n        break;\n\n      case 'static_token':\n        if (!config.staticToken) {\n          throw new Error('staticToken is required for static_token flow');\n        }\n        break;\n    }\n\n    // Warn if using FileStorage without encryption key\n    if (config.storage && !process.env.OAUTH_ENCRYPTION_KEY) {\n      console.warn(\n        'WARNING: Using persistent storage without OAUTH_ENCRYPTION_KEY environment variable. ' +\n          'Tokens will be encrypted with auto-generated key that changes on restart!'\n      );\n    }\n  }\n}\n","/**\n * Connector - The single source of truth for authentication\n *\n * Manages authenticated connections to:\n * - AI providers (OpenAI, Anthropic, Google, etc.)\n * - External APIs (GitHub, Salesforce, etc.)\n */\n\nimport { ConnectorConfig, ConnectorAuth } from '../domain/entities/Connector.js';\nimport { Vendor } from './Vendor.js';\nimport { OAuthManager } from '../connectors/oauth/OAuthManager.js';\nimport { MemoryStorage } from '../connectors/oauth/infrastructure/storage/MemoryStorage.js';\nimport type { ITokenStorage } from '../connectors/oauth/domain/ITokenStorage.js';\n\n/**\n * Connector class - represents a single authenticated connection\n */\nexport class Connector {\n  // ============ Static Registry ============\n\n  private static registry: Map<string, Connector> = new Map();\n  private static defaultStorage: ITokenStorage = new MemoryStorage();\n\n  /**\n   * Create and register a new connector\n   * @param config - Must include `name` field\n   */\n  static create(config: ConnectorConfig & { name: string }): Connector {\n    if (!config.name || config.name.trim().length === 0) {\n      throw new Error('Connector name is required');\n    }\n    if (Connector.registry.has(config.name)) {\n      throw new Error(`Connector '${config.name}' already exists. Use Connector.get() or choose a different name.`);\n    }\n    const connector = new Connector(config);\n    Connector.registry.set(config.name, connector);\n    return connector;\n  }\n\n  /**\n   * Get a connector by name\n   */\n  static get(name: string): Connector {\n    const connector = Connector.registry.get(name);\n    if (!connector) {\n      const available = Connector.list().join(', ') || 'none';\n      throw new Error(`Connector '${name}' not found. Available: ${available}`);\n    }\n    return connector;\n  }\n\n  /**\n   * Check if a connector exists\n   */\n  static has(name: string): boolean {\n    return Connector.registry.has(name);\n  }\n\n  /**\n   * List all registered connector names\n   */\n  static list(): string[] {\n    return Array.from(Connector.registry.keys());\n  }\n\n  /**\n   * Remove a connector\n   */\n  static remove(name: string): boolean {\n    const connector = Connector.registry.get(name);\n    if (connector) {\n      connector.dispose();\n    }\n    return Connector.registry.delete(name);\n  }\n\n  /**\n   * Clear all connectors (useful for testing)\n   */\n  static clear(): void {\n    for (const connector of Connector.registry.values()) {\n      connector.dispose();\n    }\n    Connector.registry.clear();\n  }\n\n  /**\n   * Set default token storage for OAuth connectors\n   */\n  static setDefaultStorage(storage: ITokenStorage): void {\n    Connector.defaultStorage = storage;\n  }\n\n  /**\n   * Get all registered connectors\n   */\n  static listAll(): Connector[] {\n    return Array.from(Connector.registry.values());\n  }\n\n  /**\n   * Get number of registered connectors\n   */\n  static size(): number {\n    return Connector.registry.size;\n  }\n\n  /**\n   * Get connector descriptions formatted for tool parameters\n   * Useful for generating dynamic tool descriptions\n   */\n  static getDescriptionsForTools(): string {\n    const connectors = Connector.listAll();\n\n    if (connectors.length === 0) {\n      return 'No connectors registered yet.';\n    }\n\n    return connectors\n      .map((c) => `  - \"${c.name}\": ${c.displayName} - ${c.config.description || 'No description'}`)\n      .join('\\n');\n  }\n\n  /**\n   * Get connector info (for tools and documentation)\n   */\n  static getInfo(): Record<string, { displayName: string; description: string; baseURL: string }> {\n    const info: Record<string, { displayName: string; description: string; baseURL: string }> = {};\n\n    for (const connector of Connector.registry.values()) {\n      info[connector.name] = {\n        displayName: connector.displayName,\n        description: connector.config.description || '',\n        baseURL: connector.baseURL,\n      };\n    }\n\n    return info;\n  }\n\n  // ============ Instance ============\n\n  readonly name: string;\n  readonly vendor?: Vendor;\n  readonly config: ConnectorConfig;\n\n  private oauthManager?: OAuthManager;\n  private disposed = false;\n\n  private constructor(config: ConnectorConfig & { name: string }) {\n    this.name = config.name;\n    this.vendor = config.vendor;\n    this.config = config;\n\n    // Initialize OAuth manager for OAuth and JWT auth types\n    if (config.auth.type === 'oauth') {\n      this.initOAuthManager(config.auth);\n    } else if (config.auth.type === 'jwt') {\n      this.initJWTManager(config.auth);\n    }\n  }\n\n  /**\n   * Human-readable display name\n   */\n  get displayName(): string {\n    return this.config.displayName || this.name;\n  }\n\n  /**\n   * API base URL for this connector\n   */\n  get baseURL(): string {\n    return this.config.baseURL || '';\n  }\n\n  /**\n   * Get the API key (for api_key auth type)\n   */\n  getApiKey(): string {\n    if (this.config.auth.type !== 'api_key') {\n      throw new Error(`Connector '${this.name}' does not use API key auth. Type: ${this.config.auth.type}`);\n    }\n    return this.config.auth.apiKey;\n  }\n\n  /**\n   * Get the current access token (for OAuth, JWT, or API key)\n   * Handles automatic refresh if needed\n   */\n  async getToken(userId?: string): Promise<string> {\n    if (this.config.auth.type === 'api_key') {\n      return this.config.auth.apiKey;\n    }\n\n    // OAuth and JWT both use OAuthManager\n    if (!this.oauthManager) {\n      throw new Error(`OAuth manager not initialized for connector '${this.name}'`);\n    }\n\n    return this.oauthManager.getToken(userId);\n  }\n\n  /**\n   * Start OAuth authorization flow\n   * Returns the URL to redirect the user to\n   */\n  async startAuth(userId?: string): Promise<string> {\n    if (!this.oauthManager) {\n      throw new Error(`Connector '${this.name}' is not an OAuth connector`);\n    }\n    return this.oauthManager.startAuthFlow(userId);\n  }\n\n  /**\n   * Handle OAuth callback\n   * Call this after user is redirected back from OAuth provider\n   */\n  async handleCallback(callbackUrl: string, userId?: string): Promise<void> {\n    if (!this.oauthManager) {\n      throw new Error(`Connector '${this.name}' is not an OAuth connector`);\n    }\n    await this.oauthManager.handleCallback(callbackUrl, userId);\n  }\n\n  /**\n   * Check if the connector has a valid token\n   */\n  async hasValidToken(userId?: string): Promise<boolean> {\n    try {\n      if (this.config.auth.type === 'api_key') {\n        return true; // API keys are always \"valid\" (we don't validate them)\n      }\n      if (this.oauthManager) {\n        const token = await this.oauthManager.getToken(userId);\n        return !!token;\n      }\n      return false;\n    } catch {\n      return false;\n    }\n  }\n\n  /**\n   * Get vendor-specific options from config\n   */\n  getOptions(): Record<string, unknown> {\n    return this.config.options ?? {};\n  }\n\n  /**\n   * Dispose of resources\n   */\n  dispose(): void {\n    if (this.disposed) return;\n    this.disposed = true;\n    // OAuthManager doesn't need explicit disposal\n    this.oauthManager = undefined;\n  }\n\n  // ============ Private ============\n\n  private initOAuthManager(auth: ConnectorAuth & { type: 'oauth' }): void {\n    // Convert ConnectorAuth to OAuthConfig\n    const oauthConfig = {\n      flow: auth.flow as 'authorization_code' | 'client_credentials' | 'jwt_bearer',\n      clientId: auth.clientId,\n      clientSecret: auth.clientSecret,\n      tokenUrl: auth.tokenUrl,\n      authorizationUrl: auth.authorizationUrl,\n      redirectUri: auth.redirectUri,\n      scope: auth.scope,\n      usePKCE: auth.usePKCE,\n      privateKey: auth.privateKey,\n      privateKeyPath: auth.privateKeyPath,\n      audience: auth.audience,\n      refreshBeforeExpiry: auth.refreshBeforeExpiry,\n      storage: Connector.defaultStorage,\n      storageKey: auth.storageKey ?? this.name,\n    };\n\n    this.oauthManager = new OAuthManager(oauthConfig);\n  }\n\n  private initJWTManager(auth: ConnectorAuth & { type: 'jwt' }): void {\n    // JWT uses jwt_bearer flow via OAuthManager\n    this.oauthManager = new OAuthManager({\n      flow: 'jwt_bearer',\n      clientId: auth.clientId,\n      tokenUrl: auth.tokenUrl,\n      privateKey: auth.privateKey,\n      privateKeyPath: auth.privateKeyPath,\n      scope: auth.scope,\n      audience: auth.audience,\n      storage: Connector.defaultStorage,\n      storageKey: this.name,\n    });\n  }\n}\n","/**\n * Supported AI Vendors\n *\n * Use this enum instead of string literals for type safety.\n * These map to specific provider implementations.\n */\nexport const Vendor = {\n  OpenAI: 'openai',\n  Anthropic: 'anthropic',\n  Google: 'google',\n  GoogleVertex: 'google-vertex',\n  Groq: 'groq',\n  Together: 'together',\n  Perplexity: 'perplexity',\n  Grok: 'grok',\n  DeepSeek: 'deepseek',\n  Mistral: 'mistral',\n  Ollama: 'ollama',\n  Custom: 'custom', // OpenAI-compatible endpoint\n} as const;\n\nexport type Vendor = (typeof Vendor)[keyof typeof Vendor];\n\n/**\n * All vendor values as array (useful for validation)\n */\nexport const VENDORS = Object.values(Vendor);\n\n/**\n * Check if a string is a valid vendor\n */\nexport function isVendor(value: string): value is Vendor {\n  return VENDORS.includes(value as Vendor);\n}\n","/**\n * Custom error classes for the AI library\n */\n\nexport class AIError extends Error {\n  constructor(\n    message: string,\n    public readonly code: string,\n    public readonly statusCode?: number,\n    public readonly originalError?: Error\n  ) {\n    super(message);\n    this.name = 'AIError';\n    Object.setPrototypeOf(this, AIError.prototype);\n  }\n}\n\nexport class ProviderNotFoundError extends AIError {\n  constructor(providerName: string) {\n    super(\n      `Provider '${providerName}' not found. Did you configure it in OneRingAI constructor?`,\n      'PROVIDER_NOT_FOUND',\n      404\n    );\n    this.name = 'ProviderNotFoundError';\n    Object.setPrototypeOf(this, ProviderNotFoundError.prototype);\n  }\n}\n\nexport class ProviderAuthError extends AIError {\n  constructor(providerName: string, message: string = 'Authentication failed') {\n    super(\n      `${providerName}: ${message}`,\n      'PROVIDER_AUTH_ERROR',\n      401\n    );\n    this.name = 'ProviderAuthError';\n    Object.setPrototypeOf(this, ProviderAuthError.prototype);\n  }\n}\n\nexport class ProviderRateLimitError extends AIError {\n  constructor(\n    providerName: string,\n    public readonly retryAfter?: number\n  ) {\n    super(\n      `${providerName}: Rate limit exceeded${retryAfter ? `. Retry after ${retryAfter}ms` : ''}`,\n      'PROVIDER_RATE_LIMIT',\n      429\n    );\n    this.name = 'ProviderRateLimitError';\n    Object.setPrototypeOf(this, ProviderRateLimitError.prototype);\n  }\n}\n\nexport class ProviderContextLengthError extends AIError {\n  constructor(\n    providerName: string,\n    public readonly maxTokens: number,\n    public readonly requestedTokens?: number\n  ) {\n    super(\n      `${providerName}: Context length exceeded. Max: ${maxTokens}${requestedTokens ? `, Requested: ${requestedTokens}` : ''}`,\n      'PROVIDER_CONTEXT_LENGTH_EXCEEDED',\n      413\n    );\n    this.name = 'ProviderContextLengthError';\n    Object.setPrototypeOf(this, ProviderContextLengthError.prototype);\n  }\n}\n\nexport class ToolExecutionError extends AIError {\n  constructor(\n    toolName: string,\n    message: string,\n    public readonly originalError?: Error\n  ) {\n    super(\n      `Tool '${toolName}' execution failed: ${message}`,\n      'TOOL_EXECUTION_ERROR',\n      500,\n      originalError\n    );\n    this.name = 'ToolExecutionError';\n    Object.setPrototypeOf(this, ToolExecutionError.prototype);\n  }\n}\n\nexport class ToolTimeoutError extends AIError {\n  constructor(\n    toolName: string,\n    public readonly timeoutMs: number\n  ) {\n    super(\n      `Tool '${toolName}' execution timed out after ${timeoutMs}ms`,\n      'TOOL_TIMEOUT',\n      408\n    );\n    this.name = 'ToolTimeoutError';\n    Object.setPrototypeOf(this, ToolTimeoutError.prototype);\n  }\n}\n\nexport class ToolNotFoundError extends AIError {\n  constructor(toolName: string) {\n    super(\n      `Tool '${toolName}' not found. Did you register it with the agent?`,\n      'TOOL_NOT_FOUND',\n      404\n    );\n    this.name = 'ToolNotFoundError';\n    Object.setPrototypeOf(this, ToolNotFoundError.prototype);\n  }\n}\n\nexport class ModelNotSupportedError extends AIError {\n  constructor(providerName: string, model: string, capability: string) {\n    super(\n      `Model '${model}' from ${providerName} does not support ${capability}`,\n      'MODEL_NOT_SUPPORTED',\n      400\n    );\n    this.name = 'ModelNotSupportedError';\n    Object.setPrototypeOf(this, ModelNotSupportedError.prototype);\n  }\n}\n\nexport class InvalidConfigError extends AIError {\n  constructor(message: string) {\n    super(message, 'INVALID_CONFIG', 400);\n    this.name = 'InvalidConfigError';\n    Object.setPrototypeOf(this, InvalidConfigError.prototype);\n  }\n}\n\nexport class InvalidToolArgumentsError extends AIError {\n  constructor(\n    toolName: string,\n    public readonly rawArguments: string,\n    public readonly parseError?: Error\n  ) {\n    super(\n      `Invalid arguments for tool '${toolName}': ${parseError?.message || 'Failed to parse JSON'}`,\n      'INVALID_TOOL_ARGUMENTS',\n      400,\n      parseError\n    );\n    this.name = 'InvalidToolArgumentsError';\n    Object.setPrototypeOf(this, InvalidToolArgumentsError.prototype);\n  }\n}\n\nexport class ProviderError extends AIError {\n  constructor(\n    public readonly providerName: string,\n    message: string,\n    statusCode?: number,\n    originalError?: Error\n  ) {\n    super(\n      `${providerName}: ${message}`,\n      'PROVIDER_ERROR',\n      statusCode,\n      originalError\n    );\n    this.name = 'ProviderError';\n    Object.setPrototypeOf(this, ProviderError.prototype);\n  }\n}\n","/**\n * Base provider class with common functionality\n */\n\nimport { IProvider, ProviderCapabilities } from '../../../domain/interfaces/IProvider.js';\nimport { ProviderConfig } from '../../../domain/types/ProviderConfig.js';\nimport { InvalidConfigError } from '../../../domain/errors/AIErrors.js';\n\nexport abstract class BaseProvider implements IProvider {\n  abstract readonly name: string;\n  abstract readonly capabilities: ProviderCapabilities;\n\n  constructor(protected config: ProviderConfig) {}\n\n  /**\n   * Validate provider configuration\n   * Returns validation result with details\n   */\n  async validateConfig(): Promise<boolean> {\n    const validation = this.validateApiKey();\n    return validation.isValid;\n  }\n\n  /**\n   * Validate API key format and presence\n   * Can be overridden by providers with specific key formats\n   */\n  protected validateApiKey(): { isValid: boolean; warning?: string } {\n    const apiKey = this.config.apiKey;\n\n    // Check for presence\n    if (!apiKey || apiKey.trim().length === 0) {\n      return { isValid: false };\n    }\n\n    // Check for common placeholder values\n    const placeholders = [\n      'your-api-key',\n      'YOUR_API_KEY',\n      'sk-xxx',\n      'api-key-here',\n      'REPLACE_ME',\n      '<your-key>',\n    ];\n\n    if (placeholders.some((p) => apiKey.includes(p))) {\n      return {\n        isValid: false,\n        warning: `API key appears to be a placeholder value`,\n      };\n    }\n\n    // Provider-specific format validation (can be overridden)\n    return this.validateProviderSpecificKeyFormat(apiKey);\n  }\n\n  /**\n   * Override this method in provider implementations for specific key format validation\n   */\n  protected validateProviderSpecificKeyFormat(_apiKey: string): { isValid: boolean; warning?: string } {\n    // Default: accept any non-empty key\n    // Override in subclasses for provider-specific validation\n    return { isValid: true };\n  }\n\n  /**\n   * Validate config and throw if invalid\n   */\n  protected assertValidConfig(): void {\n    const validation = this.validateApiKey();\n    if (!validation.isValid) {\n      throw new InvalidConfigError(\n        `Invalid API key for provider '${this.name}'${validation.warning ? `: ${validation.warning}` : ''}`\n      );\n    }\n  }\n\n  /**\n   * Get API key from config\n   */\n  protected getApiKey(): string {\n    return this.config.apiKey;\n  }\n\n  /**\n   * Get base URL if configured\n   */\n  protected getBaseURL(): string | undefined {\n    return this.config.baseURL;\n  }\n\n  /**\n   * Get timeout configuration\n   */\n  protected getTimeout(): number {\n    return this.config.timeout || 60000; // 60s default\n  }\n\n  /**\n   * Get max retries configuration\n   */\n  protected getMaxRetries(): number {\n    return this.config.maxRetries || 3;\n  }\n}\n","/**\n * Generic Circuit Breaker implementation\n *\n * Prevents cascading failures by failing fast when a system is down.\n * Works for any async operation (LLM calls, tool execution, etc.)\n */\n\nimport EventEmitter from 'eventemitter3';\n\n/**\n * Circuit breaker states\n */\nexport type CircuitState = 'closed' | 'open' | 'half-open';\n\n/**\n * Failure record for window tracking\n */\ninterface FailureRecord {\n  timestamp: number;\n  error: string;\n}\n\n/**\n * Circuit breaker configuration\n */\nexport interface CircuitBreakerConfig {\n  /** Number of failures before opening circuit */\n  failureThreshold: number;\n\n  /** Number of successes to close from half-open */\n  successThreshold: number;\n\n  /** Time to wait in open state before trying half-open (ms) */\n  resetTimeoutMs: number;\n\n  /** Time window for counting failures (ms) */\n  windowMs: number;\n\n  /** Classify errors - return true if error should count as failure */\n  isRetryable?: (error: Error) => boolean;\n}\n\n/**\n * Circuit breaker metrics\n */\nexport interface CircuitBreakerMetrics {\n  name: string;\n  state: CircuitState;\n\n  // Counters\n  totalRequests: number;\n  successCount: number;\n  failureCount: number;\n  rejectedCount: number; // Rejected by open circuit\n\n  // Current window\n  recentFailures: number;\n  consecutiveSuccesses: number;\n\n  // Timestamps\n  lastFailureTime?: number;\n  lastSuccessTime?: number;\n  lastStateChange: number;\n  nextRetryTime?: number;\n\n  // Rates\n  failureRate: number;\n  successRate: number;\n}\n\n/**\n * Circuit breaker events\n */\nexport interface CircuitBreakerEvents {\n  opened: { name: string; failureCount: number; lastError: string; nextRetryTime: number };\n  'half-open': { name: string; timestamp: number };\n  closed: { name: string; successCount: number; timestamp: number };\n}\n\n/**\n * Default configuration\n */\nexport const DEFAULT_CIRCUIT_BREAKER_CONFIG: CircuitBreakerConfig = {\n  failureThreshold: 5,\n  successThreshold: 2,\n  resetTimeoutMs: 30000, // 30 seconds\n  windowMs: 60000, // 1 minute\n  isRetryable: () => true, // All errors count by default\n};\n\n/**\n * Circuit breaker error - thrown when circuit is open\n */\nexport class CircuitOpenError extends Error {\n  constructor(\n    public readonly breakerName: string,\n    public readonly nextRetryTime: number,\n    public readonly failureCount: number,\n    public readonly lastError: string\n  ) {\n    const retryInSeconds = Math.ceil((nextRetryTime - Date.now()) / 1000);\n    super(\n      `Circuit breaker '${breakerName}' is OPEN. ` +\n      `Retry in ${retryInSeconds}s. ` +\n      `(${failureCount} recent failures, last: ${lastError})`\n    );\n    this.name = 'CircuitOpenError';\n  }\n}\n\n/**\n * Generic circuit breaker for any async operation\n */\nexport class CircuitBreaker<T = any> extends EventEmitter<CircuitBreakerEvents> {\n  private state: CircuitState = 'closed';\n  private config: CircuitBreakerConfig;\n\n  // Failure tracking\n  private failures: FailureRecord[] = [];\n  private lastError: string = '';\n\n  // Success tracking\n  private consecutiveSuccesses = 0;\n\n  // Timing\n  private openedAt?: number;\n  private lastStateChange: number;\n\n  // Metrics\n  private totalRequests = 0;\n  private successCount = 0;\n  private failureCount = 0;\n  private rejectedCount = 0;\n  private lastFailureTime?: number;\n  private lastSuccessTime?: number;\n\n  constructor(\n    public readonly name: string,\n    config: Partial<CircuitBreakerConfig> = {}\n  ) {\n    super();\n    this.config = { ...DEFAULT_CIRCUIT_BREAKER_CONFIG, ...config };\n    this.lastStateChange = Date.now();\n  }\n\n  /**\n   * Execute function with circuit breaker protection\n   */\n  async execute(fn: () => Promise<T>): Promise<T> {\n    this.totalRequests++;\n\n    // Check circuit state\n    const now = Date.now();\n\n    switch (this.state) {\n      case 'open':\n        // Check if timeout has expired\n        if (this.openedAt && now - this.openedAt >= this.config.resetTimeoutMs) {\n          // Transition to half-open\n          this.transitionTo('half-open');\n        } else {\n          // Still open, reject immediately\n          this.rejectedCount++;\n          const nextRetry = (this.openedAt || now) + this.config.resetTimeoutMs;\n          throw new CircuitOpenError(this.name, nextRetry, this.failures.length, this.lastError);\n        }\n        break;\n\n      case 'half-open':\n        // Allow one request through\n        break;\n\n      case 'closed':\n        // Normal operation\n        break;\n    }\n\n    // Execute the function\n    try {\n      const result = await fn();\n\n      // Success - record it\n      this.recordSuccess();\n\n      return result;\n    } catch (error) {\n      // Failure - record it\n      this.recordFailure(error as Error);\n\n      throw error;\n    }\n  }\n\n  /**\n   * Record successful execution\n   */\n  private recordSuccess(): void {\n    this.successCount++;\n    this.lastSuccessTime = Date.now();\n    this.consecutiveSuccesses++;\n\n    if (this.state === 'half-open') {\n      // Check if enough successes to close\n      if (this.consecutiveSuccesses >= this.config.successThreshold) {\n        this.transitionTo('closed');\n      }\n    } else if (this.state === 'closed') {\n      // Clean up old failures on success\n      this.pruneOldFailures();\n    }\n  }\n\n  /**\n   * Record failed execution\n   */\n  private recordFailure(error: Error): void {\n    // Check if error should count as failure\n    if (this.config.isRetryable && !this.config.isRetryable(error)) {\n      // Non-retryable error, don't count toward circuit breaker\n      return;\n    }\n\n    this.failureCount++;\n    this.lastFailureTime = Date.now();\n    this.lastError = error.message;\n\n    // Reset consecutive successes\n    this.consecutiveSuccesses = 0;\n\n    // Record failure\n    this.failures.push({\n      timestamp: Date.now(),\n      error: error.message,\n    });\n\n    // Prune old failures outside window\n    this.pruneOldFailures();\n\n    // Check if we should open the circuit\n    if (this.state === 'half-open') {\n      // Failure during half-open  back to open\n      this.transitionTo('open');\n    } else if (this.state === 'closed') {\n      // Check failure threshold\n      if (this.failures.length >= this.config.failureThreshold) {\n        this.transitionTo('open');\n      }\n    }\n  }\n\n  /**\n   * Transition to new state\n   */\n  private transitionTo(newState: CircuitState): void {\n    this.state = newState;\n    this.lastStateChange = Date.now();\n\n    switch (newState) {\n      case 'open':\n        this.openedAt = Date.now();\n        this.emit('opened', {\n          name: this.name,\n          failureCount: this.failures.length,\n          lastError: this.lastError,\n          nextRetryTime: this.openedAt + this.config.resetTimeoutMs,\n        });\n        break;\n\n      case 'half-open':\n        this.emit('half-open', {\n          name: this.name,\n          timestamp: Date.now(),\n        });\n        break;\n\n      case 'closed':\n        // Reset state\n        this.failures = [];\n        this.consecutiveSuccesses = 0;\n        this.openedAt = undefined;\n\n        this.emit('closed', {\n          name: this.name,\n          successCount: this.consecutiveSuccesses,\n          timestamp: Date.now(),\n        });\n        break;\n    }\n  }\n\n  /**\n   * Remove failures outside the time window\n   */\n  private pruneOldFailures(): void {\n    const now = Date.now();\n    const cutoff = now - this.config.windowMs;\n    this.failures = this.failures.filter((f) => f.timestamp > cutoff);\n  }\n\n  /**\n   * Get current state\n   */\n  getState(): CircuitState {\n    return this.state;\n  }\n\n  /**\n   * Get current metrics\n   */\n  getMetrics(): CircuitBreakerMetrics {\n    this.pruneOldFailures();\n\n    const total = this.successCount + this.failureCount;\n    const failureRate = total > 0 ? this.failureCount / total : 0;\n    const successRate = total > 0 ? this.successCount / total : 0;\n\n    return {\n      name: this.name,\n      state: this.state,\n      totalRequests: this.totalRequests,\n      successCount: this.successCount,\n      failureCount: this.failureCount,\n      rejectedCount: this.rejectedCount,\n      recentFailures: this.failures.length,\n      consecutiveSuccesses: this.consecutiveSuccesses,\n      lastFailureTime: this.lastFailureTime,\n      lastSuccessTime: this.lastSuccessTime,\n      lastStateChange: this.lastStateChange,\n      nextRetryTime: this.openedAt ? this.openedAt + this.config.resetTimeoutMs : undefined,\n      failureRate,\n      successRate,\n    };\n  }\n\n  /**\n   * Manually reset circuit breaker (force close)\n   */\n  reset(): void {\n    this.transitionTo('closed');\n    this.totalRequests = 0;\n    this.successCount = 0;\n    this.failureCount = 0;\n    this.rejectedCount = 0;\n    this.lastFailureTime = undefined;\n    this.lastSuccessTime = undefined;\n  }\n\n  /**\n   * Check if circuit is allowing requests\n   */\n  isOpen(): boolean {\n    if (this.state === 'open' && this.openedAt) {\n      const now = Date.now();\n      if (now - this.openedAt >= this.config.resetTimeoutMs) {\n        // Should transition to half-open\n        this.transitionTo('half-open');\n        return false;\n      }\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Get configuration\n   */\n  getConfig(): CircuitBreakerConfig {\n    return { ...this.config };\n  }\n}\n","/**\n * Structured logging infrastructure\n *\n * Provides framework-wide structured logging with context propagation.\n * Supports console output (default) with optional file output.\n *\n * Environment variables:\n * - LOG_LEVEL: trace|debug|info|warn|error|silent (default: info)\n * - LOG_FILE: Path to log file (optional, default: console output)\n * - LOG_PRETTY: true|false (default: true in development)\n */\n\nimport * as fs from 'fs';\nimport * as path from 'path';\n\n/**\n * Log level\n */\nexport type LogLevel = 'trace' | 'debug' | 'info' | 'warn' | 'error' | 'silent';\n\n/**\n * Log levels as numbers (for comparison)\n */\nconst LOG_LEVEL_VALUES: Record<LogLevel, number> = {\n  trace: 10,\n  debug: 20,\n  info: 30,\n  warn: 40,\n  error: 50,\n  silent: 100,\n};\n\n/**\n * Logger configuration\n */\nexport interface LoggerConfig {\n  /** Log level */\n  level?: LogLevel;\n\n  /** Pretty print for development */\n  pretty?: boolean;\n\n  /** Base context added to all logs */\n  context?: Record<string, any>;\n\n  /** Custom destination (default: console) */\n  destination?: 'console' | 'stdout' | 'stderr';\n\n  /** File path for file logging */\n  filePath?: string;\n}\n\n/**\n * Log entry\n */\nexport interface LogEntry {\n  level: LogLevel;\n  time: number;\n  msg: string;\n  [key: string]: any;\n}\n\n/**\n * Framework logger\n */\nexport class FrameworkLogger {\n  private config: LoggerConfig;\n  private context: Record<string, any>;\n  private levelValue: number;\n  private fileStream?: fs.WriteStream;\n\n  constructor(config: LoggerConfig = {}) {\n    this.config = {\n      level: (config.level || process.env.LOG_LEVEL || 'info') as LogLevel,\n      pretty: config.pretty ?? (process.env.LOG_PRETTY === 'true' || process.env.NODE_ENV === 'development'),\n      destination: config.destination || 'console',\n      context: config.context || {},\n      filePath: config.filePath || process.env.LOG_FILE,\n    };\n\n    this.context = this.config.context || {};\n    this.levelValue = LOG_LEVEL_VALUES[this.config.level || 'info'];\n\n    // Initialize file stream if file path is provided\n    if (this.config.filePath) {\n      this.initFileStream(this.config.filePath);\n    }\n  }\n\n  /**\n   * Initialize file stream for logging\n   */\n  private initFileStream(filePath: string): void {\n    try {\n      // Ensure directory exists\n      const dir = path.dirname(filePath);\n      if (!fs.existsSync(dir)) {\n        fs.mkdirSync(dir, { recursive: true });\n      }\n\n      // Create write stream with append mode\n      this.fileStream = fs.createWriteStream(filePath, {\n        flags: 'a', // append mode\n        encoding: 'utf8',\n      });\n\n      // Handle stream errors\n      this.fileStream.on('error', (err) => {\n        console.error(`[Logger] File stream error: ${err.message}`);\n        this.fileStream = undefined;\n      });\n    } catch (err) {\n      console.error(`[Logger] Failed to initialize log file: ${err instanceof Error ? err.message : err}`);\n    }\n  }\n\n  /**\n   * Create child logger with additional context\n   */\n  child(context: Record<string, any>): FrameworkLogger {\n    return new FrameworkLogger({\n      ...this.config,\n      context: { ...this.context, ...context },\n    });\n  }\n\n  /**\n   * Trace log\n   */\n  trace(obj: Record<string, any> | string, msg?: string): void {\n    this.log('trace', obj, msg);\n  }\n\n  /**\n   * Debug log\n   */\n  debug(obj: Record<string, any> | string, msg?: string): void {\n    this.log('debug', obj, msg);\n  }\n\n  /**\n   * Info log\n   */\n  info(obj: Record<string, any> | string, msg?: string): void {\n    this.log('info', obj, msg);\n  }\n\n  /**\n   * Warn log\n   */\n  warn(obj: Record<string, any> | string, msg?: string): void {\n    this.log('warn', obj, msg);\n  }\n\n  /**\n   * Error log\n   */\n  error(obj: Record<string, any> | string, msg?: string): void {\n    this.log('error', obj, msg);\n  }\n\n  /**\n   * Internal log method\n   */\n  private log(level: LogLevel, obj: Record<string, any> | string, msg?: string): void {\n    // Check if this level should be logged\n    if (LOG_LEVEL_VALUES[level] < this.levelValue) {\n      return;\n    }\n\n    // Parse arguments\n    let data: Record<string, any>;\n    let message: string;\n\n    if (typeof obj === 'string') {\n      message = obj;\n      data = {};\n    } else {\n      message = msg || '';\n      data = obj;\n    }\n\n    // Create log entry\n    const entry: LogEntry = {\n      level,\n      time: Date.now(),\n      ...this.context,\n      ...data,\n      msg: message,\n    };\n\n    // Output\n    this.output(entry);\n  }\n\n  /**\n   * Output log entry\n   */\n  private output(entry: LogEntry): void {\n    if (this.config.pretty) {\n      this.prettyPrint(entry);\n    } else {\n      this.jsonPrint(entry);\n    }\n  }\n\n  /**\n   * Pretty print for development\n   */\n  private prettyPrint(entry: LogEntry): void {\n    const levelColors: Record<LogLevel, string> = {\n      trace: '\\x1b[90m', // Gray\n      debug: '\\x1b[36m', // Cyan\n      info: '\\x1b[32m', // Green\n      warn: '\\x1b[33m', // Yellow\n      error: '\\x1b[31m', // Red\n      silent: '',\n    };\n\n    const reset = '\\x1b[0m';\n    const color = this.fileStream ? '' : levelColors[entry.level] || ''; // No colors in file\n\n    // Format time\n    const time = new Date(entry.time).toISOString().substring(11, 23);\n\n    // Format level\n    const levelStr = entry.level.toUpperCase().padEnd(5);\n\n    // Format context\n    const contextParts: string[] = [];\n    for (const [key, value] of Object.entries(entry)) {\n      if (key !== 'level' && key !== 'time' && key !== 'msg') {\n        contextParts.push(`${key}=${JSON.stringify(value)}`);\n      }\n    }\n    const context = contextParts.length > 0 ? ` ${contextParts.join(' ')}` : '';\n\n    // Output\n    const output = `${color}[${time}] ${levelStr}${reset} ${entry.msg}${context}`;\n\n    // Write to file if available\n    if (this.fileStream) {\n      // Strip ANSI color codes for file output\n      const cleanOutput = output.replace(/\\x1b\\[[0-9;]*m/g, '');\n      this.fileStream.write(cleanOutput + '\\n');\n      return;\n    }\n\n    // Console output\n    switch (entry.level) {\n      case 'error':\n      case 'warn':\n        console.error(output);\n        break;\n      default:\n        console.log(output);\n    }\n  }\n\n  /**\n   * JSON print for production\n   */\n  private jsonPrint(entry: LogEntry): void {\n    const json = JSON.stringify(entry);\n\n    // Write to file if available\n    if (this.fileStream) {\n      this.fileStream.write(json + '\\n');\n      return;\n    }\n\n    // Console output\n    switch (this.config.destination) {\n      case 'stderr':\n        console.error(json);\n        break;\n      default:\n        console.log(json);\n    }\n  }\n\n  /**\n   * Update configuration\n   */\n  updateConfig(config: Partial<LoggerConfig>): void {\n    this.config = { ...this.config, ...config };\n\n    if (config.level) {\n      this.levelValue = LOG_LEVEL_VALUES[config.level];\n    }\n\n    if (config.context) {\n      this.context = { ...this.context, ...config.context };\n    }\n\n    // Reinitialize file stream if file path changed\n    if (config.filePath !== undefined) {\n      this.closeFileStream();\n      if (config.filePath) {\n        this.initFileStream(config.filePath);\n      }\n    }\n  }\n\n  /**\n   * Close file stream\n   */\n  private closeFileStream(): void {\n    if (this.fileStream) {\n      this.fileStream.end();\n      this.fileStream = undefined;\n    }\n  }\n\n  /**\n   * Cleanup resources (call before process exit)\n   */\n  close(): void {\n    this.closeFileStream();\n  }\n\n  /**\n   * Get current log level\n   */\n  getLevel(): LogLevel {\n    return this.config.level || 'info';\n  }\n\n  /**\n   * Check if level is enabled\n   */\n  isLevelEnabled(level: LogLevel): boolean {\n    return LOG_LEVEL_VALUES[level] >= this.levelValue;\n  }\n}\n\n/**\n * Global logger singleton\n */\nexport const logger = new FrameworkLogger({\n  level: (process.env.LOG_LEVEL as LogLevel) || 'info',\n  pretty: process.env.LOG_PRETTY === 'true' || process.env.NODE_ENV === 'development',\n  filePath: process.env.LOG_FILE,\n});\n\n/**\n * Cleanup logger on process exit\n */\nprocess.on('exit', () => {\n  logger.close();\n});\n\nprocess.on('SIGINT', () => {\n  logger.close();\n  process.exit(0);\n});\n\nprocess.on('SIGTERM', () => {\n  logger.close();\n  process.exit(0);\n});\n","/**\n * Metrics collection infrastructure\n *\n * Pluggable metrics system with support for various backends.\n */\n\n/**\n * Metric tags\n */\nexport type MetricTags = Record<string, string | number | boolean>;\n\n/**\n * Metrics collector interface\n */\nexport interface MetricsCollector {\n  /**\n   * Increment a counter\n   */\n  increment(metric: string, value?: number, tags?: MetricTags): void;\n\n  /**\n   * Set a gauge value\n   */\n  gauge(metric: string, value: number, tags?: MetricTags): void;\n\n  /**\n   * Record a timing/duration\n   */\n  timing(metric: string, duration: number, tags?: MetricTags): void;\n\n  /**\n   * Record a histogram value\n   */\n  histogram(metric: string, value: number, tags?: MetricTags): void;\n}\n\n/**\n * No-op metrics collector (default - zero overhead)\n */\nexport class NoOpMetrics implements MetricsCollector {\n  increment(): void {}\n  gauge(): void {}\n  timing(): void {}\n  histogram(): void {}\n}\n\n/**\n * Console metrics collector (development/debugging)\n */\nexport class ConsoleMetrics implements MetricsCollector {\n  private prefix: string;\n\n  constructor(prefix: string = 'oneringai') {\n    this.prefix = prefix;\n  }\n\n  increment(metric: string, value: number = 1, tags?: MetricTags): void {\n    this.log('COUNTER', metric, value, tags);\n  }\n\n  gauge(metric: string, value: number, tags?: MetricTags): void {\n    this.log('GAUGE', metric, value, tags);\n  }\n\n  timing(metric: string, duration: number, tags?: MetricTags): void {\n    this.log('TIMING', metric, `${duration}ms`, tags);\n  }\n\n  histogram(metric: string, value: number, tags?: MetricTags): void {\n    this.log('HISTOGRAM', metric, value, tags);\n  }\n\n  private log(type: string, metric: string, value: any, tags?: MetricTags): void {\n    const fullMetric = `${this.prefix}.${metric}`;\n    const tagsStr = tags ? ` ${JSON.stringify(tags)}` : '';\n    console.log(`[METRIC:${type}] ${fullMetric}=${value}${tagsStr}`);\n  }\n}\n\n/**\n * In-memory metrics aggregator (testing/development)\n */\nexport class InMemoryMetrics implements MetricsCollector {\n  private counters = new Map<string, number>();\n  private gauges = new Map<string, number>();\n  private timings = new Map<string, number[]>();\n  private histograms = new Map<string, number[]>();\n\n  increment(metric: string, value: number = 1, tags?: MetricTags): void {\n    const key = this.makeKey(metric, tags);\n    this.counters.set(key, (this.counters.get(key) || 0) + value);\n  }\n\n  gauge(metric: string, value: number, tags?: MetricTags): void {\n    const key = this.makeKey(metric, tags);\n    this.gauges.set(key, value);\n  }\n\n  timing(metric: string, duration: number, tags?: MetricTags): void {\n    const key = this.makeKey(metric, tags);\n    const timings = this.timings.get(key) || [];\n    timings.push(duration);\n    this.timings.set(key, timings);\n  }\n\n  histogram(metric: string, value: number, tags?: MetricTags): void {\n    const key = this.makeKey(metric, tags);\n    const values = this.histograms.get(key) || [];\n    values.push(value);\n    this.histograms.set(key, values);\n  }\n\n  private makeKey(metric: string, tags?: MetricTags): string {\n    if (!tags) return metric;\n    const tagStr = Object.entries(tags)\n      .map(([k, v]) => `${k}:${v}`)\n      .sort()\n      .join(',');\n    return `${metric}{${tagStr}}`;\n  }\n\n  /**\n   * Get all metrics (for testing)\n   */\n  getMetrics(): {\n    counters: Map<string, number>;\n    gauges: Map<string, number>;\n    timings: Map<string, number[]>;\n    histograms: Map<string, number[]>;\n  } {\n    return {\n      counters: new Map(this.counters),\n      gauges: new Map(this.gauges),\n      timings: new Map(this.timings),\n      histograms: new Map(this.histograms),\n    };\n  }\n\n  /**\n   * Clear all metrics\n   */\n  clear(): void {\n    this.counters.clear();\n    this.gauges.clear();\n    this.timings.clear();\n    this.histograms.clear();\n  }\n\n  /**\n   * Get summary statistics for timings\n   */\n  getTimingStats(metric: string, tags?: MetricTags): {\n    count: number;\n    min: number;\n    max: number;\n    mean: number;\n    p50: number;\n    p95: number;\n    p99: number;\n  } | null {\n    const key = this.makeKey(metric, tags);\n    const timings = this.timings.get(key);\n\n    if (!timings || timings.length === 0) {\n      return null;\n    }\n\n    const sorted = [...timings].sort((a, b) => a - b);\n    const count = sorted.length;\n    const sum = sorted.reduce((a, b) => a + b, 0);\n\n    return {\n      count,\n      min: sorted[0] ?? 0,\n      max: sorted[count - 1] ?? 0,\n      mean: sum / count,\n      p50: sorted[Math.floor(count * 0.5)] ?? 0,\n      p95: sorted[Math.floor(count * 0.95)] ?? 0,\n      p99: sorted[Math.floor(count * 0.99)] ?? 0,\n    };\n  }\n}\n\n/**\n * Metrics collector type\n */\nexport type MetricsCollectorType = 'noop' | 'console' | 'inmemory';\n\n/**\n * Create metrics collector from type\n */\nexport function createMetricsCollector(type?: MetricsCollectorType, prefix?: string): MetricsCollector {\n  const collectorType = type || (process.env.METRICS_COLLECTOR as MetricsCollectorType) || 'noop';\n\n  switch (collectorType) {\n    case 'console':\n      return new ConsoleMetrics(prefix);\n    case 'inmemory':\n      return new InMemoryMetrics();\n    default:\n      return new NoOpMetrics();\n  }\n}\n\n/**\n * Global metrics singleton\n */\nexport const metrics: MetricsCollector = createMetricsCollector(\n  undefined,\n  process.env.METRICS_PREFIX || 'oneringai'\n);\n\n/**\n * Update global metrics collector\n */\nexport function setMetricsCollector(collector: MetricsCollector): void {\n  Object.assign(metrics, collector);\n}\n","/**\n * Base text provider with common text generation functionality\n */\n\nimport { BaseProvider } from './BaseProvider.js';\nimport { ITextProvider, ModelCapabilities, TextGenerateOptions } from '../../../domain/interfaces/ITextProvider.js';\nimport { LLMResponse } from '../../../domain/entities/Response.js';\nimport { StreamEvent } from '../../../domain/entities/StreamEvent.js';\nimport { CircuitBreaker, DEFAULT_CIRCUIT_BREAKER_CONFIG } from '../../resilience/CircuitBreaker.js';\nimport { logger, FrameworkLogger } from '../../observability/Logger.js';\nimport { metrics } from '../../observability/Metrics.js';\n\nexport abstract class BaseTextProvider extends BaseProvider implements ITextProvider {\n  protected circuitBreaker?: CircuitBreaker;\n  protected logger: FrameworkLogger;\n  private _isObservabilityInitialized = false;\n\n  constructor(config: any) {\n    super(config);\n\n    // Initialize with default logger (will be updated with provider name on first use)\n    this.logger = logger.child({\n      component: 'Provider',\n      provider: 'unknown',\n    });\n\n    // Circuit breaker created lazily on first use\n  }\n\n  /**\n   * Auto-initialize observability on first use (lazy initialization)\n   * This is called automatically by executeWithCircuitBreaker()\n   * @internal\n   */\n  private ensureObservabilityInitialized(): void {\n    if (this._isObservabilityInitialized) {\n      return;\n    }\n\n    const providerName = this.name || 'unknown';\n\n    // Create circuit breaker with provider name\n    const cbConfig = (this.config as any).circuitBreaker || DEFAULT_CIRCUIT_BREAKER_CONFIG;\n    this.circuitBreaker = new CircuitBreaker(\n      `provider:${providerName}`,\n      cbConfig\n    );\n\n    // Update logger with provider name\n    this.logger = logger.child({\n      component: 'Provider',\n      provider: providerName,\n    });\n\n    // Forward circuit breaker events to metrics\n    this.circuitBreaker.on('opened', (data) => {\n      this.logger.warn(data, 'Circuit breaker opened');\n      metrics.increment('circuit_breaker.opened', 1, {\n        breaker: data.name,\n        provider: providerName,\n      });\n    });\n\n    this.circuitBreaker.on('closed', (data) => {\n      this.logger.info(data, 'Circuit breaker closed');\n      metrics.increment('circuit_breaker.closed', 1, {\n        breaker: data.name,\n        provider: providerName,\n      });\n    });\n\n    this._isObservabilityInitialized = true;\n  }\n\n  /**\n   * DEPRECATED: No longer needed, kept for backward compatibility\n   * Observability is now auto-initialized on first use\n   * @deprecated Initialization happens automatically\n   */\n  protected initializeObservability(_providerName: string): void {\n    // Force initialization now (for providers that still call this)\n    this.ensureObservabilityInitialized();\n  }\n\n  abstract generate(options: TextGenerateOptions): Promise<LLMResponse>;\n  abstract streamGenerate(options: TextGenerateOptions): AsyncIterableIterator<StreamEvent>;\n  abstract getModelCapabilities(model: string): ModelCapabilities;\n\n  /**\n   * Execute with circuit breaker protection (helper for subclasses)\n   */\n  protected async executeWithCircuitBreaker<TResult>(\n    operation: () => Promise<TResult>,\n    model?: string\n  ): Promise<TResult> {\n    // Auto-initialize observability on first use\n    this.ensureObservabilityInitialized();\n\n    const startTime = Date.now();\n    const operationName = 'llm.generate';\n\n    this.logger.debug({\n      operation: operationName,\n      model,\n    }, 'LLM call started');\n\n    metrics.increment('provider.llm.request', 1, {\n      provider: this.name,\n      model: model || 'unknown',\n    });\n\n    try {\n      // Execute with circuit breaker (should always be initialized after ensureObservabilityInitialized)\n      if (!this.circuitBreaker) {\n        // Fallback: execute without circuit breaker (should never happen)\n        return await operation();\n      }\n\n      const result = await this.circuitBreaker.execute(operation);\n\n      const duration = Date.now() - startTime;\n\n      this.logger.info({\n        operation: operationName,\n        model,\n        duration,\n      }, 'LLM call completed');\n\n      metrics.timing('provider.llm.latency', duration, {\n        provider: this.name,\n        model: model || 'unknown',\n      });\n\n      metrics.increment('provider.llm.response', 1, {\n        provider: this.name,\n        model: model || 'unknown',\n        status: 'success',\n      });\n\n      return result;\n    } catch (error) {\n      const duration = Date.now() - startTime;\n\n      this.logger.error({\n        operation: operationName,\n        model,\n        error: (error as Error).message,\n        duration,\n      }, 'LLM call failed');\n\n      metrics.increment('provider.llm.error', 1, {\n        provider: this.name,\n        model: model || 'unknown',\n        error: (error as Error).name,\n      });\n\n      throw error;\n    }\n  }\n\n  /**\n   * Get circuit breaker metrics\n   */\n  getCircuitBreakerMetrics() {\n    if (!this.circuitBreaker) {\n      // Not yet initialized (no calls made yet)\n      return null;\n    }\n    return this.circuitBreaker.getMetrics();\n  }\n\n  /**\n   * Normalize input to string (helper for providers that don't support complex input)\n   */\n  protected normalizeInputToString(input: string | any[]): string {\n    if (typeof input === 'string') {\n      return input;\n    }\n\n    // Extract text from InputItem array\n    const textParts: string[] = [];\n    for (const item of input) {\n      if (item.type === 'message') {\n        for (const content of item.content) {\n          if (content.type === 'input_text') {\n            textParts.push(content.text);\n          } else if (content.type === 'output_text') {\n            textParts.push(content.text);\n          }\n        }\n      }\n    }\n\n    return textParts.join('\\n');\n  }\n\n  /**\n   * List available models (optional)\n   */\n  async listModels?(): Promise<string[]>;\n}\n","/**\n * Message entity based on OpenAI Responses API format\n */\n\nimport { Content } from './Content.js';\n\nexport enum MessageRole {\n  USER = 'user',\n  ASSISTANT = 'assistant',\n  DEVELOPER = 'developer', // Responses API uses \"developer\" instead of \"system\"\n}\n\nexport interface Message {\n  type: 'message';\n  id?: string;\n  role: MessageRole;\n  content: Content[]; // Always an array in Responses API\n}\n\nexport interface CompactionItem {\n  type: 'compaction';\n  id: string;\n  encrypted_content: string;\n}\n\nexport interface ReasoningItem {\n  type: 'reasoning';\n  id: string;\n  effort?: 'low' | 'medium' | 'high';\n  summary?: string;\n  encrypted_content?: string; // For o-series models\n}\n\nexport type InputItem = Message | CompactionItem;\nexport type OutputItem = Message | CompactionItem | ReasoningItem;\n","/**\n * Streaming event types for real-time LLM responses\n * Based on OpenAI Responses API event format as the internal standard\n */\n\nimport { TokenUsage } from './Response.js';\n\n/**\n * Stream event type enum\n */\nexport enum StreamEventType {\n  RESPONSE_CREATED = 'response.created',\n  RESPONSE_IN_PROGRESS = 'response.in_progress',\n  OUTPUT_TEXT_DELTA = 'response.output_text.delta',\n  OUTPUT_TEXT_DONE = 'response.output_text.done',\n  TOOL_CALL_START = 'response.tool_call.start',\n  TOOL_CALL_ARGUMENTS_DELTA = 'response.tool_call_arguments.delta',\n  TOOL_CALL_ARGUMENTS_DONE = 'response.tool_call_arguments.done',\n  TOOL_EXECUTION_START = 'response.tool_execution.start',\n  TOOL_EXECUTION_DONE = 'response.tool_execution.done',\n  ITERATION_COMPLETE = 'response.iteration.complete',\n  RESPONSE_COMPLETE = 'response.complete',\n  ERROR = 'response.error',\n}\n\n/**\n * Base interface for all stream events\n */\ninterface BaseStreamEvent {\n  type: StreamEventType;\n  response_id: string;\n}\n\n/**\n * Response created - first event in stream\n */\nexport interface ResponseCreatedEvent extends BaseStreamEvent {\n  type: StreamEventType.RESPONSE_CREATED;\n  model: string;\n  created_at: number;\n}\n\n/**\n * Response in progress\n */\nexport interface ResponseInProgressEvent extends BaseStreamEvent {\n  type: StreamEventType.RESPONSE_IN_PROGRESS;\n}\n\n/**\n * Text delta - incremental text output\n */\nexport interface OutputTextDeltaEvent extends BaseStreamEvent {\n  type: StreamEventType.OUTPUT_TEXT_DELTA;\n  item_id: string;\n  output_index: number;\n  content_index: number;\n  delta: string;\n  sequence_number: number;\n}\n\n/**\n * Text output complete for this item\n */\nexport interface OutputTextDoneEvent extends BaseStreamEvent {\n  type: StreamEventType.OUTPUT_TEXT_DONE;\n  item_id: string;\n  output_index: number;\n  text: string; // Complete accumulated text\n}\n\n/**\n * Tool call detected and starting\n */\nexport interface ToolCallStartEvent extends BaseStreamEvent {\n  type: StreamEventType.TOOL_CALL_START;\n  item_id: string;\n  tool_call_id: string;\n  tool_name: string;\n}\n\n/**\n * Tool call arguments delta - incremental JSON\n */\nexport interface ToolCallArgumentsDeltaEvent extends BaseStreamEvent {\n  type: StreamEventType.TOOL_CALL_ARGUMENTS_DELTA;\n  item_id: string;\n  tool_call_id: string;\n  tool_name: string;\n  delta: string; // JSON chunk\n  sequence_number: number;\n}\n\n/**\n * Tool call arguments complete\n */\nexport interface ToolCallArgumentsDoneEvent extends BaseStreamEvent {\n  type: StreamEventType.TOOL_CALL_ARGUMENTS_DONE;\n  tool_call_id: string;\n  tool_name: string;\n  arguments: string; // Complete JSON string\n  incomplete?: boolean; // True if truncated by max_tokens\n}\n\n/**\n * Tool execution starting\n */\nexport interface ToolExecutionStartEvent extends BaseStreamEvent {\n  type: StreamEventType.TOOL_EXECUTION_START;\n  tool_call_id: string;\n  tool_name: string;\n  arguments: any; // Parsed arguments\n}\n\n/**\n * Tool execution complete\n */\nexport interface ToolExecutionDoneEvent extends BaseStreamEvent {\n  type: StreamEventType.TOOL_EXECUTION_DONE;\n  tool_call_id: string;\n  tool_name: string;\n  result: any;\n  execution_time_ms: number;\n  error?: string; // If tool failed\n}\n\n/**\n * Iteration complete - end of agentic loop iteration\n */\nexport interface IterationCompleteEvent extends BaseStreamEvent {\n  type: StreamEventType.ITERATION_COMPLETE;\n  iteration: number;\n  tool_calls_count: number;\n  has_more_iterations: boolean;\n}\n\n/**\n * Response complete - final event\n */\nexport interface ResponseCompleteEvent extends BaseStreamEvent {\n  type: StreamEventType.RESPONSE_COMPLETE;\n  status: 'completed' | 'incomplete' | 'failed';\n  usage: TokenUsage;\n  iterations: number;\n  duration_ms?: number;\n}\n\n/**\n * Error event\n */\nexport interface ErrorEvent extends BaseStreamEvent {\n  type: StreamEventType.ERROR;\n  error: {\n    type: string;\n    message: string;\n    code?: string;\n  };\n  recoverable: boolean;\n}\n\n/**\n * Union type of all stream events\n * Discriminated by 'type' field for type narrowing\n */\nexport type StreamEvent =\n  | ResponseCreatedEvent\n  | ResponseInProgressEvent\n  | OutputTextDeltaEvent\n  | OutputTextDoneEvent\n  | ToolCallStartEvent\n  | ToolCallArgumentsDeltaEvent\n  | ToolCallArgumentsDoneEvent\n  | ToolExecutionStartEvent\n  | ToolExecutionDoneEvent\n  | IterationCompleteEvent\n  | ResponseCompleteEvent\n  | ErrorEvent;\n\n/**\n * Type guard to check if event is a specific type\n */\nexport function isStreamEvent<T extends StreamEvent>(\n  event: StreamEvent,\n  type: StreamEventType\n): event is T {\n  return event.type === type;\n}\n\n/**\n * Type guards for specific events\n */\nexport function isOutputTextDelta(event: StreamEvent): event is OutputTextDeltaEvent {\n  return event.type === StreamEventType.OUTPUT_TEXT_DELTA;\n}\n\nexport function isToolCallStart(event: StreamEvent): event is ToolCallStartEvent {\n  return event.type === StreamEventType.TOOL_CALL_START;\n}\n\nexport function isToolCallArgumentsDelta(\n  event: StreamEvent\n): event is ToolCallArgumentsDeltaEvent {\n  return event.type === StreamEventType.TOOL_CALL_ARGUMENTS_DELTA;\n}\n\nexport function isToolCallArgumentsDone(\n  event: StreamEvent\n): event is ToolCallArgumentsDoneEvent {\n  return event.type === StreamEventType.TOOL_CALL_ARGUMENTS_DONE;\n}\n\nexport function isResponseComplete(event: StreamEvent): event is ResponseCompleteEvent {\n  return event.type === StreamEventType.RESPONSE_COMPLETE;\n}\n\nexport function isErrorEvent(event: StreamEvent): event is ErrorEvent {\n  return event.type === StreamEventType.ERROR;\n}\n","/**\n * OpenAI text provider using Responses API\n */\n\nimport OpenAI from 'openai';\nimport { BaseTextProvider } from '../base/BaseTextProvider.js';\nimport { TextGenerateOptions, ModelCapabilities } from '../../../domain/interfaces/ITextProvider.js';\nimport { LLMResponse } from '../../../domain/entities/Response.js';\nimport { MessageRole } from '../../../domain/entities/Message.js';\nimport { ProviderCapabilities } from '../../../domain/interfaces/IProvider.js';\nimport { OpenAIConfig } from '../../../domain/types/ProviderConfig.js';\nimport {\n  ProviderAuthError,\n  ProviderRateLimitError,\n  ProviderContextLengthError,\n} from '../../../domain/errors/AIErrors.js';\nimport { StreamEvent, StreamEventType } from '../../../domain/entities/StreamEvent.js';\n\nexport class OpenAITextProvider extends BaseTextProvider {\n  readonly name: string = 'openai';\n  readonly capabilities: ProviderCapabilities = {\n    text: true,\n    images: true,\n    videos: false,\n    audio: true,\n  };\n\n  private client: OpenAI;\n\n  constructor(config: OpenAIConfig) {\n    super(config);\n\n    this.client = new OpenAI({\n      apiKey: this.getApiKey(),\n      baseURL: this.getBaseURL(),\n      organization: config.organization,\n      timeout: this.getTimeout(),\n      maxRetries: this.getMaxRetries(),\n    });\n  }\n\n  /**\n   * Generate response using OpenAI Responses API\n   */\n  async generate(options: TextGenerateOptions): Promise<LLMResponse> {\n    // Execute with circuit breaker protection and observability\n    return this.executeWithCircuitBreaker(async () => {\n      try {\n        // OpenAI Responses API format matches our internal format!\n        const response = await this.client.chat.completions.create({\n          model: options.model,\n          messages: this.convertInput(options.input, options.instructions),\n          tools: options.tools as any,\n          tool_choice: options.tool_choice as any,\n          temperature: options.temperature,\n          max_tokens: options.max_output_tokens,\n          response_format: options.response_format as any,\n        });\n\n        return this.convertResponse(response);\n      } catch (error: any) {\n        this.handleError(error);\n        throw error; // TypeScript needs this\n      }\n    }, options.model);\n  }\n\n  /**\n   * Stream response using OpenAI Streaming API\n   */\n  async *streamGenerate(options: TextGenerateOptions): AsyncIterableIterator<StreamEvent> {\n    try {\n      const stream = await this.client.chat.completions.create({\n        model: options.model,\n        messages: this.convertInput(options.input, options.instructions),\n        tools: options.tools as any,\n        tool_choice: options.tool_choice as any,\n        temperature: options.temperature,\n        max_tokens: options.max_output_tokens,\n        response_format: options.response_format as any,\n        stream: true,\n        stream_options: { include_usage: true },\n      });\n\n      let responseId = '';\n      let sequenceNumber = 0;\n      let hasUsage = false;\n      const toolCallBuffers = new Map<number, { id: string; name: string; args: string }>();\n\n      for await (const chunk of stream) {\n        // Debug: Check what's in the chunk\n        if (process.env.DEBUG_OPENAI && chunk.usage) {\n          console.error('[DEBUG] OpenAI chunk has usage:', chunk.usage);\n        }\n\n        // Initialize response ID on first chunk\n        if (!responseId) {\n          responseId = chunk.id;\n          yield {\n            type: StreamEventType.RESPONSE_CREATED,\n            response_id: responseId,\n            model: chunk.model,\n            created_at: chunk.created,\n          };\n        }\n\n        // Handle usage info FIRST (sent at the end when stream_options.include_usage is true)\n        // This chunk might not have a choice, so check usage before validating choice\n        if (chunk.usage) {\n          hasUsage = true;\n\n          if (process.env.DEBUG_OPENAI) {\n            console.error('[DEBUG] Emitting RESPONSE_COMPLETE with usage:', {\n              prompt_tokens: chunk.usage.prompt_tokens,\n              completion_tokens: chunk.usage.completion_tokens,\n              total_tokens: chunk.usage.total_tokens,\n            });\n          }\n\n          yield {\n            type: StreamEventType.RESPONSE_COMPLETE,\n            response_id: responseId,\n            status: 'completed',\n            usage: {\n              input_tokens: chunk.usage.prompt_tokens || 0,\n              output_tokens: chunk.usage.completion_tokens || 0,\n              total_tokens: chunk.usage.total_tokens || 0,\n            },\n            iterations: 1,\n          };\n        }\n\n        const choice = chunk.choices[0];\n        if (!choice) continue;\n\n        const delta = choice.delta;\n\n        // Handle text content deltas\n        if (delta.content) {\n          yield {\n            type: StreamEventType.OUTPUT_TEXT_DELTA,\n            response_id: responseId,\n            item_id: `msg_${responseId}`,\n            output_index: 0,\n            content_index: 0,\n            delta: delta.content,\n            sequence_number: sequenceNumber++,\n          };\n        }\n\n        // Handle tool calls\n        if (delta.tool_calls) {\n          for (const toolCall of delta.tool_calls) {\n            const index = toolCall.index;\n\n            if (!toolCallBuffers.has(index)) {\n              // Start new tool call\n              const toolCallId = toolCall.id || `call_${responseId}_${index}`;\n              const toolName = toolCall.function?.name || '';\n\n              toolCallBuffers.set(index, {\n                id: toolCallId,\n                name: toolName,\n                args: '',\n              });\n\n              yield {\n                type: StreamEventType.TOOL_CALL_START,\n                response_id: responseId,\n                item_id: `msg_${responseId}`,\n                tool_call_id: toolCallId,\n                tool_name: toolName,\n              };\n            }\n\n            // Accumulate tool arguments\n            if (toolCall.function?.arguments) {\n              const buffer = toolCallBuffers.get(index)!;\n              buffer.args += toolCall.function.arguments;\n\n              yield {\n                type: StreamEventType.TOOL_CALL_ARGUMENTS_DELTA,\n                response_id: responseId,\n                item_id: `msg_${responseId}`,\n                tool_call_id: buffer.id,\n                tool_name: buffer.name,\n                delta: toolCall.function.arguments,\n                sequence_number: sequenceNumber++,\n              };\n            }\n          }\n        }\n\n        // Check if tool calls are complete (finish_reason indicates end)\n        if (choice.finish_reason && toolCallBuffers.size > 0) {\n          for (const buffer of toolCallBuffers.values()) {\n            yield {\n              type: StreamEventType.TOOL_CALL_ARGUMENTS_DONE,\n              response_id: responseId,\n              tool_call_id: buffer.id,\n              tool_name: buffer.name,\n              arguments: buffer.args,\n            };\n          }\n        }\n      }\n\n      // If no usage info was sent, emit completion event with zero usage\n      if (responseId && !hasUsage) {\n        yield {\n          type: StreamEventType.RESPONSE_COMPLETE,\n          response_id: responseId,\n          status: 'completed',\n          usage: {\n            input_tokens: 0,\n            output_tokens: 0,\n            total_tokens: 0,\n          },\n          iterations: 1,\n        };\n      }\n    } catch (error: any) {\n      this.handleError(error);\n      throw error;\n    }\n  }\n\n  /**\n   * Get model capabilities\n   */\n  getModelCapabilities(model: string): ModelCapabilities {\n    // GPT-4 models\n    if (model.startsWith('gpt-4')) {\n      return {\n        supportsTools: true,\n        supportsVision: model.includes('vision') || !model.includes('0613'),\n        supportsJSON: true,\n        supportsJSONSchema: true,\n        maxTokens: model.includes('turbo') ? 128000 : 8192,\n        maxOutputTokens: 16384,\n      };\n    }\n\n    // GPT-3.5\n    if (model.startsWith('gpt-3.5')) {\n      return {\n        supportsTools: true,\n        supportsVision: false,\n        supportsJSON: true,\n        supportsJSONSchema: false,\n        maxTokens: 16385,\n        maxOutputTokens: 4096,\n      };\n    }\n\n    // o-series (reasoning models)\n    if (model.startsWith('o1') || model.startsWith('o3')) {\n      return {\n        supportsTools: false,\n        supportsVision: true,\n        supportsJSON: false,\n        supportsJSONSchema: false,\n        maxTokens: 200000,\n        maxOutputTokens: 100000,\n      };\n    }\n\n    // Default\n    return {\n      supportsTools: false,\n      supportsVision: false,\n      supportsJSON: false,\n      supportsJSONSchema: false,\n      maxTokens: 4096,\n      maxOutputTokens: 4096,\n    };\n  }\n\n  /**\n   * Convert our input format to OpenAI messages format\n   * @param input - Input messages\n   * @param instructions - Optional system instructions (prepended as DEVELOPER message for OpenAI)\n   */\n  private convertInput(input: string | any[], instructions?: string): any[] {\n    const messages: any[] = [];\n\n    if (typeof input === 'string') {\n      // Add instructions first as DEVELOPER role (OpenAI's system message)\n      if (instructions) {\n        messages.push({ role: 'developer', content: instructions });\n      }\n      messages.push({ role: 'user', content: input });\n      return messages;\n    }\n\n    // For InputItem[], check if there's already a developer message\n    const hasDeveloperMessage = Array.isArray(input) && input.some(\n      item => item.type === 'message' && item.role === 'developer'\n    );\n\n    // Add instructions as DEVELOPER message if provided and no existing developer message\n    if (instructions && !hasDeveloperMessage) {\n      messages.push({\n        role: 'developer',\n        content: instructions,\n      });\n    }\n\n    // Convert InputItem[] to OpenAI messages format\n    for (const item of input) {\n      if (item.type === 'message') {\n        const message: any = {\n          role: item.role, // Keep role as-is (developer, user, assistant)\n          content: [],\n        };\n\n        // Convert content array\n        for (const content of item.content) {\n          switch (content.type) {\n            case 'input_text':\n              message.content.push({ type: 'text', text: content.text });\n              break;\n            case 'input_image_url':\n              message.content.push({\n                type: 'image_url',\n                image_url: content.image_url,\n              });\n              break;\n            case 'output_text':\n              message.content.push({ type: 'text', text: content.text });\n              break;\n            case 'tool_use':\n              // OpenAI uses tool_calls at message level, not in content\n              if (!message.tool_calls) {\n                message.tool_calls = [];\n              }\n              message.tool_calls.push({\n                id: content.id,\n                type: 'function',\n                function: {\n                  name: content.name,\n                  arguments: content.arguments,\n                },\n              });\n              // Remove content array if we have tool calls\n              if (message.tool_calls.length > 0 && message.content.length === 0) {\n                message.content = null;\n              }\n              break;\n            case 'tool_result':\n              // Tool results are separate messages in OpenAI\n              messages.push({\n                role: 'tool',\n                tool_call_id: content.tool_use_id,\n                content: typeof content.content === 'string' ? content.content : JSON.stringify(content.content),\n              });\n              continue;\n          }\n        }\n\n        // Flatten content if it's a single text item\n        if (Array.isArray(message.content) && message.content.length === 1 && message.content[0].type === 'text') {\n          message.content = message.content[0].text;\n        }\n\n        messages.push(message);\n      }\n    }\n\n    return messages;\n  }\n\n  /**\n   * Convert OpenAI response to our LLMResponse format\n   */\n  private convertResponse(response: OpenAI.Chat.Completions.ChatCompletion): LLMResponse {\n    const choice = response.choices[0];\n    const message = choice?.message;\n\n    // Build content array\n    const content: any[] = [];\n\n    if (message?.content) {\n      content.push({\n        type: 'output_text',\n        text: message.content,\n        annotations: [],\n      });\n    }\n\n    // Add tool calls if present\n    if (message?.tool_calls) {\n      for (const toolCall of message.tool_calls) {\n        // Only process function type tool calls\n        if (toolCall.type === 'function' && 'function' in toolCall) {\n          content.push({\n            type: 'tool_use',\n            id: toolCall.id,\n            name: toolCall.function.name,\n            arguments: toolCall.function.arguments,\n          });\n        }\n      }\n    }\n\n    return {\n      id: response.id,\n      object: 'response',\n      created_at: response.created,\n      status: choice?.finish_reason === 'stop' ? 'completed' : 'incomplete',\n      model: response.model,\n      output: [\n        {\n          type: 'message' as const,\n          id: response.id,\n          role: MessageRole.ASSISTANT,\n          content,\n        },\n      ],\n      output_text: message?.content || '',\n      usage: {\n        input_tokens: response.usage?.prompt_tokens || 0,\n        output_tokens: response.usage?.completion_tokens || 0,\n        total_tokens: response.usage?.total_tokens || 0,\n      },\n    };\n  }\n\n  /**\n   * Handle OpenAI-specific errors\n   */\n  private handleError(error: any): never {\n    if (error.status === 401) {\n      throw new ProviderAuthError('openai', 'Invalid API key');\n    }\n\n    if (error.status === 429) {\n      const retryAfter = error.headers?.['retry-after'];\n      throw new ProviderRateLimitError(\n        'openai',\n        retryAfter ? parseInt(retryAfter) * 1000 : undefined\n      );\n    }\n\n    if (error.code === 'context_length_exceeded' || error.status === 413) {\n      throw new ProviderContextLengthError('openai', 128000);\n    }\n\n    // Re-throw other errors\n    throw error;\n  }\n}\n","/**\n * Content types based on OpenAI Responses API format\n */\n\nexport enum ContentType {\n  INPUT_TEXT = 'input_text',\n  INPUT_IMAGE_URL = 'input_image_url',\n  INPUT_FILE = 'input_file',\n  OUTPUT_TEXT = 'output_text',\n  TOOL_USE = 'tool_use',\n  TOOL_RESULT = 'tool_result',\n}\n\nexport interface BaseContent {\n  type: ContentType;\n}\n\nexport interface InputTextContent extends BaseContent {\n  type: ContentType.INPUT_TEXT;\n  text: string;\n}\n\nexport interface InputImageContent extends BaseContent {\n  type: ContentType.INPUT_IMAGE_URL;\n  image_url: {\n    url: string; // HTTP URL or data URI\n    detail?: 'auto' | 'low' | 'high';\n  };\n}\n\nexport interface InputFileContent extends BaseContent {\n  type: ContentType.INPUT_FILE;\n  file_id: string;\n}\n\nexport interface OutputTextContent extends BaseContent {\n  type: ContentType.OUTPUT_TEXT;\n  text: string;\n  annotations?: any[];\n}\n\nexport interface ToolUseContent extends BaseContent {\n  type: ContentType.TOOL_USE;\n  id: string;\n  name: string;\n  arguments: string; // JSON string\n}\n\nexport interface ToolResultContent extends BaseContent {\n  type: ContentType.TOOL_RESULT;\n  tool_use_id: string;\n  content: string | any;\n  error?: string;\n}\n\nexport type Content =\n  | InputTextContent\n  | InputImageContent\n  | InputFileContent\n  | OutputTextContent\n  | ToolUseContent\n  | ToolResultContent;\n","/**\n * Shared Tool Conversion Utilities\n *\n * DRY principle: Tool conversion logic shared across all providers\n * Each provider has slightly different tool formats, but the extraction\n * and basic conversion is the same.\n */\n\nimport { FunctionToolDefinition, Tool } from '../../../domain/entities/Tool.js';\n\n/**\n * Standardized tool format before provider-specific transformation\n */\nexport interface ProviderToolFormat {\n  name: string;\n  description: string;\n  parameters: Record<string, any>;\n}\n\n/**\n * Extract function tools from mixed tool array\n * Filters out built-in tools (web_search, code_interpreter, etc.)\n *\n * @param tools - Mixed array of tool definitions\n * @returns Only function tools\n */\nexport function extractFunctionTools(\n  tools: Tool[]\n): FunctionToolDefinition[] {\n  return tools.filter((t): t is FunctionToolDefinition => t.type === 'function');\n}\n\n/**\n * Convert tools to standard format (before provider transformation)\n * Extracts common properties: name, description, parameters\n *\n * @param tools - Array of tool definitions\n * @returns Standardized tool format\n */\nexport function convertToolsToStandardFormat(\n  tools: Tool[]\n): ProviderToolFormat[] {\n  return extractFunctionTools(tools).map((tool) => ({\n    name: tool.function.name,\n    description: tool.function.description || '',\n    parameters: tool.function.parameters || { type: 'object', properties: {} },\n  }));\n}\n\n/**\n * Transform for Anthropic API (uses input_schema)\n *\n * @param tool - Standardized tool format\n * @returns Anthropic-specific tool format\n */\nexport function transformForAnthropic(tool: ProviderToolFormat) {\n  return {\n    name: tool.name,\n    description: tool.description,\n    input_schema: tool.parameters,\n  };\n}\n\n/**\n * Transform for Google Gemini API (uses parameters)\n *\n * @param tool - Standardized tool format\n * @returns Google-specific tool format\n */\nexport function transformForGoogle(tool: ProviderToolFormat) {\n  return {\n    name: tool.name,\n    description: tool.description,\n    parameters: tool.parameters,\n  };\n}\n\n/**\n * Transform for OpenAI API (uses function definition)\n *\n * @param tool - Standardized tool format\n * @returns OpenAI-specific tool format\n */\nexport function transformForOpenAI(tool: ProviderToolFormat) {\n  return {\n    type: 'function' as const,\n    function: {\n      name: tool.name,\n      description: tool.description,\n      parameters: tool.parameters,\n    },\n  };\n}\n","/**\n * Anthropic converter - Converts between our Responses API format and Anthropic Messages API\n */\n\nimport Anthropic from '@anthropic-ai/sdk';\nimport { TextGenerateOptions } from '../../../domain/interfaces/ITextProvider.js';\nimport { LLMResponse } from '../../../domain/entities/Response.js';\nimport { InputItem, MessageRole, OutputItem } from '../../../domain/entities/Message.js';\nimport { Content, ContentType } from '../../../domain/entities/Content.js';\nimport { Tool } from '../../../domain/entities/Tool.js';\nimport { InvalidToolArgumentsError } from '../../../domain/errors/AIErrors.js';\nimport { convertToolsToStandardFormat, transformForAnthropic } from '../shared/ToolConversionUtils.js';\n\nexport class AnthropicConverter {\n  /**\n   * Convert our format  Anthropic Messages API format\n   */\n  convertRequest(options: TextGenerateOptions): Anthropic.MessageCreateParams {\n    const messages = this.convertMessages(options.input);\n    const tools = this.convertTools(options.tools);\n\n    const params: Anthropic.MessageCreateParams = {\n      model: options.model,\n      max_tokens: options.max_output_tokens || 4096,\n      messages,\n    };\n\n    // Add system instruction if provided\n    if (options.instructions) {\n      params.system = options.instructions;\n    }\n\n    // Add tools if provided\n    if (tools && tools.length > 0) {\n      params.tools = tools;\n    }\n\n    // Add temperature if provided\n    if (options.temperature !== undefined) {\n      params.temperature = options.temperature;\n    }\n\n    return params;\n  }\n\n  /**\n   * Convert our InputItem[]  Anthropic messages\n   */\n  private convertMessages(input: string | InputItem[]): Anthropic.MessageParam[] {\n    if (typeof input === 'string') {\n      return [{ role: 'user', content: input }];\n    }\n\n    const messages: Anthropic.MessageParam[] = [];\n\n    for (const item of input) {\n      if (item.type === 'message') {\n        // Map roles: 'developer'  'user' (Anthropic doesn't have developer role)\n        const role = item.role === MessageRole.DEVELOPER ? 'user' : item.role;\n\n        // Convert content\n        const content = this.convertContent(item.content);\n\n        messages.push({\n          role: role as 'user' | 'assistant',\n          content,\n        });\n      }\n    }\n\n    return messages;\n  }\n\n  /**\n   * Convert our Content[]  Anthropic content blocks\n   */\n  private convertContent(content: Content[]): Anthropic.MessageParam['content'] {\n    const blocks: any[] = [];\n\n    for (const c of content) {\n      switch (c.type) {\n        case ContentType.INPUT_TEXT:\n        case ContentType.OUTPUT_TEXT:\n          blocks.push({\n            type: 'text',\n            text: c.text,\n          });\n          break;\n\n        case ContentType.INPUT_IMAGE_URL:\n          // Anthropic supports image URLs in Claude 3.5+\n          // Try URL first, will fall back to base64 if needed\n          if (c.image_url.url.startsWith('data:')) {\n            // Parse data URI\n            const matches = c.image_url.url.match(/^data:image\\/(\\w+);base64,(.+)$/);\n            if (matches) {\n              const mediaType = `image/${matches[1]}` as Anthropic.ImageBlockParam['source']['media_type'];\n              const data = matches[2];\n              blocks.push({\n                type: 'image',\n                source: {\n                  type: 'base64',\n                  media_type: mediaType,\n                  data,\n                },\n              });\n            }\n          } else {\n            // Use URL (Claude 3.5+ supports this)\n            blocks.push({\n              type: 'image',\n              source: {\n                type: 'url',\n                url: c.image_url.url,\n              },\n            });\n          }\n          break;\n\n        case ContentType.TOOL_RESULT:\n          blocks.push({\n            type: 'tool_result',\n            tool_use_id: c.tool_use_id,\n            content: typeof c.content === 'string' ? c.content : JSON.stringify(c.content),\n            is_error: !!c.error,\n          });\n          break;\n\n        case ContentType.TOOL_USE:\n          // This appears in assistant messages\n          // Safe JSON parse with error handling\n          let parsedInput: unknown;\n          try {\n            parsedInput = JSON.parse(c.arguments);\n          } catch (parseError) {\n            throw new InvalidToolArgumentsError(\n              c.name,\n              c.arguments,\n              parseError instanceof Error ? parseError : new Error(String(parseError))\n            );\n          }\n          blocks.push({\n            type: 'tool_use',\n            id: c.id,\n            name: c.name,\n            input: parsedInput,\n          });\n          break;\n      }\n    }\n\n    // If only one text block, return as string\n    if (blocks.length === 1 && blocks[0]?.type === 'text') {\n      return (blocks[0] as Anthropic.TextBlock).text;\n    }\n\n    return blocks;\n  }\n\n  /**\n   * Convert our Tool[]  Anthropic tools\n   */\n  private convertTools(tools?: Tool[]): Anthropic.Tool[] | undefined {\n    if (!tools || tools.length === 0) {\n      return undefined;\n    }\n\n    // Use shared conversion utilities (DRY)\n    const standardTools = convertToolsToStandardFormat(tools);\n    return standardTools.map(tool => ({\n      ...transformForAnthropic(tool),\n      input_schema: {\n        type: 'object',\n        ...tool.parameters,\n      } as any,\n    }));\n  }\n\n  /**\n   * Convert Anthropic response  our LLMResponse format\n   */\n  convertResponse(response: Anthropic.Message): LLMResponse {\n    const output: OutputItem[] = [\n      {\n        type: 'message',\n        id: response.id,\n        role: MessageRole.ASSISTANT,\n        content: this.convertAnthropicContent(response.content),\n      },\n    ];\n\n    return {\n      id: `resp_anthropic_${response.id}`,\n      object: 'response',\n      created_at: Math.floor(Date.now() / 1000),\n      status: this.mapStopReason(response.stop_reason),\n      model: response.model,\n      output,\n      output_text: this.extractOutputText(response.content),\n      usage: {\n        input_tokens: response.usage.input_tokens,\n        output_tokens: response.usage.output_tokens,\n        total_tokens: response.usage.input_tokens + response.usage.output_tokens,\n      },\n    };\n  }\n\n  /**\n   * Convert Anthropic content blocks  our Content[]\n   */\n  private convertAnthropicContent(\n    blocks: Array<Anthropic.ContentBlock>\n  ): Content[] {\n    const content: Content[] = [];\n\n    for (const block of blocks) {\n      if (block.type === 'text') {\n        content.push({\n          type: ContentType.OUTPUT_TEXT,\n          text: block.text,\n          annotations: [],\n        });\n      } else if (block.type === 'tool_use') {\n        content.push({\n          type: ContentType.TOOL_USE,\n          id: block.id,\n          name: block.name,\n          arguments: JSON.stringify(block.input), // Convert object to JSON string\n        });\n      }\n    }\n\n    return content;\n  }\n\n  /**\n   * Extract output text from Anthropic content blocks\n   */\n  private extractOutputText(blocks: Array<Anthropic.ContentBlock>): string {\n    const textBlocks = blocks.filter(\n      (b): b is Anthropic.TextBlock => b.type === 'text'\n    );\n    return textBlocks.map((b) => b.text).join('\\n');\n  }\n\n  /**\n   * Map Anthropic stop_reason  our status\n   */\n  private mapStopReason(\n    stopReason: string | null\n  ): 'completed' | 'incomplete' | 'failed' {\n    switch (stopReason) {\n      case 'end_turn':\n        return 'completed';\n      case 'tool_use':\n        return 'completed'; // Tool use is normal completion\n      case 'max_tokens':\n        return 'incomplete';\n      case 'stop_sequence':\n        return 'completed';\n      default:\n        return 'incomplete';\n    }\n  }\n}\n","/**\n * Anthropic stream converter - converts Anthropic SSE events to our unified StreamEvent format\n */\n\nimport Anthropic from '@anthropic-ai/sdk';\nimport { StreamEvent, StreamEventType } from '../../../domain/entities/StreamEvent.js';\n\n/**\n * Converts Anthropic streaming events to our unified StreamEvent format\n */\nexport class AnthropicStreamConverter {\n  private responseId: string = '';\n  private model: string = '';\n  private sequenceNumber: number = 0;\n  private contentBlockIndex: Map<number, { type: string; id?: string; name?: string; accumulatedArgs?: string }> = new Map();\n  private usage: { input_tokens: number; output_tokens: number } = { input_tokens: 0, output_tokens: 0 };\n\n  /**\n   * Convert Anthropic stream to our StreamEvent format\n   */\n  async *convertStream(\n    anthropicStream: AsyncIterable<Anthropic.MessageStreamEvent>,\n    model: string\n  ): AsyncIterableIterator<StreamEvent> {\n    this.model = model;\n    this.sequenceNumber = 0;\n    this.contentBlockIndex.clear();\n    this.usage = { input_tokens: 0, output_tokens: 0 };\n\n    for await (const event of anthropicStream) {\n      const converted = this.convertEvent(event);\n      if (converted) {\n        for (const evt of converted) {\n          yield evt;\n        }\n      }\n    }\n  }\n\n  /**\n   * Convert single Anthropic event to our event(s)\n   */\n  private convertEvent(event: Anthropic.MessageStreamEvent): StreamEvent[] {\n    const eventType = event.type;\n\n    switch (eventType) {\n      case 'message_start':\n        return this.handleMessageStart(event as Anthropic.MessageStartEvent);\n\n      case 'content_block_start':\n        return this.handleContentBlockStart(event as Anthropic.ContentBlockStartEvent);\n\n      case 'content_block_delta':\n        return this.handleContentBlockDelta(event as Anthropic.ContentBlockDeltaEvent);\n\n      case 'content_block_stop':\n        return this.handleContentBlockStop(event as Anthropic.ContentBlockStopEvent);\n\n      case 'message_delta':\n        return this.handleMessageDelta(event as Anthropic.MessageDeltaEvent);\n\n      case 'message_stop':\n        return this.handleMessageStop();\n\n      default:\n        // Handle ping and other event types\n        return [];\n    }\n  }\n\n  /**\n   * Handle message_start event\n   */\n  private handleMessageStart(event: Anthropic.MessageStartEvent): StreamEvent[] {\n    this.responseId = event.message.id;\n\n    // Capture input_tokens from message_start (only place it's available)\n    if (event.message.usage) {\n      this.usage.input_tokens = event.message.usage.input_tokens || 0;\n    }\n\n    return [\n      {\n        type: StreamEventType.RESPONSE_CREATED,\n        response_id: this.responseId,\n        model: this.model,\n        created_at: Date.now(),\n      },\n    ];\n  }\n\n  /**\n   * Handle content_block_start event\n   */\n  private handleContentBlockStart(event: Anthropic.ContentBlockStartEvent): StreamEvent[] {\n    const index = event.index;\n    const block = event.content_block;\n\n    // Track block type\n    if (block.type === 'text') {\n      this.contentBlockIndex.set(index, { type: 'text' });\n      return []; // No event needed, text will come in deltas\n    } else if (block.type === 'tool_use') {\n      this.contentBlockIndex.set(index, {\n        type: 'tool_use',\n        id: block.id,\n        name: block.name,\n        accumulatedArgs: '', // Initialize args accumulator\n      });\n\n      return [\n        {\n          type: StreamEventType.TOOL_CALL_START,\n          response_id: this.responseId,\n          item_id: `msg_${this.responseId}`,\n          tool_call_id: block.id,\n          tool_name: block.name,\n        },\n      ];\n    }\n\n    return [];\n  }\n\n  /**\n   * Handle content_block_delta event\n   */\n  private handleContentBlockDelta(event: Anthropic.ContentBlockDeltaEvent): StreamEvent[] {\n    const index = event.index;\n    const delta = event.delta;\n    const blockInfo = this.contentBlockIndex.get(index);\n\n    if (!blockInfo) return [];\n\n    if (delta.type === 'text_delta') {\n      return [\n        {\n          type: StreamEventType.OUTPUT_TEXT_DELTA,\n          response_id: this.responseId,\n          item_id: `msg_${this.responseId}`,\n          output_index: 0,\n          content_index: index,\n          delta: delta.text,\n          sequence_number: this.sequenceNumber++,\n        },\n      ];\n    } else if (delta.type === 'input_json_delta') {\n      // Accumulate tool arguments\n      if (blockInfo.accumulatedArgs !== undefined) {\n        blockInfo.accumulatedArgs += delta.partial_json;\n      }\n\n      // Tool arguments delta\n      return [\n        {\n          type: StreamEventType.TOOL_CALL_ARGUMENTS_DELTA,\n          response_id: this.responseId,\n          item_id: `msg_${this.responseId}`,\n          tool_call_id: blockInfo.id || '',\n          tool_name: blockInfo.name || '',\n          delta: delta.partial_json,\n          sequence_number: this.sequenceNumber++,\n        },\n      ];\n    }\n\n    return [];\n  }\n\n  /**\n   * Handle content_block_stop event\n   */\n  private handleContentBlockStop(event: Anthropic.ContentBlockStopEvent): StreamEvent[] {\n    const index = event.index;\n    const blockInfo = this.contentBlockIndex.get(index);\n\n    if (!blockInfo) return [];\n\n    // If this was a tool use block, emit arguments done\n    if (blockInfo.type === 'tool_use') {\n      return [\n        {\n          type: StreamEventType.TOOL_CALL_ARGUMENTS_DONE,\n          response_id: this.responseId,\n          tool_call_id: blockInfo.id || '',\n          tool_name: blockInfo.name || '',\n          arguments: blockInfo.accumulatedArgs || '{}', // Use accumulated args\n        },\n      ];\n    }\n\n    return [];\n  }\n\n  /**\n   * Handle message_delta event (usage info, stop_reason)\n   */\n  private handleMessageDelta(event: Anthropic.MessageDeltaEvent): StreamEvent[] {\n    // Extract usage info (Anthropic sends output_tokens in message_delta)\n    // Note: input_tokens is only available in message_start, not in delta\n    if (event.usage) {\n      this.usage.output_tokens = event.usage.output_tokens || 0;\n    }\n\n    // No events to emit - we'll include usage in message_stop\n    return [];\n  }\n\n  /**\n   * Handle message_stop event (final event)\n   */\n  private handleMessageStop(): StreamEvent[] {\n    return [\n      {\n        type: StreamEventType.RESPONSE_COMPLETE,\n        response_id: this.responseId,\n        status: 'completed',\n        usage: {\n          input_tokens: this.usage.input_tokens,\n          output_tokens: this.usage.output_tokens,\n          total_tokens: this.usage.input_tokens + this.usage.output_tokens,\n        },\n        iterations: 1,\n      },\n    ];\n  }\n\n  /**\n   * Clear all internal state\n   * Should be called after each stream completes to prevent memory leaks\n   */\n  clear(): void {\n    this.responseId = '';\n    this.model = '';\n    this.sequenceNumber = 0;\n    this.contentBlockIndex.clear();\n    this.usage = { input_tokens: 0, output_tokens: 0 };\n  }\n\n  /**\n   * Reset converter state for a new stream\n   * Alias for clear()\n   */\n  reset(): void {\n    this.clear();\n  }\n}\n","/**\n * Anthropic (Claude) text provider\n */\n\nimport Anthropic from '@anthropic-ai/sdk';\nimport { BaseTextProvider } from '../base/BaseTextProvider.js';\nimport { TextGenerateOptions, ModelCapabilities } from '../../../domain/interfaces/ITextProvider.js';\nimport { LLMResponse } from '../../../domain/entities/Response.js';\nimport { ProviderCapabilities } from '../../../domain/interfaces/IProvider.js';\nimport { AnthropicConfig } from '../../../domain/types/ProviderConfig.js';\nimport {\n  ProviderAuthError,\n  ProviderRateLimitError,\n  ProviderContextLengthError,\n} from '../../../domain/errors/AIErrors.js';\nimport { AnthropicConverter } from './AnthropicConverter.js';\nimport { AnthropicStreamConverter } from './AnthropicStreamConverter.js';\nimport { StreamEvent } from '../../../domain/entities/StreamEvent.js';\n\nexport class AnthropicTextProvider extends BaseTextProvider {\n  readonly name = 'anthropic';\n  readonly capabilities: ProviderCapabilities = {\n    text: true,\n    images: true, // Claude 3+ supports vision\n    videos: false,\n    audio: false,\n  };\n\n  private client: Anthropic;\n  private converter: AnthropicConverter;\n  private streamConverter: AnthropicStreamConverter;\n\n  constructor(config: AnthropicConfig) {\n    super(config);\n\n    this.client = new Anthropic({\n      apiKey: this.getApiKey(),\n      baseURL: this.getBaseURL(),\n      maxRetries: this.getMaxRetries(),\n    });\n    this.converter = new AnthropicConverter();\n    this.streamConverter = new AnthropicStreamConverter();\n  }\n\n  /**\n   * Generate response using Anthropic Messages API\n   */\n  async generate(options: TextGenerateOptions): Promise<LLMResponse> {\n    return this.executeWithCircuitBreaker(async () => {\n      try {\n        // Convert our format  Anthropic Messages API format\n        const anthropicRequest = this.converter.convertRequest(options);\n\n        // Call Anthropic API (not stream)\n        const anthropicResponse = await this.client.messages.create({\n          ...anthropicRequest,\n          stream: false,\n        });\n\n        // Convert Anthropic response  our format\n        return this.converter.convertResponse(anthropicResponse);\n      } catch (error: any) {\n        this.handleError(error);\n        throw error; // TypeScript needs this\n      }\n    }, options.model);\n  }\n\n  /**\n   * Stream response using Anthropic Messages API\n   */\n  async *streamGenerate(options: TextGenerateOptions): AsyncIterableIterator<StreamEvent> {\n    try {\n      // Convert our format  Anthropic Messages API format\n      const anthropicRequest = this.converter.convertRequest(options);\n\n      // Create stream\n      const stream = await this.client.messages.create({\n        ...anthropicRequest,\n        stream: true,\n      });\n\n      // Reset stream converter for reuse\n      this.streamConverter.reset();\n\n      // Convert Anthropic events  our StreamEvent format\n      yield* this.streamConverter.convertStream(stream, options.model);\n    } catch (error: any) {\n      this.handleError(error);\n      throw error;\n    } finally {\n      // ALWAYS clear stream converter to prevent memory leaks\n      // Use finally block to ensure cleanup even on exception\n      this.streamConverter.clear();\n    }\n  }\n\n  /**\n   * Get model capabilities\n   */\n  getModelCapabilities(model: string): ModelCapabilities {\n    // Claude 4.5 and Claude 4 (Sonnet, Opus, Haiku)\n    if (model.includes('claude-sonnet-4') || model.includes('claude-opus-4') || model.includes('claude-haiku-4')) {\n      return {\n        supportsTools: true,\n        supportsVision: true,\n        supportsJSON: true,\n        supportsJSONSchema: false, // Use prompt engineering\n        maxTokens: 200000,\n        maxOutputTokens: 8192,\n      };\n    }\n\n    // Claude 3.5 Sonnet\n    if (model.includes('claude-3-5-sonnet') || model.includes('claude-3-7-sonnet')) {\n      return {\n        supportsTools: true,\n        supportsVision: true,\n        supportsJSON: true,\n        supportsJSONSchema: false,\n        maxTokens: 200000,\n        maxOutputTokens: 8192,\n      };\n    }\n\n    // Claude 3 Opus\n    if (model.includes('claude-3-opus')) {\n      return {\n        supportsTools: true,\n        supportsVision: true,\n        supportsJSON: true,\n        supportsJSONSchema: false,\n        maxTokens: 200000,\n        maxOutputTokens: 4096,\n      };\n    }\n\n    // Claude 3 Sonnet\n    if (model.includes('claude-3-sonnet')) {\n      return {\n        supportsTools: true,\n        supportsVision: true,\n        supportsJSON: true,\n        supportsJSONSchema: false,\n        maxTokens: 200000,\n        maxOutputTokens: 4096,\n      };\n    }\n\n    // Claude 3 Haiku\n    if (model.includes('claude-3-haiku')) {\n      return {\n        supportsTools: true,\n        supportsVision: true,\n        supportsJSON: true,\n        supportsJSONSchema: false,\n        maxTokens: 200000,\n        maxOutputTokens: 4096,\n      };\n    }\n\n\n    // Default for unknown models\n    return {\n      supportsTools: true,\n      supportsVision: true,\n      supportsJSON: true,\n      supportsJSONSchema: false,\n      maxTokens: 200000,\n      maxOutputTokens: 4096,\n    };\n  }\n\n  /**\n   * Handle Anthropic-specific errors\n   */\n  private handleError(error: any): never {\n    if (error.status === 401) {\n      throw new ProviderAuthError('anthropic', 'Invalid API key');\n    }\n\n    if (error.status === 429) {\n      const retryAfter = error.headers?.['retry-after'];\n      throw new ProviderRateLimitError(\n        'anthropic',\n        retryAfter ? parseInt(retryAfter) * 1000 : undefined\n      );\n    }\n\n    if (\n      error.type === 'invalid_request_error' &&\n      (error.message?.includes('prompt is too long') ||\n        error.message?.includes('maximum context length'))\n    ) {\n      throw new ProviderContextLengthError('anthropic', 200000);\n    }\n\n    // Re-throw other errors\n    throw error;\n  }\n}\n","/**\n * Image utilities for processing images\n */\n\nexport interface ImageData {\n  mimeType: string;\n  base64Data: string;\n  size: number;\n}\n\nexport interface FetchImageOptions {\n  /** Timeout in milliseconds (default: 30000) */\n  timeoutMs?: number;\n  /** Maximum image size in bytes (default: 10MB) */\n  maxSizeBytes?: number;\n}\n\nconst DEFAULT_TIMEOUT_MS = 30000; // 30 seconds\nconst DEFAULT_MAX_SIZE_BYTES = 10 * 1024 * 1024; // 10MB\n\n/**\n * Fetch an image from URL and convert to base64\n * Used by providers that require base64 (like Google)\n */\nexport async function fetchImageAsBase64(\n  url: string,\n  options?: FetchImageOptions\n): Promise<ImageData> {\n  const { timeoutMs = DEFAULT_TIMEOUT_MS, maxSizeBytes = DEFAULT_MAX_SIZE_BYTES } = options || {};\n\n  // Check if it's already a data URI\n  if (url.startsWith('data:image/')) {\n    const matches = url.match(/^data:(image\\/\\w+);base64,(.+)$/);\n    if (matches) {\n      const base64Data = matches[2] || '';\n      const size = calculateBase64Size(base64Data);\n\n      // Check size limit for data URIs too\n      if (size > maxSizeBytes) {\n        throw new Error(`Image size (${formatBytes(size)}) exceeds maximum allowed (${formatBytes(maxSizeBytes)})`);\n      }\n\n      return {\n        mimeType: matches[1] || 'image/png',\n        base64Data,\n        size,\n      };\n    }\n  }\n\n  // Fetch from URL with timeout and size limit\n  const controller = new AbortController();\n  const timeoutId = setTimeout(() => controller.abort(), timeoutMs);\n\n  try {\n    const response = await fetch(url, {\n      signal: controller.signal,\n    });\n\n    if (!response.ok) {\n      throw new Error(`Failed to fetch image: ${response.status} ${response.statusText}`);\n    }\n\n    // Check content-length header before downloading\n    const contentLength = response.headers.get('content-length');\n    if (contentLength) {\n      const size = parseInt(contentLength, 10);\n      if (size > maxSizeBytes) {\n        throw new Error(\n          `Image size (${formatBytes(size)}) exceeds maximum allowed (${formatBytes(maxSizeBytes)})`\n        );\n      }\n    }\n\n    // Stream the response with size limit\n    const reader = response.body?.getReader();\n    if (!reader) {\n      throw new Error('Failed to get response body reader');\n    }\n\n    const chunks: Uint8Array[] = [];\n    let totalSize = 0;\n\n    while (true) {\n      const { done, value } = await reader.read();\n      if (done) break;\n\n      totalSize += value.length;\n      if (totalSize > maxSizeBytes) {\n        reader.cancel();\n        throw new Error(\n          `Image size exceeds maximum allowed (${formatBytes(maxSizeBytes)})`\n        );\n      }\n      chunks.push(value);\n    }\n\n    // Combine chunks into a single buffer\n    const buffer = Buffer.concat(chunks.map((chunk) => Buffer.from(chunk)));\n    const base64Data = buffer.toString('base64');\n\n    // Detect MIME type from content-type header or buffer magic numbers\n    let mimeType = response.headers.get('content-type') || 'image/png';\n\n    // Validate it's an image\n    if (!mimeType.startsWith('image/')) {\n      // Try to detect from magic numbers\n      mimeType = detectImageFormatFromBuffer(buffer);\n    }\n\n    return {\n      mimeType,\n      base64Data,\n      size: buffer.length,\n    };\n  } catch (error: any) {\n    if (error.name === 'AbortError') {\n      throw new Error(`Image fetch timed out after ${timeoutMs}ms`);\n    }\n    throw new Error(`Failed to fetch image from URL: ${error.message}`);\n  } finally {\n    clearTimeout(timeoutId);\n  }\n}\n\n/**\n * Detect image format from buffer magic numbers\n */\nfunction detectImageFormatFromBuffer(buffer: Buffer): string {\n  const magic = buffer.slice(0, 4).toString('hex');\n\n  if (magic.startsWith('89504e47')) return 'image/png';\n  if (magic.startsWith('ffd8ff')) return 'image/jpeg';\n  if (magic.startsWith('47494638')) return 'image/gif';\n  if (magic.startsWith('52494646')) return 'image/webp';\n\n  throw new Error('URL does not point to a valid image');\n}\n\n/**\n * Detect image format from base64 data\n */\nexport function detectImageFormat(base64Data: string): string {\n  const buffer = Buffer.from(base64Data, 'base64');\n  const magic = buffer.slice(0, 4).toString('hex');\n\n  if (magic.startsWith('89504e47')) return 'image/png';\n  if (magic.startsWith('ffd8ff')) return 'image/jpeg';\n  if (magic.startsWith('47494638')) return 'image/gif';\n  if (magic.startsWith('52494646')) return 'image/webp';\n\n  return 'image/png'; // Default\n}\n\n/**\n * Calculate accurate size from base64 data (in bytes)\n * Accounts for padding characters\n */\nexport function calculateBase64Size(base64Data: string): number {\n  // Remove data URI prefix if present\n  const data = base64Data.includes(',') ? base64Data.split(',')[1] : base64Data;\n\n  if (!data || data.length === 0) return 0;\n\n  // Count padding characters\n  let padding = 0;\n  if (data.endsWith('==')) padding = 2;\n  else if (data.endsWith('=')) padding = 1;\n\n  // Accurate calculation: (length * 3 / 4) - padding\n  return Math.floor((data.length * 3) / 4) - padding;\n}\n\n/**\n * Format bytes into human-readable string\n */\nfunction formatBytes(bytes: number): string {\n  if (bytes < 1024) return `${bytes} bytes`;\n  if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`;\n  return `${(bytes / (1024 * 1024)).toFixed(1)} MB`;\n}\n","/**\n * Google Gemini converter - Converts between our Responses API format and Google Gemini API\n * Works with both @google/genai SDK (for Gemini API and Vertex AI)\n */\n\n// Import types - the new SDK may have different type names\nimport { randomUUID } from 'crypto';\nimport type {\n  Content as GeminiContent,\n  Part,\n  FunctionDeclaration,\n} from '@google/genai';\nimport { TextGenerateOptions } from '../../../domain/interfaces/ITextProvider.js';\nimport { LLMResponse } from '../../../domain/entities/Response.js';\nimport { InputItem, MessageRole, OutputItem } from '../../../domain/entities/Message.js';\nimport { convertToolsToStandardFormat } from '../shared/ToolConversionUtils.js';\nimport { Content, ContentType } from '../../../domain/entities/Content.js';\nimport { Tool } from '../../../domain/entities/Tool.js';\nimport { fetchImageAsBase64 } from '../../../utils/imageUtils.js';\nimport { InvalidToolArgumentsError } from '../../../domain/errors/AIErrors.js';\n\nexport class GoogleConverter {\n  // Track tool call ID  tool name mapping for tool results\n  private toolCallMapping: Map<string, string> = new Map();\n  // Track tool call ID  thought signature for Gemini 3+\n  private thoughtSignatures: Map<string, string> = new Map();\n\n  /**\n   * Convert our format  Google Gemini format\n   */\n  async convertRequest(options: TextGenerateOptions): Promise<any> {\n    // Debug input messages\n    if (process.env.DEBUG_GOOGLE && Array.isArray(options.input)) {\n      console.error('[DEBUG] Input messages:', JSON.stringify(options.input.map((msg: any) => ({\n        type: msg.type,\n        role: msg.role,\n        contentTypes: msg.content?.map((c: any) => c.type),\n      })), null, 2));\n    }\n\n    const contents = await this.convertMessages(options.input);\n    const tools = this.convertTools(options.tools);\n\n    // Debug: Check final contents\n    if (process.env.DEBUG_GOOGLE) {\n      console.error('[DEBUG] Final contents array length:', contents.length);\n    }\n\n    const request: any = {\n      contents,\n    };\n\n    // Add system instruction if provided\n    if (options.instructions) {\n      request.systemInstruction = { parts: [{ text: options.instructions }] };\n    }\n\n    // Add tools if provided\n    if (tools && tools.length > 0) {\n      request.tools = [{ functionDeclarations: tools }];\n\n      // Add tool config to encourage tool use\n      request.toolConfig = {\n        functionCallingConfig: {\n          mode: options.tool_choice === 'required' ? 'ANY' : 'AUTO',\n        },\n      };\n    }\n\n    // Add generation config\n    request.generationConfig = {\n      temperature: options.temperature,\n      maxOutputTokens: options.max_output_tokens,\n    };\n\n    // Disable Google's code execution if we have function tools\n    // (prevents model from generating code instead of calling tools)\n    if (tools && tools.length > 0) {\n      request.generationConfig.allowCodeExecution = false;\n    }\n\n    // Handle JSON output\n    if (options.response_format) {\n      if (options.response_format.type === 'json_object') {\n        request.generationConfig.responseMimeType = 'application/json';\n      } else if (options.response_format.type === 'json_schema') {\n        request.generationConfig.responseMimeType = 'application/json';\n        // Google doesn't support full JSON schema - would need to add to system instruction\n      }\n    }\n\n    return request;\n  }\n\n  /**\n   * Convert our InputItem[]  Google contents\n   */\n  private async convertMessages(input: string | InputItem[]): Promise<GeminiContent[]> {\n    if (typeof input === 'string') {\n      return [\n        {\n          role: 'user',\n          parts: [{ text: input }],\n        },\n      ];\n    }\n\n    const contents: GeminiContent[] = [];\n\n    for (const item of input) {\n      if (item.type === 'message') {\n        // Map roles\n        const role = item.role === MessageRole.USER || item.role === MessageRole.DEVELOPER ? 'user' : 'model';\n\n        // Convert content to parts\n        const parts = await this.convertContentToParts(item.content);\n\n        // Debug logging\n        if (process.env.DEBUG_GOOGLE) {\n          console.error(`[DEBUG] Converting message - role: ${item.role}  ${role}, parts: ${parts.length}`,\n            parts.map((p: any) => Object.keys(p)));\n        }\n\n        if (parts.length > 0) {\n          contents.push({\n            role,\n            parts,\n          });\n        }\n      }\n    }\n\n    return contents;\n  }\n\n  /**\n   * Convert our Content[]  Google parts\n   */\n  private async convertContentToParts(content: Content[]): Promise<Part[]> {\n    const parts: Part[] = [];\n\n    for (const c of content) {\n      switch (c.type) {\n        case ContentType.INPUT_TEXT:\n        case ContentType.OUTPUT_TEXT:\n          parts.push({ text: c.text });\n          break;\n\n        case ContentType.INPUT_IMAGE_URL:\n          // Google requires inline data (base64), not URLs\n          try {\n            const imageData = await fetchImageAsBase64(c.image_url.url);\n            parts.push({\n              inlineData: {\n                mimeType: imageData.mimeType,\n                data: imageData.base64Data,\n              },\n            });\n          } catch (error: any) {\n            // If image fetch fails, skip it and add error as text\n            console.error(`Failed to fetch image: ${error.message}`);\n            parts.push({\n              text: `[Error: Could not load image from ${c.image_url.url}]`,\n            });\n          }\n          break;\n\n        case ContentType.TOOL_USE:\n          // Store tool call ID  name mapping for later use\n          this.toolCallMapping.set(c.id, c.name);\n\n          // Safe JSON parse with error handling\n          let parsedArgs: unknown;\n          try {\n            parsedArgs = JSON.parse(c.arguments);\n          } catch (parseError) {\n            throw new InvalidToolArgumentsError(\n              c.name,\n              c.arguments,\n              parseError instanceof Error ? parseError : new Error(String(parseError))\n            );\n          }\n\n          // Google uses functionCall\n          const functionCallPart: any = {\n            functionCall: {\n              name: c.name,\n              args: parsedArgs,\n            },\n          };\n\n          // Add thought signature if we have one (required for Gemini 3+)\n          const signature = this.thoughtSignatures.get(c.id);\n\n          if (process.env.DEBUG_GOOGLE) {\n            console.error(`[DEBUG] Looking up signature for tool ID: ${c.id}`);\n            console.error(`[DEBUG] Found signature:`, signature ? 'YES' : 'NO');\n            console.error(`[DEBUG] Available signatures:`, Array.from(this.thoughtSignatures.keys()));\n          }\n\n          if (signature) {\n            functionCallPart.thoughtSignature = signature;\n          }\n\n          parts.push(functionCallPart);\n          break;\n\n        case ContentType.TOOL_RESULT:\n          // Google uses functionResponse - look up the actual function name\n          const functionName = this.toolCallMapping.get(c.tool_use_id) || this.extractToolName(c.tool_use_id);\n\n          parts.push({\n            functionResponse: {\n              name: functionName, // Use actual function name from mapping\n              response: {\n                result: typeof c.content === 'string' ? c.content : c.content,\n              },\n            },\n          });\n          break;\n      }\n    }\n\n    return parts;\n  }\n\n  /**\n   * Convert our Tool[]  Google function declarations\n   */\n  private convertTools(tools?: Tool[]): FunctionDeclaration[] | undefined {\n    if (!tools || tools.length === 0) {\n      return undefined;\n    }\n\n    // Use shared conversion utilities (DRY)\n    const standardTools = convertToolsToStandardFormat(tools);\n    return standardTools.map((tool) => ({\n      name: tool.name,\n      description: tool.description,\n      parameters: this.convertParametersSchema(tool.parameters),\n    }));\n  }\n\n  /**\n   * Convert JSON Schema parameters to Google's format\n   */\n  private convertParametersSchema(schema: any): any {\n    if (!schema) return undefined;\n\n    const converted: any = {\n      type: 'OBJECT', // Google uses uppercase 'OBJECT'\n      properties: {},\n    };\n\n    // Convert property types to uppercase\n    if (schema.properties) {\n      for (const [key, value] of Object.entries(schema.properties)) {\n        const prop = value as any;\n        converted.properties[key] = {\n          type: prop.type?.toUpperCase() || 'STRING',\n          description: prop.description,\n        };\n\n        // Handle enums\n        if (prop.enum) {\n          converted.properties[key].enum = prop.enum;\n        }\n\n        // Handle nested objects/arrays\n        if (prop.type === 'object' && prop.properties) {\n          converted.properties[key] = this.convertParametersSchema(prop);\n        }\n        if (prop.type === 'array' && prop.items) {\n          converted.properties[key].items = this.convertParametersSchema(prop.items);\n        }\n      }\n    }\n\n    // Add required fields\n    if (schema.required) {\n      converted.required = schema.required;\n    }\n\n    return converted;\n  }\n\n  /**\n   * Convert Google response  our LLMResponse format\n   */\n  convertResponse(response: any): LLMResponse {\n    const candidate = response.candidates?.[0];\n    const geminiContent = candidate?.content;\n\n    // Convert Google parts to our content\n    const content = this.convertGeminiPartsToContent(geminiContent?.parts || []);\n\n    const output: OutputItem[] = [\n      {\n        type: 'message',\n        id: response.id || `google_msg_${randomUUID()}`,\n        role: MessageRole.ASSISTANT,\n        content,\n      },\n    ];\n\n    const outputText = this.extractOutputText(geminiContent?.parts || []);\n\n    // Debug output text extraction\n    if (process.env.DEBUG_GOOGLE) {\n      console.error('[DEBUG] Extracted output_text:', outputText);\n      console.error('[DEBUG] Content array:', JSON.stringify(content, null, 2));\n      console.error('[DEBUG] Raw parts:', JSON.stringify(geminiContent?.parts, null, 2));\n    }\n\n    return {\n      id: `resp_google_${randomUUID()}`,\n      object: 'response',\n      created_at: Math.floor(Date.now() / 1000),\n      status: this.mapFinishReason(candidate?.finishReason),\n      model: response.modelVersion || 'gemini',\n      output,\n      output_text: outputText,\n      usage: {\n        input_tokens: response.usageMetadata?.promptTokenCount || 0,\n        output_tokens: response.usageMetadata?.candidatesTokenCount || 0,\n        total_tokens: response.usageMetadata?.totalTokenCount || 0,\n      },\n    };\n  }\n\n  /**\n   * Convert Google parts  our Content[]\n   */\n  private convertGeminiPartsToContent(parts: Part[]): Content[] {\n    const content: Content[] = [];\n\n    for (const part of parts) {\n      if ('text' in part && part.text) {\n        content.push({\n          type: ContentType.OUTPUT_TEXT,\n          text: part.text,\n          annotations: [],\n        });\n      } else if ('functionCall' in part && part.functionCall) {\n        const toolId = `google_${randomUUID()}`;\n        const functionName = part.functionCall.name || '';\n\n        // Store thought signature if present (required for Gemini 3+)\n        if ('thoughtSignature' in part && part.thoughtSignature) {\n          const sig = part.thoughtSignature as string;\n          this.thoughtSignatures.set(toolId, sig);\n\n          if (process.env.DEBUG_GOOGLE) {\n            console.error(`[DEBUG] Captured thought signature for tool ID: ${toolId}`);\n            console.error(`[DEBUG] Signature length:`, sig.length);\n          }\n        } else if (process.env.DEBUG_GOOGLE) {\n          console.error(`[DEBUG] NO thought signature in part for ${functionName}`);\n          console.error(`[DEBUG] Part keys:`, Object.keys(part));\n        }\n\n        content.push({\n          type: ContentType.TOOL_USE,\n          id: toolId,\n          name: functionName,\n          arguments: JSON.stringify(part.functionCall.args || {}),\n        });\n      }\n    }\n\n    return content;\n  }\n\n  /**\n   * Extract output text from Google parts\n   */\n  private extractOutputText(parts: Part[]): string {\n    return parts\n      .filter((p): p is { text: string } => 'text' in p && typeof p.text === 'string')\n      .map((p) => p.text)\n      .join('\\n');\n  }\n\n  /**\n   * Map Google finish reason  our status\n   */\n  private mapFinishReason(finishReason: string | undefined): 'completed' | 'incomplete' | 'failed' {\n    switch (finishReason) {\n      case 'STOP':\n        return 'completed';\n      case 'MAX_TOKENS':\n        return 'incomplete';\n      case 'SAFETY':\n      case 'RECITATION':\n        return 'failed';\n      case 'OTHER':\n      default:\n        return 'incomplete';\n    }\n  }\n\n  /**\n   * Extract tool name from tool_use_id using tracked mapping\n   */\n  private extractToolName(toolUseId: string): string {\n    const name = this.toolCallMapping.get(toolUseId);\n    if (name) {\n      return name;\n    }\n    // Fallback - log warning and return placeholder\n    console.warn(`[GoogleConverter] Tool name not found for ID: ${toolUseId}`);\n    return 'unknown_tool';\n  }\n\n  /**\n   * Clear all internal mappings\n   * Should be called after each request/response cycle to prevent memory leaks\n   */\n  clearMappings(): void {\n    this.toolCallMapping.clear();\n    this.thoughtSignatures.clear();\n  }\n\n  /**\n   * Reset converter state for a new request\n   * Alias for clearMappings()\n   */\n  reset(): void {\n    this.clearMappings();\n  }\n}\n","/**\n * Google Gemini stream converter - converts Google streaming responses to our unified StreamEvent format\n */\n\nimport { randomUUID } from 'crypto';\nimport { GenerateContentResponse } from '@google/genai';\nimport { StreamEvent, StreamEventType } from '../../../domain/entities/StreamEvent.js';\n\n/**\n * Converts Google Gemini streaming responses to our unified StreamEvent format\n */\nexport class GoogleStreamConverter {\n  private responseId: string = '';\n  private model: string = '';\n  private sequenceNumber: number = 0;\n  private isFirst: boolean = true;\n  private toolCallBuffers: Map<string, { name: string; args: string }> = new Map();\n\n  /**\n   * Convert Google stream to our StreamEvent format\n   */\n  async *convertStream(\n    googleStream: AsyncIterable<GenerateContentResponse>,\n    model: string\n  ): AsyncIterableIterator<StreamEvent> {\n    this.model = model;\n    this.sequenceNumber = 0;\n    this.isFirst = true;\n    this.toolCallBuffers.clear();\n\n    let lastUsage: { input_tokens: number; output_tokens: number; total_tokens: number } = {\n      input_tokens: 0,\n      output_tokens: 0,\n      total_tokens: 0,\n    };\n\n    for await (const chunk of googleStream) {\n      if (this.isFirst) {\n        this.responseId = this.generateResponseId();\n        yield {\n          type: StreamEventType.RESPONSE_CREATED,\n          response_id: this.responseId,\n          model: this.model,\n          created_at: Date.now(),\n        };\n        this.isFirst = false;\n      }\n\n      // Extract usage from chunk (Google includes it in every chunk)\n      const usage = this.extractUsage(chunk);\n      if (usage) {\n        lastUsage = usage;\n      }\n\n      const events = this.convertChunk(chunk);\n      for (const event of events) {\n        yield event;\n      }\n    }\n\n    // Emit completion for any pending tool calls\n    if (this.toolCallBuffers.size > 0) {\n      for (const [toolCallId, buffer] of this.toolCallBuffers) {\n        yield {\n          type: StreamEventType.TOOL_CALL_ARGUMENTS_DONE,\n          response_id: this.responseId,\n          tool_call_id: toolCallId,\n          tool_name: buffer.name,\n          arguments: buffer.args,\n        };\n      }\n    }\n\n    // Final completion event with actual usage\n    yield {\n      type: StreamEventType.RESPONSE_COMPLETE,\n      response_id: this.responseId,\n      status: 'completed',\n      usage: lastUsage,\n      iterations: 1,\n    };\n  }\n\n  /**\n   * Extract usage from Google chunk\n   */\n  private extractUsage(chunk: GenerateContentResponse): { input_tokens: number; output_tokens: number; total_tokens: number } | null {\n    const usage = chunk.usageMetadata;\n    if (!usage) return null;\n\n    return {\n      input_tokens: usage.promptTokenCount || 0,\n      output_tokens: usage.candidatesTokenCount || 0,\n      total_tokens: usage.totalTokenCount || 0,\n    };\n  }\n\n  /**\n   * Convert single Google chunk to our event(s)\n   */\n  private convertChunk(chunk: GenerateContentResponse): StreamEvent[] {\n    const events: StreamEvent[] = [];\n\n    const candidate = chunk.candidates?.[0];\n    if (!candidate?.content?.parts) return events;\n\n    for (const part of candidate.content.parts) {\n      if (part.text) {\n        // Text delta\n        events.push({\n          type: StreamEventType.OUTPUT_TEXT_DELTA,\n          response_id: this.responseId,\n          item_id: `msg_${this.responseId}`,\n          output_index: 0,\n          content_index: 0,\n          delta: part.text,\n          sequence_number: this.sequenceNumber++,\n        });\n      } else if (part.functionCall) {\n        // Function call (tool use)\n        const functionCall = part.functionCall;\n        const toolName = functionCall.name || 'unknown';\n        const toolCallId = `call_${this.responseId}_${toolName}`;\n\n        // Check if this is a new tool call\n        if (!this.toolCallBuffers.has(toolCallId)) {\n          this.toolCallBuffers.set(toolCallId, {\n            name: toolName,\n            args: '',\n          });\n\n          events.push({\n            type: StreamEventType.TOOL_CALL_START,\n            response_id: this.responseId,\n            item_id: `msg_${this.responseId}`,\n            tool_call_id: toolCallId,\n            tool_name: toolName,\n          });\n        }\n\n        // Convert args object to JSON string\n        if (functionCall.args) {\n          const argsJson = JSON.stringify(functionCall.args);\n          const buffer = this.toolCallBuffers.get(toolCallId)!;\n\n          // Check if this is new content (Google sends complete args each time)\n          if (argsJson !== buffer.args) {\n            const delta = argsJson.slice(buffer.args.length);\n            buffer.args = argsJson;\n\n            if (delta) {\n              events.push({\n                type: StreamEventType.TOOL_CALL_ARGUMENTS_DELTA,\n                response_id: this.responseId,\n                item_id: `msg_${this.responseId}`,\n                tool_call_id: toolCallId,\n                tool_name: toolName,\n                delta,\n                sequence_number: this.sequenceNumber++,\n              });\n            }\n          }\n        }\n      }\n    }\n\n    return events;\n  }\n\n  /**\n   * Generate unique response ID using cryptographically secure UUID\n   */\n  private generateResponseId(): string {\n    return `resp_google_${randomUUID()}`;\n  }\n\n  /**\n   * Clear all internal state\n   * Should be called after each stream completes to prevent memory leaks\n   */\n  clear(): void {\n    this.responseId = '';\n    this.model = '';\n    this.sequenceNumber = 0;\n    this.isFirst = true;\n    this.toolCallBuffers.clear();\n  }\n\n  /**\n   * Reset converter state for a new stream\n   * Alias for clear()\n   */\n  reset(): void {\n    this.clear();\n  }\n}\n","/**\n * Google Gemini text provider (using new unified SDK)\n */\n\nimport { GoogleGenAI } from '@google/genai';\nimport { BaseTextProvider } from '../base/BaseTextProvider.js';\nimport { TextGenerateOptions, ModelCapabilities } from '../../../domain/interfaces/ITextProvider.js';\nimport { LLMResponse } from '../../../domain/entities/Response.js';\nimport { ProviderCapabilities } from '../../../domain/interfaces/IProvider.js';\nimport { GoogleConfig } from '../../../domain/types/ProviderConfig.js';\nimport {\n  ProviderAuthError,\n  ProviderRateLimitError,\n  ProviderContextLengthError,\n} from '../../../domain/errors/AIErrors.js';\nimport { GoogleConverter } from './GoogleConverter.js';\nimport { GoogleStreamConverter } from './GoogleStreamConverter.js';\nimport { StreamEvent } from '../../../domain/entities/StreamEvent.js';\n\nexport class GoogleTextProvider extends BaseTextProvider {\n  readonly name = 'google';\n  readonly capabilities: ProviderCapabilities = {\n    text: true,\n    images: true, // Gemini supports vision\n    videos: false,\n    audio: false,\n  };\n\n  private client: GoogleGenAI;\n  private converter: GoogleConverter;\n  private streamConverter: GoogleStreamConverter;\n\n  constructor(config: GoogleConfig) {\n    super(config);\n\n    // New SDK uses object config\n    this.client = new GoogleGenAI({\n      apiKey: this.getApiKey(),\n    });\n    this.converter = new GoogleConverter();\n    this.streamConverter = new GoogleStreamConverter();\n  }\n\n  /**\n   * Generate response using Google Gemini API\n   */\n  async generate(options: TextGenerateOptions): Promise<LLMResponse> {\n    return this.executeWithCircuitBreaker(async () => {\n      try {\n        // Convert our format  Google format\n        const googleRequest = await this.converter.convertRequest(options);\n\n        // Debug logging\n        if (process.env.DEBUG_GOOGLE) {\n          console.error('[DEBUG] Google Request:', JSON.stringify({\n            model: options.model,\n            tools: googleRequest.tools,\n            toolConfig: googleRequest.toolConfig,\n            contents: googleRequest.contents?.slice(0, 1), // First message only\n          }, null, 2));\n        }\n\n        // Call Google API using new SDK structure\n        // Note: contents goes at top level, generation config properties go directly in config\n        const result = await this.client.models.generateContent({\n          model: options.model,\n          contents: googleRequest.contents,\n          config: {\n            systemInstruction: googleRequest.systemInstruction,\n            tools: googleRequest.tools,\n            toolConfig: googleRequest.toolConfig,\n            ...googleRequest.generationConfig,\n          },\n        });\n\n        // Debug logging for response\n        if (process.env.DEBUG_GOOGLE) {\n          console.error('[DEBUG] Google Response:', JSON.stringify({\n            candidates: result.candidates?.map((c: any) => ({\n              finishReason: c.finishReason,\n              content: c.content,\n            })),\n            usageMetadata: result.usageMetadata,\n          }, null, 2));\n        }\n\n        // Convert Google response  our format\n        const response = this.converter.convertResponse(result);\n\n        return response;\n      } catch (error: any) {\n        this.handleError(error);\n        throw error; // TypeScript needs this\n      } finally {\n        // ALWAYS clear converter mappings to prevent memory leaks\n        // Use finally block to ensure cleanup even on exception\n        this.converter.clearMappings();\n      }\n    }, options.model);\n  }\n\n  /**\n   * Stream response using Google Gemini API\n   */\n  async *streamGenerate(options: TextGenerateOptions): AsyncIterableIterator<StreamEvent> {\n    try {\n      // Convert our format  Google format\n      const googleRequest = await this.converter.convertRequest(options);\n\n      // Create stream using new SDK\n      // Note: contents goes at top level, generation config properties go directly in config\n      const stream = await this.client.models.generateContentStream({\n        model: options.model,\n        contents: googleRequest.contents,\n        config: {\n          systemInstruction: googleRequest.systemInstruction,\n          tools: googleRequest.tools,\n          toolConfig: googleRequest.toolConfig,\n          ...googleRequest.generationConfig,\n        },\n      });\n\n      // Reset stream converter for reuse\n      this.streamConverter.reset();\n\n      // Convert Google stream  our StreamEvent format\n      yield* this.streamConverter.convertStream(stream, options.model);\n    } catch (error: any) {\n      this.handleError(error);\n      throw error;\n    } finally {\n      // ALWAYS clear converters to prevent memory leaks\n      // Use finally block to ensure cleanup even on exception\n      this.converter.clearMappings();\n      this.streamConverter.clear();\n    }\n  }\n\n  /**\n   * Get model capabilities\n   */\n  getModelCapabilities(model: string): ModelCapabilities {\n    // All modern Gemini models (3.x, 2.5, 2.0, 1.5) have similar capabilities\n    if (\n      model.includes('gemini-3') ||\n      model.includes('gemini-2.5') ||\n      model.includes('gemini-2.0') ||\n      model.includes('gemini-1.5') ||\n      model.includes('gemini-pro') ||\n      model.includes('gemini-flash')\n    ) {\n      return {\n        supportsTools: true,\n        supportsVision: true,\n        supportsJSON: true,\n        supportsJSONSchema: false,\n        maxTokens: 1048576, // 1M tokens\n        maxOutputTokens: 8192,\n      };\n    }\n\n    // Default for unknown models\n    return {\n      supportsTools: true,\n      supportsVision: true,\n      supportsJSON: true,\n      supportsJSONSchema: false,\n      maxTokens: 1048576,\n      maxOutputTokens: 8192,\n    };\n  }\n\n  /**\n   * Handle Google-specific errors\n   */\n  private handleError(error: any): never {\n    const errorMessage = error.message || '';\n\n    if (error.status === 401 || errorMessage.includes('API key not valid')) {\n      throw new ProviderAuthError('google', 'Invalid API key');\n    }\n\n    if (error.status === 429 || errorMessage.includes('Resource exhausted')) {\n      throw new ProviderRateLimitError('google');\n    }\n\n    if (errorMessage.includes('context length') || errorMessage.includes('too long')) {\n      throw new ProviderContextLengthError('google', 1048576);\n    }\n\n    // Re-throw other errors\n    throw error;\n  }\n}\n","/**\n * Google Vertex AI text provider (enterprise features)\n * Uses the same unified @google/genai SDK as GoogleTextProvider\n */\n\nimport { GoogleGenAI } from '@google/genai';\nimport { BaseTextProvider } from '../base/BaseTextProvider.js';\nimport { TextGenerateOptions, ModelCapabilities } from '../../../domain/interfaces/ITextProvider.js';\nimport { LLMResponse } from '../../../domain/entities/Response.js';\nimport { ProviderCapabilities } from '../../../domain/interfaces/IProvider.js';\nimport { VertexAIConfig } from '../../../domain/types/ProviderConfig.js';\nimport {\n  ProviderAuthError,\n  ProviderRateLimitError,\n  ProviderContextLengthError,\n  InvalidConfigError,\n} from '../../../domain/errors/AIErrors.js';\nimport { GoogleConverter } from '../google/GoogleConverter.js';\nimport { GoogleStreamConverter } from '../google/GoogleStreamConverter.js';\nimport { StreamEvent } from '../../../domain/entities/StreamEvent.js';\n\nexport class VertexAITextProvider extends BaseTextProvider {\n  readonly name = 'vertex-ai';\n  readonly capabilities: ProviderCapabilities = {\n    text: true,\n    images: true,\n    videos: true, // Vertex AI supports video input\n    audio: true, // Vertex AI supports audio input\n  };\n\n  private client: GoogleGenAI;\n  private converter: GoogleConverter;\n  protected override config: VertexAIConfig;\n\n  constructor(config: VertexAIConfig) {\n    super(config);\n    this.config = config;\n\n    // Validate required config\n    if (!config.projectId) {\n      throw new InvalidConfigError('Vertex AI requires projectId');\n    }\n    if (!config.location) {\n      throw new InvalidConfigError('Vertex AI requires location (e.g., \"us-central1\")');\n    }\n\n    // Configure environment for Vertex AI\n    process.env.GOOGLE_GENAI_USE_VERTEXAI = 'True';\n    process.env.GOOGLE_CLOUD_PROJECT = config.projectId;\n    process.env.GOOGLE_CLOUD_LOCATION = config.location;\n\n    // If credentials provided, set them\n    if (config.credentials) {\n      // Note: The SDK will use credentials from the environment or ADC\n      // Service account JSON can be passed via GOOGLE_APPLICATION_CREDENTIALS env var\n    }\n\n    // Initialize client for Vertex AI\n    this.client = new GoogleGenAI({\n      // No API key for Vertex AI - uses Application Default Credentials\n    });\n\n    // Reuse Google converter - same API format!\n    this.converter = new GoogleConverter();\n  }\n\n  /**\n   * Generate response using Vertex AI\n   */\n  async generate(options: TextGenerateOptions): Promise<LLMResponse> {\n    try {\n      // Convert our format  Google format (same as regular Gemini API)\n      const googleRequest = await this.converter.convertRequest(options);\n\n      // Call Vertex AI using new SDK structure\n      // Note: contents goes at top level, generation config properties go directly in config\n      const result = await this.client.models.generateContent({\n        model: options.model,\n        contents: googleRequest.contents,\n        config: {\n          systemInstruction: googleRequest.systemInstruction,\n          tools: googleRequest.tools,\n          toolConfig: googleRequest.toolConfig,\n          ...googleRequest.generationConfig,\n        },\n      });\n\n      // Convert response  our format (same as regular Gemini API)\n      return this.converter.convertResponse(result);\n    } catch (error: any) {\n      this.handleError(error);\n      throw error; // TypeScript needs this\n    }\n  }\n\n  /**\n   * Stream response using Vertex AI\n   */\n  async *streamGenerate(options: TextGenerateOptions): AsyncIterableIterator<StreamEvent> {\n    try {\n      // Convert our format  Google format\n      const googleRequest = await this.converter.convertRequest(options);\n\n      // Create stream using new SDK\n      // Note: contents goes at top level, generation config properties go directly in config\n      const stream = await this.client.models.generateContentStream({\n        model: options.model,\n        contents: googleRequest.contents,\n        config: {\n          systemInstruction: googleRequest.systemInstruction,\n          tools: googleRequest.tools,\n          toolConfig: googleRequest.toolConfig,\n          ...googleRequest.generationConfig,\n        },\n      });\n\n      // Convert Google stream  our StreamEvent format\n      const streamConverter = new GoogleStreamConverter();\n      yield* streamConverter.convertStream(stream, options.model);\n    } catch (error: any) {\n      this.handleError(error);\n      throw error;\n    }\n  }\n\n  /**\n   * Get model capabilities\n   */\n  getModelCapabilities(model: string): ModelCapabilities {\n    // Same models as regular Gemini, but enterprise features\n    if (\n      model.includes('gemini-3') ||\n      model.includes('gemini-2.5') ||\n      model.includes('gemini-2.0') ||\n      model.includes('gemini-1.5') ||\n      model.includes('gemini-pro') ||\n      model.includes('gemini-flash')\n    ) {\n      return {\n        supportsTools: true,\n        supportsVision: true,\n        supportsJSON: true,\n        supportsJSONSchema: false,\n        maxTokens: 1048576, // 1M tokens\n        maxOutputTokens: 8192,\n      };\n    }\n\n    // Default\n    return {\n      supportsTools: true,\n      supportsVision: true,\n      supportsJSON: true,\n      supportsJSONSchema: false,\n      maxTokens: 1048576,\n      maxOutputTokens: 8192,\n    };\n  }\n\n  /**\n   * Handle Vertex AI-specific errors\n   */\n  private handleError(error: any): never {\n    const errorMessage = error.message || '';\n\n    // Authentication errors\n    if (\n      error.status === 401 ||\n      error.status === 403 ||\n      errorMessage.includes('not authenticated') ||\n      errorMessage.includes('permission denied')\n    ) {\n      throw new ProviderAuthError(\n        'vertex-ai',\n        'Authentication failed. Make sure you have set up Application Default Credentials or provided service account credentials.'\n      );\n    }\n\n    if (error.status === 429 || errorMessage.includes('Resource exhausted')) {\n      throw new ProviderRateLimitError('vertex-ai');\n    }\n\n    if (errorMessage.includes('context length') || errorMessage.includes('too long')) {\n      throw new ProviderContextLengthError('vertex-ai', 1048576);\n    }\n\n    // Re-throw other errors\n    throw error;\n  }\n}\n","/**\n * Generic OpenAI-compatible provider\n * Works with any service that implements the OpenAI Chat Completions API\n * Examples: Together AI, Groq, Perplexity, Grok (xAI), local models, etc.\n */\n\nimport { OpenAITextProvider } from '../openai/OpenAITextProvider.js';\nimport { ModelCapabilities } from '../../../domain/interfaces/ITextProvider.js';\nimport { ProviderCapabilities } from '../../../domain/interfaces/IProvider.js';\n\nexport interface GenericOpenAIConfig {\n  apiKey: string;\n  baseURL: string; // Required - the API endpoint\n  organization?: string;\n  timeout?: number;\n  maxRetries?: number;\n  defaultModel?: string;\n}\n\nexport class GenericOpenAIProvider extends OpenAITextProvider {\n  readonly name: string;\n  readonly capabilities: ProviderCapabilities;\n\n  constructor(\n    name: string,\n    config: GenericOpenAIConfig,\n    capabilities?: Partial<ProviderCapabilities>\n  ) {\n    super(config as any);\n    this.name = name;\n\n    // Set capabilities\n    if (capabilities) {\n      this.capabilities = {\n        text: capabilities.text ?? true,\n        images: capabilities.images ?? false,\n        videos: capabilities.videos ?? false,\n        audio: capabilities.audio ?? false,\n      };\n    } else {\n      // Default generic capabilities\n      this.capabilities = {\n        text: true,\n        images: false, // Conservative default\n        videos: false,\n        audio: false,\n      };\n    }\n  }\n\n  /**\n   * Override model capabilities for generic providers\n   * Can be customized per provider\n   */\n  getModelCapabilities(model: string): ModelCapabilities {\n    // Check for vision in model name (heuristic)\n    const hasVision =\n      model.toLowerCase().includes('vision') ||\n      model.toLowerCase().includes('llava') ||\n      model.toLowerCase().includes('llama-3.2-90b'); // Llama 3.2 90B has vision\n\n    // Check for large context models\n    const isLargeContext =\n      model.includes('128k') ||\n      model.includes('200k') ||\n      model.toLowerCase().includes('longtext');\n\n    return {\n      supportsTools: true, // Most OpenAI-compatible APIs support tools\n      supportsVision: hasVision,\n      supportsJSON: true, // Most support JSON mode\n      supportsJSONSchema: false, // Conservative - not all support schema\n      maxTokens: isLargeContext ? 128000 : 32000, // Conservative default\n      maxOutputTokens: 4096, // Common default\n    };\n  }\n}\n","/**\n * Provider Factory - creates the right provider from a Connector\n *\n * This is the bridge between Connectors and provider implementations.\n * It extracts credentials from the connector and instantiates the appropriate SDK.\n */\n\nimport { Connector } from './Connector.js';\nimport { Vendor } from './Vendor.js';\nimport { ITextProvider } from '../domain/interfaces/ITextProvider.js';\nimport { ProviderConfig } from '../domain/types/ProviderConfig.js';\n\n// Import providers\nimport { OpenAITextProvider } from '../infrastructure/providers/openai/OpenAITextProvider.js';\nimport { AnthropicTextProvider } from '../infrastructure/providers/anthropic/AnthropicTextProvider.js';\nimport { GoogleTextProvider } from '../infrastructure/providers/google/GoogleTextProvider.js';\nimport { VertexAITextProvider } from '../infrastructure/providers/vertex/VertexAITextProvider.js';\nimport { GenericOpenAIProvider } from '../infrastructure/providers/generic/GenericOpenAIProvider.js';\n\n/**\n * Create a text provider from a connector\n */\nexport function createProvider(connector: Connector): ITextProvider {\n  const vendor = connector.vendor;\n\n  if (!vendor) {\n    throw new Error(\n      `Connector '${connector.name}' has no vendor specified. ` +\n        `Set vendor to create an AI provider.`\n    );\n  }\n\n  // Extract config from connector\n  const config = extractProviderConfig(connector);\n\n  switch (vendor) {\n    case Vendor.OpenAI:\n      return new OpenAITextProvider({\n        ...config,\n        organization: connector.getOptions().organization as string | undefined,\n        project: connector.getOptions().project as string | undefined,\n      });\n\n    case Vendor.Anthropic:\n      return new AnthropicTextProvider({\n        ...config,\n        anthropicVersion: connector.getOptions().anthropicVersion as string | undefined,\n      });\n\n    case Vendor.Google:\n      return new GoogleTextProvider(config);\n\n    case Vendor.GoogleVertex:\n      return new VertexAITextProvider({\n        ...config,\n        projectId: connector.getOptions().projectId as string || '',\n        location: connector.getOptions().location as string || 'us-central1',\n      });\n\n    // OpenAI-compatible providers (use connector.name for unique identification)\n    case Vendor.Groq:\n      return new GenericOpenAIProvider(connector.name, {\n        ...config,\n        baseURL: config.baseURL || 'https://api.groq.com/openai/v1',\n      });\n\n    case Vendor.Together:\n      return new GenericOpenAIProvider(connector.name, {\n        ...config,\n        baseURL: config.baseURL || 'https://api.together.xyz/v1',\n      });\n\n    case Vendor.Perplexity:\n      return new GenericOpenAIProvider(connector.name, {\n        ...config,\n        baseURL: config.baseURL || 'https://api.perplexity.ai',\n      });\n\n    case Vendor.Grok:\n      return new GenericOpenAIProvider(connector.name, {\n        ...config,\n        baseURL: config.baseURL || 'https://api.x.ai/v1',\n      });\n\n    case Vendor.DeepSeek:\n      return new GenericOpenAIProvider(connector.name, {\n        ...config,\n        baseURL: config.baseURL || 'https://api.deepseek.com/v1',\n      });\n\n    case Vendor.Mistral:\n      return new GenericOpenAIProvider(connector.name, {\n        ...config,\n        baseURL: config.baseURL || 'https://api.mistral.ai/v1',\n      });\n\n    case Vendor.Ollama:\n      return new GenericOpenAIProvider(connector.name, {\n        ...config,\n        baseURL: config.baseURL || 'http://localhost:11434/v1',\n      });\n\n    case Vendor.Custom:\n      if (!config.baseURL) {\n        throw new Error(\n          `Connector '${connector.name}' with Custom vendor requires baseURL`\n        );\n      }\n      return new GenericOpenAIProvider(connector.name, {\n        ...config,\n        baseURL: config.baseURL,\n      });\n\n    default:\n      throw new Error(`Unknown vendor: ${vendor}`);\n  }\n}\n\n/**\n * Extract ProviderConfig from a Connector\n */\nfunction extractProviderConfig(connector: Connector): ProviderConfig {\n  const auth = connector.config.auth;\n\n  // Get API key based on auth type\n  let apiKey: string;\n\n  if (auth.type === 'api_key') {\n    apiKey = auth.apiKey;\n  } else if (auth.type === 'oauth') {\n    // For OAuth, we'd need to get the token asynchronously\n    // For now, throw an error - OAuth providers need special handling\n    throw new Error(\n      `Connector '${connector.name}' uses OAuth. ` +\n        `Call connector.getToken() to get the access token first.`\n    );\n  } else if (auth.type === 'jwt') {\n    throw new Error(\n      `Connector '${connector.name}' uses JWT auth. ` +\n        `JWT auth for AI providers is not yet supported.`\n    );\n  } else {\n    throw new Error(`Unknown auth type for connector '${connector.name}'`);\n  }\n\n  return {\n    apiKey,\n    baseURL: connector.config.baseURL,\n    timeout: connector.getOptions().timeout as number | undefined,\n    maxRetries: connector.getOptions().maxRetries as number | undefined,\n  };\n}\n\n/**\n * Create a text provider from a Connector with async token support\n * Use this for OAuth connectors\n */\nexport async function createProviderAsync(\n  connector: Connector,\n  userId?: string\n): Promise<ITextProvider> {\n  const auth = connector.config.auth;\n\n  // For API key auth, use sync version\n  if (auth.type === 'api_key') {\n    return createProvider(connector);\n  }\n\n  // For OAuth, get the token first\n  const token = await connector.getToken(userId);\n\n  // Create a temporary config with the token as API key\n  // (Most providers accept Bearer tokens the same way as API keys)\n  const tempConnector = {\n    ...connector,\n    config: {\n      ...connector.config,\n      auth: {\n        type: 'api_key' as const,\n        apiKey: token,\n      },\n    },\n  } as Connector;\n\n  return createProvider(tempConnector);\n}\n","/**\n * ToolManager - Dynamic tool management for agents\n *\n * Provides advanced tool management capabilities:\n * - Enable/disable tools at runtime without removing them\n * - Namespace grouping for organizing related tools\n * - Priority-based selection\n * - Context-aware tool selection\n * - Usage statistics\n *\n * Backward compatible: Works with existing ToolFunction interface\n */\n\nimport { EventEmitter } from 'events';\nimport type { ToolFunction } from '../domain/entities/Tool.js';\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport interface ToolOptions {\n  /** Whether the tool is enabled. Default: true */\n  enabled?: boolean;\n  /** Namespace for grouping related tools. Default: 'default' */\n  namespace?: string;\n  /** Priority for selection ordering. Higher = preferred. Default: 0 */\n  priority?: number;\n  /** Conditions for auto-enable/disable */\n  conditions?: ToolCondition[];\n}\n\nexport interface ToolCondition {\n  type: 'mode' | 'context' | 'custom';\n  predicate: (context: ToolSelectionContext) => boolean;\n}\n\nexport interface ToolSelectionContext {\n  /** Current user input or task description */\n  input?: string;\n  /** Current agent mode (for UniversalAgent) */\n  mode?: string;\n  /** Current task name (for TaskAgent) */\n  currentTask?: string;\n  /** Recently used tools (to avoid repetition) */\n  recentTools?: string[];\n  /** Token budget for tool definitions */\n  tokenBudget?: number;\n  /** Custom context data */\n  custom?: Record<string, unknown>;\n}\n\nexport interface ToolRegistration {\n  tool: ToolFunction;\n  enabled: boolean;\n  namespace: string;\n  priority: number;\n  conditions: ToolCondition[];\n  metadata: ToolMetadata;\n}\n\nexport interface ToolMetadata {\n  registeredAt: Date;\n  usageCount: number;\n  lastUsed?: Date;\n  totalExecutionMs: number;\n  avgExecutionMs: number;\n  successCount: number;\n  failureCount: number;\n}\n\nexport interface ToolManagerStats {\n  totalTools: number;\n  enabledTools: number;\n  disabledTools: number;\n  namespaces: string[];\n  toolsByNamespace: Record<string, number>;\n  mostUsed: Array<{ name: string; count: number }>;\n  totalExecutions: number;\n}\n\nexport interface SerializedToolState {\n  enabled: Record<string, boolean>;\n  namespaces: Record<string, string>;\n  priorities: Record<string, number>;\n}\n\nexport type ToolManagerEvent =\n  | 'tool:registered'\n  | 'tool:unregistered'\n  | 'tool:enabled'\n  | 'tool:disabled'\n  | 'tool:executed'\n  | 'namespace:enabled'\n  | 'namespace:disabled';\n\n// ============================================================================\n// ToolManager Class\n// ============================================================================\n\nexport class ToolManager extends EventEmitter {\n  private registry: Map<string, ToolRegistration> = new Map();\n  private namespaceIndex: Map<string, Set<string>> = new Map();\n\n  constructor() {\n    super();\n    // Initialize default namespace\n    this.namespaceIndex.set('default', new Set());\n  }\n\n  // ==========================================================================\n  // Registration\n  // ==========================================================================\n\n  /**\n   * Register a tool with optional configuration\n   */\n  register(tool: ToolFunction, options: ToolOptions = {}): void {\n    const name = this.getToolName(tool);\n\n    if (this.registry.has(name)) {\n      // Update existing registration\n      const existing = this.registry.get(name)!;\n      existing.tool = tool;\n      if (options.enabled !== undefined) existing.enabled = options.enabled;\n      if (options.namespace !== undefined) {\n        this.moveToNamespace(name, existing.namespace, options.namespace);\n        existing.namespace = options.namespace;\n      }\n      if (options.priority !== undefined) existing.priority = options.priority;\n      if (options.conditions !== undefined) existing.conditions = options.conditions;\n      return;\n    }\n\n    const namespace = options.namespace ?? 'default';\n    const registration: ToolRegistration = {\n      tool,\n      enabled: options.enabled ?? true,\n      namespace,\n      priority: options.priority ?? 0,\n      conditions: options.conditions ?? [],\n      metadata: {\n        registeredAt: new Date(),\n        usageCount: 0,\n        totalExecutionMs: 0,\n        avgExecutionMs: 0,\n        successCount: 0,\n        failureCount: 0,\n      },\n    };\n\n    this.registry.set(name, registration);\n    this.addToNamespace(name, namespace);\n\n    this.emit('tool:registered', { name, namespace, enabled: registration.enabled });\n  }\n\n  /**\n   * Register multiple tools at once\n   */\n  registerMany(tools: ToolFunction[], options: Omit<ToolOptions, 'conditions'> = {}): void {\n    for (const tool of tools) {\n      this.register(tool, options);\n    }\n  }\n\n  /**\n   * Unregister a tool by name\n   */\n  unregister(name: string): boolean {\n    const registration = this.registry.get(name);\n    if (!registration) return false;\n\n    this.removeFromNamespace(name, registration.namespace);\n    this.registry.delete(name);\n\n    this.emit('tool:unregistered', { name });\n    return true;\n  }\n\n  /**\n   * Clear all tools\n   */\n  clear(): void {\n    this.registry.clear();\n    this.namespaceIndex.clear();\n    this.namespaceIndex.set('default', new Set());\n  }\n\n  // ==========================================================================\n  // Enable/Disable\n  // ==========================================================================\n\n  /**\n   * Enable a tool by name\n   */\n  enable(name: string): boolean {\n    const registration = this.registry.get(name);\n    if (!registration) return false;\n\n    if (!registration.enabled) {\n      registration.enabled = true;\n      this.emit('tool:enabled', { name });\n    }\n    return true;\n  }\n\n  /**\n   * Disable a tool by name (keeps it registered but inactive)\n   */\n  disable(name: string): boolean {\n    const registration = this.registry.get(name);\n    if (!registration) return false;\n\n    if (registration.enabled) {\n      registration.enabled = false;\n      this.emit('tool:disabled', { name });\n    }\n    return true;\n  }\n\n  /**\n   * Toggle a tool's enabled state\n   */\n  toggle(name: string): boolean {\n    const registration = this.registry.get(name);\n    if (!registration) return false;\n\n    registration.enabled = !registration.enabled;\n    this.emit(registration.enabled ? 'tool:enabled' : 'tool:disabled', { name });\n    return registration.enabled;\n  }\n\n  /**\n   * Check if a tool is enabled\n   */\n  isEnabled(name: string): boolean {\n    const registration = this.registry.get(name);\n    return registration?.enabled ?? false;\n  }\n\n  /**\n   * Set enabled state for multiple tools\n   */\n  setEnabled(names: string[], enabled: boolean): void {\n    for (const name of names) {\n      if (enabled) {\n        this.enable(name);\n      } else {\n        this.disable(name);\n      }\n    }\n  }\n\n  // ==========================================================================\n  // Namespaces\n  // ==========================================================================\n\n  /**\n   * Set the namespace for a tool\n   */\n  setNamespace(toolName: string, namespace: string): boolean {\n    const registration = this.registry.get(toolName);\n    if (!registration) return false;\n\n    const oldNamespace = registration.namespace;\n    if (oldNamespace === namespace) return true;\n\n    this.moveToNamespace(toolName, oldNamespace, namespace);\n    registration.namespace = namespace;\n    return true;\n  }\n\n  /**\n   * Enable all tools in a namespace\n   */\n  enableNamespace(namespace: string): void {\n    const tools = this.namespaceIndex.get(namespace);\n    if (!tools) return;\n\n    for (const name of tools) {\n      this.enable(name);\n    }\n    this.emit('namespace:enabled', { namespace });\n  }\n\n  /**\n   * Disable all tools in a namespace\n   */\n  disableNamespace(namespace: string): void {\n    const tools = this.namespaceIndex.get(namespace);\n    if (!tools) return;\n\n    for (const name of tools) {\n      this.disable(name);\n    }\n    this.emit('namespace:disabled', { namespace });\n  }\n\n  /**\n   * Get all namespace names\n   */\n  getNamespaces(): string[] {\n    return Array.from(this.namespaceIndex.keys());\n  }\n\n  /**\n   * Create a namespace with tools\n   */\n  createNamespace(namespace: string, tools: ToolFunction[], options: Omit<ToolOptions, 'namespace'> = {}): void {\n    for (const tool of tools) {\n      this.register(tool, { ...options, namespace });\n    }\n  }\n\n  // ==========================================================================\n  // Priority\n  // ==========================================================================\n\n  /**\n   * Set priority for a tool\n   */\n  setPriority(name: string, priority: number): boolean {\n    const registration = this.registry.get(name);\n    if (!registration) return false;\n\n    registration.priority = priority;\n    return true;\n  }\n\n  /**\n   * Get priority for a tool\n   */\n  getPriority(name: string): number | undefined {\n    return this.registry.get(name)?.priority;\n  }\n\n  // ==========================================================================\n  // Query\n  // ==========================================================================\n\n  /**\n   * Get a tool by name\n   */\n  get(name: string): ToolFunction | undefined {\n    return this.registry.get(name)?.tool;\n  }\n\n  /**\n   * Check if a tool exists\n   */\n  has(name: string): boolean {\n    return this.registry.has(name);\n  }\n\n  /**\n   * Get all enabled tools (sorted by priority)\n   */\n  getEnabled(): ToolFunction[] {\n    return this.getSortedByPriority()\n      .filter((reg) => reg.enabled)\n      .map((reg) => reg.tool);\n  }\n\n  /**\n   * Get all tools (enabled and disabled)\n   */\n  getAll(): ToolFunction[] {\n    return Array.from(this.registry.values()).map((reg) => reg.tool);\n  }\n\n  /**\n   * Get tools by namespace\n   */\n  getByNamespace(namespace: string): ToolFunction[] {\n    const toolNames = this.namespaceIndex.get(namespace);\n    if (!toolNames) return [];\n\n    return Array.from(toolNames)\n      .map((name) => this.registry.get(name)!)\n      .filter((reg) => reg.enabled)\n      .sort((a, b) => b.priority - a.priority)\n      .map((reg) => reg.tool);\n  }\n\n  /**\n   * Get tool registration info\n   */\n  getRegistration(name: string): ToolRegistration | undefined {\n    return this.registry.get(name);\n  }\n\n  /**\n   * List all tool names\n   */\n  list(): string[] {\n    return Array.from(this.registry.keys());\n  }\n\n  /**\n   * List enabled tool names\n   */\n  listEnabled(): string[] {\n    return Array.from(this.registry.entries())\n      .filter(([_, reg]) => reg.enabled)\n      .map(([name]) => name);\n  }\n\n  /**\n   * Get count of registered tools\n   */\n  get size(): number {\n    return this.registry.size;\n  }\n\n  // ==========================================================================\n  // Selection\n  // ==========================================================================\n\n  /**\n   * Select tools based on context (uses conditions and smart filtering)\n   */\n  selectForContext(context: ToolSelectionContext): ToolFunction[] {\n    const sorted = this.getSortedByPriority();\n    const selected: ToolFunction[] = [];\n\n    for (const reg of sorted) {\n      // Skip disabled tools\n      if (!reg.enabled) continue;\n\n      // Check conditions\n      if (reg.conditions.length > 0) {\n        const allConditionsMet = reg.conditions.every((cond) => cond.predicate(context));\n        if (!allConditionsMet) continue;\n      }\n\n      // Skip recently used if avoiding repetition\n      if (context.recentTools?.includes(this.getToolName(reg.tool))) {\n        continue;\n      }\n\n      selected.push(reg.tool);\n    }\n\n    // Apply token budget if specified\n    if (context.tokenBudget !== undefined) {\n      return this.filterByTokenBudget(selected, context.tokenBudget);\n    }\n\n    return selected;\n  }\n\n  /**\n   * Select tools by matching capability description\n   */\n  selectByCapability(description: string): ToolFunction[] {\n    const lowerDesc = description.toLowerCase();\n    const keywords = lowerDesc.split(/\\s+/);\n\n    return this.getEnabled().filter((tool) => {\n      const toolDesc = (tool.definition.function.description ?? '').toLowerCase();\n      const toolName = tool.definition.function.name.toLowerCase();\n\n      // Match if any keyword appears in tool name or description\n      return keywords.some((kw) => toolDesc.includes(kw) || toolName.includes(kw));\n    });\n  }\n\n  /**\n   * Filter tools to fit within a token budget\n   */\n  selectWithinBudget(budget: number): ToolFunction[] {\n    return this.filterByTokenBudget(this.getEnabled(), budget);\n  }\n\n  // ==========================================================================\n  // Execution Tracking\n  // ==========================================================================\n\n  /**\n   * Record tool execution (called by agent/loop)\n   */\n  recordExecution(\n    name: string,\n    executionMs: number,\n    success: boolean\n  ): void {\n    const registration = this.registry.get(name);\n    if (!registration) return;\n\n    const meta = registration.metadata;\n    meta.usageCount++;\n    meta.lastUsed = new Date();\n    meta.totalExecutionMs += executionMs;\n    meta.avgExecutionMs = meta.totalExecutionMs / meta.usageCount;\n\n    if (success) {\n      meta.successCount++;\n    } else {\n      meta.failureCount++;\n    }\n\n    this.emit('tool:executed', {\n      name,\n      executionMs,\n      success,\n      totalUsage: meta.usageCount,\n    });\n  }\n\n  // ==========================================================================\n  // Statistics\n  // ==========================================================================\n\n  /**\n   * Get comprehensive statistics\n   */\n  getStats(): ToolManagerStats {\n    const registrations = Array.from(this.registry.values());\n    const enabledCount = registrations.filter((r) => r.enabled).length;\n\n    const toolsByNamespace: Record<string, number> = {};\n    for (const [ns, tools] of this.namespaceIndex) {\n      toolsByNamespace[ns] = tools.size;\n    }\n\n    const mostUsed = registrations\n      .filter((r) => r.metadata.usageCount > 0)\n      .sort((a, b) => b.metadata.usageCount - a.metadata.usageCount)\n      .slice(0, 10)\n      .map((r) => ({\n        name: this.getToolName(r.tool),\n        count: r.metadata.usageCount,\n      }));\n\n    const totalExecutions = registrations.reduce((sum, r) => sum + r.metadata.usageCount, 0);\n\n    return {\n      totalTools: this.registry.size,\n      enabledTools: enabledCount,\n      disabledTools: this.registry.size - enabledCount,\n      namespaces: this.getNamespaces(),\n      toolsByNamespace,\n      mostUsed,\n      totalExecutions,\n    };\n  }\n\n  // ==========================================================================\n  // Persistence\n  // ==========================================================================\n\n  /**\n   * Get serializable state (for session persistence)\n   */\n  getState(): SerializedToolState {\n    const enabled: Record<string, boolean> = {};\n    const namespaces: Record<string, string> = {};\n    const priorities: Record<string, number> = {};\n\n    for (const [name, reg] of this.registry) {\n      enabled[name] = reg.enabled;\n      namespaces[name] = reg.namespace;\n      priorities[name] = reg.priority;\n    }\n\n    return { enabled, namespaces, priorities };\n  }\n\n  /**\n   * Load state (restores enabled/disabled, namespaces, priorities)\n   * Note: Tools must be re-registered separately (they contain functions)\n   */\n  loadState(state: SerializedToolState): void {\n    for (const [name, isEnabled] of Object.entries(state.enabled)) {\n      const reg = this.registry.get(name);\n      if (reg) {\n        reg.enabled = isEnabled;\n      }\n    }\n\n    for (const [name, namespace] of Object.entries(state.namespaces)) {\n      this.setNamespace(name, namespace);\n    }\n\n    for (const [name, priority] of Object.entries(state.priorities)) {\n      this.setPriority(name, priority);\n    }\n  }\n\n  // ==========================================================================\n  // Private Helpers\n  // ==========================================================================\n\n  private getToolName(tool: ToolFunction): string {\n    return tool.definition.function.name;\n  }\n\n  private getSortedByPriority(): ToolRegistration[] {\n    return Array.from(this.registry.values()).sort((a, b) => b.priority - a.priority);\n  }\n\n  private addToNamespace(toolName: string, namespace: string): void {\n    if (!this.namespaceIndex.has(namespace)) {\n      this.namespaceIndex.set(namespace, new Set());\n    }\n    this.namespaceIndex.get(namespace)!.add(toolName);\n  }\n\n  private removeFromNamespace(toolName: string, namespace: string): void {\n    this.namespaceIndex.get(namespace)?.delete(toolName);\n  }\n\n  private moveToNamespace(toolName: string, oldNamespace: string, newNamespace: string): void {\n    this.removeFromNamespace(toolName, oldNamespace);\n    this.addToNamespace(toolName, newNamespace);\n  }\n\n  private filterByTokenBudget(tools: ToolFunction[], budget: number): ToolFunction[] {\n    const result: ToolFunction[] = [];\n    let usedTokens = 0;\n\n    for (const tool of tools) {\n      const toolTokens = this.estimateToolTokens(tool);\n      if (usedTokens + toolTokens <= budget) {\n        result.push(tool);\n        usedTokens += toolTokens;\n      }\n    }\n\n    return result;\n  }\n\n  private estimateToolTokens(tool: ToolFunction): number {\n    // Rough estimation: ~4 chars per token\n    const def = tool.definition.function;\n    const nameTokens = Math.ceil((def.name?.length ?? 0) / 4);\n    const descTokens = Math.ceil((def.description?.length ?? 0) / 4);\n    const paramTokens = def.parameters ? Math.ceil(JSON.stringify(def.parameters).length / 4) : 0;\n\n    return nameTokens + descTokens + paramTokens + 20; // +20 for structure overhead\n  }\n}\n","/**\n * SessionManager - Unified session persistence for all agent types\n *\n * Provides session management capabilities:\n * - Create, save, load, delete sessions\n * - Auto-save functionality\n * - Session metadata and filtering\n * - Pluggable storage backends\n *\n * Works with Agent, TaskAgent, and UniversalAgent\n */\n\nimport { EventEmitter } from 'events';\nimport type { SerializedToolState } from './ToolManager.js';\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport interface Session {\n  /** Unique session identifier */\n  id: string;\n  /** Type of agent that owns this session */\n  agentType: 'agent' | 'task-agent' | 'universal-agent' | string;\n  /** When the session was created */\n  createdAt: Date;\n  /** Last activity timestamp */\n  lastActiveAt: Date;\n\n  // --- Shared State (all agents) ---\n\n  /** Serialized conversation history */\n  history: SerializedHistory;\n  /** Tool enabled/disabled state */\n  toolState: SerializedToolState;\n\n  // --- Optional State (depends on agent type) ---\n\n  /** Working memory contents (TaskAgent, UniversalAgent) */\n  memory?: SerializedMemory;\n  /** Current plan (TaskAgent, UniversalAgent) */\n  plan?: SerializedPlan;\n  /** Current mode (UniversalAgent) */\n  mode?: string;\n  /** Execution metrics */\n  metrics?: SessionMetrics;\n\n  // --- Custom State ---\n\n  /** Agent-specific custom data */\n  custom: Record<string, unknown>;\n\n  // --- Metadata ---\n\n  metadata: SessionMetadata;\n}\n\nexport interface SessionMetadata {\n  /** Optional user identifier */\n  userId?: string;\n  /** Human-readable title */\n  title?: string;\n  /** Tags for filtering */\n  tags?: string[];\n  /** Custom metadata */\n  [key: string]: unknown;\n}\n\nexport interface SessionMetrics {\n  totalMessages: number;\n  totalToolCalls: number;\n  totalTokens: number;\n  totalDurationMs: number;\n}\n\nexport interface SerializedHistory {\n  /** History format version */\n  version: number;\n  /** Serialized history entries */\n  entries: SerializedHistoryEntry[];\n}\n\nexport interface SerializedHistoryEntry {\n  type: 'user' | 'assistant' | 'tool_result' | 'system' | 'task_event' | 'plan_event';\n  content: unknown;\n  timestamp: string; // ISO string\n  metadata?: Record<string, unknown>;\n}\n\nexport interface SerializedMemory {\n  /** Memory format version */\n  version: number;\n  /** Serialized memory entries */\n  entries: SerializedMemoryEntry[];\n}\n\nexport interface SerializedMemoryEntry {\n  key: string;\n  description: string;\n  value: unknown;\n  scope: 'task' | 'persistent';\n  sizeBytes: number;\n}\n\nexport interface SerializedPlan {\n  /** Plan format version */\n  version: number;\n  /** Plan data */\n  data: unknown;\n}\n\nexport interface SessionFilter {\n  /** Filter by agent type */\n  agentType?: string;\n  /** Filter by user ID */\n  userId?: string;\n  /** Filter by tags (any match) */\n  tags?: string[];\n  /** Filter by creation date range */\n  createdAfter?: Date;\n  createdBefore?: Date;\n  /** Filter by last active date range */\n  activeAfter?: Date;\n  activeBefore?: Date;\n  /** Limit results */\n  limit?: number;\n  /** Offset for pagination */\n  offset?: number;\n}\n\nexport interface SessionSummary {\n  id: string;\n  agentType: string;\n  createdAt: Date;\n  lastActiveAt: Date;\n  metadata: SessionMetadata;\n  messageCount: number;\n}\n\n// ============================================================================\n// Storage Interface\n// ============================================================================\n\nexport interface ISessionStorage {\n  /**\n   * Save a session (create or update)\n   */\n  save(session: Session): Promise<void>;\n\n  /**\n   * Load a session by ID\n   */\n  load(sessionId: string): Promise<Session | null>;\n\n  /**\n   * Delete a session by ID\n   */\n  delete(sessionId: string): Promise<void>;\n\n  /**\n   * Check if a session exists\n   */\n  exists(sessionId: string): Promise<boolean>;\n\n  /**\n   * List sessions with optional filtering\n   */\n  list(filter?: SessionFilter): Promise<SessionSummary[]>;\n\n  /**\n   * Search sessions by query string (searches title, tags, metadata)\n   */\n  search?(query: string, filter?: SessionFilter): Promise<SessionSummary[]>;\n}\n\n// ============================================================================\n// SessionManager Class\n// ============================================================================\n\nexport type SessionManagerEvent =\n  | 'session:created'\n  | 'session:saved'\n  | 'session:loaded'\n  | 'session:deleted'\n  | 'session:error';\n\nexport interface SessionManagerConfig {\n  storage: ISessionStorage;\n  /** Default metadata for new sessions */\n  defaultMetadata?: Partial<SessionMetadata>;\n}\n\nexport class SessionManager extends EventEmitter {\n  private storage: ISessionStorage;\n  private defaultMetadata: Partial<SessionMetadata>;\n  private autoSaveTimers: Map<string, NodeJS.Timeout> = new Map();\n\n  constructor(config: SessionManagerConfig) {\n    super();\n    this.storage = config.storage;\n    this.defaultMetadata = config.defaultMetadata ?? {};\n  }\n\n  // ==========================================================================\n  // Lifecycle\n  // ==========================================================================\n\n  /**\n   * Create a new session\n   */\n  create(agentType: string, metadata?: SessionMetadata): Session {\n    const now = new Date();\n    const session: Session = {\n      id: this.generateId(),\n      agentType,\n      createdAt: now,\n      lastActiveAt: now,\n      history: { version: 1, entries: [] },\n      toolState: { enabled: {}, namespaces: {}, priorities: {} },\n      custom: {},\n      metadata: {\n        ...this.defaultMetadata,\n        ...metadata,\n      },\n    };\n\n    this.emit('session:created', { sessionId: session.id, agentType });\n    return session;\n  }\n\n  /**\n   * Save a session to storage\n   */\n  async save(session: Session): Promise<void> {\n    try {\n      session.lastActiveAt = new Date();\n      await this.storage.save(session);\n      this.emit('session:saved', { sessionId: session.id });\n    } catch (error) {\n      this.emit('session:error', { sessionId: session.id, error, operation: 'save' });\n      throw error;\n    }\n  }\n\n  /**\n   * Load a session from storage\n   */\n  async load(sessionId: string): Promise<Session | null> {\n    try {\n      const session = await this.storage.load(sessionId);\n      if (session) {\n        // Ensure dates are Date objects (might be strings from JSON)\n        session.createdAt = new Date(session.createdAt);\n        session.lastActiveAt = new Date(session.lastActiveAt);\n        this.emit('session:loaded', { sessionId });\n      }\n      return session;\n    } catch (error) {\n      this.emit('session:error', { sessionId, error, operation: 'load' });\n      throw error;\n    }\n  }\n\n  /**\n   * Delete a session from storage\n   */\n  async delete(sessionId: string): Promise<void> {\n    try {\n      this.stopAutoSave(sessionId);\n      await this.storage.delete(sessionId);\n      this.emit('session:deleted', { sessionId });\n    } catch (error) {\n      this.emit('session:error', { sessionId, error, operation: 'delete' });\n      throw error;\n    }\n  }\n\n  /**\n   * Check if a session exists\n   */\n  async exists(sessionId: string): Promise<boolean> {\n    return this.storage.exists(sessionId);\n  }\n\n  // ==========================================================================\n  // Query\n  // ==========================================================================\n\n  /**\n   * List sessions with optional filtering\n   */\n  async list(filter?: SessionFilter): Promise<SessionSummary[]> {\n    return this.storage.list(filter);\n  }\n\n  /**\n   * Search sessions by query string\n   */\n  async search(query: string, filter?: SessionFilter): Promise<SessionSummary[]> {\n    if (this.storage.search) {\n      return this.storage.search(query, filter);\n    }\n    // Fallback: filter by title containing query\n    const all = await this.storage.list(filter);\n    const lowerQuery = query.toLowerCase();\n    return all.filter(\n      (s) =>\n        s.metadata.title?.toLowerCase().includes(lowerQuery) ||\n        s.metadata.tags?.some((t) => t.toLowerCase().includes(lowerQuery))\n    );\n  }\n\n  // ==========================================================================\n  // Advanced Operations\n  // ==========================================================================\n\n  /**\n   * Fork a session (create a copy with new ID)\n   */\n  async fork(sessionId: string, newMetadata?: Partial<SessionMetadata>): Promise<Session> {\n    const original = await this.load(sessionId);\n    if (!original) {\n      throw new Error(`Session not found: ${sessionId}`);\n    }\n\n    const forked: Session = {\n      ...original,\n      id: this.generateId(),\n      createdAt: new Date(),\n      lastActiveAt: new Date(),\n      metadata: {\n        ...original.metadata,\n        ...newMetadata,\n        forkedFrom: sessionId,\n      },\n      // Deep clone mutable fields\n      history: JSON.parse(JSON.stringify(original.history)),\n      toolState: JSON.parse(JSON.stringify(original.toolState)),\n      custom: JSON.parse(JSON.stringify(original.custom)),\n    };\n\n    if (original.memory) {\n      forked.memory = JSON.parse(JSON.stringify(original.memory));\n    }\n    if (original.plan) {\n      forked.plan = JSON.parse(JSON.stringify(original.plan));\n    }\n\n    await this.save(forked);\n    return forked;\n  }\n\n  /**\n   * Update session metadata\n   */\n  async updateMetadata(\n    sessionId: string,\n    metadata: Partial<SessionMetadata>\n  ): Promise<void> {\n    const session = await this.load(sessionId);\n    if (!session) {\n      throw new Error(`Session not found: ${sessionId}`);\n    }\n\n    session.metadata = { ...session.metadata, ...metadata };\n    await this.save(session);\n  }\n\n  // ==========================================================================\n  // Auto-Save\n  // ==========================================================================\n\n  /**\n   * Enable auto-save for a session\n   */\n  enableAutoSave(\n    session: Session,\n    intervalMs: number,\n    onSave?: (session: Session) => void\n  ): void {\n    this.stopAutoSave(session.id);\n\n    const timer = setInterval(async () => {\n      try {\n        await this.save(session);\n        onSave?.(session);\n      } catch (error) {\n        this.emit('session:error', {\n          sessionId: session.id,\n          error,\n          operation: 'auto-save',\n        });\n      }\n    }, intervalMs);\n\n    this.autoSaveTimers.set(session.id, timer);\n  }\n\n  /**\n   * Disable auto-save for a session\n   */\n  stopAutoSave(sessionId: string): void {\n    const timer = this.autoSaveTimers.get(sessionId);\n    if (timer) {\n      clearInterval(timer);\n      this.autoSaveTimers.delete(sessionId);\n    }\n  }\n\n  /**\n   * Stop all auto-save timers\n   */\n  stopAllAutoSave(): void {\n    for (const timer of this.autoSaveTimers.values()) {\n      clearInterval(timer);\n    }\n    this.autoSaveTimers.clear();\n  }\n\n  // ==========================================================================\n  // Utilities\n  // ==========================================================================\n\n  /**\n   * Generate a unique session ID\n   */\n  private generateId(): string {\n    const timestamp = Date.now().toString(36);\n    const random = Math.random().toString(36).substring(2, 10);\n    return `sess_${timestamp}_${random}`;\n  }\n\n  /**\n   * Cleanup resources\n   */\n  destroy(): void {\n    this.stopAllAutoSave();\n    this.removeAllListeners();\n  }\n}\n\n// ============================================================================\n// Session Helpers\n// ============================================================================\n\n/**\n * Create an empty serialized history\n */\nexport function createEmptyHistory(): SerializedHistory {\n  return { version: 1, entries: [] };\n}\n\n/**\n * Create an empty serialized memory\n */\nexport function createEmptyMemory(): SerializedMemory {\n  return { version: 1, entries: [] };\n}\n\n/**\n * Add an entry to serialized history\n */\nexport function addHistoryEntry(\n  history: SerializedHistory,\n  type: SerializedHistoryEntry['type'],\n  content: unknown,\n  metadata?: Record<string, unknown>\n): void {\n  history.entries.push({\n    type,\n    content,\n    timestamp: new Date().toISOString(),\n    metadata,\n  });\n}\n","/**\n * Tool registry - manages tool registration and execution\n */\n\nimport { IToolExecutor } from '../../domain/interfaces/IToolExecutor.js';\nimport { Tool, ToolFunction } from '../../domain/entities/Tool.js';\nimport { ToolNotFoundError, ToolExecutionError } from '../../domain/errors/AIErrors.js';\nimport { CircuitBreaker, CircuitState } from '../../infrastructure/resilience/CircuitBreaker.js';\nimport { logger, FrameworkLogger } from '../../infrastructure/observability/Logger.js';\nimport { metrics } from '../../infrastructure/observability/Metrics.js';\n\nexport class ToolRegistry implements IToolExecutor {\n  private tools: Map<string, ToolFunction> = new Map();\n  private circuitBreakers: Map<string, CircuitBreaker> = new Map();\n  private logger: FrameworkLogger;\n\n  constructor() {\n    this.logger = logger.child({ component: 'ToolRegistry' });\n  }\n\n  /**\n   * Register a new tool\n   */\n  registerTool(tool: ToolFunction): void {\n    this.tools.set(tool.definition.function.name, tool);\n  }\n\n  /**\n   * Unregister a tool\n   */\n  unregisterTool(toolName: string): void {\n    this.tools.delete(toolName);\n  }\n\n  /**\n   * Get or create circuit breaker for a tool\n   */\n  private getCircuitBreaker(toolName: string, tool: ToolFunction): CircuitBreaker {\n    let breaker = this.circuitBreakers.get(toolName);\n\n    if (!breaker) {\n      // Create circuit breaker for this tool\n      const config = (tool as any).circuitBreaker || {\n        failureThreshold: 3,\n        successThreshold: 2,\n        resetTimeoutMs: 60000, // 1 minute\n        windowMs: 300000, // 5 minutes\n      };\n\n      breaker = new CircuitBreaker(`tool:${toolName}`, config);\n\n      // Forward CB events to logger and metrics\n      breaker.on('opened', (data) => {\n        this.logger.warn(data, `Circuit breaker opened for tool: ${toolName}`);\n        metrics.increment('circuit_breaker.opened', 1, {\n          breaker: data.name,\n          tool: toolName,\n        });\n      });\n\n      breaker.on('closed', (data) => {\n        this.logger.info(data, `Circuit breaker closed for tool: ${toolName}`);\n        metrics.increment('circuit_breaker.closed', 1, {\n          breaker: data.name,\n          tool: toolName,\n        });\n      });\n\n      this.circuitBreakers.set(toolName, breaker);\n    }\n\n    return breaker;\n  }\n\n  /**\n   * Execute a tool function\n   */\n  async execute(toolName: string, args: any): Promise<any> {\n    const tool = this.tools.get(toolName);\n    if (!tool) {\n      throw new ToolNotFoundError(toolName);\n    }\n\n    // Get circuit breaker for this tool\n    const breaker = this.getCircuitBreaker(toolName, tool);\n\n    this.logger.debug({ toolName, args }, 'Tool execution started');\n\n    const startTime = Date.now();\n\n    metrics.increment('tool.executed', 1, { tool: toolName });\n\n    try {\n      // Execute with circuit breaker protection\n      const result = await breaker.execute(async () => {\n        return await tool.execute(args);\n      });\n\n      const duration = Date.now() - startTime;\n\n      this.logger.debug({ toolName, duration }, 'Tool execution completed');\n\n      metrics.timing('tool.duration', duration, { tool: toolName });\n      metrics.increment('tool.success', 1, { tool: toolName });\n\n      return result;\n    } catch (error) {\n      const duration = Date.now() - startTime;\n\n      this.logger.error({\n        toolName,\n        error: (error as Error).message,\n        duration,\n      }, 'Tool execution failed');\n\n      metrics.increment('tool.failed', 1, {\n        tool: toolName,\n        error: (error as Error).name,\n      });\n\n      throw new ToolExecutionError(\n        toolName,\n        (error as Error).message,\n        error as Error\n      );\n    }\n  }\n\n  /**\n   * Check if tool is available\n   */\n  hasToolFunction(toolName: string): boolean {\n    return this.tools.has(toolName);\n  }\n\n  /**\n   * Get tool definition\n   */\n  getToolDefinition(toolName: string): Tool | undefined {\n    const tool = this.tools.get(toolName);\n    return tool?.definition;\n  }\n\n  /**\n   * List all registered tools\n   */\n  listTools(): string[] {\n    return Array.from(this.tools.keys());\n  }\n\n  /**\n   * Clear all registered tools\n   */\n  clear(): void {\n    this.tools.clear();\n    this.circuitBreakers.clear();\n  }\n\n  /**\n   * Get circuit breaker states for all tools\n   */\n  getCircuitBreakerStates(): Map<string, CircuitState> {\n    const states = new Map<string, CircuitState>();\n    for (const [toolName, breaker] of this.circuitBreakers.entries()) {\n      states.set(toolName, breaker.getState());\n    }\n    return states;\n  }\n\n  /**\n   * Get circuit breaker metrics for a specific tool\n   */\n  getToolCircuitBreakerMetrics(toolName: string) {\n    const breaker = this.circuitBreakers.get(toolName);\n    return breaker?.getMetrics();\n  }\n\n  /**\n   * Manually reset a tool's circuit breaker\n   */\n  resetToolCircuitBreaker(toolName: string): void {\n    const breaker = this.circuitBreakers.get(toolName);\n    if (breaker) {\n      breaker.reset();\n      this.logger.info({ toolName }, 'Tool circuit breaker manually reset');\n    }\n  }\n}\n","/**\n * Tool entities with blocking/non-blocking execution support\n */\n\nexport interface JSONSchema {\n  type: string;\n  properties?: Record<string, any>;\n  required?: string[];\n  [key: string]: any;\n}\n\nexport interface FunctionToolDefinition {\n  type: 'function';\n  function: {\n    name: string;\n    description?: string;\n    parameters?: JSONSchema;\n    strict?: boolean; // Enforce schema strictly\n  };\n  blocking?: boolean; // Default: true (wait for result before continuing)\n  timeout?: number; // Timeout in ms (default: 30000)\n}\n\nexport interface BuiltInTool {\n  type: 'web_search' | 'file_search' | 'computer_use' | 'code_interpreter';\n  blocking?: boolean;\n}\n\nexport type Tool = FunctionToolDefinition | BuiltInTool;\n\nexport enum ToolCallState {\n  PENDING = 'pending', // Tool call identified, not yet executed\n  EXECUTING = 'executing', // Currently executing\n  COMPLETED = 'completed', // Successfully completed\n  FAILED = 'failed', // Execution failed\n  TIMEOUT = 'timeout', // Execution timed out\n}\n\nexport interface ToolCall {\n  id: string;\n  type: 'function';\n  function: {\n    name: string;\n    arguments: string; // JSON string\n  };\n  blocking: boolean; // Copied from tool definition\n  state: ToolCallState;\n  startTime?: Date;\n  endTime?: Date;\n  error?: string;\n}\n\nexport interface ToolResult {\n  tool_use_id: string;\n  content: any;\n  error?: string;\n  executionTime?: number; // ms\n  state: ToolCallState;\n}\n\n/**\n * Tool execution context - tracks all tool calls in a generation\n */\nexport interface ToolExecutionContext {\n  executionId: string; // Unique ID for this LLM generation\n  toolCalls: Map<string, ToolCall>; // tool_use_id  ToolCall\n  pendingNonBlocking: Set<string>; // IDs of pending non-blocking calls\n  completedResults: Map<string, ToolResult>; // tool_use_id  ToolResult\n}\n\n/**\n * Tool context - passed to tools during execution (optional, for TaskAgent)\n */\nexport interface ToolContext {\n  agentId: string;\n  taskId?: string;\n  memory?: any; // WorkingMemoryAccess, but avoiding circular dependency\n  signal?: AbortSignal;\n}\n\n/**\n * Output handling hints for context management\n */\nexport interface ToolOutputHints {\n  expectedSize?: 'small' | 'medium' | 'large' | 'variable';\n  summarize?: (output: unknown) => string;\n}\n\n/**\n * Idempotency configuration for tool caching\n */\nexport interface ToolIdempotency {\n  safe: boolean;\n  keyFn?: (args: Record<string, unknown>) => string;\n  ttlMs?: number;\n}\n\n/**\n * User-provided tool function\n */\nexport interface ToolFunction<TArgs = any, TResult = any> {\n  definition: FunctionToolDefinition;\n  execute: (args: TArgs, context?: ToolContext) => Promise<TResult>;\n\n  // Extended fields for TaskAgent (optional, backward compatible)\n  idempotency?: ToolIdempotency;\n  output?: ToolOutputHints;\n}\n","/**\n * Execution context - tracks state, metrics, and history for agent execution\n * Includes memory safety (circular buffers) and resource limits\n */\n\nimport { AgentResponse } from '../../domain/entities/Response.js';\nimport { TextGenerateOptions } from '../../domain/interfaces/ITextProvider.js';\nimport { ToolCall, ToolResult, ToolCallState } from '../../domain/entities/Tool.js';\n\nexport type HistoryMode = 'none' | 'summary' | 'full';\n\nexport interface ExecutionContextConfig {\n  maxHistorySize?: number; // Max iterations to store (default: 10)\n  historyMode?: HistoryMode; // What to store (default: 'summary')\n  maxAuditTrailSize?: number; // Max audit entries (default: 1000)\n}\n\nexport interface IterationRecord {\n  iteration: number;\n  request: TextGenerateOptions;\n  response: AgentResponse;\n  toolCalls: ToolCall[];\n  toolResults: ToolResult[];\n  startTime: Date;\n  endTime: Date;\n}\n\nexport interface IterationSummary {\n  iteration: number;\n  tokens: number;\n  toolCount: number;\n  duration: number;\n  timestamp: Date;\n}\n\nexport interface ExecutionMetrics {\n  // Timing\n  totalDuration: number;\n  llmDuration: number;\n  toolDuration: number;\n  hookDuration: number;\n\n  // Counts\n  iterationCount: number;\n  toolCallCount: number;\n  toolSuccessCount: number;\n  toolFailureCount: number;\n  toolTimeoutCount: number;\n\n  // Tokens\n  inputTokens: number;\n  outputTokens: number;\n  totalTokens: number;\n\n  // Errors\n  errors: Array<{ type: string; message: string; timestamp: Date }>;\n}\n\nexport interface AuditEntry {\n  timestamp: Date;\n  type:\n    | 'hook_executed'\n    | 'tool_modified'\n    | 'tool_skipped'\n    | 'execution_paused'\n    | 'execution_resumed'\n    | 'tool_approved'\n    | 'tool_rejected';\n  hookName?: string;\n  toolName?: string;\n  details: any;\n}\n\nexport class ExecutionContext {\n  // Execution metadata\n  readonly executionId: string;\n  readonly startTime: Date;\n  iteration: number = 0;\n\n  // Tool tracking\n  readonly toolCalls: Map<string, ToolCall> = new Map();\n  readonly toolResults: Map<string, ToolResult> = new Map();\n\n  // Control state\n  paused: boolean = false;\n  pauseReason?: string;\n  cancelled: boolean = false;\n  cancelReason?: string;\n\n  // User data (for hooks to share state)\n  readonly metadata: Map<string, any> = new Map();\n\n  // History storage (memory-safe)\n  private readonly config: ExecutionContextConfig;\n  private readonly iterations: IterationRecord[] = [];\n  private readonly iterationSummaries: IterationSummary[] = [];\n\n  // Metrics\n  readonly metrics: ExecutionMetrics = {\n    totalDuration: 0,\n    llmDuration: 0,\n    toolDuration: 0,\n    hookDuration: 0,\n    iterationCount: 0,\n    toolCallCount: 0,\n    toolSuccessCount: 0,\n    toolFailureCount: 0,\n    toolTimeoutCount: 0,\n    inputTokens: 0,\n    outputTokens: 0,\n    totalTokens: 0,\n    errors: [],\n  };\n\n  // Audit trail\n  private readonly auditTrail: AuditEntry[] = [];\n\n  constructor(\n    executionId: string,\n    config: ExecutionContextConfig = {}\n  ) {\n    this.executionId = executionId;\n    this.startTime = new Date();\n    this.config = {\n      maxHistorySize: config.maxHistorySize || 10,\n      historyMode: config.historyMode || 'summary',\n      maxAuditTrailSize: config.maxAuditTrailSize || 1000,\n    };\n  }\n\n  /**\n   * Add iteration to history (memory-safe)\n   */\n  addIteration(record: IterationRecord): void {\n    switch (this.config.historyMode) {\n      case 'none':\n        // Don't store anything\n        break;\n\n      case 'summary':\n        // Store lightweight summary only\n        this.iterationSummaries.push({\n          iteration: record.iteration,\n          tokens: record.response.usage.total_tokens,\n          toolCount: record.toolCalls.length,\n          duration: record.endTime.getTime() - record.startTime.getTime(),\n          timestamp: record.startTime,\n        });\n\n        // Keep circular buffer\n        if (this.iterationSummaries.length > this.config.maxHistorySize!) {\n          this.iterationSummaries.shift();\n        }\n        break;\n\n      case 'full':\n        // Store full iteration data\n        this.iterations.push(record);\n\n        // Keep circular buffer\n        if (this.iterations.length > this.config.maxHistorySize!) {\n          this.iterations.shift();\n        }\n        break;\n    }\n  }\n\n  /**\n   * Get iteration history\n   */\n  getHistory(): IterationRecord[] | IterationSummary[] {\n    return this.config.historyMode === 'full' ? this.iterations : this.iterationSummaries;\n  }\n\n  /**\n   * Add audit entry\n   */\n  audit(type: AuditEntry['type'], details: any, hookName?: string, toolName?: string): void {\n    this.auditTrail.push({\n      timestamp: new Date(),\n      type,\n      hookName,\n      toolName,\n      details,\n    });\n\n    // Keep circular buffer\n    if (this.auditTrail.length > this.config.maxAuditTrailSize!) {\n      this.auditTrail.shift();\n    }\n  }\n\n  /**\n   * Get audit trail\n   */\n  getAuditTrail(): readonly AuditEntry[] {\n    return this.auditTrail;\n  }\n\n  /**\n   * Update metrics\n   */\n  updateMetrics(update: Partial<ExecutionMetrics>): void {\n    Object.assign(this.metrics, update);\n  }\n\n  /**\n   * Add tool call to tracking\n   */\n  addToolCall(toolCall: ToolCall): void {\n    this.toolCalls.set(toolCall.id, toolCall);\n    this.metrics.toolCallCount++;\n  }\n\n  /**\n   * Add tool result to tracking\n   */\n  addToolResult(result: ToolResult): void {\n    this.toolResults.set(result.tool_use_id, result);\n\n    // Update metrics\n    if (result.state === ToolCallState.COMPLETED) {\n      this.metrics.toolSuccessCount++;\n    } else if (result.state === ToolCallState.FAILED) {\n      this.metrics.toolFailureCount++;\n    } else if (result.state === ToolCallState.TIMEOUT) {\n      this.metrics.toolTimeoutCount++;\n    }\n  }\n\n  /**\n   * Check resource limits\n   */\n  checkLimits(limits?: {\n    maxExecutionTime?: number;\n    maxToolCalls?: number;\n    maxContextSize?: number;\n  }): void {\n    if (!limits) return;\n\n    // Check execution time\n    if (limits.maxExecutionTime) {\n      const elapsed = Date.now() - this.startTime.getTime();\n      if (elapsed > limits.maxExecutionTime) {\n        throw new Error(\n          `Execution time limit exceeded: ${elapsed}ms > ${limits.maxExecutionTime}ms`\n        );\n      }\n    }\n\n    // Check tool call count\n    if (limits.maxToolCalls && this.toolCalls.size > limits.maxToolCalls) {\n      throw new Error(\n        `Tool call limit exceeded: ${this.toolCalls.size} > ${limits.maxToolCalls}`\n      );\n    }\n\n    // Check context size\n    if (limits.maxContextSize) {\n      const size = this.estimateSize();\n      if (size > limits.maxContextSize) {\n        throw new Error(\n          `Context size limit exceeded: ${size} bytes > ${limits.maxContextSize} bytes`\n        );\n      }\n    }\n  }\n\n  /**\n   * Estimate memory usage (rough approximation)\n   */\n  private estimateSize(): number {\n    try {\n      const data = {\n        toolCalls: Array.from(this.toolCalls.values()),\n        toolResults: Array.from(this.toolResults.values()),\n        iterations: this.config.historyMode === 'full' ? this.iterations : this.iterationSummaries,\n        auditTrail: this.auditTrail,\n      };\n      return JSON.stringify(data).length;\n    } catch {\n      return 0; // Error estimating, return 0\n    }\n  }\n\n  /**\n   * Cleanup resources and release memory\n   * Clears all internal arrays and maps to allow garbage collection\n   */\n  cleanup(): void {\n    // Store execution summary before clearing\n    const summary = {\n      executionId: this.executionId,\n      totalIterations: this.iteration,\n      totalToolCalls: this.metrics.toolCallCount,\n      totalDuration: Date.now() - this.startTime.getTime(),\n      success: !this.cancelled && this.metrics.errors.length === 0,\n    };\n\n    // Clear all maps\n    this.toolCalls.clear();\n    this.toolResults.clear();\n    this.metadata.clear();\n\n    // Clear all arrays (modify length to allow GC of items)\n    this.iterations.length = 0;\n    this.iterationSummaries.length = 0;\n    this.auditTrail.length = 0;\n    this.metrics.errors.length = 0;\n\n    // Store summary after clearing (for final access if needed)\n    this.metadata.set('execution_summary', summary);\n  }\n\n  /**\n   * Get execution summary\n   */\n  getSummary() {\n    return {\n      executionId: this.executionId,\n      startTime: this.startTime,\n      currentIteration: this.iteration,\n      paused: this.paused,\n      cancelled: this.cancelled,\n      metrics: { ...this.metrics },\n      totalDuration: Date.now() - this.startTime.getTime(),\n    };\n  }\n}\n","/**\n * Hook manager - handles hook registration and execution\n * Includes error isolation, timeouts, and optional parallel execution\n */\n\nimport { EventEmitter } from 'eventemitter3';\nimport {\n  Hook,\n  HookConfig,\n  HookName,\n  HookSignatures,\n} from './types/HookTypes.js';\n\nexport class HookManager {\n  private hooks: Map<HookName, Hook<any, any>[]> = new Map();\n  private timeout: number;\n  private parallel: boolean;\n  // Per-hook error tracking: hookKey -> consecutive error count\n  private hookErrorCounts: Map<string, number> = new Map();\n  // Disabled hooks that exceeded error threshold\n  private disabledHooks: Set<string> = new Set();\n  private maxConsecutiveErrors: number = 3;\n  private emitter: EventEmitter;\n\n  constructor(\n    config: HookConfig = {},\n    emitter: EventEmitter,\n    errorHandling?: { maxConsecutiveErrors?: number }\n  ) {\n    this.timeout = config.hookTimeout || 5000; // 5 second default\n    this.parallel = config.parallelHooks || false;\n    this.emitter = emitter;\n    this.maxConsecutiveErrors = errorHandling?.maxConsecutiveErrors || 3;\n\n    // Register hooks from config\n    this.registerFromConfig(config);\n  }\n\n  /**\n   * Register hooks from configuration\n   */\n  private registerFromConfig(config: HookConfig): void {\n    const hookNames: HookName[] = [\n      'before:execution',\n      'after:execution',\n      'before:llm',\n      'after:llm',\n      'before:tool',\n      'after:tool',\n      'approve:tool',\n      'pause:check',\n    ];\n\n    for (const name of hookNames) {\n      const hook = config[name];\n      if (hook) {\n        this.register(name, hook);\n      }\n    }\n  }\n\n  /**\n   * Register a hook\n   */\n  register(name: HookName, hook: Hook<any, any>): void {\n    // Validate hook is a function\n    if (typeof hook !== 'function') {\n      throw new Error(`Hook must be a function, got: ${typeof hook}`);\n    }\n\n    // Get or create hooks array\n    if (!this.hooks.has(name)) {\n      this.hooks.set(name, []);\n    }\n\n    const existing = this.hooks.get(name)!;\n\n    // Limit number of hooks per name\n    if (existing.length >= 10) {\n      throw new Error(`Too many hooks for ${name} (max: 10)`);\n    }\n\n    existing.push(hook);\n  }\n\n  /**\n   * Execute hooks for a given name\n   */\n  async executeHooks<K extends HookName>(\n    name: K,\n    context: HookSignatures[K]['context'],\n    defaultResult: HookSignatures[K]['result']\n  ): Promise<HookSignatures[K]['result']> {\n    const hooks = this.hooks.get(name);\n\n    if (!hooks || hooks.length === 0) {\n      return defaultResult;\n    }\n\n    // Parallel execution (for independent hooks)\n    if (this.parallel && hooks.length > 1) {\n      return this.executeHooksParallel(hooks, context, defaultResult);\n    }\n\n    // Sequential execution (default)\n    return this.executeHooksSequential(hooks, context, defaultResult);\n  }\n\n  /**\n   * Execute hooks sequentially\n   */\n  private async executeHooksSequential<T>(\n    hooks: Hook<any, any>[],\n    context: any,\n    defaultResult: T\n  ): Promise<T> {\n    let result = defaultResult;\n\n    for (let i = 0; i < hooks.length; i++) {\n      const hook = hooks[i]!;\n      const hookKey = this.getHookKey(hook, i);\n      const hookResult = await this.executeHookSafely(hook, context, hookKey);\n\n      // Skip failed hooks\n      if (hookResult === null) {\n        continue;\n      }\n\n      // Merge hook result\n      result = { ...result, ...hookResult };\n\n      // Check for early exit\n      if ((hookResult as any).skip === true) {\n        break;\n      }\n    }\n\n    return result;\n  }\n\n  /**\n   * Execute hooks in parallel\n   */\n  private async executeHooksParallel<T>(\n    hooks: Hook<any, any>[],\n    context: any,\n    defaultResult: T\n  ): Promise<T> {\n    // Execute all hooks concurrently with unique keys\n    const results = await Promise.all(\n      hooks.map((hook, i) => {\n        const hookKey = this.getHookKey(hook, i);\n        return this.executeHookSafely(hook, context, hookKey);\n      })\n    );\n\n    // Filter out failures and merge results\n    const validResults = results.filter((r) => r !== null);\n\n    return validResults.reduce(\n      (acc, hookResult) => ({ ...acc, ...hookResult }),\n      defaultResult\n    );\n  }\n\n  /**\n   * Generate unique key for a hook\n   */\n  private getHookKey(hook: Hook<any, any>, index: number): string {\n    return `${hook.name || 'anonymous'}_${index}`;\n  }\n\n  /**\n   * Execute single hook with error isolation and timeout (with per-hook error tracking)\n   */\n  private async executeHookSafely<T>(\n    hook: Hook<any, any>,\n    context: any,\n    hookKey?: string\n  ): Promise<T | null> {\n    const key = hookKey || hook.name || 'anonymous';\n\n    // Skip disabled hooks\n    if (this.disabledHooks.has(key)) {\n      return null;\n    }\n\n    const startTime = Date.now();\n\n    try {\n      // Execute with timeout\n      const result = await Promise.race([\n        hook(context),\n        new Promise<never>((_, reject) =>\n          setTimeout(() => reject(new Error('Hook timeout')), this.timeout)\n        ),\n      ]);\n\n      // Reset error counter for this hook on success\n      this.hookErrorCounts.delete(key);\n\n      // Track timing\n      const duration = Date.now() - startTime;\n      if (context.context?.updateMetrics) {\n        context.context.updateMetrics({\n          hookDuration: (context.context.metrics.hookDuration || 0) + duration,\n        });\n      }\n\n      return result as T;\n    } catch (error) {\n      // Increment error counter for this specific hook\n      const errorCount = (this.hookErrorCounts.get(key) || 0) + 1;\n      this.hookErrorCounts.set(key, errorCount);\n\n      // Emit error event\n      this.emitter.emit('hook:error', {\n        executionId: context.executionId,\n        hookName: hook.name || 'anonymous',\n        error: error as Error,\n        consecutiveErrors: errorCount,\n        timestamp: new Date(),\n      });\n\n      // Check consecutive error threshold for this hook\n      if (errorCount >= this.maxConsecutiveErrors) {\n        // Disable this specific hook, not all hooks\n        this.disabledHooks.add(key);\n        console.warn(\n          `Hook \"${key}\" disabled after ${errorCount} consecutive failures. Last error: ${(error as Error).message}`\n        );\n      } else {\n        // Log warning but continue (degraded mode)\n        console.warn(\n          `Hook execution failed (${key}): ${(error as Error).message} (${errorCount}/${this.maxConsecutiveErrors} errors)`\n        );\n      }\n\n      return null; // Hook failed, skip its result\n    }\n  }\n\n  /**\n   * Check if there are any hooks registered\n   */\n  hasHooks(name: HookName): boolean {\n    const hooks = this.hooks.get(name);\n    return !!hooks && hooks.length > 0;\n  }\n\n  /**\n   * Get hook count\n   */\n  getHookCount(name?: HookName): number {\n    if (name) {\n      return this.hooks.get(name)?.length || 0;\n    }\n    // Total across all hooks\n    return Array.from(this.hooks.values()).reduce((sum, arr) => sum + arr.length, 0);\n  }\n\n  /**\n   * Clear all hooks and reset error tracking\n   */\n  clear(): void {\n    this.hooks.clear();\n    this.hookErrorCounts.clear();\n    this.disabledHooks.clear();\n  }\n\n  /**\n   * Re-enable a disabled hook\n   */\n  enableHook(hookKey: string): void {\n    this.disabledHooks.delete(hookKey);\n    this.hookErrorCounts.delete(hookKey);\n  }\n\n  /**\n   * Get list of disabled hooks\n   */\n  getDisabledHooks(): string[] {\n    return Array.from(this.disabledHooks);\n  }\n}\n","/**\n * StreamState - Accumulates streaming events to reconstruct complete response\n */\n\nimport { TokenUsage } from './Response.js';\nimport { ToolCall } from './Tool.js';\n\n/**\n * Buffer for accumulating tool call arguments\n */\nexport interface ToolCallBuffer {\n  toolName: string;\n  argumentChunks: string[];\n  isComplete: boolean;\n  startTime: Date;\n}\n\n/**\n * StreamState tracks all accumulated data during streaming\n */\nexport class StreamState {\n  // Core identifiers\n  public responseId: string;\n  public model: string;\n  public createdAt: number;\n\n  // Text accumulation: item_id -> text chunks\n  private textBuffers: Map<string, string[]>;\n\n  // Tool call accumulation: tool_call_id -> buffer\n  private toolCallBuffers: Map<string, ToolCallBuffer>;\n\n  // Completed tool calls\n  private completedToolCalls: ToolCall[];\n\n  // Tool execution results\n  private toolResults: Map<string, any>;\n\n  // Metadata\n  public currentIteration: number;\n  public usage: TokenUsage;\n  public status: 'in_progress' | 'completed' | 'incomplete' | 'failed';\n  public startTime: Date;\n  public endTime?: Date;\n\n  // Statistics\n  public totalChunks: number;\n  public totalTextDeltas: number;\n  public totalToolCalls: number;\n\n  constructor(responseId: string, model: string, createdAt?: number) {\n    this.responseId = responseId;\n    this.model = model;\n    this.createdAt = createdAt || Date.now();\n\n    this.textBuffers = new Map();\n    this.toolCallBuffers = new Map();\n    this.completedToolCalls = [];\n    this.toolResults = new Map();\n\n    this.currentIteration = 0;\n    this.usage = {\n      input_tokens: 0,\n      output_tokens: 0,\n      total_tokens: 0,\n    };\n    this.status = 'in_progress';\n    this.startTime = new Date();\n\n    this.totalChunks = 0;\n    this.totalTextDeltas = 0;\n    this.totalToolCalls = 0;\n  }\n\n  /**\n   * Accumulate text delta for a specific item\n   */\n  accumulateTextDelta(itemId: string, delta: string): void {\n    if (!this.textBuffers.has(itemId)) {\n      this.textBuffers.set(itemId, []);\n    }\n    this.textBuffers.get(itemId)!.push(delta);\n    this.totalTextDeltas++;\n    this.totalChunks++;\n  }\n\n  /**\n   * Get complete accumulated text for an item\n   */\n  getCompleteText(itemId: string): string {\n    const chunks = this.textBuffers.get(itemId);\n    return chunks ? chunks.join('') : '';\n  }\n\n  /**\n   * Get all accumulated text (all items concatenated)\n   */\n  getAllText(): string {\n    const allText: string[] = [];\n    for (const chunks of this.textBuffers.values()) {\n      allText.push(chunks.join(''));\n    }\n    return allText.join('');\n  }\n\n  /**\n   * Start accumulating tool call arguments\n   */\n  startToolCall(toolCallId: string, toolName: string): void {\n    this.toolCallBuffers.set(toolCallId, {\n      toolName,\n      argumentChunks: [],\n      isComplete: false,\n      startTime: new Date(),\n    });\n  }\n\n  /**\n   * Accumulate tool argument delta\n   */\n  accumulateToolArguments(toolCallId: string, delta: string): void {\n    const buffer = this.toolCallBuffers.get(toolCallId);\n    if (!buffer) {\n      throw new Error(`Tool call buffer not found for id: ${toolCallId}`);\n    }\n    buffer.argumentChunks.push(delta);\n    this.totalChunks++;\n  }\n\n  /**\n   * Mark tool call arguments as complete\n   */\n  completeToolCall(toolCallId: string): void {\n    const buffer = this.toolCallBuffers.get(toolCallId);\n    if (!buffer) {\n      throw new Error(`Tool call buffer not found for id: ${toolCallId}`);\n    }\n    buffer.isComplete = true;\n    this.totalToolCalls++;\n  }\n\n  /**\n   * Get complete tool arguments (joined chunks)\n   */\n  getCompleteToolArguments(toolCallId: string): string {\n    const buffer = this.toolCallBuffers.get(toolCallId);\n    if (!buffer) {\n      throw new Error(`Tool call buffer not found for id: ${toolCallId}`);\n    }\n    return buffer.argumentChunks.join('');\n  }\n\n  /**\n   * Check if tool call is complete\n   */\n  isToolCallComplete(toolCallId: string): boolean {\n    const buffer = this.toolCallBuffers.get(toolCallId);\n    return buffer ? buffer.isComplete : false;\n  }\n\n  /**\n   * Get tool name for a tool call\n   */\n  getToolName(toolCallId: string): string | undefined {\n    return this.toolCallBuffers.get(toolCallId)?.toolName;\n  }\n\n  /**\n   * Add completed tool call\n   */\n  addCompletedToolCall(toolCall: ToolCall): void {\n    this.completedToolCalls.push(toolCall);\n  }\n\n  /**\n   * Get all completed tool calls\n   */\n  getCompletedToolCalls(): ToolCall[] {\n    return [...this.completedToolCalls];\n  }\n\n  /**\n   * Store tool execution result\n   */\n  setToolResult(toolCallId: string, result: any): void {\n    this.toolResults.set(toolCallId, result);\n  }\n\n  /**\n   * Get tool execution result\n   */\n  getToolResult(toolCallId: string): any {\n    return this.toolResults.get(toolCallId);\n  }\n\n  /**\n   * Update token usage (replaces values, doesn't accumulate)\n   */\n  updateUsage(usage: Partial<TokenUsage>): void {\n    if (usage.input_tokens !== undefined) {\n      this.usage.input_tokens = usage.input_tokens;\n    }\n    if (usage.output_tokens !== undefined) {\n      this.usage.output_tokens = usage.output_tokens;\n    }\n    if (usage.total_tokens !== undefined) {\n      this.usage.total_tokens = usage.total_tokens;\n    } else {\n      // Calculate total if not provided\n      this.usage.total_tokens = this.usage.input_tokens + this.usage.output_tokens;\n    }\n  }\n\n  /**\n   * Accumulate token usage (adds to existing values)\n   */\n  accumulateUsage(usage: Partial<TokenUsage>): void {\n    if (usage.input_tokens !== undefined) {\n      this.usage.input_tokens += usage.input_tokens;\n    }\n    if (usage.output_tokens !== undefined) {\n      this.usage.output_tokens += usage.output_tokens;\n    }\n    if (usage.total_tokens !== undefined) {\n      this.usage.total_tokens += usage.total_tokens;\n    } else {\n      // Recalculate total\n      this.usage.total_tokens = this.usage.input_tokens + this.usage.output_tokens;\n    }\n  }\n\n  /**\n   * Mark stream as complete\n   */\n  markComplete(status: 'completed' | 'incomplete' | 'failed' = 'completed'): void {\n    this.status = status;\n    this.endTime = new Date();\n  }\n\n  /**\n   * Get duration in milliseconds\n   */\n  getDuration(): number {\n    const end = this.endTime || new Date();\n    return end.getTime() - this.startTime.getTime();\n  }\n\n  /**\n   * Increment iteration counter\n   */\n  incrementIteration(): void {\n    this.currentIteration++;\n  }\n\n  /**\n   * Get summary statistics\n   */\n  getStatistics() {\n    return {\n      responseId: this.responseId,\n      model: this.model,\n      status: this.status,\n      iterations: this.currentIteration,\n      totalChunks: this.totalChunks,\n      totalTextDeltas: this.totalTextDeltas,\n      totalToolCalls: this.totalToolCalls,\n      textItemsCount: this.textBuffers.size,\n      toolCallBuffersCount: this.toolCallBuffers.size,\n      completedToolCallsCount: this.completedToolCalls.length,\n      durationMs: this.getDuration(),\n      usage: { ...this.usage },\n    };\n  }\n\n  /**\n   * Check if stream has any accumulated text\n   */\n  hasText(): boolean {\n    return this.textBuffers.size > 0;\n  }\n\n  /**\n   * Check if stream has any tool calls\n   */\n  hasToolCalls(): boolean {\n    return this.toolCallBuffers.size > 0;\n  }\n\n  /**\n   * Clear all buffers (for memory management)\n   */\n  clear(): void {\n    this.textBuffers.clear();\n    this.toolCallBuffers.clear();\n    this.completedToolCalls = [];\n    this.toolResults.clear();\n  }\n\n  /**\n   * Create a snapshot for checkpointing (error recovery)\n   */\n  createSnapshot() {\n    return {\n      responseId: this.responseId,\n      model: this.model,\n      createdAt: this.createdAt,\n      textBuffers: new Map(this.textBuffers),\n      toolCallBuffers: new Map(this.toolCallBuffers),\n      completedToolCalls: [...this.completedToolCalls],\n      toolResults: new Map(this.toolResults),\n      currentIteration: this.currentIteration,\n      usage: { ...this.usage },\n      status: this.status,\n      startTime: this.startTime,\n      endTime: this.endTime,\n    };\n  }\n}\n","/**\n * Agentic loop - handles tool calling and multi-turn conversations\n * Now with events, hooks, pause/resume, and enterprise features\n */\n\nimport { randomUUID } from 'crypto';\nimport { EventEmitter } from 'eventemitter3';\nimport { ITextProvider, TextGenerateOptions } from '../../domain/interfaces/ITextProvider.js';\nimport { IToolExecutor } from '../../domain/interfaces/IToolExecutor.js';\nimport { AgentResponse } from '../../domain/entities/Response.js';\nimport { InputItem, MessageRole, OutputItem } from '../../domain/entities/Message.js';\nimport { Tool, ToolCall, ToolCallState, ToolResult } from '../../domain/entities/Tool.js';\nimport { ContentType, ToolResultContent } from '../../domain/entities/Content.js';\nimport { ToolTimeoutError } from '../../domain/errors/AIErrors.js';\nimport { ExecutionContext, HistoryMode } from './ExecutionContext.js';\nimport { HookManager } from './HookManager.js';\nimport { HookConfig } from './types/HookTypes.js';\nimport { AgenticLoopEvents } from './types/EventTypes.js';\nimport { StreamEvent, StreamEventType, isToolCallArgumentsDone } from '../../domain/entities/StreamEvent.js';\nimport { StreamState } from '../../domain/entities/StreamState.js';\n\nexport interface AgenticLoopConfig {\n  model: string;\n  input: string | InputItem[];\n  instructions?: string;\n  tools: Tool[];\n  temperature?: number;\n  maxIterations: number;\n\n  // NEW: Enterprise configuration\n  hooks?: HookConfig;\n  historyMode?: HistoryMode;\n  limits?: {\n    maxExecutionTime?: number;\n    maxToolCalls?: number;\n    maxContextSize?: number;\n    /** Maximum input messages to keep (prevents unbounded growth). Default: 50 */\n    maxInputMessages?: number;\n  };\n  errorHandling?: {\n    hookFailureMode?: 'fail' | 'warn' | 'ignore';\n    /**\n     * Tool failure handling mode:\n     * - 'fail': Stop execution on first tool failure (throw error)\n     * - 'continue': Execute all tools even if some fail, return all results including errors\n     * @default 'continue'\n     */\n    toolFailureMode?: 'fail' | 'continue';\n    maxConsecutiveErrors?: number;\n  };\n\n  /**\n   * Tool execution timeout in milliseconds\n   * @default 30000 (30 seconds)\n   */\n  toolTimeout?: number;\n}\n\nexport class AgenticLoop extends EventEmitter<AgenticLoopEvents> {\n  private hookManager: HookManager;\n  private context: ExecutionContext | null = null;\n\n  // Pause/resume state\n  private paused: boolean = false;\n  private pausePromise: Promise<void> | null = null;\n  private resumeCallback: (() => void) | null = null;\n  private cancelled: boolean = false;\n  // Mutex to prevent race conditions in pause/resume\n  private pauseResumeMutex: Promise<void> = Promise.resolve();\n\n  constructor(\n    private provider: ITextProvider,\n    private toolExecutor: IToolExecutor,\n    hookConfig?: HookConfig,\n    errorHandling?: { maxConsecutiveErrors?: number }\n  ) {\n    super();\n    this.hookManager = new HookManager(\n      hookConfig || {},\n      this,\n      errorHandling\n    );\n  }\n\n  /**\n   * Execute agentic loop with tool calling\n   */\n  async execute(config: AgenticLoopConfig): Promise<AgentResponse> {\n    // Generate execution ID\n    const executionId = `exec_${randomUUID()}`;\n\n    // Create execution context\n    this.context = new ExecutionContext(executionId, {\n      maxHistorySize: 10,\n      historyMode: config.historyMode || 'summary',\n      maxAuditTrailSize: 1000,\n    });\n\n    // Reset state\n    this.paused = false;\n    this.cancelled = false;\n\n    // Emit execution start\n    this.emit('execution:start', {\n      executionId,\n      config,\n      timestamp: new Date(),\n    });\n\n    // Execute before:execution hook\n    await this.hookManager.executeHooks('before:execution', {\n      executionId,\n      config,\n      timestamp: new Date(),\n    }, undefined as any);\n\n    let currentInput = config.input;\n    let iteration = 0;\n    let finalResponse: AgentResponse;\n\n    try {\n      while (iteration < config.maxIterations) {\n        // Check pause\n        await this.checkPause();\n\n        // Check if cancelled\n        if (this.cancelled) {\n          throw new Error('Execution cancelled');\n        }\n\n        // Check resource limits\n        this.context.checkLimits(config.limits);\n\n        // Check pause hook\n        const pauseCheck = await this.hookManager.executeHooks('pause:check', {\n          executionId,\n          iteration,\n          context: this.context,\n          timestamp: new Date(),\n        }, { shouldPause: false });\n\n        if (pauseCheck.shouldPause) {\n          this.pause(pauseCheck.reason || 'Hook requested pause');\n          await this.checkPause();\n        }\n\n        // Update iteration\n        this.context.iteration = iteration;\n\n        // Emit iteration start\n        this.emit('iteration:start', {\n          executionId,\n          iteration,\n          timestamp: new Date(),\n        });\n\n        const iterationStartTime = Date.now();\n\n        // Generate LLM response\n        const response = await this.generateWithHooks(config, currentInput, iteration, executionId);\n\n        // Extract tool calls\n        const toolCalls = this.extractToolCalls(response.output, config.tools);\n\n        // Emit tool detection\n        if (toolCalls.length > 0) {\n          this.emit('tool:detected', {\n            executionId,\n            iteration,\n            toolCalls,\n            timestamp: new Date(),\n          });\n        }\n\n        // If no tool calls, we're done\n        if (toolCalls.length === 0) {\n          // Emit iteration complete\n          this.emit('iteration:complete', {\n            executionId,\n            iteration,\n            response,\n            timestamp: new Date(),\n            duration: Date.now() - iterationStartTime,\n          });\n\n          finalResponse = response;\n          break;\n        }\n\n        // Execute tools with hooks\n        const toolResults = await this.executeToolsWithHooks(toolCalls, iteration, executionId, config);\n\n        // Store iteration record\n        this.context.addIteration({\n          iteration,\n          request: {\n            model: config.model,\n            input: currentInput,\n            instructions: config.instructions,\n            tools: config.tools,\n            temperature: config.temperature,\n          },\n          response,\n          toolCalls,\n          toolResults,\n          startTime: new Date(iterationStartTime),\n          endTime: new Date(),\n        });\n\n        // Update metrics\n        this.context.updateMetrics({\n          iterationCount: iteration + 1,\n          inputTokens: this.context.metrics.inputTokens + (response.usage?.input_tokens || 0),\n          outputTokens: this.context.metrics.outputTokens + (response.usage?.output_tokens || 0),\n          totalTokens: this.context.metrics.totalTokens + (response.usage?.total_tokens || 0),\n        });\n\n        // Emit iteration complete\n        this.emit('iteration:complete', {\n          executionId,\n          iteration,\n          response,\n          timestamp: new Date(),\n          duration: Date.now() - iterationStartTime,\n        });\n\n        // Build next input - append to existing context (preserve history)\n        const newMessages = this.buildNewMessages(response.output, toolResults);\n        currentInput = this.appendToContext(currentInput, newMessages);\n\n        // Apply sliding window to prevent unbounded input growth\n        const maxInputMessages = config.limits?.maxInputMessages ?? 50;\n        currentInput = this.applySlidingWindow(currentInput, maxInputMessages);\n\n        iteration++;\n      }\n\n      // Check if we exited normally or hit max iterations\n      if (iteration >= config.maxIterations) {\n        throw new Error(`Max iterations (${config.maxIterations}) reached without completion`);\n      }\n\n      // Calculate total duration\n      const totalDuration = Date.now() - this.context.startTime.getTime();\n      this.context.updateMetrics({ totalDuration });\n\n      // Execute after:execution hook\n      await this.hookManager.executeHooks('after:execution', {\n        executionId,\n        response: finalResponse!,\n        context: this.context,\n        timestamp: new Date(),\n        duration: totalDuration,\n      }, undefined as any);\n\n      // Emit execution complete\n      this.emit('execution:complete', {\n        executionId,\n        response: finalResponse!,\n        timestamp: new Date(),\n        duration: totalDuration,\n      });\n\n      return finalResponse!;\n    } catch (error) {\n      // Emit execution error\n      this.emit('execution:error', {\n        executionId,\n        error: error as Error,\n        timestamp: new Date(),\n      });\n\n      // Record error in metrics\n      this.context?.metrics.errors.push({\n        type: 'execution_error',\n        message: (error as Error).message,\n        timestamp: new Date(),\n      });\n\n      throw error;\n    } finally {\n      // Always cleanup resources\n      this.context?.cleanup();\n      this.hookManager.clear();\n    }\n  }\n\n  /**\n   * Execute agentic loop with streaming and tool calling\n   */\n  async *executeStreaming(config: AgenticLoopConfig): AsyncIterableIterator<StreamEvent> {\n    // Generate execution ID\n    const executionId = `exec_${randomUUID()}`;\n\n    // Create execution context\n    this.context = new ExecutionContext(executionId, {\n      maxHistorySize: 10,\n      historyMode: config.historyMode || 'summary',\n      maxAuditTrailSize: 1000,\n    });\n\n    // Reset state\n    this.paused = false;\n    this.cancelled = false;\n    this.pausePromise = null;\n    this.resumeCallback = null;\n\n    const startTime = Date.now();\n    let iteration = 0;\n    let currentInput: string | InputItem[] = config.input;\n\n    // Create a single StreamState for the entire execution (tracks usage across iterations)\n    const globalStreamState = new StreamState(executionId, config.model);\n\n    try {\n      // Emit execution start event\n      this.emit('execution:start', {\n        executionId,\n        model: config.model,\n        timestamp: new Date(),\n      });\n\n      // Execute before:execution hook\n      await this.hookManager.executeHooks('before:execution', {\n        executionId,\n        config,\n        timestamp: new Date(),\n      }, undefined as any);\n\n      // Main agentic loop\n      while (iteration < config.maxIterations) {\n        iteration++;\n\n        // Check pause state\n        await this.checkPause();\n\n        // Check if cancelled\n        if (this.cancelled) {\n          this.emit('execution:cancelled', { executionId, iteration, timestamp: new Date() });\n          break;\n        }\n\n        // Check resource limits\n        if (this.context) {\n          this.context.checkLimits(config.limits);\n        }\n\n        // Execute pause:check hook (allows dynamic pause decisions)\n        const pauseCheck = await this.hookManager.executeHooks('pause:check', {\n          executionId,\n          iteration,\n          context: this.context!,\n          timestamp: new Date(),\n        }, { shouldPause: false });\n\n        if (pauseCheck.shouldPause) {\n          this.pause();\n        }\n\n        // Emit iteration start\n        this.emit('iteration:start', {\n          executionId,\n          iteration,\n          timestamp: new Date(),\n        });\n\n        // Stream LLM response and accumulate state (per-iteration state)\n        const iterationStreamState = new StreamState(executionId, config.model);\n        const toolCallsMap = new Map<string, { name: string; args: string }>();\n\n        // Stream from provider with hooks\n        yield* this.streamGenerateWithHooks(config, currentInput, iteration, executionId, iterationStreamState, toolCallsMap);\n\n        // Accumulate usage from this iteration into global state\n        globalStreamState.accumulateUsage(iterationStreamState.usage);\n\n        // Check if any tool calls were detected\n        const toolCalls: ToolCall[] = [];\n        for (const [toolCallId, buffer] of toolCallsMap) {\n          toolCalls.push({\n            id: toolCallId,\n            type: 'function',\n            function: {\n              name: buffer.name,\n              arguments: buffer.args,\n            },\n            blocking: true,\n            state: ToolCallState.PENDING,\n          });\n        }\n\n        // No tool calls? We're done\n        if (toolCalls.length === 0) {\n          // Yield iteration complete\n          yield {\n            type: StreamEventType.ITERATION_COMPLETE,\n            response_id: executionId,\n            iteration,\n            tool_calls_count: 0,\n            has_more_iterations: false,\n          };\n\n          // Final response complete with accumulated usage from all iterations\n          yield {\n            type: StreamEventType.RESPONSE_COMPLETE,\n            response_id: executionId,\n            status: 'completed',\n            usage: globalStreamState.usage,\n            iterations: iteration,\n            duration_ms: Date.now() - startTime,\n          };\n\n          break;\n        }\n\n        // Execute tools and yield execution events\n        const toolResults: ToolResult[] = [];\n\n        for (const toolCall of toolCalls) {\n          // Parse and validate arguments\n          let parsedArgs: any;\n          try {\n            parsedArgs = JSON.parse(toolCall.function.arguments);\n          } catch (error) {\n            // Invalid JSON - skip this tool\n            yield {\n              type: StreamEventType.TOOL_EXECUTION_DONE,\n              response_id: executionId,\n              tool_call_id: toolCall.id,\n              tool_name: toolCall.function.name,\n              result: null,\n              execution_time_ms: 0,\n              error: `Invalid tool arguments JSON: ${(error as Error).message}`,\n            };\n            continue;\n          }\n\n          // Emit tool execution start\n          yield {\n            type: StreamEventType.TOOL_EXECUTION_START,\n            response_id: executionId,\n            tool_call_id: toolCall.id,\n            tool_name: toolCall.function.name,\n            arguments: parsedArgs,\n          };\n\n          const toolStartTime = Date.now();\n\n          try {\n            // Execute tool with hooks\n            const result = await this.executeToolWithHooks(toolCall, iteration, executionId, config);\n            toolResults.push(result);\n\n            // Emit tool execution done\n            yield {\n              type: StreamEventType.TOOL_EXECUTION_DONE,\n              response_id: executionId,\n              tool_call_id: toolCall.id,\n              tool_name: toolCall.function.name,\n              result: result.content,\n              execution_time_ms: Date.now() - toolStartTime,\n            };\n          } catch (error) {\n            // Emit tool execution error\n            yield {\n              type: StreamEventType.TOOL_EXECUTION_DONE,\n              response_id: executionId,\n              tool_call_id: toolCall.id,\n              tool_name: toolCall.function.name,\n              result: null,\n              execution_time_ms: Date.now() - toolStartTime,\n              error: (error as Error).message,\n            };\n\n            // Check tool failure mode - unified with execute() behavior\n            const failureMode = config.errorHandling?.toolFailureMode || 'continue';\n            if (failureMode === 'fail') {\n              throw error; // Fail-fast mode: stop execution on first tool failure\n            }\n\n            // Continue mode (default): Add error result and continue with remaining tools\n            toolResults.push({\n              tool_use_id: toolCall.id,\n              content: '',\n              error: (error as Error).message,\n              state: ToolCallState.FAILED,\n            });\n          }\n        }\n\n        // Build next input with tool results (streaming constructs messages from StreamState)\n        const assistantMessage: InputItem = {\n          type: 'message',\n          role: MessageRole.ASSISTANT,\n          content: [\n            {\n              type: ContentType.OUTPUT_TEXT,\n              text: iterationStreamState.getAllText(),\n            },\n            ...toolCalls.map((tc) => ({\n              type: ContentType.TOOL_USE as const,\n              id: tc.id,\n              name: tc.function.name,\n              arguments: tc.function.arguments,\n            })),\n          ],\n        };\n\n        const toolResultsMessage: InputItem = {\n          type: 'message',\n          role: MessageRole.USER,\n          content: toolResults.map((tr) => ({\n            type: ContentType.TOOL_RESULT as const,\n            tool_use_id: tr.tool_use_id,\n            content: tr.content,\n            error: tr.error,\n          })),\n        };\n\n        // Update current input for next iteration using shared methods\n        const newMessages: InputItem[] = [assistantMessage, toolResultsMessage];\n        currentInput = this.appendToContext(currentInput, newMessages);\n\n        // Apply sliding window to prevent unbounded input growth\n        const maxInputMessages = config.limits?.maxInputMessages ?? 50;\n        currentInput = this.applySlidingWindow(currentInput, maxInputMessages);\n\n        // Yield iteration complete\n        yield {\n          type: StreamEventType.ITERATION_COMPLETE,\n          response_id: executionId,\n          iteration,\n          tool_calls_count: toolCalls.length,\n          has_more_iterations: true,\n        };\n\n        // Store iteration in context\n        if (this.context) {\n          globalStreamState.incrementIteration();\n        }\n\n        // Clear per-iteration resources to prevent memory accumulation\n        iterationStreamState.clear();\n        toolCallsMap.clear();\n      }\n\n      // If loop ended due to max iterations (not early break), emit final completion\n      if (iteration >= config.maxIterations) {\n        yield {\n          type: StreamEventType.RESPONSE_COMPLETE,\n          response_id: executionId,\n          status: 'incomplete', // Incomplete because we hit max iterations\n          usage: globalStreamState.usage,\n          iterations: iteration,\n          duration_ms: Date.now() - startTime,\n        };\n      }\n\n      // Execute after:execution hook\n      await this.hookManager.executeHooks('after:execution', {\n        executionId,\n        response: null as any, // We don't have a complete response in streaming\n        context: this.context,\n        timestamp: new Date(),\n        duration: Date.now() - startTime,\n      }, undefined as any);\n\n      // Emit execution complete\n      this.emit('execution:complete', {\n        executionId,\n        iterations: iteration,\n        duration: Date.now() - startTime,\n        timestamp: new Date(),\n      });\n    } catch (error) {\n      // Emit execution error\n      this.emit('execution:error', {\n        executionId,\n        error: error as Error,\n        timestamp: new Date(),\n      });\n\n      // Yield error event\n      yield {\n        type: StreamEventType.ERROR,\n        response_id: executionId,\n        error: {\n          type: 'execution_error',\n          message: (error as Error).message,\n        },\n        recoverable: false,\n      };\n\n      throw error;\n    } finally {\n      // Always cleanup resources\n      globalStreamState.clear();\n      this.context?.cleanup();\n      this.hookManager.clear();\n    }\n  }\n\n  /**\n   * Stream LLM response with hooks\n   * @private\n   */\n  private async *streamGenerateWithHooks(\n    config: AgenticLoopConfig,\n    input: string | InputItem[],\n    iteration: number,\n    executionId: string,\n    streamState: StreamState,\n    toolCallsMap: Map<string, { name: string; args: string }>\n  ): AsyncIterableIterator<StreamEvent> {\n    const llmStartTime = Date.now();\n\n    // Prepare options\n    let generateOptions: TextGenerateOptions = {\n      model: config.model,\n      input,\n      instructions: config.instructions,\n      tools: config.tools,\n      tool_choice: 'auto',\n      temperature: config.temperature,\n    };\n\n    // Execute before:llm hook\n    await this.hookManager.executeHooks('before:llm', {\n      executionId,\n      iteration,\n      options: generateOptions,\n      context: this.context!,\n      timestamp: new Date(),\n    }, {});\n\n    // Emit LLM request event\n    this.emit('llm:request', {\n      executionId,\n      iteration,\n      model: config.model,\n      timestamp: new Date(),\n    });\n\n    try {\n      // Stream from provider\n      for await (const event of this.provider.streamGenerate(generateOptions)) {\n        // Update stream state based on event\n        if (event.type === StreamEventType.OUTPUT_TEXT_DELTA) {\n          streamState.accumulateTextDelta(event.item_id, event.delta);\n        } else if (event.type === StreamEventType.TOOL_CALL_START) {\n          streamState.startToolCall(event.tool_call_id, event.tool_name);\n          toolCallsMap.set(event.tool_call_id, { name: event.tool_name, args: '' });\n        } else if (event.type === StreamEventType.TOOL_CALL_ARGUMENTS_DELTA) {\n          streamState.accumulateToolArguments(event.tool_call_id, event.delta);\n          const buffer = toolCallsMap.get(event.tool_call_id);\n          if (buffer) {\n            buffer.args += event.delta;\n          }\n        } else if (isToolCallArgumentsDone(event)) {\n          streamState.completeToolCall(event.tool_call_id);\n          const buffer = toolCallsMap.get(event.tool_call_id);\n          if (buffer) {\n            buffer.args = event.arguments;\n          }\n        } else if (event.type === StreamEventType.RESPONSE_COMPLETE) {\n          streamState.updateUsage(event.usage);\n\n          if (process.env.DEBUG_STREAMING) {\n            console.error('[DEBUG] Captured usage from provider:', event.usage);\n            console.error('[DEBUG] StreamState usage after update:', streamState.usage);\n          }\n\n          // Don't yield provider's RESPONSE_COMPLETE - we'll emit our own at the end\n          continue;\n        }\n\n        // Yield event to caller (except RESPONSE_COMPLETE which we handle ourselves)\n        yield event;\n      }\n\n      // Update metrics\n      if (this.context) {\n        this.context.metrics.llmDuration += Date.now() - llmStartTime;\n        this.context.metrics.inputTokens += streamState.usage.input_tokens;\n        this.context.metrics.outputTokens += streamState.usage.output_tokens;\n        this.context.metrics.totalTokens += streamState.usage.total_tokens;\n      }\n\n      if (process.env.DEBUG_STREAMING) {\n        console.error('[DEBUG] Stream iteration complete, usage:', streamState.usage);\n      }\n\n      // Execute after:llm hook\n      await this.hookManager.executeHooks('after:llm', {\n        executionId,\n        iteration,\n        response: null as any, // Streaming doesn't have complete response yet\n        context: this.context!,\n        timestamp: new Date(),\n        duration: Date.now() - llmStartTime,\n      }, {});\n\n      // Emit LLM response event\n      this.emit('llm:response', {\n        executionId,\n        iteration,\n        timestamp: new Date(),\n      });\n    } catch (error) {\n      this.emit('llm:error', {\n        executionId,\n        iteration,\n        error: error as Error,\n        timestamp: new Date(),\n      });\n      throw error;\n    }\n  }\n\n  /**\n   * Execute single tool with hooks\n   * @private\n   */\n  private async executeToolWithHooks(\n    toolCall: ToolCall,\n    iteration: number,\n    executionId: string,\n    config: AgenticLoopConfig\n  ): Promise<ToolResult> {\n    const toolStartTime = Date.now();\n\n    toolCall.state = ToolCallState.EXECUTING;\n    toolCall.startTime = new Date();\n\n    // Execute before:tool hook\n    await this.hookManager.executeHooks('before:tool', {\n      executionId,\n      iteration,\n      toolCall,\n      context: this.context!,\n      timestamp: new Date(),\n    }, {});\n\n    // Execute approve:tool hook if registered\n    if (this.hookManager.hasHooks('approve:tool')) {\n      const approval = await this.hookManager.executeHooks('approve:tool', {\n        executionId,\n        iteration,\n        toolCall,\n        context: this.context!,\n        timestamp: new Date(),\n      }, { approved: true });\n\n      if (!approval.approved) {\n        throw new Error(`Tool execution rejected: ${approval.reason || 'No reason provided'}`);\n      }\n    }\n\n    // Emit tool start\n    this.emit('tool:start', {\n      executionId,\n      iteration,\n      toolCall,\n      timestamp: new Date(),\n    });\n\n    try {\n      // Execute tool with timeout (configurable)\n      const args = JSON.parse(toolCall.function.arguments);\n      const result = await this.executeWithTimeout(\n        () => this.toolExecutor.execute(toolCall.function.name, args),\n        config.toolTimeout ?? 30000\n      );\n\n      // Create tool result\n      const toolResult: ToolResult = {\n        tool_use_id: toolCall.id,\n        content: result,\n        executionTime: Date.now() - toolStartTime,\n        state: ToolCallState.COMPLETED,\n      };\n\n      toolCall.state = ToolCallState.COMPLETED;\n      toolCall.endTime = new Date();\n\n      // Execute after:tool hook\n      await this.hookManager.executeHooks('after:tool', {\n        executionId,\n        iteration,\n        toolCall,\n        result: toolResult,\n        context: this.context!,\n        timestamp: new Date(),\n      }, {});\n\n      // Update metrics\n      if (this.context) {\n        this.context.metrics.toolCallCount++;\n        this.context.metrics.toolSuccessCount++;\n        this.context.metrics.toolDuration += toolResult.executionTime || 0;\n      }\n\n      // Emit tool complete\n      this.emit('tool:complete', {\n        executionId,\n        iteration,\n        toolCall,\n        result: toolResult,\n        timestamp: new Date(),\n      });\n\n      return toolResult;\n    } catch (error) {\n      toolCall.state = ToolCallState.FAILED;\n      toolCall.endTime = new Date();\n      toolCall.error = (error as Error).message;\n\n      // Update metrics\n      if (this.context) {\n        this.context.metrics.toolFailureCount++;\n      }\n\n      // Emit tool error\n      this.emit('tool:error', {\n        executionId,\n        iteration,\n        toolCall,\n        error: error as Error,\n        timestamp: new Date(),\n      });\n\n      throw error;\n    }\n  }\n\n  /**\n   * Generate LLM response with hooks\n   */\n  private async generateWithHooks(\n    config: AgenticLoopConfig,\n    input: string | InputItem[],\n    iteration: number,\n    executionId: string\n  ): Promise<AgentResponse> {\n    const llmStartTime = Date.now();\n\n    // Prepare options\n    let generateOptions: TextGenerateOptions = {\n      model: config.model,\n      input,\n      instructions: config.instructions,\n      tools: config.tools,\n      tool_choice: 'auto',\n      temperature: config.temperature,\n    };\n\n    // Execute before:llm hook\n    const beforeLLM = await this.hookManager.executeHooks('before:llm', {\n      executionId,\n      iteration,\n      options: generateOptions,\n      context: this.context!,\n      timestamp: new Date(),\n    }, {});\n\n    // Apply modifications\n    if (beforeLLM.modified) {\n      generateOptions = { ...generateOptions, ...beforeLLM.modified };\n    }\n\n    // Skip if requested\n    if (beforeLLM.skip) {\n      throw new Error('LLM call skipped by hook');\n    }\n\n    // Emit LLM request\n    this.emit('llm:request', {\n      executionId,\n      iteration,\n      options: generateOptions,\n      timestamp: new Date(),\n    });\n\n    try {\n      // Call provider\n      const response = await this.provider.generate(generateOptions);\n\n      const llmDuration = Date.now() - llmStartTime;\n\n      // Update metrics\n      this.context?.updateMetrics({\n        llmDuration: (this.context.metrics.llmDuration || 0) + llmDuration,\n      });\n\n      // Emit LLM response\n      this.emit('llm:response', {\n        executionId,\n        iteration,\n        response,\n        timestamp: new Date(),\n        duration: llmDuration,\n      });\n\n      // Execute after:llm hook\n      await this.hookManager.executeHooks('after:llm', {\n        executionId,\n        iteration,\n        response,\n        context: this.context!,\n        timestamp: new Date(),\n        duration: llmDuration,\n      }, {});\n\n      return response;\n    } catch (error) {\n      // Emit LLM error\n      this.emit('llm:error', {\n        executionId,\n        iteration,\n        error: error as Error,\n        timestamp: new Date(),\n      });\n\n      throw error;\n    }\n  }\n\n  /**\n   * Execute tools with hooks\n   */\n  private async executeToolsWithHooks(\n    toolCalls: ToolCall[],\n    iteration: number,\n    executionId: string,\n    config: AgenticLoopConfig\n  ): Promise<ToolResult[]> {\n    const results: ToolResult[] = [];\n\n    for (const toolCall of toolCalls) {\n      // Add to context\n      this.context?.addToolCall(toolCall);\n\n      // Check pause before each tool\n      await this.checkPause();\n\n      // Execute before:tool hook\n      const beforeTool = await this.hookManager.executeHooks('before:tool', {\n        executionId,\n        iteration,\n        toolCall,\n        context: this.context!,\n        timestamp: new Date(),\n      }, {});\n\n      // Check if tool should be skipped\n      if (beforeTool.skip) {\n        this.context?.audit('tool_skipped', { toolCall }, undefined, toolCall.function.name);\n\n        const mockResult: ToolResult = {\n          tool_use_id: toolCall.id,\n          content: beforeTool.mockResult || '',\n          state: ToolCallState.COMPLETED,\n          executionTime: 0,\n        };\n\n        results.push(mockResult);\n        this.context?.addToolResult(mockResult);\n        continue;\n      }\n\n      // Apply modifications if any\n      if (beforeTool.modified) {\n        Object.assign(toolCall, beforeTool.modified);\n        this.context?.audit('tool_modified', { modifications: beforeTool.modified }, undefined, toolCall.function.name);\n      }\n\n      // Execute approve:tool hook (if exists)\n      if (this.hookManager.hasHooks('approve:tool')) {\n        const approval = await this.hookManager.executeHooks('approve:tool', {\n          executionId,\n          iteration,\n          toolCall,\n          context: this.context!,\n          timestamp: new Date(),\n        }, { approved: true });\n\n        if (!approval.approved) {\n          this.context?.audit('tool_rejected', { reason: approval.reason }, undefined, toolCall.function.name);\n\n          const rejectedResult: ToolResult = {\n            tool_use_id: toolCall.id,\n            content: '',\n            error: `Tool rejected: ${approval.reason || 'Not approved'}`,\n            state: ToolCallState.FAILED,\n          };\n\n          results.push(rejectedResult);\n          this.context?.addToolResult(rejectedResult);\n          continue;\n        }\n\n        this.context?.audit('tool_approved', { reason: approval.reason }, undefined, toolCall.function.name);\n      }\n\n      // Execute tool\n      toolCall.state = ToolCallState.EXECUTING;\n      toolCall.startTime = new Date();\n\n      // Emit tool start\n      this.emit('tool:start', {\n        executionId,\n        iteration,\n        toolCall,\n        timestamp: new Date(),\n      });\n\n      const toolStartTime = Date.now();\n\n      try {\n        // Execute with timeout (configurable)\n        const timeout = config.toolTimeout ?? 30000;\n        const result = await this.executeWithTimeout(\n          () => this.toolExecutor.execute(\n            toolCall.function.name,\n            JSON.parse(toolCall.function.arguments)\n          ),\n          timeout\n        );\n\n        toolCall.state = ToolCallState.COMPLETED;\n        toolCall.endTime = new Date();\n\n        let toolResult: ToolResult = {\n          tool_use_id: toolCall.id,\n          content: result,\n          state: ToolCallState.COMPLETED,\n          executionTime: Date.now() - toolStartTime,\n        };\n\n        // Execute after:tool hook\n        const afterTool = await this.hookManager.executeHooks('after:tool', {\n          executionId,\n          iteration,\n          toolCall,\n          result: toolResult,\n          context: this.context!,\n          timestamp: new Date(),\n        }, {});\n\n        // Apply result modifications\n        if (afterTool.modified) {\n          toolResult = { ...toolResult, ...afterTool.modified };\n        }\n\n        results.push(toolResult);\n        this.context?.addToolResult(toolResult);\n\n        // Update metrics\n        this.context?.updateMetrics({\n          toolDuration: (this.context.metrics.toolDuration || 0) + toolResult.executionTime!,\n        });\n\n        // Emit tool complete\n        this.emit('tool:complete', {\n          executionId,\n          iteration,\n          toolCall,\n          result: toolResult,\n          timestamp: new Date(),\n        });\n      } catch (error) {\n        toolCall.state = ToolCallState.FAILED;\n        toolCall.endTime = new Date();\n        toolCall.error = (error as Error).message;\n\n        const toolResult: ToolResult = {\n          tool_use_id: toolCall.id,\n          content: '',\n          error: (error as Error).message,\n          state: ToolCallState.FAILED,\n        };\n\n        results.push(toolResult);\n        this.context?.addToolResult(toolResult);\n\n        // Record error\n        this.context?.metrics.errors.push({\n          type: 'tool_error',\n          message: (error as Error).message,\n          timestamp: new Date(),\n        });\n\n        // Emit tool error or timeout\n        if (error instanceof ToolTimeoutError) {\n          this.emit('tool:timeout', {\n            executionId,\n            iteration,\n            toolCall,\n            timeout: config.toolTimeout ?? 30000,\n            timestamp: new Date(),\n          });\n        } else {\n          this.emit('tool:error', {\n            executionId,\n            iteration,\n            toolCall,\n            error: error as Error,\n            timestamp: new Date(),\n          });\n        }\n\n        // Check tool failure mode\n        const failureMode = config.errorHandling?.toolFailureMode || 'continue';\n        if (failureMode === 'fail') {\n          // Fail-fast mode: stop execution on first tool failure\n          throw error;\n        }\n\n        // Continue mode (default): Continue executing remaining tools\n        // Error already added to results above\n      }\n    }\n\n    return results;\n  }\n\n  /**\n   * Extract tool calls from response output\n   */\n  private extractToolCalls(output: OutputItem[], toolDefinitions: Tool[]): ToolCall[] {\n    const toolCalls: ToolCall[] = [];\n\n    // Create tool map for quick lookup\n    const toolMap = new Map<string, Tool>();\n    for (const tool of toolDefinitions) {\n      if (tool.type === 'function') {\n        toolMap.set(tool.function.name, tool);\n      }\n    }\n\n    // Extract tool calls from output\n    for (const item of output) {\n      if (item.type === 'message' && item.role === MessageRole.ASSISTANT) {\n        for (const content of item.content) {\n          if (content.type === ContentType.TOOL_USE) {\n            const toolDef = toolMap.get(content.name);\n            const isBlocking = toolDef?.blocking !== false;\n\n            const toolCall: ToolCall = {\n              id: content.id,\n              type: 'function',\n              function: {\n                name: content.name,\n                arguments: content.arguments,\n              },\n              blocking: isBlocking,\n              state: ToolCallState.PENDING,\n            };\n\n            toolCalls.push(toolCall);\n          }\n        }\n      }\n    }\n\n    return toolCalls;\n  }\n\n  /**\n   * Execute function with timeout\n   */\n  private async executeWithTimeout<T>(fn: () => Promise<T>, timeoutMs: number): Promise<T> {\n    return new Promise((resolve, reject) => {\n      const timer = setTimeout(() => {\n        reject(new ToolTimeoutError('tool', timeoutMs));\n      }, timeoutMs);\n\n      fn()\n        .then((result) => {\n          clearTimeout(timer);\n          resolve(result);\n        })\n        .catch((error) => {\n          clearTimeout(timer);\n          reject(error);\n        });\n    });\n  }\n\n  // ============ Shared Helper Methods ============\n  // These methods provide unified logic for both execute() and executeStreaming()\n\n  /**\n   * Build new messages from tool results (assistant response + tool results)\n   */\n  private buildNewMessages(\n    previousOutput: OutputItem[],\n    toolResults: ToolResult[]\n  ): InputItem[] {\n    const messages: InputItem[] = [];\n\n    // Add assistant's previous response as input\n    for (const item of previousOutput) {\n      if (item.type === 'message') {\n        messages.push(item);\n      }\n    }\n\n    // Add tool results as user message\n    const toolResultContents: ToolResultContent[] = toolResults.map((result) => ({\n      type: ContentType.TOOL_RESULT,\n      tool_use_id: result.tool_use_id,\n      content: result.content,\n      error: result.error,\n    }));\n\n    if (toolResultContents.length > 0) {\n      messages.push({\n        type: 'message',\n        role: MessageRole.USER,\n        content: toolResultContents,\n      });\n    }\n\n    return messages;\n  }\n\n  /**\n   * Append new messages to current context, preserving history\n   * Unified logic for both execute() and executeStreaming()\n   */\n  private appendToContext(\n    currentInput: string | InputItem[],\n    newMessages: InputItem[]\n  ): InputItem[] {\n    if (Array.isArray(currentInput)) {\n      return [...currentInput, ...newMessages];\n    }\n\n    // First iteration - convert string input to array format\n    return [\n      {\n        type: 'message' as const,\n        role: MessageRole.USER,\n        content: [{ type: ContentType.INPUT_TEXT, text: currentInput }],\n      },\n      ...newMessages,\n    ];\n  }\n\n  /**\n   * Apply sliding window to prevent unbounded input growth\n   * Preserves system/developer message at the start if present\n   * IMPORTANT: Ensures tool_use and tool_result pairs are never broken\n   */\n  private applySlidingWindow(\n    input: InputItem[],\n    maxMessages: number = 50\n  ): InputItem[] {\n    if (input.length <= maxMessages) {\n      return input;\n    }\n\n    // Check if first message is a developer/system message\n    const firstMessage = input[0];\n    const isSystemMessage = firstMessage?.type === 'message' &&\n      firstMessage.role === MessageRole.DEVELOPER;\n\n    // Calculate how many messages we can keep (excluding system message if present)\n    const maxToKeep = isSystemMessage ? maxMessages - 1 : maxMessages;\n\n    // Find a safe cut point that doesn't break tool call/result pairs\n    const safeCutIndex = this.findSafeToolBoundary(input, input.length - maxToKeep);\n\n    // Slice from safe cut point to end\n    const recentMessages = input.slice(safeCutIndex);\n\n    if (isSystemMessage) {\n      return [firstMessage, ...recentMessages];\n    }\n\n    return recentMessages;\n  }\n\n  /**\n   * Find a safe index to cut the message array without breaking tool call/result pairs\n   * A safe boundary is one where all tool_use IDs have matching tool_result IDs\n   */\n  private findSafeToolBoundary(input: InputItem[], targetIndex: number): number {\n    // Ensure we don't go below 0 or above the array length\n    let cutIndex = Math.max(0, Math.min(targetIndex, input.length - 1));\n\n    // Start from targetIndex and search forward for a safe boundary\n    // A safe boundary is where we don't have orphaned tool calls or results\n    while (cutIndex < input.length - 1) {\n      if (this.isToolBoundarySafe(input, cutIndex)) {\n        return cutIndex;\n      }\n      cutIndex++;\n    }\n\n    // If no safe boundary found going forward, try going backward\n    cutIndex = Math.max(0, targetIndex);\n    while (cutIndex > 0) {\n      if (this.isToolBoundarySafe(input, cutIndex)) {\n        return cutIndex;\n      }\n      cutIndex--;\n    }\n\n    // Fallback: return original target (may cause issues but better than infinite loop)\n    return Math.max(0, targetIndex);\n  }\n\n  /**\n   * Check if cutting at this index would leave tool calls/results balanced\n   * Returns true if all tool_use IDs in the slice have matching tool_result IDs\n   */\n  private isToolBoundarySafe(input: InputItem[], startIndex: number): boolean {\n    const slicedMessages = input.slice(startIndex);\n\n    // Collect all tool_use IDs and tool_result IDs in the slice\n    const toolUseIds = new Set<string>();\n    const toolResultIds = new Set<string>();\n\n    for (const item of slicedMessages) {\n      if (item.type !== 'message') continue;\n\n      for (const content of item.content) {\n        if (content.type === ContentType.TOOL_USE) {\n          toolUseIds.add(content.id);\n        } else if (content.type === ContentType.TOOL_RESULT) {\n          toolResultIds.add(content.tool_use_id);\n        }\n      }\n    }\n\n    // Check 1: Every tool_result must have a matching tool_use\n    // (tool_result without tool_use = API error)\n    for (const resultId of toolResultIds) {\n      if (!toolUseIds.has(resultId)) {\n        return false;\n      }\n    }\n\n    // Check 2: Every tool_use should have a matching tool_result\n    // (tool_use without tool_result = incomplete, but less critical for some APIs)\n    // However, for safety, we enforce this too\n    for (const useId of toolUseIds) {\n      if (!toolResultIds.has(useId)) {\n        // Exception: the LAST assistant message may have tool_use without result yet\n        // This is only safe if it's the very last message (current iteration)\n        const lastMessage = slicedMessages[slicedMessages.length - 1];\n        const isLastMessageWithThisToolUse =\n          lastMessage?.type === 'message' &&\n          lastMessage.role === MessageRole.ASSISTANT &&\n          lastMessage.content.some(\n            (c: any) => c.type === ContentType.TOOL_USE && c.id === useId\n          );\n\n        if (!isLastMessageWithThisToolUse) {\n          return false;\n        }\n      }\n    }\n\n    return true;\n  }\n\n\n  /**\n   * Pause execution (thread-safe with mutex)\n   */\n  pause(reason?: string): void {\n    // Chain onto the mutex to ensure serialized access\n    this.pauseResumeMutex = this.pauseResumeMutex.then(() => {\n      this._doPause(reason);\n    });\n  }\n\n  /**\n   * Internal pause implementation\n   */\n  private _doPause(reason?: string): void {\n    if (this.paused) return;\n\n    this.paused = true;\n    this.pausePromise = new Promise((resolve) => {\n      this.resumeCallback = resolve;\n    });\n\n    if (this.context) {\n      this.context.paused = true;\n      this.context.pauseReason = reason;\n      this.context.audit('execution_paused', { reason });\n    }\n\n    this.emit('execution:paused', {\n      executionId: this.context?.executionId || 'unknown',\n      reason: reason || 'Manual pause',\n      timestamp: new Date(),\n    });\n  }\n\n  /**\n   * Resume execution (thread-safe with mutex)\n   */\n  resume(): void {\n    // Chain onto the mutex to ensure serialized access\n    this.pauseResumeMutex = this.pauseResumeMutex.then(() => {\n      this._doResume();\n    });\n  }\n\n  /**\n   * Internal resume implementation\n   */\n  private _doResume(): void {\n    if (!this.paused) return;\n\n    this.paused = false;\n\n    if (this.context) {\n      this.context.paused = false;\n      this.context.pauseReason = undefined;\n      this.context.audit('execution_resumed', {});\n    }\n\n    if (this.resumeCallback) {\n      this.resumeCallback();\n      this.resumeCallback = null;\n    }\n\n    this.pausePromise = null;\n\n    this.emit('execution:resumed', {\n      executionId: this.context?.executionId || 'unknown',\n      timestamp: new Date(),\n    });\n  }\n\n  /**\n   * Cancel execution\n   */\n  cancel(reason?: string): void {\n    this.cancelled = true;\n\n    if (this.context) {\n      this.context.cancelled = true;\n      this.context.cancelReason = reason;\n    }\n\n    // Resume if paused (to allow cancellation to proceed)\n    // Use internal method directly to bypass mutex for immediate cancellation\n    if (this.paused) {\n      this._doResume();\n    }\n\n    this.emit('execution:cancelled', {\n      executionId: this.context?.executionId || 'unknown',\n      reason: reason || 'Manual cancellation',\n      timestamp: new Date(),\n    });\n  }\n\n  /**\n   * Check if paused and wait\n   */\n  private async checkPause(): Promise<void> {\n    if (this.paused && this.pausePromise) {\n      await this.pausePromise;\n    }\n  }\n\n  /**\n   * Get current execution context\n   */\n  getContext(): ExecutionContext | null {\n    return this.context;\n  }\n\n  /**\n   * Check if currently executing\n   */\n  isRunning(): boolean {\n    return this.context !== null && !this.cancelled;\n  }\n\n  /**\n   * Check if paused\n   */\n  isPaused(): boolean {\n    return this.paused;\n  }\n\n  /**\n   * Check if cancelled\n   */\n  isCancelled(): boolean {\n    return this.cancelled;\n  }\n}\n","/**\n * Interface for objects that manage resources and need explicit cleanup.\n *\n * Implementing classes should release all resources (event listeners, timers,\n * connections, etc.) when destroy() is called. After destruction, the instance\n * should not be used.\n */\n\nexport interface IDisposable {\n  /**\n   * Releases all resources held by this instance.\n   *\n   * After calling destroy():\n   * - All event listeners should be removed\n   * - All timers/intervals should be cleared\n   * - All internal state should be cleaned up\n   * - The instance should not be reused\n   *\n   * Multiple calls to destroy() should be safe (idempotent).\n   */\n  destroy(): void;\n\n  /**\n   * Returns true if destroy() has been called.\n   * Methods should check this before performing operations.\n   */\n  readonly isDestroyed: boolean;\n}\n\n/**\n * Async version of IDisposable for resources requiring async cleanup.\n */\nexport interface IAsyncDisposable {\n  /**\n   * Asynchronously releases all resources held by this instance.\n   */\n  destroy(): Promise<void>;\n\n  /**\n   * Returns true if destroy() has been called.\n   */\n  readonly isDestroyed: boolean;\n}\n\n/**\n * Helper to check if an object is destroyed and throw if so.\n * @param obj - The disposable object to check\n * @param operation - Name of the operation being attempted\n */\nexport function assertNotDestroyed(obj: IDisposable | IAsyncDisposable, operation: string): void {\n  if (obj.isDestroyed) {\n    throw new Error(`Cannot ${operation}: instance has been destroyed`);\n  }\n}\n","/**\n * Agent - AI assistant bound to a Connector\n *\n * This is the main public API for creating and using agents.\n * Replaces the old OneRingAI  AgentManager  Agent flow.\n */\n\nimport { EventEmitter } from 'eventemitter3';\nimport { Connector } from './Connector.js';\nimport { createProvider } from './createProvider.js';\nimport { ToolManager } from './ToolManager.js';\nimport { SessionManager, Session, ISessionStorage } from './SessionManager.js';\nimport { ToolRegistry } from '../capabilities/agents/ToolRegistry.js';\nimport { AgenticLoop, AgenticLoopConfig } from '../capabilities/agents/AgenticLoop.js';\nimport { ExecutionContext, HistoryMode } from '../capabilities/agents/ExecutionContext.js';\nimport { ToolFunction } from '../domain/entities/Tool.js';\nimport { InputItem } from '../domain/entities/Message.js';\nimport { AgentResponse } from '../domain/entities/Response.js';\nimport { StreamEvent } from '../domain/entities/StreamEvent.js';\nimport { HookConfig } from '../capabilities/agents/types/HookTypes.js';\nimport { AgenticLoopEvents } from '../capabilities/agents/types/EventTypes.js';\nimport { IDisposable, assertNotDestroyed } from '../domain/interfaces/IDisposable.js';\nimport { ITextProvider } from '../domain/interfaces/ITextProvider.js';\nimport { logger, FrameworkLogger } from '../infrastructure/observability/Logger.js';\nimport { metrics } from '../infrastructure/observability/Metrics.js';\n\n/**\n * Session configuration for Agent\n */\nexport interface AgentSessionConfig {\n  /** Storage backend for sessions */\n  storage: ISessionStorage;\n  /** Resume existing session by ID */\n  id?: string;\n  /** Auto-save session after each interaction */\n  autoSave?: boolean;\n  /** Auto-save interval in milliseconds */\n  autoSaveIntervalMs?: number;\n}\n\n/**\n * Agent configuration - new simplified interface\n */\nexport interface AgentConfig {\n  // Required: connector (name or instance)\n  connector: string | Connector;\n\n  // Required: model to use\n  model: string;\n\n  // Optional\n  name?: string;\n  instructions?: string;\n  tools?: ToolFunction[];\n  temperature?: number;\n  maxIterations?: number;\n\n  // Enterprise features\n  hooks?: HookConfig;\n  historyMode?: HistoryMode;\n  limits?: {\n    maxExecutionTime?: number;\n    maxToolCalls?: number;\n    maxContextSize?: number;\n    maxInputMessages?: number;\n  };\n  errorHandling?: {\n    hookFailureMode?: 'fail' | 'warn' | 'ignore';\n    toolFailureMode?: 'fail' | 'continue';\n    maxConsecutiveErrors?: number;\n  };\n\n  // === NEW: Optional session support ===\n  /** Session configuration for persistence (opt-in) */\n  session?: AgentSessionConfig;\n\n  // === NEW: Advanced tool management ===\n  /** Provide a pre-configured ToolManager (advanced) */\n  toolManager?: ToolManager;\n}\n\n/**\n * Agent class - represents an AI assistant with tool calling capabilities\n */\nexport class Agent extends EventEmitter<AgenticLoopEvents> implements IDisposable {\n  // ============ Instance Properties ============\n\n  readonly name: string;\n  readonly connector: Connector;\n  readonly model: string;\n\n  private config: AgentConfig;\n  private provider: ITextProvider;\n  private toolRegistry: ToolRegistry;\n  private agenticLoop: AgenticLoop;\n  private cleanupCallbacks: Array<() => void> = [];\n  private boundListeners: Map<keyof AgenticLoopEvents, (...args: any[]) => void> = new Map();\n  private _isDestroyed = false;\n  private logger: FrameworkLogger;\n\n  // === NEW: Tool and Session Management ===\n  private _toolManager: ToolManager;\n  private _sessionManager: SessionManager | null = null;\n  private _session: Session | null = null;\n  private _pendingSessionLoad: Promise<void> | null = null;\n\n  get isDestroyed(): boolean {\n    return this._isDestroyed;\n  }\n\n  /**\n   * Advanced tool management. Returns ToolManager for fine-grained control.\n   * For simple cases, use addTool/removeTool instead.\n   */\n  get tools(): ToolManager {\n    return this._toolManager;\n  }\n\n  // ============ Static Factory ============\n\n  /**\n   * Create a new agent\n   *\n   * @example\n   * ```typescript\n   * const agent = Agent.create({\n   *   connector: 'openai',  // or Connector instance\n   *   model: 'gpt-4',\n   *   instructions: 'You are a helpful assistant',\n   *   tools: [myTool]\n   * });\n   * ```\n   */\n  static create(config: AgentConfig): Agent {\n    return new Agent(config);\n  }\n\n  /**\n   * Resume an agent from a saved session\n   *\n   * @example\n   * ```typescript\n   * const agent = await Agent.resume('session-123', {\n   *   connector: 'openai',\n   *   model: 'gpt-4',\n   *   session: { storage: myStorage }\n   * });\n   * ```\n   */\n  static async resume(\n    sessionId: string,\n    config: Omit<AgentConfig, 'session'> & { session: { storage: ISessionStorage } }\n  ): Promise<Agent> {\n    const agent = new Agent({\n      ...config,\n      session: {\n        ...config.session,\n        id: sessionId,\n      },\n    });\n\n    // Wait for session to load\n    if (agent._pendingSessionLoad) {\n      await agent._pendingSessionLoad;\n    }\n\n    return agent;\n  }\n\n  // ============ Constructor ============\n\n  private constructor(config: AgentConfig) {\n    super();\n\n    // Resolve connector\n    this.connector =\n      typeof config.connector === 'string'\n        ? Connector.get(config.connector)\n        : config.connector;\n\n    this.name = config.name ?? `agent-${Date.now()}`;\n    this.model = config.model;\n    this.config = config;\n\n    // Create logger with agent context\n    this.logger = logger.child({\n      component: 'Agent',\n      agentName: this.name,\n      model: this.model,\n      connector: this.connector.name,\n    });\n\n    this.logger.debug({ config }, 'Agent created');\n    metrics.increment('agent.created', 1, {\n      model: this.model,\n      connector: this.connector.name,\n    });\n\n    // Create provider from connector\n    this.provider = createProvider(this.connector);\n\n    // === Create ToolManager ===\n    this._toolManager = config.toolManager ?? new ToolManager();\n\n    // Register tools from config (backward compatible)\n    if (config.tools) {\n      for (const tool of config.tools) {\n        this._toolManager.register(tool);\n      }\n    }\n\n    // Create tool registry (still needed for AgenticLoop compatibility)\n    // ToolRegistry wraps the execution, ToolManager handles registration\n    this.toolRegistry = new ToolRegistry();\n    if (config.tools) {\n      for (const tool of config.tools) {\n        this.toolRegistry.registerTool(tool);\n      }\n    }\n\n    // Sync ToolManager events with ToolRegistry\n    this._toolManager.on('tool:registered', ({ name }) => {\n      const tool = this._toolManager.get(name);\n      if (tool && !this.toolRegistry.hasToolFunction(name)) {\n        this.toolRegistry.registerTool(tool);\n      }\n    });\n\n    this._toolManager.on('tool:unregistered', ({ name }) => {\n      if (this.toolRegistry.hasToolFunction(name)) {\n        this.toolRegistry.unregisterTool(name);\n      }\n    });\n\n    // Create agentic loop\n    this.agenticLoop = new AgenticLoop(\n      this.provider,\n      this.toolRegistry,\n      config.hooks,\n      config.errorHandling\n    );\n\n    // Forward events from AgenticLoop\n    this.setupEventForwarding();\n\n    // === Setup Session (optional) ===\n    if (config.session) {\n      this._sessionManager = new SessionManager({ storage: config.session.storage });\n\n      if (config.session.id) {\n        // Resume existing session\n        this._pendingSessionLoad = this.loadSessionInternal(config.session.id);\n      } else {\n        // Create new session\n        this._session = this._sessionManager.create('agent', {\n          title: this.name,\n        });\n\n        // Setup auto-save if configured\n        if (config.session.autoSave) {\n          const interval = config.session.autoSaveIntervalMs ?? 30000;\n          this._sessionManager.enableAutoSave(this._session, interval);\n        }\n      }\n    }\n  }\n\n  /**\n   * Internal method to load session\n   */\n  private async loadSessionInternal(sessionId: string): Promise<void> {\n    if (!this._sessionManager) return;\n\n    try {\n      const session = await this._sessionManager.load(sessionId);\n      if (session) {\n        this._session = session;\n\n        // Restore tool state\n        if (session.toolState) {\n          this._toolManager.loadState(session.toolState);\n        }\n\n        this.logger.info({ sessionId }, 'Session loaded');\n\n        // Setup auto-save if configured\n        if (this.config.session?.autoSave) {\n          const interval = this.config.session.autoSaveIntervalMs ?? 30000;\n          this._sessionManager.enableAutoSave(this._session, interval);\n        }\n      } else {\n        this.logger.warn({ sessionId }, 'Session not found, creating new session');\n        this._session = this._sessionManager.create('agent', {\n          title: this.name,\n        });\n      }\n    } catch (error) {\n      this.logger.error({ error: (error as Error).message, sessionId }, 'Failed to load session');\n      throw error;\n    }\n  }\n\n  // ============ Main API ============\n\n  /**\n   * Run the agent with input\n   */\n  async run(input: string | InputItem[]): Promise<AgentResponse> {\n    assertNotDestroyed(this, 'run agent');\n\n    const inputPreview = typeof input === 'string'\n      ? input.substring(0, 100)\n      : `${input.length} messages`;\n\n    this.logger.info({\n      inputPreview,\n      toolCount: this.config.tools?.length || 0,\n    }, 'Agent run started');\n\n    metrics.increment('agent.run.started', 1, {\n      model: this.model,\n      connector: this.connector.name,\n    });\n\n    const startTime = Date.now();\n\n    try {\n      // Get enabled tools from ToolManager (respects enable/disable)\n      const enabledTools = this._toolManager.getEnabled();\n      const tools = enabledTools.map((t) => t.definition);\n\n      const loopConfig: AgenticLoopConfig = {\n        model: this.model,\n        input,\n        instructions: this.config.instructions,\n        tools,\n        temperature: this.config.temperature,\n        maxIterations: this.config.maxIterations || 10,\n        hooks: this.config.hooks,\n        historyMode: this.config.historyMode,\n        limits: this.config.limits,\n        errorHandling: this.config.errorHandling,\n      };\n\n      const response = await this.agenticLoop.execute(loopConfig);\n\n      const duration = Date.now() - startTime;\n\n      this.logger.info({\n        duration,\n      }, 'Agent run completed');\n\n      metrics.timing('agent.run.duration', duration, {\n        model: this.model,\n        connector: this.connector.name,\n      });\n\n      metrics.increment('agent.run.completed', 1, {\n        model: this.model,\n        connector: this.connector.name,\n        status: 'success',\n      });\n\n      return response;\n    } catch (error) {\n      const duration = Date.now() - startTime;\n\n      this.logger.error({\n        error: (error as Error).message,\n        duration,\n      }, 'Agent run failed');\n\n      metrics.increment('agent.run.completed', 1, {\n        model: this.model,\n        connector: this.connector.name,\n        status: 'error',\n      });\n\n      throw error;\n    }\n  }\n\n  /**\n   * Stream response from the agent\n   */\n  async *stream(input: string | InputItem[]): AsyncIterableIterator<StreamEvent> {\n    assertNotDestroyed(this, 'stream from agent');\n\n    const inputPreview = typeof input === 'string'\n      ? input.substring(0, 100)\n      : `${input.length} messages`;\n\n    this.logger.info({\n      inputPreview,\n      toolCount: this.config.tools?.length || 0,\n    }, 'Agent stream started');\n\n    metrics.increment('agent.stream.started', 1, {\n      model: this.model,\n      connector: this.connector.name,\n    });\n\n    const startTime = Date.now();\n\n    try {\n      // Get enabled tools from ToolManager (respects enable/disable)\n      const enabledTools = this._toolManager.getEnabled();\n      const tools = enabledTools.map((t) => t.definition);\n\n      const loopConfig: AgenticLoopConfig = {\n        model: this.model,\n        input,\n        instructions: this.config.instructions,\n        tools,\n        temperature: this.config.temperature,\n        maxIterations: this.config.maxIterations || 10,\n        hooks: this.config.hooks,\n        historyMode: this.config.historyMode,\n        limits: this.config.limits,\n        errorHandling: this.config.errorHandling,\n      };\n\n      yield* this.agenticLoop.executeStreaming(loopConfig);\n\n      const duration = Date.now() - startTime;\n\n      this.logger.info({ duration }, 'Agent stream completed');\n\n      metrics.timing('agent.stream.duration', duration, {\n        model: this.model,\n        connector: this.connector.name,\n      });\n\n      metrics.increment('agent.stream.completed', 1, {\n        model: this.model,\n        connector: this.connector.name,\n        status: 'success',\n      });\n    } catch (error) {\n      const duration = Date.now() - startTime;\n\n      this.logger.error({\n        error: (error as Error).message,\n        duration,\n      }, 'Agent stream failed');\n\n      metrics.increment('agent.stream.completed', 1, {\n        model: this.model,\n        connector: this.connector.name,\n        status: 'error',\n      });\n\n      throw error;\n    }\n  }\n\n  // ============ Tool Management ============\n\n  /**\n   * Add a tool to the agent\n   */\n  addTool(tool: ToolFunction): void {\n    this._toolManager.register(tool);\n    this.toolRegistry.registerTool(tool);\n    if (!this.config.tools) {\n      this.config.tools = [];\n    }\n    this.config.tools.push(tool);\n  }\n\n  /**\n   * Remove a tool from the agent\n   */\n  removeTool(toolName: string): void {\n    this._toolManager.unregister(toolName);\n    this.toolRegistry.unregisterTool(toolName);\n    if (this.config.tools) {\n      this.config.tools = this.config.tools.filter(\n        (t) => t.definition.function.name !== toolName\n      );\n    }\n  }\n\n  /**\n   * List registered tools (returns enabled tool names)\n   */\n  listTools(): string[] {\n    return this._toolManager.listEnabled();\n  }\n\n  /**\n   * Replace all tools with a new array\n   */\n  setTools(tools: ToolFunction[]): void {\n    // Clear existing tools\n    for (const name of this._toolManager.list()) {\n      this._toolManager.unregister(name);\n      this.toolRegistry.unregisterTool(name);\n    }\n    // Register new tools\n    for (const tool of tools) {\n      this._toolManager.register(tool);\n      this.toolRegistry.registerTool(tool);\n    }\n    this.config.tools = [...tools];\n  }\n\n  // ============ Session Management (NEW) ============\n\n  /**\n   * Get the current session ID (if session is enabled)\n   */\n  getSessionId(): string | null {\n    return this._session?.id ?? null;\n  }\n\n  /**\n   * Check if this agent has session support enabled\n   */\n  hasSession(): boolean {\n    return this._session !== null;\n  }\n\n  /**\n   * Save the current session to storage\n   * @throws Error if session is not enabled\n   */\n  async saveSession(): Promise<void> {\n    if (!this._sessionManager || !this._session) {\n      throw new Error('Session not enabled. Configure session in AgentConfig to use this feature.');\n    }\n\n    // Update session state before saving\n    this._session.toolState = this._toolManager.getState();\n\n    await this._sessionManager.save(this._session);\n    this.logger.debug({ sessionId: this._session.id }, 'Session saved');\n  }\n\n  /**\n   * Get the current session (for advanced use)\n   */\n  getSession(): Session | null {\n    return this._session;\n  }\n\n  /**\n   * Update session custom data\n   */\n  updateSessionData(key: string, value: unknown): void {\n    if (!this._session) {\n      throw new Error('Session not enabled');\n    }\n    this._session.custom[key] = value;\n  }\n\n  /**\n   * Get session custom data\n   */\n  getSessionData<T = unknown>(key: string): T | undefined {\n    return this._session?.custom[key] as T | undefined;\n  }\n\n  // ============ Configuration Methods ============\n\n  /**\n   * Change the model\n   */\n  setModel(model: string): void {\n    (this as { model: string }).model = model;\n    this.config.model = model;\n  }\n\n  /**\n   * Get current temperature\n   */\n  getTemperature(): number | undefined {\n    return this.config.temperature;\n  }\n\n  /**\n   * Change the temperature\n   */\n  setTemperature(temperature: number): void {\n    this.config.temperature = temperature;\n  }\n\n  // ============ Control Methods ============\n\n  pause(reason?: string): void {\n    this.agenticLoop.pause(reason);\n  }\n\n  resume(): void {\n    this.agenticLoop.resume();\n  }\n\n  cancel(reason?: string): void {\n    this.agenticLoop.cancel(reason);\n  }\n\n  // ============ Introspection ============\n\n  getContext(): ExecutionContext | null {\n    return this.agenticLoop.getContext();\n  }\n\n  getMetrics() {\n    const context = this.agenticLoop.getContext();\n    return context?.metrics || null;\n  }\n\n  getSummary() {\n    const context = this.agenticLoop.getContext();\n    return context?.getSummary() || null;\n  }\n\n  getAuditTrail() {\n    const context = this.agenticLoop.getContext();\n    return context?.getAuditTrail() || [];\n  }\n\n  /**\n   * Get circuit breaker metrics for LLM provider\n   */\n  getProviderCircuitBreakerMetrics() {\n    if ('getCircuitBreakerMetrics' in this.provider) {\n      return (this.provider as any).getCircuitBreakerMetrics();\n    }\n    return null;\n  }\n\n  /**\n   * Get circuit breaker states for all tools\n   */\n  getToolCircuitBreakerStates() {\n    return this.toolRegistry.getCircuitBreakerStates();\n  }\n\n  /**\n   * Get circuit breaker metrics for a specific tool\n   */\n  getToolCircuitBreakerMetrics(toolName: string) {\n    return this.toolRegistry.getToolCircuitBreakerMetrics(toolName);\n  }\n\n  /**\n   * Manually reset a tool's circuit breaker\n   */\n  resetToolCircuitBreaker(toolName: string): void {\n    this.toolRegistry.resetToolCircuitBreaker(toolName);\n    this.logger.info({ toolName }, 'Tool circuit breaker reset by user');\n  }\n\n  isRunning(): boolean {\n    return this.agenticLoop.isRunning();\n  }\n\n  isPaused(): boolean {\n    return this.agenticLoop.isPaused();\n  }\n\n  isCancelled(): boolean {\n    return this.agenticLoop.isCancelled();\n  }\n\n  // ============ Cleanup ============\n\n  onCleanup(callback: () => void): void {\n    this.cleanupCallbacks.push(callback);\n  }\n\n  destroy(): void {\n    if (this._isDestroyed) {\n      return;\n    }\n    this._isDestroyed = true;\n\n    this.logger.debug('Agent destroy started');\n\n    try {\n      this.agenticLoop.cancel('Agent destroyed');\n    } catch {\n      // Ignore errors during cancel\n    }\n\n    // Remove event listeners\n    for (const [eventName, handler] of this.boundListeners) {\n      this.agenticLoop.off(eventName, handler);\n    }\n    this.boundListeners.clear();\n    this.removeAllListeners();\n\n    // Cleanup session manager\n    if (this._sessionManager) {\n      if (this._session) {\n        this._sessionManager.stopAutoSave(this._session.id);\n      }\n      this._sessionManager.destroy();\n    }\n\n    // Cleanup tool manager listeners\n    this._toolManager.removeAllListeners();\n\n    // Run cleanup callbacks\n    for (const callback of this.cleanupCallbacks) {\n      try {\n        callback();\n      } catch (error) {\n        this.logger.error({ error: (error as Error).message }, 'Cleanup callback error');\n      }\n    }\n    this.cleanupCallbacks = [];\n\n    metrics.increment('agent.destroyed', 1, {\n      model: this.model,\n      connector: this.connector.name,\n    });\n\n    this.logger.debug('Agent destroyed');\n  }\n\n  // ============ Private ============\n\n  private setupEventForwarding(): void {\n    const eventNames: Array<keyof AgenticLoopEvents> = [\n      'execution:start',\n      'execution:complete',\n      'execution:error',\n      'execution:paused',\n      'execution:resumed',\n      'execution:cancelled',\n      'iteration:start',\n      'iteration:complete',\n      'llm:request',\n      'llm:response',\n      'llm:error',\n      'tool:detected',\n      'tool:start',\n      'tool:complete',\n      'tool:error',\n      'tool:timeout',\n      'hook:error',\n    ];\n\n    for (const eventName of eventNames) {\n      const handler = (data: any) => {\n        if (!this._isDestroyed) {\n          this.emit(eventName, data);\n        }\n      };\n      this.boundListeners.set(eventName, handler);\n      this.agenticLoop.on(eventName, handler);\n    }\n  }\n}\n","/**\n * Base media provider with common functionality for Image, Audio, and Video providers\n * Provides circuit breaker, logging, and metrics similar to BaseTextProvider\n */\n\nimport { BaseProvider } from './BaseProvider.js';\nimport type { IProvider } from '../../../domain/interfaces/IProvider.js';\nimport { CircuitBreaker, DEFAULT_CIRCUIT_BREAKER_CONFIG } from '../../resilience/CircuitBreaker.js';\nimport { logger, FrameworkLogger } from '../../observability/Logger.js';\nimport { metrics } from '../../observability/Metrics.js';\n\n/**\n * Base class for all media providers (Image, Audio, Video)\n * Follows the same patterns as BaseTextProvider for consistency\n */\nexport abstract class BaseMediaProvider extends BaseProvider implements IProvider {\n  protected circuitBreaker?: CircuitBreaker;\n  protected logger: FrameworkLogger;\n  private _isObservabilityInitialized = false;\n\n  constructor(config: any) {\n    super(config);\n\n    // Initialize with default logger (will be updated with provider name on first use)\n    this.logger = logger.child({\n      component: 'MediaProvider',\n      provider: 'unknown',\n    });\n\n    // Circuit breaker created lazily on first use\n  }\n\n  /**\n   * Auto-initialize observability on first use (lazy initialization)\n   * This is called automatically by executeWithCircuitBreaker()\n   * @internal\n   */\n  private ensureObservabilityInitialized(): void {\n    if (this._isObservabilityInitialized) {\n      return;\n    }\n\n    const providerName = this.name || 'unknown';\n\n    // Create circuit breaker with provider name\n    const cbConfig = (this.config as any).circuitBreaker || DEFAULT_CIRCUIT_BREAKER_CONFIG;\n    this.circuitBreaker = new CircuitBreaker(\n      `media-provider:${providerName}`,\n      cbConfig\n    );\n\n    // Update logger with provider name\n    this.logger = logger.child({\n      component: 'MediaProvider',\n      provider: providerName,\n    });\n\n    // Forward circuit breaker events to metrics\n    this.circuitBreaker.on('opened', (data) => {\n      this.logger.warn(data, 'Circuit breaker opened');\n      metrics.increment('circuit_breaker.opened', 1, {\n        breaker: data.name,\n        provider: providerName,\n      });\n    });\n\n    this.circuitBreaker.on('closed', (data) => {\n      this.logger.info(data, 'Circuit breaker closed');\n      metrics.increment('circuit_breaker.closed', 1, {\n        breaker: data.name,\n        provider: providerName,\n      });\n    });\n\n    this._isObservabilityInitialized = true;\n  }\n\n  /**\n   * Execute operation with circuit breaker protection\n   * Automatically records metrics and handles errors\n   *\n   * @param operation - The async operation to execute\n   * @param operationName - Name of the operation for metrics (e.g., 'image.generate', 'audio.synthesize')\n   * @param metadata - Additional metadata to log/record\n   */\n  protected async executeWithCircuitBreaker<TResult>(\n    operation: () => Promise<TResult>,\n    operationName: string,\n    metadata?: Record<string, unknown>\n  ): Promise<TResult> {\n    // Auto-initialize observability on first use\n    this.ensureObservabilityInitialized();\n\n    const startTime = Date.now();\n    const metricLabels = {\n      provider: this.name,\n      operation: operationName,\n      ...metadata,\n    };\n\n    try {\n      // Execute through circuit breaker\n      const result = await this.circuitBreaker!.execute(operation);\n\n      // Record success metrics\n      const duration = Date.now() - startTime;\n      metrics.histogram(`${operationName}.duration`, duration, metricLabels);\n      metrics.increment(`${operationName}.success`, 1, metricLabels);\n\n      this.logger.debug(\n        { operation: operationName, duration, ...metadata },\n        'Operation completed successfully'\n      );\n\n      return result;\n    } catch (error) {\n      // Record error metrics\n      const duration = Date.now() - startTime;\n      metrics.increment(`${operationName}.error`, 1, {\n        ...metricLabels,\n        error: error instanceof Error ? error.name : 'unknown',\n      });\n\n      this.logger.error(\n        {\n          operation: operationName,\n          duration,\n          error: error instanceof Error ? error.message : String(error),\n          ...metadata,\n        },\n        'Operation failed'\n      );\n\n      throw error;\n    }\n  }\n\n  /**\n   * Log operation start with context\n   * Useful for logging before async operations\n   */\n  protected logOperationStart(operation: string, context: Record<string, unknown>): void {\n    this.ensureObservabilityInitialized();\n    this.logger.info({ operation, ...context }, `${operation} started`);\n  }\n\n  /**\n   * Log operation completion with context\n   */\n  protected logOperationComplete(operation: string, context: Record<string, unknown>): void {\n    this.ensureObservabilityInitialized();\n    this.logger.info({ operation, ...context }, `${operation} completed`);\n  }\n}\n","/**\n * Shared voice definitions and language constants\n * Eliminates duplication across TTS model registries\n */\n\n/**\n * Voice information structure\n * Used consistently across all TTS providers\n */\nexport interface IVoiceInfo {\n  id: string;\n  name: string;\n  language: string;\n  gender: 'male' | 'female' | 'neutral';\n  style?: string;\n  previewUrl?: string;\n  isDefault?: boolean;\n  accent?: string;\n  age?: 'child' | 'young' | 'adult' | 'senior';\n}\n\n// =============================================================================\n// Voice Definitions\n// =============================================================================\n\n/**\n * OpenAI TTS voices (shared across tts-1, tts-1-hd, gpt-4o-mini-tts)\n * Source: https://platform.openai.com/docs/guides/text-to-speech\n * Note: 'multi' language means the voice supports multiple languages\n * Last verified: 2026-01-24\n */\nexport const OPENAI_VOICES: IVoiceInfo[] = [\n  { id: 'alloy', name: 'Alloy', language: 'multi', gender: 'neutral', isDefault: true },\n  { id: 'ash', name: 'Ash', language: 'multi', gender: 'male' },\n  { id: 'ballad', name: 'Ballad', language: 'multi', gender: 'male' },\n  { id: 'coral', name: 'Coral', language: 'multi', gender: 'female' },\n  { id: 'echo', name: 'Echo', language: 'multi', gender: 'male' },\n  { id: 'fable', name: 'Fable', language: 'multi', gender: 'neutral', accent: 'british' },\n  { id: 'nova', name: 'Nova', language: 'multi', gender: 'female' },\n  { id: 'onyx', name: 'Onyx', language: 'multi', gender: 'male' },\n  { id: 'sage', name: 'Sage', language: 'multi', gender: 'female' },\n  { id: 'shimmer', name: 'Shimmer', language: 'multi', gender: 'female' },\n  { id: 'verse', name: 'Verse', language: 'multi', gender: 'neutral' },\n  { id: 'marin', name: 'Marin', language: 'multi', gender: 'female' },\n  { id: 'cedar', name: 'Cedar', language: 'multi', gender: 'male' },\n];\n\n/**\n * Google Gemini TTS voices (30 total)\n * Source: https://ai.google.dev/gemini-api/docs/speech-generation\n * Last verified: 2026-01-25\n */\nexport const GEMINI_VOICES: IVoiceInfo[] = [\n  // Default voice\n  { id: 'Kore', name: 'Kore', language: 'multi', gender: 'female', isDefault: true },\n  // Primary voices\n  { id: 'Puck', name: 'Puck', language: 'multi', gender: 'neutral' },\n  { id: 'Charon', name: 'Charon', language: 'multi', gender: 'male' },\n  { id: 'Fenrir', name: 'Fenrir', language: 'multi', gender: 'male' },\n  { id: 'Zephyr', name: 'Zephyr', language: 'multi', gender: 'neutral' },\n  { id: 'Leda', name: 'Leda', language: 'multi', gender: 'female' },\n  { id: 'Orus', name: 'Orus', language: 'multi', gender: 'male' },\n  { id: 'Aoede', name: 'Aoede', language: 'multi', gender: 'female' },\n  // Extended voices (celestial/astronomical naming)\n  { id: 'Callirrhoe', name: 'Callirrhoe', language: 'multi', gender: 'female' },\n  { id: 'Autonoe', name: 'Autonoe', language: 'multi', gender: 'female' },\n  { id: 'Enceladus', name: 'Enceladus', language: 'multi', gender: 'male' },\n  { id: 'Iapetus', name: 'Iapetus', language: 'multi', gender: 'male' },\n  { id: 'Umbriel', name: 'Umbriel', language: 'multi', gender: 'neutral' },\n  { id: 'Algieba', name: 'Algieba', language: 'multi', gender: 'male' },\n  { id: 'Despina', name: 'Despina', language: 'multi', gender: 'female' },\n  { id: 'Erinome', name: 'Erinome', language: 'multi', gender: 'female' },\n  { id: 'Algenib', name: 'Algenib', language: 'multi', gender: 'male' },\n  { id: 'Rasalgethi', name: 'Rasalgethi', language: 'multi', gender: 'male' },\n  { id: 'Laomedeia', name: 'Laomedeia', language: 'multi', gender: 'female' },\n  { id: 'Achernar', name: 'Achernar', language: 'multi', gender: 'male' },\n  { id: 'Alnilam', name: 'Alnilam', language: 'multi', gender: 'male' },\n  { id: 'Schedar', name: 'Schedar', language: 'multi', gender: 'female' },\n  { id: 'Gacrux', name: 'Gacrux', language: 'multi', gender: 'male' },\n  { id: 'Pulcherrima', name: 'Pulcherrima', language: 'multi', gender: 'female' },\n  { id: 'Achird', name: 'Achird', language: 'multi', gender: 'male' },\n  { id: 'Zubenelgenubi', name: 'Zubenelgenubi', language: 'multi', gender: 'male' },\n  { id: 'Vindemiatrix', name: 'Vindemiatrix', language: 'multi', gender: 'female' },\n  { id: 'Sadachbia', name: 'Sadachbia', language: 'multi', gender: 'male' },\n  { id: 'Sadaltager', name: 'Sadaltager', language: 'multi', gender: 'male' },\n  { id: 'Sulafat', name: 'Sulafat', language: 'multi', gender: 'female' },\n];\n\n/**\n * Google Gemini TTS supported languages (24)\n * Source: https://ai.google.dev/gemini-api/docs/speech-generation\n */\nexport const GEMINI_TTS_LANGUAGES = [\n  'ar-EG',  // Arabic (Egyptian)\n  'bn',     // Bengali\n  'de-DE',  // German (Germany)\n  'en-US',  // English (US)\n  'en-IN',  // English (India)\n  'es',     // Spanish\n  'fr-FR',  // French (France)\n  'hi',     // Hindi\n  'id',     // Indonesian\n  'it',     // Italian\n  'ja',     // Japanese\n  'ko',     // Korean\n  'mr',     // Marathi\n  'nl',     // Dutch\n  'pl',     // Polish\n  'pt-BR',  // Portuguese (Brazil)\n  'ro',     // Romanian\n  'ru',     // Russian\n  'ta',     // Tamil\n  'te',     // Telugu\n  'th',     // Thai\n  'tr',     // Turkish\n  'uk',     // Ukrainian\n  'vi',     // Vietnamese\n] as const;\n\n// =============================================================================\n// Language Constants\n// =============================================================================\n\n/**\n * Common language codes (ISO-639-1) supported by multiple vendors\n * Centralized to avoid duplication in model registries\n */\nexport const COMMON_LANGUAGES = {\n  /**\n   * Languages supported by OpenAI TTS models (50+)\n   * Source: https://platform.openai.com/docs/guides/text-to-speech\n   */\n  OPENAI_TTS: [\n    'en', 'es', 'fr', 'de', 'it', 'pt', 'pl', 'ru', 'ja', 'ko', 'zh', 'ar', 'hi',\n    'nl', 'sv', 'tr', 'af', 'hy', 'az', 'be', 'bs', 'bg', 'ca', 'hr', 'cs', 'da',\n    'et', 'fi', 'gl', 'el', 'he', 'hu', 'is', 'id', 'lv', 'lt', 'mk', 'ms', 'mi',\n    'ne', 'no', 'fa', 'ro', 'sr', 'sk', 'sl', 'sw', 'tl', 'ta', 'th', 'uk', 'ur',\n    'vi', 'cy',\n  ] as const,\n\n  /**\n   * Core languages supported by most vendors\n   */\n  CORE: ['en', 'es', 'fr', 'de', 'it', 'pt', 'ja', 'ko', 'zh', 'ru', 'ar', 'hi'] as const,\n\n  /**\n   * ElevenLabs supported languages\n   * Source: https://elevenlabs.io/docs\n   */\n  ELEVENLABS: [\n    'en', 'es', 'fr', 'de', 'it', 'pt', 'pl', 'ru', 'ja', 'ko', 'zh', 'ar', 'hi',\n    'nl', 'sv', 'tr', 'cs', 'da', 'fi', 'el', 'he', 'hu', 'id', 'ms', 'no', 'ro',\n    'sk', 'th', 'uk', 'vi',\n  ] as const,\n\n  /**\n   * AssemblyAI Universal model languages\n   * Source: https://www.assemblyai.com/docs\n   */\n  ASSEMBLYAI: [\n    'en', 'es', 'fr', 'de', 'it', 'pt', 'nl', 'ja', 'ko', 'zh',\n    'ru', 'ar', 'hi', 'pl', 'tr', 'uk', 'vi',\n  ] as const,\n} as const;\n\n// =============================================================================\n// Audio Format Constants\n// =============================================================================\n\n/**\n * Common audio formats by use case\n */\nexport const AUDIO_FORMATS = {\n  /**\n   * OpenAI TTS output formats\n   * Source: https://platform.openai.com/docs/guides/text-to-speech\n   */\n  OPENAI_TTS: ['mp3', 'opus', 'aac', 'flac', 'wav', 'pcm'] as const,\n\n  /**\n   * ElevenLabs output formats\n   */\n  ELEVENLABS: ['mp3', 'pcm', 'ogg', 'wav'] as const,\n\n  /**\n   * Google TTS output formats\n   */\n  GOOGLE_TTS: ['mp3', 'wav', 'ogg'] as const,\n\n  /**\n   * Common STT input formats (widely supported)\n   */\n  STT_INPUT: ['mp3', 'mp4', 'mpeg', 'mpga', 'm4a', 'wav', 'webm', 'flac', 'ogg'] as const,\n} as const;\n","/**\n * OpenAI Text-to-Speech provider\n * Supports: tts-1, tts-1-hd, gpt-4o-mini-tts\n */\n\nimport OpenAI from 'openai';\nimport { BaseMediaProvider } from '../base/BaseMediaProvider.js';\nimport type { ITextToSpeechProvider, TTSOptions, TTSResponse } from '../../../domain/interfaces/IAudioProvider.js';\nimport type { ProviderCapabilities } from '../../../domain/interfaces/IProvider.js';\nimport type { OpenAIMediaConfig } from '../../../domain/types/ProviderConfig.js';\nimport type { IVoiceInfo } from '../../../domain/entities/SharedVoices.js';\nimport { OPENAI_VOICES } from '../../../domain/entities/SharedVoices.js';\nimport {\n  ProviderAuthError,\n  ProviderRateLimitError,\n  ProviderError,\n} from '../../../domain/errors/AIErrors.js';\n\nexport class OpenAITTSProvider extends BaseMediaProvider implements ITextToSpeechProvider {\n  readonly name: string = 'openai-tts';\n  readonly vendor = 'openai' as const;\n  readonly capabilities: ProviderCapabilities = {\n    text: false,\n    images: false,\n    videos: false,\n    audio: true,\n    features: {\n      textToSpeech: true,\n    },\n  };\n\n  private client: OpenAI;\n\n  constructor(config: OpenAIMediaConfig) {\n    super({ apiKey: config.auth.apiKey, ...config });\n\n    this.client = new OpenAI({\n      apiKey: config.auth.apiKey,\n      baseURL: config.baseURL,\n      organization: config.organization,\n      timeout: config.timeout ?? 60000,\n      maxRetries: config.maxRetries ?? 2,\n    });\n  }\n\n  /**\n   * Synthesize speech from text\n   */\n  async synthesize(options: TTSOptions): Promise<TTSResponse> {\n    return this.executeWithCircuitBreaker(\n      async () => {\n        try {\n          // Map semantic format to OpenAI format\n          const format = this.mapFormat(options.format);\n\n          // Build request parameters\n          const requestParams: OpenAI.Audio.SpeechCreateParams = {\n            model: options.model,\n            input: options.input,\n            voice: options.voice as OpenAI.Audio.SpeechCreateParams['voice'],\n            response_format: format,\n            speed: options.speed,\n          };\n\n          // Add instruction steering if available (gpt-4o-mini-tts)\n          if (options.vendorOptions?.instructions) {\n            (requestParams as any).instructions = options.vendorOptions.instructions;\n          }\n\n          this.logOperationStart('tts.synthesize', {\n            model: options.model,\n            voice: options.voice,\n            inputLength: options.input.length,\n          });\n\n          const response = await this.client.audio.speech.create(requestParams);\n\n          // Convert response to Buffer\n          const arrayBuffer = await response.arrayBuffer();\n          const audio = Buffer.from(arrayBuffer);\n\n          this.logOperationComplete('tts.synthesize', {\n            model: options.model,\n            audioSize: audio.length,\n          });\n\n          return {\n            audio,\n            format: options.format || 'mp3',\n            charactersUsed: options.input.length,\n          };\n        } catch (error: any) {\n          this.handleError(error);\n          throw error; // TypeScript needs this\n        }\n      },\n      'tts.synthesize',\n      { model: options.model, voice: options.voice }\n    );\n  }\n\n  /**\n   * List available voices (returns static list for OpenAI)\n   */\n  async listVoices(): Promise<IVoiceInfo[]> {\n    return OPENAI_VOICES;\n  }\n\n  /**\n   * Map semantic audio format to OpenAI format\n   */\n  private mapFormat(\n    format?: string\n  ): OpenAI.Audio.SpeechCreateParams['response_format'] {\n    switch (format) {\n      case 'mp3':\n        return 'mp3';\n      case 'opus':\n        return 'opus';\n      case 'aac':\n        return 'aac';\n      case 'flac':\n        return 'flac';\n      case 'wav':\n        return 'wav';\n      case 'pcm':\n        return 'pcm';\n      default:\n        return 'mp3';\n    }\n  }\n\n  /**\n   * Handle OpenAI API errors\n   */\n  private handleError(error: any): never {\n    if (error instanceof OpenAI.APIError) {\n      const status = error.status;\n      const message = error.message || 'Unknown OpenAI API error';\n\n      if (status === 401) {\n        throw new ProviderAuthError('openai', 'Invalid API key');\n      }\n\n      if (status === 429) {\n        throw new ProviderRateLimitError('openai');\n      }\n\n      if (status === 400) {\n        throw new ProviderError('openai', `Bad request: ${message}`);\n      }\n\n      throw new ProviderError('openai', message);\n    }\n\n    throw error;\n  }\n}\n","/**\n * OpenAI Speech-to-Text provider\n * Supports: whisper-1, gpt-4o-transcribe, gpt-4o-transcribe-diarize\n */\n\nimport OpenAI from 'openai';\nimport { BaseMediaProvider } from '../base/BaseMediaProvider.js';\nimport type { ISpeechToTextProvider, STTOptions, STTResponse, STTOutputFormat } from '../../../domain/interfaces/IAudioProvider.js';\nimport type { ProviderCapabilities } from '../../../domain/interfaces/IProvider.js';\nimport type { OpenAIMediaConfig } from '../../../domain/types/ProviderConfig.js';\nimport {\n  ProviderAuthError,\n  ProviderRateLimitError,\n  ProviderError,\n} from '../../../domain/errors/AIErrors.js';\nimport * as fs from 'fs';\n\nexport class OpenAISTTProvider extends BaseMediaProvider implements ISpeechToTextProvider {\n  readonly name: string = 'openai-stt';\n  readonly vendor = 'openai' as const;\n  readonly capabilities: ProviderCapabilities = {\n    text: false,\n    images: false,\n    videos: false,\n    audio: true,\n    features: {\n      speechToText: true,\n    },\n  };\n\n  private client: OpenAI;\n\n  constructor(config: OpenAIMediaConfig) {\n    super({ apiKey: config.auth.apiKey, ...config });\n\n    this.client = new OpenAI({\n      apiKey: config.auth.apiKey,\n      baseURL: config.baseURL,\n      organization: config.organization,\n      timeout: config.timeout ?? 120000, // 2 minutes for audio processing\n      maxRetries: config.maxRetries ?? 2,\n    });\n  }\n\n  /**\n   * Transcribe audio to text\n   */\n  async transcribe(options: STTOptions): Promise<STTResponse> {\n    return this.executeWithCircuitBreaker(\n      async () => {\n        try {\n          this.logOperationStart('stt.transcribe', {\n            model: options.model,\n            language: options.language,\n            format: options.outputFormat,\n          });\n\n          // Prepare audio file\n          const audioFile = await this.prepareAudioFile(options.audio);\n\n          // Build request parameters\n          const requestParams: Partial<OpenAI.Audio.TranscriptionCreateParams> = {\n            model: options.model,\n            file: audioFile,\n            language: options.language,\n            prompt: options.prompt,\n            temperature: options.temperature,\n          };\n\n          // Map output format\n          if (options.outputFormat) {\n            requestParams.response_format = this.mapOutputFormat(options.outputFormat);\n          } else if (options.includeTimestamps) {\n            requestParams.response_format = 'verbose_json';\n          }\n\n          // Add timestamp granularity if needed\n          if (options.includeTimestamps && options.timestampGranularity) {\n            requestParams.timestamp_granularities = [options.timestampGranularity];\n          }\n\n          // Add diarization options if using diarize model\n          if (options.model.includes('diarize') && options.vendorOptions?.max_speakers) {\n            (requestParams as any).max_speakers = options.vendorOptions.max_speakers;\n          }\n\n          const response: any = await this.client.audio.transcriptions.create(\n            requestParams as any\n          );\n\n          this.logOperationComplete('stt.transcribe', {\n            model: options.model,\n            textLength: typeof response === 'string' ? response.length : response.text?.length || 0,\n          });\n\n          return this.convertResponse(response);\n        } catch (error: any) {\n          this.handleError(error);\n          throw error; // TypeScript needs this\n        }\n      },\n      'stt.transcribe',\n      { model: options.model }\n    );\n  }\n\n  /**\n   * Translate audio to English text\n   */\n  async translate(options: STTOptions): Promise<STTResponse> {\n    return this.executeWithCircuitBreaker(\n      async () => {\n        try {\n          this.logOperationStart('stt.translate', {\n            model: options.model,\n          });\n\n          const audioFile = await this.prepareAudioFile(options.audio);\n\n          const requestParams: Partial<OpenAI.Audio.TranslationCreateParams> = {\n            model: options.model,\n            file: audioFile,\n            prompt: options.prompt,\n            temperature: options.temperature,\n          };\n\n          if (options.outputFormat) {\n            requestParams.response_format = this.mapOutputFormat(options.outputFormat);\n          }\n\n          const response: any = await this.client.audio.translations.create(\n            requestParams as any\n          );\n\n          this.logOperationComplete('stt.translate', {\n            model: options.model,\n            textLength: typeof response === 'string' ? response.length : response.text?.length || 0,\n          });\n\n          return this.convertResponse(response);\n        } catch (error: any) {\n          this.handleError(error);\n          throw error;\n        }\n      },\n      'stt.translate',\n      { model: options.model }\n    );\n  }\n\n  /**\n   * Prepare audio file for API request\n   * Handles both Buffer and file path inputs\n   */\n  private async prepareAudioFile(audio: Buffer | string): Promise<any> {\n    if (Buffer.isBuffer(audio)) {\n      // Convert Buffer to File-like object that OpenAI SDK expects\n      const blob = new Blob([audio]);\n      return new File([blob], 'audio.wav', { type: 'audio/wav' });\n    } else if (typeof audio === 'string') {\n      // File path - create ReadStream\n      return fs.createReadStream(audio);\n    } else {\n      throw new Error('Invalid audio input: must be Buffer or file path');\n    }\n  }\n\n  /**\n   * Map semantic output format to OpenAI format\n   */\n  private mapOutputFormat(\n    format: STTOutputFormat\n  ): OpenAI.Audio.TranscriptionCreateParams['response_format'] {\n    switch (format) {\n      case 'json':\n        return 'json';\n      case 'text':\n        return 'text';\n      case 'srt':\n        return 'srt';\n      case 'vtt':\n        return 'vtt';\n      case 'verbose_json':\n        return 'verbose_json';\n      default:\n        return 'json';\n    }\n  }\n\n  /**\n   * Convert OpenAI response to our standard format\n   */\n  private convertResponse(response: OpenAI.Audio.Transcription | string): STTResponse {\n    // Handle simple string response\n    if (typeof response === 'string') {\n      return { text: response };\n    }\n\n    // Cast to access extended properties\n    const extResponse = response as any;\n\n    // Handle JSON response\n    const result: STTResponse = {\n      text: response.text,\n      language: extResponse.language,\n      durationSeconds: extResponse.duration,\n    };\n\n    // Add word timestamps if available\n    if ((response as any).words) {\n      result.words = (response as any).words.map((w: any) => ({\n        word: w.word,\n        start: w.start,\n        end: w.end,\n      }));\n    }\n\n    // Add segment timestamps if available\n    if ((response as any).segments) {\n      result.segments = (response as any).segments.map((s: any) => ({\n        id: s.id,\n        text: s.text,\n        start: s.start,\n        end: s.end,\n        tokens: s.tokens,\n      }));\n    }\n\n    return result;\n  }\n\n  /**\n   * Handle OpenAI API errors\n   */\n  private handleError(error: any): never {\n    if (error instanceof OpenAI.APIError) {\n      const status = error.status;\n      const message = error.message || 'Unknown OpenAI API error';\n\n      if (status === 401) {\n        throw new ProviderAuthError('openai', 'Invalid API key');\n      }\n\n      if (status === 429) {\n        throw new ProviderRateLimitError('openai');\n      }\n\n      if (status === 400) {\n        throw new ProviderError('openai', `Bad request: ${message}`);\n      }\n\n      if (status === 413) {\n        throw new ProviderError('openai', 'Audio file too large (max 25MB)');\n      }\n\n      throw new ProviderError('openai', message);\n    }\n\n    throw error;\n  }\n}\n","/**\n * Google Gemini Text-to-Speech provider\n * Supports: gemini-2.5-flash-preview-tts, gemini-2.5-pro-preview-tts\n */\n\nimport { GoogleGenAI } from '@google/genai';\nimport { BaseMediaProvider } from '../base/BaseMediaProvider.js';\nimport type { ITextToSpeechProvider, TTSOptions, TTSResponse } from '../../../domain/interfaces/IAudioProvider.js';\nimport type { ProviderCapabilities } from '../../../domain/interfaces/IProvider.js';\nimport type { GoogleConfig } from '../../../domain/types/ProviderConfig.js';\nimport type { IVoiceInfo } from '../../../domain/entities/SharedVoices.js';\nimport { GEMINI_VOICES } from '../../../domain/entities/SharedVoices.js';\nimport {\n  ProviderAuthError,\n  ProviderRateLimitError,\n  ProviderError,\n} from '../../../domain/errors/AIErrors.js';\n\nexport class GoogleTTSProvider extends BaseMediaProvider implements ITextToSpeechProvider {\n  readonly name: string = 'google-tts';\n  readonly vendor = 'google' as const;\n  readonly capabilities: ProviderCapabilities = {\n    text: false,\n    images: false,\n    videos: false,\n    audio: true,\n    features: {\n      textToSpeech: true,\n    },\n  };\n\n  private client: GoogleGenAI;\n\n  constructor(config: GoogleConfig) {\n    super(config);\n\n    this.client = new GoogleGenAI({\n      apiKey: config.apiKey,\n    });\n  }\n\n  /**\n   * Synthesize speech from text using Gemini TTS\n   */\n  async synthesize(options: TTSOptions): Promise<TTSResponse> {\n    return this.executeWithCircuitBreaker(\n      async () => {\n        try {\n          this.logOperationStart('tts.synthesize', {\n            model: options.model,\n            voice: options.voice,\n            inputLength: options.input.length,\n          });\n\n          // Build the request with speech config\n          const result = await this.client.models.generateContent({\n            model: options.model,\n            contents: [\n              {\n                parts: [{ text: options.input }],\n              },\n            ],\n            config: {\n              responseModalities: ['AUDIO'],\n              speechConfig: {\n                voiceConfig: {\n                  prebuiltVoiceConfig: {\n                    voiceName: options.voice || 'Kore',\n                  },\n                },\n              },\n            },\n          });\n\n          // Extract audio data from response\n          const audioData = this.extractAudioData(result);\n\n          if (!audioData) {\n            throw new ProviderError('google', 'No audio data in response');\n          }\n\n          this.logOperationComplete('tts.synthesize', {\n            model: options.model,\n            audioSize: audioData.length,\n          });\n\n          return {\n            audio: audioData,\n            format: 'wav', // Gemini outputs PCM 24kHz 16-bit, we convert to WAV\n            charactersUsed: options.input.length,\n          };\n        } catch (error: any) {\n          this.handleError(error);\n          throw error; // TypeScript needs this\n        }\n      },\n      'tts.synthesize',\n      { model: options.model, voice: options.voice }\n    );\n  }\n\n  /**\n   * List available voices (returns static list for Google)\n   */\n  async listVoices(): Promise<IVoiceInfo[]> {\n    return GEMINI_VOICES;\n  }\n\n  /**\n   * Extract audio data from Gemini response\n   * Gemini returns raw PCM data (24kHz, 16-bit, mono), we wrap it in WAV format\n   */\n  private extractAudioData(result: any): Buffer | null {\n    const candidates = result.candidates;\n    if (!candidates || candidates.length === 0) {\n      return null;\n    }\n\n    const content = candidates[0]?.content;\n    if (!content?.parts || content.parts.length === 0) {\n      return null;\n    }\n\n    // Find the audio part\n    for (const part of content.parts) {\n      if (part.inlineData?.data) {\n        // Decode base64 audio data\n        const rawPcm = Buffer.from(part.inlineData.data, 'base64');\n\n        // Wrap PCM in WAV format\n        return this.pcmToWav(rawPcm, 24000, 1, 16);\n      }\n    }\n\n    return null;\n  }\n\n  /**\n   * Convert raw PCM data to WAV format\n   * @param pcmData - Raw PCM data buffer\n   * @param sampleRate - Sample rate in Hz (default 24000 for Gemini)\n   * @param channels - Number of channels (default 1 for mono)\n   * @param bitsPerSample - Bits per sample (default 16)\n   */\n  private pcmToWav(\n    pcmData: Buffer,\n    sampleRate: number = 24000,\n    channels: number = 1,\n    bitsPerSample: number = 16\n  ): Buffer {\n    const byteRate = (sampleRate * channels * bitsPerSample) / 8;\n    const blockAlign = (channels * bitsPerSample) / 8;\n    const dataSize = pcmData.length;\n    const headerSize = 44;\n    const fileSize = headerSize + dataSize;\n\n    const header = Buffer.alloc(headerSize);\n\n    // RIFF header\n    header.write('RIFF', 0);\n    header.writeUInt32LE(fileSize - 8, 4); // File size - 8\n    header.write('WAVE', 8);\n\n    // fmt sub-chunk\n    header.write('fmt ', 12);\n    header.writeUInt32LE(16, 16); // Sub-chunk size (16 for PCM)\n    header.writeUInt16LE(1, 20); // Audio format (1 = PCM)\n    header.writeUInt16LE(channels, 22); // Number of channels\n    header.writeUInt32LE(sampleRate, 24); // Sample rate\n    header.writeUInt32LE(byteRate, 28); // Byte rate\n    header.writeUInt16LE(blockAlign, 32); // Block align\n    header.writeUInt16LE(bitsPerSample, 34); // Bits per sample\n\n    // data sub-chunk\n    header.write('data', 36);\n    header.writeUInt32LE(dataSize, 40); // Data size\n\n    return Buffer.concat([header, pcmData]);\n  }\n\n  /**\n   * Handle Google API errors\n   */\n  private handleError(error: any): never {\n    const message = error.message || 'Unknown Google API error';\n    const status = error.status || error.code;\n\n    if (status === 401 || message.includes('API key not valid')) {\n      throw new ProviderAuthError('google', 'Invalid API key');\n    }\n\n    if (status === 429 || message.includes('Resource exhausted')) {\n      throw new ProviderRateLimitError('google', message);\n    }\n\n    if (status === 400) {\n      throw new ProviderError('google', `Bad request: ${message}`);\n    }\n\n    throw new ProviderError('google', message);\n  }\n}\n","/**\n * Factory functions for creating audio providers (TTS and STT)\n */\n\nimport { Connector } from './Connector.js';\nimport type { ITextToSpeechProvider } from '../domain/interfaces/IAudioProvider.js';\nimport type { ISpeechToTextProvider } from '../domain/interfaces/IAudioProvider.js';\nimport { Vendor } from './Vendor.js';\nimport { OpenAITTSProvider } from '../infrastructure/providers/openai/OpenAITTSProvider.js';\nimport { OpenAISTTProvider } from '../infrastructure/providers/openai/OpenAISTTProvider.js';\nimport { GoogleTTSProvider } from '../infrastructure/providers/google/GoogleTTSProvider.js';\nimport type { OpenAIMediaConfig, GoogleConfig } from '../domain/types/ProviderConfig.js';\n\n/**\n * Create a Text-to-Speech provider from a connector\n */\nexport function createTTSProvider(connector: Connector): ITextToSpeechProvider {\n  const vendor = connector.vendor;\n\n  switch (vendor) {\n    case Vendor.OpenAI:\n      return new OpenAITTSProvider(extractOpenAIConfig(connector));\n\n    case Vendor.Google:\n      return new GoogleTTSProvider(extractGoogleConfig(connector));\n\n    default:\n      throw new Error(\n        `No TTS provider available for vendor: ${vendor}. ` +\n        `Supported vendors: ${Vendor.OpenAI}, ${Vendor.Google}`\n      );\n  }\n}\n\n/**\n * Create a Speech-to-Text provider from a connector\n */\nexport function createSTTProvider(connector: Connector): ISpeechToTextProvider {\n  const vendor = connector.vendor;\n\n  switch (vendor) {\n    case Vendor.OpenAI:\n      return new OpenAISTTProvider(extractOpenAIConfig(connector));\n\n    case Vendor.Groq:\n      // TODO: Implement GroqSTTProvider (Whisper on Groq)\n      throw new Error(`Groq STT provider not yet implemented`);\n\n    case Vendor.Google:\n      // TODO: Implement GoogleSTTProvider\n      throw new Error(`Google STT provider not yet implemented`);\n\n    default:\n      throw new Error(\n        `No STT provider available for vendor: ${vendor}. ` +\n        `Supported vendors: ${Vendor.OpenAI}, ${Vendor.Groq}`\n      );\n  }\n}\n\n/**\n * Extract OpenAI configuration from connector\n */\nfunction extractOpenAIConfig(connector: Connector): OpenAIMediaConfig {\n  const auth = connector.config.auth;\n\n  if (auth.type !== 'api_key') {\n    throw new Error('OpenAI requires API key authentication');\n  }\n\n  const options = connector.getOptions();\n\n  return {\n    auth: {\n      type: 'api_key',\n      apiKey: auth.apiKey,\n    },\n    baseURL: connector.baseURL,\n    organization: options.organization as string | undefined,\n    timeout: options.timeout as number | undefined,\n    maxRetries: options.maxRetries as number | undefined,\n  };\n}\n\n/**\n * Extract Google configuration from connector\n */\nfunction extractGoogleConfig(connector: Connector): GoogleConfig {\n  const auth = connector.config.auth;\n\n  if (auth.type !== 'api_key') {\n    throw new Error('Google requires API key authentication');\n  }\n\n  return {\n    apiKey: auth.apiKey,\n  };\n}\n","/**\n * Generic utilities for model registries\n * Eliminates code duplication across Image, TTS, STT, and Video registries\n */\n\nimport type { Vendor as VendorType } from '../../core/Vendor.js';\nimport type { IBaseModelDescription } from '../types/SharedTypes.js';\n\n/**\n * Creates standard helper functions for any model registry\n * This eliminates the need to write the same helper functions for each registry\n *\n * @example\n * ```typescript\n * const helpers = createRegistryHelpers(IMAGE_MODEL_REGISTRY);\n * export const getImageModelInfo = helpers.getInfo;\n * export const getImageModelsByVendor = helpers.getByVendor;\n * export const getActiveImageModels = helpers.getActive;\n * ```\n */\nexport function createRegistryHelpers<T extends IBaseModelDescription>(\n  registry: Record<string, T>\n) {\n  return {\n    /**\n     * Get model information by name\n     */\n    getInfo: (modelName: string): T | undefined => {\n      return registry[modelName];\n    },\n\n    /**\n     * Get all active models for a specific vendor\n     */\n    getByVendor: (vendor: VendorType): T[] => {\n      return Object.values(registry).filter(\n        (model) => model.provider === vendor && model.isActive\n      );\n    },\n\n    /**\n     * Get all currently active models (across all vendors)\n     */\n    getActive: (): T[] => {\n      return Object.values(registry).filter((model) => model.isActive);\n    },\n\n    /**\n     * Get all models (including inactive/deprecated)\n     */\n    getAll: (): T[] => {\n      return Object.values(registry);\n    },\n\n    /**\n     * Check if model exists in registry\n     */\n    has: (modelName: string): boolean => {\n      return modelName in registry;\n    },\n  };\n}\n\n/**\n * Creates feature-based filter for registries with capabilities\n * Used to find models that support specific features\n *\n * @example\n * ```typescript\n * const filter = createCapabilityFilter(IMAGE_MODEL_REGISTRY);\n * const modelsWithInpainting = filter.withFeature('inputModes').filter(\n *   m => m.capabilities.inputModes.inpainting\n * );\n * ```\n */\nexport function createCapabilityFilter<\n  T extends IBaseModelDescription & { capabilities: Record<string, unknown> }\n>(registry: Record<string, T>) {\n  return {\n    /**\n     * Get models that have a specific capability feature\n     * @param feature - The capability feature to filter by\n     * @param value - Optional specific value to match (if undefined, just checks truthy)\n     */\n    withFeature: <K extends keyof T['capabilities']>(\n      feature: K,\n      value?: T['capabilities'][K]\n    ): T[] => {\n      return Object.values(registry).filter((model) => {\n        if (!model.isActive) return false;\n\n        const capValue = (model.capabilities as Record<string, unknown>)[feature as string];\n\n        // If specific value provided, match exactly\n        if (value !== undefined) {\n          return capValue === value;\n        }\n\n        // Otherwise check if feature exists and is truthy\n        return Array.isArray(capValue) ? capValue.length > 0 : Boolean(capValue);\n      });\n    },\n  };\n}\n","/**\n * Text-to-Speech model registry with comprehensive metadata\n */\n\nimport { Vendor } from '../../core/Vendor.js';\nimport type { IBaseModelDescription, AudioFormat, VendorOptionSchema } from '../types/SharedTypes.js';\nimport { createRegistryHelpers } from './RegistryUtils.js';\nimport { OPENAI_VOICES, GEMINI_VOICES, GEMINI_TTS_LANGUAGES, COMMON_LANGUAGES, AUDIO_FORMATS, type IVoiceInfo } from './SharedVoices.js';\n\n// Re-export IVoiceInfo for public API\nexport type { IVoiceInfo } from './SharedVoices.js';\n\n// =============================================================================\n// Types\n// =============================================================================\n\n/**\n * TTS model capabilities\n */\nexport interface TTSModelCapabilities {\n  /** Available voices (empty array means fetch dynamically via API) */\n  voices: IVoiceInfo[];\n\n  /** Supported output formats */\n  formats: readonly AudioFormat[] | AudioFormat[];\n\n  /** Supported languages (ISO-639-1 codes) */\n  languages: readonly string[] | string[];\n\n  /** Speed control support */\n  speed: {\n    supported: boolean;\n    min?: number;\n    max?: number;\n    default?: number;\n  };\n\n  /** Feature support flags */\n  features: {\n    /** Real-time streaming support */\n    streaming: boolean;\n    /** SSML markup support */\n    ssml: boolean;\n    /** Emotion/style control */\n    emotions: boolean;\n    /** Custom voice cloning */\n    voiceCloning: boolean;\n    /** Word-level timestamps */\n    wordTimestamps: boolean;\n    /** Instruction steering (prompt-based style control) */\n    instructionSteering?: boolean;\n  };\n\n  /** Model limits */\n  limits: {\n    /** Maximum input length in characters */\n    maxInputLength: number;\n    /** Rate limit (requests per minute) */\n    maxRequestsPerMinute?: number;\n  };\n\n  /** Vendor-specific options schema */\n  vendorOptions?: Record<string, VendorOptionSchema>;\n}\n\n/**\n * TTS model pricing\n */\nexport interface TTSModelPricing {\n  /** Cost per 1,000 characters */\n  per1kCharacters: number;\n  currency: 'USD';\n}\n\n/**\n * Complete TTS model description\n */\nexport interface ITTSModelDescription extends IBaseModelDescription {\n  capabilities: TTSModelCapabilities;\n  pricing?: TTSModelPricing;\n}\n\n// =============================================================================\n// Model Constants\n// =============================================================================\n\nexport const TTS_MODELS = {\n  [Vendor.OpenAI]: {\n    /** NEW: Instruction-steerable TTS with emotional control */\n    GPT_4O_MINI_TTS: 'gpt-4o-mini-tts',\n    /** Fast, low-latency TTS */\n    TTS_1: 'tts-1',\n    /** High-definition TTS */\n    TTS_1_HD: 'tts-1-hd',\n  },\n  [Vendor.Google]: {\n    /** Gemini 2.5 Flash TTS (optimized for low latency) */\n    GEMINI_2_5_FLASH_TTS: 'gemini-2.5-flash-preview-tts',\n    /** Gemini 2.5 Pro TTS (optimized for quality) */\n    GEMINI_2_5_PRO_TTS: 'gemini-2.5-pro-preview-tts',\n  },\n} as const;\n\n// =============================================================================\n// Shared Capability Presets (DRY)\n// =============================================================================\n\n/**\n * Base OpenAI TTS capabilities (shared across models)\n */\nconst OPENAI_TTS_BASE: Omit<TTSModelCapabilities, 'features' | 'limits'> = {\n  voices: OPENAI_VOICES,\n  formats: AUDIO_FORMATS.OPENAI_TTS,\n  languages: COMMON_LANGUAGES.OPENAI_TTS,\n  speed: { supported: true, min: 0.25, max: 4.0, default: 1.0 },\n};\n\n// =============================================================================\n// Registry\n// =============================================================================\n\n/**\n * Complete TTS model registry\n * Last full audit: January 2026\n */\nexport const TTS_MODEL_REGISTRY: Record<string, ITTSModelDescription> = {\n  // ======================== OpenAI ========================\n\n  'gpt-4o-mini-tts': {\n    name: 'gpt-4o-mini-tts',\n    displayName: 'GPT-4o Mini TTS',\n    provider: Vendor.OpenAI,\n    description: 'Instruction-steerable TTS with emotional control via prompts',\n    isActive: true,\n    releaseDate: '2025-03-01',\n    sources: {\n      documentation: 'https://platform.openai.com/docs/guides/text-to-speech',\n      pricing: 'https://openai.com/pricing',\n      lastVerified: '2026-01-24',\n    },\n    capabilities: {\n      ...OPENAI_TTS_BASE,\n      features: {\n        streaming: false, // Not implementing streaming in v1\n        ssml: false,\n        emotions: true, // Via instruction steering\n        voiceCloning: true,\n        wordTimestamps: false,\n        instructionSteering: true,\n      },\n      limits: { maxInputLength: 2000 },\n      vendorOptions: {\n        instructions: {\n          type: 'string',\n          description: 'Natural language instructions for voice style (e.g., \"speak like a calm meditation guide\")',\n        },\n      },\n    },\n    pricing: { per1kCharacters: 0.015, currency: 'USD' },\n  },\n\n  'tts-1': {\n    name: 'tts-1',\n    displayName: 'TTS-1',\n    provider: Vendor.OpenAI,\n    description: 'Fast, low-latency text-to-speech optimized for real-time use',\n    isActive: true,\n    releaseDate: '2023-11-06',\n    sources: {\n      documentation: 'https://platform.openai.com/docs/guides/text-to-speech',\n      pricing: 'https://openai.com/pricing',\n      lastVerified: '2026-01-24',\n    },\n    capabilities: {\n      ...OPENAI_TTS_BASE,\n      features: {\n        streaming: false, // Not implementing streaming in v1\n        ssml: false,\n        emotions: false,\n        voiceCloning: false,\n        wordTimestamps: false,\n      },\n      limits: { maxInputLength: 4096 },\n    },\n    pricing: { per1kCharacters: 0.015, currency: 'USD' },\n  },\n\n  'tts-1-hd': {\n    name: 'tts-1-hd',\n    displayName: 'TTS-1 HD',\n    provider: Vendor.OpenAI,\n    description: 'High-definition text-to-speech with improved audio quality',\n    isActive: true,\n    releaseDate: '2023-11-06',\n    sources: {\n      documentation: 'https://platform.openai.com/docs/guides/text-to-speech',\n      pricing: 'https://openai.com/pricing',\n      lastVerified: '2026-01-24',\n    },\n    capabilities: {\n      ...OPENAI_TTS_BASE,\n      features: {\n        streaming: false, // Not implementing streaming in v1\n        ssml: false,\n        emotions: false,\n        voiceCloning: false,\n        wordTimestamps: false,\n      },\n      limits: { maxInputLength: 4096 },\n    },\n    pricing: { per1kCharacters: 0.030, currency: 'USD' },\n  },\n\n  // ======================== Google ========================\n\n  'gemini-2.5-flash-preview-tts': {\n    name: 'gemini-2.5-flash-preview-tts',\n    displayName: 'Gemini 2.5 Flash TTS',\n    provider: Vendor.Google,\n    description: 'Google Gemini 2.5 Flash TTS - optimized for low latency',\n    isActive: true,\n    releaseDate: '2025-01-01',\n    sources: {\n      documentation: 'https://ai.google.dev/gemini-api/docs/speech-generation',\n      pricing: 'https://ai.google.dev/pricing',\n      lastVerified: '2026-01-25',\n    },\n    capabilities: {\n      voices: GEMINI_VOICES,\n      formats: ['wav'] as const, // PCM output, 24kHz 16-bit mono\n      languages: [...GEMINI_TTS_LANGUAGES],\n      speed: { supported: false }, // Speed not directly configurable\n      features: {\n        streaming: false, // Not implementing streaming in v1\n        ssml: false,\n        emotions: true, // Supports affective dialogue\n        voiceCloning: false,\n        wordTimestamps: false,\n      },\n      limits: { maxInputLength: 32000 }, // 32k tokens\n    },\n  },\n\n  'gemini-2.5-pro-preview-tts': {\n    name: 'gemini-2.5-pro-preview-tts',\n    displayName: 'Gemini 2.5 Pro TTS',\n    provider: Vendor.Google,\n    description: 'Google Gemini 2.5 Pro TTS - optimized for quality',\n    isActive: true,\n    releaseDate: '2025-01-01',\n    sources: {\n      documentation: 'https://ai.google.dev/gemini-api/docs/speech-generation',\n      pricing: 'https://ai.google.dev/pricing',\n      lastVerified: '2026-01-25',\n    },\n    capabilities: {\n      voices: GEMINI_VOICES,\n      formats: ['wav'] as const, // PCM output, 24kHz 16-bit mono\n      languages: [...GEMINI_TTS_LANGUAGES],\n      speed: { supported: false }, // Speed not directly configurable\n      features: {\n        streaming: false, // Not implementing streaming in v1\n        ssml: false,\n        emotions: true, // Supports affective dialogue\n        voiceCloning: false,\n        wordTimestamps: false,\n      },\n      limits: { maxInputLength: 32000 }, // 32k tokens\n    },\n  },\n};\n\n// =============================================================================\n// Helper Functions (using shared utilities)\n// =============================================================================\n\nconst helpers = createRegistryHelpers(TTS_MODEL_REGISTRY);\n\nexport const getTTSModelInfo = helpers.getInfo;\nexport const getTTSModelsByVendor = helpers.getByVendor;\nexport const getActiveTTSModels = helpers.getActive;\n\n/**\n * Get TTS models that support a specific feature\n */\nexport function getTTSModelsWithFeature(\n  feature: keyof ITTSModelDescription['capabilities']['features']\n): ITTSModelDescription[] {\n  return Object.values(TTS_MODEL_REGISTRY).filter(\n    (model) => model.isActive && model.capabilities.features[feature]\n  );\n}\n\n/**\n * Calculate estimated cost for TTS\n */\nexport function calculateTTSCost(modelName: string, characterCount: number): number | null {\n  const model = getTTSModelInfo(modelName);\n  if (!model?.pricing) return null;\n  return (characterCount / 1000) * model.pricing.per1kCharacters;\n}\n","/**\n * TextToSpeech capability class\n * Provides high-level API for text-to-speech synthesis\n */\n\nimport { Connector } from './Connector.js';\nimport { createTTSProvider } from './createAudioProvider.js';\nimport type { ITextToSpeechProvider, TTSOptions, TTSResponse } from '../domain/interfaces/IAudioProvider.js';\nimport type { AudioFormat } from '../domain/types/SharedTypes.js';\nimport { getTTSModelInfo, getTTSModelsByVendor, type ITTSModelDescription, type IVoiceInfo } from '../domain/entities/TTSModel.js';\nimport * as fs from 'fs/promises';\n\n/**\n * Configuration for TextToSpeech capability\n */\nexport interface TextToSpeechConfig {\n  /** Connector name or instance */\n  connector: string | Connector;\n\n  /** Default model to use */\n  model?: string;\n\n  /** Default voice to use */\n  voice?: string;\n\n  /** Default audio format */\n  format?: AudioFormat;\n\n  /** Default speed (0.25 to 4.0) */\n  speed?: number;\n}\n\n/**\n * TextToSpeech capability class\n * Provides text-to-speech synthesis with model introspection\n *\n * @example\n * ```typescript\n * const tts = TextToSpeech.create({\n *   connector: 'openai',\n *   model: 'tts-1-hd',\n *   voice: 'nova',\n * });\n *\n * const audio = await tts.synthesize('Hello, world!');\n * await tts.toFile('Hello', './output.mp3');\n * ```\n */\nexport class TextToSpeech {\n  private provider: ITextToSpeechProvider;\n  private config: TextToSpeechConfig;\n\n  /**\n   * Create a new TextToSpeech instance\n   */\n  static create(config: TextToSpeechConfig): TextToSpeech {\n    return new TextToSpeech(config);\n  }\n\n  private constructor(config: TextToSpeechConfig) {\n    const connector = typeof config.connector === 'string'\n      ? Connector.get(config.connector)\n      : config.connector;\n\n    this.provider = createTTSProvider(connector);\n    this.config = config;\n  }\n\n  // ======================== Synthesis Methods ========================\n\n  /**\n   * Synthesize speech from text\n   *\n   * @param text - Text to synthesize\n   * @param options - Optional synthesis parameters\n   * @returns Audio data and metadata\n   */\n  async synthesize(\n    text: string,\n    options?: Partial<Omit<TTSOptions, 'model' | 'input'>>\n  ): Promise<TTSResponse> {\n    const fullOptions: TTSOptions = {\n      model: this.config.model ?? this.getDefaultModel(),\n      input: text,\n      voice: options?.voice ?? this.config.voice ?? this.getDefaultVoice(),\n      format: options?.format ?? this.config.format,\n      speed: options?.speed ?? this.config.speed,\n      vendorOptions: options?.vendorOptions,\n    };\n\n    return this.provider.synthesize(fullOptions);\n  }\n\n  /**\n   * Synthesize speech and save to file\n   *\n   * @param text - Text to synthesize\n   * @param filePath - Output file path\n   * @param options - Optional synthesis parameters\n   */\n  async toFile(\n    text: string,\n    filePath: string,\n    options?: Partial<Omit<TTSOptions, 'model' | 'input'>>\n  ): Promise<void> {\n    const response = await this.synthesize(text, options);\n    await fs.writeFile(filePath, response.audio);\n  }\n\n  // ======================== Introspection Methods ========================\n\n  /**\n   * Get model information for current or specified model\n   */\n  getModelInfo(model?: string): ITTSModelDescription {\n    const targetModel = model ?? this.config.model ?? this.getDefaultModel();\n    const info = getTTSModelInfo(targetModel);\n\n    if (!info) {\n      throw new Error(`Unknown TTS model: ${targetModel}`);\n    }\n\n    return info;\n  }\n\n  /**\n   * Get model capabilities\n   */\n  getModelCapabilities(model?: string) {\n    return this.getModelInfo(model).capabilities;\n  }\n\n  /**\n   * List all available voices for current model\n   * For dynamic voice providers (e.g., ElevenLabs), fetches from API\n   * For static providers (e.g., OpenAI), returns from registry\n   */\n  async listVoices(model?: string): Promise<IVoiceInfo[]> {\n    // Try to fetch from provider API first\n    if (this.provider.listVoices) {\n      return this.provider.listVoices();\n    }\n\n    // Fall back to static list from registry\n    const caps = this.getModelCapabilities(model);\n    return caps.voices;\n  }\n\n  /**\n   * List all available models for this provider's vendor\n   */\n  listAvailableModels(): ITTSModelDescription[] {\n    const vendor = this.provider.vendor;\n    if (!vendor) {\n      return [];\n    }\n    return getTTSModelsByVendor(vendor as any);\n  }\n\n  /**\n   * Check if a specific feature is supported by the model\n   */\n  supportsFeature(\n    feature: keyof ITTSModelDescription['capabilities']['features'],\n    model?: string\n  ): boolean {\n    const caps = this.getModelCapabilities(model);\n    return Boolean(caps.features[feature]);\n  }\n\n  /**\n   * Get supported audio formats for the model\n   */\n  getSupportedFormats(model?: string): readonly AudioFormat[] | AudioFormat[] {\n    return this.getModelCapabilities(model).formats;\n  }\n\n  /**\n   * Get supported languages for the model\n   */\n  getSupportedLanguages(model?: string): readonly string[] | string[] {\n    return this.getModelCapabilities(model).languages;\n  }\n\n  /**\n   * Check if speed control is supported\n   */\n  supportsSpeedControl(model?: string): boolean {\n    return this.getModelCapabilities(model).speed.supported;\n  }\n\n  // ======================== Configuration Methods ========================\n\n  /**\n   * Update default model\n   */\n  setModel(model: string): void {\n    this.config.model = model;\n  }\n\n  /**\n   * Update default voice\n   */\n  setVoice(voice: string): void {\n    this.config.voice = voice;\n  }\n\n  /**\n   * Update default format\n   */\n  setFormat(format: AudioFormat): void {\n    this.config.format = format;\n  }\n\n  /**\n   * Update default speed\n   */\n  setSpeed(speed: number): void {\n    this.config.speed = speed;\n  }\n\n  // ======================== Private Methods ========================\n\n  /**\n   * Get default model (first active model for vendor)\n   */\n  private getDefaultModel(): string {\n    const models = this.listAvailableModels();\n    const firstModel = models[0];\n    if (!firstModel) {\n      throw new Error('No TTS models available for this provider');\n    }\n    return firstModel.name;\n  }\n\n  /**\n   * Get default voice (first or default-marked voice)\n   */\n  private getDefaultVoice(): string {\n    const caps = this.getModelInfo().capabilities;\n    const defaultVoice = caps.voices.find((v) => v.isDefault);\n    return defaultVoice?.id ?? caps.voices[0]?.id ?? 'alloy';\n  }\n}\n","/**\n * Speech-to-Text model registry with comprehensive metadata\n */\n\nimport { Vendor } from '../../core/Vendor.js';\nimport type { IBaseModelDescription, VendorOptionSchema } from '../types/SharedTypes.js';\nimport { createRegistryHelpers } from './RegistryUtils.js';\nimport { AUDIO_FORMATS } from './SharedVoices.js';\n\n// =============================================================================\n// Types\n// =============================================================================\n\n/**\n * STT output format types\n */\nexport type STTOutputFormat = 'json' | 'text' | 'srt' | 'vtt' | 'verbose_json';\n\n/**\n * STT model capabilities\n */\nexport interface STTModelCapabilities {\n  /** Supported input audio formats */\n  inputFormats: readonly string[] | string[];\n\n  /** Supported output formats */\n  outputFormats: STTOutputFormat[];\n\n  /** Supported languages (empty = auto-detect all) */\n  languages: string[];\n\n  /** Timestamp support */\n  timestamps: {\n    supported: boolean;\n    granularities?: ('word' | 'segment')[];\n  };\n\n  /** Feature support flags */\n  features: {\n    /** Translation to English */\n    translation: boolean;\n    /** Speaker identification */\n    diarization: boolean;\n    /** Real-time streaming (not implemented in v1) */\n    streaming: boolean;\n    /** Automatic punctuation */\n    punctuation: boolean;\n    /** Profanity filtering */\n    profanityFilter: boolean;\n  };\n\n  /** Model limits */\n  limits: {\n    /** Maximum file size in MB */\n    maxFileSizeMB: number;\n    /** Maximum duration in seconds */\n    maxDurationSeconds?: number;\n  };\n\n  /** Vendor-specific options schema */\n  vendorOptions?: Record<string, VendorOptionSchema>;\n}\n\n/**\n * STT model pricing\n */\nexport interface STTModelPricing {\n  /** Cost per minute of audio */\n  perMinute: number;\n  currency: 'USD';\n}\n\n/**\n * Complete STT model description\n */\nexport interface ISTTModelDescription extends IBaseModelDescription {\n  capabilities: STTModelCapabilities;\n  pricing?: STTModelPricing;\n}\n\n// =============================================================================\n// Model Constants\n// =============================================================================\n\nexport const STT_MODELS = {\n  [Vendor.OpenAI]: {\n    /** NEW: GPT-4o based transcription */\n    GPT_4O_TRANSCRIBE: 'gpt-4o-transcribe',\n    /** NEW: GPT-4o with speaker diarization */\n    GPT_4O_TRANSCRIBE_DIARIZE: 'gpt-4o-transcribe-diarize',\n    /** Classic Whisper */\n    WHISPER_1: 'whisper-1',\n  },\n  [Vendor.Groq]: {\n    /** Ultra-fast Whisper on Groq LPUs */\n    WHISPER_LARGE_V3: 'whisper-large-v3',\n    /** Faster English-only variant */\n    DISTIL_WHISPER: 'distil-whisper-large-v3-en',\n  },\n} as const;\n\n// =============================================================================\n// Shared Capability Presets (DRY)\n// =============================================================================\n\n/**\n * Base Whisper capabilities (shared across OpenAI/Groq models)\n */\nconst WHISPER_BASE_CAPABILITIES: Omit<STTModelCapabilities, 'features' | 'limits'> = {\n  inputFormats: AUDIO_FORMATS.STT_INPUT,\n  outputFormats: ['json', 'text', 'srt', 'vtt', 'verbose_json'],\n  languages: [], // Auto-detect, 50+ languages\n  timestamps: { supported: true, granularities: ['word', 'segment'] },\n};\n\n// =============================================================================\n// Registry\n// =============================================================================\n\n/**\n * Complete STT model registry\n * Last full audit: January 2026\n */\nexport const STT_MODEL_REGISTRY: Record<string, ISTTModelDescription> = {\n  // ======================== OpenAI ========================\n\n  'gpt-4o-transcribe': {\n    name: 'gpt-4o-transcribe',\n    displayName: 'GPT-4o Transcribe',\n    provider: Vendor.OpenAI,\n    description: 'GPT-4o based transcription with superior accuracy and context understanding',\n    isActive: true,\n    releaseDate: '2025-04-01',\n    sources: {\n      documentation: 'https://platform.openai.com/docs/guides/speech-to-text',\n      pricing: 'https://openai.com/pricing',\n      lastVerified: '2026-01-24',\n    },\n    capabilities: {\n      ...WHISPER_BASE_CAPABILITIES,\n      features: {\n        translation: true,\n        diarization: false,\n        streaming: false, // Not implementing streaming in v1\n        punctuation: true,\n        profanityFilter: false,\n      },\n      limits: { maxFileSizeMB: 25, maxDurationSeconds: 7200 },\n    },\n    pricing: { perMinute: 0.006, currency: 'USD' },\n  },\n\n  'gpt-4o-transcribe-diarize': {\n    name: 'gpt-4o-transcribe-diarize',\n    displayName: 'GPT-4o Transcribe + Diarization',\n    provider: Vendor.OpenAI,\n    description: 'GPT-4o transcription with speaker identification',\n    isActive: true,\n    releaseDate: '2025-04-01',\n    sources: {\n      documentation: 'https://platform.openai.com/docs/guides/speech-to-text',\n      pricing: 'https://openai.com/pricing',\n      lastVerified: '2026-01-24',\n    },\n    capabilities: {\n      ...WHISPER_BASE_CAPABILITIES,\n      outputFormats: ['json', 'verbose_json'],\n      features: {\n        translation: true,\n        diarization: true, // Built-in speaker identification\n        streaming: false,\n        punctuation: true,\n        profanityFilter: false,\n      },\n      limits: { maxFileSizeMB: 25, maxDurationSeconds: 7200 },\n      vendorOptions: {\n        max_speakers: {\n          type: 'number',\n          description: 'Maximum number of speakers to detect',\n          min: 2,\n          max: 10,\n          default: 4,\n        },\n      },\n    },\n    pricing: { perMinute: 0.012, currency: 'USD' }, // 2x for diarization\n  },\n\n  'whisper-1': {\n    name: 'whisper-1',\n    displayName: 'Whisper',\n    provider: Vendor.OpenAI,\n    description: \"OpenAI's general-purpose speech recognition model\",\n    isActive: true,\n    releaseDate: '2023-03-01',\n    sources: {\n      documentation: 'https://platform.openai.com/docs/guides/speech-to-text',\n      pricing: 'https://openai.com/pricing',\n      lastVerified: '2026-01-24',\n    },\n    capabilities: {\n      ...WHISPER_BASE_CAPABILITIES,\n      inputFormats: ['mp3', 'mp4', 'mpeg', 'mpga', 'm4a', 'wav', 'webm'],\n      features: {\n        translation: true,\n        diarization: false,\n        streaming: false,\n        punctuation: true,\n        profanityFilter: false,\n      },\n      limits: { maxFileSizeMB: 25 },\n    },\n    pricing: { perMinute: 0.006, currency: 'USD' },\n  },\n\n  // ======================== Groq ========================\n\n  'whisper-large-v3': {\n    name: 'whisper-large-v3',\n    displayName: 'Whisper Large v3 (Groq)',\n    provider: Vendor.Groq,\n    description: 'Ultra-fast Whisper on Groq LPUs - 12x cheaper than OpenAI',\n    isActive: true,\n    releaseDate: '2024-04-01',\n    sources: {\n      documentation: 'https://console.groq.com/docs/speech-text',\n      pricing: 'https://groq.com/pricing/',\n      lastVerified: '2026-01-24',\n    },\n    capabilities: {\n      ...WHISPER_BASE_CAPABILITIES,\n      timestamps: { supported: true, granularities: ['segment'] },\n      outputFormats: ['json', 'text', 'verbose_json'],\n      features: {\n        translation: true,\n        diarization: false,\n        streaming: false,\n        punctuation: true,\n        profanityFilter: false,\n      },\n      limits: { maxFileSizeMB: 25 },\n    },\n    pricing: { perMinute: 0.0005, currency: 'USD' }, // 12x cheaper!\n  },\n\n  'distil-whisper-large-v3-en': {\n    name: 'distil-whisper-large-v3-en',\n    displayName: 'Distil Whisper (Groq)',\n    provider: Vendor.Groq,\n    description: 'Faster English-only Whisper variant on Groq',\n    isActive: true,\n    releaseDate: '2024-04-01',\n    sources: {\n      documentation: 'https://console.groq.com/docs/speech-text',\n      pricing: 'https://groq.com/pricing/',\n      lastVerified: '2026-01-24',\n    },\n    capabilities: {\n      inputFormats: AUDIO_FORMATS.STT_INPUT,\n      outputFormats: ['json', 'text', 'verbose_json'],\n      languages: ['en'], // English only\n      timestamps: { supported: true, granularities: ['segment'] },\n      features: {\n        translation: false,\n        diarization: false,\n        streaming: false,\n        punctuation: true,\n        profanityFilter: false,\n      },\n      limits: { maxFileSizeMB: 25 },\n    },\n    pricing: { perMinute: 0.00033, currency: 'USD' },\n  },\n};\n\n// =============================================================================\n// Helper Functions (using shared utilities)\n// =============================================================================\n\nconst helpers = createRegistryHelpers(STT_MODEL_REGISTRY);\n\nexport const getSTTModelInfo = helpers.getInfo;\nexport const getSTTModelsByVendor = helpers.getByVendor;\nexport const getActiveSTTModels = helpers.getActive;\n\n/**\n * Get STT models that support a specific feature\n */\nexport function getSTTModelsWithFeature(\n  feature: keyof ISTTModelDescription['capabilities']['features']\n): ISTTModelDescription[] {\n  return Object.values(STT_MODEL_REGISTRY).filter(\n    (model) => model.isActive && model.capabilities.features[feature]\n  );\n}\n\n/**\n * Calculate estimated cost for STT\n */\nexport function calculateSTTCost(modelName: string, durationSeconds: number): number | null {\n  const model = getSTTModelInfo(modelName);\n  if (!model?.pricing) return null;\n  return (durationSeconds / 60) * model.pricing.perMinute;\n}\n","/**\n * SpeechToText capability class\n * Provides high-level API for speech-to-text transcription\n */\n\nimport { Connector } from './Connector.js';\nimport { createSTTProvider } from './createAudioProvider.js';\nimport type { ISpeechToTextProvider, STTOptions, STTResponse } from '../domain/interfaces/IAudioProvider.js';\nimport { getSTTModelInfo, getSTTModelsByVendor, type ISTTModelDescription } from '../domain/entities/STTModel.js';\nimport * as fs from 'fs/promises';\n\n/**\n * Configuration for SpeechToText capability\n */\nexport interface SpeechToTextConfig {\n  /** Connector name or instance */\n  connector: string | Connector;\n\n  /** Default model to use */\n  model?: string;\n\n  /** Default language (ISO-639-1 code) */\n  language?: string;\n\n  /** Default temperature for sampling */\n  temperature?: number;\n}\n\n/**\n * SpeechToText capability class\n * Provides speech-to-text transcription with model introspection\n *\n * @example\n * ```typescript\n * const stt = SpeechToText.create({\n *   connector: 'openai',\n *   model: 'whisper-1',\n * });\n *\n * const result = await stt.transcribe(audioBuffer);\n * console.log(result.text);\n *\n * const detailed = await stt.transcribeWithTimestamps(audioBuffer, 'word');\n * console.log(detailed.words);\n * ```\n */\nexport class SpeechToText {\n  private provider: ISpeechToTextProvider;\n  private config: SpeechToTextConfig;\n\n  /**\n   * Create a new SpeechToText instance\n   */\n  static create(config: SpeechToTextConfig): SpeechToText {\n    return new SpeechToText(config);\n  }\n\n  private constructor(config: SpeechToTextConfig) {\n    const connector = typeof config.connector === 'string'\n      ? Connector.get(config.connector)\n      : config.connector;\n\n    this.provider = createSTTProvider(connector);\n    this.config = config;\n  }\n\n  // ======================== Transcription Methods ========================\n\n  /**\n   * Transcribe audio to text\n   *\n   * @param audio - Audio data as Buffer or file path\n   * @param options - Optional transcription parameters\n   * @returns Transcription result with text and metadata\n   */\n  async transcribe(\n    audio: Buffer | string,\n    options?: Partial<Omit<STTOptions, 'model' | 'audio'>>\n  ): Promise<STTResponse> {\n    const fullOptions: STTOptions = {\n      model: this.config.model ?? this.getDefaultModel(),\n      audio,\n      language: options?.language ?? this.config.language,\n      outputFormat: options?.outputFormat,\n      includeTimestamps: options?.includeTimestamps,\n      timestampGranularity: options?.timestampGranularity,\n      prompt: options?.prompt,\n      temperature: options?.temperature ?? this.config.temperature,\n      vendorOptions: options?.vendorOptions,\n    };\n\n    return this.provider.transcribe(fullOptions);\n  }\n\n  /**\n   * Transcribe audio file by path\n   *\n   * @param filePath - Path to audio file\n   * @param options - Optional transcription parameters\n   */\n  async transcribeFile(\n    filePath: string,\n    options?: Partial<Omit<STTOptions, 'model' | 'audio'>>\n  ): Promise<STTResponse> {\n    const audio = await fs.readFile(filePath);\n    return this.transcribe(audio, options);\n  }\n\n  /**\n   * Transcribe audio with word or segment timestamps\n   *\n   * @param audio - Audio data as Buffer or file path\n   * @param granularity - Timestamp granularity ('word' or 'segment')\n   * @param options - Optional transcription parameters\n   */\n  async transcribeWithTimestamps(\n    audio: Buffer | string,\n    granularity: 'word' | 'segment' = 'segment',\n    options?: Partial<Omit<STTOptions, 'model' | 'audio' | 'includeTimestamps' | 'timestampGranularity'>>\n  ): Promise<STTResponse> {\n    return this.transcribe(audio, {\n      ...options,\n      outputFormat: 'verbose_json',\n      includeTimestamps: true,\n      timestampGranularity: granularity,\n    });\n  }\n\n  /**\n   * Translate audio to English text\n   * Note: Only supported by some models (e.g., Whisper)\n   *\n   * @param audio - Audio data as Buffer or file path\n   * @param options - Optional transcription parameters\n   */\n  async translate(\n    audio: Buffer | string,\n    options?: Partial<Omit<STTOptions, 'model' | 'audio'>>\n  ): Promise<STTResponse> {\n    if (!this.provider.translate) {\n      throw new Error('Translation not supported by this provider');\n    }\n\n    const fullOptions: STTOptions = {\n      model: this.config.model ?? this.getDefaultModel(),\n      audio,\n      outputFormat: options?.outputFormat,\n      prompt: options?.prompt,\n      temperature: options?.temperature ?? this.config.temperature,\n      vendorOptions: options?.vendorOptions,\n    };\n\n    return this.provider.translate(fullOptions);\n  }\n\n  // ======================== Introspection Methods ========================\n\n  /**\n   * Get model information for current or specified model\n   */\n  getModelInfo(model?: string): ISTTModelDescription {\n    const targetModel = model ?? this.config.model ?? this.getDefaultModel();\n    const info = getSTTModelInfo(targetModel);\n\n    if (!info) {\n      throw new Error(`Unknown STT model: ${targetModel}`);\n    }\n\n    return info;\n  }\n\n  /**\n   * Get model capabilities\n   */\n  getModelCapabilities(model?: string) {\n    return this.getModelInfo(model).capabilities;\n  }\n\n  /**\n   * List all available models for this provider's vendor\n   */\n  listAvailableModels(): ISTTModelDescription[] {\n    const vendor = this.provider.vendor;\n    if (!vendor) {\n      return [];\n    }\n    return getSTTModelsByVendor(vendor as any);\n  }\n\n  /**\n   * Check if a specific feature is supported by the model\n   */\n  supportsFeature(\n    feature: keyof ISTTModelDescription['capabilities']['features'],\n    model?: string\n  ): boolean {\n    const caps = this.getModelCapabilities(model);\n    return Boolean(caps.features[feature]);\n  }\n\n  /**\n   * Get supported input audio formats\n   */\n  getSupportedInputFormats(model?: string): readonly string[] | string[] {\n    return this.getModelCapabilities(model).inputFormats;\n  }\n\n  /**\n   * Get supported output formats\n   */\n  getSupportedOutputFormats(model?: string): readonly string[] {\n    return this.getModelCapabilities(model).outputFormats;\n  }\n\n  /**\n   * Get supported languages (empty array = auto-detect all)\n   */\n  getSupportedLanguages(model?: string): readonly string[] {\n    return this.getModelCapabilities(model).languages;\n  }\n\n  /**\n   * Check if timestamps are supported\n   */\n  supportsTimestamps(model?: string): boolean {\n    return this.getModelCapabilities(model).timestamps.supported;\n  }\n\n  /**\n   * Check if translation is supported\n   */\n  supportsTranslation(model?: string): boolean {\n    return this.supportsFeature('translation', model);\n  }\n\n  /**\n   * Check if speaker diarization is supported\n   */\n  supportsDiarization(model?: string): boolean {\n    return this.supportsFeature('diarization', model);\n  }\n\n  /**\n   * Get timestamp granularities supported\n   */\n  getTimestampGranularities(model?: string): ('word' | 'segment')[] | undefined {\n    return this.getModelCapabilities(model).timestamps.granularities;\n  }\n\n  // ======================== Configuration Methods ========================\n\n  /**\n   * Update default model\n   */\n  setModel(model: string): void {\n    this.config.model = model;\n  }\n\n  /**\n   * Update default language\n   */\n  setLanguage(language: string): void {\n    this.config.language = language;\n  }\n\n  /**\n   * Update default temperature\n   */\n  setTemperature(temperature: number): void {\n    this.config.temperature = temperature;\n  }\n\n  // ======================== Private Methods ========================\n\n  /**\n   * Get default model (first active model for vendor)\n   */\n  private getDefaultModel(): string {\n    const models = this.listAvailableModels();\n    const firstModel = models[0];\n    if (!firstModel) {\n      throw new Error('No STT models available for this provider');\n    }\n    return firstModel.name;\n  }\n}\n","/**\n * OpenAI Image Generation provider\n * Supports: gpt-image-1, dall-e-3, dall-e-2\n */\n\nimport OpenAI from 'openai';\nimport * as fs from 'fs';\nimport { BaseMediaProvider } from '../base/BaseMediaProvider.js';\nimport type {\n  IImageProvider,\n  ImageGenerateOptions,\n  ImageEditOptions,\n  ImageVariationOptions,\n  ImageResponse,\n} from '../../../domain/interfaces/IImageProvider.js';\nimport type { ProviderCapabilities } from '../../../domain/interfaces/IProvider.js';\nimport type { OpenAIMediaConfig } from '../../../domain/types/ProviderConfig.js';\nimport {\n  ProviderAuthError,\n  ProviderRateLimitError,\n  ProviderError,\n} from '../../../domain/errors/AIErrors.js';\n\nexport class OpenAIImageProvider extends BaseMediaProvider implements IImageProvider {\n  readonly name: string = 'openai-image';\n  readonly vendor = 'openai' as const;\n  readonly capabilities: ProviderCapabilities = {\n    text: false,\n    images: true,\n    videos: false,\n    audio: false,\n    features: {\n      imageGeneration: true,\n      imageEditing: true,\n    },\n  };\n\n  private client: OpenAI;\n\n  constructor(config: OpenAIMediaConfig) {\n    super({ apiKey: config.auth.apiKey, ...config });\n\n    this.client = new OpenAI({\n      apiKey: config.auth.apiKey,\n      baseURL: config.baseURL,\n      organization: config.organization,\n      timeout: config.timeout,\n      maxRetries: config.maxRetries,\n    });\n  }\n\n  /**\n   * Generate images from a text prompt\n   */\n  async generateImage(options: ImageGenerateOptions): Promise<ImageResponse> {\n    return this.executeWithCircuitBreaker(\n      async () => {\n        try {\n          this.logOperationStart('image.generate', {\n            model: options.model,\n            size: options.size,\n            quality: options.quality,\n            n: options.n,\n          });\n\n          const response = await this.client.images.generate({\n            model: options.model,\n            prompt: options.prompt,\n            size: options.size as any,\n            quality: options.quality,\n            style: options.style,\n            n: options.n || 1,\n            response_format: options.response_format || 'b64_json',\n          });\n\n          const data = response.data || [];\n\n          this.logOperationComplete('image.generate', {\n            model: options.model,\n            imagesGenerated: data.length,\n          });\n\n          return {\n            created: response.created,\n            data: data.map((img) => ({\n              url: img.url,\n              b64_json: img.b64_json,\n              revised_prompt: img.revised_prompt,\n            })),\n          };\n        } catch (error: any) {\n          this.handleError(error);\n          throw error; // TypeScript needs this\n        }\n      },\n      'image.generate',\n      { model: options.model }\n    );\n  }\n\n  /**\n   * Edit an existing image with a prompt\n   * Supported by: gpt-image-1, dall-e-2\n   */\n  async editImage(options: ImageEditOptions): Promise<ImageResponse> {\n    return this.executeWithCircuitBreaker(\n      async () => {\n        try {\n          this.logOperationStart('image.edit', {\n            model: options.model,\n            size: options.size,\n            n: options.n,\n          });\n\n          // Prepare the image - handle both Buffer and file path\n          const image = this.prepareImageInput(options.image);\n          const mask = options.mask ? this.prepareImageInput(options.mask) : undefined;\n\n          const response = await this.client.images.edit({\n            model: options.model,\n            image,\n            prompt: options.prompt,\n            mask,\n            size: options.size as any,\n            n: options.n || 1,\n            response_format: options.response_format || 'b64_json',\n          });\n\n          const data = response.data || [];\n\n          this.logOperationComplete('image.edit', {\n            model: options.model,\n            imagesGenerated: data.length,\n          });\n\n          return {\n            created: response.created,\n            data: data.map((img) => ({\n              url: img.url,\n              b64_json: img.b64_json,\n              revised_prompt: img.revised_prompt,\n            })),\n          };\n        } catch (error: any) {\n          this.handleError(error);\n          throw error;\n        }\n      },\n      'image.edit',\n      { model: options.model }\n    );\n  }\n\n  /**\n   * Create variations of an existing image\n   * Supported by: dall-e-2 only\n   */\n  async createVariation(options: ImageVariationOptions): Promise<ImageResponse> {\n    return this.executeWithCircuitBreaker(\n      async () => {\n        try {\n          this.logOperationStart('image.variation', {\n            model: options.model,\n            size: options.size,\n            n: options.n,\n          });\n\n          // Prepare the image\n          const image = this.prepareImageInput(options.image);\n\n          const response = await this.client.images.createVariation({\n            model: options.model,\n            image,\n            size: options.size as any,\n            n: options.n || 1,\n            response_format: options.response_format || 'b64_json',\n          });\n\n          const data = response.data || [];\n\n          this.logOperationComplete('image.variation', {\n            model: options.model,\n            imagesGenerated: data.length,\n          });\n\n          return {\n            created: response.created,\n            data: data.map((img) => ({\n              url: img.url,\n              b64_json: img.b64_json,\n              revised_prompt: img.revised_prompt,\n            })),\n          };\n        } catch (error: any) {\n          this.handleError(error);\n          throw error;\n        }\n      },\n      'image.variation',\n      { model: options.model }\n    );\n  }\n\n  /**\n   * List available image models\n   */\n  async listModels(): Promise<string[]> {\n    return ['gpt-image-1', 'dall-e-3', 'dall-e-2'];\n  }\n\n  /**\n   * Prepare image input (Buffer or file path) for OpenAI API\n   */\n  private prepareImageInput(image: Buffer | string): any {\n    if (Buffer.isBuffer(image)) {\n      // OpenAI accepts File objects, we create a blob-like structure\n      return new File([image], 'image.png', { type: 'image/png' });\n    }\n\n    // It's a file path - create a readable stream\n    return fs.createReadStream(image);\n  }\n\n  /**\n   * Handle OpenAI API errors\n   */\n  private handleError(error: any): never {\n    const message = error.message || 'Unknown OpenAI API error';\n    const status = error.status;\n\n    if (status === 401) {\n      throw new ProviderAuthError('openai', 'Invalid API key');\n    }\n\n    if (status === 429) {\n      throw new ProviderRateLimitError('openai', message);\n    }\n\n    if (status === 400) {\n      // Check for specific image-related errors\n      if (message.includes('safety system')) {\n        throw new ProviderError('openai', `Content policy violation: ${message}`);\n      }\n      throw new ProviderError('openai', `Bad request: ${message}`);\n    }\n\n    throw new ProviderError('openai', message);\n  }\n}\n","/**\n * Google Imagen Image Generation provider\n * Supports: imagen-3.0-generate-002, imagen-3.0-fast-generate-001, imagen-3.0-capability-001\n */\n\nimport { GoogleGenAI } from '@google/genai';\nimport { BaseMediaProvider } from '../base/BaseMediaProvider.js';\nimport type {\n  IImageProvider,\n  ImageGenerateOptions,\n  ImageEditOptions,\n  ImageResponse,\n} from '../../../domain/interfaces/IImageProvider.js';\nimport type { ProviderCapabilities } from '../../../domain/interfaces/IProvider.js';\nimport type { GoogleConfig } from '../../../domain/types/ProviderConfig.js';\nimport {\n  ProviderAuthError,\n  ProviderRateLimitError,\n  ProviderError,\n} from '../../../domain/errors/AIErrors.js';\n\n/**\n * Extended options for Google image generation\n */\nexport interface GoogleImageGenerateOptions extends ImageGenerateOptions {\n  /** Negative prompt - what to avoid */\n  negativePrompt?: string;\n  /** Aspect ratio (1:1, 3:4, 4:3, 9:16, 16:9) */\n  aspectRatio?: '1:1' | '3:4' | '4:3' | '9:16' | '16:9';\n  /** Random seed for reproducible generation */\n  seed?: number;\n  /** Output MIME type */\n  outputMimeType?: 'image/png' | 'image/jpeg';\n  /** Include safety filter reason in response */\n  includeRaiReason?: boolean;\n}\n\nexport class GoogleImageProvider extends BaseMediaProvider implements IImageProvider {\n  readonly name: string = 'google-image';\n  readonly vendor = 'google' as const;\n  readonly capabilities: ProviderCapabilities = {\n    text: false,\n    images: true,\n    videos: false,\n    audio: false,\n    features: {\n      imageGeneration: true,\n      imageEditing: true,\n    },\n  };\n\n  private client: GoogleGenAI;\n\n  constructor(config: GoogleConfig) {\n    super(config);\n\n    this.client = new GoogleGenAI({\n      apiKey: config.apiKey,\n    });\n  }\n\n  /**\n   * Generate images from a text prompt using Google Imagen\n   */\n  async generateImage(options: ImageGenerateOptions): Promise<ImageResponse> {\n    return this.executeWithCircuitBreaker(\n      async () => {\n        try {\n          this.logOperationStart('image.generate', {\n            model: options.model,\n            n: options.n,\n          });\n\n          const googleOptions = options as GoogleImageGenerateOptions;\n\n          const response = await this.client.models.generateImages({\n            model: options.model,\n            prompt: options.prompt,\n            config: {\n              numberOfImages: options.n || 1,\n              negativePrompt: googleOptions.negativePrompt,\n              aspectRatio: googleOptions.aspectRatio,\n              seed: googleOptions.seed,\n              outputMimeType: googleOptions.outputMimeType,\n              includeRaiReason: googleOptions.includeRaiReason,\n            },\n          });\n\n          const images = response.generatedImages || [];\n\n          this.logOperationComplete('image.generate', {\n            model: options.model,\n            imagesGenerated: images.length,\n          });\n\n          return {\n            created: Math.floor(Date.now() / 1000),\n            data: images.map((img: any) => ({\n              b64_json: img.image?.imageBytes,\n              // Google doesn't provide URLs, only base64\n            })),\n          };\n        } catch (error: any) {\n          this.handleError(error);\n          throw error;\n        }\n      },\n      'image.generate',\n      { model: options.model }\n    );\n  }\n\n  /**\n   * Edit an existing image using Imagen capability model\n   * Uses imagen-3.0-capability-001\n   */\n  async editImage(options: ImageEditOptions): Promise<ImageResponse> {\n    return this.executeWithCircuitBreaker(\n      async () => {\n        try {\n          this.logOperationStart('image.edit', {\n            model: options.model,\n            n: options.n,\n          });\n\n          // Prepare the reference image\n          const referenceImage = await this.prepareReferenceImage(options.image);\n\n          const response = await this.client.models.editImage({\n            model: options.model || 'imagen-3.0-capability-001',\n            prompt: options.prompt,\n            referenceImages: [referenceImage],\n            config: {\n              numberOfImages: options.n || 1,\n            },\n          });\n\n          const images = response.generatedImages || [];\n\n          this.logOperationComplete('image.edit', {\n            model: options.model,\n            imagesGenerated: images.length,\n          });\n\n          return {\n            created: Math.floor(Date.now() / 1000),\n            data: images.map((img: any) => ({\n              b64_json: img.image?.imageBytes,\n            })),\n          };\n        } catch (error: any) {\n          this.handleError(error);\n          throw error;\n        }\n      },\n      'image.edit',\n      { model: options.model }\n    );\n  }\n\n  /**\n   * List available image models\n   */\n  async listModels(): Promise<string[]> {\n    return [\n      'imagen-4.0-generate-001',\n      'imagen-4.0-ultra-generate-001',\n      'imagen-4.0-fast-generate-001',\n    ];\n  }\n\n  /**\n   * Prepare a reference image for Google's editImage API\n   */\n  private async prepareReferenceImage(image: Buffer | string): Promise<any> {\n    let imageBytes: string;\n\n    if (Buffer.isBuffer(image)) {\n      imageBytes = image.toString('base64');\n    } else {\n      // It's a file path - read and convert\n      const fs = await import('fs');\n      const buffer = fs.readFileSync(image);\n      imageBytes = buffer.toString('base64');\n    }\n\n    // Return a subject reference image structure\n    return {\n      referenceImage: {\n        image: {\n          imageBytes,\n        },\n      },\n      referenceType: 'REFERENCE_TYPE_SUBJECT',\n    };\n  }\n\n  /**\n   * Handle Google API errors\n   */\n  private handleError(error: any): never {\n    const message = error.message || 'Unknown Google API error';\n    const status = error.status || error.code;\n\n    if (status === 401 || message.includes('API key not valid')) {\n      throw new ProviderAuthError('google', 'Invalid API key');\n    }\n\n    if (status === 429 || message.includes('Resource exhausted')) {\n      throw new ProviderRateLimitError('google', message);\n    }\n\n    if (status === 400) {\n      // Check for safety-related errors\n      if (\n        message.includes('SAFETY') ||\n        message.includes('blocked') ||\n        message.includes('Responsible AI')\n      ) {\n        throw new ProviderError('google', `Content policy violation: ${message}`);\n      }\n      throw new ProviderError('google', `Bad request: ${message}`);\n    }\n\n    throw new ProviderError('google', message);\n  }\n}\n","/**\n * Factory functions for creating image providers\n */\n\nimport { Connector } from './Connector.js';\nimport type { IImageProvider } from '../domain/interfaces/IImageProvider.js';\nimport { Vendor } from './Vendor.js';\nimport { OpenAIImageProvider } from '../infrastructure/providers/openai/OpenAIImageProvider.js';\nimport { GoogleImageProvider } from '../infrastructure/providers/google/GoogleImageProvider.js';\nimport type { OpenAIMediaConfig, GoogleConfig } from '../domain/types/ProviderConfig.js';\n\n/**\n * Create an Image Generation provider from a connector\n */\nexport function createImageProvider(connector: Connector): IImageProvider {\n  const vendor = connector.vendor;\n\n  switch (vendor) {\n    case Vendor.OpenAI:\n      return new OpenAIImageProvider(extractOpenAIConfig(connector));\n\n    case Vendor.Google:\n      return new GoogleImageProvider(extractGoogleConfig(connector));\n\n    default:\n      throw new Error(\n        `No Image provider available for vendor: ${vendor}. ` +\n        `Supported vendors: ${Vendor.OpenAI}, ${Vendor.Google}`\n      );\n  }\n}\n\n/**\n * Extract OpenAI configuration from connector\n */\nfunction extractOpenAIConfig(connector: Connector): OpenAIMediaConfig {\n  const auth = connector.config.auth;\n\n  if (auth.type !== 'api_key') {\n    throw new Error('OpenAI requires API key authentication');\n  }\n\n  const options = connector.getOptions();\n\n  return {\n    auth: {\n      type: 'api_key',\n      apiKey: auth.apiKey,\n    },\n    baseURL: connector.baseURL,\n    organization: options.organization as string | undefined,\n    timeout: options.timeout as number | undefined,\n    maxRetries: options.maxRetries as number | undefined,\n  };\n}\n\n/**\n * Extract Google configuration from connector\n */\nfunction extractGoogleConfig(connector: Connector): GoogleConfig {\n  const auth = connector.config.auth;\n\n  if (auth.type !== 'api_key') {\n    throw new Error('Google requires API key authentication');\n  }\n\n  return {\n    apiKey: auth.apiKey,\n  };\n}\n","/**\n * Image generation model registry with comprehensive metadata\n */\n\nimport { Vendor } from '../../core/Vendor.js';\nimport type { IBaseModelDescription, VendorOptionSchema } from '../types/SharedTypes.js';\nimport { createRegistryHelpers } from './RegistryUtils.js';\n\n// =============================================================================\n// Types\n// =============================================================================\n\n/**\n * Supported image sizes by model\n */\nexport type ImageSize =\n  | '256x256'\n  | '512x512'\n  | '1024x1024'\n  | '1024x1536'\n  | '1536x1024'\n  | '1792x1024'\n  | '1024x1792'\n  | 'auto';\n\n/**\n * Supported aspect ratios (Google Imagen)\n */\nexport type AspectRatio = '1:1' | '3:4' | '4:3' | '9:16' | '16:9';\n\n/**\n * Image model capabilities\n */\nexport interface ImageModelCapabilities {\n  /** Supported image sizes */\n  sizes: readonly ImageSize[];\n\n  /** Supported aspect ratios (Google) */\n  aspectRatios?: readonly AspectRatio[];\n\n  /** Maximum number of images per request */\n  maxImagesPerRequest: number;\n\n  /** Supported output formats */\n  outputFormats: readonly string[];\n\n  /** Feature support flags */\n  features: {\n    /** Text-to-image generation */\n    generation: boolean;\n    /** Image editing/inpainting */\n    editing: boolean;\n    /** Image variations */\n    variations: boolean;\n    /** Style control */\n    styleControl: boolean;\n    /** Quality control (standard/hd) */\n    qualityControl: boolean;\n    /** Transparent backgrounds */\n    transparency: boolean;\n    /** Prompt revision/enhancement */\n    promptRevision: boolean;\n  };\n\n  /** Model limits */\n  limits: {\n    /** Maximum prompt length in characters */\n    maxPromptLength: number;\n    /** Rate limit (requests per minute) */\n    maxRequestsPerMinute?: number;\n  };\n\n  /** Vendor-specific options schema */\n  vendorOptions?: Record<string, VendorOptionSchema>;\n}\n\n/**\n * Image model pricing\n */\nexport interface ImageModelPricing {\n  /** Cost per image at standard quality */\n  perImageStandard?: number;\n  /** Cost per image at HD quality */\n  perImageHD?: number;\n  /** Cost per image (flat rate) */\n  perImage?: number;\n  currency: 'USD';\n}\n\n/**\n * Complete image model description\n */\nexport interface IImageModelDescription extends IBaseModelDescription {\n  capabilities: ImageModelCapabilities;\n  pricing?: ImageModelPricing;\n}\n\n// =============================================================================\n// Model Constants\n// =============================================================================\n\nexport const IMAGE_MODELS = {\n  [Vendor.OpenAI]: {\n    /** GPT-Image-1: Latest OpenAI image model with best quality */\n    GPT_IMAGE_1: 'gpt-image-1',\n    /** DALL-E 3: High quality image generation */\n    DALL_E_3: 'dall-e-3',\n    /** DALL-E 2: Fast, supports editing and variations */\n    DALL_E_2: 'dall-e-2',\n  },\n  [Vendor.Google]: {\n    /** Imagen 4.0: Latest Google image generation model */\n    IMAGEN_4_GENERATE: 'imagen-4.0-generate-001',\n    /** Imagen 4.0 Ultra: Highest quality */\n    IMAGEN_4_ULTRA: 'imagen-4.0-ultra-generate-001',\n    /** Imagen 4.0 Fast: Optimized for speed */\n    IMAGEN_4_FAST: 'imagen-4.0-fast-generate-001',\n  },\n} as const;\n\n// =============================================================================\n// Registry\n// =============================================================================\n\n/**\n * Complete image model registry\n * Last full audit: January 2026\n */\nexport const IMAGE_MODEL_REGISTRY: Record<string, IImageModelDescription> = {\n  // ======================== OpenAI ========================\n\n  'gpt-image-1': {\n    name: 'gpt-image-1',\n    displayName: 'GPT-Image-1',\n    provider: Vendor.OpenAI,\n    description: 'OpenAI latest image generation model with best quality and features',\n    isActive: true,\n    releaseDate: '2025-04-01',\n    sources: {\n      documentation: 'https://platform.openai.com/docs/guides/images',\n      pricing: 'https://openai.com/pricing',\n      lastVerified: '2026-01-25',\n    },\n    capabilities: {\n      sizes: ['1024x1024', '1024x1536', '1536x1024', 'auto'],\n      maxImagesPerRequest: 1,\n      outputFormats: ['png', 'webp', 'jpeg'],\n      features: {\n        generation: true,\n        editing: true,\n        variations: false,\n        styleControl: false,\n        qualityControl: true,\n        transparency: true,\n        promptRevision: false,\n      },\n      limits: { maxPromptLength: 32000 },\n      vendorOptions: {\n        background: {\n          type: 'string',\n          description: 'Background setting: transparent, opaque, or auto',\n        },\n        output_format: {\n          type: 'string',\n          description: 'Output format: png, webp, or jpeg',\n        },\n      },\n    },\n    pricing: {\n      perImageStandard: 0.011,\n      perImageHD: 0.042,\n      currency: 'USD',\n    },\n  },\n\n  'dall-e-3': {\n    name: 'dall-e-3',\n    displayName: 'DALL-E 3',\n    provider: Vendor.OpenAI,\n    description: 'High quality image generation with prompt revision',\n    isActive: true,\n    releaseDate: '2023-11-06',\n    sources: {\n      documentation: 'https://platform.openai.com/docs/guides/images',\n      pricing: 'https://openai.com/pricing',\n      lastVerified: '2026-01-25',\n    },\n    capabilities: {\n      sizes: ['1024x1024', '1024x1792', '1792x1024'],\n      maxImagesPerRequest: 1,\n      outputFormats: ['png', 'url'],\n      features: {\n        generation: true,\n        editing: false,\n        variations: false,\n        styleControl: true,\n        qualityControl: true,\n        transparency: false,\n        promptRevision: true,\n      },\n      limits: { maxPromptLength: 4000 },\n      vendorOptions: {\n        style: {\n          type: 'string',\n          description: 'Style: vivid (hyper-real) or natural (more natural)',\n        },\n      },\n    },\n    pricing: {\n      perImageStandard: 0.040,\n      perImageHD: 0.080,\n      currency: 'USD',\n    },\n  },\n\n  'dall-e-2': {\n    name: 'dall-e-2',\n    displayName: 'DALL-E 2',\n    provider: Vendor.OpenAI,\n    description: 'Fast image generation with editing and variation support',\n    isActive: true,\n    releaseDate: '2022-11-03',\n    sources: {\n      documentation: 'https://platform.openai.com/docs/guides/images',\n      pricing: 'https://openai.com/pricing',\n      lastVerified: '2026-01-25',\n    },\n    capabilities: {\n      sizes: ['256x256', '512x512', '1024x1024'],\n      maxImagesPerRequest: 10,\n      outputFormats: ['png', 'url'],\n      features: {\n        generation: true,\n        editing: true,\n        variations: true,\n        styleControl: false,\n        qualityControl: false,\n        transparency: false,\n        promptRevision: false,\n      },\n      limits: { maxPromptLength: 1000 },\n    },\n    pricing: {\n      perImage: 0.020,\n      currency: 'USD',\n    },\n  },\n\n  // ======================== Google ========================\n\n  'imagen-4.0-generate-001': {\n    name: 'imagen-4.0-generate-001',\n    displayName: 'Imagen 4.0 Generate',\n    provider: Vendor.Google,\n    description: 'Google Imagen 4.0 - standard quality image generation',\n    isActive: true,\n    releaseDate: '2025-06-01',\n    sources: {\n      documentation: 'https://ai.google.dev/gemini-api/docs/imagen',\n      pricing: 'https://ai.google.dev/pricing',\n      lastVerified: '2026-01-25',\n    },\n    capabilities: {\n      sizes: ['1024x1024'],\n      aspectRatios: ['1:1', '3:4', '4:3', '9:16', '16:9'],\n      maxImagesPerRequest: 4,\n      outputFormats: ['png', 'jpeg'],\n      features: {\n        generation: true,\n        editing: false,\n        variations: false,\n        styleControl: false,\n        qualityControl: false,\n        transparency: false,\n        promptRevision: false,\n      },\n      limits: { maxPromptLength: 480 },\n      vendorOptions: {\n        negativePrompt: {\n          type: 'string',\n          description: 'Description of what to avoid in the image',\n        },\n        seed: {\n          type: 'number',\n          description: 'Random seed for reproducible generation',\n        },\n        aspectRatio: {\n          type: 'string',\n          description: 'Aspect ratio: 1:1, 3:4, 4:3, 9:16, or 16:9',\n        },\n      },\n    },\n    pricing: {\n      perImage: 0.04,\n      currency: 'USD',\n    },\n  },\n\n  'imagen-4.0-ultra-generate-001': {\n    name: 'imagen-4.0-ultra-generate-001',\n    displayName: 'Imagen 4.0 Ultra',\n    provider: Vendor.Google,\n    description: 'Google Imagen 4.0 Ultra - highest quality image generation',\n    isActive: true,\n    releaseDate: '2025-06-01',\n    sources: {\n      documentation: 'https://ai.google.dev/gemini-api/docs/imagen',\n      pricing: 'https://ai.google.dev/pricing',\n      lastVerified: '2026-01-25',\n    },\n    capabilities: {\n      sizes: ['1024x1024'],\n      aspectRatios: ['1:1', '3:4', '4:3', '9:16', '16:9'],\n      maxImagesPerRequest: 4,\n      outputFormats: ['png', 'jpeg'],\n      features: {\n        generation: true,\n        editing: false,\n        variations: false,\n        styleControl: false,\n        qualityControl: true,\n        transparency: false,\n        promptRevision: false,\n      },\n      limits: { maxPromptLength: 480 },\n    },\n    pricing: {\n      perImage: 0.08,\n      currency: 'USD',\n    },\n  },\n\n  'imagen-4.0-fast-generate-001': {\n    name: 'imagen-4.0-fast-generate-001',\n    displayName: 'Imagen 4.0 Fast',\n    provider: Vendor.Google,\n    description: 'Google Imagen 4.0 Fast - optimized for speed',\n    isActive: true,\n    releaseDate: '2025-06-01',\n    sources: {\n      documentation: 'https://ai.google.dev/gemini-api/docs/imagen',\n      pricing: 'https://ai.google.dev/pricing',\n      lastVerified: '2026-01-25',\n    },\n    capabilities: {\n      sizes: ['1024x1024'],\n      aspectRatios: ['1:1', '3:4', '4:3', '9:16', '16:9'],\n      maxImagesPerRequest: 4,\n      outputFormats: ['png', 'jpeg'],\n      features: {\n        generation: true,\n        editing: false,\n        variations: false,\n        styleControl: false,\n        qualityControl: false,\n        transparency: false,\n        promptRevision: false,\n      },\n      limits: { maxPromptLength: 480 },\n    },\n    pricing: {\n      perImage: 0.02,\n      currency: 'USD',\n    },\n  },\n};\n\n// =============================================================================\n// Helper Functions (using shared utilities)\n// =============================================================================\n\nconst helpers = createRegistryHelpers(IMAGE_MODEL_REGISTRY);\n\nexport const getImageModelInfo = helpers.getInfo;\nexport const getImageModelsByVendor = helpers.getByVendor;\nexport const getActiveImageModels = helpers.getActive;\n\n/**\n * Get image models that support a specific feature\n */\nexport function getImageModelsWithFeature(\n  feature: keyof IImageModelDescription['capabilities']['features']\n): IImageModelDescription[] {\n  return Object.values(IMAGE_MODEL_REGISTRY).filter(\n    (model) => model.isActive && model.capabilities.features[feature]\n  );\n}\n\n/**\n * Calculate estimated cost for image generation\n */\nexport function calculateImageCost(\n  modelName: string,\n  imageCount: number,\n  quality: 'standard' | 'hd' = 'standard'\n): number | null {\n  const model = getImageModelInfo(modelName);\n  if (!model?.pricing) return null;\n\n  if (model.pricing.perImage) {\n    return imageCount * model.pricing.perImage;\n  }\n\n  const pricePerImage =\n    quality === 'hd' ? model.pricing.perImageHD : model.pricing.perImageStandard;\n\n  if (!pricePerImage) return null;\n  return imageCount * pricePerImage;\n}\n","/**\n * ImageGeneration - High-level image generation capability\n *\n * Provides a unified interface for generating images across multiple vendors.\n *\n * @example\n * ```typescript\n * import { ImageGeneration, Connector, Vendor } from '@oneringai/agents';\n *\n * Connector.create({\n *   name: 'openai',\n *   vendor: Vendor.OpenAI,\n *   auth: { type: 'api_key', apiKey: process.env.OPENAI_API_KEY! },\n * });\n *\n * const imageGen = ImageGeneration.create({ connector: 'openai' });\n *\n * const result = await imageGen.generate({\n *   prompt: 'A futuristic city at sunset',\n *   model: 'dall-e-3',\n *   size: '1024x1024',\n *   quality: 'hd',\n * });\n *\n * // Get base64 data\n * console.log(result.data[0].b64_json);\n * ```\n */\n\nimport { Connector } from '../../core/Connector.js';\nimport { createImageProvider } from '../../core/createImageProvider.js';\nimport type {\n  IImageProvider,\n  ImageGenerateOptions,\n  ImageEditOptions,\n  ImageVariationOptions,\n  ImageResponse,\n} from '../../domain/interfaces/IImageProvider.js';\nimport { IMAGE_MODELS, getImageModelInfo } from '../../domain/entities/ImageModel.js';\nimport { Vendor } from '../../core/Vendor.js';\n\n/**\n * Options for creating an ImageGeneration instance\n */\nexport interface ImageGenerationCreateOptions {\n  /** Connector name or instance */\n  connector: string | Connector;\n}\n\n/**\n * Simplified options for quick generation\n */\nexport interface SimpleGenerateOptions {\n  /** Text prompt describing the image */\n  prompt: string;\n  /** Model to use (defaults to vendor's best model) */\n  model?: string;\n  /** Image size */\n  size?: string;\n  /** Quality setting */\n  quality?: 'standard' | 'hd';\n  /** Style setting (DALL-E 3 only) */\n  style?: 'vivid' | 'natural';\n  /** Number of images to generate */\n  n?: number;\n  /** Response format */\n  response_format?: 'url' | 'b64_json';\n}\n\n/**\n * ImageGeneration capability class\n */\nexport class ImageGeneration {\n  private provider: IImageProvider;\n  private connector: Connector;\n  private defaultModel: string;\n\n  private constructor(connector: Connector) {\n    this.connector = connector;\n    this.provider = createImageProvider(connector);\n    this.defaultModel = this.getDefaultModel();\n  }\n\n  /**\n   * Create an ImageGeneration instance\n   */\n  static create(options: ImageGenerationCreateOptions): ImageGeneration {\n    const connector =\n      typeof options.connector === 'string'\n        ? Connector.get(options.connector)\n        : options.connector;\n\n    if (!connector) {\n      throw new Error(`Connector not found: ${options.connector}`);\n    }\n\n    return new ImageGeneration(connector);\n  }\n\n  /**\n   * Generate images from a text prompt\n   */\n  async generate(options: SimpleGenerateOptions): Promise<ImageResponse> {\n    const fullOptions: ImageGenerateOptions = {\n      model: options.model || this.defaultModel,\n      prompt: options.prompt,\n      size: options.size,\n      quality: options.quality,\n      style: options.style,\n      n: options.n,\n      response_format: options.response_format || 'b64_json',\n    };\n\n    return this.provider.generateImage(fullOptions);\n  }\n\n  /**\n   * Edit an existing image\n   * Note: Not all models/vendors support this\n   */\n  async edit(options: ImageEditOptions): Promise<ImageResponse> {\n    if (!this.provider.editImage) {\n      throw new Error(`Image editing not supported by ${this.provider.name}`);\n    }\n\n    const fullOptions: ImageEditOptions = {\n      ...options,\n      model: options.model || this.getEditModel(),\n    };\n\n    return this.provider.editImage(fullOptions);\n  }\n\n  /**\n   * Create variations of an existing image\n   * Note: Only DALL-E 2 supports this\n   */\n  async createVariation(options: ImageVariationOptions): Promise<ImageResponse> {\n    if (!this.provider.createVariation) {\n      throw new Error(`Image variations not supported by ${this.provider.name}`);\n    }\n\n    const fullOptions: ImageVariationOptions = {\n      ...options,\n      model: options.model || 'dall-e-2', // Only DALL-E 2 supports variations\n    };\n\n    return this.provider.createVariation(fullOptions);\n  }\n\n  /**\n   * List available models for this provider\n   */\n  async listModels(): Promise<string[]> {\n    if (this.provider.listModels) {\n      return this.provider.listModels();\n    }\n\n    // Fallback to registry\n    const vendor = this.connector.vendor;\n    if (vendor && IMAGE_MODELS[vendor as keyof typeof IMAGE_MODELS]) {\n      return Object.values(IMAGE_MODELS[vendor as keyof typeof IMAGE_MODELS]);\n    }\n\n    return [];\n  }\n\n  /**\n   * Get information about a specific model\n   */\n  getModelInfo(modelName: string) {\n    return getImageModelInfo(modelName);\n  }\n\n  /**\n   * Get the underlying provider\n   */\n  getProvider(): IImageProvider {\n    return this.provider;\n  }\n\n  /**\n   * Get the current connector\n   */\n  getConnector(): Connector {\n    return this.connector;\n  }\n\n  /**\n   * Get the default model for this vendor\n   */\n  private getDefaultModel(): string {\n    const vendor = this.connector.vendor;\n\n    switch (vendor) {\n      case Vendor.OpenAI:\n        return IMAGE_MODELS[Vendor.OpenAI].DALL_E_3;\n      case Vendor.Google:\n        return IMAGE_MODELS[Vendor.Google].IMAGEN_4_GENERATE;\n      default:\n        throw new Error(`No default image model for vendor: ${vendor}`);\n    }\n  }\n\n  /**\n   * Get the default edit model for this vendor\n   */\n  private getEditModel(): string {\n    const vendor = this.connector.vendor;\n\n    switch (vendor) {\n      case Vendor.OpenAI:\n        return IMAGE_MODELS[Vendor.OpenAI].GPT_IMAGE_1;\n      case Vendor.Google:\n        // Imagen 4 doesn't have a separate editing model yet\n        return IMAGE_MODELS[Vendor.Google].IMAGEN_4_GENERATE;\n      default:\n        throw new Error(`No edit model for vendor: ${vendor}`);\n    }\n  }\n}\n","/**\n * OpenAI Sora Video Generation Provider\n * Supports: sora-2, sora-2-pro\n */\n\nimport OpenAI from 'openai';\nimport { BaseMediaProvider } from '../base/BaseMediaProvider.js';\nimport type {\n  IVideoProvider,\n  VideoGenerateOptions,\n  VideoExtendOptions,\n  VideoResponse,\n} from '../../../domain/interfaces/IVideoProvider.js';\nimport type { ProviderCapabilities } from '../../../domain/interfaces/IProvider.js';\nimport type { OpenAIMediaConfig } from '../../../domain/types/ProviderConfig.js';\nimport {\n  ProviderAuthError,\n  ProviderRateLimitError,\n  ProviderError,\n} from '../../../domain/errors/AIErrors.js';\n\nexport class OpenAISoraProvider extends BaseMediaProvider implements IVideoProvider {\n  readonly name: string = 'openai-video';\n  readonly vendor = 'openai' as const;\n  readonly capabilities: ProviderCapabilities = {\n    text: false,\n    images: false,\n    videos: true,\n    audio: false,\n    features: {\n      videoGeneration: true,\n      imageToVideo: true,\n      videoExtension: true,\n    },\n  };\n\n  private client: OpenAI;\n\n  constructor(config: OpenAIMediaConfig) {\n    super({ apiKey: config.auth.apiKey, ...config });\n\n    this.client = new OpenAI({\n      apiKey: config.auth.apiKey,\n      baseURL: config.baseURL,\n      organization: config.organization,\n      timeout: config.timeout,\n      maxRetries: config.maxRetries,\n    });\n  }\n\n  /**\n   * Generate a video from a text prompt\n   */\n  async generateVideo(options: VideoGenerateOptions): Promise<VideoResponse> {\n    return this.executeWithCircuitBreaker(\n      async () => {\n        try {\n          this.logOperationStart('video.generate', {\n            model: options.model,\n            duration: options.duration,\n            resolution: options.resolution,\n          });\n\n          const model = options.model || 'sora-2';\n          const duration = options.duration || 4;\n\n          // Build request parameters\n          const params: any = {\n            model,\n            prompt: options.prompt,\n            duration,\n          };\n\n          // Add resolution if specified\n          if (options.resolution) {\n            params.resolution = options.resolution;\n          } else if (options.aspectRatio) {\n            // Map aspect ratio to resolution\n            params.resolution = this.aspectRatioToResolution(options.aspectRatio);\n          }\n\n          // Add seed if specified\n          if (options.seed !== undefined) {\n            params.seed = options.seed;\n          }\n\n          // Add image for image-to-video\n          if (options.image) {\n            params.image = this.prepareImageInput(options.image);\n          }\n\n          // Call the OpenAI Videos API\n          const response = await (this.client as any).videos.create(params);\n\n          this.logOperationComplete('video.generate', {\n            model,\n            jobId: response.id,\n            status: response.status,\n          });\n\n          return this.mapResponse(response);\n        } catch (error: any) {\n          this.handleError(error);\n          throw error;\n        }\n      },\n      'video.generate',\n      { model: options.model }\n    );\n  }\n\n  /**\n   * Get the status of a video generation job\n   */\n  async getVideoStatus(jobId: string): Promise<VideoResponse> {\n    return this.executeWithCircuitBreaker(\n      async () => {\n        try {\n          this.logOperationStart('video.status', { jobId });\n\n          const response = await (this.client as any).videos.retrieve(jobId);\n\n          this.logOperationComplete('video.status', {\n            jobId,\n            status: response.status,\n          });\n\n          return this.mapResponse(response);\n        } catch (error: any) {\n          this.handleError(error);\n          throw error;\n        }\n      },\n      'video.status',\n      { jobId }\n    );\n  }\n\n  /**\n   * Download a completed video\n   */\n  async downloadVideo(jobId: string): Promise<Buffer> {\n    return this.executeWithCircuitBreaker(\n      async () => {\n        try {\n          this.logOperationStart('video.download', { jobId });\n\n          // First check status\n          const status = await this.getVideoStatus(jobId);\n          if (status.status !== 'completed') {\n            throw new ProviderError('openai', `Video not ready. Status: ${status.status}`);\n          }\n\n          if (!status.video?.url) {\n            throw new ProviderError('openai', 'No video URL available');\n          }\n\n          // Download the video\n          const response = await fetch(status.video.url);\n          if (!response.ok) {\n            throw new ProviderError('openai', `Failed to download video: ${response.statusText}`);\n          }\n\n          const buffer = Buffer.from(await response.arrayBuffer());\n\n          this.logOperationComplete('video.download', {\n            jobId,\n            size: buffer.length,\n          });\n\n          return buffer;\n        } catch (error: any) {\n          if (error instanceof ProviderError) throw error;\n          this.handleError(error);\n          throw error;\n        }\n      },\n      'video.download',\n      { jobId }\n    );\n  }\n\n  /**\n   * Extend an existing video\n   */\n  async extendVideo(options: VideoExtendOptions): Promise<VideoResponse> {\n    return this.executeWithCircuitBreaker(\n      async () => {\n        try {\n          this.logOperationStart('video.extend', {\n            model: options.model,\n            extendDuration: options.extendDuration,\n            direction: options.direction,\n          });\n\n          const params: any = {\n            model: options.model || 'sora-2',\n            video: this.prepareVideoInput(options.video),\n            extend_duration: options.extendDuration,\n          };\n\n          if (options.prompt) {\n            params.prompt = options.prompt;\n          }\n\n          if (options.direction) {\n            params.direction = options.direction;\n          }\n\n          const response = await (this.client as any).videos.extend(params);\n\n          this.logOperationComplete('video.extend', {\n            jobId: response.id,\n            status: response.status,\n          });\n\n          return this.mapResponse(response);\n        } catch (error: any) {\n          this.handleError(error);\n          throw error;\n        }\n      },\n      'video.extend',\n      { model: options.model }\n    );\n  }\n\n  /**\n   * List available video models\n   */\n  async listModels(): Promise<string[]> {\n    return ['sora-2', 'sora-2-pro'];\n  }\n\n  /**\n   * Cancel a pending job\n   */\n  async cancelJob(jobId: string): Promise<boolean> {\n    try {\n      await (this.client as any).videos.cancel(jobId);\n      return true;\n    } catch {\n      return false;\n    }\n  }\n\n  /**\n   * Map OpenAI response to our VideoResponse format\n   */\n  private mapResponse(response: any): VideoResponse {\n    const result: VideoResponse = {\n      jobId: response.id,\n      status: this.mapStatus(response.status),\n      created: response.created || Math.floor(Date.now() / 1000),\n    };\n\n    if (response.status === 'completed' && response.video) {\n      result.video = {\n        url: response.video.url,\n        duration: response.video.duration,\n        resolution: response.video.resolution,\n        format: 'mp4',\n      };\n\n      if (response.audio) {\n        result.audio = {\n          url: response.audio.url,\n        };\n      }\n    }\n\n    if (response.status === 'failed') {\n      result.error = response.error?.message || 'Video generation failed';\n    }\n\n    return result;\n  }\n\n  /**\n   * Map OpenAI status to our status type\n   */\n  private mapStatus(status: string): 'pending' | 'processing' | 'completed' | 'failed' {\n    switch (status) {\n      case 'queued':\n      case 'pending':\n        return 'pending';\n      case 'in_progress':\n      case 'processing':\n        return 'processing';\n      case 'completed':\n      case 'succeeded':\n        return 'completed';\n      case 'failed':\n      case 'cancelled':\n        return 'failed';\n      default:\n        return 'pending';\n    }\n  }\n\n  /**\n   * Map aspect ratio to resolution\n   */\n  private aspectRatioToResolution(aspectRatio: string): string {\n    const map: Record<string, string> = {\n      '16:9': '1280x720',\n      '9:16': '720x1280',\n      '1:1': '1024x1024',\n      '4:3': '1024x768',\n      '3:4': '768x1024',\n    };\n    return map[aspectRatio] || '1280x720';\n  }\n\n  /**\n   * Prepare image input for API\n   */\n  private prepareImageInput(image: Buffer | string): any {\n    if (Buffer.isBuffer(image)) {\n      return {\n        type: 'base64',\n        data: image.toString('base64'),\n      };\n    }\n    // Assume it's a URL or file path\n    return { type: 'url', url: image };\n  }\n\n  /**\n   * Prepare video input for API\n   */\n  private prepareVideoInput(video: Buffer | string): any {\n    if (Buffer.isBuffer(video)) {\n      return {\n        type: 'base64',\n        data: video.toString('base64'),\n      };\n    }\n    return { type: 'url', url: video };\n  }\n\n  /**\n   * Handle OpenAI API errors\n   */\n  private handleError(error: any): never {\n    const message = error.message || 'Unknown OpenAI API error';\n    const status = error.status;\n\n    if (status === 401) {\n      throw new ProviderAuthError('openai', 'Invalid API key');\n    }\n\n    if (status === 429) {\n      throw new ProviderRateLimitError('openai', message);\n    }\n\n    if (status === 400) {\n      if (message.includes('safety') || message.includes('policy')) {\n        throw new ProviderError('openai', `Content policy violation: ${message}`);\n      }\n      throw new ProviderError('openai', `Bad request: ${message}`);\n    }\n\n    throw new ProviderError('openai', message);\n  }\n}\n","/**\n * Google Veo Video Generation Provider\n * Supports: veo-2.0, veo-3.0, veo-3.0-fast, veo-3.1\n */\n\nimport { GoogleGenAI } from '@google/genai';\nimport { BaseMediaProvider } from '../base/BaseMediaProvider.js';\nimport type {\n  IVideoProvider,\n  VideoGenerateOptions,\n  VideoExtendOptions,\n  VideoResponse,\n  VideoStatus,\n} from '../../../domain/interfaces/IVideoProvider.js';\nimport type { ProviderCapabilities } from '../../../domain/interfaces/IProvider.js';\nimport type { GoogleMediaConfig } from '../../../domain/types/ProviderConfig.js';\nimport {\n  ProviderAuthError,\n  ProviderRateLimitError,\n  ProviderError,\n} from '../../../domain/errors/AIErrors.js';\n\n/**\n * Google Veo-specific options\n */\nexport interface GoogleVeoOptions {\n  /** Negative prompt (what to avoid) */\n  negativePrompt?: string;\n  /** Last frame image for interpolation */\n  lastFrame?: Buffer | string;\n  /** Person generation mode */\n  personGeneration?: 'dont_allow' | 'allow_adult' | 'allow_all';\n  /** Safety filter level */\n  safetyFilterLevel?: 'block_low_and_above' | 'block_medium_and_above' | 'block_only_high';\n}\n\nexport class GoogleVeoProvider extends BaseMediaProvider implements IVideoProvider {\n  readonly name: string = 'google-video';\n  readonly vendor = 'google' as const;\n  readonly capabilities: ProviderCapabilities = {\n    text: false,\n    images: false,\n    videos: true,\n    audio: false,\n    features: {\n      videoGeneration: true,\n      imageToVideo: true,\n      videoExtension: true,\n    },\n  };\n\n  private client: GoogleGenAI;\n  private pendingOperations: Map<string, any> = new Map();\n\n  constructor(config: GoogleMediaConfig) {\n    super({ apiKey: config.auth.apiKey, ...config });\n\n    this.client = new GoogleGenAI({\n      apiKey: config.auth.apiKey,\n    });\n  }\n\n  /**\n   * Generate a video from a text prompt\n   */\n  async generateVideo(options: VideoGenerateOptions): Promise<VideoResponse> {\n    return this.executeWithCircuitBreaker(\n      async () => {\n        try {\n          this.logOperationStart('video.generate', {\n            model: options.model,\n            duration: options.duration,\n            resolution: options.resolution,\n          });\n\n          const model = options.model || 'veo-3.0-generate-001';\n          const googleOptions = (options.vendorOptions || {}) as GoogleVeoOptions;\n\n          // Build config\n          const config: any = {};\n\n          // Aspect ratio\n          if (options.aspectRatio) {\n            config.aspectRatio = options.aspectRatio;\n          }\n\n          // Resolution\n          if (options.resolution) {\n            config.resolution = options.resolution;\n          }\n\n          // Duration\n          if (options.duration) {\n            config.durationSeconds = String(options.duration);\n          }\n\n          // Seed\n          if (options.seed !== undefined) {\n            config.seed = options.seed;\n          }\n\n          // Negative prompt\n          if (googleOptions.negativePrompt) {\n            config.negativePrompt = googleOptions.negativePrompt;\n          }\n\n          // Person generation setting\n          if (googleOptions.personGeneration) {\n            config.personGeneration = googleOptions.personGeneration;\n          }\n\n          // Safety filter level\n          if (googleOptions.safetyFilterLevel) {\n            config.safetyFilterLevel = googleOptions.safetyFilterLevel;\n          }\n\n          // Build request\n          const request: any = {\n            model,\n            prompt: options.prompt,\n            config,\n          };\n\n          // Add image for image-to-video\n          if (options.image) {\n            request.image = await this.prepareImageInput(options.image);\n          }\n\n          // Add last frame if specified\n          if (googleOptions.lastFrame) {\n            request.lastFrame = await this.prepareImageInput(googleOptions.lastFrame);\n          }\n\n          // Start video generation (returns an operation)\n          const operation = await (this.client.models as any).generateVideos(request);\n\n          // Store operation for polling\n          const jobId = this.extractJobId(operation);\n          this.pendingOperations.set(jobId, operation);\n\n          this.logOperationComplete('video.generate', {\n            model,\n            jobId,\n            status: 'pending',\n          });\n\n          return {\n            jobId,\n            status: 'pending',\n            created: Math.floor(Date.now() / 1000),\n          };\n        } catch (error: any) {\n          this.handleError(error);\n          throw error;\n        }\n      },\n      'video.generate',\n      { model: options.model }\n    );\n  }\n\n  /**\n   * Get the status of a video generation job\n   */\n  async getVideoStatus(jobId: string): Promise<VideoResponse> {\n    return this.executeWithCircuitBreaker(\n      async () => {\n        try {\n          this.logOperationStart('video.status', { jobId });\n\n          // Get stored operation\n          let operation = this.pendingOperations.get(jobId);\n\n          if (!operation) {\n            // Try to retrieve by operation name\n            try {\n              operation = await (this.client as any).operations.getVideosOperation({\n                operation: { name: jobId },\n              });\n            } catch {\n              throw new ProviderError('google', `Video job not found: ${jobId}`);\n            }\n          }\n\n          // Poll for status update\n          operation = await (this.client as any).operations.getVideosOperation({\n            operation,\n          });\n\n          // Update stored operation\n          this.pendingOperations.set(jobId, operation);\n\n          const response = this.mapResponse(jobId, operation);\n\n          this.logOperationComplete('video.status', {\n            jobId,\n            status: response.status,\n          });\n\n          // Clean up completed operations\n          if (response.status === 'completed' || response.status === 'failed') {\n            this.pendingOperations.delete(jobId);\n          }\n\n          return response;\n        } catch (error: any) {\n          if (error instanceof ProviderError) throw error;\n          this.handleError(error);\n          throw error;\n        }\n      },\n      'video.status',\n      { jobId }\n    );\n  }\n\n  /**\n   * Download a completed video\n   */\n  async downloadVideo(jobId: string): Promise<Buffer> {\n    return this.executeWithCircuitBreaker(\n      async () => {\n        try {\n          this.logOperationStart('video.download', { jobId });\n\n          // Get status to ensure completion\n          const status = await this.getVideoStatus(jobId);\n          if (status.status !== 'completed') {\n            throw new ProviderError('google', `Video not ready. Status: ${status.status}`);\n          }\n\n          // Get the operation\n          const operation = this.pendingOperations.get(jobId);\n          if (!operation?.response?.generatedVideos?.[0]?.video) {\n            throw new ProviderError('google', 'No video available for download');\n          }\n\n          // Download using the files API\n          const videoFile = operation.response.generatedVideos[0].video;\n          const downloadResponse = await (this.client.files as any).download({\n            file: videoFile,\n          });\n\n          let buffer: Buffer;\n          if (downloadResponse instanceof Buffer) {\n            buffer = downloadResponse;\n          } else if (downloadResponse.data) {\n            buffer = Buffer.from(downloadResponse.data);\n          } else {\n            throw new ProviderError('google', 'Unexpected download response format');\n          }\n\n          this.logOperationComplete('video.download', {\n            jobId,\n            size: buffer.length,\n          });\n\n          return buffer;\n        } catch (error: any) {\n          if (error instanceof ProviderError) throw error;\n          this.handleError(error);\n          throw error;\n        }\n      },\n      'video.download',\n      { jobId }\n    );\n  }\n\n  /**\n   * Extend an existing video (Veo 3.1 supports this)\n   */\n  async extendVideo(options: VideoExtendOptions): Promise<VideoResponse> {\n    return this.executeWithCircuitBreaker(\n      async () => {\n        try {\n          this.logOperationStart('video.extend', {\n            model: options.model,\n            extendDuration: options.extendDuration,\n          });\n\n          const model = options.model || 'veo-3.1-generate-001';\n\n          // Video extension in Veo is done by providing the last frame\n          // of the existing video and generating a continuation\n          const request: any = {\n            model,\n            prompt: options.prompt || 'Continue the video seamlessly',\n            config: {\n              durationSeconds: String(options.extendDuration),\n            },\n          };\n\n          // Extract last frame from video or use video as input\n          if (Buffer.isBuffer(options.video)) {\n            // For buffer input, we'd need to extract the last frame\n            // This is a simplified implementation\n            request.image = {\n              imageBytes: options.video.toString('base64'),\n            };\n          } else {\n            request.video = { uri: options.video };\n          }\n\n          const operation = await (this.client.models as any).generateVideos(request);\n\n          const jobId = this.extractJobId(operation);\n          this.pendingOperations.set(jobId, operation);\n\n          this.logOperationComplete('video.extend', {\n            jobId,\n            status: 'pending',\n          });\n\n          return {\n            jobId,\n            status: 'pending',\n            created: Math.floor(Date.now() / 1000),\n          };\n        } catch (error: any) {\n          this.handleError(error);\n          throw error;\n        }\n      },\n      'video.extend',\n      { model: options.model }\n    );\n  }\n\n  /**\n   * List available video models\n   */\n  async listModels(): Promise<string[]> {\n    return [\n      'veo-2.0-generate-001',\n      'veo-3.0-generate-001',\n      'veo-3.0-fast-generate-001',\n      'veo-3.1-generate-001',\n    ];\n  }\n\n  /**\n   * Wait for video completion with polling\n   */\n  async waitForCompletion(jobId: string, timeoutMs: number = 600000): Promise<VideoResponse> {\n    const startTime = Date.now();\n    const pollInterval = 10000; // 10 seconds\n\n    while (Date.now() - startTime < timeoutMs) {\n      const status = await this.getVideoStatus(jobId);\n\n      if (status.status === 'completed' || status.status === 'failed') {\n        return status;\n      }\n\n      // Wait before next poll\n      await new Promise((resolve) => setTimeout(resolve, pollInterval));\n    }\n\n    throw new ProviderError('google', `Video generation timed out after ${timeoutMs}ms`);\n  }\n\n  /**\n   * Extract job ID from operation\n   */\n  private extractJobId(operation: any): string {\n    if (operation.name) {\n      return operation.name;\n    }\n    // Generate a unique ID if not available\n    return `veo-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n  }\n\n  /**\n   * Prepare image input for API\n   */\n  private async prepareImageInput(image: Buffer | string): Promise<any> {\n    if (Buffer.isBuffer(image)) {\n      return {\n        imageBytes: image.toString('base64'),\n      };\n    }\n\n    // Check if it's a URL or file path\n    if (image.startsWith('http://') || image.startsWith('https://')) {\n      return { imageUri: image };\n    }\n\n    // Read from file path\n    const fs = await import('fs/promises');\n    const data = await fs.readFile(image);\n    return {\n      imageBytes: data.toString('base64'),\n    };\n  }\n\n  /**\n   * Map operation to VideoResponse\n   */\n  private mapResponse(jobId: string, operation: any): VideoResponse {\n    const result: VideoResponse = {\n      jobId,\n      status: this.mapStatus(operation),\n      created: Math.floor(Date.now() / 1000),\n    };\n\n    if (operation.done && operation.response?.generatedVideos?.[0]) {\n      const video = operation.response.generatedVideos[0];\n      result.video = {\n        duration: video.video?.duration,\n        format: 'mp4',\n      };\n\n      // URL may be available through the file reference\n      if (video.video?.uri) {\n        result.video.url = video.video.uri;\n      }\n    }\n\n    if (operation.error) {\n      result.error = operation.error.message || 'Video generation failed';\n      result.status = 'failed';\n    }\n\n    return result;\n  }\n\n  /**\n   * Map operation status to our status type\n   */\n  private mapStatus(operation: any): VideoStatus {\n    if (operation.error) {\n      return 'failed';\n    }\n    if (operation.done) {\n      return 'completed';\n    }\n    if (operation.metadata?.state === 'ACTIVE' || operation.metadata?.state === 'PROCESSING') {\n      return 'processing';\n    }\n    return 'pending';\n  }\n\n  /**\n   * Handle Google API errors\n   */\n  private handleError(error: any): never {\n    const message = error.message || 'Unknown Google API error';\n    const status = error.status || error.code;\n\n    if (status === 401 || status === 403 || message.includes('API key')) {\n      throw new ProviderAuthError('google', 'Invalid API key');\n    }\n\n    if (status === 429 || message.includes('quota') || message.includes('rate')) {\n      throw new ProviderRateLimitError('google', message);\n    }\n\n    if (status === 400) {\n      if (message.includes('safety') || message.includes('blocked')) {\n        throw new ProviderError('google', `Content policy violation: ${message}`);\n      }\n      throw new ProviderError('google', `Bad request: ${message}`);\n    }\n\n    throw new ProviderError('google', message);\n  }\n}\n","/**\n * Factory for creating video providers from connectors\n */\n\nimport { Connector } from './Connector.js';\nimport { Vendor } from './Vendor.js';\nimport type { IVideoProvider } from '../domain/interfaces/IVideoProvider.js';\nimport type { OpenAIMediaConfig, GoogleMediaConfig } from '../domain/types/ProviderConfig.js';\nimport { OpenAISoraProvider } from '../infrastructure/providers/openai/OpenAISoraProvider.js';\nimport { GoogleVeoProvider } from '../infrastructure/providers/google/GoogleVeoProvider.js';\n/**\n * Create a video provider from a connector\n */\nexport function createVideoProvider(connector: Connector): IVideoProvider {\n  const vendor = connector.vendor;\n\n  switch (vendor) {\n    case Vendor.OpenAI:\n      return new OpenAISoraProvider(extractOpenAIConfig(connector));\n\n    case Vendor.Google:\n      return new GoogleVeoProvider(extractGoogleConfig(connector));\n\n    default:\n      throw new Error(\n        `Video generation not supported for vendor: ${vendor}. ` +\n          `Supported vendors: ${Vendor.OpenAI}, ${Vendor.Google}`\n      );\n  }\n}\n\n/**\n * Extract OpenAI configuration from connector\n */\nfunction extractOpenAIConfig(connector: Connector): OpenAIMediaConfig {\n  const auth = connector.config.auth;\n\n  if (auth.type !== 'api_key') {\n    throw new Error('OpenAI requires API key authentication');\n  }\n\n  const options = connector.getOptions();\n\n  return {\n    auth: {\n      type: 'api_key',\n      apiKey: auth.apiKey,\n    },\n    baseURL: connector.baseURL,\n    organization: options.organization as string | undefined,\n    timeout: options.timeout as number | undefined,\n    maxRetries: options.maxRetries as number | undefined,\n  };\n}\n\n/**\n * Extract Google configuration from connector\n */\nfunction extractGoogleConfig(connector: Connector): GoogleMediaConfig {\n  const auth = connector.config.auth;\n\n  if (auth.type !== 'api_key') {\n    throw new Error('Google requires API key authentication');\n  }\n\n  const options = connector.getOptions();\n\n  return {\n    auth: {\n      type: 'api_key',\n      apiKey: auth.apiKey,\n    },\n    timeout: options.timeout as number | undefined,\n    maxRetries: options.maxRetries as number | undefined,\n  };\n}\n","/**\n * Video Model Registry\n *\n * Comprehensive registry of video generation models with capabilities and pricing.\n * Models are organized by vendor and include detailed capability information.\n */\n\nimport { Vendor } from '../../core/Vendor.js';\nimport type { ISourceLinks, IBaseModelDescription } from '../types/SharedTypes.js';\nimport { createRegistryHelpers } from './RegistryUtils.js';\n\n/**\n * Video model capabilities\n */\nexport interface VideoModelCapabilities {\n  /** Supported durations in seconds */\n  durations: number[];\n  /** Supported resolutions (e.g., '720x1280', '1080x1920') */\n  resolutions: string[];\n  /** Maximum frames per second */\n  maxFps: number;\n  /** Whether the model supports audio generation */\n  audio: boolean;\n  /** Whether the model supports image-to-video */\n  imageToVideo: boolean;\n  /** Whether the model supports video extension */\n  videoExtension: boolean;\n  /** Whether the model supports first/last frame specification */\n  frameControl: boolean;\n  /** Additional features */\n  features: {\n    /** Supports upscaling output */\n    upscaling: boolean;\n    /** Supports style/mood control */\n    styleControl: boolean;\n    /** Supports negative prompts */\n    negativePrompt: boolean;\n    /** Supports seed for reproducibility */\n    seed: boolean;\n  };\n}\n\n/**\n * Video model pricing\n */\nexport interface VideoModelPricing {\n  /** Cost per second of generated video */\n  perSecond: number;\n  /** Currency */\n  currency: string;\n}\n\n/**\n * Video model description\n */\nexport interface IVideoModelDescription extends IBaseModelDescription {\n  capabilities: VideoModelCapabilities;\n  pricing?: VideoModelPricing;\n}\n\n/**\n * Video model registry type\n */\ntype VideoModelRegistry = Record<string, IVideoModelDescription>;\n\n/**\n * Model constants organized by vendor\n */\nexport const VIDEO_MODELS = {\n  [Vendor.OpenAI]: {\n    SORA_2: 'sora-2',\n    SORA_2_PRO: 'sora-2-pro',\n  },\n  [Vendor.Google]: {\n    VEO_2: 'veo-2.0-generate-001',\n    VEO_3: 'veo-3.0-generate-001',\n    VEO_3_FAST: 'veo-3.0-fast-generate-001',\n    VEO_3_1: 'veo-3.1-generate-001',\n  },\n} as const;\n\n/**\n * Common sources for model information\n */\nconst OPENAI_SOURCES: ISourceLinks = {\n  documentation: 'https://platform.openai.com/docs/guides/video-generation',\n  apiReference: 'https://platform.openai.com/docs/api-reference/videos',\n  lastVerified: '2026-01-25',\n};\n\nconst GOOGLE_SOURCES: ISourceLinks = {\n  documentation: 'https://docs.cloud.google.com/vertex-ai/generative-ai/docs/video/overview',\n  apiReference: 'https://docs.cloud.google.com/vertex-ai/generative-ai/docs/model-reference/veo-video-generation',\n  lastVerified: '2026-01-25',\n};\n\n/**\n * Video Model Registry\n */\nexport const VIDEO_MODEL_REGISTRY: VideoModelRegistry = {\n  // ============================================================================\n  // OpenAI Sora Models\n  // ============================================================================\n\n  'sora-2': {\n    name: 'sora-2',\n    displayName: 'Sora 2',\n    provider: Vendor.OpenAI,\n    isActive: true,\n    sources: OPENAI_SOURCES,\n    capabilities: {\n      durations: [4, 8, 12],\n      resolutions: ['720x1280', '1280x720', '1024x1792', '1792x1024'],\n      maxFps: 30,\n      audio: true,\n      imageToVideo: true,\n      videoExtension: true,\n      frameControl: false,\n      features: {\n        upscaling: false,\n        styleControl: false,\n        negativePrompt: false,\n        seed: true,\n      },\n    },\n    pricing: {\n      perSecond: 0.15,\n      currency: 'USD',\n    },\n  },\n\n  'sora-2-pro': {\n    name: 'sora-2-pro',\n    displayName: 'Sora 2 Pro',\n    provider: Vendor.OpenAI,\n    isActive: true,\n    sources: OPENAI_SOURCES,\n    capabilities: {\n      durations: [4, 8, 12],\n      resolutions: ['720x1280', '1280x720', '1024x1792', '1792x1024', '1920x1080', '1080x1920'],\n      maxFps: 30,\n      audio: true,\n      imageToVideo: true,\n      videoExtension: true,\n      frameControl: true,\n      features: {\n        upscaling: true,\n        styleControl: true,\n        negativePrompt: false,\n        seed: true,\n      },\n    },\n    pricing: {\n      perSecond: 0.40,\n      currency: 'USD',\n    },\n  },\n\n  // ============================================================================\n  // Google Veo Models\n  // ============================================================================\n\n  'veo-2.0-generate-001': {\n    name: 'veo-2.0-generate-001',\n    displayName: 'Veo 2.0',\n    provider: Vendor.Google,\n    isActive: true,\n    sources: GOOGLE_SOURCES,\n    capabilities: {\n      durations: [5, 6, 7, 8],\n      resolutions: ['768x1408', '1408x768', '1024x1024'],\n      maxFps: 24,\n      audio: false,\n      imageToVideo: true,\n      videoExtension: false,\n      frameControl: true,\n      features: {\n        upscaling: false,\n        styleControl: false,\n        negativePrompt: true,\n        seed: true,\n      },\n    },\n    pricing: {\n      perSecond: 0.03,\n      currency: 'USD',\n    },\n  },\n\n  'veo-3.0-generate-001': {\n    name: 'veo-3.0-generate-001',\n    displayName: 'Veo 3.0',\n    provider: Vendor.Google,\n    isActive: true,\n    sources: GOOGLE_SOURCES,\n    capabilities: {\n      durations: [5, 6, 7, 8, 10, 15, 20],\n      resolutions: ['720p', '1080p', '768x1408', '1408x768'],\n      maxFps: 30,\n      audio: true,\n      imageToVideo: true,\n      videoExtension: true,\n      frameControl: true,\n      features: {\n        upscaling: true,\n        styleControl: true,\n        negativePrompt: true,\n        seed: true,\n      },\n    },\n    pricing: {\n      perSecond: 0.05,\n      currency: 'USD',\n    },\n  },\n\n  'veo-3.0-fast-generate-001': {\n    name: 'veo-3.0-fast-generate-001',\n    displayName: 'Veo 3.0 Fast',\n    provider: Vendor.Google,\n    isActive: true,\n    sources: GOOGLE_SOURCES,\n    capabilities: {\n      durations: [5, 6, 7, 8],\n      resolutions: ['720p', '768x1408', '1408x768'],\n      maxFps: 24,\n      audio: false,\n      imageToVideo: true,\n      videoExtension: false,\n      frameControl: false,\n      features: {\n        upscaling: false,\n        styleControl: false,\n        negativePrompt: true,\n        seed: true,\n      },\n    },\n    pricing: {\n      perSecond: 0.02,\n      currency: 'USD',\n    },\n  },\n\n  'veo-3.1-generate-001': {\n    name: 'veo-3.1-generate-001',\n    displayName: 'Veo 3.1',\n    provider: Vendor.Google,\n    isActive: true,\n    sources: GOOGLE_SOURCES,\n    capabilities: {\n      durations: [5, 6, 7, 8, 10, 15, 20, 30],\n      resolutions: ['720p', '1080p', '4K', '768x1408', '1408x768'],\n      maxFps: 30,\n      audio: true,\n      imageToVideo: true,\n      videoExtension: true,\n      frameControl: true,\n      features: {\n        upscaling: true,\n        styleControl: true,\n        negativePrompt: true,\n        seed: true,\n      },\n    },\n    pricing: {\n      perSecond: 0.08,\n      currency: 'USD',\n    },\n  },\n};\n\n// Create helper functions using the registry utility\nconst helpers = createRegistryHelpers<IVideoModelDescription>(VIDEO_MODEL_REGISTRY);\n\n/**\n * Get model information by name\n */\nexport const getVideoModelInfo = helpers.getInfo;\n\n/**\n * Get all models for a specific vendor\n */\nexport const getVideoModelsByVendor = helpers.getByVendor;\n\n/**\n * Get all currently active models\n */\nexport const getActiveVideoModels = helpers.getActive;\n\n/**\n * Get models with a specific feature\n */\nexport function getVideoModelsWithFeature(feature: keyof VideoModelCapabilities['features']): IVideoModelDescription[] {\n  return Object.values(VIDEO_MODEL_REGISTRY).filter(\n    (model) => model.isActive && model.capabilities.features[feature]\n  );\n}\n\n/**\n * Get models that support audio\n */\nexport function getVideoModelsWithAudio(): IVideoModelDescription[] {\n  return Object.values(VIDEO_MODEL_REGISTRY).filter((model) => model.isActive && model.capabilities.audio);\n}\n\n/**\n * Calculate video generation cost\n */\nexport function calculateVideoCost(modelName: string, durationSeconds: number): number | null {\n  const model = VIDEO_MODEL_REGISTRY[modelName];\n  if (!model || !model.pricing) {\n    return null;\n  }\n\n  return model.pricing.perSecond * durationSeconds;\n}\n","/**\n * VideoGeneration - High-level video generation capability\n *\n * Provides a unified interface for generating videos across multiple vendors.\n * Supports text-to-video, image-to-video, and video extension.\n *\n * @example\n * ```typescript\n * import { VideoGeneration, Connector, Vendor } from '@oneringai/agents';\n *\n * Connector.create({\n *   name: 'openai',\n *   vendor: Vendor.OpenAI,\n *   auth: { type: 'api_key', apiKey: process.env.OPENAI_API_KEY! },\n * });\n *\n * const videoGen = VideoGeneration.create({ connector: 'openai' });\n *\n * // Start video generation\n * const job = await videoGen.generate({\n *   prompt: 'A cinematic shot of a sunrise over mountains',\n *   duration: 8,\n *   resolution: '1280x720',\n * });\n *\n * // Wait for completion\n * const result = await videoGen.waitForCompletion(job.jobId);\n *\n * // Download the video\n * const videoBuffer = await videoGen.download(job.jobId);\n * ```\n */\n\nimport { Connector } from '../../core/Connector.js';\nimport { createVideoProvider } from '../../core/createVideoProvider.js';\nimport type {\n  IVideoProvider,\n  VideoGenerateOptions,\n  VideoExtendOptions,\n  VideoResponse,\n} from '../../domain/interfaces/IVideoProvider.js';\nimport { VIDEO_MODELS, getVideoModelInfo } from '../../domain/entities/VideoModel.js';\nimport { Vendor } from '../../core/Vendor.js';\nimport { ProviderError } from '../../domain/errors/AIErrors.js';\n\n/**\n * Options for creating a VideoGeneration instance\n */\nexport interface VideoGenerationCreateOptions {\n  /** Connector name or instance */\n  connector: string | Connector;\n}\n\n/**\n * Simplified options for quick generation\n */\nexport interface SimpleVideoGenerateOptions {\n  /** Text prompt describing the video */\n  prompt: string;\n  /** Model to use (defaults to vendor's best model) */\n  model?: string;\n  /** Duration in seconds */\n  duration?: number;\n  /** Output resolution (e.g., '1280x720', '1920x1080') */\n  resolution?: string;\n  /** Aspect ratio (alternative to resolution) */\n  aspectRatio?: '16:9' | '9:16' | '1:1' | '4:3' | '3:4';\n  /** Reference image for image-to-video */\n  image?: Buffer | string;\n  /** Seed for reproducibility */\n  seed?: number;\n  /** Vendor-specific options */\n  vendorOptions?: Record<string, unknown>;\n}\n\n/**\n * VideoGeneration capability class\n */\nexport class VideoGeneration {\n  private provider: IVideoProvider;\n  private connector: Connector;\n  private defaultModel: string;\n\n  private constructor(connector: Connector) {\n    this.connector = connector;\n    this.provider = createVideoProvider(connector);\n    this.defaultModel = this.getDefaultModel();\n  }\n\n  /**\n   * Create a VideoGeneration instance\n   */\n  static create(options: VideoGenerationCreateOptions): VideoGeneration {\n    const connector =\n      typeof options.connector === 'string'\n        ? Connector.get(options.connector)\n        : options.connector;\n\n    if (!connector) {\n      throw new Error(`Connector not found: ${options.connector}`);\n    }\n\n    return new VideoGeneration(connector);\n  }\n\n  /**\n   * Generate a video from a text prompt\n   * Returns a job that can be polled for completion\n   */\n  async generate(options: SimpleVideoGenerateOptions): Promise<VideoResponse> {\n    const fullOptions: VideoGenerateOptions = {\n      model: options.model || this.defaultModel,\n      prompt: options.prompt,\n      duration: options.duration,\n      resolution: options.resolution,\n      aspectRatio: options.aspectRatio,\n      image: options.image,\n      seed: options.seed,\n      vendorOptions: options.vendorOptions,\n    };\n\n    return this.provider.generateVideo(fullOptions);\n  }\n\n  /**\n   * Get the status of a video generation job\n   */\n  async getStatus(jobId: string): Promise<VideoResponse> {\n    return this.provider.getVideoStatus(jobId);\n  }\n\n  /**\n   * Wait for a video generation job to complete\n   */\n  async waitForCompletion(jobId: string, timeoutMs: number = 600000): Promise<VideoResponse> {\n    const startTime = Date.now();\n    const pollInterval = 10000; // 10 seconds\n\n    while (Date.now() - startTime < timeoutMs) {\n      const status = await this.provider.getVideoStatus(jobId);\n\n      if (status.status === 'completed') {\n        return status;\n      }\n\n      if (status.status === 'failed') {\n        throw new ProviderError(\n          this.connector.vendor || 'unknown',\n          `Video generation failed: ${status.error || 'Unknown error'}`\n        );\n      }\n\n      // Wait before next poll\n      await new Promise((resolve) => setTimeout(resolve, pollInterval));\n    }\n\n    throw new ProviderError(\n      this.connector.vendor || 'unknown',\n      `Video generation timed out after ${timeoutMs}ms`\n    );\n  }\n\n  /**\n   * Download a completed video\n   */\n  async download(jobId: string): Promise<Buffer> {\n    if (!this.provider.downloadVideo) {\n      throw new Error(`Video download not supported by ${this.provider.name}`);\n    }\n\n    return this.provider.downloadVideo(jobId);\n  }\n\n  /**\n   * Generate and wait for completion in one call\n   */\n  async generateAndWait(\n    options: SimpleVideoGenerateOptions,\n    timeoutMs: number = 600000\n  ): Promise<VideoResponse> {\n    const job = await this.generate(options);\n    return this.waitForCompletion(job.jobId, timeoutMs);\n  }\n\n  /**\n   * Extend an existing video\n   * Note: Not all models/vendors support this\n   */\n  async extend(options: VideoExtendOptions): Promise<VideoResponse> {\n    if (!this.provider.extendVideo) {\n      throw new Error(`Video extension not supported by ${this.provider.name}`);\n    }\n\n    const fullOptions: VideoExtendOptions = {\n      ...options,\n      model: options.model || this.getExtendModel(),\n    };\n\n    return this.provider.extendVideo(fullOptions);\n  }\n\n  /**\n   * Cancel a pending video generation job\n   */\n  async cancel(jobId: string): Promise<boolean> {\n    if (!this.provider.cancelJob) {\n      throw new Error(`Job cancellation not supported by ${this.provider.name}`);\n    }\n\n    return this.provider.cancelJob(jobId);\n  }\n\n  /**\n   * List available models for this provider\n   */\n  async listModels(): Promise<string[]> {\n    if (this.provider.listModels) {\n      return this.provider.listModels();\n    }\n\n    // Fallback to registry\n    const vendor = this.connector.vendor;\n    if (vendor && VIDEO_MODELS[vendor as keyof typeof VIDEO_MODELS]) {\n      return Object.values(VIDEO_MODELS[vendor as keyof typeof VIDEO_MODELS]);\n    }\n\n    return [];\n  }\n\n  /**\n   * Get information about a specific model\n   */\n  getModelInfo(modelName: string) {\n    return getVideoModelInfo(modelName);\n  }\n\n  /**\n   * Get the underlying provider\n   */\n  getProvider(): IVideoProvider {\n    return this.provider;\n  }\n\n  /**\n   * Get the current connector\n   */\n  getConnector(): Connector {\n    return this.connector;\n  }\n\n  /**\n   * Get the default model for this vendor\n   */\n  private getDefaultModel(): string {\n    const vendor = this.connector.vendor;\n\n    switch (vendor) {\n      case Vendor.OpenAI:\n        return VIDEO_MODELS[Vendor.OpenAI].SORA_2;\n      case Vendor.Google:\n        return VIDEO_MODELS[Vendor.Google].VEO_3;\n      default:\n        throw new Error(`No default video model for vendor: ${vendor}`);\n    }\n  }\n\n  /**\n   * Get the model that supports video extension\n   */\n  private getExtendModel(): string {\n    const vendor = this.connector.vendor;\n\n    switch (vendor) {\n      case Vendor.OpenAI:\n        return VIDEO_MODELS[Vendor.OpenAI].SORA_2;\n      case Vendor.Google:\n        return VIDEO_MODELS[Vendor.Google].VEO_3_1;\n      default:\n        throw new Error(`No extend model for vendor: ${vendor}`);\n    }\n  }\n}\n","/**\n * Task and Plan entities for TaskAgent\n *\n * Defines the data structures for task-based autonomous agents.\n */\n\n/**\n * Task status lifecycle\n */\nexport type TaskStatus =\n  | 'pending'           // Not started\n  | 'blocked'           // Dependencies not met\n  | 'in_progress'       // Currently executing\n  | 'waiting_external'  // Waiting on external event\n  | 'completed'         // Successfully finished\n  | 'failed'            // Failed after max retries\n  | 'skipped'           // Skipped (condition not met)\n  | 'cancelled';        // Manually cancelled\n\n/**\n * Plan status\n */\nexport type PlanStatus =\n  | 'pending'\n  | 'running'\n  | 'suspended'\n  | 'completed'\n  | 'failed'\n  | 'cancelled';\n\n/**\n * Condition operators for conditional task execution\n */\nexport type ConditionOperator =\n  | 'exists'\n  | 'not_exists'\n  | 'equals'\n  | 'contains'\n  | 'truthy'\n  | 'greater_than'\n  | 'less_than';\n\n/**\n * Task condition - evaluated before execution\n */\nexport interface TaskCondition {\n  memoryKey: string;\n  operator: ConditionOperator;\n  value?: unknown;\n  onFalse: 'skip' | 'fail' | 'wait';\n}\n\n/**\n * External dependency configuration\n */\nexport interface ExternalDependency {\n  type: 'webhook' | 'poll' | 'manual' | 'scheduled';\n\n  /** For webhook: unique ID to match incoming webhook */\n  webhookId?: string;\n\n  /** For poll: how to check if complete */\n  pollConfig?: {\n    toolName: string;\n    toolArgs: Record<string, unknown>;\n    intervalMs: number;\n    maxAttempts: number;\n  };\n\n  /** For scheduled: when to resume */\n  scheduledAt?: number;\n\n  /** For manual: description of what's needed */\n  manualDescription?: string;\n\n  /** Timeout for all types */\n  timeoutMs?: number;\n\n  /** Current state */\n  state: 'waiting' | 'received' | 'timeout';\n\n  /** Data received from external source */\n  receivedData?: unknown;\n  receivedAt?: number;\n}\n\n/**\n * Task execution settings\n */\nexport interface TaskExecution {\n  /** Can run in parallel with other parallel tasks */\n  parallel?: boolean;\n\n  /** Max concurrent if this spawns sub-work */\n  maxConcurrency?: number;\n\n  /** Priority (higher = executed first) */\n  priority?: number;\n}\n\n/**\n * A single unit of work\n */\nexport interface Task {\n  id: string;\n  name: string;\n  description: string;\n  status: TaskStatus;\n\n  /** Tasks that must complete before this one (task IDs) */\n  dependsOn: string[];\n\n  /** External dependency (if waiting on external event) */\n  externalDependency?: ExternalDependency;\n\n  /** Condition for execution */\n  condition?: TaskCondition;\n\n  /** Execution settings */\n  execution?: TaskExecution;\n\n  /** Optional expected output description */\n  expectedOutput?: string;\n\n  /** Result after completion */\n  result?: {\n    success: boolean;\n    output?: unknown;\n    error?: string;\n  };\n\n  /** Timestamps */\n  createdAt: number;\n  startedAt?: number;\n  completedAt?: number;\n  lastUpdatedAt: number;\n\n  /** Retry tracking */\n  attempts: number;\n  maxAttempts: number;\n\n  /** Metadata for extensions */\n  metadata?: Record<string, unknown>;\n}\n\n/**\n * Input for creating a task\n */\nexport interface TaskInput {\n  id?: string;\n  name: string;\n  description: string;\n  dependsOn?: string[];           // Task names or IDs\n  externalDependency?: ExternalDependency;\n  condition?: TaskCondition;\n  execution?: TaskExecution;\n  expectedOutput?: string;\n  maxAttempts?: number;\n  metadata?: Record<string, unknown>;\n}\n\n/**\n * Plan concurrency settings\n */\nexport interface PlanConcurrency {\n  maxParallelTasks: number;\n  strategy: 'fifo' | 'priority' | 'shortest-first';\n}\n\n/**\n * Execution plan - a goal with steps to achieve it\n */\nexport interface Plan {\n  id: string;\n  goal: string;\n  context?: string;\n\n  tasks: Task[];\n\n  /** Concurrency settings */\n  concurrency?: PlanConcurrency;\n\n  /** Can agent modify the plan? */\n  allowDynamicTasks: boolean;\n\n  /** Plan status */\n  status: PlanStatus;\n\n  /** Why is the plan suspended? */\n  suspendedReason?: {\n    type: 'waiting_external' | 'manual_pause' | 'error';\n    taskId?: string;\n    message?: string;\n  };\n\n  /** Timestamps */\n  createdAt: number;\n  startedAt?: number;\n  completedAt?: number;\n  lastUpdatedAt: number;\n\n  /** For resume: which task to continue from */\n  currentTaskId?: string;\n\n  /** Metadata */\n  metadata?: Record<string, unknown>;\n}\n\n/**\n * Input for creating a plan\n */\nexport interface PlanInput {\n  goal: string;\n  context?: string;\n  tasks: TaskInput[];\n  concurrency?: PlanConcurrency;\n  allowDynamicTasks?: boolean;\n  metadata?: Record<string, unknown>;\n}\n\n/**\n * Memory access interface for condition evaluation\n */\nexport interface ConditionMemoryAccess {\n  get(key: string): Promise<unknown>;\n}\n\n// ============ Factory Functions ============\n\n/**\n * Create a task with defaults\n */\nexport function createTask(input: TaskInput): Task {\n  const now = Date.now();\n  const id = input.id ?? `task-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n\n  return {\n    id,\n    name: input.name,\n    description: input.description,\n    status: 'pending',\n    dependsOn: input.dependsOn ?? [],\n    externalDependency: input.externalDependency,\n    condition: input.condition,\n    execution: input.execution,\n    expectedOutput: input.expectedOutput,\n    attempts: 0,\n    maxAttempts: input.maxAttempts ?? 3,\n    createdAt: now,\n    lastUpdatedAt: now,\n    metadata: input.metadata,\n  };\n}\n\n/**\n * Create a plan with tasks\n */\nexport function createPlan(input: PlanInput): Plan {\n  const now = Date.now();\n  const id = `plan-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n\n  // Create tasks first\n  const tasks = input.tasks.map((taskInput) => createTask(taskInput));\n\n  // Build name to ID map\n  const nameToId = new Map<string, string>();\n  for (const task of tasks) {\n    nameToId.set(task.name, task.id);\n  }\n\n  // Resolve dependencies from names to IDs\n  for (let i = 0; i < tasks.length; i++) {\n    const taskInput = input.tasks[i]!;\n    const task = tasks[i]!;\n\n    if (taskInput.dependsOn && taskInput.dependsOn.length > 0) {\n      task.dependsOn = taskInput.dependsOn.map((dep) => {\n        // Check if it's already an ID (starts with 'task-')\n        if (dep.startsWith('task-')) {\n          return dep;\n        }\n\n        // Otherwise, it's a name - resolve it\n        const resolvedId = nameToId.get(dep);\n        if (!resolvedId) {\n          throw new Error(`Task dependency \"${dep}\" not found in plan`);\n        }\n        return resolvedId;\n      });\n    }\n  }\n\n  return {\n    id,\n    goal: input.goal,\n    context: input.context,\n    tasks,\n    concurrency: input.concurrency,\n    allowDynamicTasks: input.allowDynamicTasks ?? true,\n    status: 'pending',\n    createdAt: now,\n    lastUpdatedAt: now,\n    metadata: input.metadata,\n  };\n}\n\n// ============ Task Utilities ============\n\n/**\n * Check if a task can be executed (dependencies met, status is pending)\n */\nexport function canTaskExecute(task: Task, allTasks: Task[]): boolean {\n  // Must be pending\n  if (task.status !== 'pending') {\n    return false;\n  }\n\n  // Check if all dependencies are completed\n  if (task.dependsOn.length > 0) {\n    for (const depId of task.dependsOn) {\n      const depTask = allTasks.find((t) => t.id === depId);\n      if (!depTask || depTask.status !== 'completed') {\n        return false;\n      }\n    }\n  }\n\n  return true;\n}\n\n/**\n * Get the next tasks that can be executed\n */\nexport function getNextExecutableTasks(plan: Plan): Task[] {\n  const executable = plan.tasks.filter((task) => canTaskExecute(task, plan.tasks));\n\n  if (executable.length === 0) {\n    return [];\n  }\n\n  // If no concurrency config, return sequential (first one only)\n  if (!plan.concurrency) {\n    return [executable[0]!];\n  }\n\n  // Count currently running tasks\n  const runningCount = plan.tasks.filter((t) => t.status === 'in_progress').length;\n  const availableSlots = plan.concurrency.maxParallelTasks - runningCount;\n\n  if (availableSlots <= 0) {\n    return [];\n  }\n\n  // Filter for parallel-capable tasks\n  const parallelTasks = executable.filter((task) => task.execution?.parallel === true);\n\n  if (parallelTasks.length === 0) {\n    // No parallel tasks available, return first sequential task\n    return [executable[0]!];\n  }\n\n  // Sort by strategy\n  let sortedTasks = [...parallelTasks];\n  if (plan.concurrency.strategy === 'priority') {\n    sortedTasks.sort((a, b) => (b.execution?.priority ?? 0) - (a.execution?.priority ?? 0));\n  }\n  // 'fifo' and 'shortest-first' use default order (creation order)\n\n  // Return up to availableSlots tasks\n  return sortedTasks.slice(0, availableSlots);\n}\n\n/**\n * Evaluate a task condition against memory\n */\nexport async function evaluateCondition(\n  condition: TaskCondition,\n  memory: ConditionMemoryAccess\n): Promise<boolean> {\n  const value = await memory.get(condition.memoryKey);\n\n  switch (condition.operator) {\n    case 'exists':\n      return value !== undefined;\n\n    case 'not_exists':\n      return value === undefined;\n\n    case 'equals':\n      return value === condition.value;\n\n    case 'contains':\n      if (Array.isArray(value)) {\n        return value.includes(condition.value);\n      }\n      if (typeof value === 'string' && typeof condition.value === 'string') {\n        return value.includes(condition.value);\n      }\n      return false;\n\n    case 'truthy':\n      return !!value;\n\n    case 'greater_than':\n      if (typeof value === 'number' && typeof condition.value === 'number') {\n        return value > condition.value;\n      }\n      return false;\n\n    case 'less_than':\n      if (typeof value === 'number' && typeof condition.value === 'number') {\n        return value < condition.value;\n      }\n      return false;\n\n    default:\n      return false;\n  }\n}\n\n/**\n * Update task status and timestamps\n */\nexport function updateTaskStatus(task: Task, status: TaskStatus): Task {\n  const now = Date.now();\n  const updated: Task = {\n    ...task,\n    status,\n    lastUpdatedAt: now,\n  };\n\n  // Set startedAt when moving to in_progress (first time only)\n  // But always increment attempts when moving to in_progress\n  if (status === 'in_progress') {\n    if (!updated.startedAt) {\n      updated.startedAt = now;\n    }\n    updated.attempts += 1;\n  }\n\n  // Set completedAt when moving to completed or failed\n  if ((status === 'completed' || status === 'failed') && !updated.completedAt) {\n    updated.completedAt = now;\n  }\n\n  return updated;\n}\n\n/**\n * Check if a task is blocked by dependencies\n */\nexport function isTaskBlocked(task: Task, allTasks: Task[]): boolean {\n  if (task.dependsOn.length === 0) {\n    return false;\n  }\n\n  for (const depId of task.dependsOn) {\n    const depTask = allTasks.find((t) => t.id === depId);\n    if (!depTask) {\n      return true; // Dependency not found\n    }\n    if (depTask.status !== 'completed') {\n      return true; // Dependency not completed\n    }\n  }\n\n  return false;\n}\n\n/**\n * Get the dependency tasks for a task\n */\nexport function getTaskDependencies(task: Task, allTasks: Task[]): Task[] {\n  if (task.dependsOn.length === 0) {\n    return [];\n  }\n\n  return task.dependsOn\n    .map((depId) => allTasks.find((t) => t.id === depId))\n    .filter((t): t is Task => t !== undefined);\n}\n\n/**\n * Resolve task name dependencies to task IDs\n * Modifies taskInputs in place\n */\nexport function resolveDependencies(taskInputs: TaskInput[], tasks: Task[]): void {\n  // Build name to ID map\n  const nameToId = new Map<string, string>();\n  for (const task of tasks) {\n    nameToId.set(task.name, task.id);\n  }\n\n  // Resolve dependencies\n  for (const input of taskInputs) {\n    if (input.dependsOn && input.dependsOn.length > 0) {\n      input.dependsOn = input.dependsOn.map((dep) => {\n        // If it's already an ID, keep it\n        if (dep.startsWith('task-')) {\n          return dep;\n        }\n\n        // Otherwise, resolve name to ID\n        const resolvedId = nameToId.get(dep);\n        if (!resolvedId) {\n          throw new Error(`Task dependency \"${dep}\" not found`);\n        }\n        return resolvedId;\n      });\n    }\n  }\n}\n","/**\n * Agent state entities for TaskAgent\n *\n * Defines the full agent state needed for persistence and resume.\n */\n\nimport { Plan } from './Task.js';\n\n/**\n * Agent execution status\n */\nexport type AgentStatus =\n  | 'idle'         // Created but not started\n  | 'running'      // Actively executing\n  | 'suspended'    // Paused, can be resumed\n  | 'completed'    // Plan finished successfully\n  | 'failed'       // Plan failed\n  | 'cancelled';   // Manually cancelled\n\n/**\n * Agent configuration (needed for resume)\n */\nexport interface AgentConfig {\n  connectorName: string;\n  model: string;\n  temperature?: number;\n  maxIterations?: number;\n  toolNames: string[];            // Tool registry keys\n}\n\n/**\n * Conversation message in history\n */\nexport interface ConversationMessage {\n  role: 'user' | 'assistant' | 'system';\n  content: string;\n  timestamp: number;\n}\n\n/**\n * Agent execution metrics\n */\nexport interface AgentMetrics {\n  totalLLMCalls: number;\n  totalToolCalls: number;\n  totalTokensUsed: number;\n  totalCost: number;\n}\n\n/**\n * Full agent state - everything needed to resume\n */\nexport interface AgentState {\n  id: string;                     // Unique agent instance ID\n  status: AgentStatus;\n\n  /** Configuration */\n  config: AgentConfig;\n\n  /** Current plan */\n  plan: Plan;\n\n  /** Working memory reference */\n  memoryId: string;\n\n  /** Conversation history (for context continuity) */\n  conversationHistory: ConversationMessage[];\n\n  /** Timestamps */\n  createdAt: number;\n  startedAt?: number;\n  suspendedAt?: number;\n  completedAt?: number;\n  lastActivityAt: number;\n\n  /** Metrics */\n  metrics: AgentMetrics;\n}\n\n/**\n * Create initial agent state\n */\nexport function createAgentState(id: string, config: AgentConfig, plan: Plan): AgentState {\n  const now = Date.now();\n\n  return {\n    id,\n    status: 'idle',\n    config,\n    plan,\n    memoryId: `memory-${id}`,\n    conversationHistory: [],\n    createdAt: now,\n    lastActivityAt: now,\n    metrics: {\n      totalLLMCalls: 0,\n      totalToolCalls: 0,\n      totalTokensUsed: 0,\n      totalCost: 0,\n    },\n  };\n}\n\n/**\n * Update agent state status\n */\nexport function updateAgentStatus(state: AgentState, status: AgentStatus): AgentState {\n  const now = Date.now();\n\n  const updated: AgentState = {\n    ...state,\n    status,\n    lastActivityAt: now,\n  };\n\n  // Set timestamps based on status\n  if (status === 'running' && !updated.startedAt) {\n    updated.startedAt = now;\n  }\n\n  if (status === 'suspended' && !updated.suspendedAt) {\n    updated.suspendedAt = now;\n  }\n\n  if ((status === 'completed' || status === 'failed' || status === 'cancelled') && !updated.completedAt) {\n    updated.completedAt = now;\n  }\n\n  return updated;\n}\n","/**\n * TaskAgent - autonomous task-based agent\n */\n\nimport EventEmitter from 'eventemitter3';\nimport { Connector } from '../../core/Connector.js';\nimport { Agent } from '../../core/Agent.js';\nimport { ToolManager } from '../../core/ToolManager.js';\nimport {\n  SessionManager,\n  Session,\n  ISessionStorage,\n} from '../../core/SessionManager.js';\nimport { ToolFunction } from '../../domain/entities/Tool.js';\nimport { Plan, PlanInput, Task, TaskInput, createPlan, createTask } from '../../domain/entities/Task.js';\nimport { AgentState, AgentStatus, createAgentState, updateAgentStatus } from '../../domain/entities/AgentState.js';\nimport type { WorkingMemoryConfig } from '../../domain/entities/Memory.js';\nimport { DEFAULT_MEMORY_CONFIG } from '../../domain/entities/Memory.js';\nimport { IAgentStorage, createAgentStorage } from '../../infrastructure/storage/InMemoryStorage.js';\nimport { WorkingMemory } from './WorkingMemory.js';\nimport { ContextManager, DEFAULT_CONTEXT_CONFIG, DEFAULT_COMPACTION_STRATEGY } from './ContextManager.js';\nimport { IdempotencyCache, DEFAULT_IDEMPOTENCY_CONFIG } from './IdempotencyCache.js';\nimport { HistoryManager, DEFAULT_HISTORY_CONFIG } from './HistoryManager.js';\nimport { ExternalDependencyHandler } from './ExternalDependencyHandler.js';\nimport { PlanExecutor } from './PlanExecutor.js';\nimport { CheckpointManager, DEFAULT_CHECKPOINT_STRATEGY } from './CheckpointManager.js';\nimport { createMemoryTools } from './memoryTools.js';\nimport { createContextTools } from './contextTools.js';\nimport { getModelInfo } from '../../domain/entities/Model.js';\n\n/**\n * TaskAgent hooks for customization\n */\nexport interface TaskAgentHooks {\n  /** Before agent starts executing */\n  onStart?: (agent: TaskAgent, plan: Plan) => Promise<void>;\n\n  /** Before each task starts */\n  beforeTask?: (task: Task, context: TaskContext) => Promise<void | 'skip'>;\n\n  /** After each task completes */\n  afterTask?: (task: Task, result: TaskResult) => Promise<void>;\n\n  /** Before each LLM call */\n  beforeLLMCall?: (messages: any[], options: any) => Promise<any[]>;\n\n  /** After each LLM response */\n  afterLLMCall?: (response: any) => Promise<void>;\n\n  /** Before each tool execution */\n  beforeTool?: (tool: ToolFunction, args: unknown) => Promise<unknown>;\n\n  /** After tool execution */\n  afterTool?: (tool: ToolFunction, args: unknown, result: unknown) => Promise<unknown>;\n\n  /** On any error */\n  onError?: (error: Error, context: ErrorContext) => Promise<'retry' | 'fail' | 'skip'>;\n\n  /** On agent completion */\n  onComplete?: (result: PlanResult) => Promise<void>;\n}\n\n/**\n * Task execution context\n */\nexport interface TaskContext {\n  taskId: string;\n  taskName: string;\n  attempt: number;\n}\n\n/**\n * Task result\n */\nexport interface TaskResult {\n  success: boolean;\n  output?: unknown;\n  error?: string;\n}\n\n/**\n * Error context\n */\nexport interface ErrorContext {\n  task?: Task;\n  error: Error;\n  phase: 'tool' | 'llm' | 'execution';\n}\n\n/**\n * Plan result\n */\nexport interface PlanResult {\n  status: 'completed' | 'failed' | 'cancelled';\n  output?: unknown;\n  error?: string;\n  metrics: {\n    totalTasks: number;\n    completedTasks: number;\n    failedTasks: number;\n    skippedTasks: number;\n  };\n}\n\n/**\n * Agent handle returned from start()\n */\nexport interface AgentHandle {\n  agentId: string;\n  planId: string;\n\n  /** Wait for completion */\n  wait(): Promise<PlanResult>;\n\n  /** Get current status */\n  status(): AgentStatus;\n}\n\n/**\n * Plan update options\n */\nexport interface PlanUpdates {\n  addTasks?: TaskInput[];\n  updateTasks?: Array<{ id: string } & Partial<Task>>;\n  removeTasks?: string[];\n}\n\n/**\n * Session configuration for TaskAgent\n */\nexport interface TaskAgentSessionConfig {\n  /** Storage backend for sessions */\n  storage: ISessionStorage;\n  /** Resume existing session by ID */\n  id?: string;\n  /** Auto-save session after each task completion */\n  autoSave?: boolean;\n  /** Auto-save interval in milliseconds */\n  autoSaveIntervalMs?: number;\n}\n\n/**\n * TaskAgent configuration\n */\nexport interface TaskAgentConfig {\n  connector: string | Connector;\n  model: string;\n  tools?: ToolFunction[];\n  instructions?: string;\n  temperature?: number;\n  maxIterations?: number;\n\n  /** Storage for persistence (agent state, checkpoints) */\n  storage?: IAgentStorage;\n\n  /** Memory configuration */\n  memoryConfig?: WorkingMemoryConfig;\n\n  /** Hooks for customization */\n  hooks?: TaskAgentHooks;\n\n  // === NEW: Optional session support ===\n  /** Session configuration for persistence (opt-in) */\n  session?: TaskAgentSessionConfig;\n\n  // === NEW: Advanced tool management ===\n  /** Provide a pre-configured ToolManager (advanced) */\n  toolManager?: ToolManager;\n}\n\n/**\n * TaskAgent events\n */\nexport interface TaskAgentEvents {\n  'task:start': { task: Task };\n  'task:complete': { task: Task; result: TaskResult };\n  'task:failed': { task: Task; error: Error };\n  'task:waiting': { task: Task; dependency: any };\n  'plan:updated': { plan: Plan };\n  'agent:suspended': { reason: string };\n  'agent:resumed': {};\n  'agent:completed': { result: PlanResult };\n  'memory:stored': { key: string; description: string };\n  'memory:limit_warning': { utilization: number };\n}\n\n/**\n * TaskAgent - autonomous task-based agent.\n *\n * Features:\n * - Plan-driven execution\n * - Working memory with indexed access\n * - External dependency handling (webhooks, polling, manual)\n * - Suspend/resume capability\n * - State persistence for long-running agents\n */\nexport class TaskAgent extends EventEmitter<TaskAgentEvents> {\n  readonly id: string;\n  protected state: AgentState;\n  protected storage: IAgentStorage;\n  protected memory: WorkingMemory;\n  protected hooks?: TaskAgentHooks;\n  protected executionPromise?: Promise<PlanResult>;\n\n  // Internal components\n  protected agent?: Agent;\n  protected contextManager?: ContextManager;\n  protected idempotencyCache?: IdempotencyCache;\n  protected historyManager?: HistoryManager;\n  protected externalHandler?: ExternalDependencyHandler;\n  protected planExecutor?: PlanExecutor;\n  protected checkpointManager?: CheckpointManager;\n  protected _tools: ToolFunction[] = [];\n  protected _toolManager: ToolManager;\n  protected config: TaskAgentConfig;\n\n  // Session management (NEW)\n  protected _sessionManager: SessionManager | null = null;\n  protected _session: Session | null = null;\n\n  // Event listener cleanup tracking\n  private eventCleanupFunctions: Array<() => void> = [];\n\n  /**\n   * Advanced tool management. Returns ToolManager for fine-grained control.\n   */\n  get tools(): ToolManager {\n    return this._toolManager;\n  }\n\n  protected constructor(\n    id: string,\n    state: AgentState,\n    storage: IAgentStorage,\n    memory: WorkingMemory,\n    config: TaskAgentConfig,\n    hooks?: TaskAgentHooks\n  ) {\n    super();\n    this.id = id;\n    this.state = state;\n    this.storage = storage;\n    this.memory = memory;\n    this.config = config;\n    this.hooks = hooks;\n\n    // Initialize ToolManager\n    this._toolManager = config.toolManager ?? new ToolManager();\n\n    // Forward memory events to agent (with cleanup tracking)\n    const storedHandler = (data: any) => this.emit('memory:stored', data);\n    const limitWarningHandler = (data: any) => this.emit('memory:limit_warning', { utilization: data.utilizationPercent });\n\n    memory.on('stored', storedHandler);\n    memory.on('limit_warning', limitWarningHandler);\n\n    // Track cleanup functions\n    this.eventCleanupFunctions.push(() => memory.off('stored', storedHandler));\n    this.eventCleanupFunctions.push(() => memory.off('limit_warning', limitWarningHandler));\n\n    // Setup session if configured\n    if (config.session) {\n      this._sessionManager = new SessionManager({ storage: config.session.storage });\n\n      if (config.session.id) {\n        // Will be loaded asynchronously in start()\n      } else {\n        // Create new session\n        this._session = this._sessionManager.create('task-agent', {\n          title: `TaskAgent ${id}`,\n        });\n      }\n    }\n  }\n\n  /**\n   * Create a new TaskAgent\n   */\n  static create(config: TaskAgentConfig): TaskAgent {\n    // Resolve connector\n    const connector =\n      typeof config.connector === 'string' ? Connector.get(config.connector) : config.connector;\n\n    if (!connector) {\n      throw new Error(`Connector \"${config.connector}\" not found`);\n    }\n\n    // Create storage\n    const storage = config.storage ?? createAgentStorage({});\n\n    // Create working memory\n    const memoryConfig = config.memoryConfig ?? DEFAULT_MEMORY_CONFIG;\n    const memory = new WorkingMemory(storage.memory, memoryConfig);\n\n    // Generate agent ID\n    const id = `agent-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n\n    // Create empty initial plan (will be set on start)\n    const emptyPlan = createPlan({ goal: '', tasks: [] });\n\n    const agentConfig = {\n      connectorName: typeof config.connector === 'string' ? config.connector : connector.name,\n      model: config.model,\n      temperature: config.temperature,\n      maxIterations: config.maxIterations,\n      toolNames: (config.tools ?? []).map((t) => t.definition.function.name),\n    };\n\n    const state = createAgentState(id, agentConfig, emptyPlan);\n\n    const taskAgent = new TaskAgent(id, state, storage, memory, config, config.hooks);\n\n    // Initialize components\n    taskAgent.initializeComponents(config);\n\n    return taskAgent;\n  }\n\n  /**\n   * Wrap a tool with idempotency cache and enhanced context\n   */\n  private wrapToolWithCache(tool: ToolFunction): ToolFunction {\n    return {\n      ...tool,\n      execute: async (args: any, context?: any) => {\n        // Enhance context with contextManager and idempotencyCache\n        const enhancedContext = {\n          ...context,\n          contextManager: this.contextManager,\n          idempotencyCache: this.idempotencyCache,\n        };\n\n        if (!this.idempotencyCache) {\n          return tool.execute(args, enhancedContext);\n        }\n\n        // Check cache first\n        const cached = await this.idempotencyCache.get(tool, args);\n        if (cached !== undefined) {\n          return cached;\n        }\n\n        // Execute tool with enhanced context\n        const result = await tool.execute(args, enhancedContext);\n\n        // Cache result\n        await this.idempotencyCache.set(tool, args, result);\n\n        return result;\n      }\n    };\n  }\n\n  /**\n   * Initialize internal components\n   */\n  private initializeComponents(config: TaskAgentConfig): void {\n    // Combine user tools with memory tools and context tools\n    const memoryTools = createMemoryTools();\n    const contextTools = createContextTools();\n    this._tools = [...(config.tools ?? []), ...memoryTools, ...contextTools];\n\n    // Register tools with ToolManager\n    for (const tool of this._tools) {\n      this._toolManager.register(tool);\n    }\n\n    // Create idempotency cache first (needed for wrapping tools)\n    this.idempotencyCache = new IdempotencyCache(DEFAULT_IDEMPOTENCY_CONFIG);\n\n    // Get enabled tools from ToolManager and wrap with cache\n    const enabledTools = this._toolManager.getEnabled();\n    const cachedTools = enabledTools.map((tool) => this.wrapToolWithCache(tool));\n\n    // Create base Agent for LLM calls\n    this.agent = Agent.create({\n      connector: config.connector,\n      model: config.model,\n      tools: cachedTools,\n      instructions: config.instructions,\n      temperature: config.temperature,\n      maxIterations: config.maxIterations ?? 10,\n    });\n\n    // Calculate context limit from model\n    const modelInfo = getModelInfo(config.model);\n    const contextTokens = modelInfo?.features.input.tokens ?? 128000;\n\n    // Create context manager\n    this.contextManager = new ContextManager(\n      {\n        ...DEFAULT_CONTEXT_CONFIG,\n        maxContextTokens: contextTokens,\n      },\n      DEFAULT_COMPACTION_STRATEGY\n    );\n\n    // Note: idempotencyCache already created above for tool wrapping\n\n    // Create history manager\n    this.historyManager = new HistoryManager(DEFAULT_HISTORY_CONFIG);\n\n    // Create external dependency handler\n    this.externalHandler = new ExternalDependencyHandler(this._tools);\n\n    // Create checkpoint manager\n    this.checkpointManager = new CheckpointManager(this.storage, DEFAULT_CHECKPOINT_STRATEGY);\n\n    // Create plan executor\n    this.planExecutor = new PlanExecutor(\n      this.agent,\n      this.memory,\n      this.contextManager,\n      this.idempotencyCache,\n      this.historyManager,\n      this.externalHandler,\n      this.checkpointManager,\n      this.hooks,\n      {\n        maxIterations: config.maxIterations ?? 100,\n      }\n    );\n\n    // Forward events from plan executor to task agent (with cleanup tracking)\n    const taskStartHandler = (data: any) => this.emit('task:start', data);\n    const taskCompleteHandler = (data: any) => {\n      this.emit('task:complete', { task: data.task, result: { success: true, output: data.result } });\n      // Call afterTask hook\n      if (this.hooks?.afterTask) {\n        this.hooks.afterTask(data.task, { success: true, output: data.result });\n      }\n    };\n    const taskFailedHandler = (data: any) => this.emit('task:failed', data);\n    const taskSkippedHandler = (data: any) => this.emit('task:failed', { task: data.task, error: new Error(data.reason) });\n    const taskWaitingExternalHandler = (data: any) => this.emit('task:waiting', { task: data.task, dependency: data.task.externalDependency });\n\n    this.planExecutor.on('task:start', taskStartHandler);\n    this.planExecutor.on('task:complete', taskCompleteHandler);\n    this.planExecutor.on('task:failed', taskFailedHandler);\n    this.planExecutor.on('task:skipped', taskSkippedHandler);\n    this.planExecutor.on('task:waiting_external', taskWaitingExternalHandler);\n\n    // Track cleanup functions\n    this.eventCleanupFunctions.push(() => this.planExecutor?.off('task:start', taskStartHandler));\n    this.eventCleanupFunctions.push(() => this.planExecutor?.off('task:complete', taskCompleteHandler));\n    this.eventCleanupFunctions.push(() => this.planExecutor?.off('task:failed', taskFailedHandler));\n    this.eventCleanupFunctions.push(() => this.planExecutor?.off('task:skipped', taskSkippedHandler));\n    this.eventCleanupFunctions.push(() => this.planExecutor?.off('task:waiting_external', taskWaitingExternalHandler));\n  }\n\n  /**\n   * Resume an existing agent from storage\n   */\n  static async resume(\n    agentId: string,\n    options: { storage: IAgentStorage; tools?: ToolFunction[]; hooks?: TaskAgentHooks }\n  ): Promise<TaskAgent> {\n    const state = await options.storage.agent.load(agentId);\n    if (!state) {\n      throw new Error(`Agent ${agentId} not found in storage`);\n    }\n\n    // Recreate config from state\n    const config: TaskAgentConfig = {\n      connector: state.config.connectorName,\n      model: state.config.model,\n      tools: options.tools ?? [],\n      temperature: state.config.temperature,\n      maxIterations: state.config.maxIterations,\n      storage: options.storage,\n      hooks: options.hooks,\n    };\n\n    // Create working memory from stored state\n    const memory = new WorkingMemory(options.storage.memory, DEFAULT_MEMORY_CONFIG);\n\n    const taskAgent = new TaskAgent(agentId, state, options.storage, memory, config, options.hooks);\n\n    // Initialize components\n    taskAgent.initializeComponents(config);\n\n    return taskAgent;\n  }\n\n  /**\n   * Start executing a plan\n   */\n  async start(planInput: PlanInput): Promise<AgentHandle> {\n    // Create plan\n    const plan = createPlan(planInput);\n    this.state.plan = plan;\n    this.state = updateAgentStatus(this.state, 'running');\n\n    // Call onStart hook\n    if (this.hooks?.onStart) {\n      await this.hooks.onStart(this, plan);\n    }\n\n    // Start execution and store promise\n    this.executionPromise = this.executePlan()\n      .then(async (result) => {\n        // Call onComplete hook after execution finishes\n        if (this.hooks?.onComplete) {\n          await this.hooks.onComplete(result);\n        }\n        return result;\n      })\n      .catch(async (error) => {\n        // Call onError hook on failure\n        if (this.hooks?.onError) {\n          await this.hooks.onError(error, { error, phase: 'execution' });\n        }\n        throw error;\n      });\n\n    // For sync-like behavior in tests, await completion\n    // TODO: Make this configurable for true background execution\n    await this.executionPromise.catch(() => {\n      // Swallow error here, it will be re-thrown when wait() is called\n    });\n\n    // Return handle\n    return {\n      agentId: this.id,\n      planId: plan.id,\n      wait: async () => {\n        if (!this.executionPromise) {\n          throw new Error('No execution in progress');\n        }\n        return this.executionPromise;\n      },\n      status: () => this.state.status,\n    };\n  }\n\n  /**\n   * Pause execution\n   */\n  async pause(): Promise<void> {\n    this.state = updateAgentStatus(this.state, 'suspended');\n    this.state.plan.status = 'suspended';\n\n    this.emit('agent:suspended', { reason: 'manual_pause' });\n  }\n\n  /**\n   * Resume execution after pause\n   */\n  async resume(): Promise<void> {\n    this.state = updateAgentStatus(this.state, 'running');\n    this.state.plan.status = 'running';\n\n    this.emit('agent:resumed', {});\n\n    // Continue execution\n    await this.executePlan();\n  }\n\n  /**\n   * Cancel execution\n   */\n  async cancel(): Promise<void> {\n    this.state = updateAgentStatus(this.state, 'cancelled');\n    this.state.plan.status = 'cancelled';\n  }\n\n  /**\n   * Trigger external dependency completion\n   */\n  async triggerExternal(webhookId: string, data: unknown): Promise<void> {\n    const plan = this.state.plan;\n    if (!plan) {\n      throw new Error('No plan running');\n    }\n\n    // Find task with this webhook\n    const task = plan.tasks.find((t) => t.externalDependency?.webhookId === webhookId);\n\n    if (!task || !task.externalDependency) {\n      throw new Error(`Task waiting on webhook ${webhookId} not found`);\n    }\n\n    // Mark as received\n    task.externalDependency.state = 'received';\n    task.externalDependency.receivedData = data;\n    task.externalDependency.receivedAt = Date.now();\n\n    // Resume execution\n    await this.resume();\n  }\n\n  /**\n   * Manually complete a task\n   */\n  async completeTaskManually(taskId: string, result: unknown): Promise<void> {\n    const plan = this.state.plan;\n    if (!plan) {\n      throw new Error('No plan running');\n    }\n\n    const task = plan.tasks.find((t) => t.id === taskId);\n    if (!task || !task.externalDependency) {\n      throw new Error(`Task ${taskId} not found or not waiting on manual input`);\n    }\n\n    // Mark as received\n    task.externalDependency.state = 'received';\n    task.externalDependency.receivedData = result;\n    task.externalDependency.receivedAt = Date.now();\n  }\n\n  /**\n   * Update the plan\n   */\n  async updatePlan(updates: PlanUpdates): Promise<void> {\n    const plan = this.state.plan;\n    if (!plan) {\n      throw new Error('No plan running');\n    }\n\n    if (!plan.allowDynamicTasks && (updates.addTasks || updates.removeTasks)) {\n      throw new Error('Dynamic tasks are disabled for this plan');\n    }\n\n    // Add tasks\n    if (updates.addTasks) {\n      for (const taskInput of updates.addTasks) {\n        const task = createTask(taskInput);\n        plan.tasks.push(task);\n      }\n    }\n\n    // Update tasks\n    if (updates.updateTasks) {\n      for (const update of updates.updateTasks) {\n        const task = plan.tasks.find((t) => t.id === update.id);\n        if (task) {\n          Object.assign(task, update);\n        }\n      }\n    }\n\n    // Remove tasks\n    if (updates.removeTasks) {\n      plan.tasks = plan.tasks.filter((t) => !updates.removeTasks!.includes(t.id));\n    }\n\n    plan.lastUpdatedAt = Date.now();\n\n    this.emit('plan:updated', { plan });\n  }\n\n  /**\n   * Get current agent state\n   */\n  getState(): AgentState {\n    return this.state;\n  }\n\n  /**\n   * Get current plan\n   */\n  getPlan(): Plan {\n    if (!this.state.plan || !this.state.plan.goal) {\n      throw new Error('No plan started');\n    }\n    return this.state.plan;\n  }\n\n  /**\n   * Get working memory\n   */\n  getMemory(): WorkingMemory {\n    return this.memory;\n  }\n\n  // ============ Session Management (NEW) ============\n\n  /**\n   * Get the current session ID (if session is enabled)\n   */\n  getSessionId(): string | null {\n    return this._session?.id ?? null;\n  }\n\n  /**\n   * Check if this agent has session support enabled\n   */\n  hasSession(): boolean {\n    return this._session !== null;\n  }\n\n  /**\n   * Save the current session to storage\n   * @throws Error if session is not enabled\n   */\n  async saveSession(): Promise<void> {\n    if (!this._sessionManager || !this._session) {\n      throw new Error('Session not enabled. Configure session in TaskAgentConfig to use this feature.');\n    }\n\n    // Update session state before saving\n    this._session.toolState = this._toolManager.getState();\n\n    // Serialize plan if exists\n    if (this.state.plan) {\n      this._session.plan = {\n        version: 1,\n        data: this.state.plan,\n      };\n    }\n\n    // Serialize memory\n    const memoryEntries = await this.memory.getIndex();\n    this._session.memory = {\n      version: 1,\n      entries: memoryEntries.entries.map((e) => ({\n        key: e.key,\n        description: e.description,\n        value: null, // Don't serialize full values, they're in storage\n        scope: e.scope,\n        sizeBytes: 0, // Size is stored as human-readable in index\n      })),\n    };\n\n    await this._sessionManager.save(this._session);\n  }\n\n  /**\n   * Get the current session (for advanced use)\n   */\n  getSession(): Session | null {\n    return this._session;\n  }\n\n  /**\n   * Update session custom data\n   */\n  updateSessionData(key: string, value: unknown): void {\n    if (!this._session) {\n      throw new Error('Session not enabled');\n    }\n    this._session.custom[key] = value;\n  }\n\n  /**\n   * Get session custom data\n   */\n  getSessionData<T = unknown>(key: string): T | undefined {\n    return this._session?.custom[key] as T | undefined;\n  }\n\n  /**\n   * Execute the plan (internal)\n   */\n  protected async executePlan(): Promise<PlanResult> {\n    const plan = this.state.plan;\n\n    if (!this.planExecutor) {\n      throw new Error('Plan executor not initialized');\n    }\n\n    try {\n      // Execute the plan\n      const execResult = await this.planExecutor.execute(plan, this.state);\n\n      // Update metrics from execution\n      if (execResult.metrics) {\n        this.state.metrics.totalLLMCalls += execResult.metrics.totalLLMCalls;\n        this.state.metrics.totalToolCalls += execResult.metrics.totalToolCalls;\n        this.state.metrics.totalTokensUsed += execResult.metrics.totalTokensUsed;\n        this.state.metrics.totalCost += execResult.metrics.totalCost;\n      }\n\n      // Update agent state\n      if (execResult.status === 'completed') {\n        this.state = updateAgentStatus(this.state, 'completed');\n        plan.status = 'completed';\n      } else if (execResult.status === 'failed') {\n        this.state = updateAgentStatus(this.state, 'failed');\n        plan.status = 'failed';\n      } else if (execResult.status === 'suspended') {\n        this.state = updateAgentStatus(this.state, 'suspended');\n        plan.status = 'suspended';\n      }\n\n      // Final checkpoint\n      await this.checkpointManager?.checkpoint(this.state, 'execution_complete');\n\n      const result: PlanResult = {\n        status: execResult.status === 'suspended' ? 'completed' : execResult.status,\n        metrics: {\n          totalTasks: plan.tasks.length,\n          completedTasks: execResult.completedTasks,\n          failedTasks: execResult.failedTasks,\n          skippedTasks: execResult.skippedTasks,\n        },\n      };\n\n      this.emit('agent:completed', { result });\n\n      return result;\n    } catch (error) {\n      // Handle execution error\n      const err = error instanceof Error ? error : new Error(String(error));\n\n      this.state = updateAgentStatus(this.state, 'failed');\n      plan.status = 'failed';\n\n      // Try to checkpoint the failure\n      try {\n        await this.checkpointManager?.checkpoint(this.state, 'execution_failed');\n      } catch {\n        // Ignore checkpoint errors during failure handling\n      }\n\n      const result: PlanResult = {\n        status: 'failed',\n        error: err.message,\n        metrics: {\n          totalTasks: plan.tasks.length,\n          completedTasks: plan.tasks.filter((t) => t.status === 'completed').length,\n          failedTasks: plan.tasks.filter((t) => t.status === 'failed').length,\n          skippedTasks: plan.tasks.filter((t) => t.status === 'skipped').length,\n        },\n      };\n\n      this.emit('agent:completed', { result });\n\n      throw err;\n    }\n  }\n\n  /**\n   * Cleanup resources\n   */\n  async destroy(): Promise<void> {\n    // Remove all event listeners first\n    this.eventCleanupFunctions.forEach((cleanup) => cleanup());\n    this.eventCleanupFunctions = [];\n\n    // Cleanup session manager\n    if (this._sessionManager) {\n      if (this._session) {\n        this._sessionManager.stopAutoSave(this._session.id);\n      }\n      this._sessionManager.destroy();\n    }\n\n    // Cleanup tool manager\n    this._toolManager.removeAllListeners();\n\n    // Cleanup components\n    this.externalHandler?.cleanup();\n    await this.checkpointManager?.cleanup();\n    this.planExecutor?.cleanup();\n    this.agent?.destroy();\n  }\n}\n","/**\n * In-memory storage implementations (default, non-persistent)\n */\n\nimport { MemoryEntry, MemoryScope } from '../../domain/entities/Memory.js';\nimport { Plan, Task, PlanStatus } from '../../domain/entities/Task.js';\nimport { AgentState, AgentStatus } from '../../domain/entities/AgentState.js';\nimport { IMemoryStorage } from '../../domain/interfaces/IMemoryStorage.js';\nimport { IPlanStorage } from '../../domain/interfaces/IPlanStorage.js';\nimport { IAgentStateStorage } from '../../domain/interfaces/IAgentStateStorage.js';\n\n/**\n * In-memory implementation of IMemoryStorage\n */\nexport class InMemoryStorage implements IMemoryStorage {\n  private store = new Map<string, MemoryEntry>();\n\n  async get(key: string): Promise<MemoryEntry | undefined> {\n    return this.store.get(key);\n  }\n\n  async set(key: string, entry: MemoryEntry): Promise<void> {\n    this.store.set(key, entry);\n  }\n\n  async delete(key: string): Promise<void> {\n    this.store.delete(key);\n  }\n\n  async has(key: string): Promise<boolean> {\n    return this.store.has(key);\n  }\n\n  async getAll(): Promise<MemoryEntry[]> {\n    return Array.from(this.store.values());\n  }\n\n  async getByScope(scope: MemoryScope): Promise<MemoryEntry[]> {\n    return Array.from(this.store.values()).filter((entry) => entry.scope === scope);\n  }\n\n  async clearScope(scope: MemoryScope): Promise<void> {\n    const toDelete: string[] = [];\n    for (const [key, entry] of this.store.entries()) {\n      if (entry.scope === scope) {\n        toDelete.push(key);\n      }\n    }\n    for (const key of toDelete) {\n      this.store.delete(key);\n    }\n  }\n\n  async clear(): Promise<void> {\n    this.store.clear();\n  }\n\n  async getTotalSize(): Promise<number> {\n    let total = 0;\n    for (const entry of this.store.values()) {\n      total += entry.sizeBytes;\n    }\n    return total;\n  }\n}\n\n/**\n * In-memory implementation of IPlanStorage\n */\nexport class InMemoryPlanStorage implements IPlanStorage {\n  private plans = new Map<string, Plan>();\n\n  async savePlan(plan: Plan): Promise<void> {\n    // Deep clone to avoid mutations\n    this.plans.set(plan.id, JSON.parse(JSON.stringify(plan)));\n  }\n\n  async getPlan(planId: string): Promise<Plan | undefined> {\n    const plan = this.plans.get(planId);\n    return plan ? JSON.parse(JSON.stringify(plan)) : undefined;\n  }\n\n  async updateTask(planId: string, task: Task): Promise<void> {\n    const plan = this.plans.get(planId);\n    if (!plan) {\n      throw new Error(`Plan ${planId} not found`);\n    }\n\n    const taskIndex = plan.tasks.findIndex((t) => t.id === task.id);\n    if (taskIndex === -1) {\n      throw new Error(`Task ${task.id} not found in plan ${planId}`);\n    }\n\n    plan.tasks[taskIndex] = JSON.parse(JSON.stringify(task));\n  }\n\n  async addTask(planId: string, task: Task): Promise<void> {\n    const plan = this.plans.get(planId);\n    if (!plan) {\n      throw new Error(`Plan ${planId} not found`);\n    }\n\n    plan.tasks.push(JSON.parse(JSON.stringify(task)));\n  }\n\n  async deletePlan(planId: string): Promise<void> {\n    this.plans.delete(planId);\n  }\n\n  async listPlans(filter?: { status?: PlanStatus[] }): Promise<Plan[]> {\n    const allPlans = Array.from(this.plans.values());\n\n    if (!filter || !filter.status) {\n      return allPlans.map((p) => JSON.parse(JSON.stringify(p)));\n    }\n\n    return allPlans\n      .filter((plan) => filter.status!.includes(plan.status))\n      .map((p) => JSON.parse(JSON.stringify(p)));\n  }\n\n  async findByWebhookId(webhookId: string): Promise<{ plan: Plan; task: Task } | undefined> {\n    for (const plan of this.plans.values()) {\n      for (const task of plan.tasks) {\n        if (task.externalDependency?.webhookId === webhookId) {\n          return {\n            plan: JSON.parse(JSON.stringify(plan)),\n            task: JSON.parse(JSON.stringify(task)),\n          };\n        }\n      }\n    }\n    return undefined;\n  }\n}\n\n/**\n * In-memory implementation of IAgentStateStorage\n */\nexport class InMemoryAgentStateStorage implements IAgentStateStorage {\n  private agents = new Map<string, AgentState>();\n\n  async save(state: AgentState): Promise<void> {\n    // Deep clone to avoid mutations\n    this.agents.set(state.id, JSON.parse(JSON.stringify(state)));\n  }\n\n  async load(agentId: string): Promise<AgentState | undefined> {\n    const state = this.agents.get(agentId);\n    return state ? JSON.parse(JSON.stringify(state)) : undefined;\n  }\n\n  async delete(agentId: string): Promise<void> {\n    this.agents.delete(agentId);\n  }\n\n  async list(filter?: { status?: AgentStatus[] }): Promise<AgentState[]> {\n    const allStates = Array.from(this.agents.values());\n\n    if (!filter || !filter.status) {\n      return allStates.map((s) => JSON.parse(JSON.stringify(s)));\n    }\n\n    return allStates\n      .filter((state) => filter.status!.includes(state.status))\n      .map((s) => JSON.parse(JSON.stringify(s)));\n  }\n\n  async patch(agentId: string, updates: Partial<AgentState>): Promise<void> {\n    const state = this.agents.get(agentId);\n    if (!state) {\n      throw new Error(`Agent ${agentId} not found`);\n    }\n\n    Object.assign(state, updates);\n  }\n}\n\n/**\n * Unified agent storage interface\n */\nexport interface IAgentStorage {\n  memory: IMemoryStorage;\n  plan: IPlanStorage;\n  agent: IAgentStateStorage;\n}\n\n/**\n * Create agent storage with defaults\n */\nexport function createAgentStorage(options: {\n  memory?: IMemoryStorage;\n  plan?: IPlanStorage;\n  agent?: IAgentStateStorage;\n} = {}): IAgentStorage {\n  return {\n    memory: options.memory ?? new InMemoryStorage(),\n    plan: options.plan ?? new InMemoryPlanStorage(),\n    agent: options.agent ?? new InMemoryAgentStateStorage(),\n  };\n}\n\n// Re-export for convenience\nexport { InMemoryStorage as InMemoryMemoryStorage };\nexport type { IAgentStorage as InMemoryAgentStorage };\n","/**\n * WorkingMemory class - manages indexed working memory for TaskAgent\n */\n\nimport EventEmitter from 'eventemitter3';\nimport { IMemoryStorage } from '../../domain/interfaces/IMemoryStorage.js';\nimport { WorkingMemoryAccess } from '../../domain/interfaces/IToolContext.js';\nimport type {\n  MemoryIndex,\n  MemoryScope,\n  WorkingMemoryConfig,\n} from '../../domain/entities/Memory.js';\nimport { DEFAULT_MEMORY_CONFIG } from '../../domain/entities/Memory.js';\n\nexport interface WorkingMemoryEvents {\n  stored: { key: string; description: string };\n  retrieved: { key: string };\n  deleted: { key: string };\n  limit_warning: { utilizationPercent: number };\n}\n\n/**\n * WorkingMemory manages the agent's indexed working memory.\n *\n * Features:\n * - Store/retrieve with descriptions for index\n * - Scoped memory (task vs persistent)\n * - LRU eviction when approaching limits\n * - Event emission for monitoring\n */\nexport class WorkingMemory extends EventEmitter<WorkingMemoryEvents> {\n  private storage: IMemoryStorage;\n  private config: WorkingMemoryConfig;\n\n  constructor(storage: IMemoryStorage, config: WorkingMemoryConfig = DEFAULT_MEMORY_CONFIG) {\n    super();\n    this.storage = storage;\n    this.config = config;\n  }\n\n  /**\n   * Store a value in working memory\n   */\n  async store(\n    key: string,\n    description: string,\n    value: unknown,\n    scope: MemoryScope = 'task'\n  ): Promise<void> {\n    const { createMemoryEntry } = await import('../../domain/entities/Memory.js');\n\n    // Validate and create entry\n    const entry = createMemoryEntry({ key, description, value, scope }, this.config);\n\n    // Check size limit\n    const currentSize = await this.storage.getTotalSize();\n    const existing = await this.storage.get(key);\n    const existingSize = existing?.sizeBytes ?? 0;\n    const newTotalSize = currentSize - existingSize + entry.sizeBytes;\n\n    const limit = this.getLimit();\n\n    if (newTotalSize > limit) {\n      throw new Error(`Memory limit exceeded: ${newTotalSize} bytes > ${limit} bytes`);\n    }\n\n    // Check soft limit warning\n    const utilization = (newTotalSize / limit) * 100;\n    if (utilization > this.config.softLimitPercent) {\n      this.emit('limit_warning', { utilizationPercent: utilization });\n    }\n\n    // Store entry\n    await this.storage.set(key, entry);\n\n    this.emit('stored', { key, description });\n  }\n\n  /**\n   * Retrieve a value from working memory\n   */\n  async retrieve(key: string): Promise<unknown> {\n    const entry = await this.storage.get(key);\n    if (!entry) {\n      return undefined;\n    }\n\n    // Update access stats\n    entry.lastAccessedAt = Date.now();\n    entry.accessCount += 1;\n    await this.storage.set(key, entry);\n\n    this.emit('retrieved', { key });\n\n    return entry.value;\n  }\n\n  /**\n   * Retrieve multiple values\n   */\n  async retrieveMany(keys: string[]): Promise<Record<string, unknown>> {\n    const result: Record<string, unknown> = {};\n\n    for (const key of keys) {\n      const value = await this.retrieve(key);\n      if (value !== undefined) {\n        result[key] = value;\n      }\n    }\n\n    return result;\n  }\n\n  /**\n   * Delete a value from working memory\n   */\n  async delete(key: string): Promise<void> {\n    await this.storage.delete(key);\n    this.emit('deleted', { key });\n  }\n\n  /**\n   * Check if key exists\n   */\n  async has(key: string): Promise<boolean> {\n    return this.storage.has(key);\n  }\n\n  /**\n   * Promote a task-scoped entry to persistent\n   */\n  async persist(key: string): Promise<void> {\n    const entry = await this.storage.get(key);\n    if (!entry) {\n      throw new Error(`Key \"${key}\" not found in memory`);\n    }\n\n    if (entry.scope !== 'persistent') {\n      entry.scope = 'persistent';\n      await this.storage.set(key, entry);\n    }\n  }\n\n  /**\n   * Clear all entries of a specific scope\n   */\n  async clearScope(scope: MemoryScope): Promise<void> {\n    await this.storage.clearScope(scope);\n  }\n\n  /**\n   * Clear all entries\n   */\n  async clear(): Promise<void> {\n    await this.storage.clear();\n  }\n\n  /**\n   * Get memory index\n   */\n  async getIndex(): Promise<MemoryIndex> {\n    const { formatSizeHuman } = await import('../../domain/entities/Memory.js');\n\n    const entries = await this.storage.getAll();\n    const totalSizeBytes = await this.storage.getTotalSize();\n    const limitBytes = this.getLimit();\n\n    // Sort by scope (persistent first)\n    const sortedEntries = entries.sort((a, b) => {\n      if (a.scope === 'persistent' && b.scope !== 'persistent') return -1;\n      if (a.scope !== 'persistent' && b.scope === 'persistent') return 1;\n      return 0;\n    });\n\n    const indexEntries = sortedEntries.map((entry) => ({\n      key: entry.key,\n      description: entry.description,\n      size: formatSizeHuman(entry.sizeBytes),\n      scope: entry.scope,\n    }));\n\n    return {\n      entries: indexEntries,\n      totalSizeBytes,\n      totalSizeHuman: formatSizeHuman(totalSizeBytes),\n      limitBytes,\n      limitHuman: formatSizeHuman(limitBytes),\n      utilizationPercent: (totalSizeBytes / limitBytes) * 100,\n    };\n  }\n\n  /**\n   * Format index for context injection\n   */\n  async formatIndex(): Promise<string> {\n    const { formatMemoryIndex } = await import('../../domain/entities/Memory.js');\n    const index = await this.getIndex();\n    return formatMemoryIndex(index);\n  }\n\n  /**\n   * Evict least recently used entries\n   */\n  async evictLRU(count: number): Promise<string[]> {\n    const entries = await this.storage.getAll();\n\n    // Only evict task-scoped entries\n    const evictable = entries\n      .filter((entry) => entry.scope === 'task')\n      .sort((a, b) => a.lastAccessedAt - b.lastAccessedAt);\n\n    const toEvict = evictable.slice(0, count);\n    const evictedKeys: string[] = [];\n\n    for (const entry of toEvict) {\n      await this.storage.delete(entry.key);\n      evictedKeys.push(entry.key);\n    }\n\n    return evictedKeys;\n  }\n\n  /**\n   * Evict largest entries first\n   */\n  async evictBySize(count: number): Promise<string[]> {\n    const entries = await this.storage.getAll();\n\n    // Only evict task-scoped entries\n    const evictable = entries\n      .filter((entry) => entry.scope === 'task')\n      .sort((a, b) => b.sizeBytes - a.sizeBytes);\n\n    const toEvict = evictable.slice(0, count);\n    const evictedKeys: string[] = [];\n\n    for (const entry of toEvict) {\n      await this.storage.delete(entry.key);\n      evictedKeys.push(entry.key);\n    }\n\n    return evictedKeys;\n  }\n\n  /**\n   * Get limited memory access for tools\n   */\n  getAccess(): WorkingMemoryAccess {\n    return {\n      get: async (key: string) => this.retrieve(key),\n      set: async (key: string, description: string, value: unknown) =>\n        this.store(key, description, value),\n      delete: async (key: string) => this.delete(key),\n      has: async (key: string) => this.has(key),\n      list: async () => {\n        const index = await this.getIndex();\n        return index.entries.map((e) => ({ key: e.key, description: e.description }));\n      },\n    };\n  }\n\n  /**\n   * Get the configured memory limit\n   */\n  getLimit(): number {\n    return this.config.maxSizeBytes ?? 512 * 1024; // Default 512KB\n  }\n}\n\nexport type { WorkingMemoryConfig };\nexport { DEFAULT_MEMORY_CONFIG };\n","/**\n * ContextManager - manages context window size and compaction\n */\n\nimport EventEmitter from 'eventemitter3';\n\n/**\n * Context manager configuration\n */\nexport interface ContextManagerConfig {\n  /** Model's max context tokens */\n  maxContextTokens: number;\n\n  /** Trigger compaction at this % of max */\n  compactionThreshold: number;\n\n  /** Hard limit - must compact before LLM call */\n  hardLimit: number;\n\n  /** Reserve space for response */\n  responseReserve: number;\n\n  /** Token estimator method */\n  tokenEstimator: 'approximate' | 'tiktoken';\n}\n\n/**\n * Compaction strategy configuration\n */\nexport interface CompactionStrategy {\n  /** Priority order for compaction */\n  priority: Array<'toolOutputs' | 'history' | 'memory'>;\n\n  /** Strategy for history compaction */\n  historyStrategy: 'summarize' | 'truncate' | 'sliding-window';\n\n  /** Strategy for memory eviction */\n  memoryStrategy: 'lru' | 'largest-first' | 'oldest-first';\n\n  /** Max tokens for tool outputs */\n  toolOutputMaxSize: number;\n}\n\n/**\n * Context components that make up the full context\n */\nexport interface ContextComponents {\n  systemPrompt: string;\n  instructions: string;\n  memoryIndex: string;\n  conversationHistory: Array<{ role: string; content: string }>;\n  currentInput: string;\n}\n\n/**\n * Context budget breakdown\n */\nexport interface ContextBudget {\n  total: number;\n  reserved: number;\n  used: number;\n  available: number;\n  utilizationPercent: number;\n  status: 'ok' | 'warning' | 'critical';\n  breakdown: {\n    systemPrompt: number;\n    instructions: number;\n    memoryIndex: number;\n    conversationHistory: number;\n    currentInput: number;\n  };\n}\n\n/**\n * Prepared context result\n */\nexport interface PreparedContext {\n  components: ContextComponents;\n  budget: ContextBudget;\n  compacted: boolean;\n  compactionLog?: string[];\n}\n\n/**\n * Memory manager interface (for compaction)\n */\nexport interface IMemoryManager {\n  evictLRU(count: number): Promise<string[]>;\n  formatIndex?(): Promise<string>;\n  getIndex?(): Promise<{ entries: any[] }>;\n}\n\n/**\n * History manager interface (for compaction)\n */\nexport interface IHistoryManager {\n  summarize(): Promise<void>;\n  truncate?(messages: any[], limit: number): Promise<any[]>;\n}\n\n/**\n * Default configuration\n */\nexport const DEFAULT_CONTEXT_CONFIG: ContextManagerConfig = {\n  maxContextTokens: 128000,\n  compactionThreshold: 0.75,\n  hardLimit: 0.9,\n  responseReserve: 0.15,\n  tokenEstimator: 'approximate',\n};\n\n/**\n * Default compaction strategy\n */\nexport const DEFAULT_COMPACTION_STRATEGY: CompactionStrategy = {\n  priority: ['toolOutputs', 'history', 'memory'],\n  historyStrategy: 'summarize',\n  memoryStrategy: 'lru',\n  toolOutputMaxSize: 4000,\n};\n\nexport interface ContextManagerEvents {\n  compacting: { reason: string };\n  compacted: { log: string[] };\n}\n\n/**\n * ContextManager handles context window management.\n *\n * Features:\n * - Token estimation (approximate or tiktoken)\n * - Proactive compaction before overflow\n * - Configurable compaction strategies\n * - Tool output truncation\n */\nexport class ContextManager extends EventEmitter<ContextManagerEvents> {\n  private config: ContextManagerConfig;\n  private strategy: CompactionStrategy;\n  private lastBudget?: ContextBudget;\n\n  constructor(\n    config: ContextManagerConfig = DEFAULT_CONTEXT_CONFIG,\n    strategy: CompactionStrategy = DEFAULT_COMPACTION_STRATEGY\n  ) {\n    super();\n    this.config = config;\n    this.strategy = strategy;\n  }\n\n  /**\n   * Estimate token count for text\n   */\n  estimateTokens(text: string): number {\n    if (!text || text.length === 0) {\n      return 0;\n    }\n\n    if (this.config.tokenEstimator === 'approximate') {\n      // Approximate: 1 token  4 characters\n      return Math.ceil(text.length / 4);\n    }\n\n    // TODO: Implement tiktoken when needed\n    return Math.ceil(text.length / 4);\n  }\n\n  /**\n   * Estimate budget for context components\n   */\n  estimateBudget(components: ContextComponents): ContextBudget {\n    const breakdown = {\n      systemPrompt: this.estimateTokens(components.systemPrompt),\n      instructions: this.estimateTokens(components.instructions),\n      memoryIndex: this.estimateTokens(components.memoryIndex),\n      conversationHistory: components.conversationHistory.reduce(\n        (sum, msg) => sum + this.estimateTokens(msg.content),\n        0\n      ),\n      currentInput: this.estimateTokens(components.currentInput),\n    };\n\n    const used = Object.values(breakdown).reduce((sum, val) => sum + val, 0);\n    const total = this.config.maxContextTokens;\n    const reserved = Math.floor(total * this.config.responseReserve);\n    const available = total - reserved - used;\n    const utilizationPercent = (used / (total - reserved)) * 100;\n\n    // Calculate utilization including reserve\n    // We need to ensure there's enough space for the response\n    const utilizationRatio = (used + reserved) / total;\n\n    let status: 'ok' | 'warning' | 'critical';\n    if (utilizationRatio >= this.config.hardLimit) {\n      status = 'critical';\n    } else if (utilizationRatio >= this.config.compactionThreshold) {\n      status = 'warning';\n    } else {\n      status = 'ok';\n    }\n\n    return {\n      total,\n      reserved,\n      used,\n      available,\n      utilizationPercent,\n      status,\n      breakdown,\n    };\n  }\n\n  /**\n   * Prepare context, compacting if necessary\n   */\n  async prepareContext(\n    components: ContextComponents,\n    memory: IMemoryManager,\n    history: IHistoryManager\n  ): Promise<PreparedContext> {\n    let current = { ...components };\n    let budget = this.estimateBudget(current);\n\n    // Store budget for inspection\n    this.lastBudget = budget;\n\n    // If under threshold, no compaction needed\n    if (budget.status === 'ok') {\n      return { components: current, budget, compacted: false };\n    }\n\n    // Need to compact\n    this.emit('compacting', { reason: `Context at ${budget.utilizationPercent.toFixed(1)}%` });\n\n    const log: string[] = [];\n\n    // Compact according to strategy priority\n    // Keep compacting until we're under threshold or run out of options\n    let compactionRound = 0;\n    const maxRounds = 3; // Prevent infinite loops\n\n    while (budget.status !== 'ok' && compactionRound < maxRounds) {\n      compactionRound++;\n      let didCompact = false;\n\n      for (const target of this.strategy.priority) {\n        budget = this.estimateBudget(current);\n\n        if (budget.status === 'ok') {\n          break; // Compacted enough\n        }\n\n        switch (target) {\n          case 'toolOutputs':\n            // Truncate large tool outputs in conversation history\n            if (current.conversationHistory.length > 0) {\n              const before = JSON.stringify(current);\n              current = this.truncateToolOutputsInHistory(current);\n              if (JSON.stringify(current) !== before) {\n                log.push(`Truncated tool outputs to ${this.strategy.toolOutputMaxSize} tokens`);\n                didCompact = true;\n              }\n            }\n            break;\n\n          case 'history':\n            // Compact history\n            if (current.conversationHistory.length > 0) {\n              if (this.strategy.historyStrategy === 'truncate') {\n                // Keep only recent messages, more aggressive each round\n                const keepRatio = Math.max(0.2, 1 - compactionRound * 0.3);\n                const maxMessages = Math.max(1, Math.floor(current.conversationHistory.length * keepRatio));\n                const before = current.conversationHistory.length;\n                current.conversationHistory = current.conversationHistory.slice(-maxMessages);\n                if (current.conversationHistory.length < before) {\n                  log.push(`Truncated history to ${maxMessages} messages`);\n                  didCompact = true;\n                }\n              } else {\n                // Summarize (placeholder - would need LLM call)\n                await history.summarize();\n                log.push('Summarized conversation history');\n                didCompact = true;\n              }\n            }\n            break;\n\n          case 'memory':\n            // Evict memory entries\n            // Default to assuming some entries exist if we can't check\n            const entryCount = memory.getIndex ? (await memory.getIndex()).entries.length : 4;\n            const evictCount = Math.max(1, Math.ceil(entryCount * 0.25));\n\n            if (evictCount > 0) {\n              const evicted = await memory.evictLRU(evictCount);\n              if (evicted.length > 0) {\n                log.push(`Evicted ${evicted.length} memory entries: ${evicted.join(', ')}`);\n                didCompact = true;\n\n                // Update memory index in context if method available\n                if (memory.formatIndex) {\n                  current.memoryIndex = await memory.formatIndex();\n                }\n              }\n            }\n            break;\n        }\n      }\n\n      // If we didn't compact anything this round, no point continuing\n      if (!didCompact) {\n        break;\n      }\n    }\n\n    budget = this.estimateBudget(current);\n\n    // Only throw if we're significantly over capacity (>5% over)\n    // Small overages are acceptable after best-effort compaction\n    const totalCapacity = budget.total - budget.reserved;\n    const overage = budget.used - totalCapacity;\n    const overagePercent = (overage / totalCapacity) * 100;\n\n    if (overage > 0 && overagePercent > 5) {\n      throw new Error(\n        `Cannot fit context within limits after compaction. Used: ${budget.used}, Available: ${totalCapacity} (${overagePercent.toFixed(1)}% over)`\n      );\n    }\n\n    this.emit('compacted', { log });\n\n    return { components: current, budget, compacted: true, compactionLog: log };\n  }\n\n  /**\n   * Truncate tool outputs in conversation history\n   */\n  private truncateToolOutputsInHistory(components: ContextComponents): ContextComponents {\n    const truncated = { ...components };\n    truncated.conversationHistory = components.conversationHistory.map((msg) => {\n      const tokens = this.estimateTokens(msg.content);\n      if (tokens > this.strategy.toolOutputMaxSize) {\n        // Truncate the content\n        const maxChars = this.strategy.toolOutputMaxSize * 4;\n        return {\n          ...msg,\n          content: msg.content.substring(0, maxChars) + '\\n[truncated...]',\n        };\n      }\n      return msg;\n    });\n    return truncated;\n  }\n\n  /**\n   * Truncate tool output to fit within limit\n   */\n  truncateToolOutput(output: unknown, maxTokens: number): unknown {\n    const serialized = JSON.stringify(output);\n    const tokens = this.estimateTokens(serialized);\n\n    if (tokens <= maxTokens) {\n      return output;\n    }\n\n    // Create truncated version\n    return {\n      _truncated: true,\n      _summary: this.createOutputSummary(output, maxTokens),\n      _originalSize: `${tokens} tokens`,\n    };\n  }\n\n  /**\n   * Create summary of large output\n   */\n  createOutputSummary(output: unknown, maxTokens: number): string {\n    if (output === null) return 'null';\n    if (output === undefined) return 'undefined';\n\n    if (Array.isArray(output)) {\n      const firstItem = output[0];\n      const keys = firstItem && typeof firstItem === 'object' ? Object.keys(firstItem) : [];\n      return `Array with ${output.length} items${keys.length > 0 ? `, first item keys: ${keys.join(', ')}` : ''}`;\n    }\n\n    if (typeof output === 'object') {\n      const keys = Object.keys(output);\n      return `Object with ${keys.length} keys: ${keys.slice(0, 10).join(', ')}${keys.length > 10 ? ` ... and ${keys.length - 10} more` : ''}`;\n    }\n\n    if (typeof output === 'string') {\n      const maxChars = maxTokens * 4;\n      return output.length > maxChars ? output.substring(0, maxChars) + '...' : output;\n    }\n\n    return String(output);\n  }\n\n  /**\n   * Check if output should be auto-stored in memory\n   */\n  shouldAutoStore(output: unknown, threshold: number): boolean {\n    const serialized = JSON.stringify(output);\n    const tokens = this.estimateTokens(serialized);\n    return tokens > threshold;\n  }\n\n  /**\n   * Get current context budget\n   */\n  getCurrentBudget(): ContextBudget | null {\n    return this.lastBudget ?? null;\n  }\n\n  /**\n   * Get current configuration\n   */\n  getConfig(): ContextManagerConfig {\n    return { ...this.config };\n  }\n\n  /**\n   * Get current compaction strategy\n   */\n  getStrategy(): CompactionStrategy {\n    return { ...this.strategy };\n  }\n\n  /**\n   * Update configuration\n   */\n  updateConfig(updates: Partial<ContextManagerConfig>): void {\n    this.config = { ...this.config, ...updates };\n  }\n}\n","/**\n * IdempotencyCache - caches tool call results for deduplication\n */\n\nimport { ToolFunction } from '../../domain/entities/Tool.js';\n\n/**\n * Cache configuration\n */\nexport interface IdempotencyCacheConfig {\n  /** Default TTL for cached entries */\n  defaultTtlMs: number;\n\n  /** Max entries before eviction */\n  maxEntries: number;\n}\n\n/**\n * Cache statistics\n */\nexport interface CacheStats {\n  entries: number;\n  hits: number;\n  misses: number;\n  hitRate: number;\n}\n\n/**\n * Default configuration\n */\nexport const DEFAULT_IDEMPOTENCY_CONFIG: IdempotencyCacheConfig = {\n  defaultTtlMs: 3600000, // 1 hour\n  maxEntries: 1000,\n};\n\n/**\n * IdempotencyCache handles tool call result caching.\n *\n * Features:\n * - Cache based on tool name + args\n * - Custom key generation per tool\n * - TTL-based expiration\n * - Max entries eviction\n */\nexport class IdempotencyCache {\n  private config: IdempotencyCacheConfig;\n  private cache = new Map<string, { value: unknown; expiresAt: number }>();\n  private hits = 0;\n  private misses = 0;\n  private cleanupInterval?: NodeJS.Timeout;\n\n  constructor(config: IdempotencyCacheConfig = DEFAULT_IDEMPOTENCY_CONFIG) {\n    this.config = config;\n\n    // Start background cleanup (every 5 minutes)\n    this.cleanupInterval = setInterval(() => {\n      this.pruneExpired();\n    }, 300000);\n  }\n\n  /**\n   * Get cached result for tool call\n   */\n  async get(tool: ToolFunction, args: Record<string, unknown>): Promise<unknown> {\n    // Don't cache if no idempotency config or if tool is safe\n    if (!tool.idempotency || tool.idempotency.safe) {\n      this.misses++;\n      return undefined;\n    }\n\n    const key = this.generateKey(tool, args);\n    const cached = this.cache.get(key);\n\n    if (!cached) {\n      this.misses++;\n      return undefined;\n    }\n\n    // Check if expired\n    if (Date.now() > cached.expiresAt) {\n      this.cache.delete(key);\n      this.misses++;\n      return undefined;\n    }\n\n    this.hits++;\n    return cached.value;\n  }\n\n  /**\n   * Cache result for tool call\n   */\n  async set(tool: ToolFunction, args: Record<string, unknown>, result: unknown): Promise<void> {\n    // Don't cache if no idempotency config or if tool is safe\n    if (!tool.idempotency || tool.idempotency.safe) {\n      return;\n    }\n\n    const key = this.generateKey(tool, args);\n    const ttl = tool.idempotency.ttlMs ?? this.config.defaultTtlMs;\n    const expiresAt = Date.now() + ttl;\n\n    this.cache.set(key, { value: result, expiresAt });\n\n    // Evict oldest if over max entries\n    if (this.cache.size > this.config.maxEntries) {\n      const firstKey = this.cache.keys().next().value;\n      if (firstKey) {\n        this.cache.delete(firstKey);\n      }\n    }\n  }\n\n  /**\n   * Check if tool call is cached\n   */\n  async has(tool: ToolFunction, args: Record<string, unknown>): Promise<boolean> {\n    if (!tool.idempotency || tool.idempotency.safe) {\n      return false;\n    }\n\n    const key = this.generateKey(tool, args);\n    const cached = this.cache.get(key);\n\n    if (!cached) {\n      return false;\n    }\n\n    // Check if expired\n    if (Date.now() > cached.expiresAt) {\n      this.cache.delete(key);\n      return false;\n    }\n\n    return true;\n  }\n\n  /**\n   * Invalidate cached result\n   */\n  async invalidate(tool: ToolFunction, args: Record<string, unknown>): Promise<void> {\n    if (!tool.idempotency) {\n      return;\n    }\n\n    const key = this.generateKey(tool, args);\n    this.cache.delete(key);\n  }\n\n  /**\n   * Invalidate all cached results for a tool\n   */\n  async invalidateTool(tool: ToolFunction): Promise<void> {\n    const toolName = tool.definition.function.name;\n\n    // Find all keys for this tool\n    const keysToDelete: string[] = [];\n    for (const key of this.cache.keys()) {\n      if (key.startsWith(`${toolName}:`)) {\n        keysToDelete.push(key);\n      }\n    }\n\n    for (const key of keysToDelete) {\n      this.cache.delete(key);\n    }\n  }\n\n  /**\n   * Prune expired entries from cache\n   */\n  pruneExpired(): number {\n    const now = Date.now();\n    const toDelete: string[] = [];\n\n    for (const [key, entry] of this.cache.entries()) {\n      if (now > entry.expiresAt) {\n        toDelete.push(key);\n      }\n    }\n\n    toDelete.forEach(key => this.cache.delete(key));\n    return toDelete.length;\n  }\n\n  /**\n   * Clear all cached results\n   */\n  async clear(): Promise<void> {\n    if (this.cleanupInterval) {\n      clearInterval(this.cleanupInterval);\n      this.cleanupInterval = undefined;\n    }\n    this.cache.clear();\n    this.hits = 0;\n    this.misses = 0;\n  }\n\n  /**\n   * Get cache statistics\n   */\n  getStats(): CacheStats {\n    const total = this.hits + this.misses;\n    const hitRate = total > 0 ? this.hits / total : 0;\n\n    return {\n      entries: this.cache.size,\n      hits: this.hits,\n      misses: this.misses,\n      hitRate,\n    };\n  }\n\n  /**\n   * Generate cache key for tool + args\n   */\n  generateKey(tool: ToolFunction, args: Record<string, unknown>): string {\n    const toolName = tool.definition.function.name;\n\n    // Use custom key function if provided\n    if (tool.idempotency?.keyFn) {\n      return `${toolName}:${tool.idempotency.keyFn(args)}`;\n    }\n\n    // Default: hash of sorted args\n    const sortedArgs = Object.keys(args)\n      .sort()\n      .reduce((obj, key) => {\n        obj[key] = args[key];\n        return obj;\n      }, {} as Record<string, unknown>);\n\n    const argsHash = this.hashObject(sortedArgs);\n    return `${toolName}:${argsHash}`;\n  }\n\n  /**\n   * Simple hash function for objects\n   */\n  private hashObject(obj: unknown): string {\n    const str = JSON.stringify(obj);\n    let hash = 0;\n    for (let i = 0; i < str.length; i++) {\n      const char = str.charCodeAt(i);\n      hash = (hash << 5) - hash + char;\n      hash = hash & hash; // Convert to 32bit integer\n    }\n    return hash.toString(36);\n  }\n}\n","/**\n * HistoryManager - manages conversation history with compaction\n */\n\nimport { ConversationMessage } from '../../domain/entities/AgentState.js';\n\nexport interface HistoryManagerConfig {\n  /** Max messages to keep in full detail */\n  maxDetailedMessages: number;\n\n  /** Strategy for older messages */\n  compressionStrategy: 'summarize' | 'truncate' | 'drop';\n\n  /** For summarize: how many messages per summary */\n  summarizeBatchSize: number;\n\n  /** Max total tokens for history (estimated) */\n  maxHistoryTokens?: number;\n\n  /** Keep all tool calls/results or summarize them too */\n  preserveToolCalls: boolean;\n}\n\nexport const DEFAULT_HISTORY_CONFIG: HistoryManagerConfig = {\n  maxDetailedMessages: 20,\n  compressionStrategy: 'summarize',\n  summarizeBatchSize: 10,\n  preserveToolCalls: true,\n};\n\n/**\n * Manages conversation history with automatic compaction\n */\nexport class HistoryManager {\n  private messages: ConversationMessage[] = [];\n  private summaries: Array<{\n    content: string;\n    coversMessages: number;\n    timestamp: number;\n  }> = [];\n  private config: HistoryManagerConfig;\n\n  constructor(config: HistoryManagerConfig = DEFAULT_HISTORY_CONFIG) {\n    this.config = config;\n  }\n\n  /**\n   * Add a message to history\n   */\n  addMessage(role: 'user' | 'assistant' | 'system', content: string): void {\n    this.messages.push({\n      role,\n      content,\n      timestamp: Date.now(),\n    });\n\n    // Auto-compact if over limit\n    if (this.messages.length > this.config.maxDetailedMessages) {\n      this.compact();\n    }\n  }\n\n  /**\n   * Get all messages (including summaries as system messages)\n   */\n  getMessages(): ConversationMessage[] {\n    const result: ConversationMessage[] = [];\n\n    // Add summaries as system messages\n    for (const summary of this.summaries) {\n      result.push({\n        role: 'system',\n        content: `[Summary of previous conversation]\\n${summary.content}`,\n        timestamp: summary.timestamp,\n      });\n    }\n\n    // Add recent messages\n    result.push(...this.messages);\n\n    return result;\n  }\n\n  /**\n   * Get recent messages only (no summaries)\n   */\n  getRecentMessages(): ConversationMessage[] {\n    return [...this.messages];\n  }\n\n  /**\n   * Compact history (summarize or truncate old messages)\n   */\n  private compact(): void {\n    if (this.config.compressionStrategy === 'truncate') {\n      // Keep only recent messages\n      const toRemove = this.messages.length - this.config.maxDetailedMessages;\n      this.messages = this.messages.slice(toRemove);\n    } else if (this.config.compressionStrategy === 'drop') {\n      // Drop oldest messages\n      const toKeep = this.config.maxDetailedMessages;\n      this.messages = this.messages.slice(-toKeep);\n    }\n    // For 'summarize', would need LLM call - placeholder for now\n  }\n\n  /**\n   * Summarize history (requires LLM - placeholder)\n   */\n  async summarize(): Promise<void> {\n    // TODO: Implement LLM-based summarization\n    // For now, just compact using truncate strategy\n    this.compact();\n  }\n\n  /**\n   * Truncate messages to a limit\n   */\n  async truncate(messages: ConversationMessage[], limit: number): Promise<ConversationMessage[]> {\n    return messages.slice(-limit);\n  }\n\n  /**\n   * Clear all history\n   */\n  clear(): void {\n    this.messages = [];\n    this.summaries = [];\n  }\n\n  /**\n   * Get total message count\n   */\n  getMessageCount(): number {\n    return this.messages.length;\n  }\n\n  /**\n   * Get history state for persistence\n   */\n  getState(): { messages: ConversationMessage[]; summaries: Array<{ content: string; coversMessages: number; timestamp: number }> } {\n    return {\n      messages: [...this.messages],\n      summaries: [...this.summaries],\n    };\n  }\n\n  /**\n   * Restore history from state\n   */\n  restoreState(state: { messages: ConversationMessage[]; summaries: Array<{ content: string; coversMessages: number; timestamp: number }> }): void {\n    this.messages = [...state.messages];\n    this.summaries = [...state.summaries];\n  }\n}\n","/**\n * ExternalDependencyHandler - handles external dependencies\n */\n\nimport EventEmitter from 'eventemitter3';\nimport { Task } from '../../domain/entities/Task.js';\nimport { ToolFunction } from '../../domain/entities/Tool.js';\n\nexport interface ExternalDependencyEvents {\n  'webhook:received': { webhookId: string; data: unknown };\n  'poll:success': { taskId: string; data: unknown };\n  'poll:timeout': { taskId: string };\n  'scheduled:triggered': { taskId: string };\n  'manual:completed': { taskId: string; data: unknown };\n}\n\n/**\n * Handles external task dependencies\n */\nexport class ExternalDependencyHandler extends EventEmitter<ExternalDependencyEvents> {\n  private activePolls = new Map<string, NodeJS.Timeout>();\n  private activeScheduled = new Map<string, NodeJS.Timeout>();\n  private tools: Map<string, ToolFunction>;\n\n  constructor(tools: ToolFunction[] = []) {\n    super();\n    this.tools = new Map(tools.map((t) => [t.definition.function.name, t]));\n  }\n\n  /**\n   * Start handling a task's external dependency\n   */\n  async startWaiting(task: Task): Promise<void> {\n    if (!task.externalDependency) {\n      return;\n    }\n\n    const dep = task.externalDependency;\n\n    switch (dep.type) {\n      case 'webhook':\n        // Webhooks are passive - just wait for triggerWebhook() to be called\n        break;\n\n      case 'poll':\n        this.startPolling(task);\n        break;\n\n      case 'scheduled':\n        this.scheduleTask(task);\n        break;\n\n      case 'manual':\n        // Manual tasks wait for completeManually() to be called\n        break;\n    }\n  }\n\n  /**\n   * Stop waiting on a task's external dependency\n   */\n  stopWaiting(task: Task): void {\n    if (!task.externalDependency) {\n      return;\n    }\n\n    // Clear any active polling or scheduled timers\n    const pollTimer = this.activePolls.get(task.id);\n    if (pollTimer) {\n      clearInterval(pollTimer);\n      this.activePolls.delete(task.id);\n    }\n\n    const scheduleTimer = this.activeScheduled.get(task.id);\n    if (scheduleTimer) {\n      clearTimeout(scheduleTimer);\n      this.activeScheduled.delete(task.id);\n    }\n  }\n\n  /**\n   * Trigger a webhook\n   */\n  async triggerWebhook(webhookId: string, data: unknown): Promise<void> {\n    this.emit('webhook:received', { webhookId, data });\n  }\n\n  /**\n   * Complete a manual task\n   */\n  async completeManual(taskId: string, data: unknown): Promise<void> {\n    this.emit('manual:completed', { taskId, data });\n  }\n\n  /**\n   * Start polling for a task\n   */\n  private startPolling(task: Task): void {\n    const dep = task.externalDependency!;\n    const pollConfig = dep.pollConfig!;\n\n    let attempts = 0;\n\n    const poll = async () => {\n      attempts++;\n\n      try {\n        // Get the tool\n        const tool = this.tools.get(pollConfig.toolName);\n        if (!tool) {\n          console.error(`Poll tool ${pollConfig.toolName} not found`);\n          return;\n        }\n\n        // Execute the tool\n        const result = await tool.execute(pollConfig.toolArgs);\n\n        // Check if result indicates completion\n        // For simplicity, any truthy result means complete\n        if (result) {\n          this.emit('poll:success', { taskId: task.id, data: result });\n          this.stopWaiting(task);\n          return;\n        }\n\n        // Check if max attempts reached\n        if (attempts >= pollConfig.maxAttempts) {\n          this.emit('poll:timeout', { taskId: task.id });\n          this.stopWaiting(task);\n        }\n      } catch (error) {\n        console.error(`Poll error for task ${task.id}:`, error);\n      }\n    };\n\n    // Start polling\n    const timer = setInterval(poll, pollConfig.intervalMs);\n    this.activePolls.set(task.id, timer);\n\n    // Initial poll\n    poll();\n  }\n\n  /**\n   * Schedule a task to trigger at a specific time\n   */\n  private scheduleTask(task: Task): void {\n    const dep = task.externalDependency!;\n    const scheduledAt = dep.scheduledAt!;\n\n    const delay = scheduledAt - Date.now();\n\n    if (delay <= 0) {\n      // Already past scheduled time, trigger immediately\n      this.emit('scheduled:triggered', { taskId: task.id });\n      return;\n    }\n\n    const timer = setTimeout(() => {\n      this.emit('scheduled:triggered', { taskId: task.id });\n      this.activeScheduled.delete(task.id);\n    }, delay);\n\n    this.activeScheduled.set(task.id, timer);\n  }\n\n  /**\n   * Cleanup all active dependencies\n   */\n  cleanup(): void {\n    // Clear all timers\n    for (const timer of this.activePolls.values()) {\n      clearInterval(timer);\n    }\n    this.activePolls.clear();\n\n    for (const timer of this.activeScheduled.values()) {\n      clearTimeout(timer);\n    }\n    this.activeScheduled.clear();\n  }\n\n  /**\n   * Update available tools\n   */\n  updateTools(tools: ToolFunction[]): void {\n    this.tools = new Map(tools.map((t) => [t.definition.function.name, t]));\n  }\n}\n","import { Vendor } from '../../core/Vendor.js';\nimport type { Vendor as VendorType } from '../../core/Vendor.js';\n\n/**\n * Complete description of an LLM model including capabilities, pricing, and features\n */\nexport interface ILLMDescription {\n  /** Model identifier (e.g., \"gpt-5.2-instant\") */\n  name: string;\n\n  /** Vendor/provider (Vendor.OpenAI, Vendor.Anthropic, etc.) */\n  provider: string;\n\n  /** Optional description of the model */\n  description?: string;\n\n  /** Whether the model is currently available for use */\n  isActive: boolean;\n\n  /** Release date (YYYY-MM-DD format) */\n  releaseDate?: string;\n\n  /** Knowledge cutoff date */\n  knowledgeCutoff?: string;\n\n  /** Model capabilities and pricing */\n  features: {\n    /** Supports extended reasoning/thinking */\n    reasoning?: boolean;\n\n    /** Supports streaming responses */\n    streaming: boolean;\n\n    /** Supports structured output (JSON mode) */\n    structuredOutput?: boolean;\n\n    /** Supports function/tool calling */\n    functionCalling?: boolean;\n\n    /** Supports fine-tuning */\n    fineTuning?: boolean;\n\n    /** Supports predicted outputs */\n    predictedOutputs?: boolean;\n\n    /** Supports realtime API */\n    realtime?: boolean;\n\n    /** Supports image input (vision) */\n    vision?: boolean;\n\n    /** Supports audio input/output */\n    audio?: boolean;\n\n    /** Supports video input */\n    video?: boolean;\n\n    /** Supports extended thinking (Claude-specific) */\n    extendedThinking?: boolean;\n\n    /** Supports batch API */\n    batchAPI?: boolean;\n\n    /** Supports prompt caching */\n    promptCaching?: boolean;\n\n    /** Input specifications */\n    input: {\n      /** Maximum input context window (in tokens) */\n      tokens: number;\n\n      /** Supports text input */\n      text: boolean;\n\n      /** Supports image input */\n      image?: boolean;\n\n      /** Supports audio input */\n      audio?: boolean;\n\n      /** Supports video input */\n      video?: boolean;\n\n      /** Cost per million tokens (input) */\n      cpm: number;\n\n      /** Cost per million cached tokens (if prompt caching supported) */\n      cpmCached?: number;\n    };\n\n    /** Output specifications */\n    output: {\n      /** Maximum output tokens */\n      tokens: number;\n\n      /** Supports text output */\n      text: boolean;\n\n      /** Supports image output */\n      image?: boolean;\n\n      /** Supports audio output */\n      audio?: boolean;\n\n      /** Cost per million tokens (output) */\n      cpm: number;\n    };\n  };\n}\n\n/**\n * Model name constants organized by vendor\n */\nexport const LLM_MODELS = {\n  [Vendor.OpenAI]: {\n    GPT_5_2_INSTANT: 'gpt-5.2-instant',\n    GPT_5_2_THINKING: 'gpt-5.2-thinking',\n    GPT_5_2_PRO: 'gpt-5.2-pro',\n    GPT_5_2_CODEX: 'gpt-5.2-codex',\n    GPT_5_1: 'gpt-5.1',\n    GPT_5: 'gpt-5',\n    GPT_5_MINI: 'gpt-5-mini',\n    GPT_5_NANO: 'gpt-5-nano',\n    GPT_4_1: 'gpt-4.1',\n    GPT_4_1_MINI: 'gpt-4.1-mini',\n    O3_MINI: 'o3-mini',\n  },\n  [Vendor.Anthropic]: {\n    CLAUDE_OPUS_4_5: 'claude-opus-4-5-20251101',\n    CLAUDE_SONNET_4_5: 'claude-sonnet-4-5-20250929',\n    CLAUDE_HAIKU_4_5: 'claude-haiku-4-5-20251001',\n    CLAUDE_OPUS_4_1: 'claude-opus-4-1-20250805',\n    CLAUDE_SONNET_4: 'claude-sonnet-4-20250514',\n  },\n  [Vendor.Google]: {\n    GEMINI_3_FLASH_PREVIEW: 'gemini-3-flash-preview',\n    GEMINI_3_PRO: 'gemini-3-pro',\n    GEMINI_3_PRO_IMAGE: 'gemini-3-pro-image',\n    GEMINI_2_5_PRO: 'gemini-2.5-pro',\n    GEMINI_2_5_FLASH: 'gemini-2.5-flash',\n    GEMINI_2_5_FLASH_LITE: 'gemini-2.5-flash-lite',\n    GEMINI_2_5_FLASH_IMAGE: 'gemini-2.5-flash-image',\n  },\n} as const;\n\n/**\n * Complete model registry with all model metadata\n * Updated: January 2026\n */\nexport const MODEL_REGISTRY: Record<string, ILLMDescription> = {\n  // ============================================================================\n  // OpenAI Models (11 total)\n  // ============================================================================\n\n  'gpt-5.2-instant': {\n    name: 'gpt-5.2-instant',\n    provider: Vendor.OpenAI,\n    description: 'Fast variant of GPT-5.2 with minimal reasoning step',\n    isActive: true,\n    releaseDate: '2025-12-11',\n    knowledgeCutoff: '2025-08-31',\n    features: {\n      reasoning: false,\n      streaming: true,\n      structuredOutput: true,\n      functionCalling: true,\n      fineTuning: false,\n      predictedOutputs: false,\n      realtime: false,\n      vision: true,\n      audio: false,\n      video: false,\n      batchAPI: true,\n      promptCaching: true,\n      input: {\n        tokens: 400000,\n        text: true,\n        image: true,\n        cpm: 1.75,\n        cpmCached: 0.025, // 90% discount\n      },\n      output: {\n        tokens: 128000,\n        text: true,\n        cpm: 14,\n      },\n    },\n  },\n\n  'gpt-5.2-thinking': {\n    name: 'gpt-5.2-thinking',\n    provider: Vendor.OpenAI,\n    description: 'GPT-5.2 with extended reasoning capabilities and xhigh reasoning effort',\n    isActive: true,\n    releaseDate: '2025-12-11',\n    knowledgeCutoff: '2025-08-31',\n    features: {\n      reasoning: true,\n      streaming: true,\n      structuredOutput: true,\n      functionCalling: true,\n      fineTuning: false,\n      predictedOutputs: false,\n      realtime: false,\n      vision: true,\n      audio: false,\n      video: false,\n      batchAPI: true,\n      promptCaching: true,\n      input: {\n        tokens: 400000,\n        text: true,\n        image: true,\n        cpm: 1.75,\n        cpmCached: 0.025,\n      },\n      output: {\n        tokens: 128000,\n        text: true,\n        cpm: 14,\n      },\n    },\n  },\n\n  'gpt-5.2-pro': {\n    name: 'gpt-5.2-pro',\n    provider: Vendor.OpenAI,\n    description: 'Flagship GPT-5.2 model with advanced reasoning and highest quality',\n    isActive: true,\n    releaseDate: '2025-12-11',\n    knowledgeCutoff: '2025-08-31',\n    features: {\n      reasoning: true,\n      streaming: true,\n      structuredOutput: true,\n      functionCalling: true,\n      fineTuning: false,\n      predictedOutputs: false,\n      realtime: false,\n      vision: true,\n      audio: false,\n      video: false,\n      batchAPI: true,\n      promptCaching: true,\n      input: {\n        tokens: 400000,\n        text: true,\n        image: true,\n        cpm: 21,\n        cpmCached: 0.025,\n      },\n      output: {\n        tokens: 128000,\n        text: true,\n        cpm: 168,\n      },\n    },\n  },\n\n  'gpt-5.2-codex': {\n    name: 'gpt-5.2-codex',\n    provider: Vendor.OpenAI,\n    description: 'Most advanced agentic coding model for complex software engineering',\n    isActive: true,\n    releaseDate: '2026-01-14',\n    knowledgeCutoff: '2025-08-31',\n    features: {\n      reasoning: true,\n      streaming: true,\n      structuredOutput: true,\n      functionCalling: true,\n      fineTuning: false,\n      predictedOutputs: false,\n      realtime: false,\n      vision: true,\n      audio: false,\n      video: false,\n      batchAPI: true,\n      promptCaching: true,\n      input: {\n        tokens: 400000,\n        text: true,\n        image: true,\n        cpm: 1.75,\n        cpmCached: 0.025,\n      },\n      output: {\n        tokens: 128000,\n        text: true,\n        cpm: 14,\n      },\n    },\n  },\n\n  'gpt-5.1': {\n    name: 'gpt-5.1',\n    provider: Vendor.OpenAI,\n    description: 'Balanced GPT-5.1 model with expanded context window',\n    isActive: true,\n    releaseDate: '2025-11-13',\n    knowledgeCutoff: '2025-08-31',\n    features: {\n      reasoning: false,\n      streaming: true,\n      structuredOutput: true,\n      functionCalling: true,\n      fineTuning: false,\n      predictedOutputs: false,\n      realtime: false,\n      vision: true,\n      audio: false,\n      video: false,\n      batchAPI: true,\n      promptCaching: true,\n      input: {\n        tokens: 272000,\n        text: true,\n        image: true,\n        cpm: 1.25,\n        cpmCached: 0.025,\n      },\n      output: {\n        tokens: 128000,\n        text: true,\n        cpm: 10,\n      },\n    },\n  },\n\n  'gpt-5': {\n    name: 'gpt-5',\n    provider: Vendor.OpenAI,\n    description: 'Standard GPT-5 model with large context window',\n    isActive: true,\n    releaseDate: '2025-08-07',\n    knowledgeCutoff: '2025-08-31',\n    features: {\n      reasoning: false,\n      streaming: true,\n      structuredOutput: true,\n      functionCalling: true,\n      fineTuning: false,\n      predictedOutputs: false,\n      realtime: false,\n      vision: true,\n      audio: false,\n      video: false,\n      batchAPI: true,\n      promptCaching: true,\n      input: {\n        tokens: 400000,\n        text: true,\n        image: true,\n        cpm: 1.25,\n        cpmCached: 0.025,\n      },\n      output: {\n        tokens: 16384,\n        text: true,\n        cpm: 10,\n      },\n    },\n  },\n\n  'gpt-5-mini': {\n    name: 'gpt-5-mini',\n    provider: Vendor.OpenAI,\n    description: 'Fast, cost-efficient version of GPT-5',\n    isActive: true,\n    releaseDate: '2025-08-07',\n    knowledgeCutoff: '2025-08-31',\n    features: {\n      reasoning: false,\n      streaming: true,\n      structuredOutput: true,\n      functionCalling: true,\n      fineTuning: false,\n      predictedOutputs: false,\n      realtime: false,\n      vision: true,\n      audio: false,\n      video: false,\n      batchAPI: true,\n      promptCaching: true,\n      input: {\n        tokens: 200000,\n        text: true,\n        image: true,\n        cpm: 0.25,\n        cpmCached: 0.025,\n      },\n      output: {\n        tokens: 16384,\n        text: true,\n        cpm: 2,\n      },\n    },\n  },\n\n  'gpt-5-nano': {\n    name: 'gpt-5-nano',\n    provider: Vendor.OpenAI,\n    description: 'Fastest, most cost-effective version of GPT-5',\n    isActive: true,\n    releaseDate: '2025-08-07',\n    knowledgeCutoff: '2025-08-31',\n    features: {\n      reasoning: false,\n      streaming: true,\n      structuredOutput: true,\n      functionCalling: true,\n      fineTuning: false,\n      predictedOutputs: false,\n      realtime: false,\n      vision: false,\n      audio: false,\n      video: false,\n      batchAPI: true,\n      promptCaching: true,\n      input: {\n        tokens: 128000,\n        text: true,\n        cpm: 0.05,\n        cpmCached: 0.025,\n      },\n      output: {\n        tokens: 4096,\n        text: true,\n        cpm: 0.4,\n      },\n    },\n  },\n\n  'gpt-4.1': {\n    name: 'gpt-4.1',\n    provider: Vendor.OpenAI,\n    description: 'GPT-4.1 specialized for coding with large context window',\n    isActive: true,\n    releaseDate: '2025-06-01',\n    knowledgeCutoff: '2025-04-01',\n    features: {\n      reasoning: false,\n      streaming: true,\n      structuredOutput: true,\n      functionCalling: true,\n      fineTuning: false,\n      predictedOutputs: false,\n      realtime: false,\n      vision: true,\n      audio: false,\n      video: false,\n      batchAPI: true,\n      promptCaching: true,\n      input: {\n        tokens: 1000000,\n        text: true,\n        image: true,\n        cpm: 0.5,\n        cpmCached: 0.025,\n      },\n      output: {\n        tokens: 32768,\n        text: true,\n        cpm: 2,\n      },\n    },\n  },\n\n  'gpt-4.1-mini': {\n    name: 'gpt-4.1-mini',\n    provider: Vendor.OpenAI,\n    description: 'Efficient GPT-4.1 model with excellent instruction following',\n    isActive: true,\n    releaseDate: '2025-06-01',\n    knowledgeCutoff: '2025-04-01',\n    features: {\n      reasoning: false,\n      streaming: true,\n      structuredOutput: true,\n      functionCalling: true,\n      fineTuning: false,\n      predictedOutputs: false,\n      realtime: false,\n      vision: true,\n      audio: false,\n      video: false,\n      batchAPI: true,\n      promptCaching: true,\n      input: {\n        tokens: 1000000,\n        text: true,\n        image: true,\n        cpm: 0.4,\n        cpmCached: 0.025,\n      },\n      output: {\n        tokens: 16384,\n        text: true,\n        cpm: 1.6,\n      },\n    },\n  },\n\n  'o3-mini': {\n    name: 'o3-mini',\n    provider: Vendor.OpenAI,\n    description: 'Fast reasoning model tailored for coding, math, and science',\n    isActive: true,\n    releaseDate: '2025-01-01',\n    knowledgeCutoff: '2023-10-01',\n    features: {\n      reasoning: true,\n      streaming: true,\n      structuredOutput: false,\n      functionCalling: false,\n      fineTuning: false,\n      predictedOutputs: false,\n      realtime: false,\n      vision: false,\n      audio: false,\n      video: false,\n      batchAPI: true,\n      promptCaching: false,\n      input: {\n        tokens: 200000,\n        text: true,\n        cpm: 0.4,\n      },\n      output: {\n        tokens: 100000,\n        text: true,\n        cpm: 1.6,\n      },\n    },\n  },\n\n  // ============================================================================\n  // Anthropic Models (5 total)\n  // ============================================================================\n\n  'claude-opus-4-5-20251101': {\n    name: 'claude-opus-4-5-20251101',\n    provider: Vendor.Anthropic,\n    description: 'Flagship Claude model with extended thinking and 80.9% SWE-bench score',\n    isActive: true,\n    releaseDate: '2025-11-24',\n    knowledgeCutoff: '2025-03-01',\n    features: {\n      reasoning: false,\n      streaming: true,\n      structuredOutput: true,\n      functionCalling: true,\n      fineTuning: false,\n      predictedOutputs: false,\n      realtime: false,\n      vision: true,\n      audio: false,\n      video: false,\n      extendedThinking: true,\n      batchAPI: true,\n      promptCaching: true,\n      input: {\n        tokens: 200000,\n        text: true,\n        image: true,\n        cpm: 5,\n        cpmCached: 0.5, // 10x reduction for cache read\n      },\n      output: {\n        tokens: 64000,\n        text: true,\n        cpm: 25,\n      },\n    },\n  },\n\n  'claude-sonnet-4-5-20250929': {\n    name: 'claude-sonnet-4-5-20250929',\n    provider: Vendor.Anthropic,\n    description: 'Balanced Claude model with computer use and extended thinking',\n    isActive: true,\n    releaseDate: '2025-09-29',\n    knowledgeCutoff: '2025-03-01',\n    features: {\n      reasoning: false,\n      streaming: true,\n      structuredOutput: true,\n      functionCalling: true,\n      fineTuning: false,\n      predictedOutputs: false,\n      realtime: false,\n      vision: true,\n      audio: false,\n      video: false,\n      extendedThinking: true,\n      batchAPI: true,\n      promptCaching: true,\n      input: {\n        tokens: 200000,\n        text: true,\n        image: true,\n        cpm: 3,\n        cpmCached: 0.3,\n      },\n      output: {\n        tokens: 64000,\n        text: true,\n        cpm: 15,\n      },\n    },\n  },\n\n  'claude-haiku-4-5-20251001': {\n    name: 'claude-haiku-4-5-20251001',\n    provider: Vendor.Anthropic,\n    description: 'Fastest Claude model with extended thinking and lowest latency',\n    isActive: true,\n    releaseDate: '2025-10-01',\n    knowledgeCutoff: '2025-03-01',\n    features: {\n      reasoning: false,\n      streaming: true,\n      structuredOutput: true,\n      functionCalling: true,\n      fineTuning: false,\n      predictedOutputs: false,\n      realtime: false,\n      vision: true,\n      audio: false,\n      video: false,\n      extendedThinking: true,\n      batchAPI: true,\n      promptCaching: true,\n      input: {\n        tokens: 200000,\n        text: true,\n        image: true,\n        cpm: 1,\n        cpmCached: 0.1,\n      },\n      output: {\n        tokens: 64000,\n        text: true,\n        cpm: 5,\n      },\n    },\n  },\n\n  'claude-opus-4-1-20250805': {\n    name: 'claude-opus-4-1-20250805',\n    provider: Vendor.Anthropic,\n    description: 'Legacy Claude Opus 4.1 (67% more expensive than 4.5)',\n    isActive: true,\n    releaseDate: '2025-08-05',\n    knowledgeCutoff: '2025-03-01',\n    features: {\n      reasoning: false,\n      streaming: true,\n      structuredOutput: true,\n      functionCalling: true,\n      fineTuning: false,\n      predictedOutputs: false,\n      realtime: false,\n      vision: true,\n      audio: false,\n      video: false,\n      extendedThinking: false,\n      batchAPI: true,\n      promptCaching: true,\n      input: {\n        tokens: 200000,\n        text: true,\n        image: true,\n        cpm: 15,\n        cpmCached: 1.5,\n      },\n      output: {\n        tokens: 64000,\n        text: true,\n        cpm: 75,\n      },\n    },\n  },\n\n  'claude-sonnet-4-20250514': {\n    name: 'claude-sonnet-4-20250514',\n    provider: Vendor.Anthropic,\n    description: 'Legacy Claude Sonnet 4 with optional 1M token context',\n    isActive: true,\n    releaseDate: '2025-05-14',\n    knowledgeCutoff: '2025-03-01',\n    features: {\n      reasoning: false,\n      streaming: true,\n      structuredOutput: true,\n      functionCalling: true,\n      fineTuning: false,\n      predictedOutputs: false,\n      realtime: false,\n      vision: true,\n      audio: false,\n      video: false,\n      extendedThinking: false,\n      batchAPI: true,\n      promptCaching: true,\n      input: {\n        tokens: 1000000, // Up to 1M with premium pricing beyond 200K\n        text: true,\n        image: true,\n        cpm: 3,\n        cpmCached: 0.3,\n      },\n      output: {\n        tokens: 64000,\n        text: true,\n        cpm: 15,\n      },\n    },\n  },\n\n  // ============================================================================\n  // Google Models (7 total)\n  // ============================================================================\n\n  'gemini-3-flash-preview': {\n    name: 'gemini-3-flash-preview',\n    provider: Vendor.Google,\n    description: 'Pro-grade reasoning with Flash-level latency and efficiency',\n    isActive: true,\n    releaseDate: '2025-11-18',\n    knowledgeCutoff: '2025-08-01',\n    features: {\n      reasoning: true,\n      streaming: true,\n      structuredOutput: true,\n      functionCalling: true,\n      fineTuning: false,\n      predictedOutputs: false,\n      realtime: false,\n      vision: true,\n      audio: true,\n      video: true,\n      batchAPI: true,\n      promptCaching: true,\n      input: {\n        tokens: 1000000,\n        text: true,\n        image: true,\n        audio: true,\n        video: true,\n        cpm: 0.5,\n      },\n      output: {\n        tokens: 64000,\n        text: true,\n        cpm: 3,\n      },\n    },\n  },\n\n  'gemini-3-pro': {\n    name: 'gemini-3-pro',\n    provider: Vendor.Google,\n    description: 'Most advanced reasoning Gemini model with 1M token context',\n    isActive: true,\n    releaseDate: '2025-11-18',\n    knowledgeCutoff: '2025-08-01',\n    features: {\n      reasoning: true,\n      streaming: true,\n      structuredOutput: true,\n      functionCalling: true,\n      fineTuning: false,\n      predictedOutputs: false,\n      realtime: false,\n      vision: true,\n      audio: true,\n      video: true,\n      batchAPI: true,\n      promptCaching: true,\n      input: {\n        tokens: 1000000,\n        text: true,\n        image: true,\n        audio: true,\n        video: true,\n        cpm: 2, // $2 up to 200K, $4 beyond\n      },\n      output: {\n        tokens: 64000,\n        text: true,\n        cpm: 12, // $12 up to 200K, $18 beyond\n      },\n    },\n  },\n\n  'gemini-3-pro-image': {\n    name: 'gemini-3-pro-image',\n    provider: Vendor.Google,\n    description: 'Highest quality image generation model (Nano Banana Pro)',\n    isActive: true,\n    releaseDate: '2025-11-18',\n    knowledgeCutoff: '2025-08-01',\n    features: {\n      reasoning: true,\n      streaming: true,\n      structuredOutput: false,\n      functionCalling: false,\n      fineTuning: false,\n      predictedOutputs: false,\n      realtime: false,\n      vision: true,\n      audio: false,\n      video: false,\n      batchAPI: true,\n      promptCaching: true,\n      input: {\n        tokens: 1000000,\n        text: true,\n        image: true,\n        cpm: 2,\n      },\n      output: {\n        tokens: 64000,\n        text: true,\n        image: true,\n        cpm: 120, // For image output\n      },\n    },\n  },\n\n  'gemini-2.5-pro': {\n    name: 'gemini-2.5-pro',\n    provider: Vendor.Google,\n    description: 'Balanced multimodal model built for agents',\n    isActive: true,\n    releaseDate: '2025-03-01',\n    knowledgeCutoff: '2025-01-01',\n    features: {\n      reasoning: true,\n      streaming: true,\n      structuredOutput: true,\n      functionCalling: true,\n      fineTuning: false,\n      predictedOutputs: false,\n      realtime: false,\n      vision: true,\n      audio: true,\n      video: true,\n      batchAPI: true,\n      promptCaching: true,\n      input: {\n        tokens: 1000000,\n        text: true,\n        image: true,\n        audio: true,\n        video: true,\n        cpm: 1.25,\n      },\n      output: {\n        tokens: 64000,\n        text: true,\n        cpm: 10,\n      },\n    },\n  },\n\n  'gemini-2.5-flash': {\n    name: 'gemini-2.5-flash',\n    provider: Vendor.Google,\n    description: 'Cost-effective model with upgraded reasoning',\n    isActive: true,\n    releaseDate: '2025-06-17',\n    knowledgeCutoff: '2025-01-01',\n    features: {\n      reasoning: true,\n      streaming: true,\n      structuredOutput: true,\n      functionCalling: true,\n      fineTuning: false,\n      predictedOutputs: false,\n      realtime: false,\n      vision: true,\n      audio: true,\n      video: true,\n      batchAPI: true,\n      promptCaching: true,\n      input: {\n        tokens: 1000000,\n        text: true,\n        image: true,\n        audio: true,\n        video: true,\n        cpm: 0.1,\n      },\n      output: {\n        tokens: 64000,\n        text: true,\n        cpm: 0.4,\n      },\n    },\n  },\n\n  'gemini-2.5-flash-lite': {\n    name: 'gemini-2.5-flash-lite',\n    provider: Vendor.Google,\n    description: 'Lowest latency Gemini model with 1M context',\n    isActive: true,\n    releaseDate: '2025-06-17',\n    knowledgeCutoff: '2025-01-01',\n    features: {\n      reasoning: true,\n      streaming: true,\n      structuredOutput: true,\n      functionCalling: true,\n      fineTuning: false,\n      predictedOutputs: false,\n      realtime: false,\n      vision: true,\n      audio: true,\n      video: true,\n      batchAPI: true,\n      promptCaching: true,\n      input: {\n        tokens: 1000000,\n        text: true,\n        image: true,\n        audio: true,\n        video: true,\n        cpm: 0.1,\n      },\n      output: {\n        tokens: 64000,\n        text: true,\n        cpm: 0.4,\n      },\n    },\n  },\n\n  'gemini-2.5-flash-image': {\n    name: 'gemini-2.5-flash-image',\n    provider: Vendor.Google,\n    description: 'State-of-the-art image generation and editing (1290 tokens per image)',\n    isActive: true,\n    releaseDate: '2026-01-01',\n    knowledgeCutoff: '2025-01-01',\n    features: {\n      reasoning: true,\n      streaming: true,\n      structuredOutput: false,\n      functionCalling: false,\n      fineTuning: false,\n      predictedOutputs: false,\n      realtime: false,\n      vision: true,\n      audio: false,\n      video: false,\n      batchAPI: true,\n      promptCaching: true,\n      input: {\n        tokens: 1000000,\n        text: true,\n        image: true,\n        cpm: 0.1,\n      },\n      output: {\n        tokens: 64000,\n        text: true,\n        image: true,\n        cpm: 30, // For image output\n      },\n    },\n  },\n};\n\n/**\n * Get model information by name\n * @param modelName The model identifier\n * @returns Model description or undefined if not found\n */\nexport function getModelInfo(modelName: string): ILLMDescription | undefined {\n  return MODEL_REGISTRY[modelName];\n}\n\n/**\n * Get all models for a specific vendor\n * @param vendor The vendor to filter by\n * @returns Array of model descriptions for the vendor\n */\nexport function getModelsByVendor(vendor: VendorType): ILLMDescription[] {\n  return Object.values(MODEL_REGISTRY).filter((model) => model.provider === vendor);\n}\n\n/**\n * Get all currently active models\n * @returns Array of active model descriptions\n */\nexport function getActiveModels(): ILLMDescription[] {\n  return Object.values(MODEL_REGISTRY).filter((model) => model.isActive);\n}\n\n/**\n * Calculate the cost for a given model and token usage\n * @param model Model name\n * @param inputTokens Number of input tokens\n * @param outputTokens Number of output tokens\n * @param options Optional calculation options\n * @returns Total cost in dollars, or null if model not found\n */\nexport function calculateCost(\n  model: string,\n  inputTokens: number,\n  outputTokens: number,\n  options?: { useCachedInput?: boolean }\n): number | null {\n  const modelInfo = getModelInfo(model);\n  if (!modelInfo) {\n    return null;\n  }\n\n  const inputCPM = options?.useCachedInput && modelInfo.features.input.cpmCached !== undefined\n    ? modelInfo.features.input.cpmCached\n    : modelInfo.features.input.cpm;\n\n  const outputCPM = modelInfo.features.output.cpm;\n\n  const inputCost = (inputTokens / 1_000_000) * inputCPM;\n  const outputCost = (outputTokens / 1_000_000) * outputCPM;\n\n  return inputCost + outputCost;\n}\n","/**\n * PlanExecutor - executes plans with LLM integration\n */\n\nimport EventEmitter from 'eventemitter3';\nimport { Agent } from '../../core/Agent.js';\nimport { Plan, Task, updateTaskStatus, evaluateCondition, getNextExecutableTasks } from '../../domain/entities/Task.js';\nimport { AgentState } from '../../domain/entities/AgentState.js';\nimport { calculateCost } from '../../domain/entities/Model.js';\nimport { WorkingMemory } from './WorkingMemory.js';\nimport { ContextManager } from './ContextManager.js';\nimport { IdempotencyCache } from './IdempotencyCache.js';\nimport { HistoryManager } from './HistoryManager.js';\nimport { ExternalDependencyHandler } from './ExternalDependencyHandler.js';\nimport { CheckpointManager } from './CheckpointManager.js';\nimport type { TaskAgentHooks, TaskContext, ErrorContext } from './TaskAgent.js';\n\nexport interface PlanExecutorConfig {\n  maxIterations: number;\n  taskTimeout?: number;\n}\n\nexport interface PlanExecutorEvents {\n  'task:start': { task: Task };\n  'task:complete': { task: Task; result: any };\n  'task:failed': { task: Task; error: Error };\n  'task:skipped': { task: Task; reason: string };\n  'task:waiting_external': { task: Task };\n  'llm:call': { iteration: number };\n  'tool:call': { toolName: string; args: any };\n  'tool:result': { toolName: string; result: any };\n}\n\nexport interface PlanExecutionResult {\n  status: 'completed' | 'failed' | 'suspended';\n  completedTasks: number;\n  failedTasks: number;\n  skippedTasks: number;\n  error?: Error;\n  metrics: {\n    totalLLMCalls: number;\n    totalToolCalls: number;\n    totalTokensUsed: number;\n    totalCost: number;\n  };\n}\n\n/**\n * Executes a plan using LLM and tools\n */\nexport class PlanExecutor extends EventEmitter<PlanExecutorEvents> {\n  private agent: Agent;\n  private memory: WorkingMemory;\n  private contextManager: ContextManager;\n  private idempotencyCache: IdempotencyCache; // TODO: Integrate in tool execution (Task #4)\n  private historyManager: HistoryManager;\n  private externalHandler: ExternalDependencyHandler;\n  private checkpointManager: CheckpointManager;\n  private hooks: TaskAgentHooks | undefined;\n  private config: PlanExecutorConfig;\n  private abortController: AbortController;\n\n  // Current execution metrics\n  private currentMetrics = {\n    totalLLMCalls: 0,\n    totalToolCalls: 0,\n    totalTokensUsed: 0,\n    totalCost: 0,\n  };\n\n  // Reference to current agent state (for checkpointing)\n  private currentState: AgentState | null = null;\n\n  constructor(\n    agent: Agent,\n    memory: WorkingMemory,\n    contextManager: ContextManager,\n    idempotencyCache: IdempotencyCache,\n    historyManager: HistoryManager,\n    externalHandler: ExternalDependencyHandler,\n    checkpointManager: CheckpointManager,\n    hooks: TaskAgentHooks | undefined,\n    config: PlanExecutorConfig\n  ) {\n    super();\n    this.agent = agent;\n    this.memory = memory;\n    this.contextManager = contextManager;\n    this.idempotencyCache = idempotencyCache;\n    this.historyManager = historyManager;\n    this.externalHandler = externalHandler;\n    this.checkpointManager = checkpointManager;\n    this.hooks = hooks;\n    this.config = config;\n    this.abortController = new AbortController();\n  }\n\n  /**\n   * Execute a plan\n   */\n  async execute(plan: Plan, state: AgentState): Promise<PlanExecutionResult> {\n    // Store state reference for checkpointing\n    this.currentState = state;\n\n    // Update checkpoint manager with current state\n    this.checkpointManager.setCurrentState(state);\n\n    // Reset metrics for this execution\n    this.currentMetrics = {\n      totalLLMCalls: 0,\n      totalToolCalls: 0,\n      totalTokensUsed: 0,\n      totalCost: 0,\n    };\n\n    let iteration = 0;\n\n    while (iteration < this.config.maxIterations) {\n      iteration++;\n\n      // Check if plan is complete\n      if (this.isPlanComplete(plan)) {\n        break;\n      }\n\n      // Check if plan is suspended (waiting on external)\n      if (this.isPlanSuspended(plan)) {\n        return {\n          status: 'suspended',\n          completedTasks: plan.tasks.filter((t) => t.status === 'completed').length,\n          failedTasks: plan.tasks.filter((t) => t.status === 'failed').length,\n          skippedTasks: plan.tasks.filter((t) => t.status === 'skipped').length,\n          metrics: this.currentMetrics,\n        };\n      }\n\n      // Get next executable tasks\n      const nextTasks = getNextExecutableTasks(plan);\n\n      if (nextTasks.length === 0) {\n        // No executable tasks - either waiting on dependencies or complete\n        break;\n      }\n\n      // Execute tasks (parallel if configured)\n      await Promise.all(\n        nextTasks.map((task) => this.executeTask(plan, task))\n      );\n    }\n\n    // Determine final status\n    const hasFailures = plan.tasks.some((t) => t.status === 'failed');\n    const allComplete = plan.tasks.every((t) =>\n      ['completed', 'skipped', 'failed'].includes(t.status)\n    );\n\n    return {\n      status: hasFailures ? 'failed' : allComplete ? 'completed' : 'suspended',\n      completedTasks: plan.tasks.filter((t) => t.status === 'completed').length,\n      failedTasks: plan.tasks.filter((t) => t.status === 'failed').length,\n      skippedTasks: plan.tasks.filter((t) => t.status === 'skipped').length,\n      metrics: this.currentMetrics,\n    };\n  }\n\n  /**\n   * Execute a single task\n   */\n  private async executeTask(plan: Plan, task: Task): Promise<void> {\n    // Check condition if present\n    if (task.condition) {\n      const conditionMet = await evaluateCondition(task.condition, {\n        get: (key: string) => this.memory.retrieve(key),\n      });\n\n      if (!conditionMet) {\n        if (task.condition.onFalse === 'skip') {\n          task.status = 'skipped';\n          this.emit('task:skipped', { task, reason: 'condition_not_met' });\n          return;\n        } else if (task.condition.onFalse === 'fail') {\n          task.status = 'failed';\n          task.result = { success: false, error: 'Condition not met' };\n          this.emit('task:failed', { task, error: new Error('Condition not met') });\n          return;\n        }\n        // 'wait' - skip for now, will retry later\n        return;\n      }\n    }\n\n    // Call beforeTask hook\n    if (this.hooks?.beforeTask) {\n      const taskContext: TaskContext = {\n        taskId: task.id,\n        taskName: task.name,\n        attempt: task.attempts + 1,\n      };\n      const hookResult = await this.hooks.beforeTask(task, taskContext);\n      if (hookResult === 'skip') {\n        task.status = 'skipped';\n        this.emit('task:skipped', { task, reason: 'hook_skip' });\n        return;\n      }\n    }\n\n    // Mark task as in progress\n    const updatedTask = updateTaskStatus(task, 'in_progress');\n    Object.assign(task, updatedTask);\n    this.emit('task:start', { task });\n\n    try {\n      // Build task prompt\n      const taskPrompt = this.buildTaskPrompt(plan, task);\n\n      // Prepare context (check for compaction needs)\n      await this.contextManager.prepareContext(\n        {\n          systemPrompt: this.buildSystemPrompt(plan),\n          instructions: '',\n          memoryIndex: await this.memory.formatIndex(),\n          conversationHistory: this.historyManager.getRecentMessages().map((m) => ({\n            role: m.role,\n            content: m.content,\n          })),\n          currentInput: taskPrompt,\n        },\n        this.memory as any,\n        this.historyManager\n      );\n\n      // Add task prompt to history\n      this.historyManager.addMessage('user', taskPrompt);\n\n      this.emit('llm:call', { iteration: task.attempts });\n\n      // Call beforeLLMCall hook\n      let messages: any[] = [{ role: 'user', content: taskPrompt }];\n      if (this.hooks?.beforeLLMCall) {\n        messages = await this.hooks.beforeLLMCall(messages, {\n          model: this.agent.model,\n          temperature: 0.7, // Default temperature\n        });\n      }\n\n      // Call LLM through the agent (tools already wrapped with cache in TaskAgent)\n      const response = await this.agent.run(taskPrompt);\n\n      // Track metrics from response\n      if (response.usage) {\n        this.currentMetrics.totalLLMCalls++;\n        this.currentMetrics.totalTokensUsed += response.usage.total_tokens || 0;\n\n        // Calculate cost if model info available\n        if (this.agent.model && response.usage.input_tokens && response.usage.output_tokens) {\n          const cost = calculateCost(this.agent.model, response.usage.input_tokens, response.usage.output_tokens);\n          if (cost !== null) {\n            this.currentMetrics.totalCost += cost;\n          }\n        }\n      }\n\n      // Call afterLLMCall hook\n      if (this.hooks?.afterLLMCall) {\n        await this.hooks.afterLLMCall(response);\n      }\n\n      // Checkpoint after LLM call\n      if (this.currentState) {\n        await this.checkpointManager.onLLMCall(this.currentState);\n      }\n\n      // Add response to history\n      this.historyManager.addMessage('assistant', response.output_text || '');\n\n      // Mark task as complete\n      const completedTask = updateTaskStatus(task, 'completed');\n      completedTask.result = {\n        success: true,\n        output: response.output_text,\n      };\n      Object.assign(task, completedTask);\n\n      this.emit('task:complete', { task, result: response });\n\n      // Call afterTask hook\n      if (this.hooks?.afterTask) {\n        await this.hooks.afterTask(task, {\n          success: true,\n          output: response.output_text,\n        });\n      }\n\n      // Check for external dependency\n      if (task.externalDependency) {\n        task.status = 'waiting_external';\n\n        // Checkpoint before external wait\n        if (this.currentState) {\n          await this.checkpointManager.checkpoint(this.currentState, 'before_external_wait');\n        }\n\n        await this.externalHandler.startWaiting(task);\n        this.emit('task:waiting_external', { task });\n      }\n    } catch (error) {\n      // Handle task failure\n      const err = error instanceof Error ? error : new Error(String(error));\n\n      // Call onError hook\n      let errorAction: 'retry' | 'fail' | 'skip' = 'retry';\n      if (this.hooks?.onError) {\n        const errorContext: ErrorContext = {\n          task,\n          error: err,\n          phase: 'execution',\n        };\n        errorAction = await this.hooks.onError(err, errorContext);\n      }\n\n      if (errorAction === 'skip') {\n        task.status = 'skipped';\n        this.emit('task:skipped', { task, reason: 'error_hook_skip' });\n        return;\n      } else if (errorAction === 'fail') {\n        // Force fail without retry\n        const failedTask = updateTaskStatus(task, 'failed');\n        failedTask.result = {\n          success: false,\n          error: err.message,\n        };\n        Object.assign(task, failedTask);\n        this.emit('task:failed', { task, error: err });\n        return;\n      }\n\n      // Check if we should retry (default behavior or 'retry' action)\n      if (task.attempts < task.maxAttempts) {\n        // Will retry on next iteration\n        const retryTask = updateTaskStatus(task, 'pending');\n        Object.assign(task, retryTask);\n      } else {\n        // Max attempts exceeded\n        const failedTask = updateTaskStatus(task, 'failed');\n        failedTask.result = {\n          success: false,\n          error: err.message,\n        };\n        Object.assign(task, failedTask);\n        this.emit('task:failed', { task, error: err });\n      }\n    }\n  }\n\n  /**\n   * Build system prompt for task execution\n   */\n  private buildSystemPrompt(plan: Plan): string {\n    return `You are an autonomous agent executing a plan.\n\n**Goal:** ${plan.goal}\n${plan.context ? `**Context:** ${plan.context}\\n` : ''}\n**Your Role:** Execute tasks step by step using the available tools. Use working memory to store and retrieve information between tasks.\n\n**Important Instructions:**\n1. When you complete a task successfully, acknowledge it clearly\n2. Use memory_store to save important data for future tasks\n3. Use memory_retrieve to access previously stored data\n4. If a task requires information from a previous task, retrieve it from memory\n5. Be systematic and thorough in completing each task`;\n  }\n\n  /**\n   * Build prompt for a specific task\n   */\n  private buildTaskPrompt(plan: Plan, task: Task): string {\n    const prompt: string[] = [];\n\n    prompt.push(`## Current Task: ${task.name}`);\n    prompt.push('');\n    prompt.push(`**Description:** ${task.description}`);\n\n    if (task.expectedOutput) {\n      prompt.push(`**Expected Output:** ${task.expectedOutput}`);\n    }\n\n    if (task.dependsOn.length > 0) {\n      const deps = plan.tasks\n        .filter((t) => task.dependsOn.includes(t.id))\n        .map((t) => t.name);\n      prompt.push(`**Dependencies Completed:** ${deps.join(', ')}`);\n    }\n\n    prompt.push('');\n    prompt.push('Please complete this task using the available tools.');\n\n    return prompt.join('\\n');\n  }\n\n  /**\n   * Check if plan is complete\n   */\n  private isPlanComplete(plan: Plan): boolean {\n    return plan.tasks.every((t) => ['completed', 'skipped', 'failed'].includes(t.status));\n  }\n\n  /**\n   * Check if plan is suspended (waiting on external)\n   */\n  private isPlanSuspended(plan: Plan): boolean {\n    return plan.tasks.some((t) => t.status === 'waiting_external');\n  }\n\n  /**\n   * Cancel execution\n   */\n  cancel(): void {\n    this.abortController.abort();\n  }\n\n  /**\n   * Cleanup resources\n   */\n  cleanup(): void {\n    this.abortController.abort();\n  }\n\n  /**\n   * Get idempotency cache\n   */\n  getIdempotencyCache(): IdempotencyCache {\n    return this.idempotencyCache;\n  }\n}\n","/**\n * CheckpointManager - manages agent state checkpointing\n */\n\nimport { AgentState } from '../../domain/entities/AgentState.js';\nimport { IAgentStorage } from '../../infrastructure/storage/InMemoryStorage.js';\n\nexport interface CheckpointStrategy {\n  /** Checkpoint after every N tool calls */\n  afterToolCalls?: number;\n\n  /** Checkpoint after every N LLM calls */\n  afterLLMCalls?: number;\n\n  /** Checkpoint on time interval */\n  intervalMs?: number;\n\n  /** Always checkpoint before external wait */\n  beforeExternalWait: boolean;\n\n  /** Checkpoint mode */\n  mode: 'sync' | 'async';\n}\n\nexport const DEFAULT_CHECKPOINT_STRATEGY: CheckpointStrategy = {\n  afterToolCalls: 1,\n  afterLLMCalls: 1,\n  intervalMs: 30000, // 30 seconds\n  beforeExternalWait: true,\n  mode: 'async',\n};\n\n/**\n * Manages state checkpointing for persistence and recovery\n */\nexport class CheckpointManager {\n  private storage: IAgentStorage;\n  private strategy: CheckpointStrategy;\n  private toolCallsSinceCheckpoint = 0;\n  private llmCallsSinceCheckpoint = 0;\n  private intervalTimer?: NodeJS.Timeout;\n  private pendingCheckpoints = new Set<Promise<void>>();\n  private currentState: AgentState | null = null;\n\n  constructor(storage: IAgentStorage, strategy: CheckpointStrategy = DEFAULT_CHECKPOINT_STRATEGY) {\n    this.storage = storage;\n    this.strategy = strategy;\n\n    // Start interval timer if configured\n    if (this.strategy.intervalMs) {\n      this.intervalTimer = setInterval(() => {\n        this.checkIntervalCheckpoint();\n      }, this.strategy.intervalMs);\n    }\n  }\n\n  /**\n   * Set the current agent state (for interval checkpointing)\n   */\n  setCurrentState(state: AgentState): void {\n    this.currentState = state;\n  }\n\n  /**\n   * Record a tool call (may trigger checkpoint)\n   */\n  async onToolCall(state: AgentState): Promise<void> {\n    this.toolCallsSinceCheckpoint++;\n\n    if (this.strategy.afterToolCalls && this.toolCallsSinceCheckpoint >= this.strategy.afterToolCalls) {\n      await this.checkpoint(state, 'tool_calls');\n    }\n  }\n\n  /**\n   * Record an LLM call (may trigger checkpoint)\n   */\n  async onLLMCall(state: AgentState): Promise<void> {\n    this.llmCallsSinceCheckpoint++;\n\n    if (this.strategy.afterLLMCalls && this.llmCallsSinceCheckpoint >= this.strategy.afterLLMCalls) {\n      await this.checkpoint(state, 'llm_calls');\n    }\n  }\n\n  /**\n   * Force a checkpoint\n   */\n  async checkpoint(state: AgentState, reason: string): Promise<void> {\n    const checkpointPromise = this.doCheckpoint(state, reason);\n\n    if (this.strategy.mode === 'sync') {\n      await checkpointPromise;\n    } else {\n      // Async mode - don't block, but track the promise\n      this.pendingCheckpoints.add(checkpointPromise);\n      checkpointPromise.finally(() => {\n        this.pendingCheckpoints.delete(checkpointPromise);\n      });\n    }\n  }\n\n  /**\n   * Perform the actual checkpoint\n   */\n  private async doCheckpoint(state: AgentState, _reason: string): Promise<void> {\n    try {\n      // Save agent state\n      await this.storage.agent.save(state);\n\n      // Save plan\n      await this.storage.plan.savePlan(state.plan);\n\n      // Reset counters\n      this.toolCallsSinceCheckpoint = 0;\n      this.llmCallsSinceCheckpoint = 0;\n    } catch (error) {\n      console.error(`Checkpoint failed (${_reason}):`, error);\n      // Don't throw - checkpointing is best-effort\n    }\n  }\n\n  /**\n   * Check if interval-based checkpoint is needed\n   */\n  private checkIntervalCheckpoint(): void {\n    if (this.currentState) {\n      // Trigger interval checkpoint\n      this.checkpoint(this.currentState, 'interval');\n    }\n  }\n\n  /**\n   * Wait for all pending checkpoints to complete\n   */\n  async flush(): Promise<void> {\n    await Promise.all(Array.from(this.pendingCheckpoints));\n  }\n\n  /**\n   * Cleanup resources\n   */\n  async cleanup(): Promise<void> {\n    if (this.intervalTimer) {\n      clearInterval(this.intervalTimer);\n    }\n\n    // Wait for all pending checkpoints to complete\n    await this.flush();\n  }\n}\n","/**\n * Memory tools - built-in tools for memory manipulation\n */\n\nimport { ToolFunction, FunctionToolDefinition } from '../../domain/entities/Tool.js';\nimport { ToolContext } from '../../domain/interfaces/IToolContext.js';\n\n/**\n * Tool definition for memory_store\n */\nexport const memoryStoreDefinition: FunctionToolDefinition = {\n  type: 'function',\n  function: {\n    name: 'memory_store',\n    description:\n      'Store data in working memory for later use. Use this to save important information from tool outputs.',\n    parameters: {\n      type: 'object',\n      properties: {\n        key: {\n          type: 'string',\n          description: 'Namespaced key (e.g., \"user.profile\", \"order.items\")',\n        },\n        description: {\n          type: 'string',\n          description: 'Brief description of what this data contains (max 150 chars)',\n        },\n        value: {\n          description: 'The data to store (can be any JSON value)',\n        },\n      },\n      required: ['key', 'description', 'value'],\n    },\n  },\n};\n\n/**\n * Tool definition for memory_retrieve\n */\nexport const memoryRetrieveDefinition: FunctionToolDefinition = {\n  type: 'function',\n  function: {\n    name: 'memory_retrieve',\n    description:\n      'Retrieve full data from working memory by key. Use when you need the complete data, not just the description.',\n    parameters: {\n      type: 'object',\n      properties: {\n        key: {\n          type: 'string',\n          description: 'The key to retrieve',\n        },\n      },\n      required: ['key'],\n    },\n  },\n};\n\n/**\n * Tool definition for memory_delete\n */\nexport const memoryDeleteDefinition: FunctionToolDefinition = {\n  type: 'function',\n  function: {\n    name: 'memory_delete',\n    description: 'Delete data from working memory to free up space.',\n    parameters: {\n      type: 'object',\n      properties: {\n        key: {\n          type: 'string',\n          description: 'The key to delete',\n        },\n      },\n      required: ['key'],\n    },\n  },\n};\n\n/**\n * Tool definition for memory_list\n */\nexport const memoryListDefinition: FunctionToolDefinition = {\n  type: 'function',\n  function: {\n    name: 'memory_list',\n    description: 'List all keys and their descriptions in working memory.',\n    parameters: {\n      type: 'object',\n      properties: {},\n      required: [],\n    },\n  },\n};\n\n/**\n * Create all memory tools\n */\nexport function createMemoryTools(): ToolFunction[] {\n  return [\n    // memory_store\n    {\n      definition: memoryStoreDefinition,\n      execute: async (args: Record<string, unknown>, context?: ToolContext) => {\n        if (!context || !context.memory) {\n          return { error: 'Memory tools require TaskAgent context' };\n        }\n\n        try {\n          await context.memory.set(\n            args.key as string,\n            args.description as string,\n            args.value\n          );\n          return { success: true, key: args.key };\n        } catch (error) {\n          return { error: error instanceof Error ? error.message : String(error) };\n        }\n      },\n      idempotency: { safe: true },\n      output: { expectedSize: 'small' },\n    },\n\n    // memory_retrieve\n    {\n      definition: memoryRetrieveDefinition,\n      execute: async (args: Record<string, unknown>, context?: ToolContext) => {\n        if (!context || !context.memory) {\n          return { error: 'Memory tools require TaskAgent context' };\n        }\n\n        const value = await context.memory.get(args.key as string);\n        if (value === undefined) {\n          return { error: `Key \"${args.key}\" not found in memory` };\n        }\n        return value;\n      },\n      idempotency: { safe: true },\n      output: { expectedSize: 'variable' },\n    },\n\n    // memory_delete\n    {\n      definition: memoryDeleteDefinition,\n      execute: async (args: Record<string, unknown>, context?: ToolContext) => {\n        if (!context || !context.memory) {\n          return { error: 'Memory tools require TaskAgent context' };\n        }\n\n        await context.memory.delete(args.key as string);\n        return { success: true, deleted: args.key };\n      },\n      idempotency: { safe: true },\n      output: { expectedSize: 'small' },\n    },\n\n    // memory_list\n    {\n      definition: memoryListDefinition,\n      execute: async (_args: Record<string, unknown>, context?: ToolContext) => {\n        if (!context || !context.memory) {\n          return { error: 'Memory tools require TaskAgent context' };\n        }\n\n        return await context.memory.list();\n      },\n      idempotency: { safe: true },\n      output: { expectedSize: 'small' },\n    },\n  ];\n}\n","/**\n * Context inspection tools for TaskAgent\n *\n * These tools allow agents to inspect their own context state:\n * - context_inspect: Get context budget and utilization\n * - context_breakdown: Get detailed token breakdown\n * - cache_stats: Get idempotency cache statistics\n * - memory_stats: Get working memory statistics\n */\n\nimport { ToolFunction } from '../../domain/entities/Tool.js';\nimport type { ToolContext } from '../../domain/interfaces/IToolContext.js';\n\n/**\n * Create context inspection tools\n */\nexport function createContextTools(): ToolFunction[] {\n  return [\n    createContextInspectTool(),\n    createContextBreakdownTool(),\n    createCacheStatsTool(),\n    createMemoryStatsTool(),\n  ];\n}\n\n/**\n * context_inspect tool - Get context budget and utilization\n */\nfunction createContextInspectTool(): ToolFunction {\n  return {\n    definition: {\n      type: 'function',\n      function: {\n        name: 'context_inspect',\n        description: 'Get detailed breakdown of current context budget and utilization. Shows total tokens, used tokens, available tokens, utilization percentage, and status (ok/warning/critical).',\n        parameters: {\n          type: 'object',\n          properties: {},\n          required: [],\n        },\n      },\n    },\n    execute: async (_args: unknown, context?: ToolContext) => {\n      if (!context?.contextManager) {\n        return {\n          error: 'Context manager not available',\n          message: 'This tool is only available within TaskAgent execution',\n        };\n      }\n\n      const budget = context.contextManager.getCurrentBudget();\n\n      if (!budget) {\n        return {\n          error: 'No context budget available',\n          message: 'Context has not been prepared yet',\n        };\n      }\n\n      return {\n        total_tokens: budget.total,\n        reserved_tokens: budget.reserved,\n        used_tokens: budget.used,\n        available_tokens: budget.available,\n        utilization_percent: Math.round(budget.utilizationPercent * 10) / 10,\n        status: budget.status,\n        warning:\n          budget.status === 'warning'\n            ? 'Context approaching limit - automatic compaction may trigger'\n            : budget.status === 'critical'\n              ? 'Context at critical level - compaction will trigger'\n              : null,\n      };\n    },\n    idempotency: {\n      safe: true, // Read-only operation\n    },\n  };\n}\n\n/**\n * context_breakdown tool - Get detailed token breakdown by component\n */\nfunction createContextBreakdownTool(): ToolFunction {\n  return {\n    definition: {\n      type: 'function',\n      function: {\n        name: 'context_breakdown',\n        description: 'Get detailed token breakdown by component (system prompt, instructions, memory index, conversation history, current input). Useful for understanding what is consuming context space.',\n        parameters: {\n          type: 'object',\n          properties: {},\n          required: [],\n        },\n      },\n    },\n    execute: async (_args: unknown, context?: ToolContext) => {\n      if (!context?.contextManager) {\n        return {\n          error: 'Context manager not available',\n          message: 'This tool is only available within TaskAgent execution',\n        };\n      }\n\n      const budget = context.contextManager.getCurrentBudget();\n\n      if (!budget) {\n        return {\n          error: 'No context budget available',\n          message: 'Context has not been prepared yet',\n        };\n      }\n\n      return {\n        total_used: budget.used,\n        breakdown: budget.breakdown,\n        components: [\n          {\n            name: 'system_prompt',\n            tokens: budget.breakdown.systemPrompt,\n            percent: Math.round((budget.breakdown.systemPrompt / budget.used) * 1000) / 10,\n          },\n          {\n            name: 'instructions',\n            tokens: budget.breakdown.instructions,\n            percent: Math.round((budget.breakdown.instructions / budget.used) * 1000) / 10,\n          },\n          {\n            name: 'memory_index',\n            tokens: budget.breakdown.memoryIndex,\n            percent: Math.round((budget.breakdown.memoryIndex / budget.used) * 1000) / 10,\n          },\n          {\n            name: 'conversation_history',\n            tokens: budget.breakdown.conversationHistory,\n            percent: Math.round((budget.breakdown.conversationHistory / budget.used) * 1000) / 10,\n          },\n          {\n            name: 'current_input',\n            tokens: budget.breakdown.currentInput,\n            percent: Math.round((budget.breakdown.currentInput / budget.used) * 1000) / 10,\n          },\n        ],\n      };\n    },\n    idempotency: {\n      safe: true, // Read-only operation\n    },\n  };\n}\n\n/**\n * cache_stats tool - Get idempotency cache statistics\n */\nfunction createCacheStatsTool(): ToolFunction {\n  return {\n    definition: {\n      type: 'function',\n      function: {\n        name: 'cache_stats',\n        description: 'Get statistics about the tool call idempotency cache. Shows number of cached entries, cache hits, cache misses, and hit rate. Useful for understanding cache effectiveness.',\n        parameters: {\n          type: 'object',\n          properties: {},\n          required: [],\n        },\n      },\n    },\n    execute: async (_args: unknown, context?: ToolContext) => {\n      if (!context?.idempotencyCache) {\n        return {\n          error: 'Idempotency cache not available',\n          message: 'This tool is only available within TaskAgent execution',\n        };\n      }\n\n      const stats = context.idempotencyCache.getStats();\n\n      return {\n        entries: stats.entries,\n        hits: stats.hits,\n        misses: stats.misses,\n        hit_rate: Math.round(stats.hitRate * 1000) / 10,\n        hit_rate_percent: `${Math.round(stats.hitRate * 100)}%`,\n        effectiveness:\n          stats.hitRate > 0.5\n            ? 'high'\n            : stats.hitRate > 0.2\n              ? 'medium'\n              : stats.hitRate > 0\n                ? 'low'\n                : 'none',\n      };\n    },\n    idempotency: {\n      safe: true, // Read-only operation\n    },\n  };\n}\n\n/**\n * memory_stats tool - Get working memory statistics\n */\nfunction createMemoryStatsTool(): ToolFunction {\n  return {\n    definition: {\n      type: 'function',\n      function: {\n        name: 'memory_stats',\n        description: 'Get detailed working memory utilization statistics. Shows total size, utilization percentage, number of entries, and breakdown by scope (persistent vs task-scoped).',\n        parameters: {\n          type: 'object',\n          properties: {},\n          required: [],\n        },\n      },\n    },\n    execute: async (_args: unknown, context?: ToolContext) => {\n      if (!context?.memory) {\n        return {\n          error: 'Working memory not available',\n          message: 'This tool is only available within TaskAgent execution',\n        };\n      }\n\n      // Get the index from memory\n      const index = await context.memory.list();\n\n      // Calculate stats (note: we don't have direct access to sizes from WorkingMemoryAccess)\n      // This is a simplified version - in production, you might want to add more methods to WorkingMemoryAccess\n      return {\n        entry_count: index.length,\n        entries_by_scope: {\n          total: index.length,\n          // Note: scope information not available through WorkingMemoryAccess interface\n          // Would need to extend the interface or use a different approach\n        },\n        entries: index.map((entry) => ({\n          key: entry.key,\n          description: entry.description,\n        })),\n      };\n    },\n    idempotency: {\n      safe: true, // Read-only operation\n    },\n  };\n}\n","/**\n * PlanningAgent - AI-driven plan generation\n *\n * Separates planning phase from execution phase.\n * Analyzes goals and generates task graphs with dependencies.\n */\n\nimport { Agent } from '../../core/Agent.js';\nimport { Connector } from '../../core/Connector.js';\nimport { ToolFunction } from '../../domain/entities/Tool.js';\nimport { Plan, TaskInput, createPlan } from '../../domain/entities/Task.js';\n\n/**\n * PlanningAgent configuration\n */\nexport interface PlanningAgentConfig {\n  /** Connector for LLM access */\n  connector: string | Connector;\n\n  /** Model to use for planning (can be different/cheaper than execution) */\n  model: string;\n\n  /** Max planning iterations */\n  maxPlanningIterations?: number;\n\n  /** Temperature for planning (lower = more deterministic) */\n  planningTemperature?: number;\n\n  /** Tools available for the plan (used to inform planning) */\n  availableTools?: ToolFunction[];\n}\n\n/**\n * Generated plan with metadata\n */\nexport interface GeneratedPlan {\n  plan: Plan;\n  reasoning: string;\n  estimated_duration?: string;\n  complexity?: 'low' | 'medium' | 'high';\n}\n\n/**\n * Planning system prompt\n */\nconst PLANNING_SYSTEM_PROMPT = `You are an AI planning agent. Your job is to analyze goals and break them down into structured, executable task plans.\n\n**Your Role:**\n1. Analyze the user's goal and context\n2. Break down the goal into logical, atomic tasks\n3. Identify dependencies between tasks\n4. Structure tasks for optimal execution (parallel where possible)\n5. Use the planning tools to create the plan\n\n**Planning Principles:**\n- Each task should have a single, clear responsibility\n- Tasks should be atomic (can't be broken down further meaningfully)\n- Dependencies should be explicit (use dependsOn)\n- Parallel tasks should be marked as such (execution.parallel)\n- Task names should be descriptive snake_case (e.g., \"fetch_user_data\")\n- Descriptions should be clear and actionable\n\n**Available Planning Tools:**\n- create_task: Add a task to the plan\n- add_dependency: Link tasks with dependencies\n- mark_parallel: Mark tasks that can run in parallel\n- finalize_plan: Complete the planning phase\n\nAlways start by analyzing the goal, then create tasks one by one, building dependencies as you go.`;\n\n/**\n * PlanningAgent class\n */\nexport class PlanningAgent {\n  private agent: Agent;\n  private config: PlanningAgentConfig;\n  private currentTasks: TaskInput[] = [];\n  private planningComplete = false;\n\n  private constructor(agent: Agent, config: PlanningAgentConfig) {\n    this.agent = agent;\n    this.config = config;\n  }\n\n  /**\n   * Create a new PlanningAgent\n   */\n  static create(config: PlanningAgentConfig): PlanningAgent {\n    // Create planning tools\n    const planningTools = createPlanningTools();\n\n    // Create base Agent with planning configuration\n    const agent = Agent.create({\n      connector: config.connector,\n      model: config.model,\n      tools: planningTools,\n      instructions: PLANNING_SYSTEM_PROMPT,\n      temperature: config.planningTemperature ?? 0.3, // Lower temp for more structured output\n      maxIterations: config.maxPlanningIterations ?? 20,\n    });\n\n    return new PlanningAgent(agent, config);\n  }\n\n  /**\n   * Generate a plan from a goal\n   */\n  async generatePlan(input: {\n    goal: string;\n    context?: string;\n    constraints?: string[];\n  }): Promise<GeneratedPlan> {\n    // Reset state\n    this.currentTasks = [];\n    this.planningComplete = false;\n\n    // Build planning prompt\n    const prompt = this.buildPlanningPrompt(input);\n\n    // Use the agent to generate the plan\n    const response = await this.agent.run(prompt);\n\n    // If planning wasn't finalized through tools, finalize manually\n    if (!this.planningComplete && this.currentTasks.length > 0) {\n      this.planningComplete = true;\n    }\n\n    // Create the plan\n    const plan = createPlan({\n      goal: input.goal,\n      context: input.context,\n      tasks: this.currentTasks,\n      allowDynamicTasks: false, // Plans are static by default\n    });\n\n    return {\n      plan,\n      reasoning: response.output_text || 'Plan generated',\n      complexity: this.estimateComplexity(this.currentTasks),\n    };\n  }\n\n  /**\n   * Validate and refine an existing plan\n   */\n  async refinePlan(plan: Plan, feedback: string): Promise<GeneratedPlan> {\n    // Load existing tasks\n    this.currentTasks = plan.tasks.map((task) => ({\n      name: task.name,\n      description: task.description,\n      dependsOn: task.dependsOn,\n      expectedOutput: task.expectedOutput,\n      condition: task.condition,\n      execution: task.execution,\n      externalDependency: task.externalDependency,\n      maxAttempts: task.maxAttempts,\n    }));\n\n    this.planningComplete = false;\n\n    // Build refinement prompt\n    const prompt = `I have an existing plan that needs refinement based on feedback.\n\n**Current Plan Goal:** ${plan.goal}\n**Current Plan Context:** ${plan.context || 'None'}\n\n**Current Tasks:**\n${this.currentTasks.map((t, i) => `${i + 1}. ${t.name}: ${t.description}${t.dependsOn?.length ? ` (depends on: ${t.dependsOn.join(', ')})` : ''}`).join('\\n')}\n\n**Feedback:** ${feedback}\n\nPlease refine the plan based on this feedback. You can:\n- Add new tasks\n- Modify existing task descriptions\n- Change dependencies\n- Remove unnecessary tasks\n- Adjust parallel execution\n\nUse the planning tools to make changes, then finalize when complete.`;\n\n    const response = await this.agent.run(prompt);\n\n    // Create refined plan\n    const refinedPlan = createPlan({\n      goal: plan.goal,\n      context: plan.context,\n      tasks: this.currentTasks,\n      allowDynamicTasks: false,\n    });\n\n    return {\n      plan: refinedPlan,\n      reasoning: response.output_text || 'Plan refined',\n      complexity: this.estimateComplexity(this.currentTasks),\n    };\n  }\n\n  /**\n   * Build planning prompt from input\n   */\n  private buildPlanningPrompt(input: {\n    goal: string;\n    context?: string;\n    constraints?: string[];\n  }): string {\n    const parts: string[] = [];\n\n    parts.push('Please create an execution plan for the following goal:\\n');\n    parts.push(`**Goal:** ${input.goal}\\n`);\n\n    if (input.context) {\n      parts.push(`**Context:** ${input.context}\\n`);\n    }\n\n    if (input.constraints && input.constraints.length > 0) {\n      parts.push('\\n**Constraints:**');\n      input.constraints.forEach((c) => parts.push(`- ${c}`));\n      parts.push('');\n    }\n\n    if (this.config.availableTools && this.config.availableTools.length > 0) {\n      parts.push('\\n**Available Tools for Execution:**');\n      this.config.availableTools.forEach((tool) => {\n        parts.push(`- ${tool.definition.function.name}: ${tool.definition.function.description}`);\n      });\n      parts.push('');\n    }\n\n    parts.push('\\nAnalyze this goal and create a structured plan with clear tasks and dependencies.');\n    parts.push('Use the planning tools to build the plan step by step.');\n\n    return parts.join('\\n');\n  }\n\n  /**\n   * Estimate plan complexity\n   */\n  private estimateComplexity(tasks: TaskInput[]): 'low' | 'medium' | 'high' {\n    const taskCount = tasks.length;\n    const hasDependencies = tasks.some((t) => t.dependsOn && t.dependsOn.length > 0);\n    const hasConditionals = tasks.some((t) => t.condition);\n    const hasExternalDeps = tasks.some((t) => t.externalDependency);\n\n    if (taskCount <= 3 && !hasDependencies && !hasConditionals && !hasExternalDeps) {\n      return 'low';\n    }\n\n    if (taskCount <= 10 && !hasConditionals && !hasExternalDeps) {\n      return 'medium';\n    }\n\n    return 'high';\n  }\n\n  /**\n   * Get current tasks (for tool access)\n   */\n  getCurrentTasks(): TaskInput[] {\n    return [...this.currentTasks];\n  }\n\n  /**\n   * Add task (called by planning tools)\n   */\n  addTask(task: TaskInput): void {\n    this.currentTasks.push(task);\n  }\n\n  /**\n   * Update task (called by planning tools)\n   */\n  updateTask(name: string, updates: Partial<TaskInput>): void {\n    const task = this.currentTasks.find((t) => t.name === name);\n    if (task) {\n      Object.assign(task, updates);\n    }\n  }\n\n  /**\n   * Remove task (called by planning tools)\n   */\n  removeTask(name: string): void {\n    const index = this.currentTasks.findIndex((t) => t.name === name);\n    if (index >= 0) {\n      this.currentTasks.splice(index, 1);\n    }\n  }\n\n  /**\n   * Mark planning as complete\n   */\n  finalizePlanning(): void {\n    this.planningComplete = true;\n  }\n}\n\n/**\n * Create planning tools\n */\nfunction createPlanningTools(): ToolFunction[] {\n  return [\n    {\n      definition: {\n        type: 'function',\n        function: {\n          name: 'create_task',\n          description: 'Create a new task in the plan with name, description, and optional dependencies',\n          parameters: {\n            type: 'object',\n            properties: {\n              name: {\n                type: 'string',\n                description: 'Task name in snake_case (e.g., \"fetch_user_data\")',\n              },\n              description: {\n                type: 'string',\n                description: 'Clear, actionable description of what this task does',\n              },\n              depends_on: {\n                type: 'array',\n                items: { type: 'string' },\n                description: 'Array of task names this task depends on (optional)',\n              },\n              parallel: {\n                type: 'boolean',\n                description: 'Whether this task can run in parallel with others (default: false)',\n              },\n              expected_output: {\n                type: 'string',\n                description: 'Description of expected output (optional)',\n              },\n            },\n            required: ['name', 'description'],\n          },\n        },\n      },\n      execute: async (args: any) => {\n        // Note: In a real implementation, we'd need access to the PlanningAgent instance\n        // This is a simplified version - the actual implementation would need to be bound to the instance\n        return {\n          success: true,\n          message: `Task '${args.name}' created`,\n        };\n      },\n      idempotency: {\n        safe: false,\n      },\n    },\n    {\n      definition: {\n        type: 'function',\n        function: {\n          name: 'finalize_plan',\n          description: 'Mark the planning phase as complete. Call this when all tasks have been created and the plan is ready.',\n          parameters: {\n            type: 'object',\n            properties: {},\n          },\n        },\n      },\n      execute: async () => {\n        return {\n          success: true,\n          message: 'Plan finalized and ready for execution',\n        };\n      },\n      idempotency: {\n        safe: false,\n      },\n    },\n  ];\n}\n\n/**\n * Simple plan generation without tools (fallback)\n */\nexport async function generateSimplePlan(\n  goal: string,\n  context?: string\n): Promise<Plan> {\n  // Fallback: create a simple single-task plan\n  return createPlan({\n    goal,\n    context,\n    tasks: [\n      {\n        name: 'execute_goal',\n        description: `Execute the goal: ${goal}`,\n      },\n    ],\n    allowDynamicTasks: true, // Allow agent to modify plan\n  });\n}\n","/**\n * Core types for context management system\n */\n\n/**\n * Context component that can be compacted\n */\nexport interface IContextComponent {\n  /** Unique name for this component */\n  name: string;\n\n  /** The actual content (string or structured data) */\n  content: string | unknown;\n\n  /** Priority for compaction (higher = compact first) */\n  priority: number;\n\n  /** Whether this component can be compacted */\n  compactable: boolean;\n\n  /** Additional metadata for compaction strategies */\n  metadata?: Record<string, unknown>;\n}\n\n/**\n * Context budget information\n */\nexport interface ContextBudget {\n  /** Total available tokens */\n  total: number;\n\n  /** Reserved tokens for response */\n  reserved: number;\n\n  /** Currently used tokens */\n  used: number;\n\n  /** Available tokens remaining */\n  available: number;\n\n  /** Utilization percentage (used / (total - reserved)) */\n  utilizationPercent: number;\n\n  /** Budget status */\n  status: 'ok' | 'warning' | 'critical';\n\n  /** Token breakdown by component */\n  breakdown: Record<string, number>;\n}\n\n/**\n * Context preparation result\n */\nexport interface PreparedContext {\n  /** Prepared components */\n  components: IContextComponent[];\n\n  /** Current budget */\n  budget: ContextBudget;\n\n  /** Whether compaction occurred */\n  compacted: boolean;\n\n  /** Compaction log if compacted */\n  compactionLog?: string[];\n}\n\n/**\n * Context manager configuration\n */\nexport interface ContextManagerConfig {\n  /** Maximum context tokens for the model */\n  maxContextTokens: number;\n\n  /** Threshold to trigger compaction (0.0 - 1.0) */\n  compactionThreshold: number;\n\n  /** Hard limit - must compact before this (0.0 - 1.0) */\n  hardLimit: number;\n\n  /** Reserve space for response (0.0 - 1.0) */\n  responseReserve: number;\n\n  /** Token estimator to use */\n  estimator: 'approximate' | 'tiktoken' | ITokenEstimator;\n\n  /** Enable automatic compaction */\n  autoCompact: boolean;\n\n  /** Strategy to use */\n  strategy?: 'proactive' | 'aggressive' | 'lazy' | 'rolling-window' | 'adaptive' | IContextStrategy;\n\n  /** Strategy-specific options */\n  strategyOptions?: Record<string, unknown>;\n}\n\n/**\n * Default configuration\n */\nexport const DEFAULT_CONTEXT_CONFIG: ContextManagerConfig = {\n  maxContextTokens: 128000,\n  compactionThreshold: 0.75,\n  hardLimit: 0.9,\n  responseReserve: 0.15,\n  estimator: 'approximate',\n  autoCompact: true,\n  strategy: 'proactive',\n  strategyOptions: {},\n};\n\n/**\n * Abstract interface for providing context components.\n * Each agent type implements this to define what goes into context.\n */\nexport interface IContextProvider {\n  /**\n   * Get current context components\n   */\n  getComponents(): Promise<IContextComponent[]>;\n\n  /**\n   * Update components after compaction\n   */\n  applyCompactedComponents(components: IContextComponent[]): Promise<void>;\n\n  /**\n   * Get max context size for this agent/model\n   */\n  getMaxContextSize(): number;\n}\n\n/**\n * Abstract interface for token estimation\n */\nexport interface ITokenEstimator {\n  /**\n   * Estimate token count for text\n   */\n  estimateTokens(text: string, model?: string): number;\n\n  /**\n   * Estimate tokens for structured data\n   */\n  estimateDataTokens(data: unknown, model?: string): number;\n}\n\n/**\n * Abstract interface for compaction strategies\n */\nexport interface IContextCompactor {\n  /** Compactor name */\n  readonly name: string;\n\n  /** Priority order (lower = run first) */\n  readonly priority: number;\n\n  /**\n   * Check if this compactor can handle the component\n   */\n  canCompact(component: IContextComponent): boolean;\n\n  /**\n   * Compact the component to target size\n   */\n  compact(component: IContextComponent, targetTokens: number): Promise<IContextComponent>;\n\n  /**\n   * Estimate savings from compaction\n   */\n  estimateSavings(component: IContextComponent): number;\n}\n\n/**\n * Context management strategy - defines the overall approach to managing context\n */\nexport interface IContextStrategy {\n  /** Strategy name */\n  readonly name: string;\n\n  /**\n   * Decide if compaction is needed based on current budget\n   */\n  shouldCompact(budget: ContextBudget, config: ContextManagerConfig): boolean;\n\n  /**\n   * Execute compaction using available compactors\n   */\n  compact(\n    components: IContextComponent[],\n    budget: ContextBudget,\n    compactors: IContextCompactor[],\n    estimator: ITokenEstimator\n  ): Promise<{\n    components: IContextComponent[];\n    log: string[];\n    tokensFreed: number;\n  }>;\n\n  /**\n   * Optional: Prepare components before budget calculation\n   * Use this for strategies that pre-process context (e.g., rolling window)\n   */\n  prepareComponents?(components: IContextComponent[]): Promise<IContextComponent[]>;\n\n  /**\n   * Optional: Post-process after compaction\n   * Use this for strategies that need cleanup or optimization\n   */\n  postProcess?(\n    components: IContextComponent[],\n    budget: ContextBudget\n  ): Promise<IContextComponent[]>;\n\n  /**\n   * Optional: Get strategy-specific metrics\n   */\n  getMetrics?(): Record<string, unknown>;\n}\n","/**\n * Proactive Compaction Strategy\n *\n * - Monitors context budget continuously\n * - Compacts proactively when reaching threshold\n * - Follows priority-based compaction order\n */\n\nimport type {\n  IContextStrategy,\n  IContextComponent,\n  ContextBudget,\n  ContextManagerConfig,\n  IContextCompactor,\n  ITokenEstimator,\n} from '../types.js';\n\nexport class ProactiveCompactionStrategy implements IContextStrategy {\n  readonly name = 'proactive';\n\n  private metrics = {\n    compactionCount: 0,\n    totalTokensFreed: 0,\n    avgTokensFreedPerCompaction: 0,\n  };\n\n  shouldCompact(budget: ContextBudget, _config: ContextManagerConfig): boolean {\n    // Compact when we hit warning or critical\n    return budget.status === 'warning' || budget.status === 'critical';\n  }\n\n  async compact(\n    components: IContextComponent[],\n    budget: ContextBudget,\n    compactors: IContextCompactor[],\n    estimator: ITokenEstimator\n  ): Promise<{ components: IContextComponent[]; log: string[]; tokensFreed: number }> {\n    const log: string[] = [];\n    let current = [...components];\n\n    // Calculate target - aim for 65% to give breathing room\n    const targetUsage = Math.floor(budget.total * 0.65);\n    const tokensToFree = budget.used - targetUsage;\n\n    let freedTokens = 0;\n    let round = 0;\n    const maxRounds = 3;\n\n    // Sort components by priority (higher = compact first)\n    const sortedComponents = current\n      .filter((c) => c.compactable)\n      .sort((a, b) => b.priority - a.priority);\n\n    while (freedTokens < tokensToFree && round < maxRounds) {\n      round++;\n      let roundFreed = 0;\n\n      for (const component of sortedComponents) {\n        if (freedTokens >= tokensToFree) break;\n\n        // Find compactor for this component\n        const compactor = compactors.find((c) => c.canCompact(component));\n        if (!compactor) continue;\n\n        // Estimate current size\n        const beforeSize = this.estimateComponent(component, estimator);\n\n        // Calculate target size (more aggressive in later rounds)\n        const reductionFactor = 0.5 - (round - 1) * 0.15; // 50%, 35%, 20%\n        const targetSize = Math.floor(beforeSize * reductionFactor);\n\n        // Compact\n        const compacted = await compactor.compact(component, targetSize);\n\n        // Update component\n        const index = current.findIndex((c) => c.name === component.name);\n        current[index] = compacted;\n\n        // Track savings\n        const afterSize = this.estimateComponent(compacted, estimator);\n        const saved = beforeSize - afterSize;\n        freedTokens += saved;\n        roundFreed += saved;\n\n        log.push(\n          `Round ${round}: ${compactor.name} compacted \"${component.name}\" by ${saved} tokens`\n        );\n      }\n\n      // If we didn't free anything this round, stop\n      if (roundFreed === 0) break;\n    }\n\n    // Update metrics\n    this.metrics.compactionCount++;\n    this.metrics.totalTokensFreed += freedTokens;\n    this.metrics.avgTokensFreedPerCompaction =\n      this.metrics.totalTokensFreed / this.metrics.compactionCount;\n\n    return { components: current, log, tokensFreed: freedTokens };\n  }\n\n  private estimateComponent(component: IContextComponent, estimator: ITokenEstimator): number {\n    if (typeof component.content === 'string') {\n      return estimator.estimateTokens(component.content);\n    }\n    return estimator.estimateDataTokens(component.content);\n  }\n\n  getMetrics() {\n    return { ...this.metrics };\n  }\n}\n","/**\n * Aggressive Compaction Strategy\n *\n * - Compacts earlier (60% threshold instead of 75%)\n * - Targets lower usage (50% instead of 65%)\n * - More aggressive per-component reduction\n * - Good for: Long-running agents, constrained context\n */\n\nimport type {\n  IContextStrategy,\n  IContextComponent,\n  ContextBudget,\n  ContextManagerConfig,\n  IContextCompactor,\n  ITokenEstimator,\n} from '../types.js';\n\nexport interface AggressiveStrategyOptions {\n  /** Threshold to trigger compaction (default: 0.60) */\n  threshold?: number;\n  /** Target utilization after compaction (default: 0.50) */\n  target?: number;\n}\n\nexport class AggressiveCompactionStrategy implements IContextStrategy {\n  readonly name = 'aggressive';\n\n  constructor(private options: AggressiveStrategyOptions = {}) {}\n\n  shouldCompact(budget: ContextBudget, _config: ContextManagerConfig): boolean {\n    const threshold = this.options.threshold ?? 0.6; // Compact at 60%\n    const utilizationRatio = (budget.used + budget.reserved) / budget.total;\n    return utilizationRatio >= threshold;\n  }\n\n  async compact(\n    components: IContextComponent[],\n    budget: ContextBudget,\n    compactors: IContextCompactor[],\n    estimator: ITokenEstimator\n  ): Promise<{ components: IContextComponent[]; log: string[]; tokensFreed: number }> {\n    const log: string[] = [];\n    let current = [...components];\n\n    const target = this.options.target ?? 0.5; // Target 50%\n    const targetUsage = Math.floor(budget.total * target);\n    const tokensToFree = budget.used - targetUsage;\n\n    let freedTokens = 0;\n\n    // Sort by priority\n    const sortedComponents = current\n      .filter((c) => c.compactable)\n      .sort((a, b) => b.priority - a.priority);\n\n    for (const component of sortedComponents) {\n      if (freedTokens >= tokensToFree) break;\n\n      const compactor = compactors.find((c) => c.canCompact(component));\n      if (!compactor) continue;\n\n      const beforeSize = this.estimateComponent(component, estimator);\n\n      // More aggressive: target 30% of original size\n      const targetSize = Math.floor(beforeSize * 0.3);\n\n      const compacted = await compactor.compact(component, targetSize);\n\n      const index = current.findIndex((c) => c.name === component.name);\n      current[index] = compacted;\n\n      const afterSize = this.estimateComponent(compacted, estimator);\n      const saved = beforeSize - afterSize;\n      freedTokens += saved;\n\n      log.push(`Aggressive: ${compactor.name} compacted \"${component.name}\" by ${saved} tokens`);\n    }\n\n    return { components: current, log, tokensFreed: freedTokens };\n  }\n\n  private estimateComponent(component: IContextComponent, estimator: ITokenEstimator): number {\n    if (typeof component.content === 'string') {\n      return estimator.estimateTokens(component.content);\n    }\n    return estimator.estimateDataTokens(component.content);\n  }\n}\n","/**\n * Lazy Compaction Strategy\n *\n * - Only compacts when absolutely necessary (>90%)\n * - Minimal compaction (just enough to fit)\n * - Preserves as much context as possible\n * - Good for: High-context models, short conversations\n */\n\nimport type {\n  IContextStrategy,\n  IContextComponent,\n  ContextBudget,\n  ContextManagerConfig,\n  IContextCompactor,\n  ITokenEstimator,\n} from '../types.js';\n\nexport class LazyCompactionStrategy implements IContextStrategy {\n  readonly name = 'lazy';\n\n  shouldCompact(budget: ContextBudget, _config: ContextManagerConfig): boolean {\n    // Only compact when critical\n    return budget.status === 'critical';\n  }\n\n  async compact(\n    components: IContextComponent[],\n    budget: ContextBudget,\n    compactors: IContextCompactor[],\n    estimator: ITokenEstimator\n  ): Promise<{ components: IContextComponent[]; log: string[]; tokensFreed: number }> {\n    const log: string[] = [];\n    let current = [...components];\n\n    // Only free enough to get under hard limit\n    const targetUsage = Math.floor(budget.total * 0.85); // Target 85%\n    const tokensToFree = budget.used - targetUsage;\n\n    let freedTokens = 0;\n\n    // Sort by priority\n    const sortedComponents = current\n      .filter((c) => c.compactable)\n      .sort((a, b) => b.priority - a.priority);\n\n    for (const component of sortedComponents) {\n      if (freedTokens >= tokensToFree) break; // Stop as soon as we have enough\n\n      const compactor = compactors.find((c) => c.canCompact(component));\n      if (!compactor) continue;\n\n      const beforeSize = this.estimateComponent(component, estimator);\n\n      // Minimal reduction: 70% of original\n      const targetSize = Math.floor(beforeSize * 0.7);\n\n      const compacted = await compactor.compact(component, targetSize);\n\n      const index = current.findIndex((c) => c.name === component.name);\n      current[index] = compacted;\n\n      const afterSize = this.estimateComponent(compacted, estimator);\n      const saved = beforeSize - afterSize;\n      freedTokens += saved;\n\n      log.push(`Lazy: ${compactor.name} compacted \"${component.name}\" by ${saved} tokens`);\n    }\n\n    return { components: current, log, tokensFreed: freedTokens };\n  }\n\n  private estimateComponent(component: IContextComponent, estimator: ITokenEstimator): number {\n    if (typeof component.content === 'string') {\n      return estimator.estimateTokens(component.content);\n    }\n    return estimator.estimateDataTokens(component.content);\n  }\n}\n","/**\n * Rolling Window Strategy\n *\n * - Maintains fixed-size window of recent context\n * - No compaction needed - just drops old items\n * - Very fast and predictable\n * - Good for: Real-time agents, streaming conversations\n */\n\nimport type {\n  IContextStrategy,\n  IContextComponent,\n  ContextBudget,\n  ContextManagerConfig,\n} from '../types.js';\n\nexport interface RollingWindowOptions {\n  /** Maximum number of messages to keep */\n  maxMessages?: number;\n  /** Maximum tokens per component */\n  maxTokensPerComponent?: number;\n}\n\nexport class RollingWindowStrategy implements IContextStrategy {\n  readonly name = 'rolling-window';\n\n  constructor(private options: RollingWindowOptions = {}) {}\n\n  shouldCompact(_budget: ContextBudget, _config: ContextManagerConfig): boolean {\n    // Never compact - we handle it in prepareComponents\n    return false;\n  }\n\n  async prepareComponents(components: IContextComponent[]): Promise<IContextComponent[]> {\n    return components.map((component) => {\n      // Apply rolling window to array components (e.g., conversation history)\n      if (Array.isArray(component.content)) {\n        const maxMessages = this.options.maxMessages ?? 20;\n        if (component.content.length > maxMessages) {\n          return {\n            ...component,\n            content: component.content.slice(-maxMessages),\n            metadata: {\n              ...component.metadata,\n              windowed: true,\n              originalLength: component.content.length,\n              keptLength: maxMessages,\n            },\n          };\n        }\n      }\n\n      return component;\n    });\n  }\n\n  async compact(): Promise<{ components: IContextComponent[]; log: string[]; tokensFreed: number }> {\n    // Should never be called since shouldCompact returns false\n    return { components: [], log: [], tokensFreed: 0 };\n  }\n}\n","/**\n * Adaptive Strategy\n *\n * - Learns from usage patterns\n * - Adjusts thresholds based on observed behavior\n * - Switches between strategies dynamically\n * - Good for: Production systems, varied workloads\n */\n\nimport type {\n  IContextStrategy,\n  IContextComponent,\n  ContextBudget,\n  ContextManagerConfig,\n  IContextCompactor,\n  ITokenEstimator,\n} from '../types.js';\nimport { ProactiveCompactionStrategy } from './ProactiveStrategy.js';\nimport { AggressiveCompactionStrategy } from './AggressiveStrategy.js';\nimport { LazyCompactionStrategy } from './LazyStrategy.js';\n\nexport interface AdaptiveStrategyOptions {\n  /** Number of compactions to learn from (default: 10) */\n  learningWindow?: number;\n  /** Compactions per minute threshold to switch to aggressive (default: 5) */\n  switchThreshold?: number;\n}\n\nexport class AdaptiveStrategy implements IContextStrategy {\n  readonly name = 'adaptive';\n\n  private currentStrategy: IContextStrategy;\n  private metrics = {\n    avgUtilization: 0,\n    compactionFrequency: 0,\n    lastCompactions: [] as number[],\n  };\n\n  constructor(private options: AdaptiveStrategyOptions = {}) {\n    // Start with proactive\n    this.currentStrategy = new ProactiveCompactionStrategy();\n  }\n\n  shouldCompact(budget: ContextBudget, config: ContextManagerConfig): boolean {\n    // Update metrics\n    this.updateMetrics(budget);\n\n    // Decide if we should switch strategies\n    this.maybeAdapt();\n\n    // Delegate to current strategy\n    return this.currentStrategy.shouldCompact(budget, config);\n  }\n\n  async compact(\n    components: IContextComponent[],\n    budget: ContextBudget,\n    compactors: IContextCompactor[],\n    estimator: ITokenEstimator\n  ): Promise<{ components: IContextComponent[]; log: string[]; tokensFreed: number }> {\n    const result = await this.currentStrategy.compact(components, budget, compactors, estimator);\n\n    // Track compaction\n    this.metrics.lastCompactions.push(Date.now());\n    const window = this.options.learningWindow ?? 10;\n    if (this.metrics.lastCompactions.length > window) {\n      this.metrics.lastCompactions.shift();\n    }\n\n    return {\n      ...result,\n      log: [`[Adaptive: using ${this.currentStrategy.name}]`, ...result.log],\n    };\n  }\n\n  private updateMetrics(budget: ContextBudget): void {\n    // Track average utilization using exponential moving average\n    const alpha = 0.1; // EMA factor\n    this.metrics.avgUtilization =\n      alpha * budget.utilizationPercent + (1 - alpha) * this.metrics.avgUtilization;\n  }\n\n  private maybeAdapt(): void {\n    const now = Date.now();\n\n    // Calculate compaction frequency (compactions per minute)\n    if (this.metrics.lastCompactions.length >= 2) {\n      const firstCompaction = this.metrics.lastCompactions[0];\n      if (firstCompaction !== undefined) {\n        const timeSpan = now - firstCompaction;\n        this.metrics.compactionFrequency =\n          (this.metrics.lastCompactions.length / timeSpan) * 60000; // per minute\n      }\n    }\n\n    // Adapt based on patterns\n    const threshold = this.options.switchThreshold ?? 5;\n\n    if (this.metrics.compactionFrequency > threshold) {\n      // Too frequent - switch to aggressive\n      if (this.currentStrategy.name !== 'aggressive') {\n        this.currentStrategy = new AggressiveCompactionStrategy();\n      }\n    } else if (this.metrics.compactionFrequency < 0.5 && this.metrics.avgUtilization < 70) {\n      // Rare compactions and low utilization - switch to lazy\n      if (this.currentStrategy.name !== 'lazy') {\n        this.currentStrategy = new LazyCompactionStrategy();\n      }\n    } else {\n      // Normal - use proactive\n      if (this.currentStrategy.name !== 'proactive') {\n        this.currentStrategy = new ProactiveCompactionStrategy();\n      }\n    }\n  }\n\n  getMetrics() {\n    return {\n      ...this.metrics,\n      currentStrategy: this.currentStrategy.name,\n    };\n  }\n}\n","/**\n * Context management strategies\n */\n\nimport type { IContextStrategy } from '../types.js';\nimport { ProactiveCompactionStrategy } from './ProactiveStrategy.js';\nimport { AggressiveCompactionStrategy } from './AggressiveStrategy.js';\nimport { LazyCompactionStrategy } from './LazyStrategy.js';\nimport { RollingWindowStrategy } from './RollingWindowStrategy.js';\nimport { AdaptiveStrategy } from './AdaptiveStrategy.js';\n\n/**\n * Strategy factory\n */\nexport function createStrategy(\n  name: string,\n  options: Record<string, unknown> = {}\n): IContextStrategy {\n  switch (name) {\n    case 'proactive':\n      return new ProactiveCompactionStrategy();\n    case 'aggressive':\n      return new AggressiveCompactionStrategy(options);\n    case 'lazy':\n      return new LazyCompactionStrategy();\n    case 'rolling-window':\n      return new RollingWindowStrategy(options);\n    case 'adaptive':\n      return new AdaptiveStrategy(options);\n    default:\n      throw new Error(`Unknown context strategy: ${name}`);\n  }\n}\n\nexport {\n  ProactiveCompactionStrategy,\n  AggressiveCompactionStrategy,\n  LazyCompactionStrategy,\n  RollingWindowStrategy,\n  AdaptiveStrategy,\n};\n","/**\n * ContextManager - Universal context management with strategy support\n */\n\nimport EventEmitter from 'eventemitter3';\nimport type {\n  IContextProvider,\n  ITokenEstimator,\n  IContextCompactor,\n  IContextStrategy,\n  ContextManagerConfig,\n  ContextBudget,\n  PreparedContext,\n  IContextComponent,\n} from './types.js';\nimport { DEFAULT_CONTEXT_CONFIG } from './types.js';\nimport { createStrategy as createStrategyFn } from './strategies/index.js';\n\n/**\n * Context manager events\n */\nexport interface ContextManagerEvents {\n  compacting: { reason: string; currentBudget: ContextBudget; strategy: string };\n  compacted: { log: string[]; newBudget: ContextBudget; tokensFreed: number };\n  budget_warning: { budget: ContextBudget };\n  budget_critical: { budget: ContextBudget };\n  strategy_switched: { from: string; to: string; reason: string };\n}\n\n/**\n * Universal Context Manager\n *\n * Works with any agent type through the IContextProvider interface.\n * Supports multiple compaction strategies that can be switched at runtime.\n */\nexport class ContextManager extends EventEmitter<ContextManagerEvents> {\n  private config: ContextManagerConfig;\n  private provider: IContextProvider;\n  private estimator: ITokenEstimator;\n  private compactors: IContextCompactor[];\n  private strategy: IContextStrategy;\n  private lastBudget?: ContextBudget;\n\n  constructor(\n    provider: IContextProvider,\n    config: Partial<ContextManagerConfig> = {},\n    compactors: IContextCompactor[] = [],\n    estimator?: ITokenEstimator,\n    strategy?: IContextStrategy\n  ) {\n    super();\n    this.provider = provider;\n    this.config = { ...DEFAULT_CONTEXT_CONFIG, ...config };\n    this.compactors = compactors.sort((a, b) => a.priority - b.priority);\n\n    // Create or use provided estimator\n    if (estimator) {\n      this.estimator = estimator;\n    } else if (typeof this.config.estimator === 'string') {\n      // Import and create estimator dynamically\n      this.estimator = this.createEstimator(this.config.estimator);\n    } else {\n      this.estimator = this.config.estimator;\n    }\n\n    // Create or use provided strategy\n    if (strategy) {\n      this.strategy = strategy;\n    } else {\n      this.strategy = this.createStrategy(this.config.strategy || 'proactive');\n    }\n  }\n\n  /**\n   * Prepare context for LLM call\n   * Returns prepared components, automatically compacting if needed\n   */\n  async prepare(): Promise<PreparedContext> {\n    // Get components from provider\n    let components = await this.provider.getComponents();\n\n    // Let strategy pre-process if needed\n    if (this.strategy.prepareComponents) {\n      components = await this.strategy.prepareComponents(components);\n    }\n\n    // Calculate budget\n    let budget = this.calculateBudget(components);\n    this.lastBudget = budget;\n\n    // Emit warnings\n    if (budget.status === 'warning') {\n      this.emit('budget_warning', { budget });\n    } else if (budget.status === 'critical') {\n      this.emit('budget_critical', { budget });\n    }\n\n    // Check if compaction needed (strategy decides)\n    const needsCompaction =\n      this.config.autoCompact && this.strategy.shouldCompact(budget, this.config);\n\n    if (needsCompaction) {\n      return await this.compactWithStrategy(components, budget);\n    }\n\n    return {\n      components,\n      budget,\n      compacted: false,\n    };\n  }\n\n  /**\n   * Compact using the current strategy\n   */\n  private async compactWithStrategy(\n    components: IContextComponent[],\n    budget: ContextBudget\n  ): Promise<PreparedContext> {\n    this.emit('compacting', {\n      reason: `Context at ${budget.utilizationPercent.toFixed(1)}%`,\n      currentBudget: budget,\n      strategy: this.strategy.name,\n    });\n\n    // Let strategy handle compaction\n    const result = await this.strategy.compact(components, budget, this.compactors, this.estimator);\n\n    // Post-process if strategy needs it\n    let finalComponents = result.components;\n    if (this.strategy.postProcess) {\n      finalComponents = await this.strategy.postProcess(result.components, budget);\n    }\n\n    // Recalculate budget\n    const newBudget = this.calculateBudget(finalComponents);\n\n    // Check if compaction was sufficient\n    if (newBudget.status === 'critical') {\n      throw new Error(\n        `Cannot fit context within limits after compaction (strategy: ${this.strategy.name}). ` +\n          `Used: ${newBudget.used}, Limit: ${budget.total - budget.reserved}`\n      );\n    }\n\n    this.emit('compacted', {\n      log: result.log,\n      newBudget,\n      tokensFreed: result.tokensFreed,\n    });\n\n    // Apply compacted components back to provider\n    await this.provider.applyCompactedComponents(finalComponents);\n\n    return {\n      components: finalComponents,\n      budget: newBudget,\n      compacted: true,\n      compactionLog: result.log,\n    };\n  }\n\n  /**\n   * Calculate budget for components\n   */\n  private calculateBudget(components: IContextComponent[]): ContextBudget {\n    const breakdown: Record<string, number> = {};\n    let used = 0;\n\n    for (const component of components) {\n      const tokens = this.estimateComponent(component);\n      breakdown[component.name] = tokens;\n      used += tokens;\n    }\n\n    const total = this.provider.getMaxContextSize();\n    const reserved = Math.floor(total * this.config.responseReserve);\n    const available = total - reserved - used;\n    const utilizationRatio = (used + reserved) / total;\n    const utilizationPercent = (used / (total - reserved)) * 100;\n\n    let status: 'ok' | 'warning' | 'critical';\n    if (utilizationRatio >= this.config.hardLimit) {\n      status = 'critical';\n    } else if (utilizationRatio >= this.config.compactionThreshold) {\n      status = 'warning';\n    } else {\n      status = 'ok';\n    }\n\n    return {\n      total,\n      reserved,\n      used,\n      available,\n      utilizationPercent,\n      status,\n      breakdown,\n    };\n  }\n\n  /**\n   * Estimate tokens for a component\n   */\n  private estimateComponent(component: IContextComponent): number {\n    if (typeof component.content === 'string') {\n      return this.estimator.estimateTokens(component.content);\n    }\n    return this.estimator.estimateDataTokens(component.content);\n  }\n\n  /**\n   * Switch to a different strategy at runtime\n   */\n  setStrategy(\n    strategy: 'proactive' | 'aggressive' | 'lazy' | 'rolling-window' | 'adaptive' | IContextStrategy\n  ): void {\n    const oldStrategy = this.strategy.name;\n    this.strategy = typeof strategy === 'string' ? this.createStrategy(strategy) : strategy;\n\n    this.emit('strategy_switched', {\n      from: oldStrategy,\n      to: this.strategy.name,\n      reason: 'manual',\n    });\n  }\n\n  /**\n   * Get current strategy\n   */\n  getStrategy(): IContextStrategy {\n    return this.strategy;\n  }\n\n  /**\n   * Get strategy metrics\n   */\n  getStrategyMetrics(): Record<string, unknown> {\n    return this.strategy.getMetrics?.() ?? {};\n  }\n\n  /**\n   * Get current budget\n   */\n  getCurrentBudget(): ContextBudget | null {\n    return this.lastBudget ?? null;\n  }\n\n  /**\n   * Get configuration\n   */\n  getConfig(): ContextManagerConfig {\n    return { ...this.config };\n  }\n\n  /**\n   * Update configuration\n   */\n  updateConfig(updates: Partial<ContextManagerConfig>): void {\n    this.config = { ...this.config, ...updates };\n  }\n\n  /**\n   * Add compactor\n   */\n  addCompactor(compactor: IContextCompactor): void {\n    this.compactors.push(compactor);\n    this.compactors.sort((a, b) => a.priority - b.priority);\n  }\n\n  /**\n   * Get all compactors\n   */\n  getCompactors(): IContextCompactor[] {\n    return [...this.compactors];\n  }\n\n  /**\n   * Create estimator from name\n   */\n  private createEstimator(_name: string): ITokenEstimator {\n    // For now, just return approximate estimator\n    // We can enhance this later if needed\n    return {\n      estimateTokens: (text: string) => {\n        if (!text || text.length === 0) return 0;\n        return Math.ceil(text.length / 4);\n      },\n      estimateDataTokens: (data: unknown) => {\n        const serialized = JSON.stringify(data);\n        return Math.ceil(serialized.length / 4);\n      },\n    };\n  }\n\n  /**\n   * Create strategy from name or config\n   */\n  private createStrategy(strategy: string | IContextStrategy): IContextStrategy {\n    if (typeof strategy !== 'string') {\n      return strategy;\n    }\n\n    // Use imported factory function\n    return createStrategyFn(strategy, this.config.strategyOptions || {});\n  }\n}\n","/**\n * Context provider for TaskAgent\n */\n\nimport type { IContextProvider, IContextComponent } from '../../../core/context/types.js';\nimport type { Plan } from '../../../domain/entities/Task.js';\nimport type { WorkingMemory } from '../../../capabilities/taskAgent/WorkingMemory.js';\nimport type { HistoryManager } from '../../../capabilities/taskAgent/HistoryManager.js';\nimport { getModelInfo } from '../../../domain/entities/Model.js';\n\nexport interface TaskAgentContextProviderConfig {\n  model: string;\n  instructions?: string;\n  plan: Plan;\n  memory: WorkingMemory;\n  historyManager: HistoryManager;\n  currentInput?: string;\n}\n\n/**\n * Context provider for TaskAgent\n */\nexport class TaskAgentContextProvider implements IContextProvider {\n  private config: TaskAgentContextProviderConfig;\n\n  constructor(config: TaskAgentContextProviderConfig) {\n    this.config = config;\n  }\n\n  async getComponents(): Promise<IContextComponent[]> {\n    const components: IContextComponent[] = [];\n\n    // System prompt (never compact)\n    components.push({\n      name: 'system_prompt',\n      content: this.buildSystemPrompt(),\n      priority: 0,\n      compactable: false,\n    });\n\n    // Instructions (never compact)\n    if (this.config.instructions) {\n      components.push({\n        name: 'instructions',\n        content: this.config.instructions,\n        priority: 0,\n        compactable: false,\n      });\n    }\n\n    // Plan (never compact)\n    components.push({\n      name: 'plan',\n      content: this.serializePlan(this.config.plan),\n      priority: 1,\n      compactable: false,\n    });\n\n    // Memory index (can evict)\n    const memoryIndex = await this.config.memory.formatIndex();\n    components.push({\n      name: 'memory_index',\n      content: memoryIndex,\n      priority: 8,\n      compactable: true,\n      metadata: {\n        strategy: 'evict',\n        evict: async (count: number) => {\n          await this.config.memory.evictLRU(count);\n        },\n        getUpdatedContent: async () => {\n          return await this.config.memory.formatIndex();\n        },\n      },\n    });\n\n    // Conversation history (can truncate)\n    const messages = this.config.historyManager.getRecentMessages();\n    components.push({\n      name: 'conversation_history',\n      content: messages.map((m) => ({\n        role: m.role,\n        content: m.content,\n      })),\n      priority: 6,\n      compactable: true,\n      metadata: {\n        strategy: 'truncate',\n        truncatable: true,\n      },\n    });\n\n    // Tool outputs from history (highest priority to compact)\n    const toolOutputs = this.extractToolOutputs(messages);\n    if (toolOutputs.length > 0) {\n      components.push({\n        name: 'tool_outputs',\n        content: toolOutputs,\n        priority: 10,\n        compactable: true,\n        metadata: {\n          strategy: 'truncate',\n          truncatable: true,\n          maxTokens: 4000,\n        },\n      });\n    }\n\n    // Current input (never compact)\n    if (this.config.currentInput) {\n      components.push({\n        name: 'current_input',\n        content: this.config.currentInput,\n        priority: 0,\n        compactable: false,\n      });\n    }\n\n    return components;\n  }\n\n  async applyCompactedComponents(components: IContextComponent[]): Promise<void> {\n    // Update conversation history if it was compacted\n    const historyComponent = components.find((c) => c.name === 'conversation_history');\n    if (historyComponent && Array.isArray(historyComponent.content)) {\n      // The history manager will be updated through the eviction callbacks\n      // No need to do anything here as compaction already happened\n    }\n\n    // Memory eviction already happened through the callback\n  }\n\n  getMaxContextSize(): number {\n    const modelInfo = getModelInfo(this.config.model);\n    return modelInfo?.features.input.tokens ?? 128000;\n  }\n\n  /**\n   * Update configuration (e.g., when task changes)\n   */\n  updateConfig(updates: Partial<TaskAgentContextProviderConfig>): void {\n    this.config = { ...this.config, ...updates };\n  }\n\n  /**\n   * Build system prompt for TaskAgent\n   */\n  private buildSystemPrompt(): string {\n    return `You are an autonomous task-based agent executing a plan.\n\nYour capabilities:\n- Access to working memory (use memory_store, memory_retrieve, memory_delete tools)\n- Tool execution for completing tasks\n- Context awareness (use context_inspect, context_breakdown tools)\n\nGuidelines:\n- Complete each task as specified in the plan\n- Store important information in memory for later tasks\n- Use tools efficiently\n- Be concise but thorough\n- Monitor your context usage`;\n  }\n\n  /**\n   * Serialize plan for context\n   */\n  private serializePlan(plan: Plan): string {\n    return `## Current Plan\n\n**Goal**: ${plan.goal}\n\n**Tasks**:\n${plan.tasks\n  .map((t, i) => {\n    const status = t.status || 'pending';\n    const deps = t.dependsOn && t.dependsOn.length > 0 ? ` (depends on: ${t.dependsOn.join(', ')})` : '';\n    return `${i + 1}. [${status}] ${t.name}: ${t.description}${deps}`;\n  })\n  .join('\\n')}`;\n  }\n\n  /**\n   * Extract tool outputs from conversation history\n   */\n  private extractToolOutputs(messages: any[]): any[] {\n    const toolOutputs: any[] = [];\n\n    for (const msg of messages) {\n      // Look for tool call results in the message\n      if (msg.role === 'assistant' && msg.toolCalls) {\n        for (const toolCall of msg.toolCalls) {\n          if (toolCall.result) {\n            toolOutputs.push({\n              tool: toolCall.name,\n              output: toolCall.result,\n            });\n          }\n        }\n      }\n    }\n\n    return toolOutputs;\n  }\n}\n","/**\n * Truncate Compactor\n *\n * Truncates content to target size by:\n * - For strings: Cut to character limit\n * - For arrays: Keep most recent items\n */\n\nimport type { IContextCompactor, IContextComponent, ITokenEstimator } from '../../../core/context/types.js';\n\nexport class TruncateCompactor implements IContextCompactor {\n  readonly name = 'truncate';\n  readonly priority = 10;\n\n  constructor(private estimator: ITokenEstimator) {}\n\n  canCompact(component: IContextComponent): boolean {\n    return (\n      component.compactable &&\n      (component.metadata?.strategy === 'truncate' || component.metadata?.truncatable === true)\n    );\n  }\n\n  async compact(component: IContextComponent, targetTokens: number): Promise<IContextComponent> {\n    if (typeof component.content === 'string') {\n      return this.truncateString(component, targetTokens);\n    }\n\n    if (Array.isArray(component.content)) {\n      return this.truncateArray(component, targetTokens);\n    }\n\n    // Can't truncate other types\n    return component;\n  }\n\n  estimateSavings(component: IContextComponent): number {\n    const current = this.estimator.estimateDataTokens(component.content);\n    return Math.floor(current * 0.5); // Estimate 50% reduction\n  }\n\n  private truncateString(component: IContextComponent, targetTokens: number): IContextComponent {\n    const content = component.content as string;\n    const currentTokens = this.estimator.estimateTokens(content);\n\n    if (currentTokens <= targetTokens) {\n      return component;\n    }\n\n    // Calculate character limit\n    const targetChars = targetTokens * 4; // ~4 chars per token\n    const truncated = content.substring(0, targetChars) + '\\n[truncated...]';\n\n    return {\n      ...component,\n      content: truncated,\n      metadata: {\n        ...component.metadata,\n        truncated: true,\n        originalLength: content.length,\n        truncatedLength: truncated.length,\n      },\n    };\n  }\n\n  private truncateArray(component: IContextComponent, targetTokens: number): IContextComponent {\n    const content = component.content as unknown[];\n    let tokens = 0;\n    const kept: unknown[] = [];\n\n    // Keep most recent items that fit within target\n    for (let i = content.length - 1; i >= 0; i--) {\n      const item = content[i];\n      const itemTokens = this.estimator.estimateDataTokens(item);\n\n      if (tokens + itemTokens > targetTokens && kept.length > 0) {\n        break;\n      }\n\n      kept.unshift(item);\n      tokens += itemTokens;\n    }\n\n    const droppedLength = content.length - kept.length;\n\n    // Only mark as truncated if we actually dropped items\n    if (droppedLength === 0) {\n      return component;\n    }\n\n    return {\n      ...component,\n      content: kept,\n      metadata: {\n        ...component.metadata,\n        truncated: true,\n        originalLength: content.length,\n        keptLength: kept.length,\n        droppedLength,\n      },\n    };\n  }\n}\n","/**\n * Summarize Compactor (Placeholder)\n *\n * Uses LLM to create summaries of conversation history\n * TODO: Implement when needed\n */\n\nimport type { IContextCompactor, IContextComponent, ITokenEstimator } from '../../../core/context/types.js';\n\nexport class SummarizeCompactor implements IContextCompactor {\n  readonly name = 'summarize';\n  readonly priority = 5;\n\n  constructor(private estimator: ITokenEstimator) {}\n\n  canCompact(component: IContextComponent): boolean {\n    return (\n      component.compactable &&\n      component.metadata?.strategy === 'summarize'\n    );\n  }\n\n  async compact(component: IContextComponent, _targetTokens: number): Promise<IContextComponent> {\n    // TODO: Implement LLM-based summarization\n    // For now, just return the component unchanged\n    console.warn('SummarizeCompactor not yet implemented - returning component unchanged');\n    return component;\n  }\n\n  estimateSavings(component: IContextComponent): number {\n    const current = this.estimator.estimateDataTokens(component.content);\n    return Math.floor(current * 0.8); // Summaries typically save 80%\n  }\n}\n","/**\n * Memory Eviction Compactor\n *\n * Evicts LRU entries from memory index\n * Works with memory components that have eviction metadata\n */\n\nimport type { IContextCompactor, IContextComponent, ITokenEstimator } from '../../../core/context/types.js';\n\nexport class MemoryEvictionCompactor implements IContextCompactor {\n  readonly name = 'memory-eviction';\n  readonly priority = 8;\n\n  constructor(private estimator: ITokenEstimator) {}\n\n  canCompact(component: IContextComponent): boolean {\n    return (\n      component.compactable &&\n      (component.metadata?.strategy === 'evict' || component.name === 'memory_index')\n    );\n  }\n\n  async compact(component: IContextComponent, targetTokens: number): Promise<IContextComponent> {\n    // If memory component has eviction callback, use it\n    if (component.metadata?.evict && typeof component.metadata.evict === 'function') {\n      const currentTokens = this.estimator.estimateDataTokens(component.content);\n      const tokensToFree = Math.max(0, currentTokens - targetTokens);\n\n      // Estimate how many entries to evict\n      const avgEntrySize = component.metadata.avgEntrySize as number || 100;\n      const entriesToEvict = Math.ceil(tokensToFree / avgEntrySize);\n\n      if (entriesToEvict > 0) {\n        // Call eviction callback\n        await (component.metadata.evict as (count: number) => Promise<void>)(entriesToEvict);\n\n        // Get updated content\n        if (component.metadata.getUpdatedContent && typeof component.metadata.getUpdatedContent === 'function') {\n          const updatedContent = await (component.metadata.getUpdatedContent as () => Promise<unknown>)();\n\n          return {\n            ...component,\n            content: updatedContent,\n            metadata: {\n              ...component.metadata,\n              evicted: true,\n              evictedCount: entriesToEvict,\n            },\n          };\n        }\n      }\n    }\n\n    // If no eviction mechanism, just return unchanged\n    return component;\n  }\n\n  estimateSavings(component: IContextComponent): number {\n    // Estimate based on average entry size\n    const avgEntrySize = component.metadata?.avgEntrySize as number || 100;\n    return avgEntrySize * 2; // Conservative estimate: evict 2 entries\n  }\n}\n","/**\n * Approximate Token Estimator\n *\n * Uses simple heuristic: 1 token  4 characters\n * Fast and good enough for most use cases\n */\n\nimport type { ITokenEstimator } from '../../../core/context/types.js';\n\nexport class ApproximateTokenEstimator implements ITokenEstimator {\n  /**\n   * Estimate tokens for text using 4 chars per token heuristic\n   */\n  estimateTokens(text: string, _model?: string): number {\n    if (!text || text.length === 0) {\n      return 0;\n    }\n\n    // Approximate: 1 token  4 characters\n    return Math.ceil(text.length / 4);\n  }\n\n  /**\n   * Estimate tokens for structured data\n   */\n  estimateDataTokens(data: unknown, _model?: string): number {\n    if (data === null || data === undefined) {\n      return 1;\n    }\n\n    // Serialize and estimate\n    try {\n      const serialized = JSON.stringify(data);\n      return this.estimateTokens(serialized);\n    } catch {\n      // If serialization fails, return a conservative estimate\n      return 100;\n    }\n  }\n}\n","/**\n * Token estimators\n */\n\nimport type { ITokenEstimator } from '../../../core/context/types.js';\nimport { ApproximateTokenEstimator } from './ApproximateEstimator.js';\n\n/**\n * Create token estimator from name\n */\nexport function createEstimator(name: string): ITokenEstimator {\n  switch (name) {\n    case 'approximate':\n      return new ApproximateTokenEstimator();\n    case 'tiktoken':\n      // TODO: Implement tiktoken-based estimator when needed\n      throw new Error('Tiktoken estimator not yet implemented. Use \"approximate\" for now.');\n    default:\n      throw new Error(`Unknown token estimator: ${name}`);\n  }\n}\n\nexport { ApproximateTokenEstimator };\n","/**\n * @oneringai/agents - Unified AI agent library\n *\n * Connector-First Architecture: Simple, DRY, Powerful\n *\n * @example\n * ```typescript\n * import { Connector, Agent, Vendor } from '@oneringai/agents';\n *\n * // Create connector (can have multiple per vendor!)\n * Connector.create({\n *   name: 'openai-main',\n *   vendor: Vendor.OpenAI,\n *   auth: { type: 'api_key', apiKey: process.env.OPENAI_API_KEY! }\n * });\n *\n * // Create agent from connector\n * const agent = Agent.create({\n *   connector: 'openai-main',\n *   model: 'gpt-4',\n *   tools: [myTool]\n * });\n *\n * // Run the agent\n * const response = await agent.run('Hello!');\n * ```\n */\n\n// ============ Core API (Primary) ============\nexport { Connector, Agent, Vendor, VENDORS, isVendor, createProvider } from './core/index.js';\nexport type { AgentConfig, AgentSessionConfig } from './core/index.js';\n\n// Audio Capabilities\nexport { TextToSpeech, SpeechToText } from './core/index.js';\nexport type { TextToSpeechConfig, SpeechToTextConfig } from './core/index.js';\n\n// Image Capabilities\nexport { ImageGeneration } from './capabilities/images/index.js';\nexport type { ImageGenerationCreateOptions, SimpleGenerateOptions } from './capabilities/images/index.js';\nexport { createImageProvider } from './core/index.js';\n\n// Video Capabilities\nexport { VideoGeneration } from './capabilities/video/index.js';\nexport type {\n  VideoGenerationCreateOptions,\n  SimpleVideoGenerateOptions,\n} from './capabilities/video/index.js';\nexport { createVideoProvider } from './core/createVideoProvider.js';\n\n// Tool Management (Dynamic)\nexport { ToolManager } from './core/index.js';\nexport type {\n  ToolOptions,\n  ToolCondition,\n  ToolSelectionContext,\n  ToolRegistration,\n  ToolMetadata,\n  ToolManagerStats,\n  SerializedToolState,\n  ToolManagerEvent,\n} from './core/index.js';\n\n// Session Management (Persistence)\nexport { SessionManager, createEmptyHistory, createEmptyMemory, addHistoryEntry } from './core/index.js';\nexport type {\n  Session,\n  SessionMetadata,\n  SessionMetrics,\n  SessionFilter,\n  SessionSummary,\n  ISessionStorage,\n  SerializedHistory,\n  SerializedHistoryEntry,\n  SerializedMemory,\n  SerializedMemoryEntry,\n  SerializedPlan,\n  SessionManagerConfig,\n  SessionManagerEvent,\n} from './core/index.js';\n\n// ============ Task-Based Agents ============\nexport {\n  TaskAgent,\n  WorkingMemory,\n  IdempotencyCache,\n  HistoryManager,\n  ExternalDependencyHandler,\n  PlanExecutor,\n  CheckpointManager,\n  createMemoryTools,\n} from './capabilities/taskAgent/index.js';\nexport type {\n  TaskAgentConfig,\n  TaskAgentSessionConfig,\n  TaskAgentHooks,\n  AgentHandle,\n  PlanResult,\n  PlanUpdates,\n  TaskContext,\n  TaskResult,\n  ErrorContext,\n  WorkingMemoryEvents,\n  IdempotencyCacheConfig,\n  CacheStats,\n  HistoryManagerConfig,\n  ExternalDependencyEvents,\n  PlanExecutorConfig,\n  PlanExecutorEvents,\n  PlanExecutionResult,\n  CheckpointStrategy,\n} from './capabilities/taskAgent/index.js';\nexport { DEFAULT_IDEMPOTENCY_CONFIG, DEFAULT_HISTORY_CONFIG, DEFAULT_CHECKPOINT_STRATEGY } from './capabilities/taskAgent/index.js';\n\n// ============ Context Management (Universal) ============\nexport { ContextManager } from './core/context/index.js';\nexport type {\n  IContextComponent,\n  ContextBudget,\n  PreparedContext,\n  ContextManagerConfig,\n  IContextProvider,\n  ITokenEstimator,\n  IContextCompactor,\n  IContextStrategy,\n} from './core/context/types.js';\nexport { DEFAULT_CONTEXT_CONFIG } from './core/context/types.js';\n\n// Context Strategies\nexport {\n  ProactiveCompactionStrategy,\n  AggressiveCompactionStrategy,\n  LazyCompactionStrategy,\n  RollingWindowStrategy,\n  AdaptiveStrategy,\n  createStrategy,\n} from './core/context/strategies/index.js';\n\n// Context Infrastructure\nexport {\n  TaskAgentContextProvider,\n  TruncateCompactor,\n  SummarizeCompactor,\n  MemoryEvictionCompactor,\n  ApproximateTokenEstimator,\n  createEstimator,\n} from './infrastructure/context/index.js';\n\n// Task & Plan Entities\nexport type {\n  Task,\n  TaskInput,\n  TaskStatus,\n  TaskCondition,\n  TaskExecution,\n  ExternalDependency,\n  Plan,\n  PlanInput,\n  PlanStatus,\n  PlanConcurrency,\n} from './domain/entities/Task.js';\n\n// Memory Entities\nexport type {\n  MemoryEntry,\n  MemoryIndex,\n  MemoryIndexEntry,\n  MemoryScope,\n  WorkingMemoryConfig,\n} from './domain/entities/Memory.js';\nexport { DEFAULT_MEMORY_CONFIG } from './domain/entities/Memory.js';\n\n// Agent State\nexport type {\n  AgentState,\n  AgentStatus,\n  AgentConfig as TaskAgentStateConfig,\n  ConversationMessage,\n  AgentMetrics,\n} from './domain/entities/AgentState.js';\n\n// Storage Interfaces\nexport type { IMemoryStorage } from './domain/interfaces/IMemoryStorage.js';\nexport type { IPlanStorage } from './domain/interfaces/IPlanStorage.js';\nexport type { IAgentStateStorage } from './domain/interfaces/IAgentStateStorage.js';\nexport { createAgentStorage } from './infrastructure/storage/index.js';\nexport type { IAgentStorage } from './infrastructure/storage/InMemoryStorage.js';\nexport { InMemoryStorage, InMemoryPlanStorage, InMemoryAgentStateStorage } from './infrastructure/storage/index.js';\n\n// Session Storage Implementations\nexport { InMemorySessionStorage, FileSessionStorage } from './infrastructure/storage/index.js';\nexport type { FileSessionStorageConfig } from './infrastructure/storage/index.js';\n\n// Tool Context\nexport type { ToolContext as TaskToolContext, WorkingMemoryAccess } from './domain/interfaces/IToolContext.js';\n\n// ============ Domain Types ============\n\n// Content\nexport { ContentType } from './domain/entities/Content.js';\nexport type {\n  Content,\n  InputTextContent,\n  InputImageContent,\n  OutputTextContent,\n  ToolUseContent,\n  ToolResultContent,\n} from './domain/entities/Content.js';\n\n// Messages\nexport { MessageRole } from './domain/entities/Message.js';\nexport type {\n  Message,\n  InputItem,\n  OutputItem,\n  CompactionItem,\n  ReasoningItem,\n} from './domain/entities/Message.js';\n\n// Tools\nexport { ToolCallState } from './domain/entities/Tool.js';\nexport type {\n  Tool,\n  FunctionToolDefinition,\n  BuiltInTool,\n  ToolFunction,\n  ToolCall,\n  ToolResult,\n  ToolExecutionContext,\n  JSONSchema,\n} from './domain/entities/Tool.js';\n\n// Response\nexport type { LLMResponse, AgentResponse } from './domain/entities/Response.js';\n\n// Connector types\nexport type {\n  ConnectorConfig,\n  ConnectorAuth,\n  OAuthConnectorAuth,\n  APIKeyConnectorAuth,\n  JWTConnectorAuth,\n} from './domain/entities/Connector.js';\n\n// Model Registry\nexport type { ILLMDescription } from './domain/entities/Model.js';\nexport {\n  LLM_MODELS,\n  MODEL_REGISTRY,\n  getModelInfo,\n  getModelsByVendor,\n  getActiveModels,\n  calculateCost,\n} from './domain/entities/Model.js';\n\n// Audio Model Registries\nexport type { ITTSModelDescription, TTSModelCapabilities } from './domain/entities/TTSModel.js';\nexport type { ISTTModelDescription, STTModelCapabilities } from './domain/entities/STTModel.js';\nexport type { IVoiceInfo } from './domain/entities/SharedVoices.js';\nexport {\n  TTS_MODELS,\n  TTS_MODEL_REGISTRY,\n  getTTSModelInfo,\n  getTTSModelsByVendor,\n  getActiveTTSModels,\n  getTTSModelsWithFeature,\n  calculateTTSCost,\n} from './domain/entities/TTSModel.js';\nexport {\n  STT_MODELS,\n  STT_MODEL_REGISTRY,\n  getSTTModelInfo,\n  getSTTModelsByVendor,\n  getActiveSTTModels,\n  getSTTModelsWithFeature,\n  calculateSTTCost,\n} from './domain/entities/STTModel.js';\n\n// Image Model Registry\nexport type { IImageModelDescription, ImageModelCapabilities, ImageModelPricing } from './domain/entities/ImageModel.js';\nexport {\n  IMAGE_MODELS,\n  IMAGE_MODEL_REGISTRY,\n  getImageModelInfo,\n  getImageModelsByVendor,\n  getActiveImageModels,\n  getImageModelsWithFeature,\n  calculateImageCost,\n} from './domain/entities/ImageModel.js';\n\n// Video Model Registry\nexport type { IVideoModelDescription, VideoModelCapabilities, VideoModelPricing } from './domain/entities/VideoModel.js';\nexport {\n  VIDEO_MODELS,\n  VIDEO_MODEL_REGISTRY,\n  getVideoModelInfo,\n  getVideoModelsByVendor,\n  getActiveVideoModels,\n  getVideoModelsWithFeature,\n  getVideoModelsWithAudio,\n  calculateVideoCost,\n} from './domain/entities/VideoModel.js';\n\n// ============ Streaming ============\nexport { StreamEventType } from './domain/entities/StreamEvent.js';\nexport type {\n  StreamEvent,\n  ResponseCreatedEvent,\n  ResponseInProgressEvent,\n  OutputTextDeltaEvent,\n  OutputTextDoneEvent,\n  ToolCallStartEvent,\n  ToolCallArgumentsDeltaEvent,\n  ToolCallArgumentsDoneEvent,\n  ToolExecutionStartEvent,\n  ToolExecutionDoneEvent,\n  IterationCompleteEvent,\n  ResponseCompleteEvent,\n  ErrorEvent,\n} from './domain/entities/StreamEvent.js';\nexport {\n  isStreamEvent,\n  isOutputTextDelta,\n  isToolCallStart,\n  isToolCallArgumentsDelta,\n  isToolCallArgumentsDone,\n  isResponseComplete,\n  isErrorEvent,\n} from './domain/entities/StreamEvent.js';\nexport { StreamState } from './domain/entities/StreamState.js';\nexport { StreamHelpers } from './capabilities/agents/StreamHelpers.js';\n\n// ============ Hooks & Events (Enterprise) ============\nexport { ToolRegistry, ExecutionContext, HookManager } from './capabilities/agents/index.js';\nexport type {\n  AgenticLoopEvents,\n  AgenticLoopEventName,\n  HookConfig,\n  HookName,\n  Hook,\n  ModifyingHook,\n  BeforeToolContext,\n  AfterToolContext,\n  ApproveToolContext,\n  ToolModification,\n  ApprovalResult,\n  HistoryMode,\n  ExecutionMetrics,\n  AuditEntry,\n} from './capabilities/agents/index.js';\n\n// ============ Errors ============\nexport {\n  AIError,\n  ProviderNotFoundError,\n  ProviderAuthError,\n  ProviderRateLimitError,\n  ProviderContextLengthError,\n  ToolExecutionError,\n  ToolTimeoutError,\n  ToolNotFoundError,\n  ModelNotSupportedError,\n  InvalidConfigError,\n  InvalidToolArgumentsError,\n  ProviderError,\n} from './domain/errors/AIErrors.js';\n\n// ============ Interfaces (for extensibility) ============\nexport type { IProvider, ProviderCapabilities } from './domain/interfaces/IProvider.js';\nexport type { ITextProvider, TextGenerateOptions, ModelCapabilities } from './domain/interfaces/ITextProvider.js';\nexport type { IToolExecutor } from './domain/interfaces/IToolExecutor.js';\nexport type { IDisposable, IAsyncDisposable } from './domain/interfaces/IDisposable.js';\nexport { assertNotDestroyed } from './domain/interfaces/IDisposable.js';\n\n// Audio Interfaces\nexport type {\n  ITextToSpeechProvider,\n  ISpeechToTextProvider,\n  TTSOptions,\n  TTSResponse,\n  STTOptions,\n  STTResponse,\n  STTOutputFormat,\n  WordTimestamp,\n  SegmentTimestamp,\n} from './domain/interfaces/IAudioProvider.js';\n\n// Image Interfaces\nexport type {\n  IImageProvider,\n  ImageGenerateOptions,\n  ImageEditOptions,\n  ImageVariationOptions,\n  ImageResponse,\n} from './domain/interfaces/IImageProvider.js';\n\n// Video Interfaces\nexport type {\n  IVideoProvider,\n  VideoGenerateOptions,\n  VideoExtendOptions,\n  VideoResponse,\n  VideoJob,\n  VideoStatus,\n} from './domain/interfaces/IVideoProvider.js';\n\n// Base classes for custom providers\nexport { BaseProvider } from './infrastructure/providers/base/BaseProvider.js';\nexport { BaseTextProvider } from './infrastructure/providers/base/BaseTextProvider.js';\nexport { BaseMediaProvider } from './infrastructure/providers/base/BaseMediaProvider.js';\nexport { ProviderErrorMapper } from './infrastructure/providers/base/ProviderErrorMapper.js';\n\n// Shared types for multi-modal\nexport type {\n  AspectRatio,\n  QualityLevel,\n  AudioFormat,\n  OutputFormat,\n  ISourceLinks,\n  VendorOptionSchema,\n  IBaseModelDescription,\n} from './domain/types/SharedTypes.js';\n\n// ============ OAuth & Storage (for external APIs) ============\nexport { OAuthManager, MemoryStorage, FileStorage } from './connectors/index.js';\nexport { generateEncryptionKey, authenticatedFetch, createAuthenticatedFetch, generateWebAPITool } from './connectors/index.js';\nexport type { OAuthConfig, OAuthFlow, ITokenStorage, FileStorageConfig, StoredToken } from './connectors/index.js';\n\n// ConnectorConfig storage (persistent connector configs with encryption)\nexport {\n  ConnectorConfigStore,\n  MemoryConnectorStorage,\n  FileConnectorStorage,\n  CONNECTOR_CONFIG_VERSION,\n} from './connectors/index.js';\nexport type {\n  IConnectorConfigStorage,\n  StoredConnectorConfig,\n  FileConnectorStorageConfig,\n} from './connectors/index.js';\n\n// ============ Resilience & Observability (Phase 3) ============\nexport { CircuitBreaker, CircuitOpenError } from './infrastructure/resilience/index.js';\nexport type {\n  CircuitState,\n  CircuitBreakerConfig,\n  CircuitBreakerMetrics,\n  CircuitBreakerEvents,\n} from './infrastructure/resilience/index.js';\nexport { DEFAULT_CIRCUIT_BREAKER_CONFIG } from './infrastructure/resilience/index.js';\n\nexport {\n  calculateBackoff,\n  addJitter,\n  backoffWait,\n  backoffSequence,\n  retryWithBackoff,\n} from './infrastructure/resilience/index.js';\nexport type { BackoffConfig, BackoffStrategyType } from './infrastructure/resilience/index.js';\nexport { DEFAULT_BACKOFF_CONFIG } from './infrastructure/resilience/index.js';\n\nexport { FrameworkLogger, logger } from './infrastructure/observability/index.js';\nexport type { LogLevel, LoggerConfig, LogEntry } from './infrastructure/observability/index.js';\n\nexport {\n  NoOpMetrics,\n  ConsoleMetrics,\n  InMemoryMetrics,\n  createMetricsCollector,\n  metrics,\n  setMetricsCollector,\n} from './infrastructure/observability/index.js';\nexport type { MetricsCollector, MetricTags, MetricsCollectorType } from './infrastructure/observability/index.js';\n\n// ============ Utilities ============\nexport { MessageBuilder, createTextMessage, createMessageWithImages } from './utils/messageBuilder.js';\nexport { readClipboardImage, hasClipboardImage } from './utils/clipboardImage.js';\nexport type { ClipboardImageResult } from './utils/clipboardImage.js';\n\n// ============ Pre-built Tools ============\nexport * as tools from './tools/index.js';\nexport { createExecuteJavaScriptTool } from './tools/code/executeJavaScript.js';\n\n// ============ Built-in Agents ============\nexport { ProviderConfigAgent } from './agents/index.js';\nexport type { ConnectorConfigResult } from './agents/index.js';\n\n// ============ UniversalAgent (NEW) ============\nexport { UniversalAgent, ModeManager } from './capabilities/universalAgent/index.js';\nexport type { UniversalAgentEvents, ModeManagerEvents } from './capabilities/universalAgent/index.js';\nexport {\n  getMetaTools,\n  isMetaTool,\n  META_TOOL_NAMES,\n} from './capabilities/universalAgent/index.js';\nexport type {\n  UniversalAgentConfig,\n  UniversalAgentSessionConfig,\n  UniversalAgentPlanningConfig,\n  UniversalResponse,\n  UniversalEvent,\n  AgentMode,\n  TaskProgress,\n  IntentAnalysis,\n  PlanChange,\n  ExecutionResult,\n  ToolCallResult as UniversalToolCallResult,\n  ModeState,\n} from './capabilities/universalAgent/index.js';\n","/**\n * InMemorySessionStorage - In-memory session storage implementation\n *\n * Stores sessions in memory. Data is lost when process exits.\n * Useful for testing, development, and short-lived applications.\n */\n\nimport type {\n  ISessionStorage,\n  Session,\n  SessionFilter,\n  SessionSummary,\n} from '../../core/SessionManager.js';\n\nexport class InMemorySessionStorage implements ISessionStorage {\n  private sessions: Map<string, Session> = new Map();\n\n  async save(session: Session): Promise<void> {\n    // Deep clone to prevent mutation issues\n    this.sessions.set(session.id, JSON.parse(JSON.stringify(session)));\n  }\n\n  async load(sessionId: string): Promise<Session | null> {\n    const session = this.sessions.get(sessionId);\n    if (!session) return null;\n    // Return a deep clone\n    return JSON.parse(JSON.stringify(session));\n  }\n\n  async delete(sessionId: string): Promise<void> {\n    this.sessions.delete(sessionId);\n  }\n\n  async exists(sessionId: string): Promise<boolean> {\n    return this.sessions.has(sessionId);\n  }\n\n  async list(filter?: SessionFilter): Promise<SessionSummary[]> {\n    let sessions = Array.from(this.sessions.values());\n\n    // Apply filters\n    if (filter) {\n      sessions = this.applyFilter(sessions, filter);\n    }\n\n    // Sort by last active (most recent first)\n    sessions.sort(\n      (a, b) =>\n        new Date(b.lastActiveAt).getTime() - new Date(a.lastActiveAt).getTime()\n    );\n\n    // Apply pagination\n    if (filter?.offset) {\n      sessions = sessions.slice(filter.offset);\n    }\n    if (filter?.limit) {\n      sessions = sessions.slice(0, filter.limit);\n    }\n\n    // Convert to summaries\n    return sessions.map(this.toSummary);\n  }\n\n  async search(query: string, filter?: SessionFilter): Promise<SessionSummary[]> {\n    const lowerQuery = query.toLowerCase();\n    let sessions = Array.from(this.sessions.values());\n\n    // Apply text search\n    sessions = sessions.filter((s) => {\n      const titleMatch = s.metadata.title?.toLowerCase().includes(lowerQuery);\n      const tagMatch = s.metadata.tags?.some((t) =>\n        t.toLowerCase().includes(lowerQuery)\n      );\n      const idMatch = s.id.toLowerCase().includes(lowerQuery);\n      return titleMatch || tagMatch || idMatch;\n    });\n\n    // Apply additional filters\n    if (filter) {\n      sessions = this.applyFilter(sessions, filter);\n    }\n\n    // Sort by relevance (title match first) then by date\n    sessions.sort((a, b) => {\n      const aTitle = a.metadata.title?.toLowerCase().includes(lowerQuery) ? 1 : 0;\n      const bTitle = b.metadata.title?.toLowerCase().includes(lowerQuery) ? 1 : 0;\n      if (aTitle !== bTitle) return bTitle - aTitle;\n      return (\n        new Date(b.lastActiveAt).getTime() - new Date(a.lastActiveAt).getTime()\n      );\n    });\n\n    // Apply pagination\n    if (filter?.offset) {\n      sessions = sessions.slice(filter.offset);\n    }\n    if (filter?.limit) {\n      sessions = sessions.slice(0, filter.limit);\n    }\n\n    return sessions.map(this.toSummary);\n  }\n\n  /**\n   * Clear all sessions (useful for testing)\n   */\n  clear(): void {\n    this.sessions.clear();\n  }\n\n  /**\n   * Get count of sessions\n   */\n  get size(): number {\n    return this.sessions.size;\n  }\n\n  // ==========================================================================\n  // Private Helpers\n  // ==========================================================================\n\n  private applyFilter(sessions: Session[], filter: SessionFilter): Session[] {\n    return sessions.filter((s) => {\n      if (filter.agentType && s.agentType !== filter.agentType) {\n        return false;\n      }\n\n      if (filter.userId && s.metadata.userId !== filter.userId) {\n        return false;\n      }\n\n      if (filter.tags && filter.tags.length > 0) {\n        const sessionTags = s.metadata.tags ?? [];\n        const hasMatchingTag = filter.tags.some((t) => sessionTags.includes(t));\n        if (!hasMatchingTag) return false;\n      }\n\n      if (filter.createdAfter && new Date(s.createdAt) < filter.createdAfter) {\n        return false;\n      }\n\n      if (filter.createdBefore && new Date(s.createdAt) > filter.createdBefore) {\n        return false;\n      }\n\n      if (filter.activeAfter && new Date(s.lastActiveAt) < filter.activeAfter) {\n        return false;\n      }\n\n      if (filter.activeBefore && new Date(s.lastActiveAt) > filter.activeBefore) {\n        return false;\n      }\n\n      return true;\n    });\n  }\n\n  private toSummary(session: Session): SessionSummary {\n    return {\n      id: session.id,\n      agentType: session.agentType,\n      createdAt: new Date(session.createdAt),\n      lastActiveAt: new Date(session.lastActiveAt),\n      metadata: session.metadata,\n      messageCount: session.history.entries.length,\n    };\n  }\n}\n","/**\n * FileSessionStorage - File-based session storage implementation\n *\n * Stores sessions as JSON files in a directory.\n * Each session is stored in its own file: {sessionId}.json\n *\n * Features:\n * - Persistent storage across process restarts\n * - Human-readable JSON format\n * - Optional compression for large sessions\n * - Index file for fast listing\n */\n\nimport { promises as fs } from 'fs';\nimport { join } from 'path';\nimport type {\n  ISessionStorage,\n  Session,\n  SessionFilter,\n  SessionSummary,\n} from '../../core/SessionManager.js';\n\nexport interface FileSessionStorageConfig {\n  /** Directory to store session files */\n  directory: string;\n  /** Pretty-print JSON (default: false for production) */\n  prettyPrint?: boolean;\n  /** File extension (default: .json) */\n  extension?: string;\n}\n\ninterface SessionIndex {\n  version: number;\n  sessions: SessionIndexEntry[];\n  lastUpdated: string;\n}\n\ninterface SessionIndexEntry {\n  id: string;\n  agentType: string;\n  createdAt: string;\n  lastActiveAt: string;\n  metadata: {\n    title?: string;\n    userId?: string;\n    tags?: string[];\n  };\n  messageCount: number;\n}\n\nexport class FileSessionStorage implements ISessionStorage {\n  private directory: string;\n  private prettyPrint: boolean;\n  private extension: string;\n  private indexPath: string;\n  private index: SessionIndex | null = null;\n\n  constructor(config: FileSessionStorageConfig) {\n    this.directory = config.directory;\n    this.prettyPrint = config.prettyPrint ?? false;\n    this.extension = config.extension ?? '.json';\n    this.indexPath = join(this.directory, '_index.json');\n  }\n\n  async save(session: Session): Promise<void> {\n    await this.ensureDirectory();\n\n    const filePath = this.getFilePath(session.id);\n    const data = this.prettyPrint\n      ? JSON.stringify(session, null, 2)\n      : JSON.stringify(session);\n\n    await fs.writeFile(filePath, data, 'utf-8');\n\n    // Update index\n    await this.updateIndex(session);\n  }\n\n  async load(sessionId: string): Promise<Session | null> {\n    const filePath = this.getFilePath(sessionId);\n\n    try {\n      const data = await fs.readFile(filePath, 'utf-8');\n      return JSON.parse(data) as Session;\n    } catch (error: any) {\n      if (error.code === 'ENOENT') {\n        return null;\n      }\n      // Handle corrupted JSON files gracefully\n      if (error instanceof SyntaxError) {\n        return null;\n      }\n      throw error;\n    }\n  }\n\n  async delete(sessionId: string): Promise<void> {\n    const filePath = this.getFilePath(sessionId);\n\n    try {\n      await fs.unlink(filePath);\n    } catch (error: any) {\n      if (error.code !== 'ENOENT') {\n        throw error;\n      }\n    }\n\n    // Remove from index\n    await this.removeFromIndex(sessionId);\n  }\n\n  async exists(sessionId: string): Promise<boolean> {\n    const filePath = this.getFilePath(sessionId);\n\n    try {\n      await fs.access(filePath);\n      return true;\n    } catch {\n      return false;\n    }\n  }\n\n  async list(filter?: SessionFilter): Promise<SessionSummary[]> {\n    const index = await this.loadIndex();\n    let entries = index.sessions;\n\n    // Apply filters\n    if (filter) {\n      entries = this.applyFilter(entries, filter);\n    }\n\n    // Sort by last active (most recent first)\n    entries.sort(\n      (a, b) =>\n        new Date(b.lastActiveAt).getTime() - new Date(a.lastActiveAt).getTime()\n    );\n\n    // Apply pagination\n    if (filter?.offset) {\n      entries = entries.slice(filter.offset);\n    }\n    if (filter?.limit) {\n      entries = entries.slice(0, filter.limit);\n    }\n\n    return entries.map(this.indexEntryToSummary);\n  }\n\n  async search(query: string, filter?: SessionFilter): Promise<SessionSummary[]> {\n    const index = await this.loadIndex();\n    const lowerQuery = query.toLowerCase();\n\n    let entries = index.sessions.filter((e) => {\n      const titleMatch = e.metadata.title?.toLowerCase().includes(lowerQuery);\n      const tagMatch = e.metadata.tags?.some((t) =>\n        t.toLowerCase().includes(lowerQuery)\n      );\n      const idMatch = e.id.toLowerCase().includes(lowerQuery);\n      return titleMatch || tagMatch || idMatch;\n    });\n\n    // Apply additional filters\n    if (filter) {\n      entries = this.applyFilter(entries, filter);\n    }\n\n    // Sort by relevance then date\n    entries.sort((a, b) => {\n      const aTitle = a.metadata.title?.toLowerCase().includes(lowerQuery) ? 1 : 0;\n      const bTitle = b.metadata.title?.toLowerCase().includes(lowerQuery) ? 1 : 0;\n      if (aTitle !== bTitle) return bTitle - aTitle;\n      return (\n        new Date(b.lastActiveAt).getTime() - new Date(a.lastActiveAt).getTime()\n      );\n    });\n\n    // Apply pagination\n    if (filter?.offset) {\n      entries = entries.slice(filter.offset);\n    }\n    if (filter?.limit) {\n      entries = entries.slice(0, filter.limit);\n    }\n\n    return entries.map(this.indexEntryToSummary);\n  }\n\n  /**\n   * Rebuild the index by scanning all session files\n   * Useful for recovery or migration\n   */\n  async rebuildIndex(): Promise<void> {\n    await this.ensureDirectory();\n\n    const files = await fs.readdir(this.directory);\n    const sessionFiles = files.filter(\n      (f) => f.endsWith(this.extension) && !f.startsWith('_')\n    );\n\n    const entries: SessionIndexEntry[] = [];\n\n    for (const file of sessionFiles) {\n      try {\n        const filePath = join(this.directory, file);\n        const data = await fs.readFile(filePath, 'utf-8');\n        const session = JSON.parse(data) as Session;\n        entries.push(this.sessionToIndexEntry(session));\n      } catch {\n        // Skip invalid files\n      }\n    }\n\n    this.index = {\n      version: 1,\n      sessions: entries,\n      lastUpdated: new Date().toISOString(),\n    };\n\n    await this.saveIndex();\n  }\n\n  /**\n   * Get the storage directory path\n   */\n  getDirectory(): string {\n    return this.directory;\n  }\n\n  // ==========================================================================\n  // Private Helpers\n  // ==========================================================================\n\n  private getFilePath(sessionId: string): string {\n    // Sanitize session ID for use as filename\n    const safeId = sessionId.replace(/[^a-zA-Z0-9_-]/g, '_');\n    return join(this.directory, `${safeId}${this.extension}`);\n  }\n\n  private async ensureDirectory(): Promise<void> {\n    try {\n      await fs.mkdir(this.directory, { recursive: true });\n    } catch (error: any) {\n      if (error.code !== 'EEXIST') {\n        throw error;\n      }\n    }\n  }\n\n  private async loadIndex(): Promise<SessionIndex> {\n    if (this.index) {\n      return this.index;\n    }\n\n    try {\n      const data = await fs.readFile(this.indexPath, 'utf-8');\n      this.index = JSON.parse(data) as SessionIndex;\n      return this.index;\n    } catch (error: any) {\n      if (error.code === 'ENOENT') {\n        // No index yet, create empty one\n        this.index = {\n          version: 1,\n          sessions: [],\n          lastUpdated: new Date().toISOString(),\n        };\n        return this.index;\n      }\n      throw error;\n    }\n  }\n\n  private async saveIndex(): Promise<void> {\n    if (!this.index) return;\n\n    this.index.lastUpdated = new Date().toISOString();\n    const data = this.prettyPrint\n      ? JSON.stringify(this.index, null, 2)\n      : JSON.stringify(this.index);\n\n    await fs.writeFile(this.indexPath, data, 'utf-8');\n  }\n\n  private async updateIndex(session: Session): Promise<void> {\n    const index = await this.loadIndex();\n    const entry = this.sessionToIndexEntry(session);\n\n    const existingIdx = index.sessions.findIndex((e) => e.id === session.id);\n    if (existingIdx >= 0) {\n      index.sessions[existingIdx] = entry;\n    } else {\n      index.sessions.push(entry);\n    }\n\n    await this.saveIndex();\n  }\n\n  private async removeFromIndex(sessionId: string): Promise<void> {\n    await this.ensureDirectory();\n    const index = await this.loadIndex();\n    index.sessions = index.sessions.filter((e) => e.id !== sessionId);\n    await this.saveIndex();\n  }\n\n  private sessionToIndexEntry(session: Session): SessionIndexEntry {\n    // Handle createdAt as Date, string, or number\n    let createdAtStr: string;\n    if (typeof session.createdAt === 'string') {\n      createdAtStr = session.createdAt;\n    } else if (typeof session.createdAt === 'number') {\n      createdAtStr = new Date(session.createdAt).toISOString();\n    } else if (session.createdAt instanceof Date) {\n      createdAtStr = session.createdAt.toISOString();\n    } else {\n      createdAtStr = new Date().toISOString();\n    }\n\n    // Handle lastActiveAt as Date, string, or number\n    let lastActiveAtStr: string;\n    if (typeof session.lastActiveAt === 'string') {\n      lastActiveAtStr = session.lastActiveAt;\n    } else if (typeof session.lastActiveAt === 'number') {\n      lastActiveAtStr = new Date(session.lastActiveAt).toISOString();\n    } else if (session.lastActiveAt instanceof Date) {\n      lastActiveAtStr = session.lastActiveAt.toISOString();\n    } else {\n      lastActiveAtStr = new Date().toISOString();\n    }\n\n    return {\n      id: session.id,\n      agentType: session.agentType,\n      createdAt: createdAtStr,\n      lastActiveAt: lastActiveAtStr,\n      metadata: {\n        title: session.metadata.title,\n        userId: session.metadata.userId,\n        tags: session.metadata.tags,\n      },\n      messageCount: session.history.entries.length,\n    };\n  }\n\n  private indexEntryToSummary(entry: SessionIndexEntry): SessionSummary {\n    return {\n      id: entry.id,\n      agentType: entry.agentType,\n      createdAt: new Date(entry.createdAt),\n      lastActiveAt: new Date(entry.lastActiveAt),\n      metadata: entry.metadata,\n      messageCount: entry.messageCount,\n    };\n  }\n\n  private applyFilter(\n    entries: SessionIndexEntry[],\n    filter: SessionFilter\n  ): SessionIndexEntry[] {\n    return entries.filter((e) => {\n      if (filter.agentType && e.agentType !== filter.agentType) {\n        return false;\n      }\n\n      if (filter.userId && e.metadata.userId !== filter.userId) {\n        return false;\n      }\n\n      if (filter.tags && filter.tags.length > 0) {\n        const entryTags = e.metadata.tags ?? [];\n        const hasMatchingTag = filter.tags.some((t) => entryTags.includes(t));\n        if (!hasMatchingTag) return false;\n      }\n\n      if (filter.createdAfter && new Date(e.createdAt) < filter.createdAfter) {\n        return false;\n      }\n\n      if (filter.createdBefore && new Date(e.createdAt) > filter.createdBefore) {\n        return false;\n      }\n\n      if (filter.activeAfter && new Date(e.lastActiveAt) < filter.activeAfter) {\n        return false;\n      }\n\n      if (filter.activeBefore && new Date(e.lastActiveAt) > filter.activeBefore) {\n        return false;\n      }\n\n      return true;\n    });\n  }\n}\n","/**\n * Stream helper utilities for consuming and processing streaming events\n */\n\nimport {\n  StreamEvent,\n  StreamEventType,\n  isOutputTextDelta,\n} from '../../domain/entities/StreamEvent.js';\nimport { StreamState } from '../../domain/entities/StreamState.js';\nimport { LLMResponse, OutputItem } from '../../domain/entities/Response.js';\nimport { MessageRole } from '../../domain/entities/Message.js';\nimport { ContentType } from '../../domain/entities/Content.js';\n\n/**\n * Helper class for consuming and processing streams\n */\nexport class StreamHelpers {\n  /**\n   * Collect complete response from stream\n   * Accumulates all events and reconstructs final LLMResponse\n   */\n  static async collectResponse(\n    stream: AsyncIterableIterator<StreamEvent>\n  ): Promise<LLMResponse> {\n    let state: StreamState | null = null;\n\n    for await (const event of stream) {\n      // Initialize state on first event\n      if (!state && event.type === StreamEventType.RESPONSE_CREATED) {\n        state = new StreamState(event.response_id, event.model, event.created_at);\n      }\n\n      if (!state) continue;\n\n      // Update state from events\n      this.updateStateFromEvent(state, event);\n    }\n\n    if (!state) {\n      throw new Error('No stream events received');\n    }\n\n    return this.reconstructLLMResponse(state);\n  }\n\n  /**\n   * Get only text deltas from stream (for simple text streaming)\n   * Filters out all other event types\n   */\n  static async *textOnly(\n    stream: AsyncIterableIterator<StreamEvent>\n  ): AsyncIterableIterator<string> {\n    for await (const event of stream) {\n      if (isOutputTextDelta(event)) {\n        yield event.delta;\n      }\n    }\n  }\n\n  /**\n   * Filter stream events by type\n   */\n  static async *filterByType<T extends StreamEvent>(\n    stream: AsyncIterableIterator<StreamEvent>,\n    eventType: StreamEventType\n  ): AsyncIterableIterator<T> {\n    for await (const event of stream) {\n      if (event.type === eventType) {\n        yield event as T;\n      }\n    }\n  }\n\n  /**\n   * Accumulate text from stream into a single string\n   */\n  static async accumulateText(\n    stream: AsyncIterableIterator<StreamEvent>\n  ): Promise<string> {\n    const chunks: string[] = [];\n\n    for await (const event of stream) {\n      if (isOutputTextDelta(event)) {\n        chunks.push(event.delta);\n      }\n    }\n\n    return chunks.join('');\n  }\n\n  /**\n   * Buffer stream events into batches\n   */\n  static async *bufferEvents(\n    stream: AsyncIterableIterator<StreamEvent>,\n    batchSize: number\n  ): AsyncIterableIterator<StreamEvent[]> {\n    let buffer: StreamEvent[] = [];\n\n    for await (const event of stream) {\n      buffer.push(event);\n\n      if (buffer.length >= batchSize) {\n        yield buffer;\n        buffer = [];\n      }\n    }\n\n    // Yield remaining events\n    if (buffer.length > 0) {\n      yield buffer;\n    }\n  }\n\n  /**\n   * Tap into stream without consuming it\n   * Useful for logging or side effects\n   */\n  static async *tap(\n    stream: AsyncIterableIterator<StreamEvent>,\n    callback: (event: StreamEvent) => void | Promise<void>\n  ): AsyncIterableIterator<StreamEvent> {\n    for await (const event of stream) {\n      await callback(event);\n      yield event;\n    }\n  }\n\n  /**\n   * Take first N events from stream\n   */\n  static async *take(\n    stream: AsyncIterableIterator<StreamEvent>,\n    count: number\n  ): AsyncIterableIterator<StreamEvent> {\n    let taken = 0;\n\n    for await (const event of stream) {\n      if (taken >= count) break;\n      yield event;\n      taken++;\n    }\n  }\n\n  /**\n   * Skip first N events from stream\n   */\n  static async *skip(\n    stream: AsyncIterableIterator<StreamEvent>,\n    count: number\n  ): AsyncIterableIterator<StreamEvent> {\n    let skipped = 0;\n\n    for await (const event of stream) {\n      if (skipped < count) {\n        skipped++;\n        continue;\n      }\n      yield event;\n    }\n  }\n\n  /**\n   * Update StreamState from event\n   * @private\n   */\n  private static updateStateFromEvent(state: StreamState, event: StreamEvent): void {\n    switch (event.type) {\n      case StreamEventType.OUTPUT_TEXT_DELTA:\n        state.accumulateTextDelta(event.item_id, event.delta);\n        break;\n\n      case StreamEventType.TOOL_CALL_START:\n        state.startToolCall(event.tool_call_id, event.tool_name);\n        break;\n\n      case StreamEventType.TOOL_CALL_ARGUMENTS_DELTA:\n        state.accumulateToolArguments(event.tool_call_id, event.delta);\n        break;\n\n      case StreamEventType.TOOL_CALL_ARGUMENTS_DONE:\n        state.completeToolCall(event.tool_call_id);\n        break;\n\n      case StreamEventType.TOOL_EXECUTION_DONE:\n        state.setToolResult(event.tool_call_id, event.result);\n        break;\n\n      case StreamEventType.ITERATION_COMPLETE:\n        state.incrementIteration();\n        break;\n\n      case StreamEventType.RESPONSE_COMPLETE:\n        // Debug: Log usage when received\n        if (process.env.DEBUG_STREAMING) {\n          console.error('[DEBUG] RESPONSE_COMPLETE event:', event.usage);\n        }\n        state.updateUsage(event.usage);\n        state.markComplete(event.status);\n        break;\n    }\n  }\n\n  /**\n   * Reconstruct LLMResponse from StreamState\n   * @private\n   */\n  private static reconstructLLMResponse(state: StreamState): LLMResponse {\n    const output: OutputItem[] = [];\n\n    // Add text messages\n    if (state.hasText()) {\n      const textContent = state.getAllText();\n      if (textContent) {\n        output.push({\n          type: 'message' as const,\n          role: MessageRole.ASSISTANT,\n          content: [\n            {\n              type: ContentType.OUTPUT_TEXT,\n              text: textContent,\n            },\n          ],\n        });\n      }\n    }\n\n    // Add tool calls to output\n    const toolCalls = state.getCompletedToolCalls();\n    if (toolCalls.length > 0) {\n      // Tool calls should be part of assistant message content\n      const toolUseContent = toolCalls.map((tc) => ({\n        type: ContentType.TOOL_USE as const,\n        id: tc.id,\n        name: tc.function.name,\n        arguments: tc.function.arguments,\n      }));\n\n      const firstOutput = output[0];\n      if (firstOutput && firstOutput.type === 'message') {\n        // Append to existing message\n        firstOutput.content.push(...toolUseContent);\n      } else {\n        // Create new message with tool calls\n        output.push({\n          type: 'message' as const,\n          role: MessageRole.ASSISTANT,\n          content: toolUseContent,\n        });\n      }\n    }\n\n    // Extract output text\n    const outputText = this.extractOutputText(output);\n\n    return {\n      id: state.responseId,\n      object: 'response',\n      created_at: state.createdAt,\n      status: state.status,\n      model: state.model,\n      output,\n      output_text: outputText,\n      usage: state.usage,\n    };\n  }\n\n  /**\n   * Extract text from output items\n   * @private\n   */\n  private static extractOutputText(output: OutputItem[]): string {\n    const texts: string[] = [];\n\n    for (const item of output) {\n      if (item.type === 'message') {\n        for (const content of item.content) {\n          if (content.type === ContentType.OUTPUT_TEXT) {\n            texts.push(content.text);\n          }\n        }\n      }\n    }\n\n    return texts.join(' ').trim();\n  }\n}\n","/**\n * Unified error mapper for all providers\n * Converts provider-specific errors to our standard error types\n */\n\nimport {\n  AIError,\n  ProviderAuthError,\n  ProviderRateLimitError,\n  ProviderContextLengthError,\n  ProviderError,\n} from '../../../domain/errors/AIErrors.js';\n\nexport interface ProviderErrorContext {\n  providerName: string;\n  maxContextTokens?: number;\n}\n\n/**\n * Maps provider-specific errors to our unified error types\n */\nexport class ProviderErrorMapper {\n  /**\n   * Map any provider error to our standard error types\n   */\n  static mapError(error: any, context: ProviderErrorContext): AIError {\n    const { providerName, maxContextTokens = 128000 } = context;\n\n    // Already our error type - return as-is\n    if (error instanceof AIError) {\n      return error;\n    }\n\n    // Extract error details\n    const status = error.status || error.statusCode || error.code;\n    const message = error.message || String(error);\n    const messageLower = message.toLowerCase();\n\n    // Auth errors (401, 403, or message indicators)\n    if (\n      status === 401 ||\n      status === 403 ||\n      messageLower.includes('api key') ||\n      messageLower.includes('api_key') ||\n      messageLower.includes('authentication') ||\n      messageLower.includes('unauthorized') ||\n      messageLower.includes('invalid key') ||\n      messageLower.includes('permission denied')\n    ) {\n      return new ProviderAuthError(providerName, message);\n    }\n\n    // Rate limit errors (429 or message indicators)\n    if (\n      status === 429 ||\n      messageLower.includes('rate limit') ||\n      messageLower.includes('rate_limit') ||\n      messageLower.includes('too many requests') ||\n      messageLower.includes('resource exhausted') ||\n      messageLower.includes('quota exceeded')\n    ) {\n      const retryAfter = this.extractRetryAfter(error);\n      return new ProviderRateLimitError(providerName, retryAfter);\n    }\n\n    // Context length errors (413 or message indicators)\n    if (\n      status === 413 ||\n      error.code === 'context_length_exceeded' ||\n      messageLower.includes('context length') ||\n      messageLower.includes('context_length') ||\n      messageLower.includes('token limit') ||\n      messageLower.includes('too long') ||\n      messageLower.includes('maximum context') ||\n      messageLower.includes('max_tokens') ||\n      messageLower.includes('prompt is too long')\n    ) {\n      return new ProviderContextLengthError(providerName, maxContextTokens);\n    }\n\n    // Generic provider error for everything else\n    return new ProviderError(providerName, message, status, error);\n  }\n\n  /**\n   * Extract retry-after value from error headers or body\n   */\n  private static extractRetryAfter(error: any): number | undefined {\n    // Check headers (common for HTTP responses)\n    const retryAfterHeader =\n      error.headers?.['retry-after'] ||\n      error.headers?.['Retry-After'] ||\n      error.headers?.get?.('retry-after');\n\n    if (retryAfterHeader) {\n      const seconds = parseInt(retryAfterHeader, 10);\n      if (!isNaN(seconds)) {\n        return seconds * 1000; // Convert to milliseconds\n      }\n    }\n\n    // Check error body for retry info\n    if (error.retryAfter) {\n      return typeof error.retryAfter === 'number'\n        ? error.retryAfter\n        : parseInt(error.retryAfter, 10) * 1000;\n    }\n\n    // Check for Google-style error details\n    if (error.errorDetails) {\n      for (const detail of error.errorDetails) {\n        if (detail.retryDelay) {\n          // Parse duration string like \"60s\"\n          const match = detail.retryDelay.match(/(\\d+)s/);\n          if (match) {\n            return parseInt(match[1], 10) * 1000;\n          }\n        }\n      }\n    }\n\n    return undefined;\n  }\n}\n","/**\n * File-based token storage\n * Tokens are encrypted and stored in individual files with restrictive permissions\n */\n\nimport * as fs from 'fs/promises';\nimport * as path from 'path';\nimport * as crypto from 'crypto';\nimport { ITokenStorage, StoredToken } from '../../domain/ITokenStorage.js';\nimport { encrypt, decrypt } from '../../utils/encryption.js';\n\nexport interface FileStorageConfig {\n  directory: string; // Directory to store token files\n  encryptionKey: string; // Encryption key (REQUIRED - do not use auto-generated key!)\n}\n\nexport class FileStorage implements ITokenStorage {\n  private directory: string;\n  private encryptionKey: string;\n\n  constructor(config: FileStorageConfig) {\n    if (!config.encryptionKey) {\n      throw new Error(\n        'FileStorage requires an encryption key. Set OAUTH_ENCRYPTION_KEY in environment or provide config.encryptionKey'\n      );\n    }\n\n    this.directory = config.directory;\n    this.encryptionKey = config.encryptionKey;\n\n    // Ensure directory exists (async, don't block constructor)\n    this.ensureDirectory().catch((error) => {\n      console.error('Failed to create token directory:', error);\n    });\n  }\n\n  private async ensureDirectory(): Promise<void> {\n    try {\n      await fs.mkdir(this.directory, { recursive: true });\n      // Set directory permissions (owner only)\n      await fs.chmod(this.directory, 0o700);\n    } catch (error) {\n      // Directory might already exist, that's okay\n    }\n  }\n\n  /**\n   * Get file path for a token key (hashed for security)\n   */\n  private getFilePath(key: string): string {\n    // Hash the key for filename (prevents exposing sensitive key names)\n    const hash = crypto.createHash('sha256').update(key).digest('hex');\n    return path.join(this.directory, `${hash}.token`);\n  }\n\n  async storeToken(key: string, token: StoredToken): Promise<void> {\n    await this.ensureDirectory();\n\n    const filePath = this.getFilePath(key);\n    const plaintext = JSON.stringify(token);\n    const encrypted = encrypt(plaintext, this.encryptionKey);\n\n    // Write encrypted token to file\n    await fs.writeFile(filePath, encrypted, 'utf8');\n\n    // Set restrictive permissions (owner read/write only)\n    await fs.chmod(filePath, 0o600);\n  }\n\n  async getToken(key: string): Promise<StoredToken | null> {\n    const filePath = this.getFilePath(key);\n\n    try {\n      const encrypted = await fs.readFile(filePath, 'utf8');\n      const decrypted = decrypt(encrypted, this.encryptionKey);\n      return JSON.parse(decrypted) as StoredToken;\n    } catch (error: any) {\n      if (error.code === 'ENOENT') {\n        // File doesn't exist\n        return null;\n      }\n\n      console.error('Failed to read/decrypt token file:', error);\n\n      // Remove corrupted file\n      try {\n        await fs.unlink(filePath);\n      } catch {\n        // Ignore unlink errors\n      }\n\n      return null;\n    }\n  }\n\n  async deleteToken(key: string): Promise<void> {\n    const filePath = this.getFilePath(key);\n\n    try {\n      await fs.unlink(filePath);\n    } catch (error: any) {\n      if (error.code !== 'ENOENT') {\n        throw error;\n      }\n      // File doesn't exist, that's okay\n    }\n  }\n\n  async hasToken(key: string): Promise<boolean> {\n    const filePath = this.getFilePath(key);\n\n    try {\n      await fs.access(filePath);\n      return true;\n    } catch {\n      return false;\n    }\n  }\n\n  /**\n   * List all token keys (for debugging)\n   */\n  async listTokens(): Promise<string[]> {\n    try {\n      const files = await fs.readdir(this.directory);\n      return files.filter((f) => f.endsWith('.token')).map((f) => f.replace('.token', ''));\n    } catch {\n      return [];\n    }\n  }\n\n  /**\n   * Clear all tokens\n   */\n  async clearAll(): Promise<void> {\n    try {\n      const files = await fs.readdir(this.directory);\n      const tokenFiles = files.filter((f) => f.endsWith('.token'));\n\n      await Promise.all(\n        tokenFiles.map((f) => fs.unlink(path.join(this.directory, f)).catch(() => {}))\n      );\n    } catch {\n      // Directory doesn't exist or can't read, that's okay\n    }\n  }\n}\n","/**\n * Authenticated Fetch - Drop-in replacement for fetch() with OAuth authentication\n */\n\nimport { Connector } from '../core/Connector.js';\n\n/**\n * Fetch with automatic OAuth authentication\n *\n * Same API as standard fetch(), but with additional authProvider and optional userId parameters.\n * The OAuth token is automatically retrieved and injected into the Authorization header.\n *\n * @param url - URL to fetch (string or URL object)\n * @param options - Standard fetch options\n * @param authProvider - Name of registered OAuth provider (e.g., 'microsoft', 'google')\n * @param userId - Optional user identifier for multi-user support (omit for single-user mode)\n * @returns Promise<Response> - Same as standard fetch\n *\n * @example Single-user mode:\n * ```typescript\n * const response = await authenticatedFetch(\n *   'https://graph.microsoft.com/v1.0/me',\n *   { method: 'GET' },\n *   'microsoft'\n * );\n * const data = await response.json();\n * ```\n *\n * @example Multi-user mode:\n * ```typescript\n * const response = await authenticatedFetch(\n *   'https://api.github.com/user/repos',\n *   { method: 'GET' },\n *   'github',\n *   'user123'  // Get token for specific user\n * );\n * const repos = await response.json();\n * ```\n */\nexport async function authenticatedFetch(\n  url: string | URL,\n  options: RequestInit | undefined,\n  authProvider: string,\n  userId?: string\n): Promise<Response> {\n  // Get connector from registry\n  const connector = Connector.get(authProvider);\n\n  // Get OAuth token for the user (automatically refreshed if needed)\n  const token = await connector.getToken(userId);\n\n  // Merge headers (don't mutate original options)\n  const authOptions: RequestInit = {\n    ...options,\n    headers: {\n      ...options?.headers,\n      Authorization: `Bearer ${token}`,\n    },\n  };\n\n  // Call standard fetch with authenticated headers\n  return fetch(url, authOptions);\n}\n\n/**\n * Create an authenticated fetch function bound to a specific provider and optionally a user\n *\n * Useful for creating reusable fetch functions for a specific API and/or user.\n *\n * @param authProvider - Name of registered OAuth provider\n * @param userId - Optional user identifier to bind to (omit for single-user mode)\n * @returns Fetch function bound to that provider (and user)\n *\n * @example Single-user mode:\n * ```typescript\n * const msftFetch = createAuthenticatedFetch('microsoft');\n *\n * // Use like normal fetch (auth automatic)\n * const me = await msftFetch('https://graph.microsoft.com/v1.0/me');\n * const emails = await msftFetch('https://graph.microsoft.com/v1.0/me/messages');\n * ```\n *\n * @example Multi-user mode (bound to specific user):\n * ```typescript\n * // Create fetch function for Alice\n * const aliceFetch = createAuthenticatedFetch('github', 'user123');\n *\n * // All calls automatically use Alice's token\n * const repos = await aliceFetch('https://api.github.com/user/repos');\n * const issues = await aliceFetch('https://api.github.com/user/issues');\n *\n * // Create fetch function for Bob (separate tokens!)\n * const bobFetch = createAuthenticatedFetch('github', 'user456');\n * const bobRepos = await bobFetch('https://api.github.com/user/repos');\n * ```\n *\n * @example Multi-user mode (userId per-call):\n * ```typescript\n * // Create fetch function NOT bound to a user\n * const githubFetch = createAuthenticatedFetch('github');\n *\n * // Specify userId at call time\n * const aliceRepos = await githubFetch(\n *   'https://api.github.com/user/repos',\n *   { userId: 'user123' }  // Pass as custom option\n * );\n * ```\n */\nexport function createAuthenticatedFetch(\n  authProvider: string,\n  userId?: string\n): (url: string | URL, options?: RequestInit) => Promise<Response> {\n  // Validate provider exists at creation time\n  Connector.get(authProvider);\n\n  return async (url: string | URL, options?: RequestInit) => {\n    return authenticatedFetch(url, options, authProvider, userId);\n  };\n}\n","/**\n * Tool Generator - Auto-generate tools for registered connectors\n */\n\nimport { ToolFunction } from '../domain/entities/Tool.js';\nimport { Connector } from '../core/Connector.js';\nimport { authenticatedFetch } from './authenticatedFetch.js';\n\ninterface APIRequestArgs {\n  authProvider: string;\n  url: string;\n  method?: 'GET' | 'POST' | 'PUT' | 'DELETE' | 'PATCH';\n  body?: any;\n  headers?: Record<string, string>;\n}\n\ninterface APIRequestResult {\n  success: boolean;\n  status: number;\n  statusText: string;\n  data: any;\n  error?: string;\n}\n\n/**\n * Generate a universal API request tool for all registered OAuth providers\n *\n * This tool allows the AI agent to make authenticated requests to any registered API.\n * The tool description is dynamically generated based on registered providers.\n *\n * @returns ToolFunction that can call any registered OAuth API\n */\nexport function generateWebAPITool(): ToolFunction<APIRequestArgs, APIRequestResult> {\n  return {\n    definition: {\n      type: 'function',\n      function: {\n        name: 'api_request',\n        description: `Make authenticated HTTP request to any registered OAuth API.\n\nThis tool automatically handles OAuth authentication for registered providers.\n\nREGISTERED PROVIDERS:\n${Connector.getDescriptionsForTools()}\n\nHOW TO USE:\n1. Choose the appropriate authProvider based on which API you need to access\n2. Provide the URL (full URL or path relative to provider's baseURL)\n3. Specify the HTTP method (GET, POST, etc.)\n4. For POST/PUT/PATCH, include the request body\n\nEXAMPLES:\nRead Microsoft emails:\n{\n  authProvider: \"microsoft\",\n  url: \"/v1.0/me/messages\",\n  method: \"GET\"\n}\n\nList GitHub repositories:\n{\n  authProvider: \"github\",\n  url: \"/user/repos\",\n  method: \"GET\"\n}\n\nCreate Salesforce account:\n{\n  authProvider: \"salesforce\",\n  url: \"/services/data/v57.0/sobjects/Account\",\n  method: \"POST\",\n  body: { Name: \"Acme Corp\", Industry: \"Technology\" }\n}`,\n\n        parameters: {\n          type: 'object',\n          properties: {\n            authProvider: {\n              type: 'string',\n              enum: Connector.list(),\n              description:\n                'Which connector to use for authentication. Choose based on the API you need to access.',\n            },\n            url: {\n              type: 'string',\n              description:\n                'URL to request. Can be full URL (https://...) or path relative to provider baseURL (e.g., \"/v1.0/me\")',\n            },\n            method: {\n              type: 'string',\n              enum: ['GET', 'POST', 'PUT', 'DELETE', 'PATCH'],\n              description: 'HTTP method (default: GET)',\n            },\n            body: {\n              description:\n                'Request body for POST/PUT/PATCH requests. Will be JSON-stringified automatically.',\n            },\n            headers: {\n              type: 'object',\n              description:\n                'Additional headers to include. Authorization header is added automatically.',\n            },\n          },\n          required: ['authProvider', 'url'],\n        },\n      },\n      blocking: true,\n      timeout: 30000,\n    },\n\n    execute: async (args: APIRequestArgs): Promise<APIRequestResult> => {\n      try {\n        // Get connector info\n        const connector = Connector.get(args.authProvider);\n\n        // Build full URL\n        const fullUrl = args.url.startsWith('http')\n          ? args.url\n          : `${connector.baseURL}${args.url}`;\n\n        // Prepare request options\n        const requestOptions: RequestInit = {\n          method: args.method || 'GET',\n          headers: {\n            'Content-Type': 'application/json',\n            ...args.headers,\n          },\n        };\n\n        // Add body for POST/PUT/PATCH\n        if (args.body && (args.method === 'POST' || args.method === 'PUT' || args.method === 'PATCH')) {\n          requestOptions.body = JSON.stringify(args.body);\n        }\n\n        // Make authenticated request\n        const response = await authenticatedFetch(fullUrl, requestOptions, args.authProvider);\n\n        // Get response data\n        const contentType = response.headers.get('content-type') || '';\n        let data: any;\n\n        if (contentType.includes('application/json')) {\n          data = await response.json();\n        } else {\n          data = await response.text();\n        }\n\n        return {\n          success: response.ok,\n          status: response.status,\n          statusText: response.statusText,\n          data,\n        };\n      } catch (error) {\n        return {\n          success: false,\n          status: 0,\n          statusText: 'Error',\n          data: null,\n          error: (error as Error).message,\n        };\n      }\n    },\n  };\n}\n","/**\n * ConnectorConfig Storage Interface (Clean Architecture - Domain Layer)\n *\n * Defines the contract for storing and retrieving ConnectorConfig objects.\n * Storage implementations do NOT handle encryption - that's done by ConnectorConfigStore.\n */\n\nimport type { ConnectorConfig } from '../entities/Connector.js';\n\n/**\n * Wrapper for stored connector configuration with metadata\n */\nexport interface StoredConnectorConfig {\n  /** The connector configuration (may contain encrypted fields) */\n  config: ConnectorConfig;\n\n  /** Timestamp when the config was first stored */\n  createdAt: number;\n\n  /** Timestamp when the config was last updated */\n  updatedAt: number;\n\n  /** Schema version for future migrations */\n  version: number;\n}\n\n/**\n * Storage interface for ConnectorConfig persistence\n *\n * Implementations should:\n * - Store data as-is (encryption is handled by ConnectorConfigStore)\n * - Use appropriate file permissions for file-based storage\n * - Hash names for filenames to prevent enumeration attacks\n */\nexport interface IConnectorConfigStorage {\n  /**\n   * Save a connector configuration\n   *\n   * @param name - Unique identifier for this connector\n   * @param stored - The stored config with metadata\n   */\n  save(name: string, stored: StoredConnectorConfig): Promise<void>;\n\n  /**\n   * Retrieve a connector configuration by name\n   *\n   * @param name - Unique identifier for the connector\n   * @returns The stored config or null if not found\n   */\n  get(name: string): Promise<StoredConnectorConfig | null>;\n\n  /**\n   * Delete a connector configuration\n   *\n   * @param name - Unique identifier for the connector\n   * @returns True if deleted, false if not found\n   */\n  delete(name: string): Promise<boolean>;\n\n  /**\n   * Check if a connector configuration exists\n   *\n   * @param name - Unique identifier for the connector\n   * @returns True if exists\n   */\n  has(name: string): Promise<boolean>;\n\n  /**\n   * List all connector names\n   *\n   * @returns Array of connector names\n   */\n  list(): Promise<string[]>;\n\n  /**\n   * Get all stored connector configurations\n   *\n   * @returns Array of all stored configs\n   */\n  listAll(): Promise<StoredConnectorConfig[]>;\n}\n\n/** Current schema version */\nexport const CONNECTOR_CONFIG_VERSION = 1;\n","/**\n * ConnectorConfigStore - Domain service for storing ConnectorConfig with encryption\n *\n * Handles encryption/decryption of sensitive fields uniformly,\n * regardless of which storage backend is used.\n */\n\nimport type { ConnectorConfig, ConnectorAuth } from '../../domain/entities/Connector.js';\nimport type {\n  IConnectorConfigStorage,\n  StoredConnectorConfig,\n} from '../../domain/interfaces/IConnectorConfigStorage.js';\nimport { CONNECTOR_CONFIG_VERSION } from '../../domain/interfaces/IConnectorConfigStorage.js';\nimport { encrypt, decrypt } from '../oauth/utils/encryption.js';\n\n/** Prefix for encrypted values */\nconst ENCRYPTED_PREFIX = '$ENC$:';\n\n/**\n * ConnectorConfigStore - manages connector configs with automatic encryption\n *\n * Usage:\n * ```typescript\n * const storage = new MemoryConnectorStorage();\n * const store = new ConnectorConfigStore(storage, process.env.ENCRYPTION_KEY!);\n *\n * await store.save('openai', { auth: { type: 'api_key', apiKey: 'sk-xxx' } });\n * const config = await store.get('openai'); // apiKey is decrypted\n * ```\n */\nexport class ConnectorConfigStore {\n  constructor(\n    private storage: IConnectorConfigStorage,\n    private encryptionKey: string\n  ) {\n    if (!encryptionKey || encryptionKey.length < 16) {\n      throw new Error(\n        'ConnectorConfigStore requires an encryption key of at least 16 characters'\n      );\n    }\n  }\n\n  /**\n   * Save a connector configuration (secrets are encrypted automatically)\n   *\n   * @param name - Unique identifier for this connector\n   * @param config - The connector configuration\n   */\n  async save(name: string, config: ConnectorConfig): Promise<void> {\n    if (!name || name.trim().length === 0) {\n      throw new Error('Connector name is required');\n    }\n\n    const existing = await this.storage.get(name);\n    const now = Date.now();\n\n    const encryptedConfig = this.encryptSecrets(config);\n\n    const stored: StoredConnectorConfig = {\n      config: { ...encryptedConfig, name },\n      createdAt: existing?.createdAt ?? now,\n      updatedAt: now,\n      version: CONNECTOR_CONFIG_VERSION,\n    };\n\n    await this.storage.save(name, stored);\n  }\n\n  /**\n   * Retrieve a connector configuration (secrets are decrypted automatically)\n   *\n   * @param name - Unique identifier for the connector\n   * @returns The decrypted config or null if not found\n   */\n  async get(name: string): Promise<ConnectorConfig | null> {\n    const stored = await this.storage.get(name);\n    if (!stored) {\n      return null;\n    }\n\n    return this.decryptSecrets(stored.config);\n  }\n\n  /**\n   * Delete a connector configuration\n   *\n   * @param name - Unique identifier for the connector\n   * @returns True if deleted, false if not found\n   */\n  async delete(name: string): Promise<boolean> {\n    return this.storage.delete(name);\n  }\n\n  /**\n   * Check if a connector configuration exists\n   *\n   * @param name - Unique identifier for the connector\n   * @returns True if exists\n   */\n  async has(name: string): Promise<boolean> {\n    return this.storage.has(name);\n  }\n\n  /**\n   * List all connector names\n   *\n   * @returns Array of connector names\n   */\n  async list(): Promise<string[]> {\n    return this.storage.list();\n  }\n\n  /**\n   * Get all connector configurations (secrets are decrypted automatically)\n   *\n   * @returns Array of decrypted configs\n   */\n  async listAll(): Promise<ConnectorConfig[]> {\n    const stored = await this.storage.listAll();\n    return stored.map((s) => this.decryptSecrets(s.config));\n  }\n\n  /**\n   * Get stored metadata for a connector\n   *\n   * @param name - Unique identifier for the connector\n   * @returns Metadata (createdAt, updatedAt, version) or null\n   */\n  async getMetadata(\n    name: string\n  ): Promise<{ createdAt: number; updatedAt: number; version: number } | null> {\n    const stored = await this.storage.get(name);\n    if (!stored) {\n      return null;\n    }\n    return {\n      createdAt: stored.createdAt,\n      updatedAt: stored.updatedAt,\n      version: stored.version,\n    };\n  }\n\n  // ============ Encryption Helpers ============\n\n  /**\n   * Encrypt sensitive fields in a ConnectorConfig\n   * Fields encrypted: apiKey, clientSecret, privateKey\n   */\n  private encryptSecrets(config: ConnectorConfig): ConnectorConfig {\n    const result = { ...config };\n\n    if (result.auth) {\n      result.auth = this.encryptAuthSecrets(result.auth);\n    }\n\n    return result;\n  }\n\n  /**\n   * Decrypt sensitive fields in a ConnectorConfig\n   */\n  private decryptSecrets(config: ConnectorConfig): ConnectorConfig {\n    const result = { ...config };\n\n    if (result.auth) {\n      result.auth = this.decryptAuthSecrets(result.auth);\n    }\n\n    return result;\n  }\n\n  /**\n   * Encrypt secrets in ConnectorAuth based on auth type\n   */\n  private encryptAuthSecrets(auth: ConnectorAuth): ConnectorAuth {\n    switch (auth.type) {\n      case 'api_key':\n        return {\n          ...auth,\n          apiKey: this.encryptValue(auth.apiKey),\n        };\n\n      case 'oauth':\n        return {\n          ...auth,\n          clientSecret: auth.clientSecret\n            ? this.encryptValue(auth.clientSecret)\n            : undefined,\n          privateKey: auth.privateKey\n            ? this.encryptValue(auth.privateKey)\n            : undefined,\n        };\n\n      case 'jwt':\n        return {\n          ...auth,\n          privateKey: this.encryptValue(auth.privateKey),\n        };\n\n      default:\n        return auth;\n    }\n  }\n\n  /**\n   * Decrypt secrets in ConnectorAuth based on auth type\n   */\n  private decryptAuthSecrets(auth: ConnectorAuth): ConnectorAuth {\n    switch (auth.type) {\n      case 'api_key':\n        return {\n          ...auth,\n          apiKey: this.decryptValue(auth.apiKey),\n        };\n\n      case 'oauth':\n        return {\n          ...auth,\n          clientSecret: auth.clientSecret\n            ? this.decryptValue(auth.clientSecret)\n            : undefined,\n          privateKey: auth.privateKey\n            ? this.decryptValue(auth.privateKey)\n            : undefined,\n        };\n\n      case 'jwt':\n        return {\n          ...auth,\n          privateKey: this.decryptValue(auth.privateKey),\n        };\n\n      default:\n        return auth;\n    }\n  }\n\n  /**\n   * Encrypt a single value if not already encrypted\n   */\n  private encryptValue(value: string): string {\n    if (this.isEncrypted(value)) {\n      return value; // Already encrypted\n    }\n    const encrypted = encrypt(value, this.encryptionKey);\n    return `${ENCRYPTED_PREFIX}${encrypted}`;\n  }\n\n  /**\n   * Decrypt a single value if encrypted\n   */\n  private decryptValue(value: string): string {\n    if (!this.isEncrypted(value)) {\n      return value; // Not encrypted (legacy or plaintext)\n    }\n    const encryptedData = value.slice(ENCRYPTED_PREFIX.length);\n    return decrypt(encryptedData, this.encryptionKey);\n  }\n\n  /**\n   * Check if a value is encrypted (has the $ENC$: prefix)\n   */\n  private isEncrypted(value: string): boolean {\n    return value.startsWith(ENCRYPTED_PREFIX);\n  }\n}\n","/**\n * In-memory storage for ConnectorConfig\n *\n * Simple Map-based storage. No encryption logic here -\n * encryption is handled by ConnectorConfigStore.\n *\n * Useful for:\n * - Testing\n * - Short-lived processes\n * - Development\n *\n * Note: Data is lost when process exits.\n */\n\nimport type {\n  IConnectorConfigStorage,\n  StoredConnectorConfig,\n} from '../../domain/interfaces/IConnectorConfigStorage.js';\n\nexport class MemoryConnectorStorage implements IConnectorConfigStorage {\n  private configs: Map<string, StoredConnectorConfig> = new Map();\n\n  async save(name: string, stored: StoredConnectorConfig): Promise<void> {\n    // Deep clone to prevent external mutation\n    this.configs.set(name, JSON.parse(JSON.stringify(stored)));\n  }\n\n  async get(name: string): Promise<StoredConnectorConfig | null> {\n    const stored = this.configs.get(name);\n    if (!stored) {\n      return null;\n    }\n    // Return a copy to prevent external mutation\n    return JSON.parse(JSON.stringify(stored));\n  }\n\n  async delete(name: string): Promise<boolean> {\n    return this.configs.delete(name);\n  }\n\n  async has(name: string): Promise<boolean> {\n    return this.configs.has(name);\n  }\n\n  async list(): Promise<string[]> {\n    return Array.from(this.configs.keys());\n  }\n\n  async listAll(): Promise<StoredConnectorConfig[]> {\n    // Return copies to prevent external mutation\n    return Array.from(this.configs.values()).map((stored) =>\n      JSON.parse(JSON.stringify(stored))\n    );\n  }\n\n  /**\n   * Clear all stored configs (useful for testing)\n   */\n  clear(): void {\n    this.configs.clear();\n  }\n\n  /**\n   * Get the number of stored configs\n   */\n  size(): number {\n    return this.configs.size;\n  }\n}\n","/**\n * File-based storage for ConnectorConfig\n *\n * Stores each connector config as a JSON file with restrictive permissions.\n * No encryption logic here - encryption is handled by ConnectorConfigStore.\n *\n * File structure:\n * - {directory}/{hash}.connector.json - individual connector files\n * - {directory}/_index.json - maps hashes to names for list()\n */\n\nimport * as fs from 'fs/promises';\nimport * as path from 'path';\nimport * as crypto from 'crypto';\nimport type {\n  IConnectorConfigStorage,\n  StoredConnectorConfig,\n} from '../../domain/interfaces/IConnectorConfigStorage.js';\n\nexport interface FileConnectorStorageConfig {\n  /** Directory to store connector files */\n  directory: string;\n}\n\ninterface IndexFile {\n  /** Maps hash -> name for reverse lookup */\n  connectors: Record<string, string>;\n}\n\nexport class FileConnectorStorage implements IConnectorConfigStorage {\n  private directory: string;\n  private indexPath: string;\n  private initialized = false;\n\n  constructor(config: FileConnectorStorageConfig) {\n    if (!config.directory) {\n      throw new Error('FileConnectorStorage requires a directory path');\n    }\n    this.directory = config.directory;\n    this.indexPath = path.join(this.directory, '_index.json');\n  }\n\n  async save(name: string, stored: StoredConnectorConfig): Promise<void> {\n    await this.ensureDirectory();\n\n    const filePath = this.getFilePath(name);\n    const json = JSON.stringify(stored, null, 2);\n\n    // Write config file\n    await fs.writeFile(filePath, json, 'utf8');\n    await fs.chmod(filePath, 0o600); // Owner read/write only\n\n    // Update index\n    await this.updateIndex(name, 'add');\n  }\n\n  async get(name: string): Promise<StoredConnectorConfig | null> {\n    const filePath = this.getFilePath(name);\n\n    try {\n      const json = await fs.readFile(filePath, 'utf8');\n      return JSON.parse(json) as StoredConnectorConfig;\n    } catch (error: unknown) {\n      const err = error as NodeJS.ErrnoException;\n      if (err.code === 'ENOENT') {\n        return null;\n      }\n      throw error;\n    }\n  }\n\n  async delete(name: string): Promise<boolean> {\n    const filePath = this.getFilePath(name);\n\n    try {\n      await fs.unlink(filePath);\n      await this.updateIndex(name, 'remove');\n      return true;\n    } catch (error: unknown) {\n      const err = error as NodeJS.ErrnoException;\n      if (err.code === 'ENOENT') {\n        return false;\n      }\n      throw error;\n    }\n  }\n\n  async has(name: string): Promise<boolean> {\n    const filePath = this.getFilePath(name);\n\n    try {\n      await fs.access(filePath);\n      return true;\n    } catch {\n      return false;\n    }\n  }\n\n  async list(): Promise<string[]> {\n    const index = await this.loadIndex();\n    return Object.values(index.connectors);\n  }\n\n  async listAll(): Promise<StoredConnectorConfig[]> {\n    const names = await this.list();\n    const results: StoredConnectorConfig[] = [];\n\n    for (const name of names) {\n      const stored = await this.get(name);\n      if (stored) {\n        results.push(stored);\n      }\n    }\n\n    return results;\n  }\n\n  /**\n   * Clear all stored configs (useful for testing)\n   */\n  async clear(): Promise<void> {\n    try {\n      const files = await fs.readdir(this.directory);\n      const connectorFiles = files.filter(\n        (f) => f.endsWith('.connector.json') || f === '_index.json'\n      );\n\n      await Promise.all(\n        connectorFiles.map((f) =>\n          fs.unlink(path.join(this.directory, f)).catch(() => {})\n        )\n      );\n    } catch {\n      // Directory doesn't exist, that's okay\n    }\n  }\n\n  // ============ Private Helpers ============\n\n  /**\n   * Get file path for a connector (hashed for security)\n   */\n  private getFilePath(name: string): string {\n    const hash = this.hashName(name);\n    return path.join(this.directory, `${hash}.connector.json`);\n  }\n\n  /**\n   * Hash connector name to prevent enumeration\n   */\n  private hashName(name: string): string {\n    return crypto.createHash('sha256').update(name).digest('hex').slice(0, 16);\n  }\n\n  /**\n   * Ensure storage directory exists with proper permissions\n   */\n  private async ensureDirectory(): Promise<void> {\n    if (this.initialized) return;\n\n    try {\n      await fs.mkdir(this.directory, { recursive: true });\n      await fs.chmod(this.directory, 0o700); // Owner only\n      this.initialized = true;\n    } catch {\n      // Directory might already exist\n      this.initialized = true;\n    }\n  }\n\n  /**\n   * Load the index file\n   */\n  private async loadIndex(): Promise<IndexFile> {\n    try {\n      const json = await fs.readFile(this.indexPath, 'utf8');\n      return JSON.parse(json) as IndexFile;\n    } catch {\n      return { connectors: {} };\n    }\n  }\n\n  /**\n   * Update the index file\n   */\n  private async updateIndex(\n    name: string,\n    action: 'add' | 'remove'\n  ): Promise<void> {\n    const index = await this.loadIndex();\n    const hash = this.hashName(name);\n\n    if (action === 'add') {\n      index.connectors[hash] = name;\n    } else {\n      delete index.connectors[hash];\n    }\n\n    const json = JSON.stringify(index, null, 2);\n    await fs.writeFile(this.indexPath, json, 'utf8');\n    await fs.chmod(this.indexPath, 0o600);\n  }\n}\n","/**\n * Backoff strategies for retry logic\n */\n\n/**\n * Backoff strategy type\n */\nexport type BackoffStrategyType = 'exponential' | 'linear' | 'constant';\n\n/**\n * Backoff configuration\n */\nexport interface BackoffConfig {\n  /** Strategy type */\n  strategy: BackoffStrategyType;\n\n  /** Initial delay in ms */\n  initialDelayMs: number;\n\n  /** Maximum delay in ms */\n  maxDelayMs: number;\n\n  /** Multiplier for exponential (default: 2) */\n  multiplier?: number;\n\n  /** Increment for linear (default: 1000ms) */\n  incrementMs?: number;\n\n  /** Add random jitter to prevent thundering herd */\n  jitter?: boolean;\n\n  /** Jitter factor (0-1, default: 0.1 = 10%) */\n  jitterFactor?: number;\n\n  /** Classify errors - return true if error should be retried */\n  isRetryable?: (error: Error) => boolean;\n}\n\n/**\n * Default backoff configuration\n */\nexport const DEFAULT_BACKOFF_CONFIG: BackoffConfig = {\n  strategy: 'exponential',\n  initialDelayMs: 1000, // 1 second\n  maxDelayMs: 30000, // 30 seconds\n  multiplier: 2,\n  jitter: true,\n  jitterFactor: 0.1,\n};\n\n/**\n * Calculate backoff delay for given attempt\n */\nexport function calculateBackoff(attempt: number, config: BackoffConfig = DEFAULT_BACKOFF_CONFIG): number {\n  let delay: number;\n\n  switch (config.strategy) {\n    case 'exponential':\n      delay = config.initialDelayMs * Math.pow(config.multiplier || 2, attempt - 1);\n      break;\n\n    case 'linear':\n      delay = config.initialDelayMs + (config.incrementMs || 1000) * (attempt - 1);\n      break;\n\n    case 'constant':\n      delay = config.initialDelayMs;\n      break;\n\n    default:\n      delay = config.initialDelayMs;\n  }\n\n  // Cap at max delay\n  delay = Math.min(delay, config.maxDelayMs);\n\n  // Add jitter if enabled\n  if (config.jitter) {\n    delay = addJitter(delay, config.jitterFactor || 0.1);\n  }\n\n  return Math.floor(delay);\n}\n\n/**\n * Add random jitter to a delay\n *\n * @param delay - Base delay in ms\n * @param factor - Jitter factor (0-1), default 0.1 = 10%\n * @returns delay with jitter applied\n */\nexport function addJitter(delay: number, factor: number = 0.1): number {\n  // Calculate jitter range\n  const jitterRange = delay * factor;\n\n  // Add random value in range [-jitterRange, +jitterRange]\n  const jitter = (Math.random() * 2 - 1) * jitterRange;\n\n  return delay + jitter;\n}\n\n/**\n * Wait for backoff delay\n */\nexport async function backoffWait(attempt: number, config: BackoffConfig = DEFAULT_BACKOFF_CONFIG): Promise<number> {\n  const delay = calculateBackoff(attempt, config);\n\n  await new Promise((resolve) => setTimeout(resolve, delay));\n\n  return delay;\n}\n\n/**\n * Backoff iterator - generates delays for each attempt\n */\nexport function* backoffSequence(\n  config: BackoffConfig = DEFAULT_BACKOFF_CONFIG,\n  maxAttempts?: number\n): Generator<number, void, unknown> {\n  let attempt = 1;\n\n  while (true) {\n    if (maxAttempts && attempt > maxAttempts) {\n      return;\n    }\n\n    yield calculateBackoff(attempt, config);\n    attempt++;\n  }\n}\n\n/**\n * Retry with backoff\n *\n * @param fn - Function to execute\n * @param config - Backoff configuration\n * @param maxAttempts - Max retry attempts (default: unlimited)\n * @returns Result of fn()\n */\nexport async function retryWithBackoff<T>(\n  fn: () => Promise<T>,\n  config: BackoffConfig = DEFAULT_BACKOFF_CONFIG,\n  maxAttempts?: number\n): Promise<T> {\n  let attempt = 0;\n  let lastError: Error;\n\n  while (true) {\n    attempt++;\n\n    try {\n      return await fn();\n    } catch (error) {\n      lastError = error as Error;\n\n      // Check if we should retry\n      if (config.isRetryable && !config.isRetryable(lastError)) {\n        // Non-retryable error, throw immediately\n        throw lastError;\n      }\n\n      // Check max attempts\n      if (maxAttempts && attempt >= maxAttempts) {\n        throw lastError;\n      }\n\n      // Wait before retrying\n      await backoffWait(attempt, config);\n    }\n  }\n}\n","/**\n * Message builder utilities for constructing complex inputs\n */\n\nimport { InputItem, MessageRole } from '../domain/entities/Message.js';\nimport {\n  ContentType,\n  InputTextContent,\n  InputImageContent,\n} from '../domain/entities/Content.js';\n\nexport class MessageBuilder {\n  private messages: InputItem[] = [];\n\n  /**\n   * Add a user text message\n   */\n  addUserMessage(text: string): this {\n    this.messages.push({\n      type: 'message',\n      role: MessageRole.USER,\n      content: [\n        {\n          type: ContentType.INPUT_TEXT,\n          text,\n        },\n      ],\n    });\n    return this;\n  }\n\n  /**\n   * Add a user message with text and images\n   */\n  addUserMessageWithImages(text: string, imageUrls: string[]): this {\n    const content: (InputTextContent | InputImageContent)[] = [\n      {\n        type: ContentType.INPUT_TEXT,\n        text,\n      },\n    ];\n\n    // Add images\n    for (const url of imageUrls) {\n      content.push({\n        type: ContentType.INPUT_IMAGE_URL,\n        image_url: {\n          url,\n          detail: 'auto', // Can be 'auto', 'low', or 'high'\n        },\n      });\n    }\n\n    this.messages.push({\n      type: 'message',\n      role: MessageRole.USER,\n      content,\n    });\n\n    return this;\n  }\n\n  /**\n   * Add an assistant message (for conversation history)\n   */\n  addAssistantMessage(text: string): this {\n    this.messages.push({\n      type: 'message',\n      role: MessageRole.ASSISTANT,\n      content: [\n        {\n          type: ContentType.OUTPUT_TEXT,\n          text,\n          annotations: [],\n        },\n      ],\n    });\n    return this;\n  }\n\n  /**\n   * Add a system/developer message\n   */\n  addDeveloperMessage(text: string): this {\n    this.messages.push({\n      type: 'message',\n      role: MessageRole.DEVELOPER,\n      content: [\n        {\n          type: ContentType.INPUT_TEXT,\n          text,\n        },\n      ],\n    });\n    return this;\n  }\n\n  /**\n   * Build and return the messages array\n   */\n  build(): InputItem[] {\n    return this.messages;\n  }\n\n  /**\n   * Clear all messages\n   */\n  clear(): this {\n    this.messages = [];\n    return this;\n  }\n\n  /**\n   * Get the current message count\n   */\n  count(): number {\n    return this.messages.length;\n  }\n}\n\n/**\n * Helper function to create a simple text message\n */\nexport function createTextMessage(text: string, role: MessageRole = MessageRole.USER): InputItem {\n  return {\n    type: 'message',\n    role,\n    content: [\n      {\n        type: ContentType.INPUT_TEXT,\n        text,\n      },\n    ],\n  };\n}\n\n/**\n * Helper function to create a message with images\n */\nexport function createMessageWithImages(\n  text: string,\n  imageUrls: string[],\n  role: MessageRole = MessageRole.USER\n): InputItem {\n  const content: (InputTextContent | InputImageContent)[] = [\n    {\n      type: ContentType.INPUT_TEXT,\n      text,\n    },\n  ];\n\n  for (const url of imageUrls) {\n    content.push({\n      type: ContentType.INPUT_IMAGE_URL,\n      image_url: {\n        url,\n        detail: 'auto',\n      },\n    });\n  }\n\n  return {\n    type: 'message',\n    role,\n    content,\n  };\n}\n","/**\n * Clipboard image utilities\n * Reads images from clipboard (supports Mac, Linux, Windows)\n */\n\nimport { exec } from 'child_process';\nimport { promisify } from 'util';\nimport * as fs from 'fs';\nimport * as os from 'os';\nimport * as path from 'path';\n\nconst execAsync = promisify(exec);\n\n/**\n * Safely clean up a temp file, ignoring errors\n */\nfunction cleanupTempFile(filePath: string): void {\n  try {\n    if (fs.existsSync(filePath)) {\n      fs.unlinkSync(filePath);\n    }\n  } catch {\n    // Ignore cleanup errors - temp directory will eventually clean up\n  }\n}\n\nexport interface ClipboardImageResult {\n  success: boolean;\n  dataUri?: string;\n  error?: string;\n  format?: string;\n}\n\n/**\n * Read image from clipboard and convert to data URI\n */\nexport async function readClipboardImage(): Promise<ClipboardImageResult> {\n  const platform = os.platform();\n\n  try {\n    switch (platform) {\n      case 'darwin': // macOS\n        return await readClipboardImageMac();\n      case 'linux':\n        return await readClipboardImageLinux();\n      case 'win32':\n        return await readClipboardImageWindows();\n      default:\n        return {\n          success: false,\n          error: `Unsupported platform: ${platform}`,\n        };\n    }\n  } catch (error: any) {\n    return {\n      success: false,\n      error: error.message,\n    };\n  }\n}\n\n/**\n * Read clipboard image on macOS\n */\nasync function readClipboardImageMac(): Promise<ClipboardImageResult> {\n  const tempFile = path.join(os.tmpdir(), `clipboard-${Date.now()}.png`);\n\n  try {\n    // Try pngpaste first (brew install pngpaste)\n    try {\n      await execAsync(`pngpaste \"${tempFile}\"`);\n      return await convertFileToDataUri(tempFile);\n    } catch (pngpasteError) {\n      // pngpaste not installed, try osascript\n      const script = `\n        set theFile to (POSIX file \"${tempFile}\")\n        try\n          set theImage to the clipboard as class PNGf\n          set fileRef to open for access theFile with write permission\n          write theImage to fileRef\n          close access fileRef\n          return \"success\"\n        on error errMsg\n          try\n            close access theFile\n          end try\n          error errMsg\n        end try\n      `;\n\n      const { stdout } = await execAsync(`osascript -e '${script}'`);\n\n      if (stdout.includes('success') || fs.existsSync(tempFile)) {\n        return await convertFileToDataUri(tempFile);\n      }\n\n      return {\n        success: false,\n        error: 'No image found in clipboard. Try copying an image first (Cmd+C or screenshot with Cmd+Ctrl+Shift+4)',\n      };\n    }\n  } finally {\n    // Always clean up temp file\n    cleanupTempFile(tempFile);\n  }\n}\n\n/**\n * Read clipboard image on Linux\n */\nasync function readClipboardImageLinux(): Promise<ClipboardImageResult> {\n  const tempFile = path.join(os.tmpdir(), `clipboard-${Date.now()}.png`);\n\n  try {\n    // Try xclip\n    try {\n      await execAsync(`xclip -selection clipboard -t image/png -o > \"${tempFile}\"`);\n      if (fs.existsSync(tempFile) && fs.statSync(tempFile).size > 0) {\n        return await convertFileToDataUri(tempFile);\n      }\n    } catch {\n      // xclip not available or failed\n    }\n\n    // Try wl-paste (Wayland)\n    try {\n      await execAsync(`wl-paste -t image/png > \"${tempFile}\"`);\n      if (fs.existsSync(tempFile) && fs.statSync(tempFile).size > 0) {\n        return await convertFileToDataUri(tempFile);\n      }\n    } catch {\n      // wl-paste not available or failed\n    }\n\n    return {\n      success: false,\n      error: 'No image in clipboard. Install xclip (X11) or wl-clipboard (Wayland)',\n    };\n  } finally {\n    // Always clean up temp file\n    cleanupTempFile(tempFile);\n  }\n}\n\n/**\n * Read clipboard image on Windows\n */\nasync function readClipboardImageWindows(): Promise<ClipboardImageResult> {\n  const tempFile = path.join(os.tmpdir(), `clipboard-${Date.now()}.png`);\n\n  try {\n    // PowerShell script to save clipboard image\n    const psScript = `\n      Add-Type -AssemblyName System.Windows.Forms;\n      $clip = [System.Windows.Forms.Clipboard]::GetImage();\n      if ($clip -ne $null) {\n        $clip.Save('${tempFile.replace(/\\\\/g, '\\\\\\\\')}', [System.Drawing.Imaging.ImageFormat]::Png);\n        Write-Output 'success';\n      } else {\n        Write-Error 'No image in clipboard';\n      }\n    `;\n\n    await execAsync(`powershell -Command \"${psScript}\"`);\n\n    if (fs.existsSync(tempFile) && fs.statSync(tempFile).size > 0) {\n      return await convertFileToDataUri(tempFile);\n    }\n\n    return {\n      success: false,\n      error: 'No image found in clipboard',\n    };\n  } finally {\n    // Always clean up temp file\n    cleanupTempFile(tempFile);\n  }\n}\n\n/**\n * Convert image file to data URI\n * Note: Caller is responsible for temp file cleanup via finally block\n */\nasync function convertFileToDataUri(filePath: string): Promise<ClipboardImageResult> {\n  try {\n    const imageBuffer = fs.readFileSync(filePath);\n    const base64Image = imageBuffer.toString('base64');\n\n    // Detect format from file\n    const magic = imageBuffer.slice(0, 4).toString('hex');\n    let mimeType = 'image/png';\n\n    if (magic.startsWith('89504e47')) {\n      mimeType = 'image/png';\n    } else if (magic.startsWith('ffd8ff')) {\n      mimeType = 'image/jpeg';\n    } else if (magic.startsWith('47494638')) {\n      mimeType = 'image/gif';\n    } else if (magic.startsWith('52494646')) {\n      mimeType = 'image/webp';\n    }\n\n    const dataUri = `data:${mimeType};base64,${base64Image}`;\n\n    return {\n      success: true,\n      dataUri,\n      format: mimeType,\n    };\n  } catch (error: any) {\n    return {\n      success: false,\n      error: error.message,\n    };\n  }\n}\n\n/**\n * Check if clipboard contains an image (quick check)\n */\nexport async function hasClipboardImage(): Promise<boolean> {\n  const platform = os.platform();\n\n  try {\n    switch (platform) {\n      case 'darwin':\n        // Check if clipboard has image data\n        const { stdout } = await execAsync('osascript -e \"clipboard info\"');\n        return stdout.includes('class PNGf') || stdout.includes('public.png');\n\n      case 'linux':\n        // Try xclip\n        try {\n          await execAsync('xclip -selection clipboard -t TARGETS -o | grep -q image');\n          return true;\n        } catch {\n          return false;\n        }\n\n      case 'win32':\n        // PowerShell check\n        const psCheck = `\n          Add-Type -AssemblyName System.Windows.Forms;\n          if ([System.Windows.Forms.Clipboard]::GetImage() -ne $null) {\n            Write-Output 'true'\n          } else {\n            Write-Output 'false'\n          }\n        `;\n        const { stdout: result } = await execAsync(`powershell -Command \"${psCheck}\"`);\n        return result.trim() === 'true';\n\n      default:\n        return false;\n    }\n  } catch {\n    return false;\n  }\n}\n","/**\n * Pre-built tools for agents\n *\n * Import and use with your agents:\n *\n * ```typescript\n * import { tools } from '@oneringai/agents';\n *\n * const agent = client.agents.create({\n *   provider: 'openai',\n *   model: 'gpt-4',\n *   tools: [tools.jsonManipulator, tools.webSearch, tools.webFetch]\n * });\n * ```\n */\n\n// JSON tools\nexport { jsonManipulator } from './json/jsonManipulator.js';\n\n// Web tools\nexport { webFetch, webFetchJS, webSearch } from './web/index.js';\n\n// Code execution tools\nexport { executeJavaScript, createExecuteJavaScriptTool } from './code/index.js';\n\n// Future tool exports\n// export { fileReader } from './file/fileReader.js';\n","/**\n * Path utilities for dot notation path manipulation in JSON objects\n */\n\n/**\n * Parse dot notation path into array of keys\n *\n * Examples:\n *   'user.name'  ['user', 'name']\n *   'users.0.name'  ['users', '0', 'name']\n *   'settings.theme.colors.primary'  ['settings', 'theme', 'colors', 'primary']\n *   ''  []\n */\nexport function parsePath(path: string): string[] {\n  if (path === '' || path === '$') {\n    return [];\n  }\n\n  const keys = path.split('.');\n\n  // Filter out empty strings (from consecutive dots)\n  const filtered = keys.filter((p) => p.length > 0);\n\n  // Validate no consecutive dots\n  if (filtered.length !== keys.length) {\n    throw new Error(`Invalid path format: ${path} (consecutive dots not allowed)`);\n  }\n\n  return filtered;\n}\n\n/**\n * Get value at path in object\n *\n * Returns undefined if path doesn't exist\n */\nexport function getValueAtPath(obj: any, path: string): any {\n  const keys = parsePath(path);\n  let current = obj;\n\n  for (const key of keys) {\n    if (current === null || current === undefined) {\n      return undefined;\n    }\n\n    // Handle both object properties and array indices\n    current = current[key];\n  }\n\n  return current;\n}\n\n/**\n * Set value at path in object (mutates the object)\n *\n * Creates intermediate objects/arrays as needed\n *\n * @returns true if successful\n * @throws Error if path is invalid or root-level\n */\nexport function setValueAtPath(obj: any, path: string, value: any): boolean {\n  const keys = parsePath(path);\n\n  if (keys.length === 0) {\n    throw new Error('Cannot set root object - path must not be empty');\n  }\n\n  let current = obj;\n\n  // Navigate to parent of target\n  for (let i = 0; i < keys.length - 1; i++) {\n    const key = keys[i]!;\n\n    // Create intermediate objects/arrays if they don't exist\n    if (!(key in current) || current[key] === null || current[key] === undefined) {\n      // Check if next key is numeric (array index)\n      const nextKey = keys[i + 1];\n      const isArrayIndex = nextKey !== undefined && /^\\d+$/.test(nextKey);\n\n      current[key] = isArrayIndex ? [] : {};\n    }\n\n    current = current[key];\n\n    // Validate we can continue navigation\n    if (current === null || current === undefined) {\n      throw new Error(`Cannot navigate through null/undefined at path: ${keys.slice(0, i + 1).join('.')}`);\n    }\n  }\n\n  // Set the final value\n  const lastKey = keys[keys.length - 1]!;\n\n  // For arrays, handle numeric indices\n  if (Array.isArray(current)) {\n    const index = parseInt(lastKey);\n    if (isNaN(index)) {\n      throw new Error(`Array index must be numeric, got: ${lastKey}`);\n    }\n    // Allow appending beyond array length\n    current[index] = value;\n  } else {\n    current[lastKey] = value;\n  }\n\n  return true;\n}\n\n/**\n * Delete value at path in object (mutates the object)\n *\n * @returns true if deleted, false if path doesn't exist\n * @throws Error if path is invalid or root-level\n */\nexport function deleteAtPath(obj: any, path: string): boolean {\n  const keys = parsePath(path);\n\n  if (keys.length === 0) {\n    throw new Error('Cannot delete root object - path must not be empty');\n  }\n\n  let current = obj;\n\n  // Navigate to parent\n  for (let i = 0; i < keys.length - 1; i++) {\n    const key = keys[i]!;\n\n    if (!(key in current)) {\n      return false; // Path doesn't exist\n    }\n\n    current = current[key];\n\n    if (current === null || current === undefined) {\n      return false; // Can't navigate further\n    }\n  }\n\n  const lastKey = keys[keys.length - 1]!;\n\n  // Check if key exists\n  if (!(lastKey in current)) {\n    return false;\n  }\n\n  // Delete from array or object\n  if (Array.isArray(current)) {\n    const index = parseInt(lastKey);\n    if (isNaN(index) || index < 0 || index >= current.length) {\n      return false;\n    }\n    current.splice(index, 1);\n  } else {\n    delete current[lastKey];\n  }\n\n  return true;\n}\n\n/**\n * Check if path exists in object\n */\nexport function pathExists(obj: any, path: string): boolean {\n  try {\n    const value = getValueAtPath(obj, path);\n    return value !== undefined;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Validate path format\n *\n * @returns true if valid, throws Error with message if invalid\n */\nexport function validatePath(path: string): boolean {\n  // Empty path is valid (represents root)\n  if (path === '' || path === '$') {\n    return true;\n  }\n\n  // Check for invalid characters\n  if (path.includes('..')) {\n    throw new Error('Invalid path: consecutive dots not allowed');\n  }\n\n  if (path.startsWith('.') || path.endsWith('.')) {\n    throw new Error('Invalid path: cannot start or end with dot');\n  }\n\n  // Try to parse it\n  parsePath(path);\n\n  return true;\n}\n","/**\n * JSON Manipulation Tool\n *\n * Allows AI agents to manipulate JSON objects using dot notation paths.\n * Supports delete, add, and replace operations at any depth.\n */\n\nimport { ToolFunction } from '../../domain/entities/Tool.js';\nimport { setValueAtPath, deleteAtPath, pathExists } from './pathUtils.js';\n\ninterface JsonManipulateArgs {\n  operation: 'delete' | 'add' | 'replace';\n  path: string;\n  value?: any;\n  object: any;\n}\n\ninterface JsonManipulateResult {\n  success: boolean;\n  result: any | null;\n  message?: string;\n  error?: string;\n}\n\nexport const jsonManipulator: ToolFunction<JsonManipulateArgs, JsonManipulateResult> = {\n  definition: {\n    type: 'function',\n    function: {\n      name: 'json_manipulate',\n      description: `Manipulate JSON objects by deleting, adding, or replacing fields at any depth.\n\nIMPORTANT - PATH FORMAT (DOT NOTATION):\nUse dots to separate nested field names. Examples:\n Top-level field: \"name\"\n Nested field: \"user.email\"\n Array element: \"users.0.name\" (where 0 is the array index)\n Deep nesting: \"settings.theme.colors.primary\"\n For root operations: use empty string \"\"\n\nOPERATIONS:\n\n1. DELETE - Remove a field from the object\n    Removes the specified field and its value\n    Returns error if path doesn't exist\n    Example: operation=\"delete\", path=\"user.address.city\"\n    Result: The city field is removed from user.address\n\n2. ADD - Add a new field to the object\n    Creates intermediate objects/arrays if they don't exist\n    If field already exists, it will be overwritten\n    Example: operation=\"add\", path=\"user.phone\", value=\"+1234567890\"\n    Result: Creates user.phone field with the phone number\n\n3. REPLACE - Replace the value of an EXISTING field\n    Only works if the field already exists (use ADD for new fields)\n    Returns error if path doesn't exist\n    Example: operation=\"replace\", path=\"user.name\", value=\"Jane Doe\"\n    Result: Changes the existing user.name value\n\nARRAY OPERATIONS:\n Access array elements by index: \"users.0.name\" (first user's name)\n Add to array: \"users.2\" appends if index >= array length\n Delete from array: \"users.1\" removes element and shifts remaining items\n\nCOMPLETE EXAMPLES:\n\nExample 1 - Delete a field:\n  Input: { operation: \"delete\", path: \"user.email\", object: {user: {name: \"John\", email: \"j@ex.com\"}} }\n  Output: {user: {name: \"John\"}}\n\nExample 2 - Add nested field (auto-creates intermediate objects):\n  Input: { operation: \"add\", path: \"user.address.city\", value: \"Paris\", object: {user: {name: \"John\"}} }\n  Output: {user: {name: \"John\", address: {city: \"Paris\"}}}\n\nExample 3 - Replace value:\n  Input: { operation: \"replace\", path: \"settings.theme\", value: \"dark\", object: {settings: {theme: \"light\"}} }\n  Output: {settings: {theme: \"dark\"}}\n\nExample 4 - Array manipulation:\n  Input: { operation: \"replace\", path: \"users.0.active\", value: false, object: {users: [{name: \"Bob\", active: true}]} }\n  Output: {users: [{name: \"Bob\", active: false}]}\n\nThe tool returns a result object with:\n success: boolean (true if operation succeeded)\n result: the modified JSON object (or null if failed)\n message: success message (if succeeded)\n error: error description (if failed)`,\n\n      parameters: {\n        type: 'object',\n        properties: {\n          operation: {\n            type: 'string',\n            enum: ['delete', 'add', 'replace'],\n            description:\n              'The operation to perform. \"delete\" removes a field, \"add\" creates a new field (or overwrites existing), \"replace\" changes an existing field value.',\n          },\n          path: {\n            type: 'string',\n            description:\n              'Dot notation path to the field. Examples: \"name\", \"user.email\", \"users.0.name\", \"settings.theme.colors.primary\". Use empty string \"\" only for root-level operations.',\n          },\n          value: {\n            description:\n              'The value to add or replace. Can be any JSON-compatible type: string, number, boolean, object, array, or null. Required for add/replace operations, ignored for delete.',\n          },\n          object: {\n            type: 'object',\n            description:\n              'The JSON object to manipulate. The original object is not modified; a new modified copy is returned in the result.',\n          },\n        },\n        required: ['operation', 'path', 'object'],\n      },\n    },\n    blocking: true, // Always wait for result\n    timeout: 10000, // 10 seconds should be plenty for JSON operations\n  },\n\n  execute: async (args: JsonManipulateArgs): Promise<JsonManipulateResult> => {\n    try {\n      // Validate operation\n      if (!['delete', 'add', 'replace'].includes(args.operation)) {\n        return {\n          success: false,\n          result: null,\n          error: `Invalid operation: \"${args.operation}\". Must be \"delete\", \"add\", or \"replace\".`,\n        };\n      }\n\n      // Validate object is provided\n      if (!args.object || typeof args.object !== 'object') {\n        return {\n          success: false,\n          result: null,\n          error: 'Invalid object: must provide a valid JSON object',\n        };\n      }\n\n      // Clone object to avoid mutation (deep clone)\n      let clonedObject: any;\n      try {\n        clonedObject = JSON.parse(JSON.stringify(args.object));\n      } catch (error: any) {\n        return {\n          success: false,\n          result: null,\n          error: `Cannot clone object: ${error.message}. Object may contain circular references or non-JSON values.`,\n        };\n      }\n\n      // Perform operation\n      switch (args.operation) {\n        case 'delete': {\n          try {\n            const deleted = deleteAtPath(clonedObject, args.path);\n\n            if (!deleted) {\n              return {\n                success: false,\n                result: null,\n                error: `Path not found: \"${args.path}\". The field does not exist in the object.`,\n              };\n            }\n\n            return {\n              success: true,\n              result: clonedObject,\n              message: `Successfully deleted field at path: \"${args.path}\"`,\n            };\n          } catch (error: any) {\n            return {\n              success: false,\n              result: null,\n              error: `Delete operation failed: ${error.message}`,\n            };\n          }\n        }\n\n        case 'add': {\n          // Validate value is provided\n          if (args.value === undefined) {\n            return {\n              success: false,\n              result: null,\n              error: 'Add operation requires a \"value\" parameter',\n            };\n          }\n\n          try {\n            setValueAtPath(clonedObject, args.path, args.value);\n\n            return {\n              success: true,\n              result: clonedObject,\n              message: `Successfully added field at path: \"${args.path}\"`,\n            };\n          } catch (error: any) {\n            return {\n              success: false,\n              result: null,\n              error: `Add operation failed: ${error.message}`,\n            };\n          }\n        }\n\n        case 'replace': {\n          // Validate value is provided\n          if (args.value === undefined) {\n            return {\n              success: false,\n              result: null,\n              error: 'Replace operation requires a \"value\" parameter',\n            };\n          }\n\n          // Check if path exists (replace only works on existing paths)\n          if (!pathExists(clonedObject, args.path)) {\n            return {\n              success: false,\n              result: null,\n              error: `Path not found: \"${args.path}\". Use \"add\" operation to create new fields.`,\n            };\n          }\n\n          try {\n            setValueAtPath(clonedObject, args.path, args.value);\n\n            return {\n              success: true,\n              result: clonedObject,\n              message: `Successfully replaced value at path: \"${args.path}\"`,\n            };\n          } catch (error: any) {\n            return {\n              success: false,\n              result: null,\n              error: `Replace operation failed: ${error.message}`,\n            };\n          }\n        }\n\n        default:\n          return {\n            success: false,\n            result: null,\n            error: `Unknown operation: ${args.operation}`,\n          };\n      }\n    } catch (error: any) {\n      return {\n        success: false,\n        result: null,\n        error: `Unexpected error manipulating JSON: ${error.message}`,\n      };\n    }\n  },\n};\n","/**\n * Content quality detection for web scraping\n * Detects if content is valid, requires JavaScript, or has errors\n */\n\nimport type { CheerioAPI } from 'cheerio';\n\nexport interface QualityResult {\n  score: number; // 0-100\n  requiresJS: boolean;\n  suggestion?: string;\n  issues: string[];\n}\n\n/**\n * Detect content quality from HTML and extracted text\n */\nexport function detectContentQuality(\n  html: string,\n  text: string,\n  $: CheerioAPI\n): QualityResult {\n  const issues: string[] = [];\n  let score = 100;\n  let requiresJS = false;\n\n  // Check 1: Empty or very short content\n  if (text.length < 100) {\n    issues.push('Very little text content extracted');\n    score -= 40;\n    requiresJS = true;\n  }\n\n  // Check 2: Detect common error patterns\n  const errorPatterns = [\n    { pattern: /access denied/i, penalty: 50 },\n    { pattern: /403 forbidden/i, penalty: 50 },\n    { pattern: /404 not found/i, penalty: 50 },\n    { pattern: /page not found/i, penalty: 40 },\n    { pattern: /cloudflare/i, penalty: 30 },\n    { pattern: /please enable javascript/i, penalty: 40 },\n    { pattern: /requires javascript/i, penalty: 40 },\n    { pattern: /robot|bot detection/i, penalty: 30 },\n  ];\n\n  for (const { pattern, penalty } of errorPatterns) {\n    if (pattern.test(html) || pattern.test(text)) {\n      issues.push(`Error pattern detected: ${pattern.source}`);\n      score -= penalty;\n    }\n  }\n\n  // Check 3: Mostly script tags (code dumps)\n  const scriptCount = $('script').length;\n  const textLength = text.length;\n\n  if (scriptCount > 10 && textLength < 500) {\n    issues.push('Page is mostly JavaScript code (code dump)');\n    score -= 40;\n    requiresJS = true;\n  }\n\n  // Check 4: High script-to-content ratio\n  const scriptLength = $('script').text().length;\n  if (scriptLength > textLength * 2 && textLength < 1000) {\n    issues.push('High JavaScript-to-content ratio');\n    score -= 20;\n    requiresJS = true;\n  }\n\n  // Check 5: Common JS framework markers\n  const jsFrameworks = [\n    { pattern: /\\breact\\b/i, name: 'React' },\n    { pattern: /\\bvue\\b/i, name: 'Vue' },\n    { pattern: /\\bangular\\b/i, name: 'Angular' },\n    { pattern: /__NEXT_DATA__/i, name: 'Next.js' },\n    { pattern: /\\bwebpack\\b/i, name: 'Webpack' },\n    { pattern: /_app-.*\\.js/i, name: 'SPA' },\n  ];\n\n  for (const framework of jsFrameworks) {\n    if (framework.pattern.test(html)) {\n      issues.push(`${framework.name} framework detected`);\n      requiresJS = true;\n    }\n  }\n\n  // Check 6: Empty body with divs (typical SPA)\n  const bodyText = $('body').text().trim();\n  const divCount = $('div').length;\n\n  if (bodyText.length < 100 && divCount > 5) {\n    issues.push('Empty body with many divs (likely Single Page App)');\n    score -= 30;\n    requiresJS = true;\n  }\n\n  // Check 7: Noscript tag with meaningful content\n  const noscript = $('noscript').text();\n  if (noscript.length > 50) {\n    issues.push('Noscript tag present (site requires JavaScript)');\n    requiresJS = true;\n  }\n\n  // Check 8: Very few paragraphs/headings (typical of SPA skeleton)\n  const paragraphCount = $('p').length;\n  const headingCount = $('h1, h2, h3, h4, h5, h6').length;\n\n  if (paragraphCount < 3 && headingCount < 2 && textLength < 500) {\n    issues.push('Very few content elements (likely needs JavaScript)');\n    score -= 20;\n    requiresJS = true;\n  }\n\n  // Generate suggestion\n  let suggestion: string | undefined;\n  if (requiresJS && score < 50) {\n    suggestion =\n      'Content quality is low. This appears to be a JavaScript-rendered site. Use the web_fetch_js tool for better results.';\n  } else if (score < 30) {\n    suggestion = 'Content extraction failed or page has errors. Check the URL and try again.';\n  }\n\n  return {\n    score: Math.max(0, Math.min(100, score)),\n    requiresJS,\n    suggestion,\n    issues,\n  };\n}\n\n/**\n * Check if content looks like an error page\n */\nexport function isErrorPage(statusCode: number, html: string, text: string): boolean {\n  if (statusCode >= 400) return true;\n\n  const errorIndicators = [\n    /404|not found/i,\n    /403|forbidden|access denied/i,\n    /500|internal server error/i,\n    /503|service unavailable/i,\n  ];\n\n  for (const pattern of errorIndicators) {\n    if (pattern.test(html) || pattern.test(text)) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\n/**\n * Extract clean text content from HTML\n */\nexport function extractCleanText($: CheerioAPI): string {\n  // Remove unwanted elements\n  $('script, style, noscript, iframe, nav, footer, header, aside').remove();\n\n  // Remove common ad/tracking divs\n  $('[class*=\"ad-\"], [class*=\"advertisement\"], [id*=\"ad-\"]').remove();\n  $('[class*=\"cookie\"], [class*=\"gdpr\"]').remove();\n\n  // Get text from main content areas (prioritized)\n  const mainSelectors = [\n    'main',\n    'article',\n    '[role=\"main\"]',\n    '.content',\n    '#content',\n    '.post',\n    '.article',\n  ];\n\n  for (const selector of mainSelectors) {\n    const mainContent = $(selector).text().trim();\n    if (mainContent.length > 200) {\n      return mainContent;\n    }\n  }\n\n  // Fallback to body\n  return $('body').text().trim();\n}\n","/**\n * Web Fetch Tool - Simple HTTP fetch with content quality detection\n */\n\nimport { load } from 'cheerio';\nimport { ToolFunction } from '../../domain/entities/Tool.js';\nimport { detectContentQuality, extractCleanText } from './contentDetector.js';\n\ninterface WebFetchArgs {\n  url: string;\n  userAgent?: string;\n  timeout?: number;\n}\n\ninterface WebFetchResult {\n  success: boolean;\n  url: string;\n  title: string;\n  content: string;\n  html: string;\n  contentType: 'html' | 'json' | 'text' | 'error';\n  qualityScore: number;\n  requiresJS: boolean;\n  suggestedAction?: string;\n  issues?: string[];\n  error?: string;\n}\n\nexport const webFetch: ToolFunction<WebFetchArgs, WebFetchResult> = {\n  definition: {\n    type: 'function',\n    function: {\n      name: 'web_fetch',\n      description: `Fetch and extract text content from a web page URL.\n\nIMPORTANT: This tool performs a simple HTTP fetch and HTML parsing. It works well for:\n- Static websites (blogs, documentation, articles)\n- Server-rendered HTML pages\n- Content that doesn't require JavaScript\n\nLIMITATIONS:\n- Cannot execute JavaScript\n- May fail on React/Vue/Angular sites (will return low quality score)\n- May get blocked by bot protection\n- Cannot handle dynamic content loading\n\nQUALITY DETECTION:\nThe tool analyzes the fetched content and returns a quality score (0-100):\n- 80-100: Excellent quality, content extracted successfully\n- 50-79: Moderate quality, some content extracted\n- 0-49: Low quality, likely needs JavaScript or has errors\n\nIf the quality score is low or requiresJS is true, the tool will suggest using 'web_fetch_js' instead.\n\nRETURNS:\n{\n  success: boolean,\n  url: string,\n  title: string,\n  content: string,          // Extracted text (clean, no scripts/styles)\n  html: string,             // Raw HTML\n  contentType: string,      // 'html' | 'json' | 'text' | 'error'\n  qualityScore: number,     // 0-100 (quality of extraction)\n  requiresJS: boolean,      // True if site likely needs JavaScript\n  suggestedAction: string,  // Suggestion if quality is low\n  issues: string[],         // List of detected issues\n  error: string             // Error message if failed\n}\n\nEXAMPLE:\nTo fetch a blog post:\n{\n  url: \"https://example.com/blog/article\"\n}\n\nWith custom user agent:\n{\n  url: \"https://example.com/page\",\n  userAgent: \"Mozilla/5.0 (Windows NT 10.0; Win64; x64)...\",\n  timeout: 15000\n}`,\n\n      parameters: {\n        type: 'object',\n        properties: {\n          url: {\n            type: 'string',\n            description: 'The URL to fetch. Must start with http:// or https://',\n          },\n          userAgent: {\n            type: 'string',\n            description: 'Optional custom user agent string. Default is a generic bot user agent.',\n          },\n          timeout: {\n            type: 'number',\n            description: 'Timeout in milliseconds (default: 10000)',\n          },\n        },\n        required: ['url'],\n      },\n    },\n    blocking: true,\n    timeout: 15000,\n  },\n\n  execute: async (args: WebFetchArgs): Promise<WebFetchResult> => {\n    try {\n      // Validate URL\n      try {\n        new URL(args.url);\n      } catch {\n        return {\n          success: false,\n          url: args.url,\n          title: '',\n          content: '',\n          html: '',\n          contentType: 'error',\n          qualityScore: 0,\n          requiresJS: false,\n          error: 'Invalid URL format',\n        };\n      }\n\n      // Fetch with timeout\n      const controller = new AbortController();\n      const timeoutId = setTimeout(() => controller.abort(), args.timeout || 10000);\n\n      const response = await fetch(args.url, {\n        headers: {\n          'User-Agent':\n            args.userAgent ||\n            'Mozilla/5.0 (compatible; OneRingAI/1.0; +https://github.com/oneringai/agents)',\n          Accept: 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',\n          'Accept-Language': 'en-US,en;q=0.9',\n        },\n        signal: controller.signal,\n      });\n\n      clearTimeout(timeoutId);\n\n      // Check response status\n      if (!response.ok) {\n        return {\n          success: false,\n          url: args.url,\n          title: '',\n          content: '',\n          html: '',\n          contentType: 'error',\n          qualityScore: 0,\n          requiresJS: false,\n          error: `HTTP ${response.status}: ${response.statusText}`,\n        };\n      }\n\n      // Get content type\n      const contentType = response.headers.get('content-type') || '';\n\n      // Handle JSON responses\n      if (contentType.includes('application/json')) {\n        const json = await response.json();\n        return {\n          success: true,\n          url: args.url,\n          title: 'JSON Response',\n          content: JSON.stringify(json, null, 2),\n          html: '',\n          contentType: 'json',\n          qualityScore: 100,\n          requiresJS: false,\n        };\n      }\n\n      // Handle plain text\n      if (contentType.includes('text/plain')) {\n        const text = await response.text();\n        return {\n          success: true,\n          url: args.url,\n          title: 'Text Response',\n          content: text,\n          html: text,\n          contentType: 'text',\n          qualityScore: 100,\n          requiresJS: false,\n        };\n      }\n\n      // Get HTML\n      const html = await response.text();\n\n      // Parse with cheerio\n      const $ = load(html);\n\n      // Extract title\n      const title = $('title').text() || $('h1').first().text() || 'Untitled';\n\n      // Extract clean text content\n      const content = extractCleanText($);\n\n      // Detect content quality\n      const quality = detectContentQuality(html, content, $);\n\n      return {\n        success: true,\n        url: args.url,\n        title,\n        content,\n        html,\n        contentType: 'html',\n        qualityScore: quality.score,\n        requiresJS: quality.requiresJS,\n        suggestedAction: quality.suggestion,\n        issues: quality.issues,\n      };\n    } catch (error: any) {\n      // Handle abort errors specially\n      if (error.name === 'AbortError') {\n        return {\n          success: false,\n          url: args.url,\n          title: '',\n          content: '',\n          html: '',\n          contentType: 'error',\n          qualityScore: 0,\n          requiresJS: false,\n          error: `Request timeout after ${args.timeout || 10000}ms`,\n        };\n      }\n\n      return {\n        success: false,\n        url: args.url,\n        title: '',\n        content: '',\n        html: '',\n        contentType: 'error',\n        qualityScore: 0,\n        requiresJS: false,\n        error: (error as Error).message,\n      };\n    }\n  },\n};\n","/**\n * Web Fetch with JavaScript - Uses Puppeteer for JS-rendered sites\n * Optional tool - requires puppeteer to be installed\n */\n\nimport { load } from 'cheerio';\nimport { ToolFunction } from '../../domain/entities/Tool.js';\n\n// Lazy-load Puppeteer (optional dependency)\nlet puppeteerModule: any = null;\nlet browserInstance: any = null;\n\ninterface WebFetchJSArgs {\n  url: string;\n  waitForSelector?: string;\n  timeout?: number;\n  takeScreenshot?: boolean;\n}\n\ninterface WebFetchJSResult {\n  success: boolean;\n  url: string;\n  title: string;\n  content: string;\n  html: string;\n  screenshot?: string;\n  loadTime: number;\n  error?: string;\n  suggestion?: string;\n}\n\n/**\n * Load Puppeteer dynamically (only when needed)\n */\nasync function loadPuppeteer(): Promise<any> {\n  if (!puppeteerModule) {\n    try {\n      puppeteerModule = await import('puppeteer');\n    } catch (error) {\n      throw new Error('Puppeteer not installed');\n    }\n  }\n  return puppeteerModule;\n}\n\n/**\n * Get or create browser instance (reuse for performance)\n */\nasync function getBrowser(): Promise<any> {\n  if (!browserInstance) {\n    const puppeteer = await loadPuppeteer();\n\n    browserInstance = await puppeteer.launch({\n      headless: true,\n      args: ['--no-sandbox', '--disable-setuid-sandbox', '--disable-dev-shm-usage'],\n    });\n\n    // Cleanup on process exit\n    process.on('exit', async () => {\n      if (browserInstance) {\n        await browserInstance.close();\n      }\n    });\n  }\n  return browserInstance;\n}\n\nexport const webFetchJS: ToolFunction<WebFetchJSArgs, WebFetchJSResult> = {\n  definition: {\n    type: 'function',\n    function: {\n      name: 'web_fetch_js',\n      description: `Fetch and extract content from JavaScript-rendered websites using a headless browser (Puppeteer).\n\nUSE THIS TOOL WHEN:\n- The web_fetch tool returned a low quality score (<50)\n- The web_fetch tool suggested using JavaScript rendering\n- You know the website is built with React/Vue/Angular/Next.js\n- Content loads dynamically via JavaScript\n- The page requires interaction (though this tool doesn't support interaction yet)\n\nHOW IT WORKS:\n- Launches a headless Chrome browser\n- Navigates to the URL\n- Waits for JavaScript to execute and content to load\n- Extracts the rendered HTML and text content\n- Optionally captures a screenshot\n\nCAPABILITIES:\n- Executes all JavaScript on the page\n- Waits for network to be idle (all resources loaded)\n- Can wait for specific CSS selectors to appear\n- Handles React, Vue, Angular, Next.js, and other SPAs\n- Returns content after full JavaScript execution\n\nLIMITATIONS:\n- Slower than web_fetch (typically 3-10 seconds vs <1 second)\n- Uses more system resources (runs a full browser)\n- May still fail on sites with aggressive bot detection\n- Requires puppeteer to be installed (npm install puppeteer)\n\nPERFORMANCE:\n- First call: Slower (launches browser ~1-2s)\n- Subsequent calls: Faster (reuses browser instance)\n\nRETURNS:\n{\n  success: boolean,\n  url: string,\n  title: string,\n  content: string,         // Extracted text after JS execution\n  html: string,            // Full HTML after JS execution\n  screenshot: string,      // Base64 PNG screenshot (if requested)\n  loadTime: number,        // Time taken in milliseconds\n  error: string           // Error message if failed\n}\n\nEXAMPLES:\nBasic usage:\n{\n  url: \"https://react-app.com/page\"\n}\n\nWait for specific content:\n{\n  url: \"https://app.com/dashboard\",\n  waitForSelector: \"#main-content\",  // Wait for this element\n  timeout: 20000\n}\n\nWith screenshot:\n{\n  url: \"https://site.com\",\n  takeScreenshot: true\n}`,\n\n      parameters: {\n        type: 'object',\n        properties: {\n          url: {\n            type: 'string',\n            description: 'The URL to fetch. Must start with http:// or https://',\n          },\n          waitForSelector: {\n            type: 'string',\n            description:\n              'Optional CSS selector to wait for before extracting content. Example: \"#main-content\" or \".article-body\"',\n          },\n          timeout: {\n            type: 'number',\n            description: 'Max wait time in milliseconds (default: 15000)',\n          },\n          takeScreenshot: {\n            type: 'boolean',\n            description:\n              'Whether to capture a screenshot of the page (default: false). Screenshot returned as base64 PNG.',\n          },\n        },\n        required: ['url'],\n      },\n    },\n    blocking: true,\n    timeout: 30000, // Allow extra time for browser operations\n  },\n\n  execute: async (args: WebFetchJSArgs): Promise<WebFetchJSResult> => {\n    let page: any = null;\n\n    try {\n      // Try to get browser (will throw if Puppeteer not installed)\n      const browser = await getBrowser();\n      page = await browser.newPage();\n\n      // Set viewport\n      await page.setViewport({ width: 1280, height: 800 });\n\n      // Set user agent\n      await page.setUserAgent(\n        'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36'\n      );\n\n      const startTime = Date.now();\n\n      // Navigate to URL\n      await page.goto(args.url, {\n        waitUntil: 'networkidle2', // Wait until network is mostly idle\n        timeout: args.timeout || 15000,\n      });\n\n      // Wait for selector if provided\n      if (args.waitForSelector) {\n        await page.waitForSelector(args.waitForSelector, {\n          timeout: args.timeout || 15000,\n        });\n      }\n\n      // Get HTML after JS execution\n      const html = await page.content();\n\n      // Extract text content using cheerio\n      const $ = load(html);\n\n      // Remove unwanted elements\n      $('script, style, noscript, iframe, nav, footer, header, aside').remove();\n\n      // Extract text\n      const content = $('body').text().trim();\n\n      // Get title\n      const title = await page.title();\n\n      const loadTime = Date.now() - startTime;\n\n      // Take screenshot if requested\n      let screenshot: string | undefined;\n      if (args.takeScreenshot) {\n        const buffer = await page.screenshot({\n          type: 'png',\n          fullPage: false, // Just viewport\n        });\n        screenshot = buffer.toString('base64');\n      }\n\n      await page.close();\n\n      return {\n        success: true,\n        url: args.url,\n        title,\n        content,\n        html,\n        screenshot,\n        loadTime,\n      };\n    } catch (error: any) {\n      if (page) {\n        try {\n          await page.close();\n        } catch {\n          // Ignore close errors\n        }\n      }\n\n      // Check if it's a Puppeteer not installed error\n      if ((error as Error).message === 'Puppeteer not installed') {\n        return {\n          success: false,\n          url: args.url,\n          title: '',\n          content: '',\n          html: '',\n          loadTime: 0,\n          error: 'Puppeteer is not installed',\n          suggestion:\n            'Install Puppeteer with: npm install puppeteer (note: downloads ~50MB Chrome binary)',\n        };\n      }\n\n      return {\n        success: false,\n        url: args.url,\n        title: '',\n        content: '',\n        html: '',\n        loadTime: 0,\n        error: (error as Error).message,\n      };\n    }\n  },\n};\n","/**\n * Serper.dev search provider\n * Fast Google search results via API\n */\n\nexport interface SearchResult {\n  title: string;\n  url: string;\n  snippet: string;\n  position: number;\n}\n\nexport async function searchWithSerper(\n  query: string,\n  numResults: number,\n  apiKey: string\n): Promise<SearchResult[]> {\n  const response = await fetch('https://google.serper.dev/search', {\n    method: 'POST',\n    headers: {\n      'X-API-KEY': apiKey,\n      'Content-Type': 'application/json',\n    },\n    body: JSON.stringify({\n      q: query,\n      num: numResults,\n    }),\n  });\n\n  if (!response.ok) {\n    throw new Error(`Serper API error: ${response.status} ${response.statusText}`);\n  }\n\n  const data: any = await response.json();\n\n  if (!data.organic || !Array.isArray(data.organic)) {\n    throw new Error('Invalid response from Serper API');\n  }\n\n  return data.organic.slice(0, numResults).map((result: any, index: number) => ({\n    title: result.title || 'Untitled',\n    url: result.link || '',\n    snippet: result.snippet || '',\n    position: index + 1,\n  }));\n}\n","/**\n * Brave Search API provider\n * Independent search index (privacy-focused)\n */\n\nimport type { SearchResult } from './serper.js';\n\nexport async function searchWithBrave(\n  query: string,\n  numResults: number,\n  apiKey: string\n): Promise<SearchResult[]> {\n  const url = `https://api.search.brave.com/res/v1/web/search?q=${encodeURIComponent(query)}&count=${numResults}`;\n\n  const response = await fetch(url, {\n    headers: {\n      'X-Subscription-Token': apiKey,\n      Accept: 'application/json',\n    },\n  });\n\n  if (!response.ok) {\n    throw new Error(`Brave API error: ${response.status} ${response.statusText}`);\n  }\n\n  const data: any = await response.json();\n\n  if (!data.web?.results || !Array.isArray(data.web.results)) {\n    throw new Error('Invalid response from Brave API');\n  }\n\n  return data.web.results.slice(0, numResults).map((result: any, index: number) => ({\n    title: result.title || 'Untitled',\n    url: result.url || '',\n    snippet: result.description || '',\n    position: index + 1,\n  }));\n}\n","/**\n * Tavily AI Search provider\n * AI-optimized search results with summaries\n */\n\nimport type { SearchResult } from './serper.js';\n\nexport async function searchWithTavily(\n  query: string,\n  numResults: number,\n  apiKey: string\n): Promise<SearchResult[]> {\n  const response = await fetch('https://api.tavily.com/search', {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n    },\n    body: JSON.stringify({\n      api_key: apiKey,\n      query,\n      max_results: numResults,\n      search_depth: 'basic', // 'basic' or 'advanced'\n      include_answer: false,\n      include_raw_content: false,\n    }),\n  });\n\n  if (!response.ok) {\n    throw new Error(`Tavily API error: ${response.status} ${response.statusText}`);\n  }\n\n  const data: any = await response.json();\n\n  if (!data.results || !Array.isArray(data.results)) {\n    throw new Error('Invalid response from Tavily API');\n  }\n\n  return data.results.slice(0, numResults).map((result: any, index: number) => ({\n    title: result.title || 'Untitled',\n    url: result.url || '',\n    snippet: result.content || '',\n    position: index + 1,\n  }));\n}\n","/**\n * Web Search Tool - Multi-provider web search\n * Supports Serper.dev (default), Brave, and Tavily\n */\n\nimport { ToolFunction } from '../../domain/entities/Tool.js';\nimport { searchWithSerper, type SearchResult } from './searchProviders/serper.js';\nimport { searchWithBrave } from './searchProviders/brave.js';\nimport { searchWithTavily } from './searchProviders/tavily.js';\n\ninterface WebSearchArgs {\n  query: string;\n  numResults?: number;\n  provider?: 'serper' | 'brave' | 'tavily';\n}\n\ninterface WebSearchResult {\n  success: boolean;\n  query: string;\n  provider: string;\n  results: SearchResult[];\n  count: number;\n  error?: string;\n}\n\nexport const webSearch: ToolFunction<WebSearchArgs, WebSearchResult> = {\n  definition: {\n    type: 'function',\n    function: {\n      name: 'web_search',\n      description: `Search the web and get relevant results with snippets.\n\nThis tool searches the web using a configured search provider.\n\nSEARCH PROVIDERS:\n- serper (default): Google search results via Serper.dev API. Fast (1-2s), 2,500 free queries.\n- brave: Brave's independent search index. Privacy-focused, no Google.\n- tavily: AI-optimized search with summaries tailored for LLMs.\n\nRETURNS:\nAn array of up to 10-20 search results, each containing:\n- title: Page title\n- url: Direct URL to the page\n- snippet: Short description/excerpt from the page\n- position: Search ranking position (1, 2, 3...)\n\nUSE CASES:\n- Find current information on any topic\n- Research multiple sources\n- Discover relevant websites\n- Get different perspectives on a topic\n- Find URLs to fetch with web_fetch tool\n\nWORKFLOW PATTERN:\n1. Use web_search to find relevant URLs\n2. Use web_fetch to get full content from top results\n3. Process and summarize the information\n\nEXAMPLE:\nBasic search:\n{\n  query: \"latest AI developments 2026\",\n  numResults: 5\n}\n\nWith specific provider:\n{\n  query: \"quantum computing news\",\n  numResults: 10,\n  provider: \"brave\"\n}\n\nIMPORTANT:\n- Requires API key to be set in environment variables\n- Default provider is \"serper\" (requires SERPER_API_KEY)\n- Returns empty results if API key not found`,\n\n      parameters: {\n        type: 'object',\n        properties: {\n          query: {\n            type: 'string',\n            description: 'The search query string. Be specific for better results.',\n          },\n          numResults: {\n            type: 'number',\n            description:\n              'Number of results to return (default: 10, max: 20). More results = more API cost.',\n          },\n          provider: {\n            type: 'string',\n            enum: ['serper', 'brave', 'tavily'],\n            description:\n              'Which search provider to use. Default is \"serper\". Each provider requires its own API key.',\n          },\n        },\n        required: ['query'],\n      },\n    },\n    blocking: true,\n    timeout: 10000,\n  },\n\n  execute: async (args: WebSearchArgs): Promise<WebSearchResult> => {\n    const provider = args.provider || 'serper';\n    const numResults = Math.min(args.numResults || 10, 20);\n\n    // Get API key from environment\n    const apiKey = getSearchAPIKey(provider);\n\n    if (!apiKey) {\n      return {\n        success: false,\n        query: args.query,\n        provider,\n        results: [],\n        count: 0,\n        error: `No API key found for ${provider}. Set ${getEnvVarName(provider)} in your .env file. See .env.example for details.`,\n      };\n    }\n\n    try {\n      let results: SearchResult[];\n\n      switch (provider) {\n        case 'serper':\n          results = await searchWithSerper(args.query, numResults, apiKey);\n          break;\n\n        case 'brave':\n          results = await searchWithBrave(args.query, numResults, apiKey);\n          break;\n\n        case 'tavily':\n          results = await searchWithTavily(args.query, numResults, apiKey);\n          break;\n\n        default:\n          throw new Error(`Unknown search provider: ${provider}`);\n      }\n\n      return {\n        success: true,\n        query: args.query,\n        provider,\n        results,\n        count: results.length,\n      };\n    } catch (error: any) {\n      return {\n        success: false,\n        query: args.query,\n        provider,\n        results: [],\n        count: 0,\n        error: (error as Error).message,\n      };\n    }\n  },\n};\n\n/**\n * Get search API key from environment\n */\nfunction getSearchAPIKey(provider: string): string | undefined {\n  switch (provider) {\n    case 'serper':\n      return process.env.SERPER_API_KEY;\n    case 'brave':\n      return process.env.BRAVE_API_KEY;\n    case 'tavily':\n      return process.env.TAVILY_API_KEY;\n    default:\n      return undefined;\n  }\n}\n\n/**\n * Get environment variable name for provider\n */\nfunction getEnvVarName(provider: string): string {\n  switch (provider) {\n    case 'serper':\n      return 'SERPER_API_KEY';\n    case 'brave':\n      return 'BRAVE_API_KEY';\n    case 'tavily':\n      return 'TAVILY_API_KEY';\n    default:\n      return 'UNKNOWN_API_KEY';\n  }\n}\n","/**\n * JavaScript Execution Tool\n * Executes JavaScript in a sandboxed VM with connector integration\n * Connectors provide authenticated access to external APIs (GitHub, Microsoft, etc.)\n */\n\nimport * as vm from 'vm';\nimport { ToolFunction } from '../../domain/entities/Tool.js';\nimport { Connector } from '../../core/Connector.js';\nimport { authenticatedFetch } from '../../connectors/authenticatedFetch.js';\n\ninterface ExecuteJSArgs {\n  code: string;\n  input?: any;\n  timeout?: number;\n}\n\ninterface ExecuteJSResult {\n  success: boolean;\n  result: any;\n  logs: string[];\n  error?: string;\n  executionTime: number;\n}\n\n/**\n * Generate the tool description with current connectors\n */\nfunction generateDescription(): string {\n  const connectors = Connector.listAll();\n  const connectorList = connectors.length > 0\n    ? connectors\n        .map(c => `    \"${c.name}\": ${c.displayName}\\n     ${c.config.description || 'No description'}\\n     Base URL: ${c.baseURL}`)\n        .join('\\n\\n')\n    : '   No connectors registered yet. Register connectors with Connector.create().';\n\n  return `Execute JavaScript code in a secure sandbox with connector integration.\n\nIMPORTANT: This tool runs JavaScript code in a sandboxed environment with authenticated access to external APIs via connectors.\n\nAVAILABLE IN CONTEXT:\n\n1. INPUT/OUTPUT:\n   - input: any data passed to your code\n   - output: SET THIS variable to return your result\n\n2. AUTHENTICATED FETCH:\n   - authenticatedFetch(url, options, connector, userId?)\n      url: Full URL or path\n      options: Standard fetch options { method: 'GET'|'POST'|..., body: ..., headers: ... }\n      connector: Connector name (see below)\n      userId: (optional) User identifier for multi-user apps\n      Returns: Promise<Response>\n\n   REGISTERED CONNECTORS:\n${connectorList}\n\n3. STANDARD FETCH:\n   - fetch(url, options) - No authentication\n\n4. CONNECTOR REGISTRY:\n   - connectors.list() - List available connectors\n   - connectors.get(name) - Get connector details\n\n5. UTILITIES:\n   - console.log/error/warn\n   - Buffer, JSON, Math, Date\n   - setTimeout, setInterval, Promise\n\nCODE PATTERN:\nAlways wrap your code in an async IIFE:\n\n(async () => {\n  // Your code here\n\n  // Single-user mode (default)\n  const response = await authenticatedFetch(url, options, 'github');\n\n  // OR Multi-user mode (if your app has multiple users)\n  const response = await authenticatedFetch(url, options, 'github', userId);\n\n  const data = await response.json();\n  output = data;\n})();\n\nSECURITY:\n- 10 second timeout (configurable)\n- No file system access\n- No process/child_process\n- No require/import\n- Memory limited\n\nRETURNS:\n{\n  success: boolean,\n  result: any,\n  logs: string[],\n  error?: string,\n  executionTime: number\n}`;\n}\n\n/**\n * Create an execute_javascript tool with the current connector state\n * Use this factory when you need the tool to reflect currently registered connectors\n */\nexport function createExecuteJavaScriptTool(): ToolFunction<ExecuteJSArgs, ExecuteJSResult> {\n  return {\n    definition: {\n      type: 'function',\n      function: {\n        name: 'execute_javascript',\n        description: generateDescription(),\n        parameters: {\n          type: 'object',\n          properties: {\n            code: {\n              type: 'string',\n              description:\n                'JavaScript code to execute. MUST set the \"output\" variable. Wrap in async IIFE for async operations.',\n            },\n            input: {\n              description: 'Optional input data available as \"input\" variable in your code',\n            },\n            timeout: {\n              type: 'number',\n              description: 'Execution timeout in milliseconds (default: 10000, max: 30000)',\n            },\n          },\n          required: ['code'],\n        },\n      },\n      blocking: true,\n      timeout: 35000, // Tool timeout (slightly more than max code timeout)\n    },\n\n    execute: async (args: ExecuteJSArgs): Promise<ExecuteJSResult> => {\n      const logs: string[] = [];\n      const startTime = Date.now();\n\n      try {\n        // Validate timeout\n        const timeout = Math.min(args.timeout || 10000, 30000);\n\n        // Execute in VM\n        const result = await executeInVM(args.code, args.input, timeout, logs);\n\n        return {\n          success: true,\n          result,\n          logs,\n          executionTime: Date.now() - startTime,\n        };\n      } catch (error) {\n        return {\n          success: false,\n          result: null,\n          logs,\n          error: (error as Error).message,\n          executionTime: Date.now() - startTime,\n        };\n      }\n    },\n  };\n}\n\n/**\n * Default executeJavaScript tool\n * NOTE: The description is generated at module load time. If you register\n * connectors after importing this, use createExecuteJavaScriptTool() instead.\n */\nexport const executeJavaScript: ToolFunction<ExecuteJSArgs, ExecuteJSResult> = createExecuteJavaScriptTool();\n\n/**\n * Execute code in Node.js vm module\n */\nasync function executeInVM(\n  code: string,\n  input: any,\n  timeout: number,\n  logs: string[]\n): Promise<any> {\n  // Create sandbox context\n  const sandbox: any = {\n    // Input/output\n    input: input || {},\n    output: null,\n\n    // Console (captured)\n    console: {\n      log: (...args: any[]) => logs.push(args.map((a) => String(a)).join(' ')),\n      error: (...args: any[]) => logs.push('ERROR: ' + args.map((a) => String(a)).join(' ')),\n      warn: (...args: any[]) => logs.push('WARN: ' + args.map((a) => String(a)).join(' ')),\n    },\n\n    // Authenticated fetch\n    authenticatedFetch,\n\n    // Standard fetch\n    fetch: globalThis.fetch,\n\n    // Connector info\n    connectors: {\n      list: () => Connector.list(),\n      get: (name: string) => {\n        try {\n          const connector = Connector.get(name);\n          return {\n            displayName: connector.displayName,\n            description: connector.config.description || '',\n            baseURL: connector.baseURL,\n          };\n        } catch {\n          return null;\n        }\n      },\n    },\n\n    // Standard globals\n    Buffer,\n    JSON,\n    Math,\n    Date,\n    setTimeout,\n    setInterval,\n    clearTimeout,\n    clearInterval,\n    Promise,\n\n    // Array/Object\n    Array,\n    Object,\n    String,\n    Number,\n    Boolean,\n  };\n\n  // Create VM context\n  const context = vm.createContext(sandbox);\n\n  // Wrap user code in async IIFE if not already wrapped\n  const wrappedCode = code.trim().startsWith('(async')\n    ? code\n    : `\n    (async () => {\n      ${code}\n      return output;\n    })()\n  `;\n\n  // Compile and run\n  const script = new vm.Script(wrappedCode);\n  const resultPromise = script.runInContext(context, {\n    timeout,\n    displayErrors: true,\n  });\n\n  // Wait for completion\n  const result = await resultPromise;\n\n  return result;\n}\n","/**\n * Provider Config Agent\n *\n * AI-powered agent that helps users configure OAuth providers\n * Asks questions, guides setup, and generates JSON configuration\n */\n\nimport { Agent } from '../core/Agent.js';\nimport { MessageBuilder } from '../utils/messageBuilder.js';\nimport { InputItem } from '../domain/entities/Message.js';\nimport { ConnectorConfigResult } from '../domain/entities/Connector.js';\n\n/**\n * Built-in agent for generating OAuth provider configurations\n */\nexport class ProviderConfigAgent {\n  private agent: Agent | null = null;\n  private conversationHistory: InputItem[] = [];\n  private connectorName: string;\n\n  /**\n   * Create a provider config agent\n   * @param connectorName - Name of the connector to use (must be created first with Connector.create())\n   */\n  constructor(connectorName: string = 'openai') {\n    this.connectorName = connectorName;\n  }\n\n  /**\n   * Start interactive configuration session\n   * AI will ask questions and generate the connector config\n   *\n   * @param initialInput - Optional initial message (e.g., \"I want to connect to GitHub\")\n   * @returns Promise<string | ConnectorConfigResult> - Either next question or final config\n   */\n  async run(initialInput?: string): Promise<string | ConnectorConfigResult> {\n    // Create agent with specialized instructions\n    this.agent = Agent.create({\n      connector: this.connectorName,\n      model: this.getDefaultModel(),\n      instructions: this.getSystemInstructions(),\n      temperature: 0.1, // Very low temperature for consistent, focused behavior\n      maxIterations: 10,\n    });\n\n    const builder = new MessageBuilder();\n\n    // Add initial input or start prompt\n    const startMessage = initialInput || 'I want to configure an OAuth provider';\n    builder.addUserMessage(startMessage);\n\n    // Store in history\n    this.conversationHistory.push(...builder.build());\n\n    // Run conversation - instructions from agent config are always included\n    const response = await this.agent.run(this.conversationHistory);\n\n    // Store assistant response in history\n    this.conversationHistory.push(...response.output.filter(\n      (item): item is InputItem =>\n        item.type === 'message' || item.type === 'compaction'\n    ));\n\n    const responseText = response.output_text || '';\n\n    // Check if AI generated a config\n    if (responseText.includes('===CONFIG_START===')) {\n      return this.extractConfig(responseText);\n    }\n\n    // Otherwise, return the conversational response\n    return responseText;\n  }\n\n  /**\n   * Continue conversation (for multi-turn interaction)\n   *\n   * @param userMessage - User's response\n   * @returns Promise<string | ConnectorConfigResult> - Either next question or final config\n   */\n  async continue(userMessage: string): Promise<string | ConnectorConfigResult> {\n    if (!this.agent) {\n      throw new Error('Agent not initialized. Call run() first.');\n    }\n\n    const builder = new MessageBuilder();\n    builder.addUserMessage(userMessage);\n\n    // Update history with user message\n    this.conversationHistory.push(...builder.build());\n\n    // Run with full history\n    const response = await this.agent.run(this.conversationHistory);\n\n    // Store assistant response in history\n    this.conversationHistory.push(...response.output.filter(\n      (item): item is InputItem =>\n        item.type === 'message' || item.type === 'compaction'\n    ));\n\n    const responseText = response.output_text || '';\n\n    // Check if AI generated a config\n    if (responseText.includes('===CONFIG_START===')) {\n      return this.extractConfig(responseText);\n    }\n\n    // Otherwise, return the conversational response\n    return responseText;\n  }\n\n  /**\n   * Get system instructions for the agent\n   */\n  private getSystemInstructions(): string {\n    return `You are a friendly OAuth Setup Assistant. Your ONLY job is to help users connect their apps to third-party services like Microsoft, Google, GitHub, etc.\n\nYOU MUST NOT answer general questions. ONLY focus on helping set up API connections.\n\nYOUR PROCESS (use NON-TECHNICAL, FRIENDLY language):\n\n1. Ask which system they want to connect to (e.g., Microsoft, Google, GitHub, Salesforce, Slack)\n\n2. Ask about HOW they want to use it (use SIMPLE language):\n   - \"Will your users log in with their [Provider] accounts?\"  authorization_code\n   - \"Does your app need to access [Provider] without users logging in?\"  client_credentials\n   - \"Is this just an API key from [Provider]?\"  static_token\n\n3. Ask BUSINESS questions about what they want to do (then YOU figure out the technical scopes):\n\n   For Microsoft:\n   - \"Do you need to read user profiles?\"  User.Read\n   - \"Do you need to read emails?\"  Mail.Read\n   - \"Do you need to access calendar?\"  Calendars.Read\n   - \"Do you need to read/write SharePoint files?\"  Sites.Read.All or Sites.ReadWrite.All\n   - \"Do you need to access Teams?\"  Team.ReadBasic.All\n   - Combine multiple scopes if needed\n\n   For Google:\n   - \"Do you need to read emails?\"  https://www.googleapis.com/auth/gmail.readonly\n   - \"Do you need to access Google Drive?\"  https://www.googleapis.com/auth/drive\n   - \"Do you need calendar access?\"  https://www.googleapis.com/auth/calendar\n\n   For GitHub:\n   - \"Do you need to read user info?\"  user:email\n   - \"Do you need to access repositories?\"  repo\n   - \"Do you need to read organization data?\"  read:org\n\n   For Salesforce:\n   - \"Do you need full access?\"  full\n   - \"Do you need to access/manage data?\"  api\n   - \"Do you need refresh tokens?\"  refresh_token offline_access\n\n4. DO NOT ask about redirect URI - it will be configured in code (use \"http://localhost:3000/callback\" as default)\n\n5. Generate complete JSON configuration\n\nCRITICAL RULES:\n- Ask ONE simple question at a time\n- Use BUSINESS language, NOT technical OAuth terms\n- Ask \"What do you want to do?\" NOT \"What scopes do you need?\"\n- YOU translate business needs into technical scopes\n- Be friendly and conversational\n- Provide specific setup URLs (e.g., https://portal.azure.com for Microsoft, https://github.com/settings/developers for GitHub)\n- When you have all info, IMMEDIATELY output the config in this EXACT format:\n\n===CONFIG_START===\n{\n  \"name\": \"github\",\n  \"config\": {\n    \"displayName\": \"GitHub API\",\n    \"description\": \"Access GitHub repositories and user data\",\n    \"baseURL\": \"https://api.github.com\",\n    \"auth\": {\n      \"type\": \"oauth\",\n      \"flow\": \"authorization_code\",\n      \"clientId\": \"ENV:GITHUB_CLIENT_ID\",\n      \"clientSecret\": \"ENV:GITHUB_CLIENT_SECRET\",\n      \"authorizationUrl\": \"https://github.com/login/oauth/authorize\",\n      \"tokenUrl\": \"https://github.com/login/oauth/access_token\",\n      \"redirectUri\": \"http://localhost:3000/callback\",\n      \"scope\": \"user:email repo\"\n    }\n  },\n  \"setupInstructions\": \"1. Go to https://github.com/settings/developers\\\\n2. Create New OAuth App\\\\n3. Set Authorization callback URL\\\\n4. Copy Client ID and Client Secret\",\n  \"envVariables\": [\"GITHUB_CLIENT_ID\", \"GITHUB_CLIENT_SECRET\"],\n  \"setupUrl\": \"https://github.com/settings/developers\"\n}\n===CONFIG_END===\n\nUse \"ENV:VARIABLE_NAME\" for values that should come from environment variables.\n\nREMEMBER: Keep it conversational, ask one question at a time, and only output the config when you have all necessary information.`;\n  }\n\n  /**\n   * Extract configuration from AI response\n   */\n  private extractConfig(responseText: string): ConnectorConfigResult {\n    // Find config between markers\n    const configMatch = responseText.match(/===CONFIG_START===\\s*([\\s\\S]*?)\\s*===CONFIG_END===/);\n\n    if (!configMatch) {\n      throw new Error('No configuration found in response. The AI may need more information.');\n    }\n\n    try {\n      const configJson = configMatch[1]!.trim();\n      const config = JSON.parse(configJson);\n\n      return config as ConnectorConfigResult;\n    } catch (error) {\n      throw new Error(`Failed to parse configuration JSON: ${(error as Error).message}`);\n    }\n  }\n\n  /**\n   * Get default model\n   */\n  private getDefaultModel(): string {\n    // Use GPT-4.1 for best instruction following\n    return 'gpt-4.1';\n  }\n\n  /**\n   * Reset conversation\n   */\n  reset(): void {\n    this.conversationHistory = [];\n    this.agent = null;\n  }\n}\n","/**\n * UniversalAgent - Unified agent combining interactive, planning, and task execution\n *\n * Features:\n * - Mode-fluid: Automatically switches between interactive, planning, and executing\n * - User intervention: Users can interrupt, modify plans, provide feedback\n * - Smart detection: Auto-detects complex tasks that need planning\n * - Session persistence: Save and resume conversations\n * - Dynamic tools: Enable/disable tools at runtime\n */\n\nimport { EventEmitter } from 'events';\nimport { Connector } from '../../core/Connector.js';\nimport { Agent } from '../../core/Agent.js';\nimport { ToolManager } from '../../core/ToolManager.js';\nimport { SessionManager, Session, ISessionStorage } from '../../core/SessionManager.js';\nimport { Plan, Task, createPlan, createTask, TaskInput } from '../../domain/entities/Task.js';\nimport { StreamEventType } from '../../domain/entities/StreamEvent.js';\nimport { WorkingMemory } from '../taskAgent/WorkingMemory.js';\nimport { DEFAULT_MEMORY_CONFIG } from '../../domain/entities/Memory.js';\nimport { InMemoryStorage } from '../../infrastructure/storage/InMemoryStorage.js';\nimport { PlanningAgent } from '../taskAgent/PlanningAgent.js';\nimport { ModeManager } from './ModeManager.js';\nimport { getMetaTools, isMetaTool, META_TOOL_NAMES } from './metaTools.js';\nimport type {\n  UniversalAgentConfig,\n  UniversalResponse,\n  UniversalEvent,\n  AgentMode,\n  TaskProgress,\n  IntentAnalysis,\n  PlanChange,\n  ExecutionResult,\n} from './types.js';\n\n// ============================================================================\n// Events\n// ============================================================================\n\nexport interface UniversalAgentEvents {\n  'mode:changed': { from: AgentMode; to: AgentMode; reason: string };\n  'plan:created': { plan: Plan };\n  'plan:modified': { plan: Plan; changes: PlanChange[] };\n  'plan:approved': { plan: Plan };\n  'task:started': { task: Task };\n  'task:completed': { task: Task; result: unknown };\n  'task:failed': { task: Task; error: string };\n  'execution:completed': { result: ExecutionResult };\n  'error': { error: Error; recoverable: boolean };\n}\n\n// ============================================================================\n// UniversalAgent Class\n// ============================================================================\n\nexport class UniversalAgent extends EventEmitter {\n  readonly name: string;\n  readonly connector: Connector;\n  readonly model: string;\n\n  // Core components\n  private config: UniversalAgentConfig;\n  private agent: Agent;\n  private _toolManager: ToolManager;\n  private modeManager: ModeManager;\n  private planningAgent?: PlanningAgent;\n  private workingMemory: WorkingMemory;\n\n  // Session management\n  private _sessionManager: SessionManager | null = null;\n  private _session: Session | null = null;\n\n  // Execution state\n  private currentPlan: Plan | null = null;\n  private executionHistory: Array<{ input: string; response: UniversalResponse; timestamp: Date }> = [];\n  private isDestroyed = false;\n\n  // ============================================================================\n  // Static Factory\n  // ============================================================================\n\n  /**\n   * Create a new UniversalAgent\n   */\n  static create(config: UniversalAgentConfig): UniversalAgent {\n    return new UniversalAgent(config);\n  }\n\n  /**\n   * Resume an agent from a saved session\n   */\n  static async resume(\n    sessionId: string,\n    config: Omit<UniversalAgentConfig, 'session'> & { session: { storage: ISessionStorage } }\n  ): Promise<UniversalAgent> {\n    const agent = new UniversalAgent({\n      ...config,\n      session: {\n        ...config.session,\n        id: sessionId,\n      },\n    });\n\n    // Load session\n    await agent.loadSession(sessionId);\n\n    return agent;\n  }\n\n  // ============================================================================\n  // Constructor\n  // ============================================================================\n\n  private constructor(config: UniversalAgentConfig) {\n    super();\n\n    // Resolve connector\n    this.connector =\n      typeof config.connector === 'string'\n        ? Connector.get(config.connector)\n        : config.connector;\n\n    this.name = config.name ?? `universal-agent-${Date.now()}`;\n    this.model = config.model;\n    this.config = config;\n\n    // Initialize ToolManager\n    this._toolManager = config.toolManager ?? new ToolManager();\n\n    // Register user tools\n    if (config.tools) {\n      for (const tool of config.tools) {\n        this._toolManager.register(tool, { namespace: 'user' });\n      }\n    }\n\n    // Register meta-tools for mode transitions\n    const metaTools = getMetaTools();\n    for (const tool of metaTools) {\n      this._toolManager.register(tool, { namespace: '_meta' });\n    }\n\n    // Create base agent for LLM calls\n    const allTools = this._toolManager.getEnabled();\n    this.agent = Agent.create({\n      connector: config.connector,\n      model: config.model,\n      tools: allTools,\n      instructions: this.buildInstructions(config.instructions),\n      temperature: config.temperature,\n      maxIterations: config.maxIterations ?? 20,\n    });\n\n    // Initialize mode manager\n    this.modeManager = new ModeManager('interactive');\n    this.modeManager.on('mode:changed', (data) => {\n      this.emit('mode:changed', data);\n    });\n\n    // Initialize planning agent if planning is enabled\n    const planningEnabled = config.planning?.enabled !== false;\n    if (planningEnabled) {\n      this.planningAgent = PlanningAgent.create({\n        connector: config.connector,\n        model: config.planning?.model ?? config.model,\n        availableTools: this._toolManager.getEnabled().filter(t => !isMetaTool(t.definition.function.name)),\n      });\n    }\n\n    // Initialize working memory with in-memory storage\n    const memoryStorage = new InMemoryStorage();\n    this.workingMemory = new WorkingMemory(memoryStorage, config.memoryConfig ?? DEFAULT_MEMORY_CONFIG);\n\n    // Setup session if configured\n    if (config.session) {\n      this._sessionManager = new SessionManager({ storage: config.session.storage });\n\n      if (!config.session.id) {\n        // Create new session\n        this._session = this._sessionManager.create('universal-agent', {\n          title: this.name,\n        });\n\n        // Setup auto-save if configured\n        if (config.session.autoSave) {\n          const interval = config.session.autoSaveIntervalMs ?? 30000;\n          this._sessionManager.enableAutoSave(this._session, interval);\n        }\n      }\n    }\n  }\n\n  // ============================================================================\n  // Main API\n  // ============================================================================\n\n  /**\n   * Chat with the agent - the main entry point\n   */\n  async chat(input: string): Promise<UniversalResponse> {\n    if (this.isDestroyed) {\n      throw new Error('Agent has been destroyed');\n    }\n\n    // Analyze user intent\n    const intent = await this.analyzeIntent(input);\n\n    // Handle based on current mode and intent\n    let response: UniversalResponse;\n\n    switch (this.modeManager.getMode()) {\n      case 'interactive':\n        response = await this.handleInteractive(input, intent);\n        break;\n      case 'planning':\n        response = await this.handlePlanning(input, intent);\n        break;\n      case 'executing':\n        response = await this.handleExecuting(input, intent);\n        break;\n      default:\n        throw new Error(`Unknown mode: ${this.modeManager.getMode()}`);\n    }\n\n    // Record in history\n    this.executionHistory.push({\n      input,\n      response,\n      timestamp: new Date(),\n    });\n\n    // Auto-save session if enabled\n    if (this.config.session?.autoSave && this._session) {\n      await this.saveSession().catch(() => {\n        // Ignore auto-save errors\n      });\n    }\n\n    return response;\n  }\n\n  /**\n   * Stream chat response\n   */\n  async *stream(input: string): AsyncIterableIterator<UniversalEvent> {\n    if (this.isDestroyed) {\n      throw new Error('Agent has been destroyed');\n    }\n\n    // Analyze intent\n    const intent = await this.analyzeIntent(input);\n\n    // Check for mode transition\n    const recommendedMode = this.modeManager.recommendMode(intent, this.currentPlan ?? undefined);\n    if (recommendedMode && recommendedMode !== this.modeManager.getMode()) {\n      const from = this.modeManager.getMode();\n      this.modeManager.transition(recommendedMode, intent.type);\n      yield { type: 'mode:changed', from, to: recommendedMode, reason: intent.type };\n    }\n\n    // Stream based on mode\n    const mode = this.modeManager.getMode();\n\n    if (mode === 'interactive') {\n      yield* this.streamInteractive(input, intent);\n    } else if (mode === 'planning') {\n      yield* this.streamPlanning(input, intent);\n    } else if (mode === 'executing') {\n      yield* this.streamExecuting(intent);\n    }\n  }\n\n  // ============================================================================\n  // Mode Handlers\n  // ============================================================================\n\n  private async handleInteractive(input: string, intent: IntentAnalysis): Promise<UniversalResponse> {\n    // Check if we should switch to planning\n    const shouldPlan = this.shouldSwitchToPlanning(intent);\n\n    if (shouldPlan) {\n      this.modeManager.enterPlanning('complex_task_detected');\n      return this.handlePlanning(input, intent);\n    }\n\n    // Execute directly with agent\n    const response = await this.agent.run(input);\n\n    // Check if agent used _start_planning meta-tool\n    const planningToolCall = response.output.find(\n      (item: any) => item.type === 'tool_use' && item.name === META_TOOL_NAMES.START_PLANNING\n    );\n\n    if (planningToolCall) {\n      this.modeManager.enterPlanning('agent_requested');\n      const rawInput = (planningToolCall as any).input;\n      const args = typeof rawInput === 'string' ? JSON.parse(rawInput || '{}') : (rawInput || {});\n      return this.createPlan(args.goal, args.reasoning);\n    }\n\n    return {\n      text: response.output_text ?? '',\n      mode: 'interactive',\n      usage: response.usage ? {\n        inputTokens: response.usage.input_tokens,\n        outputTokens: response.usage.output_tokens,\n        totalTokens: response.usage.total_tokens,\n      } : undefined,\n    };\n  }\n\n  private async handlePlanning(input: string, intent: IntentAnalysis): Promise<UniversalResponse> {\n    // Check if user is approving the plan\n    if (intent.type === 'approval' && this.modeManager.getPendingPlan()) {\n      return this.approvePlan(intent.feedback);\n    }\n\n    // Check if user is rejecting/modifying\n    if (intent.type === 'rejection') {\n      return this.handlePlanRejection(input, intent);\n    }\n\n    if (intent.type === 'plan_modify' && intent.modification) {\n      return this.modifyPlan(intent.modification);\n    }\n\n    // Create new plan or refine existing\n    if (!this.modeManager.getPendingPlan()) {\n      return this.createPlan(input);\n    } else {\n      // Refine existing plan based on input\n      return this.refinePlan(input);\n    }\n  }\n\n  private async handleExecuting(input: string, intent: IntentAnalysis): Promise<UniversalResponse> {\n    // Handle interrupts\n    if (intent.type === 'interrupt') {\n      this.modeManager.pauseExecution('user_interrupt');\n      return {\n        text: 'Execution paused. What would you like to do?',\n        mode: 'executing',\n        taskProgress: this.getTaskProgress(),\n        needsUserAction: true,\n        userActionType: 'provide_input',\n      };\n    }\n\n    // Handle status queries inline\n    if (intent.type === 'status_query') {\n      return this.reportProgress();\n    }\n\n    // Handle plan modifications\n    if (intent.type === 'plan_modify' && intent.modification) {\n      // Pause, modify, resume\n      this.modeManager.pauseExecution('plan_modification');\n      const modifyResult = await this.modifyPlan(intent.modification);\n      this.modeManager.resumeExecution();\n      return modifyResult;\n    }\n\n    // Handle feedback - note it and continue\n    if (intent.type === 'feedback') {\n      await this.workingMemory.store(\n        `user_feedback_${Date.now()}`,\n        'User feedback during execution',\n        input,\n        'persistent'\n      );\n      return {\n        text: \"Noted. I'll keep that in mind as I continue.\",\n        mode: 'executing',\n        taskProgress: this.getTaskProgress(),\n      };\n    }\n\n    // If paused, resume with this input\n    if (this.modeManager.isPaused()) {\n      this.modeManager.resumeExecution();\n      // Continue execution\n      return this.continueExecution();\n    }\n\n    // Otherwise, handle as inline question\n    const response = await this.agent.run(input);\n    return {\n      text: response.output_text ?? '',\n      mode: 'executing',\n      taskProgress: this.getTaskProgress(),\n    };\n  }\n\n  // ============================================================================\n  // Streaming Handlers\n  // ============================================================================\n\n  private async *streamInteractive(input: string, intent: IntentAnalysis): AsyncIterableIterator<UniversalEvent> {\n    // Check if we should switch to planning\n    if (this.shouldSwitchToPlanning(intent)) {\n      const from = this.modeManager.getMode();\n      this.modeManager.enterPlanning('complex_task_detected');\n      yield { type: 'mode:changed', from, to: 'planning', reason: 'complex_task_detected' };\n      yield* this.streamPlanning(input, intent);\n      return;\n    }\n\n    // Stream from agent\n    let fullText = '';\n    for await (const event of this.agent.stream(input)) {\n      if (event.type === StreamEventType.OUTPUT_TEXT_DELTA) {\n        const delta = (event as any).delta || '';\n        fullText += delta;\n        yield { type: 'text:delta', delta };\n      } else if (event.type === StreamEventType.TOOL_CALL_START) {\n        yield { type: 'tool:start', name: (event as any).tool_name || 'unknown', args: null };\n      } else if (event.type === StreamEventType.TOOL_EXECUTION_DONE) {\n        yield { type: 'tool:complete', name: (event as any).name || 'unknown', result: (event as any).result, durationMs: 0 };\n      }\n    }\n\n    yield { type: 'text:done', text: fullText };\n  }\n\n  private async *streamPlanning(input: string, intent: IntentAnalysis): AsyncIterableIterator<UniversalEvent> {\n    if (intent.type === 'approval' && this.modeManager.getPendingPlan()) {\n      const plan = this.modeManager.getPendingPlan()!;\n      this.modeManager.approvePlan();\n      yield { type: 'plan:approved', plan };\n\n      // Transition to executing\n      this.modeManager.enterExecuting(plan, 'plan_approved');\n      yield { type: 'mode:changed', from: 'planning', to: 'executing', reason: 'plan_approved' };\n\n      yield* this.streamExecution();\n      return;\n    }\n\n    // Create plan\n    yield { type: 'plan:analyzing', goal: input };\n\n    const plan = await this.createPlanInternal(input);\n    this.modeManager.setPendingPlan(plan);\n    this.currentPlan = plan;\n\n    yield { type: 'plan:created', plan };\n\n    if (this.config.planning?.requireApproval !== false) {\n      yield { type: 'plan:awaiting_approval', plan };\n      yield { type: 'needs:approval', plan };\n\n      const summary = this.formatPlanSummary(plan);\n      yield { type: 'text:delta', delta: summary };\n      yield { type: 'text:done', text: summary };\n    }\n  }\n\n  private async *streamExecuting(intent: IntentAnalysis): AsyncIterableIterator<UniversalEvent> {\n    if (intent.type === 'status_query') {\n      const progress = this.getTaskProgress();\n      const text = this.formatProgress(progress);\n      yield { type: 'text:delta', delta: text };\n      yield { type: 'text:done', text };\n      return;\n    }\n\n    yield* this.streamExecution();\n  }\n\n  private async *streamExecution(): AsyncIterableIterator<UniversalEvent> {\n    if (!this.currentPlan) {\n      yield { type: 'error', error: 'No plan to execute', recoverable: false };\n      return;\n    }\n\n    const tasks = this.currentPlan.tasks;\n    let completedTasks = 0;\n    let failedTasks = 0;\n\n    for (let i = 0; i < tasks.length; i++) {\n      const task = tasks[i];\n      if (!task) continue;\n\n      // Check if paused\n      if (this.modeManager.isPaused()) {\n        yield { type: 'execution:paused', reason: this.modeManager.getPauseReason() || 'unknown' };\n        return;\n      }\n\n      // Skip completed/failed tasks\n      if (task.status === 'completed' || task.status === 'failed' || task.status === 'skipped') {\n        if (task.status === 'completed') completedTasks++;\n        if (task.status === 'failed') failedTasks++;\n        continue;\n      }\n\n      // Start task\n      task.status = 'in_progress';\n      task.startedAt = Date.now();\n      task.attempts = (task.attempts || 0) + 1;\n      this.modeManager.setCurrentTaskIndex(i);\n\n      yield { type: 'task:started', task };\n\n      try {\n        // Execute task with agent\n        const prompt = this.buildTaskPrompt(task);\n        let taskResultText = '';\n\n        for await (const event of this.agent.stream(prompt)) {\n          if (event.type === StreamEventType.OUTPUT_TEXT_DELTA) {\n            const delta = (event as any).delta || '';\n            taskResultText += delta;\n            yield { type: 'task:progress', task, status: delta };\n          } else if (event.type === StreamEventType.TOOL_CALL_START) {\n            yield { type: 'tool:start', name: (event as any).tool_name || 'unknown', args: null };\n          } else if (event.type === StreamEventType.TOOL_EXECUTION_DONE) {\n            yield { type: 'tool:complete', name: (event as any).name || 'unknown', result: (event as any).result, durationMs: 0 };\n          }\n        }\n\n        // Mark completed\n        task.status = 'completed';\n        task.completedAt = Date.now();\n        task.result = { success: true, output: taskResultText };\n        completedTasks++;\n\n        yield { type: 'task:completed', task, result: taskResultText };\n\n      } catch (error) {\n        task.status = 'failed';\n        const errorMsg = error instanceof Error ? error.message : String(error);\n        task.result = { success: false, error: errorMsg };\n        failedTasks++;\n\n        yield { type: 'task:failed', task, error: errorMsg };\n      }\n    }\n\n    // All done\n    const result: ExecutionResult = {\n      status: failedTasks === 0 ? 'completed' : 'failed',\n      completedTasks,\n      totalTasks: tasks.length,\n      failedTasks,\n      skippedTasks: tasks.filter(t => t.status === 'skipped').length,\n    };\n\n    yield { type: 'execution:done', result };\n\n    // Return to interactive\n    this.modeManager.returnToInteractive('execution_completed');\n    yield { type: 'mode:changed', from: 'executing', to: 'interactive', reason: 'execution_completed' };\n\n    this.emit('execution:completed', { result });\n  }\n\n  // ============================================================================\n  // Planning Helpers\n  // ============================================================================\n\n  private async createPlan(goal: string, _reasoning?: string): Promise<UniversalResponse> {\n    const plan = await this.createPlanInternal(goal);\n\n    this.modeManager.setPendingPlan(plan);\n    this.currentPlan = plan;\n\n    this.emit('plan:created', { plan });\n\n    const summary = this.formatPlanSummary(plan);\n    const requireApproval = this.config.planning?.requireApproval !== false;\n\n    return {\n      text: summary,\n      mode: 'planning',\n      plan,\n      planStatus: requireApproval ? 'pending_approval' : 'approved',\n      needsUserAction: requireApproval,\n      userActionType: requireApproval ? 'approve_plan' : undefined,\n    };\n  }\n\n  private async createPlanInternal(goal: string): Promise<Plan> {\n    if (this.planningAgent) {\n      const result = await this.planningAgent.generatePlan({ goal });\n      return createPlan({ goal, tasks: result.plan.tasks as TaskInput[] });\n    }\n\n    // Fallback: simple single-task plan\n    return createPlan({\n      goal,\n      tasks: [{ name: 'execute', description: goal }],\n    });\n  }\n\n  private async approvePlan(_feedback?: string): Promise<UniversalResponse> {\n    const plan = this.modeManager.getPendingPlan();\n    if (!plan) {\n      return {\n        text: 'No plan to approve.',\n        mode: this.modeManager.getMode(),\n      };\n    }\n\n    this.modeManager.approvePlan();\n    this.modeManager.enterExecuting(plan, 'user_approved');\n    this.currentPlan = plan;\n\n    this.emit('plan:approved', { plan });\n\n    // Start execution\n    return this.continueExecution();\n  }\n\n  private async handlePlanRejection(_input: string, intent: IntentAnalysis): Promise<UniversalResponse> {\n    if (intent.feedback) {\n      return this.refinePlan(intent.feedback);\n    }\n\n    return {\n      text: \"I understand you'd like to change the plan. What would you like me to modify?\",\n      mode: 'planning',\n      plan: this.modeManager.getPendingPlan(),\n      needsUserAction: true,\n      userActionType: 'provide_input',\n    };\n  }\n\n  private async refinePlan(feedback: string): Promise<UniversalResponse> {\n    const currentPlan = this.modeManager.getPendingPlan();\n    if (!currentPlan || !this.planningAgent) {\n      return this.createPlan(feedback);\n    }\n\n    const refined = await this.planningAgent.refinePlan(currentPlan, feedback);\n    this.modeManager.setPendingPlan(refined.plan);\n    this.currentPlan = refined.plan;\n\n    this.emit('plan:modified', { plan: refined.plan, changes: [] });\n\n    return {\n      text: this.formatPlanSummary(refined.plan),\n      mode: 'planning',\n      plan: refined.plan,\n      planStatus: 'pending_approval',\n      needsUserAction: true,\n      userActionType: 'approve_plan',\n    };\n  }\n\n  private async modifyPlan(modification: IntentAnalysis['modification']): Promise<UniversalResponse> {\n    if (!modification || !this.currentPlan) {\n      return {\n        text: 'No active plan to modify.',\n        mode: this.modeManager.getMode(),\n      };\n    }\n\n    const changes: PlanChange[] = [];\n\n    switch (modification.action) {\n      case 'add_task': {\n        const newTask = createTask({\n          name: `task_${this.currentPlan.tasks.length + 1}`,\n          description: modification.details ?? 'New task',\n        });\n        this.currentPlan.tasks.push(newTask);\n        changes.push({ type: 'task_added', taskId: newTask.id, taskName: newTask.name, details: modification.details });\n        break;\n      }\n\n      case 'remove_task': {\n        const idx = this.currentPlan.tasks.findIndex(t => t.name === modification.taskName);\n        if (idx >= 0) {\n          this.currentPlan.tasks.splice(idx, 1);\n          changes.push({ type: 'task_removed', taskName: modification.taskName });\n        }\n        break;\n      }\n\n      case 'skip_task': {\n        const task = this.currentPlan.tasks.find(t => t.name === modification.taskName);\n        if (task) {\n          task.status = 'skipped';\n          changes.push({ type: 'task_updated', taskId: task.id, taskName: task.name, details: 'Marked as skipped' });\n        }\n        break;\n      }\n\n      case 'update_task': {\n        const task = this.currentPlan.tasks.find(t => t.name === modification.taskName);\n        if (task && modification.details) {\n          task.description = modification.details;\n          changes.push({ type: 'task_updated', taskId: task.id, taskName: task.name, details: modification.details });\n        }\n        break;\n      }\n    }\n\n    this.currentPlan.lastUpdatedAt = Date.now();\n\n    this.emit('plan:modified', { plan: this.currentPlan, changes });\n\n    return {\n      text: `Plan updated: ${changes.map(c => c.details || c.type).join(', ')}`,\n      mode: this.modeManager.getMode(),\n      plan: this.currentPlan,\n    };\n  }\n\n  // ============================================================================\n  // Execution Helpers\n  // ============================================================================\n\n  private async continueExecution(): Promise<UniversalResponse> {\n    if (!this.currentPlan) {\n      return {\n        text: 'No plan to execute.',\n        mode: 'interactive',\n      };\n    }\n\n    const tasks = this.currentPlan.tasks;\n    const pendingTasks = tasks.filter(t => t.status === 'pending' || t.status === 'in_progress');\n\n    if (pendingTasks.length === 0) {\n      this.modeManager.returnToInteractive('all_tasks_completed');\n      return {\n        text: 'All tasks completed!',\n        mode: 'interactive',\n        taskProgress: this.getTaskProgress(),\n      };\n    }\n\n    // Execute next pending task\n    const nextTask = pendingTasks[0];\n    if (!nextTask) {\n      // Should never happen since we checked pendingTasks.length above\n      throw new Error('No pending task found');\n    }\n\n    nextTask.status = 'in_progress';\n    nextTask.startedAt = Date.now();\n    nextTask.attempts = (nextTask.attempts || 0) + 1;\n\n    this.emit('task:started', { task: nextTask });\n\n    try {\n      const prompt = this.buildTaskPrompt(nextTask);\n      const response = await this.agent.run(prompt);\n\n      nextTask.status = 'completed';\n      nextTask.completedAt = Date.now();\n      nextTask.result = { success: true, output: response.output_text };\n\n      this.emit('task:completed', { task: nextTask, result: response.output_text });\n\n      // Check if more tasks\n      const remaining = tasks.filter(t => t.status === 'pending');\n      if (remaining.length > 0) {\n        return {\n          text: `Completed: ${nextTask.name}\\n\\nContinuing to next task...`,\n          mode: 'executing',\n          taskProgress: this.getTaskProgress(),\n        };\n      } else {\n        this.modeManager.returnToInteractive('all_tasks_completed');\n        return {\n          text: `All tasks completed!\\n\\nFinal task result:\\n${response.output_text}`,\n          mode: 'interactive',\n          taskProgress: this.getTaskProgress(),\n        };\n      }\n    } catch (error) {\n      nextTask.status = 'failed';\n      const errorMsg = error instanceof Error ? error.message : String(error);\n      nextTask.result = { success: false, error: errorMsg };\n\n      this.emit('task:failed', { task: nextTask, error: errorMsg });\n\n      return {\n        text: `Task failed: ${errorMsg}`,\n        mode: 'executing',\n        taskProgress: this.getTaskProgress(),\n      };\n    }\n  }\n\n  private reportProgress(): UniversalResponse {\n    const progress = this.getTaskProgress();\n    return {\n      text: this.formatProgress(progress),\n      mode: this.modeManager.getMode(),\n      taskProgress: progress,\n    };\n  }\n\n  // ============================================================================\n  // Intent Analysis\n  // ============================================================================\n\n  private async analyzeIntent(input: string): Promise<IntentAnalysis> {\n    const lowerInput = input.toLowerCase().trim();\n\n    // Simple pattern matching for common intents\n    if (this.isApproval(lowerInput)) {\n      return { type: 'approval', confidence: 0.9 };\n    }\n\n    if (this.isRejection(lowerInput)) {\n      return { type: 'rejection', confidence: 0.9, feedback: input };\n    }\n\n    if (this.isStatusQuery(lowerInput)) {\n      return { type: 'status_query', confidence: 0.9 };\n    }\n\n    if (this.isInterrupt(lowerInput)) {\n      return { type: 'interrupt', confidence: 0.9 };\n    }\n\n    if (this.isPlanModification(lowerInput)) {\n      return {\n        type: 'plan_modify',\n        confidence: 0.8,\n        modification: this.parsePlanModification(input),\n      };\n    }\n\n    // Check complexity heuristics\n    const complexity = this.estimateComplexity(input);\n    if (complexity === 'high' || complexity === 'medium') {\n      return {\n        type: 'complex',\n        confidence: 0.7,\n        complexity,\n        estimatedSteps: this.estimateSteps(input),\n      };\n    }\n\n    return { type: 'simple', confidence: 0.8 };\n  }\n\n  private isApproval(input: string): boolean {\n    const approvalPatterns = [\n      /^(yes|yeah|yep|sure|ok|okay|go ahead|proceed|approve|looks good|lgtm|do it|start|execute|run it)$/i,\n      /^(that('s| is) (good|fine|great|perfect))$/i,\n      /^(please proceed|please continue|continue)$/i,\n    ];\n    return approvalPatterns.some(p => p.test(input));\n  }\n\n  private isRejection(input: string): boolean {\n    const rejectionPatterns = [\n      /^(no|nope|nah|stop|cancel|reject|don't|wait)$/i,\n      /^(that('s| is) (wrong|not right|incorrect))$/i,\n      /change|modify|different|instead/i,\n    ];\n    return rejectionPatterns.some(p => p.test(input));\n  }\n\n  private isStatusQuery(input: string): boolean {\n    const statusPatterns = [\n      /status|progress|where are (you|we)|what('s| is) (the )?(status|progress)/i,\n      /how('s| is) it going|what have you done|current state/i,\n      /which task|what task/i,\n    ];\n    return statusPatterns.some(p => p.test(input));\n  }\n\n  private isInterrupt(input: string): boolean {\n    const interruptPatterns = [\n      /^(stop|pause|wait|hold on|hold up)$/i,\n      /stop (what you're doing|execution|everything)/i,\n    ];\n    return interruptPatterns.some(p => p.test(input));\n  }\n\n  private isPlanModification(input: string): boolean {\n    const modPatterns = [\n      /add (a )?task|new task|also (do|add)|additionally/i,\n      /remove (the )?task|skip (the )?task|don't do/i,\n      /change (the )?order|reorder|do .* first|prioritize/i,\n      /update (the )?task|modify (the )?task/i,\n    ];\n    return modPatterns.some(p => p.test(input));\n  }\n\n  private parsePlanModification(input: string): IntentAnalysis['modification'] {\n    const lowerInput = input.toLowerCase();\n\n    if (/add|new|also|additionally/.test(lowerInput)) {\n      return { action: 'add_task', details: input };\n    }\n    if (/remove|skip|don't/.test(lowerInput)) {\n      return { action: 'skip_task', details: input };\n    }\n    if (/reorder|first|prioritize/.test(lowerInput)) {\n      return { action: 'reorder', details: input };\n    }\n    return { action: 'update_task', details: input };\n  }\n\n  private estimateComplexity(input: string): 'low' | 'medium' | 'high' {\n    const words = input.split(/\\s+/).length;\n    const hasMultipleActions = /and|then|after|before|also|additionally/.test(input.toLowerCase());\n    const hasComplexKeywords = /build|create|implement|design|develop|setup|configure|migrate|refactor/.test(input.toLowerCase());\n\n    if (words > 50 || (hasMultipleActions && hasComplexKeywords)) {\n      return 'high';\n    }\n    if (words > 20 || hasMultipleActions || hasComplexKeywords) {\n      return 'medium';\n    }\n    return 'low';\n  }\n\n  private estimateSteps(input: string): number {\n    const andCount = (input.match(/\\band\\b/gi) || []).length;\n    const thenCount = (input.match(/\\bthen\\b/gi) || []).length;\n    return Math.max(2, andCount + thenCount + 1);\n  }\n\n  private shouldSwitchToPlanning(intent: IntentAnalysis): boolean {\n    if (this.config.planning?.enabled !== false && this.config.planning?.autoDetect !== false) {\n      return intent.type === 'complex' && (intent.complexity === 'high' || intent.complexity === 'medium');\n    }\n    return false;\n  }\n\n  // ============================================================================\n  // Helpers\n  // ============================================================================\n\n  private buildInstructions(userInstructions?: string): string {\n    const baseInstructions = `You are a versatile AI assistant that can handle both simple requests and complex multi-step tasks.\n\nFor simple requests:\n- Answer questions directly\n- Use tools when needed for immediate results\n\nFor complex requests:\n- Use the _start_planning tool to create a structured plan\n- Wait for user approval before executing\n\nYou have access to meta-tools:\n- _start_planning: Call when a task needs multiple steps\n- _modify_plan: Call when user wants to change the plan\n- _report_progress: Call when user asks about status\n- _request_approval: Call when you need user confirmation\n\nAlways be helpful, clear, and ask for clarification when needed.`;\n\n    return userInstructions\n      ? `${baseInstructions}\\n\\nAdditional instructions:\\n${userInstructions}`\n      : baseInstructions;\n  }\n\n  private buildTaskPrompt(task: Task): string {\n    let prompt = `Execute the following task:\\n\\nTask: ${task.name}\\nDescription: ${task.description}`;\n\n    if (task.expectedOutput) {\n      prompt += `\\nExpected Output: ${task.expectedOutput}`;\n    }\n\n    return prompt;\n  }\n\n  private formatPlanSummary(plan: Plan): string {\n    let summary = `I've created a plan to: ${plan.goal}\\n\\n`;\n    summary += `Tasks (${plan.tasks.length}):\\n`;\n\n    plan.tasks.forEach((task, i) => {\n      const deps = task.dependsOn?.length ? ` (depends on: ${task.dependsOn.join(', ')})` : '';\n      summary += `${i + 1}. ${task.name}: ${task.description}${deps}\\n`;\n    });\n\n    summary += '\\nWould you like me to proceed with this plan?';\n    return summary;\n  }\n\n  private formatProgress(progress: TaskProgress): string {\n    let text = `Progress: ${progress.completed}/${progress.total} tasks completed`;\n\n    if (progress.failed > 0) {\n      text += ` (${progress.failed} failed)`;\n    }\n    if (progress.skipped > 0) {\n      text += ` (${progress.skipped} skipped)`;\n    }\n\n    if (progress.current) {\n      text += `\\n\\nCurrently working on: ${progress.current.name}`;\n    }\n\n    return text;\n  }\n\n  private getTaskProgress(): TaskProgress {\n    if (!this.currentPlan) {\n      return { completed: 0, total: 0, failed: 0, skipped: 0 };\n    }\n\n    const tasks = this.currentPlan.tasks;\n    const currentIdx = this.modeManager.getCurrentTaskIndex();\n\n    return {\n      completed: tasks.filter(t => t.status === 'completed').length,\n      total: tasks.length,\n      current: tasks[currentIdx],\n      failed: tasks.filter(t => t.status === 'failed').length,\n      skipped: tasks.filter(t => t.status === 'skipped').length,\n    };\n  }\n\n  // ============================================================================\n  // Session Management\n  // ============================================================================\n\n  getSessionId(): string | null {\n    return this._session?.id ?? null;\n  }\n\n  hasSession(): boolean {\n    return this._session !== null;\n  }\n\n  async saveSession(): Promise<void> {\n    if (!this._sessionManager || !this._session) {\n      throw new Error('Session not enabled');\n    }\n\n    // Update session state\n    this._session.toolState = this._toolManager.getState();\n    this._session.mode = this.modeManager.getMode();\n\n    if (this.currentPlan) {\n      this._session.plan = { version: 1, data: this.currentPlan };\n    }\n\n    this._session.custom['modeState'] = this.modeManager.serialize();\n    this._session.custom['executionHistory'] = this.executionHistory;\n\n    await this._sessionManager.save(this._session);\n  }\n\n  private async loadSession(sessionId: string): Promise<void> {\n    if (!this._sessionManager) return;\n\n    const session = await this._sessionManager.load(sessionId);\n    if (!session) {\n      throw new Error(`Session not found: ${sessionId}`);\n    }\n\n    this._session = session;\n\n    // Restore tool state\n    if (session.toolState) {\n      this._toolManager.loadState(session.toolState);\n    }\n\n    // Restore mode state\n    if (session.custom['modeState']) {\n      this.modeManager.restore(session.custom['modeState'] as ReturnType<ModeManager['serialize']>);\n    }\n\n    // Restore plan\n    if (session.plan?.data) {\n      this.currentPlan = session.plan.data as Plan;\n    }\n\n    // Restore execution history\n    if (session.custom['executionHistory']) {\n      this.executionHistory = session.custom['executionHistory'] as typeof this.executionHistory;\n    }\n  }\n\n  getSession(): Session | null {\n    return this._session;\n  }\n\n  // ============================================================================\n  // Public Getters\n  // ============================================================================\n\n  getMode(): AgentMode {\n    return this.modeManager.getMode();\n  }\n\n  getPlan(): Plan | null {\n    return this.currentPlan;\n  }\n\n  getProgress(): TaskProgress | null {\n    if (this.modeManager.getMode() !== 'executing' || !this.currentPlan) {\n      return null;\n    }\n    return this.getTaskProgress();\n  }\n\n  get toolManager(): ToolManager {\n    return this._toolManager;\n  }\n\n  // ============================================================================\n  // Runtime Configuration\n  // ============================================================================\n\n  setAutoApproval(value: boolean): void {\n    if (this.config.planning) {\n      this.config.planning.requireApproval = !value;\n    }\n  }\n\n  setPlanningEnabled(value: boolean): void {\n    if (this.config.planning) {\n      this.config.planning.enabled = value;\n    }\n  }\n\n  // ============================================================================\n  // Control\n  // ============================================================================\n\n  private _isPaused = false;\n\n  pause(): void {\n    this._isPaused = true;\n    if (this.modeManager.getMode() === 'executing') {\n      this.modeManager.pauseExecution('user_request');\n    }\n  }\n\n  resume(): void {\n    this._isPaused = false;\n    if (this.modeManager.isPaused()) {\n      this.modeManager.resumeExecution();\n    }\n  }\n\n  cancel(): void {\n    if (this.currentPlan) {\n      this.currentPlan.status = 'cancelled';\n    }\n    this.modeManager.returnToInteractive('cancelled');\n  }\n\n  isRunning(): boolean {\n    return this.modeManager.getMode() === 'executing' && !this.isPaused();\n  }\n\n  isPaused(): boolean {\n    return this._isPaused || this.modeManager.isPaused();\n  }\n\n  onCleanup(callback: () => void): void {\n    this.agent.onCleanup(callback);\n  }\n\n  // ============================================================================\n  // Cleanup\n  // ============================================================================\n\n  destroy(): void {\n    if (this.isDestroyed) return;\n    this.isDestroyed = true;\n\n    // Cleanup session\n    if (this._sessionManager && this._session) {\n      this._sessionManager.stopAutoSave(this._session.id);\n      this._sessionManager.destroy();\n    }\n\n    // Cleanup components\n    this.agent.destroy();\n    this._toolManager.removeAllListeners();\n    this.modeManager.removeAllListeners();\n    this.removeAllListeners();\n  }\n}\n","/**\n * ModeManager - Manages agent mode transitions\n *\n * Handles the state machine for UniversalAgent modes:\n * - interactive: Direct conversation, immediate tool execution\n * - planning: Creating and refining plans\n * - executing: Running through a plan\n */\n\nimport { EventEmitter } from 'events';\nimport type { Plan } from '../../domain/entities/Task.js';\nimport type { AgentMode, ModeState, IntentAnalysis } from './types.js';\n\nexport interface ModeManagerEvents {\n  'mode:changed': { from: AgentMode; to: AgentMode; reason: string };\n  'mode:transition_blocked': { from: AgentMode; to: AgentMode; reason: string };\n}\n\nexport class ModeManager extends EventEmitter {\n  private state: ModeState;\n  private transitionHistory: Array<{ from: AgentMode; to: AgentMode; at: Date; reason: string }> = [];\n\n  constructor(initialMode: AgentMode = 'interactive') {\n    super();\n    this.state = {\n      mode: initialMode,\n      enteredAt: new Date(),\n      reason: 'initial',\n    };\n  }\n\n  /**\n   * Get current mode\n   */\n  getMode(): AgentMode {\n    return this.state.mode;\n  }\n\n  /**\n   * Get full mode state\n   */\n  getState(): ModeState {\n    return { ...this.state };\n  }\n\n  /**\n   * Check if a transition is allowed\n   */\n  canTransition(to: AgentMode): boolean {\n    const from = this.state.mode;\n\n    // Define valid transitions\n    const validTransitions: Record<AgentMode, AgentMode[]> = {\n      'interactive': ['planning', 'executing'],\n      'planning': ['interactive', 'executing'],\n      'executing': ['interactive', 'planning'],\n    };\n\n    return validTransitions[from].includes(to);\n  }\n\n  /**\n   * Transition to a new mode\n   */\n  transition(to: AgentMode, reason: string): boolean {\n    const from = this.state.mode;\n\n    if (!this.canTransition(to)) {\n      this.emit('mode:transition_blocked', { from, to, reason });\n      return false;\n    }\n\n    // Record transition\n    this.transitionHistory.push({ from, to, at: new Date(), reason });\n\n    // Update state\n    this.state = {\n      mode: to,\n      enteredAt: new Date(),\n      reason,\n      // Clear mode-specific state on transition\n      pendingPlan: to === 'planning' ? this.state.pendingPlan : undefined,\n      planApproved: to === 'executing' ? true : undefined,\n      currentTaskIndex: to === 'executing' ? 0 : undefined,\n    };\n\n    this.emit('mode:changed', { from, to, reason });\n    return true;\n  }\n\n  /**\n   * Enter planning mode with a goal\n   */\n  enterPlanning(reason: string = 'user_request'): boolean {\n    return this.transition('planning', reason);\n  }\n\n  /**\n   * Enter executing mode (plan must be approved)\n   */\n  enterExecuting(_plan: Plan, reason: string = 'plan_approved'): boolean {\n    if (this.state.mode === 'planning' && !this.state.planApproved) {\n      // Auto-approve when transitioning from planning to executing\n      this.state.planApproved = true;\n    }\n\n    const success = this.transition('executing', reason);\n    if (success) {\n      this.state.currentTaskIndex = 0;\n    }\n    return success;\n  }\n\n  /**\n   * Return to interactive mode\n   */\n  returnToInteractive(reason: string = 'completed'): boolean {\n    return this.transition('interactive', reason);\n  }\n\n  /**\n   * Set pending plan (in planning mode)\n   */\n  setPendingPlan(plan: Plan): void {\n    this.state.pendingPlan = plan;\n    this.state.planApproved = false;\n  }\n\n  /**\n   * Get pending plan\n   */\n  getPendingPlan(): Plan | undefined {\n    return this.state.pendingPlan;\n  }\n\n  /**\n   * Approve the pending plan\n   */\n  approvePlan(): boolean {\n    if (this.state.mode !== 'planning' || !this.state.pendingPlan) {\n      return false;\n    }\n    this.state.planApproved = true;\n    return true;\n  }\n\n  /**\n   * Check if plan is approved\n   */\n  isPlanApproved(): boolean {\n    return this.state.planApproved ?? false;\n  }\n\n  /**\n   * Update current task index (in executing mode)\n   */\n  setCurrentTaskIndex(index: number): void {\n    if (this.state.mode === 'executing') {\n      this.state.currentTaskIndex = index;\n    }\n  }\n\n  /**\n   * Get current task index\n   */\n  getCurrentTaskIndex(): number {\n    return this.state.currentTaskIndex ?? 0;\n  }\n\n  /**\n   * Pause execution\n   */\n  pauseExecution(reason: string): void {\n    if (this.state.mode === 'executing') {\n      this.state.pausedAt = new Date();\n      this.state.pauseReason = reason;\n    }\n  }\n\n  /**\n   * Resume execution\n   */\n  resumeExecution(): void {\n    if (this.state.mode === 'executing') {\n      this.state.pausedAt = undefined;\n      this.state.pauseReason = undefined;\n    }\n  }\n\n  /**\n   * Check if paused\n   */\n  isPaused(): boolean {\n    return this.state.pausedAt !== undefined;\n  }\n\n  /**\n   * Get pause reason\n   */\n  getPauseReason(): string | undefined {\n    return this.state.pauseReason;\n  }\n\n  /**\n   * Determine recommended mode based on intent analysis\n   */\n  recommendMode(intent: IntentAnalysis, _currentPlan?: Plan): AgentMode | null {\n    const currentMode = this.state.mode;\n\n    switch (intent.type) {\n      case 'complex':\n        // Complex task  suggest planning\n        if (currentMode === 'interactive') {\n          return 'planning';\n        }\n        break;\n\n      case 'approval':\n        // User approved plan  suggest executing\n        if (currentMode === 'planning' && this.state.pendingPlan) {\n          return 'executing';\n        }\n        break;\n\n      case 'rejection':\n        // User rejected plan  stay in planning to refine\n        if (currentMode === 'planning') {\n          return 'planning';\n        }\n        break;\n\n      case 'plan_modify':\n        // Plan modification  enter planning if not already\n        if (currentMode === 'executing' || currentMode === 'interactive') {\n          return 'planning';\n        }\n        break;\n\n      case 'interrupt':\n        // Interrupt  return to interactive\n        return 'interactive';\n\n      case 'simple':\n      case 'question':\n        // Simple query during execution  handle inline, stay in current mode\n        if (currentMode === 'executing') {\n          return null; // Handle without mode change\n        }\n        return 'interactive';\n\n      case 'status_query':\n        // Status query  no mode change, just respond\n        return null;\n\n      case 'feedback':\n        // Feedback during execution  note and continue\n        return null;\n    }\n\n    return null; // No mode change recommended\n  }\n\n  /**\n   * Get transition history\n   */\n  getHistory(): Array<{ from: AgentMode; to: AgentMode; at: Date; reason: string }> {\n    return [...this.transitionHistory];\n  }\n\n  /**\n   * Clear transition history\n   */\n  clearHistory(): void {\n    this.transitionHistory = [];\n  }\n\n  /**\n   * Get time spent in current mode\n   */\n  getTimeInCurrentMode(): number {\n    return Date.now() - this.state.enteredAt.getTime();\n  }\n\n  /**\n   * Serialize state for session persistence\n   */\n  serialize(): {\n    mode: AgentMode;\n    enteredAt: string;\n    reason: string;\n    pendingPlan?: Plan;\n    planApproved?: boolean;\n    currentTaskIndex?: number;\n  } {\n    return {\n      mode: this.state.mode,\n      enteredAt: this.state.enteredAt.toISOString(),\n      reason: this.state.reason,\n      pendingPlan: this.state.pendingPlan,\n      planApproved: this.state.planApproved,\n      currentTaskIndex: this.state.currentTaskIndex,\n    };\n  }\n\n  /**\n   * Restore state from serialized data\n   */\n  restore(data: ReturnType<ModeManager['serialize']>): void {\n    this.state = {\n      mode: data.mode,\n      enteredAt: new Date(data.enteredAt),\n      reason: data.reason,\n      pendingPlan: data.pendingPlan,\n      planApproved: data.planApproved,\n      currentTaskIndex: data.currentTaskIndex,\n    };\n  }\n}\n","/**\n * Meta-tools for UniversalAgent\n *\n * These tools are used internally by the agent to signal mode transitions\n * and perform meta-operations like planning and progress reporting.\n */\n\nimport type { ToolFunction } from '../../domain/entities/Tool.js';\nimport type { StartPlanningArgs, ModifyPlanArgs, ReportProgressArgs, RequestApprovalArgs } from './types.js';\n\n/**\n * Tool for starting planning mode\n */\nexport const startPlanningTool: ToolFunction<StartPlanningArgs, { status: string }> = {\n  definition: {\n    type: 'function',\n    function: {\n      name: '_start_planning',\n      description: `Call this when the user's request is complex and requires a multi-step plan.\nUse for tasks that:\n- Require 3 or more distinct steps\n- Need multiple tools to be called in sequence\n- Have dependencies between actions\n- Would benefit from user review before execution\n\nDo NOT use for:\n- Simple questions\n- Single tool calls\n- Quick calculations\n- Direct information retrieval`,\n      parameters: {\n        type: 'object',\n        properties: {\n          goal: {\n            type: 'string',\n            description: 'The high-level goal to achieve',\n          },\n          reasoning: {\n            type: 'string',\n            description: 'Brief explanation of why planning is needed',\n          },\n        },\n        required: ['goal', 'reasoning'],\n      },\n    },\n  },\n  execute: async (args) => {\n    // This is handled internally by UniversalAgent\n    return { status: 'planning_started', goal: args.goal };\n  },\n};\n\n/**\n * Tool for modifying the current plan\n */\nexport const modifyPlanTool: ToolFunction<ModifyPlanArgs, { status: string }> = {\n  definition: {\n    type: 'function',\n    function: {\n      name: '_modify_plan',\n      description: `Call this when the user wants to change the current plan.\nActions:\n- add_task: Add a new task to the plan\n- remove_task: Remove a task from the plan\n- skip_task: Mark a task to be skipped\n- update_task: Modify task description or dependencies\n- reorder: Change task order`,\n      parameters: {\n        type: 'object',\n        properties: {\n          action: {\n            type: 'string',\n            enum: ['add_task', 'remove_task', 'skip_task', 'update_task', 'reorder'],\n            description: 'The type of modification',\n          },\n          taskName: {\n            type: 'string',\n            description: 'Name of the task (for remove/skip/update/reorder)',\n          },\n          details: {\n            type: 'string',\n            description: 'Details of the modification (new task description, updates, etc.)',\n          },\n          insertAfter: {\n            type: 'string',\n            description: 'For add_task/reorder: insert after this task name',\n          },\n        },\n        required: ['action', 'details'],\n      },\n    },\n  },\n  execute: async (args) => {\n    // This is handled internally by UniversalAgent\n    return { status: 'plan_modified', action: args.action };\n  },\n};\n\n/**\n * Tool for reporting current progress\n */\nexport const reportProgressTool: ToolFunction<ReportProgressArgs, { status: string; progress: unknown }> = {\n  definition: {\n    type: 'function',\n    function: {\n      name: '_report_progress',\n      description: 'Call this when the user asks about current progress, status, or what has been done.',\n      parameters: {\n        type: 'object',\n        properties: {},\n        required: [],\n      },\n    },\n  },\n  execute: async () => {\n    // This is handled internally by UniversalAgent\n    return { status: 'progress_reported', progress: null };\n  },\n};\n\n/**\n * Tool for requesting user approval\n */\nexport const requestApprovalTool: ToolFunction<RequestApprovalArgs, { status: string }> = {\n  definition: {\n    type: 'function',\n    function: {\n      name: '_request_approval',\n      description: 'Call this when you need user approval to proceed. Use after creating a plan or before destructive operations.',\n      parameters: {\n        type: 'object',\n        properties: {\n          message: {\n            type: 'string',\n            description: 'Optional message to show the user',\n          },\n        },\n        required: [],\n      },\n    },\n  },\n  execute: async (args) => {\n    // This is handled internally by UniversalAgent\n    return { status: 'approval_requested', message: args?.message };\n  },\n};\n\n/**\n * Get all meta-tools\n */\nexport function getMetaTools(): ToolFunction[] {\n  return [\n    startPlanningTool,\n    modifyPlanTool,\n    reportProgressTool,\n    requestApprovalTool,\n  ];\n}\n\n/**\n * Check if a tool name is a meta-tool\n */\nexport function isMetaTool(toolName: string): boolean {\n  return toolName.startsWith('_');\n}\n\n/**\n * Meta-tool names\n */\nexport const META_TOOL_NAMES = {\n  START_PLANNING: '_start_planning',\n  MODIFY_PLAN: '_modify_plan',\n  REPORT_PROGRESS: '_report_progress',\n  REQUEST_APPROVAL: '_request_approval',\n} as const;\n"]}