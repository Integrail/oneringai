{"version":3,"sources":["../src/domain/interfaces/IDisposable.ts","../src/domain/errors/AIErrors.ts","../src/infrastructure/providers/base/BaseProvider.ts","../src/infrastructure/providers/base/BaseTextProvider.ts","../src/domain/entities/Message.ts","../src/domain/entities/StreamEvent.ts","../src/infrastructure/providers/openai/OpenAITextProvider.ts","../src/infrastructure/providers/generic/GenericOpenAIProvider.ts","../src/domain/entities/Content.ts","../src/infrastructure/providers/anthropic/AnthropicConverter.ts","../src/infrastructure/providers/anthropic/AnthropicStreamConverter.ts","../src/infrastructure/providers/anthropic/AnthropicTextProvider.ts","../src/utils/imageUtils.ts","../src/infrastructure/providers/google/GoogleConverter.ts","../src/infrastructure/providers/google/GoogleStreamConverter.ts","../src/infrastructure/providers/google/GoogleTextProvider.ts","../src/infrastructure/providers/vertex/VertexAITextProvider.ts","../src/client/ProviderRegistry.ts","../src/domain/entities/Tool.ts","../src/capabilities/agents/ExecutionContext.ts","../src/capabilities/agents/HookManager.ts","../src/domain/entities/StreamState.ts","../src/capabilities/agents/AgenticLoop.ts","../src/capabilities/agents/Agent.ts","../src/capabilities/agents/ToolRegistry.ts","../src/capabilities/agents/AgentManager.ts","../src/capabilities/text/TextManager.ts","../src/capabilities/images/ImageManager.ts","../src/client/OneRingAI.ts","../src/capabilities/agents/StreamHelpers.ts","../src/utils/messageBuilder.ts","../src/utils/clipboardImage.ts","../src/tools/index.ts","../src/tools/json/pathUtils.ts","../src/tools/json/jsonManipulator.ts","../src/tools/web/contentDetector.ts","../src/tools/web/webFetch.ts","../src/tools/web/webFetchJS.ts","../src/tools/web/searchProviders/serper.ts","../src/tools/web/searchProviders/brave.ts","../src/tools/web/searchProviders/tavily.ts","../src/tools/web/webSearch.ts","../src/plugins/oauth/utils/encryption.ts","../src/plugins/oauth/infrastructure/storage/MemoryStorage.ts","../src/plugins/oauth/domain/TokenStore.ts","../src/plugins/oauth/utils/pkce.ts","../src/plugins/oauth/flows/AuthCodePKCE.ts","../src/plugins/oauth/flows/ClientCredentials.ts","../src/plugins/oauth/flows/JWTBearer.ts","../src/plugins/oauth/flows/StaticToken.ts","../src/plugins/oauth/OAuthManager.ts","../src/plugins/oauth/OAuthRegistry.ts","../src/plugins/oauth/authenticatedFetch.ts","../src/tools/code/executeJavaScript.ts","../src/plugins/oauth/toolGenerator.ts","../src/plugins/oauth/infrastructure/storage/FileStorage.ts"],"names":["MessageRole","StreamEventType","OpenAI","ContentType","Anthropic","randomUUID","GoogleGenAI","ToolCallState","EventEmitter","promisify","exec","fs","platform","os","path","load","crypto","crypto2","fs2","importPKCS8","SignJWT","vm","fs3","crypto3","path2"],"mappings":"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","file":"index.cjs","sourcesContent":["/**\n * Interface for objects that manage resources and need explicit cleanup.\n *\n * Implementing classes should release all resources (event listeners, timers,\n * connections, etc.) when destroy() is called. After destruction, the instance\n * should not be used.\n */\n\nexport interface IDisposable {\n  /**\n   * Releases all resources held by this instance.\n   *\n   * After calling destroy():\n   * - All event listeners should be removed\n   * - All timers/intervals should be cleared\n   * - All internal state should be cleaned up\n   * - The instance should not be reused\n   *\n   * Multiple calls to destroy() should be safe (idempotent).\n   */\n  destroy(): void;\n\n  /**\n   * Returns true if destroy() has been called.\n   * Methods should check this before performing operations.\n   */\n  readonly isDestroyed: boolean;\n}\n\n/**\n * Async version of IDisposable for resources requiring async cleanup.\n */\nexport interface IAsyncDisposable {\n  /**\n   * Asynchronously releases all resources held by this instance.\n   */\n  destroy(): Promise<void>;\n\n  /**\n   * Returns true if destroy() has been called.\n   */\n  readonly isDestroyed: boolean;\n}\n\n/**\n * Helper to check if an object is destroyed and throw if so.\n * @param obj - The disposable object to check\n * @param operation - Name of the operation being attempted\n */\nexport function assertNotDestroyed(obj: IDisposable | IAsyncDisposable, operation: string): void {\n  if (obj.isDestroyed) {\n    throw new Error(`Cannot ${operation}: instance has been destroyed`);\n  }\n}\n","/**\n * Custom error classes for the AI library\n */\n\nexport class AIError extends Error {\n  constructor(\n    message: string,\n    public readonly code: string,\n    public readonly statusCode?: number,\n    public readonly originalError?: Error\n  ) {\n    super(message);\n    this.name = 'AIError';\n    Object.setPrototypeOf(this, AIError.prototype);\n  }\n}\n\nexport class ProviderNotFoundError extends AIError {\n  constructor(providerName: string) {\n    super(\n      `Provider '${providerName}' not found. Did you configure it in OneRingAI constructor?`,\n      'PROVIDER_NOT_FOUND',\n      404\n    );\n    this.name = 'ProviderNotFoundError';\n    Object.setPrototypeOf(this, ProviderNotFoundError.prototype);\n  }\n}\n\nexport class ProviderAuthError extends AIError {\n  constructor(providerName: string, message: string = 'Authentication failed') {\n    super(\n      `${providerName}: ${message}`,\n      'PROVIDER_AUTH_ERROR',\n      401\n    );\n    this.name = 'ProviderAuthError';\n    Object.setPrototypeOf(this, ProviderAuthError.prototype);\n  }\n}\n\nexport class ProviderRateLimitError extends AIError {\n  constructor(\n    providerName: string,\n    public readonly retryAfter?: number\n  ) {\n    super(\n      `${providerName}: Rate limit exceeded${retryAfter ? `. Retry after ${retryAfter}ms` : ''}`,\n      'PROVIDER_RATE_LIMIT',\n      429\n    );\n    this.name = 'ProviderRateLimitError';\n    Object.setPrototypeOf(this, ProviderRateLimitError.prototype);\n  }\n}\n\nexport class ProviderContextLengthError extends AIError {\n  constructor(\n    providerName: string,\n    public readonly maxTokens: number,\n    public readonly requestedTokens?: number\n  ) {\n    super(\n      `${providerName}: Context length exceeded. Max: ${maxTokens}${requestedTokens ? `, Requested: ${requestedTokens}` : ''}`,\n      'PROVIDER_CONTEXT_LENGTH_EXCEEDED',\n      413\n    );\n    this.name = 'ProviderContextLengthError';\n    Object.setPrototypeOf(this, ProviderContextLengthError.prototype);\n  }\n}\n\nexport class ToolExecutionError extends AIError {\n  constructor(\n    toolName: string,\n    message: string,\n    public readonly originalError?: Error\n  ) {\n    super(\n      `Tool '${toolName}' execution failed: ${message}`,\n      'TOOL_EXECUTION_ERROR',\n      500,\n      originalError\n    );\n    this.name = 'ToolExecutionError';\n    Object.setPrototypeOf(this, ToolExecutionError.prototype);\n  }\n}\n\nexport class ToolTimeoutError extends AIError {\n  constructor(\n    toolName: string,\n    public readonly timeoutMs: number\n  ) {\n    super(\n      `Tool '${toolName}' execution timed out after ${timeoutMs}ms`,\n      'TOOL_TIMEOUT',\n      408\n    );\n    this.name = 'ToolTimeoutError';\n    Object.setPrototypeOf(this, ToolTimeoutError.prototype);\n  }\n}\n\nexport class ToolNotFoundError extends AIError {\n  constructor(toolName: string) {\n    super(\n      `Tool '${toolName}' not found. Did you register it with the agent?`,\n      'TOOL_NOT_FOUND',\n      404\n    );\n    this.name = 'ToolNotFoundError';\n    Object.setPrototypeOf(this, ToolNotFoundError.prototype);\n  }\n}\n\nexport class ModelNotSupportedError extends AIError {\n  constructor(providerName: string, model: string, capability: string) {\n    super(\n      `Model '${model}' from ${providerName} does not support ${capability}`,\n      'MODEL_NOT_SUPPORTED',\n      400\n    );\n    this.name = 'ModelNotSupportedError';\n    Object.setPrototypeOf(this, ModelNotSupportedError.prototype);\n  }\n}\n\nexport class InvalidConfigError extends AIError {\n  constructor(message: string) {\n    super(message, 'INVALID_CONFIG', 400);\n    this.name = 'InvalidConfigError';\n    Object.setPrototypeOf(this, InvalidConfigError.prototype);\n  }\n}\n\nexport class InvalidToolArgumentsError extends AIError {\n  constructor(\n    toolName: string,\n    public readonly rawArguments: string,\n    public readonly parseError?: Error\n  ) {\n    super(\n      `Invalid arguments for tool '${toolName}': ${parseError?.message || 'Failed to parse JSON'}`,\n      'INVALID_TOOL_ARGUMENTS',\n      400,\n      parseError\n    );\n    this.name = 'InvalidToolArgumentsError';\n    Object.setPrototypeOf(this, InvalidToolArgumentsError.prototype);\n  }\n}\n\nexport class ProviderError extends AIError {\n  constructor(\n    public readonly providerName: string,\n    message: string,\n    statusCode?: number,\n    originalError?: Error\n  ) {\n    super(\n      `${providerName}: ${message}`,\n      'PROVIDER_ERROR',\n      statusCode,\n      originalError\n    );\n    this.name = 'ProviderError';\n    Object.setPrototypeOf(this, ProviderError.prototype);\n  }\n}\n","/**\n * Base provider class with common functionality\n */\n\nimport { IProvider, ProviderCapabilities } from '../../../domain/interfaces/IProvider.js';\nimport { ProviderConfig } from '../../../domain/types/ProviderConfig.js';\nimport { InvalidConfigError } from '../../../domain/errors/AIErrors.js';\n\nexport abstract class BaseProvider implements IProvider {\n  abstract readonly name: string;\n  abstract readonly capabilities: ProviderCapabilities;\n\n  constructor(protected config: ProviderConfig) {}\n\n  /**\n   * Validate provider configuration\n   * Returns validation result with details\n   */\n  async validateConfig(): Promise<boolean> {\n    const validation = this.validateApiKey();\n    return validation.isValid;\n  }\n\n  /**\n   * Validate API key format and presence\n   * Can be overridden by providers with specific key formats\n   */\n  protected validateApiKey(): { isValid: boolean; warning?: string } {\n    const apiKey = this.config.apiKey;\n\n    // Check for presence\n    if (!apiKey || apiKey.trim().length === 0) {\n      return { isValid: false };\n    }\n\n    // Check for common placeholder values\n    const placeholders = [\n      'your-api-key',\n      'YOUR_API_KEY',\n      'sk-xxx',\n      'api-key-here',\n      'REPLACE_ME',\n      '<your-key>',\n    ];\n\n    if (placeholders.some((p) => apiKey.includes(p))) {\n      return {\n        isValid: false,\n        warning: `API key appears to be a placeholder value`,\n      };\n    }\n\n    // Provider-specific format validation (can be overridden)\n    return this.validateProviderSpecificKeyFormat(apiKey);\n  }\n\n  /**\n   * Override this method in provider implementations for specific key format validation\n   */\n  protected validateProviderSpecificKeyFormat(apiKey: string): { isValid: boolean; warning?: string } {\n    // Default: accept any non-empty key\n    return { isValid: true };\n  }\n\n  /**\n   * Validate config and throw if invalid\n   */\n  protected assertValidConfig(): void {\n    const validation = this.validateApiKey();\n    if (!validation.isValid) {\n      throw new InvalidConfigError(\n        `Invalid API key for provider '${this.name}'${validation.warning ? `: ${validation.warning}` : ''}`\n      );\n    }\n  }\n\n  /**\n   * Get API key from config\n   */\n  protected getApiKey(): string {\n    return this.config.apiKey;\n  }\n\n  /**\n   * Get base URL if configured\n   */\n  protected getBaseURL(): string | undefined {\n    return this.config.baseURL;\n  }\n\n  /**\n   * Get timeout configuration\n   */\n  protected getTimeout(): number {\n    return this.config.timeout || 60000; // 60s default\n  }\n\n  /**\n   * Get max retries configuration\n   */\n  protected getMaxRetries(): number {\n    return this.config.maxRetries || 3;\n  }\n}\n","/**\n * Base text provider with common text generation functionality\n */\n\nimport { BaseProvider } from './BaseProvider.js';\nimport { ITextProvider, ModelCapabilities, TextGenerateOptions } from '../../../domain/interfaces/ITextProvider.js';\nimport { LLMResponse } from '../../../domain/entities/Response.js';\nimport { StreamEvent } from '../../../domain/entities/StreamEvent.js';\n\nexport abstract class BaseTextProvider extends BaseProvider implements ITextProvider {\n  abstract generate(options: TextGenerateOptions): Promise<LLMResponse>;\n  abstract streamGenerate(options: TextGenerateOptions): AsyncIterableIterator<StreamEvent>;\n  abstract getModelCapabilities(model: string): ModelCapabilities;\n\n  /**\n   * Normalize input to string (helper for providers that don't support complex input)\n   */\n  protected normalizeInputToString(input: string | any[]): string {\n    if (typeof input === 'string') {\n      return input;\n    }\n\n    // Extract text from InputItem array\n    const textParts: string[] = [];\n    for (const item of input) {\n      if (item.type === 'message') {\n        for (const content of item.content) {\n          if (content.type === 'input_text') {\n            textParts.push(content.text);\n          } else if (content.type === 'output_text') {\n            textParts.push(content.text);\n          }\n        }\n      }\n    }\n\n    return textParts.join('\\n');\n  }\n\n  /**\n   * List available models (optional)\n   */\n  async listModels?(): Promise<string[]>;\n}\n","/**\n * Message entity based on OpenAI Responses API format\n */\n\nimport { Content } from './Content.js';\n\nexport enum MessageRole {\n  USER = 'user',\n  ASSISTANT = 'assistant',\n  DEVELOPER = 'developer', // Responses API uses \"developer\" instead of \"system\"\n}\n\nexport interface Message {\n  type: 'message';\n  id?: string;\n  role: MessageRole;\n  content: Content[]; // Always an array in Responses API\n}\n\nexport interface CompactionItem {\n  type: 'compaction';\n  id: string;\n  encrypted_content: string;\n}\n\nexport interface ReasoningItem {\n  type: 'reasoning';\n  id: string;\n  effort?: 'low' | 'medium' | 'high';\n  summary?: string;\n  encrypted_content?: string; // For o-series models\n}\n\nexport type InputItem = Message | CompactionItem;\nexport type OutputItem = Message | CompactionItem | ReasoningItem;\n","/**\n * Streaming event types for real-time LLM responses\n * Based on OpenAI Responses API event format as the internal standard\n */\n\nimport { TokenUsage } from './Response.js';\n\n/**\n * Stream event type enum\n */\nexport enum StreamEventType {\n  RESPONSE_CREATED = 'response.created',\n  RESPONSE_IN_PROGRESS = 'response.in_progress',\n  OUTPUT_TEXT_DELTA = 'response.output_text.delta',\n  OUTPUT_TEXT_DONE = 'response.output_text.done',\n  TOOL_CALL_START = 'response.tool_call.start',\n  TOOL_CALL_ARGUMENTS_DELTA = 'response.tool_call_arguments.delta',\n  TOOL_CALL_ARGUMENTS_DONE = 'response.tool_call_arguments.done',\n  TOOL_EXECUTION_START = 'response.tool_execution.start',\n  TOOL_EXECUTION_DONE = 'response.tool_execution.done',\n  ITERATION_COMPLETE = 'response.iteration.complete',\n  RESPONSE_COMPLETE = 'response.complete',\n  ERROR = 'response.error',\n}\n\n/**\n * Base interface for all stream events\n */\ninterface BaseStreamEvent {\n  type: StreamEventType;\n  response_id: string;\n}\n\n/**\n * Response created - first event in stream\n */\nexport interface ResponseCreatedEvent extends BaseStreamEvent {\n  type: StreamEventType.RESPONSE_CREATED;\n  model: string;\n  created_at: number;\n}\n\n/**\n * Response in progress\n */\nexport interface ResponseInProgressEvent extends BaseStreamEvent {\n  type: StreamEventType.RESPONSE_IN_PROGRESS;\n}\n\n/**\n * Text delta - incremental text output\n */\nexport interface OutputTextDeltaEvent extends BaseStreamEvent {\n  type: StreamEventType.OUTPUT_TEXT_DELTA;\n  item_id: string;\n  output_index: number;\n  content_index: number;\n  delta: string;\n  sequence_number: number;\n}\n\n/**\n * Text output complete for this item\n */\nexport interface OutputTextDoneEvent extends BaseStreamEvent {\n  type: StreamEventType.OUTPUT_TEXT_DONE;\n  item_id: string;\n  output_index: number;\n  text: string; // Complete accumulated text\n}\n\n/**\n * Tool call detected and starting\n */\nexport interface ToolCallStartEvent extends BaseStreamEvent {\n  type: StreamEventType.TOOL_CALL_START;\n  item_id: string;\n  tool_call_id: string;\n  tool_name: string;\n}\n\n/**\n * Tool call arguments delta - incremental JSON\n */\nexport interface ToolCallArgumentsDeltaEvent extends BaseStreamEvent {\n  type: StreamEventType.TOOL_CALL_ARGUMENTS_DELTA;\n  item_id: string;\n  tool_call_id: string;\n  tool_name: string;\n  delta: string; // JSON chunk\n  sequence_number: number;\n}\n\n/**\n * Tool call arguments complete\n */\nexport interface ToolCallArgumentsDoneEvent extends BaseStreamEvent {\n  type: StreamEventType.TOOL_CALL_ARGUMENTS_DONE;\n  tool_call_id: string;\n  tool_name: string;\n  arguments: string; // Complete JSON string\n  incomplete?: boolean; // True if truncated by max_tokens\n}\n\n/**\n * Tool execution starting\n */\nexport interface ToolExecutionStartEvent extends BaseStreamEvent {\n  type: StreamEventType.TOOL_EXECUTION_START;\n  tool_call_id: string;\n  tool_name: string;\n  arguments: any; // Parsed arguments\n}\n\n/**\n * Tool execution complete\n */\nexport interface ToolExecutionDoneEvent extends BaseStreamEvent {\n  type: StreamEventType.TOOL_EXECUTION_DONE;\n  tool_call_id: string;\n  tool_name: string;\n  result: any;\n  execution_time_ms: number;\n  error?: string; // If tool failed\n}\n\n/**\n * Iteration complete - end of agentic loop iteration\n */\nexport interface IterationCompleteEvent extends BaseStreamEvent {\n  type: StreamEventType.ITERATION_COMPLETE;\n  iteration: number;\n  tool_calls_count: number;\n  has_more_iterations: boolean;\n}\n\n/**\n * Response complete - final event\n */\nexport interface ResponseCompleteEvent extends BaseStreamEvent {\n  type: StreamEventType.RESPONSE_COMPLETE;\n  status: 'completed' | 'incomplete' | 'failed';\n  usage: TokenUsage;\n  iterations: number;\n  duration_ms?: number;\n}\n\n/**\n * Error event\n */\nexport interface ErrorEvent extends BaseStreamEvent {\n  type: StreamEventType.ERROR;\n  error: {\n    type: string;\n    message: string;\n    code?: string;\n  };\n  recoverable: boolean;\n}\n\n/**\n * Union type of all stream events\n * Discriminated by 'type' field for type narrowing\n */\nexport type StreamEvent =\n  | ResponseCreatedEvent\n  | ResponseInProgressEvent\n  | OutputTextDeltaEvent\n  | OutputTextDoneEvent\n  | ToolCallStartEvent\n  | ToolCallArgumentsDeltaEvent\n  | ToolCallArgumentsDoneEvent\n  | ToolExecutionStartEvent\n  | ToolExecutionDoneEvent\n  | IterationCompleteEvent\n  | ResponseCompleteEvent\n  | ErrorEvent;\n\n/**\n * Type guard to check if event is a specific type\n */\nexport function isStreamEvent<T extends StreamEvent>(\n  event: StreamEvent,\n  type: StreamEventType\n): event is T {\n  return event.type === type;\n}\n\n/**\n * Type guards for specific events\n */\nexport function isOutputTextDelta(event: StreamEvent): event is OutputTextDeltaEvent {\n  return event.type === StreamEventType.OUTPUT_TEXT_DELTA;\n}\n\nexport function isToolCallArgumentsDelta(\n  event: StreamEvent\n): event is ToolCallArgumentsDeltaEvent {\n  return event.type === StreamEventType.TOOL_CALL_ARGUMENTS_DELTA;\n}\n\nexport function isToolCallArgumentsDone(\n  event: StreamEvent\n): event is ToolCallArgumentsDoneEvent {\n  return event.type === StreamEventType.TOOL_CALL_ARGUMENTS_DONE;\n}\n\nexport function isResponseComplete(event: StreamEvent): event is ResponseCompleteEvent {\n  return event.type === StreamEventType.RESPONSE_COMPLETE;\n}\n\nexport function isErrorEvent(event: StreamEvent): event is ErrorEvent {\n  return event.type === StreamEventType.ERROR;\n}\n","/**\n * OpenAI text provider using Responses API\n */\n\nimport OpenAI from 'openai';\nimport { BaseTextProvider } from '../base/BaseTextProvider.js';\nimport { TextGenerateOptions, ModelCapabilities } from '../../../domain/interfaces/ITextProvider.js';\nimport { LLMResponse } from '../../../domain/entities/Response.js';\nimport { MessageRole } from '../../../domain/entities/Message.js';\nimport { ProviderCapabilities } from '../../../domain/interfaces/IProvider.js';\nimport { OpenAIConfig } from '../../../domain/types/ProviderConfig.js';\nimport {\n  ProviderAuthError,\n  ProviderRateLimitError,\n  ProviderContextLengthError,\n} from '../../../domain/errors/AIErrors.js';\nimport { StreamEvent, StreamEventType } from '../../../domain/entities/StreamEvent.js';\n\nexport class OpenAITextProvider extends BaseTextProvider {\n  readonly name = 'openai';\n  readonly capabilities: ProviderCapabilities = {\n    text: true,\n    images: true,\n    videos: false,\n    audio: true,\n  };\n\n  private client: OpenAI;\n\n  constructor(config: OpenAIConfig) {\n    super(config);\n    this.client = new OpenAI({\n      apiKey: this.getApiKey(),\n      baseURL: this.getBaseURL(),\n      organization: config.organization,\n      timeout: this.getTimeout(),\n      maxRetries: this.getMaxRetries(),\n    });\n  }\n\n  /**\n   * Generate response using OpenAI Responses API\n   */\n  async generate(options: TextGenerateOptions): Promise<LLMResponse> {\n    try {\n      // OpenAI Responses API format matches our internal format!\n      const response = await this.client.chat.completions.create({\n        model: options.model,\n        messages: this.convertInput(options.input),\n        tools: options.tools as any,\n        tool_choice: options.tool_choice as any,\n        temperature: options.temperature,\n        max_tokens: options.max_output_tokens,\n        response_format: options.response_format as any,\n      });\n\n      return this.convertResponse(response);\n    } catch (error: any) {\n      this.handleError(error);\n      throw error; // TypeScript needs this\n    }\n  }\n\n  /**\n   * Stream response using OpenAI Streaming API\n   */\n  async *streamGenerate(options: TextGenerateOptions): AsyncIterableIterator<StreamEvent> {\n    try {\n      const stream = await this.client.chat.completions.create({\n        model: options.model,\n        messages: this.convertInput(options.input),\n        tools: options.tools as any,\n        tool_choice: options.tool_choice as any,\n        temperature: options.temperature,\n        max_tokens: options.max_output_tokens,\n        response_format: options.response_format as any,\n        stream: true,\n        stream_options: { include_usage: true },\n      });\n\n      let responseId = '';\n      let sequenceNumber = 0;\n      let hasUsage = false;\n      const toolCallBuffers = new Map<number, { id: string; name: string; args: string }>();\n\n      for await (const chunk of stream) {\n        // Debug: Check what's in the chunk\n        if (process.env.DEBUG_OPENAI && chunk.usage) {\n          console.error('[DEBUG] OpenAI chunk has usage:', chunk.usage);\n        }\n\n        // Initialize response ID on first chunk\n        if (!responseId) {\n          responseId = chunk.id;\n          yield {\n            type: StreamEventType.RESPONSE_CREATED,\n            response_id: responseId,\n            model: chunk.model,\n            created_at: chunk.created,\n          };\n        }\n\n        // Handle usage info FIRST (sent at the end when stream_options.include_usage is true)\n        // This chunk might not have a choice, so check usage before validating choice\n        if (chunk.usage) {\n          hasUsage = true;\n\n          if (process.env.DEBUG_OPENAI) {\n            console.error('[DEBUG] Emitting RESPONSE_COMPLETE with usage:', {\n              prompt_tokens: chunk.usage.prompt_tokens,\n              completion_tokens: chunk.usage.completion_tokens,\n              total_tokens: chunk.usage.total_tokens,\n            });\n          }\n\n          yield {\n            type: StreamEventType.RESPONSE_COMPLETE,\n            response_id: responseId,\n            status: 'completed',\n            usage: {\n              input_tokens: chunk.usage.prompt_tokens || 0,\n              output_tokens: chunk.usage.completion_tokens || 0,\n              total_tokens: chunk.usage.total_tokens || 0,\n            },\n            iterations: 1,\n          };\n        }\n\n        const choice = chunk.choices[0];\n        if (!choice) continue;\n\n        const delta = choice.delta;\n\n        // Handle text content deltas\n        if (delta.content) {\n          yield {\n            type: StreamEventType.OUTPUT_TEXT_DELTA,\n            response_id: responseId,\n            item_id: `msg_${responseId}`,\n            output_index: 0,\n            content_index: 0,\n            delta: delta.content,\n            sequence_number: sequenceNumber++,\n          };\n        }\n\n        // Handle tool calls\n        if (delta.tool_calls) {\n          for (const toolCall of delta.tool_calls) {\n            const index = toolCall.index;\n\n            if (!toolCallBuffers.has(index)) {\n              // Start new tool call\n              const toolCallId = toolCall.id || `call_${responseId}_${index}`;\n              const toolName = toolCall.function?.name || '';\n\n              toolCallBuffers.set(index, {\n                id: toolCallId,\n                name: toolName,\n                args: '',\n              });\n\n              yield {\n                type: StreamEventType.TOOL_CALL_START,\n                response_id: responseId,\n                item_id: `msg_${responseId}`,\n                tool_call_id: toolCallId,\n                tool_name: toolName,\n              };\n            }\n\n            // Accumulate tool arguments\n            if (toolCall.function?.arguments) {\n              const buffer = toolCallBuffers.get(index)!;\n              buffer.args += toolCall.function.arguments;\n\n              yield {\n                type: StreamEventType.TOOL_CALL_ARGUMENTS_DELTA,\n                response_id: responseId,\n                item_id: `msg_${responseId}`,\n                tool_call_id: buffer.id,\n                tool_name: buffer.name,\n                delta: toolCall.function.arguments,\n                sequence_number: sequenceNumber++,\n              };\n            }\n          }\n        }\n\n        // Check if tool calls are complete (finish_reason indicates end)\n        if (choice.finish_reason && toolCallBuffers.size > 0) {\n          for (const buffer of toolCallBuffers.values()) {\n            yield {\n              type: StreamEventType.TOOL_CALL_ARGUMENTS_DONE,\n              response_id: responseId,\n              tool_call_id: buffer.id,\n              tool_name: buffer.name,\n              arguments: buffer.args,\n            };\n          }\n        }\n      }\n\n      // If no usage info was sent, emit completion event with zero usage\n      if (responseId && !hasUsage) {\n        yield {\n          type: StreamEventType.RESPONSE_COMPLETE,\n          response_id: responseId,\n          status: 'completed',\n          usage: {\n            input_tokens: 0,\n            output_tokens: 0,\n            total_tokens: 0,\n          },\n          iterations: 1,\n        };\n      }\n    } catch (error: any) {\n      this.handleError(error);\n      throw error;\n    }\n  }\n\n  /**\n   * Get model capabilities\n   */\n  getModelCapabilities(model: string): ModelCapabilities {\n    // GPT-4 models\n    if (model.startsWith('gpt-4')) {\n      return {\n        supportsTools: true,\n        supportsVision: model.includes('vision') || !model.includes('0613'),\n        supportsJSON: true,\n        supportsJSONSchema: true,\n        maxTokens: model.includes('turbo') ? 128000 : 8192,\n        maxOutputTokens: 16384,\n      };\n    }\n\n    // GPT-3.5\n    if (model.startsWith('gpt-3.5')) {\n      return {\n        supportsTools: true,\n        supportsVision: false,\n        supportsJSON: true,\n        supportsJSONSchema: false,\n        maxTokens: 16385,\n        maxOutputTokens: 4096,\n      };\n    }\n\n    // o-series (reasoning models)\n    if (model.startsWith('o1') || model.startsWith('o3')) {\n      return {\n        supportsTools: false,\n        supportsVision: true,\n        supportsJSON: false,\n        supportsJSONSchema: false,\n        maxTokens: 200000,\n        maxOutputTokens: 100000,\n      };\n    }\n\n    // Default\n    return {\n      supportsTools: false,\n      supportsVision: false,\n      supportsJSON: false,\n      supportsJSONSchema: false,\n      maxTokens: 4096,\n      maxOutputTokens: 4096,\n    };\n  }\n\n  /**\n   * Convert our input format to OpenAI messages format\n   */\n  private convertInput(input: string | any[]): any[] {\n    if (typeof input === 'string') {\n      return [{ role: 'user', content: input }];\n    }\n\n    // Convert InputItem[] to OpenAI messages format\n    const messages: any[] = [];\n\n    for (const item of input) {\n      if (item.type === 'message') {\n        const message: any = {\n          role: item.role === 'developer' ? 'system' : item.role,\n          content: [],\n        };\n\n        // Convert content array\n        for (const content of item.content) {\n          switch (content.type) {\n            case 'input_text':\n              message.content.push({ type: 'text', text: content.text });\n              break;\n            case 'input_image_url':\n              message.content.push({\n                type: 'image_url',\n                image_url: content.image_url,\n              });\n              break;\n            case 'output_text':\n              message.content.push({ type: 'text', text: content.text });\n              break;\n            case 'tool_use':\n              // OpenAI uses tool_calls at message level, not in content\n              if (!message.tool_calls) {\n                message.tool_calls = [];\n              }\n              message.tool_calls.push({\n                id: content.id,\n                type: 'function',\n                function: {\n                  name: content.name,\n                  arguments: content.arguments,\n                },\n              });\n              // Remove content array if we have tool calls\n              if (message.tool_calls.length > 0 && message.content.length === 0) {\n                message.content = null;\n              }\n              break;\n            case 'tool_result':\n              // Tool results are separate messages in OpenAI\n              messages.push({\n                role: 'tool',\n                tool_call_id: content.tool_use_id,\n                content: typeof content.content === 'string' ? content.content : JSON.stringify(content.content),\n              });\n              continue;\n          }\n        }\n\n        // Flatten content if it's a single text item\n        if (Array.isArray(message.content) && message.content.length === 1 && message.content[0].type === 'text') {\n          message.content = message.content[0].text;\n        }\n\n        messages.push(message);\n      }\n    }\n\n    return messages;\n  }\n\n  /**\n   * Convert OpenAI response to our LLMResponse format\n   */\n  private convertResponse(response: OpenAI.Chat.Completions.ChatCompletion): LLMResponse {\n    const choice = response.choices[0];\n    const message = choice?.message;\n\n    // Build content array\n    const content: any[] = [];\n\n    if (message?.content) {\n      content.push({\n        type: 'output_text',\n        text: message.content,\n        annotations: [],\n      });\n    }\n\n    // Add tool calls if present\n    if (message?.tool_calls) {\n      for (const toolCall of message.tool_calls) {\n        // Only process function type tool calls\n        if (toolCall.type === 'function' && 'function' in toolCall) {\n          content.push({\n            type: 'tool_use',\n            id: toolCall.id,\n            name: toolCall.function.name,\n            arguments: toolCall.function.arguments,\n          });\n        }\n      }\n    }\n\n    return {\n      id: response.id,\n      object: 'response',\n      created_at: response.created,\n      status: choice?.finish_reason === 'stop' ? 'completed' : 'incomplete',\n      model: response.model,\n      output: [\n        {\n          type: 'message' as const,\n          id: response.id,\n          role: MessageRole.ASSISTANT,\n          content,\n        },\n      ],\n      output_text: message?.content || '',\n      usage: {\n        input_tokens: response.usage?.prompt_tokens || 0,\n        output_tokens: response.usage?.completion_tokens || 0,\n        total_tokens: response.usage?.total_tokens || 0,\n      },\n    };\n  }\n\n  /**\n   * Handle OpenAI-specific errors\n   */\n  private handleError(error: any): never {\n    if (error.status === 401) {\n      throw new ProviderAuthError('openai', 'Invalid API key');\n    }\n\n    if (error.status === 429) {\n      const retryAfter = error.headers?.['retry-after'];\n      throw new ProviderRateLimitError(\n        'openai',\n        retryAfter ? parseInt(retryAfter) * 1000 : undefined\n      );\n    }\n\n    if (error.code === 'context_length_exceeded' || error.status === 413) {\n      throw new ProviderContextLengthError('openai', 128000);\n    }\n\n    // Re-throw other errors\n    throw error;\n  }\n}\n","/**\n * Generic OpenAI-compatible provider\n * Works with any service that implements the OpenAI Chat Completions API\n * Examples: Together AI, Groq, Perplexity, Grok (xAI), local models, etc.\n */\n\nimport { OpenAITextProvider } from '../openai/OpenAITextProvider.js';\nimport { ModelCapabilities } from '../../../domain/interfaces/ITextProvider.js';\nimport { ProviderCapabilities } from '../../../domain/interfaces/IProvider.js';\n\nexport interface GenericOpenAIConfig {\n  apiKey: string;\n  baseURL: string; // Required - the API endpoint\n  organization?: string;\n  timeout?: number;\n  maxRetries?: number;\n  defaultModel?: string;\n}\n\nexport class GenericOpenAIProvider extends OpenAITextProvider {\n  readonly name: string;\n  readonly capabilities: ProviderCapabilities;\n\n  constructor(\n    name: string,\n    config: GenericOpenAIConfig,\n    capabilities?: Partial<ProviderCapabilities>\n  ) {\n    super(config as any);\n    this.name = name;\n\n    // Set capabilities\n    if (capabilities) {\n      this.capabilities = {\n        text: capabilities.text ?? true,\n        images: capabilities.images ?? false,\n        videos: capabilities.videos ?? false,\n        audio: capabilities.audio ?? false,\n      };\n    } else {\n      // Default generic capabilities\n      this.capabilities = {\n        text: true,\n        images: false, // Conservative default\n        videos: false,\n        audio: false,\n      };\n    }\n  }\n\n  /**\n   * Override model capabilities for generic providers\n   * Can be customized per provider\n   */\n  getModelCapabilities(model: string): ModelCapabilities {\n    // Check for vision in model name (heuristic)\n    const hasVision =\n      model.toLowerCase().includes('vision') ||\n      model.toLowerCase().includes('llava') ||\n      model.toLowerCase().includes('llama-3.2-90b'); // Llama 3.2 90B has vision\n\n    // Check for large context models\n    const isLargeContext =\n      model.includes('128k') ||\n      model.includes('200k') ||\n      model.toLowerCase().includes('longtext');\n\n    return {\n      supportsTools: true, // Most OpenAI-compatible APIs support tools\n      supportsVision: hasVision,\n      supportsJSON: true, // Most support JSON mode\n      supportsJSONSchema: false, // Conservative - not all support schema\n      maxTokens: isLargeContext ? 128000 : 32000, // Conservative default\n      maxOutputTokens: 4096, // Common default\n    };\n  }\n}\n","/**\n * Content types based on OpenAI Responses API format\n */\n\nexport enum ContentType {\n  INPUT_TEXT = 'input_text',\n  INPUT_IMAGE_URL = 'input_image_url',\n  INPUT_FILE = 'input_file',\n  OUTPUT_TEXT = 'output_text',\n  TOOL_USE = 'tool_use',\n  TOOL_RESULT = 'tool_result',\n}\n\nexport interface BaseContent {\n  type: ContentType;\n}\n\nexport interface InputTextContent extends BaseContent {\n  type: ContentType.INPUT_TEXT;\n  text: string;\n}\n\nexport interface InputImageContent extends BaseContent {\n  type: ContentType.INPUT_IMAGE_URL;\n  image_url: {\n    url: string; // HTTP URL or data URI\n    detail?: 'auto' | 'low' | 'high';\n  };\n}\n\nexport interface InputFileContent extends BaseContent {\n  type: ContentType.INPUT_FILE;\n  file_id: string;\n}\n\nexport interface OutputTextContent extends BaseContent {\n  type: ContentType.OUTPUT_TEXT;\n  text: string;\n  annotations?: any[];\n}\n\nexport interface ToolUseContent extends BaseContent {\n  type: ContentType.TOOL_USE;\n  id: string;\n  name: string;\n  arguments: string; // JSON string\n}\n\nexport interface ToolResultContent extends BaseContent {\n  type: ContentType.TOOL_RESULT;\n  tool_use_id: string;\n  content: string | any;\n  error?: string;\n}\n\nexport type Content =\n  | InputTextContent\n  | InputImageContent\n  | InputFileContent\n  | OutputTextContent\n  | ToolUseContent\n  | ToolResultContent;\n","/**\n * Anthropic converter - Converts between our Responses API format and Anthropic Messages API\n */\n\nimport Anthropic from '@anthropic-ai/sdk';\nimport { TextGenerateOptions } from '../../../domain/interfaces/ITextProvider.js';\nimport { LLMResponse } from '../../../domain/entities/Response.js';\nimport { InputItem, MessageRole, OutputItem } from '../../../domain/entities/Message.js';\nimport { Content, ContentType } from '../../../domain/entities/Content.js';\nimport { Tool, FunctionToolDefinition } from '../../../domain/entities/Tool.js';\nimport { InvalidToolArgumentsError } from '../../../domain/errors/AIErrors.js';\n\nexport class AnthropicConverter {\n  /**\n   * Convert our format  Anthropic Messages API format\n   */\n  convertRequest(options: TextGenerateOptions): Anthropic.MessageCreateParams {\n    const messages = this.convertMessages(options.input);\n    const tools = this.convertTools(options.tools);\n\n    const params: Anthropic.MessageCreateParams = {\n      model: options.model,\n      max_tokens: options.max_output_tokens || 4096,\n      messages,\n    };\n\n    // Add system instruction if provided\n    if (options.instructions) {\n      params.system = options.instructions;\n    }\n\n    // Add tools if provided\n    if (tools && tools.length > 0) {\n      params.tools = tools;\n    }\n\n    // Add temperature if provided\n    if (options.temperature !== undefined) {\n      params.temperature = options.temperature;\n    }\n\n    return params;\n  }\n\n  /**\n   * Convert our InputItem[]  Anthropic messages\n   */\n  private convertMessages(input: string | InputItem[]): Anthropic.MessageParam[] {\n    if (typeof input === 'string') {\n      return [{ role: 'user', content: input }];\n    }\n\n    const messages: Anthropic.MessageParam[] = [];\n\n    for (const item of input) {\n      if (item.type === 'message') {\n        // Map roles: 'developer'  'user' (Anthropic doesn't have developer role)\n        const role = item.role === MessageRole.DEVELOPER ? 'user' : item.role;\n\n        // Convert content\n        const content = this.convertContent(item.content);\n\n        messages.push({\n          role: role as 'user' | 'assistant',\n          content,\n        });\n      }\n    }\n\n    return messages;\n  }\n\n  /**\n   * Convert our Content[]  Anthropic content blocks\n   */\n  private convertContent(content: Content[]): Anthropic.MessageParam['content'] {\n    const blocks: any[] = [];\n\n    for (const c of content) {\n      switch (c.type) {\n        case ContentType.INPUT_TEXT:\n        case ContentType.OUTPUT_TEXT:\n          blocks.push({\n            type: 'text',\n            text: c.text,\n          });\n          break;\n\n        case ContentType.INPUT_IMAGE_URL:\n          // Anthropic supports image URLs in Claude 3.5+\n          // Try URL first, will fall back to base64 if needed\n          if (c.image_url.url.startsWith('data:')) {\n            // Parse data URI\n            const matches = c.image_url.url.match(/^data:image\\/(\\w+);base64,(.+)$/);\n            if (matches) {\n              const mediaType = `image/${matches[1]}` as Anthropic.ImageBlockParam['source']['media_type'];\n              const data = matches[2];\n              blocks.push({\n                type: 'image',\n                source: {\n                  type: 'base64',\n                  media_type: mediaType,\n                  data,\n                },\n              });\n            }\n          } else {\n            // Use URL (Claude 3.5+ supports this)\n            blocks.push({\n              type: 'image',\n              source: {\n                type: 'url',\n                url: c.image_url.url,\n              },\n            });\n          }\n          break;\n\n        case ContentType.TOOL_RESULT:\n          blocks.push({\n            type: 'tool_result',\n            tool_use_id: c.tool_use_id,\n            content: typeof c.content === 'string' ? c.content : JSON.stringify(c.content),\n            is_error: !!c.error,\n          });\n          break;\n\n        case ContentType.TOOL_USE:\n          // This appears in assistant messages\n          // Safe JSON parse with error handling\n          let parsedInput: unknown;\n          try {\n            parsedInput = JSON.parse(c.arguments);\n          } catch (parseError) {\n            throw new InvalidToolArgumentsError(\n              c.name,\n              c.arguments,\n              parseError instanceof Error ? parseError : new Error(String(parseError))\n            );\n          }\n          blocks.push({\n            type: 'tool_use',\n            id: c.id,\n            name: c.name,\n            input: parsedInput,\n          });\n          break;\n      }\n    }\n\n    // If only one text block, return as string\n    if (blocks.length === 1 && blocks[0]?.type === 'text') {\n      return (blocks[0] as Anthropic.TextBlock).text;\n    }\n\n    return blocks;\n  }\n\n  /**\n   * Convert our Tool[]  Anthropic tools\n   */\n  private convertTools(tools?: Tool[]): Anthropic.Tool[] | undefined {\n    if (!tools || tools.length === 0) {\n      return undefined;\n    }\n\n    return tools\n      .filter((t): t is FunctionToolDefinition => t.type === 'function')\n      .map((tool) => ({\n        name: tool.function.name,\n        description: tool.function.description || '',\n        input_schema: {\n          type: 'object',\n          ...tool.function.parameters,\n        } as any,\n      }));\n  }\n\n  /**\n   * Convert Anthropic response  our LLMResponse format\n   */\n  convertResponse(response: Anthropic.Message): LLMResponse {\n    const output: OutputItem[] = [\n      {\n        type: 'message',\n        id: response.id,\n        role: MessageRole.ASSISTANT,\n        content: this.convertAnthropicContent(response.content),\n      },\n    ];\n\n    return {\n      id: `resp_anthropic_${response.id}`,\n      object: 'response',\n      created_at: Math.floor(Date.now() / 1000),\n      status: this.mapStopReason(response.stop_reason),\n      model: response.model,\n      output,\n      output_text: this.extractOutputText(response.content),\n      usage: {\n        input_tokens: response.usage.input_tokens,\n        output_tokens: response.usage.output_tokens,\n        total_tokens: response.usage.input_tokens + response.usage.output_tokens,\n      },\n    };\n  }\n\n  /**\n   * Convert Anthropic content blocks  our Content[]\n   */\n  private convertAnthropicContent(\n    blocks: Array<Anthropic.ContentBlock>\n  ): Content[] {\n    const content: Content[] = [];\n\n    for (const block of blocks) {\n      if (block.type === 'text') {\n        content.push({\n          type: ContentType.OUTPUT_TEXT,\n          text: block.text,\n          annotations: [],\n        });\n      } else if (block.type === 'tool_use') {\n        content.push({\n          type: ContentType.TOOL_USE,\n          id: block.id,\n          name: block.name,\n          arguments: JSON.stringify(block.input), // Convert object to JSON string\n        });\n      }\n    }\n\n    return content;\n  }\n\n  /**\n   * Extract output text from Anthropic content blocks\n   */\n  private extractOutputText(blocks: Array<Anthropic.ContentBlock>): string {\n    const textBlocks = blocks.filter(\n      (b): b is Anthropic.TextBlock => b.type === 'text'\n    );\n    return textBlocks.map((b) => b.text).join('\\n');\n  }\n\n  /**\n   * Map Anthropic stop_reason  our status\n   */\n  private mapStopReason(\n    stopReason: string | null\n  ): 'completed' | 'incomplete' | 'failed' {\n    switch (stopReason) {\n      case 'end_turn':\n        return 'completed';\n      case 'tool_use':\n        return 'completed'; // Tool use is normal completion\n      case 'max_tokens':\n        return 'incomplete';\n      case 'stop_sequence':\n        return 'completed';\n      default:\n        return 'incomplete';\n    }\n  }\n}\n","/**\n * Anthropic stream converter - converts Anthropic SSE events to our unified StreamEvent format\n */\n\nimport Anthropic from '@anthropic-ai/sdk';\nimport { StreamEvent, StreamEventType } from '../../../domain/entities/StreamEvent.js';\n\n/**\n * Converts Anthropic streaming events to our unified StreamEvent format\n */\nexport class AnthropicStreamConverter {\n  private responseId: string = '';\n  private model: string = '';\n  private sequenceNumber: number = 0;\n  private contentBlockIndex: Map<number, { type: string; id?: string; name?: string; accumulatedArgs?: string }> = new Map();\n  private usage: { input_tokens: number; output_tokens: number } = { input_tokens: 0, output_tokens: 0 };\n\n  /**\n   * Convert Anthropic stream to our StreamEvent format\n   */\n  async *convertStream(\n    anthropicStream: AsyncIterable<Anthropic.MessageStreamEvent>,\n    model: string\n  ): AsyncIterableIterator<StreamEvent> {\n    this.model = model;\n    this.sequenceNumber = 0;\n    this.contentBlockIndex.clear();\n    this.usage = { input_tokens: 0, output_tokens: 0 };\n\n    for await (const event of anthropicStream) {\n      const converted = this.convertEvent(event);\n      if (converted) {\n        for (const evt of converted) {\n          yield evt;\n        }\n      }\n    }\n  }\n\n  /**\n   * Convert single Anthropic event to our event(s)\n   */\n  private convertEvent(event: Anthropic.MessageStreamEvent): StreamEvent[] {\n    const eventType = event.type;\n\n    switch (eventType) {\n      case 'message_start':\n        return this.handleMessageStart(event as Anthropic.MessageStartEvent);\n\n      case 'content_block_start':\n        return this.handleContentBlockStart(event as Anthropic.ContentBlockStartEvent);\n\n      case 'content_block_delta':\n        return this.handleContentBlockDelta(event as Anthropic.ContentBlockDeltaEvent);\n\n      case 'content_block_stop':\n        return this.handleContentBlockStop(event as Anthropic.ContentBlockStopEvent);\n\n      case 'message_delta':\n        return this.handleMessageDelta(event as Anthropic.MessageDeltaEvent);\n\n      case 'message_stop':\n        return this.handleMessageStop();\n\n      default:\n        // Handle ping and other event types\n        return [];\n    }\n  }\n\n  /**\n   * Handle message_start event\n   */\n  private handleMessageStart(event: Anthropic.MessageStartEvent): StreamEvent[] {\n    this.responseId = event.message.id;\n\n    return [\n      {\n        type: StreamEventType.RESPONSE_CREATED,\n        response_id: this.responseId,\n        model: this.model,\n        created_at: Date.now(),\n      },\n    ];\n  }\n\n  /**\n   * Handle content_block_start event\n   */\n  private handleContentBlockStart(event: Anthropic.ContentBlockStartEvent): StreamEvent[] {\n    const index = event.index;\n    const block = event.content_block;\n\n    // Track block type\n    if (block.type === 'text') {\n      this.contentBlockIndex.set(index, { type: 'text' });\n      return []; // No event needed, text will come in deltas\n    } else if (block.type === 'tool_use') {\n      this.contentBlockIndex.set(index, {\n        type: 'tool_use',\n        id: block.id,\n        name: block.name,\n        accumulatedArgs: '', // Initialize args accumulator\n      });\n\n      return [\n        {\n          type: StreamEventType.TOOL_CALL_START,\n          response_id: this.responseId,\n          item_id: `msg_${this.responseId}`,\n          tool_call_id: block.id,\n          tool_name: block.name,\n        },\n      ];\n    }\n\n    return [];\n  }\n\n  /**\n   * Handle content_block_delta event\n   */\n  private handleContentBlockDelta(event: Anthropic.ContentBlockDeltaEvent): StreamEvent[] {\n    const index = event.index;\n    const delta = event.delta;\n    const blockInfo = this.contentBlockIndex.get(index);\n\n    if (!blockInfo) return [];\n\n    if (delta.type === 'text_delta') {\n      return [\n        {\n          type: StreamEventType.OUTPUT_TEXT_DELTA,\n          response_id: this.responseId,\n          item_id: `msg_${this.responseId}`,\n          output_index: 0,\n          content_index: index,\n          delta: delta.text,\n          sequence_number: this.sequenceNumber++,\n        },\n      ];\n    } else if (delta.type === 'input_json_delta') {\n      // Accumulate tool arguments\n      if (blockInfo.accumulatedArgs !== undefined) {\n        blockInfo.accumulatedArgs += delta.partial_json;\n      }\n\n      // Tool arguments delta\n      return [\n        {\n          type: StreamEventType.TOOL_CALL_ARGUMENTS_DELTA,\n          response_id: this.responseId,\n          item_id: `msg_${this.responseId}`,\n          tool_call_id: blockInfo.id || '',\n          tool_name: blockInfo.name || '',\n          delta: delta.partial_json,\n          sequence_number: this.sequenceNumber++,\n        },\n      ];\n    }\n\n    return [];\n  }\n\n  /**\n   * Handle content_block_stop event\n   */\n  private handleContentBlockStop(event: Anthropic.ContentBlockStopEvent): StreamEvent[] {\n    const index = event.index;\n    const blockInfo = this.contentBlockIndex.get(index);\n\n    if (!blockInfo) return [];\n\n    // If this was a tool use block, emit arguments done\n    if (blockInfo.type === 'tool_use') {\n      return [\n        {\n          type: StreamEventType.TOOL_CALL_ARGUMENTS_DONE,\n          response_id: this.responseId,\n          tool_call_id: blockInfo.id || '',\n          tool_name: blockInfo.name || '',\n          arguments: blockInfo.accumulatedArgs || '{}', // Use accumulated args\n        },\n      ];\n    }\n\n    return [];\n  }\n\n  /**\n   * Handle message_delta event (usage info, stop_reason)\n   */\n  private handleMessageDelta(event: Anthropic.MessageDeltaEvent): StreamEvent[] {\n    // Extract usage info (Anthropic sends cumulative usage in message_delta)\n    if (event.usage) {\n      this.usage.input_tokens = event.usage.input_tokens || 0;\n      this.usage.output_tokens = event.usage.output_tokens || 0;\n    }\n\n    // No events to emit - we'll include usage in message_stop\n    return [];\n  }\n\n  /**\n   * Handle message_stop event (final event)\n   */\n  private handleMessageStop(): StreamEvent[] {\n    return [\n      {\n        type: StreamEventType.RESPONSE_COMPLETE,\n        response_id: this.responseId,\n        status: 'completed',\n        usage: {\n          input_tokens: this.usage.input_tokens,\n          output_tokens: this.usage.output_tokens,\n          total_tokens: this.usage.input_tokens + this.usage.output_tokens,\n        },\n        iterations: 1,\n      },\n    ];\n  }\n\n  /**\n   * Clear all internal state\n   * Should be called after each stream completes to prevent memory leaks\n   */\n  clear(): void {\n    this.responseId = '';\n    this.model = '';\n    this.sequenceNumber = 0;\n    this.contentBlockIndex.clear();\n    this.usage = { input_tokens: 0, output_tokens: 0 };\n  }\n\n  /**\n   * Reset converter state for a new stream\n   * Alias for clear()\n   */\n  reset(): void {\n    this.clear();\n  }\n}\n","/**\n * Anthropic (Claude) text provider\n */\n\nimport Anthropic from '@anthropic-ai/sdk';\nimport { BaseTextProvider } from '../base/BaseTextProvider.js';\nimport { TextGenerateOptions, ModelCapabilities } from '../../../domain/interfaces/ITextProvider.js';\nimport { LLMResponse } from '../../../domain/entities/Response.js';\nimport { ProviderCapabilities } from '../../../domain/interfaces/IProvider.js';\nimport { AnthropicConfig } from '../../../domain/types/ProviderConfig.js';\nimport {\n  ProviderAuthError,\n  ProviderRateLimitError,\n  ProviderContextLengthError,\n} from '../../../domain/errors/AIErrors.js';\nimport { AnthropicConverter } from './AnthropicConverter.js';\nimport { AnthropicStreamConverter } from './AnthropicStreamConverter.js';\nimport { StreamEvent } from '../../../domain/entities/StreamEvent.js';\n\nexport class AnthropicTextProvider extends BaseTextProvider {\n  readonly name = 'anthropic';\n  readonly capabilities: ProviderCapabilities = {\n    text: true,\n    images: true, // Claude 3+ supports vision\n    videos: false,\n    audio: false,\n  };\n\n  private client: Anthropic;\n  private converter: AnthropicConverter;\n  private streamConverter: AnthropicStreamConverter;\n\n  constructor(config: AnthropicConfig) {\n    super(config);\n    this.client = new Anthropic({\n      apiKey: this.getApiKey(),\n      baseURL: this.getBaseURL(),\n      maxRetries: this.getMaxRetries(),\n    });\n    this.converter = new AnthropicConverter();\n    this.streamConverter = new AnthropicStreamConverter();\n  }\n\n  /**\n   * Generate response using Anthropic Messages API\n   */\n  async generate(options: TextGenerateOptions): Promise<LLMResponse> {\n    try {\n      // Convert our format  Anthropic Messages API format\n      const anthropicRequest = this.converter.convertRequest(options);\n\n      // Call Anthropic API (not stream)\n      const anthropicResponse = await this.client.messages.create({\n        ...anthropicRequest,\n        stream: false,\n      });\n\n      // Convert Anthropic response  our format\n      return this.converter.convertResponse(anthropicResponse);\n    } catch (error: any) {\n      this.handleError(error);\n      throw error; // TypeScript needs this\n    }\n  }\n\n  /**\n   * Stream response using Anthropic Messages API\n   */\n  async *streamGenerate(options: TextGenerateOptions): AsyncIterableIterator<StreamEvent> {\n    try {\n      // Convert our format  Anthropic Messages API format\n      const anthropicRequest = this.converter.convertRequest(options);\n\n      // Create stream\n      const stream = await this.client.messages.create({\n        ...anthropicRequest,\n        stream: true,\n      });\n\n      // Reset stream converter for reuse\n      this.streamConverter.reset();\n\n      // Convert Anthropic events  our StreamEvent format\n      yield* this.streamConverter.convertStream(stream, options.model);\n\n      // Clear stream converter to prevent memory leaks\n      this.streamConverter.clear();\n    } catch (error: any) {\n      // Clear stream converter even on error\n      this.streamConverter.clear();\n      this.handleError(error);\n      throw error;\n    }\n  }\n\n  /**\n   * Get model capabilities\n   */\n  getModelCapabilities(model: string): ModelCapabilities {\n    // Claude 4.5 and Claude 4 (Sonnet, Opus, Haiku)\n    if (model.includes('claude-sonnet-4') || model.includes('claude-opus-4') || model.includes('claude-haiku-4')) {\n      return {\n        supportsTools: true,\n        supportsVision: true,\n        supportsJSON: true,\n        supportsJSONSchema: false, // Use prompt engineering\n        maxTokens: 200000,\n        maxOutputTokens: 8192,\n      };\n    }\n\n    // Claude 3.5 Sonnet\n    if (model.includes('claude-3-5-sonnet') || model.includes('claude-3-7-sonnet')) {\n      return {\n        supportsTools: true,\n        supportsVision: true,\n        supportsJSON: true,\n        supportsJSONSchema: false,\n        maxTokens: 200000,\n        maxOutputTokens: 8192,\n      };\n    }\n\n    // Claude 3 Opus\n    if (model.includes('claude-3-opus')) {\n      return {\n        supportsTools: true,\n        supportsVision: true,\n        supportsJSON: true,\n        supportsJSONSchema: false,\n        maxTokens: 200000,\n        maxOutputTokens: 4096,\n      };\n    }\n\n    // Claude 3 Sonnet\n    if (model.includes('claude-3-sonnet')) {\n      return {\n        supportsTools: true,\n        supportsVision: true,\n        supportsJSON: true,\n        supportsJSONSchema: false,\n        maxTokens: 200000,\n        maxOutputTokens: 4096,\n      };\n    }\n\n    // Claude 3 Haiku\n    if (model.includes('claude-3-haiku')) {\n      return {\n        supportsTools: true,\n        supportsVision: true,\n        supportsJSON: true,\n        supportsJSONSchema: false,\n        maxTokens: 200000,\n        maxOutputTokens: 4096,\n      };\n    }\n\n    // Claude 2.x (legacy)\n    if (model.includes('claude-2')) {\n      return {\n        supportsTools: false,\n        supportsVision: false,\n        supportsJSON: true,\n        supportsJSONSchema: false,\n        maxTokens: 100000,\n        maxOutputTokens: 4096,\n      };\n    }\n\n    // Default for unknown models\n    return {\n      supportsTools: true,\n      supportsVision: true,\n      supportsJSON: true,\n      supportsJSONSchema: false,\n      maxTokens: 200000,\n      maxOutputTokens: 4096,\n    };\n  }\n\n  /**\n   * Handle Anthropic-specific errors\n   */\n  private handleError(error: any): never {\n    if (error.status === 401) {\n      throw new ProviderAuthError('anthropic', 'Invalid API key');\n    }\n\n    if (error.status === 429) {\n      const retryAfter = error.headers?.['retry-after'];\n      throw new ProviderRateLimitError(\n        'anthropic',\n        retryAfter ? parseInt(retryAfter) * 1000 : undefined\n      );\n    }\n\n    if (\n      error.type === 'invalid_request_error' &&\n      (error.message?.includes('prompt is too long') ||\n        error.message?.includes('maximum context length'))\n    ) {\n      throw new ProviderContextLengthError('anthropic', 200000);\n    }\n\n    // Re-throw other errors\n    throw error;\n  }\n}\n","/**\n * Image utilities for processing images\n */\n\nexport interface ImageData {\n  mimeType: string;\n  base64Data: string;\n  size: number;\n}\n\nexport interface FetchImageOptions {\n  /** Timeout in milliseconds (default: 30000) */\n  timeoutMs?: number;\n  /** Maximum image size in bytes (default: 10MB) */\n  maxSizeBytes?: number;\n}\n\nconst DEFAULT_TIMEOUT_MS = 30000; // 30 seconds\nconst DEFAULT_MAX_SIZE_BYTES = 10 * 1024 * 1024; // 10MB\n\n/**\n * Fetch an image from URL and convert to base64\n * Used by providers that require base64 (like Google)\n */\nexport async function fetchImageAsBase64(\n  url: string,\n  options?: FetchImageOptions\n): Promise<ImageData> {\n  const { timeoutMs = DEFAULT_TIMEOUT_MS, maxSizeBytes = DEFAULT_MAX_SIZE_BYTES } = options || {};\n\n  // Check if it's already a data URI\n  if (url.startsWith('data:image/')) {\n    const matches = url.match(/^data:(image\\/\\w+);base64,(.+)$/);\n    if (matches) {\n      const base64Data = matches[2] || '';\n      const size = calculateBase64Size(base64Data);\n\n      // Check size limit for data URIs too\n      if (size > maxSizeBytes) {\n        throw new Error(`Image size (${formatBytes(size)}) exceeds maximum allowed (${formatBytes(maxSizeBytes)})`);\n      }\n\n      return {\n        mimeType: matches[1] || 'image/png',\n        base64Data,\n        size,\n      };\n    }\n  }\n\n  // Fetch from URL with timeout and size limit\n  const controller = new AbortController();\n  const timeoutId = setTimeout(() => controller.abort(), timeoutMs);\n\n  try {\n    const response = await fetch(url, {\n      signal: controller.signal,\n    });\n\n    if (!response.ok) {\n      throw new Error(`Failed to fetch image: ${response.status} ${response.statusText}`);\n    }\n\n    // Check content-length header before downloading\n    const contentLength = response.headers.get('content-length');\n    if (contentLength) {\n      const size = parseInt(contentLength, 10);\n      if (size > maxSizeBytes) {\n        throw new Error(\n          `Image size (${formatBytes(size)}) exceeds maximum allowed (${formatBytes(maxSizeBytes)})`\n        );\n      }\n    }\n\n    // Stream the response with size limit\n    const reader = response.body?.getReader();\n    if (!reader) {\n      throw new Error('Failed to get response body reader');\n    }\n\n    const chunks: Uint8Array[] = [];\n    let totalSize = 0;\n\n    while (true) {\n      const { done, value } = await reader.read();\n      if (done) break;\n\n      totalSize += value.length;\n      if (totalSize > maxSizeBytes) {\n        reader.cancel();\n        throw new Error(\n          `Image size exceeds maximum allowed (${formatBytes(maxSizeBytes)})`\n        );\n      }\n      chunks.push(value);\n    }\n\n    // Combine chunks into a single buffer\n    const buffer = Buffer.concat(chunks.map((chunk) => Buffer.from(chunk)));\n    const base64Data = buffer.toString('base64');\n\n    // Detect MIME type from content-type header or buffer magic numbers\n    let mimeType = response.headers.get('content-type') || 'image/png';\n\n    // Validate it's an image\n    if (!mimeType.startsWith('image/')) {\n      // Try to detect from magic numbers\n      mimeType = detectImageFormatFromBuffer(buffer);\n    }\n\n    return {\n      mimeType,\n      base64Data,\n      size: buffer.length,\n    };\n  } catch (error: any) {\n    if (error.name === 'AbortError') {\n      throw new Error(`Image fetch timed out after ${timeoutMs}ms`);\n    }\n    throw new Error(`Failed to fetch image from URL: ${error.message}`);\n  } finally {\n    clearTimeout(timeoutId);\n  }\n}\n\n/**\n * Detect image format from buffer magic numbers\n */\nfunction detectImageFormatFromBuffer(buffer: Buffer): string {\n  const magic = buffer.slice(0, 4).toString('hex');\n\n  if (magic.startsWith('89504e47')) return 'image/png';\n  if (magic.startsWith('ffd8ff')) return 'image/jpeg';\n  if (magic.startsWith('47494638')) return 'image/gif';\n  if (magic.startsWith('52494646')) return 'image/webp';\n\n  throw new Error('URL does not point to a valid image');\n}\n\n/**\n * Detect image format from base64 data\n */\nexport function detectImageFormat(base64Data: string): string {\n  const buffer = Buffer.from(base64Data, 'base64');\n  const magic = buffer.slice(0, 4).toString('hex');\n\n  if (magic.startsWith('89504e47')) return 'image/png';\n  if (magic.startsWith('ffd8ff')) return 'image/jpeg';\n  if (magic.startsWith('47494638')) return 'image/gif';\n  if (magic.startsWith('52494646')) return 'image/webp';\n\n  return 'image/png'; // Default\n}\n\n/**\n * Calculate accurate size from base64 data (in bytes)\n * Accounts for padding characters\n */\nexport function calculateBase64Size(base64Data: string): number {\n  // Remove data URI prefix if present\n  const data = base64Data.includes(',') ? base64Data.split(',')[1] : base64Data;\n\n  if (!data || data.length === 0) return 0;\n\n  // Count padding characters\n  let padding = 0;\n  if (data.endsWith('==')) padding = 2;\n  else if (data.endsWith('=')) padding = 1;\n\n  // Accurate calculation: (length * 3 / 4) - padding\n  return Math.floor((data.length * 3) / 4) - padding;\n}\n\n/**\n * Get image size from base64 data (in bytes)\n * @deprecated Use calculateBase64Size instead for accurate size\n */\nexport function getBase64ImageSize(base64Data: string): number {\n  return calculateBase64Size(base64Data);\n}\n\n/**\n * Format bytes into human-readable string\n */\nfunction formatBytes(bytes: number): string {\n  if (bytes < 1024) return `${bytes} bytes`;\n  if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`;\n  return `${(bytes / (1024 * 1024)).toFixed(1)} MB`;\n}\n","/**\n * Google Gemini converter - Converts between our Responses API format and Google Gemini API\n * Works with both @google/genai SDK (for Gemini API and Vertex AI)\n */\n\n// Import types - the new SDK may have different type names\nimport { randomUUID } from 'crypto';\nimport type {\n  Content as GeminiContent,\n  Part,\n  FunctionDeclaration,\n} from '@google/genai';\nimport { TextGenerateOptions } from '../../../domain/interfaces/ITextProvider.js';\nimport { LLMResponse } from '../../../domain/entities/Response.js';\nimport { InputItem, MessageRole, OutputItem } from '../../../domain/entities/Message.js';\nimport { Content, ContentType } from '../../../domain/entities/Content.js';\nimport { Tool, FunctionToolDefinition } from '../../../domain/entities/Tool.js';\nimport { fetchImageAsBase64 } from '../../../utils/imageUtils.js';\nimport { InvalidToolArgumentsError } from '../../../domain/errors/AIErrors.js';\n\nexport class GoogleConverter {\n  // Track tool call ID  tool name mapping for tool results\n  private toolCallMapping: Map<string, string> = new Map();\n  // Track tool call ID  thought signature for Gemini 3+\n  private thoughtSignatures: Map<string, string> = new Map();\n\n  /**\n   * Convert our format  Google Gemini format\n   */\n  async convertRequest(options: TextGenerateOptions): Promise<any> {\n    // Debug input messages\n    if (process.env.DEBUG_GOOGLE && Array.isArray(options.input)) {\n      console.error('[DEBUG] Input messages:', JSON.stringify(options.input.map((msg: any) => ({\n        type: msg.type,\n        role: msg.role,\n        contentTypes: msg.content?.map((c: any) => c.type),\n      })), null, 2));\n    }\n\n    const contents = await this.convertMessages(options.input);\n    const tools = this.convertTools(options.tools);\n\n    // Debug: Check final contents\n    if (process.env.DEBUG_GOOGLE) {\n      console.error('[DEBUG] Final contents array length:', contents.length);\n    }\n\n    const request: any = {\n      contents,\n    };\n\n    // Add system instruction if provided\n    if (options.instructions) {\n      request.systemInstruction = { parts: [{ text: options.instructions }] };\n    }\n\n    // Add tools if provided\n    if (tools && tools.length > 0) {\n      request.tools = [{ functionDeclarations: tools }];\n\n      // Add tool config to encourage tool use\n      request.toolConfig = {\n        functionCallingConfig: {\n          mode: options.tool_choice === 'required' ? 'ANY' : 'AUTO',\n        },\n      };\n    }\n\n    // Add generation config\n    request.generationConfig = {\n      temperature: options.temperature,\n      maxOutputTokens: options.max_output_tokens,\n    };\n\n    // Disable Google's code execution if we have function tools\n    // (prevents model from generating code instead of calling tools)\n    if (tools && tools.length > 0) {\n      request.generationConfig.allowCodeExecution = false;\n    }\n\n    // Handle JSON output\n    if (options.response_format) {\n      if (options.response_format.type === 'json_object') {\n        request.generationConfig.responseMimeType = 'application/json';\n      } else if (options.response_format.type === 'json_schema') {\n        request.generationConfig.responseMimeType = 'application/json';\n        // Google doesn't support full JSON schema - would need to add to system instruction\n      }\n    }\n\n    return request;\n  }\n\n  /**\n   * Convert our InputItem[]  Google contents\n   */\n  private async convertMessages(input: string | InputItem[]): Promise<GeminiContent[]> {\n    if (typeof input === 'string') {\n      return [\n        {\n          role: 'user',\n          parts: [{ text: input }],\n        },\n      ];\n    }\n\n    const contents: GeminiContent[] = [];\n\n    for (const item of input) {\n      if (item.type === 'message') {\n        // Map roles\n        const role = item.role === MessageRole.USER || item.role === MessageRole.DEVELOPER ? 'user' : 'model';\n\n        // Convert content to parts\n        const parts = await this.convertContentToParts(item.content);\n\n        // Debug logging\n        if (process.env.DEBUG_GOOGLE) {\n          console.error(`[DEBUG] Converting message - role: ${item.role}  ${role}, parts: ${parts.length}`,\n            parts.map((p: any) => Object.keys(p)));\n        }\n\n        if (parts.length > 0) {\n          contents.push({\n            role,\n            parts,\n          });\n        }\n      }\n    }\n\n    return contents;\n  }\n\n  /**\n   * Convert our Content[]  Google parts\n   */\n  private async convertContentToParts(content: Content[]): Promise<Part[]> {\n    const parts: Part[] = [];\n\n    for (const c of content) {\n      switch (c.type) {\n        case ContentType.INPUT_TEXT:\n        case ContentType.OUTPUT_TEXT:\n          parts.push({ text: c.text });\n          break;\n\n        case ContentType.INPUT_IMAGE_URL:\n          // Google requires inline data (base64), not URLs\n          try {\n            const imageData = await fetchImageAsBase64(c.image_url.url);\n            parts.push({\n              inlineData: {\n                mimeType: imageData.mimeType,\n                data: imageData.base64Data,\n              },\n            });\n          } catch (error: any) {\n            // If image fetch fails, skip it and add error as text\n            console.error(`Failed to fetch image: ${error.message}`);\n            parts.push({\n              text: `[Error: Could not load image from ${c.image_url.url}]`,\n            });\n          }\n          break;\n\n        case ContentType.TOOL_USE:\n          // Store tool call ID  name mapping for later use\n          this.toolCallMapping.set(c.id, c.name);\n\n          // Safe JSON parse with error handling\n          let parsedArgs: unknown;\n          try {\n            parsedArgs = JSON.parse(c.arguments);\n          } catch (parseError) {\n            throw new InvalidToolArgumentsError(\n              c.name,\n              c.arguments,\n              parseError instanceof Error ? parseError : new Error(String(parseError))\n            );\n          }\n\n          // Google uses functionCall\n          const functionCallPart: any = {\n            functionCall: {\n              name: c.name,\n              args: parsedArgs,\n            },\n          };\n\n          // Add thought signature if we have one (required for Gemini 3+)\n          const signature = this.thoughtSignatures.get(c.id);\n\n          if (process.env.DEBUG_GOOGLE) {\n            console.error(`[DEBUG] Looking up signature for tool ID: ${c.id}`);\n            console.error(`[DEBUG] Found signature:`, signature ? 'YES' : 'NO');\n            console.error(`[DEBUG] Available signatures:`, Array.from(this.thoughtSignatures.keys()));\n          }\n\n          if (signature) {\n            functionCallPart.thoughtSignature = signature;\n          }\n\n          parts.push(functionCallPart);\n          break;\n\n        case ContentType.TOOL_RESULT:\n          // Google uses functionResponse - look up the actual function name\n          const functionName = this.toolCallMapping.get(c.tool_use_id) || this.extractToolName(c.tool_use_id);\n\n          parts.push({\n            functionResponse: {\n              name: functionName, // Use actual function name from mapping\n              response: {\n                result: typeof c.content === 'string' ? c.content : c.content,\n              },\n            },\n          });\n          break;\n      }\n    }\n\n    return parts;\n  }\n\n  /**\n   * Convert our Tool[]  Google function declarations\n   */\n  private convertTools(tools?: Tool[]): FunctionDeclaration[] | undefined {\n    if (!tools || tools.length === 0) {\n      return undefined;\n    }\n\n    return tools\n      .filter((t): t is FunctionToolDefinition => t.type === 'function')\n      .map((tool) => ({\n        name: tool.function.name,\n        description: tool.function.description || '',\n        parameters: this.convertParametersSchema(tool.function.parameters),\n      }));\n  }\n\n  /**\n   * Convert JSON Schema parameters to Google's format\n   */\n  private convertParametersSchema(schema: any): any {\n    if (!schema) return undefined;\n\n    const converted: any = {\n      type: 'OBJECT', // Google uses uppercase 'OBJECT'\n      properties: {},\n    };\n\n    // Convert property types to uppercase\n    if (schema.properties) {\n      for (const [key, value] of Object.entries(schema.properties)) {\n        const prop = value as any;\n        converted.properties[key] = {\n          type: prop.type?.toUpperCase() || 'STRING',\n          description: prop.description,\n        };\n\n        // Handle enums\n        if (prop.enum) {\n          converted.properties[key].enum = prop.enum;\n        }\n\n        // Handle nested objects/arrays\n        if (prop.type === 'object' && prop.properties) {\n          converted.properties[key] = this.convertParametersSchema(prop);\n        }\n        if (prop.type === 'array' && prop.items) {\n          converted.properties[key].items = this.convertParametersSchema(prop.items);\n        }\n      }\n    }\n\n    // Add required fields\n    if (schema.required) {\n      converted.required = schema.required;\n    }\n\n    return converted;\n  }\n\n  /**\n   * Convert Google response  our LLMResponse format\n   */\n  convertResponse(response: any): LLMResponse {\n    const candidate = response.candidates?.[0];\n    const geminiContent = candidate?.content;\n\n    // Convert Google parts to our content\n    const content = this.convertGeminiPartsToContent(geminiContent?.parts || []);\n\n    const output: OutputItem[] = [\n      {\n        type: 'message',\n        id: response.id || `google_msg_${randomUUID()}`,\n        role: MessageRole.ASSISTANT,\n        content,\n      },\n    ];\n\n    const outputText = this.extractOutputText(geminiContent?.parts || []);\n\n    // Debug output text extraction\n    if (process.env.DEBUG_GOOGLE) {\n      console.error('[DEBUG] Extracted output_text:', outputText);\n      console.error('[DEBUG] Content array:', JSON.stringify(content, null, 2));\n      console.error('[DEBUG] Raw parts:', JSON.stringify(geminiContent?.parts, null, 2));\n    }\n\n    return {\n      id: `resp_google_${randomUUID()}`,\n      object: 'response',\n      created_at: Math.floor(Date.now() / 1000),\n      status: this.mapFinishReason(candidate?.finishReason),\n      model: response.modelVersion || 'gemini',\n      output,\n      output_text: outputText,\n      usage: {\n        input_tokens: response.usageMetadata?.promptTokenCount || 0,\n        output_tokens: response.usageMetadata?.candidatesTokenCount || 0,\n        total_tokens: response.usageMetadata?.totalTokenCount || 0,\n      },\n    };\n  }\n\n  /**\n   * Convert Google parts  our Content[]\n   */\n  private convertGeminiPartsToContent(parts: Part[]): Content[] {\n    const content: Content[] = [];\n\n    for (const part of parts) {\n      if ('text' in part && part.text) {\n        content.push({\n          type: ContentType.OUTPUT_TEXT,\n          text: part.text,\n          annotations: [],\n        });\n      } else if ('functionCall' in part && part.functionCall) {\n        const toolId = `google_${randomUUID()}`;\n        const functionName = part.functionCall.name || '';\n\n        // Store thought signature if present (required for Gemini 3+)\n        if ('thoughtSignature' in part && part.thoughtSignature) {\n          const sig = part.thoughtSignature as string;\n          this.thoughtSignatures.set(toolId, sig);\n\n          if (process.env.DEBUG_GOOGLE) {\n            console.error(`[DEBUG] Captured thought signature for tool ID: ${toolId}`);\n            console.error(`[DEBUG] Signature length:`, sig.length);\n          }\n        } else if (process.env.DEBUG_GOOGLE) {\n          console.error(`[DEBUG] NO thought signature in part for ${functionName}`);\n          console.error(`[DEBUG] Part keys:`, Object.keys(part));\n        }\n\n        content.push({\n          type: ContentType.TOOL_USE,\n          id: toolId,\n          name: functionName,\n          arguments: JSON.stringify(part.functionCall.args || {}),\n        });\n      }\n    }\n\n    return content;\n  }\n\n  /**\n   * Extract output text from Google parts\n   */\n  private extractOutputText(parts: Part[]): string {\n    return parts\n      .filter((p): p is { text: string } => 'text' in p && typeof p.text === 'string')\n      .map((p) => p.text)\n      .join('\\n');\n  }\n\n  /**\n   * Map Google finish reason  our status\n   */\n  private mapFinishReason(finishReason: string | undefined): 'completed' | 'incomplete' | 'failed' {\n    switch (finishReason) {\n      case 'STOP':\n        return 'completed';\n      case 'MAX_TOKENS':\n        return 'incomplete';\n      case 'SAFETY':\n      case 'RECITATION':\n        return 'failed';\n      case 'OTHER':\n      default:\n        return 'incomplete';\n    }\n  }\n\n  /**\n   * Extract tool name from tool_use_id using tracked mapping\n   */\n  private extractToolName(toolUseId: string): string {\n    const name = this.toolCallMapping.get(toolUseId);\n    if (name) {\n      return name;\n    }\n    // Fallback - log warning and return placeholder\n    console.warn(`[GoogleConverter] Tool name not found for ID: ${toolUseId}`);\n    return 'unknown_tool';\n  }\n\n  /**\n   * Clear all internal mappings\n   * Should be called after each request/response cycle to prevent memory leaks\n   */\n  clearMappings(): void {\n    this.toolCallMapping.clear();\n    this.thoughtSignatures.clear();\n  }\n\n  /**\n   * Reset converter state for a new request\n   * Alias for clearMappings()\n   */\n  reset(): void {\n    this.clearMappings();\n  }\n}\n","/**\n * Google Gemini stream converter - converts Google streaming responses to our unified StreamEvent format\n */\n\nimport { randomUUID } from 'crypto';\nimport { GenerateContentResponse } from '@google/genai';\nimport { StreamEvent, StreamEventType } from '../../../domain/entities/StreamEvent.js';\n\n/**\n * Converts Google Gemini streaming responses to our unified StreamEvent format\n */\nexport class GoogleStreamConverter {\n  private responseId: string = '';\n  private model: string = '';\n  private sequenceNumber: number = 0;\n  private isFirst: boolean = true;\n  private toolCallBuffers: Map<string, { name: string; args: string }> = new Map();\n\n  /**\n   * Convert Google stream to our StreamEvent format\n   */\n  async *convertStream(\n    googleStream: AsyncIterable<GenerateContentResponse>,\n    model: string\n  ): AsyncIterableIterator<StreamEvent> {\n    this.model = model;\n    this.sequenceNumber = 0;\n    this.isFirst = true;\n    this.toolCallBuffers.clear();\n\n    let lastUsage: { input_tokens: number; output_tokens: number; total_tokens: number } = {\n      input_tokens: 0,\n      output_tokens: 0,\n      total_tokens: 0,\n    };\n\n    for await (const chunk of googleStream) {\n      if (this.isFirst) {\n        this.responseId = this.generateResponseId();\n        yield {\n          type: StreamEventType.RESPONSE_CREATED,\n          response_id: this.responseId,\n          model: this.model,\n          created_at: Date.now(),\n        };\n        this.isFirst = false;\n      }\n\n      // Extract usage from chunk (Google includes it in every chunk)\n      const usage = this.extractUsage(chunk);\n      if (usage) {\n        lastUsage = usage;\n      }\n\n      const events = this.convertChunk(chunk);\n      for (const event of events) {\n        yield event;\n      }\n    }\n\n    // Emit completion for any pending tool calls\n    if (this.toolCallBuffers.size > 0) {\n      for (const [toolCallId, buffer] of this.toolCallBuffers) {\n        yield {\n          type: StreamEventType.TOOL_CALL_ARGUMENTS_DONE,\n          response_id: this.responseId,\n          tool_call_id: toolCallId,\n          tool_name: buffer.name,\n          arguments: buffer.args,\n        };\n      }\n    }\n\n    // Final completion event with actual usage\n    yield {\n      type: StreamEventType.RESPONSE_COMPLETE,\n      response_id: this.responseId,\n      status: 'completed',\n      usage: lastUsage,\n      iterations: 1,\n    };\n  }\n\n  /**\n   * Extract usage from Google chunk\n   */\n  private extractUsage(chunk: GenerateContentResponse): { input_tokens: number; output_tokens: number; total_tokens: number } | null {\n    const usage = chunk.usageMetadata;\n    if (!usage) return null;\n\n    return {\n      input_tokens: usage.promptTokenCount || 0,\n      output_tokens: usage.candidatesTokenCount || 0,\n      total_tokens: usage.totalTokenCount || 0,\n    };\n  }\n\n  /**\n   * Convert single Google chunk to our event(s)\n   */\n  private convertChunk(chunk: GenerateContentResponse): StreamEvent[] {\n    const events: StreamEvent[] = [];\n\n    const candidate = chunk.candidates?.[0];\n    if (!candidate?.content?.parts) return events;\n\n    for (const part of candidate.content.parts) {\n      if (part.text) {\n        // Text delta\n        events.push({\n          type: StreamEventType.OUTPUT_TEXT_DELTA,\n          response_id: this.responseId,\n          item_id: `msg_${this.responseId}`,\n          output_index: 0,\n          content_index: 0,\n          delta: part.text,\n          sequence_number: this.sequenceNumber++,\n        });\n      } else if (part.functionCall) {\n        // Function call (tool use)\n        const functionCall = part.functionCall;\n        const toolName = functionCall.name || 'unknown';\n        const toolCallId = `call_${this.responseId}_${toolName}`;\n\n        // Check if this is a new tool call\n        if (!this.toolCallBuffers.has(toolCallId)) {\n          this.toolCallBuffers.set(toolCallId, {\n            name: toolName,\n            args: '',\n          });\n\n          events.push({\n            type: StreamEventType.TOOL_CALL_START,\n            response_id: this.responseId,\n            item_id: `msg_${this.responseId}`,\n            tool_call_id: toolCallId,\n            tool_name: toolName,\n          });\n        }\n\n        // Convert args object to JSON string\n        if (functionCall.args) {\n          const argsJson = JSON.stringify(functionCall.args);\n          const buffer = this.toolCallBuffers.get(toolCallId)!;\n\n          // Check if this is new content (Google sends complete args each time)\n          if (argsJson !== buffer.args) {\n            const delta = argsJson.slice(buffer.args.length);\n            buffer.args = argsJson;\n\n            if (delta) {\n              events.push({\n                type: StreamEventType.TOOL_CALL_ARGUMENTS_DELTA,\n                response_id: this.responseId,\n                item_id: `msg_${this.responseId}`,\n                tool_call_id: toolCallId,\n                tool_name: toolName,\n                delta,\n                sequence_number: this.sequenceNumber++,\n              });\n            }\n          }\n        }\n      }\n    }\n\n    return events;\n  }\n\n  /**\n   * Generate unique response ID using cryptographically secure UUID\n   */\n  private generateResponseId(): string {\n    return `resp_google_${randomUUID()}`;\n  }\n\n  /**\n   * Clear all internal state\n   * Should be called after each stream completes to prevent memory leaks\n   */\n  clear(): void {\n    this.responseId = '';\n    this.model = '';\n    this.sequenceNumber = 0;\n    this.isFirst = true;\n    this.toolCallBuffers.clear();\n  }\n\n  /**\n   * Reset converter state for a new stream\n   * Alias for clear()\n   */\n  reset(): void {\n    this.clear();\n  }\n}\n","/**\n * Google Gemini text provider (using new unified SDK)\n */\n\nimport { GoogleGenAI } from '@google/genai';\nimport { BaseTextProvider } from '../base/BaseTextProvider.js';\nimport { TextGenerateOptions, ModelCapabilities } from '../../../domain/interfaces/ITextProvider.js';\nimport { LLMResponse } from '../../../domain/entities/Response.js';\nimport { ProviderCapabilities } from '../../../domain/interfaces/IProvider.js';\nimport { GoogleConfig } from '../../../domain/types/ProviderConfig.js';\nimport {\n  ProviderAuthError,\n  ProviderRateLimitError,\n  ProviderContextLengthError,\n} from '../../../domain/errors/AIErrors.js';\nimport { GoogleConverter } from './GoogleConverter.js';\nimport { GoogleStreamConverter } from './GoogleStreamConverter.js';\nimport { StreamEvent } from '../../../domain/entities/StreamEvent.js';\n\nexport class GoogleTextProvider extends BaseTextProvider {\n  readonly name = 'google';\n  readonly capabilities: ProviderCapabilities = {\n    text: true,\n    images: true, // Gemini supports vision\n    videos: false,\n    audio: false,\n  };\n\n  private client: GoogleGenAI;\n  private converter: GoogleConverter;\n  private streamConverter: GoogleStreamConverter;\n\n  constructor(config: GoogleConfig) {\n    super(config);\n    // New SDK uses object config\n    this.client = new GoogleGenAI({\n      apiKey: this.getApiKey(),\n    });\n    this.converter = new GoogleConverter();\n    this.streamConverter = new GoogleStreamConverter();\n  }\n\n  /**\n   * Generate response using Google Gemini API\n   */\n  async generate(options: TextGenerateOptions): Promise<LLMResponse> {\n    try {\n      // Convert our format  Google format\n      const googleRequest = await this.converter.convertRequest(options);\n\n      // Debug logging\n      if (process.env.DEBUG_GOOGLE) {\n        console.error('[DEBUG] Google Request:', JSON.stringify({\n          model: options.model,\n          tools: googleRequest.tools,\n          toolConfig: googleRequest.toolConfig,\n          contents: googleRequest.contents?.slice(0, 1), // First message only\n        }, null, 2));\n      }\n\n      // Call Google API using new SDK structure\n      // Note: contents goes at top level, tools/generationConfig go in config\n      const result = await this.client.models.generateContent({\n        model: options.model,\n        contents: googleRequest.contents,\n        config: {\n          systemInstruction: googleRequest.systemInstruction,\n          tools: googleRequest.tools,\n          toolConfig: googleRequest.toolConfig,\n          generationConfig: googleRequest.generationConfig,\n        },\n      });\n\n      // Debug logging for response\n      if (process.env.DEBUG_GOOGLE) {\n        console.error('[DEBUG] Google Response:', JSON.stringify({\n          candidates: result.candidates?.map((c: any) => ({\n            finishReason: c.finishReason,\n            content: c.content,\n          })),\n          usageMetadata: result.usageMetadata,\n        }, null, 2));\n      }\n\n      // Convert Google response  our format\n      const response = this.converter.convertResponse(result);\n\n      // Clear converter mappings to prevent memory leaks\n      this.converter.clearMappings();\n\n      return response;\n    } catch (error: any) {\n      // Clear mappings even on error\n      this.converter.clearMappings();\n      this.handleError(error);\n      throw error; // TypeScript needs this\n    }\n  }\n\n  /**\n   * Stream response using Google Gemini API\n   */\n  async *streamGenerate(options: TextGenerateOptions): AsyncIterableIterator<StreamEvent> {\n    try {\n      // Convert our format  Google format\n      const googleRequest = await this.converter.convertRequest(options);\n\n      // Create stream using new SDK\n      // Note: contents goes at top level, tools/generationConfig go in config\n      const stream = await this.client.models.generateContentStream({\n        model: options.model,\n        contents: googleRequest.contents,\n        config: {\n          systemInstruction: googleRequest.systemInstruction,\n          tools: googleRequest.tools,\n          toolConfig: googleRequest.toolConfig,\n          generationConfig: googleRequest.generationConfig,\n        },\n      });\n\n      // Reset stream converter for reuse\n      this.streamConverter.reset();\n\n      // Convert Google stream  our StreamEvent format\n      yield* this.streamConverter.convertStream(stream, options.model);\n\n      // Clear converters after stream completes\n      this.converter.clearMappings();\n      this.streamConverter.clear();\n    } catch (error: any) {\n      // Clear converters even on error\n      this.converter.clearMappings();\n      this.streamConverter.clear();\n      this.handleError(error);\n      throw error;\n    }\n  }\n\n  /**\n   * Get model capabilities\n   */\n  getModelCapabilities(model: string): ModelCapabilities {\n    // All modern Gemini models (3.x, 2.5, 2.0, 1.5) have similar capabilities\n    if (\n      model.includes('gemini-3') ||\n      model.includes('gemini-2.5') ||\n      model.includes('gemini-2.0') ||\n      model.includes('gemini-1.5') ||\n      model.includes('gemini-pro') ||\n      model.includes('gemini-flash')\n    ) {\n      return {\n        supportsTools: true,\n        supportsVision: true,\n        supportsJSON: true,\n        supportsJSONSchema: false,\n        maxTokens: 1048576, // 1M tokens\n        maxOutputTokens: 8192,\n      };\n    }\n\n    // Default for unknown models\n    return {\n      supportsTools: true,\n      supportsVision: true,\n      supportsJSON: true,\n      supportsJSONSchema: false,\n      maxTokens: 1048576,\n      maxOutputTokens: 8192,\n    };\n  }\n\n  /**\n   * Handle Google-specific errors\n   */\n  private handleError(error: any): never {\n    const errorMessage = error.message || '';\n\n    if (error.status === 401 || errorMessage.includes('API key not valid')) {\n      throw new ProviderAuthError('google', 'Invalid API key');\n    }\n\n    if (error.status === 429 || errorMessage.includes('Resource exhausted')) {\n      throw new ProviderRateLimitError('google');\n    }\n\n    if (errorMessage.includes('context length') || errorMessage.includes('too long')) {\n      throw new ProviderContextLengthError('google', 1048576);\n    }\n\n    // Re-throw other errors\n    throw error;\n  }\n}\n","/**\n * Google Vertex AI text provider (enterprise features)\n * Uses the same unified @google/genai SDK as GoogleTextProvider\n */\n\nimport { GoogleGenAI } from '@google/genai';\nimport { BaseTextProvider } from '../base/BaseTextProvider.js';\nimport { TextGenerateOptions, ModelCapabilities } from '../../../domain/interfaces/ITextProvider.js';\nimport { LLMResponse } from '../../../domain/entities/Response.js';\nimport { ProviderCapabilities } from '../../../domain/interfaces/IProvider.js';\nimport { VertexAIConfig } from '../../../domain/types/ProviderConfig.js';\nimport {\n  ProviderAuthError,\n  ProviderRateLimitError,\n  ProviderContextLengthError,\n  InvalidConfigError,\n} from '../../../domain/errors/AIErrors.js';\nimport { GoogleConverter } from '../google/GoogleConverter.js';\nimport { GoogleStreamConverter } from '../google/GoogleStreamConverter.js';\nimport { StreamEvent } from '../../../domain/entities/StreamEvent.js';\n\nexport class VertexAITextProvider extends BaseTextProvider {\n  readonly name = 'vertex-ai';\n  readonly capabilities: ProviderCapabilities = {\n    text: true,\n    images: true,\n    videos: true, // Vertex AI supports video input\n    audio: true, // Vertex AI supports audio input\n  };\n\n  private client: GoogleGenAI;\n  private converter: GoogleConverter;\n  private config: VertexAIConfig;\n\n  constructor(config: VertexAIConfig) {\n    super(config);\n    this.config = config;\n\n    // Validate required config\n    if (!config.projectId) {\n      throw new InvalidConfigError('Vertex AI requires projectId');\n    }\n    if (!config.location) {\n      throw new InvalidConfigError('Vertex AI requires location (e.g., \"us-central1\")');\n    }\n\n    // Configure environment for Vertex AI\n    process.env.GOOGLE_GENAI_USE_VERTEXAI = 'True';\n    process.env.GOOGLE_CLOUD_PROJECT = config.projectId;\n    process.env.GOOGLE_CLOUD_LOCATION = config.location;\n\n    // If credentials provided, set them\n    if (config.credentials) {\n      // Note: The SDK will use credentials from the environment or ADC\n      // Service account JSON can be passed via GOOGLE_APPLICATION_CREDENTIALS env var\n    }\n\n    // Initialize client for Vertex AI\n    this.client = new GoogleGenAI({\n      // No API key for Vertex AI - uses Application Default Credentials\n    });\n\n    // Reuse Google converter - same API format!\n    this.converter = new GoogleConverter();\n  }\n\n  /**\n   * Generate response using Vertex AI\n   */\n  async generate(options: TextGenerateOptions): Promise<LLMResponse> {\n    try {\n      // Convert our format  Google format (same as regular Gemini API)\n      const googleRequest = await this.converter.convertRequest(options);\n\n      // Call Vertex AI using new SDK structure\n      // Note: contents goes at top level, tools/generationConfig go in config\n      const result = await this.client.models.generateContent({\n        model: options.model,\n        contents: googleRequest.contents,\n        config: {\n          systemInstruction: googleRequest.systemInstruction,\n          tools: googleRequest.tools,\n          toolConfig: googleRequest.toolConfig,\n          generationConfig: googleRequest.generationConfig,\n        },\n      });\n\n      // Convert response  our format (same as regular Gemini API)\n      return this.converter.convertResponse(result);\n    } catch (error: any) {\n      this.handleError(error);\n      throw error; // TypeScript needs this\n    }\n  }\n\n  /**\n   * Stream response using Vertex AI\n   */\n  async *streamGenerate(options: TextGenerateOptions): AsyncIterableIterator<StreamEvent> {\n    try {\n      // Convert our format  Google format\n      const googleRequest = await this.converter.convertRequest(options);\n\n      // Create stream using new SDK\n      // Note: contents goes at top level, tools/generationConfig go in config\n      const stream = await this.client.models.generateContentStream({\n        model: options.model,\n        contents: googleRequest.contents,\n        config: {\n          systemInstruction: googleRequest.systemInstruction,\n          tools: googleRequest.tools,\n          toolConfig: googleRequest.toolConfig,\n          generationConfig: googleRequest.generationConfig,\n        },\n      });\n\n      // Convert Google stream  our StreamEvent format\n      const streamConverter = new GoogleStreamConverter();\n      yield* streamConverter.convertStream(stream, options.model);\n    } catch (error: any) {\n      this.handleError(error);\n      throw error;\n    }\n  }\n\n  /**\n   * Get model capabilities\n   */\n  getModelCapabilities(model: string): ModelCapabilities {\n    // Same models as regular Gemini, but enterprise features\n    if (\n      model.includes('gemini-3') ||\n      model.includes('gemini-2.5') ||\n      model.includes('gemini-2.0') ||\n      model.includes('gemini-1.5') ||\n      model.includes('gemini-pro') ||\n      model.includes('gemini-flash')\n    ) {\n      return {\n        supportsTools: true,\n        supportsVision: true,\n        supportsJSON: true,\n        supportsJSONSchema: false,\n        maxTokens: 1048576, // 1M tokens\n        maxOutputTokens: 8192,\n      };\n    }\n\n    // Default\n    return {\n      supportsTools: true,\n      supportsVision: true,\n      supportsJSON: true,\n      supportsJSONSchema: false,\n      maxTokens: 1048576,\n      maxOutputTokens: 8192,\n    };\n  }\n\n  /**\n   * Handle Vertex AI-specific errors\n   */\n  private handleError(error: any): never {\n    const errorMessage = error.message || '';\n\n    // Authentication errors\n    if (\n      error.status === 401 ||\n      error.status === 403 ||\n      errorMessage.includes('not authenticated') ||\n      errorMessage.includes('permission denied')\n    ) {\n      throw new ProviderAuthError(\n        'vertex-ai',\n        'Authentication failed. Make sure you have set up Application Default Credentials or provided service account credentials.'\n      );\n    }\n\n    if (error.status === 429 || errorMessage.includes('Resource exhausted')) {\n      throw new ProviderRateLimitError('vertex-ai');\n    }\n\n    if (errorMessage.includes('context length') || errorMessage.includes('too long')) {\n      throw new ProviderContextLengthError('vertex-ai', 1048576);\n    }\n\n    // Re-throw other errors\n    throw error;\n  }\n}\n","/**\n * Provider registry - manages provider configurations and instances\n *\n * Implements IDisposable for proper resource cleanup and uses\n * promise-based locking to prevent race conditions during lazy loading.\n */\n\nimport { ITextProvider } from '../domain/interfaces/ITextProvider.js';\nimport { IImageProvider } from '../domain/interfaces/IImageProvider.js';\nimport { IDisposable, assertNotDestroyed } from '../domain/interfaces/IDisposable.js';\nimport {\n  ProviderConfig,\n  ProvidersConfig,\n  OpenAIConfig,\n  AnthropicConfig,\n  GoogleConfig,\n  VertexAIConfig,\n  GenericOpenAIConfig,\n} from '../domain/types/ProviderConfig.js';\nimport { ProviderNotFoundError, InvalidConfigError } from '../domain/errors/AIErrors.js';\nimport { OpenAITextProvider } from '../infrastructure/providers/openai/OpenAITextProvider.js';\nimport { GenericOpenAIProvider } from '../infrastructure/providers/generic/GenericOpenAIProvider.js';\nimport { AnthropicTextProvider } from '../infrastructure/providers/anthropic/AnthropicTextProvider.js';\nimport { GoogleTextProvider } from '../infrastructure/providers/google/GoogleTextProvider.js';\nimport { VertexAITextProvider } from '../infrastructure/providers/vertex/VertexAITextProvider.js';\n\nexport class ProviderRegistry implements IDisposable {\n  private configs: Map<string, ProviderConfig> = new Map();\n  private textProviders: Map<string, ITextProvider> = new Map();\n  private imageProviders: Map<string, IImageProvider> = new Map();\n\n  // Promise locks for preventing race conditions during lazy loading\n  private textProviderPromises: Map<string, Promise<ITextProvider>> = new Map();\n  private imageProviderPromises: Map<string, Promise<IImageProvider>> = new Map();\n\n  private _isDestroyed = false;\n\n  get isDestroyed(): boolean {\n    return this._isDestroyed;\n  }\n\n  constructor(providersConfig: ProvidersConfig) {\n    // Store configurations\n    for (const [name, config] of Object.entries(providersConfig)) {\n      if (config) {\n        this.registerConfig(name, config);\n      }\n    }\n  }\n\n  /**\n   * Register a provider configuration\n   */\n  private registerConfig(name: string, config: ProviderConfig): void {\n    // Enhanced API key validation\n    if (!config.apiKey || config.apiKey.trim().length === 0) {\n      throw new InvalidConfigError(`Provider '${name}' requires a non-empty apiKey`);\n    }\n\n    // Provider-specific format hints (warnings only, don't block)\n    if (name === 'openai' && !config.apiKey.startsWith('sk-')) {\n      console.warn(`[ProviderRegistry] OpenAI API key should typically start with 'sk-'`);\n    }\n    if (name === 'anthropic' && !config.apiKey.startsWith('sk-ant-')) {\n      console.warn(`[ProviderRegistry] Anthropic API key should typically start with 'sk-ant-'`);\n    }\n\n    this.configs.set(name, config);\n  }\n\n  /**\n   * Get a text provider instance (lazy loaded and cached)\n   * Uses promise-based locking to prevent race conditions\n   */\n  async getTextProvider(name: string): Promise<ITextProvider> {\n    assertNotDestroyed(this, 'get text provider');\n\n    // Check if already instantiated\n    if (this.textProviders.has(name)) {\n      return this.textProviders.get(name)!;\n    }\n\n    // Check if creation is already in progress (race condition prevention)\n    const existingPromise = this.textProviderPromises.get(name);\n    if (existingPromise) {\n      return existingPromise;\n    }\n\n    // Check if config exists\n    const config = this.configs.get(name);\n    if (!config) {\n      throw new ProviderNotFoundError(name);\n    }\n\n    // Create with promise locking\n    const createPromise = this.createTextProviderAsync(name, config);\n    this.textProviderPromises.set(name, createPromise);\n\n    try {\n      const provider = await createPromise;\n      this.textProviders.set(name, provider);\n      return provider;\n    } finally {\n      // Always clean up the promise lock\n      this.textProviderPromises.delete(name);\n    }\n  }\n\n  /**\n   * Get a text provider instance synchronously (for backward compatibility)\n   * WARNING: This method may create duplicate providers under concurrent access.\n   * Prefer getTextProvider() (async) for new code.\n   * @deprecated Use async getTextProvider() instead to prevent race conditions\n   */\n  getTextProviderSync(name: string): ITextProvider {\n    assertNotDestroyed(this, 'get text provider');\n\n    // Check if already instantiated\n    if (this.textProviders.has(name)) {\n      return this.textProviders.get(name)!;\n    }\n\n    // Check if config exists\n    const config = this.configs.get(name);\n    if (!config) {\n      throw new ProviderNotFoundError(name);\n    }\n\n    // Lazy load provider (may race with concurrent calls)\n    const provider = this.createTextProvider(name, config);\n    this.textProviders.set(name, provider);\n    return provider;\n  }\n\n  /**\n   * Get an image provider instance (lazy loaded and cached)\n   * Uses promise-based locking to prevent race conditions\n   */\n  async getImageProvider(name: string): Promise<IImageProvider> {\n    assertNotDestroyed(this, 'get image provider');\n\n    // Check if already instantiated\n    if (this.imageProviders.has(name)) {\n      return this.imageProviders.get(name)!;\n    }\n\n    // Check if creation is already in progress (race condition prevention)\n    const existingPromise = this.imageProviderPromises.get(name);\n    if (existingPromise) {\n      return existingPromise;\n    }\n\n    // Check if config exists\n    const config = this.configs.get(name);\n    if (!config) {\n      throw new ProviderNotFoundError(name);\n    }\n\n    // Create with promise locking\n    const createPromise = this.createImageProviderAsync(name, config);\n    this.imageProviderPromises.set(name, createPromise);\n\n    try {\n      const provider = await createPromise;\n      this.imageProviders.set(name, provider);\n      return provider;\n    } finally {\n      // Always clean up the promise lock\n      this.imageProviderPromises.delete(name);\n    }\n  }\n\n  /**\n   * Async wrapper for text provider creation\n   */\n  private async createTextProviderAsync(\n    name: string,\n    config: ProviderConfig\n  ): Promise<ITextProvider> {\n    // Provider creation is synchronous, but wrapped in async for future extensibility\n    // and to support the promise-based locking pattern\n    return this.createTextProvider(name, config);\n  }\n\n  /**\n   * Async wrapper for image provider creation\n   */\n  private async createImageProviderAsync(\n    name: string,\n    config: ProviderConfig\n  ): Promise<IImageProvider> {\n    return this.createImageProvider(name, config);\n  }\n\n  /**\n   * Factory method to create text provider\n   */\n  private createTextProvider(name: string, config: ProviderConfig): ITextProvider {\n    switch (name) {\n      case 'openai':\n        return new OpenAITextProvider(config as OpenAIConfig);\n\n      case 'anthropic':\n        return new AnthropicTextProvider(config as AnthropicConfig);\n\n      case 'google':\n      case 'gemini':\n        return new GoogleTextProvider(config as GoogleConfig);\n\n      case 'vertex-ai':\n      case 'google-vertex':\n        return new VertexAITextProvider(config as VertexAIConfig);\n\n      case 'grok':\n        // xAI Grok - OpenAI-compatible\n        return new GenericOpenAIProvider(\n          'grok',\n          {\n            ...config,\n            baseURL: (config as any).baseURL || 'https://api.x.ai/v1',\n          } as GenericOpenAIConfig,\n          { text: true, images: true, videos: false, audio: false }\n        );\n\n      case 'groq':\n        // Groq - OpenAI-compatible (for Llama, Mixtral, etc.)\n        return new GenericOpenAIProvider(\n          'groq',\n          {\n            ...config,\n            baseURL: (config as any).baseURL || 'https://api.groq.com/openai/v1',\n          } as GenericOpenAIConfig,\n          { text: true, images: false, videos: false, audio: false }\n        );\n\n      case 'together-ai':\n      case 'together':\n        // Together AI - OpenAI-compatible (for Llama, etc.)\n        return new GenericOpenAIProvider(\n          'together-ai',\n          {\n            ...config,\n            baseURL: (config as any).baseURL || 'https://api.together.xyz/v1',\n          } as GenericOpenAIConfig,\n          { text: true, images: true, videos: false, audio: false }\n        );\n\n      case 'perplexity':\n        // Perplexity - OpenAI-compatible\n        return new GenericOpenAIProvider(\n          'perplexity',\n          {\n            ...config,\n            baseURL: (config as any).baseURL || 'https://api.perplexity.ai',\n          } as GenericOpenAIConfig,\n          { text: true, images: false, videos: false, audio: false }\n        );\n\n      default:\n        // Try as generic OpenAI-compatible provider if baseURL is provided\n        if ('baseURL' in config && config.baseURL) {\n          return new GenericOpenAIProvider(name, config as GenericOpenAIConfig);\n        }\n        throw new ProviderNotFoundError(name);\n    }\n  }\n\n  /**\n   * Factory method to create image provider\n   */\n  private createImageProvider(name: string, _config: ProviderConfig): IImageProvider {\n    switch (name) {\n      case 'openai':\n        throw new Error('OpenAI image provider not yet implemented');\n      case 'google':\n        throw new Error('Google image provider not yet implemented');\n      default:\n        throw new ProviderNotFoundError(name);\n    }\n  }\n\n  /**\n   * Check if a provider is registered\n   */\n  hasProvider(name: string): boolean {\n    return this.configs.has(name);\n  }\n\n  /**\n   * List all registered provider names\n   */\n  listProviders(): string[] {\n    return Array.from(this.configs.keys());\n  }\n\n  /**\n   * Get provider configuration\n   */\n  getConfig(name: string): ProviderConfig | undefined {\n    return this.configs.get(name);\n  }\n\n  /**\n   * Destroy the registry and release all resources\n   * Safe to call multiple times (idempotent)\n   */\n  destroy(): void {\n    if (this._isDestroyed) {\n      return;\n    }\n    this._isDestroyed = true;\n\n    // Clear all cached providers\n    this.textProviders.clear();\n    this.imageProviders.clear();\n\n    // Clear pending promises (they will resolve but result won't be cached)\n    this.textProviderPromises.clear();\n    this.imageProviderPromises.clear();\n\n    // Clear configs\n    this.configs.clear();\n  }\n}\n","/**\n * Tool entities with blocking/non-blocking execution support\n */\n\nexport interface JSONSchema {\n  type: string;\n  properties?: Record<string, any>;\n  required?: string[];\n  [key: string]: any;\n}\n\nexport interface FunctionToolDefinition {\n  type: 'function';\n  function: {\n    name: string;\n    description?: string;\n    parameters?: JSONSchema;\n    strict?: boolean; // Enforce schema strictly\n  };\n  blocking?: boolean; // Default: true (wait for result before continuing)\n  timeout?: number; // Timeout in ms (default: 30000)\n}\n\nexport interface BuiltInTool {\n  type: 'web_search' | 'file_search' | 'computer_use' | 'code_interpreter';\n  blocking?: boolean;\n}\n\nexport type Tool = FunctionToolDefinition | BuiltInTool;\n\nexport enum ToolCallState {\n  PENDING = 'pending', // Tool call identified, not yet executed\n  EXECUTING = 'executing', // Currently executing\n  COMPLETED = 'completed', // Successfully completed\n  FAILED = 'failed', // Execution failed\n  TIMEOUT = 'timeout', // Execution timed out\n}\n\nexport interface ToolCall {\n  id: string;\n  type: 'function';\n  function: {\n    name: string;\n    arguments: string; // JSON string\n  };\n  blocking: boolean; // Copied from tool definition\n  state: ToolCallState;\n  startTime?: Date;\n  endTime?: Date;\n  error?: string;\n}\n\nexport interface ToolResult {\n  tool_use_id: string;\n  content: any;\n  error?: string;\n  executionTime?: number; // ms\n  state: ToolCallState;\n}\n\n/**\n * Tool execution context - tracks all tool calls in a generation\n */\nexport interface ToolExecutionContext {\n  executionId: string; // Unique ID for this LLM generation\n  toolCalls: Map<string, ToolCall>; // tool_use_id  ToolCall\n  pendingNonBlocking: Set<string>; // IDs of pending non-blocking calls\n  completedResults: Map<string, ToolResult>; // tool_use_id  ToolResult\n}\n\n/**\n * User-provided tool function\n */\nexport interface ToolFunction<TArgs = any, TResult = any> {\n  definition: FunctionToolDefinition;\n  execute: (args: TArgs) => Promise<TResult>;\n}\n","/**\n * Execution context - tracks state, metrics, and history for agent execution\n * Includes memory safety (circular buffers) and resource limits\n */\n\nimport { AgentResponse } from '../../domain/entities/Response.js';\nimport { TextGenerateOptions } from '../../domain/interfaces/ITextProvider.js';\nimport { ToolCall, ToolResult, ToolCallState } from '../../domain/entities/Tool.js';\n\nexport type HistoryMode = 'none' | 'summary' | 'full';\n\nexport interface ExecutionContextConfig {\n  maxHistorySize?: number; // Max iterations to store (default: 10)\n  historyMode?: HistoryMode; // What to store (default: 'summary')\n  maxAuditTrailSize?: number; // Max audit entries (default: 1000)\n}\n\nexport interface IterationRecord {\n  iteration: number;\n  request: TextGenerateOptions;\n  response: AgentResponse;\n  toolCalls: ToolCall[];\n  toolResults: ToolResult[];\n  startTime: Date;\n  endTime: Date;\n}\n\nexport interface IterationSummary {\n  iteration: number;\n  tokens: number;\n  toolCount: number;\n  duration: number;\n  timestamp: Date;\n}\n\nexport interface ExecutionMetrics {\n  // Timing\n  totalDuration: number;\n  llmDuration: number;\n  toolDuration: number;\n  hookDuration: number;\n\n  // Counts\n  iterationCount: number;\n  toolCallCount: number;\n  toolSuccessCount: number;\n  toolFailureCount: number;\n  toolTimeoutCount: number;\n\n  // Tokens\n  inputTokens: number;\n  outputTokens: number;\n  totalTokens: number;\n\n  // Errors\n  errors: Array<{ type: string; message: string; timestamp: Date }>;\n}\n\nexport interface AuditEntry {\n  timestamp: Date;\n  type:\n    | 'hook_executed'\n    | 'tool_modified'\n    | 'tool_skipped'\n    | 'execution_paused'\n    | 'execution_resumed'\n    | 'tool_approved'\n    | 'tool_rejected';\n  hookName?: string;\n  toolName?: string;\n  details: any;\n}\n\nexport class ExecutionContext {\n  // Execution metadata\n  readonly executionId: string;\n  readonly startTime: Date;\n  iteration: number = 0;\n\n  // Tool tracking\n  readonly toolCalls: Map<string, ToolCall> = new Map();\n  readonly toolResults: Map<string, ToolResult> = new Map();\n\n  // Control state\n  paused: boolean = false;\n  pauseReason?: string;\n  cancelled: boolean = false;\n  cancelReason?: string;\n\n  // User data (for hooks to share state)\n  readonly metadata: Map<string, any> = new Map();\n\n  // History storage (memory-safe)\n  private readonly config: ExecutionContextConfig;\n  private readonly iterations: IterationRecord[] = [];\n  private readonly iterationSummaries: IterationSummary[] = [];\n\n  // Metrics\n  readonly metrics: ExecutionMetrics = {\n    totalDuration: 0,\n    llmDuration: 0,\n    toolDuration: 0,\n    hookDuration: 0,\n    iterationCount: 0,\n    toolCallCount: 0,\n    toolSuccessCount: 0,\n    toolFailureCount: 0,\n    toolTimeoutCount: 0,\n    inputTokens: 0,\n    outputTokens: 0,\n    totalTokens: 0,\n    errors: [],\n  };\n\n  // Audit trail\n  private readonly auditTrail: AuditEntry[] = [];\n\n  constructor(\n    executionId: string,\n    config: ExecutionContextConfig = {}\n  ) {\n    this.executionId = executionId;\n    this.startTime = new Date();\n    this.config = {\n      maxHistorySize: config.maxHistorySize || 10,\n      historyMode: config.historyMode || 'summary',\n      maxAuditTrailSize: config.maxAuditTrailSize || 1000,\n    };\n  }\n\n  /**\n   * Add iteration to history (memory-safe)\n   */\n  addIteration(record: IterationRecord): void {\n    switch (this.config.historyMode) {\n      case 'none':\n        // Don't store anything\n        break;\n\n      case 'summary':\n        // Store lightweight summary only\n        this.iterationSummaries.push({\n          iteration: record.iteration,\n          tokens: record.response.usage.total_tokens,\n          toolCount: record.toolCalls.length,\n          duration: record.endTime.getTime() - record.startTime.getTime(),\n          timestamp: record.startTime,\n        });\n\n        // Keep circular buffer\n        if (this.iterationSummaries.length > this.config.maxHistorySize!) {\n          this.iterationSummaries.shift();\n        }\n        break;\n\n      case 'full':\n        // Store full iteration data\n        this.iterations.push(record);\n\n        // Keep circular buffer\n        if (this.iterations.length > this.config.maxHistorySize!) {\n          this.iterations.shift();\n        }\n        break;\n    }\n  }\n\n  /**\n   * Get iteration history\n   */\n  getHistory(): IterationRecord[] | IterationSummary[] {\n    return this.config.historyMode === 'full' ? this.iterations : this.iterationSummaries;\n  }\n\n  /**\n   * Add audit entry\n   */\n  audit(type: AuditEntry['type'], details: any, hookName?: string, toolName?: string): void {\n    this.auditTrail.push({\n      timestamp: new Date(),\n      type,\n      hookName,\n      toolName,\n      details,\n    });\n\n    // Keep circular buffer\n    if (this.auditTrail.length > this.config.maxAuditTrailSize!) {\n      this.auditTrail.shift();\n    }\n  }\n\n  /**\n   * Get audit trail\n   */\n  getAuditTrail(): readonly AuditEntry[] {\n    return this.auditTrail;\n  }\n\n  /**\n   * Update metrics\n   */\n  updateMetrics(update: Partial<ExecutionMetrics>): void {\n    Object.assign(this.metrics, update);\n  }\n\n  /**\n   * Add tool call to tracking\n   */\n  addToolCall(toolCall: ToolCall): void {\n    this.toolCalls.set(toolCall.id, toolCall);\n    this.metrics.toolCallCount++;\n  }\n\n  /**\n   * Add tool result to tracking\n   */\n  addToolResult(result: ToolResult): void {\n    this.toolResults.set(result.tool_use_id, result);\n\n    // Update metrics\n    if (result.state === ToolCallState.COMPLETED) {\n      this.metrics.toolSuccessCount++;\n    } else if (result.state === ToolCallState.FAILED) {\n      this.metrics.toolFailureCount++;\n    } else if (result.state === ToolCallState.TIMEOUT) {\n      this.metrics.toolTimeoutCount++;\n    }\n  }\n\n  /**\n   * Check resource limits\n   */\n  checkLimits(limits?: {\n    maxExecutionTime?: number;\n    maxToolCalls?: number;\n    maxContextSize?: number;\n  }): void {\n    if (!limits) return;\n\n    // Check execution time\n    if (limits.maxExecutionTime) {\n      const elapsed = Date.now() - this.startTime.getTime();\n      if (elapsed > limits.maxExecutionTime) {\n        throw new Error(\n          `Execution time limit exceeded: ${elapsed}ms > ${limits.maxExecutionTime}ms`\n        );\n      }\n    }\n\n    // Check tool call count\n    if (limits.maxToolCalls && this.toolCalls.size > limits.maxToolCalls) {\n      throw new Error(\n        `Tool call limit exceeded: ${this.toolCalls.size} > ${limits.maxToolCalls}`\n      );\n    }\n\n    // Check context size\n    if (limits.maxContextSize) {\n      const size = this.estimateSize();\n      if (size > limits.maxContextSize) {\n        throw new Error(\n          `Context size limit exceeded: ${size} bytes > ${limits.maxContextSize} bytes`\n        );\n      }\n    }\n  }\n\n  /**\n   * Estimate memory usage (rough approximation)\n   */\n  private estimateSize(): number {\n    try {\n      const data = {\n        toolCalls: Array.from(this.toolCalls.values()),\n        toolResults: Array.from(this.toolResults.values()),\n        iterations: this.config.historyMode === 'full' ? this.iterations : this.iterationSummaries,\n        auditTrail: this.auditTrail,\n      };\n      return JSON.stringify(data).length;\n    } catch {\n      return 0; // Error estimating, return 0\n    }\n  }\n\n  /**\n   * Cleanup resources and release memory\n   * Clears all internal arrays and maps to allow garbage collection\n   */\n  cleanup(): void {\n    // Store execution summary before clearing\n    const summary = {\n      executionId: this.executionId,\n      totalIterations: this.iteration,\n      totalToolCalls: this.metrics.toolCallCount,\n      totalDuration: Date.now() - this.startTime.getTime(),\n      success: !this.cancelled && this.metrics.errors.length === 0,\n    };\n\n    // Clear all maps\n    this.toolCalls.clear();\n    this.toolResults.clear();\n    this.metadata.clear();\n\n    // Clear all arrays (modify length to allow GC of items)\n    this.iterations.length = 0;\n    this.iterationSummaries.length = 0;\n    this.auditTrail.length = 0;\n    this.metrics.errors.length = 0;\n\n    // Store summary after clearing (for final access if needed)\n    this.metadata.set('execution_summary', summary);\n  }\n\n  /**\n   * Get execution summary\n   */\n  getSummary() {\n    return {\n      executionId: this.executionId,\n      startTime: this.startTime,\n      currentIteration: this.iteration,\n      paused: this.paused,\n      cancelled: this.cancelled,\n      metrics: { ...this.metrics },\n      totalDuration: Date.now() - this.startTime.getTime(),\n    };\n  }\n}\n","/**\n * Hook manager - handles hook registration and execution\n * Includes error isolation, timeouts, and optional parallel execution\n */\n\nimport { EventEmitter } from 'eventemitter3';\nimport {\n  Hook,\n  HookConfig,\n  HookName,\n  HookSignatures,\n} from './types/HookTypes.js';\n\nexport class HookManager {\n  private hooks: Map<HookName, Hook<any, any>[]> = new Map();\n  private timeout: number;\n  private parallel: boolean;\n  // Per-hook error tracking: hookKey -> consecutive error count\n  private hookErrorCounts: Map<string, number> = new Map();\n  // Disabled hooks that exceeded error threshold\n  private disabledHooks: Set<string> = new Set();\n  private maxConsecutiveErrors: number = 3;\n  private emitter: EventEmitter;\n\n  constructor(\n    config: HookConfig = {},\n    emitter: EventEmitter,\n    errorHandling?: { maxConsecutiveErrors?: number }\n  ) {\n    this.timeout = config.hookTimeout || 5000; // 5 second default\n    this.parallel = config.parallelHooks || false;\n    this.emitter = emitter;\n    this.maxConsecutiveErrors = errorHandling?.maxConsecutiveErrors || 3;\n\n    // Register hooks from config\n    this.registerFromConfig(config);\n  }\n\n  /**\n   * Register hooks from configuration\n   */\n  private registerFromConfig(config: HookConfig): void {\n    const hookNames: HookName[] = [\n      'before:execution',\n      'after:execution',\n      'before:llm',\n      'after:llm',\n      'before:tool',\n      'after:tool',\n      'approve:tool',\n      'pause:check',\n    ];\n\n    for (const name of hookNames) {\n      const hook = config[name];\n      if (hook) {\n        this.register(name, hook);\n      }\n    }\n  }\n\n  /**\n   * Register a hook\n   */\n  register(name: HookName, hook: Hook<any, any>): void {\n    // Validate hook is a function\n    if (typeof hook !== 'function') {\n      throw new Error(`Hook must be a function, got: ${typeof hook}`);\n    }\n\n    // Get or create hooks array\n    if (!this.hooks.has(name)) {\n      this.hooks.set(name, []);\n    }\n\n    const existing = this.hooks.get(name)!;\n\n    // Limit number of hooks per name\n    if (existing.length >= 10) {\n      throw new Error(`Too many hooks for ${name} (max: 10)`);\n    }\n\n    existing.push(hook);\n  }\n\n  /**\n   * Execute hooks for a given name\n   */\n  async executeHooks<K extends HookName>(\n    name: K,\n    context: HookSignatures[K]['context'],\n    defaultResult: HookSignatures[K]['result']\n  ): Promise<HookSignatures[K]['result']> {\n    const hooks = this.hooks.get(name);\n\n    if (!hooks || hooks.length === 0) {\n      return defaultResult;\n    }\n\n    // Parallel execution (for independent hooks)\n    if (this.parallel && hooks.length > 1) {\n      return this.executeHooksParallel(hooks, context, defaultResult);\n    }\n\n    // Sequential execution (default)\n    return this.executeHooksSequential(hooks, context, defaultResult);\n  }\n\n  /**\n   * Execute hooks sequentially\n   */\n  private async executeHooksSequential<T>(\n    hooks: Hook<any, any>[],\n    context: any,\n    defaultResult: T\n  ): Promise<T> {\n    let result = defaultResult;\n\n    for (let i = 0; i < hooks.length; i++) {\n      const hook = hooks[i]!;\n      const hookKey = this.getHookKey(hook, i);\n      const hookResult = await this.executeHookSafely(hook, context, hookKey);\n\n      // Skip failed hooks\n      if (hookResult === null) {\n        continue;\n      }\n\n      // Merge hook result\n      result = { ...result, ...hookResult };\n\n      // Check for early exit\n      if ((hookResult as any).skip === true) {\n        break;\n      }\n    }\n\n    return result;\n  }\n\n  /**\n   * Execute hooks in parallel\n   */\n  private async executeHooksParallel<T>(\n    hooks: Hook<any, any>[],\n    context: any,\n    defaultResult: T\n  ): Promise<T> {\n    // Execute all hooks concurrently with unique keys\n    const results = await Promise.all(\n      hooks.map((hook, i) => {\n        const hookKey = this.getHookKey(hook, i);\n        return this.executeHookSafely(hook, context, hookKey);\n      })\n    );\n\n    // Filter out failures and merge results\n    const validResults = results.filter((r) => r !== null);\n\n    return validResults.reduce(\n      (acc, hookResult) => ({ ...acc, ...hookResult }),\n      defaultResult\n    );\n  }\n\n  /**\n   * Generate unique key for a hook\n   */\n  private getHookKey(hook: Hook<any, any>, index: number): string {\n    return `${hook.name || 'anonymous'}_${index}`;\n  }\n\n  /**\n   * Execute single hook with error isolation and timeout (with per-hook error tracking)\n   */\n  private async executeHookSafely<T>(\n    hook: Hook<any, any>,\n    context: any,\n    hookKey?: string\n  ): Promise<T | null> {\n    const key = hookKey || hook.name || 'anonymous';\n\n    // Skip disabled hooks\n    if (this.disabledHooks.has(key)) {\n      return null;\n    }\n\n    const startTime = Date.now();\n\n    try {\n      // Execute with timeout\n      const result = await Promise.race([\n        hook(context),\n        new Promise<never>((_, reject) =>\n          setTimeout(() => reject(new Error('Hook timeout')), this.timeout)\n        ),\n      ]);\n\n      // Reset error counter for this hook on success\n      this.hookErrorCounts.delete(key);\n\n      // Track timing\n      const duration = Date.now() - startTime;\n      if (context.context?.updateMetrics) {\n        context.context.updateMetrics({\n          hookDuration: (context.context.metrics.hookDuration || 0) + duration,\n        });\n      }\n\n      return result as T;\n    } catch (error) {\n      // Increment error counter for this specific hook\n      const errorCount = (this.hookErrorCounts.get(key) || 0) + 1;\n      this.hookErrorCounts.set(key, errorCount);\n\n      // Emit error event\n      this.emitter.emit('hook:error', {\n        executionId: context.executionId,\n        hookName: hook.name || 'anonymous',\n        error: error as Error,\n        consecutiveErrors: errorCount,\n        timestamp: new Date(),\n      });\n\n      // Check consecutive error threshold for this hook\n      if (errorCount >= this.maxConsecutiveErrors) {\n        // Disable this specific hook, not all hooks\n        this.disabledHooks.add(key);\n        console.warn(\n          `Hook \"${key}\" disabled after ${errorCount} consecutive failures. Last error: ${(error as Error).message}`\n        );\n      } else {\n        // Log warning but continue (degraded mode)\n        console.warn(\n          `Hook execution failed (${key}): ${(error as Error).message} (${errorCount}/${this.maxConsecutiveErrors} errors)`\n        );\n      }\n\n      return null; // Hook failed, skip its result\n    }\n  }\n\n  /**\n   * Check if there are any hooks registered\n   */\n  hasHooks(name: HookName): boolean {\n    const hooks = this.hooks.get(name);\n    return !!hooks && hooks.length > 0;\n  }\n\n  /**\n   * Get hook count\n   */\n  getHookCount(name?: HookName): number {\n    if (name) {\n      return this.hooks.get(name)?.length || 0;\n    }\n    // Total across all hooks\n    return Array.from(this.hooks.values()).reduce((sum, arr) => sum + arr.length, 0);\n  }\n\n  /**\n   * Clear all hooks and reset error tracking\n   */\n  clear(): void {\n    this.hooks.clear();\n    this.hookErrorCounts.clear();\n    this.disabledHooks.clear();\n  }\n\n  /**\n   * Re-enable a disabled hook\n   */\n  enableHook(hookKey: string): void {\n    this.disabledHooks.delete(hookKey);\n    this.hookErrorCounts.delete(hookKey);\n  }\n\n  /**\n   * Get list of disabled hooks\n   */\n  getDisabledHooks(): string[] {\n    return Array.from(this.disabledHooks);\n  }\n}\n","/**\n * StreamState - Accumulates streaming events to reconstruct complete response\n */\n\nimport { TokenUsage } from './Response.js';\nimport { ToolCall } from './Tool.js';\n\n/**\n * Buffer for accumulating tool call arguments\n */\nexport interface ToolCallBuffer {\n  toolName: string;\n  argumentChunks: string[];\n  isComplete: boolean;\n  startTime: Date;\n}\n\n/**\n * StreamState tracks all accumulated data during streaming\n */\nexport class StreamState {\n  // Core identifiers\n  public responseId: string;\n  public model: string;\n  public createdAt: number;\n\n  // Text accumulation: item_id -> text chunks\n  private textBuffers: Map<string, string[]>;\n\n  // Tool call accumulation: tool_call_id -> buffer\n  private toolCallBuffers: Map<string, ToolCallBuffer>;\n\n  // Completed tool calls\n  private completedToolCalls: ToolCall[];\n\n  // Tool execution results\n  private toolResults: Map<string, any>;\n\n  // Metadata\n  public currentIteration: number;\n  public usage: TokenUsage;\n  public status: 'in_progress' | 'completed' | 'incomplete' | 'failed';\n  public startTime: Date;\n  public endTime?: Date;\n\n  // Statistics\n  public totalChunks: number;\n  public totalTextDeltas: number;\n  public totalToolCalls: number;\n\n  constructor(responseId: string, model: string, createdAt?: number) {\n    this.responseId = responseId;\n    this.model = model;\n    this.createdAt = createdAt || Date.now();\n\n    this.textBuffers = new Map();\n    this.toolCallBuffers = new Map();\n    this.completedToolCalls = [];\n    this.toolResults = new Map();\n\n    this.currentIteration = 0;\n    this.usage = {\n      input_tokens: 0,\n      output_tokens: 0,\n      total_tokens: 0,\n    };\n    this.status = 'in_progress';\n    this.startTime = new Date();\n\n    this.totalChunks = 0;\n    this.totalTextDeltas = 0;\n    this.totalToolCalls = 0;\n  }\n\n  /**\n   * Accumulate text delta for a specific item\n   */\n  accumulateTextDelta(itemId: string, delta: string): void {\n    if (!this.textBuffers.has(itemId)) {\n      this.textBuffers.set(itemId, []);\n    }\n    this.textBuffers.get(itemId)!.push(delta);\n    this.totalTextDeltas++;\n    this.totalChunks++;\n  }\n\n  /**\n   * Get complete accumulated text for an item\n   */\n  getCompleteText(itemId: string): string {\n    const chunks = this.textBuffers.get(itemId);\n    return chunks ? chunks.join('') : '';\n  }\n\n  /**\n   * Get all accumulated text (all items concatenated)\n   */\n  getAllText(): string {\n    const allText: string[] = [];\n    for (const chunks of this.textBuffers.values()) {\n      allText.push(chunks.join(''));\n    }\n    return allText.join('');\n  }\n\n  /**\n   * Start accumulating tool call arguments\n   */\n  startToolCall(toolCallId: string, toolName: string): void {\n    this.toolCallBuffers.set(toolCallId, {\n      toolName,\n      argumentChunks: [],\n      isComplete: false,\n      startTime: new Date(),\n    });\n  }\n\n  /**\n   * Accumulate tool argument delta\n   */\n  accumulateToolArguments(toolCallId: string, delta: string): void {\n    const buffer = this.toolCallBuffers.get(toolCallId);\n    if (!buffer) {\n      throw new Error(`Tool call buffer not found for id: ${toolCallId}`);\n    }\n    buffer.argumentChunks.push(delta);\n    this.totalChunks++;\n  }\n\n  /**\n   * Mark tool call arguments as complete\n   */\n  completeToolCall(toolCallId: string): void {\n    const buffer = this.toolCallBuffers.get(toolCallId);\n    if (!buffer) {\n      throw new Error(`Tool call buffer not found for id: ${toolCallId}`);\n    }\n    buffer.isComplete = true;\n    this.totalToolCalls++;\n  }\n\n  /**\n   * Get complete tool arguments (joined chunks)\n   */\n  getCompleteToolArguments(toolCallId: string): string {\n    const buffer = this.toolCallBuffers.get(toolCallId);\n    if (!buffer) {\n      throw new Error(`Tool call buffer not found for id: ${toolCallId}`);\n    }\n    return buffer.argumentChunks.join('');\n  }\n\n  /**\n   * Check if tool call is complete\n   */\n  isToolCallComplete(toolCallId: string): boolean {\n    const buffer = this.toolCallBuffers.get(toolCallId);\n    return buffer ? buffer.isComplete : false;\n  }\n\n  /**\n   * Get tool name for a tool call\n   */\n  getToolName(toolCallId: string): string | undefined {\n    return this.toolCallBuffers.get(toolCallId)?.toolName;\n  }\n\n  /**\n   * Add completed tool call\n   */\n  addCompletedToolCall(toolCall: ToolCall): void {\n    this.completedToolCalls.push(toolCall);\n  }\n\n  /**\n   * Get all completed tool calls\n   */\n  getCompletedToolCalls(): ToolCall[] {\n    return [...this.completedToolCalls];\n  }\n\n  /**\n   * Store tool execution result\n   */\n  setToolResult(toolCallId: string, result: any): void {\n    this.toolResults.set(toolCallId, result);\n  }\n\n  /**\n   * Get tool execution result\n   */\n  getToolResult(toolCallId: string): any {\n    return this.toolResults.get(toolCallId);\n  }\n\n  /**\n   * Update token usage (replaces values, doesn't accumulate)\n   */\n  updateUsage(usage: Partial<TokenUsage>): void {\n    if (usage.input_tokens !== undefined) {\n      this.usage.input_tokens = usage.input_tokens;\n    }\n    if (usage.output_tokens !== undefined) {\n      this.usage.output_tokens = usage.output_tokens;\n    }\n    if (usage.total_tokens !== undefined) {\n      this.usage.total_tokens = usage.total_tokens;\n    } else {\n      // Calculate total if not provided\n      this.usage.total_tokens = this.usage.input_tokens + this.usage.output_tokens;\n    }\n  }\n\n  /**\n   * Accumulate token usage (adds to existing values)\n   */\n  accumulateUsage(usage: Partial<TokenUsage>): void {\n    if (usage.input_tokens !== undefined) {\n      this.usage.input_tokens += usage.input_tokens;\n    }\n    if (usage.output_tokens !== undefined) {\n      this.usage.output_tokens += usage.output_tokens;\n    }\n    if (usage.total_tokens !== undefined) {\n      this.usage.total_tokens += usage.total_tokens;\n    } else {\n      // Recalculate total\n      this.usage.total_tokens = this.usage.input_tokens + this.usage.output_tokens;\n    }\n  }\n\n  /**\n   * Mark stream as complete\n   */\n  markComplete(status: 'completed' | 'incomplete' | 'failed' = 'completed'): void {\n    this.status = status;\n    this.endTime = new Date();\n  }\n\n  /**\n   * Get duration in milliseconds\n   */\n  getDuration(): number {\n    const end = this.endTime || new Date();\n    return end.getTime() - this.startTime.getTime();\n  }\n\n  /**\n   * Increment iteration counter\n   */\n  incrementIteration(): void {\n    this.currentIteration++;\n  }\n\n  /**\n   * Get summary statistics\n   */\n  getStatistics() {\n    return {\n      responseId: this.responseId,\n      model: this.model,\n      status: this.status,\n      iterations: this.currentIteration,\n      totalChunks: this.totalChunks,\n      totalTextDeltas: this.totalTextDeltas,\n      totalToolCalls: this.totalToolCalls,\n      textItemsCount: this.textBuffers.size,\n      toolCallBuffersCount: this.toolCallBuffers.size,\n      completedToolCallsCount: this.completedToolCalls.length,\n      durationMs: this.getDuration(),\n      usage: { ...this.usage },\n    };\n  }\n\n  /**\n   * Check if stream has any accumulated text\n   */\n  hasText(): boolean {\n    return this.textBuffers.size > 0;\n  }\n\n  /**\n   * Check if stream has any tool calls\n   */\n  hasToolCalls(): boolean {\n    return this.toolCallBuffers.size > 0;\n  }\n\n  /**\n   * Clear all buffers (for memory management)\n   */\n  clear(): void {\n    this.textBuffers.clear();\n    this.toolCallBuffers.clear();\n    this.completedToolCalls = [];\n    this.toolResults.clear();\n  }\n\n  /**\n   * Create a snapshot for checkpointing (error recovery)\n   */\n  createSnapshot() {\n    return {\n      responseId: this.responseId,\n      model: this.model,\n      createdAt: this.createdAt,\n      textBuffers: new Map(this.textBuffers),\n      toolCallBuffers: new Map(this.toolCallBuffers),\n      completedToolCalls: [...this.completedToolCalls],\n      toolResults: new Map(this.toolResults),\n      currentIteration: this.currentIteration,\n      usage: { ...this.usage },\n      status: this.status,\n      startTime: this.startTime,\n      endTime: this.endTime,\n    };\n  }\n}\n","/**\n * Agentic loop - handles tool calling and multi-turn conversations\n * Now with events, hooks, pause/resume, and enterprise features\n */\n\nimport { randomUUID } from 'crypto';\nimport { EventEmitter } from 'eventemitter3';\nimport { ITextProvider, TextGenerateOptions } from '../../domain/interfaces/ITextProvider.js';\nimport { IToolExecutor } from '../../domain/interfaces/IToolExecutor.js';\nimport { AgentResponse } from '../../domain/entities/Response.js';\nimport { InputItem, MessageRole, OutputItem } from '../../domain/entities/Message.js';\nimport { Tool, ToolCall, ToolCallState, ToolResult } from '../../domain/entities/Tool.js';\nimport { ContentType, ToolResultContent } from '../../domain/entities/Content.js';\nimport { ToolTimeoutError } from '../../domain/errors/AIErrors.js';\nimport { ExecutionContext, HistoryMode } from './ExecutionContext.js';\nimport { HookManager } from './HookManager.js';\nimport { HookConfig } from './types/HookTypes.js';\nimport { AgenticLoopEvents } from './types/EventTypes.js';\nimport { StreamEvent, StreamEventType, isToolCallArgumentsDone } from '../../domain/entities/StreamEvent.js';\nimport { StreamState } from '../../domain/entities/StreamState.js';\n\nexport interface AgenticLoopConfig {\n  model: string;\n  input: string | InputItem[];\n  instructions?: string;\n  tools: Tool[];\n  temperature?: number;\n  maxIterations: number;\n\n  // NEW: Enterprise configuration\n  hooks?: HookConfig;\n  historyMode?: HistoryMode;\n  limits?: {\n    maxExecutionTime?: number;\n    maxToolCalls?: number;\n    maxContextSize?: number;\n    /** Maximum input messages to keep (prevents unbounded growth). Default: 50 */\n    maxInputMessages?: number;\n  };\n  errorHandling?: {\n    hookFailureMode?: 'fail' | 'warn' | 'ignore';\n    toolFailureMode?: 'fail' | 'warn' | 'continue';\n    maxConsecutiveErrors?: number;\n  };\n}\n\nexport class AgenticLoop extends EventEmitter<AgenticLoopEvents> {\n  private hookManager: HookManager;\n  private context: ExecutionContext | null = null;\n\n  // Pause/resume state\n  private paused: boolean = false;\n  private pausePromise: Promise<void> | null = null;\n  private resumeCallback: (() => void) | null = null;\n  private cancelled: boolean = false;\n  // Mutex to prevent race conditions in pause/resume\n  private pauseResumeMutex: Promise<void> = Promise.resolve();\n\n  constructor(\n    private provider: ITextProvider,\n    private toolExecutor: IToolExecutor,\n    hookConfig?: HookConfig,\n    errorHandling?: { maxConsecutiveErrors?: number }\n  ) {\n    super();\n    this.hookManager = new HookManager(\n      hookConfig || {},\n      this,\n      errorHandling\n    );\n  }\n\n  /**\n   * Execute agentic loop with tool calling\n   */\n  async execute(config: AgenticLoopConfig): Promise<AgentResponse> {\n    // Generate execution ID\n    const executionId = `exec_${randomUUID()}`;\n\n    // Create execution context\n    this.context = new ExecutionContext(executionId, {\n      maxHistorySize: 10,\n      historyMode: config.historyMode || 'summary',\n      maxAuditTrailSize: 1000,\n    });\n\n    // Reset state\n    this.paused = false;\n    this.cancelled = false;\n\n    // Emit execution start\n    this.emit('execution:start', {\n      executionId,\n      config,\n      timestamp: new Date(),\n    });\n\n    // Execute before:execution hook\n    await this.hookManager.executeHooks('before:execution', {\n      executionId,\n      config,\n      timestamp: new Date(),\n    }, undefined as any);\n\n    let currentInput = config.input;\n    let iteration = 0;\n    let finalResponse: AgentResponse;\n\n    try {\n      while (iteration < config.maxIterations) {\n        // Check pause\n        await this.checkPause();\n\n        // Check if cancelled\n        if (this.cancelled) {\n          throw new Error('Execution cancelled');\n        }\n\n        // Check resource limits\n        this.context.checkLimits(config.limits);\n\n        // Check pause hook\n        const pauseCheck = await this.hookManager.executeHooks('pause:check', {\n          executionId,\n          iteration,\n          context: this.context,\n          timestamp: new Date(),\n        }, { shouldPause: false });\n\n        if (pauseCheck.shouldPause) {\n          this.pause(pauseCheck.reason || 'Hook requested pause');\n          await this.checkPause();\n        }\n\n        // Update iteration\n        this.context.iteration = iteration;\n\n        // Emit iteration start\n        this.emit('iteration:start', {\n          executionId,\n          iteration,\n          timestamp: new Date(),\n        });\n\n        const iterationStartTime = Date.now();\n\n        // Generate LLM response\n        const response = await this.generateWithHooks(config, currentInput, iteration, executionId);\n\n        // Extract tool calls\n        const toolCalls = this.extractToolCalls(response.output, config.tools);\n\n        // Emit tool detection\n        if (toolCalls.length > 0) {\n          this.emit('tool:detected', {\n            executionId,\n            iteration,\n            toolCalls,\n            timestamp: new Date(),\n          });\n        }\n\n        // If no tool calls, we're done\n        if (toolCalls.length === 0) {\n          // Emit iteration complete\n          this.emit('iteration:complete', {\n            executionId,\n            iteration,\n            response,\n            timestamp: new Date(),\n            duration: Date.now() - iterationStartTime,\n          });\n\n          finalResponse = response;\n          break;\n        }\n\n        // Execute tools with hooks\n        const toolResults = await this.executeToolsWithHooks(toolCalls, iteration, executionId);\n\n        // Store iteration record\n        this.context.addIteration({\n          iteration,\n          request: {\n            model: config.model,\n            input: currentInput,\n            instructions: config.instructions,\n            tools: config.tools,\n            temperature: config.temperature,\n          },\n          response,\n          toolCalls,\n          toolResults,\n          startTime: new Date(iterationStartTime),\n          endTime: new Date(),\n        });\n\n        // Update metrics\n        this.context.updateMetrics({\n          iterationCount: iteration + 1,\n          inputTokens: this.context.metrics.inputTokens + (response.usage?.input_tokens || 0),\n          outputTokens: this.context.metrics.outputTokens + (response.usage?.output_tokens || 0),\n          totalTokens: this.context.metrics.totalTokens + (response.usage?.total_tokens || 0),\n        });\n\n        // Emit iteration complete\n        this.emit('iteration:complete', {\n          executionId,\n          iteration,\n          response,\n          timestamp: new Date(),\n          duration: Date.now() - iterationStartTime,\n        });\n\n        // Build next input\n        currentInput = this.buildInputWithToolResults(response.output, toolResults);\n\n        iteration++;\n      }\n\n      // Check if we exited normally or hit max iterations\n      if (iteration >= config.maxIterations) {\n        throw new Error(`Max iterations (${config.maxIterations}) reached without completion`);\n      }\n\n      // Calculate total duration\n      const totalDuration = Date.now() - this.context.startTime.getTime();\n      this.context.updateMetrics({ totalDuration });\n\n      // Execute after:execution hook\n      await this.hookManager.executeHooks('after:execution', {\n        executionId,\n        response: finalResponse!,\n        context: this.context,\n        timestamp: new Date(),\n        duration: totalDuration,\n      }, undefined as any);\n\n      // Emit execution complete\n      this.emit('execution:complete', {\n        executionId,\n        response: finalResponse!,\n        timestamp: new Date(),\n        duration: totalDuration,\n      });\n\n      return finalResponse!;\n    } catch (error) {\n      // Emit execution error\n      this.emit('execution:error', {\n        executionId,\n        error: error as Error,\n        timestamp: new Date(),\n      });\n\n      // Record error in metrics\n      this.context?.metrics.errors.push({\n        type: 'execution_error',\n        message: (error as Error).message,\n        timestamp: new Date(),\n      });\n\n      throw error;\n    } finally {\n      // Always cleanup resources\n      this.context?.cleanup();\n      this.hookManager.clear();\n    }\n  }\n\n  /**\n   * Execute agentic loop with streaming and tool calling\n   */\n  async *executeStreaming(config: AgenticLoopConfig): AsyncIterableIterator<StreamEvent> {\n    // Generate execution ID\n    const executionId = `exec_${randomUUID()}`;\n\n    // Create execution context\n    this.context = new ExecutionContext(executionId, {\n      maxHistorySize: 10,\n      historyMode: config.historyMode || 'summary',\n      maxAuditTrailSize: 1000,\n    });\n\n    // Reset state\n    this.paused = false;\n    this.cancelled = false;\n    this.pausePromise = null;\n    this.resumeCallback = null;\n\n    const startTime = Date.now();\n    let iteration = 0;\n    let currentInput: string | InputItem[] = config.input;\n\n    // Create a single StreamState for the entire execution (tracks usage across iterations)\n    const globalStreamState = new StreamState(executionId, config.model);\n\n    try {\n      // Emit execution start event\n      this.emit('execution:start', {\n        executionId,\n        model: config.model,\n        timestamp: new Date(),\n      });\n\n      // Execute before:execution hook\n      await this.hookManager.executeHooks('before:execution', {\n        executionId,\n        config,\n        timestamp: new Date(),\n      }, undefined as any);\n\n      // Main agentic loop\n      while (iteration < config.maxIterations) {\n        iteration++;\n\n        // Check pause state\n        await this.checkPause();\n\n        // Check if cancelled\n        if (this.cancelled) {\n          this.emit('execution:cancelled', { executionId, iteration, timestamp: new Date() });\n          break;\n        }\n\n        // Check resource limits\n        if (this.context) {\n          this.context.checkLimits(config.limits);\n        }\n\n        // Execute pause:check hook (allows dynamic pause decisions)\n        const pauseCheck = await this.hookManager.executeHooks('pause:check', {\n          executionId,\n          iteration,\n          context: this.context!,\n          timestamp: new Date(),\n        }, { shouldPause: false });\n\n        if (pauseCheck.shouldPause) {\n          this.pause();\n        }\n\n        // Emit iteration start\n        this.emit('iteration:start', {\n          executionId,\n          iteration,\n          timestamp: new Date(),\n        });\n\n        // Stream LLM response and accumulate state (per-iteration state)\n        const iterationStreamState = new StreamState(executionId, config.model);\n        const toolCallsMap = new Map<string, { name: string; args: string }>();\n\n        // Stream from provider with hooks\n        yield* this.streamGenerateWithHooks(config, currentInput, iteration, executionId, iterationStreamState, toolCallsMap);\n\n        // Accumulate usage from this iteration into global state\n        globalStreamState.accumulateUsage(iterationStreamState.usage);\n\n        // Check if any tool calls were detected\n        const toolCalls: ToolCall[] = [];\n        for (const [toolCallId, buffer] of toolCallsMap) {\n          toolCalls.push({\n            id: toolCallId,\n            type: 'function',\n            function: {\n              name: buffer.name,\n              arguments: buffer.args,\n            },\n            blocking: true,\n            state: ToolCallState.PENDING,\n          });\n        }\n\n        // No tool calls? We're done\n        if (toolCalls.length === 0) {\n          // Yield iteration complete\n          yield {\n            type: StreamEventType.ITERATION_COMPLETE,\n            response_id: executionId,\n            iteration,\n            tool_calls_count: 0,\n            has_more_iterations: false,\n          };\n\n          // Final response complete with accumulated usage from all iterations\n          yield {\n            type: StreamEventType.RESPONSE_COMPLETE,\n            response_id: executionId,\n            status: 'completed',\n            usage: globalStreamState.usage,\n            iterations: iteration,\n            duration_ms: Date.now() - startTime,\n          };\n\n          break;\n        }\n\n        // Execute tools and yield execution events\n        const toolResults: ToolResult[] = [];\n\n        for (const toolCall of toolCalls) {\n          // Parse and validate arguments\n          let parsedArgs: any;\n          try {\n            parsedArgs = JSON.parse(toolCall.function.arguments);\n          } catch (error) {\n            // Invalid JSON - skip this tool\n            yield {\n              type: StreamEventType.TOOL_EXECUTION_DONE,\n              response_id: executionId,\n              tool_call_id: toolCall.id,\n              tool_name: toolCall.function.name,\n              result: null,\n              execution_time_ms: 0,\n              error: `Invalid tool arguments JSON: ${(error as Error).message}`,\n            };\n            continue;\n          }\n\n          // Emit tool execution start\n          yield {\n            type: StreamEventType.TOOL_EXECUTION_START,\n            response_id: executionId,\n            tool_call_id: toolCall.id,\n            tool_name: toolCall.function.name,\n            arguments: parsedArgs,\n          };\n\n          const toolStartTime = Date.now();\n\n          try {\n            // Execute tool with hooks\n            const result = await this.executeToolWithHooks(toolCall, iteration, executionId);\n            toolResults.push(result);\n\n            // Emit tool execution done\n            yield {\n              type: StreamEventType.TOOL_EXECUTION_DONE,\n              response_id: executionId,\n              tool_call_id: toolCall.id,\n              tool_name: toolCall.function.name,\n              result: result.content,\n              execution_time_ms: Date.now() - toolStartTime,\n            };\n          } catch (error) {\n            // Emit tool execution error\n            yield {\n              type: StreamEventType.TOOL_EXECUTION_DONE,\n              response_id: executionId,\n              tool_call_id: toolCall.id,\n              tool_name: toolCall.function.name,\n              result: null,\n              execution_time_ms: Date.now() - toolStartTime,\n              error: (error as Error).message,\n            };\n\n            throw error; // Re-throw to stop execution\n          }\n        }\n\n        // Build next input with tool results\n        const assistantMessage: InputItem = {\n          type: 'message',\n          role: MessageRole.ASSISTANT,\n          content: [\n            {\n              type: ContentType.OUTPUT_TEXT,\n              text: iterationStreamState.getAllText(),\n            },\n            ...toolCalls.map((tc) => ({\n              type: ContentType.TOOL_USE as const,\n              id: tc.id,\n              name: tc.function.name,\n              arguments: tc.function.arguments,\n            })),\n          ],\n        };\n\n        const toolResultsMessage: InputItem = {\n          type: 'message',\n          role: MessageRole.USER,\n          content: toolResults.map((tr) => ({\n            type: ContentType.TOOL_RESULT as const,\n            tool_use_id: tr.tool_use_id,\n            content: tr.content,\n            error: tr.error,\n          })),\n        };\n\n        // Update current input for next iteration\n        if (Array.isArray(currentInput)) {\n          currentInput = [...currentInput, assistantMessage, toolResultsMessage];\n        } else {\n          currentInput = [\n            {\n              type: 'message' as const,\n              role: MessageRole.USER,\n              content: [{ type: ContentType.INPUT_TEXT, text: currentInput }],\n            },\n            assistantMessage,\n            toolResultsMessage,\n          ];\n        }\n\n        // Apply sliding window to prevent unbounded input growth\n        const maxInputMessages = config.limits?.maxInputMessages ?? 50;\n        if (Array.isArray(currentInput) && currentInput.length > maxInputMessages) {\n          // Keep the first message (usually system/developer message) and last N-1 messages\n          const firstMessage = currentInput[0];\n          const recentMessages = currentInput.slice(-(maxInputMessages - 1));\n\n          // Check if first message is a developer/system message\n          const isSystemMessage = firstMessage?.type === 'message' &&\n            firstMessage.role === MessageRole.DEVELOPER;\n\n          if (isSystemMessage) {\n            currentInput = [firstMessage, ...recentMessages];\n          } else {\n            // No system message, just keep the most recent messages\n            currentInput = currentInput.slice(-maxInputMessages);\n          }\n        }\n\n        // Yield iteration complete\n        yield {\n          type: StreamEventType.ITERATION_COMPLETE,\n          response_id: executionId,\n          iteration,\n          tool_calls_count: toolCalls.length,\n          has_more_iterations: true,\n        };\n\n        // Store iteration in context\n        if (this.context) {\n          globalStreamState.incrementIteration();\n        }\n\n        // Clear per-iteration resources to prevent memory accumulation\n        iterationStreamState.clear();\n        toolCallsMap.clear();\n      }\n\n      // If loop ended due to max iterations (not early break), emit final completion\n      if (iteration >= config.maxIterations) {\n        yield {\n          type: StreamEventType.RESPONSE_COMPLETE,\n          response_id: executionId,\n          status: 'incomplete', // Incomplete because we hit max iterations\n          usage: globalStreamState.usage,\n          iterations: iteration,\n          duration_ms: Date.now() - startTime,\n        };\n      }\n\n      // Execute after:execution hook\n      await this.hookManager.executeHooks('after:execution', {\n        executionId,\n        response: null as any, // We don't have a complete response in streaming\n        context: this.context,\n        timestamp: new Date(),\n        duration: Date.now() - startTime,\n      }, undefined as any);\n\n      // Emit execution complete\n      this.emit('execution:complete', {\n        executionId,\n        iterations: iteration,\n        duration: Date.now() - startTime,\n        timestamp: new Date(),\n      });\n    } catch (error) {\n      // Emit execution error\n      this.emit('execution:error', {\n        executionId,\n        error: error as Error,\n        timestamp: new Date(),\n      });\n\n      // Yield error event\n      yield {\n        type: StreamEventType.ERROR,\n        response_id: executionId,\n        error: {\n          type: 'execution_error',\n          message: (error as Error).message,\n        },\n        recoverable: false,\n      };\n\n      throw error;\n    } finally {\n      // Always cleanup resources\n      globalStreamState.clear();\n      this.context?.cleanup();\n      this.hookManager.clear();\n    }\n  }\n\n  /**\n   * Stream LLM response with hooks\n   * @private\n   */\n  private async *streamGenerateWithHooks(\n    config: AgenticLoopConfig,\n    input: string | InputItem[],\n    iteration: number,\n    executionId: string,\n    streamState: StreamState,\n    toolCallsMap: Map<string, { name: string; args: string }>\n  ): AsyncIterableIterator<StreamEvent> {\n    const llmStartTime = Date.now();\n\n    // Prepare options\n    let generateOptions: TextGenerateOptions = {\n      model: config.model,\n      input,\n      instructions: config.instructions,\n      tools: config.tools,\n      tool_choice: 'auto',\n      temperature: config.temperature,\n    };\n\n    // Execute before:llm hook\n    await this.hookManager.executeHooks('before:llm', {\n      executionId,\n      iteration,\n      options: generateOptions,\n      context: this.context!,\n      timestamp: new Date(),\n    }, {});\n\n    // Emit LLM request event\n    this.emit('llm:request', {\n      executionId,\n      iteration,\n      model: config.model,\n      timestamp: new Date(),\n    });\n\n    try {\n      // Stream from provider\n      for await (const event of this.provider.streamGenerate(generateOptions)) {\n        // Update stream state based on event\n        if (event.type === StreamEventType.OUTPUT_TEXT_DELTA) {\n          streamState.accumulateTextDelta(event.item_id, event.delta);\n        } else if (event.type === StreamEventType.TOOL_CALL_START) {\n          streamState.startToolCall(event.tool_call_id, event.tool_name);\n          toolCallsMap.set(event.tool_call_id, { name: event.tool_name, args: '' });\n        } else if (event.type === StreamEventType.TOOL_CALL_ARGUMENTS_DELTA) {\n          streamState.accumulateToolArguments(event.tool_call_id, event.delta);\n          const buffer = toolCallsMap.get(event.tool_call_id);\n          if (buffer) {\n            buffer.args += event.delta;\n          }\n        } else if (isToolCallArgumentsDone(event)) {\n          streamState.completeToolCall(event.tool_call_id);\n          const buffer = toolCallsMap.get(event.tool_call_id);\n          if (buffer) {\n            buffer.args = event.arguments;\n          }\n        } else if (event.type === StreamEventType.RESPONSE_COMPLETE) {\n          streamState.updateUsage(event.usage);\n\n          if (process.env.DEBUG_STREAMING) {\n            console.error('[DEBUG] Captured usage from provider:', event.usage);\n            console.error('[DEBUG] StreamState usage after update:', streamState.usage);\n          }\n\n          // Don't yield provider's RESPONSE_COMPLETE - we'll emit our own at the end\n          continue;\n        }\n\n        // Yield event to caller (except RESPONSE_COMPLETE which we handle ourselves)\n        yield event;\n      }\n\n      // Update metrics\n      if (this.context) {\n        this.context.metrics.llmDuration += Date.now() - llmStartTime;\n        this.context.metrics.inputTokens += streamState.usage.input_tokens;\n        this.context.metrics.outputTokens += streamState.usage.output_tokens;\n        this.context.metrics.totalTokens += streamState.usage.total_tokens;\n      }\n\n      if (process.env.DEBUG_STREAMING) {\n        console.error('[DEBUG] Stream iteration complete, usage:', streamState.usage);\n      }\n\n      // Execute after:llm hook\n      await this.hookManager.executeHooks('after:llm', {\n        executionId,\n        iteration,\n        response: null as any, // Streaming doesn't have complete response yet\n        context: this.context!,\n        timestamp: new Date(),\n        duration: Date.now() - llmStartTime,\n      }, {});\n\n      // Emit LLM response event\n      this.emit('llm:response', {\n        executionId,\n        iteration,\n        timestamp: new Date(),\n      });\n    } catch (error) {\n      this.emit('llm:error', {\n        executionId,\n        iteration,\n        error: error as Error,\n        timestamp: new Date(),\n      });\n      throw error;\n    }\n  }\n\n  /**\n   * Execute single tool with hooks\n   * @private\n   */\n  private async executeToolWithHooks(\n    toolCall: ToolCall,\n    iteration: number,\n    executionId: string\n  ): Promise<ToolResult> {\n    const toolStartTime = Date.now();\n\n    toolCall.state = ToolCallState.EXECUTING;\n    toolCall.startTime = new Date();\n\n    // Execute before:tool hook\n    await this.hookManager.executeHooks('before:tool', {\n      executionId,\n      iteration,\n      toolCall,\n      context: this.context!,\n      timestamp: new Date(),\n    }, {});\n\n    // Execute approve:tool hook if registered\n    if (this.hookManager.hasHooks('approve:tool')) {\n      const approval = await this.hookManager.executeHooks('approve:tool', {\n        executionId,\n        iteration,\n        toolCall,\n        context: this.context!,\n        timestamp: new Date(),\n      }, { approved: true });\n\n      if (!approval.approved) {\n        throw new Error(`Tool execution rejected: ${approval.reason || 'No reason provided'}`);\n      }\n    }\n\n    // Emit tool start\n    this.emit('tool:start', {\n      executionId,\n      iteration,\n      toolCall,\n      timestamp: new Date(),\n    });\n\n    try {\n      // Execute tool with timeout\n      const args = JSON.parse(toolCall.function.arguments);\n      const result = await this.executeWithTimeout(\n        () => this.toolExecutor.execute(toolCall.function.name, args),\n        30000 // 30 seconds timeout\n      );\n\n      // Create tool result\n      const toolResult: ToolResult = {\n        tool_use_id: toolCall.id,\n        content: result,\n        executionTime: Date.now() - toolStartTime,\n        state: ToolCallState.COMPLETED,\n      };\n\n      toolCall.state = ToolCallState.COMPLETED;\n      toolCall.endTime = new Date();\n\n      // Execute after:tool hook\n      await this.hookManager.executeHooks('after:tool', {\n        executionId,\n        iteration,\n        toolCall,\n        result: toolResult,\n        context: this.context!,\n        timestamp: new Date(),\n      }, {});\n\n      // Update metrics\n      if (this.context) {\n        this.context.metrics.toolCallCount++;\n        this.context.metrics.toolSuccessCount++;\n        this.context.metrics.toolDuration += toolResult.executionTime || 0;\n      }\n\n      // Emit tool complete\n      this.emit('tool:complete', {\n        executionId,\n        iteration,\n        toolCall,\n        result: toolResult,\n        timestamp: new Date(),\n      });\n\n      return toolResult;\n    } catch (error) {\n      toolCall.state = ToolCallState.FAILED;\n      toolCall.endTime = new Date();\n      toolCall.error = (error as Error).message;\n\n      // Update metrics\n      if (this.context) {\n        this.context.metrics.toolFailureCount++;\n      }\n\n      // Emit tool error\n      this.emit('tool:error', {\n        executionId,\n        iteration,\n        toolCall,\n        error: error as Error,\n        timestamp: new Date(),\n      });\n\n      throw error;\n    }\n  }\n\n  /**\n   * Generate LLM response with hooks\n   */\n  private async generateWithHooks(\n    config: AgenticLoopConfig,\n    input: string | InputItem[],\n    iteration: number,\n    executionId: string\n  ): Promise<AgentResponse> {\n    const llmStartTime = Date.now();\n\n    // Prepare options\n    let generateOptions: TextGenerateOptions = {\n      model: config.model,\n      input,\n      instructions: config.instructions,\n      tools: config.tools,\n      tool_choice: 'auto',\n      temperature: config.temperature,\n    };\n\n    // Execute before:llm hook\n    const beforeLLM = await this.hookManager.executeHooks('before:llm', {\n      executionId,\n      iteration,\n      options: generateOptions,\n      context: this.context!,\n      timestamp: new Date(),\n    }, {});\n\n    // Apply modifications\n    if (beforeLLM.modified) {\n      generateOptions = { ...generateOptions, ...beforeLLM.modified };\n    }\n\n    // Skip if requested\n    if (beforeLLM.skip) {\n      throw new Error('LLM call skipped by hook');\n    }\n\n    // Emit LLM request\n    this.emit('llm:request', {\n      executionId,\n      iteration,\n      options: generateOptions,\n      timestamp: new Date(),\n    });\n\n    try {\n      // Call provider\n      const response = await this.provider.generate(generateOptions);\n\n      const llmDuration = Date.now() - llmStartTime;\n\n      // Update metrics\n      this.context?.updateMetrics({\n        llmDuration: (this.context.metrics.llmDuration || 0) + llmDuration,\n      });\n\n      // Emit LLM response\n      this.emit('llm:response', {\n        executionId,\n        iteration,\n        response,\n        timestamp: new Date(),\n        duration: llmDuration,\n      });\n\n      // Execute after:llm hook\n      await this.hookManager.executeHooks('after:llm', {\n        executionId,\n        iteration,\n        response,\n        context: this.context!,\n        timestamp: new Date(),\n        duration: llmDuration,\n      }, {});\n\n      return response;\n    } catch (error) {\n      // Emit LLM error\n      this.emit('llm:error', {\n        executionId,\n        iteration,\n        error: error as Error,\n        timestamp: new Date(),\n      });\n\n      throw error;\n    }\n  }\n\n  /**\n   * Execute tools with hooks\n   */\n  private async executeToolsWithHooks(\n    toolCalls: ToolCall[],\n    iteration: number,\n    executionId: string\n  ): Promise<ToolResult[]> {\n    const results: ToolResult[] = [];\n\n    for (const toolCall of toolCalls) {\n      // Add to context\n      this.context?.addToolCall(toolCall);\n\n      // Check pause before each tool\n      await this.checkPause();\n\n      // Execute before:tool hook\n      const beforeTool = await this.hookManager.executeHooks('before:tool', {\n        executionId,\n        iteration,\n        toolCall,\n        context: this.context!,\n        timestamp: new Date(),\n      }, {});\n\n      // Check if tool should be skipped\n      if (beforeTool.skip) {\n        this.context?.audit('tool_skipped', { toolCall }, undefined, toolCall.function.name);\n\n        const mockResult: ToolResult = {\n          tool_use_id: toolCall.id,\n          content: beforeTool.mockResult || '',\n          state: ToolCallState.COMPLETED,\n          executionTime: 0,\n        };\n\n        results.push(mockResult);\n        this.context?.addToolResult(mockResult);\n        continue;\n      }\n\n      // Apply modifications if any\n      if (beforeTool.modified) {\n        Object.assign(toolCall, beforeTool.modified);\n        this.context?.audit('tool_modified', { modifications: beforeTool.modified }, undefined, toolCall.function.name);\n      }\n\n      // Execute approve:tool hook (if exists)\n      if (this.hookManager.hasHooks('approve:tool')) {\n        const approval = await this.hookManager.executeHooks('approve:tool', {\n          executionId,\n          iteration,\n          toolCall,\n          context: this.context!,\n          timestamp: new Date(),\n        }, { approved: true });\n\n        if (!approval.approved) {\n          this.context?.audit('tool_rejected', { reason: approval.reason }, undefined, toolCall.function.name);\n\n          const rejectedResult: ToolResult = {\n            tool_use_id: toolCall.id,\n            content: '',\n            error: `Tool rejected: ${approval.reason || 'Not approved'}`,\n            state: ToolCallState.FAILED,\n          };\n\n          results.push(rejectedResult);\n          this.context?.addToolResult(rejectedResult);\n          continue;\n        }\n\n        this.context?.audit('tool_approved', { reason: approval.reason }, undefined, toolCall.function.name);\n      }\n\n      // Execute tool\n      toolCall.state = ToolCallState.EXECUTING;\n      toolCall.startTime = new Date();\n\n      // Emit tool start\n      this.emit('tool:start', {\n        executionId,\n        iteration,\n        toolCall,\n        timestamp: new Date(),\n      });\n\n      const toolStartTime = Date.now();\n\n      try {\n        // Execute with timeout\n        const timeout = 30000;\n        const result = await this.executeWithTimeout(\n          () => this.toolExecutor.execute(\n            toolCall.function.name,\n            JSON.parse(toolCall.function.arguments)\n          ),\n          timeout\n        );\n\n        toolCall.state = ToolCallState.COMPLETED;\n        toolCall.endTime = new Date();\n\n        let toolResult: ToolResult = {\n          tool_use_id: toolCall.id,\n          content: result,\n          state: ToolCallState.COMPLETED,\n          executionTime: Date.now() - toolStartTime,\n        };\n\n        // Execute after:tool hook\n        const afterTool = await this.hookManager.executeHooks('after:tool', {\n          executionId,\n          iteration,\n          toolCall,\n          result: toolResult,\n          context: this.context!,\n          timestamp: new Date(),\n        }, {});\n\n        // Apply result modifications\n        if (afterTool.modified) {\n          toolResult = { ...toolResult, ...afterTool.modified };\n        }\n\n        results.push(toolResult);\n        this.context?.addToolResult(toolResult);\n\n        // Update metrics\n        this.context?.updateMetrics({\n          toolDuration: (this.context.metrics.toolDuration || 0) + toolResult.executionTime!,\n        });\n\n        // Emit tool complete\n        this.emit('tool:complete', {\n          executionId,\n          iteration,\n          toolCall,\n          result: toolResult,\n          timestamp: new Date(),\n        });\n      } catch (error) {\n        toolCall.state = ToolCallState.FAILED;\n        toolCall.endTime = new Date();\n        toolCall.error = (error as Error).message;\n\n        const toolResult: ToolResult = {\n          tool_use_id: toolCall.id,\n          content: '',\n          error: (error as Error).message,\n          state: ToolCallState.FAILED,\n        };\n\n        results.push(toolResult);\n        this.context?.addToolResult(toolResult);\n\n        // Record error\n        this.context?.metrics.errors.push({\n          type: 'tool_error',\n          message: (error as Error).message,\n          timestamp: new Date(),\n        });\n\n        // Emit tool error or timeout\n        if (error instanceof ToolTimeoutError) {\n          this.emit('tool:timeout', {\n            executionId,\n            iteration,\n            toolCall,\n            timeout: 30000,\n            timestamp: new Date(),\n          });\n        } else {\n          this.emit('tool:error', {\n            executionId,\n            iteration,\n            toolCall,\n            error: error as Error,\n            timestamp: new Date(),\n          });\n        }\n      }\n    }\n\n    return results;\n  }\n\n  /**\n   * Extract tool calls from response output\n   */\n  private extractToolCalls(output: OutputItem[], toolDefinitions: Tool[]): ToolCall[] {\n    const toolCalls: ToolCall[] = [];\n\n    // Create tool map for quick lookup\n    const toolMap = new Map<string, Tool>();\n    for (const tool of toolDefinitions) {\n      if (tool.type === 'function') {\n        toolMap.set(tool.function.name, tool);\n      }\n    }\n\n    // Extract tool calls from output\n    for (const item of output) {\n      if (item.type === 'message' && item.role === MessageRole.ASSISTANT) {\n        for (const content of item.content) {\n          if (content.type === ContentType.TOOL_USE) {\n            const toolDef = toolMap.get(content.name);\n            const isBlocking = toolDef?.blocking !== false;\n\n            const toolCall: ToolCall = {\n              id: content.id,\n              type: 'function',\n              function: {\n                name: content.name,\n                arguments: content.arguments,\n              },\n              blocking: isBlocking,\n              state: ToolCallState.PENDING,\n            };\n\n            toolCalls.push(toolCall);\n          }\n        }\n      }\n    }\n\n    return toolCalls;\n  }\n\n  /**\n   * Execute function with timeout\n   */\n  private async executeWithTimeout<T>(fn: () => Promise<T>, timeoutMs: number): Promise<T> {\n    return new Promise((resolve, reject) => {\n      const timer = setTimeout(() => {\n        reject(new ToolTimeoutError('tool', timeoutMs));\n      }, timeoutMs);\n\n      fn()\n        .then((result) => {\n          clearTimeout(timer);\n          resolve(result);\n        })\n        .catch((error) => {\n          clearTimeout(timer);\n          reject(error);\n        });\n    });\n  }\n\n  /**\n   * Build input with tool results\n   */\n  private buildInputWithToolResults(\n    previousOutput: OutputItem[],\n    toolResults: ToolResult[]\n  ): InputItem[] {\n    const input: InputItem[] = [];\n\n    // Add assistant's previous response as input\n    for (const item of previousOutput) {\n      if (item.type === 'message') {\n        input.push(item);\n      }\n    }\n\n    // Add tool results as user message\n    const toolResultContents: ToolResultContent[] = toolResults.map((result) => ({\n      type: ContentType.TOOL_RESULT,\n      tool_use_id: result.tool_use_id,\n      content: result.content,\n      error: result.error,\n    }));\n\n    if (toolResultContents.length > 0) {\n      input.push({\n        type: 'message',\n        role: MessageRole.USER,\n        content: toolResultContents,\n      });\n    }\n\n    return input;\n  }\n\n  /**\n   * Pause execution (thread-safe with mutex)\n   */\n  pause(reason?: string): void {\n    // Chain onto the mutex to ensure serialized access\n    this.pauseResumeMutex = this.pauseResumeMutex.then(() => {\n      this._doPause(reason);\n    });\n  }\n\n  /**\n   * Internal pause implementation\n   */\n  private _doPause(reason?: string): void {\n    if (this.paused) return;\n\n    this.paused = true;\n    this.pausePromise = new Promise((resolve) => {\n      this.resumeCallback = resolve;\n    });\n\n    if (this.context) {\n      this.context.paused = true;\n      this.context.pauseReason = reason;\n      this.context.audit('execution_paused', { reason });\n    }\n\n    this.emit('execution:paused', {\n      executionId: this.context?.executionId || 'unknown',\n      reason: reason || 'Manual pause',\n      timestamp: new Date(),\n    });\n  }\n\n  /**\n   * Resume execution (thread-safe with mutex)\n   */\n  resume(): void {\n    // Chain onto the mutex to ensure serialized access\n    this.pauseResumeMutex = this.pauseResumeMutex.then(() => {\n      this._doResume();\n    });\n  }\n\n  /**\n   * Internal resume implementation\n   */\n  private _doResume(): void {\n    if (!this.paused) return;\n\n    this.paused = false;\n\n    if (this.context) {\n      this.context.paused = false;\n      this.context.pauseReason = undefined;\n      this.context.audit('execution_resumed', {});\n    }\n\n    if (this.resumeCallback) {\n      this.resumeCallback();\n      this.resumeCallback = null;\n    }\n\n    this.pausePromise = null;\n\n    this.emit('execution:resumed', {\n      executionId: this.context?.executionId || 'unknown',\n      timestamp: new Date(),\n    });\n  }\n\n  /**\n   * Cancel execution\n   */\n  cancel(reason?: string): void {\n    this.cancelled = true;\n\n    if (this.context) {\n      this.context.cancelled = true;\n      this.context.cancelReason = reason;\n    }\n\n    // Resume if paused (to allow cancellation to proceed)\n    // Use internal method directly to bypass mutex for immediate cancellation\n    if (this.paused) {\n      this._doResume();\n    }\n\n    this.emit('execution:cancelled', {\n      executionId: this.context?.executionId || 'unknown',\n      reason: reason || 'Manual cancellation',\n      timestamp: new Date(),\n    });\n  }\n\n  /**\n   * Check if paused and wait\n   */\n  private async checkPause(): Promise<void> {\n    if (this.paused && this.pausePromise) {\n      await this.pausePromise;\n    }\n  }\n\n  /**\n   * Get current execution context\n   */\n  getContext(): ExecutionContext | null {\n    return this.context;\n  }\n\n  /**\n   * Check if currently executing\n   */\n  isRunning(): boolean {\n    return this.context !== null && !this.cancelled;\n  }\n\n  /**\n   * Check if paused\n   */\n  isPaused(): boolean {\n    return this.paused;\n  }\n\n  /**\n   * Check if cancelled\n   */\n  isCancelled(): boolean {\n    return this.cancelled;\n  }\n}\n","/**\n * Agent class - represents an agent with tool calling capabilities\n * Now with events, hooks, pause/resume, and enterprise features\n *\n * Implements IDisposable for proper resource cleanup\n */\n\nimport { EventEmitter } from 'eventemitter3';\nimport { ITextProvider } from '../../domain/interfaces/ITextProvider.js';\nimport { IDisposable, assertNotDestroyed } from '../../domain/interfaces/IDisposable.js';\nimport { ToolRegistry } from './ToolRegistry.js';\nimport { ToolFunction } from '../../domain/entities/Tool.js';\nimport { InputItem } from '../../domain/entities/Message.js';\nimport { AgentResponse } from '../../domain/entities/Response.js';\nimport { AgenticLoop, AgenticLoopConfig } from './AgenticLoop.js';\nimport { ExecutionContext, HistoryMode } from './ExecutionContext.js';\nimport { HookConfig } from './types/HookTypes.js';\nimport { AgenticLoopEvents } from './types/EventTypes.js';\nimport { StreamEvent } from '../../domain/entities/StreamEvent.js';\n\nexport interface AgentConfig {\n  provider: string;\n  model: string;\n  instructions?: string;\n  tools?: ToolFunction[];\n  temperature?: number;\n  maxIterations?: number;\n\n  // NEW: Enterprise configuration\n  hooks?: HookConfig;\n  historyMode?: HistoryMode;\n  limits?: {\n    maxExecutionTime?: number;\n    maxToolCalls?: number;\n    maxContextSize?: number;\n    /** Maximum number of input messages to keep (prevents unbounded context growth) */\n    maxInputMessages?: number;\n  };\n  errorHandling?: {\n    hookFailureMode?: 'fail' | 'warn' | 'ignore';\n    toolFailureMode?: 'fail' | 'warn' | 'continue';\n    maxConsecutiveErrors?: number;\n  };\n}\n\nexport class Agent extends EventEmitter<AgenticLoopEvents> implements IDisposable {\n  private agenticLoop: AgenticLoop;\n  private cleanupCallbacks: Array<() => void> = [];\n  private boundListeners: Map<keyof AgenticLoopEvents, (...args: any[]) => void> = new Map();\n  private _isDestroyed = false;\n\n  get isDestroyed(): boolean {\n    return this._isDestroyed;\n  }\n\n  constructor(\n    private config: AgentConfig,\n    textProvider: ITextProvider,\n    private toolRegistry: ToolRegistry\n  ) {\n    super();\n\n    // Register tools if provided\n    if (config.tools) {\n      for (const tool of config.tools) {\n        this.toolRegistry.registerTool(tool);\n      }\n    }\n\n    // Create agentic loop with hooks\n    this.agenticLoop = new AgenticLoop(\n      textProvider,\n      toolRegistry,\n      config.hooks,\n      config.errorHandling\n    );\n\n    // Forward all events from AgenticLoop with tracked listeners for cleanup\n    const eventNames: Array<keyof AgenticLoopEvents> = [\n      'execution:start',\n      'execution:complete',\n      'execution:error',\n      'execution:paused',\n      'execution:resumed',\n      'execution:cancelled',\n      'iteration:start',\n      'iteration:complete',\n      'llm:request',\n      'llm:response',\n      'llm:error',\n      'tool:detected',\n      'tool:start',\n      'tool:complete',\n      'tool:error',\n      'tool:timeout',\n      'hook:error',\n    ];\n\n    for (const eventName of eventNames) {\n      // Create a bound handler that can be removed later\n      const handler = (data: any) => {\n        if (!this._isDestroyed) {\n          this.emit(eventName, data);\n        }\n      };\n      this.boundListeners.set(eventName, handler);\n      this.agenticLoop.on(eventName, handler);\n    }\n  }\n\n  /**\n   * Run the agent with input\n   * @throws Error if agent has been destroyed\n   */\n  async run(input: string | InputItem[]): Promise<AgentResponse> {\n    assertNotDestroyed(this, 'run agent');\n\n    // Get tool definitions for the LLM\n    const tools = this.config.tools?.map((t) => t.definition) || [];\n\n    const loopConfig: AgenticLoopConfig = {\n      model: this.config.model,\n      input,\n      instructions: this.config.instructions,\n      tools,\n      temperature: this.config.temperature,\n      maxIterations: this.config.maxIterations || 10,\n      hooks: this.config.hooks,\n      historyMode: this.config.historyMode,\n      limits: this.config.limits,\n      errorHandling: this.config.errorHandling,\n    };\n\n    return this.agenticLoop.execute(loopConfig);\n  }\n\n  /**\n   * Stream response from the agent with real-time events\n   * Returns an async iterator of streaming events\n   * Supports full agentic loop with tool calling\n   * @throws Error if agent has been destroyed\n   */\n  async *stream(input: string | InputItem[]): AsyncIterableIterator<StreamEvent> {\n    assertNotDestroyed(this, 'stream from agent');\n\n    // Get tool definitions for the LLM\n    const tools = this.config.tools?.map((t) => t.definition) || [];\n\n    const loopConfig: AgenticLoopConfig = {\n      model: this.config.model,\n      input,\n      instructions: this.config.instructions,\n      tools,\n      temperature: this.config.temperature,\n      maxIterations: this.config.maxIterations || 10,\n      hooks: this.config.hooks,\n      historyMode: this.config.historyMode,\n      limits: this.config.limits,\n      errorHandling: this.config.errorHandling,\n    };\n\n    // Stream from agentic loop with full tool support\n    yield* this.agenticLoop.executeStreaming(loopConfig);\n  }\n\n  /**\n   * Add a tool to the agent\n   */\n  addTool(tool: ToolFunction): void {\n    this.toolRegistry.registerTool(tool);\n    if (!this.config.tools) {\n      this.config.tools = [];\n    }\n    this.config.tools.push(tool);\n  }\n\n  /**\n   * Remove a tool from the agent\n   */\n  removeTool(toolName: string): void {\n    this.toolRegistry.unregisterTool(toolName);\n    if (this.config.tools) {\n      this.config.tools = this.config.tools.filter(\n        (t) => t.definition.function.name !== toolName\n      );\n    }\n  }\n\n  /**\n   * List registered tools\n   */\n  listTools(): string[] {\n    return this.toolRegistry.listTools();\n  }\n\n  // ==================== NEW: Control Methods ====================\n\n  /**\n   * Pause execution\n   */\n  pause(reason?: string): void {\n    this.agenticLoop.pause(reason);\n  }\n\n  /**\n   * Resume execution\n   */\n  resume(): void {\n    this.agenticLoop.resume();\n  }\n\n  /**\n   * Cancel execution\n   */\n  cancel(reason?: string): void {\n    this.agenticLoop.cancel(reason);\n  }\n\n  // ==================== NEW: Introspection Methods ====================\n\n  /**\n   * Get current execution context\n   */\n  getContext(): ExecutionContext | null {\n    return this.agenticLoop.getContext();\n  }\n\n  /**\n   * Get execution metrics\n   */\n  getMetrics() {\n    const context = this.agenticLoop.getContext();\n    return context?.metrics || null;\n  }\n\n  /**\n   * Get execution summary\n   */\n  getSummary() {\n    const context = this.agenticLoop.getContext();\n    return context?.getSummary() || null;\n  }\n\n  /**\n   * Get audit trail\n   */\n  getAuditTrail() {\n    const context = this.agenticLoop.getContext();\n    return context?.getAuditTrail() || [];\n  }\n\n  /**\n   * Check if currently running\n   */\n  isRunning(): boolean {\n    return this.agenticLoop.isRunning();\n  }\n\n  /**\n   * Check if paused\n   */\n  isPaused(): boolean {\n    return this.agenticLoop.isPaused();\n  }\n\n  /**\n   * Check if cancelled\n   */\n  isCancelled(): boolean {\n    return this.agenticLoop.isCancelled();\n  }\n\n  // ==================== NEW: Cleanup ====================\n\n  /**\n   * Register cleanup callback\n   */\n  onCleanup(callback: () => void): void {\n    this.cleanupCallbacks.push(callback);\n  }\n\n  /**\n   * Destroy agent and cleanup resources\n   * Safe to call multiple times (idempotent)\n   */\n  destroy(): void {\n    if (this._isDestroyed) {\n      return;\n    }\n    this._isDestroyed = true;\n\n    // Cancel any ongoing execution\n    try {\n      this.agenticLoop.cancel('Agent destroyed');\n    } catch {\n      // Ignore errors during cancel\n    }\n\n    // Remove specifically tracked event forwarding listeners from AgenticLoop\n    for (const [eventName, handler] of this.boundListeners) {\n      this.agenticLoop.off(eventName, handler);\n    }\n    this.boundListeners.clear();\n\n    // Remove all event listeners from this Agent\n    this.removeAllListeners();\n\n    // Run custom cleanup callbacks\n    for (const callback of this.cleanupCallbacks) {\n      try {\n        callback();\n      } catch (error) {\n        console.error('Cleanup callback error:', error);\n      }\n    }\n    this.cleanupCallbacks = [];\n  }\n}\n","/**\n * Tool registry - manages tool registration and execution\n */\n\nimport { IToolExecutor } from '../../domain/interfaces/IToolExecutor.js';\nimport { Tool, ToolFunction } from '../../domain/entities/Tool.js';\nimport { ToolNotFoundError, ToolExecutionError } from '../../domain/errors/AIErrors.js';\n\nexport class ToolRegistry implements IToolExecutor {\n  private tools: Map<string, ToolFunction> = new Map();\n\n  /**\n   * Register a new tool\n   */\n  registerTool(tool: ToolFunction): void {\n    this.tools.set(tool.definition.function.name, tool);\n  }\n\n  /**\n   * Unregister a tool\n   */\n  unregisterTool(toolName: string): void {\n    this.tools.delete(toolName);\n  }\n\n  /**\n   * Execute a tool function\n   */\n  async execute(toolName: string, args: any): Promise<any> {\n    const tool = this.tools.get(toolName);\n    if (!tool) {\n      throw new ToolNotFoundError(toolName);\n    }\n\n    try {\n      return await tool.execute(args);\n    } catch (error) {\n      throw new ToolExecutionError(\n        toolName,\n        (error as Error).message,\n        error as Error\n      );\n    }\n  }\n\n  /**\n   * Check if tool is available\n   */\n  hasToolFunction(toolName: string): boolean {\n    return this.tools.has(toolName);\n  }\n\n  /**\n   * Get tool definition\n   */\n  getToolDefinition(toolName: string): Tool | undefined {\n    const tool = this.tools.get(toolName);\n    return tool?.definition;\n  }\n\n  /**\n   * List all registered tools\n   */\n  listTools(): string[] {\n    return Array.from(this.tools.keys());\n  }\n\n  /**\n   * Clear all registered tools\n   */\n  clear(): void {\n    this.tools.clear();\n  }\n}\n","/**\n * Agent manager - creates and manages agents with tool calling\n *\n * Implements IDisposable for proper resource cleanup\n */\n\nimport { ProviderRegistry } from '../../client/ProviderRegistry.js';\nimport { IDisposable, assertNotDestroyed } from '../../domain/interfaces/IDisposable.js';\nimport { Agent, AgentConfig } from './Agent.js';\nimport { ToolRegistry } from './ToolRegistry.js';\n\nexport class AgentManager implements IDisposable {\n  private toolRegistry: ToolRegistry;\n  private agents: Set<Agent> = new Set();\n  private _isDestroyed = false;\n\n  get isDestroyed(): boolean {\n    return this._isDestroyed;\n  }\n\n  constructor(private registry: ProviderRegistry) {\n    this.toolRegistry = new ToolRegistry();\n  }\n\n  /**\n   * Create a new agent instance\n   * @returns Promise<Agent> - async to support race-condition-free provider loading\n   */\n  async create(config: AgentConfig): Promise<Agent> {\n    assertNotDestroyed(this, 'create agent');\n\n    const provider = await this.registry.getTextProvider(config.provider);\n    const agent = new Agent(config, provider, this.toolRegistry);\n\n    // Track agent for cleanup\n    this.agents.add(agent);\n\n    // Auto-remove from tracking when agent is destroyed\n    agent.onCleanup(() => {\n      this.agents.delete(agent);\n    });\n\n    return agent;\n  }\n\n  /**\n   * Convenience method for one-off agent calls\n   */\n  async run(config: AgentConfig & { input: string | any[] }): Promise<any> {\n    const agent = await this.create(config);\n    try {\n      return await agent.run(config.input);\n    } finally {\n      // Clean up one-off agents\n      agent.destroy();\n    }\n  }\n\n  /**\n   * Get the number of active agents\n   */\n  getActiveAgentCount(): number {\n    return this.agents.size;\n  }\n\n  /**\n   * Destroy the manager and all managed agents\n   * Safe to call multiple times (idempotent)\n   */\n  destroy(): void {\n    if (this._isDestroyed) {\n      return;\n    }\n    this._isDestroyed = true;\n\n    // Destroy all managed agents\n    for (const agent of this.agents) {\n      try {\n        agent.destroy();\n      } catch {\n        // Ignore errors during cleanup\n      }\n    }\n    this.agents.clear();\n\n    // Clear tool registry\n    this.toolRegistry.clear();\n  }\n}\n","/**\n * Text generation manager - simple text generation without tools\n *\n * Implements IDisposable for proper resource cleanup\n */\n\nimport { ProviderRegistry } from '../../client/ProviderRegistry.js';\nimport { IDisposable, assertNotDestroyed } from '../../domain/interfaces/IDisposable.js';\nimport { InputItem } from '../../domain/entities/Message.js';\nimport { LLMResponse } from '../../domain/entities/Response.js';\nimport { TextGenerateOptions } from '../../domain/interfaces/ITextProvider.js';\n\nexport interface SimpleTextOptions {\n  provider: string;\n  model: string;\n  instructions?: string;\n  temperature?: number;\n  max_output_tokens?: number;\n  response_format?: {\n    type: 'text' | 'json_object' | 'json_schema';\n    json_schema?: any;\n  };\n}\n\nexport class TextManager implements IDisposable {\n  private _isDestroyed = false;\n\n  get isDestroyed(): boolean {\n    return this._isDestroyed;\n  }\n\n  constructor(private registry: ProviderRegistry) {}\n\n  /**\n   * Generate text response\n   */\n  async generate(input: string | InputItem[], options: SimpleTextOptions): Promise<string> {\n    assertNotDestroyed(this, 'generate text');\n\n    const provider = await this.registry.getTextProvider(options.provider);\n\n    const generateOptions: TextGenerateOptions = {\n      model: options.model,\n      input,\n      instructions: options.instructions,\n      temperature: options.temperature,\n      max_output_tokens: options.max_output_tokens,\n      response_format: options.response_format,\n    };\n\n    const response = await provider.generate(generateOptions);\n    return this.extractTextFromResponse(response);\n  }\n\n  /**\n   * Generate structured JSON output\n   */\n  async generateJSON<T = any>(\n    input: string | InputItem[],\n    options: SimpleTextOptions & { schema: any }\n  ): Promise<T> {\n    assertNotDestroyed(this, 'generate JSON');\n\n    const provider = await this.registry.getTextProvider(options.provider);\n\n    const generateOptions: TextGenerateOptions = {\n      model: options.model,\n      input,\n      instructions: options.instructions,\n      temperature: options.temperature,\n      response_format: {\n        type: 'json_schema',\n        json_schema: options.schema,\n      },\n    };\n\n    const response = await provider.generate(generateOptions);\n    const text = this.extractTextFromResponse(response);\n    return JSON.parse(text) as T;\n  }\n\n  /**\n   * Get full response object (not just text)\n   */\n  async generateRaw(input: string | InputItem[], options: SimpleTextOptions): Promise<LLMResponse> {\n    assertNotDestroyed(this, 'generate raw response');\n\n    const provider = await this.registry.getTextProvider(options.provider);\n\n    const generateOptions: TextGenerateOptions = {\n      model: options.model,\n      input,\n      instructions: options.instructions,\n      temperature: options.temperature,\n      max_output_tokens: options.max_output_tokens,\n      response_format: options.response_format,\n    };\n\n    return provider.generate(generateOptions);\n  }\n\n  /**\n   * Extract text from response\n   */\n  private extractTextFromResponse(response: LLMResponse): string {\n    if (response.output_text) {\n      return response.output_text;\n    }\n\n    // Extract from output items\n    for (const item of response.output) {\n      if (item.type === 'message' && item.role === 'assistant') {\n        for (const content of item.content) {\n          if (content.type === 'output_text') {\n            return content.text;\n          }\n        }\n      }\n    }\n\n    return '';\n  }\n\n  /**\n   * Destroy the manager and release resources\n   * Safe to call multiple times (idempotent)\n   */\n  destroy(): void {\n    if (this._isDestroyed) {\n      return;\n    }\n    this._isDestroyed = true;\n    // TextManager has no internal resources to clean up\n    // but follows the IDisposable pattern for consistency\n  }\n}\n","/**\n * Image generation manager\n *\n * Implements IDisposable for proper resource cleanup\n */\n\nimport { ProviderRegistry } from '../../client/ProviderRegistry.js';\nimport { IDisposable, assertNotDestroyed } from '../../domain/interfaces/IDisposable.js';\nimport {\n  ImageGenerateOptions,\n  ImageEditOptions,\n  ImageVariationOptions,\n  ImageResponse,\n} from '../../domain/interfaces/IImageProvider.js';\n\nexport class ImageManager implements IDisposable {\n  private _isDestroyed = false;\n\n  get isDestroyed(): boolean {\n    return this._isDestroyed;\n  }\n\n  constructor(private registry: ProviderRegistry) {}\n\n  /**\n   * Generate images from text prompt\n   */\n  async generate(options: ImageGenerateOptions): Promise<ImageResponse> {\n    assertNotDestroyed(this, 'generate image');\n\n    const provider = await this.registry.getImageProvider(options.model.split('/')[0] || 'openai');\n    return provider.generateImage(options);\n  }\n\n  /**\n   * Edit an existing image\n   */\n  async edit(options: ImageEditOptions): Promise<ImageResponse> {\n    assertNotDestroyed(this, 'edit image');\n\n    const providerName = options.model.split('/')[0] || 'openai';\n    const provider = await this.registry.getImageProvider(providerName);\n\n    if (!provider.editImage) {\n      throw new Error(`Provider ${providerName} does not support image editing`);\n    }\n\n    return provider.editImage(options);\n  }\n\n  /**\n   * Create variations of an image\n   */\n  async createVariation(options: ImageVariationOptions): Promise<ImageResponse> {\n    assertNotDestroyed(this, 'create image variation');\n\n    const providerName = options.model.split('/')[0] || 'openai';\n    const provider = await this.registry.getImageProvider(providerName);\n\n    if (!provider.createVariation) {\n      throw new Error(`Provider ${providerName} does not support image variations`);\n    }\n\n    return provider.createVariation(options);\n  }\n\n  /**\n   * Destroy the manager and release resources\n   * Safe to call multiple times (idempotent)\n   */\n  destroy(): void {\n    if (this._isDestroyed) {\n      return;\n    }\n    this._isDestroyed = true;\n    // ImageManager has no internal resources to clean up\n    // but follows the IDisposable pattern for consistency\n  }\n}\n","/**\n * Main client class - entry point for the library\n *\n * Implements IDisposable for proper resource cleanup\n */\n\nimport { ProvidersConfig } from '../domain/types/ProviderConfig.js';\nimport { LogLevel } from '../domain/types/CommonTypes.js';\nimport { ProviderRegistry } from './ProviderRegistry.js';\nimport { AgentManager } from '../capabilities/agents/AgentManager.js';\nimport { TextManager } from '../capabilities/text/TextManager.js';\nimport { ImageManager } from '../capabilities/images/ImageManager.js';\nimport { ProviderCapabilities } from '../domain/interfaces/IProvider.js';\nimport { IDisposable, assertNotDestroyed } from '../domain/interfaces/IDisposable.js';\nimport { ProviderNotFoundError } from '../domain/errors/AIErrors.js';\n\nexport interface OneRingAIConfig {\n  providers: ProvidersConfig;\n  defaultProvider?: string;\n  logLevel?: LogLevel;\n}\n\nexport class OneRingAI implements IDisposable {\n  private registry: ProviderRegistry;\n\n  // Capability managers (lazy loaded)\n  private _agents?: AgentManager;\n  private _text?: TextManager;\n  private _images?: ImageManager;\n\n  private _isDestroyed = false;\n\n  get isDestroyed(): boolean {\n    return this._isDestroyed;\n  }\n\n  constructor(config: OneRingAIConfig) {\n    this.registry = new ProviderRegistry(config.providers);\n  }\n\n  /**\n   * Access agent capability (with tool calling)\n   */\n  get agents(): AgentManager {\n    assertNotDestroyed(this, 'access agents');\n    if (!this._agents) {\n      this._agents = new AgentManager(this.registry);\n    }\n    return this._agents;\n  }\n\n  /**\n   * Access simple text generation capability\n   */\n  get text(): TextManager {\n    assertNotDestroyed(this, 'access text');\n    if (!this._text) {\n      this._text = new TextManager(this.registry);\n    }\n    return this._text;\n  }\n\n  /**\n   * Access image generation capability\n   */\n  get images(): ImageManager {\n    assertNotDestroyed(this, 'access images');\n    if (!this._images) {\n      this._images = new ImageManager(this.registry);\n    }\n    return this._images;\n  }\n\n  /**\n   * List all configured providers\n   */\n  listProviders(): string[] {\n    return this.registry.listProviders();\n  }\n\n  /**\n   * Get provider capabilities\n   * Now async to support race-condition-free provider loading\n   */\n  async getProviderCapabilities(providerName: string): Promise<ProviderCapabilities> {\n    assertNotDestroyed(this, 'get provider capabilities');\n\n    if (!this.registry.hasProvider(providerName)) {\n      throw new ProviderNotFoundError(providerName);\n    }\n\n    // Try to get text provider to check capabilities\n    try {\n      const provider = await this.registry.getTextProvider(providerName);\n      return provider.capabilities;\n    } catch {\n      // If text provider fails, try image provider\n      try {\n        const provider = await this.registry.getImageProvider(providerName);\n        return provider.capabilities;\n      } catch {\n        throw new ProviderNotFoundError(providerName);\n      }\n    }\n  }\n\n  /**\n   * Check if a provider is configured\n   */\n  hasProvider(providerName: string): boolean {\n    return this.registry.hasProvider(providerName);\n  }\n\n  /**\n   * Destroy the client and release all resources\n   * Safe to call multiple times (idempotent)\n   */\n  destroy(): void {\n    if (this._isDestroyed) {\n      return;\n    }\n    this._isDestroyed = true;\n\n    // Destroy all managers\n    this._agents?.destroy();\n    this._text?.destroy();\n    this._images?.destroy();\n\n    // Clear references\n    this._agents = undefined;\n    this._text = undefined;\n    this._images = undefined;\n\n    // Destroy registry\n    this.registry.destroy();\n  }\n}\n","/**\n * Stream helper utilities for consuming and processing streaming events\n */\n\nimport {\n  StreamEvent,\n  StreamEventType,\n  isOutputTextDelta,\n} from '../../domain/entities/StreamEvent.js';\nimport { StreamState } from '../../domain/entities/StreamState.js';\nimport { LLMResponse, OutputItem } from '../../domain/entities/Response.js';\nimport { MessageRole } from '../../domain/entities/Message.js';\nimport { ContentType } from '../../domain/entities/Content.js';\n\n/**\n * Helper class for consuming and processing streams\n */\nexport class StreamHelpers {\n  /**\n   * Collect complete response from stream\n   * Accumulates all events and reconstructs final LLMResponse\n   */\n  static async collectResponse(\n    stream: AsyncIterableIterator<StreamEvent>\n  ): Promise<LLMResponse> {\n    let state: StreamState | null = null;\n\n    for await (const event of stream) {\n      // Initialize state on first event\n      if (!state && event.type === StreamEventType.RESPONSE_CREATED) {\n        state = new StreamState(event.response_id, event.model, event.created_at);\n      }\n\n      if (!state) continue;\n\n      // Update state from events\n      this.updateStateFromEvent(state, event);\n    }\n\n    if (!state) {\n      throw new Error('No stream events received');\n    }\n\n    return this.reconstructLLMResponse(state);\n  }\n\n  /**\n   * Get only text deltas from stream (for simple text streaming)\n   * Filters out all other event types\n   */\n  static async *textOnly(\n    stream: AsyncIterableIterator<StreamEvent>\n  ): AsyncIterableIterator<string> {\n    for await (const event of stream) {\n      if (isOutputTextDelta(event)) {\n        yield event.delta;\n      }\n    }\n  }\n\n  /**\n   * Filter stream events by type\n   */\n  static async *filterByType<T extends StreamEvent>(\n    stream: AsyncIterableIterator<StreamEvent>,\n    eventType: StreamEventType\n  ): AsyncIterableIterator<T> {\n    for await (const event of stream) {\n      if (event.type === eventType) {\n        yield event as T;\n      }\n    }\n  }\n\n  /**\n   * Accumulate text from stream into a single string\n   */\n  static async accumulateText(\n    stream: AsyncIterableIterator<StreamEvent>\n  ): Promise<string> {\n    const chunks: string[] = [];\n\n    for await (const event of stream) {\n      if (isOutputTextDelta(event)) {\n        chunks.push(event.delta);\n      }\n    }\n\n    return chunks.join('');\n  }\n\n  /**\n   * Buffer stream events into batches\n   */\n  static async *bufferEvents(\n    stream: AsyncIterableIterator<StreamEvent>,\n    batchSize: number\n  ): AsyncIterableIterator<StreamEvent[]> {\n    let buffer: StreamEvent[] = [];\n\n    for await (const event of stream) {\n      buffer.push(event);\n\n      if (buffer.length >= batchSize) {\n        yield buffer;\n        buffer = [];\n      }\n    }\n\n    // Yield remaining events\n    if (buffer.length > 0) {\n      yield buffer;\n    }\n  }\n\n  /**\n   * Tap into stream without consuming it\n   * Useful for logging or side effects\n   */\n  static async *tap(\n    stream: AsyncIterableIterator<StreamEvent>,\n    callback: (event: StreamEvent) => void | Promise<void>\n  ): AsyncIterableIterator<StreamEvent> {\n    for await (const event of stream) {\n      await callback(event);\n      yield event;\n    }\n  }\n\n  /**\n   * Take first N events from stream\n   */\n  static async *take(\n    stream: AsyncIterableIterator<StreamEvent>,\n    count: number\n  ): AsyncIterableIterator<StreamEvent> {\n    let taken = 0;\n\n    for await (const event of stream) {\n      if (taken >= count) break;\n      yield event;\n      taken++;\n    }\n  }\n\n  /**\n   * Skip first N events from stream\n   */\n  static async *skip(\n    stream: AsyncIterableIterator<StreamEvent>,\n    count: number\n  ): AsyncIterableIterator<StreamEvent> {\n    let skipped = 0;\n\n    for await (const event of stream) {\n      if (skipped < count) {\n        skipped++;\n        continue;\n      }\n      yield event;\n    }\n  }\n\n  /**\n   * Update StreamState from event\n   * @private\n   */\n  private static updateStateFromEvent(state: StreamState, event: StreamEvent): void {\n    switch (event.type) {\n      case StreamEventType.OUTPUT_TEXT_DELTA:\n        state.accumulateTextDelta(event.item_id, event.delta);\n        break;\n\n      case StreamEventType.TOOL_CALL_START:\n        state.startToolCall(event.tool_call_id, event.tool_name);\n        break;\n\n      case StreamEventType.TOOL_CALL_ARGUMENTS_DELTA:\n        state.accumulateToolArguments(event.tool_call_id, event.delta);\n        break;\n\n      case StreamEventType.TOOL_CALL_ARGUMENTS_DONE:\n        state.completeToolCall(event.tool_call_id);\n        break;\n\n      case StreamEventType.TOOL_EXECUTION_DONE:\n        state.setToolResult(event.tool_call_id, event.result);\n        break;\n\n      case StreamEventType.ITERATION_COMPLETE:\n        state.incrementIteration();\n        break;\n\n      case StreamEventType.RESPONSE_COMPLETE:\n        // Debug: Log usage when received\n        if (process.env.DEBUG_STREAMING) {\n          console.error('[DEBUG] RESPONSE_COMPLETE event:', event.usage);\n        }\n        state.updateUsage(event.usage);\n        state.markComplete(event.status);\n        break;\n    }\n  }\n\n  /**\n   * Reconstruct LLMResponse from StreamState\n   * @private\n   */\n  private static reconstructLLMResponse(state: StreamState): LLMResponse {\n    const output: OutputItem[] = [];\n\n    // Add text messages\n    if (state.hasText()) {\n      const textContent = state.getAllText();\n      if (textContent) {\n        output.push({\n          type: 'message' as const,\n          role: MessageRole.ASSISTANT,\n          content: [\n            {\n              type: ContentType.OUTPUT_TEXT,\n              text: textContent,\n            },\n          ],\n        });\n      }\n    }\n\n    // Add tool calls to output\n    const toolCalls = state.getCompletedToolCalls();\n    if (toolCalls.length > 0) {\n      // Tool calls should be part of assistant message content\n      const toolUseContent = toolCalls.map((tc) => ({\n        type: ContentType.TOOL_USE as const,\n        id: tc.id,\n        name: tc.function.name,\n        arguments: tc.function.arguments,\n      }));\n\n      const firstOutput = output[0];\n      if (firstOutput && firstOutput.type === 'message') {\n        // Append to existing message\n        firstOutput.content.push(...toolUseContent);\n      } else {\n        // Create new message with tool calls\n        output.push({\n          type: 'message' as const,\n          role: MessageRole.ASSISTANT,\n          content: toolUseContent,\n        });\n      }\n    }\n\n    // Extract output text\n    const outputText = this.extractOutputText(output);\n\n    return {\n      id: state.responseId,\n      object: 'response',\n      created_at: state.createdAt,\n      status: state.status,\n      model: state.model,\n      output,\n      output_text: outputText,\n      usage: state.usage,\n    };\n  }\n\n  /**\n   * Extract text from output items\n   * @private\n   */\n  private static extractOutputText(output: OutputItem[]): string {\n    const texts: string[] = [];\n\n    for (const item of output) {\n      if (item.type === 'message') {\n        for (const content of item.content) {\n          if (content.type === ContentType.OUTPUT_TEXT) {\n            texts.push(content.text);\n          }\n        }\n      }\n    }\n\n    return texts.join(' ').trim();\n  }\n}\n","/**\n * Message builder utilities for constructing complex inputs\n */\n\nimport { InputItem, MessageRole } from '../domain/entities/Message.js';\nimport {\n  ContentType,\n  InputTextContent,\n  InputImageContent,\n} from '../domain/entities/Content.js';\n\nexport class MessageBuilder {\n  private messages: InputItem[] = [];\n\n  /**\n   * Add a user text message\n   */\n  addUserMessage(text: string): this {\n    this.messages.push({\n      type: 'message',\n      role: MessageRole.USER,\n      content: [\n        {\n          type: ContentType.INPUT_TEXT,\n          text,\n        },\n      ],\n    });\n    return this;\n  }\n\n  /**\n   * Add a user message with text and images\n   */\n  addUserMessageWithImages(text: string, imageUrls: string[]): this {\n    const content: (InputTextContent | InputImageContent)[] = [\n      {\n        type: ContentType.INPUT_TEXT,\n        text,\n      },\n    ];\n\n    // Add images\n    for (const url of imageUrls) {\n      content.push({\n        type: ContentType.INPUT_IMAGE_URL,\n        image_url: {\n          url,\n          detail: 'auto', // Can be 'auto', 'low', or 'high'\n        },\n      });\n    }\n\n    this.messages.push({\n      type: 'message',\n      role: MessageRole.USER,\n      content,\n    });\n\n    return this;\n  }\n\n  /**\n   * Add an assistant message (for conversation history)\n   */\n  addAssistantMessage(text: string): this {\n    this.messages.push({\n      type: 'message',\n      role: MessageRole.ASSISTANT,\n      content: [\n        {\n          type: ContentType.OUTPUT_TEXT,\n          text,\n          annotations: [],\n        },\n      ],\n    });\n    return this;\n  }\n\n  /**\n   * Add a system/developer message\n   */\n  addDeveloperMessage(text: string): this {\n    this.messages.push({\n      type: 'message',\n      role: MessageRole.DEVELOPER,\n      content: [\n        {\n          type: ContentType.INPUT_TEXT,\n          text,\n        },\n      ],\n    });\n    return this;\n  }\n\n  /**\n   * Build and return the messages array\n   */\n  build(): InputItem[] {\n    return this.messages;\n  }\n\n  /**\n   * Clear all messages\n   */\n  clear(): this {\n    this.messages = [];\n    return this;\n  }\n\n  /**\n   * Get the current message count\n   */\n  count(): number {\n    return this.messages.length;\n  }\n}\n\n/**\n * Helper function to create a simple text message\n */\nexport function createTextMessage(text: string, role: MessageRole = MessageRole.USER): InputItem {\n  return {\n    type: 'message',\n    role,\n    content: [\n      {\n        type: ContentType.INPUT_TEXT,\n        text,\n      },\n    ],\n  };\n}\n\n/**\n * Helper function to create a message with images\n */\nexport function createMessageWithImages(\n  text: string,\n  imageUrls: string[],\n  role: MessageRole = MessageRole.USER\n): InputItem {\n  const content: (InputTextContent | InputImageContent)[] = [\n    {\n      type: ContentType.INPUT_TEXT,\n      text,\n    },\n  ];\n\n  for (const url of imageUrls) {\n    content.push({\n      type: ContentType.INPUT_IMAGE_URL,\n      image_url: {\n        url,\n        detail: 'auto',\n      },\n    });\n  }\n\n  return {\n    type: 'message',\n    role,\n    content,\n  };\n}\n","/**\n * Clipboard image utilities\n * Reads images from clipboard (supports Mac, Linux, Windows)\n */\n\nimport { exec } from 'child_process';\nimport { promisify } from 'util';\nimport * as fs from 'fs';\nimport * as os from 'os';\nimport * as path from 'path';\n\nconst execAsync = promisify(exec);\n\n/**\n * Safely clean up a temp file, ignoring errors\n */\nfunction cleanupTempFile(filePath: string): void {\n  try {\n    if (fs.existsSync(filePath)) {\n      fs.unlinkSync(filePath);\n    }\n  } catch {\n    // Ignore cleanup errors - temp directory will eventually clean up\n  }\n}\n\nexport interface ClipboardImageResult {\n  success: boolean;\n  dataUri?: string;\n  error?: string;\n  format?: string;\n}\n\n/**\n * Read image from clipboard and convert to data URI\n */\nexport async function readClipboardImage(): Promise<ClipboardImageResult> {\n  const platform = os.platform();\n\n  try {\n    switch (platform) {\n      case 'darwin': // macOS\n        return await readClipboardImageMac();\n      case 'linux':\n        return await readClipboardImageLinux();\n      case 'win32':\n        return await readClipboardImageWindows();\n      default:\n        return {\n          success: false,\n          error: `Unsupported platform: ${platform}`,\n        };\n    }\n  } catch (error: any) {\n    return {\n      success: false,\n      error: error.message,\n    };\n  }\n}\n\n/**\n * Read clipboard image on macOS\n */\nasync function readClipboardImageMac(): Promise<ClipboardImageResult> {\n  const tempFile = path.join(os.tmpdir(), `clipboard-${Date.now()}.png`);\n\n  try {\n    // Try pngpaste first (brew install pngpaste)\n    try {\n      await execAsync(`pngpaste \"${tempFile}\"`);\n      return await convertFileToDataUri(tempFile);\n    } catch (pngpasteError) {\n      // pngpaste not installed, try osascript\n      const script = `\n        set theFile to (POSIX file \"${tempFile}\")\n        try\n          set theImage to the clipboard as class PNGf\n          set fileRef to open for access theFile with write permission\n          write theImage to fileRef\n          close access fileRef\n          return \"success\"\n        on error errMsg\n          try\n            close access theFile\n          end try\n          error errMsg\n        end try\n      `;\n\n      const { stdout } = await execAsync(`osascript -e '${script}'`);\n\n      if (stdout.includes('success') || fs.existsSync(tempFile)) {\n        return await convertFileToDataUri(tempFile);\n      }\n\n      return {\n        success: false,\n        error: 'No image found in clipboard. Try copying an image first (Cmd+C or screenshot with Cmd+Ctrl+Shift+4)',\n      };\n    }\n  } finally {\n    // Always clean up temp file\n    cleanupTempFile(tempFile);\n  }\n}\n\n/**\n * Read clipboard image on Linux\n */\nasync function readClipboardImageLinux(): Promise<ClipboardImageResult> {\n  const tempFile = path.join(os.tmpdir(), `clipboard-${Date.now()}.png`);\n\n  try {\n    // Try xclip\n    try {\n      await execAsync(`xclip -selection clipboard -t image/png -o > \"${tempFile}\"`);\n      if (fs.existsSync(tempFile) && fs.statSync(tempFile).size > 0) {\n        return await convertFileToDataUri(tempFile);\n      }\n    } catch {\n      // xclip not available or failed\n    }\n\n    // Try wl-paste (Wayland)\n    try {\n      await execAsync(`wl-paste -t image/png > \"${tempFile}\"`);\n      if (fs.existsSync(tempFile) && fs.statSync(tempFile).size > 0) {\n        return await convertFileToDataUri(tempFile);\n      }\n    } catch {\n      // wl-paste not available or failed\n    }\n\n    return {\n      success: false,\n      error: 'No image in clipboard. Install xclip (X11) or wl-clipboard (Wayland)',\n    };\n  } finally {\n    // Always clean up temp file\n    cleanupTempFile(tempFile);\n  }\n}\n\n/**\n * Read clipboard image on Windows\n */\nasync function readClipboardImageWindows(): Promise<ClipboardImageResult> {\n  const tempFile = path.join(os.tmpdir(), `clipboard-${Date.now()}.png`);\n\n  try {\n    // PowerShell script to save clipboard image\n    const psScript = `\n      Add-Type -AssemblyName System.Windows.Forms;\n      $clip = [System.Windows.Forms.Clipboard]::GetImage();\n      if ($clip -ne $null) {\n        $clip.Save('${tempFile.replace(/\\\\/g, '\\\\\\\\')}', [System.Drawing.Imaging.ImageFormat]::Png);\n        Write-Output 'success';\n      } else {\n        Write-Error 'No image in clipboard';\n      }\n    `;\n\n    await execAsync(`powershell -Command \"${psScript}\"`);\n\n    if (fs.existsSync(tempFile) && fs.statSync(tempFile).size > 0) {\n      return await convertFileToDataUri(tempFile);\n    }\n\n    return {\n      success: false,\n      error: 'No image found in clipboard',\n    };\n  } finally {\n    // Always clean up temp file\n    cleanupTempFile(tempFile);\n  }\n}\n\n/**\n * Convert image file to data URI\n * Note: Caller is responsible for temp file cleanup via finally block\n */\nasync function convertFileToDataUri(filePath: string): Promise<ClipboardImageResult> {\n  try {\n    const imageBuffer = fs.readFileSync(filePath);\n    const base64Image = imageBuffer.toString('base64');\n\n    // Detect format from file\n    const magic = imageBuffer.slice(0, 4).toString('hex');\n    let mimeType = 'image/png';\n\n    if (magic.startsWith('89504e47')) {\n      mimeType = 'image/png';\n    } else if (magic.startsWith('ffd8ff')) {\n      mimeType = 'image/jpeg';\n    } else if (magic.startsWith('47494638')) {\n      mimeType = 'image/gif';\n    } else if (magic.startsWith('52494646')) {\n      mimeType = 'image/webp';\n    }\n\n    const dataUri = `data:${mimeType};base64,${base64Image}`;\n\n    return {\n      success: true,\n      dataUri,\n      format: mimeType,\n    };\n  } catch (error: any) {\n    return {\n      success: false,\n      error: error.message,\n    };\n  }\n}\n\n/**\n * Check if clipboard contains an image (quick check)\n */\nexport async function hasClipboardImage(): Promise<boolean> {\n  const platform = os.platform();\n\n  try {\n    switch (platform) {\n      case 'darwin':\n        // Check if clipboard has image data\n        const { stdout } = await execAsync('osascript -e \"clipboard info\"');\n        return stdout.includes('class PNGf') || stdout.includes('public.png');\n\n      case 'linux':\n        // Try xclip\n        try {\n          await execAsync('xclip -selection clipboard -t TARGETS -o | grep -q image');\n          return true;\n        } catch {\n          return false;\n        }\n\n      case 'win32':\n        // PowerShell check\n        const psCheck = `\n          Add-Type -AssemblyName System.Windows.Forms;\n          if ([System.Windows.Forms.Clipboard]::GetImage() -ne $null) {\n            Write-Output 'true'\n          } else {\n            Write-Output 'false'\n          }\n        `;\n        const { stdout: result } = await execAsync(`powershell -Command \"${psCheck}\"`);\n        return result.trim() === 'true';\n\n      default:\n        return false;\n    }\n  } catch {\n    return false;\n  }\n}\n","/**\n * Pre-built tools for agents\n *\n * Import and use with your agents:\n *\n * ```typescript\n * import { tools } from '@oneringai/agents';\n *\n * const agent = client.agents.create({\n *   provider: 'openai',\n *   model: 'gpt-4',\n *   tools: [tools.jsonManipulator, tools.webSearch, tools.webFetch]\n * });\n * ```\n */\n\n// JSON tools\nexport { jsonManipulator } from './json/jsonManipulator.js';\n\n// Web tools\nexport { webFetch, webFetchJS, webSearch } from './web/index.js';\n\n// Code execution tools\nexport { executeJavaScript, createExecuteJavaScriptTool } from './code/index.js';\n\n// Future tool exports\n// export { fileReader } from './file/fileReader.js';\n","/**\n * Path utilities for dot notation path manipulation in JSON objects\n */\n\n/**\n * Parse dot notation path into array of keys\n *\n * Examples:\n *   'user.name'  ['user', 'name']\n *   'users.0.name'  ['users', '0', 'name']\n *   'settings.theme.colors.primary'  ['settings', 'theme', 'colors', 'primary']\n *   ''  []\n */\nexport function parsePath(path: string): string[] {\n  if (path === '' || path === '$') {\n    return [];\n  }\n\n  const keys = path.split('.');\n\n  // Filter out empty strings (from consecutive dots)\n  const filtered = keys.filter((p) => p.length > 0);\n\n  // Validate no consecutive dots\n  if (filtered.length !== keys.length) {\n    throw new Error(`Invalid path format: ${path} (consecutive dots not allowed)`);\n  }\n\n  return filtered;\n}\n\n/**\n * Get value at path in object\n *\n * Returns undefined if path doesn't exist\n */\nexport function getValueAtPath(obj: any, path: string): any {\n  const keys = parsePath(path);\n  let current = obj;\n\n  for (const key of keys) {\n    if (current === null || current === undefined) {\n      return undefined;\n    }\n\n    // Handle both object properties and array indices\n    current = current[key];\n  }\n\n  return current;\n}\n\n/**\n * Set value at path in object (mutates the object)\n *\n * Creates intermediate objects/arrays as needed\n *\n * @returns true if successful\n * @throws Error if path is invalid or root-level\n */\nexport function setValueAtPath(obj: any, path: string, value: any): boolean {\n  const keys = parsePath(path);\n\n  if (keys.length === 0) {\n    throw new Error('Cannot set root object - path must not be empty');\n  }\n\n  let current = obj;\n\n  // Navigate to parent of target\n  for (let i = 0; i < keys.length - 1; i++) {\n    const key = keys[i]!;\n\n    // Create intermediate objects/arrays if they don't exist\n    if (!(key in current) || current[key] === null || current[key] === undefined) {\n      // Check if next key is numeric (array index)\n      const nextKey = keys[i + 1];\n      const isArrayIndex = nextKey !== undefined && /^\\d+$/.test(nextKey);\n\n      current[key] = isArrayIndex ? [] : {};\n    }\n\n    current = current[key];\n\n    // Validate we can continue navigation\n    if (current === null || current === undefined) {\n      throw new Error(`Cannot navigate through null/undefined at path: ${keys.slice(0, i + 1).join('.')}`);\n    }\n  }\n\n  // Set the final value\n  const lastKey = keys[keys.length - 1]!;\n\n  // For arrays, handle numeric indices\n  if (Array.isArray(current)) {\n    const index = parseInt(lastKey);\n    if (isNaN(index)) {\n      throw new Error(`Array index must be numeric, got: ${lastKey}`);\n    }\n    // Allow appending beyond array length\n    current[index] = value;\n  } else {\n    current[lastKey] = value;\n  }\n\n  return true;\n}\n\n/**\n * Delete value at path in object (mutates the object)\n *\n * @returns true if deleted, false if path doesn't exist\n * @throws Error if path is invalid or root-level\n */\nexport function deleteAtPath(obj: any, path: string): boolean {\n  const keys = parsePath(path);\n\n  if (keys.length === 0) {\n    throw new Error('Cannot delete root object - path must not be empty');\n  }\n\n  let current = obj;\n\n  // Navigate to parent\n  for (let i = 0; i < keys.length - 1; i++) {\n    const key = keys[i]!;\n\n    if (!(key in current)) {\n      return false; // Path doesn't exist\n    }\n\n    current = current[key];\n\n    if (current === null || current === undefined) {\n      return false; // Can't navigate further\n    }\n  }\n\n  const lastKey = keys[keys.length - 1]!;\n\n  // Check if key exists\n  if (!(lastKey in current)) {\n    return false;\n  }\n\n  // Delete from array or object\n  if (Array.isArray(current)) {\n    const index = parseInt(lastKey);\n    if (isNaN(index) || index < 0 || index >= current.length) {\n      return false;\n    }\n    current.splice(index, 1);\n  } else {\n    delete current[lastKey];\n  }\n\n  return true;\n}\n\n/**\n * Check if path exists in object\n */\nexport function pathExists(obj: any, path: string): boolean {\n  try {\n    const value = getValueAtPath(obj, path);\n    return value !== undefined;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Validate path format\n *\n * @returns true if valid, throws Error with message if invalid\n */\nexport function validatePath(path: string): boolean {\n  // Empty path is valid (represents root)\n  if (path === '' || path === '$') {\n    return true;\n  }\n\n  // Check for invalid characters\n  if (path.includes('..')) {\n    throw new Error('Invalid path: consecutive dots not allowed');\n  }\n\n  if (path.startsWith('.') || path.endsWith('.')) {\n    throw new Error('Invalid path: cannot start or end with dot');\n  }\n\n  // Try to parse it\n  parsePath(path);\n\n  return true;\n}\n","/**\n * JSON Manipulation Tool\n *\n * Allows AI agents to manipulate JSON objects using dot notation paths.\n * Supports delete, add, and replace operations at any depth.\n */\n\nimport { ToolFunction } from '../../domain/entities/Tool.js';\nimport { setValueAtPath, deleteAtPath, pathExists } from './pathUtils.js';\n\ninterface JsonManipulateArgs {\n  operation: 'delete' | 'add' | 'replace';\n  path: string;\n  value?: any;\n  object: any;\n}\n\ninterface JsonManipulateResult {\n  success: boolean;\n  result: any | null;\n  message?: string;\n  error?: string;\n}\n\nexport const jsonManipulator: ToolFunction<JsonManipulateArgs, JsonManipulateResult> = {\n  definition: {\n    type: 'function',\n    function: {\n      name: 'json_manipulate',\n      description: `Manipulate JSON objects by deleting, adding, or replacing fields at any depth.\n\nIMPORTANT - PATH FORMAT (DOT NOTATION):\nUse dots to separate nested field names. Examples:\n Top-level field: \"name\"\n Nested field: \"user.email\"\n Array element: \"users.0.name\" (where 0 is the array index)\n Deep nesting: \"settings.theme.colors.primary\"\n For root operations: use empty string \"\"\n\nOPERATIONS:\n\n1. DELETE - Remove a field from the object\n    Removes the specified field and its value\n    Returns error if path doesn't exist\n    Example: operation=\"delete\", path=\"user.address.city\"\n    Result: The city field is removed from user.address\n\n2. ADD - Add a new field to the object\n    Creates intermediate objects/arrays if they don't exist\n    If field already exists, it will be overwritten\n    Example: operation=\"add\", path=\"user.phone\", value=\"+1234567890\"\n    Result: Creates user.phone field with the phone number\n\n3. REPLACE - Replace the value of an EXISTING field\n    Only works if the field already exists (use ADD for new fields)\n    Returns error if path doesn't exist\n    Example: operation=\"replace\", path=\"user.name\", value=\"Jane Doe\"\n    Result: Changes the existing user.name value\n\nARRAY OPERATIONS:\n Access array elements by index: \"users.0.name\" (first user's name)\n Add to array: \"users.2\" appends if index >= array length\n Delete from array: \"users.1\" removes element and shifts remaining items\n\nCOMPLETE EXAMPLES:\n\nExample 1 - Delete a field:\n  Input: { operation: \"delete\", path: \"user.email\", object: {user: {name: \"John\", email: \"j@ex.com\"}} }\n  Output: {user: {name: \"John\"}}\n\nExample 2 - Add nested field (auto-creates intermediate objects):\n  Input: { operation: \"add\", path: \"user.address.city\", value: \"Paris\", object: {user: {name: \"John\"}} }\n  Output: {user: {name: \"John\", address: {city: \"Paris\"}}}\n\nExample 3 - Replace value:\n  Input: { operation: \"replace\", path: \"settings.theme\", value: \"dark\", object: {settings: {theme: \"light\"}} }\n  Output: {settings: {theme: \"dark\"}}\n\nExample 4 - Array manipulation:\n  Input: { operation: \"replace\", path: \"users.0.active\", value: false, object: {users: [{name: \"Bob\", active: true}]} }\n  Output: {users: [{name: \"Bob\", active: false}]}\n\nThe tool returns a result object with:\n success: boolean (true if operation succeeded)\n result: the modified JSON object (or null if failed)\n message: success message (if succeeded)\n error: error description (if failed)`,\n\n      parameters: {\n        type: 'object',\n        properties: {\n          operation: {\n            type: 'string',\n            enum: ['delete', 'add', 'replace'],\n            description:\n              'The operation to perform. \"delete\" removes a field, \"add\" creates a new field (or overwrites existing), \"replace\" changes an existing field value.',\n          },\n          path: {\n            type: 'string',\n            description:\n              'Dot notation path to the field. Examples: \"name\", \"user.email\", \"users.0.name\", \"settings.theme.colors.primary\". Use empty string \"\" only for root-level operations.',\n          },\n          value: {\n            description:\n              'The value to add or replace. Can be any JSON-compatible type: string, number, boolean, object, array, or null. Required for add/replace operations, ignored for delete.',\n          },\n          object: {\n            type: 'object',\n            description:\n              'The JSON object to manipulate. The original object is not modified; a new modified copy is returned in the result.',\n          },\n        },\n        required: ['operation', 'path', 'object'],\n      },\n    },\n    blocking: true, // Always wait for result\n    timeout: 10000, // 10 seconds should be plenty for JSON operations\n  },\n\n  execute: async (args: JsonManipulateArgs): Promise<JsonManipulateResult> => {\n    try {\n      // Validate operation\n      if (!['delete', 'add', 'replace'].includes(args.operation)) {\n        return {\n          success: false,\n          result: null,\n          error: `Invalid operation: \"${args.operation}\". Must be \"delete\", \"add\", or \"replace\".`,\n        };\n      }\n\n      // Validate object is provided\n      if (!args.object || typeof args.object !== 'object') {\n        return {\n          success: false,\n          result: null,\n          error: 'Invalid object: must provide a valid JSON object',\n        };\n      }\n\n      // Clone object to avoid mutation (deep clone)\n      let clonedObject: any;\n      try {\n        clonedObject = JSON.parse(JSON.stringify(args.object));\n      } catch (error: any) {\n        return {\n          success: false,\n          result: null,\n          error: `Cannot clone object: ${error.message}. Object may contain circular references or non-JSON values.`,\n        };\n      }\n\n      // Perform operation\n      switch (args.operation) {\n        case 'delete': {\n          try {\n            const deleted = deleteAtPath(clonedObject, args.path);\n\n            if (!deleted) {\n              return {\n                success: false,\n                result: null,\n                error: `Path not found: \"${args.path}\". The field does not exist in the object.`,\n              };\n            }\n\n            return {\n              success: true,\n              result: clonedObject,\n              message: `Successfully deleted field at path: \"${args.path}\"`,\n            };\n          } catch (error: any) {\n            return {\n              success: false,\n              result: null,\n              error: `Delete operation failed: ${error.message}`,\n            };\n          }\n        }\n\n        case 'add': {\n          // Validate value is provided\n          if (args.value === undefined) {\n            return {\n              success: false,\n              result: null,\n              error: 'Add operation requires a \"value\" parameter',\n            };\n          }\n\n          try {\n            setValueAtPath(clonedObject, args.path, args.value);\n\n            return {\n              success: true,\n              result: clonedObject,\n              message: `Successfully added field at path: \"${args.path}\"`,\n            };\n          } catch (error: any) {\n            return {\n              success: false,\n              result: null,\n              error: `Add operation failed: ${error.message}`,\n            };\n          }\n        }\n\n        case 'replace': {\n          // Validate value is provided\n          if (args.value === undefined) {\n            return {\n              success: false,\n              result: null,\n              error: 'Replace operation requires a \"value\" parameter',\n            };\n          }\n\n          // Check if path exists (replace only works on existing paths)\n          if (!pathExists(clonedObject, args.path)) {\n            return {\n              success: false,\n              result: null,\n              error: `Path not found: \"${args.path}\". Use \"add\" operation to create new fields.`,\n            };\n          }\n\n          try {\n            setValueAtPath(clonedObject, args.path, args.value);\n\n            return {\n              success: true,\n              result: clonedObject,\n              message: `Successfully replaced value at path: \"${args.path}\"`,\n            };\n          } catch (error: any) {\n            return {\n              success: false,\n              result: null,\n              error: `Replace operation failed: ${error.message}`,\n            };\n          }\n        }\n\n        default:\n          return {\n            success: false,\n            result: null,\n            error: `Unknown operation: ${args.operation}`,\n          };\n      }\n    } catch (error: any) {\n      return {\n        success: false,\n        result: null,\n        error: `Unexpected error manipulating JSON: ${error.message}`,\n      };\n    }\n  },\n};\n","/**\n * Content quality detection for web scraping\n * Detects if content is valid, requires JavaScript, or has errors\n */\n\nimport type { CheerioAPI } from 'cheerio';\n\nexport interface QualityResult {\n  score: number; // 0-100\n  requiresJS: boolean;\n  suggestion?: string;\n  issues: string[];\n}\n\n/**\n * Detect content quality from HTML and extracted text\n */\nexport function detectContentQuality(\n  html: string,\n  text: string,\n  $: CheerioAPI\n): QualityResult {\n  const issues: string[] = [];\n  let score = 100;\n  let requiresJS = false;\n\n  // Check 1: Empty or very short content\n  if (text.length < 100) {\n    issues.push('Very little text content extracted');\n    score -= 40;\n    requiresJS = true;\n  }\n\n  // Check 2: Detect common error patterns\n  const errorPatterns = [\n    { pattern: /access denied/i, penalty: 50 },\n    { pattern: /403 forbidden/i, penalty: 50 },\n    { pattern: /404 not found/i, penalty: 50 },\n    { pattern: /page not found/i, penalty: 40 },\n    { pattern: /cloudflare/i, penalty: 30 },\n    { pattern: /please enable javascript/i, penalty: 40 },\n    { pattern: /requires javascript/i, penalty: 40 },\n    { pattern: /robot|bot detection/i, penalty: 30 },\n  ];\n\n  for (const { pattern, penalty } of errorPatterns) {\n    if (pattern.test(html) || pattern.test(text)) {\n      issues.push(`Error pattern detected: ${pattern.source}`);\n      score -= penalty;\n    }\n  }\n\n  // Check 3: Mostly script tags (code dumps)\n  const scriptCount = $('script').length;\n  const textLength = text.length;\n\n  if (scriptCount > 10 && textLength < 500) {\n    issues.push('Page is mostly JavaScript code (code dump)');\n    score -= 40;\n    requiresJS = true;\n  }\n\n  // Check 4: High script-to-content ratio\n  const scriptLength = $('script').text().length;\n  if (scriptLength > textLength * 2 && textLength < 1000) {\n    issues.push('High JavaScript-to-content ratio');\n    score -= 20;\n    requiresJS = true;\n  }\n\n  // Check 5: Common JS framework markers\n  const jsFrameworks = [\n    { pattern: /\\breact\\b/i, name: 'React' },\n    { pattern: /\\bvue\\b/i, name: 'Vue' },\n    { pattern: /\\bangular\\b/i, name: 'Angular' },\n    { pattern: /__NEXT_DATA__/i, name: 'Next.js' },\n    { pattern: /\\bwebpack\\b/i, name: 'Webpack' },\n    { pattern: /_app-.*\\.js/i, name: 'SPA' },\n  ];\n\n  for (const framework of jsFrameworks) {\n    if (framework.pattern.test(html)) {\n      issues.push(`${framework.name} framework detected`);\n      requiresJS = true;\n    }\n  }\n\n  // Check 6: Empty body with divs (typical SPA)\n  const bodyText = $('body').text().trim();\n  const divCount = $('div').length;\n\n  if (bodyText.length < 100 && divCount > 5) {\n    issues.push('Empty body with many divs (likely Single Page App)');\n    score -= 30;\n    requiresJS = true;\n  }\n\n  // Check 7: Noscript tag with meaningful content\n  const noscript = $('noscript').text();\n  if (noscript.length > 50) {\n    issues.push('Noscript tag present (site requires JavaScript)');\n    requiresJS = true;\n  }\n\n  // Check 8: Very few paragraphs/headings (typical of SPA skeleton)\n  const paragraphCount = $('p').length;\n  const headingCount = $('h1, h2, h3, h4, h5, h6').length;\n\n  if (paragraphCount < 3 && headingCount < 2 && textLength < 500) {\n    issues.push('Very few content elements (likely needs JavaScript)');\n    score -= 20;\n    requiresJS = true;\n  }\n\n  // Generate suggestion\n  let suggestion: string | undefined;\n  if (requiresJS && score < 50) {\n    suggestion =\n      'Content quality is low. This appears to be a JavaScript-rendered site. Use the web_fetch_js tool for better results.';\n  } else if (score < 30) {\n    suggestion = 'Content extraction failed or page has errors. Check the URL and try again.';\n  }\n\n  return {\n    score: Math.max(0, Math.min(100, score)),\n    requiresJS,\n    suggestion,\n    issues,\n  };\n}\n\n/**\n * Check if content looks like an error page\n */\nexport function isErrorPage(statusCode: number, html: string, text: string): boolean {\n  if (statusCode >= 400) return true;\n\n  const errorIndicators = [\n    /404|not found/i,\n    /403|forbidden|access denied/i,\n    /500|internal server error/i,\n    /503|service unavailable/i,\n  ];\n\n  for (const pattern of errorIndicators) {\n    if (pattern.test(html) || pattern.test(text)) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\n/**\n * Extract clean text content from HTML\n */\nexport function extractCleanText($: CheerioAPI): string {\n  // Remove unwanted elements\n  $('script, style, noscript, iframe, nav, footer, header, aside').remove();\n\n  // Remove common ad/tracking divs\n  $('[class*=\"ad-\"], [class*=\"advertisement\"], [id*=\"ad-\"]').remove();\n  $('[class*=\"cookie\"], [class*=\"gdpr\"]').remove();\n\n  // Get text from main content areas (prioritized)\n  const mainSelectors = [\n    'main',\n    'article',\n    '[role=\"main\"]',\n    '.content',\n    '#content',\n    '.post',\n    '.article',\n  ];\n\n  for (const selector of mainSelectors) {\n    const mainContent = $(selector).text().trim();\n    if (mainContent.length > 200) {\n      return mainContent;\n    }\n  }\n\n  // Fallback to body\n  return $('body').text().trim();\n}\n","/**\n * Web Fetch Tool - Simple HTTP fetch with content quality detection\n */\n\nimport { load } from 'cheerio';\nimport { ToolFunction } from '../../domain/entities/Tool.js';\nimport { detectContentQuality, extractCleanText } from './contentDetector.js';\n\ninterface WebFetchArgs {\n  url: string;\n  userAgent?: string;\n  timeout?: number;\n}\n\ninterface WebFetchResult {\n  success: boolean;\n  url: string;\n  title: string;\n  content: string;\n  html: string;\n  contentType: 'html' | 'json' | 'text' | 'error';\n  qualityScore: number;\n  requiresJS: boolean;\n  suggestedAction?: string;\n  issues?: string[];\n  error?: string;\n}\n\nexport const webFetch: ToolFunction<WebFetchArgs, WebFetchResult> = {\n  definition: {\n    type: 'function',\n    function: {\n      name: 'web_fetch',\n      description: `Fetch and extract text content from a web page URL.\n\nIMPORTANT: This tool performs a simple HTTP fetch and HTML parsing. It works well for:\n- Static websites (blogs, documentation, articles)\n- Server-rendered HTML pages\n- Content that doesn't require JavaScript\n\nLIMITATIONS:\n- Cannot execute JavaScript\n- May fail on React/Vue/Angular sites (will return low quality score)\n- May get blocked by bot protection\n- Cannot handle dynamic content loading\n\nQUALITY DETECTION:\nThe tool analyzes the fetched content and returns a quality score (0-100):\n- 80-100: Excellent quality, content extracted successfully\n- 50-79: Moderate quality, some content extracted\n- 0-49: Low quality, likely needs JavaScript or has errors\n\nIf the quality score is low or requiresJS is true, the tool will suggest using 'web_fetch_js' instead.\n\nRETURNS:\n{\n  success: boolean,\n  url: string,\n  title: string,\n  content: string,          // Extracted text (clean, no scripts/styles)\n  html: string,             // Raw HTML\n  contentType: string,      // 'html' | 'json' | 'text' | 'error'\n  qualityScore: number,     // 0-100 (quality of extraction)\n  requiresJS: boolean,      // True if site likely needs JavaScript\n  suggestedAction: string,  // Suggestion if quality is low\n  issues: string[],         // List of detected issues\n  error: string             // Error message if failed\n}\n\nEXAMPLE:\nTo fetch a blog post:\n{\n  url: \"https://example.com/blog/article\"\n}\n\nWith custom user agent:\n{\n  url: \"https://example.com/page\",\n  userAgent: \"Mozilla/5.0 (Windows NT 10.0; Win64; x64)...\",\n  timeout: 15000\n}`,\n\n      parameters: {\n        type: 'object',\n        properties: {\n          url: {\n            type: 'string',\n            description: 'The URL to fetch. Must start with http:// or https://',\n          },\n          userAgent: {\n            type: 'string',\n            description: 'Optional custom user agent string. Default is a generic bot user agent.',\n          },\n          timeout: {\n            type: 'number',\n            description: 'Timeout in milliseconds (default: 10000)',\n          },\n        },\n        required: ['url'],\n      },\n    },\n    blocking: true,\n    timeout: 15000,\n  },\n\n  execute: async (args: WebFetchArgs): Promise<WebFetchResult> => {\n    try {\n      // Validate URL\n      try {\n        new URL(args.url);\n      } catch {\n        return {\n          success: false,\n          url: args.url,\n          title: '',\n          content: '',\n          html: '',\n          contentType: 'error',\n          qualityScore: 0,\n          requiresJS: false,\n          error: 'Invalid URL format',\n        };\n      }\n\n      // Fetch with timeout\n      const controller = new AbortController();\n      const timeoutId = setTimeout(() => controller.abort(), args.timeout || 10000);\n\n      const response = await fetch(args.url, {\n        headers: {\n          'User-Agent':\n            args.userAgent ||\n            'Mozilla/5.0 (compatible; OneRingAI/1.0; +https://github.com/oneringai/agents)',\n          Accept: 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',\n          'Accept-Language': 'en-US,en;q=0.9',\n        },\n        signal: controller.signal,\n      });\n\n      clearTimeout(timeoutId);\n\n      // Check response status\n      if (!response.ok) {\n        return {\n          success: false,\n          url: args.url,\n          title: '',\n          content: '',\n          html: '',\n          contentType: 'error',\n          qualityScore: 0,\n          requiresJS: false,\n          error: `HTTP ${response.status}: ${response.statusText}`,\n        };\n      }\n\n      // Get content type\n      const contentType = response.headers.get('content-type') || '';\n\n      // Handle JSON responses\n      if (contentType.includes('application/json')) {\n        const json = await response.json();\n        return {\n          success: true,\n          url: args.url,\n          title: 'JSON Response',\n          content: JSON.stringify(json, null, 2),\n          html: '',\n          contentType: 'json',\n          qualityScore: 100,\n          requiresJS: false,\n        };\n      }\n\n      // Handle plain text\n      if (contentType.includes('text/plain')) {\n        const text = await response.text();\n        return {\n          success: true,\n          url: args.url,\n          title: 'Text Response',\n          content: text,\n          html: text,\n          contentType: 'text',\n          qualityScore: 100,\n          requiresJS: false,\n        };\n      }\n\n      // Get HTML\n      const html = await response.text();\n\n      // Parse with cheerio\n      const $ = load(html);\n\n      // Extract title\n      const title = $('title').text() || $('h1').first().text() || 'Untitled';\n\n      // Extract clean text content\n      const content = extractCleanText($);\n\n      // Detect content quality\n      const quality = detectContentQuality(html, content, $);\n\n      return {\n        success: true,\n        url: args.url,\n        title,\n        content,\n        html,\n        contentType: 'html',\n        qualityScore: quality.score,\n        requiresJS: quality.requiresJS,\n        suggestedAction: quality.suggestion,\n        issues: quality.issues,\n      };\n    } catch (error: any) {\n      // Handle abort errors specially\n      if (error.name === 'AbortError') {\n        return {\n          success: false,\n          url: args.url,\n          title: '',\n          content: '',\n          html: '',\n          contentType: 'error',\n          qualityScore: 0,\n          requiresJS: false,\n          error: `Request timeout after ${args.timeout || 10000}ms`,\n        };\n      }\n\n      return {\n        success: false,\n        url: args.url,\n        title: '',\n        content: '',\n        html: '',\n        contentType: 'error',\n        qualityScore: 0,\n        requiresJS: false,\n        error: (error as Error).message,\n      };\n    }\n  },\n};\n","/**\n * Web Fetch with JavaScript - Uses Puppeteer for JS-rendered sites\n * Optional tool - requires puppeteer to be installed\n */\n\nimport { load } from 'cheerio';\nimport { ToolFunction } from '../../domain/entities/Tool.js';\n\n// Lazy-load Puppeteer (optional dependency)\nlet puppeteerModule: any = null;\nlet browserInstance: any = null;\n\ninterface WebFetchJSArgs {\n  url: string;\n  waitForSelector?: string;\n  timeout?: number;\n  takeScreenshot?: boolean;\n}\n\ninterface WebFetchJSResult {\n  success: boolean;\n  url: string;\n  title: string;\n  content: string;\n  html: string;\n  screenshot?: string;\n  loadTime: number;\n  error?: string;\n  suggestion?: string;\n}\n\n/**\n * Load Puppeteer dynamically (only when needed)\n */\nasync function loadPuppeteer(): Promise<any> {\n  if (!puppeteerModule) {\n    try {\n      puppeteerModule = await import('puppeteer');\n    } catch (error) {\n      throw new Error('Puppeteer not installed');\n    }\n  }\n  return puppeteerModule;\n}\n\n/**\n * Get or create browser instance (reuse for performance)\n */\nasync function getBrowser(): Promise<any> {\n  if (!browserInstance) {\n    const puppeteer = await loadPuppeteer();\n\n    browserInstance = await puppeteer.launch({\n      headless: true,\n      args: ['--no-sandbox', '--disable-setuid-sandbox', '--disable-dev-shm-usage'],\n    });\n\n    // Cleanup on process exit\n    process.on('exit', async () => {\n      if (browserInstance) {\n        await browserInstance.close();\n      }\n    });\n  }\n  return browserInstance;\n}\n\nexport const webFetchJS: ToolFunction<WebFetchJSArgs, WebFetchJSResult> = {\n  definition: {\n    type: 'function',\n    function: {\n      name: 'web_fetch_js',\n      description: `Fetch and extract content from JavaScript-rendered websites using a headless browser (Puppeteer).\n\nUSE THIS TOOL WHEN:\n- The web_fetch tool returned a low quality score (<50)\n- The web_fetch tool suggested using JavaScript rendering\n- You know the website is built with React/Vue/Angular/Next.js\n- Content loads dynamically via JavaScript\n- The page requires interaction (though this tool doesn't support interaction yet)\n\nHOW IT WORKS:\n- Launches a headless Chrome browser\n- Navigates to the URL\n- Waits for JavaScript to execute and content to load\n- Extracts the rendered HTML and text content\n- Optionally captures a screenshot\n\nCAPABILITIES:\n- Executes all JavaScript on the page\n- Waits for network to be idle (all resources loaded)\n- Can wait for specific CSS selectors to appear\n- Handles React, Vue, Angular, Next.js, and other SPAs\n- Returns content after full JavaScript execution\n\nLIMITATIONS:\n- Slower than web_fetch (typically 3-10 seconds vs <1 second)\n- Uses more system resources (runs a full browser)\n- May still fail on sites with aggressive bot detection\n- Requires puppeteer to be installed (npm install puppeteer)\n\nPERFORMANCE:\n- First call: Slower (launches browser ~1-2s)\n- Subsequent calls: Faster (reuses browser instance)\n\nRETURNS:\n{\n  success: boolean,\n  url: string,\n  title: string,\n  content: string,         // Extracted text after JS execution\n  html: string,            // Full HTML after JS execution\n  screenshot: string,      // Base64 PNG screenshot (if requested)\n  loadTime: number,        // Time taken in milliseconds\n  error: string           // Error message if failed\n}\n\nEXAMPLES:\nBasic usage:\n{\n  url: \"https://react-app.com/page\"\n}\n\nWait for specific content:\n{\n  url: \"https://app.com/dashboard\",\n  waitForSelector: \"#main-content\",  // Wait for this element\n  timeout: 20000\n}\n\nWith screenshot:\n{\n  url: \"https://site.com\",\n  takeScreenshot: true\n}`,\n\n      parameters: {\n        type: 'object',\n        properties: {\n          url: {\n            type: 'string',\n            description: 'The URL to fetch. Must start with http:// or https://',\n          },\n          waitForSelector: {\n            type: 'string',\n            description:\n              'Optional CSS selector to wait for before extracting content. Example: \"#main-content\" or \".article-body\"',\n          },\n          timeout: {\n            type: 'number',\n            description: 'Max wait time in milliseconds (default: 15000)',\n          },\n          takeScreenshot: {\n            type: 'boolean',\n            description:\n              'Whether to capture a screenshot of the page (default: false). Screenshot returned as base64 PNG.',\n          },\n        },\n        required: ['url'],\n      },\n    },\n    blocking: true,\n    timeout: 30000, // Allow extra time for browser operations\n  },\n\n  execute: async (args: WebFetchJSArgs): Promise<WebFetchJSResult> => {\n    let page: any = null;\n\n    try {\n      // Try to get browser (will throw if Puppeteer not installed)\n      const browser = await getBrowser();\n      page = await browser.newPage();\n\n      // Set viewport\n      await page.setViewport({ width: 1280, height: 800 });\n\n      // Set user agent\n      await page.setUserAgent(\n        'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36'\n      );\n\n      const startTime = Date.now();\n\n      // Navigate to URL\n      await page.goto(args.url, {\n        waitUntil: 'networkidle2', // Wait until network is mostly idle\n        timeout: args.timeout || 15000,\n      });\n\n      // Wait for selector if provided\n      if (args.waitForSelector) {\n        await page.waitForSelector(args.waitForSelector, {\n          timeout: args.timeout || 15000,\n        });\n      }\n\n      // Get HTML after JS execution\n      const html = await page.content();\n\n      // Extract text content using cheerio\n      const $ = load(html);\n\n      // Remove unwanted elements\n      $('script, style, noscript, iframe, nav, footer, header, aside').remove();\n\n      // Extract text\n      const content = $('body').text().trim();\n\n      // Get title\n      const title = await page.title();\n\n      const loadTime = Date.now() - startTime;\n\n      // Take screenshot if requested\n      let screenshot: string | undefined;\n      if (args.takeScreenshot) {\n        const buffer = await page.screenshot({\n          type: 'png',\n          fullPage: false, // Just viewport\n        });\n        screenshot = buffer.toString('base64');\n      }\n\n      await page.close();\n\n      return {\n        success: true,\n        url: args.url,\n        title,\n        content,\n        html,\n        screenshot,\n        loadTime,\n      };\n    } catch (error: any) {\n      if (page) {\n        try {\n          await page.close();\n        } catch {\n          // Ignore close errors\n        }\n      }\n\n      // Check if it's a Puppeteer not installed error\n      if ((error as Error).message === 'Puppeteer not installed') {\n        return {\n          success: false,\n          url: args.url,\n          title: '',\n          content: '',\n          html: '',\n          loadTime: 0,\n          error: 'Puppeteer is not installed',\n          suggestion:\n            'Install Puppeteer with: npm install puppeteer (note: downloads ~50MB Chrome binary)',\n        };\n      }\n\n      return {\n        success: false,\n        url: args.url,\n        title: '',\n        content: '',\n        html: '',\n        loadTime: 0,\n        error: (error as Error).message,\n      };\n    }\n  },\n};\n","/**\n * Serper.dev search provider\n * Fast Google search results via API\n */\n\nexport interface SearchResult {\n  title: string;\n  url: string;\n  snippet: string;\n  position: number;\n}\n\nexport async function searchWithSerper(\n  query: string,\n  numResults: number,\n  apiKey: string\n): Promise<SearchResult[]> {\n  const response = await fetch('https://google.serper.dev/search', {\n    method: 'POST',\n    headers: {\n      'X-API-KEY': apiKey,\n      'Content-Type': 'application/json',\n    },\n    body: JSON.stringify({\n      q: query,\n      num: numResults,\n    }),\n  });\n\n  if (!response.ok) {\n    throw new Error(`Serper API error: ${response.status} ${response.statusText}`);\n  }\n\n  const data: any = await response.json();\n\n  if (!data.organic || !Array.isArray(data.organic)) {\n    throw new Error('Invalid response from Serper API');\n  }\n\n  return data.organic.slice(0, numResults).map((result: any, index: number) => ({\n    title: result.title || 'Untitled',\n    url: result.link || '',\n    snippet: result.snippet || '',\n    position: index + 1,\n  }));\n}\n","/**\n * Brave Search API provider\n * Independent search index (privacy-focused)\n */\n\nimport type { SearchResult } from './serper.js';\n\nexport async function searchWithBrave(\n  query: string,\n  numResults: number,\n  apiKey: string\n): Promise<SearchResult[]> {\n  const url = `https://api.search.brave.com/res/v1/web/search?q=${encodeURIComponent(query)}&count=${numResults}`;\n\n  const response = await fetch(url, {\n    headers: {\n      'X-Subscription-Token': apiKey,\n      Accept: 'application/json',\n    },\n  });\n\n  if (!response.ok) {\n    throw new Error(`Brave API error: ${response.status} ${response.statusText}`);\n  }\n\n  const data: any = await response.json();\n\n  if (!data.web?.results || !Array.isArray(data.web.results)) {\n    throw new Error('Invalid response from Brave API');\n  }\n\n  return data.web.results.slice(0, numResults).map((result: any, index: number) => ({\n    title: result.title || 'Untitled',\n    url: result.url || '',\n    snippet: result.description || '',\n    position: index + 1,\n  }));\n}\n","/**\n * Tavily AI Search provider\n * AI-optimized search results with summaries\n */\n\nimport type { SearchResult } from './serper.js';\n\nexport async function searchWithTavily(\n  query: string,\n  numResults: number,\n  apiKey: string\n): Promise<SearchResult[]> {\n  const response = await fetch('https://api.tavily.com/search', {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n    },\n    body: JSON.stringify({\n      api_key: apiKey,\n      query,\n      max_results: numResults,\n      search_depth: 'basic', // 'basic' or 'advanced'\n      include_answer: false,\n      include_raw_content: false,\n    }),\n  });\n\n  if (!response.ok) {\n    throw new Error(`Tavily API error: ${response.status} ${response.statusText}`);\n  }\n\n  const data: any = await response.json();\n\n  if (!data.results || !Array.isArray(data.results)) {\n    throw new Error('Invalid response from Tavily API');\n  }\n\n  return data.results.slice(0, numResults).map((result: any, index: number) => ({\n    title: result.title || 'Untitled',\n    url: result.url || '',\n    snippet: result.content || '',\n    position: index + 1,\n  }));\n}\n","/**\n * Web Search Tool - Multi-provider web search\n * Supports Serper.dev (default), Brave, and Tavily\n */\n\nimport { ToolFunction } from '../../domain/entities/Tool.js';\nimport { searchWithSerper, type SearchResult } from './searchProviders/serper.js';\nimport { searchWithBrave } from './searchProviders/brave.js';\nimport { searchWithTavily } from './searchProviders/tavily.js';\n\ninterface WebSearchArgs {\n  query: string;\n  numResults?: number;\n  provider?: 'serper' | 'brave' | 'tavily';\n}\n\ninterface WebSearchResult {\n  success: boolean;\n  query: string;\n  provider: string;\n  results: SearchResult[];\n  count: number;\n  error?: string;\n}\n\nexport const webSearch: ToolFunction<WebSearchArgs, WebSearchResult> = {\n  definition: {\n    type: 'function',\n    function: {\n      name: 'web_search',\n      description: `Search the web and get relevant results with snippets.\n\nThis tool searches the web using a configured search provider.\n\nSEARCH PROVIDERS:\n- serper (default): Google search results via Serper.dev API. Fast (1-2s), 2,500 free queries.\n- brave: Brave's independent search index. Privacy-focused, no Google.\n- tavily: AI-optimized search with summaries tailored for LLMs.\n\nRETURNS:\nAn array of up to 10-20 search results, each containing:\n- title: Page title\n- url: Direct URL to the page\n- snippet: Short description/excerpt from the page\n- position: Search ranking position (1, 2, 3...)\n\nUSE CASES:\n- Find current information on any topic\n- Research multiple sources\n- Discover relevant websites\n- Get different perspectives on a topic\n- Find URLs to fetch with web_fetch tool\n\nWORKFLOW PATTERN:\n1. Use web_search to find relevant URLs\n2. Use web_fetch to get full content from top results\n3. Process and summarize the information\n\nEXAMPLE:\nBasic search:\n{\n  query: \"latest AI developments 2026\",\n  numResults: 5\n}\n\nWith specific provider:\n{\n  query: \"quantum computing news\",\n  numResults: 10,\n  provider: \"brave\"\n}\n\nIMPORTANT:\n- Requires API key to be set in environment variables\n- Default provider is \"serper\" (requires SERPER_API_KEY)\n- Returns empty results if API key not found`,\n\n      parameters: {\n        type: 'object',\n        properties: {\n          query: {\n            type: 'string',\n            description: 'The search query string. Be specific for better results.',\n          },\n          numResults: {\n            type: 'number',\n            description:\n              'Number of results to return (default: 10, max: 20). More results = more API cost.',\n          },\n          provider: {\n            type: 'string',\n            enum: ['serper', 'brave', 'tavily'],\n            description:\n              'Which search provider to use. Default is \"serper\". Each provider requires its own API key.',\n          },\n        },\n        required: ['query'],\n      },\n    },\n    blocking: true,\n    timeout: 10000,\n  },\n\n  execute: async (args: WebSearchArgs): Promise<WebSearchResult> => {\n    const provider = args.provider || 'serper';\n    const numResults = Math.min(args.numResults || 10, 20);\n\n    // Get API key from environment\n    const apiKey = getSearchAPIKey(provider);\n\n    if (!apiKey) {\n      return {\n        success: false,\n        query: args.query,\n        provider,\n        results: [],\n        count: 0,\n        error: `No API key found for ${provider}. Set ${getEnvVarName(provider)} in your .env file. See .env.example for details.`,\n      };\n    }\n\n    try {\n      let results: SearchResult[];\n\n      switch (provider) {\n        case 'serper':\n          results = await searchWithSerper(args.query, numResults, apiKey);\n          break;\n\n        case 'brave':\n          results = await searchWithBrave(args.query, numResults, apiKey);\n          break;\n\n        case 'tavily':\n          results = await searchWithTavily(args.query, numResults, apiKey);\n          break;\n\n        default:\n          throw new Error(`Unknown search provider: ${provider}`);\n      }\n\n      return {\n        success: true,\n        query: args.query,\n        provider,\n        results,\n        count: results.length,\n      };\n    } catch (error: any) {\n      return {\n        success: false,\n        query: args.query,\n        provider,\n        results: [],\n        count: 0,\n        error: (error as Error).message,\n      };\n    }\n  },\n};\n\n/**\n * Get search API key from environment\n */\nfunction getSearchAPIKey(provider: string): string | undefined {\n  switch (provider) {\n    case 'serper':\n      return process.env.SERPER_API_KEY;\n    case 'brave':\n      return process.env.BRAVE_API_KEY;\n    case 'tavily':\n      return process.env.TAVILY_API_KEY;\n    default:\n      return undefined;\n  }\n}\n\n/**\n * Get environment variable name for provider\n */\nfunction getEnvVarName(provider: string): string {\n  switch (provider) {\n    case 'serper':\n      return 'SERPER_API_KEY';\n    case 'brave':\n      return 'BRAVE_API_KEY';\n    case 'tavily':\n      return 'TAVILY_API_KEY';\n    default:\n      return 'UNKNOWN_API_KEY';\n  }\n}\n","/**\n * Encryption utilities for OAuth tokens\n * Uses AES-256-GCM for secure token storage\n */\n\nimport * as crypto from 'crypto';\n\nconst ALGORITHM = 'aes-256-gcm';\nconst IV_LENGTH = 16;\nconst SALT_LENGTH = 64;\nconst TAG_LENGTH = 16;\nconst KEY_LENGTH = 32;\n\n/**\n * Encrypt data using AES-256-GCM with PBKDF2 key derivation\n *\n * @param text - Plaintext to encrypt\n * @param password - Encryption key/password\n * @returns Base64-encoded encrypted data\n */\nexport function encrypt(text: string, password: string): string {\n  // Generate random salt\n  const salt = crypto.randomBytes(SALT_LENGTH);\n\n  // Derive key from password using PBKDF2\n  const key = crypto.pbkdf2Sync(password, salt, 100000, KEY_LENGTH, 'sha512');\n\n  // Generate random IV\n  const iv = crypto.randomBytes(IV_LENGTH);\n\n  // Create cipher\n  const cipher = crypto.createCipheriv(ALGORITHM, key, iv);\n\n  // Encrypt\n  let encrypted = cipher.update(text, 'utf8', 'hex');\n  encrypted += cipher.final('hex');\n\n  // Get authentication tag\n  const tag = cipher.getAuthTag();\n\n  // Combine: salt + iv + tag + encrypted\n  const result = Buffer.concat([salt, iv, tag, Buffer.from(encrypted, 'hex')]);\n\n  // Return as base64\n  return result.toString('base64');\n}\n\n/**\n * Decrypt data using AES-256-GCM\n *\n * @param encryptedData - Base64-encoded encrypted data\n * @param password - Encryption key/password\n * @returns Decrypted plaintext\n */\nexport function decrypt(encryptedData: string, password: string): string {\n  const buffer = Buffer.from(encryptedData, 'base64');\n\n  // Extract components\n  const salt = buffer.subarray(0, SALT_LENGTH);\n  const iv = buffer.subarray(SALT_LENGTH, SALT_LENGTH + IV_LENGTH);\n  const tag = buffer.subarray(SALT_LENGTH + IV_LENGTH, SALT_LENGTH + IV_LENGTH + TAG_LENGTH);\n  const encrypted = buffer.subarray(SALT_LENGTH + IV_LENGTH + TAG_LENGTH);\n\n  // Derive key from password\n  const key = crypto.pbkdf2Sync(password, salt, 100000, KEY_LENGTH, 'sha512');\n\n  // Create decipher\n  const decipher = crypto.createDecipheriv(ALGORITHM, key, iv);\n  decipher.setAuthTag(tag);\n\n  // Decrypt\n  let decrypted = decipher.update(encrypted);\n  decrypted = Buffer.concat([decrypted, decipher.final()]);\n\n  return decrypted.toString('utf8');\n}\n\n/**\n * Get encryption key from environment or generate temporary one\n *\n * For production, always set OAUTH_ENCRYPTION_KEY environment variable!\n */\nexport function getEncryptionKey(): string {\n  // Use environment variable if available (RECOMMENDED)\n  if (process.env.OAUTH_ENCRYPTION_KEY) {\n    return process.env.OAUTH_ENCRYPTION_KEY;\n  }\n\n  // For in-memory storage: use process-specific key (not persistent across restarts)\n  // This is acceptable for MemoryStorage but NOT for FileStorage or DatabaseStorage!\n  if (!(global as any).__oauthEncryptionKey) {\n    (global as any).__oauthEncryptionKey = crypto.randomBytes(32).toString('hex');\n\n    console.warn(\n      'WARNING: Using auto-generated encryption key. Tokens will not persist across restarts. ' +\n        'Set OAUTH_ENCRYPTION_KEY environment variable for production!'\n    );\n  }\n\n  return (global as any).__oauthEncryptionKey;\n}\n\n/**\n * Generate a secure random encryption key\n * Use this to generate OAUTH_ENCRYPTION_KEY for your .env file\n */\nexport function generateEncryptionKey(): string {\n  return crypto.randomBytes(32).toString('hex');\n}\n","/**\n * In-memory token storage (default)\n * Tokens are encrypted in memory using AES-256-GCM\n */\n\nimport { ITokenStorage, StoredToken } from '../../domain/ITokenStorage.js';\nimport { encrypt, decrypt, getEncryptionKey } from '../../utils/encryption.js';\n\nexport class MemoryStorage implements ITokenStorage {\n  private tokens: Map<string, string> = new Map(); // Stores encrypted tokens\n\n  async storeToken(key: string, token: StoredToken): Promise<void> {\n    const encryptionKey = getEncryptionKey();\n    const plaintext = JSON.stringify(token);\n    const encrypted = encrypt(plaintext, encryptionKey);\n\n    this.tokens.set(key, encrypted);\n  }\n\n  async getToken(key: string): Promise<StoredToken | null> {\n    const encrypted = this.tokens.get(key);\n    if (!encrypted) {\n      return null;\n    }\n\n    try {\n      const encryptionKey = getEncryptionKey();\n      const decrypted = decrypt(encrypted, encryptionKey);\n      return JSON.parse(decrypted) as StoredToken;\n    } catch (error) {\n      console.error('Failed to decrypt token from memory:', error);\n      // Remove corrupted token\n      this.tokens.delete(key);\n      return null;\n    }\n  }\n\n  async deleteToken(key: string): Promise<void> {\n    this.tokens.delete(key);\n  }\n\n  async hasToken(key: string): Promise<boolean> {\n    return this.tokens.has(key);\n  }\n\n  /**\n   * Clear all tokens (useful for testing)\n   */\n  clearAll(): void {\n    this.tokens.clear();\n  }\n\n  /**\n   * Get number of stored tokens\n   */\n  size(): number {\n    return this.tokens.size;\n  }\n}\n","/**\n * Token Store (Domain Layer)\n * Manages token lifecycle using pluggable storage backend\n */\n\nimport { ITokenStorage, StoredToken } from './ITokenStorage.js';\nimport { MemoryStorage } from '../infrastructure/storage/MemoryStorage.js';\n\nexport class TokenStore {\n  private storage: ITokenStorage;\n  private baseStorageKey: string;\n\n  constructor(storageKey: string = 'default', storage?: ITokenStorage) {\n    this.baseStorageKey = storageKey;\n    // Default to in-memory storage (encrypted)\n    this.storage = storage || new MemoryStorage();\n  }\n\n  /**\n   * Get user-scoped storage key\n   * For multi-user support, keys are scoped per user: \"provider:userId\"\n   * For single-user (backward compatible), userId is omitted or \"default\"\n   *\n   * @param userId - User identifier (optional, defaults to single-user mode)\n   * @returns Storage key scoped to user\n   */\n  private getScopedKey(userId?: string): string {\n    if (!userId || userId === 'default') {\n      // Single-user mode (backward compatible)\n      return this.baseStorageKey;\n    }\n    // Multi-user mode: scope by userId\n    return `${this.baseStorageKey}:${userId}`;\n  }\n\n  /**\n   * Store token (encrypted by storage layer)\n   * @param tokenResponse - Token response from OAuth provider\n   * @param userId - Optional user identifier for multi-user support\n   */\n  async storeToken(tokenResponse: any, userId?: string): Promise<void> {\n    const token: StoredToken = {\n      access_token: tokenResponse.access_token,\n      refresh_token: tokenResponse.refresh_token,\n      expires_in: tokenResponse.expires_in || 3600,\n      token_type: tokenResponse.token_type || 'Bearer',\n      scope: tokenResponse.scope,\n      obtained_at: Date.now(),\n    };\n\n    const key = this.getScopedKey(userId);\n    await this.storage.storeToken(key, token);\n  }\n\n  /**\n   * Get access token\n   * @param userId - Optional user identifier for multi-user support\n   */\n  async getAccessToken(userId?: string): Promise<string> {\n    const key = this.getScopedKey(userId);\n    const token = await this.storage.getToken(key);\n    if (!token) {\n      throw new Error(`No token stored for ${userId ? `user: ${userId}` : 'default user'}`);\n    }\n    return token.access_token;\n  }\n\n  /**\n   * Get refresh token\n   * @param userId - Optional user identifier for multi-user support\n   */\n  async getRefreshToken(userId?: string): Promise<string> {\n    const key = this.getScopedKey(userId);\n    const token = await this.storage.getToken(key);\n    if (!token?.refresh_token) {\n      throw new Error(`No refresh token available for ${userId ? `user: ${userId}` : 'default user'}`);\n    }\n    return token.refresh_token;\n  }\n\n  /**\n   * Check if has refresh token\n   * @param userId - Optional user identifier for multi-user support\n   */\n  async hasRefreshToken(userId?: string): Promise<boolean> {\n    const key = this.getScopedKey(userId);\n    const token = await this.storage.getToken(key);\n    return !!token?.refresh_token;\n  }\n\n  /**\n   * Check if token is valid (not expired)\n   *\n   * @param bufferSeconds - Refresh this many seconds before expiry (default: 300 = 5 min)\n   * @param userId - Optional user identifier for multi-user support\n   */\n  async isValid(bufferSeconds: number = 300, userId?: string): Promise<boolean> {\n    const key = this.getScopedKey(userId);\n    const token = await this.storage.getToken(key);\n    if (!token) {\n      return false;\n    }\n\n    const expiresAt = token.obtained_at + token.expires_in * 1000;\n    const bufferMs = bufferSeconds * 1000;\n\n    return Date.now() < expiresAt - bufferMs;\n  }\n\n  /**\n   * Clear stored token\n   * @param userId - Optional user identifier for multi-user support\n   */\n  async clear(userId?: string): Promise<void> {\n    const key = this.getScopedKey(userId);\n    await this.storage.deleteToken(key);\n  }\n\n  /**\n   * Get full token info\n   * @param userId - Optional user identifier for multi-user support\n   */\n  async getTokenInfo(userId?: string): Promise<StoredToken | null> {\n    const key = this.getScopedKey(userId);\n    return this.storage.getToken(key);\n  }\n}\n","/**\n * PKCE (Proof Key for Code Exchange) utilities\n * RFC 7636 - https://tools.ietf.org/html/rfc7636\n */\n\nimport * as crypto from 'crypto';\n\nexport interface PKCEPair {\n  codeVerifier: string;\n  codeChallenge: string;\n}\n\n/**\n * Generate PKCE code verifier and challenge pair\n *\n * code_challenge = BASE64URL(SHA256(code_verifier))\n */\nexport function generatePKCE(): PKCEPair {\n  // Generate random code verifier (43-128 characters as per RFC)\n  const codeVerifier = base64URLEncode(crypto.randomBytes(32));\n\n  // Create code challenge = BASE64URL(SHA256(code_verifier))\n  const hash = crypto.createHash('sha256').update(codeVerifier).digest();\n  const codeChallenge = base64URLEncode(hash);\n\n  return {\n    codeVerifier,\n    codeChallenge,\n  };\n}\n\n/**\n * Base64 URL encode (RFC 4648 Section 5)\n * Used for PKCE code_verifier and code_challenge\n */\nfunction base64URLEncode(buffer: Buffer): string {\n  return buffer\n    .toString('base64')\n    .replace(/\\+/g, '-') // Replace + with -\n    .replace(/\\//g, '_') // Replace / with _\n    .replace(/=/g, ''); // Remove padding\n}\n\n/**\n * Generate random state for CSRF protection\n */\nexport function generateState(): string {\n  return crypto.randomBytes(16).toString('hex');\n}\n","/**\n * OAuth 2.0 Authorization Code Flow with PKCE (RFC 7636)\n * User authentication for web and mobile apps\n */\n\nimport * as crypto from 'crypto';\nimport { TokenStore } from '../domain/TokenStore.js';\nimport { generatePKCE, generateState } from '../utils/pkce.js';\nimport type { OAuthConfig } from '../types.js';\n\nexport class AuthCodePKCEFlow {\n  private tokenStore: TokenStore;\n  // Store PKCE data per user\n  private codeVerifiers: Map<string, string> = new Map();\n  private states: Map<string, string> = new Map();\n\n  constructor(private config: OAuthConfig) {\n    const storageKey = config.storageKey || `auth_code:${config.clientId}`;\n    this.tokenStore = new TokenStore(storageKey, config.storage);\n  }\n\n  /**\n   * Generate authorization URL for user to visit\n   * Opens browser or redirects user to this URL\n   *\n   * @param userId - User identifier for multi-user support (optional)\n   */\n  async getAuthorizationUrl(userId?: string): Promise<string> {\n    if (!this.config.authorizationUrl) {\n      throw new Error('authorizationUrl is required for authorization_code flow');\n    }\n\n    if (!this.config.redirectUri) {\n      throw new Error('redirectUri is required for authorization_code flow');\n    }\n\n    const userKey = userId || 'default';\n\n    // Generate PKCE pair\n    const { codeVerifier, codeChallenge } = generatePKCE();\n    this.codeVerifiers.set(userKey, codeVerifier);\n\n    // Generate state for CSRF protection\n    const state = generateState();\n    this.states.set(userKey, state);\n\n    // Build authorization URL\n    const params = new URLSearchParams({\n      response_type: 'code',\n      client_id: this.config.clientId,\n      redirect_uri: this.config.redirectUri,\n      state,\n    });\n\n    // Add scope if provided\n    if (this.config.scope) {\n      params.append('scope', this.config.scope);\n    }\n\n    // Add PKCE parameters (if enabled, default true)\n    if (this.config.usePKCE !== false) {\n      params.append('code_challenge', codeChallenge);\n      params.append('code_challenge_method', 'S256');\n    }\n\n    // Add user_id as state metadata (encode in state for retrieval in callback)\n    // The state will be: `{random_state}::{userId}`\n    const stateWithUser = userId ? `${state}::${userId}` : state;\n    params.set('state', stateWithUser);\n\n    return `${this.config.authorizationUrl}?${params.toString()}`;\n  }\n\n  /**\n   * Exchange authorization code for access token\n   *\n   * @param code - Authorization code from callback\n   * @param state - State parameter from callback (for CSRF verification, may include userId)\n   * @param userId - User identifier (optional, can be extracted from state)\n   */\n  async exchangeCode(code: string, state: string, userId?: string): Promise<void> {\n    // Extract userId from state if embedded\n    let actualState = state;\n    let actualUserId = userId;\n\n    if (state.includes('::')) {\n      const parts = state.split('::');\n      actualState = parts[0]!;\n      actualUserId = parts[1];\n    }\n\n    const userKey = actualUserId || 'default';\n\n    // Verify state to prevent CSRF attacks\n    const expectedState = this.states.get(userKey);\n    if (actualState !== expectedState) {\n      throw new Error(`State mismatch for user ${actualUserId} - possible CSRF attack. Expected: ${expectedState}, Got: ${actualState}`);\n    }\n\n    if (!this.config.redirectUri) {\n      throw new Error('redirectUri is required');\n    }\n\n    // Build token request\n    const params = new URLSearchParams({\n      grant_type: 'authorization_code',\n      code,\n      redirect_uri: this.config.redirectUri,\n      client_id: this.config.clientId,\n    });\n\n    // Add client secret if provided (confidential clients)\n    if (this.config.clientSecret) {\n      params.append('client_secret', this.config.clientSecret);\n    }\n\n    // Add code_verifier if PKCE was used\n    const codeVerifier = this.codeVerifiers.get(userKey);\n    if (this.config.usePKCE !== false && codeVerifier) {\n      params.append('code_verifier', codeVerifier);\n    }\n\n    const response = await fetch(this.config.tokenUrl, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n      },\n      body: params,\n    });\n\n    if (!response.ok) {\n      const error = await response.text();\n      throw new Error(`Token exchange failed: ${response.status} ${response.statusText} - ${error}`);\n    }\n\n    const data: any = await response.json();\n\n    // Store token (encrypted) with user scoping\n    await this.tokenStore.storeToken(data, actualUserId);\n\n    // Clear PKCE data (one-time use)\n    this.codeVerifiers.delete(userKey);\n    this.states.delete(userKey);\n  }\n\n  /**\n   * Get valid token (auto-refreshes if needed)\n   * @param userId - User identifier for multi-user support\n   */\n  async getToken(userId?: string): Promise<string> {\n    // Return cached token if valid\n    if (await this.tokenStore.isValid(this.config.refreshBeforeExpiry, userId)) {\n      return this.tokenStore.getAccessToken(userId);\n    }\n\n    // Try to refresh if we have a refresh token\n    if (await this.tokenStore.hasRefreshToken(userId)) {\n      return this.refreshToken(userId);\n    }\n\n    // No valid token and can't refresh\n    throw new Error(`No valid token available for ${userId ? `user: ${userId}` : 'default user'}. User needs to authorize (call startAuthFlow).`);\n  }\n\n  /**\n   * Refresh access token using refresh token\n   * @param userId - User identifier for multi-user support\n   */\n  async refreshToken(userId?: string): Promise<string> {\n    const refreshToken = await this.tokenStore.getRefreshToken(userId);\n\n    const params = new URLSearchParams({\n      grant_type: 'refresh_token',\n      refresh_token: refreshToken,\n      client_id: this.config.clientId,\n    });\n\n    // Add client secret if provided\n    if (this.config.clientSecret) {\n      params.append('client_secret', this.config.clientSecret);\n    }\n\n    const response = await fetch(this.config.tokenUrl, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n      },\n      body: params,\n    });\n\n    if (!response.ok) {\n      const error = await response.text();\n      throw new Error(`Token refresh failed: ${response.status} ${response.statusText} - ${error}`);\n    }\n\n    const data: any = await response.json();\n\n    // Store new token with user scoping\n    await this.tokenStore.storeToken(data, userId);\n\n    return data.access_token;\n  }\n\n  /**\n   * Check if token is valid\n   * @param userId - User identifier for multi-user support\n   */\n  async isTokenValid(userId?: string): Promise<boolean> {\n    return this.tokenStore.isValid(this.config.refreshBeforeExpiry, userId);\n  }\n\n  /**\n   * Revoke token (if supported by provider)\n   * @param revocationUrl - Optional revocation endpoint\n   * @param userId - User identifier for multi-user support\n   */\n  async revokeToken(revocationUrl?: string, userId?: string): Promise<void> {\n    if (!revocationUrl) {\n      // Just clear from storage\n      await this.tokenStore.clear(userId);\n      return;\n    }\n\n    try {\n      const token = await this.tokenStore.getAccessToken(userId);\n\n      await fetch(revocationUrl, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/x-www-form-urlencoded',\n        },\n        body: new URLSearchParams({\n          token,\n          client_id: this.config.clientId,\n        }),\n      });\n    } finally {\n      // Always clear from storage\n      await this.tokenStore.clear(userId);\n    }\n  }\n}\n","/**\n * OAuth 2.0 Client Credentials Flow\n * Machine-to-machine authentication\n */\n\nimport { TokenStore } from '../domain/TokenStore.js';\nimport type { OAuthConfig } from '../types.js';\n\nexport class ClientCredentialsFlow {\n  private tokenStore: TokenStore;\n\n  constructor(private config: OAuthConfig) {\n    const storageKey = config.storageKey || `client_credentials:${config.clientId}`;\n    this.tokenStore = new TokenStore(storageKey, config.storage);\n  }\n\n  /**\n   * Get token using client credentials\n   */\n  async getToken(): Promise<string> {\n    // Return cached token if valid\n    if (await this.tokenStore.isValid(this.config.refreshBeforeExpiry)) {\n      return this.tokenStore.getAccessToken();\n    }\n\n    // Request new token\n    return this.requestToken();\n  }\n\n  /**\n   * Request a new token from the authorization server\n   */\n  private async requestToken(): Promise<string> {\n    // Create Basic Auth header\n    const auth = Buffer.from(`${this.config.clientId}:${this.config.clientSecret}`).toString(\n      'base64'\n    );\n\n    const params = new URLSearchParams({\n      grant_type: 'client_credentials',\n    });\n\n    // Add scope if provided\n    if (this.config.scope) {\n      params.append('scope', this.config.scope);\n    }\n\n    const response = await fetch(this.config.tokenUrl, {\n      method: 'POST',\n      headers: {\n        Authorization: `Basic ${auth}`,\n        'Content-Type': 'application/x-www-form-urlencoded',\n      },\n      body: params,\n    });\n\n    if (!response.ok) {\n      const error = await response.text();\n      throw new Error(`Token request failed: ${response.status} ${response.statusText} - ${error}`);\n    }\n\n    const data: any = await response.json();\n\n    // Store token (encrypted)\n    await this.tokenStore.storeToken(data);\n\n    return data.access_token;\n  }\n\n  /**\n   * Refresh token (client credentials don't use refresh tokens)\n   * Just requests a new token\n   */\n  async refreshToken(): Promise<string> {\n    await this.tokenStore.clear();\n    return this.requestToken();\n  }\n\n  /**\n   * Check if token is valid\n   */\n  async isTokenValid(): Promise<boolean> {\n    return this.tokenStore.isValid(this.config.refreshBeforeExpiry);\n  }\n}\n","/**\n * OAuth 2.0 JWT Bearer Flow (RFC 7523)\n * Service account authentication using private key signing\n */\n\nimport { SignJWT, importPKCS8 } from 'jose';\nimport * as fs from 'fs';\nimport { TokenStore } from '../domain/TokenStore.js';\nimport type { OAuthConfig } from '../types.js';\n\nexport class JWTBearerFlow {\n  private tokenStore: TokenStore;\n  private privateKey: string;\n\n  constructor(private config: OAuthConfig) {\n    const storageKey = config.storageKey || `jwt_bearer:${config.clientId}`;\n    this.tokenStore = new TokenStore(storageKey, config.storage);\n\n    // Load private key\n    if (config.privateKey) {\n      this.privateKey = config.privateKey;\n    } else if (config.privateKeyPath) {\n      try {\n        this.privateKey = fs.readFileSync(config.privateKeyPath, 'utf8');\n      } catch (error) {\n        throw new Error(`Failed to read private key from ${config.privateKeyPath}: ${(error as Error).message}`);\n      }\n    } else {\n      throw new Error('JWT Bearer flow requires privateKey or privateKeyPath');\n    }\n  }\n\n  /**\n   * Generate signed JWT assertion\n   */\n  private async generateJWT(): Promise<string> {\n    const now = Math.floor(Date.now() / 1000);\n    const alg = this.config.tokenSigningAlg || 'RS256';\n\n    // Parse private key\n    const key = await importPKCS8(this.privateKey, alg);\n\n    // Create JWT\n    const jwt = await new SignJWT({\n      scope: this.config.scope || '',\n    })\n      .setProtectedHeader({ alg })\n      .setIssuer(this.config.clientId)\n      .setSubject(this.config.clientId)\n      .setAudience(this.config.audience || this.config.tokenUrl)\n      .setIssuedAt(now)\n      .setExpirationTime(now + 3600) // 1 hour\n      .sign(key);\n\n    return jwt;\n  }\n\n  /**\n   * Get token using JWT Bearer assertion\n   */\n  async getToken(): Promise<string> {\n    // Return cached token if valid\n    if (await this.tokenStore.isValid(this.config.refreshBeforeExpiry)) {\n      return this.tokenStore.getAccessToken();\n    }\n\n    // Request new token\n    return this.requestToken();\n  }\n\n  /**\n   * Request token using JWT assertion\n   */\n  private async requestToken(): Promise<string> {\n    // Generate JWT assertion\n    const assertion = await this.generateJWT();\n\n    // Exchange JWT for access token\n    const params = new URLSearchParams({\n      grant_type: 'urn:ietf:params:oauth:grant-type:jwt-bearer',\n      assertion,\n    });\n\n    const response = await fetch(this.config.tokenUrl, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n      },\n      body: params,\n    });\n\n    if (!response.ok) {\n      const error = await response.text();\n      throw new Error(`JWT Bearer token request failed: ${response.status} ${response.statusText} - ${error}`);\n    }\n\n    const data: any = await response.json();\n\n    // Store token (encrypted)\n    await this.tokenStore.storeToken(data);\n\n    return data.access_token;\n  }\n\n  /**\n   * Refresh token (generate new JWT and request new token)\n   */\n  async refreshToken(): Promise<string> {\n    await this.tokenStore.clear();\n    return this.requestToken();\n  }\n\n  /**\n   * Check if token is valid\n   */\n  async isTokenValid(): Promise<boolean> {\n    return this.tokenStore.isValid(this.config.refreshBeforeExpiry);\n  }\n}\n","/**\n * Static Token Flow - For APIs that use static API keys\n * Examples: OpenAI, Anthropic, many SaaS APIs\n */\n\nimport type { OAuthConfig } from '../types.js';\n\nexport class StaticTokenFlow {\n  private token: string;\n\n  constructor(private config: OAuthConfig) {\n    if (!config.staticToken) {\n      throw new Error('Static token flow requires staticToken in config');\n    }\n\n    this.token = config.staticToken;\n  }\n\n  /**\n   * Get token (always returns the static token)\n   */\n  async getToken(): Promise<string> {\n    return this.token;\n  }\n\n  /**\n   * Refresh token (no-op for static tokens)\n   */\n  async refreshToken(): Promise<string> {\n    return this.token;\n  }\n\n  /**\n   * Token is always valid for static tokens\n   */\n  async isTokenValid(): Promise<boolean> {\n    return true;\n  }\n\n  /**\n   * Update the static token\n   */\n  updateToken(newToken: string): void {\n    this.token = newToken;\n  }\n}\n","/**\n * OAuth Manager - Main entry point for OAuth 2.0 authentication\n * Supports multiple flows: Authorization Code (with PKCE), Client Credentials, JWT Bearer, Static Token\n */\n\nimport { AuthCodePKCEFlow } from './flows/AuthCodePKCE.js';\nimport { ClientCredentialsFlow } from './flows/ClientCredentials.js';\nimport { JWTBearerFlow } from './flows/JWTBearer.js';\nimport { StaticTokenFlow } from './flows/StaticToken.js';\nimport type { OAuthConfig } from './types.js';\n\nexport class OAuthManager {\n  private flow: AuthCodePKCEFlow | ClientCredentialsFlow | JWTBearerFlow | StaticTokenFlow;\n\n  constructor(config: OAuthConfig) {\n    // Validate configuration\n    this.validateConfig(config);\n\n    // Create appropriate flow implementation\n    switch (config.flow) {\n      case 'authorization_code':\n        this.flow = new AuthCodePKCEFlow(config);\n        break;\n\n      case 'client_credentials':\n        this.flow = new ClientCredentialsFlow(config);\n        break;\n\n      case 'jwt_bearer':\n        this.flow = new JWTBearerFlow(config);\n        break;\n\n      case 'static_token':\n        this.flow = new StaticTokenFlow(config);\n        break;\n\n      default:\n        throw new Error(`Unknown OAuth flow: ${(config as any).flow}`);\n    }\n  }\n\n  /**\n   * Get valid access token\n   * Automatically refreshes if expired\n   *\n   * @param userId - User identifier for multi-user support (optional)\n   */\n  async getToken(userId?: string): Promise<string> {\n    return this.flow.getToken(userId);\n  }\n\n  /**\n   * Force refresh the token\n   *\n   * @param userId - User identifier for multi-user support (optional)\n   */\n  async refreshToken(userId?: string): Promise<string> {\n    return this.flow.refreshToken(userId);\n  }\n\n  /**\n   * Check if current token is valid\n   *\n   * @param userId - User identifier for multi-user support (optional)\n   */\n  async isTokenValid(userId?: string): Promise<boolean> {\n    return this.flow.isTokenValid(userId);\n  }\n\n  // ==================== Authorization Code Flow Methods ====================\n\n  /**\n   * Start authorization flow (Authorization Code only)\n   * Returns URL for user to visit\n   *\n   * @param userId - User identifier for multi-user support (optional)\n   * @returns Authorization URL for the user to visit\n   */\n  async startAuthFlow(userId?: string): Promise<string> {\n    if (!(this.flow instanceof AuthCodePKCEFlow)) {\n      throw new Error('startAuthFlow() is only available for authorization_code flow');\n    }\n\n    return this.flow.getAuthorizationUrl(userId);\n  }\n\n  /**\n   * Handle OAuth callback (Authorization Code only)\n   * Call this with the callback URL after user authorizes\n   *\n   * @param callbackUrl - Full callback URL with code and state parameters\n   * @param userId - Optional user identifier (can be extracted from state if embedded)\n   */\n  async handleCallback(callbackUrl: string, userId?: string): Promise<void> {\n    if (!(this.flow instanceof AuthCodePKCEFlow)) {\n      throw new Error('handleCallback() is only available for authorization_code flow');\n    }\n\n    const url = new URL(callbackUrl);\n    const code = url.searchParams.get('code');\n    const state = url.searchParams.get('state');\n\n    if (!code) {\n      throw new Error('Missing authorization code in callback URL');\n    }\n\n    if (!state) {\n      throw new Error('Missing state parameter in callback URL');\n    }\n\n    await this.flow.exchangeCode(code, state, userId);\n  }\n\n  /**\n   * Revoke token (if supported by provider)\n   *\n   * @param revocationUrl - Optional revocation endpoint URL\n   * @param userId - User identifier for multi-user support (optional)\n   */\n  async revokeToken(revocationUrl?: string, userId?: string): Promise<void> {\n    if (this.flow instanceof AuthCodePKCEFlow) {\n      await this.flow.revokeToken(revocationUrl, userId);\n    } else {\n      throw new Error('Token revocation not implemented for this flow');\n    }\n  }\n\n  // ==================== Validation ====================\n\n  private validateConfig(config: OAuthConfig): void {\n    // Required fields\n    if (!config.flow) {\n      throw new Error('OAuth flow is required (authorization_code, client_credentials, jwt_bearer, or static_token)');\n    }\n\n    // tokenUrl and clientId not required for static_token\n    if (config.flow !== 'static_token') {\n      if (!config.tokenUrl) {\n        throw new Error('tokenUrl is required');\n      }\n\n      if (!config.clientId) {\n        throw new Error('clientId is required');\n      }\n    }\n\n    // Flow-specific validation\n    switch (config.flow) {\n      case 'authorization_code':\n        if (!config.authorizationUrl) {\n          throw new Error('authorizationUrl is required for authorization_code flow');\n        }\n        if (!config.redirectUri) {\n          throw new Error('redirectUri is required for authorization_code flow');\n        }\n        break;\n\n      case 'client_credentials':\n        if (!config.clientSecret) {\n          throw new Error('clientSecret is required for client_credentials flow');\n        }\n        break;\n\n      case 'jwt_bearer':\n        if (!config.privateKey && !config.privateKeyPath) {\n          throw new Error(\n            'privateKey or privateKeyPath is required for jwt_bearer flow'\n          );\n        }\n        break;\n\n      case 'static_token':\n        if (!config.staticToken) {\n          throw new Error('staticToken is required for static_token flow');\n        }\n        break;\n    }\n\n    // Warn if using FileStorage without encryption key\n    if (config.storage && !process.env.OAUTH_ENCRYPTION_KEY) {\n      console.warn(\n        'WARNING: Using persistent storage without OAUTH_ENCRYPTION_KEY environment variable. ' +\n          'Tokens will be encrypted with auto-generated key that changes on restart!'\n      );\n    }\n  }\n}\n","/**\n * OAuth Provider Registry - Global singleton for managing OAuth providers\n * Register providers once, use everywhere with authenticated fetch and tools\n */\n\nimport { OAuthManager } from './OAuthManager.js';\nimport type { OAuthConfig } from './types.js';\n\nexport interface RegisteredProvider {\n  name: string; // Unique ID: 'microsoft', 'google', 'github', etc.\n  displayName: string; // Human-readable: 'Microsoft Graph API'\n  description: string; // What APIs it provides access to\n  baseURL: string; // Base URL for the API\n  oauthManager: OAuthManager; // OAuth manager instance\n}\n\nexport interface ProviderRegistrationConfig {\n  displayName: string;\n  description: string;\n  baseURL: string;\n  oauth: OAuthConfig | OAuthManager;\n}\n\nexport class OAuthRegistry {\n  private static instance: OAuthRegistry;\n  private providers: Map<string, RegisteredProvider> = new Map();\n\n  private constructor() {\n    // Private constructor for singleton\n  }\n\n  /**\n   * Get singleton instance\n   */\n  static getInstance(): OAuthRegistry {\n    if (!OAuthRegistry.instance) {\n      OAuthRegistry.instance = new OAuthRegistry();\n    }\n    return OAuthRegistry.instance;\n  }\n\n  /**\n   * Register an OAuth provider\n   *\n   * @param name - Unique provider identifier (e.g., 'microsoft', 'google')\n   * @param config - Provider configuration\n   */\n  register(name: string, config: ProviderRegistrationConfig): void {\n    // Validate name\n    if (!name || name.trim().length === 0) {\n      throw new Error('Provider name cannot be empty');\n    }\n\n    if (this.providers.has(name)) {\n      console.warn(`OAuth provider '${name}' is already registered. Overwriting...`);\n    }\n\n    // Create OAuthManager if config provided, or use existing instance\n    const oauthManager =\n      config.oauth instanceof OAuthManager ? config.oauth : new OAuthManager(config.oauth);\n\n    this.providers.set(name, {\n      name,\n      displayName: config.displayName,\n      description: config.description,\n      baseURL: config.baseURL,\n      oauthManager,\n    });\n  }\n\n  /**\n   * Get provider by name\n   *\n   * @throws Error if provider not found\n   */\n  get(name: string): RegisteredProvider {\n    const provider = this.providers.get(name);\n\n    if (!provider) {\n      const available = this.listProviderNames();\n      const availableList = available.length > 0 ? available.join(', ') : 'none';\n\n      throw new Error(\n        `OAuth provider '${name}' not found. Available providers: ${availableList}`\n      );\n    }\n\n    return provider;\n  }\n\n  /**\n   * Check if provider exists\n   */\n  has(name: string): boolean {\n    return this.providers.has(name);\n  }\n\n  /**\n   * Get all registered provider names\n   */\n  listProviderNames(): string[] {\n    return Array.from(this.providers.keys());\n  }\n\n  /**\n   * Get all registered providers with full metadata\n   */\n  listProviders(): RegisteredProvider[] {\n    return Array.from(this.providers.values());\n  }\n\n  /**\n   * Get provider descriptions formatted for tool parameters\n   * Returns a string suitable for including in tool descriptions\n   */\n  getProviderDescriptionsForTools(): string {\n    const providers = this.listProviders();\n\n    if (providers.length === 0) {\n      return 'No OAuth providers registered yet.';\n    }\n\n    return providers\n      .map((p) => `  - \"${p.name}\": ${p.displayName} - ${p.description}`)\n      .join('\\n');\n  }\n\n  /**\n   * Get provider names and descriptions as an object (for documentation)\n   */\n  getProviderInfo(): Record<string, { displayName: string; description: string; baseURL: string }> {\n    const info: Record<string, any> = {};\n\n    for (const [name, provider] of this.providers) {\n      info[name] = {\n        displayName: provider.displayName,\n        description: provider.description,\n        baseURL: provider.baseURL,\n      };\n    }\n\n    return info;\n  }\n\n  /**\n   * Unregister a provider\n   */\n  unregister(name: string): boolean {\n    return this.providers.delete(name);\n  }\n\n  /**\n   * Clear all providers (useful for testing)\n   */\n  clear(): void {\n    this.providers.clear();\n  }\n\n  /**\n   * Get number of registered providers\n   */\n  size(): number {\n    return this.providers.size;\n  }\n}\n\n/**\n * Singleton instance - use this in your code\n */\nexport const oauthRegistry = OAuthRegistry.getInstance();\n","/**\n * Authenticated Fetch - Drop-in replacement for fetch() with OAuth authentication\n */\n\nimport { oauthRegistry } from './OAuthRegistry.js';\n\n/**\n * Fetch with automatic OAuth authentication\n *\n * Same API as standard fetch(), but with additional authProvider and optional userId parameters.\n * The OAuth token is automatically retrieved and injected into the Authorization header.\n *\n * @param url - URL to fetch (string or URL object)\n * @param options - Standard fetch options\n * @param authProvider - Name of registered OAuth provider (e.g., 'microsoft', 'google')\n * @param userId - Optional user identifier for multi-user support (omit for single-user mode)\n * @returns Promise<Response> - Same as standard fetch\n *\n * @example Single-user mode:\n * ```typescript\n * const response = await authenticatedFetch(\n *   'https://graph.microsoft.com/v1.0/me',\n *   { method: 'GET' },\n *   'microsoft'\n * );\n * const data = await response.json();\n * ```\n *\n * @example Multi-user mode:\n * ```typescript\n * const response = await authenticatedFetch(\n *   'https://api.github.com/user/repos',\n *   { method: 'GET' },\n *   'github',\n *   'user123'  // Get token for specific user\n * );\n * const repos = await response.json();\n * ```\n */\nexport async function authenticatedFetch(\n  url: string | URL,\n  options: RequestInit | undefined,\n  authProvider: string,\n  userId?: string\n): Promise<Response> {\n  // Get provider from registry\n  const provider = oauthRegistry.get(authProvider);\n\n  // Get OAuth token for the user (automatically refreshed if needed)\n  const token = await provider.oauthManager.getToken(userId);\n\n  // Merge headers (don't mutate original options)\n  const authOptions: RequestInit = {\n    ...options,\n    headers: {\n      ...options?.headers,\n      Authorization: `Bearer ${token}`,\n    },\n  };\n\n  // Call standard fetch with authenticated headers\n  return fetch(url, authOptions);\n}\n\n/**\n * Create an authenticated fetch function bound to a specific provider and optionally a user\n *\n * Useful for creating reusable fetch functions for a specific API and/or user.\n *\n * @param authProvider - Name of registered OAuth provider\n * @param userId - Optional user identifier to bind to (omit for single-user mode)\n * @returns Fetch function bound to that provider (and user)\n *\n * @example Single-user mode:\n * ```typescript\n * const msftFetch = createAuthenticatedFetch('microsoft');\n *\n * // Use like normal fetch (auth automatic)\n * const me = await msftFetch('https://graph.microsoft.com/v1.0/me');\n * const emails = await msftFetch('https://graph.microsoft.com/v1.0/me/messages');\n * ```\n *\n * @example Multi-user mode (bound to specific user):\n * ```typescript\n * // Create fetch function for Alice\n * const aliceFetch = createAuthenticatedFetch('github', 'user123');\n *\n * // All calls automatically use Alice's token\n * const repos = await aliceFetch('https://api.github.com/user/repos');\n * const issues = await aliceFetch('https://api.github.com/user/issues');\n *\n * // Create fetch function for Bob (separate tokens!)\n * const bobFetch = createAuthenticatedFetch('github', 'user456');\n * const bobRepos = await bobFetch('https://api.github.com/user/repos');\n * ```\n *\n * @example Multi-user mode (userId per-call):\n * ```typescript\n * // Create fetch function NOT bound to a user\n * const githubFetch = createAuthenticatedFetch('github');\n *\n * // Specify userId at call time\n * const aliceRepos = await githubFetch(\n *   'https://api.github.com/user/repos',\n *   { userId: 'user123' }  // Pass as custom option\n * );\n * ```\n */\nexport function createAuthenticatedFetch(\n  authProvider: string,\n  userId?: string\n): (url: string | URL, options?: RequestInit) => Promise<Response> {\n  // Validate provider exists at creation time\n  oauthRegistry.get(authProvider);\n\n  return async (url: string | URL, options?: RequestInit) => {\n    return authenticatedFetch(url, options, authProvider, userId);\n  };\n}\n","/**\n * JavaScript Execution Tool\n * Executes JavaScript in a sandboxed VM with OAuth integration\n */\n\nimport * as vm from 'vm';\nimport { ToolFunction } from '../../domain/entities/Tool.js';\nimport { oauthRegistry, OAuthRegistry } from '../../plugins/oauth/OAuthRegistry.js';\nimport { authenticatedFetch } from '../../plugins/oauth/authenticatedFetch.js';\n\ninterface ExecuteJSArgs {\n  code: string;\n  input?: any;\n  timeout?: number;\n}\n\ninterface ExecuteJSResult {\n  success: boolean;\n  result: any;\n  logs: string[];\n  error?: string;\n  executionTime: number;\n}\n\n/**\n * Generate the tool description with current OAuth providers\n */\nfunction generateDescription(registry: OAuthRegistry): string {\n  const providers = registry.listProviders();\n  const providerList = providers.length > 0\n    ? providers\n        .map(p => `    \"${p.name}\": ${p.displayName}\\n     ${p.description}\\n     Base URL: ${p.baseURL}`)\n        .join('\\n\\n')\n    : '   No OAuth providers registered yet. Register providers with oauthRegistry.register().';\n\n  return `Execute JavaScript code in a secure sandbox with OAuth authentication.\n\nIMPORTANT: This tool runs JavaScript code in a sandboxed environment with access to authenticated APIs.\n\nAVAILABLE IN CONTEXT:\n\n1. INPUT/OUTPUT:\n   - input: any data passed to your code\n   - output: SET THIS variable to return your result\n\n2. AUTHENTICATED FETCH:\n   - authenticatedFetch(url, options, provider, userId?)\n      url: Full URL or path\n      options: Standard fetch options { method: 'GET'|'POST'|..., body: ..., headers: ... }\n      provider: OAuth provider name (see below)\n      userId: (optional) User identifier for multi-user apps\n      Returns: Promise<Response>\n\n   REGISTERED OAUTH PROVIDERS:\n${providerList}\n\n3. STANDARD FETCH:\n   - fetch(url, options) - No authentication\n\n4. OAUTH REGISTRY:\n   - oauth.listProviders() - List available providers\n   - oauth.getProviderInfo(name) - Get provider details\n\n5. UTILITIES:\n   - console.log/error/warn\n   - Buffer, JSON, Math, Date\n   - setTimeout, setInterval, Promise\n\nCODE PATTERN:\nAlways wrap your code in an async IIFE:\n\n(async () => {\n  // Your code here\n\n  // Single-user mode (default)\n  const response = await authenticatedFetch(url, options, provider);\n\n  // OR Multi-user mode (if your app has multiple users)\n  const response = await authenticatedFetch(url, options, provider, userId);\n\n  const data = await response.json();\n  output = data;\n})();\n\nSECURITY:\n- 10 second timeout (configurable)\n- No file system access\n- No process/child_process\n- No require/import\n- Memory limited\n\nRETURNS:\n{\n  success: boolean,\n  result: any,\n  logs: string[],\n  error?: string,\n  executionTime: number\n}`;\n}\n\n/**\n * Create an execute_javascript tool with the current OAuth registry state\n * Use this factory when you need the tool to reflect currently registered providers\n */\nexport function createExecuteJavaScriptTool(registry: OAuthRegistry = oauthRegistry): ToolFunction<ExecuteJSArgs, ExecuteJSResult> {\n  return {\n    definition: {\n      type: 'function',\n      function: {\n        name: 'execute_javascript',\n        description: generateDescription(registry),\n        parameters: {\n          type: 'object',\n          properties: {\n            code: {\n              type: 'string',\n              description:\n                'JavaScript code to execute. MUST set the \"output\" variable. Wrap in async IIFE for async operations.',\n            },\n            input: {\n              description: 'Optional input data available as \"input\" variable in your code',\n            },\n            timeout: {\n              type: 'number',\n              description: 'Execution timeout in milliseconds (default: 10000, max: 30000)',\n            },\n          },\n          required: ['code'],\n        },\n      },\n      blocking: true,\n      timeout: 35000, // Tool timeout (slightly more than max code timeout)\n    },\n\n    execute: async (args: ExecuteJSArgs): Promise<ExecuteJSResult> => {\n      const logs: string[] = [];\n      const startTime = Date.now();\n\n      try {\n        // Validate timeout\n        const timeout = Math.min(args.timeout || 10000, 30000);\n\n        // Execute in VM with the specified registry\n        const result = await executeInVM(args.code, args.input, timeout, logs, registry);\n\n        return {\n          success: true,\n          result,\n          logs,\n          executionTime: Date.now() - startTime,\n        };\n      } catch (error) {\n        return {\n          success: false,\n          result: null,\n          logs,\n          error: (error as Error).message,\n          executionTime: Date.now() - startTime,\n        };\n      }\n    },\n  };\n}\n\n/**\n * Default executeJavaScript tool (uses global oauthRegistry)\n * NOTE: The description is generated at module load time. If you register\n * providers after importing this, use createExecuteJavaScriptTool() instead.\n */\nexport const executeJavaScript: ToolFunction<ExecuteJSArgs, ExecuteJSResult> = createExecuteJavaScriptTool(oauthRegistry);\n\n/**\n * Execute code in Node.js vm module\n */\nasync function executeInVM(\n  code: string,\n  input: any,\n  timeout: number,\n  logs: string[],\n  registry: OAuthRegistry = oauthRegistry\n): Promise<any> {\n  // Create sandbox context\n  const sandbox: any = {\n    // Input/output\n    input: input || {},\n    output: null,\n\n    // Console (captured)\n    console: {\n      log: (...args: any[]) => logs.push(args.map((a) => String(a)).join(' ')),\n      error: (...args: any[]) => logs.push('ERROR: ' + args.map((a) => String(a)).join(' ')),\n      warn: (...args: any[]) => logs.push('WARN: ' + args.map((a) => String(a)).join(' ')),\n    },\n\n    // Authenticated fetch\n    authenticatedFetch,\n\n    // Standard fetch\n    fetch: globalThis.fetch,\n\n    // OAuth registry info (uses the provided registry)\n    oauth: {\n      listProviders: () => registry.listProviderNames(),\n      getProviderInfo: (name: string) => {\n        try {\n          const provider = registry.get(name);\n          return {\n            displayName: provider.displayName,\n            description: provider.description,\n            baseURL: provider.baseURL,\n          };\n        } catch {\n          return null;\n        }\n      },\n    },\n\n    // Standard globals\n    Buffer,\n    JSON,\n    Math,\n    Date,\n    setTimeout,\n    setInterval,\n    clearTimeout,\n    clearInterval,\n    Promise,\n\n    // Array/Object\n    Array,\n    Object,\n    String,\n    Number,\n    Boolean,\n  };\n\n  // Create VM context\n  const context = vm.createContext(sandbox);\n\n  // Wrap user code in async IIFE if not already wrapped\n  const wrappedCode = code.trim().startsWith('(async')\n    ? code\n    : `\n    (async () => {\n      ${code}\n      return output;\n    })()\n  `;\n\n  // Compile and run\n  const script = new vm.Script(wrappedCode);\n  const resultPromise = script.runInContext(context, {\n    timeout,\n    displayErrors: true,\n  });\n\n  // Wait for completion\n  const result = await resultPromise;\n\n  return result;\n}\n","/**\n * OAuth Tool Generator - Auto-generate tools for registered OAuth providers\n */\n\nimport { ToolFunction } from '../../domain/entities/Tool.js';\nimport { oauthRegistry } from './OAuthRegistry.js';\nimport { authenticatedFetch } from './authenticatedFetch.js';\n\ninterface APIRequestArgs {\n  authProvider: string;\n  url: string;\n  method?: 'GET' | 'POST' | 'PUT' | 'DELETE' | 'PATCH';\n  body?: any;\n  headers?: Record<string, string>;\n}\n\ninterface APIRequestResult {\n  success: boolean;\n  status: number;\n  statusText: string;\n  data: any;\n  error?: string;\n}\n\n/**\n * Generate a universal API request tool for all registered OAuth providers\n *\n * This tool allows the AI agent to make authenticated requests to any registered API.\n * The tool description is dynamically generated based on registered providers.\n *\n * @returns ToolFunction that can call any registered OAuth API\n */\nexport function generateWebAPITool(): ToolFunction<APIRequestArgs, APIRequestResult> {\n  return {\n    definition: {\n      type: 'function',\n      function: {\n        name: 'api_request',\n        description: `Make authenticated HTTP request to any registered OAuth API.\n\nThis tool automatically handles OAuth authentication for registered providers.\n\nREGISTERED PROVIDERS:\n${oauthRegistry.getProviderDescriptionsForTools()}\n\nHOW TO USE:\n1. Choose the appropriate authProvider based on which API you need to access\n2. Provide the URL (full URL or path relative to provider's baseURL)\n3. Specify the HTTP method (GET, POST, etc.)\n4. For POST/PUT/PATCH, include the request body\n\nEXAMPLES:\nRead Microsoft emails:\n{\n  authProvider: \"microsoft\",\n  url: \"/v1.0/me/messages\",\n  method: \"GET\"\n}\n\nList GitHub repositories:\n{\n  authProvider: \"github\",\n  url: \"/user/repos\",\n  method: \"GET\"\n}\n\nCreate Salesforce account:\n{\n  authProvider: \"salesforce\",\n  url: \"/services/data/v57.0/sobjects/Account\",\n  method: \"POST\",\n  body: { Name: \"Acme Corp\", Industry: \"Technology\" }\n}`,\n\n        parameters: {\n          type: 'object',\n          properties: {\n            authProvider: {\n              type: 'string',\n              enum: oauthRegistry.listProviderNames(),\n              description:\n                'Which OAuth provider to use for authentication. Choose based on the API you need to access.',\n            },\n            url: {\n              type: 'string',\n              description:\n                'URL to request. Can be full URL (https://...) or path relative to provider baseURL (e.g., \"/v1.0/me\")',\n            },\n            method: {\n              type: 'string',\n              enum: ['GET', 'POST', 'PUT', 'DELETE', 'PATCH'],\n              description: 'HTTP method (default: GET)',\n            },\n            body: {\n              description:\n                'Request body for POST/PUT/PATCH requests. Will be JSON-stringified automatically.',\n            },\n            headers: {\n              type: 'object',\n              description:\n                'Additional headers to include. Authorization header is added automatically.',\n            },\n          },\n          required: ['authProvider', 'url'],\n        },\n      },\n      blocking: true,\n      timeout: 30000,\n    },\n\n    execute: async (args: APIRequestArgs): Promise<APIRequestResult> => {\n      try {\n        // Get provider info\n        const provider = oauthRegistry.get(args.authProvider);\n\n        // Build full URL\n        const fullUrl = args.url.startsWith('http')\n          ? args.url\n          : `${provider.baseURL}${args.url}`;\n\n        // Prepare request options\n        const requestOptions: RequestInit = {\n          method: args.method || 'GET',\n          headers: {\n            'Content-Type': 'application/json',\n            ...args.headers,\n          },\n        };\n\n        // Add body for POST/PUT/PATCH\n        if (args.body && (args.method === 'POST' || args.method === 'PUT' || args.method === 'PATCH')) {\n          requestOptions.body = JSON.stringify(args.body);\n        }\n\n        // Make authenticated request\n        const response = await authenticatedFetch(fullUrl, requestOptions, args.authProvider);\n\n        // Get response data\n        const contentType = response.headers.get('content-type') || '';\n        let data: any;\n\n        if (contentType.includes('application/json')) {\n          data = await response.json();\n        } else {\n          data = await response.text();\n        }\n\n        return {\n          success: response.ok,\n          status: response.status,\n          statusText: response.statusText,\n          data,\n        };\n      } catch (error) {\n        return {\n          success: false,\n          status: 0,\n          statusText: 'Error',\n          data: null,\n          error: (error as Error).message,\n        };\n      }\n    },\n  };\n}\n","/**\n * File-based token storage\n * Tokens are encrypted and stored in individual files with restrictive permissions\n */\n\nimport * as fs from 'fs/promises';\nimport * as path from 'path';\nimport * as crypto from 'crypto';\nimport { ITokenStorage, StoredToken } from '../../domain/ITokenStorage.js';\nimport { encrypt, decrypt } from '../../utils/encryption.js';\n\nexport interface FileStorageConfig {\n  directory: string; // Directory to store token files\n  encryptionKey: string; // Encryption key (REQUIRED - do not use auto-generated key!)\n}\n\nexport class FileStorage implements ITokenStorage {\n  private directory: string;\n  private encryptionKey: string;\n\n  constructor(config: FileStorageConfig) {\n    if (!config.encryptionKey) {\n      throw new Error(\n        'FileStorage requires an encryption key. Set OAUTH_ENCRYPTION_KEY in environment or provide config.encryptionKey'\n      );\n    }\n\n    this.directory = config.directory;\n    this.encryptionKey = config.encryptionKey;\n\n    // Ensure directory exists (async, don't block constructor)\n    this.ensureDirectory().catch((error) => {\n      console.error('Failed to create token directory:', error);\n    });\n  }\n\n  private async ensureDirectory(): Promise<void> {\n    try {\n      await fs.mkdir(this.directory, { recursive: true });\n      // Set directory permissions (owner only)\n      await fs.chmod(this.directory, 0o700);\n    } catch (error) {\n      // Directory might already exist, that's okay\n    }\n  }\n\n  /**\n   * Get file path for a token key (hashed for security)\n   */\n  private getFilePath(key: string): string {\n    // Hash the key for filename (prevents exposing sensitive key names)\n    const hash = crypto.createHash('sha256').update(key).digest('hex');\n    return path.join(this.directory, `${hash}.token`);\n  }\n\n  async storeToken(key: string, token: StoredToken): Promise<void> {\n    await this.ensureDirectory();\n\n    const filePath = this.getFilePath(key);\n    const plaintext = JSON.stringify(token);\n    const encrypted = encrypt(plaintext, this.encryptionKey);\n\n    // Write encrypted token to file\n    await fs.writeFile(filePath, encrypted, 'utf8');\n\n    // Set restrictive permissions (owner read/write only)\n    await fs.chmod(filePath, 0o600);\n  }\n\n  async getToken(key: string): Promise<StoredToken | null> {\n    const filePath = this.getFilePath(key);\n\n    try {\n      const encrypted = await fs.readFile(filePath, 'utf8');\n      const decrypted = decrypt(encrypted, this.encryptionKey);\n      return JSON.parse(decrypted) as StoredToken;\n    } catch (error: any) {\n      if (error.code === 'ENOENT') {\n        // File doesn't exist\n        return null;\n      }\n\n      console.error('Failed to read/decrypt token file:', error);\n\n      // Remove corrupted file\n      try {\n        await fs.unlink(filePath);\n      } catch {\n        // Ignore unlink errors\n      }\n\n      return null;\n    }\n  }\n\n  async deleteToken(key: string): Promise<void> {\n    const filePath = this.getFilePath(key);\n\n    try {\n      await fs.unlink(filePath);\n    } catch (error: any) {\n      if (error.code !== 'ENOENT') {\n        throw error;\n      }\n      // File doesn't exist, that's okay\n    }\n  }\n\n  async hasToken(key: string): Promise<boolean> {\n    const filePath = this.getFilePath(key);\n\n    try {\n      await fs.access(filePath);\n      return true;\n    } catch {\n      return false;\n    }\n  }\n\n  /**\n   * List all token keys (for debugging)\n   */\n  async listTokens(): Promise<string[]> {\n    try {\n      const files = await fs.readdir(this.directory);\n      return files.filter((f) => f.endsWith('.token')).map((f) => f.replace('.token', ''));\n    } catch {\n      return [];\n    }\n  }\n\n  /**\n   * Clear all tokens\n   */\n  async clearAll(): Promise<void> {\n    try {\n      const files = await fs.readdir(this.directory);\n      const tokenFiles = files.filter((f) => f.endsWith('.token'));\n\n      await Promise.all(\n        tokenFiles.map((f) => fs.unlink(path.join(this.directory, f)).catch(() => {}))\n      );\n    } catch {\n      // Directory doesn't exist or can't read, that's okay\n    }\n  }\n}\n"]}