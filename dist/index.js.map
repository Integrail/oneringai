{"version":3,"sources":["../src/connectors/oauth/utils/encryption.ts","../src/connectors/oauth/infrastructure/storage/MemoryStorage.ts","../src/connectors/oauth/domain/TokenStore.ts","../src/connectors/oauth/utils/pkce.ts","../src/connectors/oauth/flows/AuthCodePKCE.ts","../src/connectors/oauth/flows/ClientCredentials.ts","../src/connectors/oauth/flows/JWTBearer.ts","../src/connectors/oauth/flows/StaticToken.ts","../src/connectors/oauth/OAuthManager.ts","../src/infrastructure/resilience/CircuitBreaker.ts","../src/infrastructure/resilience/BackoffStrategy.ts","../src/infrastructure/observability/Logger.ts","../src/infrastructure/observability/Metrics.ts","../src/core/Connector.ts","../node_modules/fs.realpath/old.js","../node_modules/fs.realpath/index.js","../node_modules/concat-map/index.js","../node_modules/balanced-match/index.js","../node_modules/brace-expansion/index.js","../node_modules/minimatch/minimatch.js","../node_modules/inherits/inherits_browser.js","../node_modules/inherits/inherits.js","../node_modules/path-is-absolute/index.js","../node_modules/glob/common.js","../node_modules/glob/sync.js","../node_modules/wrappy/wrappy.js","../node_modules/once/once.js","../node_modules/inflight/inflight.js","../node_modules/glob/glob.js","../src/core/index.ts","../src/core/BaseAgent.ts","../src/core/permissions/types.ts","../src/core/permissions/ToolPermissionManager.ts","../src/core/ToolManager.ts","../src/domain/errors/AIErrors.ts","../src/core/IdempotencyCache.ts","../src/domain/entities/Memory.ts","../src/capabilities/taskAgent/WorkingMemory.ts","../src/infrastructure/storage/InMemoryStorage.ts","../src/domain/entities/Message.ts","../src/domain/entities/Content.ts","../src/core/context/types.ts","../src/core/context/utils/ContextUtils.ts","../src/core/context/strategies/BaseCompactionStrategy.ts","../src/core/constants.ts","../src/core/context/strategies/ProactiveStrategy.ts","../src/core/context/strategies/AggressiveStrategy.ts","../src/core/context/strategies/LazyStrategy.ts","../src/core/context/strategies/RollingWindowStrategy.ts","../src/core/context/strategies/AdaptiveStrategy.ts","../src/core/context/strategies/index.ts","../src/core/Vendor.ts","../src/domain/entities/Model.ts","../src/core/context/plugins/IContextPlugin.ts","../src/core/context/plugins/InContextMemoryPlugin.ts","../src/core/context/plugins/inContextMemoryTools.ts","../src/infrastructure/storage/FilePersistentInstructionsStorage.ts","../src/core/context/plugins/PersistentInstructionsPlugin.ts","../src/core/context/plugins/persistentInstructionsTools.ts","../src/capabilities/taskAgent/memoryTools.ts","../src/capabilities/taskAgent/contextTools.ts","../src/core/context/FeatureInstructions.ts","../src/core/AgentContext.ts","../src/infrastructure/providers/base/BaseProvider.ts","../src/infrastructure/providers/base/BaseTextProvider.ts","../src/infrastructure/providers/openai/OpenAIResponsesConverter.ts","../src/domain/entities/StreamEvent.ts","../src/infrastructure/providers/openai/OpenAIResponsesStreamConverter.ts","../src/infrastructure/providers/openai/OpenAITextProvider.ts","../src/infrastructure/providers/shared/ResponseBuilder.ts","../src/infrastructure/providers/shared/ToolConversionUtils.ts","../src/infrastructure/providers/base/BaseConverter.ts","../src/infrastructure/providers/anthropic/AnthropicConverter.ts","../src/infrastructure/providers/base/BaseStreamConverter.ts","../src/infrastructure/providers/anthropic/AnthropicStreamConverter.ts","../src/infrastructure/providers/anthropic/AnthropicTextProvider.ts","../src/utils/imageUtils.ts","../src/infrastructure/providers/google/GoogleConverter.ts","../src/infrastructure/providers/google/GoogleStreamConverter.ts","../src/infrastructure/providers/google/GoogleTextProvider.ts","../src/infrastructure/providers/vertex/VertexAITextProvider.ts","../src/infrastructure/providers/generic/GenericOpenAIProvider.ts","../src/core/createProvider.ts","../src/domain/entities/Tool.ts","../src/capabilities/agents/ExecutionContext.ts","../src/capabilities/agents/HookManager.ts","../src/domain/entities/StreamState.ts","../src/capabilities/agents/AgenticLoop.ts","../src/domain/interfaces/IDisposable.ts","../src/core/Agent.ts","../src/core/AgentContextTools.ts","../src/infrastructure/config/ConfigLoader.ts","../src/domain/errors/MCPError.ts","../src/domain/entities/MCPConfig.ts","../src/infrastructure/mcp/adapters/MCPToolAdapter.ts","../src/core/mcp/MCPClient.ts","../src/core/mcp/MCPRegistry.ts","../src/core/TextToSpeech.ts","../src/infrastructure/providers/base/BaseMediaProvider.ts","../src/domain/entities/SharedVoices.ts","../src/infrastructure/providers/openai/OpenAITTSProvider.ts","../src/infrastructure/providers/openai/OpenAISTTProvider.ts","../src/infrastructure/providers/google/GoogleTTSProvider.ts","../src/core/createAudioProvider.ts","../src/domain/entities/RegistryUtils.ts","../src/domain/entities/TTSModel.ts","../src/core/SpeechToText.ts","../src/domain/entities/STTModel.ts","../src/infrastructure/providers/openai/OpenAIImageProvider.ts","../src/infrastructure/providers/google/GoogleImageProvider.ts","../src/core/createImageProvider.ts","../src/core/ErrorHandler.ts","../src/capabilities/images/ImageGeneration.ts","../src/domain/entities/ImageModel.ts","../src/capabilities/video/VideoGeneration.ts","../src/infrastructure/providers/openai/OpenAISoraProvider.ts","../src/infrastructure/providers/google/GoogleVeoProvider.ts","../src/core/createVideoProvider.ts","../src/domain/entities/VideoModel.ts","../src/capabilities/search/SearchProvider.ts","../src/capabilities/shared/types.ts","../src/capabilities/search/providers/SerperProvider.ts","../src/capabilities/search/providers/BraveProvider.ts","../src/capabilities/search/providers/TavilyProvider.ts","../src/capabilities/search/providers/RapidAPIProvider.ts","../src/capabilities/scrape/ScrapeProvider.ts","../src/capabilities/scrape/providers/ZenRowsProvider.ts","../src/domain/interfaces/IContextStorage.ts","../src/domain/interfaces/IAgentDefinitionStorage.ts","../src/capabilities/taskAgent/TaskAgent.ts","../src/domain/entities/Task.ts","../src/domain/entities/AgentState.ts","../src/core/context/plugins/PlanPlugin.ts","../src/core/context/plugins/MemoryPlugin.ts","../src/capabilities/taskAgent/ExternalDependencyHandler.ts","../src/infrastructure/resilience/index.ts","../src/infrastructure/resilience/RateLimiter.ts","../src/utils/jsonExtractor.ts","../src/capabilities/taskAgent/PlanExecutor.ts","../src/capabilities/taskAgent/CheckpointManager.ts","../src/capabilities/taskAgent/PlanningAgent.ts","../src/core/context/plugins/AutoSpillPlugin.ts","../src/capabilities/researchAgent/ResearchAgent.ts","../src/capabilities/researchAgent/sources/WebSearchSource.ts","../src/capabilities/researchAgent/sources/FileSearchSource.ts","../src/infrastructure/context/compactors/TruncateCompactor.ts","../src/infrastructure/context/compactors/SummarizeCompactor.ts","../src/infrastructure/context/compactors/MemoryEvictionCompactor.ts","../src/infrastructure/context/estimators/ApproximateEstimator.ts","../src/infrastructure/context/estimators/index.ts","../src/domain/interfaces/IHistoryManager.ts","../src/infrastructure/storage/InMemoryHistoryStorage.ts","../src/infrastructure/storage/FileContextStorage.ts","../src/infrastructure/storage/FileAgentDefinitionStorage.ts","../src/capabilities/agents/StreamHelpers.ts","../src/infrastructure/providers/base/ProviderErrorMapper.ts","../src/domain/entities/Services.ts","../src/index.ts","../src/tools/connector/ConnectorTools.ts","../src/connectors/oauth/index.ts","../src/connectors/index.ts","../src/connectors/oauth/infrastructure/storage/FileStorage.ts","../src/connectors/authenticatedFetch.ts","../src/connectors/toolGenerator.ts","../src/domain/interfaces/IConnectorConfigStorage.ts","../src/connectors/storage/ConnectorConfigStore.ts","../src/connectors/storage/MemoryConnectorStorage.ts","../src/connectors/storage/FileConnectorStorage.ts","../src/infrastructure/observability/index.ts","../src/utils/messageBuilder.ts","../src/utils/clipboardImage.ts","../src/tools/index.ts","../src/tools/filesystem/types.ts","../src/tools/filesystem/readFile.ts","../src/tools/filesystem/writeFile.ts","../src/tools/filesystem/editFile.ts","../src/tools/filesystem/glob.ts","../src/tools/filesystem/grep.ts","../src/tools/filesystem/listDirectory.ts","../src/tools/shell/types.ts","../src/tools/shell/bash.ts","../src/tools/json/pathUtils.ts","../src/tools/json/jsonManipulator.ts","../src/tools/web/contentDetector.ts","../src/tools/web/htmlToMarkdown.ts","../src/tools/web/webFetch.ts","../src/tools/web/webFetchJS.ts","../src/tools/web/webSearch.ts","../src/tools/web/searchProviders/serper.ts","../src/tools/web/searchProviders/brave.ts","../src/tools/web/searchProviders/tavily.ts","../src/tools/web/webScrape.ts","../src/tools/code/executeJavaScript.ts","../src/tools/registry.generated.ts","../src/agents/ProviderConfigAgent.ts","../src/capabilities/universalAgent/ModeManager.ts","../src/capabilities/universalAgent/metaTools.ts","../src/capabilities/universalAgent/UniversalAgent.ts"],"names":["crypto3","fs","resolve","path","fs2","exports","stat","err","base","minimatch","Minimatch","filter","makeRe","braceExpand","set","isAbsolute","m","cb","glob","er","EventEmitter","MessageRole","ContentType","DEFAULT_OPTIONS","platform","DEFAULT_CONFIG","getPluginFromContext","StreamEventType","OpenAI","randomUUID","GoogleGenAI","ToolCallState","join","homedir","fs6","fs7","helpers","fs8","fs9","extractOpenAIConfig","extractGoogleConfig","formatBytes","metrics","fs10","getDefaultBaseDirectory","sanitizeAgentId","safeStringify","fs13","crypto4","path3","path4","crypto5","path5","readFile","writeFile","existsSync","fsReadFile","dirname","mkdir","fsWriteFile","readdir","relative","extname","plan"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoBO,SAAS,OAAA,CAAQ,MAAc,QAAA,EAA0B;AAE9D,EAAA,MAAM,IAAA,GAAc,oBAAY,WAAW,CAAA;AAG3C,EAAA,MAAM,MAAa,OAAA,CAAA,UAAA,CAAW,QAAA,EAAU,IAAA,EAAM,GAAA,EAAQ,YAAY,QAAQ,CAAA;AAG1E,EAAA,MAAM,EAAA,GAAY,oBAAY,SAAS,CAAA;AAGvC,EAAA,MAAM,MAAA,GAAgB,OAAA,CAAA,cAAA,CAAe,SAAA,EAAW,GAAA,EAAK,EAAE,CAAA;AAGvD,EAAA,IAAI,SAAA,GAAY,MAAA,CAAO,MAAA,CAAO,IAAA,EAAM,QAAQ,KAAK,CAAA;AACjD,EAAA,SAAA,IAAa,MAAA,CAAO,MAAM,KAAK,CAAA;AAG/B,EAAA,MAAM,GAAA,GAAM,OAAO,UAAA,EAAW;AAG9B,EAAA,MAAM,MAAA,GAAS,MAAA,CAAO,MAAA,CAAO,CAAC,IAAA,EAAM,EAAA,EAAI,GAAA,EAAK,MAAA,CAAO,IAAA,CAAK,SAAA,EAAW,KAAK,CAAC,CAAC,CAAA;AAG3E,EAAA,OAAO,MAAA,CAAO,SAAS,QAAQ,CAAA;AACjC;AASO,SAAS,OAAA,CAAQ,eAAuB,QAAA,EAA0B;AACvE,EAAA,MAAM,MAAA,GAAS,MAAA,CAAO,IAAA,CAAK,aAAA,EAAe,QAAQ,CAAA;AAGlD,EAAA,MAAM,IAAA,GAAO,MAAA,CAAO,QAAA,CAAS,CAAA,EAAG,WAAW,CAAA;AAC3C,EAAA,MAAM,EAAA,GAAK,MAAA,CAAO,QAAA,CAAS,WAAA,EAAa,cAAc,SAAS,CAAA;AAC/D,EAAA,MAAM,MAAM,MAAA,CAAO,QAAA,CAAS,cAAc,SAAA,EAAW,WAAA,GAAc,YAAY,UAAU,CAAA;AACzF,EAAA,MAAM,SAAA,GAAY,MAAA,CAAO,QAAA,CAAS,WAAA,GAAc,YAAY,UAAU,CAAA;AAGtE,EAAA,MAAM,MAAa,OAAA,CAAA,UAAA,CAAW,QAAA,EAAU,IAAA,EAAM,GAAA,EAAQ,YAAY,QAAQ,CAAA;AAG1E,EAAA,MAAM,QAAA,GAAkB,OAAA,CAAA,gBAAA,CAAiB,SAAA,EAAW,GAAA,EAAK,EAAE,CAAA;AAC3D,EAAA,QAAA,CAAS,WAAW,GAAG,CAAA;AAGvB,EAAA,IAAI,SAAA,GAAY,QAAA,CAAS,MAAA,CAAO,SAAS,CAAA;AACzC,EAAA,SAAA,GAAY,OAAO,MAAA,CAAO,CAAC,WAAW,QAAA,CAAS,KAAA,EAAO,CAAC,CAAA;AAEvD,EAAA,OAAO,SAAA,CAAU,SAAS,MAAM,CAAA;AAClC;AAOO,SAAS,gBAAA,GAA2B;AAEzC,EAAA,IAAI,OAAA,CAAQ,IAAI,oBAAA,EAAsB;AACpC,IAAA,OAAO,QAAQ,GAAA,CAAI,oBAAA;AAAA,EACrB;AAIA,EAAA,IAAI,CAAE,OAAe,oBAAA,EAAsB;AACzC,IAAC,OAAe,oBAAA,GAA8B,OAAA,CAAA,WAAA,CAAY,EAAE,CAAA,CAAE,SAAS,KAAK,CAAA;AAE5E,IAAA,OAAA,CAAQ,IAAA;AAAA,MACN;AAAA,KAEF;AAAA,EACF;AAEA,EAAA,OAAQ,MAAA,CAAe,oBAAA;AACzB;AAMO,SAAS,qBAAA,GAAgC;AAC9C,EAAA,OAAc,OAAA,CAAA,WAAA,CAAY,EAAE,CAAA,CAAE,QAAA,CAAS,KAAK,CAAA;AAC9C;AA5GA,IAOM,SAAA,EACA,SAAA,EACA,WAAA,EACA,UAAA,EACA,UAAA;AAXN,IAAA,eAAA,GAAA,KAAA,CAAA;AAAA,EAAA,0CAAA,GAAA;AAOA,IAAM,SAAA,GAAY,aAAA;AAClB,IAAM,SAAA,GAAY,EAAA;AAClB,IAAM,WAAA,GAAc,EAAA;AACpB,IAAM,UAAA,GAAa,EAAA;AACnB,IAAM,UAAA,GAAa,EAAA;AAAA,EAAA;AAAA,CAAA,CAAA;;;ACXnB,IAQa;AARb,IAAA,kBAAA,GAAA,KAAA,CAAA;AAAA,EAAA,8DAAA,GAAA;AAMA,IAAA,eAAA,EAAA;AAEO,IAAM,gBAAN,MAA6C;AAAA,MAC1C,MAAA,uBAAkC,GAAA,EAAI;AAAA;AAAA,MAE9C,MAAM,UAAA,CAAW,GAAA,EAAa,KAAA,EAAmC;AAC/D,QAAA,MAAM,gBAAgB,gBAAA,EAAiB;AACvC,QAAA,MAAM,SAAA,GAAY,IAAA,CAAK,SAAA,CAAU,KAAK,CAAA;AACtC,QAAA,MAAM,SAAA,GAAY,OAAA,CAAQ,SAAA,EAAW,aAAa,CAAA;AAElD,QAAA,IAAA,CAAK,MAAA,CAAO,GAAA,CAAI,GAAA,EAAK,SAAS,CAAA;AAAA,MAChC;AAAA,MAEA,MAAM,SAAS,GAAA,EAA0C;AACvD,QAAA,MAAM,SAAA,GAAY,IAAA,CAAK,MAAA,CAAO,GAAA,CAAI,GAAG,CAAA;AACrC,QAAA,IAAI,CAAC,SAAA,EAAW;AACd,UAAA,OAAO,IAAA;AAAA,QACT;AAEA,QAAA,IAAI;AACF,UAAA,MAAM,gBAAgB,gBAAA,EAAiB;AACvC,UAAA,MAAM,SAAA,GAAY,OAAA,CAAQ,SAAA,EAAW,aAAa,CAAA;AAClD,UAAA,OAAO,IAAA,CAAK,MAAM,SAAS,CAAA;AAAA,QAC7B,SAAS,KAAA,EAAO;AACd,UAAA,OAAA,CAAQ,KAAA,CAAM,wCAAwC,KAAK,CAAA;AAE3D,UAAA,IAAA,CAAK,MAAA,CAAO,OAAO,GAAG,CAAA;AACtB,UAAA,OAAO,IAAA;AAAA,QACT;AAAA,MACF;AAAA,MAEA,MAAM,YAAY,GAAA,EAA4B;AAC5C,QAAA,IAAA,CAAK,MAAA,CAAO,OAAO,GAAG,CAAA;AAAA,MACxB;AAAA,MAEA,MAAM,SAAS,GAAA,EAA+B;AAC5C,QAAA,OAAO,IAAA,CAAK,MAAA,CAAO,GAAA,CAAI,GAAG,CAAA;AAAA,MAC5B;AAAA;AAAA;AAAA;AAAA,MAKA,QAAA,GAAiB;AACf,QAAA,IAAA,CAAK,OAAO,KAAA,EAAM;AAAA,MACpB;AAAA;AAAA;AAAA;AAAA,MAKA,IAAA,GAAe;AACb,QAAA,OAAO,KAAK,MAAA,CAAO,IAAA;AAAA,MACrB;AAAA,KACF;AAAA,EAAA;AAAA,CAAA,CAAA;;;AC1DA,IAQa,UAAA;AARb,IAAA,eAAA,GAAA,KAAA,CAAA;AAAA,EAAA,2CAAA,GAAA;AAMA,IAAA,kBAAA,EAAA;AAEO,IAAM,aAAN,MAAiB;AAAA,MACd,OAAA;AAAA,MACA,cAAA;AAAA,MAER,WAAA,CAAY,UAAA,GAAqB,SAAA,EAAW,OAAA,EAAyB;AACnE,QAAA,IAAA,CAAK,cAAA,GAAiB,UAAA;AAEtB,QAAA,IAAA,CAAK,OAAA,GAAU,OAAA,IAAW,IAAI,aAAA,EAAc;AAAA,MAC9C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAUQ,aAAa,MAAA,EAAyB;AAC5C,QAAA,IAAI,CAAC,MAAA,IAAU,MAAA,KAAW,SAAA,EAAW;AAEnC,UAAA,OAAO,IAAA,CAAK,cAAA;AAAA,QACd;AAEA,QAAA,OAAO,CAAA,EAAG,IAAA,CAAK,cAAc,CAAA,CAAA,EAAI,MAAM,CAAA,CAAA;AAAA,MACzC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAOA,MAAM,UAAA,CAAW,aAAA,EAAoB,MAAA,EAAgC;AAEnE,QAAA,IAAI,CAAC,cAAc,YAAA,EAAc;AAC/B,UAAA,MAAM,IAAI,MAAM,oDAAoD,CAAA;AAAA,QACtE;AAEA,QAAA,IAAI,OAAO,aAAA,CAAc,YAAA,KAAiB,QAAA,EAAU;AAClD,UAAA,MAAM,IAAI,MAAM,+BAA+B,CAAA;AAAA,QACjD;AAEA,QAAA,IAAI,aAAA,CAAc,UAAA,KAAe,MAAA,IAAa,aAAA,CAAc,aAAa,CAAA,EAAG;AAC1E,UAAA,MAAM,IAAI,MAAM,6BAA6B,CAAA;AAAA,QAC/C;AAEA,QAAA,MAAM,KAAA,GAAqB;AAAA,UACzB,cAAc,aAAA,CAAc,YAAA;AAAA,UAC5B,eAAe,aAAA,CAAc,aAAA;AAAA,UAC7B,UAAA,EAAY,cAAc,UAAA,IAAc,IAAA;AAAA,UACxC,UAAA,EAAY,cAAc,UAAA,IAAc,QAAA;AAAA,UACxC,OAAO,aAAA,CAAc,KAAA;AAAA,UACrB,WAAA,EAAa,KAAK,GAAA;AAAI,SACxB;AAEA,QAAA,MAAM,GAAA,GAAM,IAAA,CAAK,YAAA,CAAa,MAAM,CAAA;AACpC,QAAA,MAAM,IAAA,CAAK,OAAA,CAAQ,UAAA,CAAW,GAAA,EAAK,KAAK,CAAA;AAAA,MAC1C;AAAA;AAAA;AAAA;AAAA;AAAA,MAMA,MAAM,eAAe,MAAA,EAAkC;AACrD,QAAA,MAAM,GAAA,GAAM,IAAA,CAAK,YAAA,CAAa,MAAM,CAAA;AACpC,QAAA,MAAM,KAAA,GAAQ,MAAM,IAAA,CAAK,OAAA,CAAQ,SAAS,GAAG,CAAA;AAC7C,QAAA,IAAI,CAAC,KAAA,EAAO;AACV,UAAA,MAAM,IAAI,MAAM,CAAA,oBAAA,EAAuB,MAAA,GAAS,SAAS,MAAM,CAAA,CAAA,GAAK,cAAc,CAAA,CAAE,CAAA;AAAA,QACtF;AACA,QAAA,OAAO,KAAA,CAAM,YAAA;AAAA,MACf;AAAA;AAAA;AAAA;AAAA;AAAA,MAMA,MAAM,gBAAgB,MAAA,EAAkC;AACtD,QAAA,MAAM,GAAA,GAAM,IAAA,CAAK,YAAA,CAAa,MAAM,CAAA;AACpC,QAAA,MAAM,KAAA,GAAQ,MAAM,IAAA,CAAK,OAAA,CAAQ,SAAS,GAAG,CAAA;AAC7C,QAAA,IAAI,CAAC,OAAO,aAAA,EAAe;AACzB,UAAA,MAAM,IAAI,MAAM,CAAA,+BAAA,EAAkC,MAAA,GAAS,SAAS,MAAM,CAAA,CAAA,GAAK,cAAc,CAAA,CAAE,CAAA;AAAA,QACjG;AACA,QAAA,OAAO,KAAA,CAAM,aAAA;AAAA,MACf;AAAA;AAAA;AAAA;AAAA;AAAA,MAMA,MAAM,gBAAgB,MAAA,EAAmC;AACvD,QAAA,MAAM,GAAA,GAAM,IAAA,CAAK,YAAA,CAAa,MAAM,CAAA;AACpC,QAAA,MAAM,KAAA,GAAQ,MAAM,IAAA,CAAK,OAAA,CAAQ,SAAS,GAAG,CAAA;AAC7C,QAAA,OAAO,CAAC,CAAC,KAAA,EAAO,aAAA;AAAA,MAClB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAQA,MAAM,OAAA,CAAQ,aAAA,GAAwB,GAAA,EAAK,MAAA,EAAmC;AAC5E,QAAA,MAAM,GAAA,GAAM,IAAA,CAAK,YAAA,CAAa,MAAM,CAAA;AACpC,QAAA,MAAM,KAAA,GAAQ,MAAM,IAAA,CAAK,OAAA,CAAQ,SAAS,GAAG,CAAA;AAC7C,QAAA,IAAI,CAAC,KAAA,EAAO;AACV,UAAA,OAAO,KAAA;AAAA,QACT;AAEA,QAAA,MAAM,SAAA,GAAY,KAAA,CAAM,WAAA,GAAc,KAAA,CAAM,UAAA,GAAa,GAAA;AACzD,QAAA,MAAM,WAAW,aAAA,GAAgB,GAAA;AAEjC,QAAA,OAAO,IAAA,CAAK,GAAA,EAAI,GAAI,SAAA,GAAY,QAAA;AAAA,MAClC;AAAA;AAAA;AAAA;AAAA;AAAA,MAMA,MAAM,MAAM,MAAA,EAAgC;AAC1C,QAAA,MAAM,GAAA,GAAM,IAAA,CAAK,YAAA,CAAa,MAAM,CAAA;AACpC,QAAA,MAAM,IAAA,CAAK,OAAA,CAAQ,WAAA,CAAY,GAAG,CAAA;AAAA,MACpC;AAAA;AAAA;AAAA;AAAA;AAAA,MAMA,MAAM,aAAa,MAAA,EAA8C;AAC/D,QAAA,MAAM,GAAA,GAAM,IAAA,CAAK,YAAA,CAAa,MAAM,CAAA;AACpC,QAAA,OAAO,IAAA,CAAK,OAAA,CAAQ,QAAA,CAAS,GAAG,CAAA;AAAA,MAClC;AAAA,KACF;AAAA,EAAA;AAAA,CAAA,CAAA;AC1HO,SAAS,YAAA,GAAyB;AAEvC,EAAA,MAAM,YAAA,GAAe,eAAA,CAAuBA,OAAA,CAAA,WAAA,CAAY,EAAE,CAAC,CAAA;AAG3D,EAAA,MAAM,OAAcA,OAAA,CAAA,UAAA,CAAW,QAAQ,EAAE,MAAA,CAAO,YAAY,EAAE,MAAA,EAAO;AACrE,EAAA,MAAM,aAAA,GAAgB,gBAAgB,IAAI,CAAA;AAE1C,EAAA,OAAO;AAAA,IACL,YAAA;AAAA,IACA;AAAA,GACF;AACF;AAMA,SAAS,gBAAgB,MAAA,EAAwB;AAC/C,EAAA,OAAO,MAAA,CACJ,QAAA,CAAS,QAAQ,CAAA,CACjB,QAAQ,KAAA,EAAO,GAAG,CAAA,CAClB,OAAA,CAAQ,KAAA,EAAO,GAAG,CAAA,CAClB,OAAA,CAAQ,MAAM,EAAE,CAAA;AACrB;AAKO,SAAS,aAAA,GAAwB;AACtC,EAAA,OAAcA,OAAA,CAAA,WAAA,CAAY,EAAE,CAAA,CAAE,QAAA,CAAS,KAAK,CAAA;AAC9C;AAhDA,IAAA,SAAA,GAAA,KAAA,CAAA;AAAA,EAAA,oCAAA,GAAA;AAAA,EAAA;AAAA,CAAA,CAAA;;;ACAA,IASa,gBAAA;AATb,IAAA,iBAAA,GAAA,KAAA,CAAA;AAAA,EAAA,4CAAA,GAAA;AAKA,IAAA,eAAA,EAAA;AACA,IAAA,SAAA,EAAA;AAGO,IAAM,mBAAN,MAAuB;AAAA,MAU5B,YAAoB,MAAA,EAAqB;AAArB,QAAA,IAAA,CAAA,MAAA,GAAA,MAAA;AAClB,QAAA,MAAM,UAAA,GAAa,MAAA,CAAO,UAAA,IAAc,CAAA,UAAA,EAAa,OAAO,QAAQ,CAAA,CAAA;AACpE,QAAA,IAAA,CAAK,UAAA,GAAa,IAAI,UAAA,CAAW,UAAA,EAAY,OAAO,OAAO,CAAA;AAAA,MAC7D;AAAA,MAZQ,UAAA;AAAA;AAAA,MAEA,aAAA,uBAA0E,GAAA,EAAI;AAAA,MAC9E,MAAA,uBAAgE,GAAA,EAAI;AAAA;AAAA,MAEpE,YAAA,uBAAiD,GAAA,EAAI;AAAA;AAAA,MAE5C,QAAA,GAAW,KAAK,EAAA,GAAK,GAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAatC,MAAM,oBAAoB,MAAA,EAAkC;AAC1D,QAAA,IAAI,CAAC,IAAA,CAAK,MAAA,CAAO,gBAAA,EAAkB;AACjC,UAAA,MAAM,IAAI,MAAM,0DAA0D,CAAA;AAAA,QAC5E;AAEA,QAAA,IAAI,CAAC,IAAA,CAAK,MAAA,CAAO,WAAA,EAAa;AAC5B,UAAA,MAAM,IAAI,MAAM,qDAAqD,CAAA;AAAA,QACvE;AAGA,QAAA,IAAA,CAAK,kBAAA,EAAmB;AAExB,QAAA,MAAM,UAAU,MAAA,IAAU,SAAA;AAG1B,QAAA,MAAM,EAAE,YAAA,EAAc,aAAA,EAAc,GAAI,YAAA,EAAa;AACrD,QAAA,IAAA,CAAK,aAAA,CAAc,GAAA,CAAI,OAAA,EAAS,EAAE,QAAA,EAAU,cAAc,SAAA,EAAW,IAAA,CAAK,GAAA,EAAI,EAAG,CAAA;AAGjF,QAAA,MAAM,QAAQ,aAAA,EAAc;AAC5B,QAAA,IAAA,CAAK,MAAA,CAAO,IAAI,OAAA,EAAS,EAAE,OAAO,SAAA,EAAW,IAAA,CAAK,GAAA,EAAI,EAAG,CAAA;AAGzD,QAAA,MAAM,MAAA,GAAS,IAAI,eAAA,CAAgB;AAAA,UACjC,aAAA,EAAe,MAAA;AAAA,UACf,SAAA,EAAW,KAAK,MAAA,CAAO,QAAA;AAAA,UACvB,YAAA,EAAc,KAAK,MAAA,CAAO,WAAA;AAAA,UAC1B;AAAA,SACD,CAAA;AAGD,QAAA,IAAI,IAAA,CAAK,OAAO,KAAA,EAAO;AACrB,UAAA,MAAA,CAAO,MAAA,CAAO,OAAA,EAAS,IAAA,CAAK,MAAA,CAAO,KAAK,CAAA;AAAA,QAC1C;AAGA,QAAA,IAAI,IAAA,CAAK,MAAA,CAAO,OAAA,KAAY,KAAA,EAAO;AACjC,UAAA,MAAA,CAAO,MAAA,CAAO,kBAAkB,aAAa,CAAA;AAC7C,UAAA,MAAA,CAAO,MAAA,CAAO,yBAAyB,MAAM,CAAA;AAAA,QAC/C;AAIA,QAAA,MAAM,gBAAgB,MAAA,GAAS,CAAA,EAAG,KAAK,CAAA,EAAA,EAAK,MAAM,CAAA,CAAA,GAAK,KAAA;AACvD,QAAA,MAAA,CAAO,GAAA,CAAI,SAAS,aAAa,CAAA;AAEjC,QAAA,OAAO,GAAG,IAAA,CAAK,MAAA,CAAO,gBAAgB,CAAA,CAAA,EAAI,MAAA,CAAO,UAAU,CAAA,CAAA;AAAA,MAC7D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MASA,MAAM,YAAA,CAAa,IAAA,EAAc,KAAA,EAAe,MAAA,EAAgC;AAE9E,QAAA,IAAI,WAAA,GAAc,KAAA;AAClB,QAAA,IAAI,YAAA,GAAe,MAAA;AAEnB,QAAA,IAAI,KAAA,CAAM,QAAA,CAAS,IAAI,CAAA,EAAG;AACxB,UAAA,MAAM,KAAA,GAAQ,KAAA,CAAM,KAAA,CAAM,IAAI,CAAA;AAC9B,UAAA,WAAA,GAAc,MAAM,CAAC,CAAA;AACrB,UAAA,YAAA,GAAe,MAAM,CAAC,CAAA;AAAA,QACxB;AAEA,QAAA,MAAM,UAAU,YAAA,IAAgB,SAAA;AAGhC,QAAA,MAAM,SAAA,GAAY,IAAA,CAAK,MAAA,CAAO,GAAA,CAAI,OAAO,CAAA;AACzC,QAAA,IAAI,CAAC,SAAA,EAAW;AACd,UAAA,MAAM,IAAI,KAAA,CAAM,CAAA,6BAAA,EAAgC,YAAY,CAAA,mDAAA,CAAqD,CAAA;AAAA,QACnH;AAEA,QAAA,MAAM,gBAAgB,SAAA,CAAU,KAAA;AAChC,QAAA,IAAI,gBAAgB,aAAA,EAAe;AACjC,UAAA,MAAM,IAAI,MAAM,CAAA,wBAAA,EAA2B,YAAY,sCAAsC,aAAa,CAAA,OAAA,EAAU,WAAW,CAAA,CAAE,CAAA;AAAA,QACnI;AAEA,QAAA,IAAI,CAAC,IAAA,CAAK,MAAA,CAAO,WAAA,EAAa;AAC5B,UAAA,MAAM,IAAI,MAAM,yBAAyB,CAAA;AAAA,QAC3C;AAGA,QAAA,MAAM,MAAA,GAAS,IAAI,eAAA,CAAgB;AAAA,UACjC,UAAA,EAAY,oBAAA;AAAA,UACZ,IAAA;AAAA,UACA,YAAA,EAAc,KAAK,MAAA,CAAO,WAAA;AAAA,UAC1B,SAAA,EAAW,KAAK,MAAA,CAAO;AAAA,SACxB,CAAA;AAGD,QAAA,IAAI,IAAA,CAAK,OAAO,YAAA,EAAc;AAC5B,UAAA,MAAA,CAAO,MAAA,CAAO,eAAA,EAAiB,IAAA,CAAK,MAAA,CAAO,YAAY,CAAA;AAAA,QACzD;AAGA,QAAA,MAAM,YAAA,GAAe,IAAA,CAAK,aAAA,CAAc,GAAA,CAAI,OAAO,CAAA;AACnD,QAAA,IAAI,IAAA,CAAK,MAAA,CAAO,OAAA,KAAY,KAAA,IAAS,YAAA,EAAc;AACjD,UAAA,MAAA,CAAO,MAAA,CAAO,eAAA,EAAiB,YAAA,CAAa,QAAQ,CAAA;AAAA,QACtD;AAEA,QAAA,MAAM,QAAA,GAAW,MAAM,KAAA,CAAM,IAAA,CAAK,OAAO,QAAA,EAAU;AAAA,UACjD,MAAA,EAAQ,MAAA;AAAA,UACR,OAAA,EAAS;AAAA,YACP,cAAA,EAAgB;AAAA,WAClB;AAAA,UACA,IAAA,EAAM;AAAA,SACP,CAAA;AAED,QAAA,IAAI,CAAC,SAAS,EAAA,EAAI;AAChB,UAAA,MAAM,KAAA,GAAQ,MAAM,QAAA,CAAS,IAAA,EAAK;AAClC,UAAA,MAAM,IAAI,KAAA,CAAM,CAAA,uBAAA,EAA0B,QAAA,CAAS,MAAM,IAAI,QAAA,CAAS,UAAU,CAAA,GAAA,EAAM,KAAK,CAAA,CAAE,CAAA;AAAA,QAC/F;AAEA,QAAA,MAAM,IAAA,GAAY,MAAM,QAAA,CAAS,IAAA,EAAK;AAGtC,QAAA,MAAM,IAAA,CAAK,UAAA,CAAW,UAAA,CAAW,IAAA,EAAM,YAAY,CAAA;AAGnD,QAAA,IAAA,CAAK,aAAA,CAAc,OAAO,OAAO,CAAA;AACjC,QAAA,IAAA,CAAK,MAAA,CAAO,OAAO,OAAO,CAAA;AAAA,MAC5B;AAAA;AAAA;AAAA;AAAA;AAAA,MAMA,MAAM,SAAS,MAAA,EAAkC;AAC/C,QAAA,MAAM,MAAM,MAAA,IAAU,SAAA;AAGtB,QAAA,IAAI,IAAA,CAAK,YAAA,CAAa,GAAA,CAAI,GAAG,CAAA,EAAG;AAC9B,UAAA,OAAO,IAAA,CAAK,YAAA,CAAa,GAAA,CAAI,GAAG,CAAA;AAAA,QAClC;AAGA,QAAA,IAAI,MAAM,KAAK,UAAA,CAAW,OAAA,CAAQ,KAAK,MAAA,CAAO,mBAAA,EAAqB,MAAM,CAAA,EAAG;AAC1E,UAAA,OAAO,IAAA,CAAK,UAAA,CAAW,cAAA,CAAe,MAAM,CAAA;AAAA,QAC9C;AAGA,QAAA,IAAI,MAAM,IAAA,CAAK,UAAA,CAAW,eAAA,CAAgB,MAAM,CAAA,EAAG;AAEjD,UAAA,MAAM,cAAA,GAAiB,IAAA,CAAK,YAAA,CAAa,MAAM,CAAA;AAC/C,UAAA,IAAA,CAAK,YAAA,CAAa,GAAA,CAAI,GAAA,EAAK,cAAc,CAAA;AAEzC,UAAA,IAAI;AACF,YAAA,OAAO,MAAM,cAAA;AAAA,UACf,CAAA,SAAE;AAEA,YAAA,IAAA,CAAK,YAAA,CAAa,OAAO,GAAG,CAAA;AAAA,UAC9B;AAAA,QACF;AAGA,QAAA,MAAM,IAAI,MAAM,CAAA,6BAAA,EAAgC,MAAA,GAAS,SAAS,MAAM,CAAA,CAAA,GAAK,cAAc,CAAA,+CAAA,CAAiD,CAAA;AAAA,MAC9I;AAAA;AAAA;AAAA;AAAA;AAAA,MAMA,MAAM,aAAa,MAAA,EAAkC;AACnD,QAAA,MAAM,YAAA,GAAe,MAAM,IAAA,CAAK,UAAA,CAAW,gBAAgB,MAAM,CAAA;AAEjE,QAAA,MAAM,MAAA,GAAS,IAAI,eAAA,CAAgB;AAAA,UACjC,UAAA,EAAY,eAAA;AAAA,UACZ,aAAA,EAAe,YAAA;AAAA,UACf,SAAA,EAAW,KAAK,MAAA,CAAO;AAAA,SACxB,CAAA;AAGD,QAAA,IAAI,IAAA,CAAK,OAAO,YAAA,EAAc;AAC5B,UAAA,MAAA,CAAO,MAAA,CAAO,eAAA,EAAiB,IAAA,CAAK,MAAA,CAAO,YAAY,CAAA;AAAA,QACzD;AAEA,QAAA,MAAM,QAAA,GAAW,MAAM,KAAA,CAAM,IAAA,CAAK,OAAO,QAAA,EAAU;AAAA,UACjD,MAAA,EAAQ,MAAA;AAAA,UACR,OAAA,EAAS;AAAA,YACP,cAAA,EAAgB;AAAA,WAClB;AAAA,UACA,IAAA,EAAM;AAAA,SACP,CAAA;AAED,QAAA,IAAI,CAAC,SAAS,EAAA,EAAI;AAChB,UAAA,MAAM,KAAA,GAAQ,MAAM,QAAA,CAAS,IAAA,EAAK;AAClC,UAAA,MAAM,IAAI,KAAA,CAAM,CAAA,sBAAA,EAAyB,QAAA,CAAS,MAAM,IAAI,QAAA,CAAS,UAAU,CAAA,GAAA,EAAM,KAAK,CAAA,CAAE,CAAA;AAAA,QAC9F;AAEA,QAAA,MAAM,IAAA,GAAY,MAAM,QAAA,CAAS,IAAA,EAAK;AAGtC,QAAA,MAAM,IAAA,CAAK,UAAA,CAAW,UAAA,CAAW,IAAA,EAAM,MAAM,CAAA;AAE7C,QAAA,OAAO,IAAA,CAAK,YAAA;AAAA,MACd;AAAA;AAAA;AAAA;AAAA;AAAA,MAMA,MAAM,aAAa,MAAA,EAAmC;AACpD,QAAA,OAAO,KAAK,UAAA,CAAW,OAAA,CAAQ,IAAA,CAAK,MAAA,CAAO,qBAAqB,MAAM,CAAA;AAAA,MACxE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAOA,MAAM,WAAA,CAAY,aAAA,EAAwB,MAAA,EAAgC;AACxE,QAAA,IAAI,CAAC,aAAA,EAAe;AAElB,UAAA,MAAM,IAAA,CAAK,UAAA,CAAW,KAAA,CAAM,MAAM,CAAA;AAClC,UAAA;AAAA,QACF;AAEA,QAAA,IAAI;AACF,UAAA,MAAM,KAAA,GAAQ,MAAM,IAAA,CAAK,UAAA,CAAW,eAAe,MAAM,CAAA;AAEzD,UAAA,MAAM,MAAM,aAAA,EAAe;AAAA,YACzB,MAAA,EAAQ,MAAA;AAAA,YACR,OAAA,EAAS;AAAA,cACP,cAAA,EAAgB;AAAA,aAClB;AAAA,YACA,IAAA,EAAM,IAAI,eAAA,CAAgB;AAAA,cACxB,KAAA;AAAA,cACA,SAAA,EAAW,KAAK,MAAA,CAAO;AAAA,aACxB;AAAA,WACF,CAAA;AAAA,QACH,CAAA,SAAE;AAEA,UAAA,MAAM,IAAA,CAAK,UAAA,CAAW,KAAA,CAAM,MAAM,CAAA;AAAA,QACpC;AAAA,MACF;AAAA;AAAA;AAAA;AAAA;AAAA,MAMQ,kBAAA,GAA2B;AACjC,QAAA,MAAM,GAAA,GAAM,KAAK,GAAA,EAAI;AAGrB,QAAA,KAAA,MAAW,CAAC,GAAA,EAAK,IAAI,CAAA,IAAK,KAAK,aAAA,EAAe;AAC5C,UAAA,IAAI,GAAA,GAAM,IAAA,CAAK,SAAA,GAAY,IAAA,CAAK,QAAA,EAAU;AACxC,YAAA,IAAA,CAAK,aAAA,CAAc,OAAO,GAAG,CAAA;AAC7B,YAAA,IAAA,CAAK,MAAA,CAAO,OAAO,GAAG,CAAA;AAAA,UACxB;AAAA,QACF;AAAA,MACF;AAAA,KACF;AAAA,EAAA;AAAA,CAAA,CAAA;;;AC5RA,IAQa,qBAAA;AARb,IAAA,sBAAA,GAAA,KAAA,CAAA;AAAA,EAAA,iDAAA,GAAA;AAKA,IAAA,eAAA,EAAA;AAGO,IAAM,wBAAN,MAA4B;AAAA,MAGjC,YAAoB,MAAA,EAAqB;AAArB,QAAA,IAAA,CAAA,MAAA,GAAA,MAAA;AAClB,QAAA,MAAM,UAAA,GAAa,MAAA,CAAO,UAAA,IAAc,CAAA,mBAAA,EAAsB,OAAO,QAAQ,CAAA,CAAA;AAC7E,QAAA,IAAA,CAAK,UAAA,GAAa,IAAI,UAAA,CAAW,UAAA,EAAY,OAAO,OAAO,CAAA;AAAA,MAC7D;AAAA,MALQ,UAAA;AAAA;AAAA;AAAA;AAAA,MAUR,MAAM,QAAA,GAA4B;AAEhC,QAAA,IAAI,MAAM,IAAA,CAAK,UAAA,CAAW,QAAQ,IAAA,CAAK,MAAA,CAAO,mBAAmB,CAAA,EAAG;AAClE,UAAA,OAAO,IAAA,CAAK,WAAW,cAAA,EAAe;AAAA,QACxC;AAGA,QAAA,OAAO,KAAK,YAAA,EAAa;AAAA,MAC3B;AAAA;AAAA;AAAA;AAAA,MAKA,MAAc,YAAA,GAAgC;AAE5C,QAAA,MAAM,IAAA,GAAO,MAAA,CAAO,IAAA,CAAK,CAAA,EAAG,IAAA,CAAK,MAAA,CAAO,QAAQ,CAAA,CAAA,EAAI,IAAA,CAAK,MAAA,CAAO,YAAY,CAAA,CAAE,CAAA,CAAE,QAAA;AAAA,UAC9E;AAAA,SACF;AAEA,QAAA,MAAM,MAAA,GAAS,IAAI,eAAA,CAAgB;AAAA,UACjC,UAAA,EAAY;AAAA,SACb,CAAA;AAGD,QAAA,IAAI,IAAA,CAAK,OAAO,KAAA,EAAO;AACrB,UAAA,MAAA,CAAO,MAAA,CAAO,OAAA,EAAS,IAAA,CAAK,MAAA,CAAO,KAAK,CAAA;AAAA,QAC1C;AAEA,QAAA,MAAM,QAAA,GAAW,MAAM,KAAA,CAAM,IAAA,CAAK,OAAO,QAAA,EAAU;AAAA,UACjD,MAAA,EAAQ,MAAA;AAAA,UACR,OAAA,EAAS;AAAA,YACP,aAAA,EAAe,SAAS,IAAI,CAAA,CAAA;AAAA,YAC5B,cAAA,EAAgB;AAAA,WAClB;AAAA,UACA,IAAA,EAAM;AAAA,SACP,CAAA;AAED,QAAA,IAAI,CAAC,SAAS,EAAA,EAAI;AAChB,UAAA,MAAM,KAAA,GAAQ,MAAM,QAAA,CAAS,IAAA,EAAK;AAClC,UAAA,MAAM,IAAI,KAAA,CAAM,CAAA,sBAAA,EAAyB,QAAA,CAAS,MAAM,IAAI,QAAA,CAAS,UAAU,CAAA,GAAA,EAAM,KAAK,CAAA,CAAE,CAAA;AAAA,QAC9F;AAEA,QAAA,MAAM,IAAA,GAAY,MAAM,QAAA,CAAS,IAAA,EAAK;AAGtC,QAAA,MAAM,IAAA,CAAK,UAAA,CAAW,UAAA,CAAW,IAAI,CAAA;AAErC,QAAA,OAAO,IAAA,CAAK,YAAA;AAAA,MACd;AAAA;AAAA;AAAA;AAAA;AAAA,MAMA,MAAM,YAAA,GAAgC;AACpC,QAAA,MAAM,IAAA,CAAK,WAAW,KAAA,EAAM;AAC5B,QAAA,OAAO,KAAK,YAAA,EAAa;AAAA,MAC3B;AAAA;AAAA;AAAA;AAAA,MAKA,MAAM,YAAA,GAAiC;AACrC,QAAA,OAAO,IAAA,CAAK,UAAA,CAAW,OAAA,CAAQ,IAAA,CAAK,OAAO,mBAAmB,CAAA;AAAA,MAChE;AAAA,KACF;AAAA,EAAA;AAAA,CAAA,CAAA;ACpFA,IAUa,aAAA;AAVb,IAAA,cAAA,GAAA,KAAA,CAAA;AAAA,EAAA,yCAAA,GAAA;AAOA,IAAA,eAAA,EAAA;AAGO,IAAM,gBAAN,MAAoB;AAAA,MAIzB,YAAoB,MAAA,EAAqB;AAArB,QAAA,IAAA,CAAA,MAAA,GAAA,MAAA;AAClB,QAAA,MAAM,UAAA,GAAa,MAAA,CAAO,UAAA,IAAc,CAAA,WAAA,EAAc,OAAO,QAAQ,CAAA,CAAA;AACrE,QAAA,IAAA,CAAK,UAAA,GAAa,IAAI,UAAA,CAAW,UAAA,EAAY,OAAO,OAAO,CAAA;AAG3D,QAAA,IAAI,OAAO,UAAA,EAAY;AACrB,UAAA,IAAA,CAAK,aAAa,MAAA,CAAO,UAAA;AAAA,QAC3B,CAAA,MAAA,IAAW,OAAO,cAAA,EAAgB;AAChC,UAAA,IAAI;AACF,YAAA,IAAA,CAAK,UAAA,GAAgBC,IAAA,CAAA,YAAA,CAAa,MAAA,CAAO,cAAA,EAAgB,MAAM,CAAA;AAAA,UACjE,SAAS,KAAA,EAAO;AACd,YAAA,MAAM,IAAI,MAAM,CAAA,gCAAA,EAAmC,MAAA,CAAO,cAAc,CAAA,EAAA,EAAM,KAAA,CAAgB,OAAO,CAAA,CAAE,CAAA;AAAA,UACzG;AAAA,QACF,CAAA,MAAO;AACL,UAAA,MAAM,IAAI,MAAM,uDAAuD,CAAA;AAAA,QACzE;AAAA,MACF;AAAA,MAnBQ,UAAA;AAAA,MACA,UAAA;AAAA;AAAA;AAAA;AAAA,MAuBR,MAAc,WAAA,GAA+B;AAC3C,QAAA,MAAM,MAAM,IAAA,CAAK,KAAA,CAAM,IAAA,CAAK,GAAA,KAAQ,GAAI,CAAA;AACxC,QAAA,MAAM,GAAA,GAAM,IAAA,CAAK,MAAA,CAAO,eAAA,IAAmB,OAAA;AAG3C,QAAA,MAAM,GAAA,GAAM,MAAM,WAAA,CAAY,IAAA,CAAK,YAAY,GAAG,CAAA;AAGlD,QAAA,MAAM,GAAA,GAAM,MAAM,IAAI,OAAA,CAAQ;AAAA,UAC5B,KAAA,EAAO,IAAA,CAAK,MAAA,CAAO,KAAA,IAAS;AAAA,SAC7B,CAAA,CACE,kBAAA,CAAmB,EAAE,KAAK,CAAA,CAC1B,SAAA,CAAU,IAAA,CAAK,MAAA,CAAO,QAAQ,CAAA,CAC9B,UAAA,CAAW,KAAK,MAAA,CAAO,QAAQ,CAAA,CAC/B,WAAA,CAAY,IAAA,CAAK,MAAA,CAAO,QAAA,IAAY,IAAA,CAAK,OAAO,QAAQ,CAAA,CACxD,WAAA,CAAY,GAAG,EACf,iBAAA,CAAkB,GAAA,GAAM,IAAI,CAAA,CAC5B,KAAK,GAAG,CAAA;AAEX,QAAA,OAAO,GAAA;AAAA,MACT;AAAA;AAAA;AAAA;AAAA,MAKA,MAAM,QAAA,GAA4B;AAEhC,QAAA,IAAI,MAAM,IAAA,CAAK,UAAA,CAAW,QAAQ,IAAA,CAAK,MAAA,CAAO,mBAAmB,CAAA,EAAG;AAClE,UAAA,OAAO,IAAA,CAAK,WAAW,cAAA,EAAe;AAAA,QACxC;AAGA,QAAA,OAAO,KAAK,YAAA,EAAa;AAAA,MAC3B;AAAA;AAAA;AAAA;AAAA,MAKA,MAAc,YAAA,GAAgC;AAE5C,QAAA,MAAM,SAAA,GAAY,MAAM,IAAA,CAAK,WAAA,EAAY;AAGzC,QAAA,MAAM,MAAA,GAAS,IAAI,eAAA,CAAgB;AAAA,UACjC,UAAA,EAAY,6CAAA;AAAA,UACZ;AAAA,SACD,CAAA;AAED,QAAA,MAAM,QAAA,GAAW,MAAM,KAAA,CAAM,IAAA,CAAK,OAAO,QAAA,EAAU;AAAA,UACjD,MAAA,EAAQ,MAAA;AAAA,UACR,OAAA,EAAS;AAAA,YACP,cAAA,EAAgB;AAAA,WAClB;AAAA,UACA,IAAA,EAAM;AAAA,SACP,CAAA;AAED,QAAA,IAAI,CAAC,SAAS,EAAA,EAAI;AAChB,UAAA,MAAM,KAAA,GAAQ,MAAM,QAAA,CAAS,IAAA,EAAK;AAClC,UAAA,MAAM,IAAI,KAAA,CAAM,CAAA,iCAAA,EAAoC,QAAA,CAAS,MAAM,IAAI,QAAA,CAAS,UAAU,CAAA,GAAA,EAAM,KAAK,CAAA,CAAE,CAAA;AAAA,QACzG;AAEA,QAAA,MAAM,IAAA,GAAY,MAAM,QAAA,CAAS,IAAA,EAAK;AAGtC,QAAA,MAAM,IAAA,CAAK,UAAA,CAAW,UAAA,CAAW,IAAI,CAAA;AAErC,QAAA,OAAO,IAAA,CAAK,YAAA;AAAA,MACd;AAAA;AAAA;AAAA;AAAA,MAKA,MAAM,YAAA,GAAgC;AACpC,QAAA,MAAM,IAAA,CAAK,WAAW,KAAA,EAAM;AAC5B,QAAA,OAAO,KAAK,YAAA,EAAa;AAAA,MAC3B;AAAA;AAAA;AAAA;AAAA,MAKA,MAAM,YAAA,GAAiC;AACrC,QAAA,OAAO,IAAA,CAAK,UAAA,CAAW,OAAA,CAAQ,IAAA,CAAK,OAAO,mBAAmB,CAAA;AAAA,MAChE;AAAA,KACF;AAAA,EAAA;AAAA,CAAA,CAAA;;;ACtHA,IAOa,eAAA;AAPb,IAAA,gBAAA,GAAA,KAAA,CAAA;AAAA,EAAA,2CAAA,GAAA;AAOO,IAAM,kBAAN,MAAsB;AAAA,MACnB,KAAA;AAAA,MAER,YAAY,MAAA,EAAqB;AAC/B,QAAA,IAAI,CAAC,OAAO,WAAA,EAAa;AACvB,UAAA,MAAM,IAAI,MAAM,kDAAkD,CAAA;AAAA,QACpE;AAEA,QAAA,IAAA,CAAK,QAAQ,MAAA,CAAO,WAAA;AAAA,MACtB;AAAA;AAAA;AAAA;AAAA,MAKA,MAAM,QAAA,GAA4B;AAChC,QAAA,OAAO,IAAA,CAAK,KAAA;AAAA,MACd;AAAA;AAAA;AAAA;AAAA,MAKA,MAAM,YAAA,GAAgC;AACpC,QAAA,OAAO,IAAA,CAAK,KAAA;AAAA,MACd;AAAA;AAAA;AAAA;AAAA,MAKA,MAAM,YAAA,GAAiC;AACrC,QAAA,OAAO,IAAA;AAAA,MACT;AAAA;AAAA;AAAA;AAAA,MAKA,YAAY,QAAA,EAAwB;AAClC,QAAA,IAAA,CAAK,KAAA,GAAQ,QAAA;AAAA,MACf;AAAA,KACF;AAAA,EAAA;AAAA,CAAA,CAAA;;;AC7CA,IAWa;AAXb,IAAA,iBAAA,GAAA,KAAA,CAAA;AAAA,EAAA,sCAAA,GAAA;AAKA,IAAA,iBAAA,EAAA;AACA,IAAA,sBAAA,EAAA;AACA,IAAA,cAAA,EAAA;AACA,IAAA,gBAAA,EAAA;AAGO,IAAM,eAAN,MAAmB;AAAA,MAChB,IAAA;AAAA,MAER,YAAY,MAAA,EAAqB;AAE/B,QAAA,IAAA,CAAK,eAAe,MAAM,CAAA;AAG1B,QAAA,QAAQ,OAAO,IAAA;AAAM,UACnB,KAAK,oBAAA;AACH,YAAA,IAAA,CAAK,IAAA,GAAO,IAAI,gBAAA,CAAiB,MAAM,CAAA;AACvC,YAAA;AAAA,UAEF,KAAK,oBAAA;AACH,YAAA,IAAA,CAAK,IAAA,GAAO,IAAI,qBAAA,CAAsB,MAAM,CAAA;AAC5C,YAAA;AAAA,UAEF,KAAK,YAAA;AACH,YAAA,IAAA,CAAK,IAAA,GAAO,IAAI,aAAA,CAAc,MAAM,CAAA;AACpC,YAAA;AAAA,UAEF,KAAK,cAAA;AACH,YAAA,IAAA,CAAK,IAAA,GAAO,IAAI,eAAA,CAAgB,MAAM,CAAA;AACtC,YAAA;AAAA,UAEF;AACE,YAAA,MAAM,IAAI,KAAA,CAAM,CAAA,oBAAA,EAAwB,MAAA,CAAe,IAAI,CAAA,CAAE,CAAA;AAAA;AACjE,MACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAQA,MAAM,SAAS,MAAA,EAAkC;AAC/C,QAAA,OAAO,IAAA,CAAK,IAAA,CAAK,QAAA,CAAS,MAAM,CAAA;AAAA,MAClC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAOA,MAAM,aAAa,MAAA,EAAkC;AACnD,QAAA,OAAO,IAAA,CAAK,IAAA,CAAK,YAAA,CAAa,MAAM,CAAA;AAAA,MACtC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAOA,MAAM,aAAa,MAAA,EAAmC;AACpD,QAAA,OAAO,IAAA,CAAK,IAAA,CAAK,YAAA,CAAa,MAAM,CAAA;AAAA,MACtC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAWA,MAAM,cAAc,MAAA,EAAkC;AACpD,QAAA,IAAI,EAAE,IAAA,CAAK,IAAA,YAAgB,gBAAA,CAAA,EAAmB;AAC5C,UAAA,MAAM,IAAI,MAAM,+DAA+D,CAAA;AAAA,QACjF;AAEA,QAAA,OAAO,IAAA,CAAK,IAAA,CAAK,mBAAA,CAAoB,MAAM,CAAA;AAAA,MAC7C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MASA,MAAM,cAAA,CAAe,WAAA,EAAqB,MAAA,EAAgC;AACxE,QAAA,IAAI,EAAE,IAAA,CAAK,IAAA,YAAgB,gBAAA,CAAA,EAAmB;AAC5C,UAAA,MAAM,IAAI,MAAM,gEAAgE,CAAA;AAAA,QAClF;AAEA,QAAA,MAAM,GAAA,GAAM,IAAI,GAAA,CAAI,WAAW,CAAA;AAC/B,QAAA,MAAM,IAAA,GAAO,GAAA,CAAI,YAAA,CAAa,GAAA,CAAI,MAAM,CAAA;AACxC,QAAA,MAAM,KAAA,GAAQ,GAAA,CAAI,YAAA,CAAa,GAAA,CAAI,OAAO,CAAA;AAE1C,QAAA,IAAI,CAAC,IAAA,EAAM;AACT,UAAA,MAAM,IAAI,MAAM,4CAA4C,CAAA;AAAA,QAC9D;AAEA,QAAA,IAAI,CAAC,KAAA,EAAO;AACV,UAAA,MAAM,IAAI,MAAM,yCAAyC,CAAA;AAAA,QAC3D;AAEA,QAAA,MAAM,IAAA,CAAK,IAAA,CAAK,YAAA,CAAa,IAAA,EAAM,OAAO,MAAM,CAAA;AAAA,MAClD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAQA,MAAM,WAAA,CAAY,aAAA,EAAwB,MAAA,EAAgC;AACxE,QAAA,IAAI,IAAA,CAAK,gBAAgB,gBAAA,EAAkB;AACzC,UAAA,MAAM,IAAA,CAAK,IAAA,CAAK,WAAA,CAAY,aAAA,EAAe,MAAM,CAAA;AAAA,QACnD,CAAA,MAAO;AACL,UAAA,MAAM,IAAI,MAAM,gDAAgD,CAAA;AAAA,QAClE;AAAA,MACF;AAAA;AAAA,MAIQ,eAAe,MAAA,EAA2B;AAEhD,QAAA,IAAI,CAAC,OAAO,IAAA,EAAM;AAChB,UAAA,MAAM,IAAI,MAAM,8FAA8F,CAAA;AAAA,QAChH;AAGA,QAAA,IAAI,MAAA,CAAO,SAAS,cAAA,EAAgB;AAClC,UAAA,IAAI,CAAC,OAAO,QAAA,EAAU;AACpB,YAAA,MAAM,IAAI,MAAM,sBAAsB,CAAA;AAAA,UACxC;AAEA,UAAA,IAAI,CAAC,OAAO,QAAA,EAAU;AACpB,YAAA,MAAM,IAAI,MAAM,sBAAsB,CAAA;AAAA,UACxC;AAAA,QACF;AAGA,QAAA,QAAQ,OAAO,IAAA;AAAM,UACnB,KAAK,oBAAA;AACH,YAAA,IAAI,CAAC,OAAO,gBAAA,EAAkB;AAC5B,cAAA,MAAM,IAAI,MAAM,0DAA0D,CAAA;AAAA,YAC5E;AACA,YAAA,IAAI,CAAC,OAAO,WAAA,EAAa;AACvB,cAAA,MAAM,IAAI,MAAM,qDAAqD,CAAA;AAAA,YACvE;AACA,YAAA;AAAA,UAEF,KAAK,oBAAA;AACH,YAAA,IAAI,CAAC,OAAO,YAAA,EAAc;AACxB,cAAA,MAAM,IAAI,MAAM,sDAAsD,CAAA;AAAA,YACxE;AACA,YAAA;AAAA,UAEF,KAAK,YAAA;AACH,YAAA,IAAI,CAAC,MAAA,CAAO,UAAA,IAAc,CAAC,OAAO,cAAA,EAAgB;AAChD,cAAA,MAAM,IAAI,KAAA;AAAA,gBACR;AAAA,eACF;AAAA,YACF;AACA,YAAA;AAAA,UAEF,KAAK,cAAA;AACH,YAAA,IAAI,CAAC,OAAO,WAAA,EAAa;AACvB,cAAA,MAAM,IAAI,MAAM,+CAA+C,CAAA;AAAA,YACjE;AACA,YAAA;AAAA;AAIJ,QAAA,IAAI,MAAA,CAAO,OAAA,IAAW,CAAC,OAAA,CAAQ,IAAI,oBAAA,EAAsB;AACvD,UAAA,OAAA,CAAQ,IAAA;AAAA,YACN;AAAA,WAEF;AAAA,QACF;AAAA,MACF;AAAA,KACF;AAAA,EAAA;AAAA,CAAA,CAAA;AC1LA,IAkFa,gCAWA,gBAAA,CAAA,CAoBA;AAjHb,IAAA,mBAAA,GAAA,KAAA,CAAA;AAAA,EAAA,iDAAA,GAAA;AAkFO,IAAM,8BAAA,GAAuD;AAAA,MAClE,gBAAA,EAAkB,CAAA;AAAA,MAClB,gBAAA,EAAkB,CAAA;AAAA,MAClB,cAAA,EAAgB,GAAA;AAAA;AAAA,MAChB,QAAA,EAAU,GAAA;AAAA;AAAA,MACV,aAAa,MAAM;AAAA;AAAA,KACrB;AAKO,IAAM,gBAAA,GAAN,cAA+B,KAAA,CAAM;AAAA,MAC1C,WAAA,CACkB,WAAA,EACA,aAAA,EACA,YAAA,EACA,SAAA,EAChB;AACA,QAAA,MAAM,iBAAiB,IAAA,CAAK,IAAA,CAAA,CAAM,gBAAgB,IAAA,CAAK,GAAA,MAAS,GAAI,CAAA;AACpE,QAAA,KAAA;AAAA,UACE,oBAAoB,WAAW,CAAA,oBAAA,EACnB,cAAc,CAAA,IAAA,EACtB,YAAY,2BAA2B,SAAS,CAAA,CAAA;AAAA,SACtD;AAVgB,QAAA,IAAA,CAAA,WAAA,GAAA,WAAA;AACA,QAAA,IAAA,CAAA,aAAA,GAAA,aAAA;AACA,QAAA,IAAA,CAAA,YAAA,GAAA,YAAA;AACA,QAAA,IAAA,CAAA,SAAA,GAAA,SAAA;AAQhB,QAAA,IAAA,CAAK,IAAA,GAAO,kBAAA;AAAA,MACd;AAAA,KACF;AAKO,IAAM,cAAA,GAAN,cAAsC,YAAA,CAAmC;AAAA,MAuB9E,WAAA,CACkB,IAAA,EAChB,MAAA,GAAwC,EAAC,EACzC;AACA,QAAA,KAAA,EAAM;AAHU,QAAA,IAAA,CAAA,IAAA,GAAA,IAAA;AAIhB,QAAA,IAAA,CAAK,MAAA,GAAS,EAAE,GAAG,8BAAA,EAAgC,GAAG,MAAA,EAAO;AAC7D,QAAA,IAAA,CAAK,eAAA,GAAkB,KAAK,GAAA,EAAI;AAAA,MAClC;AAAA,MA7BQ,KAAA,GAAsB,QAAA;AAAA,MACtB,MAAA;AAAA;AAAA,MAGA,WAA4B,EAAC;AAAA,MAC7B,SAAA,GAAoB,EAAA;AAAA;AAAA,MAGpB,oBAAA,GAAuB,CAAA;AAAA;AAAA,MAGvB,QAAA;AAAA,MACA,eAAA;AAAA;AAAA,MAGA,aAAA,GAAgB,CAAA;AAAA,MAChB,YAAA,GAAe,CAAA;AAAA,MACf,YAAA,GAAe,CAAA;AAAA,MACf,aAAA,GAAgB,CAAA;AAAA,MAChB,eAAA;AAAA,MACA,eAAA;AAAA;AAAA;AAAA;AAAA,MAcR,MAAM,QAAQ,EAAA,EAAkC;AAC9C,QAAA,IAAA,CAAK,aAAA,EAAA;AAGL,QAAA,MAAM,GAAA,GAAM,KAAK,GAAA,EAAI;AAErB,QAAA,QAAQ,KAAK,KAAA;AAAO,UAClB,KAAK,MAAA;AAEH,YAAA,IAAI,KAAK,QAAA,IAAY,GAAA,GAAM,KAAK,QAAA,IAAY,IAAA,CAAK,OAAO,cAAA,EAAgB;AAEtE,cAAA,IAAA,CAAK,aAAa,WAAW,CAAA;AAAA,YAC/B,CAAA,MAAO;AAEL,cAAA,IAAA,CAAK,aAAA,EAAA;AACL,cAAA,MAAM,SAAA,GAAA,CAAa,IAAA,CAAK,QAAA,IAAY,GAAA,IAAO,KAAK,MAAA,CAAO,cAAA;AACvD,cAAA,MAAM,IAAI,iBAAiB,IAAA,CAAK,IAAA,EAAM,WAAW,IAAA,CAAK,QAAA,CAAS,MAAA,EAAQ,IAAA,CAAK,SAAS,CAAA;AAAA,YACvF;AACA,YAAA;AAQA;AAIJ,QAAA,IAAI;AACF,UAAA,MAAM,MAAA,GAAS,MAAM,EAAA,EAAG;AAGxB,UAAA,IAAA,CAAK,aAAA,EAAc;AAEnB,UAAA,OAAO,MAAA;AAAA,QACT,SAAS,KAAA,EAAO;AAEd,UAAA,IAAA,CAAK,cAAc,KAAc,CAAA;AAEjC,UAAA,MAAM,KAAA;AAAA,QACR;AAAA,MACF;AAAA;AAAA;AAAA;AAAA,MAKQ,aAAA,GAAsB;AAC5B,QAAA,IAAA,CAAK,YAAA,EAAA;AACL,QAAA,IAAA,CAAK,eAAA,GAAkB,KAAK,GAAA,EAAI;AAChC,QAAA,IAAA,CAAK,oBAAA,EAAA;AAEL,QAAA,IAAI,IAAA,CAAK,UAAU,WAAA,EAAa;AAE9B,UAAA,IAAI,IAAA,CAAK,oBAAA,IAAwB,IAAA,CAAK,MAAA,CAAO,gBAAA,EAAkB;AAC7D,YAAA,IAAA,CAAK,aAAa,QAAQ,CAAA;AAAA,UAC5B;AAAA,QACF,CAAA,MAAA,IAAW,IAAA,CAAK,KAAA,KAAU,QAAA,EAAU;AAElC,UAAA,IAAA,CAAK,gBAAA,EAAiB;AAAA,QACxB;AAAA,MACF;AAAA;AAAA;AAAA;AAAA,MAKQ,cAAc,KAAA,EAAoB;AAExC,QAAA,IAAI,IAAA,CAAK,OAAO,WAAA,IAAe,CAAC,KAAK,MAAA,CAAO,WAAA,CAAY,KAAK,CAAA,EAAG;AAE9D,UAAA;AAAA,QACF;AAEA,QAAA,IAAA,CAAK,YAAA,EAAA;AACL,QAAA,IAAA,CAAK,eAAA,GAAkB,KAAK,GAAA,EAAI;AAChC,QAAA,IAAA,CAAK,YAAY,KAAA,CAAM,OAAA;AAGvB,QAAA,IAAA,CAAK,oBAAA,GAAuB,CAAA;AAG5B,QAAA,IAAA,CAAK,SAAS,IAAA,CAAK;AAAA,UACjB,SAAA,EAAW,KAAK,GAAA,EAAI;AAAA,UACpB,OAAO,KAAA,CAAM;AAAA,SACd,CAAA;AAGD,QAAA,IAAA,CAAK,gBAAA,EAAiB;AAGtB,QAAA,IAAI,IAAA,CAAK,UAAU,WAAA,EAAa;AAE9B,UAAA,IAAA,CAAK,aAAa,MAAM,CAAA;AAAA,QAC1B,CAAA,MAAA,IAAW,IAAA,CAAK,KAAA,KAAU,QAAA,EAAU;AAElC,UAAA,IAAI,IAAA,CAAK,QAAA,CAAS,MAAA,IAAU,IAAA,CAAK,OAAO,gBAAA,EAAkB;AACxD,YAAA,IAAA,CAAK,aAAa,MAAM,CAAA;AAAA,UAC1B;AAAA,QACF;AAAA,MACF;AAAA;AAAA;AAAA;AAAA,MAKQ,aAAa,QAAA,EAA8B;AACjD,QAAA,IAAA,CAAK,KAAA,GAAQ,QAAA;AACb,QAAA,IAAA,CAAK,eAAA,GAAkB,KAAK,GAAA,EAAI;AAEhC,QAAA,QAAQ,QAAA;AAAU,UAChB,KAAK,MAAA;AACH,YAAA,IAAA,CAAK,QAAA,GAAW,KAAK,GAAA,EAAI;AACzB,YAAA,IAAA,CAAK,KAAK,QAAA,EAAU;AAAA,cAClB,MAAM,IAAA,CAAK,IAAA;AAAA,cACX,YAAA,EAAc,KAAK,QAAA,CAAS,MAAA;AAAA,cAC5B,WAAW,IAAA,CAAK,SAAA;AAAA,cAChB,aAAA,EAAe,IAAA,CAAK,QAAA,GAAW,IAAA,CAAK,MAAA,CAAO;AAAA,aAC5C,CAAA;AACD,YAAA;AAAA,UAEF,KAAK,WAAA;AACH,YAAA,IAAA,CAAK,KAAK,WAAA,EAAa;AAAA,cACrB,MAAM,IAAA,CAAK,IAAA;AAAA,cACX,SAAA,EAAW,KAAK,GAAA;AAAI,aACrB,CAAA;AACD,YAAA;AAAA,UAEF,KAAK,QAAA;AAEH,YAAA,IAAA,CAAK,WAAW,EAAC;AACjB,YAAA,IAAA,CAAK,oBAAA,GAAuB,CAAA;AAC5B,YAAA,IAAA,CAAK,QAAA,GAAW,MAAA;AAEhB,YAAA,IAAA,CAAK,KAAK,QAAA,EAAU;AAAA,cAClB,MAAM,IAAA,CAAK,IAAA;AAAA,cACX,cAAc,IAAA,CAAK,oBAAA;AAAA,cACnB,SAAA,EAAW,KAAK,GAAA;AAAI,aACrB,CAAA;AACD,YAAA;AAAA;AACJ,MACF;AAAA;AAAA;AAAA;AAAA,MAKQ,gBAAA,GAAyB;AAC/B,QAAA,MAAM,GAAA,GAAM,KAAK,GAAA,EAAI;AACrB,QAAA,MAAM,MAAA,GAAS,GAAA,GAAM,IAAA,CAAK,MAAA,CAAO,QAAA;AACjC,QAAA,IAAA,CAAK,QAAA,GAAW,KAAK,QAAA,CAAS,MAAA,CAAO,CAAC,CAAA,KAAM,CAAA,CAAE,YAAY,MAAM,CAAA;AAAA,MAClE;AAAA;AAAA;AAAA;AAAA,MAKA,QAAA,GAAyB;AACvB,QAAA,OAAO,IAAA,CAAK,KAAA;AAAA,MACd;AAAA;AAAA;AAAA;AAAA,MAKA,UAAA,GAAoC;AAClC,QAAA,IAAA,CAAK,gBAAA,EAAiB;AAEtB,QAAA,MAAM,KAAA,GAAQ,IAAA,CAAK,YAAA,GAAe,IAAA,CAAK,YAAA;AACvC,QAAA,MAAM,WAAA,GAAc,KAAA,GAAQ,CAAA,GAAI,IAAA,CAAK,eAAe,KAAA,GAAQ,CAAA;AAC5D,QAAA,MAAM,WAAA,GAAc,KAAA,GAAQ,CAAA,GAAI,IAAA,CAAK,eAAe,KAAA,GAAQ,CAAA;AAE5D,QAAA,OAAO;AAAA,UACL,MAAM,IAAA,CAAK,IAAA;AAAA,UACX,OAAO,IAAA,CAAK,KAAA;AAAA,UACZ,eAAe,IAAA,CAAK,aAAA;AAAA,UACpB,cAAc,IAAA,CAAK,YAAA;AAAA,UACnB,cAAc,IAAA,CAAK,YAAA;AAAA,UACnB,eAAe,IAAA,CAAK,aAAA;AAAA,UACpB,cAAA,EAAgB,KAAK,QAAA,CAAS,MAAA;AAAA,UAC9B,sBAAsB,IAAA,CAAK,oBAAA;AAAA,UAC3B,iBAAiB,IAAA,CAAK,eAAA;AAAA,UACtB,iBAAiB,IAAA,CAAK,eAAA;AAAA,UACtB,iBAAiB,IAAA,CAAK,eAAA;AAAA,UACtB,eAAe,IAAA,CAAK,QAAA,GAAW,KAAK,QAAA,GAAW,IAAA,CAAK,OAAO,cAAA,GAAiB,MAAA;AAAA,UAC5E,WAAA;AAAA,UACA;AAAA,SACF;AAAA,MACF;AAAA;AAAA;AAAA;AAAA,MAKA,KAAA,GAAc;AACZ,QAAA,IAAA,CAAK,aAAa,QAAQ,CAAA;AAC1B,QAAA,IAAA,CAAK,aAAA,GAAgB,CAAA;AACrB,QAAA,IAAA,CAAK,YAAA,GAAe,CAAA;AACpB,QAAA,IAAA,CAAK,YAAA,GAAe,CAAA;AACpB,QAAA,IAAA,CAAK,aAAA,GAAgB,CAAA;AACrB,QAAA,IAAA,CAAK,eAAA,GAAkB,MAAA;AACvB,QAAA,IAAA,CAAK,eAAA,GAAkB,MAAA;AAAA,MACzB;AAAA;AAAA;AAAA;AAAA,MAKA,MAAA,GAAkB;AAChB,QAAA,IAAI,IAAA,CAAK,KAAA,KAAU,MAAA,IAAU,IAAA,CAAK,QAAA,EAAU;AAC1C,UAAA,MAAM,GAAA,GAAM,KAAK,GAAA,EAAI;AACrB,UAAA,IAAI,GAAA,GAAM,IAAA,CAAK,QAAA,IAAY,IAAA,CAAK,OAAO,cAAA,EAAgB;AAErD,YAAA,IAAA,CAAK,aAAa,WAAW,CAAA;AAC7B,YAAA,OAAO,KAAA;AAAA,UACT;AACA,UAAA,OAAO,IAAA;AAAA,QACT;AACA,QAAA,OAAO,KAAA;AAAA,MACT;AAAA;AAAA;AAAA;AAAA,MAKA,SAAA,GAAkC;AAChC,QAAA,OAAO,EAAE,GAAG,IAAA,CAAK,MAAA,EAAO;AAAA,MAC1B;AAAA,KACF;AAAA,EAAA;AAAA,CAAA,CAAA;;;AC5TO,SAAS,gBAAA,CAAiB,OAAA,EAAiB,MAAA,GAAwB,sBAAA,EAAgC;AACxG,EAAA,IAAI,KAAA;AAEJ,EAAA,QAAQ,OAAO,QAAA;AAAU,IACvB,KAAK,aAAA;AACH,MAAA,KAAA,GAAQ,MAAA,CAAO,iBAAiB,IAAA,CAAK,GAAA,CAAI,OAAO,UAAA,IAAc,CAAA,EAAG,UAAU,CAAC,CAAA;AAC5E,MAAA;AAAA,IAEF,KAAK,QAAA;AACH,MAAA,KAAA,GAAQ,MAAA,CAAO,cAAA,GAAA,CAAkB,MAAA,CAAO,WAAA,IAAe,QAAS,OAAA,GAAU,CAAA,CAAA;AAC1E,MAAA;AAAA,IAEF,KAAK,UAAA;AACH,MAAA,KAAA,GAAQ,MAAA,CAAO,cAAA;AACf,MAAA;AAAA,IAEF;AACE,MAAA,KAAA,GAAQ,MAAA,CAAO,cAAA;AAAA;AAInB,EAAA,KAAA,GAAQ,IAAA,CAAK,GAAA,CAAI,KAAA,EAAO,MAAA,CAAO,UAAU,CAAA;AAGzC,EAAA,IAAI,OAAO,MAAA,EAAQ;AACjB,IAAA,KAAA,GAAQ,SAAA,CAAU,KAAA,EAAO,MAAA,CAAO,YAAA,IAAgB,GAAG,CAAA;AAAA,EACrD;AAEA,EAAA,OAAO,IAAA,CAAK,MAAM,KAAK,CAAA;AACzB;AASO,SAAS,SAAA,CAAU,KAAA,EAAe,MAAA,GAAiB,GAAA,EAAa;AAErE,EAAA,MAAM,cAAc,KAAA,GAAQ,MAAA;AAG5B,EAAA,MAAM,MAAA,GAAA,CAAU,IAAA,CAAK,MAAA,EAAO,GAAI,IAAI,CAAA,IAAK,WAAA;AAEzC,EAAA,OAAO,KAAA,GAAQ,MAAA;AACjB;AAKA,eAAsB,WAAA,CAAY,OAAA,EAAiB,MAAA,GAAwB,sBAAA,EAAyC;AAClH,EAAA,MAAM,KAAA,GAAQ,gBAAA,CAAiB,OAAA,EAAS,MAAM,CAAA;AAE9C,EAAA,MAAM,IAAI,OAAA,CAAQ,CAACC,aAAY,UAAA,CAAWA,QAAAA,EAAS,KAAK,CAAC,CAAA;AAEzD,EAAA,OAAO,KAAA;AACT;AAKO,UAAU,eAAA,CACf,MAAA,GAAwB,sBAAA,EACxB,WAAA,EACkC;AAClC,EAAA,IAAI,OAAA,GAAU,CAAA;AAEd,EAAA,OAAO,IAAA,EAAM;AACX,IAAA,IAAI,WAAA,IAAe,UAAU,WAAA,EAAa;AACxC,MAAA;AAAA,IACF;AAEA,IAAA,MAAM,gBAAA,CAAiB,SAAS,MAAM,CAAA;AACtC,IAAA,OAAA,EAAA;AAAA,EACF;AACF;AAUA,eAAsB,gBAAA,CACpB,EAAA,EACA,MAAA,GAAwB,sBAAA,EACxB,WAAA,EACY;AACZ,EAAA,IAAI,OAAA,GAAU,CAAA;AACd,EAAA,IAAI,SAAA;AAEJ,EAAA,OAAO,IAAA,EAAM;AACX,IAAA,OAAA,EAAA;AAEA,IAAA,IAAI;AACF,MAAA,OAAO,MAAM,EAAA,EAAG;AAAA,IAClB,SAAS,KAAA,EAAO;AACd,MAAA,SAAA,GAAY,KAAA;AAGZ,MAAA,IAAI,OAAO,WAAA,IAAe,CAAC,MAAA,CAAO,WAAA,CAAY,SAAS,CAAA,EAAG;AAExD,QAAA,MAAM,SAAA;AAAA,MACR;AAGA,MAAA,IAAI,WAAA,IAAe,WAAW,WAAA,EAAa;AACzC,QAAA,MAAM,SAAA;AAAA,MACR;AAGA,MAAA,MAAM,WAAA,CAAY,SAAS,MAAM,CAAA;AAAA,IACnC;AAAA,EACF;AACF;AA1KA,IAyCa;AAzCb,IAAA,oBAAA,GAAA,KAAA,CAAA;AAAA,EAAA,kDAAA,GAAA;AAyCO,IAAM,sBAAA,GAAwC;AAAA,MACnD,QAAA,EAAU,aAAA;AAAA,MACV,cAAA,EAAgB,GAAA;AAAA;AAAA,MAChB,UAAA,EAAY,GAAA;AAAA;AAAA,MACZ,UAAA,EAAY,CAAA;AAAA,MACZ,MAAA,EAAQ,IAAA;AAAA,MACR,YAAA,EAAc;AAAA,KAChB;AAAA,EAAA;AAAA,CAAA,CAAA;ACbA,SAAS,aAAA,CAAc,KAAc,MAAA,EAAyB;AAC5D,EAAA,MAAM,IAAA,uBAAW,OAAA,EAAQ;AAEzB,EAAA,MAAM,QAAA,GAAW,CAAC,IAAA,EAAc,KAAA,KAA4B;AAE1D,IAAA,IAAI,KAAA,KAAU,IAAA,IAAQ,KAAA,KAAU,MAAA,EAAW;AACzC,MAAA,OAAO,KAAA;AAAA,IACT;AAGA,IAAA,IAAI,OAAO,UAAU,QAAA,EAAU;AAE7B,MAAA,IAAI,OAAO,UAAU,UAAA,EAAY;AAC/B,QAAA,OAAO,YAAA;AAAA,MACT;AAEA,MAAA,IAAI,OAAO,UAAU,QAAA,EAAU;AAC7B,QAAA,OAAO,MAAM,QAAA,EAAS;AAAA,MACxB;AACA,MAAA,OAAO,KAAA;AAAA,IACT;AAGA,IAAA,MAAM,QAAA,GAAW,KAAA;AACjB,IAAA,MAAM,WAAA,GAAc,QAAA,CAAS,WAAA,EAAa,IAAA,IAAQ,EAAA;AAGlD,IAAA,IACE,gBAAgB,SAAA,IAChB,WAAA,KAAgB,YAAA,IAChB,WAAA,KAAgB,YAChB,WAAA,KAAgB,QAAA,IAChB,WAAA,KAAgB,iBAAA,IAChB,gBAAgB,gBAAA,IAChB,WAAA,KAAgB,iBAChB,WAAA,KAAgB,YAAA,IAChB,gBAAgB,cAAA,EAChB;AACA,MAAA,OAAO,IAAI,WAAW,CAAA,CAAA,CAAA;AAAA,IACxB;AAGA,IAAA,IAAI,IAAA,CAAK,GAAA,CAAI,QAAQ,CAAA,EAAG;AACtB,MAAA,OAAO,YAAA;AAAA,IACT;AAGA,IAAA,IAAI,oBAAoB,KAAA,EAAO;AAC7B,MAAA,OAAO;AAAA,QACL,MAAM,QAAA,CAAS,IAAA;AAAA,QACf,SAAS,QAAA,CAAS,OAAA;AAAA,QAClB,OAAO,QAAA,CAAS;AAAA,OAClB;AAAA,IACF;AAGA,IAAA,IAAI,oBAAoB,IAAA,EAAM;AAC5B,MAAA,OAAO,SAAS,WAAA,EAAY;AAAA,IAC9B;AAGA,IAAA,IAAI,oBAAoB,GAAA,EAAK;AAC3B,MAAA,OAAO,MAAA,CAAO,YAAY,QAAQ,CAAA;AAAA,IACpC;AAGA,IAAA,IAAI,oBAAoB,GAAA,EAAK;AAC3B,MAAA,OAAO,KAAA,CAAM,KAAK,QAAQ,CAAA;AAAA,IAC5B;AAGA,IAAA,IAAI,MAAA,CAAO,QAAA,CAAS,QAAQ,CAAA,EAAG;AAC7B,MAAA,OAAO,CAAA,QAAA,EAAW,SAAS,MAAM,CAAA,EAAA,CAAA;AAAA,IACnC;AAGA,IAAA,IAAA,CAAK,IAAI,QAAQ,CAAA;AAEjB,IAAA,OAAO,KAAA;AAAA,EACT,CAAA;AAEA,EAAA,IAAI;AACF,IAAA,OAAO,IAAA,CAAK,SAAA,CAAU,GAAA,EAAK,QAAA,EAAU,MAAM,CAAA;AAAA,EAC7C,CAAA,CAAA,MAAQ;AAEN,IAAA,OAAO,kBAAA;AAAA,EACT;AACF;AA1HA,IAuBM,kBAsIO,eAAA,CAAA,CAkRA;AA/ab,IAAA,WAAA,GAAA,KAAA,CAAA;AAAA,EAAA,4CAAA,GAAA;AAuBA,IAAM,gBAAA,GAA6C;AAAA,MACjD,KAAA,EAAO,EAAA;AAAA,MACP,KAAA,EAAO,EAAA;AAAA,MACP,IAAA,EAAM,EAAA;AAAA,MACN,IAAA,EAAM,EAAA;AAAA,MACN,KAAA,EAAO,EAAA;AAAA,MACP,MAAA,EAAQ;AAAA,KACV;AA+HO,IAAM,eAAA,GAAN,MAAM,gBAAA,CAAgB;AAAA,MACnB,MAAA;AAAA,MACA,OAAA;AAAA,MACA,UAAA;AAAA,MACA,UAAA;AAAA,MAER,WAAA,CAAY,MAAA,GAAuB,EAAC,EAAG;AACrC,QAAA,IAAA,CAAK,MAAA,GAAS;AAAA,UACZ,KAAA,EAAQ,MAAA,CAAO,KAAA,IAAS,OAAA,CAAQ,IAAI,SAAA,IAAa,MAAA;AAAA,UACjD,MAAA,EAAQ,OAAO,MAAA,KAAW,OAAA,CAAQ,IAAI,UAAA,KAAe,MAAA,IAAU,OAAA,CAAQ,GAAA,CAAI,QAAA,KAAa,aAAA,CAAA;AAAA,UACxF,WAAA,EAAa,OAAO,WAAA,IAAe,SAAA;AAAA,UACnC,OAAA,EAAS,MAAA,CAAO,OAAA,IAAW,EAAC;AAAA,UAC5B,QAAA,EAAU,MAAA,CAAO,QAAA,IAAY,OAAA,CAAQ,GAAA,CAAI;AAAA,SAC3C;AAEA,QAAA,IAAA,CAAK,OAAA,GAAU,IAAA,CAAK,MAAA,CAAO,OAAA,IAAW,EAAC;AACvC,QAAA,IAAA,CAAK,UAAA,GAAa,gBAAA,CAAiB,IAAA,CAAK,MAAA,CAAO,SAAS,MAAM,CAAA;AAG9D,QAAA,IAAI,IAAA,CAAK,OAAO,QAAA,EAAU;AACxB,UAAA,IAAA,CAAK,cAAA,CAAe,IAAA,CAAK,MAAA,CAAO,QAAQ,CAAA;AAAA,QAC1C;AAAA,MACF;AAAA;AAAA;AAAA;AAAA,MAKQ,eAAe,QAAA,EAAwB;AAC7C,QAAA,IAAI;AAEF,UAAA,MAAM,GAAA,GAAWC,cAAQ,QAAQ,CAAA;AACjC,UAAA,IAAI,CAAIC,IAAA,CAAA,UAAA,CAAW,GAAG,CAAA,EAAG;AACvB,YAAGA,IAAA,CAAA,SAAA,CAAU,GAAA,EAAK,EAAE,SAAA,EAAW,MAAM,CAAA;AAAA,UACvC;AAGA,UAAA,IAAA,CAAK,UAAA,GAAgBA,uBAAkB,QAAA,EAAU;AAAA,YAC/C,KAAA,EAAO,GAAA;AAAA;AAAA,YACP,QAAA,EAAU;AAAA,WACX,CAAA;AAGD,UAAA,IAAA,CAAK,UAAA,CAAW,EAAA,CAAG,OAAA,EAAS,CAAC,GAAA,KAAQ;AACnC,YAAA,OAAA,CAAQ,KAAA,CAAM,CAAA,4BAAA,EAA+B,GAAA,CAAI,OAAO,CAAA,CAAE,CAAA;AAC1D,YAAA,IAAA,CAAK,UAAA,GAAa,KAAA,CAAA;AAAA,UACpB,CAAC,CAAA;AAAA,QACH,SAAS,GAAA,EAAK;AACZ,UAAA,OAAA,CAAQ,MAAM,CAAA,wCAAA,EAA2C,GAAA,YAAe,QAAQ,GAAA,CAAI,OAAA,GAAU,GAAG,CAAA,CAAE,CAAA;AAAA,QACrG;AAAA,MACF;AAAA;AAAA;AAAA;AAAA,MAKA,MAAM,OAAA,EAA+C;AACnD,QAAA,OAAO,IAAI,gBAAA,CAAgB;AAAA,UACzB,GAAG,IAAA,CAAK,MAAA;AAAA,UACR,SAAS,EAAE,GAAG,IAAA,CAAK,OAAA,EAAS,GAAG,OAAA;AAAQ,SACxC,CAAA;AAAA,MACH;AAAA;AAAA;AAAA;AAAA,MAKA,KAAA,CAAM,KAAmC,GAAA,EAAoB;AAC3D,QAAA,IAAA,CAAK,GAAA,CAAI,OAAA,EAAS,GAAA,EAAK,GAAG,CAAA;AAAA,MAC5B;AAAA;AAAA;AAAA;AAAA,MAKA,KAAA,CAAM,KAAmC,GAAA,EAAoB;AAC3D,QAAA,IAAA,CAAK,GAAA,CAAI,OAAA,EAAS,GAAA,EAAK,GAAG,CAAA;AAAA,MAC5B;AAAA;AAAA;AAAA;AAAA,MAKA,IAAA,CAAK,KAAmC,GAAA,EAAoB;AAC1D,QAAA,IAAA,CAAK,GAAA,CAAI,MAAA,EAAQ,GAAA,EAAK,GAAG,CAAA;AAAA,MAC3B;AAAA;AAAA;AAAA;AAAA,MAKA,IAAA,CAAK,KAAmC,GAAA,EAAoB;AAC1D,QAAA,IAAA,CAAK,GAAA,CAAI,MAAA,EAAQ,GAAA,EAAK,GAAG,CAAA;AAAA,MAC3B;AAAA;AAAA;AAAA;AAAA,MAKA,KAAA,CAAM,KAAmC,GAAA,EAAoB;AAC3D,QAAA,IAAA,CAAK,GAAA,CAAI,OAAA,EAAS,GAAA,EAAK,GAAG,CAAA;AAAA,MAC5B;AAAA;AAAA;AAAA;AAAA,MAKQ,GAAA,CAAI,KAAA,EAAiB,GAAA,EAAmC,GAAA,EAAoB;AAElF,QAAA,IAAI,gBAAA,CAAiB,KAAK,CAAA,GAAI,IAAA,CAAK,UAAA,EAAY;AAC7C,UAAA;AAAA,QACF;AAGA,QAAA,IAAI,IAAA;AACJ,QAAA,IAAI,OAAA;AAEJ,QAAA,IAAI,OAAO,QAAQ,QAAA,EAAU;AAC3B,UAAA,OAAA,GAAU,GAAA;AACV,UAAA,IAAA,GAAO,EAAC;AAAA,QACV,CAAA,MAAO;AACL,UAAA,OAAA,GAAU,GAAA,IAAO,EAAA;AACjB,UAAA,IAAA,GAAO,GAAA;AAAA,QACT;AAGA,QAAA,MAAM,KAAA,GAAkB;AAAA,UACtB,KAAA;AAAA,UACA,IAAA,EAAM,KAAK,GAAA,EAAI;AAAA,UACf,GAAG,IAAA,CAAK,OAAA;AAAA,UACR,GAAG,IAAA;AAAA,UACH,GAAA,EAAK;AAAA,SACP;AAGA,QAAA,IAAA,CAAK,OAAO,KAAK,CAAA;AAAA,MACnB;AAAA;AAAA;AAAA;AAAA,MAKQ,OAAO,KAAA,EAAuB;AACpC,QAAA,IAAI,IAAA,CAAK,OAAO,MAAA,EAAQ;AACtB,UAAA,IAAA,CAAK,YAAY,KAAK,CAAA;AAAA,QACxB,CAAA,MAAO;AACL,UAAA,IAAA,CAAK,UAAU,KAAK,CAAA;AAAA,QACtB;AAAA,MACF;AAAA;AAAA;AAAA;AAAA,MAKQ,YAAY,KAAA,EAAuB;AACzC,QAAA,MAAM,WAAA,GAAwC;AAAA,UAC5C,KAAA,EAAO,UAAA;AAAA;AAAA,UACP,KAAA,EAAO,UAAA;AAAA;AAAA,UACP,IAAA,EAAM,UAAA;AAAA;AAAA,UACN,IAAA,EAAM,UAAA;AAAA;AAAA,UACN,KAAA,EAAO,UAAA;AAAA;AAAA,UACP,MAAA,EAAQ;AAAA,SACV;AAEA,QAAA,MAAM,KAAA,GAAQ,SAAA;AACd,QAAA,MAAM,QAAQ,IAAA,CAAK,UAAA,GAAa,KAAK,WAAA,CAAY,KAAA,CAAM,KAAK,CAAA,IAAK,EAAA;AAGjE,QAAA,MAAM,IAAA,GAAO,IAAI,IAAA,CAAK,KAAA,CAAM,IAAI,EAAE,WAAA,EAAY,CAAE,SAAA,CAAU,EAAA,EAAI,EAAE,CAAA;AAGhE,QAAA,MAAM,WAAW,KAAA,CAAM,KAAA,CAAM,WAAA,EAAY,CAAE,OAAO,CAAC,CAAA;AAGnD,QAAA,MAAM,eAAyB,EAAC;AAChC,QAAA,KAAA,MAAW,CAAC,GAAA,EAAK,KAAK,KAAK,MAAA,CAAO,OAAA,CAAQ,KAAK,CAAA,EAAG;AAChD,UAAA,IAAI,GAAA,KAAQ,OAAA,IAAW,GAAA,KAAQ,MAAA,IAAU,QAAQ,KAAA,EAAO;AACtD,YAAA,YAAA,CAAa,KAAK,CAAA,EAAG,GAAG,IAAI,aAAA,CAAc,KAAK,CAAC,CAAA,CAAE,CAAA;AAAA,UACpD;AAAA,QACF;AACA,QAAA,MAAM,OAAA,GAAU,aAAa,MAAA,GAAS,CAAA,GAAI,IAAI,YAAA,CAAa,IAAA,CAAK,GAAG,CAAC,CAAA,CAAA,GAAK,EAAA;AAGzE,QAAA,MAAM,MAAA,GAAS,CAAA,EAAG,KAAK,CAAA,CAAA,EAAI,IAAI,CAAA,EAAA,EAAK,QAAQ,CAAA,EAAG,KAAK,CAAA,CAAA,EAAI,KAAA,CAAM,GAAG,GAAG,OAAO,CAAA,CAAA;AAG3E,QAAA,IAAI,KAAK,UAAA,EAAY;AAEnB,UAAA,MAAM,WAAA,GAAc,MAAA,CAAO,OAAA,CAAQ,iBAAA,EAAmB,EAAE,CAAA;AACxD,UAAA,IAAA,CAAK,UAAA,CAAW,KAAA,CAAM,WAAA,GAAc,IAAI,CAAA;AACxC,UAAA;AAAA,QACF;AAGA,QAAA,QAAQ,MAAM,KAAA;AAAO,UACnB,KAAK,OAAA;AAAA,UACL,KAAK,MAAA;AACH,YAAA,OAAA,CAAQ,MAAM,MAAM,CAAA;AACpB,YAAA;AAAA,UACF;AACE,YAAA,OAAA,CAAQ,IAAI,MAAM,CAAA;AAAA;AACtB,MACF;AAAA;AAAA;AAAA;AAAA,MAKQ,UAAU,KAAA,EAAuB;AACvC,QAAA,MAAM,IAAA,GAAO,cAAc,KAAK,CAAA;AAGhC,QAAA,IAAI,KAAK,UAAA,EAAY;AACnB,UAAA,IAAA,CAAK,UAAA,CAAW,KAAA,CAAM,IAAA,GAAO,IAAI,CAAA;AACjC,UAAA;AAAA,QACF;AAGA,QAAA,QAAQ,IAAA,CAAK,OAAO,WAAA;AAAa,UAC/B,KAAK,QAAA;AACH,YAAA,OAAA,CAAQ,MAAM,IAAI,CAAA;AAClB,YAAA;AAAA,UACF;AACE,YAAA,OAAA,CAAQ,IAAI,IAAI,CAAA;AAAA;AACpB,MACF;AAAA;AAAA;AAAA;AAAA,MAKA,aAAa,MAAA,EAAqC;AAChD,QAAA,IAAA,CAAK,SAAS,EAAE,GAAG,IAAA,CAAK,MAAA,EAAQ,GAAG,MAAA,EAAO;AAE1C,QAAA,IAAI,OAAO,KAAA,EAAO;AAChB,UAAA,IAAA,CAAK,UAAA,GAAa,gBAAA,CAAiB,MAAA,CAAO,KAAK,CAAA;AAAA,QACjD;AAEA,QAAA,IAAI,OAAO,OAAA,EAAS;AAClB,UAAA,IAAA,CAAK,UAAU,EAAE,GAAG,KAAK,OAAA,EAAS,GAAG,OAAO,OAAA,EAAQ;AAAA,QACtD;AAGA,QAAA,IAAI,MAAA,CAAO,aAAa,MAAA,EAAW;AACjC,UAAA,IAAA,CAAK,eAAA,EAAgB;AACrB,UAAA,IAAI,OAAO,QAAA,EAAU;AACnB,YAAA,IAAA,CAAK,cAAA,CAAe,OAAO,QAAQ,CAAA;AAAA,UACrC;AAAA,QACF;AAAA,MACF;AAAA;AAAA;AAAA;AAAA,MAKQ,eAAA,GAAwB;AAC9B,QAAA,IAAI,KAAK,UAAA,EAAY;AACnB,UAAA,IAAA,CAAK,WAAW,GAAA,EAAI;AACpB,UAAA,IAAA,CAAK,UAAA,GAAa,MAAA;AAAA,QACpB;AAAA,MACF;AAAA;AAAA;AAAA;AAAA,MAKA,KAAA,GAAc;AACZ,QAAA,IAAA,CAAK,eAAA,EAAgB;AAAA,MACvB;AAAA;AAAA;AAAA;AAAA,MAKA,QAAA,GAAqB;AACnB,QAAA,OAAO,IAAA,CAAK,OAAO,KAAA,IAAS,MAAA;AAAA,MAC9B;AAAA;AAAA;AAAA;AAAA,MAKA,eAAe,KAAA,EAA0B;AACvC,QAAA,OAAO,gBAAA,CAAiB,KAAK,CAAA,IAAK,IAAA,CAAK,UAAA;AAAA,MACzC;AAAA,KACF;AAKO,IAAM,MAAA,GAAS,IAAI,eAAA,CAAgB;AAAA,MACxC,KAAA,EAAQ,OAAA,CAAQ,GAAA,CAAI,SAAA,IAA0B,MAAA;AAAA,MAC9C,QAAQ,OAAA,CAAQ,GAAA,CAAI,eAAe,MAAA,IAAU,OAAA,CAAQ,IAAI,QAAA,KAAa,aAAA;AAAA,MACtE,QAAA,EAAU,QAAQ,GAAA,CAAI;AAAA,KACvB,CAAA;AAKD,IAAA,OAAA,CAAQ,EAAA,CAAG,QAAQ,MAAM;AACvB,MAAA,MAAA,CAAO,KAAA,EAAM;AAAA,IACf,CAAC,CAAA;AAED,IAAA,OAAA,CAAQ,EAAA,CAAG,UAAU,MAAM;AACzB,MAAA,MAAA,CAAO,KAAA,EAAM;AACb,MAAA,OAAA,CAAQ,KAAK,CAAC,CAAA;AAAA,IAChB,CAAC,CAAA;AAED,IAAA,OAAA,CAAQ,EAAA,CAAG,WAAW,MAAM;AAC1B,MAAA,MAAA,CAAO,KAAA,EAAM;AACb,MAAA,OAAA,CAAQ,KAAK,CAAC,CAAA;AAAA,IAChB,CAAC,CAAA;AAAA,EAAA;AAAA,CAAA,CAAA;;;ACrQM,SAAS,sBAAA,CAAuB,MAA6B,MAAA,EAAmC;AACrG,EAAA,MAAM,aAAA,GAAgB,IAAA,IAAS,OAAA,CAAQ,GAAA,CAAI,iBAAA,IAA8C,MAAA;AAEzF,EAAA,QAAQ,aAAA;AAAe,IACrB,KAAK,SAAA;AACH,MAAA,OAAO,IAAI,eAAe,MAAM,CAAA;AAAA,IAClC,KAAK,UAAA;AACH,MAAA,OAAO,IAAI,eAAA,EAAgB;AAAA,IAC7B;AACE,MAAA,OAAO,IAAI,WAAA,EAAY;AAAA;AAE7B;AAaO,SAAS,oBAAoB,SAAA,EAAmC;AACrE,EAAA,MAAA,CAAO,MAAA,CAAO,SAAS,SAAS,CAAA;AAClC;AAzNA,IAuCa,WAAA,CAAA,CAUA,gBAiCA,eAAA,CAAA,CA6HA;AA/Mb,IAAA,YAAA,GAAA,KAAA,CAAA;AAAA,EAAA,6CAAA,GAAA;AAuCO,IAAM,cAAN,MAA8C;AAAA,MACnD,SAAA,GAAkB;AAAA,MAAC;AAAA,MACnB,KAAA,GAAc;AAAA,MAAC;AAAA,MACf,MAAA,GAAe;AAAA,MAAC;AAAA,MAChB,SAAA,GAAkB;AAAA,MAAC;AAAA,KACrB;AAKO,IAAM,iBAAN,MAAiD;AAAA,MAC9C,MAAA;AAAA,MAER,WAAA,CAAY,SAAiB,WAAA,EAAa;AACxC,QAAA,IAAA,CAAK,MAAA,GAAS,MAAA;AAAA,MAChB;AAAA,MAEA,SAAA,CAAU,MAAA,EAAgB,KAAA,GAAgB,CAAA,EAAG,IAAA,EAAyB;AACpE,QAAA,IAAA,CAAK,GAAA,CAAI,SAAA,EAAW,MAAA,EAAQ,KAAA,EAAO,IAAI,CAAA;AAAA,MACzC;AAAA,MAEA,KAAA,CAAM,MAAA,EAAgB,KAAA,EAAe,IAAA,EAAyB;AAC5D,QAAA,IAAA,CAAK,GAAA,CAAI,OAAA,EAAS,MAAA,EAAQ,KAAA,EAAO,IAAI,CAAA;AAAA,MACvC;AAAA,MAEA,MAAA,CAAO,MAAA,EAAgB,QAAA,EAAkB,IAAA,EAAyB;AAChE,QAAA,IAAA,CAAK,IAAI,QAAA,EAAU,MAAA,EAAQ,CAAA,EAAG,QAAQ,MAAM,IAAI,CAAA;AAAA,MAClD;AAAA,MAEA,SAAA,CAAU,MAAA,EAAgB,KAAA,EAAe,IAAA,EAAyB;AAChE,QAAA,IAAA,CAAK,GAAA,CAAI,WAAA,EAAa,MAAA,EAAQ,KAAA,EAAO,IAAI,CAAA;AAAA,MAC3C;AAAA,MAEQ,GAAA,CAAI,IAAA,EAAc,MAAA,EAAgB,KAAA,EAAY,IAAA,EAAyB;AAC7E,QAAA,MAAM,UAAA,GAAa,CAAA,EAAG,IAAA,CAAK,MAAM,IAAI,MAAM,CAAA,CAAA;AAC3C,QAAA,MAAM,UAAU,IAAA,GAAO,CAAA,CAAA,EAAI,KAAK,SAAA,CAAU,IAAI,CAAC,CAAA,CAAA,GAAK,EAAA;AACpD,QAAA,OAAA,CAAQ,GAAA,CAAI,WAAW,IAAI,CAAA,EAAA,EAAK,UAAU,CAAA,CAAA,EAAI,KAAK,CAAA,EAAG,OAAO,CAAA,CAAE,CAAA;AAAA,MACjE;AAAA,KACF;AAKO,IAAM,kBAAN,MAAkD;AAAA,MAC/C,QAAA,uBAAe,GAAA,EAAoB;AAAA,MACnC,MAAA,uBAAa,GAAA,EAAoB;AAAA,MACjC,OAAA,uBAAc,GAAA,EAAsB;AAAA,MACpC,UAAA,uBAAiB,GAAA,EAAsB;AAAA,MAE/C,SAAA,CAAU,MAAA,EAAgB,KAAA,GAAgB,CAAA,EAAG,IAAA,EAAyB;AACpE,QAAA,MAAM,GAAA,GAAM,IAAA,CAAK,OAAA,CAAQ,MAAA,EAAQ,IAAI,CAAA;AACrC,QAAA,IAAA,CAAK,QAAA,CAAS,IAAI,GAAA,EAAA,CAAM,IAAA,CAAK,SAAS,GAAA,CAAI,GAAG,CAAA,IAAK,CAAA,IAAK,KAAK,CAAA;AAAA,MAC9D;AAAA,MAEA,KAAA,CAAM,MAAA,EAAgB,KAAA,EAAe,IAAA,EAAyB;AAC5D,QAAA,MAAM,GAAA,GAAM,IAAA,CAAK,OAAA,CAAQ,MAAA,EAAQ,IAAI,CAAA;AACrC,QAAA,IAAA,CAAK,MAAA,CAAO,GAAA,CAAI,GAAA,EAAK,KAAK,CAAA;AAAA,MAC5B;AAAA,MAEA,MAAA,CAAO,MAAA,EAAgB,QAAA,EAAkB,IAAA,EAAyB;AAChE,QAAA,MAAM,GAAA,GAAM,IAAA,CAAK,OAAA,CAAQ,MAAA,EAAQ,IAAI,CAAA;AACrC,QAAA,MAAM,UAAU,IAAA,CAAK,OAAA,CAAQ,GAAA,CAAI,GAAG,KAAK,EAAC;AAC1C,QAAA,OAAA,CAAQ,KAAK,QAAQ,CAAA;AACrB,QAAA,IAAA,CAAK,OAAA,CAAQ,GAAA,CAAI,GAAA,EAAK,OAAO,CAAA;AAAA,MAC/B;AAAA,MAEA,SAAA,CAAU,MAAA,EAAgB,KAAA,EAAe,IAAA,EAAyB;AAChE,QAAA,MAAM,GAAA,GAAM,IAAA,CAAK,OAAA,CAAQ,MAAA,EAAQ,IAAI,CAAA;AACrC,QAAA,MAAM,SAAS,IAAA,CAAK,UAAA,CAAW,GAAA,CAAI,GAAG,KAAK,EAAC;AAC5C,QAAA,MAAA,CAAO,KAAK,KAAK,CAAA;AACjB,QAAA,IAAA,CAAK,UAAA,CAAW,GAAA,CAAI,GAAA,EAAK,MAAM,CAAA;AAAA,MACjC;AAAA,MAEQ,OAAA,CAAQ,QAAgB,IAAA,EAA2B;AACzD,QAAA,IAAI,CAAC,MAAM,OAAO,MAAA;AAClB,QAAA,MAAM,MAAA,GAAS,OAAO,OAAA,CAAQ,IAAI,EAC/B,GAAA,CAAI,CAAC,CAAC,CAAA,EAAG,CAAC,MAAM,CAAA,EAAG,CAAC,IAAI,CAAC,CAAA,CAAE,EAC3B,IAAA,EAAK,CACL,KAAK,GAAG,CAAA;AACX,QAAA,OAAO,CAAA,EAAG,MAAM,CAAA,CAAA,EAAI,MAAM,CAAA,CAAA,CAAA;AAAA,MAC5B;AAAA;AAAA;AAAA;AAAA,MAKA,UAAA,GAKE;AACA,QAAA,OAAO;AAAA,UACL,QAAA,EAAU,IAAI,GAAA,CAAI,IAAA,CAAK,QAAQ,CAAA;AAAA,UAC/B,MAAA,EAAQ,IAAI,GAAA,CAAI,IAAA,CAAK,MAAM,CAAA;AAAA,UAC3B,OAAA,EAAS,IAAI,GAAA,CAAI,IAAA,CAAK,OAAO,CAAA;AAAA,UAC7B,UAAA,EAAY,IAAI,GAAA,CAAI,IAAA,CAAK,UAAU;AAAA,SACrC;AAAA,MACF;AAAA;AAAA;AAAA;AAAA,MAKA,KAAA,GAAc;AACZ,QAAA,IAAA,CAAK,SAAS,KAAA,EAAM;AACpB,QAAA,IAAA,CAAK,OAAO,KAAA,EAAM;AAClB,QAAA,IAAA,CAAK,QAAQ,KAAA,EAAM;AACnB,QAAA,IAAA,CAAK,WAAW,KAAA,EAAM;AAAA,MACxB;AAAA;AAAA;AAAA;AAAA,MAKA,cAAA,CAAe,QAAgB,IAAA,EAQtB;AACP,QAAA,MAAM,GAAA,GAAM,IAAA,CAAK,OAAA,CAAQ,MAAA,EAAQ,IAAI,CAAA;AACrC,QAAA,MAAM,OAAA,GAAU,IAAA,CAAK,OAAA,CAAQ,GAAA,CAAI,GAAG,CAAA;AAEpC,QAAA,IAAI,CAAC,OAAA,IAAW,OAAA,CAAQ,MAAA,KAAW,CAAA,EAAG;AACpC,UAAA,OAAO,IAAA;AAAA,QACT;AAEA,QAAA,MAAM,MAAA,GAAS,CAAC,GAAG,OAAO,CAAA,CAAE,KAAK,CAAC,CAAA,EAAG,CAAA,KAAM,CAAA,GAAI,CAAC,CAAA;AAChD,QAAA,MAAM,QAAQ,MAAA,CAAO,MAAA;AACrB,QAAA,MAAM,GAAA,GAAM,OAAO,MAAA,CAAO,CAAC,GAAG,CAAA,KAAM,CAAA,GAAI,GAAG,CAAC,CAAA;AAE5C,QAAA,OAAO;AAAA,UACL,KAAA;AAAA,UACA,GAAA,EAAK,MAAA,CAAO,CAAC,CAAA,IAAK,CAAA;AAAA,UAClB,GAAA,EAAK,MAAA,CAAO,KAAA,GAAQ,CAAC,CAAA,IAAK,CAAA;AAAA,UAC1B,MAAM,GAAA,GAAM,KAAA;AAAA,UACZ,KAAK,MAAA,CAAO,IAAA,CAAK,MAAM,KAAA,GAAQ,GAAG,CAAC,CAAA,IAAK,CAAA;AAAA,UACxC,KAAK,MAAA,CAAO,IAAA,CAAK,MAAM,KAAA,GAAQ,IAAI,CAAC,CAAA,IAAK,CAAA;AAAA,UACzC,KAAK,MAAA,CAAO,IAAA,CAAK,MAAM,KAAA,GAAQ,IAAI,CAAC,CAAA,IAAK;AAAA,SAC3C;AAAA,MACF;AAAA,KACF;AA0BO,IAAM,OAAA,GAA4B,sBAAA;AAAA,MACvC,MAAA;AAAA,MACA,OAAA,CAAQ,IAAI,cAAA,IAAkB;AAAA,KAChC;AAAA,EAAA;AAAA,CAAA,CAAA;;;AClNA,IAAA,iBAAA,GAAA,EAAA;AAAA,QAAA,CAAA,iBAAA,EAAA;AAAA,EAAA,SAAA,EAAA,MAAA,SAAA;AAAA,EAAA,qBAAA,EAAA,MAAA,qBAAA;AAAA,EAAA,yBAAA,EAAA,MAAA,yBAAA;AAAA,EAAA,oBAAA,EAAA,MAAA,oBAAA;AAAA,EAAA,mBAAA,EAAA,MAAA,mBAAA;AAAA,EAAA,0BAAA,EAAA,MAAA;AAAA,CAAA,CAAA;AAAA,IA2Ba,yBAAA,CAAA,CACA,mBAAA,CAAA,CACA,0BAAA,CAAA,CACA,qBAAA,CAAA,CACA,oBAAA,CAAA,CAiBA;AAhDb,IAAA,cAAA,GAAA,KAAA,CAAA;AAAA,EAAA,uBAAA,GAAA;AAgBA,IAAA,iBAAA,EAAA;AACA,IAAA,kBAAA,EAAA;AAEA,IAAA,mBAAA,EAAA;AACA,IAAA,oBAAA,EAAA;AACA,IAAA,WAAA,EAAA;AACA,IAAA,YAAA,EAAA;AAKO,IAAM,yBAAA,GAA4B,GAAA;AAClC,IAAM,mBAAA,GAAsB,CAAA;AAC5B,IAAM,6BAA6B,CAAC,GAAA,EAAK,GAAA,EAAK,GAAA,EAAK,KAAK,GAAG,CAAA;AAC3D,IAAM,qBAAA,GAAwB,GAAA;AAC9B,IAAM,oBAAA,GAAuB,GAAA;AAiB7B,IAAM,SAAA,GAAN,MAAM,UAAA,CAAU;AAAA;AAAA,MAGrB,OAAe,QAAA,mBAAmC,IAAI,GAAA,EAAI;AAAA,MAC1D,OAAe,cAAA,GAAgC,IAAI,aAAA,EAAc;AAAA;AAAA;AAAA;AAAA;AAAA,MAMjE,OAAO,OAAO,MAAA,EAAuD;AACnE,QAAA,IAAI,CAAC,OAAO,IAAA,IAAQ,MAAA,CAAO,KAAK,IAAA,EAAK,CAAE,WAAW,CAAA,EAAG;AACnD,UAAA,MAAM,IAAI,MAAM,4BAA4B,CAAA;AAAA,QAC9C;AACA,QAAA,IAAI,UAAA,CAAU,QAAA,CAAS,GAAA,CAAI,MAAA,CAAO,IAAI,CAAA,EAAG;AACvC,UAAA,MAAM,IAAI,KAAA,CAAM,CAAA,WAAA,EAAc,MAAA,CAAO,IAAI,CAAA,iEAAA,CAAmE,CAAA;AAAA,QAC9G;AACA,QAAA,MAAM,SAAA,GAAY,IAAI,UAAA,CAAU,MAAM,CAAA;AACtC,QAAA,UAAA,CAAU,QAAA,CAAS,GAAA,CAAI,MAAA,CAAO,IAAA,EAAM,SAAS,CAAA;AAC7C,QAAA,OAAO,SAAA;AAAA,MACT;AAAA;AAAA;AAAA;AAAA,MAKA,OAAO,IAAI,IAAA,EAAyB;AAClC,QAAA,MAAM,SAAA,GAAY,UAAA,CAAU,QAAA,CAAS,GAAA,CAAI,IAAI,CAAA;AAC7C,QAAA,IAAI,CAAC,SAAA,EAAW;AACd,UAAA,MAAM,YAAY,UAAA,CAAU,IAAA,EAAK,CAAE,IAAA,CAAK,IAAI,CAAA,IAAK,MAAA;AACjD,UAAA,MAAM,IAAI,KAAA,CAAM,CAAA,WAAA,EAAc,IAAI,CAAA,wBAAA,EAA2B,SAAS,CAAA,CAAE,CAAA;AAAA,QAC1E;AACA,QAAA,OAAO,SAAA;AAAA,MACT;AAAA;AAAA;AAAA;AAAA,MAKA,OAAO,IAAI,IAAA,EAAuB;AAChC,QAAA,OAAO,UAAA,CAAU,QAAA,CAAS,GAAA,CAAI,IAAI,CAAA;AAAA,MACpC;AAAA;AAAA;AAAA;AAAA,MAKA,OAAO,IAAA,GAAiB;AACtB,QAAA,OAAO,KAAA,CAAM,IAAA,CAAK,UAAA,CAAU,QAAA,CAAS,MAAM,CAAA;AAAA,MAC7C;AAAA;AAAA;AAAA;AAAA,MAKA,OAAO,OAAO,IAAA,EAAuB;AACnC,QAAA,MAAM,SAAA,GAAY,UAAA,CAAU,QAAA,CAAS,GAAA,CAAI,IAAI,CAAA;AAC7C,QAAA,IAAI,SAAA,EAAW;AACb,UAAA,SAAA,CAAU,OAAA,EAAQ;AAAA,QACpB;AACA,QAAA,OAAO,UAAA,CAAU,QAAA,CAAS,MAAA,CAAO,IAAI,CAAA;AAAA,MACvC;AAAA;AAAA;AAAA;AAAA,MAKA,OAAO,KAAA,GAAc;AACnB,QAAA,KAAA,MAAW,SAAA,IAAa,UAAA,CAAU,QAAA,CAAS,MAAA,EAAO,EAAG;AACnD,UAAA,SAAA,CAAU,OAAA,EAAQ;AAAA,QACpB;AACA,QAAA,UAAA,CAAU,SAAS,KAAA,EAAM;AAAA,MAC3B;AAAA;AAAA;AAAA;AAAA,MAKA,OAAO,kBAAkB,OAAA,EAA8B;AACrD,QAAA,UAAA,CAAU,cAAA,GAAiB,OAAA;AAAA,MAC7B;AAAA;AAAA;AAAA;AAAA,MAKA,OAAO,OAAA,GAAuB;AAC5B,QAAA,OAAO,KAAA,CAAM,IAAA,CAAK,UAAA,CAAU,QAAA,CAAS,QAAQ,CAAA;AAAA,MAC/C;AAAA;AAAA;AAAA;AAAA,MAKA,OAAO,IAAA,GAAe;AACpB,QAAA,OAAO,WAAU,QAAA,CAAS,IAAA;AAAA,MAC5B;AAAA;AAAA;AAAA;AAAA;AAAA,MAMA,OAAO,uBAAA,GAAkC;AACvC,QAAA,MAAM,UAAA,GAAa,WAAU,OAAA,EAAQ;AAErC,QAAA,IAAI,UAAA,CAAW,WAAW,CAAA,EAAG;AAC3B,UAAA,OAAO,+BAAA;AAAA,QACT;AAEA,QAAA,OAAO,WACJ,GAAA,CAAI,CAAC,MAAM,CAAA,KAAA,EAAQ,CAAA,CAAE,IAAI,CAAA,GAAA,EAAM,CAAA,CAAE,WAAW,CAAA,GAAA,EAAM,EAAE,MAAA,CAAO,WAAA,IAAe,gBAAgB,CAAA,CAAE,CAAA,CAC5F,KAAK,IAAI,CAAA;AAAA,MACd;AAAA;AAAA;AAAA;AAAA,MAKA,OAAO,OAAA,GAAyF;AAC9F,QAAA,MAAM,OAAsF,EAAC;AAE7F,QAAA,KAAA,MAAW,SAAA,IAAa,UAAA,CAAU,QAAA,CAAS,MAAA,EAAO,EAAG;AACnD,UAAA,IAAA,CAAK,SAAA,CAAU,IAAI,CAAA,GAAI;AAAA,YACrB,aAAa,SAAA,CAAU,WAAA;AAAA,YACvB,WAAA,EAAa,SAAA,CAAU,MAAA,CAAO,WAAA,IAAe,EAAA;AAAA,YAC7C,SAAS,SAAA,CAAU;AAAA,WACrB;AAAA,QACF;AAEA,QAAA,OAAO,IAAA;AAAA,MACT;AAAA;AAAA,MAIS,IAAA;AAAA,MACA,MAAA;AAAA,MACA,MAAA;AAAA,MAED,YAAA;AAAA,MACA,cAAA;AAAA,MACA,QAAA,GAAW,KAAA;AAAA;AAAA,MAGX,YAAA,GAAe,CAAA;AAAA,MACf,YAAA,GAAe,CAAA;AAAA,MACf,YAAA,GAAe,CAAA;AAAA,MACf,cAAA,GAAiB,CAAA;AAAA,MAEjB,YAAY,MAAA,EAA4C;AAC9D,QAAA,IAAA,CAAK,OAAO,MAAA,CAAO,IAAA;AACnB,QAAA,IAAA,CAAK,SAAS,MAAA,CAAO,MAAA;AACrB,QAAA,IAAA,CAAK,MAAA,GAAS,MAAA;AAGd,QAAA,IAAI,MAAA,CAAO,IAAA,CAAK,IAAA,KAAS,OAAA,EAAS;AAChC,UAAA,IAAA,CAAK,gBAAA,CAAiB,OAAO,IAAI,CAAA;AAAA,QACnC,CAAA,MAAA,IAAW,MAAA,CAAO,IAAA,CAAK,IAAA,KAAS,KAAA,EAAO;AACrC,UAAA,IAAA,CAAK,cAAA,CAAe,OAAO,IAAI,CAAA;AAAA,QACjC;AAGA,QAAA,IAAA,CAAK,kBAAA,EAAmB;AAAA,MAC1B;AAAA;AAAA;AAAA;AAAA,MAKQ,kBAAA,GAA2B;AACjC,QAAA,MAAM,QAAA,GAAW,KAAK,MAAA,CAAO,cAAA;AAC7B,QAAA,MAAM,OAAA,GAAU,UAAU,OAAA,IAAW,IAAA;AAErC,QAAA,IAAI,OAAA,EAAS;AACX,UAAA,IAAA,CAAK,iBAAiB,IAAI,cAAA,CAAe,CAAA,UAAA,EAAa,IAAA,CAAK,IAAI,CAAA,CAAA,EAAI;AAAA,YACjE,gBAAA,EAAkB,UAAU,gBAAA,IAAoB,CAAA;AAAA,YAChD,gBAAA,EAAkB,UAAU,gBAAA,IAAoB,CAAA;AAAA,YAChD,cAAA,EAAgB,UAAU,cAAA,IAAkB,GAAA;AAAA,YAC5C,QAAA,EAAU,GAAA;AAAA;AAAA,YACV,WAAA,EAAa,CAAC,KAAA,KAAU;AAEtB,cAAA,IAAI,KAAA,CAAM,OAAA,CAAQ,QAAA,CAAS,QAAQ,CAAA,IAAK,CAAC,KAAA,CAAM,OAAA,CAAQ,QAAA,CAAS,UAAU,CAAA,EAAG;AAC3E,gBAAA,OAAO,KAAA;AAAA,cACT;AACA,cAAA,OAAO,IAAA;AAAA,YACT;AAAA,WACD,CAAA;AAGD,UAAA,IAAA,CAAK,cAAA,CAAe,GAAG,QAAA,EAAU,CAAC,EAAE,IAAA,EAAM,YAAA,EAAc,WAAU,KAAM;AACtE,YAAA,MAAA,CAAO,KAAK,CAAA,2BAAA,EAA8B,IAAI,KAAK,YAAY,CAAA,uBAAA,EAA0B,SAAS,CAAA,CAAE,CAAA;AACpG,YAAA,OAAA,CAAQ,UAAU,kCAAA,EAAoC,CAAA,EAAG,EAAE,SAAA,EAAW,IAAA,CAAK,MAAM,CAAA;AAAA,UACnF,CAAC,CAAA;AAED,UAAA,IAAA,CAAK,eAAe,EAAA,CAAG,QAAA,EAAU,CAAC,EAAE,MAAK,KAAM;AAC7C,YAAA,MAAA,CAAO,IAAA,CAAK,CAAA,2BAAA,EAA8B,IAAI,CAAA,CAAE,CAAA;AAChD,YAAA,OAAA,CAAQ,UAAU,kCAAA,EAAoC,CAAA,EAAG,EAAE,SAAA,EAAW,IAAA,CAAK,MAAM,CAAA;AAAA,UACnF,CAAC,CAAA;AAAA,QACH;AAAA,MACF;AAAA;AAAA;AAAA;AAAA,MAKA,IAAI,WAAA,GAAsB;AACxB,QAAA,OAAO,IAAA,CAAK,MAAA,CAAO,WAAA,IAAe,IAAA,CAAK,IAAA;AAAA,MACzC;AAAA;AAAA;AAAA;AAAA,MAKA,IAAI,OAAA,GAAkB;AACpB,QAAA,OAAO,IAAA,CAAK,OAAO,OAAA,IAAW,EAAA;AAAA,MAChC;AAAA;AAAA;AAAA;AAAA,MAKA,SAAA,GAAoB;AAClB,QAAA,IAAI,IAAA,CAAK,MAAA,CAAO,IAAA,CAAK,IAAA,KAAS,SAAA,EAAW;AACvC,UAAA,MAAM,IAAI,KAAA,CAAM,CAAA,WAAA,EAAc,IAAA,CAAK,IAAI,sCAAsC,IAAA,CAAK,MAAA,CAAO,IAAA,CAAK,IAAI,CAAA,CAAE,CAAA;AAAA,QACtG;AACA,QAAA,OAAO,IAAA,CAAK,OAAO,IAAA,CAAK,MAAA;AAAA,MAC1B;AAAA;AAAA;AAAA;AAAA;AAAA,MAMA,MAAM,SAAS,MAAA,EAAkC;AAC/C,QAAA,IAAI,IAAA,CAAK,MAAA,CAAO,IAAA,CAAK,IAAA,KAAS,SAAA,EAAW;AACvC,UAAA,OAAO,IAAA,CAAK,OAAO,IAAA,CAAK,MAAA;AAAA,QAC1B;AAGA,QAAA,IAAI,CAAC,KAAK,YAAA,EAAc;AACtB,UAAA,MAAM,IAAI,KAAA,CAAM,CAAA,6CAAA,EAAgD,IAAA,CAAK,IAAI,CAAA,CAAA,CAAG,CAAA;AAAA,QAC9E;AAEA,QAAA,OAAO,IAAA,CAAK,YAAA,CAAa,QAAA,CAAS,MAAM,CAAA;AAAA,MAC1C;AAAA;AAAA;AAAA;AAAA;AAAA,MAMA,MAAM,UAAU,MAAA,EAAkC;AAChD,QAAA,IAAI,CAAC,KAAK,YAAA,EAAc;AACtB,UAAA,MAAM,IAAI,KAAA,CAAM,CAAA,WAAA,EAAc,IAAA,CAAK,IAAI,CAAA,2BAAA,CAA6B,CAAA;AAAA,QACtE;AACA,QAAA,OAAO,IAAA,CAAK,YAAA,CAAa,aAAA,CAAc,MAAM,CAAA;AAAA,MAC/C;AAAA;AAAA;AAAA;AAAA;AAAA,MAMA,MAAM,cAAA,CAAe,WAAA,EAAqB,MAAA,EAAgC;AACxE,QAAA,IAAI,CAAC,KAAK,YAAA,EAAc;AACtB,UAAA,MAAM,IAAI,KAAA,CAAM,CAAA,WAAA,EAAc,IAAA,CAAK,IAAI,CAAA,2BAAA,CAA6B,CAAA;AAAA,QACtE;AACA,QAAA,MAAM,IAAA,CAAK,YAAA,CAAa,cAAA,CAAe,WAAA,EAAa,MAAM,CAAA;AAAA,MAC5D;AAAA;AAAA;AAAA;AAAA,MAKA,MAAM,cAAc,MAAA,EAAmC;AACrD,QAAA,IAAI;AACF,UAAA,IAAI,IAAA,CAAK,MAAA,CAAO,IAAA,CAAK,IAAA,KAAS,SAAA,EAAW;AACvC,YAAA,OAAO,IAAA;AAAA,UACT;AACA,UAAA,IAAI,KAAK,YAAA,EAAc;AACrB,YAAA,MAAM,KAAA,GAAQ,MAAM,IAAA,CAAK,YAAA,CAAa,SAAS,MAAM,CAAA;AACrD,YAAA,OAAO,CAAC,CAAC,KAAA;AAAA,UACX;AACA,UAAA,OAAO,KAAA;AAAA,QACT,CAAA,CAAA,MAAQ;AACN,UAAA,OAAO,KAAA;AAAA,QACT;AAAA,MACF;AAAA;AAAA;AAAA;AAAA,MAKA,UAAA,GAAsC;AACpC,QAAA,OAAO,IAAA,CAAK,MAAA,CAAO,OAAA,IAAW,EAAC;AAAA,MACjC;AAAA;AAAA;AAAA;AAAA,MAKA,IAAI,WAAA,GAAkC;AACpC,QAAA,OAAO,KAAK,MAAA,CAAO,WAAA;AAAA,MACrB;AAAA;AAAA;AAAA;AAAA,MAKA,UAAA,GAME;AACA,QAAA,OAAO;AAAA,UACL,cAAc,IAAA,CAAK,YAAA;AAAA,UACnB,cAAc,IAAA,CAAK,YAAA;AAAA,UACnB,cAAc,IAAA,CAAK,YAAA;AAAA,UACnB,cAAc,IAAA,CAAK,YAAA,GAAe,IAAI,IAAA,CAAK,cAAA,GAAiB,KAAK,YAAA,GAAe,CAAA;AAAA,UAChF,mBAAA,EAAqB,IAAA,CAAK,cAAA,EAAgB,QAAA;AAAS,SACrD;AAAA,MACF;AAAA;AAAA;AAAA;AAAA,MAKA,mBAAA,GAA4B;AAC1B,QAAA,IAAA,CAAK,gBAAgB,KAAA,EAAM;AAAA,MAC7B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAiBA,MAAM,KAAA,CACJ,QAAA,EACA,OAAA,EACA,MAAA,EACmB;AAEnB,QAAA,IAAI,KAAK,QAAA,EAAU;AACjB,UAAA,MAAM,IAAI,KAAA,CAAM,CAAA,WAAA,EAAc,IAAA,CAAK,IAAI,CAAA,mBAAA,CAAqB,CAAA;AAAA,QAC9D;AAEA,QAAA,MAAM,SAAA,GAAY,KAAK,GAAA,EAAI;AAC3B,QAAA,IAAA,CAAK,YAAA,EAAA;AAGL,QAAA,MAAM,GAAA,GAAM,QAAA,CAAS,UAAA,CAAW,MAAM,CAAA,GAAI,WAAW,CAAA,EAAG,IAAA,CAAK,OAAO,CAAA,EAAG,QAAQ,CAAA,CAAA;AAG/E,QAAA,MAAM,OAAA,GAAU,OAAA,EAAS,OAAA,IAAW,IAAA,CAAK,OAAO,OAAA,IAAW,yBAAA;AAG3D,QAAA,IAAI,IAAA,CAAK,MAAA,CAAO,OAAA,EAAS,OAAA,EAAS;AAChC,UAAA,IAAA,CAAK,UAAA,CAAW,KAAK,OAAO,CAAA;AAAA,QAC9B;AAGA,QAAA,MAAM,UAAU,YAA+B;AAE7C,UAAA,MAAM,KAAA,GAAQ,MAAM,IAAA,CAAK,QAAA,CAAS,MAAM,CAAA;AACxC,UAAA,MAAM,IAAA,GAAO,KAAK,MAAA,CAAO,IAAA;AAGzB,UAAA,IAAI,UAAA,GAAa,eAAA;AACjB,UAAA,IAAI,WAAA,GAAc,UAAU,KAAK,CAAA,CAAA;AAEjC,UAAA,IAAI,IAAA,CAAK,SAAS,SAAA,EAAW;AAC3B,YAAA,UAAA,GAAa,KAAK,UAAA,IAAc,eAAA;AAChC,YAAA,MAAM,MAAA,GAAS,KAAK,YAAA,IAAgB,QAAA;AACpC,YAAA,WAAA,GAAc,MAAA,GAAS,CAAA,EAAG,MAAM,CAAA,CAAA,EAAI,KAAK,CAAA,CAAA,GAAK,KAAA;AAAA,UAChD;AAGA,UAAA,MAAM,UAAA,GAAa,IAAI,eAAA,EAAgB;AACvC,UAAA,MAAM,YAAY,UAAA,CAAW,MAAM,UAAA,CAAW,KAAA,IAAS,OAAO,CAAA;AAE9D,UAAA,IAAI;AACF,YAAA,MAAM,QAAA,GAAW,MAAM,KAAA,CAAM,GAAA,EAAK;AAAA,cAChC,GAAG,OAAA;AAAA,cACH,QAAQ,UAAA,CAAW,MAAA;AAAA,cACnB,OAAA,EAAS;AAAA,gBACP,GAAG,OAAA,EAAS,OAAA;AAAA,gBACZ,CAAC,UAAU,GAAG;AAAA;AAChB,aACD,CAAA;AAED,YAAA,OAAO,QAAA;AAAA,UACT,CAAA,SAAE;AACA,YAAA,YAAA,CAAa,SAAS,CAAA;AAAA,UACxB;AAAA,QACF,CAAA;AAGA,QAAA,MAAM,mBAAmB,YAA+B;AACtD,UAAA,MAAM,WAAA,GAAc,KAAK,MAAA,CAAO,KAAA;AAChC,UAAA,MAAM,UAAA,GAAa,aAAa,UAAA,IAAc,mBAAA;AAC9C,UAAA,MAAM,iBAAA,GAAoB,aAAa,iBAAA,IAAqB,0BAAA;AAC5D,UAAA,MAAM,WAAA,GAAc,aAAa,WAAA,IAAe,qBAAA;AAChD,UAAA,MAAM,UAAA,GAAa,aAAa,UAAA,IAAc,oBAAA;AAE9C,UAAA,MAAM,aAAA,GAA+B;AAAA,YACnC,QAAA,EAAU,aAAA;AAAA,YACV,cAAA,EAAgB,WAAA;AAAA,YAChB,UAAA;AAAA,YACA,UAAA,EAAY,CAAA;AAAA,YACZ,MAAA,EAAQ,IAAA;AAAA,YACR,YAAA,EAAc;AAAA,WAChB;AAEA,UAAA,IAAI,SAAA;AACJ,UAAA,IAAI,YAAA;AAEJ,UAAA,KAAA,IAAS,OAAA,GAAU,CAAA,EAAG,OAAA,IAAW,UAAA,GAAa,GAAG,OAAA,EAAA,EAAW;AAC1D,YAAA,IAAI;AACF,cAAA,MAAM,QAAA,GAAW,MAAM,OAAA,EAAQ;AAG/B,cAAA,IAAI,CAAC,SAAS,EAAA,IAAM,iBAAA,CAAkB,SAAS,QAAA,CAAS,MAAM,CAAA,IAAK,OAAA,IAAW,UAAA,EAAY;AACxF,gBAAA,YAAA,GAAe,QAAA;AACf,gBAAA,MAAM,KAAA,GAAQ,gBAAA,CAAiB,OAAA,EAAS,aAAa,CAAA;AAErD,gBAAA,IAAI,IAAA,CAAK,MAAA,CAAO,OAAA,EAAS,OAAA,EAAS;AAChC,kBAAA,MAAA,CAAO,KAAA,CAAM,CAAA,UAAA,EAAa,IAAA,CAAK,IAAI,CAAA,QAAA,EAAW,OAAO,CAAA,CAAA,EAAI,UAAU,CAAA,OAAA,EAAU,KAAK,CAAA,WAAA,EAAc,QAAA,CAAS,MAAM,CAAA,CAAA,CAAG,CAAA;AAAA,gBACpH;AAEA,gBAAA,MAAM,IAAA,CAAK,MAAM,KAAK,CAAA;AACtB,gBAAA;AAAA,cACF;AAEA,cAAA,OAAO,QAAA;AAAA,YACT,SAAS,KAAA,EAAO;AACd,cAAA,SAAA,GAAY,KAAA;AAGZ,cAAA,IAAI,SAAA,CAAU,SAAS,YAAA,EAAc;AACnC,gBAAA,MAAM,IAAI,KAAA,CAAM,CAAA,sBAAA,EAAyB,OAAO,CAAA,IAAA,EAAO,GAAG,CAAA,CAAE,CAAA;AAAA,cAC9D;AAGA,cAAA,IAAI,OAAA,IAAW,UAAA,IAAc,CAAC,OAAA,EAAS,SAAA,EAAW;AAChD,gBAAA,MAAM,KAAA,GAAQ,gBAAA,CAAiB,OAAA,EAAS,aAAa,CAAA;AAErD,gBAAA,IAAI,IAAA,CAAK,MAAA,CAAO,OAAA,EAAS,OAAA,EAAS;AAChC,kBAAA,MAAA,CAAO,KAAA,CAAM,CAAA,UAAA,EAAa,IAAA,CAAK,IAAI,CAAA,QAAA,EAAW,OAAO,CAAA,CAAA,EAAI,UAAU,CAAA,OAAA,EAAU,KAAK,CAAA,WAAA,EAAc,SAAA,CAAU,OAAO,CAAA,CAAA,CAAG,CAAA;AAAA,gBACtH;AAEA,gBAAA,MAAM,IAAA,CAAK,MAAM,KAAK,CAAA;AACtB,gBAAA;AAAA,cACF;AAEA,cAAA,MAAM,SAAA;AAAA,YACR;AAAA,UACF;AAGA,UAAA,IAAI,YAAA,EAAc;AAChB,YAAA,OAAO,YAAA;AAAA,UACT;AAGA,UAAA,MAAM,SAAA,IAAa,IAAI,KAAA,CAAM,4BAA4B,CAAA;AAAA,QAC3D,CAAA;AAEA,QAAA,IAAI;AACF,UAAA,IAAI,QAAA;AAGJ,UAAA,IAAI,IAAA,CAAK,cAAA,IAAkB,CAAC,OAAA,EAAS,kBAAA,EAAoB;AACvD,YAAA,QAAA,GAAW,MAAM,IAAA,CAAK,cAAA,CAAe,OAAA,CAAQ,gBAAgB,CAAA;AAAA,UAC/D,CAAA,MAAO;AACL,YAAA,QAAA,GAAW,MAAM,gBAAA,EAAiB;AAAA,UACpC;AAGA,UAAA,MAAM,OAAA,GAAU,IAAA,CAAK,GAAA,EAAI,GAAI,SAAA;AAC7B,UAAA,IAAA,CAAK,YAAA,EAAA;AACL,UAAA,IAAA,CAAK,cAAA,IAAkB,OAAA;AACvB,UAAA,OAAA,CAAQ,OAAO,mBAAA,EAAqB,OAAA,EAAS,EAAE,SAAA,EAAW,IAAA,CAAK,MAAM,CAAA;AACrE,UAAA,OAAA,CAAQ,UAAU,mBAAA,EAAqB,CAAA,EAAG,EAAE,SAAA,EAAW,IAAA,CAAK,MAAM,CAAA;AAGlE,UAAA,IAAI,IAAA,CAAK,MAAA,CAAO,OAAA,EAAS,OAAA,EAAS;AAChC,YAAA,IAAA,CAAK,WAAA,CAAY,GAAA,EAAK,QAAA,EAAU,OAAO,CAAA;AAAA,UACzC;AAEA,UAAA,OAAO,QAAA;AAAA,QACT,SAAS,KAAA,EAAO;AAEd,UAAA,MAAM,OAAA,GAAU,IAAA,CAAK,GAAA,EAAI,GAAI,SAAA;AAC7B,UAAA,IAAA,CAAK,YAAA,EAAA;AACL,UAAA,IAAA,CAAK,cAAA,IAAkB,OAAA;AACvB,UAAA,OAAA,CAAQ,SAAA,CAAU,mBAAA,EAAqB,CAAA,EAAG,EAAE,SAAA,EAAW,KAAK,IAAA,EAAM,KAAA,EAAQ,KAAA,CAAgB,IAAA,EAAM,CAAA;AAGhG,UAAA,IAAI,IAAA,CAAK,MAAA,CAAO,OAAA,EAAS,OAAA,EAAS;AAChC,YAAA,MAAA,CAAO,KAAA;AAAA,cACL,EAAE,WAAW,IAAA,CAAK,IAAA,EAAM,KAAK,OAAA,EAAS,KAAA,EAAQ,MAAgB,OAAA,EAAQ;AAAA,cACtE,CAAA,UAAA,EAAa,IAAA,CAAK,IAAI,CAAA,eAAA,EAAmB,MAAgB,OAAO,CAAA;AAAA,aAClE;AAAA,UACF;AAEA,UAAA,MAAM,KAAA;AAAA,QACR;AAAA,MACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAWA,MAAM,SAAA,CACJ,QAAA,EACA,OAAA,EACA,MAAA,EACY;AACZ,QAAA,MAAM,WAAW,MAAM,IAAA,CAAK,KAAA,CAAM,QAAA,EAAU,SAAS,MAAM,CAAA;AAG3D,QAAA,MAAM,IAAA,GAAO,MAAM,QAAA,CAAS,IAAA,EAAK;AACjC,QAAA,IAAI,IAAA;AAEJ,QAAA,IAAI;AACF,UAAA,IAAA,GAAO,IAAA,CAAK,MAAM,IAAI,CAAA;AAAA,QACxB,CAAA,CAAA,MAAQ;AACN,UAAA,IAAI,CAAC,SAAS,EAAA,EAAI;AAChB,YAAA,MAAM,IAAI,KAAA,CAAM,CAAA,KAAA,EAAQ,SAAS,MAAM,CAAA,EAAA,EAAK,IAAI,CAAA,CAAE,CAAA;AAAA,UACpD;AACA,UAAA,MAAM,IAAI,MAAM,CAAA,uBAAA,EAA0B,IAAA,CAAK,MAAM,CAAA,EAAG,GAAG,CAAC,CAAA,CAAE,CAAA;AAAA,QAChE;AAEA,QAAA,IAAI,CAAC,SAAS,EAAA,EAAI;AAEhB,UAAA,MAAM,QAAA,GAAW,OAAO,IAAA,KAAS,QAAA,IAAY,SAAS,IAAA,GAAO,IAAA,CAAK,SAAA,CAAU,IAAI,CAAA,GAAI,IAAA;AACpF,UAAA,MAAM,IAAI,KAAA,CAAM,CAAA,KAAA,EAAQ,SAAS,MAAM,CAAA,EAAA,EAAK,QAAQ,CAAA,CAAE,CAAA;AAAA,QACxD;AAEA,QAAA,OAAO,IAAA;AAAA,MACT;AAAA;AAAA,MAIQ,MAAM,EAAA,EAA2B;AACvC,QAAA,OAAO,IAAI,OAAA,CAAQ,CAACF,aAAY,UAAA,CAAWA,QAAAA,EAAS,EAAE,CAAC,CAAA;AAAA,MACzD;AAAA,MAEQ,UAAA,CAAW,KAAa,OAAA,EAA6B;AAC3D,QAAA,MAAM,OAAA,GAAmC;AAAA,UACvC,WAAW,IAAA,CAAK,IAAA;AAAA,UAChB,MAAA,EAAQ,SAAS,MAAA,IAAU,KAAA;AAAA,UAC3B;AAAA,SACF;AAEA,QAAA,IAAI,IAAA,CAAK,MAAA,CAAO,OAAA,EAAS,UAAA,IAAc,SAAS,OAAA,EAAS;AAEvD,UAAA,MAAM,OAAA,GAAU,EAAE,GAAG,OAAA,CAAQ,OAAA,EAAQ;AACrC,UAAA,IAAI,OAAA,CAAQ,eAAe,CAAA,EAAG;AAC5B,YAAA,OAAA,CAAQ,eAAe,CAAA,GAAI,YAAA;AAAA,UAC7B;AACA,UAAA,IAAI,OAAA,CAAQ,eAAe,CAAA,EAAG;AAC5B,YAAA,OAAA,CAAQ,eAAe,CAAA,GAAI,YAAA;AAAA,UAC7B;AACA,UAAA,OAAA,CAAQ,OAAA,GAAU,OAAA;AAAA,QACpB;AAEA,QAAA,IAAI,IAAA,CAAK,MAAA,CAAO,OAAA,EAAS,OAAA,IAAW,SAAS,IAAA,EAAM;AACjD,UAAA,OAAA,CAAQ,IAAA,GAAO,OAAO,OAAA,CAAQ,IAAA,KAAS,QAAA,GAAW,QAAQ,IAAA,CAAK,KAAA,CAAM,CAAA,EAAG,GAAI,CAAA,GAAI,mBAAA;AAAA,QAClF;AAEA,QAAA,MAAA,CAAO,KAAA,CAAM,OAAA,EAAS,CAAA,UAAA,EAAa,IAAA,CAAK,IAAI,CAAA,QAAA,CAAU,CAAA;AAAA,MACxD;AAAA,MAEQ,WAAA,CAAY,GAAA,EAAa,QAAA,EAAoB,OAAA,EAAuB;AAC1E,QAAA,MAAA,CAAO,KAAA;AAAA,UACL,EAAE,WAAW,IAAA,CAAK,IAAA,EAAM,KAAK,MAAA,EAAQ,QAAA,CAAS,QAAQ,OAAA,EAAQ;AAAA,UAC9D,CAAA,UAAA,EAAa,KAAK,IAAI,CAAA,SAAA;AAAA,SACxB;AAAA,MACF;AAAA;AAAA;AAAA;AAAA,MAKA,OAAA,GAAgB;AACd,QAAA,IAAI,KAAK,QAAA,EAAU;AACnB,QAAA,IAAA,CAAK,QAAA,GAAW,IAAA;AAEhB,QAAA,IAAA,CAAK,YAAA,GAAe,MAAA;AACpB,QAAA,IAAA,CAAK,cAAA,GAAiB,MAAA;AAAA,MACxB;AAAA;AAAA;AAAA;AAAA,MAKA,UAAA,GAAsB;AACpB,QAAA,OAAO,IAAA,CAAK,QAAA;AAAA,MACd;AAAA;AAAA,MAIQ,iBAAiB,IAAA,EAA+C;AAEtE,QAAA,MAAM,WAAA,GAAc;AAAA,UAClB,MAAM,IAAA,CAAK,IAAA;AAAA,UACX,UAAU,IAAA,CAAK,QAAA;AAAA,UACf,cAAc,IAAA,CAAK,YAAA;AAAA,UACnB,UAAU,IAAA,CAAK,QAAA;AAAA,UACf,kBAAkB,IAAA,CAAK,gBAAA;AAAA,UACvB,aAAa,IAAA,CAAK,WAAA;AAAA,UAClB,OAAO,IAAA,CAAK,KAAA;AAAA,UACZ,SAAS,IAAA,CAAK,OAAA;AAAA,UACd,YAAY,IAAA,CAAK,UAAA;AAAA,UACjB,gBAAgB,IAAA,CAAK,cAAA;AAAA,UACrB,UAAU,IAAA,CAAK,QAAA;AAAA,UACf,qBAAqB,IAAA,CAAK,mBAAA;AAAA,UAC1B,SAAS,UAAA,CAAU,cAAA;AAAA,UACnB,UAAA,EAAY,IAAA,CAAK,UAAA,IAAc,IAAA,CAAK;AAAA,SACtC;AAEA,QAAA,IAAA,CAAK,YAAA,GAAe,IAAI,YAAA,CAAa,WAAW,CAAA;AAAA,MAClD;AAAA,MAEQ,eAAe,IAAA,EAA6C;AAElE,QAAA,IAAA,CAAK,YAAA,GAAe,IAAI,YAAA,CAAa;AAAA,UACnC,IAAA,EAAM,YAAA;AAAA,UACN,UAAU,IAAA,CAAK,QAAA;AAAA,UACf,UAAU,IAAA,CAAK,QAAA;AAAA,UACf,YAAY,IAAA,CAAK,UAAA;AAAA,UACjB,gBAAgB,IAAA,CAAK,cAAA;AAAA,UACrB,OAAO,IAAA,CAAK,KAAA;AAAA,UACZ,UAAU,IAAA,CAAK,QAAA;AAAA,UACf,SAAS,UAAA,CAAU,cAAA;AAAA,UACnB,YAAY,IAAA,CAAK;AAAA,SAClB,CAAA;AAAA,MACH;AAAA,KACF;AAAA,EAAA;AAAA,CAAA,CAAA;;;ACxqBA,IAAA,WAAA,GAAA,UAAA,CAAA;AAAA,EAAA,iCAAA,CAAAG,SAAA,EAAA;AAqBA,IAAA,IAAI,UAAA,GAAa,UAAQ,MAAM,CAAA;AAC/B,IAAA,IAAI,SAAA,GAAY,QAAQ,QAAA,KAAa,OAAA;AACrC,IAAA,IAAIJ,IAAAA,GAAK,UAAQ,IAAI,CAAA;AAIrB,IAAA,IAAI,KAAA,GAAQ,QAAQ,GAAA,CAAI,UAAA,IAAc,KAAK,IAAA,CAAK,OAAA,CAAQ,IAAI,UAAU,CAAA;AAEtE,IAAA,SAAS,OAAA,GAAU;AAGjB,MAAA,IAAI,QAAA;AACJ,MAAA,IAAI,KAAA,EAAO;AACT,QAAA,IAAI,YAAY,IAAI,KAAA,EAAA;AACpB,QAAA,QAAA,GAAW,aAAA;AAAA,MACb,CAAA;AACE,QAAA,QAAA,GAAW,eAAA;AAEb,MAAA,OAAO,QAAA;AAEP,MAAA,SAAS,cAAc,GAAA,EAAK;AAC1B,QAAA,IAAI,GAAA,EAAK;AACP,UAAA,SAAA,CAAU,UAAU,GAAA,CAAI,OAAA;AACxB,UAAA,GAAA,GAAM,SAAA;AACN,UAAA,eAAA,CAAgB,GAAG,CAAA;AAAA,QACrB;AAAA,MACF;AAEA,MAAA,SAAS,gBAAgB,GAAA,EAAK;AAC5B,QAAA,IAAI,GAAA,EAAK;AACP,UAAA,IAAI,OAAA,CAAQ,gBAAA;AACV,YAAA,MAAM,GAAA;AAAA,eAAA,IACC,CAAC,QAAQ,aAAA,EAAe;AAC/B,YAAA,IAAI,GAAA,GAAM,uBAAA,IAA2B,GAAA,CAAI,KAAA,IAAS,GAAA,CAAI,OAAA,CAAA;AACtD,YAAA,IAAI,OAAA,CAAQ,gBAAA;AACV,cAAA,OAAA,CAAQ,MAAM,GAAG,CAAA;AAAA;AAEjB,cAAA,OAAA,CAAQ,MAAM,GAAG,CAAA;AAAA,UACrB;AAAA,QACF;AAAA,MACF;AAAA,IACF;AAEA,IAAA,SAAS,cAAc,EAAA,EAAI;AACzB,MAAA,OAAO,OAAO,EAAA,KAAO,UAAA,GAAa,EAAA,GAAK,OAAA,EAAQ;AAAA,IACjD;AAEA,IAAgB,UAAA,CAAW;AAI3B,IAAA,IAAI,SAAA,EAAW;AACT,MAAA,UAAA,GAAa,qBAAA;AAAA,IACnB,CAAA,MAAO;AACD,MAAA,UAAA,GAAa,mBAAA;AAAA,IACnB;AAHM,IAAA,IAAA,UAAA;AAMN,IAAA,IAAI,SAAA,EAAW;AACT,MAAA,WAAA,GAAc,wDAAA;AAAA,IACpB,CAAA,MAAO;AACD,MAAA,WAAA,GAAc,QAAA;AAAA,IACpB;AAHM,IAAA,IAAA,WAAA;AAKN,IAAAI,SAAA,CAAQ,YAAA,GAAe,SAAS,YAAA,CAAa,CAAA,EAAG,KAAA,EAAO;AAErD,MAAA,CAAA,GAAI,UAAA,CAAW,QAAQ,CAAC,CAAA;AAExB,MAAA,IAAI,SAAS,MAAA,CAAO,SAAA,CAAU,eAAe,IAAA,CAAK,KAAA,EAAO,CAAC,CAAA,EAAG;AAC3D,QAAA,OAAO,MAAM,CAAC,CAAA;AAAA,MAChB;AAEA,MAAA,IAAI,WAAW,CAAA,EACX,SAAA,GAAY,EAAC,EACb,YAAY,EAAC;AAGjB,MAAA,IAAI,GAAA;AAEJ,MAAA,IAAI,OAAA;AAEJ,MAAA,IAAI,IAAA;AAEJ,MAAA,IAAI,QAAA;AAEJ,MAAA,KAAA,EAAM;AAEN,MAAA,SAAS,KAAA,GAAQ;AAEf,QAAA,IAAI,CAAA,GAAI,WAAA,CAAY,IAAA,CAAK,CAAC,CAAA;AAC1B,QAAA,GAAA,GAAM,CAAA,CAAE,CAAC,CAAA,CAAE,MAAA;AACX,QAAA,OAAA,GAAU,EAAE,CAAC,CAAA;AACb,QAAA,IAAA,GAAO,EAAE,CAAC,CAAA;AACV,QAAA,QAAA,GAAW,EAAA;AAGX,QAAA,IAAI,SAAA,IAAa,CAAC,SAAA,CAAU,IAAI,CAAA,EAAG;AACjC,UAAAJ,IAAAA,CAAG,UAAU,IAAI,CAAA;AACjB,UAAA,SAAA,CAAU,IAAI,CAAA,GAAI,IAAA;AAAA,QACpB;AAAA,MACF;AAKA,MAAA,OAAO,GAAA,GAAM,EAAE,MAAA,EAAQ;AAErB,QAAA,UAAA,CAAW,SAAA,GAAY,GAAA;AACvB,QAAA,IAAI,MAAA,GAAS,UAAA,CAAW,IAAA,CAAK,CAAC,CAAA;AAC9B,QAAA,QAAA,GAAW,OAAA;AACX,QAAA,OAAA,IAAW,OAAO,CAAC,CAAA;AACnB,QAAA,IAAA,GAAO,QAAA,GAAW,OAAO,CAAC,CAAA;AAC1B,QAAA,GAAA,GAAM,UAAA,CAAW,SAAA;AAGjB,QAAA,IAAI,UAAU,IAAI,CAAA,IAAM,SAAS,KAAA,CAAM,IAAI,MAAM,IAAA,EAAO;AACtD,UAAA;AAAA,QACF;AAEA,QAAA,IAAI,YAAA;AACJ,QAAA,IAAI,SAAS,MAAA,CAAO,SAAA,CAAU,eAAe,IAAA,CAAK,KAAA,EAAO,IAAI,CAAA,EAAG;AAE9D,UAAA,YAAA,GAAe,MAAM,IAAI,CAAA;AAAA,QAC3B,CAAA,MAAO;AACL,UAAA,IAAIK,KAAAA,GAAOL,IAAAA,CAAG,SAAA,CAAU,IAAI,CAAA;AAC5B,UAAA,IAAI,CAACK,KAAAA,CAAK,cAAA,EAAe,EAAG;AAC1B,YAAA,SAAA,CAAU,IAAI,CAAA,GAAI,IAAA;AAClB,YAAA,IAAI,KAAA,EAAO,KAAA,CAAM,IAAI,CAAA,GAAI,IAAA;AACzB,YAAA;AAAA,UACF;AAIA,UAAA,IAAI,UAAA,GAAa,IAAA;AACjB,UAAA,IAAI,CAAC,SAAA,EAAW;AACd,YAAA,IAAI,EAAA,GAAKA,KAAAA,CAAK,GAAA,CAAI,QAAA,CAAS,EAAE,IAAI,GAAA,GAAMA,KAAAA,CAAK,GAAA,CAAI,QAAA,CAAS,EAAE,CAAA;AAC3D,YAAA,IAAI,SAAA,CAAU,cAAA,CAAe,EAAE,CAAA,EAAG;AAChC,cAAA,UAAA,GAAa,UAAU,EAAE,CAAA;AAAA,YAC3B;AAAA,UACF;AACA,UAAA,IAAI,eAAe,IAAA,EAAM;AACvB,YAAAL,IAAAA,CAAG,SAAS,IAAI,CAAA;AAChB,YAAA,UAAA,GAAaA,IAAAA,CAAG,aAAa,IAAI,CAAA;AAAA,UACnC;AACA,UAAA,YAAA,GAAe,UAAA,CAAW,OAAA,CAAQ,QAAA,EAAU,UAAU,CAAA;AAEtD,UAAA,IAAI,KAAA,EAAO,KAAA,CAAM,IAAI,CAAA,GAAI,YAAA;AACzB,UAAA,IAAI,CAAC,SAAA,EAAW,SAAA,CAAU,EAAE,CAAA,GAAI,UAAA;AAAA,QAClC;AAGA,QAAA,CAAA,GAAI,WAAW,OAAA,CAAQ,YAAA,EAAc,CAAA,CAAE,KAAA,CAAM,GAAG,CAAC,CAAA;AACjD,QAAA,KAAA,EAAM;AAAA,MACR;AAEA,MAAA,IAAI,KAAA,EAAO,KAAA,CAAM,QAAQ,CAAA,GAAI,CAAA;AAE7B,MAAA,OAAO,CAAA;AAAA,IACT,CAAA;AAGA,IAAAI,SAAA,CAAQ,QAAA,GAAW,SAAS,QAAA,CAAS,CAAA,EAAG,OAAO,EAAA,EAAI;AACjD,MAAA,IAAI,OAAO,OAAO,UAAA,EAAY;AAC5B,QAAA,EAAA,GAAK,cAAc,KAAK,CAAA;AACxB,QAAA,KAAA,GAAQ,IAAA;AAAA,MACV;AAGA,MAAA,CAAA,GAAI,UAAA,CAAW,QAAQ,CAAC,CAAA;AAExB,MAAA,IAAI,SAAS,MAAA,CAAO,SAAA,CAAU,eAAe,IAAA,CAAK,KAAA,EAAO,CAAC,CAAA,EAAG;AAC3D,QAAA,OAAO,OAAA,CAAQ,SAAS,EAAA,CAAG,IAAA,CAAK,MAAM,IAAA,EAAM,KAAA,CAAM,CAAC,CAAC,CAAC,CAAA;AAAA,MACvD;AAEA,MAAA,IAAI,WAAW,CAAA,EACX,SAAA,GAAY,EAAC,EACb,YAAY,EAAC;AAGjB,MAAA,IAAI,GAAA;AAEJ,MAAA,IAAI,OAAA;AAEJ,MAAA,IAAI,IAAA;AAEJ,MAAA,IAAI,QAAA;AAEJ,MAAA,KAAA,EAAM;AAEN,MAAA,SAAS,KAAA,GAAQ;AAEf,QAAA,IAAI,CAAA,GAAI,WAAA,CAAY,IAAA,CAAK,CAAC,CAAA;AAC1B,QAAA,GAAA,GAAM,CAAA,CAAE,CAAC,CAAA,CAAE,MAAA;AACX,QAAA,OAAA,GAAU,EAAE,CAAC,CAAA;AACb,QAAA,IAAA,GAAO,EAAE,CAAC,CAAA;AACV,QAAA,QAAA,GAAW,EAAA;AAGX,QAAA,IAAI,SAAA,IAAa,CAAC,SAAA,CAAU,IAAI,CAAA,EAAG;AACjC,UAAAJ,IAAAA,CAAG,KAAA,CAAM,IAAA,EAAM,SAAS,GAAA,EAAK;AAC3B,YAAA,IAAI,GAAA,EAAK,OAAO,EAAA,CAAG,GAAG,CAAA;AACtB,YAAA,SAAA,CAAU,IAAI,CAAA,GAAI,IAAA;AAClB,YAAA,IAAA,EAAK;AAAA,UACP,CAAC,CAAA;AAAA,QACH,CAAA,MAAO;AACL,UAAA,OAAA,CAAQ,SAAS,IAAI,CAAA;AAAA,QACvB;AAAA,MACF;AAIA,MAAA,SAAS,IAAA,GAAO;AAEd,QAAA,IAAI,GAAA,IAAO,EAAE,MAAA,EAAQ;AACnB,UAAA,IAAI,KAAA,EAAO,KAAA,CAAM,QAAQ,CAAA,GAAI,CAAA;AAC7B,UAAA,OAAO,EAAA,CAAG,MAAM,CAAC,CAAA;AAAA,QACnB;AAGA,QAAA,UAAA,CAAW,SAAA,GAAY,GAAA;AACvB,QAAA,IAAI,MAAA,GAAS,UAAA,CAAW,IAAA,CAAK,CAAC,CAAA;AAC9B,QAAA,QAAA,GAAW,OAAA;AACX,QAAA,OAAA,IAAW,OAAO,CAAC,CAAA;AACnB,QAAA,IAAA,GAAO,QAAA,GAAW,OAAO,CAAC,CAAA;AAC1B,QAAA,GAAA,GAAM,UAAA,CAAW,SAAA;AAGjB,QAAA,IAAI,UAAU,IAAI,CAAA,IAAM,SAAS,KAAA,CAAM,IAAI,MAAM,IAAA,EAAO;AACtD,UAAA,OAAO,OAAA,CAAQ,SAAS,IAAI,CAAA;AAAA,QAC9B;AAEA,QAAA,IAAI,SAAS,MAAA,CAAO,SAAA,CAAU,eAAe,IAAA,CAAK,KAAA,EAAO,IAAI,CAAA,EAAG;AAE9D,UAAA,OAAO,eAAA,CAAgB,KAAA,CAAM,IAAI,CAAC,CAAA;AAAA,QACpC;AAEA,QAAA,OAAOA,IAAAA,CAAG,KAAA,CAAM,IAAA,EAAM,OAAO,CAAA;AAAA,MAC/B;AAEA,MAAA,SAAS,OAAA,CAAQ,KAAKK,KAAAA,EAAM;AAC1B,QAAA,IAAI,GAAA,EAAK,OAAO,EAAA,CAAG,GAAG,CAAA;AAGtB,QAAA,IAAI,CAACA,KAAAA,CAAK,cAAA,EAAe,EAAG;AAC1B,UAAA,SAAA,CAAU,IAAI,CAAA,GAAI,IAAA;AAClB,UAAA,IAAI,KAAA,EAAO,KAAA,CAAM,IAAI,CAAA,GAAI,IAAA;AACzB,UAAA,OAAO,OAAA,CAAQ,SAAS,IAAI,CAAA;AAAA,QAC9B;AAKA,QAAA,IAAI,CAAC,SAAA,EAAW;AACd,UAAA,IAAI,EAAA,GAAKA,KAAAA,CAAK,GAAA,CAAI,QAAA,CAAS,EAAE,IAAI,GAAA,GAAMA,KAAAA,CAAK,GAAA,CAAI,QAAA,CAAS,EAAE,CAAA;AAC3D,UAAA,IAAI,SAAA,CAAU,cAAA,CAAe,EAAE,CAAA,EAAG;AAChC,YAAA,OAAO,SAAA,CAAU,IAAA,EAAM,SAAA,CAAU,EAAE,GAAG,IAAI,CAAA;AAAA,UAC5C;AAAA,QACF;AACA,QAAAL,IAAAA,CAAG,IAAA,CAAK,IAAA,EAAM,SAASM,IAAAA,EAAK;AAC1B,UAAA,IAAIA,IAAAA,EAAK,OAAO,EAAA,CAAGA,IAAG,CAAA;AAEtB,UAAAN,IAAAA,CAAG,QAAA,CAAS,IAAA,EAAM,SAASM,MAAK,MAAA,EAAQ;AACtC,YAAA,IAAI,CAAC,SAAA,EAAW,SAAA,CAAU,EAAE,CAAA,GAAI,MAAA;AAChC,YAAA,SAAA,CAAUA,MAAK,MAAM,CAAA;AAAA,UACvB,CAAC,CAAA;AAAA,QACH,CAAC,CAAA;AAAA,MACH;AAEA,MAAA,SAAS,SAAA,CAAU,GAAA,EAAK,MAAA,EAAQC,KAAAA,EAAM;AACpC,QAAA,IAAI,GAAA,EAAK,OAAO,EAAA,CAAG,GAAG,CAAA;AAEtB,QAAA,IAAI,YAAA,GAAe,UAAA,CAAW,OAAA,CAAQ,QAAA,EAAU,MAAM,CAAA;AACtD,QAAA,IAAI,KAAA,EAAO,KAAA,CAAMA,KAAI,CAAA,GAAI,YAAA;AACzB,QAAA,eAAA,CAAgB,YAAY,CAAA;AAAA,MAC9B;AAEA,MAAA,SAAS,gBAAgB,YAAA,EAAc;AAErC,QAAA,CAAA,GAAI,WAAW,OAAA,CAAQ,YAAA,EAAc,CAAA,CAAE,KAAA,CAAM,GAAG,CAAC,CAAA;AACjD,QAAA,KAAA,EAAM;AAAA,MACR;AAAA,IACF,CAAA;AAAA,EAAA;AAAA,CAAA,CAAA;;;AC9SA,IAAA,UAAA,GAAA,UAAA,CAAA;AAAA,EAAA,mCAAA,CAAAH,SAAA,EAAA,MAAA,EAAA;AAAA,IAAA,MAAA,CAAO,OAAA,GAAU,QAAA;AACjB,IAAA,QAAA,CAAS,QAAA,GAAW,QAAA;AACpB,IAAA,QAAA,CAAS,IAAA,GAAO,YAAA;AAChB,IAAA,QAAA,CAAS,YAAA,GAAe,YAAA;AACxB,IAAA,QAAA,CAAS,WAAA,GAAc,WAAA;AACvB,IAAA,QAAA,CAAS,aAAA,GAAgB,aAAA;AAEzB,IAAA,IAAIJ,IAAAA,GAAK,UAAQ,IAAI,CAAA;AACrB,IAAA,IAAI,eAAeA,IAAAA,CAAG,QAAA;AACtB,IAAA,IAAI,mBAAmBA,IAAAA,CAAG,YAAA;AAE1B,IAAA,IAAI,UAAU,OAAA,CAAQ,OAAA;AACtB,IAAA,IAAI,EAAA,GAAK,WAAA,CAAY,IAAA,CAAK,OAAO,CAAA;AACjC,IAAA,IAAI,GAAA,GAAM,WAAA,EAAA;AAEV,IAAA,SAAS,SAAU,EAAA,EAAI;AACrB,MAAA,OAAO,EAAA,IAAM,EAAA,CAAG,OAAA,KAAY,UAAA,KAC1B,EAAA,CAAG,IAAA,KAAS,OAAA,IACZ,EAAA,CAAG,IAAA,KAAS,QAAA,IACZ,EAAA,CAAG,IAAA,KAAS,cAAA,CAAA;AAAA,IAEhB;AAEA,IAAA,SAAS,QAAA,CAAU,CAAA,EAAG,KAAA,EAAO,EAAA,EAAI;AAC/B,MAAA,IAAI,EAAA,EAAI;AACN,QAAA,OAAO,YAAA,CAAa,CAAA,EAAG,KAAA,EAAO,EAAE,CAAA;AAAA,MAClC;AAEA,MAAA,IAAI,OAAO,UAAU,UAAA,EAAY;AAC/B,QAAA,EAAA,GAAK,KAAA;AACL,QAAA,KAAA,GAAQ,IAAA;AAAA,MACV;AACA,MAAA,YAAA,CAAa,CAAA,EAAG,KAAA,EAAO,SAAU,EAAA,EAAI,MAAA,EAAQ;AAC3C,QAAA,IAAI,QAAA,CAAS,EAAE,CAAA,EAAG;AAChB,UAAA,GAAA,CAAI,QAAA,CAAS,CAAA,EAAG,KAAA,EAAO,EAAE,CAAA;AAAA,QAC3B,CAAA,MAAO;AACL,UAAA,EAAA,CAAG,IAAI,MAAM,CAAA;AAAA,QACf;AAAA,MACF,CAAC,CAAA;AAAA,IACH;AAEA,IAAA,SAAS,YAAA,CAAc,GAAG,KAAA,EAAO;AAC/B,MAAA,IAAI,EAAA,EAAI;AACN,QAAA,OAAO,gBAAA,CAAiB,GAAG,KAAK,CAAA;AAAA,MAClC;AAEA,MAAA,IAAI;AACF,QAAA,OAAO,gBAAA,CAAiB,GAAG,KAAK,CAAA;AAAA,MAClC,SAAS,EAAA,EAAI;AACX,QAAA,IAAI,QAAA,CAAS,EAAE,CAAA,EAAG;AAChB,UAAA,OAAO,GAAA,CAAI,YAAA,CAAa,CAAA,EAAG,KAAK,CAAA;AAAA,QAClC,CAAA,MAAO;AACL,UAAA,MAAM,EAAA;AAAA,QACR;AAAA,MACF;AAAA,IACF;AAEA,IAAA,SAAS,WAAA,GAAe;AACtB,MAAAA,KAAG,QAAA,GAAW,QAAA;AACd,MAAAA,KAAG,YAAA,GAAe,YAAA;AAAA,IACpB;AAEA,IAAA,SAAS,aAAA,GAAiB;AACxB,MAAAA,KAAG,QAAA,GAAW,YAAA;AACd,MAAAA,KAAG,YAAA,GAAe,gBAAA;AAAA,IACpB;AAAA,EAAA;AAAA,CAAA,CAAA;;;ACjEA,IAAA,kBAAA,GAAA,UAAA,CAAA;AAAA,EAAA,kCAAA,CAAAI,SAAA,EAAA,MAAA,EAAA;AAAA,IAAA,MAAA,CAAO,OAAA,GAAU,SAAU,EAAA,EAAI,EAAA,EAAI;AAC/B,MAAA,IAAI,MAAM,EAAC;AACX,MAAA,KAAA,IAAS,CAAA,GAAI,CAAA,EAAG,CAAA,GAAI,EAAA,CAAG,QAAQ,CAAA,EAAA,EAAK;AAChC,QAAA,IAAI,CAAA,GAAI,EAAA,CAAG,EAAA,CAAG,CAAC,GAAG,CAAC,CAAA;AACnB,QAAA,IAAI,QAAQ,CAAC,CAAA,MAAO,IAAA,CAAK,KAAA,CAAM,KAAK,CAAC,CAAA;AAAA,aAChC,GAAA,CAAI,KAAK,CAAC,CAAA;AAAA,MACnB;AACA,MAAA,OAAO,GAAA;AAAA,IACX,CAAA;AAEA,IAAA,IAAI,OAAA,GAAU,KAAA,CAAM,OAAA,IAAW,SAAU,EAAA,EAAI;AACzC,MAAA,OAAO,MAAA,CAAO,SAAA,CAAU,QAAA,CAAS,IAAA,CAAK,EAAE,CAAA,KAAM,gBAAA;AAAA,IAClD,CAAA;AAAA,EAAA;AAAA,CAAA,CAAA;;;ACZA,IAAA,sBAAA,GAAA,UAAA,CAAA;AAAA,EAAA,sCAAA,CAAAA,SAAA,EAAA,MAAA,EAAA;AACA,IAAA,MAAA,CAAO,OAAA,GAAU,QAAA;AACjB,IAAA,SAAS,QAAA,CAAS,CAAA,EAAG,CAAA,EAAG,GAAA,EAAK;AAC3B,MAAA,IAAI,CAAA,YAAa,MAAA,EAAQ,CAAA,GAAI,UAAA,CAAW,GAAG,GAAG,CAAA;AAC9C,MAAA,IAAI,CAAA,YAAa,MAAA,EAAQ,CAAA,GAAI,UAAA,CAAW,GAAG,GAAG,CAAA;AAE9C,MAAA,IAAI,CAAA,GAAI,KAAA,CAAM,CAAA,EAAG,CAAA,EAAG,GAAG,CAAA;AAEvB,MAAA,OAAO,CAAA,IAAK;AAAA,QACV,KAAA,EAAO,EAAE,CAAC,CAAA;AAAA,QACV,GAAA,EAAK,EAAE,CAAC,CAAA;AAAA,QACR,KAAK,GAAA,CAAI,KAAA,CAAM,CAAA,EAAG,CAAA,CAAE,CAAC,CAAC,CAAA;AAAA,QACtB,IAAA,EAAM,GAAA,CAAI,KAAA,CAAM,CAAA,CAAE,CAAC,IAAI,CAAA,CAAE,MAAA,EAAQ,CAAA,CAAE,CAAC,CAAC,CAAA;AAAA,QACrC,MAAM,GAAA,CAAI,KAAA,CAAM,EAAE,CAAC,CAAA,GAAI,EAAE,MAAM;AAAA,OACjC;AAAA,IACF;AAEA,IAAA,SAAS,UAAA,CAAW,KAAK,GAAA,EAAK;AAC5B,MAAA,IAAI,CAAA,GAAI,GAAA,CAAI,KAAA,CAAM,GAAG,CAAA;AACrB,MAAA,OAAO,CAAA,GAAI,CAAA,CAAE,CAAC,CAAA,GAAI,IAAA;AAAA,IACpB;AAEA,IAAA,QAAA,CAAS,KAAA,GAAQ,KAAA;AACjB,IAAA,SAAS,KAAA,CAAM,CAAA,EAAG,CAAA,EAAG,GAAA,EAAK;AACxB,MAAA,IAAI,IAAA,EAAM,GAAA,EAAK,IAAA,EAAM,KAAA,EAAO,MAAA;AAC5B,MAAA,IAAI,EAAA,GAAK,GAAA,CAAI,OAAA,CAAQ,CAAC,CAAA;AACtB,MAAA,IAAI,EAAA,GAAK,GAAA,CAAI,OAAA,CAAQ,CAAA,EAAG,KAAK,CAAC,CAAA;AAC9B,MAAA,IAAI,CAAA,GAAI,EAAA;AAER,MAAA,IAAI,EAAA,IAAM,CAAA,IAAK,EAAA,GAAK,CAAA,EAAG;AACrB,QAAA,IAAG,MAAI,CAAA,EAAG;AACR,UAAA,OAAO,CAAC,IAAI,EAAE,CAAA;AAAA,QAChB;AACA,QAAA,IAAA,GAAO,EAAC;AACR,QAAA,IAAA,GAAO,GAAA,CAAI,MAAA;AAEX,QAAA,OAAO,CAAA,IAAK,CAAA,IAAK,CAAC,MAAA,EAAQ;AACxB,UAAA,IAAI,KAAK,EAAA,EAAI;AACX,YAAA,IAAA,CAAK,KAAK,CAAC,CAAA;AACX,YAAA,EAAA,GAAK,GAAA,CAAI,OAAA,CAAQ,CAAA,EAAG,CAAA,GAAI,CAAC,CAAA;AAAA,UAC3B,CAAA,MAAA,IAAW,IAAA,CAAK,MAAA,IAAU,CAAA,EAAG;AAC3B,YAAA,MAAA,GAAS,CAAE,IAAA,CAAK,GAAA,EAAI,EAAG,EAAG,CAAA;AAAA,UAC5B,CAAA,MAAO;AACL,YAAA,GAAA,GAAM,KAAK,GAAA,EAAI;AACf,YAAA,IAAI,MAAM,IAAA,EAAM;AACd,cAAA,IAAA,GAAO,GAAA;AACP,cAAA,KAAA,GAAQ,EAAA;AAAA,YACV;AAEA,YAAA,EAAA,GAAK,GAAA,CAAI,OAAA,CAAQ,CAAA,EAAG,CAAA,GAAI,CAAC,CAAA;AAAA,UAC3B;AAEA,UAAA,CAAA,GAAI,EAAA,GAAK,EAAA,IAAM,EAAA,IAAM,CAAA,GAAI,EAAA,GAAK,EAAA;AAAA,QAChC;AAEA,QAAA,IAAI,KAAK,MAAA,EAAQ;AACf,UAAA,MAAA,GAAS,CAAE,MAAM,KAAM,CAAA;AAAA,QACzB;AAAA,MACF;AAEA,MAAA,OAAO,MAAA;AAAA,IACT;AAAA,EAAA;AAAA,CAAA,CAAA;;;AC7DA,IAAA,uBAAA,GAAA,UAAA,CAAA;AAAA,EAAA,uCAAA,CAAAA,SAAA,EAAA,MAAA,EAAA;AAAA,IAAA,IAAI,SAAA,GAAY,kBAAA,EAAA;AAChB,IAAA,IAAI,QAAA,GAAW,sBAAA,EAAA;AAEf,IAAA,MAAA,CAAO,OAAA,GAAU,SAAA;AAEjB,IAAA,IAAI,QAAA,GAAW,SAAA,GAAU,IAAA,CAAK,MAAA,EAAO,GAAE,IAAA;AACvC,IAAA,IAAI,OAAA,GAAU,QAAA,GAAS,IAAA,CAAK,MAAA,EAAO,GAAE,IAAA;AACrC,IAAA,IAAI,QAAA,GAAW,SAAA,GAAU,IAAA,CAAK,MAAA,EAAO,GAAE,IAAA;AACvC,IAAA,IAAI,QAAA,GAAW,SAAA,GAAU,IAAA,CAAK,MAAA,EAAO,GAAE,IAAA;AACvC,IAAA,IAAI,SAAA,GAAY,UAAA,GAAW,IAAA,CAAK,MAAA,EAAO,GAAE,IAAA;AAEzC,IAAA,SAAS,QAAQ,GAAA,EAAK;AACpB,MAAA,OAAO,QAAA,CAAS,GAAA,EAAK,EAAE,CAAA,IAAK,GAAA,GACxB,QAAA,CAAS,GAAA,EAAK,EAAE,CAAA,GAChB,GAAA,CAAI,UAAA,CAAW,CAAC,CAAA;AAAA,IACtB;AAEA,IAAA,SAAS,aAAa,GAAA,EAAK;AACzB,MAAA,OAAO,GAAA,CAAI,KAAA,CAAM,MAAM,CAAA,CAAE,IAAA,CAAK,QAAQ,CAAA,CAC3B,KAAA,CAAM,KAAK,CAAA,CAAE,IAAA,CAAK,OAAO,CAAA,CACzB,KAAA,CAAM,KAAK,CAAA,CAAE,IAAA,CAAK,QAAQ,CAAA,CAC1B,KAAA,CAAM,KAAK,CAAA,CAAE,IAAA,CAAK,QAAQ,CAAA,CAC1B,KAAA,CAAM,KAAK,CAAA,CAAE,KAAK,SAAS,CAAA;AAAA,IACxC;AAEA,IAAA,SAAS,eAAe,GAAA,EAAK;AAC3B,MAAA,OAAO,GAAA,CAAI,KAAA,CAAM,QAAQ,CAAA,CAAE,IAAA,CAAK,IAAI,CAAA,CACzB,KAAA,CAAM,OAAO,CAAA,CAAE,IAAA,CAAK,GAAG,CAAA,CACvB,KAAA,CAAM,QAAQ,CAAA,CAAE,IAAA,CAAK,GAAG,CAAA,CACxB,KAAA,CAAM,QAAQ,CAAA,CAAE,IAAA,CAAK,GAAG,CAAA,CACxB,KAAA,CAAM,SAAS,CAAA,CAAE,KAAK,GAAG,CAAA;AAAA,IACtC;AAMA,IAAA,SAAS,gBAAgB,GAAA,EAAK;AAC5B,MAAA,IAAI,CAAC,GAAA;AACH,QAAA,OAAO,CAAC,EAAE,CAAA;AAEZ,MAAA,IAAI,QAAQ,EAAC;AACb,MAAA,IAAI,CAAA,GAAI,QAAA,CAAS,GAAA,EAAK,GAAA,EAAK,GAAG,CAAA;AAE9B,MAAA,IAAI,CAAC,CAAA;AACH,QAAA,OAAO,GAAA,CAAI,MAAM,GAAG,CAAA;AAEtB,MAAA,IAAI,MAAM,CAAA,CAAE,GAAA;AACZ,MAAA,IAAI,OAAO,CAAA,CAAE,IAAA;AACb,MAAA,IAAI,OAAO,CAAA,CAAE,IAAA;AACb,MAAA,IAAI,CAAA,GAAI,GAAA,CAAI,KAAA,CAAM,GAAG,CAAA;AAErB,MAAA,CAAA,CAAE,CAAA,CAAE,MAAA,GAAO,CAAC,CAAA,IAAK,MAAM,IAAA,GAAO,GAAA;AAC9B,MAAA,IAAI,SAAA,GAAY,gBAAgB,IAAI,CAAA;AACpC,MAAA,IAAI,KAAK,MAAA,EAAQ;AACf,QAAA,CAAA,CAAE,CAAA,CAAE,MAAA,GAAO,CAAC,CAAA,IAAK,UAAU,KAAA,EAAM;AACjC,QAAA,CAAA,CAAE,IAAA,CAAK,KAAA,CAAM,CAAA,EAAG,SAAS,CAAA;AAAA,MAC3B;AAEA,MAAA,KAAA,CAAM,IAAA,CAAK,KAAA,CAAM,KAAA,EAAO,CAAC,CAAA;AAEzB,MAAA,OAAO,KAAA;AAAA,IACT;AAEA,IAAA,SAAS,UAAU,GAAA,EAAK;AACtB,MAAA,IAAI,CAAC,GAAA;AACH,QAAA,OAAO,EAAC;AAQV,MAAA,IAAI,GAAA,CAAI,MAAA,CAAO,CAAA,EAAG,CAAC,MAAM,IAAA,EAAM;AAC7B,QAAA,GAAA,GAAM,QAAA,GAAW,GAAA,CAAI,MAAA,CAAO,CAAC,CAAA;AAAA,MAC/B;AAEA,MAAA,OAAO,OAAO,YAAA,CAAa,GAAG,GAAG,IAAI,CAAA,CAAE,IAAI,cAAc,CAAA;AAAA,IAC3D;AAMA,IAAA,SAAS,QAAQ,GAAA,EAAK;AACpB,MAAA,OAAO,MAAM,GAAA,GAAM,GAAA;AAAA,IACrB;AACA,IAAA,SAAS,SAAS,EAAA,EAAI;AACpB,MAAA,OAAO,QAAA,CAAS,KAAK,EAAE,CAAA;AAAA,IACzB;AAEA,IAAA,SAAS,GAAA,CAAI,GAAG,CAAA,EAAG;AACjB,MAAA,OAAO,CAAA,IAAK,CAAA;AAAA,IACd;AACA,IAAA,SAAS,GAAA,CAAI,GAAG,CAAA,EAAG;AACjB,MAAA,OAAO,CAAA,IAAK,CAAA;AAAA,IACd;AAEA,IAAA,SAAS,MAAA,CAAO,KAAK,KAAA,EAAO;AAC1B,MAAA,IAAI,aAAa,EAAC;AAElB,MAAA,IAAI,CAAA,GAAI,QAAA,CAAS,GAAA,EAAK,GAAA,EAAK,GAAG,CAAA;AAC9B,MAAA,IAAI,CAAC,KAAK,KAAA,CAAM,IAAA,CAAK,EAAE,GAAG,CAAA,EAAG,OAAO,CAAC,GAAG,CAAA;AAExC,MAAA,IAAI,iBAAA,GAAoB,gCAAA,CAAiC,IAAA,CAAK,CAAA,CAAE,IAAI,CAAA;AACpE,MAAA,IAAI,eAAA,GAAkB,sCAAA,CAAuC,IAAA,CAAK,CAAA,CAAE,IAAI,CAAA;AACxE,MAAA,IAAI,aAAa,iBAAA,IAAqB,eAAA;AACtC,MAAA,IAAI,SAAA,GAAY,CAAA,CAAE,IAAA,CAAK,OAAA,CAAQ,GAAG,CAAA,IAAK,CAAA;AACvC,MAAA,IAAI,CAAC,UAAA,IAAc,CAAC,SAAA,EAAW;AAE7B,QAAA,IAAI,CAAA,CAAE,IAAA,CAAK,KAAA,CAAM,YAAY,CAAA,EAAG;AAC9B,UAAA,GAAA,GAAM,EAAE,GAAA,GAAM,GAAA,GAAM,CAAA,CAAE,IAAA,GAAO,WAAW,CAAA,CAAE,IAAA;AAC1C,UAAA,OAAO,OAAO,GAAG,CAAA;AAAA,QACnB;AACA,QAAA,OAAO,CAAC,GAAG,CAAA;AAAA,MACb;AAEA,MAAA,IAAI,CAAA;AACJ,MAAA,IAAI,UAAA,EAAY;AACd,QAAA,CAAA,GAAI,CAAA,CAAE,IAAA,CAAK,KAAA,CAAM,MAAM,CAAA;AAAA,MACzB,CAAA,MAAO;AACL,QAAA,CAAA,GAAI,eAAA,CAAgB,EAAE,IAAI,CAAA;AAC1B,QAAA,IAAI,CAAA,CAAE,WAAW,CAAA,EAAG;AAElB,UAAA,CAAA,GAAI,OAAO,CAAA,CAAE,CAAC,GAAG,KAAK,CAAA,CAAE,IAAI,OAAO,CAAA;AACnC,UAAA,IAAI,CAAA,CAAE,WAAW,CAAA,EAAG;AAClB,YAAA,IAAI,IAAA,GAAO,CAAA,CAAE,IAAA,CAAK,MAAA,GACd,MAAA,CAAO,EAAE,IAAA,EAAM,KAAK,CAAA,GACpB,CAAC,EAAE,CAAA;AACP,YAAA,OAAO,IAAA,CAAK,GAAA,CAAI,SAAS,CAAA,EAAG;AAC1B,cAAA,OAAO,CAAA,CAAE,GAAA,GAAM,CAAA,CAAE,CAAC,CAAA,GAAI,CAAA;AAAA,YACxB,CAAC,CAAA;AAAA,UACH;AAAA,QACF;AAAA,MACF;AAMA,MAAA,IAAI,MAAM,CAAA,CAAE,GAAA;AACZ,MAAA,IAAI,IAAA,GAAO,CAAA,CAAE,IAAA,CAAK,MAAA,GACd,MAAA,CAAO,EAAE,IAAA,EAAM,KAAK,CAAA,GACpB,CAAC,EAAE,CAAA;AAEP,MAAA,IAAI,CAAA;AAEJ,MAAA,IAAI,UAAA,EAAY;AACd,QAAA,IAAI,CAAA,GAAI,OAAA,CAAQ,CAAA,CAAE,CAAC,CAAC,CAAA;AACpB,QAAA,IAAI,CAAA,GAAI,OAAA,CAAQ,CAAA,CAAE,CAAC,CAAC,CAAA;AACpB,QAAA,IAAI,KAAA,GAAQ,IAAA,CAAK,GAAA,CAAI,CAAA,CAAE,CAAC,EAAE,MAAA,EAAQ,CAAA,CAAE,CAAC,CAAA,CAAE,MAAM,CAAA;AAC7C,QAAA,IAAI,IAAA,GAAO,CAAA,CAAE,MAAA,IAAU,CAAA,GACnB,IAAA,CAAK,GAAA,CAAI,OAAA,CAAQ,CAAA,CAAE,CAAC,CAAC,CAAC,CAAA,GACtB,CAAA;AACJ,QAAA,IAAI,IAAA,GAAO,GAAA;AACX,QAAA,IAAI,UAAU,CAAA,GAAI,CAAA;AAClB,QAAA,IAAI,OAAA,EAAS;AACX,UAAA,IAAA,IAAQ,EAAA;AACR,UAAA,IAAA,GAAO,GAAA;AAAA,QACT;AACA,QAAA,IAAI,GAAA,GAAM,CAAA,CAAE,IAAA,CAAK,QAAQ,CAAA;AAEzB,QAAA,CAAA,GAAI,EAAC;AAEL,QAAA,KAAA,IAAS,IAAI,CAAA,EAAG,IAAA,CAAK,GAAG,CAAC,CAAA,EAAG,KAAK,IAAA,EAAM;AACrC,UAAA,IAAI,CAAA;AACJ,UAAA,IAAI,eAAA,EAAiB;AACnB,YAAA,CAAA,GAAI,MAAA,CAAO,aAAa,CAAC,CAAA;AACzB,YAAA,IAAI,CAAA,KAAM,IAAA;AACR,cAAA,CAAA,GAAI,EAAA;AAAA,UACR,CAAA,MAAO;AACL,YAAA,CAAA,GAAI,OAAO,CAAC,CAAA;AACZ,YAAA,IAAI,GAAA,EAAK;AACP,cAAA,IAAI,IAAA,GAAO,QAAQ,CAAA,CAAE,MAAA;AACrB,cAAA,IAAI,OAAO,CAAA,EAAG;AACZ,gBAAA,IAAI,IAAI,IAAI,KAAA,CAAM,OAAO,CAAC,CAAA,CAAE,KAAK,GAAG,CAAA;AACpC,gBAAA,IAAI,CAAA,GAAI,CAAA;AACN,kBAAA,CAAA,GAAI,GAAA,GAAM,CAAA,GAAI,CAAA,CAAE,KAAA,CAAM,CAAC,CAAA;AAAA;AAEvB,kBAAA,CAAA,GAAI,CAAA,GAAI,CAAA;AAAA,cACZ;AAAA,YACF;AAAA,UACF;AACA,UAAA,CAAA,CAAE,KAAK,CAAC,CAAA;AAAA,QACV;AAAA,MACF,CAAA,MAAO;AACL,QAAA,CAAA,GAAI,SAAA,CAAU,CAAA,EAAG,SAAS,EAAA,EAAI;AAAE,UAAA,OAAO,MAAA,CAAO,IAAI,KAAK,CAAA;AAAA,QAAE,CAAC,CAAA;AAAA,MAC5D;AAEA,MAAA,KAAA,IAAS,CAAA,GAAI,CAAA,EAAG,CAAA,GAAI,CAAA,CAAE,QAAQ,CAAA,EAAA,EAAK;AACjC,QAAA,KAAA,IAAS,CAAA,GAAI,CAAA,EAAG,CAAA,GAAI,IAAA,CAAK,QAAQ,CAAA,EAAA,EAAK;AACpC,UAAA,IAAI,YAAY,GAAA,GAAM,CAAA,CAAE,CAAC,CAAA,GAAI,KAAK,CAAC,CAAA;AACnC,UAAA,IAAI,CAAC,SAAS,UAAA,IAAc,SAAA;AAC1B,YAAA,UAAA,CAAW,KAAK,SAAS,CAAA;AAAA,QAC7B;AAAA,MACF;AAEA,MAAA,OAAO,UAAA;AAAA,IACT;AAAA,EAAA;AAAA,CAAA,CAAA;;;ACvMA,IAAA,iBAAA,GAAA,UAAA,CAAA;AAAA,EAAA,qCAAA,CAAAA,SAAA,EAAA,MAAA,EAAA;AAAA,IAAA,MAAA,CAAO,OAAA,GAAU,SAAA;AACjB,IAAA,SAAA,CAAU,SAAA,GAAY,SAAA;AAEtB,IAAA,IAAIF,SAAQ,WAAY;AAAE,MAAA,IAAI;AAAE,QAAA,OAAO,UAAQ,MAAM,CAAA;AAAA,MAAE,SAAS,CAAA,EAAG;AAAA,MAAC;AAAA,IAAC,IAAE,IAAM;AAAA,MAC3E,GAAA,EAAK;AAAA,KACP;AACA,IAAA,SAAA,CAAU,MAAMA,KAAAA,CAAK,GAAA;AAErB,IAAA,IAAI,QAAA,GAAW,SAAA,CAAU,QAAA,GAAW,SAAA,CAAU,WAAW,EAAC;AAC1D,IAAA,IAAI,MAAA,GAAS,uBAAA,EAAA;AAEb,IAAA,IAAI,OAAA,GAAU;AAAA,MACZ,GAAA,EAAK,EAAE,IAAA,EAAM,WAAA,EAAa,OAAO,WAAA,EAAW;AAAA,MAC5C,GAAA,EAAK,EAAE,IAAA,EAAM,KAAA,EAAO,OAAO,IAAA,EAAK;AAAA,MAChC,GAAA,EAAK,EAAE,IAAA,EAAM,KAAA,EAAO,OAAO,IAAA,EAAK;AAAA,MAChC,GAAA,EAAK,EAAE,IAAA,EAAM,KAAA,EAAO,OAAO,IAAA,EAAK;AAAA,MAChC,GAAA,EAAK,EAAE,IAAA,EAAM,KAAA,EAAO,OAAO,GAAA;AAAI,KACjC;AAIA,IAAA,IAAI,KAAA,GAAQ,MAAA;AAGZ,IAAA,IAAI,OAAO,KAAA,GAAQ,IAAA;AAKnB,IAAA,IAAI,UAAA,GAAa,yCAAA;AAIjB,IAAA,IAAI,YAAA,GAAe,yBAAA;AAGnB,IAAA,IAAI,UAAA,GAAa,QAAQ,iBAAiB,CAAA;AAG1C,IAAA,SAAS,QAAS,CAAA,EAAG;AACnB,MAAA,OAAO,EAAE,KAAA,CAAM,EAAE,EAAE,MAAA,CAAO,SAAU,KAAK,CAAA,EAAG;AAC1C,QAAA,GAAA,CAAI,CAAC,CAAA,GAAI,IAAA;AACT,QAAA,OAAO,GAAA;AAAA,MACT,CAAA,EAAG,EAAE,CAAA;AAAA,IACP;AAGA,IAAA,IAAI,UAAA,GAAa,KAAA;AAEjB,IAAA,SAAA,CAAU,MAAA,GAAS,MAAA;AACnB,IAAA,SAAS,MAAA,CAAQ,SAAS,OAAA,EAAS;AACjC,MAAA,OAAA,GAAU,WAAW,EAAC;AACtB,MAAA,OAAO,SAAU,CAAA,EAAG,CAAA,EAAG,IAAA,EAAM;AAC3B,QAAA,OAAO,SAAA,CAAU,CAAA,EAAG,OAAA,EAAS,OAAO,CAAA;AAAA,MACtC,CAAA;AAAA,IACF;AAEA,IAAA,SAAS,GAAA,CAAK,GAAG,CAAA,EAAG;AAClB,MAAA,CAAA,GAAI,KAAK,EAAC;AACV,MAAA,IAAI,IAAI,EAAC;AACT,MAAA,MAAA,CAAO,IAAA,CAAK,CAAC,CAAA,CAAE,OAAA,CAAQ,SAAU,CAAA,EAAG;AAClC,QAAA,CAAA,CAAE,CAAC,CAAA,GAAI,CAAA,CAAE,CAAC,CAAA;AAAA,MACZ,CAAC,CAAA;AACD,MAAA,MAAA,CAAO,IAAA,CAAK,CAAC,CAAA,CAAE,OAAA,CAAQ,SAAU,CAAA,EAAG;AAClC,QAAA,CAAA,CAAE,CAAC,CAAA,GAAI,CAAA,CAAE,CAAC,CAAA;AAAA,MACZ,CAAC,CAAA;AACD,MAAA,OAAO,CAAA;AAAA,IACT;AAEA,IAAA,SAAA,CAAU,QAAA,GAAW,SAAU,GAAA,EAAK;AAClC,MAAA,IAAI,CAAC,GAAA,IAAO,OAAO,GAAA,KAAQ,QAAA,IAAY,CAAC,MAAA,CAAO,IAAA,CAAK,GAAG,CAAA,CAAE,MAAA,EAAQ;AAC/D,QAAA,OAAO,SAAA;AAAA,MACT;AAEA,MAAA,IAAI,IAAA,GAAO,SAAA;AAEX,MAAA,IAAI,CAAA,GAAI,SAASM,UAAAA,CAAW,CAAA,EAAG,SAAS,OAAA,EAAS;AAC/C,QAAA,OAAO,KAAK,CAAA,EAAG,OAAA,EAAS,GAAA,CAAI,GAAA,EAAK,OAAO,CAAC,CAAA;AAAA,MAC3C,CAAA;AAEA,MAAA,CAAA,CAAE,SAAA,GAAY,SAASC,UAAAA,CAAW,OAAA,EAAS,OAAA,EAAS;AAClD,QAAA,OAAO,IAAI,IAAA,CAAK,SAAA,CAAU,SAAS,GAAA,CAAI,GAAA,EAAK,OAAO,CAAC,CAAA;AAAA,MACtD,CAAA;AACA,MAAA,CAAA,CAAE,SAAA,CAAU,QAAA,GAAW,SAAS,QAAA,CAAU,OAAA,EAAS;AACjD,QAAA,OAAO,KAAK,QAAA,CAAS,GAAA,CAAI,GAAA,EAAK,OAAO,CAAC,CAAA,CAAE,SAAA;AAAA,MAC1C,CAAA;AAEA,MAAA,CAAA,CAAE,MAAA,GAAS,SAASC,OAAAA,CAAQ,OAAA,EAAS,OAAA,EAAS;AAC5C,QAAA,OAAO,KAAK,MAAA,CAAO,OAAA,EAAS,GAAA,CAAI,GAAA,EAAK,OAAO,CAAC,CAAA;AAAA,MAC/C,CAAA;AAEA,MAAA,CAAA,CAAE,QAAA,GAAW,SAAS,QAAA,CAAU,OAAA,EAAS;AACvC,QAAA,OAAO,IAAA,CAAK,QAAA,CAAS,GAAA,CAAI,GAAA,EAAK,OAAO,CAAC,CAAA;AAAA,MACxC,CAAA;AAEA,MAAA,CAAA,CAAE,MAAA,GAAS,SAASC,OAAAA,CAAQ,OAAA,EAAS,OAAA,EAAS;AAC5C,QAAA,OAAO,KAAK,MAAA,CAAO,OAAA,EAAS,GAAA,CAAI,GAAA,EAAK,OAAO,CAAC,CAAA;AAAA,MAC/C,CAAA;AAEA,MAAA,CAAA,CAAE,WAAA,GAAc,SAASC,YAAAA,CAAa,OAAA,EAAS,OAAA,EAAS;AACtD,QAAA,OAAO,KAAK,WAAA,CAAY,OAAA,EAAS,GAAA,CAAI,GAAA,EAAK,OAAO,CAAC,CAAA;AAAA,MACpD,CAAA;AAEA,MAAA,CAAA,CAAE,KAAA,GAAQ,SAAU,IAAA,EAAM,OAAA,EAAS,OAAA,EAAS;AAC1C,QAAA,OAAO,KAAK,KAAA,CAAM,IAAA,EAAM,SAAS,GAAA,CAAI,GAAA,EAAK,OAAO,CAAC,CAAA;AAAA,MACpD,CAAA;AAEA,MAAA,OAAO,CAAA;AAAA,IACT,CAAA;AAEA,IAAA,SAAA,CAAU,QAAA,GAAW,SAAU,GAAA,EAAK;AAClC,MAAA,OAAO,SAAA,CAAU,QAAA,CAAS,GAAG,CAAA,CAAE,SAAA;AAAA,IACjC,CAAA;AAEA,IAAA,SAAS,SAAA,CAAW,CAAA,EAAG,OAAA,EAAS,OAAA,EAAS;AACvC,MAAA,kBAAA,CAAmB,OAAO,CAAA;AAE1B,MAAA,IAAI,CAAC,OAAA,EAAS,OAAA,GAAU,EAAC;AAGzB,MAAA,IAAI,CAAC,OAAA,CAAQ,SAAA,IAAa,QAAQ,MAAA,CAAO,CAAC,MAAM,GAAA,EAAK;AACnD,QAAA,OAAO,KAAA;AAAA,MACT;AAEA,MAAA,OAAO,IAAI,SAAA,CAAU,OAAA,EAAS,OAAO,CAAA,CAAE,MAAM,CAAC,CAAA;AAAA,IAChD;AAEA,IAAA,SAAS,SAAA,CAAW,SAAS,OAAA,EAAS;AACpC,MAAA,IAAI,EAAE,gBAAgB,SAAA,CAAA,EAAY;AAChC,QAAA,OAAO,IAAI,SAAA,CAAU,OAAA,EAAS,OAAO,CAAA;AAAA,MACvC;AAEA,MAAA,kBAAA,CAAmB,OAAO,CAAA;AAE1B,MAAA,IAAI,CAAC,OAAA,EAAS,OAAA,GAAU,EAAC;AAEzB,MAAA,OAAA,GAAU,QAAQ,IAAA,EAAK;AAGvB,MAAA,IAAI,CAAC,OAAA,CAAQ,kBAAA,IAAsBV,KAAAA,CAAK,QAAQ,GAAA,EAAK;AACnD,QAAA,OAAA,GAAU,QAAQ,KAAA,CAAMA,KAAAA,CAAK,GAAG,CAAA,CAAE,KAAK,GAAG,CAAA;AAAA,MAC5C;AAEA,MAAA,IAAA,CAAK,OAAA,GAAU,OAAA;AACf,MAAA,IAAA,CAAK,MAAM,EAAC;AACZ,MAAA,IAAA,CAAK,OAAA,GAAU,OAAA;AACf,MAAA,IAAA,CAAK,MAAA,GAAS,IAAA;AACd,MAAA,IAAA,CAAK,MAAA,GAAS,KAAA;AACd,MAAA,IAAA,CAAK,OAAA,GAAU,KAAA;AACf,MAAA,IAAA,CAAK,KAAA,GAAQ,KAAA;AACb,MAAA,IAAA,CAAK,OAAA,GAAU,CAAC,CAAC,OAAA,CAAQ,OAAA;AAGzB,MAAA,IAAA,CAAK,IAAA,EAAK;AAAA,IACZ;AAEA,IAAA,SAAA,CAAU,SAAA,CAAU,QAAQ,WAAY;AAAA,IAAC,CAAA;AAEzC,IAAA,SAAA,CAAU,UAAU,IAAA,GAAO,IAAA;AAC3B,IAAA,SAAS,IAAA,GAAQ;AACf,MAAA,IAAI,UAAU,IAAA,CAAK,OAAA;AACnB,MAAA,IAAI,UAAU,IAAA,CAAK,OAAA;AAGnB,MAAA,IAAI,CAAC,OAAA,CAAQ,SAAA,IAAa,QAAQ,MAAA,CAAO,CAAC,MAAM,GAAA,EAAK;AACnD,QAAA,IAAA,CAAK,OAAA,GAAU,IAAA;AACf,QAAA;AAAA,MACF;AACA,MAAA,IAAI,CAAC,OAAA,EAAS;AACZ,QAAA,IAAA,CAAK,KAAA,GAAQ,IAAA;AACb,QAAA;AAAA,MACF;AAGA,MAAA,IAAA,CAAK,WAAA,EAAY;AAGjB,MAAA,IAAI,GAAA,GAAM,IAAA,CAAK,OAAA,GAAU,IAAA,CAAK,WAAA,EAAY;AAE1C,MAAA,IAAI,OAAA,CAAQ,KAAA,EAAO,IAAA,CAAK,KAAA,GAAQ,SAAS,KAAA,GAAQ;AAAE,QAAA,OAAA,CAAQ,KAAA,CAAM,KAAA,CAAM,OAAA,EAAS,SAAS,CAAA;AAAA,MAAE,CAAA;AAE3F,MAAA,IAAA,CAAK,KAAA,CAAM,IAAA,CAAK,OAAA,EAAS,GAAG,CAAA;AAO5B,MAAA,GAAA,GAAM,IAAA,CAAK,SAAA,GAAY,GAAA,CAAI,GAAA,CAAI,SAAU,CAAA,EAAG;AAC1C,QAAA,OAAO,CAAA,CAAE,MAAM,UAAU,CAAA;AAAA,MAC3B,CAAC,CAAA;AAED,MAAA,IAAA,CAAK,KAAA,CAAM,IAAA,CAAK,OAAA,EAAS,GAAG,CAAA;AAG5B,MAAA,GAAA,GAAM,GAAA,CAAI,GAAA,CAAI,SAAU,CAAA,EAAG,IAAIW,IAAAA,EAAK;AAClC,QAAA,OAAO,CAAA,CAAE,GAAA,CAAI,IAAA,CAAK,KAAA,EAAO,IAAI,CAAA;AAAA,MAC/B,GAAG,IAAI,CAAA;AAEP,MAAA,IAAA,CAAK,KAAA,CAAM,IAAA,CAAK,OAAA,EAAS,GAAG,CAAA;AAG5B,MAAA,GAAA,GAAM,GAAA,CAAI,MAAA,CAAO,SAAU,CAAA,EAAG;AAC5B,QAAA,OAAO,CAAA,CAAE,OAAA,CAAQ,KAAK,CAAA,KAAM,EAAA;AAAA,MAC9B,CAAC,CAAA;AAED,MAAA,IAAA,CAAK,KAAA,CAAM,IAAA,CAAK,OAAA,EAAS,GAAG,CAAA;AAE5B,MAAA,IAAA,CAAK,GAAA,GAAM,GAAA;AAAA,IACb;AAEA,IAAA,SAAA,CAAU,UAAU,WAAA,GAAc,WAAA;AAClC,IAAA,SAAS,WAAA,GAAe;AACtB,MAAA,IAAI,UAAU,IAAA,CAAK,OAAA;AACnB,MAAA,IAAI,MAAA,GAAS,KAAA;AACb,MAAA,IAAI,UAAU,IAAA,CAAK,OAAA;AACnB,MAAA,IAAI,YAAA,GAAe,CAAA;AAEnB,MAAA,IAAI,QAAQ,QAAA,EAAU;AAEtB,MAAA,KAAA,IAAS,CAAA,GAAI,CAAA,EAAG,CAAA,GAAI,OAAA,CAAQ,MAAA,EACxB,CAAA,GAAI,CAAA,IAAK,OAAA,CAAQ,MAAA,CAAO,CAAC,CAAA,KAAM,GAAA,EAC/B,CAAA,EAAA,EAAK;AACP,QAAA,MAAA,GAAS,CAAC,MAAA;AACV,QAAA,YAAA,EAAA;AAAA,MACF;AAEA,MAAA,IAAI,YAAA,EAAc,IAAA,CAAK,OAAA,GAAU,OAAA,CAAQ,OAAO,YAAY,CAAA;AAC5D,MAAA,IAAA,CAAK,MAAA,GAAS,MAAA;AAAA,IAChB;AAYA,IAAA,SAAA,CAAU,WAAA,GAAc,SAAU,OAAA,EAAS,OAAA,EAAS;AAClD,MAAA,OAAO,WAAA,CAAY,SAAS,OAAO,CAAA;AAAA,IACrC,CAAA;AAEA,IAAA,SAAA,CAAU,UAAU,WAAA,GAAc,WAAA;AAElC,IAAA,SAAS,WAAA,CAAa,SAAS,OAAA,EAAS;AACtC,MAAA,IAAI,CAAC,OAAA,EAAS;AACZ,QAAA,IAAI,gBAAgB,SAAA,EAAW;AAC7B,UAAA,OAAA,GAAU,IAAA,CAAK,OAAA;AAAA,QACjB,CAAA,MAAO;AACL,UAAA,OAAA,GAAU,EAAC;AAAA,QACb;AAAA,MACF;AAEA,MAAA,OAAA,GAAU,OAAO,OAAA,KAAY,WAAA,GACzB,IAAA,CAAK,OAAA,GAAU,OAAA;AAEnB,MAAA,kBAAA,CAAmB,OAAO,CAAA;AAI1B,MAAA,IAAI,QAAQ,OAAA,IAAW,CAAC,kBAAA,CAAmB,IAAA,CAAK,OAAO,CAAA,EAAG;AAExD,QAAA,OAAO,CAAC,OAAO,CAAA;AAAA,MACjB;AAEA,MAAA,OAAO,OAAO,OAAO,CAAA;AAAA,IACvB;AAEA,IAAA,IAAI,qBAAqB,IAAA,GAAO,EAAA;AAChC,IAAA,IAAI,kBAAA,GAAqB,SAAU,OAAA,EAAS;AAC1C,MAAA,IAAI,OAAO,YAAY,QAAA,EAAU;AAC/B,QAAA,MAAM,IAAI,UAAU,iBAAiB,CAAA;AAAA,MACvC;AAEA,MAAA,IAAI,OAAA,CAAQ,SAAS,kBAAA,EAAoB;AACvC,QAAA,MAAM,IAAI,UAAU,qBAAqB,CAAA;AAAA,MAC3C;AAAA,IACF,CAAA;AAaA,IAAA,SAAA,CAAU,UAAU,KAAA,GAAQ,KAAA;AAC5B,IAAA,IAAI,WAAW,EAAC;AAChB,IAAA,SAAS,KAAA,CAAO,SAAS,KAAA,EAAO;AAC9B,MAAA,kBAAA,CAAmB,OAAO,CAAA;AAE1B,MAAA,IAAI,UAAU,IAAA,CAAK,OAAA;AAGnB,MAAA,IAAI,YAAY,IAAA,EAAM;AACpB,QAAA,IAAI,CAAC,OAAA,CAAQ,UAAA;AACX,UAAA,OAAO,QAAA;AAAA;AAEP,UAAA,OAAA,GAAU,GAAA;AAAA,MACd;AACA,MAAA,IAAI,OAAA,KAAY,IAAI,OAAO,EAAA;AAE3B,MAAA,IAAI,EAAA,GAAK,EAAA;AACT,MAAA,IAAI,QAAA,GAAW,CAAC,CAAC,OAAA,CAAQ,MAAA;AACzB,MAAA,IAAI,QAAA,GAAW,KAAA;AAEf,MAAA,IAAI,mBAAmB,EAAC;AACxB,MAAA,IAAI,gBAAgB,EAAC;AACrB,MAAA,IAAI,SAAA;AACJ,MAAA,IAAI,OAAA,GAAU,KAAA;AACd,MAAA,IAAI,YAAA,GAAe,EAAA;AACnB,MAAA,IAAI,UAAA,GAAa,EAAA;AAGjB,MAAA,IAAI,YAAA,GAAe,QAAQ,MAAA,CAAO,CAAC,MAAM,GAAA,GAAM,EAAA,GAE7C,OAAA,CAAQ,GAAA,GAAM,gCAAA,GACd,SAAA;AACF,MAAA,IAAI,IAAA,GAAO,IAAA;AAEX,MAAA,SAAS,cAAA,GAAkB;AACzB,QAAA,IAAI,SAAA,EAAW;AAGb,UAAA,QAAQ,SAAA;AAAW,YACjB,KAAK,GAAA;AACH,cAAA,EAAA,IAAM,IAAA;AACN,cAAA,QAAA,GAAW,IAAA;AACb,cAAA;AAAA,YACA,KAAK,GAAA;AACH,cAAA,EAAA,IAAM,KAAA;AACN,cAAA,QAAA,GAAW,IAAA;AACb,cAAA;AAAA,YACA;AACE,cAAA,EAAA,IAAM,IAAA,GAAO,SAAA;AACf,cAAA;AAAA;AAEF,UAAA,IAAA,CAAK,KAAA,CAAM,sBAAA,EAAwB,SAAA,EAAW,EAAE,CAAA;AAChD,UAAA,SAAA,GAAY,KAAA;AAAA,QACd;AAAA,MACF;AAEA,MAAA,KAAA,IAAS,CAAA,GAAI,CAAA,EAAG,GAAA,GAAM,OAAA,CAAQ,MAAA,EAAQ,CAAA,EACjC,CAAA,GAAI,GAAA,KAAS,CAAA,GAAI,OAAA,CAAQ,MAAA,CAAO,CAAC,IAClC,CAAA,EAAA,EAAK;AACP,QAAA,IAAA,CAAK,KAAA,CAAM,aAAA,EAAgB,OAAA,EAAS,CAAA,EAAG,IAAI,CAAC,CAAA;AAG5C,QAAA,IAAI,QAAA,IAAY,UAAA,CAAW,CAAC,CAAA,EAAG;AAC7B,UAAA,EAAA,IAAM,IAAA,GAAO,CAAA;AACb,UAAA,QAAA,GAAW,KAAA;AACX,UAAA;AAAA,QACF;AAEA,QAAA,QAAQ,CAAA;AAAG;AAAA,UAET,KAAK,GAAA,EAAK;AAGR,YAAA,OAAO,KAAA;AAAA,UACT;AAAA,UAEA,KAAK,IAAA;AACH,YAAA,cAAA,EAAe;AACf,YAAA,QAAA,GAAW,IAAA;AACb,YAAA;AAAA;AAAA;AAAA,UAIA,KAAK,GAAA;AAAA,UACL,KAAK,GAAA;AAAA,UACL,KAAK,GAAA;AAAA,UACL,KAAK,GAAA;AAAA,UACL,KAAK,GAAA;AACH,YAAA,IAAA,CAAK,KAAA,CAAM,2BAAA,EAA8B,OAAA,EAAS,CAAA,EAAG,IAAI,CAAC,CAAA;AAI1D,YAAA,IAAI,OAAA,EAAS;AACX,cAAA,IAAA,CAAK,MAAM,YAAY,CAAA;AACvB,cAAA,IAAI,CAAA,KAAM,GAAA,IAAO,CAAA,KAAM,UAAA,GAAa,GAAG,CAAA,GAAI,GAAA;AAC3C,cAAA,EAAA,IAAM,CAAA;AACN,cAAA;AAAA,YACF;AAKA,YAAA,IAAA,CAAK,KAAA,CAAM,0BAA0B,SAAS,CAAA;AAC9C,YAAA,cAAA,EAAe;AACf,YAAA,SAAA,GAAY,CAAA;AAIZ,YAAA,IAAI,OAAA,CAAQ,OAAO,cAAA,EAAe;AACpC,YAAA;AAAA,UAEA,KAAK,GAAA;AACH,YAAA,IAAI,OAAA,EAAS;AACX,cAAA,EAAA,IAAM,GAAA;AACN,cAAA;AAAA,YACF;AAEA,YAAA,IAAI,CAAC,SAAA,EAAW;AACd,cAAA,EAAA,IAAM,KAAA;AACN,cAAA;AAAA,YACF;AAEA,YAAA,gBAAA,CAAiB,IAAA,CAAK;AAAA,cACpB,IAAA,EAAM,SAAA;AAAA,cACN,OAAO,CAAA,GAAI,CAAA;AAAA,cACX,SAAS,EAAA,CAAG,MAAA;AAAA,cACZ,IAAA,EAAM,OAAA,CAAQ,SAAS,CAAA,CAAE,IAAA;AAAA,cACzB,KAAA,EAAO,OAAA,CAAQ,SAAS,CAAA,CAAE;AAAA,aAC3B,CAAA;AAED,YAAA,EAAA,IAAM,SAAA,KAAc,MAAM,WAAA,GAAc,KAAA;AACxC,YAAA,IAAA,CAAK,KAAA,CAAM,cAAA,EAAgB,SAAA,EAAW,EAAE,CAAA;AACxC,YAAA,SAAA,GAAY,KAAA;AACd,YAAA;AAAA,UAEA,KAAK,GAAA;AACH,YAAA,IAAI,OAAA,IAAW,CAAC,gBAAA,CAAiB,MAAA,EAAQ;AACvC,cAAA,EAAA,IAAM,KAAA;AACN,cAAA;AAAA,YACF;AAEA,YAAA,cAAA,EAAe;AACf,YAAA,QAAA,GAAW,IAAA;AACX,YAAA,IAAI,EAAA,GAAK,iBAAiB,GAAA,EAAI;AAG9B,YAAA,EAAA,IAAM,EAAA,CAAG,KAAA;AACT,YAAA,IAAI,EAAA,CAAG,SAAS,GAAA,EAAK;AACnB,cAAA,aAAA,CAAc,KAAK,EAAE,CAAA;AAAA,YACvB;AACA,YAAA,EAAA,CAAG,QAAQ,EAAA,CAAG,MAAA;AAChB,YAAA;AAAA,UAEA,KAAK,GAAA;AACH,YAAA,IAAI,OAAA,IAAW,CAAC,gBAAA,CAAiB,MAAA,IAAU,QAAA,EAAU;AACnD,cAAA,EAAA,IAAM,KAAA;AACN,cAAA,QAAA,GAAW,KAAA;AACX,cAAA;AAAA,YACF;AAEA,YAAA,cAAA,EAAe;AACf,YAAA,EAAA,IAAM,GAAA;AACR,YAAA;AAAA;AAAA,UAGA,KAAK,GAAA;AAEH,YAAA,cAAA,EAAe;AAEf,YAAA,IAAI,OAAA,EAAS;AACX,cAAA,EAAA,IAAM,IAAA,GAAO,CAAA;AACb,cAAA;AAAA,YACF;AAEA,YAAA,OAAA,GAAU,IAAA;AACV,YAAA,UAAA,GAAa,CAAA;AACb,YAAA,YAAA,GAAe,EAAA,CAAG,MAAA;AAClB,YAAA,EAAA,IAAM,CAAA;AACR,YAAA;AAAA,UAEA,KAAK,GAAA;AAKH,YAAA,IAAI,CAAA,KAAM,UAAA,GAAa,CAAA,IAAK,CAAC,OAAA,EAAS;AACpC,cAAA,EAAA,IAAM,IAAA,GAAO,CAAA;AACb,cAAA,QAAA,GAAW,KAAA;AACX,cAAA;AAAA,YACF;AAWA,YAAA,IAAI,EAAA,GAAK,OAAA,CAAQ,SAAA,CAAU,UAAA,GAAa,GAAG,CAAC,CAAA;AAC5C,YAAA,IAAI;AACF,cAAA,MAAA,CAAO,GAAA,GAAM,KAAK,GAAG,CAAA;AAAA,YACvB,SAAS,EAAA,EAAI;AAEX,cAAA,IAAI,EAAA,GAAK,IAAA,CAAK,KAAA,CAAM,EAAA,EAAI,QAAQ,CAAA;AAChC,cAAA,EAAA,GAAK,EAAA,CAAG,OAAO,CAAA,EAAG,YAAY,IAAI,KAAA,GAAQ,EAAA,CAAG,CAAC,CAAA,GAAI,KAAA;AAClD,cAAA,QAAA,GAAW,QAAA,IAAY,GAAG,CAAC,CAAA;AAC3B,cAAA,OAAA,GAAU,KAAA;AACV,cAAA;AAAA,YACF;AAGA,YAAA,QAAA,GAAW,IAAA;AACX,YAAA,OAAA,GAAU,KAAA;AACV,YAAA,EAAA,IAAM,CAAA;AACR,YAAA;AAAA,UAEA;AAEE,YAAA,cAAA,EAAe;AAEf,YAAA,IAAI,QAAA,EAAU;AAEZ,cAAA,QAAA,GAAW,KAAA;AAAA,YACb,WAAW,UAAA,CAAW,CAAC,KAClB,EAAE,CAAA,KAAM,OAAO,OAAA,CAAA,EAAU;AAC5B,cAAA,EAAA,IAAM,IAAA;AAAA,YACR;AAEA,YAAA,EAAA,IAAM,CAAA;AAAA;AAEV,MACF;AAIA,MAAA,IAAI,OAAA,EAAS;AAKX,QAAA,EAAA,GAAK,OAAA,CAAQ,MAAA,CAAO,UAAA,GAAa,CAAC,CAAA;AAClC,QAAA,EAAA,GAAK,IAAA,CAAK,KAAA,CAAM,EAAA,EAAI,QAAQ,CAAA;AAC5B,QAAA,EAAA,GAAK,GAAG,MAAA,CAAO,CAAA,EAAG,YAAY,CAAA,GAAI,KAAA,GAAQ,GAAG,CAAC,CAAA;AAC9C,QAAA,QAAA,GAAW,QAAA,IAAY,GAAG,CAAC,CAAA;AAAA,MAC7B;AAQA,MAAA,KAAK,EAAA,GAAK,iBAAiB,GAAA,EAAI,EAAG,IAAI,EAAA,GAAK,gBAAA,CAAiB,KAAI,EAAG;AACjE,QAAA,IAAI,OAAO,EAAA,CAAG,KAAA,CAAM,GAAG,OAAA,GAAU,EAAA,CAAG,KAAK,MAAM,CAAA;AAC/C,QAAA,IAAA,CAAK,KAAA,CAAM,cAAA,EAAgB,EAAA,EAAI,EAAE,CAAA;AAEjC,QAAA,IAAA,GAAO,KAAK,OAAA,CAAQ,2BAAA,EAA6B,SAAU,CAAA,EAAG,IAAI,EAAA,EAAI;AACpE,UAAA,IAAI,CAAC,EAAA,EAAI;AAEP,YAAA,EAAA,GAAK,IAAA;AAAA,UACP;AAQA,UAAA,OAAO,EAAA,GAAK,KAAK,EAAA,GAAK,GAAA;AAAA,QACxB,CAAC,CAAA;AAED,QAAA,IAAA,CAAK,KAAA,CAAM,gBAAA,EAAkB,IAAA,EAAM,IAAA,EAAM,IAAI,EAAE,CAAA;AAC/C,QAAA,IAAI,CAAA,GAAI,EAAA,CAAG,IAAA,KAAS,GAAA,GAAM,IAAA,GACtB,GAAG,IAAA,KAAS,GAAA,GAAM,KAAA,GAClB,IAAA,GAAO,EAAA,CAAG,IAAA;AAEd,QAAA,QAAA,GAAW,IAAA;AACX,QAAA,EAAA,GAAK,GAAG,KAAA,CAAM,CAAA,EAAG,GAAG,OAAO,CAAA,GAAI,IAAI,KAAA,GAAQ,IAAA;AAAA,MAC7C;AAGA,MAAA,cAAA,EAAe;AACf,MAAA,IAAI,QAAA,EAAU;AAEZ,QAAA,EAAA,IAAM,MAAA;AAAA,MACR;AAIA,MAAA,IAAI,eAAA,GAAkB,KAAA;AACtB,MAAA,QAAQ,EAAA,CAAG,MAAA,CAAO,CAAC,CAAA;AAAG,QACpB,KAAK,GAAA;AAAA,QAAK,KAAK,GAAA;AAAA,QAAK,KAAK,GAAA;AAAK,UAAA,eAAA,GAAkB,IAAA;AAAA;AAQlD,MAAA,KAAA,IAAS,IAAI,aAAA,CAAc,MAAA,GAAS,CAAA,EAAG,CAAA,GAAI,IAAI,CAAA,EAAA,EAAK;AAClD,QAAA,IAAI,EAAA,GAAK,cAAc,CAAC,CAAA;AAExB,QAAA,IAAI,QAAA,GAAW,EAAA,CAAG,KAAA,CAAM,CAAA,EAAG,GAAG,OAAO,CAAA;AACrC,QAAA,IAAI,UAAU,EAAA,CAAG,KAAA,CAAM,GAAG,OAAA,EAAS,EAAA,CAAG,QAAQ,CAAC,CAAA;AAC/C,QAAA,IAAI,SAAS,EAAA,CAAG,KAAA,CAAM,GAAG,KAAA,GAAQ,CAAA,EAAG,GAAG,KAAK,CAAA;AAC5C,QAAA,IAAI,OAAA,GAAU,EAAA,CAAG,KAAA,CAAM,EAAA,CAAG,KAAK,CAAA;AAE/B,QAAA,MAAA,IAAU,OAAA;AAKV,QAAA,IAAI,gBAAA,GAAmB,QAAA,CAAS,KAAA,CAAM,GAAG,EAAE,MAAA,GAAS,CAAA;AACpD,QAAA,IAAI,UAAA,GAAa,OAAA;AACjB,QAAA,KAAK,CAAA,GAAI,CAAA,EAAG,CAAA,GAAI,gBAAA,EAAkB,CAAA,EAAA,EAAK;AACrC,UAAA,UAAA,GAAa,UAAA,CAAW,OAAA,CAAQ,UAAA,EAAY,EAAE,CAAA;AAAA,QAChD;AACA,QAAA,OAAA,GAAU,UAAA;AAEV,QAAA,IAAI,MAAA,GAAS,EAAA;AACb,QAAA,IAAI,OAAA,KAAY,EAAA,IAAM,KAAA,KAAU,QAAA,EAAU;AACxC,UAAA,MAAA,GAAS,GAAA;AAAA,QACX;AACA,QAAA,IAAI,KAAA,GAAQ,QAAA,GAAW,OAAA,GAAU,OAAA,GAAU,MAAA,GAAS,MAAA;AACpD,QAAA,EAAA,GAAK,KAAA;AAAA,MACP;AAKA,MAAA,IAAI,EAAA,KAAO,MAAM,QAAA,EAAU;AACzB,QAAA,EAAA,GAAK,OAAA,GAAU,EAAA;AAAA,MACjB;AAEA,MAAA,IAAI,eAAA,EAAiB;AACnB,QAAA,EAAA,GAAK,YAAA,GAAe,EAAA;AAAA,MACtB;AAGA,MAAA,IAAI,UAAU,QAAA,EAAU;AACtB,QAAA,OAAO,CAAC,IAAI,QAAQ,CAAA;AAAA,MACtB;AAKA,MAAA,IAAI,CAAC,QAAA,EAAU;AACb,QAAA,OAAO,aAAa,OAAO,CAAA;AAAA,MAC7B;AAEA,MAAA,IAAI,KAAA,GAAQ,OAAA,CAAQ,MAAA,GAAS,GAAA,GAAM,EAAA;AACnC,MAAA,IAAI;AACF,QAAA,IAAI,SAAS,IAAI,MAAA,CAAO,GAAA,GAAM,EAAA,GAAK,KAAK,KAAK,CAAA;AAAA,MAC/C,SAAS,EAAA,EAAsD;AAK7D,QAAA,OAAO,IAAI,OAAO,IAAI,CAAA;AAAA,MACxB;AAEA,MAAA,MAAA,CAAO,KAAA,GAAQ,OAAA;AACf,MAAA,MAAA,CAAO,IAAA,GAAO,EAAA;AAEd,MAAA,OAAO,MAAA;AAAA,IACT;AAEA,IAAA,SAAA,CAAU,MAAA,GAAS,SAAU,OAAA,EAAS,OAAA,EAAS;AAC7C,MAAA,OAAO,IAAI,SAAA,CAAU,OAAA,EAAS,WAAW,EAAE,EAAE,MAAA,EAAO;AAAA,IACtD,CAAA;AAEA,IAAA,SAAA,CAAU,UAAU,MAAA,GAAS,MAAA;AAC7B,IAAA,SAAS,MAAA,GAAU;AACjB,MAAA,IAAI,KAAK,MAAA,IAAU,IAAA,CAAK,MAAA,KAAW,KAAA,SAAc,IAAA,CAAK,MAAA;AAQtD,MAAA,IAAI,MAAM,IAAA,CAAK,GAAA;AAEf,MAAA,IAAI,CAAC,IAAI,MAAA,EAAQ;AACf,QAAA,IAAA,CAAK,MAAA,GAAS,KAAA;AACd,QAAA,OAAO,IAAA,CAAK,MAAA;AAAA,MACd;AACA,MAAA,IAAI,UAAU,IAAA,CAAK,OAAA;AAEnB,MAAA,IAAI,UAAU,OAAA,CAAQ,UAAA,GAAa,IAAA,GAC/B,OAAA,CAAQ,MAAM,UAAA,GACd,YAAA;AACJ,MAAA,IAAI,KAAA,GAAQ,OAAA,CAAQ,MAAA,GAAS,GAAA,GAAM,EAAA;AAEnC,MAAA,IAAI,EAAA,GAAK,GAAA,CAAI,GAAA,CAAI,SAAU,OAAA,EAAS;AAClC,QAAA,OAAO,OAAA,CAAQ,GAAA,CAAI,SAAU,CAAA,EAAG;AAC9B,UAAA,OAAQ,CAAA,KAAM,WAAY,OAAA,GACvB,OAAO,MAAM,QAAA,GAAY,YAAA,CAAa,CAAC,CAAA,GACxC,CAAA,CAAE,IAAA;AAAA,QACN,CAAC,CAAA,CAAE,IAAA,CAAK,KAAM,CAAA;AAAA,MAChB,CAAC,CAAA,CAAE,IAAA,CAAK,GAAG,CAAA;AAIX,MAAA,EAAA,GAAK,SAAS,EAAA,GAAK,IAAA;AAGnB,MAAA,IAAI,IAAA,CAAK,MAAA,EAAQ,EAAA,GAAK,MAAA,GAAS,EAAA,GAAK,MAAA;AAEpC,MAAA,IAAI;AACF,QAAA,IAAA,CAAK,MAAA,GAAS,IAAI,MAAA,CAAO,EAAA,EAAI,KAAK,CAAA;AAAA,MACpC,SAAS,EAAA,EAAsD;AAC7D,QAAA,IAAA,CAAK,MAAA,GAAS,KAAA;AAAA,MAChB;AACA,MAAA,OAAO,IAAA,CAAK,MAAA;AAAA,IACd;AAEA,IAAA,SAAA,CAAU,KAAA,GAAQ,SAAU,IAAA,EAAM,OAAA,EAAS,OAAA,EAAS;AAClD,MAAA,OAAA,GAAU,WAAW,EAAC;AACtB,MAAA,IAAI,EAAA,GAAK,IAAI,SAAA,CAAU,OAAA,EAAS,OAAO,CAAA;AACvC,MAAA,IAAA,GAAO,IAAA,CAAK,MAAA,CAAO,SAAU,CAAA,EAAG;AAC9B,QAAA,OAAO,EAAA,CAAG,MAAM,CAAC,CAAA;AAAA,MACnB,CAAC,CAAA;AACD,MAAA,IAAI,EAAA,CAAG,OAAA,CAAQ,MAAA,IAAU,CAAC,KAAK,MAAA,EAAQ;AACrC,QAAA,IAAA,CAAK,KAAK,OAAO,CAAA;AAAA,MACnB;AACA,MAAA,OAAO,IAAA;AAAA,IACT,CAAA;AAEA,IAAA,SAAA,CAAU,SAAA,CAAU,KAAA,GAAQ,SAAS,KAAA,CAAO,GAAG,OAAA,EAAS;AACtD,MAAA,IAAI,OAAO,OAAA,KAAY,WAAA,EAAa,OAAA,GAAU,IAAA,CAAK,OAAA;AACnD,MAAA,IAAA,CAAK,KAAA,CAAM,OAAA,EAAS,CAAA,EAAG,IAAA,CAAK,OAAO,CAAA;AAGnC,MAAA,IAAI,IAAA,CAAK,SAAS,OAAO,KAAA;AACzB,MAAA,IAAI,IAAA,CAAK,KAAA,EAAO,OAAO,CAAA,KAAM,EAAA;AAE7B,MAAA,IAAI,CAAA,KAAM,GAAA,IAAO,OAAA,EAAS,OAAO,IAAA;AAEjC,MAAA,IAAI,UAAU,IAAA,CAAK,OAAA;AAGnB,MAAA,IAAIX,KAAAA,CAAK,QAAQ,GAAA,EAAK;AACpB,QAAA,CAAA,GAAI,EAAE,KAAA,CAAMA,KAAAA,CAAK,GAAG,CAAA,CAAE,KAAK,GAAG,CAAA;AAAA,MAChC;AAGA,MAAA,CAAA,GAAI,CAAA,CAAE,MAAM,UAAU,CAAA;AACtB,MAAA,IAAA,CAAK,KAAA,CAAM,IAAA,CAAK,OAAA,EAAS,OAAA,EAAS,CAAC,CAAA;AAOnC,MAAA,IAAI,MAAM,IAAA,CAAK,GAAA;AACf,MAAA,IAAA,CAAK,KAAA,CAAM,IAAA,CAAK,OAAA,EAAS,KAAA,EAAO,GAAG,CAAA;AAGnC,MAAA,IAAI,QAAA;AACJ,MAAA,IAAI,CAAA;AACJ,MAAA,KAAK,IAAI,CAAA,CAAE,MAAA,GAAS,CAAA,EAAG,CAAA,IAAK,GAAG,CAAA,EAAA,EAAK;AAClC,QAAA,QAAA,GAAW,EAAE,CAAC,CAAA;AACd,QAAA,IAAI,QAAA,EAAU;AAAA,MAChB;AAEA,MAAA,KAAK,CAAA,GAAI,CAAA,EAAG,CAAA,GAAI,GAAA,CAAI,QAAQ,CAAA,EAAA,EAAK;AAC/B,QAAA,IAAI,OAAA,GAAU,IAAI,CAAC,CAAA;AACnB,QAAA,IAAI,IAAA,GAAO,CAAA;AACX,QAAA,IAAI,OAAA,CAAQ,SAAA,IAAa,OAAA,CAAQ,MAAA,KAAW,CAAA,EAAG;AAC7C,UAAA,IAAA,GAAO,CAAC,QAAQ,CAAA;AAAA,QAClB;AACA,QAAA,IAAI,GAAA,GAAM,IAAA,CAAK,QAAA,CAAS,IAAA,EAAM,SAAS,OAAO,CAAA;AAC9C,QAAA,IAAI,GAAA,EAAK;AACP,UAAA,IAAI,OAAA,CAAQ,YAAY,OAAO,IAAA;AAC/B,UAAA,OAAO,CAAC,IAAA,CAAK,MAAA;AAAA,QACf;AAAA,MACF;AAIA,MAAA,IAAI,OAAA,CAAQ,YAAY,OAAO,KAAA;AAC/B,MAAA,OAAO,IAAA,CAAK,MAAA;AAAA,IACd,CAAA;AAOA,IAAA,SAAA,CAAU,SAAA,CAAU,QAAA,GAAW,SAAU,IAAA,EAAM,SAAS,OAAA,EAAS;AAC/D,MAAA,IAAI,UAAU,IAAA,CAAK,OAAA;AAEnB,MAAA,IAAA,CAAK,KAAA;AAAA,QAAM,UAAA;AAAA,QACT,EAAE,MAAA,EAAQ,IAAA,EAAM,IAAA,EAAY,OAAA;AAAiB,OAAC;AAEhD,MAAA,IAAA,CAAK,KAAA,CAAM,UAAA,EAAY,IAAA,CAAK,MAAA,EAAQ,QAAQ,MAAM,CAAA;AAElD,MAAA,KAAA,IAAS,EAAA,GAAK,CAAA,EACV,EAAA,GAAK,CAAA,EACL,KAAK,IAAA,CAAK,MAAA,EACV,EAAA,GAAK,OAAA,CAAQ,QACV,EAAA,GAAK,EAAA,IAAQ,EAAA,GAAK,EAAA,EACnB,MAAM,EAAA,EAAA,EAAM;AAChB,QAAA,IAAA,CAAK,MAAM,eAAe,CAAA;AAC1B,QAAA,IAAI,CAAA,GAAI,QAAQ,EAAE,CAAA;AAClB,QAAA,IAAI,CAAA,GAAI,KAAK,EAAE,CAAA;AAEf,QAAA,IAAA,CAAK,KAAA,CAAM,OAAA,EAAS,CAAA,EAAG,CAAC,CAAA;AAKxB,QAAA,IAAI,CAAA,KAAM,OAAO,OAAO,KAAA;AAExB,QAAA,IAAI,MAAM,QAAA,EAAU;AAClB,UAAA,IAAA,CAAK,MAAM,UAAA,EAAY,CAAC,OAAA,EAAS,CAAA,EAAG,CAAC,CAAC,CAAA;AAwBtC,UAAA,IAAI,EAAA,GAAK,EAAA;AACT,UAAA,IAAI,KAAK,EAAA,GAAK,CAAA;AACd,UAAA,IAAI,OAAO,EAAA,EAAI;AACb,YAAA,IAAA,CAAK,MAAM,eAAe,CAAA;AAO1B,YAAA,OAAO,EAAA,GAAK,IAAI,EAAA,EAAA,EAAM;AACpB,cAAA,IAAI,KAAK,EAAE,CAAA,KAAM,OAAO,IAAA,CAAK,EAAE,MAAM,IAAA,IAClC,CAAC,OAAA,CAAQ,GAAA,IAAO,KAAK,EAAE,CAAA,CAAE,OAAO,CAAC,CAAA,KAAM,KAAM,OAAO,KAAA;AAAA,YACzD;AACA,YAAA,OAAO,IAAA;AAAA,UACT;AAGA,UAAA,OAAO,KAAK,EAAA,EAAI;AACd,YAAA,IAAI,SAAA,GAAY,KAAK,EAAE,CAAA;AAEvB,YAAA,IAAA,CAAK,MAAM,kBAAA,EAAoB,IAAA,EAAM,EAAA,EAAI,OAAA,EAAS,IAAI,SAAS,CAAA;AAG/D,YAAA,IAAI,IAAA,CAAK,QAAA,CAAS,IAAA,CAAK,KAAA,CAAM,EAAE,CAAA,EAAG,OAAA,CAAQ,KAAA,CAAM,EAAE,CAAA,EAAG,OAAO,CAAA,EAAG;AAC7D,cAAA,IAAA,CAAK,KAAA,CAAM,uBAAA,EAAyB,EAAA,EAAI,EAAA,EAAI,SAAS,CAAA;AAErD,cAAA,OAAO,IAAA;AAAA,YACT,CAAA,MAAO;AAGL,cAAA,IAAI,SAAA,KAAc,GAAA,IAAO,SAAA,KAAc,IAAA,IACpC,CAAC,OAAA,CAAQ,GAAA,IAAO,SAAA,CAAU,MAAA,CAAO,CAAC,CAAA,KAAM,GAAA,EAAM;AAC/C,gBAAA,IAAA,CAAK,KAAA,CAAM,eAAA,EAAiB,IAAA,EAAM,EAAA,EAAI,SAAS,EAAE,CAAA;AACjD,gBAAA;AAAA,cACF;AAGA,cAAA,IAAA,CAAK,MAAM,0CAA0C,CAAA;AACrD,cAAA,EAAA,EAAA;AAAA,YACF;AAAA,UACF;AAMA,UAAA,IAAI,OAAA,EAAS;AAEX,YAAA,IAAA,CAAK,KAAA,CAAM,0BAAA,EAA4B,IAAA,EAAM,EAAA,EAAI,SAAS,EAAE,CAAA;AAC5D,YAAA,IAAI,EAAA,KAAO,IAAI,OAAO,IAAA;AAAA,UACxB;AACA,UAAA,OAAO,KAAA;AAAA,QACT;AAKA,QAAA,IAAI,GAAA;AACJ,QAAA,IAAI,OAAO,MAAM,QAAA,EAAU;AACzB,UAAA,GAAA,GAAM,CAAA,KAAM,CAAA;AACZ,UAAA,IAAA,CAAK,KAAA,CAAM,cAAA,EAAgB,CAAA,EAAG,CAAA,EAAG,GAAG,CAAA;AAAA,QACtC,CAAA,MAAO;AACL,UAAA,GAAA,GAAM,CAAA,CAAE,MAAM,CAAC,CAAA;AACf,UAAA,IAAA,CAAK,KAAA,CAAM,eAAA,EAAiB,CAAA,EAAG,CAAA,EAAG,GAAG,CAAA;AAAA,QACvC;AAEA,QAAA,IAAI,CAAC,KAAK,OAAO,KAAA;AAAA,MACnB;AAcA,MAAA,IAAI,EAAA,KAAO,EAAA,IAAM,EAAA,KAAO,EAAA,EAAI;AAG1B,QAAA,OAAO,IAAA;AAAA,MACT,CAAA,MAAA,IAAW,OAAO,EAAA,EAAI;AAIpB,QAAA,OAAO,OAAA;AAAA,MACT,CAAA,MAAA,IAAsC,OAAO,EAAA,EAAI;AAK/C,QAAA,OAAQ,EAAA,KAAO,EAAA,GAAK,CAAA,IAAO,IAAA,CAAK,EAAE,CAAA,KAAM,EAAA;AAAA,MAC1C;AAIA,MAAA,MAAM,IAAI,MAAM,MAAM,CAAA;AAAA,IACxB,CAAA;AAGA,IAAA,SAAS,aAAc,CAAA,EAAG;AACxB,MAAA,OAAO,CAAA,CAAE,OAAA,CAAQ,QAAA,EAAU,IAAI,CAAA;AAAA,IACjC;AAEA,IAAA,SAAS,aAAc,CAAA,EAAG;AACxB,MAAA,OAAO,CAAA,CAAE,OAAA,CAAQ,0BAAA,EAA4B,MAAM,CAAA;AAAA,IACrD;AAAA,EAAA;AAAA,CAAA,CAAA;;;ACl7BA,IAAA,wBAAA,GAAA,UAAA,CAAA;AAAA,EAAA,2CAAA,CAAAE,SAAA,EAAA,MAAA,EAAA;AAAA,IAAA,IAAI,OAAO,MAAA,CAAO,MAAA,KAAW,UAAA,EAAY;AAEvC,MAAA,MAAA,CAAO,OAAA,GAAU,SAAS,QAAA,CAAS,IAAA,EAAM,SAAA,EAAW;AAClD,QAAA,IAAI,SAAA,EAAW;AACb,UAAA,IAAA,CAAK,MAAA,GAAS,SAAA;AACd,UAAA,IAAA,CAAK,SAAA,GAAY,MAAA,CAAO,MAAA,CAAO,SAAA,CAAU,SAAA,EAAW;AAAA,YAClD,WAAA,EAAa;AAAA,cACX,KAAA,EAAO,IAAA;AAAA,cACP,UAAA,EAAY,KAAA;AAAA,cACZ,QAAA,EAAU,IAAA;AAAA,cACV,YAAA,EAAc;AAAA;AAChB,WACD,CAAA;AAAA,QACH;AAAA,MACF,CAAA;AAAA,IACF,CAAA,MAAO;AAEL,MAAA,MAAA,CAAO,OAAA,GAAU,SAAS,QAAA,CAAS,IAAA,EAAM,SAAA,EAAW;AAClD,QAAA,IAAI,SAAA,EAAW;AACb,UAAA,IAAA,CAAK,MAAA,GAAS,SAAA;AACd,UAAA,IAAI,WAAW,WAAY;AAAA,UAAC,CAAA;AAC5B,UAAA,QAAA,CAAS,YAAY,SAAA,CAAU,SAAA;AAC/B,UAAA,IAAA,CAAK,SAAA,GAAY,IAAI,QAAA,EAAS;AAC9B,UAAA,IAAA,CAAK,UAAU,WAAA,GAAc,IAAA;AAAA,QAC/B;AAAA,MACF,CAAA;AAAA,IACF;AAAA,EAAA;AAAA,CAAA,CAAA;;;AC1BA,IAAA,gBAAA,GAAA,UAAA,CAAA;AAAA,EAAA,mCAAA,CAAAA,SAAA,EAAA,MAAA,EAAA;AAAA,IAAA,IAAI;AACE,MAAA,IAAA,GAAO,UAAQ,MAAM,CAAA;AAEzB,MAAA,IAAI,OAAO,IAAA,CAAK,QAAA,KAAa,UAAA,EAAY,MAAM,EAAA;AAC/C,MAAA,MAAA,CAAO,UAAU,IAAA,CAAK,QAAA;AAAA,IACxB,SAAS,CAAA,EAAG;AAEV,MAAA,MAAA,CAAO,OAAA,GAAU,wBAAA,EAAA;AAAA,IACnB;AAPM,IAAA,IAAA,IAAA;AAAA,EAAA;AAAA,CAAA,CAAA;;;ACDN,IAAA,wBAAA,GAAA,UAAA,CAAA;AAAA,EAAA,wCAAA,CAAAA,SAAA,EAAA,MAAA,EAAA;AAEA,IAAA,SAAS,MAAMF,KAAAA,EAAM;AACpB,MAAA,OAAOA,KAAAA,CAAK,MAAA,CAAO,CAAC,CAAA,KAAM,GAAA;AAAA,IAC3B;AAEA,IAAA,SAAS,MAAMA,KAAAA,EAAM;AAEpB,MAAA,IAAI,aAAA,GAAgB,oEAAA;AACpB,MAAA,IAAI,MAAA,GAAS,aAAA,CAAc,IAAA,CAAKA,KAAI,CAAA;AACpC,MAAA,IAAI,MAAA,GAAS,MAAA,CAAO,CAAC,CAAA,IAAK,EAAA;AAC1B,MAAA,IAAI,QAAQ,OAAA,CAAQ,MAAA,IAAU,OAAO,MAAA,CAAO,CAAC,MAAM,GAAG,CAAA;AAGtD,MAAA,OAAO,OAAA,CAAQ,MAAA,CAAO,CAAC,CAAA,IAAK,KAAK,CAAA;AAAA,IAClC;AAEA,IAAA,MAAA,CAAO,OAAA,GAAU,OAAA,CAAQ,QAAA,KAAa,OAAA,GAAU,KAAA,GAAQ,KAAA;AACxD,IAAA,MAAA,CAAO,QAAQ,KAAA,GAAQ,KAAA;AACvB,IAAA,MAAA,CAAO,QAAQ,KAAA,GAAQ,KAAA;AAAA,EAAA;AAAA,CAAA,CAAA;;;ACnBvB,IAAA,cAAA,GAAA,UAAA,CAAA;AAAA,EAAA,6BAAA,CAAAE,SAAA,EAAA;AAAA,IAAAA,SAAA,CAAQ,OAAA,GAAU,OAAA;AAClB,IAAAA,SAAA,CAAQ,OAAA,GAAU,OAAA;AAClB,IAAAA,SAAA,CAAQ,OAAA,GAAU,OAAA;AAClB,IAAAA,SAAA,CAAQ,MAAA,GAAS,MAAA;AACjB,IAAAA,SAAA,CAAQ,IAAA,GAAO,IAAA;AACf,IAAAA,SAAA,CAAQ,SAAA,GAAY,SAAA;AACpB,IAAAA,SAAA,CAAQ,eAAA,GAAkB,eAAA;AAE1B,IAAA,SAAS,OAAA,CAAS,KAAK,KAAA,EAAO;AAC5B,MAAA,OAAO,MAAA,CAAO,SAAA,CAAU,cAAA,CAAe,IAAA,CAAK,KAAK,KAAK,CAAA;AAAA,IACxD;AAEA,IAAA,IAAIJ,IAAAA,GAAK,UAAQ,IAAI,CAAA;AACrB,IAAA,IAAIE,KAAAA,GAAO,UAAQ,MAAM,CAAA;AACzB,IAAA,IAAI,SAAA,GAAY,iBAAA,EAAA;AAChB,IAAA,IAAIY,WAAAA,GAAa,wBAAA,EAAA;AACjB,IAAA,IAAI,YAAY,SAAA,CAAU,SAAA;AAE1B,IAAA,SAAS,SAAA,CAAW,GAAG,CAAA,EAAG;AACxB,MAAA,OAAO,CAAA,CAAE,aAAA,CAAc,CAAA,EAAG,IAAI,CAAA;AAAA,IAChC;AAEA,IAAA,SAAS,YAAA,CAAc,MAAM,OAAA,EAAS;AACpC,MAAA,IAAA,CAAK,MAAA,GAAS,OAAA,CAAQ,MAAA,IAAU,EAAC;AAEjC,MAAA,IAAI,CAAC,KAAA,CAAM,OAAA,CAAQ,IAAA,CAAK,MAAM,CAAA;AAC5B,QAAA,IAAA,CAAK,MAAA,GAAS,CAAC,IAAA,CAAK,MAAM,CAAA;AAE5B,MAAA,IAAI,IAAA,CAAK,OAAO,MAAA,EAAQ;AACtB,QAAA,IAAA,CAAK,MAAA,GAAS,IAAA,CAAK,MAAA,CAAO,GAAA,CAAI,SAAS,CAAA;AAAA,MACzC;AAAA,IACF;AAGA,IAAA,SAAS,UAAW,OAAA,EAAS;AAC3B,MAAA,IAAI,QAAA,GAAW,IAAA;AACf,MAAA,IAAI,OAAA,CAAQ,KAAA,CAAM,EAAE,CAAA,KAAM,KAAA,EAAO;AAC/B,QAAA,IAAI,QAAA,GAAW,OAAA,CAAQ,OAAA,CAAQ,YAAA,EAAc,EAAE,CAAA;AAC/C,QAAA,QAAA,GAAW,IAAI,SAAA,CAAU,QAAA,EAAU,EAAE,GAAA,EAAK,MAAM,CAAA;AAAA,MAClD;AAEA,MAAA,OAAO;AAAA,QACL,SAAS,IAAI,SAAA,CAAU,SAAS,EAAE,GAAA,EAAK,MAAM,CAAA;AAAA,QAC7C;AAAA,OACF;AAAA,IACF;AAEA,IAAA,SAAS,OAAA,CAAS,IAAA,EAAM,OAAA,EAAS,OAAA,EAAS;AACxC,MAAA,IAAI,CAAC,OAAA;AACH,QAAA,OAAA,GAAU,EAAC;AAGb,MAAA,IAAI,QAAQ,SAAA,IAAa,EAAA,KAAO,OAAA,CAAQ,OAAA,CAAQ,GAAG,CAAA,EAAG;AACpD,QAAA,IAAI,QAAQ,UAAA,EAAY;AACtB,UAAA,MAAM,IAAI,MAAM,iCAAiC,CAAA;AAAA,QACnD;AACA,QAAA,OAAA,GAAU,KAAA,GAAQ,OAAA;AAAA,MACpB;AAEA,MAAA,IAAA,CAAK,MAAA,GAAS,CAAC,CAAC,OAAA,CAAQ,MAAA;AACxB,MAAA,IAAA,CAAK,OAAA,GAAU,OAAA;AACf,MAAA,IAAA,CAAK,MAAA,GAAS,QAAQ,MAAA,KAAW,KAAA;AACjC,MAAA,IAAA,CAAK,QAAA,GAAW,CAAC,CAAC,OAAA,CAAQ,QAAA;AAC1B,MAAA,IAAA,CAAK,aAAA,GAAgB,OAAA,CAAQ,aAAA,oBAAiB,MAAA,CAAO,OAAO,IAAI,CAAA;AAChE,MAAA,IAAA,CAAK,MAAA,GAAS,CAAC,CAAC,OAAA,CAAQ,MAAA;AACxB,MAAA,IAAA,CAAK,GAAA,GAAM,CAAC,CAAC,OAAA,CAAQ,GAAA;AACrB,MAAA,IAAA,CAAK,IAAA,GAAO,CAAC,CAAC,OAAA,CAAQ,IAAA;AACtB,MAAA,IAAA,CAAK,KAAA,GAAQ,CAAC,CAAC,OAAA,CAAQ,KAAA;AACvB,MAAA,IAAI,IAAA,CAAK,KAAA;AACP,QAAA,IAAA,CAAK,IAAA,GAAO,IAAA;AACd,MAAA,IAAA,CAAK,IAAA,GAAO,CAAC,CAAC,OAAA,CAAQ,IAAA;AACtB,MAAA,IAAA,CAAK,QAAA,GAAW,CAAC,CAAC,OAAA,CAAQ,QAAA;AAC1B,MAAA,IAAA,CAAK,MAAA,GAAS,CAAC,CAAC,OAAA,CAAQ,MAAA;AACxB,MAAA,IAAA,CAAK,MAAA,GAAS,CAAC,CAAC,OAAA,CAAQ,MAAA;AACxB,MAAA,IAAA,CAAK,MAAA,GAAS,CAAC,CAAC,OAAA,CAAQ,MAAA;AACxB,MAAA,IAAA,CAAK,IAAA,GAAO,CAAC,CAAC,OAAA,CAAQ,IAAA;AACtB,MAAA,IAAA,CAAK,SAAA,GAAY,CAAC,CAAC,OAAA,CAAQ,SAAA;AAC3B,MAAA,IAAA,CAAK,QAAA,GAAW,CAAC,CAAC,OAAA,CAAQ,QAAA;AAC1B,MAAA,IAAA,CAAK,EAAA,GAAK,QAAQ,EAAA,IAAMd,IAAAA;AAExB,MAAA,IAAA,CAAK,SAAA,GAAY,QAAQ,SAAA,IAAa,QAAA;AACtC,MAAA,IAAA,CAAK,KAAA,GAAQ,OAAA,CAAQ,KAAA,oBAAS,MAAA,CAAO,OAAO,IAAI,CAAA;AAChD,MAAA,IAAA,CAAK,SAAA,GAAY,OAAA,CAAQ,SAAA,oBAAa,MAAA,CAAO,OAAO,IAAI,CAAA;AACxD,MAAA,IAAA,CAAK,QAAA,GAAW,OAAA,CAAQ,QAAA,oBAAY,MAAA,CAAO,OAAO,IAAI,CAAA;AAEtD,MAAA,YAAA,CAAa,MAAM,OAAO,CAAA;AAE1B,MAAA,IAAA,CAAK,UAAA,GAAa,KAAA;AAClB,MAAA,IAAI,GAAA,GAAM,QAAQ,GAAA,EAAI;AACtB,MAAA,IAAI,CAAC,OAAA,CAAQ,OAAA,EAAS,KAAK,CAAA;AACzB,QAAA,IAAA,CAAK,GAAA,GAAM,GAAA;AAAA,WACR;AACH,QAAA,IAAA,CAAK,GAAA,GAAME,KAAAA,CAAK,OAAA,CAAQ,OAAA,CAAQ,GAAG,CAAA;AACnC,QAAA,IAAA,CAAK,UAAA,GAAa,KAAK,GAAA,KAAQ,GAAA;AAAA,MACjC;AAEA,MAAA,IAAA,CAAK,OAAO,OAAA,CAAQ,IAAA,IAAQA,MAAK,OAAA,CAAQ,IAAA,CAAK,KAAK,GAAG,CAAA;AACtD,MAAA,IAAA,CAAK,IAAA,GAAOA,KAAAA,CAAK,OAAA,CAAQ,IAAA,CAAK,IAAI,CAAA;AAClC,MAAA,IAAI,QAAQ,QAAA,KAAa,OAAA;AACvB,QAAA,IAAA,CAAK,IAAA,GAAO,IAAA,CAAK,IAAA,CAAK,OAAA,CAAQ,OAAO,GAAG,CAAA;AAI1C,MAAA,IAAA,CAAK,MAAA,GAASY,WAAAA,CAAW,IAAA,CAAK,GAAG,CAAA,GAAI,KAAK,GAAA,GAAM,OAAA,CAAQ,IAAA,EAAM,IAAA,CAAK,GAAG,CAAA;AACtE,MAAA,IAAI,QAAQ,QAAA,KAAa,OAAA;AACvB,QAAA,IAAA,CAAK,MAAA,GAAS,IAAA,CAAK,MAAA,CAAO,OAAA,CAAQ,OAAO,GAAG,CAAA;AAC9C,MAAA,IAAA,CAAK,OAAA,GAAU,CAAC,CAAC,OAAA,CAAQ,OAAA;AAIzB,MAAA,OAAA,CAAQ,QAAA,GAAW,IAAA;AACnB,MAAA,OAAA,CAAQ,SAAA,GAAY,IAAA;AAEpB,MAAA,OAAA,CAAQ,kBAAA,GAAqB,KAAA;AAE7B,MAAA,IAAA,CAAK,SAAA,GAAY,IAAI,SAAA,CAAU,OAAA,EAAS,OAAO,CAAA;AAC/C,MAAA,IAAA,CAAK,OAAA,GAAU,KAAK,SAAA,CAAU,OAAA;AAAA,IAChC;AAEA,IAAA,SAAS,OAAQ,IAAA,EAAM;AACrB,MAAA,IAAI,MAAM,IAAA,CAAK,QAAA;AACf,MAAA,IAAI,MAAM,GAAA,GAAM,EAAC,mBAAI,MAAA,CAAO,OAAO,IAAI,CAAA;AAEvC,MAAA,KAAA,IAAS,CAAA,GAAI,GAAG,CAAA,GAAI,IAAA,CAAK,QAAQ,MAAA,EAAQ,CAAA,GAAI,GAAG,CAAA,EAAA,EAAM;AACpD,QAAA,IAAI,OAAA,GAAU,IAAA,CAAK,OAAA,CAAQ,CAAC,CAAA;AAC5B,QAAA,IAAI,CAAC,OAAA,IAAW,MAAA,CAAO,KAAK,OAAO,CAAA,CAAE,WAAW,CAAA,EAAG;AACjD,UAAA,IAAI,KAAK,MAAA,EAAQ;AAEf,YAAA,IAAI,OAAA,GAAU,IAAA,CAAK,SAAA,CAAU,OAAA,CAAQ,CAAC,CAAA;AACtC,YAAA,IAAI,GAAA;AACF,cAAA,GAAA,CAAI,KAAK,OAAO,CAAA;AAAA;AAEhB,cAAA,GAAA,CAAI,OAAO,CAAA,GAAI,IAAA;AAAA,UACnB;AAAA,QACF,CAAA,MAAO;AAEL,UAAA,IAAI,CAAA,GAAI,MAAA,CAAO,IAAA,CAAK,OAAO,CAAA;AAC3B,UAAA,IAAI,GAAA;AACF,YAAA,GAAA,CAAI,IAAA,CAAK,KAAA,CAAM,GAAA,EAAK,CAAC,CAAA;AAAA;AAErB,YAAA,CAAA,CAAE,OAAA,CAAQ,SAAUC,EAAAA,EAAG;AACrB,cAAA,GAAA,CAAIA,EAAC,CAAA,GAAI,IAAA;AAAA,YACX,CAAC,CAAA;AAAA,QACL;AAAA,MACF;AAEA,MAAA,IAAI,CAAC,GAAA;AACH,QAAA,GAAA,GAAM,MAAA,CAAO,KAAK,GAAG,CAAA;AAEvB,MAAA,IAAI,CAAC,IAAA,CAAK,MAAA;AACR,QAAA,GAAA,GAAM,GAAA,CAAI,KAAK,SAAS,CAAA;AAG1B,MAAA,IAAI,KAAK,IAAA,EAAM;AACb,QAAA,KAAA,IAAS,CAAA,GAAI,CAAA,EAAG,CAAA,GAAI,GAAA,CAAI,QAAQ,CAAA,EAAA,EAAK;AACnC,UAAA,GAAA,CAAI,CAAC,CAAA,GAAI,IAAA,CAAK,KAAA,CAAM,GAAA,CAAI,CAAC,CAAC,CAAA;AAAA,QAC5B;AACA,QAAA,IAAI,KAAK,KAAA,EAAO;AACd,UAAA,GAAA,GAAM,GAAA,CAAI,MAAA,CAAO,SAAU,CAAA,EAAG;AAC5B,YAAA,IAAI,MAAA,GAAS,CAAE,KAAA,CAAM,IAAA,CAAK,CAAC,CAAA;AAC3B,YAAA,IAAI,CAAA,GAAI,IAAA,CAAK,KAAA,CAAM,CAAC,CAAA,IAAK,KAAK,KAAA,CAAM,OAAA,CAAQ,IAAA,EAAM,CAAC,CAAC,CAAA;AACpD,YAAA,IAAI,MAAA,IAAU,CAAA;AACZ,cAAA,MAAA,GAAS,CAAA,KAAM,KAAA,IAAS,CAAC,KAAA,CAAM,QAAQ,CAAC,CAAA;AAC1C,YAAA,OAAO,MAAA;AAAA,UACT,CAAC,CAAA;AAAA,QACH;AAAA,MACF;AAEA,MAAA,IAAI,KAAK,MAAA,CAAO,MAAA;AACd,QAAA,GAAA,GAAM,GAAA,CAAI,MAAA,CAAO,SAASA,EAAAA,EAAG;AAC3B,UAAA,OAAO,CAAC,SAAA,CAAU,IAAA,EAAMA,EAAC,CAAA;AAAA,QAC3B,CAAC,CAAA;AAEH,MAAA,IAAA,CAAK,KAAA,GAAQ,GAAA;AAAA,IACf;AAEA,IAAA,SAAS,IAAA,CAAM,MAAM,CAAA,EAAG;AACtB,MAAA,IAAI,GAAA,GAAM,OAAA,CAAQ,IAAA,EAAM,CAAC,CAAA;AACzB,MAAA,IAAI,CAAA,GAAI,IAAA,CAAK,KAAA,CAAM,GAAG,CAAA;AACtB,MAAA,IAAI,CAAA,GAAI,CAAA;AACR,MAAA,IAAI,CAAA,EAAG;AACL,QAAA,IAAI,KAAA,GAAQ,CAAA,KAAM,KAAA,IAAS,KAAA,CAAM,QAAQ,CAAC,CAAA;AAC1C,QAAA,IAAI,KAAA,GAAQ,CAAA,CAAE,KAAA,CAAM,EAAE,CAAA,KAAM,GAAA;AAE5B,QAAA,IAAI,SAAS,CAAC,KAAA;AACZ,UAAA,CAAA,IAAK,GAAA;AAAA,aAAA,IACE,CAAC,KAAA,IAAS,KAAA;AACjB,UAAA,CAAA,GAAI,CAAA,CAAE,KAAA,CAAM,CAAA,EAAG,EAAE,CAAA;AAEnB,QAAA,IAAI,MAAM,CAAA,EAAG;AACX,UAAA,IAAI,IAAA,GAAO,OAAA,CAAQ,IAAA,EAAM,CAAC,CAAA;AAC1B,UAAA,IAAA,CAAK,SAAA,CAAU,IAAI,CAAA,GAAI,IAAA,CAAK,UAAU,GAAG,CAAA;AACzC,UAAA,IAAA,CAAK,KAAA,CAAM,IAAI,CAAA,GAAI,IAAA,CAAK,MAAM,GAAG,CAAA;AAAA,QACnC;AAAA,MACF;AAEA,MAAA,OAAO,CAAA;AAAA,IACT;AAGA,IAAA,SAAS,OAAA,CAAS,MAAM,CAAA,EAAG;AACzB,MAAA,IAAI,GAAA,GAAM,CAAA;AACV,MAAA,IAAI,CAAA,CAAE,MAAA,CAAO,CAAC,CAAA,KAAM,GAAA,EAAK;AACvB,QAAA,GAAA,GAAMb,KAAAA,CAAK,IAAA,CAAK,IAAA,CAAK,IAAA,EAAM,CAAC,CAAA;AAAA,MAC9B,CAAA,MAAA,IAAWY,WAAAA,CAAW,CAAC,CAAA,IAAK,MAAM,EAAA,EAAI;AACpC,QAAA,GAAA,GAAM,CAAA;AAAA,MACR,CAAA,MAAA,IAAW,KAAK,UAAA,EAAY;AAC1B,QAAA,GAAA,GAAMZ,KAAAA,CAAK,OAAA,CAAQ,IAAA,CAAK,GAAA,EAAK,CAAC,CAAA;AAAA,MAChC,CAAA,MAAO;AACL,QAAA,GAAA,GAAMA,KAAAA,CAAK,QAAQ,CAAC,CAAA;AAAA,MACtB;AAEA,MAAA,IAAI,QAAQ,QAAA,KAAa,OAAA;AACvB,QAAA,GAAA,GAAM,GAAA,CAAI,OAAA,CAAQ,KAAA,EAAO,GAAG,CAAA;AAE9B,MAAA,OAAO,GAAA;AAAA,IACT;AAKA,IAAA,SAAS,SAAA,CAAW,MAAMA,KAAAA,EAAM;AAC9B,MAAA,IAAI,CAAC,KAAK,MAAA,CAAO,MAAA;AACf,QAAA,OAAO,KAAA;AAET,MAAA,OAAO,IAAA,CAAK,MAAA,CAAO,IAAA,CAAK,SAAS,IAAA,EAAM;AACrC,QAAA,OAAO,IAAA,CAAK,OAAA,CAAQ,KAAA,CAAMA,KAAI,CAAA,IAAK,CAAC,EAAE,IAAA,CAAK,QAAA,IAAY,IAAA,CAAK,QAAA,CAAS,KAAA,CAAMA,KAAI,CAAA,CAAA;AAAA,MACjF,CAAC,CAAA;AAAA,IACH;AAEA,IAAA,SAAS,eAAA,CAAiB,MAAMA,KAAAA,EAAM;AACpC,MAAA,IAAI,CAAC,KAAK,MAAA,CAAO,MAAA;AACf,QAAA,OAAO,KAAA;AAET,MAAA,OAAO,IAAA,CAAK,MAAA,CAAO,IAAA,CAAK,SAAS,IAAA,EAAM;AACrC,QAAA,OAAO,CAAC,EAAE,IAAA,CAAK,YAAY,IAAA,CAAK,QAAA,CAAS,MAAMA,KAAI,CAAA,CAAA;AAAA,MACrD,CAAC,CAAA;AAAA,IACH;AAAA,EAAA;AAAA,CAAA,CAAA;;;AC7OA,IAAA,YAAA,GAAA,UAAA,CAAA;AAAA,EAAA,2BAAA,CAAAE,SAAA,EAAA,MAAA,EAAA;AAAA,IAAA,MAAA,CAAO,OAAA,GAAU,QAAA;AACjB,IAAA,QAAA,CAAS,QAAA,GAAW,QAAA;AAEpB,IAAA,IAAI,EAAA,GAAK,UAAA,EAAA;AACT,IAAA,IAAI,SAAA,GAAY,iBAAA,EAAA;AAChB,IAAgB,SAAA,CAAU;AAC1B,IAAW,YAAA,EAAA,CAAqB;AAChC,IAAW,UAAQ,MAAM;AACzB,IAAA,IAAIF,KAAAA,GAAO,UAAQ,MAAM,CAAA;AACzB,IAAA,IAAI,MAAA,GAAS,UAAQ,QAAQ,CAAA;AAC7B,IAAA,IAAIY,WAAAA,GAAa,wBAAA,EAAA;AACjB,IAAA,IAAI,MAAA,GAAS,cAAA,EAAA;AACb,IAAA,IAAI,UAAU,MAAA,CAAO,OAAA;AACrB,IAAA,IAAI,UAAU,MAAA,CAAO,OAAA;AACrB,IAAA,IAAI,kBAAkB,MAAA,CAAO,eAAA;AAC7B,IAAA,IAAI,YAAY,MAAA,CAAO,SAAA;AAEvB,IAAA,SAAS,QAAA,CAAU,SAAS,OAAA,EAAS;AACnC,MAAA,IAAI,OAAO,OAAA,KAAY,UAAA,IAAc,SAAA,CAAU,MAAA,KAAW,CAAA;AACxD,QAAA,MAAM,IAAI,UAAU,qFACqD,CAAA;AAE3E,MAAA,OAAO,IAAI,QAAA,CAAS,OAAA,EAAS,OAAO,CAAA,CAAE,KAAA;AAAA,IACxC;AAEA,IAAA,SAAS,QAAA,CAAU,SAAS,OAAA,EAAS;AACnC,MAAA,IAAI,CAAC,OAAA;AACH,QAAA,MAAM,IAAI,MAAM,sBAAsB,CAAA;AAExC,MAAA,IAAI,OAAO,OAAA,KAAY,UAAA,IAAc,SAAA,CAAU,MAAA,KAAW,CAAA;AACxD,QAAA,MAAM,IAAI,UAAU,qFACqD,CAAA;AAE3E,MAAA,IAAI,EAAE,IAAA,YAAgB,QAAA,CAAA;AACpB,QAAA,OAAO,IAAI,QAAA,CAAS,OAAA,EAAS,OAAO,CAAA;AAEtC,MAAA,OAAA,CAAQ,IAAA,EAAM,SAAS,OAAO,CAAA;AAE9B,MAAA,IAAI,IAAA,CAAK,SAAA;AACP,QAAA,OAAO,IAAA;AAET,MAAA,IAAI,CAAA,GAAI,IAAA,CAAK,SAAA,CAAU,GAAA,CAAI,MAAA;AAC3B,MAAA,IAAA,CAAK,OAAA,GAAU,IAAI,KAAA,CAAM,CAAC,CAAA;AAC1B,MAAA,KAAA,IAAS,CAAA,GAAI,CAAA,EAAG,CAAA,GAAI,CAAA,EAAG,CAAA,EAAA,EAAM;AAC3B,QAAA,IAAA,CAAK,SAAS,IAAA,CAAK,SAAA,CAAU,IAAI,CAAC,CAAA,EAAG,GAAG,KAAK,CAAA;AAAA,MAC/C;AACA,MAAA,IAAA,CAAK,OAAA,EAAQ;AAAA,IACf;AAEA,IAAA,QAAA,CAAS,SAAA,CAAU,UAAU,WAAY;AACvC,MAAA,MAAA,CAAO,EAAA,CAAG,gBAAgB,QAAQ,CAAA;AAClC,MAAA,IAAI,KAAK,QAAA,EAAU;AACjB,QAAA,IAAI,IAAA,GAAO,IAAA;AACX,QAAA,IAAA,CAAK,OAAA,CAAQ,OAAA,CAAQ,SAAU,QAAA,EAAU,KAAA,EAAO;AAC9C,UAAA,IAAI,MAAM,IAAA,CAAK,OAAA,CAAQ,KAAK,CAAA,mBAAI,MAAA,CAAO,OAAO,IAAI,CAAA;AAClD,UAAA,KAAA,IAAS,KAAK,QAAA,EAAU;AACtB,YAAA,IAAI;AACF,cAAA,CAAA,GAAI,IAAA,CAAK,SAAS,CAAC,CAAA;AACnB,cAAA,IAAI,IAAA,GAAO,EAAA,CAAG,YAAA,CAAa,CAAA,EAAG,KAAK,aAAa,CAAA;AAChD,cAAA,GAAA,CAAI,IAAI,CAAA,GAAI,IAAA;AAAA,YACd,SAAS,EAAA,EAAI;AACX,cAAA,IAAI,GAAG,OAAA,KAAY,MAAA;AACjB,gBAAA,GAAA,CAAI,IAAA,CAAK,QAAA,CAAS,CAAC,CAAC,CAAA,GAAI,IAAA;AAAA;AAExB,gBAAA,MAAM,EAAA;AAAA,YACV;AAAA,UACF;AAAA,QACF,CAAC,CAAA;AAAA,MACH;AACA,MAAA,MAAA,CAAO,OAAO,IAAI,CAAA;AAAA,IACpB,CAAA;AAGA,IAAA,QAAA,CAAS,SAAA,CAAU,QAAA,GAAW,SAAU,OAAA,EAAS,OAAO,UAAA,EAAY;AAClE,MAAA,MAAA,CAAO,EAAA,CAAG,gBAAgB,QAAQ,CAAA;AAGlC,MAAA,IAAI,CAAA,GAAI,CAAA;AACR,MAAA,OAAO,OAAO,OAAA,CAAQ,CAAC,CAAA,KAAM,QAAA,EAAU;AACrC,QAAA,CAAA,EAAA;AAAA,MACF;AAIA,MAAA,IAAI,MAAA;AACJ,MAAA,QAAQ,CAAA;AAAG;AAAA,QAET,KAAK,OAAA,CAAQ,MAAA;AACX,UAAA,IAAA,CAAK,cAAA,CAAe,OAAA,CAAQ,IAAA,CAAK,GAAG,GAAG,KAAK,CAAA;AAC5C,UAAA;AAAA,QAEF,KAAK,CAAA;AAGH,UAAA,MAAA,GAAS,IAAA;AACT,UAAA;AAAA,QAEF;AAIE,UAAA,MAAA,GAAS,QAAQ,KAAA,CAAM,CAAA,EAAG,CAAC,CAAA,CAAE,KAAK,GAAG,CAAA;AACrC,UAAA;AAAA;AAGJ,MAAA,IAAI,MAAA,GAAS,OAAA,CAAQ,KAAA,CAAM,CAAC,CAAA;AAG5B,MAAA,IAAI,IAAA;AACJ,MAAA,IAAI,MAAA,KAAW,IAAA;AACb,QAAA,IAAA,GAAO,GAAA;AAAA,WAAA,IACAA,YAAW,MAAM,CAAA,IACtBA,YAAW,OAAA,CAAQ,GAAA,CAAI,SAAU,CAAA,EAAG;AAClC,QAAA,OAAO,OAAO,CAAA,KAAM,QAAA,GAAW,CAAA,GAAI,KAAA;AAAA,MACrC,CAAC,CAAA,CAAE,IAAA,CAAK,GAAG,CAAC,CAAA,EAAG;AACjB,QAAA,IAAI,CAAC,MAAA,IAAU,CAACA,WAAAA,CAAW,MAAM,CAAA;AAC/B,UAAA,MAAA,GAAS,GAAA,GAAM,MAAA;AACjB,QAAA,IAAA,GAAO,MAAA;AAAA,MACT,CAAA;AACE,QAAA,IAAA,GAAO,MAAA;AAET,MAAA,IAAI,GAAA,GAAM,IAAA,CAAK,QAAA,CAAS,IAAI,CAAA;AAG5B,MAAA,IAAI,eAAA,CAAgB,MAAM,IAAI,CAAA;AAC5B,QAAA;AAEF,MAAA,IAAI,UAAA,GAAa,MAAA,CAAO,CAAC,CAAA,KAAM,SAAA,CAAU,QAAA;AACzC,MAAA,IAAI,UAAA;AACF,QAAA,IAAA,CAAK,iBAAiB,MAAA,EAAQ,IAAA,EAAM,GAAA,EAAK,MAAA,EAAQ,OAAO,UAAU,CAAA;AAAA;AAElE,QAAA,IAAA,CAAK,gBAAgB,MAAA,EAAQ,IAAA,EAAM,GAAA,EAAK,MAAA,EAAQ,OAAO,UAAU,CAAA;AAAA,IACrE,CAAA;AAGA,IAAA,QAAA,CAAS,SAAA,CAAU,kBAAkB,SAAU,MAAA,EAAQ,MAAM,GAAA,EAAK,MAAA,EAAQ,OAAO,UAAA,EAAY;AAC3F,MAAA,IAAI,OAAA,GAAU,IAAA,CAAK,QAAA,CAAS,GAAA,EAAK,UAAU,CAAA;AAG3C,MAAA,IAAI,CAAC,OAAA;AACH,QAAA;AAIF,MAAA,IAAI,EAAA,GAAK,OAAO,CAAC,CAAA;AACjB,MAAA,IAAI,MAAA,GAAS,CAAC,CAAC,IAAA,CAAK,SAAA,CAAU,MAAA;AAC9B,MAAA,IAAI,UAAU,EAAA,CAAG,KAAA;AACjB,MAAA,IAAI,QAAQ,IAAA,CAAK,GAAA,IAAO,OAAA,CAAQ,MAAA,CAAO,CAAC,CAAA,KAAM,GAAA;AAE9C,MAAA,IAAI,iBAAiB,EAAC;AACtB,MAAA,KAAA,IAAS,CAAA,GAAI,CAAA,EAAG,CAAA,GAAI,OAAA,CAAQ,QAAQ,CAAA,EAAA,EAAK;AACvC,QAAA,IAAI,CAAA,GAAI,QAAQ,CAAC,CAAA;AACjB,QAAA,IAAI,CAAA,CAAE,MAAA,CAAO,CAAC,CAAA,KAAM,OAAO,KAAA,EAAO;AAChC,UAAA,IAAI,CAAA;AACJ,UAAA,IAAI,MAAA,IAAU,CAAC,MAAA,EAAQ;AACrB,YAAA,CAAA,GAAI,CAAC,CAAA,CAAE,KAAA,CAAM,EAAE,CAAA;AAAA,UACjB,CAAA,MAAO;AACL,YAAA,CAAA,GAAI,CAAA,CAAE,MAAM,EAAE,CAAA;AAAA,UAChB;AACA,UAAA,IAAI,CAAA;AACF,YAAA,cAAA,CAAe,KAAK,CAAC,CAAA;AAAA,QACzB;AAAA,MACF;AAEA,MAAA,IAAI,MAAM,cAAA,CAAe,MAAA;AAEzB,MAAA,IAAI,GAAA,KAAQ,CAAA;AACV,QAAA;AAOF,MAAA,IAAI,MAAA,CAAO,WAAW,CAAA,IAAK,CAAC,KAAK,IAAA,IAAQ,CAAC,KAAK,IAAA,EAAM;AACnD,QAAA,IAAI,CAAC,IAAA,CAAK,OAAA,CAAQ,KAAK,CAAA;AACrB,UAAA,IAAA,CAAK,OAAA,CAAQ,KAAK,CAAA,mBAAI,MAAA,CAAO,OAAO,IAAI,CAAA;AAE1C,QAAA,KAAA,IAAS,CAAA,GAAI,CAAA,EAAG,CAAA,GAAI,GAAA,EAAK,CAAA,EAAA,EAAM;AAC7B,UAAA,IAAI,CAAA,GAAI,eAAe,CAAC,CAAA;AACxB,UAAA,IAAI,MAAA,EAAQ;AACV,YAAA,IAAI,MAAA,CAAO,KAAA,CAAM,EAAE,CAAA,KAAM,GAAA;AACvB,cAAA,CAAA,GAAI,SAAS,GAAA,GAAM,CAAA;AAAA;AAEnB,cAAA,CAAA,GAAI,MAAA,GAAS,CAAA;AAAA,UACjB;AAEA,UAAA,IAAI,EAAE,MAAA,CAAO,CAAC,MAAM,GAAA,IAAO,CAAC,KAAK,OAAA,EAAS;AACxC,YAAA,CAAA,GAAIZ,KAAAA,CAAK,IAAA,CAAK,IAAA,CAAK,IAAA,EAAM,CAAC,CAAA;AAAA,UAC5B;AACA,UAAA,IAAA,CAAK,UAAA,CAAW,OAAO,CAAC,CAAA;AAAA,QAC1B;AAEA,QAAA;AAAA,MACF;AAIA,MAAA,MAAA,CAAO,KAAA,EAAM;AACb,MAAA,KAAA,IAAS,CAAA,GAAI,CAAA,EAAG,CAAA,GAAI,GAAA,EAAK,CAAA,EAAA,EAAM;AAC7B,QAAA,IAAI,CAAA,GAAI,eAAe,CAAC,CAAA;AACxB,QAAA,IAAI,UAAA;AACJ,QAAA,IAAI,MAAA;AACF,UAAA,UAAA,GAAa,CAAC,QAAQ,CAAC,CAAA;AAAA;AAEvB,UAAA,UAAA,GAAa,CAAC,CAAC,CAAA;AACjB,QAAA,IAAA,CAAK,SAAS,UAAA,CAAW,MAAA,CAAO,MAAM,CAAA,EAAG,OAAO,UAAU,CAAA;AAAA,MAC5D;AAAA,IACF,CAAA;AAGA,IAAA,QAAA,CAAS,SAAA,CAAU,UAAA,GAAa,SAAU,KAAA,EAAO,CAAA,EAAG;AAClD,MAAA,IAAI,SAAA,CAAU,MAAM,CAAC,CAAA;AACnB,QAAA;AAEF,MAAA,IAAI,GAAA,GAAM,IAAA,CAAK,QAAA,CAAS,CAAC,CAAA;AAEzB,MAAA,IAAI,IAAA,CAAK,IAAA;AACP,QAAA,CAAA,GAAI,IAAA,CAAK,MAAM,CAAC,CAAA;AAElB,MAAA,IAAI,KAAK,QAAA,EAAU;AACjB,QAAA,CAAA,GAAI,GAAA;AAAA,MACN;AAEA,MAAA,IAAI,IAAA,CAAK,OAAA,CAAQ,KAAK,CAAA,CAAE,CAAC,CAAA;AACvB,QAAA;AAEF,MAAA,IAAI,KAAK,KAAA,EAAO;AACd,QAAA,IAAI,CAAA,GAAI,IAAA,CAAK,KAAA,CAAM,GAAG,CAAA;AACtB,QAAA,IAAI,CAAA,KAAM,KAAA,IAAS,KAAA,CAAM,OAAA,CAAQ,CAAC,CAAA;AAChC,UAAA;AAAA,MACJ;AAEA,MAAA,IAAA,CAAK,OAAA,CAAQ,KAAK,CAAA,CAAE,CAAC,CAAA,GAAI,IAAA;AAEzB,MAAA,IAAI,IAAA,CAAK,IAAA;AACP,QAAA,IAAA,CAAK,MAAM,CAAC,CAAA;AAAA,IAChB,CAAA;AAGA,IAAA,QAAA,CAAS,SAAA,CAAU,kBAAA,GAAqB,SAAU,GAAA,EAAK;AAGrD,MAAA,IAAI,IAAA,CAAK,MAAA;AACP,QAAA,OAAO,IAAA,CAAK,QAAA,CAAS,GAAA,EAAK,KAAK,CAAA;AAEjC,MAAA,IAAI,OAAA;AACJ,MAAA,IAAI,KAAA;AAEJ,MAAA,IAAI;AACF,QAAA,KAAA,GAAQ,IAAA,CAAK,EAAA,CAAG,SAAA,CAAU,GAAG,CAAA;AAAA,MAC/B,SAAS,EAAA,EAAI;AACX,QAAA,IAAI,EAAA,CAAG,SAAS,QAAA,EAAU;AAExB,UAAA,OAAO,IAAA;AAAA,QACT;AAAA,MACF;AAEA,MAAA,IAAI,KAAA,GAAQ,KAAA,IAAS,KAAA,CAAM,cAAA,EAAe;AAC1C,MAAA,IAAA,CAAK,QAAA,CAAS,GAAG,CAAA,GAAI,KAAA;AAIrB,MAAA,IAAI,CAAC,KAAA,IAAS,KAAA,IAAS,CAAC,MAAM,WAAA,EAAY;AACxC,QAAA,IAAA,CAAK,KAAA,CAAM,GAAG,CAAA,GAAI,MAAA;AAAA;AAElB,QAAA,OAAA,GAAU,IAAA,CAAK,QAAA,CAAS,GAAA,EAAK,KAAK,CAAA;AAEpC,MAAA,OAAO,OAAA;AAAA,IACT,CAAA;AAEA,IAAA,QAAA,CAAS,SAAA,CAAU,QAAA,GAAW,SAAU,GAAA,EAAK,UAAA,EAAY;AAGvD,MAAA,IAAI,UAAA,IAAc,CAAC,OAAA,CAAQ,IAAA,CAAK,UAAU,GAAG,CAAA;AAC3C,QAAA,OAAO,IAAA,CAAK,mBAAmB,GAAG,CAAA;AAEpC,MAAA,IAAI,OAAA,CAAQ,IAAA,CAAK,KAAA,EAAO,GAAG,CAAA,EAAG;AAC5B,QAAA,IAAI,CAAA,GAAI,IAAA,CAAK,KAAA,CAAM,GAAG,CAAA;AACtB,QAAA,IAAI,CAAC,KAAK,CAAA,KAAM,MAAA;AACd,UAAA,OAAO,IAAA;AAET,QAAA,IAAI,KAAA,CAAM,QAAQ,CAAC,CAAA;AACjB,UAAA,OAAO,CAAA;AAAA,MACX;AAEA,MAAA,IAAI;AACF,QAAA,OAAO,KAAK,eAAA,CAAgB,GAAA,EAAK,KAAK,EAAA,CAAG,WAAA,CAAY,GAAG,CAAC,CAAA;AAAA,MAC3D,SAAS,EAAA,EAAI;AACX,QAAA,IAAA,CAAK,aAAA,CAAc,KAAK,EAAE,CAAA;AAC1B,QAAA,OAAO,IAAA;AAAA,MACT;AAAA,IACF,CAAA;AAEA,IAAA,QAAA,CAAS,SAAA,CAAU,eAAA,GAAkB,SAAU,GAAA,EAAK,OAAA,EAAS;AAI3D,MAAA,IAAI,CAAC,IAAA,CAAK,IAAA,IAAQ,CAAC,KAAK,IAAA,EAAM;AAC5B,QAAA,KAAA,IAAS,CAAA,GAAI,CAAA,EAAG,CAAA,GAAI,OAAA,CAAQ,QAAQ,CAAA,EAAA,EAAM;AACxC,UAAA,IAAI,CAAA,GAAI,QAAQ,CAAC,CAAA;AACjB,UAAA,IAAI,GAAA,KAAQ,GAAA;AACV,YAAA,CAAA,GAAI,GAAA,GAAM,CAAA;AAAA;AAEV,YAAA,CAAA,GAAI,MAAM,GAAA,GAAM,CAAA;AAClB,UAAA,IAAA,CAAK,KAAA,CAAM,CAAC,CAAA,GAAI,IAAA;AAAA,QAClB;AAAA,MACF;AAEA,MAAA,IAAA,CAAK,KAAA,CAAM,GAAG,CAAA,GAAI,OAAA;AAGlB,MAAA,OAAO,OAAA;AAAA,IACT,CAAA;AAEA,IAAA,QAAA,CAAS,SAAA,CAAU,aAAA,GAAgB,SAAU,CAAA,EAAG,EAAA,EAAI;AAElD,MAAA,QAAQ,GAAG,IAAA;AAAM,QACf,KAAK,SAAA;AAAA;AAAA,QACL,KAAK,SAAA;AACH,UAAA,IAAI,GAAA,GAAM,IAAA,CAAK,QAAA,CAAS,CAAC,CAAA;AACzB,UAAA,IAAA,CAAK,KAAA,CAAM,GAAG,CAAA,GAAI,MAAA;AAClB,UAAA,IAAI,GAAA,KAAQ,KAAK,MAAA,EAAQ;AACvB,YAAA,IAAI,QAAQ,IAAI,KAAA,CAAM,GAAG,IAAA,GAAO,eAAA,GAAkB,KAAK,GAAG,CAAA;AAC1D,YAAA,KAAA,CAAM,OAAO,IAAA,CAAK,GAAA;AAClB,YAAA,KAAA,CAAM,OAAO,EAAA,CAAG,IAAA;AAChB,YAAA,MAAM,KAAA;AAAA,UACR;AACA,UAAA;AAAA,QAEF,KAAK,QAAA;AAAA;AAAA,QACL,KAAK,OAAA;AAAA,QACL,KAAK,cAAA;AAAA,QACL,KAAK,SAAA;AACH,UAAA,IAAA,CAAK,KAAA,CAAM,IAAA,CAAK,QAAA,CAAS,CAAC,CAAC,CAAA,GAAI,KAAA;AAC/B,UAAA;AAAA,QAEF;AACE,UAAA,IAAA,CAAK,KAAA,CAAM,IAAA,CAAK,QAAA,CAAS,CAAC,CAAC,CAAA,GAAI,KAAA;AAC/B,UAAA,IAAI,IAAA,CAAK,MAAA;AACP,YAAA,MAAM,EAAA;AACR,UAAA,IAAI,CAAC,IAAA,CAAK,MAAA;AACR,YAAA,OAAA,CAAQ,KAAA,CAAM,cAAc,EAAE,CAAA;AAChC,UAAA;AAAA;AACJ,IACF,CAAA;AAEA,IAAA,QAAA,CAAS,SAAA,CAAU,mBAAmB,SAAU,MAAA,EAAQ,MAAM,GAAA,EAAK,MAAA,EAAQ,OAAO,UAAA,EAAY;AAE5F,MAAA,IAAI,OAAA,GAAU,IAAA,CAAK,QAAA,CAAS,GAAA,EAAK,UAAU,CAAA;AAI3C,MAAA,IAAI,CAAC,OAAA;AACH,QAAA;AAIF,MAAA,IAAI,qBAAA,GAAwB,MAAA,CAAO,KAAA,CAAM,CAAC,CAAA;AAC1C,MAAA,IAAI,MAAA,GAAS,MAAA,GAAS,CAAE,MAAO,IAAI,EAAC;AACpC,MAAA,IAAI,UAAA,GAAa,MAAA,CAAO,MAAA,CAAO,qBAAqB,CAAA;AAGpD,MAAA,IAAA,CAAK,QAAA,CAAS,UAAA,EAAY,KAAA,EAAO,KAAK,CAAA;AAEtC,MAAA,IAAI,MAAM,OAAA,CAAQ,MAAA;AAClB,MAAA,IAAI,KAAA,GAAQ,IAAA,CAAK,QAAA,CAAS,GAAG,CAAA;AAG7B,MAAA,IAAI,KAAA,IAAS,UAAA;AACX,QAAA;AAEF,MAAA,KAAA,IAAS,CAAA,GAAI,CAAA,EAAG,CAAA,GAAI,GAAA,EAAK,CAAA,EAAA,EAAK;AAC5B,QAAA,IAAI,CAAA,GAAI,QAAQ,CAAC,CAAA;AACjB,QAAA,IAAI,EAAE,MAAA,CAAO,CAAC,CAAA,KAAM,GAAA,IAAO,CAAC,IAAA,CAAK,GAAA;AAC/B,UAAA;AAGF,QAAA,IAAI,UAAU,MAAA,CAAO,MAAA,CAAO,OAAA,CAAQ,CAAC,GAAG,qBAAqB,CAAA;AAC7D,QAAA,IAAA,CAAK,QAAA,CAAS,OAAA,EAAS,KAAA,EAAO,IAAI,CAAA;AAElC,QAAA,IAAI,QAAQ,MAAA,CAAO,MAAA,CAAO,OAAA,CAAQ,CAAC,GAAG,MAAM,CAAA;AAC5C,QAAA,IAAA,CAAK,QAAA,CAAS,KAAA,EAAO,KAAA,EAAO,IAAI,CAAA;AAAA,MAClC;AAAA,IACF,CAAA;AAEA,IAAA,QAAA,CAAS,SAAA,CAAU,cAAA,GAAiB,SAAU,MAAA,EAAQ,KAAA,EAAO;AAG3D,MAAA,IAAI,MAAA,GAAS,IAAA,CAAK,KAAA,CAAM,MAAM,CAAA;AAE9B,MAAA,IAAI,CAAC,IAAA,CAAK,OAAA,CAAQ,KAAK,CAAA;AACrB,QAAA,IAAA,CAAK,OAAA,CAAQ,KAAK,CAAA,mBAAI,MAAA,CAAO,OAAO,IAAI,CAAA;AAG1C,MAAA,IAAI,CAAC,MAAA;AACH,QAAA;AAEF,MAAA,IAAI,UAAUY,WAAAA,CAAW,MAAM,CAAA,IAAK,CAAC,KAAK,OAAA,EAAS;AACjD,QAAA,IAAI,KAAA,GAAQ,SAAA,CAAU,IAAA,CAAK,MAAM,CAAA;AACjC,QAAA,IAAI,MAAA,CAAO,MAAA,CAAO,CAAC,CAAA,KAAM,GAAA,EAAK;AAC5B,UAAA,MAAA,GAASZ,KAAAA,CAAK,IAAA,CAAK,IAAA,CAAK,IAAA,EAAM,MAAM,CAAA;AAAA,QACtC,CAAA,MAAO;AACL,UAAA,MAAA,GAASA,KAAAA,CAAK,OAAA,CAAQ,IAAA,CAAK,IAAA,EAAM,MAAM,CAAA;AACvC,UAAA,IAAI,KAAA;AACF,YAAA,MAAA,IAAU,GAAA;AAAA,QACd;AAAA,MACF;AAEA,MAAA,IAAI,QAAQ,QAAA,KAAa,OAAA;AACvB,QAAA,MAAA,GAAS,MAAA,CAAO,OAAA,CAAQ,KAAA,EAAO,GAAG,CAAA;AAGpC,MAAA,IAAA,CAAK,UAAA,CAAW,OAAO,MAAM,CAAA;AAAA,IAC/B,CAAA;AAGA,IAAA,QAAA,CAAS,SAAA,CAAU,KAAA,GAAQ,SAAU,CAAA,EAAG;AACtC,MAAA,IAAI,GAAA,GAAM,IAAA,CAAK,QAAA,CAAS,CAAC,CAAA;AACzB,MAAA,IAAI,OAAA,GAAU,CAAA,CAAE,KAAA,CAAM,EAAE,CAAA,KAAM,GAAA;AAE9B,MAAA,IAAI,CAAA,CAAE,SAAS,IAAA,CAAK,SAAA;AAClB,QAAA,OAAO,KAAA;AAET,MAAA,IAAI,CAAC,IAAA,CAAK,IAAA,IAAQ,QAAQ,IAAA,CAAK,KAAA,EAAO,GAAG,CAAA,EAAG;AAC1C,QAAA,IAAI,CAAA,GAAI,IAAA,CAAK,KAAA,CAAM,GAAG,CAAA;AAEtB,QAAA,IAAI,KAAA,CAAM,QAAQ,CAAC,CAAA;AACjB,UAAA,CAAA,GAAI,KAAA;AAGN,QAAA,IAAI,CAAC,WAAW,CAAA,KAAM,KAAA;AACpB,UAAA,OAAO,CAAA;AAET,QAAA,IAAI,WAAW,CAAA,KAAM,MAAA;AACnB,UAAA,OAAO,KAAA;AAAA,MAIX;AAGA,MAAA,IAAIG,KAAAA,GAAO,IAAA,CAAK,SAAA,CAAU,GAAG,CAAA;AAC7B,MAAA,IAAI,CAACA,KAAAA,EAAM;AACT,QAAA,IAAI,KAAA;AACJ,QAAA,IAAI;AACF,UAAA,KAAA,GAAQ,IAAA,CAAK,EAAA,CAAG,SAAA,CAAU,GAAG,CAAA;AAAA,QAC/B,SAAS,EAAA,EAAI;AACX,UAAA,IAAI,OAAO,EAAA,CAAG,IAAA,KAAS,QAAA,IAAY,EAAA,CAAG,SAAS,SAAA,CAAA,EAAY;AACzD,YAAA,IAAA,CAAK,SAAA,CAAU,GAAG,CAAA,GAAI,KAAA;AACtB,YAAA,OAAO,KAAA;AAAA,UACT;AAAA,QACF;AAEA,QAAA,IAAI,KAAA,IAAS,KAAA,CAAM,cAAA,EAAe,EAAG;AACnC,UAAA,IAAI;AACF,YAAAA,KAAAA,GAAO,IAAA,CAAK,EAAA,CAAG,QAAA,CAAS,GAAG,CAAA;AAAA,UAC7B,SAAS,EAAA,EAAI;AACX,YAAAA,KAAAA,GAAO,KAAA;AAAA,UACT;AAAA,QACF,CAAA,MAAO;AACL,UAAAA,KAAAA,GAAO,KAAA;AAAA,QACT;AAAA,MACF;AAEA,MAAA,IAAA,CAAK,SAAA,CAAU,GAAG,CAAA,GAAIA,KAAAA;AAEtB,MAAA,IAAI,CAAA,GAAI,IAAA;AACR,MAAA,IAAIA,KAAAA;AACF,QAAA,CAAA,GAAIA,KAAAA,CAAK,WAAA,EAAY,GAAI,KAAA,GAAQ,MAAA;AAEnC,MAAA,IAAA,CAAK,MAAM,GAAG,CAAA,GAAI,IAAA,CAAK,KAAA,CAAM,GAAG,CAAA,IAAK,CAAA;AAErC,MAAA,IAAI,WAAW,CAAA,KAAM,MAAA;AACnB,QAAA,OAAO,KAAA;AAET,MAAA,OAAO,CAAA;AAAA,IACT,CAAA;AAEA,IAAA,QAAA,CAAS,SAAA,CAAU,KAAA,GAAQ,SAAU,CAAA,EAAG;AACtC,MAAA,OAAO,MAAA,CAAO,IAAA,CAAK,IAAA,EAAM,CAAC,CAAA;AAAA,IAC5B,CAAA;AAEA,IAAA,QAAA,CAAS,SAAA,CAAU,QAAA,GAAW,SAAU,CAAA,EAAG;AACzC,MAAA,OAAO,MAAA,CAAO,OAAA,CAAQ,IAAA,EAAM,CAAC,CAAA;AAAA,IAC/B,CAAA;AAAA,EAAA;AAAA,CAAA,CAAA;;;ACreA,IAAA,cAAA,GAAA,UAAA,CAAA;AAAA,EAAA,+BAAA,CAAAD,SAAA,EAAA,MAAA,EAAA;AAKA,IAAA,MAAA,CAAO,OAAA,GAAU,MAAA;AACjB,IAAA,SAAS,MAAA,CAAQ,IAAI,EAAA,EAAI;AACvB,MAAA,IAAI,MAAM,EAAA,EAAI,OAAO,MAAA,CAAO,EAAE,EAAE,EAAE,CAAA;AAElC,MAAA,IAAI,OAAO,EAAA,KAAO,UAAA;AAChB,QAAA,MAAM,IAAI,UAAU,uBAAuB,CAAA;AAE7C,MAAA,MAAA,CAAO,IAAA,CAAK,EAAE,CAAA,CAAE,OAAA,CAAQ,SAAU,CAAA,EAAG;AACnC,QAAA,OAAA,CAAQ,CAAC,CAAA,GAAI,EAAA,CAAG,CAAC,CAAA;AAAA,MACnB,CAAC,CAAA;AAED,MAAA,OAAO,OAAA;AAEP,MAAA,SAAS,OAAA,GAAU;AACjB,QAAA,IAAI,IAAA,GAAO,IAAI,KAAA,CAAM,SAAA,CAAU,MAAM,CAAA;AACrC,QAAA,KAAA,IAAS,CAAA,GAAI,CAAA,EAAG,CAAA,GAAI,IAAA,CAAK,QAAQ,CAAA,EAAA,EAAK;AACpC,UAAA,IAAA,CAAK,CAAC,CAAA,GAAI,SAAA,CAAU,CAAC,CAAA;AAAA,QACvB;AACA,QAAA,IAAI,GAAA,GAAM,EAAA,CAAG,KAAA,CAAM,IAAA,EAAM,IAAI,CAAA;AAC7B,QAAA,IAAIY,GAAAA,GAAK,IAAA,CAAK,IAAA,CAAK,MAAA,GAAO,CAAC,CAAA;AAC3B,QAAA,IAAI,OAAO,GAAA,KAAQ,UAAA,IAAc,GAAA,KAAQA,GAAAA,EAAI;AAC3C,UAAA,MAAA,CAAO,IAAA,CAAKA,GAAE,CAAA,CAAE,OAAA,CAAQ,SAAU,CAAA,EAAG;AACnC,YAAA,GAAA,CAAI,CAAC,CAAA,GAAIA,GAAAA,CAAG,CAAC,CAAA;AAAA,UACf,CAAC,CAAA;AAAA,QACH;AACA,QAAA,OAAO,GAAA;AAAA,MACT;AAAA,IACF;AAAA,EAAA;AAAA,CAAA,CAAA;;;AChCA,IAAA,YAAA,GAAA,UAAA,CAAA;AAAA,EAAA,2BAAA,CAAAZ,SAAA,EAAA,MAAA,EAAA;AAAA,IAAA,IAAI,MAAA,GAAS,cAAA,EAAA;AACb,IAAA,MAAA,CAAO,OAAA,GAAU,OAAO,IAAI,CAAA;AAC5B,IAAA,MAAA,CAAO,OAAA,CAAQ,MAAA,GAAS,MAAA,CAAO,UAAU,CAAA;AAEzC,IAAA,IAAA,CAAK,KAAA,GAAQ,KAAK,WAAY;AAC5B,MAAA,MAAA,CAAO,cAAA,CAAe,QAAA,CAAS,SAAA,EAAW,MAAA,EAAQ;AAAA,QAChD,OAAO,WAAY;AACjB,UAAA,OAAO,KAAK,IAAI,CAAA;AAAA,QAClB,CAAA;AAAA,QACA,YAAA,EAAc;AAAA,OACf,CAAA;AAED,MAAA,MAAA,CAAO,cAAA,CAAe,QAAA,CAAS,SAAA,EAAW,YAAA,EAAc;AAAA,QACtD,OAAO,WAAY;AACjB,UAAA,OAAO,WAAW,IAAI,CAAA;AAAA,QACxB,CAAA;AAAA,QACA,YAAA,EAAc;AAAA,OACf,CAAA;AAAA,IACH,CAAC,CAAA;AAED,IAAA,SAAS,KAAM,EAAA,EAAI;AACjB,MAAA,IAAI,IAAI,WAAY;AAClB,QAAA,IAAI,CAAA,CAAE,MAAA,EAAQ,OAAO,CAAA,CAAE,KAAA;AACvB,QAAA,CAAA,CAAE,MAAA,GAAS,IAAA;AACX,QAAA,OAAO,CAAA,CAAE,KAAA,GAAQ,EAAA,CAAG,KAAA,CAAM,MAAM,SAAS,CAAA;AAAA,MAC3C,CAAA;AACA,MAAA,CAAA,CAAE,MAAA,GAAS,KAAA;AACX,MAAA,OAAO,CAAA;AAAA,IACT;AAEA,IAAA,SAAS,WAAY,EAAA,EAAI;AACvB,MAAA,IAAI,IAAI,WAAY;AAClB,QAAA,IAAI,CAAA,CAAE,MAAA;AACJ,UAAA,MAAM,IAAI,KAAA,CAAM,CAAA,CAAE,SAAS,CAAA;AAC7B,QAAA,CAAA,CAAE,MAAA,GAAS,IAAA;AACX,QAAA,OAAO,CAAA,CAAE,KAAA,GAAQ,EAAA,CAAG,KAAA,CAAM,MAAM,SAAS,CAAA;AAAA,MAC3C,CAAA;AACA,MAAA,IAAI,IAAA,GAAO,GAAG,IAAA,IAAQ,8BAAA;AACtB,MAAA,CAAA,CAAE,YAAY,IAAA,GAAO,qCAAA;AACrB,MAAA,CAAA,CAAE,MAAA,GAAS,KAAA;AACX,MAAA,OAAO,CAAA;AAAA,IACT;AAAA,EAAA;AAAA,CAAA,CAAA;;;ACzCA,IAAA,gBAAA,GAAA,UAAA,CAAA;AAAA,EAAA,mCAAA,CAAAA,SAAA,EAAA,MAAA,EAAA;AAAA,IAAA,IAAI,MAAA,GAAS,cAAA,EAAA;AACb,IAAA,IAAI,IAAA,mBAAO,MAAA,CAAO,MAAA,CAAO,IAAI,CAAA;AAC7B,IAAA,IAAI,IAAA,GAAO,YAAA,EAAA;AAEX,IAAA,MAAA,CAAO,OAAA,GAAU,OAAO,QAAQ,CAAA;AAEhC,IAAA,SAAS,QAAA,CAAU,KAAK,EAAA,EAAI;AAC1B,MAAA,IAAI,IAAA,CAAK,GAAG,CAAA,EAAG;AACb,QAAA,IAAA,CAAK,GAAG,CAAA,CAAE,IAAA,CAAK,EAAE,CAAA;AACjB,QAAA,OAAO,IAAA;AAAA,MACT,CAAA,MAAO;AACL,QAAA,IAAA,CAAK,GAAG,CAAA,GAAI,CAAC,EAAE,CAAA;AACf,QAAA,OAAO,QAAQ,GAAG,CAAA;AAAA,MACpB;AAAA,IACF;AAEA,IAAA,SAAS,QAAS,GAAA,EAAK;AACrB,MAAA,OAAO,IAAA,CAAK,SAAS,GAAA,GAAO;AAC1B,QAAA,IAAI,GAAA,GAAM,KAAK,GAAG,CAAA;AAClB,QAAA,IAAI,MAAM,GAAA,CAAI,MAAA;AACd,QAAA,IAAI,IAAA,GAAO,MAAM,SAAS,CAAA;AAQ1B,QAAA,IAAI;AACF,UAAA,KAAA,IAAS,CAAA,GAAI,CAAA,EAAG,CAAA,GAAI,GAAA,EAAK,CAAA,EAAA,EAAK;AAC5B,YAAA,GAAA,CAAI,CAAC,CAAA,CAAE,KAAA,CAAM,IAAA,EAAM,IAAI,CAAA;AAAA,UACzB;AAAA,QACF,CAAA,SAAE;AACA,UAAA,IAAI,GAAA,CAAI,SAAS,GAAA,EAAK;AAGpB,YAAA,GAAA,CAAI,MAAA,CAAO,GAAG,GAAG,CAAA;AACjB,YAAA,OAAA,CAAQ,SAAS,WAAY;AAC3B,cAAA,GAAA,CAAI,KAAA,CAAM,MAAM,IAAI,CAAA;AAAA,YACtB,CAAC,CAAA;AAAA,UACH,CAAA,MAAO;AACL,YAAA,OAAO,KAAK,GAAG,CAAA;AAAA,UACjB;AAAA,QACF;AAAA,MACF,CAAC,CAAA;AAAA,IACH;AAEA,IAAA,SAAS,MAAO,IAAA,EAAM;AACpB,MAAA,IAAI,SAAS,IAAA,CAAK,MAAA;AAClB,MAAA,IAAI,QAAQ,EAAC;AAEb,MAAA,KAAA,IAAS,CAAA,GAAI,GAAG,CAAA,GAAI,MAAA,EAAQ,KAAK,KAAA,CAAM,CAAC,CAAA,GAAI,IAAA,CAAK,CAAC,CAAA;AAClD,MAAA,OAAO,KAAA;AAAA,IACT;AAAA,EAAA;AAAA,CAAA,CAAA;;;ACrDA,IAAA,YAAA,GAAA,UAAA,CAAA;AAAA,EAAA,2BAAA,CAAAA,SAAA,EAAA,MAAA,EAAA;AAwCA,IAAA,MAAA,CAAO,OAAA,GAAUa,KAAAA;AAEjB,IAAA,IAAI,EAAA,GAAK,UAAA,EAAA;AACT,IAAA,IAAI,SAAA,GAAY,iBAAA,EAAA;AAChB,IAAgB,SAAA,CAAU;AAC1B,IAAA,IAAI,QAAA,GAAW,gBAAA,EAAA;AACf,IAAA,IAAI,EAAA,GAAK,SAAA,CAAQ,QAAQ,CAAA,CAAE,YAAA;AAC3B,IAAA,IAAIf,KAAAA,GAAO,UAAQ,MAAM,CAAA;AACzB,IAAA,IAAI,MAAA,GAAS,UAAQ,QAAQ,CAAA;AAC7B,IAAA,IAAIY,WAAAA,GAAa,wBAAA,EAAA;AACjB,IAAA,IAAI,QAAA,GAAW,YAAA,EAAA;AACf,IAAA,IAAI,MAAA,GAAS,cAAA,EAAA;AACb,IAAA,IAAI,UAAU,MAAA,CAAO,OAAA;AACrB,IAAA,IAAI,UAAU,MAAA,CAAO,OAAA;AACrB,IAAA,IAAI,QAAA,GAAW,gBAAA,EAAA;AACf,IAAW,UAAQ,MAAM;AACzB,IAAA,IAAI,kBAAkB,MAAA,CAAO,eAAA;AAC7B,IAAA,IAAI,YAAY,MAAA,CAAO,SAAA;AAEvB,IAAA,IAAI,IAAA,GAAO,YAAA,EAAA;AAEX,IAAA,SAASG,KAAAA,CAAM,OAAA,EAAS,OAAA,EAAS,EAAA,EAAI;AACnC,MAAA,IAAI,OAAO,OAAA,KAAY,UAAA,EAAY,EAAA,GAAK,OAAA,EAAS,UAAU,EAAC;AAC5D,MAAA,IAAI,CAAC,OAAA,EAAS,OAAA,GAAU,EAAC;AAEzB,MAAA,IAAI,QAAQ,IAAA,EAAM;AAChB,QAAA,IAAI,EAAA;AACF,UAAA,MAAM,IAAI,UAAU,gCAAgC,CAAA;AACtD,QAAA,OAAO,QAAA,CAAS,SAAS,OAAO,CAAA;AAAA,MAClC;AAEA,MAAA,OAAO,IAAI,IAAA,CAAK,OAAA,EAAS,OAAA,EAAS,EAAE,CAAA;AAAA,IACtC;AAEA,IAAAA,MAAK,IAAA,GAAO,QAAA;AACZ,IAAA,IAAI,QAAA,GAAWA,KAAAA,CAAK,QAAA,GAAW,QAAA,CAAS,QAAA;AAGxC,IAAAA,MAAK,IAAA,GAAOA,KAAAA;AAEZ,IAAA,SAAS,MAAA,CAAQ,QAAQ,GAAA,EAAK;AAC5B,MAAA,IAAI,GAAA,KAAQ,IAAA,IAAQ,OAAO,GAAA,KAAQ,QAAA,EAAU;AAC3C,QAAA,OAAO,MAAA;AAAA,MACT;AAEA,MAAA,IAAI,IAAA,GAAO,MAAA,CAAO,IAAA,CAAK,GAAG,CAAA;AAC1B,MAAA,IAAI,IAAI,IAAA,CAAK,MAAA;AACb,MAAA,OAAO,CAAA,EAAA,EAAK;AACV,QAAA,MAAA,CAAO,KAAK,CAAC,CAAC,IAAI,GAAA,CAAI,IAAA,CAAK,CAAC,CAAC,CAAA;AAAA,MAC/B;AACA,MAAA,OAAO,MAAA;AAAA,IACT;AAEA,IAAAA,KAAAA,CAAK,QAAA,GAAW,SAAU,OAAA,EAAS,QAAA,EAAU;AAC3C,MAAA,IAAI,OAAA,GAAU,MAAA,CAAO,EAAC,EAAG,QAAQ,CAAA;AACjC,MAAA,OAAA,CAAQ,SAAA,GAAY,IAAA;AAEpB,MAAA,IAAI,CAAA,GAAI,IAAI,IAAA,CAAK,OAAA,EAAS,OAAO,CAAA;AACjC,MAAA,IAAI,GAAA,GAAM,EAAE,SAAA,CAAU,GAAA;AAEtB,MAAA,IAAI,CAAC,OAAA;AACH,QAAA,OAAO,KAAA;AAET,MAAA,IAAI,IAAI,MAAA,GAAS,CAAA;AACf,QAAA,OAAO,IAAA;AAET,MAAA,KAAA,IAAS,IAAI,CAAA,EAAG,CAAA,GAAI,IAAI,CAAC,CAAA,CAAE,QAAQ,CAAA,EAAA,EAAK;AACtC,QAAA,IAAI,OAAO,GAAA,CAAI,CAAC,CAAA,CAAE,CAAC,CAAA,KAAM,QAAA;AACvB,UAAA,OAAO,IAAA;AAAA,MACX;AAEA,MAAA,OAAO,KAAA;AAAA,IACT,CAAA;AAEA,IAAAA,MAAK,IAAA,GAAO,IAAA;AACZ,IAAA,QAAA,CAAS,MAAM,EAAE,CAAA;AACjB,IAAA,SAAS,IAAA,CAAM,OAAA,EAAS,OAAA,EAAS,EAAA,EAAI;AACnC,MAAA,IAAI,OAAO,YAAY,UAAA,EAAY;AACjC,QAAA,EAAA,GAAK,OAAA;AACL,QAAA,OAAA,GAAU,IAAA;AAAA,MACZ;AAEA,MAAA,IAAI,OAAA,IAAW,QAAQ,IAAA,EAAM;AAC3B,QAAA,IAAI,EAAA;AACF,UAAA,MAAM,IAAI,UAAU,gCAAgC,CAAA;AACtD,QAAA,OAAO,IAAI,QAAA,CAAS,OAAA,EAAS,OAAO,CAAA;AAAA,MACtC;AAEA,MAAA,IAAI,EAAE,IAAA,YAAgB,IAAA,CAAA;AACpB,QAAA,OAAO,IAAI,IAAA,CAAK,OAAA,EAAS,OAAA,EAAS,EAAE,CAAA;AAEtC,MAAA,OAAA,CAAQ,IAAA,EAAM,SAAS,OAAO,CAAA;AAC9B,MAAA,IAAA,CAAK,YAAA,GAAe,KAAA;AAGpB,MAAA,IAAI,CAAA,GAAI,IAAA,CAAK,SAAA,CAAU,GAAA,CAAI,MAAA;AAM3B,MAAA,IAAA,CAAK,OAAA,GAAU,IAAI,KAAA,CAAM,CAAC,CAAA;AAE1B,MAAA,IAAI,OAAO,OAAO,UAAA,EAAY;AAC5B,QAAA,EAAA,GAAK,KAAK,EAAE,CAAA;AACZ,QAAA,IAAA,CAAK,EAAA,CAAG,SAAS,EAAE,CAAA;AACnB,QAAA,IAAA,CAAK,EAAA,CAAG,KAAA,EAAO,SAAU,OAAA,EAAS;AAChC,UAAA,EAAA,CAAG,MAAM,OAAO,CAAA;AAAA,QAClB,CAAC,CAAA;AAAA,MACH;AAEA,MAAA,IAAI,IAAA,GAAO,IAAA;AACX,MAAA,IAAA,CAAK,WAAA,GAAc,CAAA;AAEnB,MAAA,IAAA,CAAK,aAAa,EAAC;AACnB,MAAA,IAAA,CAAK,gBAAgB,EAAC;AACtB,MAAA,IAAA,CAAK,MAAA,GAAS,KAAA;AAEd,MAAA,IAAI,IAAA,CAAK,SAAA;AACP,QAAA,OAAO,IAAA;AAET,MAAA,IAAI,CAAA,KAAM,CAAA;AACR,QAAA,OAAO,IAAA,EAAK;AAEd,MAAA,IAAI,IAAA,GAAO,IAAA;AACX,MAAA,KAAA,IAAS,CAAA,GAAI,CAAA,EAAG,CAAA,GAAI,CAAA,EAAG,CAAA,EAAA,EAAM;AAC3B,QAAA,IAAA,CAAK,QAAA,CAAS,KAAK,SAAA,CAAU,GAAA,CAAI,CAAC,CAAA,EAAG,CAAA,EAAG,OAAO,IAAI,CAAA;AAAA,MACrD;AACA,MAAA,IAAA,GAAO,KAAA;AAEP,MAAA,SAAS,IAAA,GAAQ;AACf,QAAA,EAAE,IAAA,CAAK,WAAA;AACP,QAAA,IAAI,IAAA,CAAK,eAAe,CAAA,EAAG;AACzB,UAAA,IAAI,IAAA,EAAM;AACR,YAAA,OAAA,CAAQ,SAAS,WAAY;AAC3B,cAAA,IAAA,CAAK,OAAA,EAAQ;AAAA,YACf,CAAC,CAAA;AAAA,UACH,CAAA,MAAO;AACL,YAAA,IAAA,CAAK,OAAA,EAAQ;AAAA,UACf;AAAA,QACF;AAAA,MACF;AAAA,IACF;AAEA,IAAA,IAAA,CAAK,SAAA,CAAU,UAAU,WAAY;AACnC,MAAA,MAAA,CAAO,gBAAgB,IAAI,CAAA;AAC3B,MAAA,IAAI,IAAA,CAAK,OAAA;AACP,QAAA;AAEF,MAAA,IAAI,IAAA,CAAK,QAAA,IAAY,CAAC,IAAA,CAAK,YAAA;AACzB,QAAA,OAAO,KAAK,SAAA,EAAU;AAExB,MAAA,MAAA,CAAO,OAAO,IAAI,CAAA;AAClB,MAAA,IAAA,CAAK,IAAA,CAAK,KAAA,EAAO,IAAA,CAAK,KAAK,CAAA;AAAA,IAC7B,CAAA;AAEA,IAAA,IAAA,CAAK,SAAA,CAAU,YAAY,WAAY;AACrC,MAAA,IAAI,IAAA,CAAK,YAAA;AACP,QAAA;AAEF,MAAA,IAAA,CAAK,YAAA,GAAe,IAAA;AAEpB,MAAA,IAAI,CAAA,GAAI,KAAK,OAAA,CAAQ,MAAA;AACrB,MAAA,IAAI,CAAA,KAAM,CAAA;AACR,QAAA,OAAO,KAAK,OAAA,EAAQ;AAEtB,MAAA,IAAI,IAAA,GAAO,IAAA;AACX,MAAA,KAAA,IAAS,CAAA,GAAI,CAAA,EAAG,CAAA,GAAI,IAAA,CAAK,QAAQ,MAAA,EAAQ,CAAA,EAAA;AACvC,QAAA,IAAA,CAAK,YAAA,CAAa,GAAG,IAAI,CAAA;AAE3B,MAAA,SAAS,IAAA,GAAQ;AACf,QAAA,IAAI,EAAE,CAAA,KAAM,CAAA;AACV,UAAA,IAAA,CAAK,OAAA,EAAQ;AAAA,MACjB;AAAA,IACF,CAAA;AAEA,IAAA,IAAA,CAAK,SAAA,CAAU,YAAA,GAAe,SAAU,KAAA,EAAO,EAAA,EAAI;AACjD,MAAA,IAAI,QAAA,GAAW,IAAA,CAAK,OAAA,CAAQ,KAAK,CAAA;AACjC,MAAA,IAAI,CAAC,QAAA;AACH,QAAA,OAAO,EAAA,EAAG;AAEZ,MAAA,IAAI,KAAA,GAAQ,MAAA,CAAO,IAAA,CAAK,QAAQ,CAAA;AAChC,MAAA,IAAI,IAAA,GAAO,IAAA;AACX,MAAA,IAAI,IAAI,KAAA,CAAM,MAAA;AAEd,MAAA,IAAI,CAAA,KAAM,CAAA;AACR,QAAA,OAAO,EAAA,EAAG;AAEZ,MAAA,IAAI,MAAM,IAAA,CAAK,OAAA,CAAQ,KAAK,CAAA,mBAAI,MAAA,CAAO,OAAO,IAAI,CAAA;AAClD,MAAA,KAAA,CAAM,OAAA,CAAQ,SAAU,CAAA,EAAG,CAAA,EAAG;AAI5B,QAAA,CAAA,GAAI,IAAA,CAAK,SAAS,CAAC,CAAA;AACnB,QAAA,EAAA,CAAG,SAAS,CAAA,EAAG,IAAA,CAAK,aAAA,EAAe,SAAU,IAAI,IAAA,EAAM;AACrD,UAAA,IAAI,CAAC,EAAA;AACH,YAAA,GAAA,CAAI,IAAI,CAAA,GAAI,IAAA;AAAA,eAAA,IACL,GAAG,OAAA,KAAY,MAAA;AACtB,YAAA,GAAA,CAAI,CAAC,CAAA,GAAI,IAAA;AAAA;AAET,YAAA,IAAA,CAAK,IAAA,CAAK,SAAS,EAAE,CAAA;AAEvB,UAAA,IAAI,EAAE,MAAM,CAAA,EAAG;AACb,YAAA,IAAA,CAAK,OAAA,CAAQ,KAAK,CAAA,GAAI,GAAA;AACtB,YAAA,EAAA,EAAG;AAAA,UACL;AAAA,QACF,CAAC,CAAA;AAAA,MACH,CAAC,CAAA;AAAA,IACH,CAAA;AAEA,IAAA,IAAA,CAAK,SAAA,CAAU,KAAA,GAAQ,SAAU,CAAA,EAAG;AAClC,MAAA,OAAO,MAAA,CAAO,IAAA,CAAK,IAAA,EAAM,CAAC,CAAA;AAAA,IAC5B,CAAA;AAEA,IAAA,IAAA,CAAK,SAAA,CAAU,QAAA,GAAW,SAAU,CAAA,EAAG;AACrC,MAAA,OAAO,MAAA,CAAO,OAAA,CAAQ,IAAA,EAAM,CAAC,CAAA;AAAA,IAC/B,CAAA;AAEA,IAAA,IAAA,CAAK,SAAA,CAAU,QAAQ,WAAY;AACjC,MAAA,IAAA,CAAK,OAAA,GAAU,IAAA;AACf,MAAA,IAAA,CAAK,KAAK,OAAO,CAAA;AAAA,IACnB,CAAA;AAEA,IAAA,IAAA,CAAK,SAAA,CAAU,QAAQ,WAAY;AACjC,MAAA,IAAI,CAAC,KAAK,MAAA,EAAQ;AAChB,QAAA,IAAA,CAAK,MAAA,GAAS,IAAA;AACd,QAAA,IAAA,CAAK,KAAK,OAAO,CAAA;AAAA,MACnB;AAAA,IACF,CAAA;AAEA,IAAA,IAAA,CAAK,SAAA,CAAU,SAAS,WAAY;AAClC,MAAA,IAAI,KAAK,MAAA,EAAQ;AACf,QAAA,IAAA,CAAK,KAAK,QAAQ,CAAA;AAClB,QAAA,IAAA,CAAK,MAAA,GAAS,KAAA;AACd,QAAA,IAAI,IAAA,CAAK,WAAW,MAAA,EAAQ;AAC1B,UAAA,IAAI,EAAA,GAAK,IAAA,CAAK,UAAA,CAAW,KAAA,CAAM,CAAC,CAAA;AAChC,UAAA,IAAA,CAAK,WAAW,MAAA,GAAS,CAAA;AACzB,UAAA,KAAA,IAAS,CAAA,GAAI,CAAA,EAAG,CAAA,GAAI,EAAA,CAAG,QAAQ,CAAA,EAAA,EAAM;AACnC,YAAA,IAAI,CAAA,GAAI,GAAG,CAAC,CAAA;AACZ,YAAA,IAAA,CAAK,WAAW,CAAA,CAAE,CAAC,CAAA,EAAG,CAAA,CAAE,CAAC,CAAC,CAAA;AAAA,UAC5B;AAAA,QACF;AACA,QAAA,IAAI,IAAA,CAAK,cAAc,MAAA,EAAQ;AAC7B,UAAA,IAAI,EAAA,GAAK,IAAA,CAAK,aAAA,CAAc,KAAA,CAAM,CAAC,CAAA;AACnC,UAAA,IAAA,CAAK,cAAc,MAAA,GAAS,CAAA;AAC5B,UAAA,KAAA,IAAS,CAAA,GAAI,CAAA,EAAG,CAAA,GAAI,EAAA,CAAG,QAAQ,CAAA,EAAA,EAAM;AACnC,YAAA,IAAI,CAAA,GAAI,GAAG,CAAC,CAAA;AACZ,YAAA,IAAA,CAAK,WAAA,EAAA;AACL,YAAA,IAAA,CAAK,QAAA,CAAS,CAAA,CAAE,CAAC,CAAA,EAAG,CAAA,CAAE,CAAC,CAAA,EAAG,CAAA,CAAE,CAAC,CAAA,EAAG,CAAA,CAAE,CAAC,CAAC,CAAA;AAAA,UACtC;AAAA,QACF;AAAA,MACF;AAAA,IACF,CAAA;AAEA,IAAA,IAAA,CAAK,UAAU,QAAA,GAAW,SAAU,OAAA,EAAS,KAAA,EAAO,YAAY,EAAA,EAAI;AAClE,MAAA,MAAA,CAAO,gBAAgB,IAAI,CAAA;AAC3B,MAAA,MAAA,CAAO,OAAO,OAAO,UAAU,CAAA;AAE/B,MAAA,IAAI,IAAA,CAAK,OAAA;AACP,QAAA;AAEF,MAAA,IAAA,CAAK,WAAA,EAAA;AACL,MAAA,IAAI,KAAK,MAAA,EAAQ;AACf,QAAA,IAAA,CAAK,cAAc,IAAA,CAAK,CAAC,SAAS,KAAA,EAAO,UAAA,EAAY,EAAE,CAAC,CAAA;AACxD,QAAA;AAAA,MACF;AAKA,MAAA,IAAI,CAAA,GAAI,CAAA;AACR,MAAA,OAAO,OAAO,OAAA,CAAQ,CAAC,CAAA,KAAM,QAAA,EAAU;AACrC,QAAA,CAAA,EAAA;AAAA,MACF;AAIA,MAAA,IAAI,MAAA;AACJ,MAAA,QAAQ,CAAA;AAAG;AAAA,QAET,KAAK,OAAA,CAAQ,MAAA;AACX,UAAA,IAAA,CAAK,eAAe,OAAA,CAAQ,IAAA,CAAK,GAAG,CAAA,EAAG,OAAO,EAAE,CAAA;AAChD,UAAA;AAAA,QAEF,KAAK,CAAA;AAGH,UAAA,MAAA,GAAS,IAAA;AACT,UAAA;AAAA,QAEF;AAIE,UAAA,MAAA,GAAS,QAAQ,KAAA,CAAM,CAAA,EAAG,CAAC,CAAA,CAAE,KAAK,GAAG,CAAA;AACrC,UAAA;AAAA;AAGJ,MAAA,IAAI,MAAA,GAAS,OAAA,CAAQ,KAAA,CAAM,CAAC,CAAA;AAG5B,MAAA,IAAI,IAAA;AACJ,MAAA,IAAI,MAAA,KAAW,IAAA;AACb,QAAA,IAAA,GAAO,GAAA;AAAA,WAAA,IACAH,YAAW,MAAM,CAAA,IACtBA,YAAW,OAAA,CAAQ,GAAA,CAAI,SAAU,CAAA,EAAG;AAClC,QAAA,OAAO,OAAO,CAAA,KAAM,QAAA,GAAW,CAAA,GAAI,KAAA;AAAA,MACrC,CAAC,CAAA,CAAE,IAAA,CAAK,GAAG,CAAC,CAAA,EAAG;AACjB,QAAA,IAAI,CAAC,MAAA,IAAU,CAACA,WAAAA,CAAW,MAAM,CAAA;AAC/B,UAAA,MAAA,GAAS,GAAA,GAAM,MAAA;AACjB,QAAA,IAAA,GAAO,MAAA;AAAA,MACT,CAAA;AACE,QAAA,IAAA,GAAO,MAAA;AAET,MAAA,IAAI,GAAA,GAAM,IAAA,CAAK,QAAA,CAAS,IAAI,CAAA;AAG5B,MAAA,IAAI,eAAA,CAAgB,MAAM,IAAI,CAAA;AAC5B,QAAA,OAAO,EAAA,EAAG;AAEZ,MAAA,IAAI,UAAA,GAAa,MAAA,CAAO,CAAC,CAAA,KAAM,SAAA,CAAU,QAAA;AACzC,MAAA,IAAI,UAAA;AACF,QAAA,IAAA,CAAK,iBAAiB,MAAA,EAAQ,IAAA,EAAM,KAAK,MAAA,EAAQ,KAAA,EAAO,YAAY,EAAE,CAAA;AAAA;AAEtE,QAAA,IAAA,CAAK,gBAAgB,MAAA,EAAQ,IAAA,EAAM,KAAK,MAAA,EAAQ,KAAA,EAAO,YAAY,EAAE,CAAA;AAAA,IACzE,CAAA;AAEA,IAAA,IAAA,CAAK,SAAA,CAAU,kBAAkB,SAAU,MAAA,EAAQ,MAAM,GAAA,EAAK,MAAA,EAAQ,KAAA,EAAO,UAAA,EAAY,EAAA,EAAI;AAC3F,MAAA,IAAI,IAAA,GAAO,IAAA;AACX,MAAA,IAAA,CAAK,QAAA,CAAS,GAAA,EAAK,UAAA,EAAY,SAAU,IAAI,OAAA,EAAS;AACpD,QAAA,OAAO,IAAA,CAAK,iBAAiB,MAAA,EAAQ,IAAA,EAAM,KAAK,MAAA,EAAQ,KAAA,EAAO,UAAA,EAAY,OAAA,EAAS,EAAE,CAAA;AAAA,MACxF,CAAC,CAAA;AAAA,IACH,CAAA;AAEA,IAAA,IAAA,CAAK,SAAA,CAAU,gBAAA,GAAmB,SAAU,MAAA,EAAQ,IAAA,EAAM,KAAK,MAAA,EAAQ,KAAA,EAAO,UAAA,EAAY,OAAA,EAAS,EAAA,EAAI;AAGrG,MAAA,IAAI,CAAC,OAAA;AACH,QAAA,OAAO,EAAA,EAAG;AAIZ,MAAA,IAAI,EAAA,GAAK,OAAO,CAAC,CAAA;AACjB,MAAA,IAAI,MAAA,GAAS,CAAC,CAAC,IAAA,CAAK,SAAA,CAAU,MAAA;AAC9B,MAAA,IAAI,UAAU,EAAA,CAAG,KAAA;AACjB,MAAA,IAAI,QAAQ,IAAA,CAAK,GAAA,IAAO,OAAA,CAAQ,MAAA,CAAO,CAAC,CAAA,KAAM,GAAA;AAE9C,MAAA,IAAI,iBAAiB,EAAC;AACtB,MAAA,KAAA,IAAS,CAAA,GAAI,CAAA,EAAG,CAAA,GAAI,OAAA,CAAQ,QAAQ,CAAA,EAAA,EAAK;AACvC,QAAA,IAAI,CAAA,GAAI,QAAQ,CAAC,CAAA;AACjB,QAAA,IAAI,CAAA,CAAE,MAAA,CAAO,CAAC,CAAA,KAAM,OAAO,KAAA,EAAO;AAChC,UAAA,IAAI,CAAA;AACJ,UAAA,IAAI,MAAA,IAAU,CAAC,MAAA,EAAQ;AACrB,YAAA,CAAA,GAAI,CAAC,CAAA,CAAE,KAAA,CAAM,EAAE,CAAA;AAAA,UACjB,CAAA,MAAO;AACL,YAAA,CAAA,GAAI,CAAA,CAAE,MAAM,EAAE,CAAA;AAAA,UAChB;AACA,UAAA,IAAI,CAAA;AACF,YAAA,cAAA,CAAe,KAAK,CAAC,CAAA;AAAA,QACzB;AAAA,MACF;AAIA,MAAA,IAAI,MAAM,cAAA,CAAe,MAAA;AAEzB,MAAA,IAAI,GAAA,KAAQ,CAAA;AACV,QAAA,OAAO,EAAA,EAAG;AAOZ,MAAA,IAAI,MAAA,CAAO,WAAW,CAAA,IAAK,CAAC,KAAK,IAAA,IAAQ,CAAC,KAAK,IAAA,EAAM;AACnD,QAAA,IAAI,CAAC,IAAA,CAAK,OAAA,CAAQ,KAAK,CAAA;AACrB,UAAA,IAAA,CAAK,OAAA,CAAQ,KAAK,CAAA,mBAAI,MAAA,CAAO,OAAO,IAAI,CAAA;AAE1C,QAAA,KAAA,IAAS,CAAA,GAAI,CAAA,EAAG,CAAA,GAAI,GAAA,EAAK,CAAA,EAAA,EAAM;AAC7B,UAAA,IAAI,CAAA,GAAI,eAAe,CAAC,CAAA;AACxB,UAAA,IAAI,MAAA,EAAQ;AACV,YAAA,IAAI,MAAA,KAAW,GAAA;AACb,cAAA,CAAA,GAAI,SAAS,GAAA,GAAM,CAAA;AAAA;AAEnB,cAAA,CAAA,GAAI,MAAA,GAAS,CAAA;AAAA,UACjB;AAEA,UAAA,IAAI,EAAE,MAAA,CAAO,CAAC,MAAM,GAAA,IAAO,CAAC,KAAK,OAAA,EAAS;AACxC,YAAA,CAAA,GAAIZ,KAAAA,CAAK,IAAA,CAAK,IAAA,CAAK,IAAA,EAAM,CAAC,CAAA;AAAA,UAC5B;AACA,UAAA,IAAA,CAAK,UAAA,CAAW,OAAO,CAAC,CAAA;AAAA,QAC1B;AAEA,QAAA,OAAO,EAAA,EAAG;AAAA,MACZ;AAIA,MAAA,MAAA,CAAO,KAAA,EAAM;AACb,MAAA,KAAA,IAAS,CAAA,GAAI,CAAA,EAAG,CAAA,GAAI,GAAA,EAAK,CAAA,EAAA,EAAM;AAC7B,QAAA,IAAI,CAAA,GAAI,eAAe,CAAC,CAAA;AAExB,QAAA,IAAI,MAAA,EAAQ;AACV,UAAA,IAAI,MAAA,KAAW,GAAA;AACb,YAAA,CAAA,GAAI,SAAS,GAAA,GAAM,CAAA;AAAA;AAEnB,YAAA,CAAA,GAAI,MAAA,GAAS,CAAA;AAAA,QACjB;AACA,QAAA,IAAA,CAAK,QAAA,CAAS,CAAC,CAAC,CAAA,CAAE,OAAO,MAAM,CAAA,EAAG,KAAA,EAAO,UAAA,EAAY,EAAE,CAAA;AAAA,MACzD;AACA,MAAA,EAAA,EAAG;AAAA,IACL,CAAA;AAEA,IAAA,IAAA,CAAK,SAAA,CAAU,UAAA,GAAa,SAAU,KAAA,EAAO,CAAA,EAAG;AAC9C,MAAA,IAAI,IAAA,CAAK,OAAA;AACP,QAAA;AAEF,MAAA,IAAI,SAAA,CAAU,MAAM,CAAC,CAAA;AACnB,QAAA;AAEF,MAAA,IAAI,KAAK,MAAA,EAAQ;AACf,QAAA,IAAA,CAAK,UAAA,CAAW,IAAA,CAAK,CAAC,KAAA,EAAO,CAAC,CAAC,CAAA;AAC/B,QAAA;AAAA,MACF;AAEA,MAAA,IAAI,MAAMY,WAAAA,CAAW,CAAC,IAAI,CAAA,GAAI,IAAA,CAAK,SAAS,CAAC,CAAA;AAE7C,MAAA,IAAI,IAAA,CAAK,IAAA;AACP,QAAA,CAAA,GAAI,IAAA,CAAK,MAAM,CAAC,CAAA;AAElB,MAAA,IAAI,IAAA,CAAK,QAAA;AACP,QAAA,CAAA,GAAI,GAAA;AAEN,MAAA,IAAI,IAAA,CAAK,OAAA,CAAQ,KAAK,CAAA,CAAE,CAAC,CAAA;AACvB,QAAA;AAEF,MAAA,IAAI,KAAK,KAAA,EAAO;AACd,QAAA,IAAI,CAAA,GAAI,IAAA,CAAK,KAAA,CAAM,GAAG,CAAA;AACtB,QAAA,IAAI,CAAA,KAAM,KAAA,IAAS,KAAA,CAAM,OAAA,CAAQ,CAAC,CAAA;AAChC,UAAA;AAAA,MACJ;AAEA,MAAA,IAAA,CAAK,OAAA,CAAQ,KAAK,CAAA,CAAE,CAAC,CAAA,GAAI,IAAA;AAEzB,MAAA,IAAI,EAAA,GAAK,IAAA,CAAK,SAAA,CAAU,GAAG,CAAA;AAC3B,MAAA,IAAI,EAAA;AACF,QAAA,IAAA,CAAK,IAAA,CAAK,MAAA,EAAQ,CAAA,EAAG,EAAE,CAAA;AAEzB,MAAA,IAAA,CAAK,IAAA,CAAK,SAAS,CAAC,CAAA;AAAA,IACtB,CAAA;AAEA,IAAA,IAAA,CAAK,SAAA,CAAU,kBAAA,GAAqB,SAAU,GAAA,EAAK,EAAA,EAAI;AACrD,MAAA,IAAI,IAAA,CAAK,OAAA;AACP,QAAA;AAIF,MAAA,IAAI,IAAA,CAAK,MAAA;AACP,QAAA,OAAO,IAAA,CAAK,QAAA,CAAS,GAAA,EAAK,KAAA,EAAO,EAAE,CAAA;AAErC,MAAA,IAAI,WAAW,SAAA,GAAY,GAAA;AAC3B,MAAA,IAAI,IAAA,GAAO,IAAA;AACX,MAAA,IAAI,OAAA,GAAU,QAAA,CAAS,QAAA,EAAU,QAAQ,CAAA;AAEzC,MAAA,IAAI,OAAA;AACF,QAAA,IAAA,CAAK,EAAA,CAAG,KAAA,CAAM,GAAA,EAAK,OAAO,CAAA;AAE5B,MAAA,SAAS,QAAA,CAAU,IAAI,KAAA,EAAO;AAC5B,QAAA,IAAI,EAAA,IAAM,GAAG,IAAA,KAAS,QAAA;AACpB,UAAA,OAAO,EAAA,EAAG;AAEZ,QAAA,IAAI,KAAA,GAAQ,KAAA,IAAS,KAAA,CAAM,cAAA,EAAe;AAC1C,QAAA,IAAA,CAAK,QAAA,CAAS,GAAG,CAAA,GAAI,KAAA;AAIrB,QAAA,IAAI,CAAC,KAAA,IAAS,KAAA,IAAS,CAAC,KAAA,CAAM,aAAY,EAAG;AAC3C,UAAA,IAAA,CAAK,KAAA,CAAM,GAAG,CAAA,GAAI,MAAA;AAClB,UAAA,EAAA,EAAG;AAAA,QACL,CAAA;AACE,UAAA,IAAA,CAAK,QAAA,CAAS,GAAA,EAAK,KAAA,EAAO,EAAE,CAAA;AAAA,MAChC;AAAA,IACF,CAAA;AAEA,IAAA,IAAA,CAAK,SAAA,CAAU,QAAA,GAAW,SAAU,GAAA,EAAK,YAAY,EAAA,EAAI;AACvD,MAAA,IAAI,IAAA,CAAK,OAAA;AACP,QAAA;AAEF,MAAA,EAAA,GAAK,QAAA,CAAS,WAAA,GAAY,GAAA,GAAI,IAAA,GAAK,YAAY,EAAE,CAAA;AACjD,MAAA,IAAI,CAAC,EAAA;AACH,QAAA;AAGF,MAAA,IAAI,UAAA,IAAc,CAAC,OAAA,CAAQ,IAAA,CAAK,UAAU,GAAG,CAAA;AAC3C,QAAA,OAAO,IAAA,CAAK,kBAAA,CAAmB,GAAA,EAAK,EAAE,CAAA;AAExC,MAAA,IAAI,OAAA,CAAQ,IAAA,CAAK,KAAA,EAAO,GAAG,CAAA,EAAG;AAC5B,QAAA,IAAI,CAAA,GAAI,IAAA,CAAK,KAAA,CAAM,GAAG,CAAA;AACtB,QAAA,IAAI,CAAC,KAAK,CAAA,KAAM,MAAA;AACd,UAAA,OAAO,EAAA,EAAG;AAEZ,QAAA,IAAI,KAAA,CAAM,QAAQ,CAAC,CAAA;AACjB,UAAA,OAAO,EAAA,CAAG,MAAM,CAAC,CAAA;AAAA,MACrB;AAEA,MAAA,IAAI,IAAA,GAAO,IAAA;AACX,MAAA,IAAA,CAAK,GAAG,OAAA,CAAQ,GAAA,EAAK,UAAU,IAAA,EAAM,GAAA,EAAK,EAAE,CAAC,CAAA;AAAA,IAC/C,CAAA;AAEA,IAAA,SAAS,SAAA,CAAW,IAAA,EAAM,GAAA,EAAK,EAAA,EAAI;AACjC,MAAA,OAAO,SAAU,IAAI,OAAA,EAAS;AAC5B,QAAA,IAAI,EAAA;AACF,UAAA,IAAA,CAAK,aAAA,CAAc,GAAA,EAAK,EAAA,EAAI,EAAE,CAAA;AAAA;AAE9B,UAAA,IAAA,CAAK,eAAA,CAAgB,GAAA,EAAK,OAAA,EAAS,EAAE,CAAA;AAAA,MACzC,CAAA;AAAA,IACF;AAEA,IAAA,IAAA,CAAK,SAAA,CAAU,eAAA,GAAkB,SAAU,GAAA,EAAK,SAAS,EAAA,EAAI;AAC3D,MAAA,IAAI,IAAA,CAAK,OAAA;AACP,QAAA;AAKF,MAAA,IAAI,CAAC,IAAA,CAAK,IAAA,IAAQ,CAAC,KAAK,IAAA,EAAM;AAC5B,QAAA,KAAA,IAAS,CAAA,GAAI,CAAA,EAAG,CAAA,GAAI,OAAA,CAAQ,QAAQ,CAAA,EAAA,EAAM;AACxC,UAAA,IAAI,CAAA,GAAI,QAAQ,CAAC,CAAA;AACjB,UAAA,IAAI,GAAA,KAAQ,GAAA;AACV,YAAA,CAAA,GAAI,GAAA,GAAM,CAAA;AAAA;AAEV,YAAA,CAAA,GAAI,MAAM,GAAA,GAAM,CAAA;AAClB,UAAA,IAAA,CAAK,KAAA,CAAM,CAAC,CAAA,GAAI,IAAA;AAAA,QAClB;AAAA,MACF;AAEA,MAAA,IAAA,CAAK,KAAA,CAAM,GAAG,CAAA,GAAI,OAAA;AAClB,MAAA,OAAO,EAAA,CAAG,MAAM,OAAO,CAAA;AAAA,IACzB,CAAA;AAEA,IAAA,IAAA,CAAK,SAAA,CAAU,aAAA,GAAgB,SAAU,CAAA,EAAG,IAAI,EAAA,EAAI;AAClD,MAAA,IAAI,IAAA,CAAK,OAAA;AACP,QAAA;AAGF,MAAA,QAAQ,GAAG,IAAA;AAAM,QACf,KAAK,SAAA;AAAA;AAAA,QACL,KAAK,SAAA;AACH,UAAA,IAAI,GAAA,GAAM,IAAA,CAAK,QAAA,CAAS,CAAC,CAAA;AACzB,UAAA,IAAA,CAAK,KAAA,CAAM,GAAG,CAAA,GAAI,MAAA;AAClB,UAAA,IAAI,GAAA,KAAQ,KAAK,MAAA,EAAQ;AACvB,YAAA,IAAI,QAAQ,IAAI,KAAA,CAAM,GAAG,IAAA,GAAO,eAAA,GAAkB,KAAK,GAAG,CAAA;AAC1D,YAAA,KAAA,CAAM,OAAO,IAAA,CAAK,GAAA;AAClB,YAAA,KAAA,CAAM,OAAO,EAAA,CAAG,IAAA;AAChB,YAAA,IAAA,CAAK,IAAA,CAAK,SAAS,KAAK,CAAA;AACxB,YAAA,IAAA,CAAK,KAAA,EAAM;AAAA,UACb;AACA,UAAA;AAAA,QAEF,KAAK,QAAA;AAAA;AAAA,QACL,KAAK,OAAA;AAAA,QACL,KAAK,cAAA;AAAA,QACL,KAAK,SAAA;AACH,UAAA,IAAA,CAAK,KAAA,CAAM,IAAA,CAAK,QAAA,CAAS,CAAC,CAAC,CAAA,GAAI,KAAA;AAC/B,UAAA;AAAA,QAEF;AACE,UAAA,IAAA,CAAK,KAAA,CAAM,IAAA,CAAK,QAAA,CAAS,CAAC,CAAC,CAAA,GAAI,KAAA;AAC/B,UAAA,IAAI,KAAK,MAAA,EAAQ;AACf,YAAA,IAAA,CAAK,IAAA,CAAK,SAAS,EAAE,CAAA;AAGrB,YAAA,IAAA,CAAK,KAAA,EAAM;AAAA,UACb;AACA,UAAA,IAAI,CAAC,IAAA,CAAK,MAAA;AACR,YAAA,OAAA,CAAQ,KAAA,CAAM,cAAc,EAAE,CAAA;AAChC,UAAA;AAAA;AAGJ,MAAA,OAAO,EAAA,EAAG;AAAA,IACZ,CAAA;AAEA,IAAA,IAAA,CAAK,SAAA,CAAU,mBAAmB,SAAU,MAAA,EAAQ,MAAM,GAAA,EAAK,MAAA,EAAQ,KAAA,EAAO,UAAA,EAAY,EAAA,EAAI;AAC5F,MAAA,IAAI,IAAA,GAAO,IAAA;AACX,MAAA,IAAA,CAAK,QAAA,CAAS,GAAA,EAAK,UAAA,EAAY,SAAU,IAAI,OAAA,EAAS;AACpD,QAAA,IAAA,CAAK,iBAAA,CAAkB,QAAQ,IAAA,EAAM,GAAA,EAAK,QAAQ,KAAA,EAAO,UAAA,EAAY,SAAS,EAAE,CAAA;AAAA,MAClF,CAAC,CAAA;AAAA,IACH,CAAA;AAGA,IAAA,IAAA,CAAK,SAAA,CAAU,iBAAA,GAAoB,SAAU,MAAA,EAAQ,IAAA,EAAM,KAAK,MAAA,EAAQ,KAAA,EAAO,UAAA,EAAY,OAAA,EAAS,EAAA,EAAI;AAKtG,MAAA,IAAI,CAAC,OAAA;AACH,QAAA,OAAO,EAAA,EAAG;AAIZ,MAAA,IAAI,qBAAA,GAAwB,MAAA,CAAO,KAAA,CAAM,CAAC,CAAA;AAC1C,MAAA,IAAI,MAAA,GAAS,MAAA,GAAS,CAAE,MAAO,IAAI,EAAC;AACpC,MAAA,IAAI,UAAA,GAAa,MAAA,CAAO,MAAA,CAAO,qBAAqB,CAAA;AAGpD,MAAA,IAAA,CAAK,QAAA,CAAS,UAAA,EAAY,KAAA,EAAO,KAAA,EAAO,EAAE,CAAA;AAE1C,MAAA,IAAI,KAAA,GAAQ,IAAA,CAAK,QAAA,CAAS,GAAG,CAAA;AAC7B,MAAA,IAAI,MAAM,OAAA,CAAQ,MAAA;AAGlB,MAAA,IAAI,KAAA,IAAS,UAAA;AACX,QAAA,OAAO,EAAA,EAAG;AAEZ,MAAA,KAAA,IAAS,CAAA,GAAI,CAAA,EAAG,CAAA,GAAI,GAAA,EAAK,CAAA,EAAA,EAAK;AAC5B,QAAA,IAAI,CAAA,GAAI,QAAQ,CAAC,CAAA;AACjB,QAAA,IAAI,EAAE,MAAA,CAAO,CAAC,CAAA,KAAM,GAAA,IAAO,CAAC,IAAA,CAAK,GAAA;AAC/B,UAAA;AAGF,QAAA,IAAI,UAAU,MAAA,CAAO,MAAA,CAAO,OAAA,CAAQ,CAAC,GAAG,qBAAqB,CAAA;AAC7D,QAAA,IAAA,CAAK,QAAA,CAAS,OAAA,EAAS,KAAA,EAAO,IAAA,EAAM,EAAE,CAAA;AAEtC,QAAA,IAAI,QAAQ,MAAA,CAAO,MAAA,CAAO,OAAA,CAAQ,CAAC,GAAG,MAAM,CAAA;AAC5C,QAAA,IAAA,CAAK,QAAA,CAAS,KAAA,EAAO,KAAA,EAAO,IAAA,EAAM,EAAE,CAAA;AAAA,MACtC;AAEA,MAAA,EAAA,EAAG;AAAA,IACL,CAAA;AAEA,IAAA,IAAA,CAAK,SAAA,CAAU,cAAA,GAAiB,SAAU,MAAA,EAAQ,OAAO,EAAA,EAAI;AAG3D,MAAA,IAAI,IAAA,GAAO,IAAA;AACX,MAAA,IAAA,CAAK,KAAA,CAAM,MAAA,EAAQ,SAAU,EAAA,EAAI,MAAA,EAAQ;AACvC,QAAA,IAAA,CAAK,eAAA,CAAgB,MAAA,EAAQ,KAAA,EAAO,EAAA,EAAI,QAAQ,EAAE,CAAA;AAAA,MACpD,CAAC,CAAA;AAAA,IACH,CAAA;AACA,IAAA,IAAA,CAAK,UAAU,eAAA,GAAkB,SAAU,QAAQ,KAAA,EAAO,EAAA,EAAI,QAAQ,EAAA,EAAI;AAIxE,MAAA,IAAI,CAAC,IAAA,CAAK,OAAA,CAAQ,KAAK,CAAA;AACrB,QAAA,IAAA,CAAK,OAAA,CAAQ,KAAK,CAAA,mBAAI,MAAA,CAAO,OAAO,IAAI,CAAA;AAG1C,MAAA,IAAI,CAAC,MAAA;AACH,QAAA,OAAO,EAAA,EAAG;AAEZ,MAAA,IAAI,UAAUA,WAAAA,CAAW,MAAM,CAAA,IAAK,CAAC,KAAK,OAAA,EAAS;AACjD,QAAA,IAAI,KAAA,GAAQ,SAAA,CAAU,IAAA,CAAK,MAAM,CAAA;AACjC,QAAA,IAAI,MAAA,CAAO,MAAA,CAAO,CAAC,CAAA,KAAM,GAAA,EAAK;AAC5B,UAAA,MAAA,GAASZ,KAAAA,CAAK,IAAA,CAAK,IAAA,CAAK,IAAA,EAAM,MAAM,CAAA;AAAA,QACtC,CAAA,MAAO;AACL,UAAA,MAAA,GAASA,KAAAA,CAAK,OAAA,CAAQ,IAAA,CAAK,IAAA,EAAM,MAAM,CAAA;AACvC,UAAA,IAAI,KAAA;AACF,YAAA,MAAA,IAAU,GAAA;AAAA,QACd;AAAA,MACF;AAEA,MAAA,IAAI,QAAQ,QAAA,KAAa,OAAA;AACvB,QAAA,MAAA,GAAS,MAAA,CAAO,OAAA,CAAQ,KAAA,EAAO,GAAG,CAAA;AAGpC,MAAA,IAAA,CAAK,UAAA,CAAW,OAAO,MAAM,CAAA;AAC7B,MAAA,EAAA,EAAG;AAAA,IACL,CAAA;AAGA,IAAA,IAAA,CAAK,SAAA,CAAU,KAAA,GAAQ,SAAU,CAAA,EAAG,EAAA,EAAI;AACtC,MAAA,IAAI,GAAA,GAAM,IAAA,CAAK,QAAA,CAAS,CAAC,CAAA;AACzB,MAAA,IAAI,OAAA,GAAU,CAAA,CAAE,KAAA,CAAM,EAAE,CAAA,KAAM,GAAA;AAE9B,MAAA,IAAI,CAAA,CAAE,SAAS,IAAA,CAAK,SAAA;AAClB,QAAA,OAAO,EAAA,EAAG;AAEZ,MAAA,IAAI,CAAC,IAAA,CAAK,IAAA,IAAQ,QAAQ,IAAA,CAAK,KAAA,EAAO,GAAG,CAAA,EAAG;AAC1C,QAAA,IAAI,CAAA,GAAI,IAAA,CAAK,KAAA,CAAM,GAAG,CAAA;AAEtB,QAAA,IAAI,KAAA,CAAM,QAAQ,CAAC,CAAA;AACjB,UAAA,CAAA,GAAI,KAAA;AAGN,QAAA,IAAI,CAAC,WAAW,CAAA,KAAM,KAAA;AACpB,UAAA,OAAO,EAAA,CAAG,MAAM,CAAC,CAAA;AAEnB,QAAA,IAAI,WAAW,CAAA,KAAM,MAAA;AACnB,UAAA,OAAO,EAAA,EAAG;AAAA,MAId;AAGA,MAAA,IAAIG,KAAAA,GAAO,IAAA,CAAK,SAAA,CAAU,GAAG,CAAA;AAC7B,MAAA,IAAIA,UAAS,MAAA,EAAW;AACtB,QAAA,IAAIA,KAAAA,KAAS,KAAA;AACX,UAAA,OAAO,EAAA,CAAG,MAAMA,KAAI,CAAA;AAAA,aACjB;AACH,UAAA,IAAI,IAAA,GAAOA,KAAAA,CAAK,WAAA,EAAY,GAAI,KAAA,GAAQ,MAAA;AACxC,UAAA,IAAI,WAAW,IAAA,KAAS,MAAA;AACtB,YAAA,OAAO,EAAA,EAAG;AAAA;AAEV,YAAA,OAAO,EAAA,CAAG,IAAA,EAAM,IAAA,EAAMA,KAAI,CAAA;AAAA,QAC9B;AAAA,MACF;AAEA,MAAA,IAAI,IAAA,GAAO,IAAA;AACX,MAAA,IAAI,MAAA,GAAS,QAAA,CAAS,QAAA,GAAW,GAAA,EAAK,QAAQ,CAAA;AAC9C,MAAA,IAAI,MAAA;AACF,QAAA,IAAA,CAAK,EAAA,CAAG,KAAA,CAAM,GAAA,EAAK,MAAM,CAAA;AAE3B,MAAA,SAAS,QAAA,CAAU,IAAI,KAAA,EAAO;AAC5B,QAAA,IAAI,KAAA,IAAS,KAAA,CAAM,cAAA,EAAe,EAAG;AAGnC,UAAA,OAAO,KAAK,EAAA,CAAG,IAAA,CAAK,GAAA,EAAK,SAAUa,KAAIb,KAAAA,EAAM;AAC3C,YAAA,IAAIa,GAAAA;AACF,cAAA,IAAA,CAAK,MAAA,CAAO,CAAA,EAAG,GAAA,EAAK,IAAA,EAAM,OAAO,EAAE,CAAA;AAAA;AAEnC,cAAA,IAAA,CAAK,MAAA,CAAO,CAAA,EAAG,GAAA,EAAKA,GAAAA,EAAIb,OAAM,EAAE,CAAA;AAAA,UACpC,CAAC,CAAA;AAAA,QACH,CAAA,MAAO;AACL,UAAA,IAAA,CAAK,MAAA,CAAO,CAAA,EAAG,GAAA,EAAK,EAAA,EAAI,OAAO,EAAE,CAAA;AAAA,QACnC;AAAA,MACF;AAAA,IACF,CAAA;AAEA,IAAA,IAAA,CAAK,UAAU,MAAA,GAAS,SAAU,GAAG,GAAA,EAAK,EAAA,EAAIA,OAAM,EAAA,EAAI;AACtD,MAAA,IAAI,OAAO,EAAA,CAAG,IAAA,KAAS,QAAA,IAAY,EAAA,CAAG,SAAS,SAAA,CAAA,EAAY;AACzD,QAAA,IAAA,CAAK,SAAA,CAAU,GAAG,CAAA,GAAI,KAAA;AACtB,QAAA,OAAO,EAAA,EAAG;AAAA,MACZ;AAEA,MAAA,IAAI,OAAA,GAAU,CAAA,CAAE,KAAA,CAAM,EAAE,CAAA,KAAM,GAAA;AAC9B,MAAA,IAAA,CAAK,SAAA,CAAU,GAAG,CAAA,GAAIA,KAAAA;AAEtB,MAAA,IAAI,GAAA,CAAI,MAAM,EAAE,CAAA,KAAM,OAAOA,KAAAA,IAAQ,CAACA,MAAK,WAAA,EAAY;AACrD,QAAA,OAAO,EAAA,CAAG,IAAA,EAAM,KAAA,EAAOA,KAAI,CAAA;AAE7B,MAAA,IAAI,CAAA,GAAI,IAAA;AACR,MAAA,IAAIA,KAAAA;AACF,QAAA,CAAA,GAAIA,KAAAA,CAAK,WAAA,EAAY,GAAI,KAAA,GAAQ,MAAA;AACnC,MAAA,IAAA,CAAK,MAAM,GAAG,CAAA,GAAI,IAAA,CAAK,KAAA,CAAM,GAAG,CAAA,IAAK,CAAA;AAErC,MAAA,IAAI,WAAW,CAAA,KAAM,MAAA;AACnB,QAAA,OAAO,EAAA,EAAG;AAEZ,MAAA,OAAO,EAAA,CAAG,IAAA,EAAM,CAAA,EAAGA,KAAI,CAAA;AAAA,IACzB,CAAA;AAAA,EAAA;AAAA,CAAA,CAAA;;;AC1vBA,cAAA,EAAA;;;ACZA,cAAA,EAAA;;;ACoRO,IAAM,sBAAA,GAAyB;AAK/B,IAAM,yBAAA,GAAyF;AAAA,EACpG,KAAA,EAAO,MAAA;AAAA,EACP,SAAA,EAAW;AACb;AAcO,IAAM,iBAAA,GAAuC;AAAA;AAAA,EAElD,WAAA;AAAA,EACA,MAAA;AAAA,EACA,MAAA;AAAA,EACA,gBAAA;AAAA;AAAA,EAGA,cAAA;AAAA,EACA,iBAAA;AAAA,EACA,eAAA;AAAA,EACA,aAAA;AAAA;AAAA,EAGA,iBAAA;AAAA,EACA,mBAAA;AAAA,EACA,aAAA;AAAA,EACA,cAAA;AAAA;AAAA,EAGA,iBAAA;AAAA,EACA,cAAA;AAAA,EACA,kBAAA;AAAA,EACA;AAAA;AACF;;;AC1RO,IAAM,qBAAA,GAAN,cAAoCc,YAAAA,CAAa;AAAA;AAAA,EAE9C,aAAA,uBAAqD,GAAA,EAAI;AAAA;AAAA,EAGzD,SAAA,uBAA6B,GAAA,EAAI;AAAA,EACjC,SAAA,uBAA6B,GAAA,EAAI;AAAA;AAAA,EAGjC,WAAA,uBAAqD,GAAA,EAAI;AAAA;AAAA,EAGzD,YAAA;AAAA,EACA,gBAAA;AAAA;AAAA,EAGA,kBAAA;AAAA,EAER,YAAY,MAAA,EAAiC;AAC3C,IAAA,KAAA,EAAM;AAEN,IAAA,IAAA,CAAK,YAAA,GAAe,MAAA,EAAQ,YAAA,IAAgB,yBAAA,CAA0B,KAAA;AACtE,IAAA,IAAA,CAAK,gBAAA,GAAmB,MAAA,EAAQ,gBAAA,IAAoB,yBAAA,CAA0B,SAAA;AAI9E,IAAA,KAAA,MAAW,YAAY,iBAAA,EAAmB;AACxC,MAAA,IAAA,CAAK,SAAA,CAAU,IAAI,QAAQ,CAAA;AAAA,IAC7B;AAGA,IAAA,IAAI,QAAQ,SAAA,EAAW;AACrB,MAAA,KAAA,MAAW,QAAA,IAAY,OAAO,SAAA,EAAW;AACvC,QAAA,IAAA,CAAK,SAAA,CAAU,IAAI,QAAQ,CAAA;AAAA,MAC7B;AAAA,IACF;AAGA,IAAA,IAAI,QAAQ,SAAA,EAAW;AACrB,MAAA,KAAA,MAAW,QAAA,IAAY,OAAO,SAAA,EAAW;AACvC,QAAA,IAAA,CAAK,SAAA,CAAU,IAAI,QAAQ,CAAA;AAAA,MAC7B;AAAA,IACF;AAGA,IAAA,IAAI,QAAQ,KAAA,EAAO;AACjB,MAAA,KAAA,MAAW,CAAC,UAAU,UAAU,CAAA,IAAK,OAAO,OAAA,CAAQ,MAAA,CAAO,KAAK,CAAA,EAAG;AACjE,QAAA,IAAA,CAAK,WAAA,CAAY,GAAA,CAAI,QAAA,EAAU,UAAU,CAAA;AAAA,MAC3C;AAAA,IACF;AAGA,IAAA,IAAA,CAAK,qBAAqB,MAAA,EAAQ,kBAAA;AAAA,EACpC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAaA,eAAA,CAAgB,UAAkB,KAAA,EAAwD;AACxF,IAAA,MAAM,MAAA,GAAS,IAAA,CAAK,kBAAA,CAAmB,QAAQ,CAAA;AAG/C,IAAA,IAAI,IAAA,CAAK,SAAA,CAAU,GAAA,CAAI,QAAQ,CAAA,EAAG;AAChC,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,KAAA;AAAA,QACT,aAAA,EAAe,KAAA;AAAA,QACf,OAAA,EAAS,IAAA;AAAA,QACT,MAAA,EAAQ,qBAAA;AAAA,QACR;AAAA,OACF;AAAA,IACF;AAGA,IAAA,IAAI,IAAA,CAAK,SAAA,CAAU,GAAA,CAAI,QAAQ,CAAA,EAAG;AAChC,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,IAAA;AAAA,QACT,aAAA,EAAe,KAAA;AAAA,QACf,OAAA,EAAS,KAAA;AAAA,QACT,MAAA,EAAQ,qBAAA;AAAA,QACR;AAAA,OACF;AAAA,IACF;AAGA,IAAA,MAAM,KAAA,GAAQ,MAAA,CAAO,KAAA,IAAS,IAAA,CAAK,YAAA;AAEnC,IAAA,QAAQ,KAAA;AAAO,MACb,KAAK,QAAA;AACH,QAAA,OAAO;AAAA,UACL,OAAA,EAAS,IAAA;AAAA,UACT,aAAA,EAAe,KAAA;AAAA,UACf,OAAA,EAAS,KAAA;AAAA,UACT,MAAA,EAAQ,wBAAA;AAAA,UACR;AAAA,SACF;AAAA,MAEF,KAAK,OAAA;AACH,QAAA,OAAO;AAAA,UACL,OAAA,EAAS,KAAA;AAAA,UACT,aAAA,EAAe,KAAA;AAAA,UACf,OAAA,EAAS,IAAA;AAAA,UACT,MAAA,EAAQ,uBAAA;AAAA,UACR;AAAA,SACF;AAAA,MAEF,KAAK,SAAA;AAEH,QAAA,IAAI,IAAA,CAAK,oBAAA,CAAqB,QAAQ,CAAA,EAAG;AACvC,UAAA,OAAO;AAAA,YACL,OAAA,EAAS,IAAA;AAAA,YACT,aAAA,EAAe,KAAA;AAAA,YACf,OAAA,EAAS,KAAA;AAAA,YACT,MAAA,EAAQ,2BAAA;AAAA,YACR;AAAA,WACF;AAAA,QACF;AACA,QAAA,OAAO;AAAA,UACL,OAAA,EAAS,KAAA;AAAA,UACT,aAAA,EAAe,IAAA;AAAA,UACf,OAAA,EAAS,KAAA;AAAA,UACT,MAAA,EAAQ,2BAAA;AAAA,UACR;AAAA,SACF;AAAA,MAEF,KAAK,MAAA;AAAA,MACL;AAEE,QAAA,OAAO;AAAA,UACL,OAAA,EAAS,KAAA;AAAA,UACT,aAAA,EAAe,IAAA;AAAA,UACf,OAAA,EAAS,KAAA;AAAA,UACT,MAAA,EAAQ,4BAAA;AAAA,UACR;AAAA,SACF;AAAA;AACJ,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,cAAc,QAAA,EAA6B;AACzC,IAAA,MAAM,MAAA,GAAS,IAAA,CAAK,eAAA,CAAgB,QAAA,CAAS,SAAS,IAAI,CAAA;AAC1D,IAAA,OAAO,MAAA,CAAO,aAAA;AAAA,EAChB;AAAA;AAAA;AAAA;AAAA,EAKA,UAAU,QAAA,EAA2B;AACnC,IAAA,OAAO,IAAA,CAAK,eAAA,CAAgB,QAAQ,CAAA,CAAE,OAAA;AAAA,EACxC;AAAA;AAAA;AAAA;AAAA,EAKA,WAAW,QAAA,EAA2B;AACpC,IAAA,OAAO,IAAA,CAAK,eAAA,CAAgB,QAAQ,CAAA,CAAE,OAAA;AAAA,EACxC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAYA,OAAA,CAAQ,UAAkB,QAAA,EAA4C;AACpE,IAAA,MAAM,KAAA,GAAQ,UAAU,KAAA,IAAS,SAAA;AACjC,IAAA,MAAM,MAAA,GAAS,IAAA,CAAK,kBAAA,CAAmB,QAAQ,CAAA;AAG/C,IAAA,IAAI,SAAA;AACJ,IAAA,IAAI,KAAA,KAAU,SAAA,IAAa,MAAA,CAAO,YAAA,EAAc;AAC9C,MAAA,SAAA,GAAY,IAAI,IAAA,CAAK,IAAA,CAAK,GAAA,EAAI,GAAI,OAAO,YAAY,CAAA;AAAA,IACvD;AAEA,IAAA,MAAM,KAAA,GAA4B;AAAA,MAChC,QAAA;AAAA,MACA,KAAA;AAAA,MACA,UAAA,sBAAgB,IAAA,EAAK;AAAA,MACrB,YAAY,QAAA,EAAU,UAAA;AAAA,MACtB;AAAA,KACF;AAEA,IAAA,IAAA,CAAK,aAAA,CAAc,GAAA,CAAI,QAAA,EAAU,KAAK,CAAA;AAEtC,IAAA,IAAA,CAAK,KAAK,eAAA,EAAiB;AAAA,MACzB,QAAA;AAAA,MACA,KAAA;AAAA,MACA,YAAY,QAAA,EAAU;AAAA,KACvB,CAAA;AAAA,EACH;AAAA;AAAA;AAAA;AAAA,EAKA,iBAAA,CAAkB,UAAkB,UAAA,EAA2B;AAC7D,IAAA,IAAA,CAAK,QAAQ,QAAA,EAAU,EAAE,KAAA,EAAO,SAAA,EAAW,YAAY,CAAA;AAAA,EACzD;AAAA;AAAA;AAAA;AAAA,EAKA,OAAO,QAAA,EAAwB;AAC7B,IAAA,IAAI,IAAA,CAAK,aAAA,CAAc,GAAA,CAAI,QAAQ,CAAA,EAAG;AACpC,MAAA,IAAA,CAAK,aAAA,CAAc,OAAO,QAAQ,CAAA;AAClC,MAAA,IAAA,CAAK,IAAA,CAAK,cAAA,EAAgB,EAAE,QAAA,EAAU,CAAA;AAAA,IACxC;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,IAAA,CAAK,UAAkB,MAAA,EAAsB;AAC3C,IAAA,IAAA,CAAK,IAAA,CAAK,aAAA,EAAe,EAAE,QAAA,EAAU,QAAQ,CAAA;AAAA,EAC/C;AAAA;AAAA;AAAA;AAAA,EAKA,qBAAqB,QAAA,EAA2B;AAC9C,IAAA,MAAM,KAAA,GAAQ,IAAA,CAAK,aAAA,CAAc,GAAA,CAAI,QAAQ,CAAA;AAC7C,IAAA,IAAI,CAAC,OAAO,OAAO,KAAA;AAGnB,IAAA,IAAI,MAAM,SAAA,IAAa,KAAA,CAAM,SAAA,mBAAY,IAAI,MAAK,EAAG;AACnD,MAAA,IAAA,CAAK,aAAA,CAAc,OAAO,QAAQ,CAAA;AAClC,MAAA,OAAO,KAAA;AAAA,IACT;AAEA,IAAA,OAAO,KAAA,CAAM,KAAA,KAAU,SAAA,IAAa,KAAA,CAAM,KAAA,KAAU,QAAA;AAAA,EACtD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,aAAa,QAAA,EAAwB;AAEnC,IAAA,IAAA,CAAK,SAAA,CAAU,OAAO,QAAQ,CAAA;AAE9B,IAAA,IAAA,CAAK,SAAA,CAAU,IAAI,QAAQ,CAAA;AAC3B,IAAA,IAAA,CAAK,IAAA,CAAK,iBAAA,EAAmB,EAAE,QAAA,EAAU,CAAA;AAAA,EAC3C;AAAA;AAAA;AAAA;AAAA,EAKA,gBAAgB,QAAA,EAAwB;AACtC,IAAA,IAAI,IAAA,CAAK,SAAA,CAAU,MAAA,CAAO,QAAQ,CAAA,EAAG;AACnC,MAAA,IAAA,CAAK,IAAA,CAAK,mBAAA,EAAqB,EAAE,QAAA,EAAU,CAAA;AAAA,IAC7C;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,cAAc,QAAA,EAA2B;AACvC,IAAA,OAAO,IAAA,CAAK,SAAA,CAAU,GAAA,CAAI,QAAQ,CAAA;AAAA,EACpC;AAAA;AAAA;AAAA;AAAA,EAKA,YAAA,GAAyB;AACvB,IAAA,OAAO,KAAA,CAAM,IAAA,CAAK,IAAA,CAAK,SAAS,CAAA;AAAA,EAClC;AAAA;AAAA;AAAA;AAAA,EAKA,aAAa,QAAA,EAAwB;AAEnC,IAAA,IAAA,CAAK,SAAA,CAAU,OAAO,QAAQ,CAAA;AAE9B,IAAA,IAAA,CAAK,SAAA,CAAU,IAAI,QAAQ,CAAA;AAC3B,IAAA,IAAA,CAAK,IAAA,CAAK,iBAAA,EAAmB,EAAE,QAAA,EAAU,CAAA;AAAA,EAC3C;AAAA;AAAA;AAAA;AAAA,EAKA,gBAAgB,QAAA,EAAwB;AACtC,IAAA,IAAI,IAAA,CAAK,SAAA,CAAU,MAAA,CAAO,QAAQ,CAAA,EAAG;AACnC,MAAA,IAAA,CAAK,IAAA,CAAK,mBAAA,EAAqB,EAAE,QAAA,EAAU,CAAA;AAAA,IAC7C;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,cAAc,QAAA,EAA2B;AACvC,IAAA,OAAO,IAAA,CAAK,SAAA,CAAU,GAAA,CAAI,QAAQ,CAAA;AAAA,EACpC;AAAA;AAAA;AAAA;AAAA,EAKA,YAAA,GAAyB;AACvB,IAAA,OAAO,KAAA,CAAM,IAAA,CAAK,IAAA,CAAK,SAAS,CAAA;AAAA,EAClC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,aAAA,CAAc,UAAkB,MAAA,EAAoC;AAClE,IAAA,IAAA,CAAK,WAAA,CAAY,GAAA,CAAI,QAAA,EAAU,MAAM,CAAA;AAAA,EACvC;AAAA;AAAA;AAAA;AAAA,EAKA,cAAc,QAAA,EAAoD;AAChE,IAAA,OAAO,IAAA,CAAK,WAAA,CAAY,GAAA,CAAI,QAAQ,CAAA;AAAA,EACtC;AAAA;AAAA;AAAA;AAAA,EAKA,mBAAmB,QAAA,EAAwC;AACzD,IAAA,MAAM,UAAA,GAAa,IAAA,CAAK,WAAA,CAAY,GAAA,CAAI,QAAQ,CAAA;AAChD,IAAA,OAAO;AAAA,MACL,KAAA,EAAO,UAAA,EAAY,KAAA,IAAS,IAAA,CAAK,YAAA;AAAA,MACjC,SAAA,EAAW,UAAA,EAAY,SAAA,IAAa,IAAA,CAAK,gBAAA;AAAA,MACzC,iBAAiB,UAAA,EAAY,eAAA;AAAA,MAC7B,eAAe,UAAA,EAAY,aAAA;AAAA,MAC3B,cAAc,UAAA,EAAY;AAAA,KAC5B;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAoBA,MAAM,gBAAgB,OAAA,EAA4D;AAChF,IAAA,IAAI,KAAK,kBAAA,EAAoB;AAC3B,MAAA,MAAM,QAAA,GAAW,MAAM,IAAA,CAAK,kBAAA,CAAmB,OAAO,CAAA;AAGtD,MAAA,IAAI,SAAS,QAAA,EAAU;AACrB,QAAA,IAAA,CAAK,OAAA,CAAQ,OAAA,CAAQ,QAAA,CAAS,QAAA,CAAS,MAAM,QAAQ,CAAA;AAAA,MACvD,CAAA,MAAO;AACL,QAAA,IAAA,CAAK,KAAK,OAAA,CAAQ,QAAA,CAAS,SAAS,IAAA,EAAM,QAAA,CAAS,UAAU,aAAa,CAAA;AAAA,MAC5E;AAEA,MAAA,OAAO,QAAA;AAAA,IACT;AAMA,IAAA,OAAO;AAAA,MACL,QAAA,EAAU,IAAA;AAAA,MACV,MAAA,EAAQ;AAAA,KACV;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,gBAAA,GAA6B;AAC3B,IAAA,MAAM,WAAqB,EAAC;AAE5B,IAAA,KAAA,MAAW,CAAC,QAAA,EAAU,KAAK,CAAA,IAAK,KAAK,aAAA,EAAe;AAElD,MAAA,IAAI,MAAM,SAAA,IAAa,KAAA,CAAM,SAAA,mBAAY,IAAI,MAAK,EAAG;AACnD,QAAA;AAAA,MACF;AACA,MAAA,QAAA,CAAS,KAAK,QAAQ,CAAA;AAAA,IACxB;AAEA,IAAA,OAAO,QAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,iBAAiB,QAAA,EAAkD;AACjE,IAAA,MAAM,KAAA,GAAQ,IAAA,CAAK,aAAA,CAAc,GAAA,CAAI,QAAQ,CAAA;AAC7C,IAAA,IAAI,CAAC,OAAO,OAAO,MAAA;AAGnB,IAAA,IAAI,MAAM,SAAA,IAAa,KAAA,CAAM,SAAA,mBAAY,IAAI,MAAK,EAAG;AACnD,MAAA,IAAA,CAAK,aAAA,CAAc,OAAO,QAAQ,CAAA;AAClC,MAAA,OAAO,MAAA;AAAA,IACT;AAEA,IAAA,OAAO,KAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,YAAA,GAAqB;AACnB,IAAA,IAAA,CAAK,cAAc,KAAA,EAAM;AACzB,IAAA,IAAA,CAAK,IAAA,CAAK,iBAAA,EAAmB,EAAE,CAAA;AAAA,EACjC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,QAAA,GAAoC;AAClC,IAAA,MAAM,YAAqD,EAAC;AAE5D,IAAA,KAAA,MAAW,CAAC,QAAA,EAAU,KAAK,CAAA,IAAK,KAAK,aAAA,EAAe;AAElD,MAAA,IAAI,MAAM,SAAA,IAAa,KAAA,CAAM,SAAA,mBAAY,IAAI,MAAK,EAAG;AACnD,QAAA;AAAA,MACF;AAEA,MAAA,SAAA,CAAU,QAAQ,CAAA,GAAI;AAAA,QACpB,UAAU,KAAA,CAAM,QAAA;AAAA,QAChB,OAAO,KAAA,CAAM,KAAA;AAAA,QACb,UAAA,EAAY,KAAA,CAAM,UAAA,CAAW,WAAA,EAAY;AAAA,QACzC,YAAY,KAAA,CAAM,UAAA;AAAA,QAClB,SAAA,EAAW,KAAA,CAAM,SAAA,EAAW,WAAA,EAAY;AAAA,QACxC,UAAU,KAAA,CAAM;AAAA,OAClB;AAAA,IACF;AAEA,IAAA,OAAO;AAAA,MACL,OAAA,EAAS,sBAAA;AAAA,MACT,SAAA;AAAA,MACA,SAAA,EAAW,KAAA,CAAM,IAAA,CAAK,IAAA,CAAK,SAAS,CAAA;AAAA,MACpC,SAAA,EAAW,KAAA,CAAM,IAAA,CAAK,IAAA,CAAK,SAAS;AAAA,KACtC;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,UAAU,KAAA,EAAsC;AAE9C,IAAA,IAAA,CAAK,cAAc,KAAA,EAAM;AAGzB,IAAA,IAAI,KAAA,CAAM,YAAY,sBAAA,EAAwB;AAE5C,MAAA,OAAA,CAAQ,IAAA,CAAK,CAAA,6CAAA,EAAgD,KAAA,CAAM,OAAO,CAAA,UAAA,CAAY,CAAA;AACtF,MAAA;AAAA,IACF;AAGA,IAAA,KAAA,MAAW,CAAC,UAAU,KAAK,CAAA,IAAK,OAAO,OAAA,CAAQ,KAAA,CAAM,SAAS,CAAA,EAAG;AAC/D,MAAA,MAAM,UAAA,GAAa,IAAI,IAAA,CAAK,KAAA,CAAM,UAAU,CAAA;AAC5C,MAAA,MAAM,YAAY,KAAA,CAAM,SAAA,GAAY,IAAI,IAAA,CAAK,KAAA,CAAM,SAAS,CAAA,GAAI,MAAA;AAGhE,MAAA,IAAI,SAAA,IAAa,SAAA,mBAAY,IAAI,IAAA,EAAK,EAAG;AACvC,QAAA;AAAA,MACF;AAEA,MAAA,IAAA,CAAK,aAAA,CAAc,IAAI,QAAA,EAAU;AAAA,QAC/B,UAAU,KAAA,CAAM,QAAA;AAAA,QAChB,OAAO,KAAA,CAAM,KAAA;AAAA,QACb,UAAA;AAAA,QACA,YAAY,KAAA,CAAM,UAAA;AAAA,QAClB,SAAA;AAAA,QACA,UAAU,KAAA,CAAM;AAAA,OACjB,CAAA;AAAA,IACH;AAGA,IAAA,KAAA,MAAW,QAAA,IAAY,MAAM,SAAA,EAAW;AACtC,MAAA,IAAA,CAAK,SAAA,CAAU,IAAI,QAAQ,CAAA;AAAA,IAC7B;AAEA,IAAA,KAAA,MAAW,QAAA,IAAY,MAAM,SAAA,EAAW;AAEtC,MAAA,IAAA,CAAK,SAAA,CAAU,OAAO,QAAQ,CAAA;AAC9B,MAAA,IAAA,CAAK,SAAA,CAAU,IAAI,QAAQ,CAAA;AAAA,IAC7B;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,WAAA,GAAgE;AAC9D,IAAA,OAAO;AAAA,MACL,OAAO,IAAA,CAAK,YAAA;AAAA,MACZ,WAAW,IAAA,CAAK;AAAA,KAClB;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,YAAY,QAAA,EAAoE;AAC9E,IAAA,IAAI,QAAA,CAAS,KAAA,EAAO,IAAA,CAAK,YAAA,GAAe,QAAA,CAAS,KAAA;AACjD,IAAA,IAAI,QAAA,CAAS,SAAA,EAAW,IAAA,CAAK,gBAAA,GAAmB,QAAA,CAAS,SAAA;AAAA,EAC3D;AAAA;AAAA;AAAA;AAAA,EAKA,QAAA,GAKE;AACA,IAAA,OAAO;AAAA,MACL,aAAA,EAAe,IAAA,CAAK,gBAAA,EAAiB,CAAE,MAAA;AAAA,MACvC,gBAAA,EAAkB,KAAK,SAAA,CAAU,IAAA;AAAA,MACjC,gBAAA,EAAkB,KAAK,SAAA,CAAU,IAAA;AAAA,MACjC,eAAA,EAAiB,KAAK,WAAA,CAAY;AAAA,KACpC;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,KAAA,GAAc;AACZ,IAAA,IAAA,CAAK,cAAc,KAAA,EAAM;AACzB,IAAA,IAAA,CAAK,UAAU,KAAA,EAAM;AACrB,IAAA,IAAA,CAAK,UAAU,KAAA,EAAM;AACrB,IAAA,IAAA,CAAK,YAAY,KAAA,EAAM;AACvB,IAAA,IAAA,CAAK,eAAe,yBAAA,CAA0B,KAAA;AAC9C,IAAA,IAAA,CAAK,mBAAmB,yBAAA,CAA0B,SAAA;AAAA,EACpD;AACF;;;AF5lBA,WAAA,EAAA;;;AGCA,mBAAA,EAAA;;;ACjBO,IAAM,OAAA,GAAN,MAAM,QAAA,SAAgB,KAAA,CAAM;AAAA,EACjC,WAAA,CACE,OAAA,EACgB,IAAA,EACA,UAAA,EACA,aAAA,EAChB;AACA,IAAA,KAAA,CAAM,OAAO,CAAA;AAJG,IAAA,IAAA,CAAA,IAAA,GAAA,IAAA;AACA,IAAA,IAAA,CAAA,UAAA,GAAA,UAAA;AACA,IAAA,IAAA,CAAA,aAAA,GAAA,aAAA;AAGhB,IAAA,IAAA,CAAK,IAAA,GAAO,SAAA;AACZ,IAAA,MAAA,CAAO,cAAA,CAAe,IAAA,EAAM,QAAA,CAAQ,SAAS,CAAA;AAAA,EAC/C;AACF;AAEO,IAAM,qBAAA,GAAN,MAAM,sBAAA,SAA8B,OAAA,CAAQ;AAAA,EACjD,YAAY,YAAA,EAAsB;AAChC,IAAA,KAAA;AAAA,MACE,aAAa,YAAY,CAAA,2DAAA,CAAA;AAAA,MACzB,oBAAA;AAAA,MACA;AAAA,KACF;AACA,IAAA,IAAA,CAAK,IAAA,GAAO,uBAAA;AACZ,IAAA,MAAA,CAAO,cAAA,CAAe,IAAA,EAAM,sBAAA,CAAsB,SAAS,CAAA;AAAA,EAC7D;AACF;AAEO,IAAM,iBAAA,GAAN,MAAM,kBAAA,SAA0B,OAAA,CAAQ;AAAA,EAC7C,WAAA,CAAY,YAAA,EAAsB,OAAA,GAAkB,uBAAA,EAAyB;AAC3E,IAAA,KAAA;AAAA,MACE,CAAA,EAAG,YAAY,CAAA,EAAA,EAAK,OAAO,CAAA,CAAA;AAAA,MAC3B,qBAAA;AAAA,MACA;AAAA,KACF;AACA,IAAA,IAAA,CAAK,IAAA,GAAO,mBAAA;AACZ,IAAA,MAAA,CAAO,cAAA,CAAe,IAAA,EAAM,kBAAA,CAAkB,SAAS,CAAA;AAAA,EACzD;AACF;AAEO,IAAM,sBAAA,GAAN,MAAM,uBAAA,SAA+B,OAAA,CAAQ;AAAA,EAClD,WAAA,CACE,cACgB,UAAA,EAChB;AACA,IAAA,KAAA;AAAA,MACE,GAAG,YAAY,CAAA,qBAAA,EAAwB,aAAa,CAAA,cAAA,EAAiB,UAAU,OAAO,EAAE,CAAA,CAAA;AAAA,MACxF,qBAAA;AAAA,MACA;AAAA,KACF;AANgB,IAAA,IAAA,CAAA,UAAA,GAAA,UAAA;AAOhB,IAAA,IAAA,CAAK,IAAA,GAAO,wBAAA;AACZ,IAAA,MAAA,CAAO,cAAA,CAAe,IAAA,EAAM,uBAAA,CAAuB,SAAS,CAAA;AAAA,EAC9D;AACF;AAEO,IAAM,0BAAA,GAAN,MAAM,2BAAA,SAAmC,OAAA,CAAQ;AAAA,EACtD,WAAA,CACE,YAAA,EACgB,SAAA,EACA,eAAA,EAChB;AACA,IAAA,KAAA;AAAA,MACE,CAAA,EAAG,YAAY,CAAA,gCAAA,EAAmC,SAAS,GAAG,eAAA,GAAkB,CAAA,aAAA,EAAgB,eAAe,CAAA,CAAA,GAAK,EAAE,CAAA,CAAA;AAAA,MACtH,kCAAA;AAAA,MACA;AAAA,KACF;AAPgB,IAAA,IAAA,CAAA,SAAA,GAAA,SAAA;AACA,IAAA,IAAA,CAAA,eAAA,GAAA,eAAA;AAOhB,IAAA,IAAA,CAAK,IAAA,GAAO,4BAAA;AACZ,IAAA,MAAA,CAAO,cAAA,CAAe,IAAA,EAAM,2BAAA,CAA2B,SAAS,CAAA;AAAA,EAClE;AACF;AAEO,IAAM,kBAAA,GAAN,MAAM,mBAAA,SAA2B,OAAA,CAAQ;AAAA,EAC9C,WAAA,CACE,QAAA,EACA,OAAA,EACgB,aAAA,EAChB;AACA,IAAA,KAAA;AAAA,MACE,CAAA,MAAA,EAAS,QAAQ,CAAA,oBAAA,EAAuB,OAAO,CAAA,CAAA;AAAA,MAC/C,sBAAA;AAAA,MACA,GAAA;AAAA,MACA;AAAA,KACF;AAPgB,IAAA,IAAA,CAAA,aAAA,GAAA,aAAA;AAQhB,IAAA,IAAA,CAAK,IAAA,GAAO,oBAAA;AACZ,IAAA,MAAA,CAAO,cAAA,CAAe,IAAA,EAAM,mBAAA,CAAmB,SAAS,CAAA;AAAA,EAC1D;AACF;AAEO,IAAM,gBAAA,GAAN,MAAM,iBAAA,SAAyB,OAAA,CAAQ;AAAA,EAC5C,WAAA,CACE,UACgB,SAAA,EAChB;AACA,IAAA,KAAA;AAAA,MACE,CAAA,MAAA,EAAS,QAAQ,CAAA,4BAAA,EAA+B,SAAS,CAAA,EAAA,CAAA;AAAA,MACzD,cAAA;AAAA,MACA;AAAA,KACF;AANgB,IAAA,IAAA,CAAA,SAAA,GAAA,SAAA;AAOhB,IAAA,IAAA,CAAK,IAAA,GAAO,kBAAA;AACZ,IAAA,MAAA,CAAO,cAAA,CAAe,IAAA,EAAM,iBAAA,CAAiB,SAAS,CAAA;AAAA,EACxD;AACF;AAEO,IAAM,iBAAA,GAAN,MAAM,kBAAA,SAA0B,OAAA,CAAQ;AAAA,EAC7C,YAAY,QAAA,EAAkB;AAC5B,IAAA,KAAA;AAAA,MACE,SAAS,QAAQ,CAAA,gDAAA,CAAA;AAAA,MACjB,gBAAA;AAAA,MACA;AAAA,KACF;AACA,IAAA,IAAA,CAAK,IAAA,GAAO,mBAAA;AACZ,IAAA,MAAA,CAAO,cAAA,CAAe,IAAA,EAAM,kBAAA,CAAkB,SAAS,CAAA;AAAA,EACzD;AACF;AAEO,IAAM,sBAAA,GAAN,MAAM,uBAAA,SAA+B,OAAA,CAAQ;AAAA,EAClD,WAAA,CAAY,YAAA,EAAsB,KAAA,EAAe,UAAA,EAAoB;AACnE,IAAA,KAAA;AAAA,MACE,CAAA,OAAA,EAAU,KAAK,CAAA,OAAA,EAAU,YAAY,qBAAqB,UAAU,CAAA,CAAA;AAAA,MACpE,qBAAA;AAAA,MACA;AAAA,KACF;AACA,IAAA,IAAA,CAAK,IAAA,GAAO,wBAAA;AACZ,IAAA,MAAA,CAAO,cAAA,CAAe,IAAA,EAAM,uBAAA,CAAuB,SAAS,CAAA;AAAA,EAC9D;AACF;AAEO,IAAM,kBAAA,GAAN,MAAM,mBAAA,SAA2B,OAAA,CAAQ;AAAA,EAC9C,YAAY,OAAA,EAAiB;AAC3B,IAAA,KAAA,CAAM,OAAA,EAAS,kBAAkB,GAAG,CAAA;AACpC,IAAA,IAAA,CAAK,IAAA,GAAO,oBAAA;AACZ,IAAA,MAAA,CAAO,cAAA,CAAe,IAAA,EAAM,mBAAA,CAAmB,SAAS,CAAA;AAAA,EAC1D;AACF;AAEO,IAAM,yBAAA,GAAN,MAAM,0BAAA,SAAkC,OAAA,CAAQ;AAAA,EACrD,WAAA,CACE,QAAA,EACgB,YAAA,EACA,UAAA,EAChB;AACA,IAAA,KAAA;AAAA,MACE,CAAA,4BAAA,EAA+B,QAAQ,CAAA,GAAA,EAAM,UAAA,EAAY,WAAW,sBAAsB,CAAA,CAAA;AAAA,MAC1F,wBAAA;AAAA,MACA,GAAA;AAAA,MACA;AAAA,KACF;AARgB,IAAA,IAAA,CAAA,YAAA,GAAA,YAAA;AACA,IAAA,IAAA,CAAA,UAAA,GAAA,UAAA;AAQhB,IAAA,IAAA,CAAK,IAAA,GAAO,2BAAA;AACZ,IAAA,MAAA,CAAO,cAAA,CAAe,IAAA,EAAM,0BAAA,CAA0B,SAAS,CAAA;AAAA,EACjE;AACF;AAEO,IAAM,aAAA,GAAN,MAAM,cAAA,SAAsB,OAAA,CAAQ;AAAA,EACzC,WAAA,CACkB,YAAA,EAChB,OAAA,EACA,UAAA,EACA,aAAA,EACA;AACA,IAAA,KAAA;AAAA,MACE,CAAA,EAAG,YAAY,CAAA,EAAA,EAAK,OAAO,CAAA,CAAA;AAAA,MAC3B,gBAAA;AAAA,MACA,UAAA;AAAA,MACA;AAAA,KACF;AAVgB,IAAA,IAAA,CAAA,YAAA,GAAA,YAAA;AAWhB,IAAA,IAAA,CAAK,IAAA,GAAO,eAAA;AACZ,IAAA,MAAA,CAAO,cAAA,CAAe,IAAA,EAAM,cAAA,CAAc,SAAS,CAAA;AAAA,EACrD;AACF;AAOO,IAAM,oBAAA,GAAN,MAAM,qBAAA,SAA6B,OAAA,CAAQ;AAAA,EAChD,WAAA,CAEkB,OAEA,MAAA,EAChB;AACA,IAAA,KAAA;AAAA,MACE,CAAA,2BAAA,EAA8B,KAAA,CAAM,IAAA,CAAK,MAAM,CAAC,CAAA,CAAA;AAAA,MAChD,kBAAA;AAAA,MACA;AAAA,KACF;AARgB,IAAA,IAAA,CAAA,KAAA,GAAA,KAAA;AAEA,IAAA,IAAA,CAAA,MAAA,GAAA,MAAA;AAOhB,IAAA,IAAA,CAAK,IAAA,GAAO,sBAAA;AACZ,IAAA,MAAA,CAAO,cAAA,CAAe,IAAA,EAAM,qBAAA,CAAqB,SAAS,CAAA;AAAA,EAC5D;AACF;AAKO,IAAM,gBAAA,GAAN,MAAM,iBAAA,SAAyB,OAAA,CAAQ;AAAA,EAC5C,WAAA,CACkB,MAAA,EACA,QAAA,EACA,SAAA,EAChB;AACA,IAAA,KAAA;AAAA,MACE,CAAA,MAAA,EAAS,QAAQ,CAAA,GAAA,EAAM,MAAM,qBAAqB,SAAS,CAAA,EAAA,CAAA;AAAA,MAC3D,cAAA;AAAA,MACA;AAAA,KACF;AARgB,IAAA,IAAA,CAAA,MAAA,GAAA,MAAA;AACA,IAAA,IAAA,CAAA,QAAA,GAAA,QAAA;AACA,IAAA,IAAA,CAAA,SAAA,GAAA,SAAA;AAOhB,IAAA,IAAA,CAAK,IAAA,GAAO,kBAAA;AACZ,IAAA,MAAA,CAAO,cAAA,CAAe,IAAA,EAAM,iBAAA,CAAiB,SAAS,CAAA;AAAA,EACxD;AACF;AAKO,IAAM,mBAAA,GAAN,MAAM,oBAAA,SAA4B,OAAA,CAAQ;AAAA,EAC/C,WAAA,CACkB,MAAA,EACA,QAAA,EACA,MAAA,EAChB;AACA,IAAA,KAAA;AAAA,MACE,CAAA,MAAA,EAAS,QAAQ,CAAA,GAAA,EAAM,MAAM,wBAAwB,MAAM,CAAA,CAAA;AAAA,MAC3D,uBAAA;AAAA,MACA;AAAA,KACF;AARgB,IAAA,IAAA,CAAA,MAAA,GAAA,MAAA;AACA,IAAA,IAAA,CAAA,QAAA,GAAA,QAAA;AACA,IAAA,IAAA,CAAA,MAAA,GAAA,MAAA;AAOhB,IAAA,IAAA,CAAK,IAAA,GAAO,qBAAA;AACZ,IAAA,MAAA,CAAO,cAAA,CAAe,IAAA,EAAM,oBAAA,CAAoB,SAAS,CAAA;AAAA,EAC3D;AACF;AAcO,IAAM,kBAAA,GAAN,MAAM,mBAAA,SAA2B,OAAA,CAAQ;AAAA,EAC9C,YAEkB,QAAA,EAChB;AACA,IAAA,MAAM,KAAA,GAAQ,SAAS,GAAA,CAAI,CAAC,MAAM,CAAA,CAAE,QAAQ,CAAA,CAAE,IAAA,CAAK,IAAI,CAAA;AACvD,IAAA,KAAA;AAAA,MACE,gDAAgD,KAAK,CAAA,CAAA;AAAA,MACrD,sBAAA;AAAA,MACA;AAAA,KACF;AAPgB,IAAA,IAAA,CAAA,QAAA,GAAA,QAAA;AAQhB,IAAA,IAAA,CAAK,IAAA,GAAO,oBAAA;AACZ,IAAA,MAAA,CAAO,cAAA,CAAe,IAAA,EAAM,mBAAA,CAAmB,SAAS,CAAA;AAAA,EAC1D;AAAA;AAAA;AAAA;AAAA,EAKA,SAAA,GAAqB;AACnB,IAAA,OAAO,KAAK,QAAA,CAAS,GAAA,CAAI,CAAC,CAAA,KAAM,EAAE,KAAK,CAAA;AAAA,EACzC;AAAA;AAAA;AAAA;AAAA,EAKA,gBAAA,GAA6B;AAC3B,IAAA,OAAO,KAAK,QAAA,CAAS,GAAA,CAAI,CAAC,CAAA,KAAM,EAAE,MAAM,CAAA;AAAA,EAC1C;AACF;;;ADvPA,WAAA,EAAA;AACA,YAAA,EAAA;AAgGO,IAAM,WAAA,GAAN,cAA0BA,YAAAA,CAAmD;AAAA,EAC1E,QAAA,uBAA8C,GAAA,EAAI;AAAA,EAClD,cAAA,uBAA+C,GAAA,EAAI;AAAA,EACnD,eAAA,uBAAmD,GAAA,EAAI;AAAA,EACvD,UAAA;AAAA,EACA,YAAA,GAAe,KAAA;AAAA;AAAA,EAGf,YAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,cAAA,GAAkE,IAAA;AAAA,EAE1E,WAAA,GAAc;AACZ,IAAA,KAAA,EAAM;AAEN,IAAA,IAAA,CAAK,cAAA,CAAe,GAAA,CAAI,SAAA,kBAAW,IAAI,KAAK,CAAA;AAC5C,IAAA,IAAA,CAAK,aAAa,MAAA,CAAO,KAAA,CAAM,EAAE,SAAA,EAAW,eAAe,CAAA;AAAA,EAC7D;AAAA;AAAA;AAAA;AAAA,EAKA,IAAI,WAAA,GAAuB;AACzB,IAAA,OAAO,IAAA,CAAK,YAAA;AAAA,EACd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,OAAA,GAAgB;AACd,IAAA,IAAI,KAAK,YAAA,EAAc;AACrB,MAAA;AAAA,IACF;AAEA,IAAA,IAAA,CAAK,YAAA,GAAe,IAAA;AAGpB,IAAA,KAAA,MAAW,OAAA,IAAW,IAAA,CAAK,eAAA,CAAgB,MAAA,EAAO,EAAG;AACnD,MAAA,OAAA,CAAQ,kBAAA,EAAmB;AAAA,IAC7B;AACA,IAAA,IAAA,CAAK,gBAAgB,KAAA,EAAM;AAG3B,IAAA,IAAA,CAAK,SAAS,KAAA,EAAM;AACpB,IAAA,IAAA,CAAK,eAAe,KAAA,EAAM;AAG1B,IAAA,IAAA,CAAK,kBAAA,EAAmB;AAAA,EAC1B;AAAA;AAAA;AAAA;AAAA,EAKA,eAAe,OAAA,EAAwC;AACrD,IAAA,IAAA,CAAK,YAAA,GAAe,OAAA;AAAA,EACtB;AAAA;AAAA;AAAA;AAAA,EAKA,cAAA,GAA0C;AACxC,IAAA,OAAO,IAAA,CAAK,YAAA;AAAA,EACd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAYA,iBAAiB,OAAA,EAAgE;AAC/E,IAAA,IAAA,CAAK,cAAA,GAAiB,OAAA;AAAA,EACxB;AAAA;AAAA;AAAA;AAAA,EAKA,gBAAA,GAAoE;AAClE,IAAA,OAAO,IAAA,CAAK,cAAA;AAAA,EACd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOQ,uBAAA,GAAmD;AACzD,IAAA,IAAI,CAAC,KAAK,cAAA,EAAgB;AACxB,MAAA,OAAO,MAAA;AAAA,IACT;AAEA,IAAA,MAAM,MAAM,IAAA,CAAK,cAAA;AACjB,IAAA,OAAO;AAAA,MACL,SAAS,GAAA,CAAI,OAAA;AAAA,MACb,MAAA,EAAQ,GAAA,CAAI,MAAA,EAAQ,SAAA,EAAU;AAAA,MAC9B,YAAA,EAAc,GAAA;AAAA,MACd,gBAAA,EAAkB,IAAI,KAAA,IAAS,MAAA;AAAA,MAC/B,eAAA,EAAiB,IAAI,eAAA,IAAmB,MAAA;AAAA,MACxC,sBAAA,EAAwB,IAAI,sBAAA,IAA0B;AAAA,KACxD;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,QAAA,CAAS,IAAA,EAAoB,OAAA,GAAuB,EAAC,EAAS;AAC5D,IAAA,MAAM,IAAA,GAAO,IAAA,CAAK,WAAA,CAAY,IAAI,CAAA;AAElC,IAAA,IAAI,IAAA,CAAK,QAAA,CAAS,GAAA,CAAI,IAAI,CAAA,EAAG;AAE3B,MAAA,MAAM,QAAA,GAAW,IAAA,CAAK,QAAA,CAAS,GAAA,CAAI,IAAI,CAAA;AACvC,MAAA,QAAA,CAAS,IAAA,GAAO,IAAA;AAChB,MAAA,IAAI,OAAA,CAAQ,OAAA,KAAY,MAAA,EAAW,QAAA,CAAS,UAAU,OAAA,CAAQ,OAAA;AAC9D,MAAA,IAAI,OAAA,CAAQ,cAAc,MAAA,EAAW;AACnC,QAAA,IAAA,CAAK,eAAA,CAAgB,IAAA,EAAM,QAAA,CAAS,SAAA,EAAW,QAAQ,SAAS,CAAA;AAChE,QAAA,QAAA,CAAS,YAAY,OAAA,CAAQ,SAAA;AAAA,MAC/B;AACA,MAAA,IAAI,OAAA,CAAQ,QAAA,KAAa,MAAA,EAAW,QAAA,CAAS,WAAW,OAAA,CAAQ,QAAA;AAChE,MAAA,IAAI,OAAA,CAAQ,UAAA,KAAe,MAAA,EAAW,QAAA,CAAS,aAAa,OAAA,CAAQ,UAAA;AACpE,MAAA,IAAI,OAAA,CAAQ,UAAA,KAAe,MAAA,EAAW,QAAA,CAAS,aAAa,OAAA,CAAQ,UAAA;AACpE,MAAA;AAAA,IACF;AAEA,IAAA,MAAM,SAAA,GAAY,QAAQ,SAAA,IAAa,SAAA;AAGvC,IAAA,MAAM,mBAAA,GAAsB,OAAA,CAAQ,UAAA,IAAc,IAAA,CAAK,UAAA;AAEvD,IAAA,MAAM,YAAA,GAAiC;AAAA,MACrC,IAAA;AAAA,MACA,OAAA,EAAS,QAAQ,OAAA,IAAW,IAAA;AAAA,MAC5B,SAAA;AAAA,MACA,QAAA,EAAU,QAAQ,QAAA,IAAY,CAAA;AAAA,MAC9B,UAAA,EAAY,OAAA,CAAQ,UAAA,IAAc,EAAC;AAAA,MACnC,QAAA,EAAU;AAAA,QACR,YAAA,sBAAkB,IAAA,EAAK;AAAA,QACvB,UAAA,EAAY,CAAA;AAAA,QACZ,gBAAA,EAAkB,CAAA;AAAA,QAClB,cAAA,EAAgB,CAAA;AAAA,QAChB,YAAA,EAAc,CAAA;AAAA,QACd,YAAA,EAAc;AAAA,OAChB;AAAA,MACA,UAAA,EAAY;AAAA,KACd;AAEA,IAAA,IAAA,CAAK,QAAA,CAAS,GAAA,CAAI,IAAA,EAAM,YAAY,CAAA;AACpC,IAAA,IAAA,CAAK,cAAA,CAAe,MAAM,SAAS,CAAA;AAEnC,IAAA,IAAA,CAAK,IAAA,CAAK,mBAAmB,EAAE,IAAA,EAAM,WAAW,OAAA,EAAS,YAAA,CAAa,SAAS,CAAA;AAAA,EACjF;AAAA;AAAA;AAAA;AAAA,EAKA,YAAA,CAAa,KAAA,EAAuB,OAAA,GAA2C,EAAC,EAAS;AACvF,IAAA,KAAA,MAAW,QAAQ,KAAA,EAAO;AACxB,MAAA,IAAA,CAAK,QAAA,CAAS,MAAM,OAAO,CAAA;AAAA,IAC7B;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,WAAW,IAAA,EAAuB;AAChC,IAAA,MAAM,YAAA,GAAe,IAAA,CAAK,QAAA,CAAS,GAAA,CAAI,IAAI,CAAA;AAC3C,IAAA,IAAI,CAAC,cAAc,OAAO,KAAA;AAE1B,IAAA,IAAA,CAAK,mBAAA,CAAoB,IAAA,EAAM,YAAA,CAAa,SAAS,CAAA;AACrD,IAAA,IAAA,CAAK,QAAA,CAAS,OAAO,IAAI,CAAA;AAGzB,IAAA,MAAM,OAAA,GAAU,IAAA,CAAK,eAAA,CAAgB,GAAA,CAAI,IAAI,CAAA;AAC7C,IAAA,IAAI,OAAA,EAAS;AACX,MAAA,OAAA,CAAQ,kBAAA,EAAmB;AAC3B,MAAA,IAAA,CAAK,eAAA,CAAgB,OAAO,IAAI,CAAA;AAAA,IAClC;AAEA,IAAA,IAAA,CAAK,IAAA,CAAK,mBAAA,EAAqB,EAAE,IAAA,EAAM,CAAA;AACvC,IAAA,OAAO,IAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,KAAA,GAAc;AACZ,IAAA,IAAA,CAAK,SAAS,KAAA,EAAM;AACpB,IAAA,IAAA,CAAK,eAAe,KAAA,EAAM;AAC1B,IAAA,IAAA,CAAK,cAAA,CAAe,GAAA,CAAI,SAAA,kBAAW,IAAI,KAAK,CAAA;AAG5C,IAAA,KAAA,MAAW,OAAA,IAAW,IAAA,CAAK,eAAA,CAAgB,MAAA,EAAO,EAAG;AACnD,MAAA,OAAA,CAAQ,kBAAA,EAAmB;AAAA,IAC7B;AACA,IAAA,IAAA,CAAK,gBAAgB,KAAA,EAAM;AAAA,EAC7B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,OAAO,IAAA,EAAuB;AAC5B,IAAA,MAAM,YAAA,GAAe,IAAA,CAAK,QAAA,CAAS,GAAA,CAAI,IAAI,CAAA;AAC3C,IAAA,IAAI,CAAC,cAAc,OAAO,KAAA;AAE1B,IAAA,IAAI,CAAC,aAAa,OAAA,EAAS;AACzB,MAAA,YAAA,CAAa,OAAA,GAAU,IAAA;AACvB,MAAA,IAAA,CAAK,IAAA,CAAK,cAAA,EAAgB,EAAE,IAAA,EAAM,CAAA;AAAA,IACpC;AACA,IAAA,OAAO,IAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,QAAQ,IAAA,EAAuB;AAC7B,IAAA,MAAM,YAAA,GAAe,IAAA,CAAK,QAAA,CAAS,GAAA,CAAI,IAAI,CAAA;AAC3C,IAAA,IAAI,CAAC,cAAc,OAAO,KAAA;AAE1B,IAAA,IAAI,aAAa,OAAA,EAAS;AACxB,MAAA,YAAA,CAAa,OAAA,GAAU,KAAA;AACvB,MAAA,IAAA,CAAK,IAAA,CAAK,eAAA,EAAiB,EAAE,IAAA,EAAM,CAAA;AAAA,IACrC;AACA,IAAA,OAAO,IAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,OAAO,IAAA,EAAuB;AAC5B,IAAA,MAAM,YAAA,GAAe,IAAA,CAAK,QAAA,CAAS,GAAA,CAAI,IAAI,CAAA;AAC3C,IAAA,IAAI,CAAC,cAAc,OAAO,KAAA;AAE1B,IAAA,YAAA,CAAa,OAAA,GAAU,CAAC,YAAA,CAAa,OAAA;AACrC,IAAA,IAAA,CAAK,KAAK,YAAA,CAAa,OAAA,GAAU,iBAAiB,eAAA,EAAiB,EAAE,MAAM,CAAA;AAC3E,IAAA,OAAO,YAAA,CAAa,OAAA;AAAA,EACtB;AAAA;AAAA;AAAA;AAAA,EAKA,UAAU,IAAA,EAAuB;AAC/B,IAAA,MAAM,YAAA,GAAe,IAAA,CAAK,QAAA,CAAS,GAAA,CAAI,IAAI,CAAA;AAC3C,IAAA,OAAO,cAAc,OAAA,IAAW,KAAA;AAAA,EAClC;AAAA;AAAA;AAAA;AAAA,EAKA,UAAA,CAAW,OAAiB,OAAA,EAAwB;AAClD,IAAA,KAAA,MAAW,QAAQ,KAAA,EAAO;AACxB,MAAA,IAAI,OAAA,EAAS;AACX,QAAA,IAAA,CAAK,OAAO,IAAI,CAAA;AAAA,MAClB,CAAA,MAAO;AACL,QAAA,IAAA,CAAK,QAAQ,IAAI,CAAA;AAAA,MACnB;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,YAAA,CAAa,UAAkB,SAAA,EAA4B;AACzD,IAAA,MAAM,YAAA,GAAe,IAAA,CAAK,QAAA,CAAS,GAAA,CAAI,QAAQ,CAAA;AAC/C,IAAA,IAAI,CAAC,cAAc,OAAO,KAAA;AAE1B,IAAA,MAAM,eAAe,YAAA,CAAa,SAAA;AAClC,IAAA,IAAI,YAAA,KAAiB,WAAW,OAAO,IAAA;AAEvC,IAAA,IAAA,CAAK,eAAA,CAAgB,QAAA,EAAU,YAAA,EAAc,SAAS,CAAA;AACtD,IAAA,YAAA,CAAa,SAAA,GAAY,SAAA;AACzB,IAAA,OAAO,IAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,gBAAgB,SAAA,EAAyB;AACvC,IAAA,MAAM,KAAA,GAAQ,IAAA,CAAK,cAAA,CAAe,GAAA,CAAI,SAAS,CAAA;AAC/C,IAAA,IAAI,CAAC,KAAA,EAAO;AAEZ,IAAA,KAAA,MAAW,QAAQ,KAAA,EAAO;AACxB,MAAA,IAAA,CAAK,OAAO,IAAI,CAAA;AAAA,IAClB;AACA,IAAA,IAAA,CAAK,IAAA,CAAK,mBAAA,EAAqB,EAAE,SAAA,EAAW,CAAA;AAAA,EAC9C;AAAA;AAAA;AAAA;AAAA,EAKA,iBAAiB,SAAA,EAAyB;AACxC,IAAA,MAAM,KAAA,GAAQ,IAAA,CAAK,cAAA,CAAe,GAAA,CAAI,SAAS,CAAA;AAC/C,IAAA,IAAI,CAAC,KAAA,EAAO;AAEZ,IAAA,KAAA,MAAW,QAAQ,KAAA,EAAO;AACxB,MAAA,IAAA,CAAK,QAAQ,IAAI,CAAA;AAAA,IACnB;AACA,IAAA,IAAA,CAAK,IAAA,CAAK,oBAAA,EAAsB,EAAE,SAAA,EAAW,CAAA;AAAA,EAC/C;AAAA;AAAA;AAAA;AAAA,EAKA,aAAA,GAA0B;AACxB,IAAA,OAAO,KAAA,CAAM,IAAA,CAAK,IAAA,CAAK,cAAA,CAAe,MAAM,CAAA;AAAA,EAC9C;AAAA;AAAA;AAAA;AAAA,EAKA,eAAA,CAAgB,SAAA,EAAmB,KAAA,EAAuB,OAAA,GAA0C,EAAC,EAAS;AAC5G,IAAA,KAAA,MAAW,QAAQ,KAAA,EAAO;AACxB,MAAA,IAAA,CAAK,SAAS,IAAA,EAAM,EAAE,GAAG,OAAA,EAAS,WAAW,CAAA;AAAA,IAC/C;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,WAAA,CAAY,MAAc,QAAA,EAA2B;AACnD,IAAA,MAAM,YAAA,GAAe,IAAA,CAAK,QAAA,CAAS,GAAA,CAAI,IAAI,CAAA;AAC3C,IAAA,IAAI,CAAC,cAAc,OAAO,KAAA;AAE1B,IAAA,YAAA,CAAa,QAAA,GAAW,QAAA;AACxB,IAAA,OAAO,IAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,YAAY,IAAA,EAAkC;AAC5C,IAAA,OAAO,IAAA,CAAK,QAAA,CAAS,GAAA,CAAI,IAAI,CAAA,EAAG,QAAA;AAAA,EAClC;AAAA;AAAA;AAAA;AAAA,EAKA,cAAc,IAAA,EAAgD;AAC5D,IAAA,OAAO,IAAA,CAAK,QAAA,CAAS,GAAA,CAAI,IAAI,CAAA,EAAG,UAAA;AAAA,EAClC;AAAA;AAAA;AAAA;AAAA,EAKA,aAAA,CAAc,MAAc,UAAA,EAA2C;AACrE,IAAA,MAAM,YAAA,GAAe,IAAA,CAAK,QAAA,CAAS,GAAA,CAAI,IAAI,CAAA;AAC3C,IAAA,IAAI,CAAC,cAAc,OAAO,KAAA;AAE1B,IAAA,YAAA,CAAa,UAAA,GAAa,UAAA;AAC1B,IAAA,OAAO,IAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,IAAI,IAAA,EAAwC;AAC1C,IAAA,OAAO,IAAA,CAAK,QAAA,CAAS,GAAA,CAAI,IAAI,CAAA,EAAG,IAAA;AAAA,EAClC;AAAA;AAAA;AAAA;AAAA,EAKA,IAAI,IAAA,EAAuB;AACzB,IAAA,OAAO,IAAA,CAAK,QAAA,CAAS,GAAA,CAAI,IAAI,CAAA;AAAA,EAC/B;AAAA;AAAA;AAAA;AAAA,EAKA,UAAA,GAA6B;AAC3B,IAAA,OAAO,IAAA,CAAK,mBAAA,EAAoB,CAC7B,MAAA,CAAO,CAAC,GAAA,KAAQ,GAAA,CAAI,OAAO,CAAA,CAC3B,GAAA,CAAI,CAAC,GAAA,KAAQ,IAAI,IAAI,CAAA;AAAA,EAC1B;AAAA;AAAA;AAAA;AAAA,EAKA,MAAA,GAAyB;AACvB,IAAA,OAAO,KAAA,CAAM,IAAA,CAAK,IAAA,CAAK,QAAA,CAAS,MAAA,EAAQ,CAAA,CAAE,GAAA,CAAI,CAAC,GAAA,KAAQ,GAAA,CAAI,IAAI,CAAA;AAAA,EACjE;AAAA;AAAA;AAAA;AAAA,EAKA,eAAe,SAAA,EAAmC;AAChD,IAAA,MAAM,SAAA,GAAY,IAAA,CAAK,cAAA,CAAe,GAAA,CAAI,SAAS,CAAA;AACnD,IAAA,IAAI,CAAC,SAAA,EAAW,OAAO,EAAC;AAExB,IAAA,OAAO,KAAA,CAAM,IAAA,CAAK,SAAS,CAAA,CACxB,IAAI,CAAC,IAAA,KAAS,IAAA,CAAK,QAAA,CAAS,GAAA,CAAI,IAAI,CAAE,CAAA,CACtC,OAAO,CAAC,GAAA,KAAQ,GAAA,CAAI,OAAO,CAAA,CAC3B,IAAA,CAAK,CAAC,CAAA,EAAG,MAAM,CAAA,CAAE,QAAA,GAAW,CAAA,CAAE,QAAQ,CAAA,CACtC,GAAA,CAAI,CAAC,GAAA,KAAQ,IAAI,IAAI,CAAA;AAAA,EAC1B;AAAA;AAAA;AAAA;AAAA,EAKA,gBAAgB,IAAA,EAA4C;AAC1D,IAAA,OAAO,IAAA,CAAK,QAAA,CAAS,GAAA,CAAI,IAAI,CAAA;AAAA,EAC/B;AAAA;AAAA;AAAA;AAAA,EAKA,IAAA,GAAiB;AACf,IAAA,OAAO,KAAA,CAAM,IAAA,CAAK,IAAA,CAAK,QAAA,CAAS,MAAM,CAAA;AAAA,EACxC;AAAA;AAAA;AAAA;AAAA,EAKA,WAAA,GAAwB;AACtB,IAAA,OAAO,KAAA,CAAM,KAAK,IAAA,CAAK,QAAA,CAAS,SAAS,CAAA,CACtC,OAAO,CAAC,CAAC,GAAG,GAAG,CAAA,KAAM,IAAI,OAAO,CAAA,CAChC,IAAI,CAAC,CAAC,IAAI,CAAA,KAAM,IAAI,CAAA;AAAA,EACzB;AAAA;AAAA;AAAA;AAAA,EAKA,IAAI,IAAA,GAAe;AACjB,IAAA,OAAO,KAAK,QAAA,CAAS,IAAA;AAAA,EACvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,iBAAiB,OAAA,EAA+C;AAC9D,IAAA,MAAM,MAAA,GAAS,KAAK,mBAAA,EAAoB;AACxC,IAAA,MAAM,WAA2B,EAAC;AAElC,IAAA,KAAA,MAAW,OAAO,MAAA,EAAQ;AAExB,MAAA,IAAI,CAAC,IAAI,OAAA,EAAS;AAGlB,MAAA,IAAI,GAAA,CAAI,UAAA,CAAW,MAAA,GAAS,CAAA,EAAG;AAC7B,QAAA,MAAM,gBAAA,GAAmB,IAAI,UAAA,CAAW,KAAA,CAAM,CAAC,IAAA,KAAS,IAAA,CAAK,SAAA,CAAU,OAAO,CAAC,CAAA;AAC/E,QAAA,IAAI,CAAC,gBAAA,EAAkB;AAAA,MACzB;AAGA,MAAA,IAAI,OAAA,CAAQ,aAAa,QAAA,CAAS,IAAA,CAAK,YAAY,GAAA,CAAI,IAAI,CAAC,CAAA,EAAG;AAC7D,QAAA;AAAA,MACF;AAEA,MAAA,QAAA,CAAS,IAAA,CAAK,IAAI,IAAI,CAAA;AAAA,IACxB;AAGA,IAAA,IAAI,OAAA,CAAQ,gBAAgB,MAAA,EAAW;AACrC,MAAA,OAAO,IAAA,CAAK,mBAAA,CAAoB,QAAA,EAAU,OAAA,CAAQ,WAAW,CAAA;AAAA,IAC/D;AAEA,IAAA,OAAO,QAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,mBAAmB,WAAA,EAAqC;AACtD,IAAA,MAAM,SAAA,GAAY,YAAY,WAAA,EAAY;AAC1C,IAAA,MAAM,QAAA,GAAW,SAAA,CAAU,KAAA,CAAM,KAAK,CAAA;AAEtC,IAAA,OAAO,IAAA,CAAK,UAAA,EAAW,CAAE,MAAA,CAAO,CAAC,IAAA,KAAS;AACxC,MAAA,MAAM,YAAY,IAAA,CAAK,UAAA,CAAW,QAAA,CAAS,WAAA,IAAe,IAAI,WAAA,EAAY;AAC1E,MAAA,MAAM,QAAA,GAAW,IAAA,CAAK,UAAA,CAAW,QAAA,CAAS,KAAK,WAAA,EAAY;AAG3D,MAAA,OAAO,QAAA,CAAS,IAAA,CAAK,CAAC,EAAA,KAAO,QAAA,CAAS,QAAA,CAAS,EAAE,CAAA,IAAK,QAAA,CAAS,QAAA,CAAS,EAAE,CAAC,CAAA;AAAA,IAC7E,CAAC,CAAA;AAAA,EACH;AAAA;AAAA;AAAA;AAAA,EAKA,mBAAmB,MAAA,EAAgC;AACjD,IAAA,OAAO,IAAA,CAAK,mBAAA,CAAoB,IAAA,CAAK,UAAA,IAAc,MAAM,CAAA;AAAA,EAC3D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,eAAA,CACE,IAAA,EACA,WAAA,EACA,OAAA,EACM;AACN,IAAA,MAAM,YAAA,GAAe,IAAA,CAAK,QAAA,CAAS,GAAA,CAAI,IAAI,CAAA;AAC3C,IAAA,IAAI,CAAC,YAAA,EAAc;AAEnB,IAAA,MAAM,OAAO,YAAA,CAAa,QAAA;AAC1B,IAAA,IAAA,CAAK,UAAA,EAAA;AACL,IAAA,IAAA,CAAK,QAAA,uBAAe,IAAA,EAAK;AACzB,IAAA,IAAA,CAAK,gBAAA,IAAoB,WAAA;AACzB,IAAA,IAAA,CAAK,cAAA,GAAiB,IAAA,CAAK,gBAAA,GAAmB,IAAA,CAAK,UAAA;AAEnD,IAAA,IAAI,OAAA,EAAS;AACX,MAAA,IAAA,CAAK,YAAA,EAAA;AAAA,IACP,CAAA,MAAO;AACL,MAAA,IAAA,CAAK,YAAA,EAAA;AAAA,IACP;AAEA,IAAA,IAAA,CAAK,KAAK,eAAA,EAAiB;AAAA,MACzB,IAAA;AAAA,MACA,WAAA;AAAA,MACA,OAAA;AAAA,MACA,YAAY,IAAA,CAAK;AAAA,KAClB,CAAA;AAAA,EACH;AAAA;AAAA;AAAA;AAAA,EAKQ,gBAAgB,MAAA,EAA0C;AAChE,IAAA,IAAI,MAAA,KAAW,IAAA,IAAQ,MAAA,KAAW,MAAA,EAAW;AAC3C,MAAA,OAAO,EAAE,MAAM,MAAA,EAAO;AAAA,IACxB;AAEA,IAAA,IAAI,OAAO,WAAW,QAAA,EAAU;AAC9B,MAAA,OAAO,EAAE,IAAA,EAAM,OAAO,MAAA,EAAQ,KAAA,EAAO,MAAA,CAAO,MAAM,CAAA,CAAE,KAAA,CAAM,CAAA,EAAG,GAAG,CAAA,EAAE;AAAA,IACpE;AAEA,IAAA,MAAM,GAAA,GAAM,MAAA;AAGZ,IAAA,IAAI,aAAa,GAAA,EAAK;AACpB,MAAA,MAAM,OAAA,GAAmC;AAAA,QACvC,SAAS,GAAA,CAAI;AAAA,OACf;AACA,MAAA,IAAI,OAAA,IAAW,GAAA,EAAK,OAAA,CAAQ,KAAA,GAAQ,GAAA,CAAI,KAAA;AACxC,MAAA,IAAI,OAAA,IAAW,GAAA,EAAK,OAAA,CAAQ,KAAA,GAAQ,GAAA,CAAI,KAAA;AACxC,MAAA,IAAI,aAAa,GAAA,IAAO,KAAA,CAAM,OAAA,CAAQ,GAAA,CAAI,OAAO,CAAA,EAAG;AAClD,QAAA,OAAA,CAAQ,WAAA,GAAc,IAAI,OAAA,CAAQ,MAAA;AAAA,MACpC;AACA,MAAA,IAAI,UAAA,IAAc,GAAA,EAAK,OAAA,CAAQ,QAAA,GAAW,GAAA,CAAI,QAAA;AAC9C,MAAA,OAAO,OAAA;AAAA,IACT;AAGA,IAAA,IAAI,KAAA,CAAM,OAAA,CAAQ,MAAM,CAAA,EAAG;AACzB,MAAA,OAAO,EAAE,IAAA,EAAM,OAAA,EAAS,MAAA,EAAQ,OAAO,MAAA,EAAO;AAAA,IAChD;AAGA,IAAA,MAAM,IAAA,GAAO,MAAA,CAAO,IAAA,CAAK,GAAG,CAAA;AAC5B,IAAA,OAAO;AAAA,MACL,IAAA,EAAM,QAAA;AAAA,MACN,IAAA,EAAM,IAAA,CAAK,KAAA,CAAM,CAAA,EAAG,EAAE,CAAA;AAAA,MACtB,UAAU,IAAA,CAAK;AAAA,KACjB;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,QAAA,GAA6B;AAC3B,IAAA,MAAM,gBAAgB,KAAA,CAAM,IAAA,CAAK,IAAA,CAAK,QAAA,CAAS,QAAQ,CAAA;AACvD,IAAA,MAAM,eAAe,aAAA,CAAc,MAAA,CAAO,CAAC,CAAA,KAAM,CAAA,CAAE,OAAO,CAAA,CAAE,MAAA;AAE5D,IAAA,MAAM,mBAA2C,EAAC;AAClD,IAAA,KAAA,MAAW,CAAC,EAAA,EAAI,KAAK,CAAA,IAAK,KAAK,cAAA,EAAgB;AAC7C,MAAA,gBAAA,CAAiB,EAAE,IAAI,KAAA,CAAM,IAAA;AAAA,IAC/B;AAEA,IAAA,MAAM,QAAA,GAAW,aAAA,CACd,MAAA,CAAO,CAAC,CAAA,KAAM,CAAA,CAAE,QAAA,CAAS,UAAA,GAAa,CAAC,CAAA,CACvC,IAAA,CAAK,CAAC,CAAA,EAAG,CAAA,KAAM,CAAA,CAAE,QAAA,CAAS,UAAA,GAAa,CAAA,CAAE,QAAA,CAAS,UAAU,CAAA,CAC5D,KAAA,CAAM,CAAA,EAAG,EAAE,CAAA,CACX,GAAA,CAAI,CAAC,CAAA,MAAO;AAAA,MACX,IAAA,EAAM,IAAA,CAAK,WAAA,CAAY,CAAA,CAAE,IAAI,CAAA;AAAA,MAC7B,KAAA,EAAO,EAAE,QAAA,CAAS;AAAA,KACpB,CAAE,CAAA;AAEJ,IAAA,MAAM,eAAA,GAAkB,aAAA,CAAc,MAAA,CAAO,CAAC,GAAA,EAAK,MAAM,GAAA,GAAM,CAAA,CAAE,QAAA,CAAS,UAAA,EAAY,CAAC,CAAA;AAEvF,IAAA,OAAO;AAAA,MACL,UAAA,EAAY,KAAK,QAAA,CAAS,IAAA;AAAA,MAC1B,YAAA,EAAc,YAAA;AAAA,MACd,aAAA,EAAe,IAAA,CAAK,QAAA,CAAS,IAAA,GAAO,YAAA;AAAA,MACpC,UAAA,EAAY,KAAK,aAAA,EAAc;AAAA,MAC/B,gBAAA;AAAA,MACA,QAAA;AAAA,MACA;AAAA,KACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUA,MAAM,OAAA,CAAQ,QAAA,EAAkB,IAAA,EAAyB;AACvD,IAAA,MAAM,YAAA,GAAe,IAAA,CAAK,QAAA,CAAS,GAAA,CAAI,QAAQ,CAAA;AAC/C,IAAA,IAAI,CAAC,YAAA,EAAc;AACjB,MAAA,MAAM,IAAI,kBAAkB,QAAQ,CAAA;AAAA,IACtC;AAGA,IAAA,IAAI,CAAC,aAAa,OAAA,EAAS;AACzB,MAAA,MAAM,IAAI,kBAAA,CAAmB,QAAA,EAAU,kBAAkB,CAAA;AAAA,IAC3D;AAGA,IAAA,MAAM,OAAA,GAAU,IAAA,CAAK,yBAAA,CAA0B,QAAA,EAAU,YAAY,CAAA;AAErE,IAAA,IAAA,CAAK,WAAW,KAAA,CAAM,EAAE,QAAA,EAAU,IAAA,IAAQ,wBAAwB,CAAA;AAElE,IAAA,MAAM,SAAA,GAAY,KAAK,GAAA,EAAI;AAC3B,IAAA,OAAA,CAAQ,UAAU,eAAA,EAAiB,CAAA,EAAG,EAAE,IAAA,EAAM,UAAU,CAAA;AAIxD,IAAA,MAAM,gBAAA,GAAmB,IAAA,CAAK,YAAA,IAAgB,IAAA,CAAK,uBAAA,EAAwB;AAE3E,IAAA,IAAI;AAEF,MAAA,MAAM,MAAA,GAAS,MAAM,OAAA,CAAQ,OAAA,CAAQ,YAAY;AAC/C,QAAA,OAAO,MAAM,YAAA,CAAa,IAAA,CAAK,OAAA,CAAQ,MAAM,gBAAgB,CAAA;AAAA,MAC/D,CAAC,CAAA;AAED,MAAA,MAAM,QAAA,GAAW,IAAA,CAAK,GAAA,EAAI,GAAI,SAAA;AAG9B,MAAA,IAAA,CAAK,eAAA,CAAgB,QAAA,EAAU,QAAA,EAAU,IAAI,CAAA;AAG7C,MAAA,MAAM,aAAA,GAAgB,IAAA,CAAK,eAAA,CAAgB,MAAM,CAAA;AACjD,MAAA,IAAA,CAAK,WAAW,KAAA,CAAM;AAAA,QACpB,QAAA;AAAA,QACA,QAAA;AAAA,QACA;AAAA,SACC,0BAA0B,CAAA;AAE7B,MAAA,OAAA,CAAQ,OAAO,eAAA,EAAiB,QAAA,EAAU,EAAE,IAAA,EAAM,UAAU,CAAA;AAC5D,MAAA,OAAA,CAAQ,UAAU,cAAA,EAAgB,CAAA,EAAG,EAAE,IAAA,EAAM,UAAU,CAAA;AAEvD,MAAA,OAAO,MAAA;AAAA,IACT,SAAS,KAAA,EAAO;AACd,MAAA,MAAM,QAAA,GAAW,IAAA,CAAK,GAAA,EAAI,GAAI,SAAA;AAG9B,MAAA,IAAA,CAAK,eAAA,CAAgB,QAAA,EAAU,QAAA,EAAU,KAAK,CAAA;AAE9C,MAAA,IAAA,CAAK,WAAW,KAAA,CAAM;AAAA,QACpB,QAAA;AAAA,QACA,OAAQ,KAAA,CAAgB,OAAA;AAAA,QACxB;AAAA,SACC,uBAAuB,CAAA;AAE1B,MAAA,OAAA,CAAQ,SAAA,CAAU,eAAe,CAAA,EAAG;AAAA,QAClC,IAAA,EAAM,QAAA;AAAA,QACN,OAAQ,KAAA,CAAgB;AAAA,OACzB,CAAA;AAED,MAAA,MAAM,IAAI,kBAAA;AAAA,QACR,QAAA;AAAA,QACC,KAAA,CAAgB,OAAA;AAAA,QACjB;AAAA,OACF;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,gBAAgB,QAAA,EAA2B;AACzC,IAAA,OAAO,IAAA,CAAK,QAAA,CAAS,GAAA,CAAI,QAAQ,CAAA;AAAA,EACnC;AAAA;AAAA;AAAA;AAAA,EAKA,kBAAkB,QAAA,EAAoC;AACpD,IAAA,MAAM,YAAA,GAAe,IAAA,CAAK,QAAA,CAAS,GAAA,CAAI,QAAQ,CAAA;AAC/C,IAAA,OAAO,cAAc,IAAA,CAAK,UAAA;AAAA,EAC5B;AAAA;AAAA;AAAA;AAAA,EAKA,aAAa,IAAA,EAA0B;AACrC,IAAA,IAAA,CAAK,SAAS,IAAI,CAAA;AAAA,EACpB;AAAA;AAAA;AAAA;AAAA,EAKA,eAAe,QAAA,EAAwB;AACrC,IAAA,IAAA,CAAK,WAAW,QAAQ,CAAA;AAAA,EAC1B;AAAA;AAAA;AAAA;AAAA,EAKA,SAAA,GAAsB;AACpB,IAAA,OAAO,KAAK,IAAA,EAAK;AAAA,EACnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASQ,yBAAA,CAA0B,UAAkB,YAAA,EAAgD;AAClG,IAAA,IAAI,OAAA,GAAU,IAAA,CAAK,eAAA,CAAgB,GAAA,CAAI,QAAQ,CAAA;AAE/C,IAAA,IAAI,CAAC,OAAA,EAAS;AAEZ,MAAA,MAAM,MAAA,GAAS,aAAa,oBAAA,IAAwB;AAAA,QAClD,gBAAA,EAAkB,CAAA;AAAA,QAClB,gBAAA,EAAkB,CAAA;AAAA,QAClB,cAAA,EAAgB,GAAA;AAAA;AAAA,QAChB,QAAA,EAAU;AAAA;AAAA,OACZ;AAEA,MAAA,OAAA,GAAU,IAAI,cAAA,CAAe,CAAA,KAAA,EAAQ,QAAQ,IAAI,MAAM,CAAA;AAGvD,MAAA,OAAA,CAAQ,EAAA,CAAG,QAAA,EAAU,CAAC,IAAA,KAAS;AAC7B,QAAA,IAAA,CAAK,UAAA,CAAW,IAAA,CAAK,IAAA,EAAM,CAAA,iCAAA,EAAoC,QAAQ,CAAA,CAAE,CAAA;AACzE,QAAA,OAAA,CAAQ,SAAA,CAAU,0BAA0B,CAAA,EAAG;AAAA,UAC7C,SAAS,IAAA,CAAK,IAAA;AAAA,UACd,IAAA,EAAM;AAAA,SACP,CAAA;AAAA,MACH,CAAC,CAAA;AAED,MAAA,OAAA,CAAQ,EAAA,CAAG,QAAA,EAAU,CAAC,IAAA,KAAS;AAC7B,QAAA,IAAA,CAAK,UAAA,CAAW,IAAA,CAAK,IAAA,EAAM,CAAA,iCAAA,EAAoC,QAAQ,CAAA,CAAE,CAAA;AACzE,QAAA,OAAA,CAAQ,SAAA,CAAU,0BAA0B,CAAA,EAAG;AAAA,UAC7C,SAAS,IAAA,CAAK,IAAA;AAAA,UACd,IAAA,EAAM;AAAA,SACP,CAAA;AAAA,MACH,CAAC,CAAA;AAED,MAAA,IAAA,CAAK,eAAA,CAAgB,GAAA,CAAI,QAAA,EAAU,OAAO,CAAA;AAAA,IAC5C;AAEA,IAAA,OAAO,OAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,uBAAA,GAAqD;AACnD,IAAA,MAAM,MAAA,uBAAa,GAAA,EAA0B;AAC7C,IAAA,KAAA,MAAW,CAAC,QAAA,EAAU,OAAO,KAAK,IAAA,CAAK,eAAA,CAAgB,SAAQ,EAAG;AAChE,MAAA,MAAA,CAAO,GAAA,CAAI,QAAA,EAAU,OAAA,CAAQ,QAAA,EAAU,CAAA;AAAA,IACzC;AACA,IAAA,OAAO,MAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,6BAA6B,QAAA,EAAkB;AAC7C,IAAA,MAAM,OAAA,GAAU,IAAA,CAAK,eAAA,CAAgB,GAAA,CAAI,QAAQ,CAAA;AACjD,IAAA,OAAO,SAAS,UAAA,EAAW;AAAA,EAC7B;AAAA;AAAA;AAAA;AAAA,EAKA,wBAAwB,QAAA,EAAwB;AAC9C,IAAA,MAAM,OAAA,GAAU,IAAA,CAAK,eAAA,CAAgB,GAAA,CAAI,QAAQ,CAAA;AACjD,IAAA,IAAI,OAAA,EAAS;AACX,MAAA,OAAA,CAAQ,KAAA,EAAM;AACd,MAAA,IAAA,CAAK,UAAA,CAAW,IAAA,CAAK,EAAE,QAAA,IAAY,qCAAqC,CAAA;AAAA,IAC1E;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,uBAAA,CAAwB,UAAkB,MAAA,EAAuC;AAC/E,IAAA,MAAM,YAAA,GAAe,IAAA,CAAK,QAAA,CAAS,GAAA,CAAI,QAAQ,CAAA;AAC/C,IAAA,IAAI,CAAC,cAAc,OAAO,KAAA;AAE1B,IAAA,YAAA,CAAa,oBAAA,GAAuB,MAAA;AAGpC,IAAA,MAAM,eAAA,GAAkB,IAAA,CAAK,eAAA,CAAgB,GAAA,CAAI,QAAQ,CAAA;AACzD,IAAA,IAAI,eAAA,EAAiB;AACnB,MAAA,eAAA,CAAgB,kBAAA,EAAmB;AACnC,MAAA,IAAA,CAAK,eAAA,CAAgB,OAAO,QAAQ,CAAA;AAAA,IAEtC;AAEA,IAAA,OAAO,IAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,QAAA,GAAgC;AAC9B,IAAA,MAAM,UAAmC,EAAC;AAC1C,IAAA,MAAM,aAAqC,EAAC;AAC5C,IAAA,MAAM,aAAqC,EAAC;AAC5C,IAAA,MAAM,cAAoD,EAAC;AAE3D,IAAA,KAAA,MAAW,CAAC,IAAA,EAAM,GAAG,CAAA,IAAK,KAAK,QAAA,EAAU;AACvC,MAAA,OAAA,CAAQ,IAAI,IAAI,GAAA,CAAI,OAAA;AACpB,MAAA,UAAA,CAAW,IAAI,IAAI,GAAA,CAAI,SAAA;AACvB,MAAA,UAAA,CAAW,IAAI,IAAI,GAAA,CAAI,QAAA;AACvB,MAAA,IAAI,IAAI,UAAA,EAAY;AAClB,QAAA,WAAA,CAAY,IAAI,IAAI,GAAA,CAAI,UAAA;AAAA,MAC1B;AAAA,IACF;AAEA,IAAA,OAAO,EAAE,OAAA,EAAS,UAAA,EAAY,UAAA,EAAY,WAAA,EAAY;AAAA,EACxD;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,UAAU,KAAA,EAAkC;AAC1C,IAAA,KAAA,MAAW,CAAC,MAAM,SAAS,CAAA,IAAK,OAAO,OAAA,CAAQ,KAAA,CAAM,OAAO,CAAA,EAAG;AAC7D,MAAA,MAAM,GAAA,GAAM,IAAA,CAAK,QAAA,CAAS,GAAA,CAAI,IAAI,CAAA;AAClC,MAAA,IAAI,GAAA,EAAK;AACP,QAAA,GAAA,CAAI,OAAA,GAAU,SAAA;AAAA,MAChB;AAAA,IACF;AAEA,IAAA,KAAA,MAAW,CAAC,MAAM,SAAS,CAAA,IAAK,OAAO,OAAA,CAAQ,KAAA,CAAM,UAAU,CAAA,EAAG;AAChE,MAAA,IAAA,CAAK,YAAA,CAAa,MAAM,SAAS,CAAA;AAAA,IACnC;AAEA,IAAA,KAAA,MAAW,CAAC,MAAM,QAAQ,CAAA,IAAK,OAAO,OAAA,CAAQ,KAAA,CAAM,UAAU,CAAA,EAAG;AAC/D,MAAA,IAAA,CAAK,WAAA,CAAY,MAAM,QAAQ,CAAA;AAAA,IACjC;AAGA,IAAA,IAAI,MAAM,WAAA,EAAa;AACrB,MAAA,KAAA,MAAW,CAAC,MAAM,UAAU,CAAA,IAAK,OAAO,OAAA,CAAQ,KAAA,CAAM,WAAW,CAAA,EAAG;AAClE,QAAA,IAAA,CAAK,aAAA,CAAc,MAAM,UAAU,CAAA;AAAA,MACrC;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAMQ,YAAY,IAAA,EAA4B;AAC9C,IAAA,OAAO,IAAA,CAAK,WAAW,QAAA,CAAS,IAAA;AAAA,EAClC;AAAA,EAEQ,mBAAA,GAA0C;AAChD,IAAA,OAAO,KAAA,CAAM,IAAA,CAAK,IAAA,CAAK,QAAA,CAAS,QAAQ,CAAA,CAAE,IAAA,CAAK,CAAC,CAAA,EAAG,CAAA,KAAM,CAAA,CAAE,QAAA,GAAW,EAAE,QAAQ,CAAA;AAAA,EAClF;AAAA,EAEQ,cAAA,CAAe,UAAkB,SAAA,EAAyB;AAChE,IAAA,IAAI,CAAC,IAAA,CAAK,cAAA,CAAe,GAAA,CAAI,SAAS,CAAA,EAAG;AACvC,MAAA,IAAA,CAAK,cAAA,CAAe,GAAA,CAAI,SAAA,kBAAW,IAAI,KAAK,CAAA;AAAA,IAC9C;AACA,IAAA,IAAA,CAAK,cAAA,CAAe,GAAA,CAAI,SAAS,CAAA,CAAG,IAAI,QAAQ,CAAA;AAAA,EAClD;AAAA,EAEQ,mBAAA,CAAoB,UAAkB,SAAA,EAAyB;AACrE,IAAA,IAAA,CAAK,cAAA,CAAe,GAAA,CAAI,SAAS,CAAA,EAAG,OAAO,QAAQ,CAAA;AAAA,EACrD;AAAA,EAEQ,eAAA,CAAgB,QAAA,EAAkB,YAAA,EAAsB,YAAA,EAA4B;AAC1F,IAAA,IAAA,CAAK,mBAAA,CAAoB,UAAU,YAAY,CAAA;AAC/C,IAAA,IAAA,CAAK,cAAA,CAAe,UAAU,YAAY,CAAA;AAAA,EAC5C;AAAA,EAEQ,mBAAA,CAAoB,OAAuB,MAAA,EAAgC;AACjF,IAAA,MAAM,SAAyB,EAAC;AAChC,IAAA,IAAI,UAAA,GAAa,CAAA;AAEjB,IAAA,KAAA,MAAW,QAAQ,KAAA,EAAO;AACxB,MAAA,MAAM,UAAA,GAAa,IAAA,CAAK,kBAAA,CAAmB,IAAI,CAAA;AAC/C,MAAA,IAAI,UAAA,GAAa,cAAc,MAAA,EAAQ;AACrC,QAAA,MAAA,CAAO,KAAK,IAAI,CAAA;AAChB,QAAA,UAAA,IAAc,UAAA;AAAA,MAChB;AAAA,IACF;AAEA,IAAA,OAAO,MAAA;AAAA,EACT;AAAA,EAEQ,mBAAmB,IAAA,EAA4B;AAErD,IAAA,MAAM,GAAA,GAAM,KAAK,UAAA,CAAW,QAAA;AAC5B,IAAA,MAAM,aAAa,IAAA,CAAK,IAAA,CAAA,CAAM,IAAI,IAAA,EAAM,MAAA,IAAU,KAAK,CAAC,CAAA;AACxD,IAAA,MAAM,aAAa,IAAA,CAAK,IAAA,CAAA,CAAM,IAAI,WAAA,EAAa,MAAA,IAAU,KAAK,CAAC,CAAA;AAC/D,IAAA,MAAM,WAAA,GAAc,GAAA,CAAI,UAAA,GAAa,IAAA,CAAK,IAAA,CAAK,IAAA,CAAK,SAAA,CAAU,GAAA,CAAI,UAAU,CAAA,CAAE,MAAA,GAAS,CAAC,CAAA,GAAI,CAAA;AAE5F,IAAA,OAAO,UAAA,GAAa,aAAa,WAAA,GAAc,EAAA;AAAA,EACjD;AACF;;;AEhgCO,IAAM,0BAAA,GAAqD;AAAA,EAChE,YAAA,EAAc,IAAA;AAAA;AAAA,EACd,UAAA,EAAY;AACd;AAcO,IAAM,mBAAN,MAA8C;AAAA,EAC3C,MAAA;AAAA,EACA,KAAA,uBAAY,GAAA,EAAmD;AAAA,EAC/D,IAAA,GAAO,CAAA;AAAA,EACP,MAAA,GAAS,CAAA;AAAA,EACT,eAAA;AAAA,EACA,YAAA,GAAe,KAAA;AAAA,EAEvB,WAAA,CAAY,SAAiC,0BAAA,EAA4B;AACvE,IAAA,IAAA,CAAK,MAAA,GAAS,MAAA;AAGd,IAAA,IAAA,CAAK,eAAA,GAAkB,YAAY,MAAM;AACvC,MAAA,IAAA,CAAK,YAAA,EAAa;AAAA,IACpB,GAAG,GAAM,CAAA;AAAA,EACX;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,IAAI,WAAA,GAAuB;AACzB,IAAA,OAAO,IAAA,CAAK,YAAA;AAAA,EACd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,OAAA,GAAgB;AACd,IAAA,IAAI,KAAK,YAAA,EAAc;AACrB,MAAA;AAAA,IACF;AAEA,IAAA,IAAA,CAAK,YAAA,GAAe,IAAA;AAEpB,IAAA,IAAI,KAAK,eAAA,EAAiB;AACxB,MAAA,aAAA,CAAc,KAAK,eAAe,CAAA;AAClC,MAAA,IAAA,CAAK,eAAA,GAAkB,MAAA;AAAA,IACzB;AAEA,IAAA,IAAA,CAAK,MAAM,KAAA,EAAM;AACjB,IAAA,IAAA,CAAK,IAAA,GAAO,CAAA;AACZ,IAAA,IAAA,CAAK,MAAA,GAAS,CAAA;AAAA,EAChB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAWQ,YAAY,IAAA,EAA6B;AAC/C,IAAA,MAAM,cAAc,IAAA,CAAK,WAAA;AACzB,IAAA,IAAI,CAAC,aAAa,OAAO,KAAA;AAGzB,IAAA,IAAI,WAAA,CAAY,cAAc,MAAA,EAAW;AACvC,MAAA,OAAO,WAAA,CAAY,SAAA;AAAA,IACrB;AAGA,IAAA,IAAI,WAAA,CAAY,SAAS,MAAA,EAAW;AAClC,MAAA,OAAO,CAAC,WAAA,CAAY,IAAA;AAAA,IACtB;AAEA,IAAA,OAAO,KAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,GAAA,CAAI,IAAA,EAAoB,IAAA,EAAiD;AAE7E,IAAA,IAAI,KAAK,YAAA,EAAc;AACrB,MAAA,OAAO,MAAA;AAAA,IACT;AAGA,IAAA,IAAI,CAAC,IAAA,CAAK,WAAA,CAAY,IAAI,CAAA,EAAG;AAC3B,MAAA,IAAA,CAAK,MAAA,EAAA;AACL,MAAA,OAAO,MAAA;AAAA,IACT;AAEA,IAAA,MAAM,GAAA,GAAM,IAAA,CAAK,WAAA,CAAY,IAAA,EAAM,IAAI,CAAA;AACvC,IAAA,MAAM,MAAA,GAAS,IAAA,CAAK,KAAA,CAAM,GAAA,CAAI,GAAG,CAAA;AAEjC,IAAA,IAAI,CAAC,MAAA,EAAQ;AACX,MAAA,IAAA,CAAK,MAAA,EAAA;AACL,MAAA,OAAO,MAAA;AAAA,IACT;AAGA,IAAA,IAAI,IAAA,CAAK,GAAA,EAAI,GAAI,MAAA,CAAO,SAAA,EAAW;AACjC,MAAA,IAAA,CAAK,KAAA,CAAM,OAAO,GAAG,CAAA;AACrB,MAAA,IAAA,CAAK,MAAA,EAAA;AACL,MAAA,OAAO,MAAA;AAAA,IACT;AAEA,IAAA,IAAA,CAAK,IAAA,EAAA;AACL,IAAA,OAAO,MAAA,CAAO,KAAA;AAAA,EAChB;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,GAAA,CAAI,IAAA,EAAoB,IAAA,EAA+B,MAAA,EAAgC;AAE3F,IAAA,IAAI,KAAK,YAAA,EAAc;AACrB,MAAA;AAAA,IACF;AAGA,IAAA,IAAI,CAAC,IAAA,CAAK,WAAA,CAAY,IAAI,CAAA,EAAG;AAC3B,MAAA;AAAA,IACF;AAEA,IAAA,MAAM,GAAA,GAAM,IAAA,CAAK,WAAA,CAAY,IAAA,EAAM,IAAI,CAAA;AACvC,IAAA,MAAM,GAAA,GAAM,IAAA,CAAK,WAAA,EAAa,KAAA,IAAS,KAAK,MAAA,CAAO,YAAA;AACnD,IAAA,MAAM,SAAA,GAAY,IAAA,CAAK,GAAA,EAAI,GAAI,GAAA;AAE/B,IAAA,IAAA,CAAK,MAAM,GAAA,CAAI,GAAA,EAAK,EAAE,KAAA,EAAO,MAAA,EAAQ,WAAW,CAAA;AAGhD,IAAA,IAAI,IAAA,CAAK,KAAA,CAAM,IAAA,GAAO,IAAA,CAAK,OAAO,UAAA,EAAY;AAC5C,MAAA,MAAM,WAAW,IAAA,CAAK,KAAA,CAAM,IAAA,EAAK,CAAE,MAAK,CAAE,KAAA;AAC1C,MAAA,IAAI,QAAA,EAAU;AACZ,QAAA,IAAA,CAAK,KAAA,CAAM,OAAO,QAAQ,CAAA;AAAA,MAC5B;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,GAAA,CAAI,IAAA,EAAoB,IAAA,EAAiD;AAE7E,IAAA,IAAI,KAAK,YAAA,EAAc;AACrB,MAAA,OAAO,KAAA;AAAA,IACT;AAGA,IAAA,IAAI,CAAC,IAAA,CAAK,WAAA,CAAY,IAAI,CAAA,EAAG;AAC3B,MAAA,OAAO,KAAA;AAAA,IACT;AAEA,IAAA,MAAM,GAAA,GAAM,IAAA,CAAK,WAAA,CAAY,IAAA,EAAM,IAAI,CAAA;AACvC,IAAA,MAAM,MAAA,GAAS,IAAA,CAAK,KAAA,CAAM,GAAA,CAAI,GAAG,CAAA;AAEjC,IAAA,IAAI,CAAC,MAAA,EAAQ;AACX,MAAA,OAAO,KAAA;AAAA,IACT;AAGA,IAAA,IAAI,IAAA,CAAK,GAAA,EAAI,GAAI,MAAA,CAAO,SAAA,EAAW;AACjC,MAAA,IAAA,CAAK,KAAA,CAAM,OAAO,GAAG,CAAA;AACrB,MAAA,OAAO,KAAA;AAAA,IACT;AAEA,IAAA,OAAO,IAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,UAAA,CAAW,IAAA,EAAoB,IAAA,EAA8C;AACjF,IAAA,IAAI,CAAC,KAAK,WAAA,EAAa;AACrB,MAAA;AAAA,IACF;AAEA,IAAA,MAAM,GAAA,GAAM,IAAA,CAAK,WAAA,CAAY,IAAA,EAAM,IAAI,CAAA;AACvC,IAAA,IAAA,CAAK,KAAA,CAAM,OAAO,GAAG,CAAA;AAAA,EACvB;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,eAAe,IAAA,EAAmC;AACtD,IAAA,MAAM,QAAA,GAAW,IAAA,CAAK,UAAA,CAAW,QAAA,CAAS,IAAA;AAG1C,IAAA,MAAM,eAAyB,EAAC;AAChC,IAAA,KAAA,MAAW,GAAA,IAAO,IAAA,CAAK,KAAA,CAAM,IAAA,EAAK,EAAG;AACnC,MAAA,IAAI,GAAA,CAAI,UAAA,CAAW,CAAA,EAAG,QAAQ,GAAG,CAAA,EAAG;AAClC,QAAA,YAAA,CAAa,KAAK,GAAG,CAAA;AAAA,MACvB;AAAA,IACF;AAEA,IAAA,KAAA,MAAW,OAAO,YAAA,EAAc;AAC9B,MAAA,IAAA,CAAK,KAAA,CAAM,OAAO,GAAG,CAAA;AAAA,IACvB;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,YAAA,GAAuB;AAErB,IAAA,IAAI,KAAK,YAAA,EAAc;AACrB,MAAA,OAAO,CAAA;AAAA,IACT;AAEA,IAAA,MAAM,GAAA,GAAM,KAAK,GAAA,EAAI;AACrB,IAAA,MAAM,WAAqB,EAAC;AAE5B,IAAA,KAAA,MAAW,CAAC,GAAA,EAAK,KAAK,KAAK,IAAA,CAAK,KAAA,CAAM,SAAQ,EAAG;AAC/C,MAAA,IAAI,GAAA,GAAM,MAAM,SAAA,EAAW;AACzB,QAAA,QAAA,CAAS,KAAK,GAAG,CAAA;AAAA,MACnB;AAAA,IACF;AAEA,IAAA,QAAA,CAAS,QAAQ,CAAA,GAAA,KAAO,IAAA,CAAK,KAAA,CAAM,MAAA,CAAO,GAAG,CAAC,CAAA;AAC9C,IAAA,OAAO,QAAA,CAAS,MAAA;AAAA,EAClB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,MAAM,KAAA,GAAuB;AAC3B,IAAA,IAAA,CAAK,OAAA,EAAQ;AAAA,EACf;AAAA;AAAA;AAAA;AAAA,EAKA,QAAA,GAAuB;AACrB,IAAA,MAAM,KAAA,GAAQ,IAAA,CAAK,IAAA,GAAO,IAAA,CAAK,MAAA;AAC/B,IAAA,MAAM,OAAA,GAAU,KAAA,GAAQ,CAAA,GAAI,IAAA,CAAK,OAAO,KAAA,GAAQ,CAAA;AAEhD,IAAA,OAAO;AAAA,MACL,OAAA,EAAS,KAAK,KAAA,CAAM,IAAA;AAAA,MACpB,MAAM,IAAA,CAAK,IAAA;AAAA,MACX,QAAQ,IAAA,CAAK,MAAA;AAAA,MACb;AAAA,KACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,WAAA,CAAY,MAAoB,IAAA,EAAuC;AACrE,IAAA,MAAM,QAAA,GAAW,IAAA,CAAK,UAAA,CAAW,QAAA,CAAS,IAAA;AAG1C,IAAA,IAAI,IAAA,CAAK,aAAa,KAAA,EAAO;AAC3B,MAAA,OAAO,GAAG,QAAQ,CAAA,CAAA,EAAI,KAAK,WAAA,CAAY,KAAA,CAAM,IAAI,CAAC,CAAA,CAAA;AAAA,IACpD;AAGA,IAAA,MAAM,UAAA,GAAa,MAAA,CAAO,IAAA,CAAK,IAAI,CAAA,CAChC,MAAK,CACL,MAAA,CAAO,CAAC,GAAA,EAAK,GAAA,KAAQ;AACpB,MAAA,GAAA,CAAI,GAAG,CAAA,GAAI,IAAA,CAAK,GAAG,CAAA;AACnB,MAAA,OAAO,GAAA;AAAA,IACT,CAAA,EAAG,EAA6B,CAAA;AAElC,IAAA,MAAM,QAAA,GAAW,IAAA,CAAK,UAAA,CAAW,UAAU,CAAA;AAC3C,IAAA,OAAO,CAAA,EAAG,QAAQ,CAAA,CAAA,EAAI,QAAQ,CAAA,CAAA;AAAA,EAChC;AAAA;AAAA;AAAA;AAAA,EAKQ,WAAW,GAAA,EAAsB;AACvC,IAAA,MAAM,GAAA,GAAM,IAAA,CAAK,SAAA,CAAU,GAAG,CAAA;AAC9B,IAAA,IAAI,IAAA,GAAO,CAAA;AACX,IAAA,KAAA,IAAS,CAAA,GAAI,CAAA,EAAG,CAAA,GAAI,GAAA,CAAI,QAAQ,CAAA,EAAA,EAAK;AACnC,MAAA,MAAM,IAAA,GAAO,GAAA,CAAI,UAAA,CAAW,CAAC,CAAA;AAC7B,MAAA,IAAA,GAAA,CAAQ,IAAA,IAAQ,KAAK,IAAA,GAAO,IAAA;AAC5B,MAAA,IAAA,GAAO,IAAA,GAAO,IAAA;AAAA,IAChB;AACA,IAAA,OAAO,IAAA,CAAK,SAAS,EAAE,CAAA;AAAA,EACzB;AACF;;;AC7SO,SAAS,iBAAiB,KAAA,EAA6C;AAC5E,EAAA,OAAO,OAAO,KAAA,KAAU,QAAA,IAAY,KAAA,KAAU,QAAQ,MAAA,IAAU,KAAA;AAClE;AAKO,SAAS,cAAc,KAAA,EAA0C;AACtE,EAAA,OAAO,KAAA,KAAU,aAAa,KAAA,KAAU,YAAA;AAC1C;AAMO,SAAS,WAAA,CAAY,GAAgB,CAAA,EAAyB;AAEnE,EAAA,IAAI,aAAA,CAAc,CAAC,CAAA,IAAK,aAAA,CAAc,CAAC,CAAA,EAAG;AACxC,IAAA,OAAO,CAAA,KAAM,CAAA;AAAA,EACf;AAGA,EAAA,IAAI,gBAAA,CAAiB,CAAC,CAAA,IAAK,gBAAA,CAAiB,CAAC,CAAA,EAAG;AAC9C,IAAA,IAAI,CAAA,CAAE,IAAA,KAAS,CAAA,CAAE,IAAA,EAAM,OAAO,KAAA;AAG9B,IAAA,IAAI,CAAA,CAAE,IAAA,KAAS,MAAA,IAAU,CAAA,CAAE,SAAS,MAAA,EAAQ;AAC1C,MAAA,IAAI,EAAE,OAAA,CAAQ,MAAA,KAAW,CAAA,CAAE,OAAA,CAAQ,QAAQ,OAAO,KAAA;AAClD,MAAA,MAAM,UAAU,CAAC,GAAG,CAAA,CAAE,OAAO,EAAE,IAAA,EAAK;AACpC,MAAA,MAAM,UAAU,CAAC,GAAG,CAAA,CAAE,OAAO,EAAE,IAAA,EAAK;AACpC,MAAA,OAAO,OAAA,CAAQ,MAAM,CAAC,EAAA,EAAI,MAAM,EAAA,KAAO,OAAA,CAAQ,CAAC,CAAC,CAAA;AAAA,IACnD;AAGA,IAAA,OAAO,IAAA;AAAA,EACT;AAGA,EAAA,OAAO,KAAA;AACT;AAMO,SAAS,YAAA,CAAa,YAAyB,WAAA,EAAmC;AAEvF,EAAA,IAAI,WAAA,CAAY,UAAA,EAAY,WAAW,CAAA,EAAG,OAAO,IAAA;AAGjD,EAAA,IAAI,aAAA,CAAc,WAAW,CAAA,EAAG,OAAO,KAAA;AAGvC,EAAA,IAAI,gBAAA,CAAiB,UAAU,CAAA,IAAK,gBAAA,CAAiB,WAAW,CAAA,EAAG;AACjE,IAAA,OAAO,UAAA,CAAW,SAAS,WAAA,CAAY,IAAA;AAAA,EACzC;AAEA,EAAA,OAAO,KAAA;AACT;AAmBO,IAAM,sBAAA,GAAyD;AAAA,EACpE,QAAA,EAAU,CAAA;AAAA,EACV,IAAA,EAAM,CAAA;AAAA,EACN,MAAA,EAAQ,CAAA;AAAA,EACR,GAAA,EAAK;AACP;AAqBO,IAAM,eAAA,GAAsD;AAAA,EACjE,GAAA,EAAK,KAAA;AAAA,EACL,OAAA,EAAS,QAAA;AAAA,EACT,QAAA,EAAU;AACZ,CAAA;AAKO,IAAM,iBAAA,GAAgD;AAAA,EAC3D,GAAA,EAAK,MAAA;AAAA,EACL,OAAA,EAAS,UAAA;AAAA,EACT,QAAA,EAAU;AACZ,CAAA;AAiBO,SAAS,eAAe,GAAA,EAAqC;AAClE,EAAA,IAAI,GAAA,CAAI,UAAA,CAAW,iBAAA,CAAkB,GAAG,GAAG,OAAO,KAAA;AAClD,EAAA,IAAI,GAAA,CAAI,UAAA,CAAW,iBAAA,CAAkB,OAAO,GAAG,OAAO,SAAA;AACtD,EAAA,IAAI,GAAA,CAAI,UAAA,CAAW,iBAAA,CAAkB,QAAQ,GAAG,OAAO,UAAA;AACvD,EAAA,OAAO,MAAA;AACT;AAKO,SAAS,gBAAgB,GAAA,EAAqB;AACnD,EAAA,MAAM,IAAA,GAAO,eAAe,GAAG,CAAA;AAC/B,EAAA,IAAI,CAAC,MAAM,OAAO,GAAA;AAClB,EAAA,OAAO,GAAA,CAAI,SAAA,CAAU,iBAAA,CAAkB,IAAI,EAAE,MAAM,CAAA;AACrD;AAKO,SAAS,aAAA,CAAc,KAAa,IAAA,EAA0B;AACnE,EAAA,MAAM,YAAA,GAAe,eAAe,GAAG,CAAA;AACvC,EAAA,IAAI,YAAA,EAAc;AAEhB,IAAA,MAAM,OAAA,GAAU,gBAAgB,GAAG,CAAA;AACnC,IAAA,OAAO,iBAAA,CAAkB,IAAI,CAAA,GAAI,OAAA;AAAA,EACnC;AACA,EAAA,OAAO,iBAAA,CAAkB,IAAI,CAAA,GAAI,GAAA;AACnC;AA0BO,IAAM,wBAAA,GAAkD,CAAC,WAAA,EAAa,QAAA,EAAU,WAAW,WAAW,CAAA;AAKtG,SAAS,uBAAuB,MAAA,EAAsC;AAC3E,EAAA,OAAO,wBAAA,CAAyB,SAAS,MAAM,CAAA;AACjD;AAeO,IAAM,wBAAA,GAA+C,CAAC,KAAA,KAAU;AACrE,EAAA,IAAI,KAAA,CAAM,QAAQ,OAAO,UAAA;AACzB,EAAA,OAAO,KAAA,CAAM,YAAA;AACf,CAAA;AA2FO,SAAS,kBAAA,CACd,OAAA,EACA,eAAA,EACA,UAAA,EACkB;AAClB,EAAA,MAAM,QAA0B,EAAC;AAEjC,EAAA,KAAA,MAAW,SAAS,OAAA,EAAS;AAC3B,IAAA,IAAI,MAAM,MAAA,EAAQ;AAElB,IAAA,MAAM,QAAQ,KAAA,CAAM,KAAA;AACpB,IAAA,IAAI,CAAC,gBAAA,CAAiB,KAAK,CAAA,IAAK,KAAA,CAAM,SAAS,MAAA,EAAQ;AAGvD,IAAA,IAAI,CAAC,KAAA,CAAM,OAAA,CAAQ,QAAA,CAAS,eAAe,CAAA,EAAG;AAG9C,IAAA,MAAM,WAAA,GAAc,KAAA,CAAM,OAAA,CAAQ,KAAA,CAAM,CAAC,MAAA,KAAW;AAClD,MAAA,MAAM,MAAA,GAAS,UAAA,CAAW,GAAA,CAAI,MAAM,CAAA;AACpC,MAAA,OAAO,MAAA,GAAS,sBAAA,CAAuB,MAAM,CAAA,GAAI,KAAA;AAAA,IACnD,CAAC,CAAA;AAED,IAAA,IAAI,WAAA,EAAa;AACf,MAAA,KAAA,CAAM,IAAA,CAAK;AAAA,QACT,KAAK,KAAA,CAAM,GAAA;AAAA,QACX,aAAa,KAAA,CAAM,WAAA;AAAA,QACnB,MAAA,EAAQ,gBAAA;AAAA,QACR,kBAAkB,KAAA,CAAM,YAAA;AAAA,QACxB,WAAA,EAAa,KAAA;AAAA,QACb,SAAS,KAAA,CAAM;AAAA,OAChB,CAAA;AAAA,IACH;AAAA,EACF;AAEA,EAAA,OAAO,KAAA;AACT;AAqFO,SAAS,QAAA,CACd,GAAA,EACA,WAAA,EACA,KAAA,EACA,SACA,OAAA,EACkB;AAClB,EAAA,OAAO;AAAA,IACL,GAAA;AAAA,IACA,WAAA;AAAA,IACA,KAAA;AAAA,IACA,KAAA,EAAO,EAAE,IAAA,EAAM,MAAA,EAAQ,OAAA,EAAQ;AAAA,IAC/B,UAAU,OAAA,EAAS,QAAA;AAAA,IACnB,QAAQ,OAAA,EAAS;AAAA,GACnB;AACF;AAKO,SAAS,OAAA,CACd,GAAA,EACA,WAAA,EACA,KAAA,EACA,OAAA,EACkB;AAClB,EAAA,OAAO;AAAA,IACL,GAAA;AAAA,IACA,WAAA;AAAA,IACA,KAAA;AAAA,IACA,KAAA,EAAO,EAAE,IAAA,EAAM,MAAA,EAAO;AAAA,IACtB,UAAU,OAAA,EAAS,QAAA;AAAA,IACnB,QAAQ,OAAA,EAAS;AAAA,GACnB;AACF;AAKO,IAAM,qBAAA,GAA6C;AAAA,EACxD,YAAA,EAAc,KAAK,IAAA,GAAO,IAAA;AAAA;AAAA,EAC1B,oBAAA,EAAsB,GAAA;AAAA,EACtB,gBAAA,EAAkB,EAAA;AAAA,EAClB,wBAAA,EAA0B;AAC5B;AAOO,SAAS,kBAAkB,GAAA,EAAmB;AACnD,EAAA,IAAI,CAAC,GAAA,IAAO,GAAA,CAAI,MAAA,KAAW,CAAA,EAAG;AAC5B,IAAA,MAAM,IAAI,MAAM,4BAA4B,CAAA;AAAA,EAC9C;AAGA,EAAA,IAAI,GAAA,CAAI,UAAA,CAAW,GAAG,CAAA,IAAK,GAAA,CAAI,QAAA,CAAS,GAAG,CAAA,IAAK,GAAA,CAAI,QAAA,CAAS,IAAI,CAAA,EAAG;AAClE,IAAA,MAAM,IAAI,MAAM,wFAAwF,CAAA;AAAA,EAC1G;AAGA,EAAA,IAAI,CAAC,mBAAA,CAAoB,IAAA,CAAK,GAAG,CAAA,EAAG;AAClC,IAAA,MAAM,IAAI,MAAM,qFAAqF,CAAA;AAAA,EACvG;AACF;AAMO,SAAS,mBAAmB,KAAA,EAAwB;AACzD,EAAA,IAAI,UAAU,MAAA,EAAW;AACvB,IAAA,OAAO,CAAA;AAAA,EACT;AAEA,EAAA,MAAM,UAAA,GAAa,IAAA,CAAK,SAAA,CAAU,KAAK,CAAA;AAGvC,EAAA,IAAI,OAAO,WAAW,WAAA,EAAa;AACjC,IAAA,OAAO,MAAA,CAAO,UAAA,CAAW,UAAA,EAAY,MAAM,CAAA;AAAA,EAC7C;AAEA,EAAA,OAAO,IAAI,IAAA,CAAK,CAAC,UAAU,CAAC,CAAA,CAAE,IAAA;AAChC;AAKO,SAAS,iBAAA,CACd,KAAA,EACA,MAAA,GAA8B,qBAAA,EACjB;AAEb,EAAA,iBAAA,CAAkB,MAAM,GAAG,CAAA;AAG3B,EAAA,IAAI,KAAA,CAAM,WAAA,CAAY,MAAA,GAAS,MAAA,CAAO,oBAAA,EAAsB;AAC1D,IAAA,MAAM,IAAI,KAAA,CAAM,CAAA,sCAAA,EAAyC,MAAA,CAAO,oBAAoB,CAAA,WAAA,CAAa,CAAA;AAAA,EACnG;AAGA,EAAA,IAAI,KAAA,CAAM,SAAS,gBAAA,CAAiB,KAAA,CAAM,KAAK,CAAA,IAAK,KAAA,CAAM,KAAA,CAAM,IAAA,KAAS,MAAA,EAAQ;AAC/E,IAAA,IAAI,KAAA,CAAM,KAAA,CAAM,OAAA,CAAQ,MAAA,KAAW,CAAA,EAAG;AAGpC,MAAA,OAAA,CAAQ,IAAA,CAAK,CAAA,cAAA,EAAiB,KAAA,CAAM,GAAG,CAAA,kDAAA,CAAoD,CAAA;AAAA,IAC7F;AAAA,EACF;AAEA,EAAA,MAAM,GAAA,GAAM,KAAK,GAAA,EAAI;AACrB,EAAA,MAAM,SAAA,GAAY,kBAAA,CAAmB,KAAA,CAAM,KAAK,CAAA;AAGhD,EAAA,MAAM,MAAA,GAAS,MAAM,MAAA,IAAU,KAAA;AAC/B,EAAA,MAAM,QAAA,GAAW,MAAA,GAAS,UAAA,GAAc,KAAA,CAAM,QAAA,IAAY,QAAA;AAE1D,EAAA,OAAO;AAAA,IACL,KAAK,KAAA,CAAM,GAAA;AAAA,IACX,aAAa,KAAA,CAAM,WAAA;AAAA,IACnB,OAAO,KAAA,CAAM,KAAA;AAAA,IACb,SAAA;AAAA,IACA,KAAA,EAAO,MAAM,KAAA,IAAS,SAAA;AAAA,IACtB,YAAA,EAAc,QAAA;AAAA,IACd,MAAA;AAAA,IACA,SAAA,EAAW,GAAA;AAAA,IACX,cAAA,EAAgB,GAAA;AAAA,IAChB,WAAA,EAAa;AAAA,GACf;AACF;AAKO,SAAS,gBAAgB,KAAA,EAAuB;AACrD,EAAA,IAAI,KAAA,KAAU,GAAG,OAAO,IAAA;AACxB,EAAA,IAAI,KAAA,GAAQ,IAAA,EAAM,OAAO,CAAA,EAAG,KAAK,CAAA,CAAA,CAAA;AAEjC,EAAA,MAAM,KAAK,KAAA,GAAQ,IAAA;AACnB,EAAA,IAAI,KAAA,GAAQ,OAAO,IAAA,EAAM;AAEvB,IAAA,OAAO,CAAA,EAAG,GAAG,OAAA,CAAQ,CAAC,EAAE,OAAA,CAAQ,MAAA,EAAQ,EAAE,CAAC,CAAA,EAAA,CAAA;AAAA,EAC7C;AAEA,EAAA,MAAM,EAAA,GAAK,SAAS,IAAA,GAAO,IAAA,CAAA;AAC3B,EAAA,IAAI,KAAA,GAAQ,IAAA,GAAO,IAAA,GAAO,IAAA,EAAM;AAC9B,IAAA,OAAO,CAAA,EAAG,GAAG,OAAA,CAAQ,CAAC,EAAE,OAAA,CAAQ,MAAA,EAAQ,EAAE,CAAC,CAAA,EAAA,CAAA;AAAA,EAC7C;AAEA,EAAA,MAAM,EAAA,GAAK,KAAA,IAAS,IAAA,GAAO,IAAA,GAAO,IAAA,CAAA;AAClC,EAAA,OAAO,CAAA,EAAG,GAAG,OAAA,CAAQ,CAAC,EAAE,OAAA,CAAQ,MAAA,EAAQ,EAAE,CAAC,CAAA,EAAA,CAAA;AAC7C;AAKA,SAAS,YAAY,KAAA,EAA4B;AAC/C,EAAA,IAAI,aAAA,CAAc,KAAK,CAAA,EAAG;AACxB,IAAA,OAAO,KAAA;AAAA,EACT;AAEA,EAAA,IAAI,KAAA,CAAM,SAAS,MAAA,EAAQ;AACzB,IAAA,OAAO,CAAA,KAAA,EAAQ,KAAA,CAAM,OAAA,CAAQ,IAAA,CAAK,GAAG,CAAC,CAAA,CAAA;AAAA,EACxC;AACA,EAAA,OAAO,KAAA,CAAM,IAAA;AACf;AAKA,SAAS,iBAAiB,KAAA,EAAiC;AACzD,EAAA,MAAM,QAAkB,EAAC;AAEzB,EAAA,IAAI,MAAM,MAAA,EAAQ;AAChB,IAAA,KAAA,CAAM,KAAK,QAAQ,CAAA;AAAA,EACrB,CAAA,MAAA,IAAW,KAAA,CAAM,iBAAA,KAAsB,QAAA,EAAU;AAC/C,IAAA,KAAA,CAAM,IAAA,CAAK,MAAM,iBAAiB,CAAA;AAAA,EACpC;AAEA,EAAA,KAAA,CAAM,IAAA,CAAK,WAAA,CAAY,KAAA,CAAM,KAAK,CAAC,CAAA;AAEnC,EAAA,OAAO,KAAA,CAAM,KAAK,IAAI,CAAA;AACxB;AAKO,SAAS,kBAAkB,KAAA,EAA4B;AAC5D,EAAA,MAAM,QAAkB,EAAC;AAGzB,EAAA,MAAM,cAAc,MAAA,CAAO,SAAA,CAAU,KAAA,CAAM,kBAAkB,IACzD,KAAA,CAAM,kBAAA,CAAmB,QAAA,EAAS,GAClC,MAAM,kBAAA,CAAmB,OAAA,CAAQ,CAAC,CAAA,CAAE,OAAA,CAAQ,QAAQ,EAAE,CAAA;AAE1D,EAAA,KAAA,CAAM,IAAA,CAAK,sBAAsB,KAAA,CAAM,cAAc,MAAM,KAAA,CAAM,UAAU,CAAA,GAAA,EAAM,WAAW,CAAA,EAAA,CAAI,CAAA;AAChG,EAAA,KAAA,CAAM,KAAK,EAAE,CAAA;AAEb,EAAA,IAAI,KAAA,CAAM,OAAA,CAAQ,MAAA,KAAW,CAAA,EAAG;AAC9B,IAAA,KAAA,CAAM,KAAK,kBAAkB,CAAA;AAAA,EAC/B,CAAA,MAAO;AAEL,IAAA,MAAM,SAAS,KAAA,CAAM,OAAA,CAAQ,OAAO,CAAC,CAAA,KAAM,EAAE,MAAM,CAAA;AACnD,IAAA,MAAM,QAAA,GAAW,KAAA,CAAM,OAAA,CAAQ,MAAA,CAAO,CAAC,CAAA,KAAM,CAAC,CAAA,CAAE,MAAA,IAAU,CAAA,CAAE,iBAAA,KAAsB,UAAU,CAAA;AAC5F,IAAA,MAAM,IAAA,GAAO,KAAA,CAAM,OAAA,CAAQ,MAAA,CAAO,CAAC,CAAA,KAAM,CAAC,CAAA,CAAE,MAAA,IAAU,CAAA,CAAE,iBAAA,KAAsB,MAAM,CAAA;AACpF,IAAA,MAAM,MAAA,GAAS,KAAA,CAAM,OAAA,CAAQ,MAAA,CAAO,CAAC,CAAA,KAAM,CAAC,CAAA,CAAE,MAAA,IAAU,CAAA,CAAE,iBAAA,KAAsB,QAAQ,CAAA;AACxF,IAAA,MAAM,GAAA,GAAM,KAAA,CAAM,OAAA,CAAQ,MAAA,CAAO,CAAC,CAAA,KAAM,CAAC,CAAA,CAAE,MAAA,IAAU,CAAA,CAAE,iBAAA,KAAsB,KAAK,CAAA;AAElF,IAAA,IAAI,MAAA,CAAO,SAAS,CAAA,EAAG;AACrB,MAAA,KAAA,CAAM,KAAK,6BAA6B,CAAA;AACxC,MAAA,KAAA,MAAW,SAAS,MAAA,EAAQ;AAC1B,QAAA,KAAA,CAAM,IAAA,CAAK,CAAA,IAAA,EAAO,KAAA,CAAM,GAAG,OAAO,KAAA,CAAM,IAAI,CAAA,GAAA,EAAM,KAAA,CAAM,WAAW,CAAA,EAAA,EAAK,gBAAA,CAAiB,KAAK,CAAC,CAAA,CAAA,CAAG,CAAA;AAAA,MACpG;AACA,MAAA,KAAA,CAAM,KAAK,EAAE,CAAA;AAAA,IACf;AAEA,IAAA,IAAI,QAAA,CAAS,SAAS,CAAA,EAAG;AACvB,MAAA,KAAA,CAAM,KAAK,wBAAwB,CAAA;AACnC,MAAA,KAAA,MAAW,SAAS,QAAA,EAAU;AAC5B,QAAA,KAAA,CAAM,IAAA,CAAK,CAAA,IAAA,EAAO,KAAA,CAAM,GAAG,OAAO,KAAA,CAAM,IAAI,CAAA,GAAA,EAAM,KAAA,CAAM,WAAW,CAAA,EAAA,EAAK,gBAAA,CAAiB,KAAK,CAAC,CAAA,CAAA,CAAG,CAAA;AAAA,MACpG;AACA,MAAA,KAAA,CAAM,KAAK,EAAE,CAAA;AAAA,IACf;AAEA,IAAA,IAAI,IAAA,CAAK,SAAS,CAAA,EAAG;AACnB,MAAA,KAAA,CAAM,KAAK,oBAAoB,CAAA;AAC/B,MAAA,KAAA,MAAW,SAAS,IAAA,EAAM;AACxB,QAAA,KAAA,CAAM,IAAA,CAAK,CAAA,IAAA,EAAO,KAAA,CAAM,GAAG,OAAO,KAAA,CAAM,IAAI,CAAA,GAAA,EAAM,KAAA,CAAM,WAAW,CAAA,EAAA,EAAK,gBAAA,CAAiB,KAAK,CAAC,CAAA,CAAA,CAAG,CAAA;AAAA,MACpG;AACA,MAAA,KAAA,CAAM,KAAK,EAAE,CAAA;AAAA,IACf;AAEA,IAAA,IAAI,MAAA,CAAO,SAAS,CAAA,EAAG;AACrB,MAAA,KAAA,CAAM,KAAK,sBAAsB,CAAA;AACjC,MAAA,KAAA,MAAW,SAAS,MAAA,EAAQ;AAC1B,QAAA,KAAA,CAAM,IAAA,CAAK,CAAA,IAAA,EAAO,KAAA,CAAM,GAAG,OAAO,KAAA,CAAM,IAAI,CAAA,GAAA,EAAM,KAAA,CAAM,WAAW,CAAA,EAAA,EAAK,gBAAA,CAAiB,KAAK,CAAC,CAAA,CAAA,CAAG,CAAA;AAAA,MACpG;AACA,MAAA,KAAA,CAAM,KAAK,EAAE,CAAA;AAAA,IACf;AAEA,IAAA,IAAI,GAAA,CAAI,SAAS,CAAA,EAAG;AAClB,MAAA,KAAA,CAAM,KAAK,mCAAmC,CAAA;AAC9C,MAAA,KAAA,MAAW,SAAS,GAAA,EAAK;AACvB,QAAA,KAAA,CAAM,IAAA,CAAK,CAAA,IAAA,EAAO,KAAA,CAAM,GAAG,OAAO,KAAA,CAAM,IAAI,CAAA,GAAA,EAAM,KAAA,CAAM,WAAW,CAAA,EAAA,EAAK,gBAAA,CAAiB,KAAK,CAAC,CAAA,CAAA,CAAG,CAAA;AAAA,MACpG;AACA,MAAA,KAAA,CAAM,KAAK,EAAE,CAAA;AAAA,IACf;AAGA,IAAA,IAAI,KAAA,CAAM,qBAAqB,EAAA,EAAI;AACjC,MAAA,KAAA,CAAM,KAAK,wEAAwE,CAAA;AACnF,MAAA,KAAA,CAAM,KAAK,EAAE,CAAA;AAAA,IACf;AAAA,EACF;AAEA,EAAA,KAAA,CAAM,KAAK,oDAAoD,CAAA;AAC/D,EAAA,KAAA,CAAM,KAAK,iEAAiE,CAAA;AAE5E,EAAA,OAAO,KAAA,CAAM,KAAK,IAAI,CAAA;AACxB;;;ACxmBO,IAAM,aAAA,GAAN,cAA4BA,YAAAA,CAAyD;AAAA,EAClF,OAAA;AAAA,EACA,MAAA;AAAA,EACA,kBAAA;AAAA,EACA,eAAA;AAAA,EACA,YAAA,GAAe,KAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASvB,WAAA,CACE,OAAA,EACA,MAAA,GAA8B,qBAAA,EAC9B,qBAAyC,wBAAA,EACzC;AACA,IAAA,KAAA,EAAM;AACN,IAAA,IAAA,CAAK,OAAA,GAAU,OAAA;AACf,IAAA,IAAA,CAAK,MAAA,GAAS,MAAA;AACd,IAAA,IAAA,CAAK,kBAAA,GAAqB,kBAAA;AAC1B,IAAA,IAAA,CAAK,kBAAkB,EAAC;AAAA,EAC1B;AAAA;AAAA;AAAA;AAAA,EAKA,sBAAsB,UAAA,EAAsC;AAC1D,IAAA,IAAA,CAAK,kBAAA,GAAqB,UAAA;AAAA,EAC5B;AAAA;AAAA;AAAA;AAAA,EAKA,mBAAmB,OAAA,EAAgC;AACjD,IAAA,IAAA,CAAK,eAAA,GAAkB,OAAA;AAAA,EACzB;AAAA;AAAA;AAAA;AAAA,EAKA,kBAAA,GAAsC;AACpC,IAAA,OAAO,IAAA,CAAK,eAAA;AAAA,EACd;AAAA;AAAA;AAAA;AAAA,EAKQ,yBAAyB,KAAA,EAAoC;AACnE,IAAA,OAAO,IAAA,CAAK,kBAAA,CAAmB,KAAA,EAAO,IAAA,CAAK,eAAe,CAAA;AAAA,EAC5D;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,MAAc,sBAAA,GAAuD;AACnE,IAAA,MAAM,OAAA,GAAU,MAAM,IAAA,CAAK,OAAA,CAAQ,MAAA,EAAO;AAC1C,IAAA,OAAO,OAAA,CAAQ,GAAA,CAAI,CAAC,KAAA,MAAW;AAAA,MAC7B,KAAA;AAAA,MACA,iBAAA,EAAmB,IAAA,CAAK,wBAAA,CAAyB,KAAK;AAAA,KACxD,CAAE,CAAA;AAAA,EACJ;AAAA;AAAA;AAAA;AAAA;AAAA,EAMQ,mBAAA,CACN,qBACA,QAAA,EACqB;AACrB,IAAA,OAAO,oBACJ,MAAA,CAAO,CAAC,EAAE,KAAA,EAAO,mBAAkB,KAAM;AAExC,MAAA,IAAI,KAAA,CAAM,QAAQ,OAAO,KAAA;AAEzB,MAAA,IAAI,iBAAA,KAAsB,YAAY,OAAO,KAAA;AAC7C,MAAA,OAAO,IAAA;AAAA,IACT,CAAC,CAAA,CACA,IAAA,CAAK,CAAC,GAAG,CAAA,KAAM;AAEd,MAAA,MAAM,eACJ,sBAAA,CAAuB,CAAA,CAAE,iBAAiB,CAAA,GAC1C,sBAAA,CAAuB,EAAE,iBAAiB,CAAA;AAC5C,MAAA,IAAI,YAAA,KAAiB,GAAG,OAAO,YAAA;AAG/B,MAAA,IAAI,aAAa,KAAA,EAAO;AACtB,QAAA,OAAO,CAAA,CAAE,KAAA,CAAM,cAAA,GAAiB,CAAA,CAAE,KAAA,CAAM,cAAA;AAAA,MAC1C,CAAA,MAAO;AAEL,QAAA,OAAO,CAAA,CAAE,KAAA,CAAM,SAAA,GAAY,CAAA,CAAE,KAAA,CAAM,SAAA;AAAA,MACrC;AAAA,IACF,CAAC,CAAA;AAAA,EACL;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUA,MAAM,KAAA,CACJ,GAAA,EACA,WAAA,EACA,OACA,OAAA,EAKe;AACf,IAAA,MAAM,KAAA,GAA0B;AAAA,MAC9B,GAAA;AAAA,MACA,WAAA;AAAA,MACA,KAAA;AAAA,MACA,KAAA,EAAO,SAAS,KAAA,IAAS,SAAA;AAAA,MACzB,UAAU,OAAA,EAAS,QAAA;AAAA,MACnB,QAAQ,OAAA,EAAS;AAAA,KACnB;AAGA,IAAA,MAAM,KAAA,GAAQ,iBAAA,CAAkB,KAAA,EAAO,IAAA,CAAK,MAAM,CAAA;AAGlD,IAAA,MAAM,WAAA,GAAc,MAAM,IAAA,CAAK,OAAA,CAAQ,YAAA,EAAa;AACpD,IAAA,MAAM,QAAA,GAAW,MAAM,IAAA,CAAK,OAAA,CAAQ,IAAI,GAAG,CAAA;AAC3C,IAAA,MAAM,YAAA,GAAe,UAAU,SAAA,IAAa,CAAA;AAC5C,IAAA,MAAM,YAAA,GAAe,WAAA,GAAc,YAAA,GAAe,KAAA,CAAM,SAAA;AAExD,IAAA,MAAM,KAAA,GAAQ,KAAK,QAAA,EAAS;AAE5B,IAAA,IAAI,eAAe,KAAA,EAAO;AACxB,MAAA,MAAM,IAAI,KAAA,CAAM,CAAA,uBAAA,EAA0B,YAAY,CAAA,SAAA,EAAY,KAAK,CAAA,MAAA,CAAQ,CAAA;AAAA,IACjF;AAGA,IAAA,MAAM,WAAA,GAAe,eAAe,KAAA,GAAS,GAAA;AAC7C,IAAA,IAAI,WAAA,GAAc,IAAA,CAAK,MAAA,CAAO,gBAAA,EAAkB;AAC9C,MAAA,IAAA,CAAK,IAAA,CAAK,eAAA,EAAiB,EAAE,kBAAA,EAAoB,aAAa,CAAA;AAAA,IAChE;AAGA,IAAA,MAAM,IAAA,CAAK,OAAA,CAAQ,GAAA,CAAI,GAAA,EAAK,KAAK,CAAA;AAEjC,IAAA,IAAA,CAAK,IAAA,CAAK,UAAU,EAAE,GAAA,EAAK,aAAa,KAAA,EAAO,KAAA,CAAM,OAAO,CAAA;AAAA,EAC9D;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,MAAM,aAAA,CACJ,GAAA,EACA,WAAA,EACA,KAAA,EACA,SACA,OAAA,EACe;AACf,IAAA,MAAM,IAAA,CAAK,KAAA,CAAM,GAAA,EAAK,WAAA,EAAa,KAAA,EAAO;AAAA,MACxC,KAAA,EAAO,EAAE,IAAA,EAAM,MAAA,EAAQ,OAAA,EAAQ;AAAA,MAC/B,UAAU,OAAA,EAAS,QAAA;AAAA,MACnB,QAAQ,OAAA,EAAS;AAAA,KAClB,CAAA;AAAA,EACH;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,MAAM,YAAA,CACJ,GAAA,EACA,WAAA,EACA,OACA,OAAA,EACe;AACf,IAAA,MAAM,IAAA,CAAK,KAAA,CAAM,GAAA,EAAK,WAAA,EAAa,KAAA,EAAO;AAAA,MACxC,KAAA,EAAO,EAAE,IAAA,EAAM,MAAA,EAAO;AAAA,MACtB,UAAU,OAAA,EAAS,QAAA;AAAA,MACnB,QAAQ,OAAA,EAAS;AAAA,KAClB,CAAA;AAAA,EACH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,MAAM,SAAS,GAAA,EAA+B;AAC5C,IAAA,MAAM,KAAA,GAAQ,MAAM,IAAA,CAAK,OAAA,CAAQ,IAAI,GAAG,CAAA;AACxC,IAAA,IAAI,CAAC,KAAA,EAAO;AACV,MAAA,OAAO,MAAA;AAAA,IACT;AAGA,IAAA,MAAM,QAAQ,KAAA,CAAM,KAAA;AAIpB,IAAA,MAAM,UAAA,GAAa,MAAM,IAAA,CAAK,OAAA,CAAQ,IAAI,GAAG,CAAA;AAC7C,IAAA,IAAI,UAAA,EAAY;AACd,MAAA,UAAA,CAAW,cAAA,GAAiB,KAAK,GAAA,EAAI;AACrC,MAAA,UAAA,CAAW,WAAA,IAAe,CAAA;AAC1B,MAAA,MAAM,IAAA,CAAK,OAAA,CAAQ,GAAA,CAAI,GAAA,EAAK,UAAU,CAAA;AAAA,IACxC;AAEA,IAAA,IAAA,CAAK,IAAA,CAAK,WAAA,EAAa,EAAE,GAAA,EAAK,CAAA;AAE9B,IAAA,OAAO,KAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,aAAa,IAAA,EAAkD;AACnE,IAAA,MAAM,SAAkC,EAAC;AAEzC,IAAA,KAAA,MAAW,OAAO,IAAA,EAAM;AACtB,MAAA,MAAM,KAAA,GAAQ,MAAM,IAAA,CAAK,QAAA,CAAS,GAAG,CAAA;AACrC,MAAA,IAAI,UAAU,MAAA,EAAW;AACvB,QAAA,MAAA,CAAO,GAAG,CAAA,GAAI,KAAA;AAAA,MAChB;AAAA,IACF;AAEA,IAAA,OAAO,MAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,OAAO,GAAA,EAA4B;AACvC,IAAA,MAAM,IAAA,CAAK,OAAA,CAAQ,MAAA,CAAO,GAAG,CAAA;AAC7B,IAAA,IAAA,CAAK,IAAA,CAAK,SAAA,EAAW,EAAE,GAAA,EAAK,CAAA;AAAA,EAC9B;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,IAAI,GAAA,EAA+B;AACvC,IAAA,OAAO,IAAA,CAAK,OAAA,CAAQ,GAAA,CAAI,GAAG,CAAA;AAAA,EAC7B;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,MAAM,QAAQ,GAAA,EAA4B;AACxC,IAAA,MAAM,KAAA,GAAQ,MAAM,IAAA,CAAK,OAAA,CAAQ,IAAI,GAAG,CAAA;AACxC,IAAA,IAAI,CAAC,KAAA,EAAO;AACV,MAAA,MAAM,IAAI,KAAA,CAAM,CAAA,KAAA,EAAQ,GAAG,CAAA,qBAAA,CAAuB,CAAA;AAAA,IACpD;AAGA,IAAA,MAAM,YAAA,GAAe,aAAA,CAAc,KAAA,CAAM,KAAK,IAC1C,KAAA,CAAM,KAAA,KAAU,YAAA,GAChB,gBAAA,CAAiB,KAAA,CAAM,KAAK,CAAA,IAAK,KAAA,CAAM,MAAM,IAAA,KAAS,YAAA;AAE1D,IAAA,IAAI,CAAC,YAAA,EAAc;AACjB,MAAA,KAAA,CAAM,KAAA,GAAQ,EAAE,IAAA,EAAM,YAAA,EAAa;AACnC,MAAA,MAAM,IAAA,CAAK,OAAA,CAAQ,GAAA,CAAI,GAAA,EAAK,KAAK,CAAA;AAAA,IACnC;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,IAAI,GAAA,EAA4B;AACpC,IAAA,MAAM,KAAA,GAAQ,MAAM,IAAA,CAAK,OAAA,CAAQ,IAAI,GAAG,CAAA;AACxC,IAAA,IAAI,CAAC,KAAA,EAAO;AACV,MAAA,MAAM,IAAI,KAAA,CAAM,CAAA,KAAA,EAAQ,GAAG,CAAA,qBAAA,CAAuB,CAAA;AAAA,IACpD;AAEA,IAAA,IAAI,CAAC,MAAM,MAAA,EAAQ;AACjB,MAAA,KAAA,CAAM,MAAA,GAAS,IAAA;AACf,MAAA,KAAA,CAAM,YAAA,GAAe,UAAA;AACrB,MAAA,MAAM,IAAA,CAAK,OAAA,CAAQ,GAAA,CAAI,GAAA,EAAK,KAAK,CAAA;AAAA,IACnC;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,KAAA,CAAM,GAAA,EAAa,WAAA,GAA8B,QAAA,EAAyB;AAC9E,IAAA,MAAM,KAAA,GAAQ,MAAM,IAAA,CAAK,OAAA,CAAQ,IAAI,GAAG,CAAA;AACxC,IAAA,IAAI,CAAC,KAAA,EAAO;AACV,MAAA,MAAM,IAAI,KAAA,CAAM,CAAA,KAAA,EAAQ,GAAG,CAAA,qBAAA,CAAuB,CAAA;AAAA,IACpD;AAEA,IAAA,IAAI,MAAM,MAAA,EAAQ;AAChB,MAAA,KAAA,CAAM,MAAA,GAAS,KAAA;AACf,MAAA,KAAA,CAAM,YAAA,GAAe,WAAA;AACrB,MAAA,MAAM,IAAA,CAAK,OAAA,CAAQ,GAAA,CAAI,GAAA,EAAK,KAAK,CAAA;AAAA,IACnC;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,WAAA,CAAY,GAAA,EAAa,QAAA,EAAyC;AACtE,IAAA,MAAM,KAAA,GAAQ,MAAM,IAAA,CAAK,OAAA,CAAQ,IAAI,GAAG,CAAA;AACxC,IAAA,IAAI,CAAC,KAAA,EAAO;AACV,MAAA,MAAM,IAAI,KAAA,CAAM,CAAA,KAAA,EAAQ,GAAG,CAAA,qBAAA,CAAuB,CAAA;AAAA,IACpD;AAEA,IAAA,KAAA,CAAM,YAAA,GAAe,QAAA;AACrB,IAAA,MAAM,IAAA,CAAK,OAAA,CAAQ,GAAA,CAAI,GAAA,EAAK,KAAK,CAAA;AAAA,EACnC;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,WAAA,CAAY,GAAA,EAAa,KAAA,EAAmC;AAChE,IAAA,MAAM,KAAA,GAAQ,MAAM,IAAA,CAAK,OAAA,CAAQ,IAAI,GAAG,CAAA;AACxC,IAAA,IAAI,CAAC,KAAA,EAAO;AACV,MAAA,MAAM,IAAI,KAAA,CAAM,CAAA,KAAA,EAAQ,GAAG,CAAA,qBAAA,CAAuB,CAAA;AAAA,IACpD;AAEA,IAAA,KAAA,CAAM,KAAA,GAAQ,KAAA;AACd,IAAA,MAAM,IAAA,CAAK,OAAA,CAAQ,GAAA,CAAI,GAAA,EAAK,KAAK,CAAA;AAAA,EACnC;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,MAAM,eAAA,CAAgB,GAAA,EAAa,OAAA,EAAkC;AACnE,IAAA,MAAM,KAAA,GAAQ,MAAM,IAAA,CAAK,OAAA,CAAQ,IAAI,GAAG,CAAA;AACxC,IAAA,IAAI,CAAC,KAAA,EAAO;AACV,MAAA,MAAM,IAAI,KAAA,CAAM,CAAA,KAAA,EAAQ,GAAG,CAAA,qBAAA,CAAuB,CAAA;AAAA,IACpD;AAEA,IAAA,IAAI,iBAAiB,KAAA,CAAM,KAAK,KAAK,KAAA,CAAM,KAAA,CAAM,SAAS,MAAA,EAAQ;AAEhE,MAAA,MAAM,WAAA,GAAc,IAAI,GAAA,CAAI,KAAA,CAAM,MAAM,OAAO,CAAA;AAC/C,MAAA,KAAA,MAAW,MAAM,OAAA,EAAS;AACxB,QAAA,WAAA,CAAY,IAAI,EAAE,CAAA;AAAA,MACpB;AACA,MAAA,KAAA,CAAM,KAAA,GAAQ,EAAE,IAAA,EAAM,MAAA,EAAQ,SAAS,KAAA,CAAM,IAAA,CAAK,WAAW,CAAA,EAAE;AAAA,IACjE,CAAA,MAAO;AAEL,MAAA,KAAA,CAAM,KAAA,GAAQ,EAAE,IAAA,EAAM,MAAA,EAAQ,OAAA,EAAQ;AAAA,IACxC;AAEA,IAAA,MAAM,IAAA,CAAK,OAAA,CAAQ,GAAA,CAAI,GAAA,EAAK,KAAK,CAAA;AAAA,EACnC;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,WAAW,KAAA,EAAmC;AAClD,IAAA,MAAM,IAAA,CAAK,OAAA,CAAQ,UAAA,CAAW,KAAK,CAAA;AAAA,EACrC;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,KAAA,GAAuB;AAC3B,IAAA,MAAM,IAAA,CAAK,QAAQ,KAAA,EAAM;AAAA,EAC3B;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,QAAA,GAAiC;AACrC,IAAA,MAAM,mBAAA,GAAsB,MAAM,IAAA,CAAK,sBAAA,EAAuB;AAC9D,IAAA,MAAM,cAAA,GAAiB,MAAM,IAAA,CAAK,OAAA,CAAQ,YAAA,EAAa;AACvD,IAAA,MAAM,UAAA,GAAa,KAAK,QAAA,EAAS;AAGjC,IAAA,MAAM,aAAA,GAAgB,CAAC,GAAG,mBAAmB,EAAE,IAAA,CAAK,CAAC,GAAG,CAAA,KAAM;AAE5D,MAAA,IAAI,EAAE,KAAA,CAAM,MAAA,IAAU,CAAC,CAAA,CAAE,KAAA,CAAM,QAAQ,OAAO,EAAA;AAC9C,MAAA,IAAI,CAAC,CAAA,CAAE,KAAA,CAAM,UAAU,CAAA,CAAE,KAAA,CAAM,QAAQ,OAAO,CAAA;AAG9C,MAAA,MAAM,eACJ,sBAAA,CAAuB,CAAA,CAAE,iBAAiB,CAAA,GAC1C,sBAAA,CAAuB,EAAE,iBAAiB,CAAA;AAC5C,MAAA,IAAI,YAAA,KAAiB,GAAG,OAAO,YAAA;AAG/B,MAAA,OAAO,CAAA,CAAE,KAAA,CAAM,cAAA,GAAiB,CAAA,CAAE,KAAA,CAAM,cAAA;AAAA,IAC1C,CAAC,CAAA;AAED,IAAA,MAAM,eAAe,aAAA,CAAc,GAAA,CAAI,CAAC,EAAE,KAAA,EAAO,mBAAkB,MAAO;AAAA,MACxE,KAAK,KAAA,CAAM,GAAA;AAAA,MACX,aAAa,KAAA,CAAM,WAAA;AAAA,MACnB,IAAA,EAAM,eAAA,CAAgB,KAAA,CAAM,SAAS,CAAA;AAAA,MACrC,OAAO,KAAA,CAAM,KAAA;AAAA,MACb,iBAAA;AAAA,MACA,QAAQ,KAAA,CAAM;AAAA,KAChB,CAAE,CAAA;AAEF,IAAA,OAAO;AAAA,MACL,OAAA,EAAS,YAAA;AAAA,MACT,cAAA;AAAA,MACA,cAAA,EAAgB,gBAAgB,cAAc,CAAA;AAAA,MAC9C,UAAA;AAAA,MACA,UAAA,EAAY,gBAAgB,UAAU,CAAA;AAAA,MACtC,kBAAA,EAAqB,iBAAiB,UAAA,GAAc;AAAA,KACtD;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,WAAA,GAA+B;AACnC,IAAA,MAAM,KAAA,GAAQ,MAAM,IAAA,CAAK,QAAA,EAAS;AAClC,IAAA,OAAO,kBAAkB,KAAK,CAAA;AAAA,EAChC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAcA,MAAM,KAAA,CAAM,KAAA,EAAe,QAAA,GAA6B,KAAA,EAA0B;AAChF,IAAA,MAAM,mBAAA,GAAsB,MAAM,IAAA,CAAK,sBAAA,EAAuB;AAC9D,IAAA,MAAM,SAAA,GAAY,IAAA,CAAK,mBAAA,CAAoB,mBAAA,EAAqB,QAAQ,CAAA;AAExE,IAAA,MAAM,OAAA,GAAU,SAAA,CAAU,KAAA,CAAM,CAAA,EAAG,KAAK,CAAA;AACxC,IAAA,MAAM,cAAwB,EAAC;AAE/B,IAAA,KAAA,MAAW,EAAE,KAAA,EAAM,IAAK,OAAA,EAAS;AAC/B,MAAA,MAAM,IAAA,CAAK,OAAA,CAAQ,MAAA,CAAO,KAAA,CAAM,GAAG,CAAA;AACnC,MAAA,WAAA,CAAY,IAAA,CAAK,MAAM,GAAG,CAAA;AAAA,IAC5B;AAEA,IAAA,IAAI,WAAA,CAAY,SAAS,CAAA,EAAG;AAC1B,MAAA,IAAA,CAAK,KAAK,SAAA,EAAW,EAAE,MAAM,WAAA,EAAa,MAAA,EAAQ,UAAU,CAAA;AAAA,IAC9D;AAEA,IAAA,OAAO,WAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,MAAM,SAAS,KAAA,EAAkC;AAC/C,IAAA,OAAO,IAAA,CAAK,KAAA,CAAM,KAAA,EAAO,KAAK,CAAA;AAAA,EAChC;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,MAAM,YAAY,KAAA,EAAkC;AAClD,IAAA,OAAO,IAAA,CAAK,KAAA,CAAM,KAAA,EAAO,MAAM,CAAA;AAAA,EACjC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAcA,MAAM,cAAA,CACJ,MAAA,EACA,UAAA,EAC2B;AAE3B,IAAA,IAAA,CAAK,gBAAgB,UAAA,GAAa,UAAA;AAGlC,IAAA,MAAM,OAAA,GAAU,MAAM,IAAA,CAAK,OAAA,CAAQ,MAAA,EAAO;AAG1C,IAAA,MAAM,YAAA,GAAe,kBAAA,CAAmB,OAAA,EAAS,MAAA,EAAQ,UAAU,CAAA;AAGnE,IAAA,IAAI,YAAA,CAAa,SAAS,CAAA,EAAG;AAC3B,MAAA,IAAA,CAAK,IAAA,CAAK,eAAA,EAAiB,EAAE,OAAA,EAAS,cAAc,CAAA;AAAA,IACtD;AAEA,IAAA,OAAO,YAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAWA,MAAM,0BACJ,UAAA,EACmB;AACnB,IAAA,MAAM,OAAA,GAAU,MAAM,IAAA,CAAK,OAAA,CAAQ,MAAA,EAAO;AAC1C,IAAA,MAAM,cAAwB,EAAC;AAE/B,IAAA,KAAA,MAAW,SAAS,OAAA,EAAS;AAE3B,MAAA,IAAI,MAAM,MAAA,EAAQ;AAGlB,MAAA,IAAI,CAAC,iBAAiB,KAAA,CAAM,KAAK,KAAK,KAAA,CAAM,KAAA,CAAM,SAAS,MAAA,EAAQ;AAGnE,MAAA,MAAM,cAAc,KAAA,CAAM,KAAA,CAAM,OAAA,CAAQ,KAAA,CAAM,CAAC,MAAA,KAAW;AACxD,QAAA,MAAM,MAAA,GAAS,UAAA,CAAW,GAAA,CAAI,MAAM,CAAA;AACpC,QAAA,OAAO,MAAA,GAAS,sBAAA,CAAuB,MAAM,CAAA,GAAI,KAAA;AAAA,MACnD,CAAC,CAAA;AAED,MAAA,IAAI,WAAA,EAAa;AACf,QAAA,MAAM,IAAA,CAAK,OAAA,CAAQ,MAAA,CAAO,KAAA,CAAM,GAAG,CAAA;AACnC,QAAA,WAAA,CAAY,IAAA,CAAK,MAAM,GAAG,CAAA;AAAA,MAC5B;AAAA,IACF;AAEA,IAAA,IAAI,WAAA,CAAY,SAAS,CAAA,EAAG;AAC1B,MAAA,IAAA,CAAK,KAAK,SAAA,EAAW,EAAE,MAAM,WAAA,EAAa,MAAA,EAAQ,kBAAkB,CAAA;AAAA,IACtE;AAEA,IAAA,OAAO,WAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,SAAA,GAAiC;AAC/B,IAAA,OAAO;AAAA,MACL,GAAA,EAAK,OAAO,GAAA,KAAgB,IAAA,CAAK,SAAS,GAAG,CAAA;AAAA,MAC7C,GAAA,EAAK,OAAO,GAAA,EAAa,WAAA,EAAqB,KAAA,EAAgB,OAAA,KAIxD,IAAA,CAAK,KAAA,CAAM,GAAA,EAAK,WAAA,EAAa,KAAA,EAAO,OAAO,CAAA;AAAA,MACjD,MAAA,EAAQ,OAAO,GAAA,KAAgB,IAAA,CAAK,OAAO,GAAG,CAAA;AAAA,MAC9C,GAAA,EAAK,OAAO,GAAA,KAAgB,IAAA,CAAK,IAAI,GAAG,CAAA;AAAA,MACxC,MAAM,YAAY;AAChB,QAAA,MAAM,KAAA,GAAQ,MAAM,IAAA,CAAK,QAAA,EAAS;AAClC,QAAA,OAAO,KAAA,CAAM,OAAA,CAAQ,GAAA,CAAI,CAAC,CAAA,MAAO;AAAA,UAC/B,KAAK,CAAA,CAAE,GAAA;AAAA,UACP,aAAa,CAAA,CAAE,WAAA;AAAA,UACf,mBAAmB,CAAA,CAAE,iBAAA;AAAA,UACrB,QAAQ,CAAA,CAAE;AAAA,SACZ,CAAE,CAAA;AAAA,MACJ;AAAA,KACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAiBA,MAAM,QAAA,CACJ,GAAA,EACA,WAAA,EACA,OACA,OAAA,EACe;AACf,IAAA,MAAM,OAAA,GAAU,aAAA,CAAc,GAAA,EAAK,KAAK,CAAA;AACxC,IAAA,MAAM,KAAA,GAAQ,OAAA,EAAS,OAAA,GACnB,EAAE,IAAA,EAAM,MAAA,EAAiB,OAAA,EAAS,OAAA,CAAQ,OAAA,EAAQ,GAClD,OAAA,EAAS,KAAA,IAAS,SAAA;AAEtB,IAAA,MAAM,IAAA,CAAK,KAAA,CAAM,OAAA,EAAS,WAAA,EAAa,KAAA,EAAO;AAAA,MAC5C,KAAA;AAAA,MACA,UAAU,eAAA,CAAgB;AAAA,KAC3B,CAAA;AAAA,EACH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAcA,MAAM,YAAA,CACJ,GAAA,EACA,WAAA,EACA,KAAA,EACA,aACA,OAAA,EACe;AACf,IAAA,MAAM,OAAA,GAAU,aAAA,CAAc,GAAA,EAAK,SAAS,CAAA;AAC5C,IAAA,MAAM,aAAa,KAAA,CAAM,OAAA,CAAQ,WAAW,CAAA,GAAI,WAAA,GAAc,CAAC,WAAW,CAAA;AAC1E,IAAA,MAAM,KAAA,GAAQ,OAAA,EAAS,OAAA,GACnB,EAAE,MAAM,MAAA,EAAiB,OAAA,EAAS,OAAA,CAAQ,OAAA,EAAQ,GAClD,OAAA,EAAS,KAAA,IAAS,EAAE,MAAM,MAAA,EAAgB;AAE9C,IAAA,MAAM,IAAA,CAAK,KAAA,CAAM,OAAA,EAAS,WAAA,EAAa,KAAA,EAAO;AAAA,MAC5C,KAAA;AAAA,MACA,UAAU,eAAA,CAAgB;AAAA,KAC3B,CAAA;AAGD,IAAA,KAAA,MAAW,aAAa,UAAA,EAAY;AAClC,MAAA,IAAI;AACF,QAAA,MAAM,WAAA,GAAc,MAAM,IAAA,CAAK,OAAA,CAAQ,IAAI,SAAS,CAAA;AACpD,QAAA,IAAI,WAAA,EAAa;AACf,UAAA,MAAM,QAAA,GAAY,YAAY,KAAA,EAAmC,QAAA;AACjE,UAAA,MAAM,iBAAA,GAAoB,QAAA,EAAU,SAAA,IAAa,EAAC;AAClD,UAAA,IAAI,CAAC,iBAAA,CAAkB,QAAA,CAAS,OAAO,CAAA,EAAG;AAAA,UAG1C;AAAA,QACF;AAAA,MACF,CAAA,CAAA,MAAQ;AAAA,MAER;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAcA,MAAM,aAAA,CACJ,GAAA,EACA,WAAA,EACA,KAAA,EACA,cACA,OAAA,EACe;AACf,IAAA,MAAM,OAAA,GAAU,aAAA,CAAc,GAAA,EAAK,UAAU,CAAA;AAC7C,IAAA,MAAM,KAAA,GAAQ,OAAA,EAAS,KAAA,IAAS,EAAE,MAAM,MAAA,EAAgB;AAGxD,IAAA,MAAM,IAAA,CAAK,KAAA,CAAM,OAAA,EAAS,WAAA,EAAa,KAAA,EAAO;AAAA,MAC5C,KAAA;AAAA,MACA,UAAU,eAAA,CAAgB,QAAA;AAAA,MAC1B,QAAQ,OAAA,EAAS;AAAA,KAClB,CAAA;AAAA,EACH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAWA,MAAM,eAAe,eAAA,EAA4C;AAC/D,IAAA,IAAI,YAAA,GAAe,CAAA;AAEnB,IAAA,KAAA,MAAW,OAAO,eAAA,EAAiB;AAEjC,MAAA,MAAM,IAAA,GAAO,eAAe,GAAG,CAAA;AAC/B,MAAA,IAAI,SAAS,KAAA,EAAO;AAClB,QAAA,MAAM,MAAA,GAAS,MAAM,IAAA,CAAK,GAAA,CAAI,GAAG,CAAA;AACjC,QAAA,IAAI,MAAA,EAAQ;AACV,UAAA,MAAM,IAAA,CAAK,OAAO,GAAG,CAAA;AACrB,UAAA,YAAA,EAAA;AAAA,QACF;AAAA,MACF;AAAA,IACF;AAEA,IAAA,OAAO,YAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,MAAM,UAAU,IAAA,EAA0C;AACxD,IAAA,MAAM,OAAA,GAAU,MAAM,IAAA,CAAK,OAAA,CAAQ,MAAA,EAAO;AAC1C,IAAA,MAAM,MAAA,GAAS,kBAAkB,IAAI,CAAA;AACrC,IAAA,OAAO,OAAA,CAAQ,OAAO,CAAC,CAAA,KAAM,EAAE,GAAA,CAAI,UAAA,CAAW,MAAM,CAAC,CAAA;AAAA,EACvD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAYA,MAAM,OAAA,CAAQ,GAAA,EAAa,MAAA,EAAqC;AAC9D,IAAA,MAAM,WAAA,GAAc,eAAe,GAAG,CAAA;AACtC,IAAA,IAAI,gBAAgB,MAAA,EAAQ;AAC1B,MAAA,OAAO,GAAA;AAAA,IACT;AAEA,IAAA,MAAM,KAAA,GAAQ,MAAM,IAAA,CAAK,OAAA,CAAQ,IAAI,GAAG,CAAA;AACxC,IAAA,IAAI,CAAC,KAAA,EAAO;AACV,MAAA,MAAM,IAAI,KAAA,CAAM,CAAA,KAAA,EAAQ,GAAG,CAAA,qBAAA,CAAuB,CAAA;AAAA,IACpD;AAGA,IAAA,MAAM,MAAA,GAAS,aAAA,CAAc,GAAA,EAAK,MAAM,CAAA;AACxC,IAAA,MAAM,WAAA,GAAc,gBAAgB,MAAM,CAAA;AAG1C,IAAA,MAAM,KAAK,KAAA,CAAM,MAAA,EAAQ,KAAA,CAAM,WAAA,EAAa,MAAM,KAAA,EAAO;AAAA,MACvD,OAAO,KAAA,CAAM,KAAA;AAAA,MACb,QAAA,EAAU,WAAA;AAAA,MACV,QAAQ,KAAA,CAAM;AAAA,KACf,CAAA;AAGD,IAAA,MAAM,IAAA,CAAK,OAAO,GAAG,CAAA;AAErB,IAAA,OAAO,MAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,MAAM,YAAA,GAAkF;AACtF,IAAA,MAAM,OAAA,GAAU,MAAM,IAAA,CAAK,OAAA,CAAQ,MAAA,EAAO;AAC1C,IAAA,MAAM,KAAA,GAAkE;AAAA,MACtE,GAAA,EAAK,EAAE,KAAA,EAAO,CAAA,EAAG,WAAW,CAAA,EAAE;AAAA,MAC9B,OAAA,EAAS,EAAE,KAAA,EAAO,CAAA,EAAG,WAAW,CAAA,EAAE;AAAA,MAClC,QAAA,EAAU,EAAE,KAAA,EAAO,CAAA,EAAG,WAAW,CAAA;AAAE,KACrC;AAEA,IAAA,KAAA,MAAW,SAAS,OAAA,EAAS;AAC3B,MAAA,MAAM,IAAA,GAAO,cAAA,CAAe,KAAA,CAAM,GAAG,CAAA;AACrC,MAAA,IAAI,IAAA,EAAM;AACR,QAAA,KAAA,CAAM,IAAI,CAAA,CAAE,KAAA,EAAA;AACZ,QAAA,KAAA,CAAM,IAAI,CAAA,CAAE,SAAA,IAAa,KAAA,CAAM,SAAA;AAAA,MACjC;AAAA,IACF;AAEA,IAAA,OAAO,KAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,QAAA,GAMH;AACD,IAAA,MAAM,mBAAA,GAAsB,MAAM,IAAA,CAAK,sBAAA,EAAuB;AAC9D,IAAA,MAAM,cAAA,GAAiB,MAAM,IAAA,CAAK,OAAA,CAAQ,YAAA,EAAa;AACvD,IAAA,MAAM,KAAA,GAAQ,KAAK,QAAA,EAAS;AAE5B,IAAA,MAAM,UAAA,GAA6C;AAAA,MACjD,QAAA,EAAU,CAAA;AAAA,MACV,IAAA,EAAM,CAAA;AAAA,MACN,MAAA,EAAQ,CAAA;AAAA,MACR,GAAA,EAAK;AAAA,KACP;AAEA,IAAA,IAAI,WAAA,GAAc,CAAA;AAElB,IAAA,KAAA,MAAW,EAAE,KAAA,EAAO,iBAAA,EAAkB,IAAK,mBAAA,EAAqB;AAC9D,MAAA,UAAA,CAAW,iBAAiB,CAAA,EAAA;AAC5B,MAAA,IAAI,MAAM,MAAA,EAAQ,WAAA,EAAA;AAAA,IACpB;AAEA,IAAA,OAAO;AAAA,MACL,cAAc,mBAAA,CAAoB,MAAA;AAAA,MAClC,cAAA;AAAA,MACA,kBAAA,EAAqB,iBAAiB,KAAA,GAAS,GAAA;AAAA,MAC/C,UAAA;AAAA,MACA;AAAA,KACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,QAAA,GAAmB;AACjB,IAAA,OAAO,IAAA,CAAK,MAAA,CAAO,YAAA,IAAgB,EAAA,GAAK,IAAA,GAAO,IAAA;AAAA,EACjD;AAAA;AAAA;AAAA;AAAA,EAKA,IAAI,WAAA,GAAuB;AACzB,IAAA,OAAO,IAAA,CAAK,YAAA;AAAA,EACd;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,OAAA,GAAgB;AACd,IAAA,IAAI,KAAK,YAAA,EAAc;AACvB,IAAA,IAAA,CAAK,YAAA,GAAe,IAAA;AACpB,IAAA,IAAA,CAAK,kBAAA,EAAmB;AACxB,IAAA,IAAA,CAAK,kBAAkB,EAAC;AAAA,EAC1B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAcA,MAAM,SAAA,GAAuC;AAC3C,IAAA,MAAM,OAAA,GAAU,MAAM,IAAA,CAAK,OAAA,CAAQ,MAAA,EAAO;AAE1C,IAAA,MAAM,iBAAA,GAA6C,OAAA,CAAQ,GAAA,CAAI,CAAC,KAAA,MAAW;AAAA,MACzE,KAAK,KAAA,CAAM,GAAA;AAAA,MACX,aAAa,KAAA,CAAM,WAAA;AAAA,MACnB,OAAO,KAAA,CAAM,KAAA;AAAA,MACb,OAAO,KAAA,CAAM,KAAA;AAAA,MACb,WAAW,KAAA,CAAM,SAAA;AAAA,MACjB,cAAc,KAAA,CAAM,YAAA;AAAA,MACpB,QAAQ,KAAA,CAAM;AAAA;AAAA;AAAA,KAGhB,CAAE,CAAA;AAEF,IAAA,OAAO;AAAA,MACL,OAAA,EAAS,CAAA;AAAA,MACT,OAAA,EAAS;AAAA,KACX;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUA,MAAM,QAAQ,KAAA,EAAwC;AAEpD,IAAA,IAAI,KAAA,CAAM,YAAY,CAAA,EAAG;AACvB,MAAA,MAAM,IAAI,KAAA,CAAM,CAAA,0CAAA,EAA6C,KAAA,CAAM,OAAO,CAAA,CAAE,CAAA;AAAA,IAC9E;AAGA,IAAA,MAAM,IAAA,CAAK,QAAQ,KAAA,EAAM;AAGzB,IAAA,MAAM,GAAA,GAAM,KAAK,GAAA,EAAI;AACrB,IAAA,KAAA,MAAW,KAAA,IAAS,MAAM,OAAA,EAAS;AACjC,MAAA,MAAM,SAAA,GAAyB;AAAA,QAC7B,KAAK,KAAA,CAAM,GAAA;AAAA,QACX,aAAa,KAAA,CAAM,WAAA;AAAA,QACnB,OAAO,KAAA,CAAM,KAAA;AAAA,QACb,OAAO,KAAA,CAAM,KAAA;AAAA,QACb,WAAW,KAAA,CAAM,SAAA;AAAA,QACjB,YAAA,EAAc,MAAM,YAAA,IAAgB,QAAA;AAAA,QACpC,MAAA,EAAQ,MAAM,MAAA,IAAU,KAAA;AAAA,QACxB,SAAA,EAAW,GAAA;AAAA,QACX,cAAA,EAAgB,GAAA;AAAA,QAChB,WAAA,EAAa;AAAA,OACf;AAEA,MAAA,MAAM,IAAA,CAAK,OAAA,CAAQ,GAAA,CAAI,KAAA,CAAM,KAAK,SAAS,CAAA;AAAA,IAC7C;AAAA,EACF;AACF;;;ACr+BO,IAAM,kBAAN,MAAgD;AAAA,EAC7C,KAAA,uBAAY,GAAA,EAAyB;AAAA,EAE7C,MAAM,IAAI,GAAA,EAA+C;AACvD,IAAA,OAAO,IAAA,CAAK,KAAA,CAAM,GAAA,CAAI,GAAG,CAAA;AAAA,EAC3B;AAAA,EAEA,MAAM,GAAA,CAAI,GAAA,EAAa,KAAA,EAAmC;AACxD,IAAA,IAAA,CAAK,KAAA,CAAM,GAAA,CAAI,GAAA,EAAK,KAAK,CAAA;AAAA,EAC3B;AAAA,EAEA,MAAM,OAAO,GAAA,EAA4B;AACvC,IAAA,IAAA,CAAK,KAAA,CAAM,OAAO,GAAG,CAAA;AAAA,EACvB;AAAA,EAEA,MAAM,IAAI,GAAA,EAA+B;AACvC,IAAA,OAAO,IAAA,CAAK,KAAA,CAAM,GAAA,CAAI,GAAG,CAAA;AAAA,EAC3B;AAAA,EAEA,MAAM,MAAA,GAAiC;AACrC,IAAA,OAAO,KAAA,CAAM,IAAA,CAAK,IAAA,CAAK,KAAA,CAAM,QAAQ,CAAA;AAAA,EACvC;AAAA,EAEA,MAAM,WAAW,KAAA,EAA4C;AAC3D,IAAA,OAAO,KAAA,CAAM,IAAA,CAAK,IAAA,CAAK,KAAA,CAAM,QAAQ,CAAA,CAAE,MAAA,CAAO,CAAC,KAAA,KAAU,YAAA,CAAa,KAAA,CAAM,KAAA,EAAO,KAAK,CAAC,CAAA;AAAA,EAC3F;AAAA,EAEA,MAAM,WAAW,KAAA,EAAmC;AAClD,IAAA,MAAM,WAAqB,EAAC;AAC5B,IAAA,KAAA,MAAW,CAAC,GAAA,EAAK,KAAK,KAAK,IAAA,CAAK,KAAA,CAAM,SAAQ,EAAG;AAC/C,MAAA,IAAI,YAAA,CAAa,KAAA,CAAM,KAAA,EAAO,KAAK,CAAA,EAAG;AACpC,QAAA,QAAA,CAAS,KAAK,GAAG,CAAA;AAAA,MACnB;AAAA,IACF;AACA,IAAA,KAAA,MAAW,OAAO,QAAA,EAAU;AAC1B,MAAA,IAAA,CAAK,KAAA,CAAM,OAAO,GAAG,CAAA;AAAA,IACvB;AAAA,EACF;AAAA,EAEA,MAAM,KAAA,GAAuB;AAC3B,IAAA,IAAA,CAAK,MAAM,KAAA,EAAM;AAAA,EACnB;AAAA,EAEA,MAAM,YAAA,GAAgC;AACpC,IAAA,IAAI,KAAA,GAAQ,CAAA;AACZ,IAAA,KAAA,MAAW,KAAA,IAAS,IAAA,CAAK,KAAA,CAAM,MAAA,EAAO,EAAG;AACvC,MAAA,KAAA,IAAS,KAAA,CAAM,SAAA;AAAA,IACjB;AACA,IAAA,OAAO,KAAA;AAAA,EACT;AACF;AAKO,IAAM,sBAAN,MAAkD;AAAA,EAC/C,KAAA,uBAAY,GAAA,EAAkB;AAAA,EAEtC,MAAM,SAAS,IAAA,EAA2B;AAExC,IAAA,IAAA,CAAK,KAAA,CAAM,GAAA,CAAI,IAAA,CAAK,EAAA,EAAI,IAAA,CAAK,MAAM,IAAA,CAAK,SAAA,CAAU,IAAI,CAAC,CAAC,CAAA;AAAA,EAC1D;AAAA,EAEA,MAAM,QAAQ,MAAA,EAA2C;AACvD,IAAA,MAAM,IAAA,GAAO,IAAA,CAAK,KAAA,CAAM,GAAA,CAAI,MAAM,CAAA;AAClC,IAAA,OAAO,OAAO,IAAA,CAAK,KAAA,CAAM,KAAK,SAAA,CAAU,IAAI,CAAC,CAAA,GAAI,MAAA;AAAA,EACnD;AAAA,EAEA,MAAM,UAAA,CAAW,MAAA,EAAgB,IAAA,EAA2B;AAC1D,IAAA,MAAM,IAAA,GAAO,IAAA,CAAK,KAAA,CAAM,GAAA,CAAI,MAAM,CAAA;AAClC,IAAA,IAAI,CAAC,IAAA,EAAM;AACT,MAAA,MAAM,IAAI,KAAA,CAAM,CAAA,KAAA,EAAQ,MAAM,CAAA,UAAA,CAAY,CAAA;AAAA,IAC5C;AAEA,IAAA,MAAM,SAAA,GAAY,KAAK,KAAA,CAAM,SAAA,CAAU,CAAC,CAAA,KAAM,CAAA,CAAE,EAAA,KAAO,IAAA,CAAK,EAAE,CAAA;AAC9D,IAAA,IAAI,cAAc,EAAA,EAAI;AACpB,MAAA,MAAM,IAAI,KAAA,CAAM,CAAA,KAAA,EAAQ,KAAK,EAAE,CAAA,mBAAA,EAAsB,MAAM,CAAA,CAAE,CAAA;AAAA,IAC/D;AAEA,IAAA,IAAA,CAAK,KAAA,CAAM,SAAS,CAAA,GAAI,IAAA,CAAK,MAAM,IAAA,CAAK,SAAA,CAAU,IAAI,CAAC,CAAA;AAAA,EACzD;AAAA,EAEA,MAAM,OAAA,CAAQ,MAAA,EAAgB,IAAA,EAA2B;AACvD,IAAA,MAAM,IAAA,GAAO,IAAA,CAAK,KAAA,CAAM,GAAA,CAAI,MAAM,CAAA;AAClC,IAAA,IAAI,CAAC,IAAA,EAAM;AACT,MAAA,MAAM,IAAI,KAAA,CAAM,CAAA,KAAA,EAAQ,MAAM,CAAA,UAAA,CAAY,CAAA;AAAA,IAC5C;AAEA,IAAA,IAAA,CAAK,KAAA,CAAM,KAAK,IAAA,CAAK,KAAA,CAAM,KAAK,SAAA,CAAU,IAAI,CAAC,CAAC,CAAA;AAAA,EAClD;AAAA,EAEA,MAAM,WAAW,MAAA,EAA+B;AAC9C,IAAA,IAAA,CAAK,KAAA,CAAM,OAAO,MAAM,CAAA;AAAA,EAC1B;AAAA,EAEA,MAAM,UAAU,MAAA,EAAqD;AACnE,IAAA,MAAM,WAAW,KAAA,CAAM,IAAA,CAAK,IAAA,CAAK,KAAA,CAAM,QAAQ,CAAA;AAE/C,IAAA,IAAI,CAAC,MAAA,IAAU,CAAC,MAAA,CAAO,MAAA,EAAQ;AAC7B,MAAA,OAAO,QAAA,CAAS,GAAA,CAAI,CAAC,CAAA,KAAM,IAAA,CAAK,MAAM,IAAA,CAAK,SAAA,CAAU,CAAC,CAAC,CAAC,CAAA;AAAA,IAC1D;AAEA,IAAA,OAAO,QAAA,CACJ,OAAO,CAAC,IAAA,KAAS,OAAO,MAAA,CAAQ,QAAA,CAAS,KAAK,MAAM,CAAC,EACrD,GAAA,CAAI,CAAC,MAAM,IAAA,CAAK,KAAA,CAAM,KAAK,SAAA,CAAU,CAAC,CAAC,CAAC,CAAA;AAAA,EAC7C;AAAA,EAEA,MAAM,gBAAgB,SAAA,EAAoE;AACxF,IAAA,KAAA,MAAW,IAAA,IAAQ,IAAA,CAAK,KAAA,CAAM,MAAA,EAAO,EAAG;AACtC,MAAA,KAAA,MAAW,IAAA,IAAQ,KAAK,KAAA,EAAO;AAC7B,QAAA,IAAI,IAAA,CAAK,kBAAA,EAAoB,SAAA,KAAc,SAAA,EAAW;AACpD,UAAA,OAAO;AAAA,YACL,MAAM,IAAA,CAAK,KAAA,CAAM,IAAA,CAAK,SAAA,CAAU,IAAI,CAAC,CAAA;AAAA,YACrC,MAAM,IAAA,CAAK,KAAA,CAAM,IAAA,CAAK,SAAA,CAAU,IAAI,CAAC;AAAA,WACvC;AAAA,QACF;AAAA,MACF;AAAA,IACF;AACA,IAAA,OAAO,MAAA;AAAA,EACT;AACF;AAKO,IAAM,4BAAN,MAA8D;AAAA,EAC3D,MAAA,uBAAa,GAAA,EAAwB;AAAA,EAE7C,MAAM,KAAK,KAAA,EAAkC;AAE3C,IAAA,IAAA,CAAK,MAAA,CAAO,GAAA,CAAI,KAAA,CAAM,EAAA,EAAI,IAAA,CAAK,MAAM,IAAA,CAAK,SAAA,CAAU,KAAK,CAAC,CAAC,CAAA;AAAA,EAC7D;AAAA,EAEA,MAAM,KAAK,OAAA,EAAkD;AAC3D,IAAA,MAAM,KAAA,GAAQ,IAAA,CAAK,MAAA,CAAO,GAAA,CAAI,OAAO,CAAA;AACrC,IAAA,OAAO,QAAQ,IAAA,CAAK,KAAA,CAAM,KAAK,SAAA,CAAU,KAAK,CAAC,CAAA,GAAI,MAAA;AAAA,EACrD;AAAA,EAEA,MAAM,OAAO,OAAA,EAAgC;AAC3C,IAAA,IAAA,CAAK,MAAA,CAAO,OAAO,OAAO,CAAA;AAAA,EAC5B;AAAA,EAEA,MAAM,KAAK,MAAA,EAA4D;AACrE,IAAA,MAAM,YAAY,KAAA,CAAM,IAAA,CAAK,IAAA,CAAK,MAAA,CAAO,QAAQ,CAAA;AAEjD,IAAA,IAAI,CAAC,MAAA,IAAU,CAAC,MAAA,CAAO,MAAA,EAAQ;AAC7B,MAAA,OAAO,SAAA,CAAU,GAAA,CAAI,CAAC,CAAA,KAAM,IAAA,CAAK,MAAM,IAAA,CAAK,SAAA,CAAU,CAAC,CAAC,CAAC,CAAA;AAAA,IAC3D;AAEA,IAAA,OAAO,SAAA,CACJ,OAAO,CAAC,KAAA,KAAU,OAAO,MAAA,CAAQ,QAAA,CAAS,MAAM,MAAM,CAAC,EACvD,GAAA,CAAI,CAAC,MAAM,IAAA,CAAK,KAAA,CAAM,KAAK,SAAA,CAAU,CAAC,CAAC,CAAC,CAAA;AAAA,EAC7C;AAAA,EAEA,MAAM,KAAA,CAAM,OAAA,EAAiB,OAAA,EAA6C;AACxE,IAAA,MAAM,KAAA,GAAQ,IAAA,CAAK,MAAA,CAAO,GAAA,CAAI,OAAO,CAAA;AACrC,IAAA,IAAI,CAAC,KAAA,EAAO;AACV,MAAA,MAAM,IAAI,KAAA,CAAM,CAAA,MAAA,EAAS,OAAO,CAAA,UAAA,CAAY,CAAA;AAAA,IAC9C;AAEA,IAAA,MAAA,CAAO,MAAA,CAAO,OAAO,OAAO,CAAA;AAAA,EAC9B;AACF;AAcO,SAAS,kBAAA,CAAmB,OAAA,GAI/B,EAAC,EAAkB;AACrB,EAAA,OAAO;AAAA,IACL,MAAA,EAAQ,OAAA,CAAQ,MAAA,IAAU,IAAI,eAAA,EAAgB;AAAA,IAC9C,IAAA,EAAM,OAAA,CAAQ,IAAA,IAAQ,IAAI,mBAAA,EAAoB;AAAA,IAC9C,KAAA,EAAO,OAAA,CAAQ,KAAA,IAAS,IAAI,yBAAA;AAA0B,GACxD;AACF;;;AClMO,IAAK,WAAA,qBAAAC,YAAAA,KAAL;AACL,EAAAA,aAAA,MAAA,CAAA,GAAO,MAAA;AACP,EAAAA,aAAA,WAAA,CAAA,GAAY,WAAA;AACZ,EAAAA,aAAA,WAAA,CAAA,GAAY,WAAA;AAHF,EAAA,OAAAA,YAAAA;AAAA,CAAA,EAAA,WAAA,IAAA,EAAA;;;ACFL,IAAK,WAAA,qBAAAC,YAAAA,KAAL;AACL,EAAAA,aAAA,YAAA,CAAA,GAAa,YAAA;AACb,EAAAA,aAAA,iBAAA,CAAA,GAAkB,iBAAA;AAClB,EAAAA,aAAA,YAAA,CAAA,GAAa,YAAA;AACb,EAAAA,aAAA,aAAA,CAAA,GAAc,aAAA;AACd,EAAAA,aAAA,UAAA,CAAA,GAAW,UAAA;AACX,EAAAA,aAAA,aAAA,CAAA,GAAc,aAAA;AANJ,EAAA,OAAAA,YAAAA;AAAA,CAAA,EAAA,WAAA,IAAA,EAAA;;;AC+FL,IAAM,sBAAA,GAA+C;AAAA,EAC1D,gBAAA,EAAkB,KAAA;AAAA,EAClB,mBAAA,EAAqB,IAAA;AAAA,EACrB,SAAA,EAAW,GAAA;AAAA,EACX,eAAA,EAAiB,IAAA;AAAA,EACjB,SAAA,EAAW,aAAA;AAAA,EACX,WAAA,EAAa,IAAA;AAAA,EACb,QAAA,EAAU,WAAA;AAAA,EACV,iBAAiB;AACnB;;;AC5FO,SAAS,uBAAA,CACd,WACA,SAAA,EACQ;AACR,EAAA,IAAI,OAAO,SAAA,CAAU,OAAA,KAAY,QAAA,EAAU;AACzC,IAAA,OAAO,SAAA,CAAU,cAAA,CAAe,SAAA,CAAU,OAAO,CAAA;AAAA,EACnD;AACA,EAAA,OAAO,SAAA,CAAU,kBAAA,CAAmB,SAAA,CAAU,OAAO,CAAA;AACvD;AAUO,SAAS,0BACd,UAAA,EACqB;AACrB,EAAA,OAAO,UAAA,CACJ,MAAA,CAAO,CAAC,CAAA,KAAM,EAAE,WAAW,CAAA,CAC3B,IAAA,CAAK,CAAC,CAAA,EAAG,CAAA,KAAM,CAAA,CAAE,QAAA,GAAW,EAAE,QAAQ,CAAA;AAC3C;AASO,SAAS,yBAAA,CACd,WACA,UAAA,EACqD;AACrD,EAAA,OAAO,WAAW,IAAA,CAAK,CAAC,MAAM,CAAA,CAAE,UAAA,CAAW,SAAS,CAAC,CAAA;AACvD;AAyDA,eAAsB,sBACpB,OAAA,EAC2B;AAC3B,EAAA,MAAM;AAAA,IACJ,UAAA;AAAA,IACA,YAAA;AAAA,IACA,UAAA;AAAA,IACA,SAAA;AAAA,IACA,mBAAA;AAAA,IACA,SAAA,GAAY,CAAA;AAAA,IACZ,SAAA,GAAY;AAAA,GACd,GAAI,OAAA;AAEJ,EAAA,MAAM,MAAgB,EAAC;AACvB,EAAA,IAAI,OAAA,GAAU,CAAC,GAAG,UAAU,CAAA;AAC5B,EAAA,IAAI,WAAA,GAAc,CAAA;AAClB,EAAA,IAAI,KAAA,GAAQ,CAAA;AAGZ,EAAA,MAAM,gBAAA,GAAmB,0BAA0B,OAAO,CAAA;AAE1D,EAAA,OAAO,WAAA,GAAc,YAAA,IAAgB,KAAA,GAAQ,SAAA,EAAW;AACtD,IAAA,KAAA,EAAA;AACA,IAAA,IAAI,UAAA,GAAa,CAAA;AAEjB,IAAA,KAAA,MAAW,aAAa,gBAAA,EAAkB;AACxC,MAAA,IAAI,eAAe,YAAA,EAAc;AAGjC,MAAA,MAAM,SAAA,GAAY,yBAAA,CAA0B,SAAA,EAAW,UAAU,CAAA;AACjE,MAAA,IAAI,CAAC,SAAA,EAAW;AAGhB,MAAA,MAAM,UAAA,GAAa,uBAAA,CAAwB,SAAA,EAAW,SAAS,CAAA;AAG/D,MAAA,MAAM,UAAA,GAAa,mBAAA,CAAoB,UAAA,EAAY,KAAK,CAAA;AAGxD,MAAA,IAAI,cAAc,UAAA,EAAY;AAG9B,MAAA,MAAM,SAAA,GAAY,MAAM,SAAA,CAAU,OAAA,CAAQ,WAAW,UAAU,CAAA;AAG/D,MAAA,MAAM,KAAA,GAAQ,QAAQ,SAAA,CAAU,CAAC,MAAM,CAAA,CAAE,IAAA,KAAS,UAAU,IAAI,CAAA;AAChE,MAAA,IAAI,UAAU,EAAA,EAAI;AAChB,QAAA,OAAA,CAAQ,KAAK,CAAA,GAAI,SAAA;AAAA,MACnB;AAGA,MAAA,MAAM,SAAA,GAAY,uBAAA,CAAwB,SAAA,EAAW,SAAS,CAAA;AAC9D,MAAA,MAAM,QAAQ,UAAA,GAAa,SAAA;AAC3B,MAAA,WAAA,IAAe,KAAA;AACf,MAAA,UAAA,IAAc,KAAA;AAGd,MAAA,MAAM,MAAA,GAAS,SAAA,GAAY,CAAA,EAAG,SAAS,CAAA,EAAA,CAAA,GAAO,EAAA;AAC9C,MAAA,MAAM,SAAA,GAAY,SAAA,GAAY,CAAA,GAAI,CAAA,MAAA,EAAS,KAAK,CAAA,EAAA,CAAA,GAAO,EAAA;AACvD,MAAA,GAAA,CAAI,IAAA;AAAA,QACF,CAAA,EAAG,MAAM,CAAA,EAAG,SAAS,CAAA,EAAG,SAAA,CAAU,IAAI,CAAA,YAAA,EAAe,SAAA,CAAU,IAAI,CAAA,KAAA,EAAQ,KAAK,CAAA,OAAA;AAAA,OAClF;AAAA,IACF;AAGA,IAAA,IAAI,eAAe,CAAA,EAAG;AAAA,EACxB;AAEA,EAAA,OAAO,EAAE,UAAA,EAAY,OAAA,EAAS,GAAA,EAAK,aAAa,WAAA,EAAY;AAC9D;;;AChJO,IAAe,yBAAf,MAAkE;AAAA,EAG7D,OAAA,GAA+B;AAAA,IACvC,eAAA,EAAiB,CAAA;AAAA,IACjB,gBAAA,EAAkB,CAAA;AAAA,IAClB,2BAAA,EAA6B;AAAA,GAC/B;AAAA;AAAA;AAAA;AAAA;AAAA,EA2BU,YAAA,GAAuB;AAC/B,IAAA,OAAO,CAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA,EAMU,YAAA,GAAuB;AAC/B,IAAA,OAAO,IAAA,CAAK,IAAA,CAAK,MAAA,CAAO,CAAC,CAAA,CAAE,aAAY,GAAI,IAAA,CAAK,IAAA,CAAK,KAAA,CAAM,CAAC,CAAA;AAAA,EAC9D;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,MAAM,OAAA,CACJ,UAAA,EACA,MAAA,EACA,YACA,SAAA,EAC2B;AAE3B,IAAA,MAAM,cAAc,IAAA,CAAK,KAAA,CAAM,OAAO,KAAA,GAAQ,IAAA,CAAK,sBAAsB,CAAA;AACzE,IAAA,MAAM,YAAA,GAAe,OAAO,IAAA,GAAO,WAAA;AAGnC,IAAA,MAAM,MAAA,GAAS,MAAM,qBAAA,CAAsB;AAAA,MACzC,UAAA;AAAA,MACA,YAAA;AAAA,MACA,UAAA;AAAA,MACA,SAAA;AAAA,MACA,mBAAA,EAAqB,IAAA,CAAK,mBAAA,CAAoB,IAAA,CAAK,IAAI,CAAA;AAAA,MACvD,SAAA,EAAW,KAAK,YAAA,EAAa;AAAA,MAC7B,SAAA,EAAW,KAAK,YAAA;AAAa,KAC9B,CAAA;AAGD,IAAA,IAAA,CAAK,aAAA,CAAc,OAAO,WAAW,CAAA;AAErC,IAAA,OAAO,MAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKU,cAAc,WAAA,EAA2B;AACjD,IAAA,IAAA,CAAK,OAAA,CAAQ,eAAA,EAAA;AACb,IAAA,IAAA,CAAK,QAAQ,gBAAA,IAAoB,WAAA;AACjC,IAAA,IAAA,CAAK,QAAQ,2BAAA,GACX,IAAA,CAAK,OAAA,CAAQ,gBAAA,GAAmB,KAAK,OAAA,CAAQ,eAAA;AAAA,EACjD;AAAA;AAAA;AAAA;AAAA,EAKA,UAAA,GAAkC;AAChC,IAAA,OAAO,EAAE,GAAG,IAAA,CAAK,OAAA,EAAQ;AAAA,EAC3B;AAAA;AAAA;AAAA;AAAA,EAKA,YAAA,GAAqB;AACnB,IAAA,IAAA,CAAK,OAAA,GAAU;AAAA,MACb,eAAA,EAAiB,CAAA;AAAA,MACjB,gBAAA,EAAkB,CAAA;AAAA,MAClB,2BAAA,EAA6B;AAAA,KAC/B;AAAA,EACF;AACF,CAAA;;;AChIO,IAAM,aAAA,GAAgB;AAAA;AAAA,EAE3B,UAAA,EAAY,GAUd,CAAA;AAOO,IAAM,gBAAA,GAAmB;AAAA;AAAA,EAE9B,UAAA,EAAY,KAUd,CAAA;AAOO,IAAM,2BAAA,GAA8B;AAAA;AAAA,EAEzC,kBAAA,EAAoB,IAAA;AAAA;AAAA,EAGpB,qBAAA,EAAuB,GAAA;AAAA;AAAA,EAGvB,cAAA,EAAgB,IAAA;AAAA;AAAA,EAGhB,UAAA,EAAY;AACd,CAAA;AAKO,IAAM,4BAAA,GAA+B;AAAA;AAAA,EAE1C,SAAA,EAAW,GAAA;AAAA;AAAA,EAGX,kBAAA,EAAoB,GAAA;AAAA;AAAA,EAGpB,gBAAA,EAAkB;AACpB,CAAA;AAKO,IAAM,sBAAA,GAAyB;AAAA;AAAA,EAEpC,kBAAA,EAAoB,IAAA;AAAA;AAAA,EAGpB,gBAAA,EAAkB;AACpB,CAAA;AAKO,IAAM,0BAAA,GAA6B;AAAA;AAAA,EAExC,eAAA,EAAiB,EAAA;AAAA;AAAA,EAGjB,gBAAA,EAAkB,CAAA;AAAA;AAAA,EAGlB,yBAAA,EAA2B,EAAA;AAAA;AAAA,EAG3B,uBAAA,EAAyB;AAC3B,CAAA;AAKO,IAAM,uBAAA,GAA0B;AAAA;AAAA,EAErC,YAAA,EAAc;AAChB,CAAA;;;AChFA,IAAM,eAAA,GAAsD;AAAA,EAC1D,mBAAmB,2BAAA,CAA4B,kBAAA;AAAA,EAC/C,qBAAqB,2BAAA,CAA4B,qBAAA;AAAA,EACjD,eAAe,2BAAA,CAA4B,cAAA;AAAA,EAC3C,WAAW,2BAAA,CAA4B;AACzC,CAAA;AAEO,IAAM,2BAAA,GAAN,cAA0C,sBAAA,CAAuB;AAAA,EAC7D,IAAA,GAAO,WAAA;AAAA,EACR,OAAA;AAAA,EAER,WAAA,CAAY,OAAA,GAAoC,EAAC,EAAG;AAClD,IAAA,KAAA,EAAM;AACN,IAAA,IAAA,CAAK,OAAA,GAAU,EAAE,GAAG,eAAA,EAAiB,GAAG,OAAA,EAAQ;AAAA,EAClD;AAAA,EAEA,aAAA,CAAc,QAAuB,OAAA,EAAwC;AAE3E,IAAA,OAAO,MAAA,CAAO,MAAA,KAAW,SAAA,IAAa,MAAA,CAAO,MAAA,KAAW,UAAA;AAAA,EAC1D;AAAA,EAEA,mBAAA,CAAoB,YAAoB,KAAA,EAAuB;AAE7D,IAAA,MAAM,kBACJ,IAAA,CAAK,OAAA,CAAQ,uBAAuB,KAAA,GAAQ,CAAA,IAAK,KAAK,OAAA,CAAQ,aAAA;AAChE,IAAA,OAAO,KAAK,KAAA,CAAM,UAAA,GAAa,KAAK,GAAA,CAAI,eAAA,EAAiB,GAAG,CAAC,CAAA;AAAA,EAC/D;AAAA,EAEA,oBAAA,GAA+B;AAC7B,IAAA,OAAO,KAAK,OAAA,CAAQ,iBAAA;AAAA,EACtB;AAAA,EAEU,YAAA,GAAuB;AAC/B,IAAA,OAAO,KAAK,OAAA,CAAQ,SAAA;AAAA,EACtB;AAAA,EAEU,YAAA,GAAuB;AAC/B,IAAA,OAAO,WAAA;AAAA,EACT;AACF;;;ACzCA,IAAMC,gBAAAA,GAAuD;AAAA,EAC3D,WAAW,4BAAA,CAA6B,SAAA;AAAA,EACxC,mBAAmB,4BAAA,CAA6B,kBAAA;AAAA,EAChD,iBAAiB,4BAAA,CAA6B;AAChD,CAAA;AAEO,IAAM,4BAAA,GAAN,cAA2C,sBAAA,CAAuB;AAAA,EAC9D,IAAA,GAAO,YAAA;AAAA,EACR,OAAA;AAAA,EAER,WAAA,CAAY,OAAA,GAAqC,EAAC,EAAG;AACnD,IAAA,KAAA,EAAM;AACN,IAAA,IAAA,CAAK,OAAA,GAAU,EAAE,GAAGA,gBAAAA,EAAiB,GAAG,OAAA,EAAQ;AAAA,EAClD;AAAA,EAEA,aAAA,CAAc,QAAuB,OAAA,EAAwC;AAC3E,IAAA,MAAM,gBAAA,GAAA,CAAoB,MAAA,CAAO,IAAA,GAAO,MAAA,CAAO,YAAY,MAAA,CAAO,KAAA;AAClE,IAAA,OAAO,gBAAA,IAAoB,KAAK,OAAA,CAAQ,SAAA;AAAA,EAC1C;AAAA,EAEA,mBAAA,CAAoB,YAAoB,MAAA,EAAwB;AAE9D,IAAA,OAAO,IAAA,CAAK,KAAA,CAAM,UAAA,GAAa,IAAA,CAAK,QAAQ,eAAe,CAAA;AAAA,EAC7D;AAAA,EAEA,oBAAA,GAA+B;AAC7B,IAAA,OAAO,KAAK,OAAA,CAAQ,iBAAA;AAAA,EACtB;AAAA,EAEU,YAAA,GAAuB;AAC/B,IAAA,OAAO,YAAA;AAAA,EACT;AACF;;;AClCA,IAAMA,gBAAAA,GAAiD;AAAA,EACrD,mBAAmB,sBAAA,CAAuB,kBAAA;AAAA,EAC1C,iBAAiB,sBAAA,CAAuB;AAC1C,CAAA;AAEO,IAAM,sBAAA,GAAN,cAAqC,sBAAA,CAAuB;AAAA,EACxD,IAAA,GAAO,MAAA;AAAA,EACR,OAAA;AAAA,EAER,WAAA,CAAY,OAAA,GAA+B,EAAC,EAAG;AAC7C,IAAA,KAAA,EAAM;AACN,IAAA,IAAA,CAAK,OAAA,GAAU,EAAE,GAAGA,gBAAAA,EAAiB,GAAG,OAAA,EAAQ;AAAA,EAClD;AAAA,EAEA,aAAA,CAAc,QAAuB,OAAA,EAAwC;AAE3E,IAAA,OAAO,OAAO,MAAA,KAAW,UAAA;AAAA,EAC3B;AAAA,EAEA,mBAAA,CAAoB,YAAoB,MAAA,EAAwB;AAE9D,IAAA,OAAO,IAAA,CAAK,KAAA,CAAM,UAAA,GAAa,IAAA,CAAK,QAAQ,eAAe,CAAA;AAAA,EAC7D;AAAA,EAEA,oBAAA,GAA+B;AAC7B,IAAA,OAAO,KAAK,OAAA,CAAQ,iBAAA;AAAA,EACtB;AAAA,EAEU,YAAA,GAAuB;AAC/B,IAAA,OAAO,MAAA;AAAA,EACT;AACF;;;ACnCO,IAAM,wBAAN,MAAwD;AAAA,EAG7D,WAAA,CAAoB,OAAA,GAAgC,EAAC,EAAG;AAApC,IAAA,IAAA,CAAA,OAAA,GAAA,OAAA;AAAA,EAAqC;AAAA,EAFhD,IAAA,GAAO,gBAAA;AAAA,EAIhB,aAAA,CAAc,SAAwB,OAAA,EAAwC;AAE5E,IAAA,OAAO,KAAA;AAAA,EACT;AAAA,EAEA,MAAM,kBAAkB,UAAA,EAA+D;AACrF,IAAA,OAAO,UAAA,CAAW,GAAA,CAAI,CAAC,SAAA,KAAc;AAEnC,MAAA,IAAI,KAAA,CAAM,OAAA,CAAQ,SAAA,CAAU,OAAO,CAAA,EAAG;AACpC,QAAA,MAAM,WAAA,GAAc,IAAA,CAAK,OAAA,CAAQ,WAAA,IAAe,uBAAA,CAAwB,YAAA;AACxE,QAAA,IAAI,SAAA,CAAU,OAAA,CAAQ,MAAA,GAAS,WAAA,EAAa;AAC1C,UAAA,OAAO;AAAA,YACL,GAAG,SAAA;AAAA,YACH,OAAA,EAAS,SAAA,CAAU,OAAA,CAAQ,KAAA,CAAM,CAAC,WAAW,CAAA;AAAA,YAC7C,QAAA,EAAU;AAAA,cACR,GAAG,SAAA,CAAU,QAAA;AAAA,cACb,QAAA,EAAU,IAAA;AAAA,cACV,cAAA,EAAgB,UAAU,OAAA,CAAQ,MAAA;AAAA,cAClC,UAAA,EAAY;AAAA;AACd,WACF;AAAA,QACF;AAAA,MACF;AAEA,MAAA,OAAO,SAAA;AAAA,IACT,CAAC,CAAA;AAAA,EACH;AAAA,EAEA,MAAM,OAAA,GAA4F;AAEhG,IAAA,OAAO,EAAE,YAAY,EAAC,EAAG,KAAK,EAAC,EAAG,aAAa,CAAA,EAAE;AAAA,EACnD;AACF;;;AChCO,IAAM,mBAAN,MAAmD;AAAA,EAUxD,WAAA,CAAoB,OAAA,GAAmC,EAAC,EAAG;AAAvC,IAAA,IAAA,CAAA,OAAA,GAAA,OAAA;AAElB,IAAA,IAAA,CAAK,eAAA,GAAkB,IAAI,2BAAA,EAA4B;AAAA,EACzD;AAAA,EAZS,IAAA,GAAO,UAAA;AAAA,EAER,eAAA;AAAA,EACA,OAAA,GAAU;AAAA,IAChB,cAAA,EAAgB,CAAA;AAAA,IAChB,mBAAA,EAAqB,CAAA;AAAA,IACrB,iBAAiB;AAAC,GACpB;AAAA,EAOA,aAAA,CAAc,QAAuB,MAAA,EAAuC;AAE1E,IAAA,IAAA,CAAK,cAAc,MAAM,CAAA;AAGzB,IAAA,IAAA,CAAK,UAAA,EAAW;AAGhB,IAAA,OAAO,IAAA,CAAK,eAAA,CAAgB,aAAA,CAAc,MAAA,EAAQ,MAAM,CAAA;AAAA,EAC1D;AAAA,EAEA,MAAM,OAAA,CACJ,UAAA,EACA,MAAA,EACA,YACA,SAAA,EACkF;AAClF,IAAA,MAAM,MAAA,GAAS,MAAM,IAAA,CAAK,eAAA,CAAgB,QAAQ,UAAA,EAAY,MAAA,EAAQ,YAAY,SAAS,CAAA;AAG3F,IAAA,IAAA,CAAK,OAAA,CAAQ,eAAA,CAAgB,IAAA,CAAK,IAAA,CAAK,KAAK,CAAA;AAC5C,IAAA,MAAM,MAAA,GAAS,IAAA,CAAK,OAAA,CAAQ,cAAA,IAAkB,0BAAA,CAA2B,eAAA;AACzE,IAAA,IAAI,IAAA,CAAK,OAAA,CAAQ,eAAA,CAAgB,MAAA,GAAS,MAAA,EAAQ;AAChD,MAAA,IAAA,CAAK,OAAA,CAAQ,gBAAgB,KAAA,EAAM;AAAA,IACrC;AAEA,IAAA,OAAO;AAAA,MACL,GAAG,MAAA;AAAA,MACH,GAAA,EAAK,CAAC,CAAA,iBAAA,EAAoB,IAAA,CAAK,gBAAgB,IAAI,CAAA,CAAA,CAAA,EAAK,GAAG,MAAA,CAAO,GAAG;AAAA,KACvE;AAAA,EACF;AAAA,EAEQ,cAAc,MAAA,EAA6B;AAEjD,IAAA,MAAM,KAAA,GAAQ,GAAA;AACd,IAAA,IAAA,CAAK,OAAA,CAAQ,iBACX,KAAA,GAAQ,MAAA,CAAO,sBAAsB,CAAA,GAAI,KAAA,IAAS,KAAK,OAAA,CAAQ,cAAA;AAAA,EACnE;AAAA,EAEQ,UAAA,GAAmB;AACzB,IAAA,MAAM,GAAA,GAAM,KAAK,GAAA,EAAI;AAGrB,IAAA,IAAI,IAAA,CAAK,OAAA,CAAQ,eAAA,CAAgB,MAAA,IAAU,CAAA,EAAG;AAC5C,MAAA,MAAM,eAAA,GAAkB,IAAA,CAAK,OAAA,CAAQ,eAAA,CAAgB,CAAC,CAAA;AACtD,MAAA,IAAI,oBAAoB,MAAA,EAAW;AACjC,QAAA,MAAM,WAAW,GAAA,GAAM,eAAA;AACvB,QAAA,IAAA,CAAK,QAAQ,mBAAA,GACV,IAAA,CAAK,OAAA,CAAQ,eAAA,CAAgB,SAAS,QAAA,GAAY,GAAA;AAAA,MACvD;AAAA,IACF;AAGA,IAAA,MAAM,SAAA,GAAY,IAAA,CAAK,OAAA,CAAQ,eAAA,IAAmB,0BAAA,CAA2B,gBAAA;AAE7E,IAAA,IAAI,IAAA,CAAK,OAAA,CAAQ,mBAAA,GAAsB,SAAA,EAAW;AAEhD,MAAA,IAAI,IAAA,CAAK,eAAA,CAAgB,IAAA,KAAS,YAAA,EAAc;AAC9C,QAAA,IAAA,CAAK,eAAA,GAAkB,IAAI,4BAAA,EAA6B;AAAA,MAC1D;AAAA,IACF,CAAA,MAAA,IACE,IAAA,CAAK,OAAA,CAAQ,mBAAA,GAAsB,0BAAA,CAA2B,2BAC9D,IAAA,CAAK,OAAA,CAAQ,cAAA,GAAiB,0BAAA,CAA2B,yBAAA,EACzD;AAEA,MAAA,IAAI,IAAA,CAAK,eAAA,CAAgB,IAAA,KAAS,MAAA,EAAQ;AACxC,QAAA,IAAA,CAAK,eAAA,GAAkB,IAAI,sBAAA,EAAuB;AAAA,MACpD;AAAA,IACF,CAAA,MAAO;AAEL,MAAA,IAAI,IAAA,CAAK,eAAA,CAAgB,IAAA,KAAS,WAAA,EAAa;AAC7C,QAAA,IAAA,CAAK,eAAA,GAAkB,IAAI,2BAAA,EAA4B;AAAA,MACzD;AAAA,IACF;AAAA,EACF;AAAA,EAEA,UAAA,GAAa;AACX,IAAA,OAAO;AAAA,MACL,GAAG,IAAA,CAAK,OAAA;AAAA,MACR,eAAA,EAAiB,KAAK,eAAA,CAAgB;AAAA,KACxC;AAAA,EACF;AACF;;;AClGO,SAAS,cAAA,CACd,IAAA,EACA,OAAA,GAAmC,EAAC,EAClB;AAClB,EAAA,QAAQ,IAAA;AAAM,IACZ,KAAK,WAAA;AACH,MAAA,OAAO,IAAI,4BAA4B,OAAmC,CAAA;AAAA,IAC5E,KAAK,YAAA;AACH,MAAA,OAAO,IAAI,6BAA6B,OAAoC,CAAA;AAAA,IAC9E,KAAK,MAAA;AACH,MAAA,OAAO,IAAI,uBAAuB,OAA8B,CAAA;AAAA,IAClE,KAAK,gBAAA;AACH,MAAA,OAAO,IAAI,sBAAsB,OAA+B,CAAA;AAAA,IAClE,KAAK,UAAA;AACH,MAAA,OAAO,IAAI,iBAAiB,OAAkC,CAAA;AAAA,IAChE;AACE,MAAA,MAAM,IAAI,KAAA,CAAM,CAAA,0BAAA,EAA6B,IAAI,CAAA,CAAE,CAAA;AAAA;AAEzD;;;ACxCO,IAAM,MAAA,GAAS;AAAA,EACpB,MAAA,EAAQ,QAAA;AAAA,EACR,SAAA,EAAW,WAAA;AAAA,EACX,MAAA,EAAQ,QAAA;AAAA,EACR,YAAA,EAAc,eAAA;AAAA,EACd,IAAA,EAAM,MAAA;AAAA,EACN,QAAA,EAAU,UAAA;AAAA,EACV,UAAA,EAAY,YAAA;AAAA,EACZ,IAAA,EAAM,MAAA;AAAA,EACN,QAAA,EAAU,UAAA;AAAA,EACV,OAAA,EAAS,SAAA;AAAA,EACT,MAAA,EAAQ,QAAA;AAAA,EACR,MAAA,EAAQ;AAAA;AACV;AAOO,IAAM,OAAA,GAAU,MAAA,CAAO,MAAA,CAAO,MAAM;AAKpC,SAAS,SAAS,KAAA,EAAgC;AACvD,EAAA,OAAO,OAAA,CAAQ,SAAS,KAAe,CAAA;AACzC;;;AC6FO,IAAM,UAAA,GAAa;AAAA,EACxB,CAAC,MAAA,CAAO,MAAM,GAAG;AAAA;AAAA,IAEf,OAAA,EAAS,SAAA;AAAA,IACT,WAAA,EAAa,aAAA;AAAA;AAAA,IAEb,KAAA,EAAO,OAAA;AAAA,IACP,UAAA,EAAY,YAAA;AAAA,IACZ,UAAA,EAAY,YAAA;AAAA;AAAA,IAEZ,OAAA,EAAS,SAAA;AAAA,IACT,YAAA,EAAc,cAAA;AAAA,IACd,YAAA,EAAc,cAAA;AAAA;AAAA,IAEd,MAAA,EAAQ,QAAA;AAAA,IACR,WAAA,EAAa,aAAA;AAAA;AAAA,IAEb,OAAA,EAAS,SAAA;AAAA,IACT,EAAA,EAAI;AAAA,GACN;AAAA,EACA,CAAC,MAAA,CAAO,SAAS,GAAG;AAAA;AAAA,IAElB,eAAA,EAAiB,0BAAA;AAAA,IACjB,iBAAA,EAAmB,4BAAA;AAAA,IACnB,gBAAA,EAAkB,2BAAA;AAAA;AAAA,IAElB,eAAA,EAAiB,0BAAA;AAAA,IACjB,eAAA,EAAiB,0BAAA;AAAA,IACjB,iBAAA,EAAmB,4BAAA;AAAA;AAAA,IAEnB,cAAA,EAAgB;AAAA,GAClB;AAAA,EACA,CAAC,MAAA,CAAO,MAAM,GAAG;AAAA;AAAA,IAEf,sBAAA,EAAwB,wBAAA;AAAA,IACxB,oBAAA,EAAsB,sBAAA;AAAA,IACtB,0BAAA,EAA4B,4BAAA;AAAA;AAAA,IAE5B,cAAA,EAAgB,gBAAA;AAAA,IAChB,gBAAA,EAAkB,kBAAA;AAAA,IAClB,qBAAA,EAAuB,uBAAA;AAAA,IACvB,sBAAA,EAAwB;AAAA;AAE5B;AAMO,IAAM,cAAA,GAAkD;AAAA;AAAA;AAAA;AAAA;AAAA,EAM7D,SAAA,EAAW;AAAA,IACT,IAAA,EAAM,SAAA;AAAA,IACN,UAAU,MAAA,CAAO,MAAA;AAAA,IACjB,WAAA,EAAa,+FAAA;AAAA,IACb,QAAA,EAAU,IAAA;AAAA,IACV,WAAA,EAAa,YAAA;AAAA,IACb,eAAA,EAAiB,YAAA;AAAA,IACjB,QAAA,EAAU;AAAA,MACR,SAAA,EAAW,IAAA;AAAA,MACX,SAAA,EAAW,IAAA;AAAA,MACX,gBAAA,EAAkB,IAAA;AAAA,MAClB,eAAA,EAAiB,IAAA;AAAA,MACjB,UAAA,EAAY,KAAA;AAAA,MACZ,gBAAA,EAAkB,KAAA;AAAA,MAClB,QAAA,EAAU,KAAA;AAAA,MACV,MAAA,EAAQ,IAAA;AAAA,MACR,KAAA,EAAO,KAAA;AAAA,MACP,KAAA,EAAO,KAAA;AAAA,MACP,QAAA,EAAU,IAAA;AAAA,MACV,aAAA,EAAe,IAAA;AAAA,MACf,UAAA,EAAY;AAAA,QACV,WAAA,EAAa,KAAA;AAAA,QACb,IAAA,EAAM,KAAA;AAAA,QACN,gBAAA,EAAkB,KAAA;AAAA,QAClB,eAAA,EAAiB;AAAA,OACnB;AAAA,MACA,KAAA,EAAO;AAAA,QACL,MAAA,EAAQ,GAAA;AAAA,QACR,IAAA,EAAM,IAAA;AAAA,QACN,KAAA,EAAO,IAAA;AAAA,QACP,GAAA,EAAK;AAAA,OACP;AAAA,MACA,MAAA,EAAQ;AAAA,QACN,MAAA,EAAQ,KAAA;AAAA,QACR,IAAA,EAAM,IAAA;AAAA,QACN,GAAA,EAAK;AAAA;AACP;AACF,GACF;AAAA,EAEA,aAAA,EAAe;AAAA,IACb,IAAA,EAAM,aAAA;AAAA,IACN,UAAU,MAAA,CAAO,MAAA;AAAA,IACjB,WAAA,EAAa,gGAAA;AAAA,IACb,QAAA,EAAU,IAAA;AAAA,IACV,WAAA,EAAa,YAAA;AAAA,IACb,eAAA,EAAiB,YAAA;AAAA,IACjB,QAAA,EAAU;AAAA,MACR,SAAA,EAAW,IAAA;AAAA,MACX,SAAA,EAAW,IAAA;AAAA,MACX,gBAAA,EAAkB,IAAA;AAAA,MAClB,eAAA,EAAiB,IAAA;AAAA,MACjB,UAAA,EAAY,KAAA;AAAA,MACZ,gBAAA,EAAkB,KAAA;AAAA,MAClB,QAAA,EAAU,KAAA;AAAA,MACV,MAAA,EAAQ,IAAA;AAAA,MACR,KAAA,EAAO,KAAA;AAAA,MACP,KAAA,EAAO,KAAA;AAAA,MACP,QAAA,EAAU,IAAA;AAAA,MACV,aAAA,EAAe,IAAA;AAAA,MACf,UAAA,EAAY;AAAA,QACV,WAAA,EAAa,KAAA;AAAA,QACb,IAAA,EAAM,KAAA;AAAA,QACN,gBAAA,EAAkB,KAAA;AAAA,QAClB,eAAA,EAAiB;AAAA,OACnB;AAAA,MACA,KAAA,EAAO;AAAA,QACL,MAAA,EAAQ,GAAA;AAAA,QACR,IAAA,EAAM,IAAA;AAAA,QACN,KAAA,EAAO,IAAA;AAAA,QACP,GAAA,EAAK;AAAA,OACP;AAAA,MACA,MAAA,EAAQ;AAAA,QACN,MAAA,EAAQ,KAAA;AAAA,QACR,IAAA,EAAM,IAAA;AAAA,QACN,GAAA,EAAK;AAAA;AACP;AACF,GACF;AAAA;AAAA,EAGA,OAAA,EAAS;AAAA,IACP,IAAA,EAAM,OAAA;AAAA,IACN,UAAU,MAAA,CAAO,MAAA;AAAA,IACjB,WAAA,EAAa,iHAAA;AAAA,IACb,QAAA,EAAU,IAAA;AAAA,IACV,WAAA,EAAa,YAAA;AAAA,IACb,eAAA,EAAiB,YAAA;AAAA,IACjB,QAAA,EAAU;AAAA,MACR,SAAA,EAAW,IAAA;AAAA,MACX,SAAA,EAAW,IAAA;AAAA,MACX,gBAAA,EAAkB,IAAA;AAAA,MAClB,eAAA,EAAiB,IAAA;AAAA,MACjB,UAAA,EAAY,KAAA;AAAA,MACZ,gBAAA,EAAkB,KAAA;AAAA,MAClB,QAAA,EAAU,KAAA;AAAA,MACV,MAAA,EAAQ,IAAA;AAAA,MACR,KAAA,EAAO,KAAA;AAAA,MACP,KAAA,EAAO,KAAA;AAAA,MACP,QAAA,EAAU,IAAA;AAAA,MACV,aAAA,EAAe,IAAA;AAAA,MACf,UAAA,EAAY;AAAA,QACV,WAAA,EAAa,KAAA;AAAA,QACb,IAAA,EAAM,KAAA;AAAA,QACN,gBAAA,EAAkB,KAAA;AAAA,QAClB,eAAA,EAAiB;AAAA,OACnB;AAAA,MACA,KAAA,EAAO;AAAA,QACL,MAAA,EAAQ,GAAA;AAAA,QACR,IAAA,EAAM,IAAA;AAAA,QACN,KAAA,EAAO,IAAA;AAAA,QACP,GAAA,EAAK;AAAA,OACP;AAAA,MACA,MAAA,EAAQ;AAAA,QACN,MAAA,EAAQ,KAAA;AAAA,QACR,IAAA,EAAM,IAAA;AAAA,QACN,GAAA,EAAK;AAAA;AACP;AACF,GACF;AAAA,EAEA,YAAA,EAAc;AAAA,IACZ,IAAA,EAAM,YAAA;AAAA,IACN,UAAU,MAAA,CAAO,MAAA;AAAA,IACjB,WAAA,EAAa,oFAAA;AAAA,IACb,QAAA,EAAU,IAAA;AAAA,IACV,WAAA,EAAa,YAAA;AAAA,IACb,eAAA,EAAiB,YAAA;AAAA,IACjB,QAAA,EAAU;AAAA,MACR,SAAA,EAAW,IAAA;AAAA,MACX,SAAA,EAAW,IAAA;AAAA,MACX,gBAAA,EAAkB,IAAA;AAAA,MAClB,eAAA,EAAiB,IAAA;AAAA,MACjB,UAAA,EAAY,KAAA;AAAA,MACZ,gBAAA,EAAkB,KAAA;AAAA,MAClB,QAAA,EAAU,KAAA;AAAA,MACV,MAAA,EAAQ,IAAA;AAAA,MACR,KAAA,EAAO,KAAA;AAAA,MACP,KAAA,EAAO,KAAA;AAAA,MACP,QAAA,EAAU,IAAA;AAAA,MACV,aAAA,EAAe,IAAA;AAAA,MACf,UAAA,EAAY;AAAA,QACV,WAAA,EAAa,KAAA;AAAA,QACb,IAAA,EAAM,KAAA;AAAA,QACN,gBAAA,EAAkB,KAAA;AAAA,QAClB,eAAA,EAAiB;AAAA,OACnB;AAAA,MACA,KAAA,EAAO;AAAA,QACL,MAAA,EAAQ,GAAA;AAAA,QACR,IAAA,EAAM,IAAA;AAAA,QACN,KAAA,EAAO,IAAA;AAAA,QACP,GAAA,EAAK;AAAA,OACP;AAAA,MACA,MAAA,EAAQ;AAAA,QACN,MAAA,EAAQ,KAAA;AAAA,QACR,IAAA,EAAM,IAAA;AAAA,QACN,GAAA,EAAK;AAAA;AACP;AACF,GACF;AAAA,EAEA,YAAA,EAAc;AAAA,IACZ,IAAA,EAAM,YAAA;AAAA,IACN,UAAU,MAAA,CAAO,MAAA;AAAA,IACjB,WAAA,EAAa,sFAAA;AAAA,IACb,QAAA,EAAU,IAAA;AAAA,IACV,WAAA,EAAa,YAAA;AAAA,IACb,eAAA,EAAiB,YAAA;AAAA,IACjB,QAAA,EAAU;AAAA,MACR,SAAA,EAAW,IAAA;AAAA,MACX,SAAA,EAAW,IAAA;AAAA,MACX,gBAAA,EAAkB,IAAA;AAAA,MAClB,eAAA,EAAiB,IAAA;AAAA,MACjB,UAAA,EAAY,KAAA;AAAA,MACZ,gBAAA,EAAkB,KAAA;AAAA,MAClB,QAAA,EAAU,KAAA;AAAA,MACV,MAAA,EAAQ,IAAA;AAAA,MACR,KAAA,EAAO,KAAA;AAAA,MACP,KAAA,EAAO,KAAA;AAAA,MACP,QAAA,EAAU,IAAA;AAAA,MACV,aAAA,EAAe,IAAA;AAAA,MACf,UAAA,EAAY;AAAA,QACV,WAAA,EAAa,KAAA;AAAA,QACb,IAAA,EAAM,KAAA;AAAA,QACN,gBAAA,EAAkB,KAAA;AAAA,QAClB,eAAA,EAAiB;AAAA,OACnB;AAAA,MACA,KAAA,EAAO;AAAA,QACL,MAAA,EAAQ,GAAA;AAAA,QACR,IAAA,EAAM,IAAA;AAAA,QACN,KAAA,EAAO,IAAA;AAAA,QACP,GAAA,EAAK;AAAA,OACP;AAAA,MACA,MAAA,EAAQ;AAAA,QACN,MAAA,EAAQ,KAAA;AAAA,QACR,IAAA,EAAM,IAAA;AAAA,QACN,GAAA,EAAK;AAAA;AACP;AACF,GACF;AAAA;AAAA,EAGA,SAAA,EAAW;AAAA,IACT,IAAA,EAAM,SAAA;AAAA,IACN,UAAU,MAAA,CAAO,MAAA;AAAA,IACjB,WAAA,EAAa,6DAAA;AAAA,IACb,QAAA,EAAU,IAAA;AAAA,IACV,WAAA,EAAa,YAAA;AAAA,IACb,eAAA,EAAiB,YAAA;AAAA,IACjB,QAAA,EAAU;AAAA,MACR,SAAA,EAAW,KAAA;AAAA,MACX,SAAA,EAAW,IAAA;AAAA,MACX,gBAAA,EAAkB,IAAA;AAAA,MAClB,eAAA,EAAiB,IAAA;AAAA,MACjB,UAAA,EAAY,KAAA;AAAA,MACZ,gBAAA,EAAkB,KAAA;AAAA,MAClB,QAAA,EAAU,KAAA;AAAA,MACV,MAAA,EAAQ,IAAA;AAAA,MACR,KAAA,EAAO,KAAA;AAAA,MACP,KAAA,EAAO,KAAA;AAAA,MACP,QAAA,EAAU,IAAA;AAAA,MACV,aAAA,EAAe,IAAA;AAAA,MACf,KAAA,EAAO;AAAA,QACL,MAAA,EAAQ,GAAA;AAAA,QACR,IAAA,EAAM,IAAA;AAAA,QACN,KAAA,EAAO,IAAA;AAAA,QACP,GAAA,EAAK;AAAA,OACP;AAAA,MACA,MAAA,EAAQ;AAAA,QACN,MAAA,EAAQ,KAAA;AAAA,QACR,IAAA,EAAM,IAAA;AAAA,QACN,GAAA,EAAK;AAAA;AACP;AACF,GACF;AAAA,EAEA,cAAA,EAAgB;AAAA,IACd,IAAA,EAAM,cAAA;AAAA,IACN,UAAU,MAAA,CAAO,MAAA;AAAA,IACjB,WAAA,EAAa,4EAAA;AAAA,IACb,QAAA,EAAU,IAAA;AAAA,IACV,WAAA,EAAa,YAAA;AAAA,IACb,eAAA,EAAiB,YAAA;AAAA,IACjB,QAAA,EAAU;AAAA,MACR,SAAA,EAAW,KAAA;AAAA,MACX,SAAA,EAAW,IAAA;AAAA,MACX,gBAAA,EAAkB,IAAA;AAAA,MAClB,eAAA,EAAiB,IAAA;AAAA,MACjB,UAAA,EAAY,KAAA;AAAA,MACZ,gBAAA,EAAkB,KAAA;AAAA,MAClB,QAAA,EAAU,KAAA;AAAA,MACV,MAAA,EAAQ,IAAA;AAAA,MACR,KAAA,EAAO,KAAA;AAAA,MACP,KAAA,EAAO,KAAA;AAAA,MACP,QAAA,EAAU,IAAA;AAAA,MACV,aAAA,EAAe,IAAA;AAAA,MACf,KAAA,EAAO;AAAA,QACL,MAAA,EAAQ,GAAA;AAAA,QACR,IAAA,EAAM,IAAA;AAAA,QACN,KAAA,EAAO,IAAA;AAAA,QACP,GAAA,EAAK;AAAA,OACP;AAAA,MACA,MAAA,EAAQ;AAAA,QACN,MAAA,EAAQ,KAAA;AAAA,QACR,IAAA,EAAM,IAAA;AAAA,QACN,GAAA,EAAK;AAAA;AACP;AACF,GACF;AAAA,EAEA,cAAA,EAAgB;AAAA,IACd,IAAA,EAAM,cAAA;AAAA,IACN,UAAU,MAAA,CAAO,MAAA;AAAA,IACjB,WAAA,EAAa,iGAAA;AAAA,IACb,QAAA,EAAU,IAAA;AAAA,IACV,WAAA,EAAa,YAAA;AAAA,IACb,eAAA,EAAiB,YAAA;AAAA,IACjB,QAAA,EAAU;AAAA,MACR,SAAA,EAAW,KAAA;AAAA,MACX,SAAA,EAAW,IAAA;AAAA,MACX,gBAAA,EAAkB,IAAA;AAAA,MAClB,eAAA,EAAiB,IAAA;AAAA,MACjB,UAAA,EAAY,KAAA;AAAA,MACZ,gBAAA,EAAkB,KAAA;AAAA,MAClB,QAAA,EAAU,KAAA;AAAA,MACV,MAAA,EAAQ,IAAA;AAAA,MACR,KAAA,EAAO,KAAA;AAAA,MACP,KAAA,EAAO,KAAA;AAAA,MACP,QAAA,EAAU,IAAA;AAAA,MACV,aAAA,EAAe,IAAA;AAAA,MACf,KAAA,EAAO;AAAA,QACL,MAAA,EAAQ,GAAA;AAAA,QACR,IAAA,EAAM,IAAA;AAAA,QACN,KAAA,EAAO,IAAA;AAAA,QACP,GAAA,EAAK;AAAA,OACP;AAAA,MACA,MAAA,EAAQ;AAAA,QACN,MAAA,EAAQ,KAAA;AAAA,QACR,IAAA,EAAM,IAAA;AAAA,QACN,GAAA,EAAK;AAAA;AACP;AACF,GACF;AAAA;AAAA,EAGA,QAAA,EAAU;AAAA,IACR,IAAA,EAAM,QAAA;AAAA,IACN,UAAU,MAAA,CAAO,MAAA;AAAA,IACjB,WAAA,EAAa,qEAAA;AAAA,IACb,QAAA,EAAU,IAAA;AAAA,IACV,WAAA,EAAa,YAAA;AAAA,IACb,eAAA,EAAiB,YAAA;AAAA,IACjB,QAAA,EAAU;AAAA,MACR,SAAA,EAAW,KAAA;AAAA,MACX,SAAA,EAAW,IAAA;AAAA,MACX,gBAAA,EAAkB,IAAA;AAAA,MAClB,eAAA,EAAiB,IAAA;AAAA,MACjB,UAAA,EAAY,KAAA;AAAA,MACZ,gBAAA,EAAkB,IAAA;AAAA,MAClB,QAAA,EAAU,IAAA;AAAA,MACV,MAAA,EAAQ,IAAA;AAAA,MACR,KAAA,EAAO,IAAA;AAAA,MACP,KAAA,EAAO,KAAA;AAAA,MACP,QAAA,EAAU,IAAA;AAAA,MACV,aAAA,EAAe,IAAA;AAAA,MACf,KAAA,EAAO;AAAA,QACL,MAAA,EAAQ,KAAA;AAAA,QACR,IAAA,EAAM,IAAA;AAAA,QACN,KAAA,EAAO,IAAA;AAAA,QACP,KAAA,EAAO,IAAA;AAAA,QACP,GAAA,EAAK;AAAA,OACP;AAAA,MACA,MAAA,EAAQ;AAAA,QACN,MAAA,EAAQ,KAAA;AAAA,QACR,IAAA,EAAM,IAAA;AAAA,QACN,KAAA,EAAO,IAAA;AAAA,QACP,GAAA,EAAK;AAAA;AACP;AACF,GACF;AAAA,EAEA,aAAA,EAAe;AAAA,IACb,IAAA,EAAM,aAAA;AAAA,IACN,UAAU,MAAA,CAAO,MAAA;AAAA,IACjB,WAAA,EAAa,gDAAA;AAAA,IACb,QAAA,EAAU,IAAA;AAAA,IACV,WAAA,EAAa,YAAA;AAAA,IACb,eAAA,EAAiB,YAAA;AAAA,IACjB,QAAA,EAAU;AAAA,MACR,SAAA,EAAW,KAAA;AAAA,MACX,SAAA,EAAW,IAAA;AAAA,MACX,gBAAA,EAAkB,IAAA;AAAA,MAClB,eAAA,EAAiB,IAAA;AAAA,MACjB,UAAA,EAAY,IAAA;AAAA,MACZ,gBAAA,EAAkB,KAAA;AAAA,MAClB,QAAA,EAAU,IAAA;AAAA,MACV,MAAA,EAAQ,IAAA;AAAA,MACR,KAAA,EAAO,IAAA;AAAA,MACP,KAAA,EAAO,KAAA;AAAA,MACP,QAAA,EAAU,IAAA;AAAA,MACV,aAAA,EAAe,IAAA;AAAA,MACf,KAAA,EAAO;AAAA,QACL,MAAA,EAAQ,KAAA;AAAA,QACR,IAAA,EAAM,IAAA;AAAA,QACN,KAAA,EAAO,IAAA;AAAA,QACP,KAAA,EAAO,IAAA;AAAA,QACP,GAAA,EAAK;AAAA,OACP;AAAA,MACA,MAAA,EAAQ;AAAA,QACN,MAAA,EAAQ,KAAA;AAAA,QACR,IAAA,EAAM,IAAA;AAAA,QACN,KAAA,EAAO,IAAA;AAAA,QACP,GAAA,EAAK;AAAA;AACP;AACF,GACF;AAAA;AAAA,EAGA,SAAA,EAAW;AAAA,IACT,IAAA,EAAM,SAAA;AAAA,IACN,UAAU,MAAA,CAAO,MAAA;AAAA,IACjB,WAAA,EAAa,6DAAA;AAAA,IACb,QAAA,EAAU,IAAA;AAAA,IACV,WAAA,EAAa,YAAA;AAAA,IACb,eAAA,EAAiB,YAAA;AAAA,IACjB,QAAA,EAAU;AAAA,MACR,SAAA,EAAW,IAAA;AAAA,MACX,SAAA,EAAW,IAAA;AAAA,MACX,gBAAA,EAAkB,IAAA;AAAA,MAClB,eAAA,EAAiB,IAAA;AAAA,MACjB,UAAA,EAAY,KAAA;AAAA,MACZ,gBAAA,EAAkB,KAAA;AAAA,MAClB,QAAA,EAAU,KAAA;AAAA,MACV,MAAA,EAAQ,IAAA;AAAA,MACR,KAAA,EAAO,KAAA;AAAA,MACP,KAAA,EAAO,KAAA;AAAA,MACP,QAAA,EAAU,IAAA;AAAA,MACV,aAAA,EAAe,KAAA;AAAA,MACf,UAAA,EAAY;AAAA,QACV,WAAA,EAAa,KAAA;AAAA,QACb,IAAA,EAAM,KAAA;AAAA,QACN,gBAAA,EAAkB,KAAA;AAAA,QAClB,eAAA,EAAiB;AAAA,OACnB;AAAA,MACA,KAAA,EAAO;AAAA,QACL,MAAA,EAAQ,GAAA;AAAA,QACR,IAAA,EAAM,IAAA;AAAA,QACN,KAAA,EAAO,IAAA;AAAA,QACP,GAAA,EAAK;AAAA,OACP;AAAA,MACA,MAAA,EAAQ;AAAA,QACN,MAAA,EAAQ,GAAA;AAAA,QACR,IAAA,EAAM,IAAA;AAAA,QACN,GAAA,EAAK;AAAA;AACP;AACF,GACF;AAAA,EAEA,IAAA,EAAM;AAAA,IACJ,IAAA,EAAM,IAAA;AAAA,IACN,UAAU,MAAA,CAAO,MAAA;AAAA,IACjB,WAAA,EAAa,+CAAA;AAAA,IACb,QAAA,EAAU,IAAA;AAAA,IACV,WAAA,EAAa,YAAA;AAAA,IACb,eAAA,EAAiB,YAAA;AAAA,IACjB,QAAA,EAAU;AAAA,MACR,SAAA,EAAW,IAAA;AAAA,MACX,SAAA,EAAW,IAAA;AAAA,MACX,gBAAA,EAAkB,IAAA;AAAA,MAClB,eAAA,EAAiB,IAAA;AAAA,MACjB,UAAA,EAAY,KAAA;AAAA,MACZ,gBAAA,EAAkB,KAAA;AAAA,MAClB,QAAA,EAAU,KAAA;AAAA,MACV,MAAA,EAAQ,IAAA;AAAA,MACR,KAAA,EAAO,KAAA;AAAA,MACP,KAAA,EAAO,KAAA;AAAA,MACP,QAAA,EAAU,IAAA;AAAA,MACV,aAAA,EAAe,KAAA;AAAA,MACf,UAAA,EAAY;AAAA,QACV,WAAA,EAAa,KAAA;AAAA,QACb,IAAA,EAAM,KAAA;AAAA,QACN,gBAAA,EAAkB,KAAA;AAAA,QAClB,eAAA,EAAiB;AAAA,OACnB;AAAA,MACA,KAAA,EAAO;AAAA,QACL,MAAA,EAAQ,GAAA;AAAA,QACR,IAAA,EAAM,IAAA;AAAA,QACN,KAAA,EAAO,IAAA;AAAA,QACP,GAAA,EAAK;AAAA,OACP;AAAA,MACA,MAAA,EAAQ;AAAA,QACN,MAAA,EAAQ,GAAA;AAAA,QACR,IAAA,EAAM,IAAA;AAAA,QACN,GAAA,EAAK;AAAA;AACP;AACF,GACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,0BAAA,EAA4B;AAAA,IAC1B,IAAA,EAAM,0BAAA;AAAA,IACN,UAAU,MAAA,CAAO,SAAA;AAAA,IACjB,WAAA,EAAa,yEAAA;AAAA,IACb,QAAA,EAAU,IAAA;AAAA,IACV,WAAA,EAAa,YAAA;AAAA,IACb,eAAA,EAAiB,YAAA;AAAA,IACjB,QAAA,EAAU;AAAA,MACR,SAAA,EAAW,KAAA;AAAA,MACX,SAAA,EAAW,IAAA;AAAA,MACX,gBAAA,EAAkB,IAAA;AAAA,MAClB,eAAA,EAAiB,IAAA;AAAA,MACjB,UAAA,EAAY,KAAA;AAAA,MACZ,gBAAA,EAAkB,KAAA;AAAA,MAClB,QAAA,EAAU,KAAA;AAAA,MACV,MAAA,EAAQ,IAAA;AAAA,MACR,KAAA,EAAO,KAAA;AAAA,MACP,KAAA,EAAO,KAAA;AAAA,MACP,gBAAA,EAAkB,IAAA;AAAA,MAClB,QAAA,EAAU,IAAA;AAAA,MACV,aAAA,EAAe,IAAA;AAAA,MACf,KAAA,EAAO;AAAA,QACL,MAAA,EAAQ,GAAA;AAAA,QACR,IAAA,EAAM,IAAA;AAAA,QACN,KAAA,EAAO,IAAA;AAAA,QACP,GAAA,EAAK,CAAA;AAAA,QACL,SAAA,EAAW;AAAA,OACb;AAAA,MACA,MAAA,EAAQ;AAAA,QACN,MAAA,EAAQ,IAAA;AAAA,QACR,IAAA,EAAM,IAAA;AAAA,QACN,GAAA,EAAK;AAAA;AACP;AACF,GACF;AAAA,EAEA,4BAAA,EAA8B;AAAA,IAC5B,IAAA,EAAM,4BAAA;AAAA,IACN,UAAU,MAAA,CAAO,SAAA;AAAA,IACjB,WAAA,EAAa,sFAAA;AAAA,IACb,QAAA,EAAU,IAAA;AAAA,IACV,WAAA,EAAa,YAAA;AAAA,IACb,eAAA,EAAiB,YAAA;AAAA,IACjB,QAAA,EAAU;AAAA,MACR,SAAA,EAAW,KAAA;AAAA,MACX,SAAA,EAAW,IAAA;AAAA,MACX,gBAAA,EAAkB,IAAA;AAAA,MAClB,eAAA,EAAiB,IAAA;AAAA,MACjB,UAAA,EAAY,KAAA;AAAA,MACZ,gBAAA,EAAkB,KAAA;AAAA,MAClB,QAAA,EAAU,KAAA;AAAA,MACV,MAAA,EAAQ,IAAA;AAAA,MACR,KAAA,EAAO,KAAA;AAAA,MACP,KAAA,EAAO,KAAA;AAAA,MACP,gBAAA,EAAkB,IAAA;AAAA,MAClB,QAAA,EAAU,IAAA;AAAA,MACV,aAAA,EAAe,IAAA;AAAA,MACf,KAAA,EAAO;AAAA,QACL,MAAA,EAAQ,GAAA;AAAA,QACR,IAAA,EAAM,IAAA;AAAA,QACN,KAAA,EAAO,IAAA;AAAA,QACP,GAAA,EAAK,CAAA;AAAA,QACL,SAAA,EAAW;AAAA,OACb;AAAA,MACA,MAAA,EAAQ;AAAA,QACN,MAAA,EAAQ,IAAA;AAAA,QACR,IAAA,EAAM,IAAA;AAAA,QACN,GAAA,EAAK;AAAA;AACP;AACF,GACF;AAAA,EAEA,2BAAA,EAA6B;AAAA,IAC3B,IAAA,EAAM,2BAAA;AAAA,IACN,UAAU,MAAA,CAAO,SAAA;AAAA,IACjB,WAAA,EAAa,2EAAA;AAAA,IACb,QAAA,EAAU,IAAA;AAAA,IACV,WAAA,EAAa,YAAA;AAAA,IACb,eAAA,EAAiB,YAAA;AAAA,IACjB,QAAA,EAAU;AAAA,MACR,SAAA,EAAW,KAAA;AAAA,MACX,SAAA,EAAW,IAAA;AAAA,MACX,gBAAA,EAAkB,IAAA;AAAA,MAClB,eAAA,EAAiB,IAAA;AAAA,MACjB,UAAA,EAAY,KAAA;AAAA,MACZ,gBAAA,EAAkB,KAAA;AAAA,MAClB,QAAA,EAAU,KAAA;AAAA,MACV,MAAA,EAAQ,IAAA;AAAA,MACR,KAAA,EAAO,KAAA;AAAA,MACP,KAAA,EAAO,KAAA;AAAA,MACP,gBAAA,EAAkB,IAAA;AAAA,MAClB,QAAA,EAAU,IAAA;AAAA,MACV,aAAA,EAAe,IAAA;AAAA,MACf,KAAA,EAAO;AAAA,QACL,MAAA,EAAQ,GAAA;AAAA,QACR,IAAA,EAAM,IAAA;AAAA,QACN,KAAA,EAAO,IAAA;AAAA,QACP,GAAA,EAAK,CAAA;AAAA,QACL,SAAA,EAAW;AAAA,OACb;AAAA,MACA,MAAA,EAAQ;AAAA,QACN,MAAA,EAAQ,IAAA;AAAA,QACR,IAAA,EAAM,IAAA;AAAA,QACN,GAAA,EAAK;AAAA;AACP;AACF,GACF;AAAA;AAAA,EAGA,0BAAA,EAA4B;AAAA,IAC1B,IAAA,EAAM,0BAAA;AAAA,IACN,UAAU,MAAA,CAAO,SAAA;AAAA,IACjB,WAAA,EAAa,4EAAA;AAAA,IACb,QAAA,EAAU,IAAA;AAAA,IACV,WAAA,EAAa,YAAA;AAAA,IACb,eAAA,EAAiB,YAAA;AAAA,IACjB,QAAA,EAAU;AAAA,MACR,SAAA,EAAW,KAAA;AAAA,MACX,SAAA,EAAW,IAAA;AAAA,MACX,gBAAA,EAAkB,IAAA;AAAA,MAClB,eAAA,EAAiB,IAAA;AAAA,MACjB,UAAA,EAAY,KAAA;AAAA,MACZ,gBAAA,EAAkB,KAAA;AAAA,MAClB,QAAA,EAAU,KAAA;AAAA,MACV,MAAA,EAAQ,IAAA;AAAA,MACR,KAAA,EAAO,KAAA;AAAA,MACP,KAAA,EAAO,KAAA;AAAA,MACP,gBAAA,EAAkB,IAAA;AAAA,MAClB,QAAA,EAAU,IAAA;AAAA,MACV,aAAA,EAAe,IAAA;AAAA,MACf,KAAA,EAAO;AAAA,QACL,MAAA,EAAQ,GAAA;AAAA,QACR,IAAA,EAAM,IAAA;AAAA,QACN,KAAA,EAAO,IAAA;AAAA,QACP,GAAA,EAAK,EAAA;AAAA,QACL,SAAA,EAAW;AAAA,OACb;AAAA,MACA,MAAA,EAAQ;AAAA,QACN,MAAA,EAAQ,IAAA;AAAA,QACR,IAAA,EAAM,IAAA;AAAA,QACN,GAAA,EAAK;AAAA;AACP;AACF,GACF;AAAA,EAEA,0BAAA,EAA4B;AAAA,IAC1B,IAAA,EAAM,0BAAA;AAAA,IACN,UAAU,MAAA,CAAO,SAAA;AAAA,IACjB,WAAA,EAAa,mEAAA;AAAA,IACb,QAAA,EAAU,IAAA;AAAA,IACV,WAAA,EAAa,YAAA;AAAA,IACb,eAAA,EAAiB,YAAA;AAAA,IACjB,QAAA,EAAU;AAAA,MACR,SAAA,EAAW,KAAA;AAAA,MACX,SAAA,EAAW,IAAA;AAAA,MACX,gBAAA,EAAkB,IAAA;AAAA,MAClB,eAAA,EAAiB,IAAA;AAAA,MACjB,UAAA,EAAY,KAAA;AAAA,MACZ,gBAAA,EAAkB,KAAA;AAAA,MAClB,QAAA,EAAU,KAAA;AAAA,MACV,MAAA,EAAQ,IAAA;AAAA,MACR,KAAA,EAAO,KAAA;AAAA,MACP,KAAA,EAAO,KAAA;AAAA,MACP,gBAAA,EAAkB,IAAA;AAAA,MAClB,QAAA,EAAU,IAAA;AAAA,MACV,aAAA,EAAe,IAAA;AAAA,MACf,KAAA,EAAO;AAAA,QACL,MAAA,EAAQ,GAAA;AAAA;AAAA,QACR,IAAA,EAAM,IAAA;AAAA,QACN,KAAA,EAAO,IAAA;AAAA,QACP,GAAA,EAAK,CAAA;AAAA,QACL,SAAA,EAAW;AAAA,OACb;AAAA,MACA,MAAA,EAAQ;AAAA,QACN,MAAA,EAAQ,IAAA;AAAA,QACR,IAAA,EAAM,IAAA;AAAA,QACN,GAAA,EAAK;AAAA;AACP;AACF,GACF;AAAA,EAEA,4BAAA,EAA8B;AAAA,IAC5B,IAAA,EAAM,4BAAA;AAAA,IACN,UAAU,MAAA,CAAO,SAAA;AAAA,IACjB,WAAA,EAAa,qEAAA;AAAA,IACb,QAAA,EAAU,IAAA;AAAA,IACV,WAAA,EAAa,YAAA;AAAA,IACb,eAAA,EAAiB,YAAA;AAAA,IACjB,QAAA,EAAU;AAAA,MACR,SAAA,EAAW,KAAA;AAAA,MACX,SAAA,EAAW,IAAA;AAAA,MACX,gBAAA,EAAkB,IAAA;AAAA,MAClB,eAAA,EAAiB,IAAA;AAAA,MACjB,UAAA,EAAY,KAAA;AAAA,MACZ,gBAAA,EAAkB,KAAA;AAAA,MAClB,QAAA,EAAU,KAAA;AAAA,MACV,MAAA,EAAQ,IAAA;AAAA,MACR,KAAA,EAAO,KAAA;AAAA,MACP,KAAA,EAAO,KAAA;AAAA,MACP,gBAAA,EAAkB,IAAA;AAAA,MAClB,QAAA,EAAU,IAAA;AAAA,MACV,aAAA,EAAe,IAAA;AAAA,MACf,KAAA,EAAO;AAAA,QACL,MAAA,EAAQ,GAAA;AAAA,QACR,IAAA,EAAM,IAAA;AAAA,QACN,KAAA,EAAO,IAAA;AAAA,QACP,GAAA,EAAK,CAAA;AAAA,QACL,SAAA,EAAW;AAAA,OACb;AAAA,MACA,MAAA,EAAQ;AAAA,QACN,MAAA,EAAQ,IAAA;AAAA;AAAA,QACR,IAAA,EAAM,IAAA;AAAA,QACN,GAAA,EAAK;AAAA;AACP;AACF,GACF;AAAA;AAAA,EAGA,yBAAA,EAA2B;AAAA,IACzB,IAAA,EAAM,yBAAA;AAAA,IACN,UAAU,MAAA,CAAO,SAAA;AAAA,IACjB,WAAA,EAAa,qDAAA;AAAA,IACb,QAAA,EAAU,IAAA;AAAA,IACV,WAAA,EAAa,YAAA;AAAA,IACb,eAAA,EAAiB,YAAA;AAAA,IACjB,QAAA,EAAU;AAAA,MACR,SAAA,EAAW,KAAA;AAAA,MACX,SAAA,EAAW,IAAA;AAAA,MACX,gBAAA,EAAkB,IAAA;AAAA,MAClB,eAAA,EAAiB,IAAA;AAAA,MACjB,UAAA,EAAY,KAAA;AAAA,MACZ,gBAAA,EAAkB,KAAA;AAAA,MAClB,QAAA,EAAU,KAAA;AAAA,MACV,MAAA,EAAQ,IAAA;AAAA,MACR,KAAA,EAAO,KAAA;AAAA,MACP,KAAA,EAAO,KAAA;AAAA,MACP,gBAAA,EAAkB,KAAA;AAAA,MAClB,QAAA,EAAU,IAAA;AAAA,MACV,aAAA,EAAe,IAAA;AAAA,MACf,KAAA,EAAO;AAAA,QACL,MAAA,EAAQ,GAAA;AAAA,QACR,IAAA,EAAM,IAAA;AAAA,QACN,KAAA,EAAO,IAAA;AAAA,QACP,GAAA,EAAK,IAAA;AAAA,QACL,SAAA,EAAW;AAAA,OACb;AAAA,MACA,MAAA,EAAQ;AAAA,QACN,MAAA,EAAQ,IAAA;AAAA,QACR,IAAA,EAAM,IAAA;AAAA,QACN,GAAA,EAAK;AAAA;AACP;AACF,GACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,wBAAA,EAA0B;AAAA,IACxB,IAAA,EAAM,wBAAA;AAAA,IACN,UAAU,MAAA,CAAO,MAAA;AAAA,IACjB,WAAA,EAAa,6DAAA;AAAA,IACb,QAAA,EAAU,IAAA;AAAA,IACV,WAAA,EAAa,YAAA;AAAA,IACb,eAAA,EAAiB,YAAA;AAAA,IACjB,QAAA,EAAU;AAAA,MACR,SAAA,EAAW,IAAA;AAAA,MACX,SAAA,EAAW,IAAA;AAAA,MACX,gBAAA,EAAkB,IAAA;AAAA,MAClB,eAAA,EAAiB,IAAA;AAAA,MACjB,UAAA,EAAY,KAAA;AAAA,MACZ,gBAAA,EAAkB,KAAA;AAAA,MAClB,QAAA,EAAU,KAAA;AAAA,MACV,MAAA,EAAQ,IAAA;AAAA,MACR,KAAA,EAAO,IAAA;AAAA,MACP,KAAA,EAAO,IAAA;AAAA,MACP,QAAA,EAAU,IAAA;AAAA,MACV,aAAA,EAAe,IAAA;AAAA,MACf,KAAA,EAAO;AAAA,QACL,MAAA,EAAQ,GAAA;AAAA,QACR,IAAA,EAAM,IAAA;AAAA,QACN,KAAA,EAAO,IAAA;AAAA,QACP,KAAA,EAAO,IAAA;AAAA,QACP,KAAA,EAAO,IAAA;AAAA,QACP,GAAA,EAAK;AAAA,OACP;AAAA,MACA,MAAA,EAAQ;AAAA,QACN,MAAA,EAAQ,KAAA;AAAA,QACR,IAAA,EAAM,IAAA;AAAA,QACN,GAAA,EAAK;AAAA;AACP;AACF,GACF;AAAA,EAEA,sBAAA,EAAwB;AAAA,IACtB,IAAA,EAAM,sBAAA;AAAA,IACN,UAAU,MAAA,CAAO,MAAA;AAAA,IACjB,WAAA,EAAa,wDAAA;AAAA,IACb,QAAA,EAAU,IAAA;AAAA,IACV,WAAA,EAAa,YAAA;AAAA,IACb,eAAA,EAAiB,YAAA;AAAA,IACjB,QAAA,EAAU;AAAA,MACR,SAAA,EAAW,IAAA;AAAA,MACX,SAAA,EAAW,IAAA;AAAA,MACX,gBAAA,EAAkB,IAAA;AAAA,MAClB,eAAA,EAAiB,IAAA;AAAA,MACjB,UAAA,EAAY,KAAA;AAAA,MACZ,gBAAA,EAAkB,KAAA;AAAA,MAClB,QAAA,EAAU,KAAA;AAAA,MACV,MAAA,EAAQ,IAAA;AAAA,MACR,KAAA,EAAO,IAAA;AAAA,MACP,KAAA,EAAO,IAAA;AAAA,MACP,QAAA,EAAU,IAAA;AAAA,MACV,aAAA,EAAe,IAAA;AAAA,MACf,KAAA,EAAO;AAAA,QACL,MAAA,EAAQ,GAAA;AAAA,QACR,IAAA,EAAM,IAAA;AAAA,QACN,KAAA,EAAO,IAAA;AAAA,QACP,KAAA,EAAO,IAAA;AAAA,QACP,KAAA,EAAO,IAAA;AAAA,QACP,GAAA,EAAK;AAAA,OACP;AAAA,MACA,MAAA,EAAQ;AAAA,QACN,MAAA,EAAQ,KAAA;AAAA,QACR,IAAA,EAAM,IAAA;AAAA,QACN,GAAA,EAAK;AAAA;AACP;AACF,GACF;AAAA,EAEA,4BAAA,EAA8B;AAAA,IAC5B,IAAA,EAAM,4BAAA;AAAA,IACN,UAAU,MAAA,CAAO,MAAA;AAAA,IACjB,WAAA,EAAa,wCAAA;AAAA,IACb,QAAA,EAAU,IAAA;AAAA,IACV,WAAA,EAAa,YAAA;AAAA,IACb,eAAA,EAAiB,YAAA;AAAA,IACjB,QAAA,EAAU;AAAA,MACR,SAAA,EAAW,IAAA;AAAA,MACX,SAAA,EAAW,IAAA;AAAA,MACX,gBAAA,EAAkB,KAAA;AAAA,MAClB,eAAA,EAAiB,KAAA;AAAA,MACjB,UAAA,EAAY,KAAA;AAAA,MACZ,gBAAA,EAAkB,KAAA;AAAA,MAClB,QAAA,EAAU,KAAA;AAAA,MACV,MAAA,EAAQ,IAAA;AAAA,MACR,KAAA,EAAO,KAAA;AAAA,MACP,KAAA,EAAO,KAAA;AAAA,MACP,QAAA,EAAU,IAAA;AAAA,MACV,aAAA,EAAe,IAAA;AAAA,MACf,KAAA,EAAO;AAAA,QACL,MAAA,EAAQ,GAAA;AAAA,QACR,IAAA,EAAM,IAAA;AAAA,QACN,KAAA,EAAO,IAAA;AAAA,QACP,GAAA,EAAK;AAAA,OACP;AAAA,MACA,MAAA,EAAQ;AAAA,QACN,MAAA,EAAQ,KAAA;AAAA,QACR,IAAA,EAAM,IAAA;AAAA,QACN,KAAA,EAAO,IAAA;AAAA,QACP,GAAA,EAAK;AAAA;AACP;AACF,GACF;AAAA;AAAA,EAGA,gBAAA,EAAkB;AAAA,IAChB,IAAA,EAAM,gBAAA;AAAA,IACN,UAAU,MAAA,CAAO,MAAA;AAAA,IACjB,WAAA,EAAa,+DAAA;AAAA,IACb,QAAA,EAAU,IAAA;AAAA,IACV,WAAA,EAAa,YAAA;AAAA,IACb,eAAA,EAAiB,YAAA;AAAA,IACjB,QAAA,EAAU;AAAA,MACR,SAAA,EAAW,IAAA;AAAA,MACX,SAAA,EAAW,IAAA;AAAA,MACX,gBAAA,EAAkB,IAAA;AAAA,MAClB,eAAA,EAAiB,IAAA;AAAA,MACjB,UAAA,EAAY,KAAA;AAAA,MACZ,gBAAA,EAAkB,KAAA;AAAA,MAClB,QAAA,EAAU,KAAA;AAAA,MACV,MAAA,EAAQ,IAAA;AAAA,MACR,KAAA,EAAO,IAAA;AAAA,MACP,KAAA,EAAO,IAAA;AAAA,MACP,QAAA,EAAU,IAAA;AAAA,MACV,aAAA,EAAe,IAAA;AAAA,MACf,KAAA,EAAO;AAAA,QACL,MAAA,EAAQ,GAAA;AAAA,QACR,IAAA,EAAM,IAAA;AAAA,QACN,KAAA,EAAO,IAAA;AAAA,QACP,KAAA,EAAO,IAAA;AAAA,QACP,KAAA,EAAO,IAAA;AAAA,QACP,GAAA,EAAK;AAAA,OACP;AAAA,MACA,MAAA,EAAQ;AAAA,QACN,MAAA,EAAQ,KAAA;AAAA,QACR,IAAA,EAAM,IAAA;AAAA,QACN,GAAA,EAAK;AAAA;AACP;AACF,GACF;AAAA,EAEA,kBAAA,EAAoB;AAAA,IAClB,IAAA,EAAM,kBAAA;AAAA,IACN,UAAU,MAAA,CAAO,MAAA;AAAA,IACjB,WAAA,EAAa,qDAAA;AAAA,IACb,QAAA,EAAU,IAAA;AAAA,IACV,WAAA,EAAa,YAAA;AAAA,IACb,eAAA,EAAiB,YAAA;AAAA,IACjB,QAAA,EAAU;AAAA,MACR,SAAA,EAAW,IAAA;AAAA,MACX,SAAA,EAAW,IAAA;AAAA,MACX,gBAAA,EAAkB,IAAA;AAAA,MAClB,eAAA,EAAiB,IAAA;AAAA,MACjB,UAAA,EAAY,KAAA;AAAA,MACZ,gBAAA,EAAkB,KAAA;AAAA,MAClB,QAAA,EAAU,KAAA;AAAA,MACV,MAAA,EAAQ,IAAA;AAAA,MACR,KAAA,EAAO,IAAA;AAAA,MACP,KAAA,EAAO,IAAA;AAAA,MACP,QAAA,EAAU,IAAA;AAAA,MACV,aAAA,EAAe,IAAA;AAAA,MACf,KAAA,EAAO;AAAA,QACL,MAAA,EAAQ,GAAA;AAAA,QACR,IAAA,EAAM,IAAA;AAAA,QACN,KAAA,EAAO,IAAA;AAAA,QACP,KAAA,EAAO,IAAA;AAAA,QACP,KAAA,EAAO,IAAA;AAAA,QACP,GAAA,EAAK;AAAA,OACP;AAAA,MACA,MAAA,EAAQ;AAAA,QACN,MAAA,EAAQ,KAAA;AAAA,QACR,IAAA,EAAM,IAAA;AAAA,QACN,GAAA,EAAK;AAAA;AACP;AACF,GACF;AAAA,EAEA,uBAAA,EAAyB;AAAA,IACvB,IAAA,EAAM,uBAAA;AAAA,IACN,UAAU,MAAA,CAAO,MAAA;AAAA,IACjB,WAAA,EAAa,qEAAA;AAAA,IACb,QAAA,EAAU,IAAA;AAAA,IACV,WAAA,EAAa,YAAA;AAAA,IACb,eAAA,EAAiB,YAAA;AAAA,IACjB,QAAA,EAAU;AAAA,MACR,SAAA,EAAW,IAAA;AAAA,MACX,SAAA,EAAW,IAAA;AAAA,MACX,gBAAA,EAAkB,IAAA;AAAA,MAClB,eAAA,EAAiB,IAAA;AAAA,MACjB,UAAA,EAAY,KAAA;AAAA,MACZ,gBAAA,EAAkB,KAAA;AAAA,MAClB,QAAA,EAAU,KAAA;AAAA,MACV,MAAA,EAAQ,IAAA;AAAA,MACR,KAAA,EAAO,IAAA;AAAA,MACP,KAAA,EAAO,IAAA;AAAA,MACP,QAAA,EAAU,IAAA;AAAA,MACV,aAAA,EAAe,IAAA;AAAA,MACf,KAAA,EAAO;AAAA,QACL,MAAA,EAAQ,GAAA;AAAA,QACR,IAAA,EAAM,IAAA;AAAA,QACN,KAAA,EAAO,IAAA;AAAA,QACP,KAAA,EAAO,IAAA;AAAA,QACP,KAAA,EAAO,IAAA;AAAA,QACP,GAAA,EAAK;AAAA,OACP;AAAA,MACA,MAAA,EAAQ;AAAA,QACN,MAAA,EAAQ,KAAA;AAAA,QACR,IAAA,EAAM,IAAA;AAAA,QACN,GAAA,EAAK;AAAA;AACP;AACF,GACF;AAAA,EAEA,wBAAA,EAA0B;AAAA,IACxB,IAAA,EAAM,wBAAA;AAAA,IACN,UAAU,MAAA,CAAO,MAAA;AAAA,IACjB,WAAA,EAAa,oCAAA;AAAA,IACb,QAAA,EAAU,IAAA;AAAA,IACV,WAAA,EAAa,YAAA;AAAA,IACb,eAAA,EAAiB,YAAA;AAAA,IACjB,QAAA,EAAU;AAAA,MACR,SAAA,EAAW,IAAA;AAAA,MACX,SAAA,EAAW,IAAA;AAAA,MACX,gBAAA,EAAkB,KAAA;AAAA,MAClB,eAAA,EAAiB,KAAA;AAAA,MACjB,UAAA,EAAY,KAAA;AAAA,MACZ,gBAAA,EAAkB,KAAA;AAAA,MAClB,QAAA,EAAU,KAAA;AAAA,MACV,MAAA,EAAQ,IAAA;AAAA,MACR,KAAA,EAAO,KAAA;AAAA,MACP,KAAA,EAAO,KAAA;AAAA,MACP,QAAA,EAAU,IAAA;AAAA,MACV,aAAA,EAAe,IAAA;AAAA,MACf,KAAA,EAAO;AAAA,QACL,MAAA,EAAQ,GAAA;AAAA,QACR,IAAA,EAAM,IAAA;AAAA,QACN,KAAA,EAAO,IAAA;AAAA,QACP,GAAA,EAAK;AAAA,OACP;AAAA,MACA,MAAA,EAAQ;AAAA,QACN,MAAA,EAAQ,KAAA;AAAA,QACR,IAAA,EAAM,IAAA;AAAA,QACN,KAAA,EAAO,IAAA;AAAA,QACP,GAAA,EAAK;AAAA;AACP;AACF;AAEJ;AAOO,SAAS,aAAa,SAAA,EAAgD;AAC3E,EAAA,OAAO,eAAe,SAAS,CAAA;AACjC;AAOO,SAAS,kBAAkB,MAAA,EAAuC;AACvE,EAAA,OAAO,MAAA,CAAO,OAAO,cAAc,CAAA,CAAE,OAAO,CAAC,KAAA,KAAU,KAAA,CAAM,QAAA,KAAa,MAAM,CAAA;AAClF;AAMO,SAAS,eAAA,GAAqC;AACnD,EAAA,OAAO,MAAA,CAAO,OAAO,cAAc,CAAA,CAAE,OAAO,CAAC,KAAA,KAAU,MAAM,QAAQ,CAAA;AACvE;AAUO,SAAS,aAAA,CACd,KAAA,EACA,WAAA,EACA,YAAA,EACA,OAAA,EACe;AACf,EAAA,MAAM,SAAA,GAAY,aAAa,KAAK,CAAA;AACpC,EAAA,IAAI,CAAC,SAAA,EAAW;AACd,IAAA,OAAO,IAAA;AAAA,EACT;AAEA,EAAA,MAAM,QAAA,GAAW,OAAA,EAAS,cAAA,IAAkB,SAAA,CAAU,SAAS,KAAA,CAAM,SAAA,KAAc,MAAA,GAC/E,SAAA,CAAU,QAAA,CAAS,KAAA,CAAM,SAAA,GACzB,SAAA,CAAU,SAAS,KAAA,CAAM,GAAA;AAE7B,EAAA,MAAM,SAAA,GAAY,SAAA,CAAU,QAAA,CAAS,MAAA,CAAO,GAAA;AAE5C,EAAA,MAAM,SAAA,GAAa,cAAc,GAAA,GAAa,QAAA;AAC9C,EAAA,MAAM,UAAA,GAAc,eAAe,GAAA,GAAa,SAAA;AAEhD,EAAA,OAAO,SAAA,GAAY,UAAA;AACrB;;;AC9lCO,IAAe,oBAAf,MAA2D;AAAA;AAAA,EAQhE,MAAM,OAAA,CAAQ,aAAA,EAAuB,UAAA,EAA8C;AACjF,IAAA,OAAO,CAAA;AAAA,EACT;AAAA,EAEA,MAAM,WAAW,OAAA,EAAuC;AAAA,EAExD;AAAA,EAEA,OAAA,GAAgB;AAAA,EAEhB;AAAA,EAEA,QAAA,GAAoB;AAClB,IAAA,OAAO,MAAA;AAAA,EACT;AAAA,EAEA,aAAa,MAAA,EAAuB;AAAA,EAEpC;AACF,CAAA;;;ACxDA,IAAM,eAAA,GAAqD;AAAA,EACzD,GAAA,EAAK,CAAA;AAAA,EACL,MAAA,EAAQ,CAAA;AAAA,EACR,IAAA,EAAM,CAAA;AAAA,EACN,QAAA,EAAU;AACZ,CAAA;AAKA,IAAM,cAAA,GAAkD;AAAA,EACtD,UAAA,EAAY,EAAA;AAAA,EACZ,cAAA,EAAgB,GAAA;AAAA,EAChB,eAAA,EAAiB,QAAA;AAAA,EACjB,cAAA,EAAgB,KAAA;AAAA,EAChB,UAAA,EAAY;AACd,CAAA;AAgBO,IAAM,qBAAA,GAAN,cAAoC,iBAAA,CAAkB;AAAA,EAClD,IAAA,GAAO,mBAAA;AAAA,EACP,QAAA,GAAW,CAAA;AAAA;AAAA,EACX,WAAA,GAAc,IAAA;AAAA,EAEf,OAAA,uBAA2C,GAAA,EAAI;AAAA,EAC/C,MAAA;AAAA,EACA,SAAA,GAAY,KAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOpB,WAAA,CAAY,MAAA,GAAgC,EAAC,EAAG;AAC9C,IAAA,KAAA,EAAM;AACN,IAAA,IAAA,CAAK,MAAA,GAAS,EAAE,GAAG,cAAA,EAAgB,GAAG,MAAA,EAAO;AAAA,EAC/C;AAAA;AAAA;AAAA;AAAA,EAKA,IAAI,WAAA,GAAuB;AACzB,IAAA,OAAO,IAAA,CAAK,SAAA;AAAA,EACd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAYA,GAAA,CAAI,GAAA,EAAa,WAAA,EAAqB,KAAA,EAAgB,QAAA,EAAoC;AACxF,IAAA,IAAA,CAAK,kBAAA,EAAmB;AAExB,IAAA,MAAM,KAAA,GAAwB;AAAA,MAC5B,GAAA;AAAA,MACA,WAAA;AAAA,MACA,KAAA;AAAA,MACA,SAAA,EAAW,KAAK,GAAA,EAAI;AAAA,MACpB,QAAA,EAAU,QAAA,IAAY,IAAA,CAAK,MAAA,CAAO;AAAA,KACpC;AAEA,IAAA,IAAA,CAAK,OAAA,CAAQ,GAAA,CAAI,GAAA,EAAK,KAAK,CAAA;AAG3B,IAAA,IAAA,CAAK,iBAAA,EAAkB;AAAA,EACzB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,IAAI,GAAA,EAAkC;AACpC,IAAA,IAAA,CAAK,kBAAA,EAAmB;AACxB,IAAA,OAAO,IAAA,CAAK,OAAA,CAAQ,GAAA,CAAI,GAAG,CAAA,EAAG,KAAA;AAAA,EAChC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,IAAI,GAAA,EAAsB;AACxB,IAAA,IAAA,CAAK,kBAAA,EAAmB;AACxB,IAAA,OAAO,IAAA,CAAK,OAAA,CAAQ,GAAA,CAAI,GAAG,CAAA;AAAA,EAC7B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,OAAO,GAAA,EAAsB;AAC3B,IAAA,IAAA,CAAK,kBAAA,EAAmB;AACxB,IAAA,OAAO,IAAA,CAAK,OAAA,CAAQ,MAAA,CAAO,GAAG,CAAA;AAAA,EAChC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,IAAA,GAAoG;AAClG,IAAA,IAAA,CAAK,kBAAA,EAAmB;AACxB,IAAA,OAAO,KAAA,CAAM,KAAK,IAAA,CAAK,OAAA,CAAQ,QAAQ,CAAA,CAAE,GAAA,CAAI,CAAC,CAAA,MAAO;AAAA,MACnD,KAAK,CAAA,CAAE,GAAA;AAAA,MACP,aAAa,CAAA,CAAE,WAAA;AAAA,MACf,UAAU,CAAA,CAAE,QAAA;AAAA,MACZ,WAAW,CAAA,CAAE;AAAA,KACf,CAAE,CAAA;AAAA,EACJ;AAAA;AAAA;AAAA;AAAA,EAKA,KAAA,GAAc;AACZ,IAAA,IAAA,CAAK,kBAAA,EAAmB;AACxB,IAAA,IAAA,CAAK,QAAQ,KAAA,EAAM;AAAA,EACrB;AAAA;AAAA;AAAA;AAAA,EAKA,IAAI,IAAA,GAAe;AACjB,IAAA,OAAO,KAAK,OAAA,CAAQ,IAAA;AAAA,EACtB;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,MAAM,YAAA,GAAkD;AACtD,IAAA,IAAA,CAAK,kBAAA,EAAmB;AAExB,IAAA,IAAI,IAAA,CAAK,OAAA,CAAQ,IAAA,KAAS,CAAA,EAAG;AAC3B,MAAA,OAAO,IAAA;AAAA,IACT;AAEA,IAAA,MAAM,OAAA,GAAU,KAAK,aAAA,EAAc;AAEnC,IAAA,OAAO;AAAA,MACL,MAAM,IAAA,CAAK,IAAA;AAAA,MACX,OAAA;AAAA,MACA,UAAU,IAAA,CAAK,QAAA;AAAA,MACf,aAAa,IAAA,CAAK,WAAA;AAAA,MAClB,QAAA,EAAU;AAAA,QACR,UAAA,EAAY,KAAK,OAAA,CAAQ;AAAA;AAC3B,KACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAYA,MAAe,OAAA,CAAQ,YAAA,EAAsB,SAAA,EAA6C;AACxF,IAAA,IAAA,CAAK,kBAAA,EAAmB;AAExB,IAAA,MAAM,aAAA,GAAgB,KAAK,aAAA,EAAc;AACzC,IAAA,MAAM,YAAA,GAAe,SAAA,CAAU,cAAA,CAAe,aAAa,CAAA;AAE3D,IAAA,IAAI,gBAAgB,YAAA,EAAc;AAChC,MAAA,OAAO,CAAA;AAAA,IACT;AAGA,IAAA,MAAM,aAAA,GAAgB,KAAK,2BAAA,EAA4B;AAGvD,IAAA,KAAA,MAAW,SAAS,aAAA,EAAe;AAEjC,MAAA,IAAI,KAAA,CAAM,aAAa,UAAA,EAAY;AACjC,QAAA;AAAA,MACF;AAEA,MAAA,IAAA,CAAK,OAAA,CAAQ,MAAA,CAAO,KAAA,CAAM,GAAG,CAAA;AAE7B,MAAA,MAAM,cAAA,GAAiB,KAAK,aAAA,EAAc;AAC1C,MAAA,MAAM,aAAA,GAAgB,SAAA,CAAU,cAAA,CAAe,cAAc,CAAA;AAE7D,MAAA,IAAI,iBAAiB,YAAA,EAAc;AACjC,QAAA;AAAA,MACF;AAAA,IACF;AAEA,IAAA,MAAM,YAAA,GAAe,KAAK,aAAA,EAAc;AACxC,IAAA,MAAM,WAAA,GAAc,SAAA,CAAU,cAAA,CAAe,YAAY,CAAA;AAEzD,IAAA,OAAO,IAAA,CAAK,GAAA,CAAI,CAAA,EAAG,YAAA,GAAe,WAAW,CAAA;AAAA,EAC/C;AAAA;AAAA;AAAA;AAAA,EAKS,QAAA,GAA2C;AAClD,IAAA,OAAO;AAAA,MACL,SAAS,KAAA,CAAM,IAAA,CAAK,IAAA,CAAK,OAAA,CAAQ,QAAQ,CAAA;AAAA,MACzC,QAAQ,IAAA,CAAK;AAAA,KACf;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOS,aAAa,KAAA,EAAsB;AAC1C,IAAA,IAAA,CAAK,kBAAA,EAAmB;AAExB,IAAA,IAAI,CAAC,KAAA,IAAS,OAAO,KAAA,KAAU,QAAA,EAAU;AACvC,MAAA;AAAA,IACF;AAEA,IAAA,MAAM,UAAA,GAAa,KAAA;AAEnB,IAAA,IAAI,WAAW,OAAA,IAAW,KAAA,CAAM,OAAA,CAAQ,UAAA,CAAW,OAAO,CAAA,EAAG;AAC3D,MAAA,IAAA,CAAK,QAAQ,KAAA,EAAM;AACnB,MAAA,KAAA,MAAW,KAAA,IAAS,WAAW,OAAA,EAAS;AACtC,QAAA,IAAI,KAAA,CAAM,GAAA,IAAO,OAAO,KAAA,CAAM,QAAQ,QAAA,EAAU;AAC9C,UAAA,IAAA,CAAK,OAAA,CAAQ,GAAA,CAAI,KAAA,CAAM,GAAA,EAAK,KAAK,CAAA;AAAA,QACnC;AAAA,MACF;AAAA,IACF;AAEA,IAAA,IAAI,UAAA,CAAW,MAAA,IAAU,OAAO,UAAA,CAAW,WAAW,QAAA,EAAU;AAC9D,MAAA,IAAA,CAAK,SAAS,EAAE,GAAG,cAAA,EAAgB,GAAG,WAAW,MAAA,EAAO;AAAA,IAC1D;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKS,OAAA,GAAgB;AACvB,IAAA,IAAA,CAAK,QAAQ,KAAA,EAAM;AACnB,IAAA,IAAA,CAAK,SAAA,GAAY,IAAA;AAAA,EACnB;AAAA;AAAA;AAAA;AAAA;AAAA,EAOQ,aAAA,GAAwB;AAC9B,IAAA,IAAI,IAAA,CAAK,OAAA,CAAQ,IAAA,KAAS,CAAA,EAAG;AAC3B,MAAA,OAAO,EAAA;AAAA,IACT;AAEA,IAAA,MAAM,KAAA,GAAkB;AAAA,MACtB,KAAK,MAAA,CAAO,UAAA;AAAA,MACZ,mEAAA;AAAA,MACA;AAAA,KACF;AAEA,IAAA,KAAA,MAAW,KAAA,IAAS,IAAA,CAAK,OAAA,CAAQ,MAAA,EAAO,EAAG;AACzC,MAAA,KAAA,CAAM,IAAA,CAAK,CAAA,IAAA,EAAO,KAAA,CAAM,GAAG,CAAA,CAAE,CAAA;AAC7B,MAAA,KAAA,CAAM,IAAA,CAAK,MAAM,WAAW,CAAA;AAG5B,MAAA,MAAM,QAAA,GAAW,OAAO,KAAA,CAAM,KAAA,KAAU,QAAA,GACpC,KAAA,CAAM,KAAA,GACN,IAAA,CAAK,SAAA,CAAU,KAAA,CAAM,KAAA,EAAO,IAAA,EAAM,CAAC,CAAA;AAEvC,MAAA,KAAA,CAAM,KAAK,SAAS,CAAA;AACpB,MAAA,KAAA,CAAM,KAAK,QAAQ,CAAA;AACnB,MAAA,KAAA,CAAM,KAAK,KAAK,CAAA;AAEhB,MAAA,IAAI,IAAA,CAAK,OAAO,cAAA,EAAgB;AAC9B,QAAA,MAAM,IAAA,GAAO,IAAI,IAAA,CAAK,KAAA,CAAM,SAAS,CAAA;AACrC,QAAA,KAAA,CAAM,IAAA,CAAK,CAAA,UAAA,EAAa,IAAA,CAAK,WAAA,EAAa,CAAA,CAAA,CAAG,CAAA;AAAA,MAC/C;AAEA,MAAA,KAAA,CAAM,KAAK,EAAE,CAAA;AAAA,IACf;AAEA,IAAA,OAAO,KAAA,CAAM,KAAK,IAAI,CAAA;AAAA,EACxB;AAAA;AAAA;AAAA;AAAA,EAKQ,2BAAA,GAAgD;AACtD,IAAA,OAAO,KAAA,CAAM,IAAA,CAAK,IAAA,CAAK,OAAA,CAAQ,MAAA,EAAQ,CAAA,CAAE,IAAA,CAAK,CAAC,CAAA,EAAG,CAAA,KAAM;AAEtD,MAAA,MAAM,eAAe,eAAA,CAAgB,CAAA,CAAE,QAAQ,CAAA,GAAI,eAAA,CAAgB,EAAE,QAAQ,CAAA;AAC7E,MAAA,IAAI,iBAAiB,CAAA,EAAG;AACtB,QAAA,OAAO,YAAA;AAAA,MACT;AAEA,MAAA,OAAO,CAAA,CAAE,YAAY,CAAA,CAAE,SAAA;AAAA,IACzB,CAAC,CAAA;AAAA,EACH;AAAA;AAAA;AAAA;AAAA,EAKQ,iBAAA,GAA0B;AAChC,IAAA,IAAI,IAAA,CAAK,OAAA,CAAQ,IAAA,IAAQ,IAAA,CAAK,OAAO,UAAA,EAAY;AAC/C,MAAA;AAAA,IACF;AAEA,IAAA,MAAM,MAAA,GAAS,KAAK,2BAAA,EAA4B;AAEhD,IAAA,OAAO,IAAA,CAAK,QAAQ,IAAA,GAAO,IAAA,CAAK,OAAO,UAAA,IAAc,MAAA,CAAO,SAAS,CAAA,EAAG;AACtE,MAAA,MAAM,OAAA,GAAU,OAAO,KAAA,EAAM;AAG7B,MAAA,IAAI,OAAA,CAAQ,aAAa,UAAA,EAAY;AACnC,QAAA;AAAA,MACF;AAEA,MAAA,IAAA,CAAK,OAAA,CAAQ,MAAA,CAAO,OAAA,CAAQ,GAAG,CAAA;AAAA,IACjC;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,kBAAA,GAA2B;AACjC,IAAA,IAAI,KAAK,SAAA,EAAW;AAClB,MAAA,MAAM,IAAI,MAAM,0CAA0C,CAAA;AAAA,IAC5D;AAAA,EACF;AACF;;;ACrYO,IAAM,oBAAA,GAA+C;AAAA,EAC1D,IAAA,EAAM,UAAA;AAAA,EACN,QAAA,EAAU;AAAA,IACR,IAAA,EAAM,aAAA;AAAA,IACN,WAAA,EAAa,CAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,kEAAA,CAAA;AAAA,IAcb,UAAA,EAAY;AAAA,MACV,IAAA,EAAM,QAAA;AAAA,MACN,UAAA,EAAY;AAAA,QACV,GAAA,EAAK;AAAA,UACH,IAAA,EAAM,QAAA;AAAA,UACN,WAAA,EAAa;AAAA,SACf;AAAA,QACA,WAAA,EAAa;AAAA,UACX,IAAA,EAAM,QAAA;AAAA,UACN,WAAA,EAAa;AAAA,SACf;AAAA,QACA,KAAA,EAAO;AAAA,UACL,WAAA,EAAa;AAAA,SACf;AAAA,QACA,QAAA,EAAU;AAAA,UACR,IAAA,EAAM,QAAA;AAAA,UACN,IAAA,EAAM,CAAC,KAAA,EAAO,QAAA,EAAU,QAAQ,UAAU,CAAA;AAAA,UAC1C,WAAA,EAAa;AAAA;AACf,OACF;AAAA,MACA,QAAA,EAAU,CAAC,KAAA,EAAO,aAAA,EAAe,OAAO;AAAA;AAC1C;AAEJ,CAAA;AAKO,IAAM,uBAAA,GAAkD;AAAA,EAC7D,IAAA,EAAM,UAAA;AAAA,EACN,QAAA,EAAU;AAAA,IACR,IAAA,EAAM,gBAAA;AAAA,IACN,WAAA,EAAa,CAAA;;AAAA;AAAA;AAAA;AAAA,iCAAA,CAAA;AAAA,IAMb,UAAA,EAAY;AAAA,MACV,IAAA,EAAM,QAAA;AAAA,MACN,UAAA,EAAY;AAAA,QACV,GAAA,EAAK;AAAA,UACH,IAAA,EAAM,QAAA;AAAA,UACN,WAAA,EAAa;AAAA;AACf,OACF;AAAA,MACA,QAAA,EAAU,CAAC,KAAK;AAAA;AAClB;AAEJ,CAAA;AAKO,IAAM,qBAAA,GAAgD;AAAA,EAC3D,IAAA,EAAM,UAAA;AAAA,EACN,QAAA,EAAU;AAAA,IACR,IAAA,EAAM,cAAA;AAAA,IACN,WAAA,EAAa,CAAA;;AAAA;AAAA,0DAAA,CAAA;AAAA,IAIb,UAAA,EAAY;AAAA,MACV,IAAA,EAAM,QAAA;AAAA,MACN,YAAY,EAAC;AAAA,MACb,UAAU;AAAC;AACb;AAEJ,CAAA;AASO,SAAS,0BAAA,GAA6C;AAC3D,EAAA,OAAO;AAAA;AAAA,IAEL;AAAA,MACE,UAAA,EAAY,oBAAA;AAAA,MACZ,OAAA,EAAS,OAAO,IAAA,EAA+B,OAAA,KAA0B;AACvE,QAAA,MAAM,MAAA,GAAS,oBAAA,CAAqB,OAAA,EAAS,aAAa,CAAA;AAE1D,QAAA,MAAM,MAAM,IAAA,CAAK,GAAA;AACjB,QAAA,MAAM,cAAc,IAAA,CAAK,WAAA;AACzB,QAAA,MAAM,QAAQ,IAAA,CAAK,KAAA;AACnB,QAAA,MAAM,WAAW,IAAA,CAAK,QAAA;AAEtB,QAAA,MAAA,CAAO,GAAA,CAAI,GAAA,EAAK,WAAA,EAAa,KAAA,EAAO,QAAQ,CAAA;AAE5C,QAAA,OAAO;AAAA,UACL,OAAA,EAAS,IAAA;AAAA,UACT,GAAA;AAAA,UACA,UAAU,QAAA,IAAY,QAAA;AAAA,UACtB,OAAA,EAAS,WAAW,GAAG,CAAA,iBAAA;AAAA,SACzB;AAAA,MACF,CAAA;AAAA,MACA,WAAA,EAAa,EAAE,SAAA,EAAW,KAAA,EAAM;AAAA,MAChC,MAAA,EAAQ,EAAE,YAAA,EAAc,OAAA,EAAQ;AAAA,MAChC,UAAA,EAAY;AAAA,QACV,KAAA,EAAO,QAAA;AAAA;AAAA,QACP,SAAA,EAAW;AAAA,OACb;AAAA,MACA,YAAA,EAAc,CAAC,IAAA,KAAS,IAAA,CAAK;AAAA,KAC/B;AAAA;AAAA,IAGA;AAAA,MACE,UAAA,EAAY,uBAAA;AAAA,MACZ,OAAA,EAAS,OAAO,IAAA,EAA+B,OAAA,KAA0B;AACvE,QAAA,MAAM,MAAA,GAAS,oBAAA,CAAqB,OAAA,EAAS,gBAAgB,CAAA;AAE7D,QAAA,MAAM,MAAM,IAAA,CAAK,GAAA;AACjB,QAAA,MAAM,OAAA,GAAU,MAAA,CAAO,MAAA,CAAO,GAAG,CAAA;AAEjC,QAAA,OAAO;AAAA,UACL,OAAA,EAAS,IAAA;AAAA,UACT,GAAA;AAAA,UACA,OAAA;AAAA,UACA,SAAS,OAAA,GAAU,CAAA,SAAA,EAAY,GAAG,CAAA,mBAAA,CAAA,GAAwB,QAAQ,GAAG,CAAA,eAAA;AAAA,SACvE;AAAA,MACF,CAAA;AAAA,MACA,WAAA,EAAa,EAAE,SAAA,EAAW,KAAA,EAAM;AAAA,MAChC,MAAA,EAAQ,EAAE,YAAA,EAAc,OAAA,EAAQ;AAAA,MAChC,UAAA,EAAY;AAAA,QACV,KAAA,EAAO,QAAA;AAAA,QACP,SAAA,EAAW;AAAA,OACb;AAAA,MACA,YAAA,EAAc,CAAC,IAAA,KAAS,IAAA,CAAK;AAAA,KAC/B;AAAA;AAAA,IAGA;AAAA,MACE,UAAA,EAAY,qBAAA;AAAA,MACZ,OAAA,EAAS,OAAO,KAAA,EAAgC,OAAA,KAA0B;AACxE,QAAA,MAAM,MAAA,GAAS,oBAAA,CAAqB,OAAA,EAAS,cAAc,CAAA;AAE3D,QAAA,MAAM,OAAA,GAAU,OAAO,IAAA,EAAK;AAE5B,QAAA,OAAO;AAAA,UACL,OAAA,EAAS,OAAA,CAAQ,GAAA,CAAI,CAAC,CAAA,MAAO;AAAA,YAC3B,KAAK,CAAA,CAAE,GAAA;AAAA,YACP,aAAa,CAAA,CAAE,WAAA;AAAA,YACf,UAAU,CAAA,CAAE,QAAA;AAAA,YACZ,WAAW,IAAI,IAAA,CAAK,CAAA,CAAE,SAAS,EAAE,WAAA;AAAY,WAC/C,CAAE,CAAA;AAAA,UACF,OAAO,OAAA,CAAQ;AAAA,SACjB;AAAA,MACF,CAAA;AAAA,MACA,WAAA,EAAa,EAAE,SAAA,EAAW,IAAA,EAAM,OAAO,GAAA,EAAI;AAAA,MAC3C,MAAA,EAAQ,EAAE,YAAA,EAAc,OAAA,EAAQ;AAAA,MAChC,UAAA,EAAY;AAAA,QACV,KAAA,EAAO,QAAA;AAAA,QACP,SAAA,EAAW;AAAA,OACb;AAAA,MACA,cAAc,MAAM;AAAA;AACtB,GACF;AACF;AAmBO,SAAS,sBAAsB,MAAA,EAGpC;AACA,EAAA,MAAM,MAAA,GAAS,IAAI,qBAAA,CAAsB,MAAM,CAAA;AAC/C,EAAA,MAAM,QAAQ,0BAAA,EAA2B;AAEzC,EAAA,OAAO,EAAE,QAAQ,KAAA,EAAM;AACzB;AAoBO,SAAS,oBAAA,CACd,cACA,MAAA,EACuB;AACvB,EAAA,MAAM,EAAE,MAAA,EAAQ,KAAA,EAAM,GAAI,sBAAsB,MAAM,CAAA;AAGtD,EAAA,YAAA,CAAa,eAAe,MAAM,CAAA;AAGlC,EAAA,KAAA,MAAW,QAAQ,KAAA,EAAO;AACxB,IAAA,YAAA,CAAa,KAAA,CAAM,SAAS,IAAI,CAAA;AAAA,EAClC;AAGA,EAAC,aAA4E,eAAA,GAAkB,MAAA;AAE/F,EAAA,OAAO,MAAA;AACT;AAOA,SAAS,oBAAA,CAAqB,SAAkC,QAAA,EAAyC;AACvG,EAAA,IAAI,CAAC,OAAA,EAAS;AACZ,IAAA,MAAM,IAAI,kBAAA;AAAA,MACR,QAAA;AAAA,MACA;AAAA,KACF;AAAA,EACF;AAGA,EAAA,MAAM,SAAU,OAAA,CAAsE,eAAA;AAEtF,EAAA,IAAI,CAAC,MAAA,EAAQ;AACX,IAAA,MAAM,IAAI,kBAAA;AAAA,MACR,QAAA;AAAA,MACA;AAAA,KACF;AAAA,EACF;AAEA,EAAA,OAAO,MAAA;AACT;AChQA,SAAS,uBAAA,GAAkC;AACzC,EAAA,MAAMC,YAAW,OAAA,CAAQ,QAAA;AAEzB,EAAA,IAAIA,cAAa,OAAA,EAAS;AAExB,IAAA,MAAM,OAAA,GAAU,OAAA,CAAQ,GAAA,CAAI,OAAA,IAAW,QAAQ,GAAA,CAAI,YAAA;AACnD,IAAA,IAAI,OAAA,EAAS;AACX,MAAA,OAAO,IAAA,CAAK,OAAA,EAAS,WAAA,EAAa,QAAQ,CAAA;AAAA,IAC5C;AAAA,EACF;AAGA,EAAA,OAAO,IAAA,CAAK,OAAA,EAAQ,EAAG,YAAA,EAAc,QAAQ,CAAA;AAC/C;AAMA,SAAS,gBAAgB,OAAA,EAAyB;AAGhD,EAAA,OAAO,OAAA,CACJ,OAAA,CAAQ,iBAAA,EAAmB,GAAG,EAC9B,OAAA,CAAQ,KAAA,EAAO,GAAG,CAAA,CAClB,OAAA,CAAQ,QAAA,EAAU,EAAE,CAAA,CACpB,aAAY,IACV,SAAA;AACP;AAKO,IAAM,oCAAN,MAAkF;AAAA,EACtE,SAAA;AAAA,EACA,QAAA;AAAA,EACA,OAAA;AAAA,EAEjB,YAAY,MAAA,EAAiD;AAC3D,IAAA,IAAA,CAAK,UAAU,MAAA,CAAO,OAAA;AACtB,IAAA,MAAM,WAAA,GAAc,eAAA,CAAgB,MAAA,CAAO,OAAO,CAAA;AAClD,IAAA,MAAM,OAAA,GAAU,MAAA,CAAO,aAAA,IAAiB,uBAAA,EAAwB;AAChE,IAAA,MAAM,QAAA,GAAW,OAAO,QAAA,IAAY,wBAAA;AAEpC,IAAA,IAAA,CAAK,SAAA,GAAY,IAAA,CAAK,OAAA,EAAS,WAAW,CAAA;AAC1C,IAAA,IAAA,CAAK,QAAA,GAAW,IAAA,CAAK,IAAA,CAAK,SAAA,EAAW,QAAQ,CAAA;AAAA,EAC/C;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,IAAA,GAA+B;AACnC,IAAA,IAAI;AACF,MAAA,MAAM,UAAU,MAAMvB,QAAAA,CAAG,QAAA,CAAS,IAAA,CAAK,UAAU,OAAO,CAAA;AACxD,MAAA,OAAO,OAAA,CAAQ,MAAK,IAAK,IAAA;AAAA,IAC3B,SAAS,KAAA,EAAgB;AACvB,MAAA,IAAI,iBAAiB,KAAA,IAAS,MAAA,IAAU,KAAA,IAAU,KAAA,CAAgC,SAAS,QAAA,EAAU;AACnG,QAAA,OAAO,IAAA;AAAA,MACT;AACA,MAAA,MAAM,KAAA;AAAA,IACR;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,MAAM,KAAK,OAAA,EAAgC;AAEzC,IAAA,MAAM,KAAK,eAAA,EAAgB;AAG3B,IAAA,MAAM,QAAA,GAAW,CAAA,EAAG,IAAA,CAAK,QAAQ,CAAA,IAAA,CAAA;AACjC,IAAA,IAAI;AACF,MAAA,MAAMA,QAAAA,CAAG,SAAA,CAAU,QAAA,EAAU,OAAA,EAAS,OAAO,CAAA;AAC7C,MAAA,MAAMA,QAAAA,CAAG,MAAA,CAAO,QAAA,EAAU,IAAA,CAAK,QAAQ,CAAA;AAAA,IACzC,SAAS,KAAA,EAAO;AAEd,MAAA,IAAI;AACF,QAAA,MAAMA,QAAAA,CAAG,OAAO,QAAQ,CAAA;AAAA,MAC1B,CAAA,CAAA,MAAQ;AAAA,MAER;AACA,MAAA,MAAM,KAAA;AAAA,IACR;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,MAAA,GAAwB;AAC5B,IAAA,IAAI;AACF,MAAA,MAAMA,QAAAA,CAAG,MAAA,CAAO,IAAA,CAAK,QAAQ,CAAA;AAAA,IAC/B,SAAS,KAAA,EAAgB;AACvB,MAAA,IAAI,iBAAiB,KAAA,IAAS,MAAA,IAAU,KAAA,IAAU,KAAA,CAAgC,SAAS,QAAA,EAAU;AACnG,QAAA,MAAM,KAAA;AAAA,MACR;AAAA,IAEF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,MAAA,GAA2B;AAC/B,IAAA,IAAI;AACF,MAAA,MAAMA,QAAAA,CAAG,MAAA,CAAO,IAAA,CAAK,QAAQ,CAAA;AAC7B,MAAA,OAAO,IAAA;AAAA,IACT,CAAA,CAAA,MAAQ;AACN,MAAA,OAAO,KAAA;AAAA,IACT;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,OAAA,GAAkB;AAChB,IAAA,OAAO,IAAA,CAAK,QAAA;AAAA,EACd;AAAA;AAAA;AAAA;AAAA,EAKA,UAAA,GAAqB;AACnB,IAAA,OAAO,IAAA,CAAK,OAAA;AAAA,EACd;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,eAAA,GAAiC;AAC7C,IAAA,IAAI;AACF,MAAA,MAAMA,SAAG,KAAA,CAAM,IAAA,CAAK,WAAW,EAAE,SAAA,EAAW,MAAM,CAAA;AAAA,IACpD,SAAS,KAAA,EAAgB;AACvB,MAAA,IAAI,iBAAiB,KAAA,IAAS,MAAA,IAAU,KAAA,IAAU,KAAA,CAAgC,SAAS,QAAA,EAAU;AACnG,QAAA,MAAM,KAAA;AAAA,MACR;AAAA,IACF;AAAA,EACF;AACF;;;AC9HA,IAAMwB,eAAAA,GAAiB;AAAA,EACrB,SAAA,EAAW;AACb,CAAA;AAKA,SAAS,wBAAwBtB,KAAAA,EAAsB;AACrD,EAAA,OAAO,CAAA;;AAAA;AAAA;;AAAA;AAAA,kBAAA,EAMWA,KAAI;;AAAA;AAAA,CAAA;AAIxB;AAWO,IAAM,4BAAA,GAAN,cAA2C,iBAAA,CAAkB;AAAA,EACzD,IAAA,GAAO,yBAAA;AAAA,EACP,QAAA,GAAW,CAAA;AAAA;AAAA,EACX,WAAA,GAAc,KAAA;AAAA,EAEf,QAAA,GAA0B,IAAA;AAAA,EAC1B,MAAA,GAAS,KAAA;AAAA,EACT,YAAA,GAAe,KAAA;AAAA,EACf,UAAA,GAAa,KAAA;AAAA,EAEJ,OAAA;AAAA,EACA,SAAA;AAAA,EACA,OAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOjB,YAAY,MAAA,EAAsC;AAChD,IAAA,KAAA,EAAM;AACN,IAAA,IAAA,CAAK,UAAU,MAAA,CAAO,OAAA;AACtB,IAAA,IAAA,CAAK,SAAA,GAAY,MAAA,CAAO,SAAA,IAAasB,eAAAA,CAAe,SAAA;AAGpD,IAAA,IAAA,CAAK,OAAA,GAAU,MAAA,CAAO,OAAA,IAAW,IAAI,iCAAA,CAAkC;AAAA,MACrE,SAAS,MAAA,CAAO;AAAA,KACjB,CAAA;AAAA,EACH;AAAA;AAAA;AAAA;AAAA,EAKA,IAAI,WAAA,GAAuB;AACzB,IAAA,OAAO,IAAA,CAAK,UAAA;AAAA,EACd;AAAA;AAAA;AAAA;AAAA,EAKA,IAAI,aAAA,GAAyB;AAC3B,IAAA,OAAO,IAAA,CAAK,YAAA;AAAA,EACd;AAAA;AAAA;AAAA;AAAA,EAKA,IAAI,OAAA,GAAmB;AACrB,IAAA,OAAO,IAAA,CAAK,MAAA;AAAA,EACd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,MAAM,UAAA,GAA4B;AAChC,IAAA,IAAI,IAAA,CAAK,YAAA,IAAgB,IAAA,CAAK,UAAA,EAAY;AACxC,MAAA;AAAA,IACF;AAEA,IAAA,IAAI;AACF,MAAA,IAAA,CAAK,QAAA,GAAW,MAAM,IAAA,CAAK,OAAA,CAAQ,IAAA,EAAK;AACxC,MAAA,IAAA,CAAK,YAAA,GAAe,IAAA;AACpB,MAAA,IAAA,CAAK,MAAA,GAAS,KAAA;AAAA,IAChB,SAAS,KAAA,EAAO;AAEd,MAAA,OAAA,CAAQ,IAAA,CAAK,CAAA,kDAAA,EAAqD,IAAA,CAAK,OAAO,MAAM,KAAK,CAAA;AACzF,MAAA,IAAA,CAAK,QAAA,GAAW,IAAA;AAChB,MAAA,IAAA,CAAK,YAAA,GAAe,IAAA;AAAA,IACtB;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUA,MAAM,IAAI,OAAA,EAAmC;AAC3C,IAAA,IAAA,CAAK,kBAAA,EAAmB;AAExB,IAAA,IAAI,OAAA,CAAQ,MAAA,GAAS,IAAA,CAAK,SAAA,EAAW;AACnC,MAAA,OAAO,KAAA;AAAA,IACT;AAEA,IAAA,IAAA,CAAK,QAAA,GAAW,OAAA,CAAQ,IAAA,EAAK,IAAK,IAAA;AAClC,IAAA,IAAA,CAAK,MAAA,GAAS,IAAA;AAGd,IAAA,IAAI,KAAK,QAAA,EAAU;AACjB,MAAA,MAAM,IAAA,CAAK,OAAA,CAAQ,IAAA,CAAK,IAAA,CAAK,QAAQ,CAAA;AAAA,IACvC,CAAA,MAAO;AACL,MAAA,MAAM,IAAA,CAAK,QAAQ,MAAA,EAAO;AAAA,IAC5B;AAEA,IAAA,IAAA,CAAK,MAAA,GAAS,KAAA;AACd,IAAA,OAAO,IAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,MAAM,OAAO,OAAA,EAAmC;AAC9C,IAAA,IAAA,CAAK,kBAAA,EAAmB;AAExB,IAAA,MAAM,cAAA,GAAiB,QAAQ,IAAA,EAAK;AACpC,IAAA,IAAI,CAAC,cAAA,EAAgB;AACnB,MAAA,OAAO,IAAA;AAAA,IACT;AAEA,IAAA,MAAM,cAAA,GAAiB,KAAK,QAAA,IAAY,EAAA;AACxC,IAAA,MAAM,UAAA,GAAa,cAAA,GACf,CAAA,EAAG,cAAc;;AAAA,EAAO,cAAc,CAAA,CAAA,GACtC,cAAA;AAEJ,IAAA,IAAI,UAAA,CAAW,MAAA,GAAS,IAAA,CAAK,SAAA,EAAW;AACtC,MAAA,OAAO,KAAA;AAAA,IACT;AAEA,IAAA,IAAA,CAAK,QAAA,GAAW,UAAA;AAChB,IAAA,IAAA,CAAK,MAAA,GAAS,IAAA;AAGd,IAAA,MAAM,IAAA,CAAK,OAAA,CAAQ,IAAA,CAAK,IAAA,CAAK,QAAQ,CAAA;AACrC,IAAA,IAAA,CAAK,MAAA,GAAS,KAAA;AAEd,IAAA,OAAO,IAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,GAAA,GAAqB;AACnB,IAAA,IAAA,CAAK,kBAAA,EAAmB;AACxB,IAAA,OAAO,IAAA,CAAK,QAAA;AAAA,EACd;AAAA;AAAA;AAAA;AAAA,EAKA,GAAA,GAAe;AACb,IAAA,IAAA,CAAK,kBAAA,EAAmB;AACxB,IAAA,OAAO,IAAA,CAAK,QAAA,KAAa,IAAA,IAAQ,IAAA,CAAK,SAAS,MAAA,GAAS,CAAA;AAAA,EAC1D;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,KAAA,GAAuB;AAC3B,IAAA,IAAA,CAAK,kBAAA,EAAmB;AAExB,IAAA,IAAA,CAAK,QAAA,GAAW,IAAA;AAChB,IAAA,IAAA,CAAK,MAAA,GAAS,IAAA;AAEd,IAAA,MAAM,IAAA,CAAK,QAAQ,MAAA,EAAO;AAC1B,IAAA,IAAA,CAAK,MAAA,GAAS,KAAA;AAAA,EAChB;AAAA;AAAA;AAAA;AAAA,EAKA,OAAA,GAAkB;AAChB,IAAA,OAAO,IAAA,CAAK,QAAQ,OAAA,EAAQ;AAAA,EAC9B;AAAA;AAAA;AAAA;AAAA,EAKA,UAAA,GAAqB;AACnB,IAAA,OAAO,IAAA,CAAK,OAAA;AAAA,EACd;AAAA;AAAA;AAAA;AAAA,EAKA,SAAA,GAAoB;AAClB,IAAA,OAAO,IAAA,CAAK,UAAU,MAAA,IAAU,CAAA;AAAA,EAClC;AAAA;AAAA;AAAA;AAAA,EAKA,YAAA,GAAuB;AACrB,IAAA,OAAO,IAAA,CAAK,SAAA;AAAA,EACd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,MAAM,YAAA,GAAkD;AACtD,IAAA,IAAA,CAAK,kBAAA,EAAmB;AAGxB,IAAA,IAAI,CAAC,KAAK,YAAA,EAAc;AACtB,MAAA,MAAM,KAAK,UAAA,EAAW;AAAA,IACxB;AAEA,IAAA,IAAI,CAAC,KAAK,QAAA,EAAU;AAClB,MAAA,OAAO,IAAA;AAAA,IACT;AAGA,IAAA,MAAM,WAAA,GAAc,uBAAA,CAAwB,IAAA,CAAK,OAAA,CAAQ,SAAS,CAAA;AAClE,IAAA,MAAM,OAAA,GAAU,GAAG,WAAW;AAAA,EAAK,KAAK,QAAQ,CAAA,CAAA;AAEhD,IAAA,OAAO;AAAA,MACL,MAAM,IAAA,CAAK,IAAA;AAAA,MACX,OAAA;AAAA,MACA,UAAU,IAAA,CAAK,QAAA;AAAA,MACf,aAAa,IAAA,CAAK,WAAA;AAAA,MAClB,QAAA,EAAU;AAAA,QACR,SAAS,IAAA,CAAK,OAAA;AAAA,QACd,MAAA,EAAQ,KAAK,QAAA,CAAS,MAAA;AAAA,QACtB,IAAA,EAAM,IAAA,CAAK,OAAA,CAAQ,OAAA;AAAQ;AAC7B,KACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAe,OAAA,CAAQ,aAAA,EAAuB,UAAA,EAA8C;AAE1F,IAAA,OAAO,CAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKS,QAAA,GAAkD;AACzD,IAAA,OAAO;AAAA,MACL,SAAS,IAAA,CAAK,QAAA;AAAA,MACd,OAAO,IAAA,CAAK,MAAA;AAAA,MACZ,SAAS,IAAA,CAAK;AAAA,KAChB;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAMS,aAAa,KAAA,EAAsB;AAC1C,IAAA,IAAA,CAAK,kBAAA,EAAmB;AAExB,IAAA,IAAI,CAAC,KAAA,IAAS,OAAO,KAAA,KAAU,QAAA,EAAU;AACvC,MAAA;AAAA,IACF;AAEA,IAAA,MAAM,UAAA,GAAa,KAAA;AAEnB,IAAA,IAAI,aAAa,UAAA,EAAY;AAC3B,MAAA,IAAA,CAAK,WAAW,UAAA,CAAW,OAAA;AAAA,IAC7B;AACA,IAAA,IAAI,WAAW,UAAA,EAAY;AACzB,MAAA,IAAA,CAAK,SAAS,UAAA,CAAW,KAAA;AAAA,IAC3B;AAGA,IAAA,IAAA,CAAK,YAAA,GAAe,IAAA;AAAA,EACtB;AAAA;AAAA;AAAA;AAAA,EAKS,OAAA,GAAgB;AACvB,IAAA,IAAA,CAAK,QAAA,GAAW,IAAA;AAChB,IAAA,IAAA,CAAK,YAAA,GAAe,KAAA;AACpB,IAAA,IAAA,CAAK,UAAA,GAAa,IAAA;AAAA,EACpB;AAAA;AAAA;AAAA;AAAA;AAAA,EAOQ,kBAAA,GAA2B;AACjC,IAAA,IAAI,KAAK,UAAA,EAAY;AACnB,MAAA,MAAM,IAAI,MAAM,iDAAiD,CAAA;AAAA,IACnE;AAAA,EACF;AACF;;;AC1VO,IAAM,yBAAA,GAAoD;AAAA,EAC/D,IAAA,EAAM,UAAA;AAAA,EACN,QAAA,EAAU;AAAA,IACR,IAAA,EAAM,kBAAA;AAAA,IACN,WAAA,EAAa,CAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA,mDAAA,CAAA;AAAA,IAWb,UAAA,EAAY;AAAA,MACV,IAAA,EAAM,QAAA;AAAA,MACN,UAAA,EAAY;AAAA,QACV,OAAA,EAAS;AAAA,UACP,IAAA,EAAM,QAAA;AAAA,UACN,WAAA,EAAa;AAAA;AACf,OACF;AAAA,MACA,QAAA,EAAU,CAAC,SAAS;AAAA;AACtB;AAEJ,CAAA;AAKO,IAAM,4BAAA,GAAuD;AAAA,EAClE,IAAA,EAAM,UAAA;AAAA,EACN,QAAA,EAAU;AAAA,IACR,IAAA,EAAM,qBAAA;AAAA,IACN,WAAA,EAAa,CAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA,mDAAA,CAAA;AAAA,IAQb,UAAA,EAAY;AAAA,MACV,IAAA,EAAM,QAAA;AAAA,MACN,UAAA,EAAY;AAAA,QACV,OAAA,EAAS;AAAA,UACP,IAAA,EAAM,QAAA;AAAA,UACN,WAAA,EAAa;AAAA;AACf,OACF;AAAA,MACA,QAAA,EAAU,CAAC,SAAS;AAAA;AACtB;AAEJ,CAAA;AAKO,IAAM,yBAAA,GAAoD;AAAA,EAC/D,IAAA,EAAM,UAAA;AAAA,EACN,QAAA,EAAU;AAAA,IACR,IAAA,EAAM,kBAAA;AAAA,IACN,WAAA,EAAa,CAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,WAAA,CAAA;AAAA,IAOb,UAAA,EAAY;AAAA,MACV,IAAA,EAAM,QAAA;AAAA,MACN,YAAY,EAAC;AAAA,MACb,UAAU;AAAC;AACb;AAEJ,CAAA;AAKO,IAAM,2BAAA,GAAsD;AAAA,EACjE,IAAA,EAAM,UAAA;AAAA,EACN,QAAA,EAAU;AAAA,IACR,IAAA,EAAM,oBAAA;AAAA,IACN,WAAA,EAAa,CAAA;;AAAA;AAAA,+BAAA,CAAA;AAAA,IAIb,UAAA,EAAY;AAAA,MACV,IAAA,EAAM,QAAA;AAAA,MACN,UAAA,EAAY;AAAA,QACV,OAAA,EAAS;AAAA,UACP,IAAA,EAAM,SAAA;AAAA,UACN,WAAA,EAAa;AAAA;AACf,OACF;AAAA,MACA,QAAA,EAAU,CAAC,SAAS;AAAA;AACtB;AAEJ,CAAA;AASO,SAAS,iCAAA,GAAoD;AAClE,EAAA,OAAO;AAAA;AAAA,IAEL;AAAA,MACE,UAAA,EAAY,yBAAA;AAAA,MACZ,OAAA,EAAS,OAAO,IAAA,EAA+B,OAAA,KAA0B;AACvE,QAAA,MAAM,MAAA,GAASC,qBAAAA,CAAqB,OAAA,EAAS,kBAAkB,CAAA;AAE/D,QAAA,MAAM,UAAU,IAAA,CAAK,OAAA;AAErB,QAAA,IAAI,CAAC,OAAA,IAAW,OAAA,CAAQ,IAAA,EAAK,CAAE,WAAW,CAAA,EAAG;AAC3C,UAAA,OAAO;AAAA,YACL,KAAA,EAAO;AAAA,WACT;AAAA,QACF;AAEA,QAAA,MAAM,OAAA,GAAU,MAAM,MAAA,CAAO,GAAA,CAAI,OAAO,CAAA;AAExC,QAAA,IAAI,CAAC,OAAA,EAAS;AACZ,UAAA,OAAO;AAAA,YACL,OAAO,CAAA,+BAAA,EAAkC,MAAA,CAAO,cAAc,CAAA,iBAAA,EAAoB,QAAQ,MAAM,CAAA,CAAA;AAAA,WAClG;AAAA,QACF;AAEA,QAAA,OAAO;AAAA,UACL,OAAA,EAAS,IAAA;AAAA,UACT,OAAA,EAAS,iCAAA;AAAA,UACT,IAAA,EAAM,OAAO,OAAA,EAAQ;AAAA,UACrB,MAAA,EAAQ,OAAO,SAAA;AAAU,SAC3B;AAAA,MACF,CAAA;AAAA,MACA,WAAA,EAAa,EAAE,SAAA,EAAW,KAAA,EAAM;AAAA,MAChC,MAAA,EAAQ,EAAE,YAAA,EAAc,OAAA,EAAQ;AAAA,MAChC,UAAA,EAAY;AAAA,QACV,KAAA,EAAO,QAAA;AAAA;AAAA,QACP,SAAA,EAAW;AAAA,OACb;AAAA,MACA,cAAc,MAAM;AAAA,KACtB;AAAA;AAAA,IAGA;AAAA,MACE,UAAA,EAAY,4BAAA;AAAA,MACZ,OAAA,EAAS,OAAO,IAAA,EAA+B,OAAA,KAA0B;AACvE,QAAA,MAAM,MAAA,GAASA,qBAAAA,CAAqB,OAAA,EAAS,qBAAqB,CAAA;AAElE,QAAA,MAAM,UAAU,IAAA,CAAK,OAAA;AAErB,QAAA,IAAI,CAAC,OAAA,IAAW,OAAA,CAAQ,IAAA,EAAK,CAAE,WAAW,CAAA,EAAG;AAC3C,UAAA,OAAO;AAAA,YACL,KAAA,EAAO;AAAA,WACT;AAAA,QACF;AAEA,QAAA,MAAM,OAAA,GAAU,MAAM,MAAA,CAAO,MAAA,CAAO,OAAO,CAAA;AAE3C,QAAA,IAAI,CAAC,OAAA,EAAS;AACZ,UAAA,OAAO;AAAA,YACL,KAAA,EAAO,CAAA,+BAAA,EAAkC,MAAA,CAAO,YAAA,EAAc,CAAA,sBAAA,EAAyB,MAAA,CAAO,SAAA,EAAW,CAAA,UAAA,EAAa,OAAA,CAAQ,MAAM,CAAA,CAAA;AAAA,WACtI;AAAA,QACF;AAEA,QAAA,OAAO;AAAA,UACL,OAAA,EAAS,IAAA;AAAA,UACT,OAAA,EAAS,+BAAA;AAAA,UACT,SAAA,EAAW,OAAO,SAAA;AAAU,SAC9B;AAAA,MACF,CAAA;AAAA,MACA,WAAA,EAAa,EAAE,SAAA,EAAW,KAAA,EAAM;AAAA,MAChC,MAAA,EAAQ,EAAE,YAAA,EAAc,OAAA,EAAQ;AAAA,MAChC,UAAA,EAAY;AAAA,QACV,KAAA,EAAO,QAAA;AAAA,QACP,SAAA,EAAW;AAAA,OACb;AAAA,MACA,cAAc,MAAM;AAAA,KACtB;AAAA;AAAA,IAGA;AAAA,MACE,UAAA,EAAY,yBAAA;AAAA,MACZ,OAAA,EAAS,OAAO,KAAA,EAAgC,OAAA,KAA0B;AACxE,QAAA,MAAM,MAAA,GAASA,qBAAAA,CAAqB,OAAA,EAAS,kBAAkB,CAAA;AAE/D,QAAA,MAAM,OAAA,GAAU,OAAO,GAAA,EAAI;AAE3B,QAAA,IAAI,CAAC,OAAA,EAAS;AACZ,UAAA,OAAO;AAAA,YACL,MAAA,EAAQ,KAAA;AAAA,YACR,OAAA,EAAS,4BAAA;AAAA,YACT,IAAA,EAAM,OAAO,OAAA;AAAQ,WACvB;AAAA,QACF;AAEA,QAAA,OAAO;AAAA,UACL,MAAA,EAAQ,IAAA;AAAA,UACR,OAAA;AAAA,UACA,QAAQ,OAAA,CAAQ,MAAA;AAAA,UAChB,SAAA,EAAW,OAAO,YAAA,EAAa;AAAA,UAC/B,IAAA,EAAM,OAAO,OAAA;AAAQ,SACvB;AAAA,MACF,CAAA;AAAA,MACA,WAAA,EAAa,EAAE,SAAA,EAAW,IAAA,EAAM,OAAO,GAAA,EAAK;AAAA,MAC5C,MAAA,EAAQ,EAAE,YAAA,EAAc,UAAA,EAAW;AAAA,MACnC,UAAA,EAAY;AAAA,QACV,KAAA,EAAO,QAAA;AAAA,QACP,SAAA,EAAW;AAAA,OACb;AAAA,MACA,cAAc,MAAM;AAAA,KACtB;AAAA;AAAA,IAGA;AAAA,MACE,UAAA,EAAY,2BAAA;AAAA,MACZ,OAAA,EAAS,OAAO,IAAA,EAA+B,OAAA,KAA0B;AACvE,QAAA,MAAM,MAAA,GAASA,qBAAAA,CAAqB,OAAA,EAAS,oBAAoB,CAAA;AAEjE,QAAA,MAAM,UAAU,IAAA,CAAK,OAAA;AAErB,QAAA,IAAI,YAAY,IAAA,EAAM;AACpB,UAAA,OAAO;AAAA,YACL,KAAA,EAAO;AAAA,WACT;AAAA,QACF;AAEA,QAAA,MAAM,UAAA,GAAa,OAAO,GAAA,EAAI;AAC9B,QAAA,MAAM,OAAO,KAAA,EAAM;AAEnB,QAAA,OAAO;AAAA,UACL,OAAA,EAAS,IAAA;AAAA,UACT,OAAA,EAAS,aACL,mCAAA,GACA,0BAAA;AAAA,UACJ,IAAA,EAAM,OAAO,OAAA;AAAQ,SACvB;AAAA,MACF,CAAA;AAAA,MACA,WAAA,EAAa,EAAE,SAAA,EAAW,KAAA,EAAM;AAAA,MAChC,MAAA,EAAQ,EAAE,YAAA,EAAc,OAAA,EAAQ;AAAA,MAChC,UAAA,EAAY;AAAA,QACV,KAAA,EAAO,QAAA;AAAA,QACP,SAAA,EAAW;AAAA,OACb;AAAA,MACA,cAAc,MAAM;AAAA;AACtB,GACF;AACF;AAmBO,SAAS,6BAA6B,MAAA,EAG3C;AACA,EAAA,MAAM,MAAA,GAAS,IAAI,4BAAA,CAA6B,MAAM,CAAA;AACtD,EAAA,MAAM,QAAQ,iCAAA,EAAkC;AAEhD,EAAA,OAAO,EAAE,QAAQ,KAAA,EAAM;AACzB;AAoBO,SAAS,2BAAA,CACd,cACA,MAAA,EAC8B;AAC9B,EAAA,MAAM,EAAE,MAAA,EAAQ,KAAA,EAAM,GAAI,6BAA6B,MAAM,CAAA;AAG7D,EAAA,YAAA,CAAa,eAAe,MAAM,CAAA;AAGlC,EAAA,KAAA,MAAW,QAAQ,KAAA,EAAO;AACxB,IAAA,YAAA,CAAa,KAAA,CAAM,SAAS,IAAI,CAAA;AAAA,EAClC;AAGA,EAAC,aAA0F,sBAAA,GAAyB,MAAA;AAEpH,EAAA,OAAO,MAAA;AACT;AAOA,SAASA,qBAAAA,CAAqB,SAAkC,QAAA,EAAgD;AAC9G,EAAA,IAAI,CAAC,OAAA,EAAS;AACZ,IAAA,MAAM,IAAI,kBAAA;AAAA,MACR,QAAA;AAAA,MACA;AAAA,KACF;AAAA,EACF;AAGA,EAAA,MAAM,SAAU,OAAA,CAAoF,sBAAA;AAEpG,EAAA,IAAI,CAAC,MAAA,EAAQ;AACX,IAAA,MAAM,IAAI,kBAAA;AAAA,MACR,QAAA;AAAA,MACA;AAAA,KACF;AAAA,EACF;AAEA,EAAA,OAAO,MAAA;AACT;;;AC5VO,IAAM,qBAAA,GAAgD;AAAA,EAC3D,IAAA,EAAM,UAAA;AAAA,EACN,QAAA,EAAU;AAAA,IACR,IAAA,EAAM,cAAA;AAAA,IACN,WAAA,EAAa,CAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA,wGAAA,CAAA;AAAA,IAQb,UAAA,EAAY;AAAA,MACV,IAAA,EAAM,QAAA;AAAA,MACN,UAAA,EAAY;AAAA,QACV,GAAA,EAAK;AAAA,UACH,IAAA,EAAM,QAAA;AAAA,UACN,WAAA,EAAa;AAAA,SACf;AAAA,QACA,WAAA,EAAa;AAAA,UACX,IAAA,EAAM,QAAA;AAAA,UACN,WAAA,EAAa;AAAA,SACf;AAAA,QACA,KAAA,EAAO;AAAA,UACL,WAAA,EAAa;AAAA,SACf;AAAA,QACA,IAAA,EAAM;AAAA,UACJ,IAAA,EAAM,QAAA;AAAA,UACN,IAAA,EAAM,CAAC,KAAA,EAAO,SAAA,EAAW,UAAU,CAAA;AAAA,UACnC,WAAA,EAAa;AAAA,SACf;AAAA,QACA,WAAA,EAAa;AAAA,UACX,IAAA,EAAM,OAAA;AAAA,UACN,KAAA,EAAO,EAAE,IAAA,EAAM,QAAA,EAAS;AAAA,UACxB,WAAA,EAAa;AAAA,SACf;AAAA,QACA,cAAA,EAAgB;AAAA,UACd,IAAA,EAAM,OAAA;AAAA,UACN,KAAA,EAAO,EAAE,IAAA,EAAM,QAAA,EAAS;AAAA,UACxB,WAAA,EAAa;AAAA,SACf;AAAA,QACA,KAAA,EAAO;AAAA,UACL,IAAA,EAAM,QAAA;AAAA,UACN,IAAA,EAAM,CAAC,SAAA,EAAW,MAAA,EAAQ,YAAY,CAAA;AAAA,UACtC,WAAA,EAAa;AAAA,SACf;AAAA,QACA,QAAA,EAAU;AAAA,UACR,IAAA,EAAM,QAAA;AAAA,UACN,IAAA,EAAM,CAAC,KAAA,EAAO,QAAA,EAAU,QAAQ,UAAU,CAAA;AAAA,UAC1C,WAAA,EAAa;AAAA,SACf;AAAA,QACA,MAAA,EAAQ;AAAA,UACN,IAAA,EAAM,SAAA;AAAA,UACN,WAAA,EAAa;AAAA;AACf,OACF;AAAA,MACA,QAAA,EAAU,CAAC,KAAA,EAAO,aAAA,EAAe,OAAO;AAAA;AAC1C;AAEJ,CAAA;AAKO,IAAM,wBAAA,GAAmD;AAAA,EAC9D,IAAA,EAAM,UAAA;AAAA,EACN,QAAA,EAAU;AAAA,IACR,IAAA,EAAM,iBAAA;AAAA,IACN,WAAA,EACE,+GAAA;AAAA,IACF,UAAA,EAAY;AAAA,MACV,IAAA,EAAM,QAAA;AAAA,MACN,UAAA,EAAY;AAAA,QACV,GAAA,EAAK;AAAA,UACH,IAAA,EAAM,QAAA;AAAA,UACN,WAAA,EAAa;AAAA;AACf,OACF;AAAA,MACA,QAAA,EAAU,CAAC,KAAK;AAAA;AAClB;AAEJ,CAAA;AAKO,IAAM,sBAAA,GAAiD;AAAA,EAC5D,IAAA,EAAM,UAAA;AAAA,EACN,QAAA,EAAU;AAAA,IACR,IAAA,EAAM,eAAA;AAAA,IACN,WAAA,EAAa,mDAAA;AAAA,IACb,UAAA,EAAY;AAAA,MACV,IAAA,EAAM,QAAA;AAAA,MACN,UAAA,EAAY;AAAA,QACV,GAAA,EAAK;AAAA,UACH,IAAA,EAAM,QAAA;AAAA,UACN,WAAA,EAAa;AAAA;AACf,OACF;AAAA,MACA,QAAA,EAAU,CAAC,KAAK;AAAA;AAClB;AAEJ,CAAA;AAKO,IAAM,qBAAA,GAAgD;AAAA,EAC3D,IAAA,EAAM,UAAA;AAAA,EACN,QAAA,EAAU;AAAA,IACR,IAAA,EAAM,cAAA;AAAA,IACN,WAAA,EAAa,CAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,uEAAA,CAAA;AAAA,IAOb,UAAA,EAAY;AAAA,MACV,IAAA,EAAM,QAAA;AAAA,MACN,UAAA,EAAY;AAAA,QACV,OAAA,EAAS;AAAA,UACP,IAAA,EAAM,QAAA;AAAA,UACN,WAAA,EAAa;AAAA,SACf;AAAA,QACA,IAAA,EAAM;AAAA,UACJ,IAAA,EAAM,QAAA;AAAA,UACN,IAAA,EAAM,CAAC,KAAA,EAAO,SAAA,EAAW,YAAY,MAAM,CAAA;AAAA,UAC3C,WAAA,EAAa;AAAA,SACf;AAAA,QACA,KAAA,EAAO;AAAA,UACL,IAAA,EAAM,QAAA;AAAA,UACN,IAAA,EAAM,CAAC,SAAA,EAAW,YAAY,CAAA;AAAA,UAC9B,WAAA,EAAa;AAAA,SACf;AAAA,QACA,aAAA,EAAe;AAAA,UACb,IAAA,EAAM,SAAA;AAAA,UACN,WAAA,EAAa;AAAA,SACf;AAAA,QACA,eAAA,EAAiB;AAAA,UACf,IAAA,EAAM,SAAA;AAAA,UACN,WAAA,EAAa;AAAA,SACf;AAAA,QACA,YAAA,EAAc;AAAA,UACZ,IAAA,EAAM,SAAA;AAAA,UACN,WAAA,EAAa;AAAA;AACf,OACF;AAAA,MACA,UAAU;AAAC;AACb;AAEJ,CAAA;AAKO,IAAM,0BAAA,GAAqD;AAAA,EAChE,IAAA,EAAM,UAAA;AAAA,EACN,QAAA,EAAU;AAAA,IACR,IAAA,EAAM,oBAAA;AAAA,IACN,WAAA,EAAa,oGAAA;AAAA,IACb,UAAA,EAAY;AAAA,MACV,IAAA,EAAM,QAAA;AAAA,MACN,UAAA,EAAY;AAAA,QACV,IAAA,EAAM;AAAA,UACJ,IAAA,EAAM,OAAA;AAAA,UACN,KAAA,EAAO,EAAE,IAAA,EAAM,QAAA,EAAS;AAAA,UACxB,WAAA,EAAa;AAAA;AACf,OACF;AAAA,MACA,QAAA,EAAU,CAAC,MAAM;AAAA;AACnB;AAEJ,CAAA;AAMA,SAAS,YAAA,CAAa,KAAa,OAAA,EAA0B;AAE3D,EAAA,MAAM,YAAA,GAAe,QAClB,OAAA,CAAQ,oBAAA,EAAsB,MAAM,CAAA,CACpC,OAAA,CAAQ,OAAO,IAAI,CAAA;AACtB,EAAA,MAAM,KAAA,GAAQ,IAAI,MAAA,CAAO,CAAA,CAAA,EAAI,YAAY,CAAA,CAAA,CAAG,CAAA;AAC5C,EAAA,OAAO,KAAA,CAAM,KAAK,GAAG,CAAA;AACvB;AASO,SAAS,qBAAA,GAAsC;AACpD,EAAA,OAAO;AAAA,IACL,UAAA,EAAY,qBAAA;AAAA,IACZ,OAAA,EAAS,OAAO,IAAA,EAA+B,OAAA,KAA0B;AACvE,MAAA,IAAI,CAAC,OAAA,IAAW,CAAC,OAAA,CAAQ,MAAA,EAAQ;AAC/B,QAAA,MAAM,IAAI,kBAAA,CAAmB,cAAA,EAAgB,wCAAwC,CAAA;AAAA,MACvF;AAEA,MAAA,IAAI;AACF,QAAA,IAAI,MAAM,IAAA,CAAK,GAAA;AACf,QAAA,MAAM,OAAO,IAAA,CAAK,IAAA;AAClB,QAAA,MAAM,cAAc,IAAA,CAAK,WAAA;AAGzB,QAAA,IAAI,IAAA,EAAM;AACR,UAAA,GAAA,GAAM,aAAA,CAAc,KAAK,IAAI,CAAA;AAAA,QAC/B;AAGA,QAAA,IAAI,KAAA;AACJ,QAAA,IAAI,IAAA,CAAK,cAAA,IAAkB,KAAA,CAAM,OAAA,CAAQ,IAAA,CAAK,cAAc,CAAA,IAAK,IAAA,CAAK,cAAA,CAAe,MAAA,GAAS,CAAA,EAAG;AAC/F,UAAA,KAAA,GAAQ,EAAE,IAAA,EAAM,MAAA,EAAQ,OAAA,EAAS,KAAK,cAAA,EAA2B;AAAA,QACnE,CAAA,MAAA,IAAW,IAAA,CAAK,KAAA,KAAU,MAAA,EAAQ;AAChC,UAAA,KAAA,GAAQ,EAAE,MAAM,MAAA,EAAO;AAAA,QACzB,CAAA,MAAA,IAAW,IAAA,CAAK,KAAA,KAAU,YAAA,EAAc;AACtC,UAAA,KAAA,GAAQ,EAAE,MAAM,YAAA,EAAa;AAAA,QAC/B,CAAA,MAAA,IAAW,SAAS,UAAA,EAAY;AAE9B,UAAA,KAAA,GAAQ,EAAE,MAAM,MAAA,EAAO;AAAA,QACzB,CAAA,MAAO;AACL,UAAA,KAAA,GAAQ,SAAA;AAAA,QACV;AAGA,QAAA,IAAI,WAAuC,IAAA,CAAK,QAAA;AAChD,QAAA,IAAI,IAAA,EAAM;AACR,UAAA,QAAA,GAAW,gBAAgB,IAAI,CAAA;AAAA,QACjC;AAEA,QAAA,MAAM,QAAQ,MAAA,CAAO,GAAA;AAAA,UACnB,GAAA;AAAA,UACA,IAAA,CAAK,WAAA;AAAA,UACL,IAAA,CAAK,KAAA;AAAA,UACL;AAAA,YACE,KAAA;AAAA,YACA,QAAA;AAAA,YACA,QAAQ,IAAA,CAAK;AAAA;AACf,SACF;AAEA,QAAA,OAAO;AAAA,UACL,OAAA,EAAS,IAAA;AAAA,UACT,GAAA;AAAA,UACA,IAAA,EAAM,IAAA,IAAQ,cAAA,CAAe,GAAG,CAAA,IAAK,MAAA;AAAA,UACrC,KAAA,EAAO,OAAO,KAAA,KAAU,QAAA,GAAW,QAAQ,KAAA,CAAM,IAAA;AAAA,UACjD,UAAU,QAAA,IAAY,QAAA;AAAA,UACtB,WAAA,EAAa,eAAe;AAAC,SAC/B;AAAA,MACF,SAAS,KAAA,EAAO;AACd,QAAA,OAAO,EAAE,OAAO,KAAA,YAAiB,KAAA,GAAQ,MAAM,OAAA,GAAU,MAAA,CAAO,KAAK,CAAA,EAAE;AAAA,MACzE;AAAA,IACF,CAAA;AAAA,IACA,WAAA,EAAa,EAAE,IAAA,EAAM,IAAA,EAAK;AAAA,IAC1B,MAAA,EAAQ,EAAE,YAAA,EAAc,OAAA,EAAQ;AAAA,IAChC,YAAA,EAAc,CAAC,IAAA,KAAS;AACtB,MAAA,MAAM,OAAO,IAAA,CAAK,IAAA;AAClB,MAAA,MAAM,MAAM,IAAA,CAAK,GAAA;AACjB,MAAA,OAAO,IAAA,GAAO,CAAA,EAAG,IAAI,CAAA,CAAA,EAAI,GAAG,CAAA,CAAA,GAAK,GAAA;AAAA,IACnC;AAAA,GACF;AACF;AAKO,SAAS,wBAAA,GAAyC;AACvD,EAAA,OAAO;AAAA,IACL,UAAA,EAAY,wBAAA;AAAA,IACZ,OAAA,EAAS,OAAO,IAAA,EAA+B,OAAA,KAA0B;AACvE,MAAA,IAAI,CAAC,OAAA,IAAW,CAAC,OAAA,CAAQ,MAAA,EAAQ;AAC/B,QAAA,MAAM,IAAI,kBAAA,CAAmB,iBAAA,EAAmB,wCAAwC,CAAA;AAAA,MAC1F;AAEA,MAAA,MAAM,QAAQ,MAAM,OAAA,CAAQ,MAAA,CAAO,GAAA,CAAI,KAAK,GAAa,CAAA;AACzD,MAAA,IAAI,UAAU,MAAA,EAAW;AACvB,QAAA,OAAO,EAAE,KAAA,EAAO,CAAA,KAAA,EAAQ,IAAA,CAAK,GAAG,CAAA,qBAAA,CAAA,EAAwB;AAAA,MAC1D;AACA,MAAA,OAAO,KAAA;AAAA,IACT,CAAA;AAAA,IACA,WAAA,EAAa,EAAE,IAAA,EAAM,IAAA,EAAK;AAAA,IAC1B,MAAA,EAAQ,EAAE,YAAA,EAAc,UAAA,EAAW;AAAA,IACnC,YAAA,EAAc,CAAC,IAAA,KAAS,IAAA,CAAK;AAAA,GAC/B;AACF;AAKO,SAAS,sBAAA,GAAuC;AACrD,EAAA,OAAO;AAAA,IACL,UAAA,EAAY,sBAAA;AAAA,IACZ,OAAA,EAAS,OAAO,IAAA,EAA+B,OAAA,KAA0B;AACvE,MAAA,IAAI,CAAC,OAAA,IAAW,CAAC,OAAA,CAAQ,MAAA,EAAQ;AAC/B,QAAA,MAAM,IAAI,kBAAA,CAAmB,eAAA,EAAiB,wCAAwC,CAAA;AAAA,MACxF;AAEA,MAAA,MAAM,OAAA,CAAQ,MAAA,CAAO,MAAA,CAAO,IAAA,CAAK,GAAa,CAAA;AAC9C,MAAA,OAAO,EAAE,OAAA,EAAS,IAAA,EAAM,OAAA,EAAS,KAAK,GAAA,EAAI;AAAA,IAC5C,CAAA;AAAA,IACA,WAAA,EAAa,EAAE,IAAA,EAAM,IAAA,EAAK;AAAA,IAC1B,MAAA,EAAQ,EAAE,YAAA,EAAc,OAAA,EAAQ;AAAA,IAChC,YAAA,EAAc,CAAC,IAAA,KAAS,IAAA,CAAK;AAAA,GAC/B;AACF;AAKO,SAAS,qBAAA,GAAsC;AACpD,EAAA,OAAO;AAAA,IACL,UAAA,EAAY,qBAAA;AAAA,IACZ,OAAA,EAAS,OAAO,IAAA,EAA+B,OAAA,KAA0B;AACvE,MAAA,IAAI,CAAC,OAAA,IAAW,CAAC,OAAA,CAAQ,MAAA,EAAQ;AAC/B,QAAA,MAAM,IAAI,kBAAA,CAAmB,cAAA,EAAgB,wCAAwC,CAAA;AAAA,MACvF;AAEA,MAAA,MAAM,UAAU,IAAA,CAAK,OAAA;AACrB,MAAA,MAAM,OAAO,IAAA,CAAK,IAAA;AAClB,MAAA,MAAM,gBAAgB,IAAA,CAAK,aAAA;AAC3B,MAAA,MAAM,kBAAkB,IAAA,CAAK,eAAA;AAC7B,MAAA,MAAM,eAAe,IAAA,CAAK,YAAA;AAG1B,MAAA,IAAI,OAAA,GAAU,MAAM,OAAA,CAAQ,MAAA,CAAO,IAAA,EAAK;AAGxC,MAAA,IAAI,IAAA,EAAM;AAER,QAAA,MAAM,MAAA,GAAS,GAAG,IAAI,CAAA,CAAA,CAAA;AACtB,QAAA,OAAA,GAAU,OAAA,CAAQ,OAAO,CAAC,CAAA,KAAM,EAAE,GAAA,CAAI,UAAA,CAAW,MAAM,CAAC,CAAA;AAAA,MAC1D,CAAA,MAAA,IAAW,OAAA,IAAW,OAAA,KAAY,GAAA,EAAK;AAErC,QAAA,OAAA,GAAU,OAAA,CAAQ,OAAO,CAAC,CAAA,KAAM,aAAa,CAAA,CAAE,GAAA,EAAK,OAAO,CAAC,CAAA;AAAA,MAC9D;AAGA,MAAA,MAAM,MAAA,GAAkC;AAAA,QACtC,OAAO,OAAA,CAAQ,MAAA;AAAA,QACf,MAAA,EAAQ,OAAO,CAAA,KAAA,EAAQ,IAAI,KAAK,OAAA,GAAU,CAAA,QAAA,EAAW,OAAO,CAAA,CAAA,GAAK;AAAA,OACnE;AAGA,MAAA,IAAI,aAAA,EAAe;AAEjB,QAAA,MAAM,oBAA6C,EAAC;AACpD,QAAA,MAAM,WAAqG,EAAC;AAE5G,QAAA,KAAA,MAAW,SAAS,OAAA,EAAS;AAC3B,UAAA,MAAM,QAAQ,MAAM,OAAA,CAAQ,MAAA,CAAO,GAAA,CAAI,MAAM,GAAG,CAAA;AAChD,UAAA,IAAI,UAAU,MAAA,EAAW;AACvB,YAAA,iBAAA,CAAkB,KAAA,CAAM,GAAG,CAAA,GAAI,KAAA;AAE/B,YAAA,IAAI,eAAA,EAAiB;AACnB,cAAA,QAAA,CAAS,KAAA,CAAM,GAAG,CAAA,GAAI;AAAA,gBACpB,IAAA,EAAM,cAAA,CAAe,KAAA,CAAM,GAAG,CAAA,IAAK,MAAA;AAAA,gBACnC,QAAA,EAAU,MAAM,iBAAA,IAAqB,QAAA;AAAA,gBACrC,MAAA,EAAQ,MAAM,MAAA,IAAU,KAAA;AAAA,gBACxB,aAAa,KAAA,CAAM;AAAA,eACrB;AAAA,YACF;AAAA,UACF;AAAA,QACF;AAEA,QAAA,MAAA,CAAO,OAAA,GAAU,iBAAA;AACjB,QAAA,IAAI,eAAA,EAAiB;AACnB,UAAA,MAAA,CAAO,QAAA,GAAW,QAAA;AAAA,QACpB;AAAA,MACF,CAAA,MAAO;AAEL,QAAA,MAAA,CAAO,OAAA,GAAU,OAAA,CAAQ,GAAA,CAAI,CAAC,CAAA,KAAM;AAClC,UAAA,MAAM,SAAA,GAAqC;AAAA,YACzC,KAAK,CAAA,CAAE,GAAA;AAAA,YACP,aAAa,CAAA,CAAE;AAAA,WACjB;AAEA,UAAA,IAAI,eAAA,EAAiB;AACnB,YAAA,SAAA,CAAU,QAAA,GAAW,EAAE,iBAAA,IAAqB,QAAA;AAC5C,YAAA,SAAA,CAAU,IAAA,GAAO,cAAA,CAAe,CAAA,CAAE,GAAG,CAAA,IAAK,MAAA;AAC1C,YAAA,SAAA,CAAU,MAAA,GAAS,EAAE,MAAA,IAAU,KAAA;AAAA,UACjC;AAEA,UAAA,OAAO,SAAA;AAAA,QACT,CAAC,CAAA;AAAA,MACH;AAGA,MAAA,IAAI,YAAA,EAAc;AAChB,QAAA,MAAM,UAAA,GAAa,MAAM,OAAA,CAAQ,MAAA,CAAO,IAAA,EAAK;AAC7C,QAAA,MAAM,SAAiC,EAAC;AAExC,QAAA,KAAA,MAAW,SAAS,UAAA,EAAY;AAC9B,UAAA,MAAM,SAAA,GAAY,cAAA,CAAe,KAAA,CAAM,GAAG,CAAA,IAAK,OAAA;AAC/C,UAAA,MAAA,CAAO,SAAS,CAAA,GAAA,CAAK,MAAA,CAAO,SAAS,KAAK,CAAA,IAAK,CAAA;AAAA,QACjD;AAEA,QAAA,MAAA,CAAO,KAAA,GAAQ;AAAA,UACb,cAAc,UAAA,CAAW,MAAA;AAAA,UACzB;AAAA,SACF;AAAA,MACF;AAEA,MAAA,OAAO,MAAA;AAAA,IACT,CAAA;AAAA,IACA,WAAA,EAAa,EAAE,IAAA,EAAM,IAAA,EAAK;AAAA,IAC1B,MAAA,EAAQ,EAAE,YAAA,EAAc,UAAA,EAAW;AAAA,IACnC,YAAA,EAAc,CAAC,IAAA,KAAS;AACtB,MAAA,MAAM,UAAU,IAAA,CAAK,OAAA;AACrB,MAAA,MAAM,OAAO,IAAA,CAAK,IAAA;AAClB,MAAA,MAAM,gBAAgB,IAAA,CAAK,aAAA;AAC3B,MAAA,IAAI,MAAM,OAAO,CAAA,KAAA,EAAQ,IAAI,CAAA,EAAG,aAAA,GAAgB,YAAY,EAAE,CAAA,CAAA;AAC9D,MAAA,IAAI,SAAS,OAAO,CAAA,QAAA,EAAW,OAAO,CAAA,EAAG,aAAA,GAAgB,YAAY,EAAE,CAAA,CAAA;AACvE,MAAA,OAAO,gBAAgB,YAAA,GAAe,KAAA;AAAA,IACxC;AAAA,GACF;AACF;AAKO,SAAS,0BAAA,GAA2C;AACzD,EAAA,OAAO;AAAA,IACL,UAAA,EAAY,0BAAA;AAAA,IACZ,OAAA,EAAS,OAAO,IAAA,EAA+B,OAAA,KAA0B;AACvE,MAAA,IAAI,CAAC,OAAA,IAAW,CAAC,OAAA,CAAQ,MAAA,EAAQ;AAC/B,QAAA,MAAM,IAAI,kBAAA,CAAmB,oBAAA,EAAsB,wCAAwC,CAAA;AAAA,MAC7F;AAEA,MAAA,MAAM,OAAO,IAAA,CAAK,IAAA;AAClB,MAAA,IAAI,YAAA,GAAe,CAAA;AACnB,MAAA,MAAM,UAAoB,EAAC;AAE3B,MAAA,KAAA,MAAW,OAAO,IAAA,EAAM;AACtB,QAAA,MAAM,IAAA,GAAO,eAAe,GAAG,CAAA;AAC/B,QAAA,IAAI,SAAS,KAAA,EAAO;AAClB,UAAA,MAAM,MAAA,GAAS,MAAM,OAAA,CAAQ,MAAA,CAAO,IAAI,GAAG,CAAA;AAC3C,UAAA,IAAI,MAAA,EAAQ;AACV,YAAA,MAAM,OAAA,CAAQ,MAAA,CAAO,MAAA,CAAO,GAAG,CAAA;AAC/B,YAAA,YAAA,EAAA;AAAA,UACF;AAAA,QACF,CAAA,MAAO;AACL,UAAA,OAAA,CAAQ,KAAK,GAAG,CAAA;AAAA,QAClB;AAAA,MACF;AAEA,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,IAAA;AAAA,QACT,OAAA,EAAS,YAAA;AAAA,QACT,OAAA,EAAS,OAAA,CAAQ,MAAA,GAAS,CAAA,GAAI,OAAA,GAAU,MAAA;AAAA,QACxC,aAAA,EAAe,OAAA,CAAQ,MAAA,GAAS,CAAA,GAAI,sBAAA,GAAyB;AAAA,OAC/D;AAAA,IACF,CAAA;AAAA,IACA,WAAA,EAAa,EAAE,IAAA,EAAM,IAAA,EAAK;AAAA,IAC1B,MAAA,EAAQ,EAAE,YAAA,EAAc,OAAA,EAAQ;AAAA,IAChC,cAAc,CAAC,IAAA,KAAS,CAAA,EAAI,IAAA,CAAK,KAAkB,MAAM,CAAA,KAAA;AAAA,GAC3D;AACF;AAgBO,SAAS,iBAAA,GAAoC;AAClD,EAAA,OAAO;AAAA,IACL,qBAAA,EAAsB;AAAA,IACtB,wBAAA,EAAyB;AAAA,IACzB,sBAAA,EAAuB;AAAA,IACvB,qBAAA,EAAsB;AAAA,IACtB,0BAAA;AAA2B,GAC7B;AACF;;;ACheO,IAAM,sBAAA,GAAiD;AAAA,EAC5D,IAAA,EAAM,UAAA;AAAA,EACN,QAAA,EAAU;AAAA,IACR,IAAA,EAAM,eAAA;AAAA,IACN,WAAA,EAAa,CAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wDAAA,CAAA;AAAA,IAQb,UAAA,EAAY;AAAA,MACV,IAAA,EAAM,QAAA;AAAA,MACN,UAAA,EAAY;AAAA,QACV,QAAA,EAAU;AAAA,UACR,IAAA,EAAM,OAAA;AAAA,UACN,KAAA,EAAO;AAAA,YACL,IAAA,EAAM,QAAA;AAAA,YACN,MAAM,CAAC,QAAA,EAAU,WAAA,EAAa,QAAA,EAAU,SAAS,KAAK;AAAA,WACxD;AAAA,UACA,WAAA,EAAa;AAAA;AACf,OACF;AAAA,MACA,UAAU;AAAC;AACb;AAEJ,CAAA;AAUO,SAAS,sBAAA,GAAuC;AACrD,EAAA,OAAO;AAAA,IACL,UAAA,EAAY,sBAAA;AAAA,IACZ,OAAA,EAAS,OAAO,IAAA,EAA+B,OAAA,KAA0B;AACvE,MAAA,MAAM,WAAW,OAAA,EAAS,YAAA;AAC1B,MAAA,IAAI,CAAC,QAAA,EAAU;AACb,QAAA,OAAO;AAAA,UACL,KAAA,EAAO,4BAAA;AAAA,UACP,OAAA,EAAS;AAAA,SACX;AAAA,MACF;AAEA,MAAA,MAAM,iBAAA,GAAqB,IAAA,CAAK,QAAA,IAAqC,CAAC,QAAQ,CAAA;AAC9E,MAAA,MAAM,WAAW,IAAI,GAAA;AAAA,QACnB,iBAAA,CAAkB,SAAS,KAAK,CAAA,GAC5B,CAAC,QAAA,EAAU,WAAA,EAAa,QAAA,EAAU,OAAO,CAAA,GACzC;AAAA,OACN;AAEA,MAAA,MAAM,SAAkC,EAAC;AAGzC,MAAA,IAAI,QAAA,CAAS,GAAA,CAAI,QAAQ,CAAA,EAAG;AAC1B,QAAA,MAAM,MAAA,GAAS,SAAS,aAAA,EAAc;AACtC,QAAA,IAAI,CAAC,MAAA,EAAQ;AACX,UAAA,MAAA,CAAO,MAAA,GAAS;AAAA,YACd,MAAA,EAAQ,gBAAA;AAAA,YACR,OAAA,EAAS;AAAA,WACX;AAAA,QACF,CAAA,MAAO;AACL,UAAA,MAAA,CAAO,MAAA,GAAS;AAAA,YACd,cAAc,MAAA,CAAO,KAAA;AAAA,YACrB,iBAAiB,MAAA,CAAO,QAAA;AAAA,YACxB,aAAa,MAAA,CAAO,IAAA;AAAA,YACpB,kBAAkB,MAAA,CAAO,SAAA;AAAA,YACzB,qBAAqB,IAAA,CAAK,KAAA,CAAM,MAAA,CAAO,kBAAA,GAAqB,EAAE,CAAA,GAAI,EAAA;AAAA,YAClE,QAAQ,MAAA,CAAO,MAAA;AAAA,YACf,OAAA,EACE,OAAO,MAAA,KAAW,SAAA,GACd,iEACA,MAAA,CAAO,MAAA,KAAW,aAChB,qDAAA,GACA;AAAA,WACV;AAAA,QACF;AAAA,MACF;AAGA,MAAA,IAAI,QAAA,CAAS,GAAA,CAAI,WAAW,CAAA,EAAG;AAC7B,QAAA,MAAM,MAAA,GAAS,SAAS,aAAA,EAAc;AACtC,QAAA,IAAI,CAAC,MAAA,EAAQ;AACX,UAAA,MAAA,CAAO,SAAA,GAAY;AAAA,YACjB,MAAA,EAAQ,gBAAA;AAAA,YACR,OAAA,EAAS;AAAA,WACX;AAAA,QACF,CAAA,MAAO;AACL,UAAA,MAAM,UAAA,GAAa,MAAA,CAAO,OAAA,CAAQ,MAAA,CAAO,SAAS,CAAA,CAAE,GAAA,CAAI,CAAC,CAAC,IAAA,EAAM,MAAM,CAAA,MAAO;AAAA,YAC3E,IAAA;AAAA,YACA,MAAA;AAAA,YACA,OAAA,EAAS,MAAA,CAAO,IAAA,GAAO,CAAA,GAAI,IAAA,CAAK,KAAA,CAAO,MAAA,GAAS,MAAA,CAAO,IAAA,GAAQ,GAAI,CAAA,GAAI,EAAA,GAAK;AAAA,WAC9E,CAAE,CAAA;AAEF,UAAA,MAAA,CAAO,SAAA,GAAY;AAAA,YACjB,YAAY,MAAA,CAAO,IAAA;AAAA,YACnB,cAAc,MAAA,CAAO,SAAA;AAAA,YACrB;AAAA,WACF;AAAA,QACF;AAAA,MACF;AAGA,MAAA,IAAI,QAAA,CAAS,GAAA,CAAI,QAAQ,CAAA,EAAG;AAC1B,QAAA,IAAI,CAAC,SAAS,MAAA,EAAQ;AACpB,UAAA,MAAA,CAAO,MAAA,GAAS;AAAA,YACd,MAAA,EAAQ,kBAAA;AAAA,YACR,OAAA,EAAS;AAAA,WACX;AAAA,QACF,CAAA,MAAO;AACL,UAAA,MAAM,OAAA,GAAU,MAAM,OAAA,CAAQ,MAAA,CAAO,IAAA,EAAK;AAG1C,UAAA,MAAM,SAAiC,EAAC;AACxC,UAAA,KAAA,MAAW,SAAS,OAAA,EAAS;AAC3B,YAAA,MAAM,IAAA,GAAO,cAAA,CAAe,KAAA,CAAM,GAAG,CAAA,IAAK,OAAA;AAC1C,YAAA,MAAA,CAAO,IAAI,CAAA,GAAA,CAAK,MAAA,CAAO,IAAI,KAAK,CAAA,IAAK,CAAA;AAAA,UACvC;AAEA,UAAA,MAAA,CAAO,MAAA,GAAS;AAAA,YACd,eAAe,OAAA,CAAQ,MAAA;AAAA,YACvB,OAAA,EAAS,MAAA;AAAA,YACT,OAAA,EAAS,OAAA,CAAQ,GAAA,CAAI,CAAC,CAAA,MAAO;AAAA,cAC3B,KAAK,CAAA,CAAE,GAAA;AAAA,cACP,aAAa,CAAA,CAAE,WAAA;AAAA,cACf,QAAA,EAAU,EAAE,iBAAA,IAAqB;AAAA,aACnC,CAAE;AAAA,WACJ;AAAA,QACF;AAAA,MACF;AAGA,MAAA,IAAI,QAAA,CAAS,GAAA,CAAI,OAAO,CAAA,EAAG;AACzB,QAAA,IAAI,CAAC,SAAS,gBAAA,EAAkB;AAC9B,UAAA,MAAA,CAAO,KAAA,GAAQ;AAAA,YACb,MAAA,EAAQ,kBAAA;AAAA,YACR,OAAA,EAAS;AAAA,WACX;AAAA,QACF,CAAA,MAAO;AACL,UAAA,MAAM,KAAA,GAAQ,OAAA,CAAQ,gBAAA,CAAiB,QAAA,EAAS;AAChD,UAAA,MAAA,CAAO,KAAA,GAAQ;AAAA,YACb,SAAS,KAAA,CAAM,OAAA;AAAA,YACf,MAAM,KAAA,CAAM,IAAA;AAAA,YACZ,QAAQ,KAAA,CAAM,MAAA;AAAA,YACd,gBAAA,EAAkB,IAAA,CAAK,KAAA,CAAM,KAAA,CAAM,UAAU,GAAG,CAAA;AAAA,YAChD,aAAA,EACE,KAAA,CAAM,OAAA,GAAU,GAAA,GACZ,MAAA,GACA,KAAA,CAAM,OAAA,GAAU,GAAA,GACd,QAAA,GACA,KAAA,CAAM,OAAA,GAAU,CAAA,GACd,KAAA,GACA;AAAA,WACZ;AAAA,QACF;AAAA,MACF;AAEA,MAAA,OAAO,MAAA;AAAA,IACT,CAAA;AAAA,IACA,WAAA,EAAa,EAAE,IAAA,EAAM,IAAA,EAAK;AAAA,IAC1B,MAAA,EAAQ,EAAE,YAAA,EAAc,OAAA,EAAQ;AAAA,IAChC,YAAA,EAAc,CAAC,IAAA,KAAS;AACtB,MAAA,MAAM,WAAW,IAAA,CAAK,QAAA;AACtB,MAAA,IAAI,CAAC,QAAA,IAAY,QAAA,CAAS,MAAA,KAAW,GAAG,OAAO,QAAA;AAC/C,MAAA,IAAI,QAAA,CAAS,QAAA,CAAS,KAAK,CAAA,EAAG,OAAO,KAAA;AACrC,MAAA,OAAO,QAAA,CAAS,KAAK,GAAG,CAAA;AAAA,IAC1B;AAAA,GACF;AACF;AAkOO,SAAS,kBAAA,GAAqC;AACnD,EAAA,OAAO;AAAA,IACL,sBAAA;AAAuB,GACzB;AACF;;;ACnZO,IAAM,0BAAA,GAA6B,CAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA,6CAAA;AAsBnC,IAAM,2BAAA,GAA8B,CAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sDAAA;AAmCpC,IAAM,8BAAA,GAAiC,CAAA;;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA,8CAAA;AAkCvC,IAAM,oCAAA,GAAuC,CAAA;;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,+CAAA;AAuC7C,SAAS,yBACd,QAAA,EAC0B;AAC1B,EAAA,MAAM,WAAqB,EAAC;AAG5B,EAAA,QAAA,CAAS,KAAK,0BAA0B,CAAA;AAGxC,EAAA,IAAI,SAAS,MAAA,EAAQ;AACnB,IAAA,QAAA,CAAS,KAAK,2BAA2B,CAAA;AAAA,EAC3C;AAGA,EAAA,IAAI,SAAS,eAAA,EAAiB;AAC5B,IAAA,QAAA,CAAS,KAAK,8BAA8B,CAAA;AAAA,EAC9C;AAGA,EAAA,IAAI,SAAS,sBAAA,EAAwB;AACnC,IAAA,QAAA,CAAS,KAAK,oCAAoC,CAAA;AAAA,EACpD;AAIA,EAAA,IAAI,QAAA,CAAS,WAAW,CAAA,EAAG;AACzB,IAAA,OAAO,IAAA;AAAA,EACT;AAEA,EAAA,MAAM,OAAA,GAAU,QAAA,CAAS,IAAA,CAAK,MAAM,CAAA;AAEpC,EAAA,OAAO;AAAA,IACL,IAAA,EAAM,sBAAA;AAAA,IACN,OAAA;AAAA,IACA,QAAA,EAAU,CAAA;AAAA;AAAA,IACV,WAAA,EAAa,IAAA;AAAA;AAAA,IACb,QAAA,EAAU;AAAA,MACR,cAAc,QAAA,CAAS,MAAA;AAAA,MACvB,eAAe,QAAA,CAAS,MAAA;AAAA,MACxB,wBAAwB,QAAA,CAAS,eAAA;AAAA,MACjC,+BAA+B,QAAA,CAAS;AAAA;AAC1C,GACF;AACF;AAKO,SAAS,kBAAA,GAA6C;AAC3D,EAAA,OAAO;AAAA,IACL,aAAA,EAAe,0BAAA;AAAA,IACf,aAAA,EAAe,2BAAA;AAAA,IACf,eAAA,EAAiB,8BAAA;AAAA,IACjB,sBAAA,EAAwB;AAAA,GAC1B;AACF;;;AC1GO,IAAM,iBAAA,GAA8D;AAAA,EACzE,QAAA,EAAU;AAAA,IACR,YAAA,EAAc,CAAA;AAAA;AAAA,IACd,YAAA,EAAc,CAAA;AAAA;AAAA,IACd,oBAAA,EAAsB;AAAA;AAAA,GACxB;AAAA,EACA,MAAA,EAAQ;AAAA,IACN,YAAA,EAAc,CAAA;AAAA,IACd,oBAAA,EAAsB,CAAA;AAAA;AAAA,IACtB,YAAA,EAAc;AAAA;AAAA,GAChB;AAAA,EACA,QAAA,EAAU;AAAA,IACR,YAAA,EAAc,CAAA;AAAA,IACd,YAAA,EAAc,CAAA;AAAA;AAAA,IACd,oBAAA,EAAsB;AAAA,GACxB;AAAA,EACA,OAAA,EAAS;AAAA,IACP,YAAA,EAAc,CAAA;AAAA,IACd,oBAAA,EAAsB,CAAA;AAAA;AAAA,IACtB,YAAA,EAAc;AAAA;AAElB,CAAA;AAKO,IAAM,iBAAA,GAA8C;AAAA,EACzD,QAAA,EAAU,CAAA;;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA,+DAAA,CAAA;AAAA,EAyBV,MAAA,EAAQ,CAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,kEAAA,CAAA;AAAA,EAQR,QAAA,EAAU,CAAA;;AAAA;AAAA;AAAA;AAAA,uDAAA,CAAA;AAAA,EAOV,OAAA,EAAS,CAAA;;AAAA;AAAA;AAAA,mDAAA;AAKX,CAAA;AA6DO,IAAM,gBAAA,GAAmD;AAAA,EAC9D,MAAA,EAAQ,IAAA;AAAA,EACR,eAAA,EAAiB,KAAA;AAAA,EACjB,OAAA,EAAS,IAAA;AAAA,EACT,WAAA,EAAa,IAAA;AAAA,EACb,sBAAA,EAAwB;AAC1B;AAyKA,IAAM,4BAAA,GAEF;AAAA,EACF,KAAA,EAAO,OAAA;AAAA,EACP,gBAAA,EAAkB,KAAA;AAAA,EAClB,YAAA,EAAc,EAAA;AAAA,EACd,YAAA,EAAc,EAAA;AAAA,EACd,OAAA,EAAS;AAAA,IACP,WAAA,EAAa,GAAA;AAAA,IACb,cAAA,EAAgB;AAAA,GAClB;AAAA,EACA,QAAA,EAAU,WAAA;AAAA,EACV,eAAA,EAAiB,IAAA;AAAA,EACjB,WAAA,EAAa;AACf,CAAA;AAuFO,IAAM,YAAA,GAAN,MAAM,aAAA,SAAqBN,YAAAA,CAAiC;AAAA;AAAA,EAEhD,MAAA;AAAA,EACA,OAAA;AAAA,EACA,MAAA;AAAA,EACA,YAAA;AAAA,EACT,gBAAA,GAAiD,IAAA;AAAA,EACjD,uBAAA,GAA+D,IAAA;AAAA,EACtD,QAAA;AAAA;AAAA,EAGA,SAAA;AAAA;AAAA,EAGT,aAAA;AAAA,EACA,aAAA;AAAA,EACA,aAA+B,EAAC;AAAA,EAChC,aAAA,GAAwB,EAAA;AAAA,EACxB,eAAA;AAAA;AAAA;AAAA,EAIA,gBAA6B,EAAC;AAAA;AAAA,EAE9B,gBAAA,uBAAqD,GAAA,EAAI;AAAA;AAAA,EAEzD,mBAAA,GAA8B,CAAA;AAAA;AAAA,EAG9B,QAAA,uBAA4C,GAAA,EAAI;AAAA;AAAA,EAGhD,OAAA;AAAA,EACA,iBAAA;AAAA,EACA,SAAA;AAAA,EACA,UAAA;AAAA,EACA,aAAA;AAAA;AAAA,EAGA,gBAAA,GAAmB,CAAA;AAAA,EACnB,iBAAA,GAAoB,CAAA;AAAA,EACpB,WAAA,GAAoC,IAAA;AAAA;AAAA,EAGpC,iBAAA;AAAA,EACA,qBAAA;AAAA,EACA,mBAAA,GAA+B,IAAA;AAAA;AAAA,EAG/B,QAAA,GAAmC,IAAA;AAAA,EACnC,UAAA,GAA4B,IAAA;AAAA,EAC5B,mBAA2C,EAAC;AAAA;AAAA;AAAA;AAAA,EAM5C,WAAA,CAAY,MAAA,GAA6B,EAAC,EAAG;AACnD,IAAA,KAAA,EAAM;AAGN,IAAA,IAAA,CAAK,YAAY,EAAE,GAAG,gBAAA,EAAkB,GAAG,OAAO,QAAA,EAAS;AAG3D,IAAA,IAAI,MAAA,CAAO,KAAA,EAAO,OAAA,KAAY,KAAA,EAAO;AACnC,MAAA,IAAA,CAAK,UAAU,MAAA,GAAS,KAAA;AAAA,IAC1B;AAGA,IAAA,IAAA,CAAK,OAAA,GAAU;AAAA,MACb,GAAG,4BAAA;AAAA,MACH,GAAG,MAAA;AAAA,MACH,SAAS,EAAE,GAAG,6BAA6B,OAAA,EAAS,GAAG,OAAO,OAAA;AAAQ,KACxE;AAEA,IAAA,IAAA,CAAK,aAAA,GAAgB,OAAO,YAAA,IAAgB,EAAA;AAC5C,IAAA,IAAA,CAAK,aAAA,GAAgB,OAAO,YAAA,IAAgB,EAAA;AAG5C,IAAA,IAAA,CAAK,QAAA,GAAW,OAAO,OAAA,IAClB,MAAA,CAAO,wBAAwB,OAAA,IAC/B,CAAA,MAAA,EAAS,KAAK,GAAA,EAAK,IAAI,IAAA,CAAK,MAAA,GAAS,QAAA,CAAS,EAAE,EAAE,SAAA,CAAU,CAAA,EAAG,CAAC,CAAC,CAAA,CAAA;AAGtE,IAAA,IAAA,CAAK,eAAA,GAAkB,KAAK,SAAA,CAAU,OAAA;AAGtC,IAAA,IAAA,CAAK,iBAAA,GAAoB,MAAA,CAAO,gBAAA,IAC3B,YAAA,CAAa,MAAA,CAAO,SAAS,OAAO,CAAA,EAAG,QAAA,CAAS,KAAA,CAAM,MAAA,IACtD,KAAA;AAGL,IAAA,IAAA,CAAK,YAAY,cAAA,CAAsB,IAAA,CAAK,OAAA,CAAQ,QAAA,EAAU,EAAE,CAAA;AAChE,IAAA,IAAA,CAAK,UAAA,GAAa,KAAK,eAAA,EAAgB;AAKvC,IAAA,IAAA,CAAK,MAAA,GAAS,IAAI,WAAA,EAAY;AAK9B,IAAA,IAAA,CAAK,MAAA,CAAO,iBAAiB,IAAI,CAAA;AAEjC,IAAA,IAAI,OAAO,KAAA,EAAO;AAChB,MAAA,KAAA,MAAW,IAAA,IAAQ,OAAO,KAAA,EAAO;AAC/B,QAAA,IAAA,CAAK,MAAA,CAAO,SAAS,IAAI,CAAA;AAAA,MAC3B;AAAA,IACF;AAGA,IAAA,IAAI,IAAA,CAAK,UAAU,WAAA,EAAa;AAC9B,MAAA,IAAA,CAAK,YAAA,GAAe,IAAI,qBAAA,CAAsB,MAAA,CAAO,WAAW,CAAA;AAAA,IAClE,CAAA,MAAO;AACL,MAAA,IAAA,CAAK,YAAA,GAAe,IAAA;AAAA,IACtB;AAGA,IAAA,IAAI,IAAA,CAAK,UAAU,MAAA,EAAQ;AAEzB,MAAA,MAAM,aAAA,GAAgB,MAAA,CAAO,MAAA,EAAQ,OAAA,IAAW,IAAI,eAAA,EAAgB;AACpE,MAAA,MAAM,YAAA,GAAoC;AAAA,QACxC,GAAG,qBAAA;AAAA,QACH,GAAG,MAAA,CAAO;AAAA,OACZ;AACA,MAAA,IAAA,CAAK,OAAA,GAAU,IAAI,aAAA,CAAc,aAAA,EAAe,YAAY,CAAA;AAG5D,MAAA,IAAA,CAAK,aAAA,GAAgB,IAAA;AACrB,MAAA,MAAM,WAAA,GAAsC;AAAA,QAC1C,GAAG,0BAAA;AAAA,QACH,GAAG,MAAA,CAAO;AAAA,OACZ;AACA,MAAA,IAAA,CAAK,MAAA,GAAS,IAAI,gBAAA,CAAiB,WAAW,CAAA;AAAA,IAChD,CAAA,MAAO;AACL,MAAA,IAAA,CAAK,OAAA,GAAU,IAAA;AACf,MAAA,IAAA,CAAK,MAAA,GAAS,IAAA;AACd,MAAA,IAAA,CAAK,aAAA,GAAgB,KAAA;AAAA,IACvB;AAGA,IAAA,IAAI,IAAA,CAAK,UAAU,eAAA,EAAiB;AAClC,MAAA,MAAM,EAAE,MAAA,EAAQ,KAAA,EAAM,GAAI,qBAAA,CAAsB,OAAO,eAAe,CAAA;AACtE,MAAA,IAAA,CAAK,gBAAA,GAAmB,MAAA;AACxB,MAAA,IAAA,CAAK,eAAe,MAAM,CAAA;AAC1B,MAAA,KAAA,MAAW,QAAQ,KAAA,EAAO;AACxB,QAAA,IAAA,CAAK,MAAA,CAAO,SAAS,IAAI,CAAA;AAAA,MAC3B;AAAA,IACF;AAIA,IAAA,IAAI,IAAA,CAAK,UAAU,sBAAA,EAAwB;AACzC,MAAA,MAAM,EAAE,MAAA,EAAQ,KAAA,EAAM,GAAI,4BAAA,CAA6B;AAAA,QACrD,SAAS,IAAA,CAAK,QAAA;AAAA,QACd,GAAG,MAAA,CAAO;AAAA,OACX,CAAA;AACD,MAAA,IAAA,CAAK,uBAAA,GAA0B,MAAA;AAC/B,MAAA,IAAA,CAAK,eAAe,MAAM,CAAA;AAC1B,MAAA,KAAA,MAAW,QAAQ,KAAA,EAAO;AACxB,QAAA,IAAA,CAAK,MAAA,CAAO,SAAS,IAAI,CAAA;AAAA,MAC3B;AAAA,IACF;AAIA,IAAA,IAAA,CAAK,qBAAA,EAAsB;AAG3B,IAAA,IAAA,CAAK,oBAAoB,MAAA,CAAO,QAAA;AAChC,IAAA,IAAA,CAAK,mBAAA,GAAsB,OAAO,kBAAA,KAAuB,KAAA;AAGzD,IAAA,IAAA,CAAK,QAAA,GAAW,OAAO,OAAA,IAAW,IAAA;AAClC,IAAA,IAAA,CAAK,gBAAA,GAAmB,MAAA,CAAO,eAAA,IAAmB,EAAC;AACnD,IAAA,IAAA,CAAK,UAAA,GAAa,OAAO,SAAA,IAAa,IAAA;AAAA,EACxC;AAAA;AAAA;AAAA;AAAA,EAKA,OAAO,MAAA,CAAO,MAAA,GAA6B,EAAC,EAAiB;AAC3D,IAAA,OAAO,IAAI,cAAa,MAAM,CAAA;AAAA,EAChC;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,IAAI,KAAA,GAAqB;AACvB,IAAA,OAAO,IAAA,CAAK,MAAA;AAAA,EACd;AAAA;AAAA,EAGA,IAAI,MAAA,GAA+B;AACjC,IAAA,OAAO,IAAA,CAAK,OAAA;AAAA,EACd;AAAA;AAAA,EAGA,IAAI,KAAA,GAAiC;AACnC,IAAA,OAAO,IAAA,CAAK,MAAA;AAAA,EACd;AAAA;AAAA,EAGA,IAAI,WAAA,GAA4C;AAC9C,IAAA,OAAO,IAAA,CAAK,YAAA;AAAA,EACd;AAAA;AAAA,EAGA,IAAI,eAAA,GAAgD;AAClD,IAAA,OAAO,IAAA,CAAK,gBAAA;AAAA,EACd;AAAA;AAAA,EAGA,IAAI,sBAAA,GAA8D;AAChE,IAAA,OAAO,IAAA,CAAK,uBAAA;AAAA,EACd;AAAA;AAAA,EAGA,IAAI,OAAA,GAAkB;AACpB,IAAA,OAAO,IAAA,CAAK,QAAA;AAAA,EACd;AAAA;AAAA,EAGA,IAAI,SAAA,GAA2B;AAC7B,IAAA,OAAO,IAAA,CAAK,UAAA;AAAA,EACd;AAAA;AAAA,EAGA,IAAI,OAAA,GAAkC;AACpC,IAAA,OAAO,IAAA,CAAK,QAAA;AAAA,EACd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,IAAI,QAAA,GAAqD;AACvD,IAAA,OAAO,IAAA,CAAK,SAAA;AAAA,EACd;AAAA;AAAA;AAAA;AAAA,EAKA,iBAAiB,OAAA,EAA8C;AAC7D,IAAA,OAAO,IAAA,CAAK,UAAU,OAAO,CAAA;AAAA,EAC/B;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,aAAA,GAA+B;AAC7B,IAAA,IAAI,CAAC,KAAK,OAAA,EAAS;AACjB,MAAA,MAAM,IAAI,MAAM,oFAAoF,CAAA;AAAA,IACtG;AACA,IAAA,OAAO,IAAA,CAAK,OAAA;AAAA,EACd;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,YAAA,GAAiC;AAC/B,IAAA,IAAI,CAAC,KAAK,MAAA,EAAQ;AAChB,MAAA,MAAM,IAAI,MAAM,uFAAuF,CAAA;AAAA,IACzG;AACA,IAAA,OAAO,IAAA,CAAK,MAAA;AAAA,EACd;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,kBAAA,GAA4C;AAC1C,IAAA,IAAI,CAAC,KAAK,YAAA,EAAc;AACtB,MAAA,MAAM,IAAI,MAAM,iGAAiG,CAAA;AAAA,IACnH;AACA,IAAA,OAAO,IAAA,CAAK,YAAA;AAAA,EACd;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,IAAI,YAAA,GAAuB;AACzB,IAAA,OAAO,IAAA,CAAK,aAAA;AAAA,EACd;AAAA,EAEA,IAAI,aAAa,KAAA,EAAe;AAC9B,IAAA,IAAA,CAAK,aAAA,GAAgB,KAAA;AAAA,EACvB;AAAA;AAAA,EAGA,IAAI,YAAA,GAAuB;AACzB,IAAA,OAAO,IAAA,CAAK,aAAA;AAAA,EACd;AAAA,EAEA,IAAI,aAAa,KAAA,EAAe;AAC9B,IAAA,IAAA,CAAK,aAAA,GAAgB,KAAA;AAAA,EACvB;AAAA;AAAA,EAGA,gBAAgB,KAAA,EAAqB;AACnC,IAAA,IAAA,CAAK,aAAA,GAAgB,KAAA;AAAA,EACvB;AAAA;AAAA,EAGA,eAAA,GAA0B;AACxB,IAAA,OAAO,IAAA,CAAK,aAAA;AAAA,EACd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAYA,eAAe,OAAA,EAAqC;AAClD,IAAA,MAAM,EAAA,GAAK,KAAK,UAAA,EAAW;AAC3B,IAAA,MAAM,YAAA,GAA0B,OAAO,OAAA,KAAY,QAAA,GAC/C,CAAC,EAAE,IAAA,EAAA,YAAA,mBAA8B,IAAA,EAAM,OAAA,EAAS,CAAA,GAChD,OAAA;AAEJ,IAAA,MAAM,OAAA,GAAmB;AAAA,MACvB,IAAA,EAAM,SAAA;AAAA,MACN,EAAA;AAAA,MACA,IAAA,EAAA,MAAA;AAAA,MACA,OAAA,EAAS;AAAA,KACX;AAEA,IAAA,IAAA,CAAK,aAAA,CAAc,KAAK,OAAO,CAAA;AAC/B,IAAA,IAAA,CAAK,gBAAA,CAAiB,IAAI,EAAA,EAAI;AAAA,MAC5B,SAAA,EAAW,KAAK,GAAA,EAAI;AAAA,MACpB,UAAA,EAAY,IAAA,CAAK,qBAAA,CAAsB,OAAO;AAAA,KAC/C,CAAA;AAGD,IAAA,MAAM,WAAA,GAAc,IAAA,CAAK,sBAAA,CAAuB,YAAY,CAAA;AAC5D,IAAA,IAAI,WAAA,EAAa;AACf,MAAA,IAAA,CAAK,gBAAgB,WAAW,CAAA;AAAA,IAClC;AAEA,IAAA,IAAA,CAAK,IAAA,CAAK,iBAAiB,EAAE,OAAA,EAAS,KAAK,uBAAA,CAAwB,OAAO,GAAG,CAAA;AAC7E,IAAA,OAAO,EAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,cAAc,KAAA,EAA0B;AACtC,IAAA,KAAA,MAAW,QAAQ,KAAA,EAAO;AACxB,MAAA,IAAI,IAAA,CAAK,SAAS,SAAA,EAAW;AAC3B,QAAA,MAAM,EAAA,GAAK,IAAA,CAAK,EAAA,IAAM,IAAA,CAAK,UAAA,EAAW;AACtC,QAAA,MAAM,aAAA,GAAyB,EAAE,GAAG,IAAA,EAAM,EAAA,EAAG;AAC7C,QAAA,IAAA,CAAK,aAAA,CAAc,KAAK,aAAa,CAAA;AACrC,QAAA,IAAA,CAAK,gBAAA,CAAiB,IAAI,EAAA,EAAI;AAAA,UAC5B,SAAA,EAAW,KAAK,GAAA,EAAI;AAAA,UACpB,UAAA,EAAY,IAAA,CAAK,qBAAA,CAAsB,aAAa;AAAA,SACrD,CAAA;AACD,QAAA,IAAA,CAAK,IAAA,CAAK,iBAAiB,EAAE,OAAA,EAAS,KAAK,uBAAA,CAAwB,aAAa,GAAG,CAAA;AAAA,MACrF;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,qBAAqB,MAAA,EAAgC;AACnD,IAAA,MAAM,MAAgB,EAAC;AAEvB,IAAA,KAAA,MAAW,QAAQ,MAAA,EAAQ;AACzB,MAAA,IAAI,IAAA,CAAK,IAAA,KAAS,SAAA,IAAa,IAAA,CAAK,IAAA,KAAA,WAAA,kBAAgC;AAClE,QAAA,MAAM,EAAA,GAAK,IAAA,CAAK,EAAA,IAAM,IAAA,CAAK,UAAA,EAAW;AACtC,QAAA,MAAM,aAAA,GAAyB,EAAE,GAAG,IAAA,EAAM,EAAA,EAAG;AAC7C,QAAA,IAAA,CAAK,aAAA,CAAc,KAAK,aAA0B,CAAA;AAClD,QAAA,IAAA,CAAK,gBAAA,CAAiB,IAAI,EAAA,EAAI;AAAA,UAC5B,SAAA,EAAW,KAAK,GAAA,EAAI;AAAA,UACpB,UAAA,EAAY,IAAA,CAAK,qBAAA,CAAsB,aAAa;AAAA,SACrD,CAAA;AACD,QAAA,GAAA,CAAI,KAAK,EAAE,CAAA;AACX,QAAA,IAAA,CAAK,IAAA,CAAK,iBAAiB,EAAE,OAAA,EAAS,KAAK,uBAAA,CAAwB,aAAa,GAAG,CAAA;AAAA,MACrF;AAAA,IACF;AAEA,IAAA,OAAO,GAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,eAAe,OAAA,EAA+B;AAC5C,IAAA,MAAM,EAAA,GAAK,KAAK,UAAA,EAAW;AAE3B,IAAA,MAAM,OAAA,GAAmB;AAAA,MACvB,IAAA,EAAM,SAAA;AAAA,MACN,EAAA;AAAA,MACA,IAAA,EAAA,MAAA;AAAA;AAAA,MACA,OAAA,EAAS,OAAA,CAAQ,GAAA,CAAI,CAAA,CAAA,MAAM;AAAA,QACzB,IAAA,EAAA,aAAA;AAAA,QACA,aAAa,CAAA,CAAE,WAAA;AAAA,QACf,OAAA,EAAS,OAAO,CAAA,CAAE,OAAA,KAAY,QAAA,GAAW,EAAE,OAAA,GAAU,IAAA,CAAK,SAAA,CAAU,CAAA,CAAE,OAAO,CAAA;AAAA,QAC7E,OAAO,CAAA,CAAE;AAAA,OACX,CAAE;AAAA,KACJ;AAEA,IAAA,IAAA,CAAK,aAAA,CAAc,KAAK,OAAO,CAAA;AAC/B,IAAA,IAAA,CAAK,gBAAA,CAAiB,IAAI,EAAA,EAAI;AAAA,MAC5B,SAAA,EAAW,KAAK,GAAA,EAAI;AAAA,MACpB,UAAA,EAAY,IAAA,CAAK,qBAAA,CAAsB,OAAO;AAAA,KAC/C,CAAA;AAGD,IAAA,KAAA,MAAW,KAAK,OAAA,EAAS;AACvB,MAAA,IAAA,CAAK,WAAW,IAAA,CAAK;AAAA,QACnB,IAAI,CAAA,CAAE,WAAA;AAAA,QACN,IAAA,EAAO,EAAU,SAAA,IAAa,SAAA;AAAA,QAC9B,MAAM,EAAC;AAAA,QACP,QAAQ,CAAA,CAAE,OAAA;AAAA,QACV,OAAO,CAAA,CAAE,KAAA;AAAA,QACT,SAAA,EAAW,KAAK,GAAA;AAAI,OACrB,CAAA;AAAA,IACH;AAEA,IAAA,IAAA,CAAK,IAAA,CAAK,iBAAiB,EAAE,OAAA,EAAS,KAAK,uBAAA,CAAwB,OAAO,GAAG,CAAA;AAC7E,IAAA,OAAO,EAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,qBAAA,GAA8B;AAC5B,IAAA,IAAA,CAAK,mBAAA,GAAsB,KAAK,aAAA,CAAc,MAAA;AAAA,EAChD;AAAA;AAAA;AAAA;AAAA,EAKA,eAAA,GAA4C;AAC1C,IAAA,OAAO,IAAA,CAAK,aAAA;AAAA,EACd;AAAA;AAAA;AAAA;AAAA,EAKA,qBAAA,GAAgC;AAC9B,IAAA,OAAO,KAAK,aAAA,CAAc,MAAA;AAAA,EAC5B;AAAA;AAAA;AAAA;AAAA,EAKA,kBAAkB,MAAA,EAAuB;AACvC,IAAA,IAAA,CAAK,gBAAgB,EAAC;AACtB,IAAA,IAAA,CAAK,iBAAiB,KAAA,EAAM;AAC5B,IAAA,IAAA,CAAK,mBAAA,GAAsB,CAAA;AAC3B,IAAA,IAAA,CAAK,IAAA,CAAK,iBAAA,EAAmB,EAAE,MAAA,EAAQ,CAAA;AAAA,EACzC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAaA,MAAM,oBAAoB,OAAA,EAAqE;AAE7F,IAAA,IAAA,CAAK,qBAAA,EAAsB;AAG3B,IAAA,MAAM,kBAAA,GAAqB,KAAK,0BAAA,EAA2B;AAC3D,IAAA,MAAM,YAAA,GAAe,MAAM,IAAA,CAAK,oBAAA,EAAqB;AACrD,IAAA,MAAM,YAAY,kBAAA,GAAqB,YAAA;AAEvC,IAAA,IAAI,MAAA,GAAS,IAAA,CAAK,yBAAA,CAA0B,SAAS,CAAA;AACrD,IAAA,IAAA,CAAK,WAAA,GAAc,MAAA;AAGnB,IAAA,IAAI,MAAA,CAAO,WAAW,SAAA,EAAW;AAC/B,MAAA,IAAA,CAAK,IAAA,CAAK,gBAAA,EAAkB,EAAE,MAAA,EAAQ,CAAA;AAAA,IACxC,CAAA,MAAA,IAAW,MAAA,CAAO,MAAA,KAAW,UAAA,EAAY;AACvC,MAAA,IAAA,CAAK,IAAA,CAAK,iBAAA,EAAmB,EAAE,MAAA,EAAQ,CAAA;AAAA,IACzC;AAGA,IAAA,MAAM,kBAAkB,IAAA,CAAK,OAAA,CAAQ,eACnC,IAAA,CAAK,SAAA,CAAU,cAAc,MAAA,EAAQ;AAAA,MACnC,GAAG,sBAAA;AAAA,MACH,kBAAkB,IAAA,CAAK,iBAAA;AAAA,MACvB,eAAA,EAAiB,KAAK,OAAA,CAAQ;AAAA,KAC/B,CAAA;AAEH,IAAA,IAAI,gBAA0B,EAAC;AAC/B,IAAA,IAAI,eAAA,EAAiB;AACnB,MAAA,aAAA,GAAgB,MAAM,IAAA,CAAK,mBAAA,CAAoB,MAAM,CAAA;AAErD,MAAA,MAAM,SAAA,GAAY,IAAA,CAAK,0BAAA,EAA2B,GAAI,YAAA;AACtD,MAAA,MAAA,GAAS,IAAA,CAAK,0BAA0B,SAAS,CAAA;AACjD,MAAA,IAAA,CAAK,WAAA,GAAc,MAAA;AAAA,IACrB;AAGA,IAAA,MAAM,KAAA,GAAQ,MAAM,IAAA,CAAK,aAAA,CAAc,SAAS,mBAAmB,CAAA;AAEnE,IAAA,IAAA,CAAK,KAAK,kBAAA,EAAoB,EAAE,MAAA,EAAQ,SAAA,EAAW,iBAAiB,CAAA;AAEpE,IAAA,OAAO;AAAA,MACL,KAAA;AAAA,MACA,MAAA;AAAA,MACA,SAAA,EAAW,eAAA;AAAA,MACX;AAAA,KACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,YAAY,IAAA,EAAsB;AAChC,IAAA,IAAA,CAAK,iBAAA,GAAoB,IAAA;AAAA,EAC3B;AAAA;AAAA;AAAA;AAAA,EAKA,aAAA,GAAsB;AACpB,IAAA,IAAA,CAAK,iBAAA,GAAoB,MAAA;AACzB,IAAA,IAAA,CAAK,qBAAA,GAAwB,MAAA;AAAA,EAC/B;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,WAAA,GAAwB;AACtB,IAAA,IAAI,KAAK,iBAAA,EAAmB;AAC1B,MAAA,OAAO,IAAA,CAAK,iBAAA;AAAA,IACd;AACA,IAAA,IAAI,KAAK,mBAAA,EAAqB;AAC5B,MAAA,IAAA,CAAK,qBAAA,GAAwB,KAAK,sBAAA,EAAuB;AACzD,MAAA,OAAO,KAAK,qBAAA,IAAyB,SAAA;AAAA,IACvC;AACA,IAAA,OAAO,SAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,iBAAA,GAA4B;AAC1B,IAAA,OAAO,iBAAA,CAAkB,IAAA,CAAK,WAAA,EAAa,CAAA;AAAA,EAC7C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAeQ,qBAAA,GAA8B;AAIpC,IAAA,IAAA,CAAK,MAAA,CAAO,QAAA,CAAS,sBAAA,EAAwB,CAAA;AAG7C,IAAA,IAAI,IAAA,CAAK,UAAU,MAAA,EAAQ;AAEzB,MAAA,IAAA,CAAK,MAAA,CAAO,QAAA,CAAS,qBAAA,EAAuB,CAAA;AAC5C,MAAA,IAAA,CAAK,MAAA,CAAO,QAAA,CAAS,wBAAA,EAA0B,CAAA;AAC/C,MAAA,IAAA,CAAK,MAAA,CAAO,QAAA,CAAS,sBAAA,EAAwB,CAAA;AAC7C,MAAA,IAAA,CAAK,MAAA,CAAO,QAAA,CAAS,qBAAA,EAAuB,CAAA;AAC5C,MAAA,IAAA,CAAK,MAAA,CAAO,QAAA,CAAS,0BAAA,EAA4B,CAAA;AAAA,IACnD;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAMQ,sBAAA,GAA+C;AACrD,IAAA,MAAM,UAAA,GAAa,IAAA,CAAK,SAAA,CAAsB,MAAM,CAAA;AACpD,IAAA,MAAM,IAAA,GAAO,YAAY,OAAA,EAAQ;AACjC,IAAA,IAAI,CAAC,MAAM,OAAO,MAAA;AAGlB,IAAA,MAAM,IAAA,GAAO,GAAG,IAAA,CAAK,IAAI,IAAI,IAAA,CAAK,KAAA,CAAM,IAAI,CAAA,CAAA,KAAK,CAAA,EAAG,EAAE,IAAI,CAAA,CAAA,EAAI,EAAE,WAAW,CAAA,CAAE,EAAE,IAAA,CAAK,GAAG,CAAC,CAAA,CAAA,CAAG,WAAA,EAAY;AAGvG,IAAA,IAAI,gIAAA,CAAiI,IAAA,CAAK,IAAI,CAAA,EAAG;AAC/I,MAAA,OAAO,UAAA;AAAA,IACT;AAGA,IAAA,IAAI,sJAAA,CAAuJ,IAAA,CAAK,IAAI,CAAA,EAAG;AACrK,MAAA,OAAO,QAAA;AAAA,IACT;AAGA,IAAA,IAAI,qHAAA,CAAsH,IAAA,CAAK,IAAI,CAAA,EAAG;AACpI,MAAA,OAAO,UAAA;AAAA,IACT;AAEA,IAAA,OAAO,SAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EA6BA,MAAM,UAAA,CACJ,IAAA,EACA,OAAA,EACA,QAAA,EACgC;AAEhC,IAAA,IAAI,CAAC,KAAK,eAAA,EAAiB;AACzB,MAAA,OAAO,IAAA;AAAA,IACT;AAGA,IAAA,MAAM,eAAA,GAAkB,IAAA,CAAK,UAAA,CAAW,cAAA,CAAe,OAAO,CAAA;AAI9D,IAAA,IAAI,kBAAkB,GAAA,EAAM;AAC1B,MAAA,MAAM,WAAA,GAAc,MAAM,IAAA,CAAK,cAAA,CAAe,eAAe,CAAA;AAC7D,MAAA,IAAI,CAAC,WAAA,EAAa;AAEhB,QAAA,IAAA,CAAK,KAAK,iBAAA,EAAmB,EAAE,MAAA,EAAQ,IAAA,CAAK,aAAc,CAAA;AAAA,MAC5D;AAAA,IACF;AAGA,IAAA,MAAM,OAAA,GAAU,IAAA,KAAS,MAAA,GAAA,MAAA,cACrB,IAAA,KAAS,4CACT,IAAA,KAAS,QAAA,GAAA,WAAA,mBAAA,MAAA;AAGb,IAAA,MAAM,EAAA,GAAK,KAAK,UAAA,EAAW;AAC3B,IAAA,MAAM,OAAA,GAAmB;AAAA,MACvB,IAAA,EAAM,SAAA;AAAA,MACN,EAAA;AAAA,MACA,IAAA,EAAM,OAAA;AAAA,MACN,SAAS,CAAC,EAAE,IAAA,EAAA,YAAA,mBAA8B,IAAA,EAAM,SAAS;AAAA,KAC3D;AAEA,IAAA,IAAA,CAAK,aAAA,CAAc,KAAK,OAAO,CAAA;AAC/B,IAAA,IAAA,CAAK,gBAAA,CAAiB,IAAI,EAAA,EAAI;AAAA,MAC5B,SAAA,EAAW,KAAK,GAAA,EAAI;AAAA,MACpB,UAAA,EAAY,eAAA;AAAA,MACZ,UAAA,EAAY;AAAA;AAAA,KACb,CAAA;AAGD,IAAA,MAAM,cAAA,GAAiC;AAAA,MACrC,EAAA;AAAA,MACA,IAAA;AAAA,MACA,OAAA;AAAA,MACA,SAAA,EAAW,KAAK,GAAA,EAAI;AAAA,MACpB;AAAA,KACF;AAEA,IAAA,IAAA,CAAK,IAAA,CAAK,eAAA,EAAiB,EAAE,OAAA,EAAS,gBAAgB,CAAA;AACtD,IAAA,OAAO,cAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAgBA,cAAA,CACE,IAAA,EACA,OAAA,EACA,QAAA,EACuB;AAEvB,IAAA,IAAI,CAAC,KAAK,eAAA,EAAiB;AACzB,MAAA,OAAO,IAAA;AAAA,IACT;AAGA,IAAA,MAAM,OAAA,GAAU,IAAA,KAAS,MAAA,GAAA,MAAA,cACrB,IAAA,KAAS,4CACT,IAAA,KAAS,QAAA,GAAA,WAAA,mBAAA,MAAA;AAGb,IAAA,MAAM,EAAA,GAAK,KAAK,UAAA,EAAW;AAC3B,IAAA,MAAM,OAAA,GAAmB;AAAA,MACvB,IAAA,EAAM,SAAA;AAAA,MACN,EAAA;AAAA,MACA,IAAA,EAAM,OAAA;AAAA,MACN,SAAS,CAAC,EAAE,IAAA,EAAA,YAAA,mBAA8B,IAAA,EAAM,SAAS;AAAA,KAC3D;AAEA,IAAA,IAAA,CAAK,aAAA,CAAc,KAAK,OAAO,CAAA;AAC/B,IAAA,IAAA,CAAK,gBAAA,CAAiB,IAAI,EAAA,EAAI;AAAA,MAC5B,SAAA,EAAW,KAAK,GAAA,EAAI;AAAA,MACpB,UAAA,EAAY,IAAA,CAAK,UAAA,CAAW,cAAA,CAAe,OAAO,CAAA;AAAA,MAClD,UAAA,EAAY;AAAA;AAAA,KACb,CAAA;AAGD,IAAA,MAAM,cAAA,GAAiC;AAAA,MACrC,EAAA;AAAA,MACA,IAAA;AAAA,MACA,OAAA;AAAA,MACA,SAAA,EAAW,KAAK,GAAA,EAAI;AAAA,MACpB;AAAA,KACF;AAEA,IAAA,IAAA,CAAK,IAAA,CAAK,eAAA,EAAiB,EAAE,OAAA,EAAS,gBAAgB,CAAA;AACtD,IAAA,OAAO,cAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EA4BA,MAAM,aAAA,CACJ,MAAA,EACA,QAAA,EACgC;AAEhC,IAAA,IAAI,CAAC,KAAK,eAAA,EAAiB;AACzB,MAAA,OAAO,IAAA;AAAA,IACT;AAGA,IAAA,MAAM,OAAA,GAAU,OAAO,MAAA,KAAW,QAAA,GAC9B,SACA,IAAA,CAAK,SAAA,CAAU,MAAA,EAAQ,IAAA,EAAM,CAAC,CAAA;AAGlC,IAAA,OAAO,IAAA,CAAK,UAAA,CAAW,MAAA,EAAQ,OAAA,EAAS,QAAQ,CAAA;AAAA,EAClD;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,UAAA,GAA+B;AAC7B,IAAA,OAAO,KAAK,aAAA,CAAc,GAAA,CAAI,UAAQ,IAAA,CAAK,uBAAA,CAAwB,IAAI,CAAC,CAAA;AAAA,EAC1E;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,iBAAiB,KAAA,EAAiC;AAChD,IAAA,MAAM,WAAA,GAAc,IAAA,CAAK,aAAA,CAAc,KAAA,CAAM,CAAC,KAAK,CAAA;AACnD,IAAA,OAAO,YAAY,GAAA,CAAI,CAAA,IAAA,KAAQ,IAAA,CAAK,uBAAA,CAAwB,IAAI,CAAC,CAAA;AAAA,EACnE;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,eAAA,GAA0B;AACxB,IAAA,OAAO,KAAK,aAAA,CAAc,MAAA;AAAA,EAC5B;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,aAAa,MAAA,EAAuB;AAClC,IAAA,IAAA,CAAK,kBAAkB,MAAM,CAAA;AAAA,EAC/B;AAAA;AAAA;AAAA;AAAA,EAKA,YAAA,GAAiC;AAC/B,IAAA,OAAO,CAAC,GAAG,IAAA,CAAK,UAAU,CAAA;AAAA,EAC5B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAeA,MAAM,WAAA,CACJ,QAAA,EACA,IAAA,EACA,OAAA,EACkB;AAClB,IAAA,MAAM,IAAA,GAAO,IAAA,CAAK,MAAA,CAAO,GAAA,CAAI,QAAQ,CAAA;AACrC,IAAA,IAAI,CAAC,IAAA,EAAM;AACT,MAAA,MAAM,IAAI,KAAA,CAAM,CAAA,MAAA,EAAS,QAAQ,CAAA,WAAA,CAAa,CAAA;AAAA,IAChD;AAEA,IAAA,MAAM,SAAA,GAAY,KAAK,GAAA,EAAI;AAC3B,IAAA,IAAI,MAAA;AACJ,IAAA,IAAI,KAAA;AACJ,IAAA,IAAI,MAAA,GAAS,KAAA;AAEb,IAAA,IAAI;AAEF,MAAA,IAAI,IAAA,CAAK,aAAA,IAAiB,IAAA,CAAK,MAAA,EAAQ;AACrC,QAAA,MAAM,eAAe,MAAM,IAAA,CAAK,MAAA,CAAO,GAAA,CAAI,MAAM,IAAI,CAAA;AACrD,QAAA,IAAI,iBAAiB,KAAA,CAAA,EAAW;AAC9B,UAAA,MAAA,GAAS,IAAA;AACT,UAAA,MAAA,GAAS,YAAA;AACT,UAAA,IAAA,CAAK,KAAK,aAAA,EAAe,EAAE,IAAA,EAAM,QAAA,EAAU,MAAM,CAAA;AAAA,QACnD;AAAA,MACF;AAGA,MAAA,IAAI,CAAC,MAAA,EAAQ;AAEX,QAAA,MAAM,WAAA,GAA2B;AAAA,UAC/B,OAAA,EAAS,OAAA,EAAS,OAAA,IAAW,IAAA,CAAK,QAAA;AAAA,UAClC,QAAQ,OAAA,EAAS,MAAA;AAAA,UACjB,MAAA,EAAQ,IAAA,CAAK,OAAA,EAAS,SAAA,EAAU;AAAA;AAAA,UAChC,YAAA,EAAc,IAAA;AAAA;AAAA,UACd,gBAAA,EAAkB,KAAK,MAAA,IAAU,KAAA,CAAA;AAAA;AAAA,UACjC,eAAA,EAAiB,KAAK,gBAAA,IAAoB,KAAA,CAAA;AAAA;AAAA,UAC1C,sBAAA,EAAwB,KAAK,uBAAA,IAA2B,KAAA,CAAA;AAAA;AAAA,UACxD,QAAQ,OAAA,EAAS;AAAA,SACnB;AACA,QAAA,IAAA,CAAK,MAAA,CAAO,eAAe,WAAW,CAAA;AAGtC,QAAA,MAAA,GAAS,MAAM,IAAA,CAAK,MAAA,CAAO,OAAA,CAAQ,UAAU,IAAI,CAAA;AAGjD,QAAA,IAAI,IAAA,CAAK,aAAA,IAAiB,IAAA,CAAK,MAAA,EAAQ;AACrC,UAAA,MAAM,IAAA,CAAK,MAAA,CAAO,GAAA,CAAI,IAAA,EAAM,MAAM,MAAM,CAAA;AAAA,QAC1C;AAAA,MACF;AAAA,IACF,SAAS,GAAA,EAAK;AACZ,MAAA,KAAA,GAAQ,GAAA,YAAe,KAAA,GAAQ,GAAA,CAAI,OAAA,GAAU,OAAO,GAAG,CAAA;AACvD,MAAA,MAAM,GAAA;AAAA,IACR,CAAA,SAAE;AAEA,MAAA,MAAM,MAAA,GAAyB;AAAA,QAC7B,EAAA,EAAI,KAAK,UAAA,EAAW;AAAA,QACpB,IAAA,EAAM,QAAA;AAAA,QACN,IAAA;AAAA,QACA,MAAA,EAAQ,QAAQ,MAAA,GAAY,MAAA;AAAA,QAC5B,KAAA;AAAA,QACA,UAAA,EAAY,IAAA,CAAK,GAAA,EAAI,GAAI,SAAA;AAAA,QACzB,MAAA;AAAA,QACA,SAAA,EAAW,KAAK,GAAA;AAAI,OACtB;AAEA,MAAA,IAAA,CAAK,UAAA,CAAW,KAAK,MAAM,CAAA;AAC3B,MAAA,IAAA,CAAK,IAAA,CAAK,eAAA,EAAiB,EAAE,MAAA,EAAQ,CAAA;AAAA,IACvC;AAEA,IAAA,OAAO,MAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,eAAe,MAAA,EAA8B;AAC3C,IAAA,IAAI,IAAA,CAAK,QAAA,CAAS,GAAA,CAAI,MAAA,CAAO,IAAI,CAAA,EAAG;AAClC,MAAA,MAAM,IAAI,KAAA,CAAM,CAAA,QAAA,EAAW,MAAA,CAAO,IAAI,CAAA,uBAAA,CAAyB,CAAA;AAAA,IACjE;AACA,IAAA,IAAA,CAAK,QAAA,CAAS,GAAA,CAAI,MAAA,CAAO,IAAA,EAAM,MAAM,CAAA;AACrC,IAAA,IAAA,CAAK,KAAK,mBAAA,EAAqB,EAAE,IAAA,EAAM,MAAA,CAAO,MAAM,CAAA;AAAA,EACtD;AAAA;AAAA;AAAA;AAAA,EAKA,iBAAiB,IAAA,EAAuB;AACtC,IAAA,MAAM,MAAA,GAAS,IAAA,CAAK,QAAA,CAAS,GAAA,CAAI,IAAI,CAAA;AACrC,IAAA,IAAI,MAAA,EAAQ;AACV,MAAA,MAAA,CAAO,OAAA,IAAU;AACjB,MAAA,IAAA,CAAK,QAAA,CAAS,OAAO,IAAI,CAAA;AACzB,MAAA,IAAA,CAAK,IAAA,CAAK,qBAAA,EAAuB,EAAE,IAAA,EAAM,CAAA;AACzC,MAAA,OAAO,IAAA;AAAA,IACT;AACA,IAAA,OAAO,KAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,UAAoC,IAAA,EAA6B;AAC/D,IAAA,OAAO,IAAA,CAAK,QAAA,CAAS,GAAA,CAAI,IAAI,CAAA;AAAA,EAC/B;AAAA;AAAA;AAAA;AAAA,EAKA,WAAA,GAAwB;AACtB,IAAA,OAAO,KAAA,CAAM,IAAA,CAAK,IAAA,CAAK,QAAA,CAAS,MAAM,CAAA;AAAA,EACxC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAkBA,MAAM,OAAA,GAAoC;AACxC,IAAA,MAAM,UAAA,GAAa,MAAM,IAAA,CAAK,eAAA,EAAgB;AAC9C,IAAA,IAAA,CAAK,KAAK,mBAAA,EAAqB,EAAE,cAAA,EAAgB,UAAA,CAAW,QAAQ,CAAA;AAEpE,IAAA,IAAI,MAAA,GAAS,IAAA,CAAK,eAAA,CAAgB,UAAU,CAAA;AAC5C,IAAA,IAAA,CAAK,WAAA,GAAc,MAAA;AAGnB,IAAA,IAAI,MAAA,CAAO,WAAW,SAAA,EAAW;AAC/B,MAAA,IAAA,CAAK,IAAA,CAAK,gBAAA,EAAkB,EAAE,MAAA,EAAQ,CAAA;AAAA,IACxC,CAAA,MAAA,IAAW,MAAA,CAAO,MAAA,KAAW,UAAA,EAAY;AACvC,MAAA,IAAA,CAAK,IAAA,CAAK,iBAAA,EAAmB,EAAE,MAAA,EAAQ,CAAA;AAAA,IACzC;AAGA,IAAA,MAAM,kBAAkB,IAAA,CAAK,OAAA,CAAQ,eACnC,IAAA,CAAK,SAAA,CAAU,cAAc,MAAA,EAAQ;AAAA,MACnC,GAAG,sBAAA;AAAA,MACH,kBAAkB,IAAA,CAAK,iBAAA;AAAA,MACvB,eAAA,EAAiB,KAAK,OAAA,CAAQ;AAAA,KAC/B,CAAA;AAEH,IAAA,IAAI,eAAA,EAAiB;AACnB,MAAA,MAAM,MAAA,GAAS,MAAM,IAAA,CAAK,YAAA,CAAa,YAAY,MAAM,CAAA;AACzD,MAAA,IAAA,CAAK,IAAA,CAAK,oBAAoB,EAAE,MAAA,EAAQ,OAAO,MAAA,EAAQ,SAAA,EAAW,MAAM,CAAA;AACxE,MAAA,OAAO,MAAA;AAAA,IACT;AAEA,IAAA,IAAA,CAAK,KAAK,kBAAA,EAAoB,EAAE,MAAA,EAAQ,SAAA,EAAW,OAAO,CAAA;AAC1D,IAAA,OAAO,EAAE,UAAA,EAAY,MAAA,EAAQ,SAAA,EAAW,KAAA,EAAM;AAAA,EAChD;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,SAAA,GAAoC;AACxC,IAAA,MAAM,UAAA,GAAa,MAAM,IAAA,CAAK,eAAA,EAAgB;AAC9C,IAAA,OAAO,IAAA,CAAK,gBAAgB,UAAU,CAAA;AAAA,EACxC;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,OAAA,GAAoC;AACxC,IAAA,MAAM,UAAA,GAAa,MAAM,IAAA,CAAK,eAAA,EAAgB;AAC9C,IAAA,MAAM,MAAA,GAAS,IAAA,CAAK,eAAA,CAAgB,UAAU,CAAA;AAC9C,IAAA,OAAO,IAAA,CAAK,YAAA,CAAa,UAAA,EAAY,MAAM,CAAA;AAAA,EAC7C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,YAAY,QAAA,EAAqF;AAC/F,IAAA,IAAA,CAAK,SAAA,GAAY,cAAA,CAAsB,QAAA,EAAU,EAAE,CAAA;AAAA,EACrD;AAAA;AAAA;AAAA;AAAA,EAKA,mBAAA,GAA8B;AAC5B,IAAA,OAAO,IAAA,CAAK,iBAAA;AAAA,EACd;AAAA;AAAA;AAAA;AAAA,EAKA,oBAAoB,MAAA,EAAsB;AACxC,IAAA,IAAA,CAAK,iBAAA,GAAoB,MAAA;AAAA,EAC3B;AAAA;AAAA;AAAA;AAAA,EAKA,gBAAgB,OAAA,EAAwB;AACtC,IAAA,IAAA,CAAK,aAAA,GAAgB,OAAA;AAAA,EACvB;AAAA;AAAA;AAAA;AAAA,EAKA,cAAA,GAA0B;AACxB,IAAA,OAAO,IAAA,CAAK,aAAA;AAAA,EACd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,cAAA,CAAe,SAAiB,IAAA,EAAiC;AAC/D,IAAA,OAAO,IAAA,CAAK,UAAA,CAAW,cAAA,CAAe,OAAA,EAAS,IAAI,CAAA;AAAA,EACrD;AAAA;AAAA;AAAA;AAAA,EAKA,cAAA,GAAyB;AACvB,IAAA,OAAO,IAAA,CAAK,aAAa,kBAAA,IAAsB,CAAA;AAAA,EACjD;AAAA;AAAA;AAAA;AAAA,EAKA,aAAA,GAAsC;AACpC,IAAA,OAAO,IAAA,CAAK,WAAA;AAAA,EACd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EA2BA,MAAM,eAAe,eAAA,EAA2C;AAE9D,IAAA,MAAM,UAAA,GAAa,MAAM,IAAA,CAAK,eAAA,EAAgB;AAC9C,IAAA,MAAM,MAAA,GAAS,IAAA,CAAK,eAAA,CAAgB,UAAU,CAAA;AAG9C,IAAA,MAAM,aAAA,GAAgB,OAAO,IAAA,GAAO,eAAA;AACpC,IAAA,MAAM,mBAAA,GAAsB,MAAA,CAAO,KAAA,GAAQ,MAAA,CAAO,QAAA;AAClD,IAAA,MAAM,uBAAuB,aAAA,GAAgB,mBAAA;AAG7C,IAAA,MAAM,eAAA,GAAiC;AAAA,MACrC,GAAG,MAAA;AAAA,MACH,IAAA,EAAM,aAAA;AAAA,MACN,SAAA,EAAW,OAAO,SAAA,GAAY,eAAA;AAAA,MAC9B,oBAAoB,oBAAA,GAAuB,GAAA;AAAA,MAC3C,QAAQ,oBAAA,IAAwB,GAAA,GAAM,UAAA,GAAa,oBAAA,IAAwB,OAAO,SAAA,GAAY;AAAA,KAChG;AAGA,IAAA,MAAM,eAAA,GAAkB,IAAA,CAAK,SAAA,CAAU,aAAA,CAAc,eAAA,EAAiB;AAAA,MACpE,GAAG,sBAAA;AAAA,MACH,kBAAkB,IAAA,CAAK,iBAAA;AAAA,MACvB,eAAA,EAAiB,KAAK,OAAA,CAAQ;AAAA,KAC/B,CAAA;AAED,IAAA,IAAI,CAAC,eAAA,EAAiB;AACpB,MAAA,OAAO,IAAA;AAAA,IACT;AAGA,IAAA,IAAA,CAAK,IAAA,CAAK,gBAAA,EAAkB,EAAE,MAAA,EAAQ,CAAA;AACtC,IAAA,MAAM,IAAA,CAAK,YAAA,CAAa,UAAA,EAAY,MAAM,CAAA;AAG1C,IAAA,MAAM,aAAA,GAAgB,MAAM,IAAA,CAAK,eAAA,EAAgB;AACjD,IAAA,MAAM,SAAA,GAAY,IAAA,CAAK,eAAA,CAAgB,aAAa,CAAA;AACpD,IAAA,IAAA,CAAK,WAAA,GAAc,SAAA;AAGnB,IAAA,OAAQ,UAAU,SAAA,IAAa,eAAA;AAAA,EACjC;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,UAAA,GAA2C;AAE/C,IAAA,IAAI,WAAA;AACJ,IAAA,IAAI,KAAK,OAAA,EAAS;AAChB,MAAA,MAAM,KAAA,GAAQ,MAAM,IAAA,CAAK,OAAA,CAAQ,QAAA,EAAS;AAC1C,MAAA,WAAA,GAAc;AAAA,QACZ,cAAc,KAAA,CAAM,YAAA;AAAA,QACpB,gBAAgB,KAAA,CAAM,cAAA;AAAA,QACtB,oBAAoB,KAAA,CAAM;AAAA,OAC5B;AAAA,IACF,CAAA,MAAO;AACL,MAAA,WAAA,GAAc;AAAA,QACZ,YAAA,EAAc,CAAA;AAAA,QACd,cAAA,EAAgB,CAAA;AAAA,QAChB,kBAAA,EAAoB;AAAA,OACtB;AAAA,IACF;AAGA,IAAA,MAAM,UAAA,GAAa,IAAA,CAAK,MAAA,EAAQ,QAAA,EAAS,IAAK;AAAA,MAC5C,OAAA,EAAS,CAAA;AAAA,MACT,IAAA,EAAM,CAAA;AAAA,MACN,MAAA,EAAQ,CAAA;AAAA,MACR,OAAA,EAAS;AAAA,KACX;AAEA,IAAA,OAAO;AAAA,MACL,mBAAA,EAAqB,KAAK,aAAA,CAAc,MAAA;AAAA,MACxC,aAAA,EAAe,KAAK,UAAA,CAAW,MAAA;AAAA,MAC/B,UAAA;AAAA,MACA,WAAA;AAAA,MACA,WAAA,EAAa,KAAK,QAAA,CAAS,IAAA;AAAA,MAC3B,kBAAA,EAAoB,IAAA,CAAK,WAAA,EAAa,kBAAA,IAAsB;AAAA,KAC9D;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAiBA,MAAM,QAAA,GAAiD;AACrD,IAAA,MAAM,eAAwC,EAAC;AAC/C,IAAA,KAAA,MAAW,CAAC,IAAA,EAAM,MAAM,CAAA,IAAK,KAAK,QAAA,EAAU;AAC1C,MAAA,MAAM,KAAA,GAAQ,OAAO,QAAA,IAAW;AAChC,MAAA,IAAI,UAAU,MAAA,EAAW;AACvB,QAAA,YAAA,CAAa,IAAI,CAAA,GAAI,KAAA;AAAA,MACvB;AAAA,IACF;AAGA,IAAA,IAAI,MAAA;AACJ,IAAA,IAAI,KAAK,OAAA,EAAS;AAChB,MAAA,MAAA,GAAS,MAAM,IAAA,CAAK,OAAA,CAAQ,SAAA,EAAU;AAAA,IACxC;AAGA,IAAA,MAAM,eAAA,GAAkB,IAAA,CAAK,YAAA,EAAc,QAAA,EAAS,IAAK;AAAA,MACvD,OAAA,EAAS,CAAA;AAAA,MACT,WAAW,EAAC;AAAA,MACZ,WAAW,EAAC;AAAA,MACZ,WAAW;AAAC,KACd;AAGA,IAAA,MAAM,cAA+C,EAAC;AACtD,IAAA,KAAA,MAAW,CAAC,GAAA,EAAK,KAAK,CAAA,IAAK,KAAK,gBAAA,EAAkB;AAChD,MAAA,WAAA,CAAY,GAAG,CAAA,GAAI,KAAA;AAAA,IACrB;AAEA,IAAA,OAAO;AAAA,MACL,OAAA,EAAS,CAAA;AAAA;AAAA,MACT,IAAA,EAAM;AAAA,QACJ,cAAc,IAAA,CAAK,aAAA;AAAA,QACnB,cAAc,IAAA,CAAK,aAAA;AAAA;AAAA,QAEnB,cAAc,IAAA,CAAK,aAAA;AAAA,QACnB,eAAA,EAAiB,WAAA;AAAA;AAAA,QAEjB,OAAA,EAAS,KAAK,aAAA,CAAc,GAAA,CAAI,UAAQ,IAAA,CAAK,uBAAA,CAAwB,IAAI,CAAC,CAAA;AAAA,QAC1E,WAAW,IAAA,CAAK;AAAA,OAClB;AAAA,MACA,KAAA,EAAO,IAAA,CAAK,MAAA,CAAO,QAAA,EAAS;AAAA,MAC5B,MAAA;AAAA,MACA,WAAA,EAAa,eAAA;AAAA,MACb,OAAA,EAAS,YAAA;AAAA,MACT,MAAA,EAAQ;AAAA,QACN,KAAA,EAAO,KAAK,OAAA,CAAQ,KAAA;AAAA,QACpB,kBAAkB,IAAA,CAAK,iBAAA;AAAA,QACvB,QAAA,EAAU,KAAK,SAAA,CAAU;AAAA;AAC3B,KACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,MAAM,aAAa,KAAA,EAAmD;AAEpE,IAAA,IAAA,CAAK,aAAA,GAAgB,KAAA,CAAM,IAAA,CAAK,YAAA,IAAgB,EAAA;AAChD,IAAA,IAAA,CAAK,aAAA,GAAgB,KAAA,CAAM,IAAA,CAAK,YAAA,IAAgB,EAAA;AAChD,IAAA,IAAA,CAAK,UAAA,GAAa,KAAA,CAAM,IAAA,CAAK,SAAA,IAAa,EAAC;AAG3C,IAAA,IAAI,KAAA,CAAM,OAAA,IAAW,CAAA,IAAK,KAAA,CAAM,KAAK,YAAA,EAAc;AAEjD,MAAA,IAAA,CAAK,aAAA,GAAgB,MAAM,IAAA,CAAK,YAAA;AAEhC,MAAA,IAAA,CAAK,iBAAiB,KAAA,EAAM;AAC5B,MAAA,IAAI,KAAA,CAAM,KAAK,eAAA,EAAiB;AAC9B,QAAA,KAAA,MAAW,CAAC,KAAK,KAAK,CAAA,IAAK,OAAO,OAAA,CAAQ,KAAA,CAAM,IAAA,CAAK,eAAe,CAAA,EAAG;AACrE,UAAA,IAAA,CAAK,gBAAA,CAAiB,GAAA,CAAI,GAAA,EAAK,KAAwB,CAAA;AAAA,QACzD;AAAA,MACF;AAAA,IACF,CAAA,MAAA,IAAW,KAAA,CAAM,IAAA,CAAK,OAAA,EAAS;AAE7B,MAAA,IAAA,CAAK,gBAAgB,EAAC;AACtB,MAAA,IAAA,CAAK,iBAAiB,KAAA,EAAM;AAC5B,MAAA,KAAA,MAAW,GAAA,IAAO,KAAA,CAAM,IAAA,CAAK,OAAA,EAAS;AACpC,QAAA,MAAM,IAAA,GAAO,IAAI,IAAA,KAAS,MAAA,GAAA,MAAA,cACtB,IAAI,IAAA,KAAS,WAAA,GAAA,WAAA,mBACb,IAAI,IAAA,KAAS,QAAA,GAAA,WAAA,mBAAA,MAAA;AAGjB,QAAA,MAAM,SAAA,GAAqB;AAAA,UACzB,IAAA,EAAM,SAAA;AAAA,UACN,IAAI,GAAA,CAAI,EAAA;AAAA,UACR,IAAA;AAAA,UACA,SAAS,CAAC,EAAE,qCAA8B,IAAA,EAAM,GAAA,CAAI,SAAS;AAAA,SAC/D;AACA,QAAA,IAAA,CAAK,aAAA,CAAc,KAAK,SAAS,CAAA;AACjC,QAAA,IAAA,CAAK,gBAAA,CAAiB,GAAA,CAAI,GAAA,CAAI,EAAA,EAAI;AAAA,UAChC,WAAW,GAAA,CAAI,SAAA;AAAA,UACf,UAAA,EAAY,IAAA,CAAK,UAAA,CAAW,cAAA,CAAe,IAAI,OAAO;AAAA,SACvD,CAAA;AAAA,MACH;AAAA,IACF,CAAA,MAAO;AACL,MAAA,IAAA,CAAK,gBAAgB,EAAC;AACtB,MAAA,IAAA,CAAK,iBAAiB,KAAA,EAAM;AAAA,IAC9B;AAEA,IAAA,IAAA,CAAK,mBAAA,GAAsB,CAAA;AAG3B,IAAA,IAAI,KAAA,CAAM,OAAO,gBAAA,EAAkB;AACjC,MAAA,IAAA,CAAK,iBAAA,GAAoB,MAAM,MAAA,CAAO,gBAAA;AAAA,IACxC;AACA,IAAA,IAAI,KAAA,CAAM,OAAO,QAAA,EAAU;AACzB,MAAA,IAAA,CAAK,YAAY,cAAA,CAAsB,KAAA,CAAM,MAAA,CAAO,QAAA,EAAU,EAAE,CAAA;AAAA,IAClE;AAGA,IAAA,IAAI,MAAM,KAAA,EAAO;AACf,MAAA,IAAA,CAAK,MAAA,CAAO,SAAA,CAAU,KAAA,CAAM,KAAK,CAAA;AAAA,IACnC;AAGA,IAAA,IAAI,KAAA,CAAM,MAAA,IAAU,IAAA,CAAK,OAAA,EAAS;AAChC,MAAA,MAAM,IAAA,CAAK,OAAA,CAAQ,OAAA,CAAQ,KAAA,CAAM,MAAM,CAAA;AAAA,IACzC;AAGA,IAAA,IAAI,KAAA,CAAM,WAAA,IAAe,IAAA,CAAK,YAAA,EAAc;AAC1C,MAAA,IAAA,CAAK,YAAA,CAAa,SAAA,CAAU,KAAA,CAAM,WAAW,CAAA;AAAA,IAC/C;AAGA,IAAA,KAAA,MAAW,CAAC,MAAM,WAAW,CAAA,IAAK,OAAO,OAAA,CAAQ,KAAA,CAAM,OAAO,CAAA,EAAG;AAC/D,MAAA,MAAM,MAAA,GAAS,IAAA,CAAK,QAAA,CAAS,GAAA,CAAI,IAAI,CAAA;AACrC,MAAA,IAAI,QAAQ,YAAA,EAAc;AACxB,QAAA,MAAA,CAAO,aAAa,WAAW,CAAA;AAAA,MACjC;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAkBA,MAAM,IAAA,CACJ,SAAA,EACA,QAAA,EACA,aAAA,EACe;AACf,IAAA,IAAI,CAAC,KAAK,QAAA,EAAU;AAClB,MAAA,MAAM,IAAI,MAAM,6FAA6F,CAAA;AAAA,IAC/G;AAEA,IAAA,MAAM,eAAA,GAAkB,aAAa,IAAA,CAAK,UAAA;AAC1C,IAAA,IAAI,CAAC,eAAA,EAAiB;AACpB,MAAA,MAAM,IAAI,MAAM,4FAA4F,CAAA;AAAA,IAC9G;AAGA,IAAA,MAAM,KAAA,GAAQ,aAAA,IAAiB,MAAM,IAAA,CAAK,QAAA,EAAS;AAGnD,IAAA,MAAM,aAAA,GAAwC;AAAA,MAC5C,GAAG,IAAA,CAAK,gBAAA;AAAA,MACR,GAAG;AAAA,KACL;AAGA,IAAA,MAAM,IAAA,CAAK,QAAA,CAAS,IAAA,CAAK,eAAA,EAAiB,OAAO,aAAa,CAAA;AAG9D,IAAA,IAAA,CAAK,UAAA,GAAa,eAAA;AAClB,IAAA,IAAA,CAAK,gBAAA,GAAmB,aAAA;AAAA,EAC1B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAmBA,MAAM,KAAK,SAAA,EAAqC;AAC9C,IAAA,MAAM,MAAA,GAAS,MAAM,IAAA,CAAK,OAAA,CAAQ,SAAS,CAAA;AAC3C,IAAA,IAAI,CAAC,MAAA,EAAQ;AACX,MAAA,OAAO,KAAA;AAAA,IACT;AACA,IAAA,MAAM,IAAA,CAAK,YAAA,CAAa,MAAA,CAAO,KAAK,CAAA;AACpC,IAAA,OAAO,IAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,MAAM,QAAQ,SAAA,EAA6G;AACzH,IAAA,IAAI,CAAC,KAAK,QAAA,EAAU;AAClB,MAAA,MAAM,IAAI,MAAM,6FAA6F,CAAA;AAAA,IAC/G;AAGA,IAAA,MAAM,MAAA,GAAS,MAAM,IAAA,CAAK,QAAA,CAAS,KAAK,SAAS,CAAA;AACjD,IAAA,IAAI,CAAC,MAAA,EAAQ;AACX,MAAA,OAAO,IAAA;AAAA,IACT;AAGA,IAAA,IAAA,CAAK,UAAA,GAAa,SAAA;AAClB,IAAA,IAAA,CAAK,mBAAmB,MAAA,CAAO,QAAA;AAE/B,IAAA,OAAO,EAAE,KAAA,EAAO,MAAA,CAAO,KAAA,EAAO,QAAA,EAAU,OAAO,QAAA,EAAS;AAAA,EAC1D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,MAAM,cAAc,SAAA,EAAqC;AACvD,IAAA,IAAI,CAAC,KAAK,QAAA,EAAU;AAClB,MAAA,MAAM,IAAI,MAAM,6FAA6F,CAAA;AAAA,IAC/G;AACA,IAAA,OAAO,IAAA,CAAK,QAAA,CAAS,MAAA,CAAO,SAAS,CAAA;AAAA,EACvC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,MAAM,cAAc,SAAA,EAAmC;AACrD,IAAA,IAAI,CAAC,KAAK,QAAA,EAAU;AAClB,MAAA,MAAM,IAAI,MAAM,6FAA6F,CAAA;AAAA,IAC/G;AAEA,IAAA,MAAM,eAAA,GAAkB,aAAa,IAAA,CAAK,UAAA;AAC1C,IAAA,IAAI,CAAC,eAAA,EAAiB;AACpB,MAAA,MAAM,IAAI,MAAM,+CAA+C,CAAA;AAAA,IACjE;AAEA,IAAA,MAAM,IAAA,CAAK,QAAA,CAAS,MAAA,CAAO,eAAe,CAAA;AAG1C,IAAA,IAAI,eAAA,KAAoB,KAAK,UAAA,EAAY;AACvC,MAAA,IAAA,CAAK,UAAA,GAAa,IAAA;AAClB,MAAA,IAAA,CAAK,mBAAmB,EAAC;AAAA,IAC3B;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,OAAA,GAAgB;AAEd,IAAA,KAAA,MAAW,MAAA,IAAU,IAAA,CAAK,QAAA,CAAS,MAAA,EAAO,EAAG;AAC3C,MAAA,MAAA,CAAO,OAAA,IAAU;AAAA,IACnB;AACA,IAAA,IAAA,CAAK,SAAS,KAAA,EAAM;AAGpB,IAAA,IAAA,CAAK,QAAQ,OAAA,EAAQ;AAGrB,IAAA,IAAA,CAAK,OAAO,OAAA,EAAQ;AAGpB,IAAA,IAAA,CAAK,gBAAgB,EAAC;AACtB,IAAA,IAAA,CAAK,iBAAiB,KAAA,EAAM;AAC5B,IAAA,IAAA,CAAK,mBAAA,GAAsB,CAAA;AAC3B,IAAA,IAAA,CAAK,aAAa,EAAC;AAEnB,IAAA,IAAA,CAAK,kBAAA,EAAmB;AAAA,EAC1B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAWA,MAAc,eAAA,GAAgD;AAC5D,IAAA,MAAM,aAAkC,EAAC;AAGzC,IAAA,MAAM,QAAA,GAAW,KAAK,WAAA,EAAY;AAClC,IAAA,MAAM,eAAA,GAAkB,kBAAkB,QAAQ,CAAA;AAGlD,IAAA,MAAM,cAAA,GAAiB,IAAA,CAAK,8BAAA,CAA+B,QAAQ,CAAA;AAGnE,IAAA,MAAM,gBAAA,GAAmB,IAAA,CAAK,aAAA,GAC1B,CAAA,EAAG,KAAK,aAAa;;AAAA,EAAO,cAAc,CAAA,CAAA,GAC1C,cAAA;AACJ,IAAA,IAAI,gBAAA,EAAkB;AACpB,MAAA,UAAA,CAAW,IAAA,CAAK;AAAA,QACd,IAAA,EAAM,eAAA;AAAA,QACN,OAAA,EAAS,gBAAA;AAAA,QACT,QAAA,EAAU,CAAA;AAAA,QACV,WAAA,EAAa;AAAA,OACd,CAAA;AAAA,IACH;AAGA,IAAA,IAAI,KAAK,aAAA,EAAe;AACtB,MAAA,UAAA,CAAW,IAAA,CAAK;AAAA,QACd,IAAA,EAAM,cAAA;AAAA,QACN,SAAS,IAAA,CAAK,aAAA;AAAA,QACd,QAAA,EAAU,CAAA;AAAA,QACV,WAAA,EAAa;AAAA,OACd,CAAA;AAAA,IACH;AAIA,IAAA,MAAM,mBAAA,GAAsB,wBAAA,CAAyB,IAAA,CAAK,SAAS,CAAA;AACnE,IAAA,IAAI,mBAAA,EAAqB;AACvB,MAAA,UAAA,CAAW,KAAK,mBAAmB,CAAA;AAAA,IACrC;AAGA,IAAA,IAAI,KAAK,SAAA,CAAU,OAAA,IAAW,IAAA,CAAK,aAAA,CAAc,SAAS,CAAA,EAAG;AAC3D,MAAA,UAAA,CAAW,IAAA,CAAK;AAAA,QACd,IAAA,EAAM,sBAAA;AAAA,QACN,OAAA,EAAS,KAAK,4BAAA,EAA6B;AAAA,QAC3C,QAAA,EAAU,gBAAgB,oBAAA,IAAwB,CAAA;AAAA,QAClD,WAAA,EAAa,IAAA;AAAA,QACb,QAAA,EAAU;AAAA,UACR,YAAA,EAAc,KAAK,aAAA,CAAc,MAAA;AAAA,UACjC,QAAA,EAAU,QAAA,KAAa,UAAA,GAAa,WAAA,GAAc;AAAA;AACpD,OACD,CAAA;AAAA,IACH;AAGA,IAAA,IAAI,IAAA,CAAK,SAAA,CAAU,MAAA,IAAU,IAAA,CAAK,OAAA,EAAS;AACzC,MAAA,MAAM,WAAA,GAAc,MAAM,IAAA,CAAK,OAAA,CAAQ,WAAA,EAAY;AAEnD,MAAA,MAAM,OAAA,GAAU,CAAC,WAAA,IAAe,WAAA,CAAY,IAAA,GAAO,MAAA,KAAW,CAAA,IAAK,WAAA,CAAY,QAAA,CAAS,kBAAkB,CAAA;AAC1G,MAAA,IAAI,CAAC,OAAA,EAAS;AACZ,QAAA,UAAA,CAAW,IAAA,CAAK;AAAA,UACd,IAAA,EAAM,cAAA;AAAA,UACN,OAAA,EAAS,WAAA;AAAA,UACT,QAAA,EAAU,gBAAgB,YAAA,IAAgB,CAAA;AAAA,UAC1C,WAAA,EAAa,IAAA;AAAA,UACb,QAAA,EAAU;AAAA,YACR,QAAA,EAAU;AAAA;AACZ,SACD,CAAA;AAAA,MACH;AAAA,IACF;AAGA,IAAA,KAAA,MAAW,MAAA,IAAU,IAAA,CAAK,QAAA,CAAS,MAAA,EAAO,EAAG;AAC3C,MAAA,IAAI;AACF,QAAA,MAAM,SAAA,GAAY,MAAM,MAAA,CAAO,YAAA,EAAa;AAC5C,QAAA,IAAI,SAAA,EAAW;AAEb,UAAA,MAAM,gBAAA,GAAmB,eAAA,CAAgB,SAAA,CAAU,IAAI,CAAA;AACvD,UAAA,IAAI,qBAAqB,KAAA,CAAA,EAAW;AAClC,YAAA,SAAA,CAAU,QAAA,GAAW,gBAAA;AAAA,UACvB;AACA,UAAA,UAAA,CAAW,KAAK,SAAS,CAAA;AAAA,QAC3B;AAAA,MACF,SAAS,KAAA,EAAO;AACd,QAAA,OAAA,CAAQ,IAAA,CAAK,CAAA,QAAA,EAAW,MAAA,CAAO,IAAI,8BAA8B,KAAK,CAAA;AAAA,MACxE;AAAA,IACF;AAGA,IAAA,IAAI,KAAK,aAAA,EAAe;AACtB,MAAA,UAAA,CAAW,IAAA,CAAK;AAAA,QACd,IAAA,EAAM,eAAA;AAAA,QACN,SAAS,IAAA,CAAK,aAAA;AAAA,QACd,QAAA,EAAU,CAAA;AAAA,QACV,WAAA,EAAa;AAAA,OACd,CAAA;AAAA,IACH;AAEA,IAAA,OAAO,UAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKQ,+BAA+B,QAAA,EAA4B;AACjE,IAAA,MAAM,UAAA,GAAa,kBAAkB,QAAQ,CAAA;AAG7C,IAAA,IAAI,CAAC,IAAA,CAAK,SAAA,CAAU,MAAA,EAAQ;AAE1B,MAAA,IAAI,aAAa,UAAA,EAAY;AAC3B,QAAA,OAAO,CAAA;;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA,wBAAA,CAAA;AAAA,MAeT,CAAA,MAAA,IAAW,aAAa,QAAA,EAAU;AAChC,QAAA,OAAO,CAAA;;AAAA;AAAA;AAAA;AAAA,kEAAA,CAAA;AAAA,MAMT,CAAA,MAAA,IAAW,aAAa,UAAA,EAAY;AAClC,QAAA,OAAO,CAAA;;AAAA;AAAA;AAAA,uDAAA,CAAA;AAAA,MAKT,CAAA,MAAO;AACL,QAAA,OAAO,CAAA;;AAAA;AAAA,0CAAA,CAAA;AAAA,MAIT;AAAA,IACF;AAEA,IAAA,OAAO,UAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKQ,gBAAgB,UAAA,EAAgD;AACtE,IAAA,MAAM,YAAoC,EAAC;AAC3C,IAAA,IAAI,IAAA,GAAO,CAAA;AAEX,IAAA,KAAA,MAAW,aAAa,UAAA,EAAY;AAClC,MAAA,MAAM,MAAA,GAAS,uBAAA,CAAwB,SAAA,EAAW,IAAA,CAAK,UAAU,CAAA;AACjE,MAAA,SAAA,CAAU,SAAA,CAAU,IAAI,CAAA,GAAI,MAAA;AAC5B,MAAA,IAAA,IAAQ,MAAA;AAAA,IACV;AAEA,IAAA,MAAM,QAAQ,IAAA,CAAK,iBAAA;AACnB,IAAA,MAAM,WAAW,IAAA,CAAK,KAAA,CAAM,KAAA,GAAQ,IAAA,CAAK,QAAQ,eAAe,CAAA;AAChE,IAAA,MAAM,SAAA,GAAY,QAAQ,QAAA,GAAW,IAAA;AACrC,IAAA,MAAM,gBAAA,GAAA,CAAoB,OAAO,QAAA,IAAY,KAAA;AAC7C,IAAA,MAAM,kBAAA,GAAsB,IAAA,IAAQ,KAAA,GAAQ,QAAA,CAAA,GAAa,GAAA;AAEzD,IAAA,IAAI,MAAA;AACJ,IAAA,IAAI,oBAAoB,GAAA,EAAK;AAC3B,MAAA,MAAA,GAAS,UAAA;AAAA,IACX,CAAA,MAAA,IAAW,oBAAoB,IAAA,EAAM;AACnC,MAAA,MAAA,GAAS,SAAA;AAAA,IACX,CAAA,MAAO;AACL,MAAA,MAAA,GAAS,IAAA;AAAA,IACX;AAEA,IAAA,OAAO;AAAA,MACL,KAAA;AAAA,MACA,QAAA;AAAA,MACA,IAAA;AAAA,MACA,SAAA;AAAA,MACA,kBAAA;AAAA,MACA,MAAA;AAAA,MACA;AAAA,KACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,YAAA,CACZ,UAAA,EACA,MAAA,EAC0B;AAC1B,IAAA,MAAM,MAAgB,EAAC;AACvB,IAAA,IAAI,WAAA,GAAc,CAAA;AAClB,IAAA,IAAI,aAAA,GAAgB,MAAA;AAGpB,IAAA,MAAM,WAAA,GAAc,UAAA,CACjB,MAAA,CAAO,CAAA,CAAA,KAAK,EAAE,WAAW,CAAA,CACzB,IAAA,CAAK,CAAC,CAAA,EAAG,CAAA,KAAM,CAAA,CAAE,QAAA,GAAW,EAAE,QAAQ,CAAA;AAEzC,IAAA,KAAA,MAAW,aAAa,WAAA,EAAa;AACnC,MAAA,IAAI,aAAA,CAAc,WAAW,IAAA,EAAM;AAEnC,MAAA,IAAI,KAAA,GAAQ,CAAA;AAEZ,MAAA,IAAI,SAAA,CAAU,SAAS,sBAAA,EAAwB;AAC7C,QAAA,KAAA,GAAQ,KAAK,cAAA,EAAe;AAC5B,QAAA,IAAI,QAAQ,CAAA,EAAG,GAAA,CAAI,IAAA,CAAK,CAAA,0BAAA,EAA6B,KAAK,CAAA,OAAA,CAAS,CAAA;AAAA,MACrE,CAAA,MAAA,IAAW,SAAA,CAAU,IAAA,KAAS,cAAA,EAAgB;AAC5C,QAAA,KAAA,GAAQ,MAAM,KAAK,aAAA,EAAc;AACjC,QAAA,IAAI,QAAQ,CAAA,EAAG,GAAA,CAAI,IAAA,CAAK,CAAA,yBAAA,EAA4B,KAAK,CAAA,OAAA,CAAS,CAAA;AAAA,MACpE,CAAA,MAAO;AACL,QAAA,MAAM,MAAA,GAAS,IAAA,CAAK,QAAA,CAAS,GAAA,CAAI,UAAU,IAAI,CAAA;AAC/C,QAAA,IAAI,QAAQ,OAAA,EAAS;AACnB,UAAA,KAAA,GAAQ,MAAM,MAAA,CAAO,OAAA,CAAQ,aAAA,CAAc,SAAA,EAAW,KAAK,UAAU,CAAA;AACrE,UAAA,IAAI,KAAA,GAAQ,GAAG,GAAA,CAAI,IAAA,CAAK,aAAa,SAAA,CAAU,IAAI,CAAA,SAAA,EAAY,KAAK,CAAA,OAAA,CAAS,CAAA;AAAA,QAC/E;AAAA,MACF;AAEA,MAAA,WAAA,IAAe,KAAA;AAGf,MAAA,MAAM,aAAA,GAAgB,MAAM,IAAA,CAAK,eAAA,EAAgB;AACjD,MAAA,aAAA,GAAgB,IAAA,CAAK,gBAAgB,aAAa,CAAA;AAAA,IACpD;AAEA,IAAA,IAAA,CAAK,gBAAA,EAAA;AACL,IAAA,IAAA,CAAK,iBAAA,IAAqB,WAAA;AAE1B,IAAA,MAAM,eAAA,GAAkB,MAAM,IAAA,CAAK,eAAA,EAAgB;AACnD,IAAA,MAAM,WAAA,GAAc,IAAA,CAAK,eAAA,CAAgB,eAAe,CAAA;AAExD,IAAA,IAAA,CAAK,IAAA,CAAK,WAAA,EAAa,EAAE,GAAA,EAAK,aAAa,CAAA;AAE3C,IAAA,OAAO;AAAA,MACL,UAAA,EAAY,eAAA;AAAA,MACZ,MAAA,EAAQ,WAAA;AAAA,MACR,SAAA,EAAW,IAAA;AAAA,MACX,aAAA,EAAe;AAAA,KACjB;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,cAAA,GAAyB;AAC/B,IAAA,MAAM,QAAA,GAAW,IAAA,CAAK,OAAA,CAAQ,OAAA,CAAQ,cAAA;AACtC,IAAA,MAAM,MAAA,GAAS,KAAK,aAAA,CAAc,MAAA;AAElC,IAAA,IAAI,MAAA,IAAU,UAAU,OAAO,CAAA;AAI/B,IAAA,MAAM,WAAW,MAAA,GAAS,QAAA;AAC1B,IAAA,MAAM,UAAuB,EAAC;AAC9B,IAAA,IAAI,WAAA,GAAc,CAAA;AAElB,IAAA,KAAA,IAAS,IAAI,CAAA,EAAG,CAAA,GAAI,YAAY,CAAA,GAAI,IAAA,CAAK,qBAAqB,CAAA,EAAA,EAAK;AACjE,MAAA,MAAM,IAAA,GAAO,IAAA,CAAK,aAAA,CAAc,CAAC,CAAA;AACjC,MAAA,IAAI,CAAC,IAAA,EAAM;AACX,MAAA,MAAM,KAAM,IAAA,CAAa,EAAA;AACzB,MAAA,MAAM,WAAW,EAAA,GAAK,IAAA,CAAK,gBAAA,CAAiB,GAAA,CAAI,EAAE,CAAA,GAAI,IAAA;AACtD,MAAA,WAAA,IAAe,QAAA,EAAU,UAAA,IAAc,IAAA,CAAK,qBAAA,CAAsB,IAAI,CAAA;AACtE,MAAA,OAAA,CAAQ,KAAK,IAAI,CAAA;AACjB,MAAA,IAAI,EAAA,EAAI;AACN,QAAA,IAAA,CAAK,gBAAA,CAAiB,OAAO,EAAE,CAAA;AAAA,MACjC;AAAA,IACF;AAEA,IAAA,IAAI,OAAA,CAAQ,SAAS,CAAA,EAAG;AACtB,MAAA,IAAA,CAAK,aAAA,GAAgB,IAAA,CAAK,aAAA,CAAc,KAAA,CAAM,QAAQ,MAAM,CAAA;AAC5D,MAAA,IAAA,CAAK,sBAAsB,IAAA,CAAK,GAAA,CAAI,GAAG,IAAA,CAAK,mBAAA,GAAsB,QAAQ,MAAM,CAAA;AAChF,MAAA,IAAA,CAAK,KAAK,mBAAA,EAAqB,EAAE,YAAA,EAAc,OAAA,CAAQ,QAAQ,CAAA;AAAA,IACjE;AAEA,IAAA,OAAO,WAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,aAAA,GAAiC;AAE7C,IAAA,IAAI,CAAC,KAAK,OAAA,EAAS;AACjB,MAAA,OAAO,CAAA;AAAA,IACT;AAEA,IAAA,MAAM,WAAA,GAAc,MAAM,IAAA,CAAK,OAAA,CAAQ,WAAA,EAAY;AACnD,IAAA,MAAM,YAAA,GAAe,IAAA,CAAK,UAAA,CAAW,cAAA,CAAe,WAAW,CAAA;AAE/D,IAAA,MAAM,IAAA,CAAK,OAAA,CAAQ,KAAA,CAAM,CAAA,EAAG,KAAK,CAAA;AAEjC,IAAA,MAAM,UAAA,GAAa,MAAM,IAAA,CAAK,OAAA,CAAQ,WAAA,EAAY;AAClD,IAAA,MAAM,WAAA,GAAc,IAAA,CAAK,UAAA,CAAW,cAAA,CAAe,UAAU,CAAA;AAE7D,IAAA,OAAO,IAAA,CAAK,GAAA,CAAI,CAAA,EAAG,YAAA,GAAe,WAAW,CAAA;AAAA,EAC/C;AAAA;AAAA;AAAA;AAAA,EAKQ,eAAA,GAAmC;AACzC,IAAA,OAAO;AAAA,MACL,cAAA,EAAgB,CAAC,IAAA,EAAc,WAAA,KAAmC;AAChE,QAAA,IAAI,CAAC,IAAA,IAAQ,IAAA,CAAK,MAAA,KAAW,GAAG,OAAO,CAAA;AACvC,QAAA,MAAM,QAAQ,WAAA,KAAgB,MAAA,GAAS,CAAA,GAAI,WAAA,KAAgB,UAAU,CAAA,GAAI,GAAA;AACzE,QAAA,OAAO,IAAA,CAAK,IAAA,CAAK,IAAA,CAAK,MAAA,GAAS,KAAK,CAAA;AAAA,MACtC,CAAA;AAAA,MACA,kBAAA,EAAoB,CAAC,IAAA,EAAe,WAAA,KAAmC;AACrE,QAAA,MAAM,UAAA,GAAa,IAAA,CAAK,SAAA,CAAU,IAAI,CAAA;AACtC,QAAA,MAAM,QAAQ,WAAA,KAAgB,MAAA,GAAS,CAAA,GAAI,WAAA,KAAgB,UAAU,CAAA,GAAI,GAAA;AACzE,QAAA,OAAO,IAAA,CAAK,IAAA,CAAK,UAAA,CAAW,MAAA,GAAS,KAAK,CAAA;AAAA,MAC5C;AAAA,KACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,UAAA,GAAqB;AAC3B,IAAA,OAAO,CAAA,EAAG,IAAA,CAAK,GAAA,EAAK,IAAI,IAAA,CAAK,MAAA,EAAO,CAAE,QAAA,CAAS,EAAE,CAAA,CAAE,SAAA,CAAU,CAAA,EAAG,CAAC,CAAC,CAAA,CAAA;AAAA,EACpE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASQ,uBAAuB,OAAA,EAA4B;AACzD,IAAA,MAAM,QAAkB,EAAC;AACzB,IAAA,KAAA,MAAW,KAAK,OAAA,EAAS;AACvB,MAAA,IAAI,CAAA,CAAE,IAAA,KAAA,YAAA,qBAAmC,CAAA,CAAE,IAAA,KAAA,aAAA,oBAAkC;AAC3E,QAAA,KAAA,CAAM,IAAA,CAAM,CAAA,CAAU,IAAA,IAAQ,EAAE,CAAA;AAAA,MAClC,CAAA,MAAA,IAAW,EAAE,IAAA,KAAA,aAAA,oBAAkC;AAC7C,QAAA,KAAA,CAAM,IAAA,CAAM,CAAA,CAAU,OAAA,IAAW,EAAE,CAAA;AAAA,MACrC;AAAA,IACF;AACA,IAAA,OAAO,KAAA,CAAM,KAAK,GAAG,CAAA;AAAA,EACvB;AAAA;AAAA;AAAA;AAAA,EAKQ,wBAAwB,IAAA,EAAiC;AAC/D,IAAA,IAAI,OAAA,GAAU,EAAA;AACd,IAAA,IAAI,IAAA,GAAiD,MAAA;AAErD,IAAA,MAAM,QAAA,GAAW,IAAA,CAAK,gBAAA,CAAiB,GAAA,CAAK,KAAa,EAAE,CAAA;AAG3D,IAAA,IAAI,UAAU,UAAA,EAAY;AACxB,MAAA,IAAA,GAAO,QAAA,CAAS,UAAA;AAAA,IAClB,CAAA,MAAA,IAAW,IAAA,CAAK,IAAA,KAAS,SAAA,EAAW;AAClC,MAAA,MAAM,GAAA,GAAM,IAAA;AACZ,MAAA,IAAA,GAAO,GAAA,CAAI,6BAA4B,MAAA,GACnC,GAAA,CAAI,uCAAiC,WAAA,GACrC,GAAA,CAAI,uCAAiC,QAAA,GACrC,MAAA;AAAA,IACN;AAEA,IAAA,IAAI,IAAA,CAAK,SAAS,SAAA,EAAW;AAC3B,MAAA,MAAM,GAAA,GAAM,IAAA;AACZ,MAAA,OAAA,GAAU,IAAA,CAAK,sBAAA,CAAuB,GAAA,CAAI,OAAO,CAAA;AAAA,IACnD;AAEA,IAAA,OAAO;AAAA,MACL,EAAA,EAAK,IAAA,CAAa,EAAA,IAAM,IAAA,CAAK,UAAA,EAAW;AAAA,MACxC,IAAA;AAAA,MACA,OAAA;AAAA,MACA,SAAA,EAAW,QAAA,EAAU,SAAA,IAAa,IAAA,CAAK,GAAA;AAAI,KAC7C;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,sBAAsB,IAAA,EAAyB;AACrD,IAAA,IAAI,IAAA,CAAK,SAAS,SAAA,EAAW;AAC3B,MAAA,MAAM,GAAA,GAAM,IAAA;AACZ,MAAA,IAAI,KAAA,GAAQ,CAAA;AACZ,MAAA,KAAA,MAAW,CAAA,IAAK,IAAI,OAAA,EAAS;AAC3B,QAAA,IAAI,CAAA,CAAE,IAAA,KAAA,YAAA,qBAAmC,CAAA,CAAE,IAAA,KAAA,aAAA,oBAAkC;AAC3E,UAAA,KAAA,IAAS,IAAA,CAAK,UAAA,CAAW,cAAA,CAAgB,CAAA,CAAU,QAAQ,EAAE,CAAA;AAAA,QAC/D,CAAA,MAAA,IAAW,EAAE,IAAA,KAAA,UAAA,iBAA+B;AAC1C,UAAA,KAAA,IAAS,IAAA,CAAK,UAAA,CAAW,cAAA,CAAgB,CAAA,CAAU,QAAQ,EAAE,CAAA;AAC7D,UAAA,KAAA,IAAS,KAAK,UAAA,CAAW,kBAAA,CAAoB,CAAA,CAAU,KAAA,IAAS,EAAE,CAAA;AAAA,QACpE,CAAA,MAAA,IAAW,EAAE,IAAA,KAAA,aAAA,oBAAkC;AAC7C,UAAA,KAAA,IAAS,IAAA,CAAK,UAAA,CAAW,cAAA,CAAgB,CAAA,CAAU,WAAW,EAAE,CAAA;AAAA,QAClE,CAAA,MAAA,IAAW,EAAE,IAAA,KAAA,iBAAA,wBAAsC;AAEjD,UAAA,KAAA,IAAS,GAAA;AAAA,QACX;AAAA,MACF;AACA,MAAA,OAAO,KAAA;AAAA,IACT;AACA,IAAA,OAAO,EAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKQ,0BAAA,GAAqC;AAC3C,IAAA,IAAI,KAAA,GAAQ,CAAA;AACZ,IAAA,KAAA,MAAW,IAAA,IAAQ,KAAK,aAAA,EAAe;AACrC,MAAA,MAAM,KAAM,IAAA,CAAa,EAAA;AACzB,MAAA,MAAM,WAAW,EAAA,GAAK,IAAA,CAAK,gBAAA,CAAiB,GAAA,CAAI,EAAE,CAAA,GAAI,IAAA;AACtD,MAAA,IAAI,UAAU,UAAA,EAAY;AACxB,QAAA,KAAA,IAAS,QAAA,CAAS,UAAA;AAAA,MACpB,CAAA,MAAO;AACL,QAAA,KAAA,IAAS,IAAA,CAAK,sBAAsB,IAAI,CAAA;AAAA,MAC1C;AAAA,IACF;AACA,IAAA,OAAO,KAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,oBAAA,GAAwC;AACpD,IAAA,IAAI,KAAA,GAAQ,CAAA;AAGZ,IAAA,IAAI,KAAK,aAAA,EAAe;AACtB,MAAA,KAAA,IAAS,IAAA,CAAK,UAAA,CAAW,cAAA,CAAe,IAAA,CAAK,aAAa,CAAA;AAAA,IAC5D;AAGA,IAAA,IAAI,KAAK,aAAA,EAAe;AACtB,MAAA,KAAA,IAAS,IAAA,CAAK,UAAA,CAAW,cAAA,CAAe,IAAA,CAAK,aAAa,CAAA;AAAA,IAC5D;AAGA,IAAA,MAAM,cAAA,GAAiB,KAAK,iBAAA,EAAkB;AAC9C,IAAA,IAAI,cAAA,EAAgB;AAClB,MAAA,KAAA,IAAS,IAAA,CAAK,UAAA,CAAW,cAAA,CAAe,cAAc,CAAA;AAAA,IACxD;AAGA,IAAA,MAAM,mBAAA,GAAsB,wBAAA,CAAyB,IAAA,CAAK,SAAS,CAAA;AACnE,IAAA,IAAI,mBAAA,EAAqB,OAAA,IAAW,OAAO,mBAAA,CAAoB,YAAY,QAAA,EAAU;AACnF,MAAA,KAAA,IAAS,IAAA,CAAK,UAAA,CAAW,cAAA,CAAe,mBAAA,CAAoB,OAAO,CAAA;AAAA,IACrE;AAGA,IAAA,IAAI,IAAA,CAAK,SAAA,CAAU,MAAA,IAAU,IAAA,CAAK,OAAA,EAAS;AACzC,MAAA,MAAM,WAAA,GAAc,MAAM,IAAA,CAAK,OAAA,CAAQ,WAAA,EAAY;AACnD,MAAA,IAAI,WAAA,IAAe,CAAC,WAAA,CAAY,QAAA,CAAS,kBAAkB,CAAA,EAAG;AAC5D,QAAA,KAAA,IAAS,IAAA,CAAK,UAAA,CAAW,cAAA,CAAe,WAAW,CAAA;AAAA,MACrD;AAAA,IACF;AAGA,IAAA,KAAA,MAAW,MAAA,IAAU,IAAA,CAAK,QAAA,CAAS,MAAA,EAAO,EAAG;AAC3C,MAAA,IAAI;AACF,QAAA,MAAM,SAAA,GAAY,MAAM,MAAA,CAAO,YAAA,EAAa;AAC5C,QAAA,IAAI,SAAA,EAAW,OAAA,IAAW,OAAO,SAAA,CAAU,YAAY,QAAA,EAAU;AAC/D,UAAA,KAAA,IAAS,IAAA,CAAK,UAAA,CAAW,cAAA,CAAe,SAAA,CAAU,OAAO,CAAA;AAAA,QAC3D;AAAA,MACF,CAAA,CAAA,MAAQ;AAAA,MAER;AAAA,IACF;AAEA,IAAA,OAAO,KAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKQ,0BAA0B,IAAA,EAA6B;AAC7D,IAAA,MAAM,QAAQ,IAAA,CAAK,iBAAA;AACnB,IAAA,MAAM,WAAW,IAAA,CAAK,KAAA,CAAM,KAAA,GAAQ,IAAA,CAAK,QAAQ,eAAe,CAAA;AAChE,IAAA,MAAM,SAAA,GAAY,QAAQ,QAAA,GAAW,IAAA;AACrC,IAAA,MAAM,gBAAA,GAAA,CAAoB,OAAO,QAAA,IAAY,KAAA;AAC7C,IAAA,MAAM,kBAAA,GAAsB,IAAA,IAAQ,KAAA,GAAQ,QAAA,CAAA,GAAa,GAAA;AAEzD,IAAA,IAAI,MAAA;AACJ,IAAA,IAAI,oBAAoB,GAAA,EAAK;AAC3B,MAAA,MAAA,GAAS,UAAA;AAAA,IACX,CAAA,MAAA,IAAW,oBAAoB,IAAA,EAAM;AACnC,MAAA,MAAA,GAAS,SAAA;AAAA,IACX,CAAA,MAAO;AACL,MAAA,MAAA,GAAS,IAAA;AAAA,IACX;AAEA,IAAA,OAAO;AAAA,MACL,KAAA;AAAA,MACA,QAAA;AAAA,MACA,IAAA;AAAA,MACA,SAAA;AAAA,MACA,kBAAA;AAAA,MACA,MAAA;AAAA,MACA,SAAA,EAAW;AAAA,QACT,YAAA,EAAc,KAAK,0BAAA,EAA2B;AAAA,QAC9C,MAAA,EAAQ,IAAA,GAAO,IAAA,CAAK,0BAAA;AAA2B;AACjD,KACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAMQ,aAAA,GAA+E;AACrF,IAAA,MAAM,KAAA,uBAAY,GAAA,EAA8D;AAEhF,IAAA,KAAA,IAAS,IAAI,CAAA,EAAG,CAAA,GAAI,IAAA,CAAK,aAAA,CAAc,QAAQ,CAAA,EAAA,EAAK;AAClD,MAAA,MAAM,IAAA,GAAO,IAAA,CAAK,aAAA,CAAc,CAAC,CAAA;AACjC,MAAA,IAAI,CAAC,IAAA,EAAM;AACX,MAAA,IAAI,IAAA,CAAK,SAAS,SAAA,EAAW;AAC3B,QAAA,MAAM,GAAA,GAAM,IAAA;AACZ,QAAA,KAAA,MAAW,OAAA,IAAW,IAAI,OAAA,EAAS;AACjC,UAAA,IAAI,QAAQ,IAAA,KAAA,UAAA,iBAA+B;AACzC,YAAA,MAAM,YAAa,OAAA,CAAgB,EAAA;AACnC,YAAA,IAAI,SAAA,EAAW;AACb,cAAA,KAAA,CAAM,IAAI,SAAA,EAAW,EAAE,UAAU,CAAA,EAAG,WAAA,EAAa,MAAM,CAAA;AAAA,YACzD;AAAA,UACF,CAAA,MAAA,IAAW,QAAQ,IAAA,KAAA,aAAA,oBAAkC;AACnD,YAAA,MAAM,YAAa,OAAA,CAAgB,WAAA;AACnC,YAAA,MAAM,IAAA,GAAO,KAAA,CAAM,GAAA,CAAI,SAAS,CAAA;AAChC,YAAA,IAAI,IAAA,EAAM;AACR,cAAA,IAAA,CAAK,WAAA,GAAc,CAAA;AAAA,YACrB;AAAA,UACF;AAAA,QACF;AAAA,MACF;AAAA,IACF;AAEA,IAAA,OAAO,KAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,oBAAoB,OAAA,EAA2C;AAC3E,IAAA,MAAM,MAAgB,EAAC;AACvB,IAAA,MAAM,SAAA,GAAY,KAAK,aAAA,EAAc;AAGrC,IAAA,MAAM,iBAAiB,IAAA,CAAK,mBAAA;AAC5B,IAAA,IAAI,kBAAkB,CAAA,EAAG;AACvB,MAAA,GAAA,CAAI,KAAK,yCAAyC,CAAA;AAClD,MAAA,OAAO,GAAA;AAAA,IACT;AAGA,IAAA,MAAM,cAAwB,EAAC;AAC/B,IAAA,KAAA,IAAS,CAAA,GAAI,CAAA,EAAG,CAAA,GAAI,cAAA,EAAgB,CAAA,EAAA,EAAK;AACvC,MAAA,IAAI,MAAA,GAAS,IAAA;AAGb,MAAA,KAAA,MAAW,GAAG,IAAI,CAAA,IAAK,SAAA,EAAW;AAEhC,QAAA,IAAI,IAAA,CAAK,aAAa,CAAA,IAAK,IAAA,CAAK,gBAAgB,IAAA,IAAQ,IAAA,CAAK,eAAe,cAAA,EAAgB;AAC1F,UAAA,MAAA,GAAS,KAAA;AACT,UAAA;AAAA,QACF;AAEA,QAAA,IAAI,IAAA,CAAK,WAAA,KAAgB,CAAA,IAAK,IAAA,CAAK,YAAY,cAAA,EAAgB;AAC7D,UAAA,MAAA,GAAS,KAAA;AACT,UAAA;AAAA,QACF;AAAA,MACF;AAEA,MAAA,IAAI,MAAA,EAAQ;AACV,QAAA,WAAA,CAAY,KAAK,CAAC,CAAA;AAAA,MACpB;AAAA,IACF;AAEA,IAAA,IAAI,WAAA,CAAY,WAAW,CAAA,EAAG;AAC5B,MAAA,GAAA,CAAI,KAAK,0DAA0D,CAAA;AACnE,MAAA,OAAO,GAAA;AAAA,IACT;AAGA,IAAA,MAAM,gBAAgB,IAAA,CAAK,GAAA;AAAA,MACzB,IAAA,CAAK,KAAA,CAAM,WAAA,CAAY,MAAA,GAAS,CAAC,CAAA;AAAA,MACjC,WAAA,CAAY;AAAA,KACd;AAEA,IAAA,MAAM,WAAW,IAAI,GAAA,CAAI,YAAY,KAAA,CAAM,CAAA,EAAG,aAAa,CAAC,CAAA;AAC5D,IAAA,IAAI,WAAA,GAAc,CAAA;AAGlB,IAAA,MAAM,kBAA+B,EAAC;AACtC,IAAA,KAAA,IAAS,IAAI,CAAA,EAAG,CAAA,GAAI,IAAA,CAAK,aAAA,CAAc,QAAQ,CAAA,EAAA,EAAK;AAClD,MAAA,MAAM,IAAA,GAAO,IAAA,CAAK,aAAA,CAAc,CAAC,CAAA;AACjC,MAAA,IAAI,CAAC,IAAA,EAAM;AACX,MAAA,IAAI,QAAA,CAAS,GAAA,CAAI,CAAC,CAAA,EAAG;AACnB,QAAA,MAAM,KAAM,IAAA,CAAa,EAAA;AACzB,QAAA,MAAM,WAAW,EAAA,GAAK,IAAA,CAAK,gBAAA,CAAiB,GAAA,CAAI,EAAE,CAAA,GAAI,IAAA;AACtD,QAAA,WAAA,IAAe,QAAA,EAAU,UAAA,IAAc,IAAA,CAAK,qBAAA,CAAsB,IAAI,CAAA;AACtE,QAAA,IAAI,EAAA,EAAI;AACN,UAAA,IAAA,CAAK,gBAAA,CAAiB,OAAO,EAAE,CAAA;AAAA,QACjC;AAAA,MACF,CAAA,MAAO;AACL,QAAA,eAAA,CAAgB,KAAK,IAAI,CAAA;AAAA,MAC3B;AAAA,IACF;AAEA,IAAA,IAAA,CAAK,aAAA,GAAgB,eAAA;AAGrB,IAAA,IAAI,sBAAA,GAAyB,CAAA;AAC7B,IAAA,KAAA,MAAW,OAAO,QAAA,EAAU;AAC1B,MAAA,IAAI,GAAA,GAAM,KAAK,mBAAA,EAAqB;AAClC,QAAA,sBAAA,EAAA;AAAA,MACF;AAAA,IACF;AACA,IAAA,IAAA,CAAK,mBAAA,IAAuB,sBAAA;AAE5B,IAAA,GAAA,CAAI,KAAK,CAAA,QAAA,EAAW,QAAA,CAAS,IAAI,CAAA,kBAAA,EAAqB,WAAW,CAAA,OAAA,CAAS,CAAA;AAE1E,IAAA,IAAA,CAAK,gBAAA,EAAA;AACL,IAAA,IAAA,CAAK,iBAAA,IAAqB,WAAA;AAC1B,IAAA,IAAA,CAAK,KAAK,mBAAA,EAAqB,EAAE,YAAA,EAAc,QAAA,CAAS,MAAM,CAAA;AAE9D,IAAA,OAAO,GAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,cAAc,mBAAA,EAAoD;AAC9E,IAAA,MAAM,QAAqB,EAAC;AAG5B,IAAA,MAAM,cAAwB,EAAC;AAG/B,IAAA,IAAI,KAAK,aAAA,EAAe;AACtB,MAAA,WAAA,CAAY,IAAA,CAAK,KAAK,aAAa,CAAA;AAAA,IACrC;AAGA,IAAA,MAAM,cAAA,GAAiB,IAAA,CAAK,8BAAA,CAA+B,IAAA,CAAK,aAAa,CAAA;AAC7E,IAAA,IAAI,cAAA,EAAgB;AAClB,MAAA,WAAA,CAAY,KAAK,cAAc,CAAA;AAAA,IACjC;AAGA,IAAA,MAAM,YAAA,GAAe,uBAAuB,IAAA,CAAK,aAAA;AACjD,IAAA,IAAI,YAAA,EAAc;AAChB,MAAA,WAAA,CAAY,KAAK,YAAY,CAAA;AAAA,IAC/B;AAGA,IAAA,MAAM,mBAAA,GAAsB,wBAAA,CAAyB,IAAA,CAAK,SAAS,CAAA;AACnE,IAAA,IAAI,mBAAA,EAAqB,OAAA,IAAW,OAAO,mBAAA,CAAoB,YAAY,QAAA,EAAU;AACnF,MAAA,WAAA,CAAY,IAAA,CAAK,oBAAoB,OAAO,CAAA;AAAA,IAC9C;AAGA,IAAA,IAAI,IAAA,CAAK,SAAA,CAAU,MAAA,IAAU,IAAA,CAAK,OAAA,EAAS;AACzC,MAAA,MAAM,WAAA,GAAc,MAAM,IAAA,CAAK,OAAA,CAAQ,WAAA,EAAY;AACnD,MAAA,IAAI,WAAA,IAAe,CAAC,WAAA,CAAY,QAAA,CAAS,kBAAkB,CAAA,EAAG;AAC5D,QAAA,WAAA,CAAY,IAAA,CAAK,CAAA;AAAA,EAAsB,WAAW,CAAA,CAAE,CAAA;AAAA,MACtD;AAAA,IACF;AAGA,IAAA,KAAA,MAAW,MAAA,IAAU,IAAA,CAAK,QAAA,CAAS,MAAA,EAAO,EAAG;AAC3C,MAAA,IAAI;AACF,QAAA,MAAM,SAAA,GAAY,MAAM,MAAA,CAAO,YAAA,EAAa;AAC5C,QAAA,IAAI,SAAA,EAAW,OAAA,IAAW,OAAO,SAAA,CAAU,YAAY,QAAA,EAAU;AAC/D,UAAA,WAAA,CAAY,IAAA,CAAK,UAAU,OAAO,CAAA;AAAA,QACpC;AAAA,MACF,CAAA,CAAA,MAAQ;AAAA,MAER;AAAA,IACF;AAGA,IAAA,IAAI,WAAA,CAAY,SAAS,CAAA,EAAG;AAC1B,MAAA,KAAA,CAAM,IAAA,CAAK;AAAA,QACT,IAAA,EAAM,SAAA;AAAA,QACN,IAAA,EAAA,WAAA;AAAA,QACA,OAAA,EAAS,CAAC,EAAE,IAAA,EAAA,YAAA,mBAA8B,MAAM,WAAA,CAAY,IAAA,CAAK,MAAM,CAAA,EAAG;AAAA,OAChE,CAAA;AAAA,IACd;AAGA,IAAA,KAAA,CAAM,IAAA,CAAK,GAAG,IAAA,CAAK,aAAa,CAAA;AAEhC,IAAA,OAAO,KAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKQ,4BAAA,GAAuC;AAC7C,IAAA,MAAM,QAAkB,EAAC;AAEzB,IAAA,KAAA,MAAW,IAAA,IAAQ,KAAK,aAAA,EAAe;AACrC,MAAA,IAAI,IAAA,CAAK,SAAS,SAAA,EAAW;AAC3B,QAAA,MAAM,GAAA,GAAM,IAAA;AACZ,QAAA,MAAM,SAAA,GAAY,IAAI,IAAA,KAAA,MAAA,cAA4B,MAAA,GAC9C,IAAI,IAAA,KAAA,WAAA,mBAAiC,WAAA,GACrC,GAAA,CAAI,IAAA,KAAA,WAAA,mBAAiC,QAAA,GACrC,SAAA;AAEJ,QAAA,MAAM,WAAA,GAAc,IAAA,CAAK,sBAAA,CAAuB,GAAA,CAAI,OAAO,CAAA;AAC3D,QAAA,IAAI,WAAA,EAAa;AACf,UAAA,KAAA,CAAM,IAAA,CAAK,CAAA,EAAG,SAAS,CAAA,EAAA,EAAK,WAAW,CAAA,CAAE,CAAA;AAAA,QAC3C;AAGA,QAAA,KAAA,MAAW,CAAA,IAAK,IAAI,OAAA,EAAS;AAC3B,UAAA,IAAI,EAAE,IAAA,KAAA,UAAA,iBAA+B;AACnC,YAAA,MAAM,OAAA,GAAU,CAAA;AAChB,YAAA,KAAA,CAAM,KAAK,CAAA,EAAG,SAAS,CAAA,gBAAA,EAAmB,OAAA,CAAQ,IAAI,CAAA,CAAA,CAAG,CAAA;AAAA,UAC3D,CAAA,MAAA,IAAW,EAAE,IAAA,KAAA,aAAA,oBAAkC;AAC7C,YAAA,MAAM,UAAA,GAAa,CAAA;AACnB,YAAA,MAAM,WAAW,UAAA,CAAW,OAAA,IAAW,EAAA,EAAI,KAAA,CAAM,GAAG,GAAG,CAAA;AACvD,YAAA,KAAA,CAAM,IAAA,CAAK,CAAA,EAAG,SAAS,CAAA,gBAAA,EAAmB,OAAO,CAAA,EAAG,UAAA,CAAW,OAAA,EAAS,MAAA,GAAS,GAAA,GAAM,KAAA,GAAQ,EAAE,CAAA,CAAA,CAAG,CAAA;AAAA,UACtG;AAAA,QACF;AAAA,MACF;AAAA,IACF;AAEA,IAAA,OAAO,KAAA,CAAM,KAAK,MAAM,CAAA;AAAA,EAC1B;AACF;;;ACvuFO,IAAe,eAAf,MAAiD;AAAA,EAItD,YAAsB,MAAA,EAAwB;AAAxB,IAAA,IAAA,CAAA,MAAA,GAAA,MAAA;AAAA,EAAyB;AAAA;AAAA;AAAA;AAAA;AAAA,EAM/C,MAAM,cAAA,GAAmC;AACvC,IAAA,MAAM,UAAA,GAAa,KAAK,cAAA,EAAe;AACvC,IAAA,OAAO,UAAA,CAAW,OAAA;AAAA,EACpB;AAAA;AAAA;AAAA;AAAA;AAAA,EAMU,cAAA,GAAyD;AACjE,IAAA,MAAM,MAAA,GAAS,KAAK,MAAA,CAAO,MAAA;AAG3B,IAAA,IAAI,CAAC,MAAA,IAAU,MAAA,CAAO,IAAA,EAAK,CAAE,WAAW,CAAA,EAAG;AACzC,MAAA,OAAO,EAAE,SAAS,KAAA,EAAM;AAAA,IAC1B;AAGA,IAAA,MAAM,YAAA,GAAe;AAAA,MACnB,cAAA;AAAA,MACA,cAAA;AAAA,MACA,QAAA;AAAA,MACA,cAAA;AAAA,MACA,YAAA;AAAA,MACA;AAAA,KACF;AAEA,IAAA,IAAI,YAAA,CAAa,KAAK,CAAC,CAAA,KAAM,OAAO,QAAA,CAAS,CAAC,CAAC,CAAA,EAAG;AAChD,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,KAAA;AAAA,QACT,OAAA,EAAS,CAAA,yCAAA;AAAA,OACX;AAAA,IACF;AAGA,IAAA,OAAO,IAAA,CAAK,kCAAkC,MAAM,CAAA;AAAA,EACtD;AAAA;AAAA;AAAA;AAAA,EAKU,kCAAkC,OAAA,EAAyD;AAGnG,IAAA,OAAO,EAAE,SAAS,IAAA,EAAK;AAAA,EACzB;AAAA;AAAA;AAAA;AAAA,EAKU,iBAAA,GAA0B;AAClC,IAAA,MAAM,UAAA,GAAa,KAAK,cAAA,EAAe;AACvC,IAAA,IAAI,CAAC,WAAW,OAAA,EAAS;AACvB,MAAA,MAAM,IAAI,kBAAA;AAAA,QACR,CAAA,8BAAA,EAAiC,IAAA,CAAK,IAAI,CAAA,CAAA,EAAI,UAAA,CAAW,UAAU,CAAA,EAAA,EAAK,UAAA,CAAW,OAAO,CAAA,CAAA,GAAK,EAAE,CAAA;AAAA,OACnG;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKU,SAAA,GAAoB;AAC5B,IAAA,OAAO,KAAK,MAAA,CAAO,MAAA;AAAA,EACrB;AAAA;AAAA;AAAA;AAAA,EAKU,UAAA,GAAiC;AACzC,IAAA,OAAO,KAAK,MAAA,CAAO,OAAA;AAAA,EACrB;AAAA;AAAA;AAAA;AAAA,EAKU,UAAA,GAAqB;AAC7B,IAAA,OAAO,IAAA,CAAK,OAAO,OAAA,IAAW,GAAA;AAAA,EAChC;AAAA;AAAA;AAAA;AAAA,EAKU,aAAA,GAAwB;AAChC,IAAA,OAAO,IAAA,CAAK,OAAO,UAAA,IAAc,CAAA;AAAA,EACnC;AACF;;;AChGA,mBAAA,EAAA;AACA,WAAA,EAAA;AACA,YAAA,EAAA;AAEO,IAAe,gBAAA,GAAf,cAAwC,YAAA,CAAsC;AAAA,EACzE,cAAA;AAAA,EACA,MAAA;AAAA,EACF,2BAAA,GAA8B,KAAA;AAAA,EAEtC,YAAY,MAAA,EAAa;AACvB,IAAA,KAAA,CAAM,MAAM,CAAA;AAGZ,IAAA,IAAA,CAAK,MAAA,GAAS,OAAO,KAAA,CAAM;AAAA,MACzB,SAAA,EAAW,UAAA;AAAA,MACX,QAAA,EAAU;AAAA,KACX,CAAA;AAAA,EAGH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOQ,8BAAA,GAAuC;AAC7C,IAAA,IAAI,KAAK,2BAAA,EAA6B;AACpC,MAAA;AAAA,IACF;AAEA,IAAA,MAAM,YAAA,GAAe,KAAK,IAAA,IAAQ,SAAA;AAGlC,IAAA,MAAM,QAAA,GAAY,IAAA,CAAK,MAAA,CAAe,cAAA,IAAkB,8BAAA;AACxD,IAAA,IAAA,CAAK,iBAAiB,IAAI,cAAA;AAAA,MACxB,YAAY,YAAY,CAAA,CAAA;AAAA,MACxB;AAAA,KACF;AAGA,IAAA,IAAA,CAAK,MAAA,GAAS,OAAO,KAAA,CAAM;AAAA,MACzB,SAAA,EAAW,UAAA;AAAA,MACX,QAAA,EAAU;AAAA,KACX,CAAA;AAGD,IAAA,IAAA,CAAK,cAAA,CAAe,EAAA,CAAG,QAAA,EAAU,CAAC,IAAA,KAAS;AACzC,MAAA,IAAA,CAAK,MAAA,CAAO,IAAA,CAAK,IAAA,EAAM,wBAAwB,CAAA;AAC/C,MAAA,OAAA,CAAQ,SAAA,CAAU,0BAA0B,CAAA,EAAG;AAAA,QAC7C,SAAS,IAAA,CAAK,IAAA;AAAA,QACd,QAAA,EAAU;AAAA,OACX,CAAA;AAAA,IACH,CAAC,CAAA;AAED,IAAA,IAAA,CAAK,cAAA,CAAe,EAAA,CAAG,QAAA,EAAU,CAAC,IAAA,KAAS;AACzC,MAAA,IAAA,CAAK,MAAA,CAAO,IAAA,CAAK,IAAA,EAAM,wBAAwB,CAAA;AAC/C,MAAA,OAAA,CAAQ,SAAA,CAAU,0BAA0B,CAAA,EAAG;AAAA,QAC7C,SAAS,IAAA,CAAK,IAAA;AAAA,QACd,QAAA,EAAU;AAAA,OACX,CAAA;AAAA,IACH,CAAC,CAAA;AAED,IAAA,IAAA,CAAK,2BAAA,GAA8B,IAAA;AAAA,EACrC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOU,wBAAwB,aAAA,EAA6B;AAE7D,IAAA,IAAA,CAAK,8BAAA,EAA+B;AAAA,EACtC;AAAA;AAAA;AAAA;AAAA,EASA,MAAgB,yBAAA,CACd,SAAA,EACA,KAAA,EACkB;AAElB,IAAA,IAAA,CAAK,8BAAA,EAA+B;AAEpC,IAAA,MAAM,SAAA,GAAY,KAAK,GAAA,EAAI;AAC3B,IAAA,MAAM,aAAA,GAAgB,cAAA;AAEtB,IAAA,IAAA,CAAK,OAAO,KAAA,CAAM;AAAA,MAChB,SAAA,EAAW,aAAA;AAAA,MACX;AAAA,OACC,kBAAkB,CAAA;AAErB,IAAA,OAAA,CAAQ,SAAA,CAAU,wBAAwB,CAAA,EAAG;AAAA,MAC3C,UAAU,IAAA,CAAK,IAAA;AAAA,MACf,OAAO,KAAA,IAAS;AAAA,KACjB,CAAA;AAED,IAAA,IAAI;AAEF,MAAA,IAAI,CAAC,KAAK,cAAA,EAAgB;AAExB,QAAA,OAAO,MAAM,SAAA,EAAU;AAAA,MACzB;AAEA,MAAA,MAAM,MAAA,GAAS,MAAM,IAAA,CAAK,cAAA,CAAe,QAAQ,SAAS,CAAA;AAE1D,MAAA,MAAM,QAAA,GAAW,IAAA,CAAK,GAAA,EAAI,GAAI,SAAA;AAE9B,MAAA,IAAA,CAAK,OAAO,IAAA,CAAK;AAAA,QACf,SAAA,EAAW,aAAA;AAAA,QACX,KAAA;AAAA,QACA;AAAA,SACC,oBAAoB,CAAA;AAEvB,MAAA,OAAA,CAAQ,MAAA,CAAO,wBAAwB,QAAA,EAAU;AAAA,QAC/C,UAAU,IAAA,CAAK,IAAA;AAAA,QACf,OAAO,KAAA,IAAS;AAAA,OACjB,CAAA;AAED,MAAA,OAAA,CAAQ,SAAA,CAAU,yBAAyB,CAAA,EAAG;AAAA,QAC5C,UAAU,IAAA,CAAK,IAAA;AAAA,QACf,OAAO,KAAA,IAAS,SAAA;AAAA,QAChB,MAAA,EAAQ;AAAA,OACT,CAAA;AAED,MAAA,OAAO,MAAA;AAAA,IACT,SAAS,KAAA,EAAO;AACd,MAAA,MAAM,QAAA,GAAW,IAAA,CAAK,GAAA,EAAI,GAAI,SAAA;AAE9B,MAAA,IAAA,CAAK,OAAO,KAAA,CAAM;AAAA,QAChB,SAAA,EAAW,aAAA;AAAA,QACX,KAAA;AAAA,QACA,OAAQ,KAAA,CAAgB,OAAA;AAAA,QACxB;AAAA,SACC,iBAAiB,CAAA;AAEpB,MAAA,OAAA,CAAQ,SAAA,CAAU,sBAAsB,CAAA,EAAG;AAAA,QACzC,UAAU,IAAA,CAAK,IAAA;AAAA,QACf,OAAO,KAAA,IAAS,SAAA;AAAA,QAChB,OAAQ,KAAA,CAAgB;AAAA,OACzB,CAAA;AAED,MAAA,MAAM,KAAA;AAAA,IACR;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,wBAAA,GAA2B;AACzB,IAAA,IAAI,CAAC,KAAK,cAAA,EAAgB;AAExB,MAAA,OAAO,IAAA;AAAA,IACT;AACA,IAAA,OAAO,IAAA,CAAK,eAAe,UAAA,EAAW;AAAA,EACxC;AAAA;AAAA;AAAA;AAAA,EAKU,uBAAuB,KAAA,EAA+B;AAC9D,IAAA,IAAI,OAAO,UAAU,QAAA,EAAU;AAC7B,MAAA,OAAO,KAAA;AAAA,IACT;AAGA,IAAA,MAAM,YAAsB,EAAC;AAC7B,IAAA,KAAA,MAAW,QAAQ,KAAA,EAAO;AACxB,MAAA,IAAI,IAAA,CAAK,SAAS,SAAA,EAAW;AAC3B,QAAA,KAAA,MAAW,OAAA,IAAW,KAAK,OAAA,EAAS;AAClC,UAAA,IAAI,OAAA,CAAQ,SAAS,YAAA,EAAc;AACjC,YAAA,SAAA,CAAU,IAAA,CAAK,QAAQ,IAAI,CAAA;AAAA,UAC7B,CAAA,MAAA,IAAW,OAAA,CAAQ,IAAA,KAAS,aAAA,EAAe;AACzC,YAAA,SAAA,CAAU,IAAA,CAAK,QAAQ,IAAI,CAAA;AAAA,UAC7B;AAAA,QACF;AAAA,MACF;AAAA,IACF;AAEA,IAAA,OAAO,SAAA,CAAU,KAAK,IAAI,CAAA;AAAA,EAC5B;AAAA;AAAA;AAAA;AAAA;AAAA,EAWA,OAAA,GAAgB;AACd,IAAA,IAAI,KAAK,cAAA,EAAgB;AACvB,MAAA,IAAA,CAAK,eAAe,kBAAA,EAAmB;AACvC,MAAA,IAAA,CAAK,cAAA,GAAiB,MAAA;AAAA,IACxB;AACA,IAAA,IAAA,CAAK,2BAAA,GAA8B,KAAA;AAAA,EACrC;AACF;;;AC9LO,IAAM,2BAAN,MAA+B;AAAA;AAAA;AAAA;AAAA,EAIpC,YAAA,CACE,OACA,YAAA,EACoE;AAEpE,IAAA,IAAI,OAAO,UAAU,QAAA,EAAU;AAC7B,MAAA,OAAO;AAAA,QACL,KAAA;AAAA,QACA;AAAA,OACF;AAAA,IACF;AAGA,IAAA,MAAM,QAAiC,EAAC;AAExC,IAAA,KAAA,MAAW,QAAQ,KAAA,EAAO;AACxB,MAAA,IAAI,IAAA,CAAK,SAAS,SAAA,EAAW;AAE3B,QAAA,MAAM,iBAAwB,EAAC;AAE/B,QAAA,KAAA,MAAW,OAAA,IAAW,KAAK,OAAA,EAAS;AAClC,UAAA,QAAQ,QAAQ,IAAA;AAAM,YACpB,KAAK,YAAA;AACH,cAAA,cAAA,CAAe,IAAA,CAAK;AAAA,gBAClB,IAAA,EAAM,YAAA;AAAA,gBACN,MAAM,OAAA,CAAQ;AAAA,eACf,CAAA;AACD,cAAA;AAAA,YAEF,KAAK,iBAAA;AACH,cAAA,cAAA,CAAe,IAAA,CAAK;AAAA,gBAClB,IAAA,EAAM,aAAA;AAAA,gBACN,SAAA,EAAW,QAAQ,SAAA,CAAU,GAAA;AAAA,gBAC7B,GAAI,QAAQ,SAAA,CAAU,MAAA,IAAU,EAAE,MAAA,EAAQ,OAAA,CAAQ,UAAU,MAAA;AAAO,eACpE,CAAA;AACD,cAAA;AAAA,YAEF,KAAK,aAAA;AACH,cAAA,cAAA,CAAe,IAAA,CAAK;AAAA,gBAClB,IAAA,EAAM,aAAA;AAAA,gBACN,MAAM,OAAA,CAAQ;AAAA,eACf,CAAA;AACD,cAAA;AAAA,YAEF,KAAK,UAAA;AAEH,cAAA,KAAA,CAAM,IAAA,CAAK;AAAA,gBACT,IAAA,EAAM,eAAA;AAAA,gBACN,SAAS,OAAA,CAAQ,EAAA;AAAA,gBACjB,MAAM,OAAA,CAAQ,IAAA;AAAA,gBACd,WAAW,OAAA,CAAQ;AAAA,eACqB,CAAA;AAC1C,cAAA;AAAA,YAEF,KAAK,aAAA;AAEH,cAAA,MAAM,MAAA,GAAS,OAAO,OAAA,CAAQ,OAAA,KAAY,QAAA,GACtC,QAAQ,OAAA,GACR,IAAA,CAAK,SAAA,CAAU,OAAA,CAAQ,OAAO,CAAA;AAClC,cAAA,KAAA,CAAM,IAAA,CAAK;AAAA,gBACT,IAAA,EAAM,sBAAA;AAAA,gBACN,SAAS,OAAA,CAAQ,WAAA;AAAA,gBACjB;AAAA,eACM,CAAA;AACR,cAAA;AAAA;AACJ,QACF;AAGA,QAAA,IAAI,cAAA,CAAe,SAAS,CAAA,EAAG;AAC7B,UAAA,KAAA,CAAM,IAAA,CAAK;AAAA,YACT,IAAA,EAAM,SAAA;AAAA,YACN,MAAM,IAAA,CAAK,IAAA;AAAA,YACX,OAAA,EAAS,cAAA;AAAA,YACT,IAAI,IAAA,CAAK,EAAA;AAAA,YACT,MAAA,EAAQ;AAAA,WACiC,CAAA;AAAA,QAC7C;AAAA,MACF,CAAA,MAAA,IAAW,IAAA,CAAK,IAAA,KAAS,YAAA,EAAc;AAErC,QAAA,KAAA,CAAM,IAAA,CAAK;AAAA,UACT,IAAA,EAAM,YAAA;AAAA,UACN,IAAI,IAAA,CAAK,EAAA;AAAA,UACT,mBAAmB,IAAA,CAAK;AAAA,SACmB,CAAA;AAAA,MAC/C;AAAA,IACF;AAEA,IAAA,OAAO;AAAA,MACL,KAAA,EAAO,KAAA;AAAA,MACP;AAAA,KACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,gBAAgB,QAAA,EAA6C;AAC3D,IAAA,MAAM,UAAiB,EAAC;AACxB,IAAA,IAAI,UAAA,GAAa,EAAA;AACjB,IAAA,IAAI,SAAA;AAGJ,IAAA,KAAA,MAAW,IAAA,IAAQ,QAAA,CAAS,MAAA,IAAU,EAAC,EAAG;AACxC,MAAA,IAAI,IAAA,CAAK,SAAS,SAAA,EAAW;AAE3B,QAAA,MAAM,WAAA,GAAc,IAAA;AAGpB,QAAA,IAAI,CAAC,SAAA,IAAa,WAAA,CAAY,EAAA,EAAI;AAChC,UAAA,SAAA,GAAY,WAAA,CAAY,EAAA;AAAA,QAC1B;AAEA,QAAA,KAAA,MAAW,WAAA,IAAe,WAAA,CAAY,OAAA,IAAW,EAAC,EAAG;AACnD,UAAA,IAAI,WAAA,CAAY,SAAS,aAAA,EAAe;AACtC,YAAA,MAAM,WAAA,GAAc,WAAA;AACpB,YAAA,OAAA,CAAQ,IAAA,CAAK;AAAA,cACX,IAAA,EAAM,aAAA;AAAA,cACN,MAAM,WAAA,CAAY,IAAA;AAAA,cAClB,WAAA,EAAa,WAAA,CAAY,WAAA,IAAe;AAAC,aAC1C,CAAA;AACD,YAAA,UAAA,IAAc,WAAA,CAAY,IAAA;AAAA,UAC5B;AAAA,QACF;AAAA,MACF,CAAA,MAAA,IAAW,IAAA,CAAK,IAAA,KAAS,eAAA,EAAiB;AAExC,QAAA,MAAM,YAAA,GAAe,IAAA;AACrB,QAAA,OAAA,CAAQ,IAAA,CAAK;AAAA,UACX,IAAA,EAAM,UAAA;AAAA,UACN,IAAI,YAAA,CAAa,OAAA;AAAA,UACjB,MAAM,YAAA,CAAa,IAAA;AAAA,UACnB,WAAW,YAAA,CAAa;AAAA,SACzB,CAAA;AAAA,MACH,CAAA,MAAA,IAAW,IAAA,CAAK,IAAA,KAAS,WAAA,EAAa;AAEpC,QAAA,MAAM,SAAA,GAAY,IAAA;AAElB,QAAA,IAAI,UAAU,OAAA,EAAS;AACrB,UAAA,OAAA,CAAQ,IAAA,CAAK;AAAA,YACX,IAAA,EAAM,WAAA;AAAA,YACN,SAAS,SAAA,CAAU,OAAA;AAAA;AAAA,YAEnB,GAAK,QAAA,IAAY,SAAA,IAAc,EAAE,MAAA,EAAS,UAAkB,MAAA;AAAO,WACpE,CAAA;AAAA,QACH;AAAA,MACF;AAAA,IACF;AAGA,IAAA,IAAI,CAAC,UAAA,EAAY;AACf,MAAA,UAAA,GAAa,SAAS,WAAA,IAAe,EAAA;AAAA,IACvC;AAKA,IAAA,MAAM,cAAA,GAAiB,aAAa,QAAA,CAAS,EAAA;AAE7C,IAAA,OAAO;AAAA,MACL,IAAI,QAAA,CAAS,EAAA;AAAA,MACb,MAAA,EAAQ,UAAA;AAAA,MACR,YAAY,QAAA,CAAS,UAAA;AAAA,MACrB,MAAA,EAAQ,SAAS,MAAA,IAAU,WAAA;AAAA,MAC3B,OAAO,QAAA,CAAS,KAAA;AAAA,MAChB,MAAA,EAAQ;AAAA,QACN;AAAA,UACE,IAAA,EAAM,SAAA;AAAA,UACN,EAAA,EAAI,cAAA;AAAA,UACJ,IAAA,EAAA,WAAA;AAAA,UACA;AAAA;AACF,OACF;AAAA,MACA,WAAA,EAAa,UAAA;AAAA,MACb,KAAA,EAAO;AAAA,QACL,YAAA,EAAc,QAAA,CAAS,KAAA,EAAO,YAAA,IAAgB,CAAA;AAAA,QAC9C,aAAA,EAAe,QAAA,CAAS,KAAA,EAAO,aAAA,IAAiB,CAAA;AAAA,QAChD,YAAA,EAAc,QAAA,CAAS,KAAA,EAAO,YAAA,IAAgB;AAAA;AAChD,KACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,aAAa,KAAA,EAAoC;AAC/C,IAAA,OAAO,KAAA,CAAM,GAAA,CAAI,CAAC,IAAA,KAAS;AACzB,MAAA,IAAI,IAAA,CAAK,SAAS,UAAA,EAAY;AAE5B,QAAA,MAAM,UAAU,IAAA,CAAK,QAAA;AAKrB,QAAA,MAAM,SAAA,GAAY,QAAQ,MAAA,KAAW,IAAA;AAErC,QAAA,OAAO;AAAA,UACL,IAAA,EAAM,UAAA;AAAA,UACN,MAAM,OAAA,CAAQ,IAAA;AAAA,UACd,WAAA,EAAa,QAAQ,WAAA,IAAe,EAAA;AAAA,UACpC,UAAA,EAAY,QAAQ,UAAA,IAAc,IAAA;AAAA,UAClC,MAAA,EAAQ;AAAA,SACV;AAAA,MACF;AAGA,MAAA,OAAO,IAAA;AAAA,IACT,CAAC,CAAA;AAAA,EACH;AAAA;AAAA;AAAA;AAAA,EAKA,kBACE,UAAA,EACkD;AAClD,IAAA,IAAI,CAAC,UAAA,IAAc,UAAA,KAAe,MAAA,EAAQ;AACxC,MAAA,OAAO,MAAA;AAAA,IACT;AAEA,IAAA,IAAI,eAAe,UAAA,EAAY;AAC7B,MAAA,OAAO,UAAA;AAAA,IACT;AAGA,IAAA,OAAO;AAAA,MACL,IAAA,EAAM,UAAA;AAAA,MACN,IAAA,EAAM,WAAW,QAAA,CAAS;AAAA,KAC5B;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,sBACE,cAAA,EAI6C;AAC7C,IAAA,IAAI,CAAC,cAAA,EAAgB;AACnB,MAAA,OAAO,MAAA;AAAA,IACT;AAEA,IAAA,IAAI,cAAA,CAAe,IAAA,KAAS,aAAA,IAAiB,cAAA,CAAe,WAAA,EAAa;AACvE,MAAA,OAAO;AAAA,QACL,IAAA,EAAM,MAAA;AAAA,QACN,IAAA,EAAM;AAAA,UACJ,IAAA,EAAM,aAAA;AAAA,UACN,IAAA,EAAM,cAAA,CAAe,WAAA,CAAY,IAAA,IAAQ,UAAA;AAAA,UACzC,MAAA,EAAQ,cAAA,CAAe,WAAA,CAAY,MAAA,IAAU,cAAA,CAAe,WAAA;AAAA,UAC5D,WAAA,EAAa,eAAe,WAAA,CAAY,WAAA;AAAA,UACxC,MAAA,EAAQ,cAAA,CAAe,WAAA,CAAY,MAAA,KAAW;AAAA;AAChD,OACF;AAAA,IACF;AAEA,IAAA,IAAI,cAAA,CAAe,SAAS,aAAA,EAAe;AACzC,MAAA,OAAO;AAAA,QACL,IAAA,EAAM,MAAA;AAAA,QACN,IAAA,EAAM;AAAA,UACJ,IAAA,EAAM;AAAA;AACR,OACF;AAAA,IACF;AAEA,IAAA,OAAO;AAAA,MACL,IAAA,EAAM,MAAA;AAAA,MACN,IAAA,EAAM;AAAA,QACJ,IAAA,EAAM;AAAA;AACR,KACF;AAAA,EACF;AACF,CAAA;;;ACnSO,IAAK,eAAA,qBAAAO,gBAAAA,KAAL;AACL,EAAAA,iBAAA,kBAAA,CAAA,GAAmB,kBAAA;AACnB,EAAAA,iBAAA,sBAAA,CAAA,GAAuB,sBAAA;AACvB,EAAAA,iBAAA,mBAAA,CAAA,GAAoB,4BAAA;AACpB,EAAAA,iBAAA,kBAAA,CAAA,GAAmB,2BAAA;AACnB,EAAAA,iBAAA,iBAAA,CAAA,GAAkB,0BAAA;AAClB,EAAAA,iBAAA,2BAAA,CAAA,GAA4B,oCAAA;AAC5B,EAAAA,iBAAA,0BAAA,CAAA,GAA2B,mCAAA;AAC3B,EAAAA,iBAAA,sBAAA,CAAA,GAAuB,+BAAA;AACvB,EAAAA,iBAAA,qBAAA,CAAA,GAAsB,8BAAA;AACtB,EAAAA,iBAAA,oBAAA,CAAA,GAAqB,6BAAA;AACrB,EAAAA,iBAAA,mBAAA,CAAA,GAAoB,mBAAA;AACpB,EAAAA,iBAAA,OAAA,CAAA,GAAQ,gBAAA;AAZE,EAAA,OAAAA,gBAAAA;AAAA,CAAA,EAAA,eAAA,IAAA,EAAA;AA2KL,SAAS,aAAA,CACd,OACA,IAAA,EACY;AACZ,EAAA,OAAO,MAAM,IAAA,KAAS,IAAA;AACxB;AAKO,SAAS,kBAAkB,KAAA,EAAmD;AACnF,EAAA,OAAO,MAAM,IAAA,KAAS,4BAAA;AACxB;AAEO,SAAS,gBAAgB,KAAA,EAAiD;AAC/E,EAAA,OAAO,MAAM,IAAA,KAAS,0BAAA;AACxB;AAEO,SAAS,yBACd,KAAA,EACsC;AACtC,EAAA,OAAO,MAAM,IAAA,KAAS,oCAAA;AACxB;AAEO,SAAS,wBACd,KAAA,EACqC;AACrC,EAAA,OAAO,MAAM,IAAA,KAAS,mCAAA;AACxB;AAEO,SAAS,mBAAmB,KAAA,EAAoD;AACrF,EAAA,OAAO,MAAM,IAAA,KAAS,mBAAA;AACxB;AAEO,SAAS,aAAa,KAAA,EAAyC;AACpE,EAAA,OAAO,MAAM,IAAA,KAAS,gBAAA;AACxB;;;ACtMO,IAAM,iCAAN,MAAqC;AAAA;AAAA;AAAA;AAAA,EAI1C,OAAO,cACL,MAAA,EACoC;AACpC,IAAA,IAAI,UAAA,GAAa,EAAA;AACjB,IAAA,IAAI,cAAA,GAAiB,CAAA;AAGrB,IAAA,MAAM,WAAA,uBAAkB,GAAA,EAAsE;AAC9F,IAAA,MAAM,eAAA,uBAAsB,GAAA,EAAwD;AAEpF,IAAA,WAAA,MAAiB,SAAS,MAAA,EAAQ;AAEhC,MAAA,IAAI,OAAA,CAAQ,IAAI,YAAA,EAAc;AAC5B,QAAA,OAAA,CAAQ,KAAA,CAAM,8BAAA,EAAgC,KAAA,CAAM,IAAI,CAAA;AAAA,MAC1D;AAEA,MAAA,QAAQ,MAAM,IAAA;AAAM,QAClB,KAAK,kBAAA,EAAoB;AACvB,UAAA,UAAA,GAAa,MAAM,QAAA,CAAS,EAAA;AAC5B,UAAA,MAAM;AAAA,YACJ,IAAA,EAAA,kBAAA;AAAA,YACA,WAAA,EAAa,UAAA;AAAA,YACb,KAAA,EAAO,MAAM,QAAA,CAAS,KAAA;AAAA,YACtB,UAAA,EAAY,MAAM,QAAA,CAAS;AAAA,WAC7B;AACA,UAAA;AAAA,QACF;AAAA,QAEA,KAAK,4BAAA,EAA8B;AACjC,UAAA,MAAM,UAAA,GAAa,KAAA;AACnB,UAAA,MAAM,OAAO,UAAA,CAAW,IAAA;AACxB,UAAA,WAAA,CAAY,GAAA,CAAI,UAAA,CAAW,YAAA,CAAa,QAAA,EAAS,EAAG;AAAA,YAClD,MAAM,IAAA,CAAK;AAAA,WACZ,CAAA;AAGD,UAAA,IAAI,IAAA,CAAK,SAAS,eAAA,EAAiB;AACjC,YAAA,MAAM,YAAA,GAAe,IAAA;AACrB,YAAA,MAAM,aAAa,YAAA,CAAa,OAAA;AAChC,YAAA,MAAM,WAAW,YAAA,CAAa,IAAA;AAE9B,YAAA,WAAA,CAAY,GAAA,CAAI,UAAA,CAAW,YAAA,CAAa,QAAA,EAAS,EAAG;AAAA,cAClD,IAAA,EAAM,eAAA;AAAA,cACN,UAAA;AAAA,cACA;AAAA,aACD,CAAA;AAED,YAAA,eAAA,CAAgB,IAAI,UAAA,EAAY;AAAA,cAC9B,EAAA,EAAI,UAAA;AAAA,cACJ,IAAA,EAAM,QAAA;AAAA,cACN,IAAA,EAAM;AAAA,aACP,CAAA;AAED,YAAA,MAAM;AAAA,cACJ,IAAA,EAAA,0BAAA;AAAA,cACA,WAAA,EAAa,UAAA;AAAA,cACb,OAAA,EAAS,CAAA,KAAA,EAAQ,UAAA,CAAW,YAAY,CAAA,CAAA;AAAA,cACxC,YAAA,EAAc,UAAA;AAAA,cACd,SAAA,EAAW;AAAA,aACb;AAAA,UACF;AACA,UAAA;AAAA,QACF;AAAA,QAEA,KAAK,4BAAA,EAA8B;AACjC,UAAA,MAAM,SAAA,GAAY,KAAA;AAClB,UAAA,MAAM;AAAA,YACJ,IAAA,EAAA,4BAAA;AAAA,YACA,WAAA,EAAa,UAAA;AAAA,YACb,SAAS,SAAA,CAAU,OAAA;AAAA,YACnB,cAAc,SAAA,CAAU,YAAA;AAAA,YACxB,eAAe,SAAA,CAAU,aAAA;AAAA,YACzB,KAAA,EAAO,UAAU,KAAA,IAAS,EAAA;AAAA,YAC1B,eAAA,EAAiB,cAAA;AAAA,WACnB;AACA,UAAA;AAAA,QACF;AAAA,QAEA,KAAK,wCAAA,EAA0C;AAC7C,UAAA,MAAM,SAAA,GAAY,KAAA;AAClB,UAAA,MAAM,WAAW,WAAA,CAAY,GAAA,CAAI,SAAA,CAAU,YAAA,CAAa,UAAU,CAAA;AAElE,UAAA,IAAI,UAAU,UAAA,EAAY;AACxB,YAAA,MAAM,MAAA,GAAS,eAAA,CAAgB,GAAA,CAAI,QAAA,CAAS,UAAU,CAAA;AACtD,YAAA,IAAI,MAAA,EAAQ;AACV,cAAA,MAAA,CAAO,IAAA,IAAQ,UAAU,KAAA,IAAS,EAAA;AAElC,cAAA,MAAM;AAAA,gBACJ,IAAA,EAAA,oCAAA;AAAA,gBACA,WAAA,EAAa,UAAA;AAAA,gBACb,SAAS,SAAA,CAAU,OAAA;AAAA,gBACnB,cAAc,MAAA,CAAO,EAAA;AAAA,gBACrB,WAAW,MAAA,CAAO,IAAA;AAAA,gBAClB,KAAA,EAAO,UAAU,KAAA,IAAS,EAAA;AAAA,gBAC1B,eAAA,EAAiB,cAAA;AAAA,eACnB;AAAA,YACF;AAAA,UACF;AACA,UAAA;AAAA,QACF;AAAA,QAEA,KAAK,2BAAA,EAA6B;AAChC,UAAA,MAAM,SAAA,GAAY,KAAA;AAClB,UAAA,MAAM,OAAO,SAAA,CAAU,IAAA;AAGvB,UAAA,IAAI,IAAA,CAAK,SAAS,eAAA,EAAiB;AACjC,YAAA,MAAM,YAAA,GAAe,IAAA;AACrB,YAAA,MAAM,MAAA,GAAS,eAAA,CAAgB,GAAA,CAAI,YAAA,CAAa,OAAO,CAAA;AAEvD,YAAA,IAAI,MAAA,EAAQ;AACV,cAAA,MAAM;AAAA,gBACJ,IAAA,EAAA,mCAAA;AAAA,gBACA,WAAA,EAAa,UAAA;AAAA,gBACb,cAAc,MAAA,CAAO,EAAA;AAAA,gBACrB,WAAW,MAAA,CAAO,IAAA;AAAA,gBAClB,SAAA,EAAW,MAAA,CAAO,IAAA,IAAQ,YAAA,CAAa;AAAA,eACzC;AAAA,YACF;AAAA,UACF;AACA,UAAA;AAAA,QACF;AAAA,QAEA,KAAK,oBAAA,EAAsB;AACzB,UAAA,MAAM,cAAA,GAAiB,KAAA;AACvB,UAAA,MAAM,WAAW,cAAA,CAAe,QAAA;AAGhC,UAAA,IAAI,MAAA,GAAgD,WAAA;AACpD,UAAA,IAAI,QAAA,CAAS,WAAW,QAAA,EAAU;AAChC,YAAA,MAAA,GAAS,QAAA;AAAA,UACX,CAAA,MAAA,IAAW,QAAA,CAAS,MAAA,KAAW,YAAA,EAAc;AAC3C,YAAA,MAAA,GAAS,YAAA;AAAA,UACX;AAEA,UAAA,MAAM;AAAA,YACJ,IAAA,EAAA,mBAAA;AAAA,YACA,WAAA,EAAa,UAAA;AAAA,YACb,MAAA;AAAA,YACA,KAAA,EAAO;AAAA,cACL,YAAA,EAAc,QAAA,CAAS,KAAA,EAAO,YAAA,IAAgB,CAAA;AAAA,cAC9C,aAAA,EAAe,QAAA,CAAS,KAAA,EAAO,aAAA,IAAiB,CAAA;AAAA,cAChD,YAAA,EAAc,QAAA,CAAS,KAAA,EAAO,YAAA,IAAgB;AAAA,aAChD;AAAA,YACA,UAAA,EAAY;AAAA,WACd;AACA,UAAA;AAAA,QACF;AAAA;AAAA,QAGA;AACE,UAAA,IAAI,OAAA,CAAQ,IAAI,YAAA,EAAc;AAC5B,YAAA,OAAA,CAAQ,KAAA,CAAM,6CAAA,EAAgD,KAAA,CAAc,IAAI,CAAA;AAAA,UAClF;AAAA;AACJ,IACF;AAAA,EACF;AACF,CAAA;;;AC/JO,IAAM,kBAAA,GAAN,cAAiC,gBAAA,CAAiB;AAAA,EAC9C,IAAA,GAAe,QAAA;AAAA,EACf,YAAA,GAAqC;AAAA,IAC5C,IAAA,EAAM,IAAA;AAAA,IACN,MAAA,EAAQ,IAAA;AAAA,IACR,MAAA,EAAQ,KAAA;AAAA,IACR,KAAA,EAAO;AAAA,GACT;AAAA,EAEQ,MAAA;AAAA,EACA,SAAA;AAAA,EACA,eAAA;AAAA,EAER,YAAY,MAAA,EAAsB;AAChC,IAAA,KAAA,CAAM,MAAM,CAAA;AAEZ,IAAA,IAAA,CAAK,MAAA,GAAS,IAAIC,OAAA,CAAO;AAAA,MACvB,MAAA,EAAQ,KAAK,SAAA,EAAU;AAAA,MACvB,OAAA,EAAS,KAAK,UAAA,EAAW;AAAA,MACzB,cAAc,MAAA,CAAO,YAAA;AAAA,MACrB,OAAA,EAAS,KAAK,UAAA,EAAW;AAAA,MACzB,UAAA,EAAY,KAAK,aAAA;AAAc,KAChC,CAAA;AAED,IAAA,IAAA,CAAK,SAAA,GAAY,IAAI,wBAAA,EAAyB;AAC9C,IAAA,IAAA,CAAK,eAAA,GAAkB,IAAI,8BAAA,EAA+B;AAAA,EAC5D;AAAA;AAAA;AAAA;AAAA,EAKQ,iBAAA,CAAkB,OAAe,SAAA,EAAqF;AAC5H,IAAA,MAAM,SAAA,GAAY,aAAa,KAAK,CAAA;AACpC,IAAA,IAAI,CAAC,SAAA,EAAW,QAAA,CAAS,UAAA,EAAY;AAEnC,MAAA,OAAO,IAAA;AAAA,IACT;AACA,IAAA,OAAO,SAAA,CAAU,QAAA,CAAS,UAAA,CAAW,SAAS,CAAA,KAAM,KAAA;AAAA,EACtD;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,SAAS,OAAA,EAAoD;AAEjE,IAAA,OAAO,IAAA,CAAK,0BAA0B,YAAY;AAChD,MAAA,IAAI;AAEF,QAAA,MAAM,EAAE,KAAA,EAAO,YAAA,EAAa,GAAI,KAAK,SAAA,CAAU,YAAA;AAAA,UAC7C,OAAA,CAAQ,KAAA;AAAA,UACR,OAAA,CAAQ;AAAA,SACV;AAGA,QAAA,MAAM,MAAA,GAAc;AAAA,UAClB,OAAO,OAAA,CAAQ,KAAA;AAAA,UACf,KAAA;AAAA,UACA,GAAI,YAAA,IAAgB,EAAE,YAAA,EAAa;AAAA,UACnC,GAAI,OAAA,CAAQ,KAAA,IAAS,OAAA,CAAQ,KAAA,CAAM,SAAS,CAAA,IAAK;AAAA,YAC/C,KAAA,EAAO,IAAA,CAAK,SAAA,CAAU,YAAA,CAAa,QAAQ,KAAK;AAAA,WAClD;AAAA,UACA,GAAI,QAAQ,WAAA,IAAe;AAAA,YACzB,WAAA,EAAa,IAAA,CAAK,SAAA,CAAU,iBAAA,CAAkB,QAAQ,WAAW;AAAA,WACnE;AAAA,UACA,GAAI,OAAA,CAAQ,WAAA,KAAgB,KAAA,CAAA,IACxB,IAAA,CAAK,iBAAA,CAAkB,OAAA,CAAQ,KAAA,EAAO,aAAa,CAAA,IACnD,EAAE,WAAA,EAAa,QAAQ,WAAA,EAAY;AAAA,UACvC,GAAI,OAAA,CAAQ,iBAAA,IAAqB,EAAE,iBAAA,EAAmB,QAAQ,iBAAA,EAAkB;AAAA,UAChF,GAAI,QAAQ,eAAA,IAAmB;AAAA,YAC7B,IAAA,EAAM,IAAA,CAAK,SAAA,CAAU,qBAAA,CAAsB,QAAQ,eAAe;AAAA,WACpE;AAAA,UACA,GAAI,OAAA,CAAQ,mBAAA,KAAwB,KAAA,CAAA,IAAa;AAAA,YAC/C,qBAAqB,OAAA,CAAQ;AAAA,WAC/B;AAAA,UACA,GAAI,QAAQ,oBAAA,IAAwB;AAAA,YAClC,sBAAsB,OAAA,CAAQ;AAAA,WAChC;AAAA,UACA,GAAI,OAAA,CAAQ,QAAA,IAAY,EAAE,QAAA,EAAU,QAAQ,QAAA;AAAS,SACvD;AAGA,QAAA,MAAM,WAAW,MAAM,IAAA,CAAK,MAAA,CAAO,SAAA,CAAU,OAAO,MAAM,CAAA;AAG1D,QAAA,OAAO,IAAA,CAAK,SAAA,CAAU,eAAA,CAAgB,QAAQ,CAAA;AAAA,MAChD,SAAS,KAAA,EAAY;AACnB,QAAA,IAAA,CAAK,YAAY,KAAK,CAAA;AACtB,QAAA,MAAM,KAAA;AAAA,MACR;AAAA,IACF,CAAA,EAAG,QAAQ,KAAK,CAAA;AAAA,EAClB;AAAA;AAAA;AAAA;AAAA,EAKA,OAAO,eAAe,OAAA,EAAkE;AACtF,IAAA,IAAI;AAEF,MAAA,MAAM,EAAE,KAAA,EAAO,YAAA,EAAa,GAAI,KAAK,SAAA,CAAU,YAAA;AAAA,QAC7C,OAAA,CAAQ,KAAA;AAAA,QACR,OAAA,CAAQ;AAAA,OACV;AAGA,MAAA,MAAM,MAAA,GAAc;AAAA,QAClB,OAAO,OAAA,CAAQ,KAAA;AAAA,QACf,KAAA;AAAA,QACA,GAAI,YAAA,IAAgB,EAAE,YAAA,EAAa;AAAA,QACnC,GAAI,OAAA,CAAQ,KAAA,IAAS,OAAA,CAAQ,KAAA,CAAM,SAAS,CAAA,IAAK;AAAA,UAC/C,KAAA,EAAO,IAAA,CAAK,SAAA,CAAU,YAAA,CAAa,QAAQ,KAAK;AAAA,SAClD;AAAA,QACA,GAAI,QAAQ,WAAA,IAAe;AAAA,UACzB,WAAA,EAAa,IAAA,CAAK,SAAA,CAAU,iBAAA,CAAkB,QAAQ,WAAW;AAAA,SACnE;AAAA,QACA,GAAI,OAAA,CAAQ,WAAA,KAAgB,KAAA,CAAA,IACxB,IAAA,CAAK,iBAAA,CAAkB,OAAA,CAAQ,KAAA,EAAO,aAAa,CAAA,IACnD,EAAE,WAAA,EAAa,QAAQ,WAAA,EAAY;AAAA,QACvC,GAAI,OAAA,CAAQ,iBAAA,IAAqB,EAAE,iBAAA,EAAmB,QAAQ,iBAAA,EAAkB;AAAA,QAChF,GAAI,QAAQ,eAAA,IAAmB;AAAA,UAC7B,IAAA,EAAM,IAAA,CAAK,SAAA,CAAU,qBAAA,CAAsB,QAAQ,eAAe;AAAA,SACpE;AAAA,QACA,GAAI,OAAA,CAAQ,mBAAA,KAAwB,KAAA,CAAA,IAAa;AAAA,UAC/C,qBAAqB,OAAA,CAAQ;AAAA,SAC/B;AAAA,QACA,GAAI,QAAQ,oBAAA,IAAwB;AAAA,UAClC,sBAAsB,OAAA,CAAQ;AAAA,SAChC;AAAA,QACA,GAAI,OAAA,CAAQ,QAAA,IAAY,EAAE,QAAA,EAAU,QAAQ,QAAA,EAAS;AAAA,QACrD,MAAA,EAAQ;AAAA,OACV;AAGA,MAAA,MAAM,SAAS,MAAM,IAAA,CAAK,MAAA,CAAO,SAAA,CAAU,OAAO,MAAM,CAAA;AAGxD,MAAA,OAAO,IAAA,CAAK,eAAA,CAAgB,aAAA,CAAc,MAAyD,CAAA;AAAA,IACrG,SAAS,KAAA,EAAY;AACnB,MAAA,IAAA,CAAK,YAAY,KAAK,CAAA;AACtB,MAAA,MAAM,KAAA;AAAA,IACR;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,qBAAqB,KAAA,EAAkC;AAErD,IAAA,IAAI,KAAA,CAAM,UAAA,CAAW,OAAO,CAAA,EAAG;AAC7B,MAAA,OAAO;AAAA,QACL,aAAA,EAAe,IAAA;AAAA,QACf,cAAA,EAAgB,MAAM,QAAA,CAAS,QAAQ,KAAK,CAAC,KAAA,CAAM,SAAS,MAAM,CAAA;AAAA,QAClE,YAAA,EAAc,IAAA;AAAA,QACd,kBAAA,EAAoB,IAAA;AAAA,QACpB,SAAA,EAAW,KAAA,CAAM,QAAA,CAAS,OAAO,IAAI,KAAA,GAAS,IAAA;AAAA,QAC9C,eAAA,EAAiB;AAAA,OACnB;AAAA,IACF;AAGA,IAAA,IAAI,KAAA,CAAM,UAAA,CAAW,SAAS,CAAA,EAAG;AAC/B,MAAA,OAAO;AAAA,QACL,aAAA,EAAe,IAAA;AAAA,QACf,cAAA,EAAgB,KAAA;AAAA,QAChB,YAAA,EAAc,IAAA;AAAA,QACd,kBAAA,EAAoB,KAAA;AAAA,QACpB,SAAA,EAAW,KAAA;AAAA,QACX,eAAA,EAAiB;AAAA,OACnB;AAAA,IACF;AAGA,IAAA,IAAI,MAAM,UAAA,CAAW,IAAI,KAAK,KAAA,CAAM,UAAA,CAAW,IAAI,CAAA,EAAG;AACpD,MAAA,OAAO;AAAA,QACL,aAAA,EAAe,KAAA;AAAA,QACf,cAAA,EAAgB,IAAA;AAAA,QAChB,YAAA,EAAc,KAAA;AAAA,QACd,kBAAA,EAAoB,KAAA;AAAA,QACpB,SAAA,EAAW,GAAA;AAAA,QACX,eAAA,EAAiB;AAAA,OACnB;AAAA,IACF;AAGA,IAAA,OAAO;AAAA,MACL,aAAA,EAAe,KAAA;AAAA,MACf,cAAA,EAAgB,KAAA;AAAA,MAChB,YAAA,EAAc,KAAA;AAAA,MACd,kBAAA,EAAoB,KAAA;AAAA,MACpB,SAAA,EAAW,IAAA;AAAA,MACX,eAAA,EAAiB;AAAA,KACnB;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAMQ,YAAY,KAAA,EAAmB;AACrC,IAAA,IAAI,KAAA,CAAM,WAAW,GAAA,EAAK;AACxB,MAAA,MAAM,IAAI,iBAAA,CAAkB,QAAA,EAAU,iBAAiB,CAAA;AAAA,IACzD;AAEA,IAAA,IAAI,KAAA,CAAM,WAAW,GAAA,EAAK;AACxB,MAAA,MAAM,UAAA,GAAa,KAAA,CAAM,OAAA,GAAU,aAAa,CAAA;AAChD,MAAA,MAAM,IAAI,sBAAA;AAAA,QACR,QAAA;AAAA,QACA,UAAA,GAAa,QAAA,CAAS,UAAU,CAAA,GAAI,GAAA,GAAO;AAAA,OAC7C;AAAA,IACF;AAEA,IAAA,IAAI,KAAA,CAAM,IAAA,KAAS,yBAAA,IAA6B,KAAA,CAAM,WAAW,GAAA,EAAK;AACpE,MAAA,MAAM,IAAI,0BAAA,CAA2B,QAAA,EAAU,KAAM,CAAA;AAAA,IACvD;AAGA,IAAA,MAAM,KAAA;AAAA,EACR;AACF,CAAA;ACrLO,SAAS,iBAAiB,OAAA,EAA8C;AAC7E,EAAA,MAAM;AAAA,IACJ,QAAA;AAAA,IACA,KAAA;AAAA,IACA,KAAA;AAAA,IACA,MAAA;AAAA,IACA,OAAA;AAAA,IACA,KAAA;AAAA,IACA,SAAA;AAAA,IACA,YAAY,IAAA,CAAK,KAAA,CAAM,IAAA,CAAK,GAAA,KAAQ,GAAI;AAAA,GAC1C,GAAI,OAAA;AAGJ,EAAA,MAAM,UAAA,GAAa,KAAA,GAAQ,CAAA,KAAA,EAAQ,QAAQ,CAAA,CAAA,EAAI,KAAK,CAAA,CAAA,GAAK,CAAA,KAAA,EAAQ,QAAQ,CAAA,CAAA,EAAI,UAAA,EAAY,CAAA,CAAA;AACzF,EAAA,MAAM,QAAQ,SAAA,IAAa,CAAA,IAAA,EAAO,QAAQ,CAAA,CAAA,EAAI,YAAY,CAAA,CAAA;AAG1D,EAAA,MAAM,MAAA,GAAuB;AAAA,IAC3B;AAAA,MACE,IAAA,EAAM,SAAA;AAAA,MACN,EAAA,EAAI,KAAA;AAAA,MACJ,IAAA,EAAA,WAAA;AAAA,MACA;AAAA;AACF,GACF;AAGA,EAAA,MAAM,UAAA,GAAa,uBAAuB,OAAO,CAAA;AAEjD,EAAA,OAAO;AAAA,IACL,EAAA,EAAI,UAAA;AAAA,IACJ,MAAA,EAAQ,UAAA;AAAA,IACR,UAAA,EAAY,SAAA;AAAA,IACZ,MAAA;AAAA,IACA,KAAA;AAAA,IACA,MAAA;AAAA,IACA,WAAA,EAAa,UAAA;AAAA,IACb,KAAA,EAAO;AAAA,MACL,cAAc,KAAA,CAAM,WAAA;AAAA,MACpB,eAAe,KAAA,CAAM,YAAA;AAAA,MACrB,YAAA,EAAc,KAAA,CAAM,WAAA,IAAgB,KAAA,CAAM,cAAc,KAAA,CAAM;AAAA;AAChE,GACF;AACF;AAQO,SAAS,uBAAuB,OAAA,EAA4B;AACjE,EAAA,OAAO,OAAA,CACJ,MAAA;AAAA,IAAO,CAAC,MACP,CAAA,CAAE,IAAA,KAAA,aAAA;AAAA,GACJ,CACC,IAAI,CAAC,CAAA,KAAM,EAAE,IAAI,CAAA,CACjB,KAAK,IAAI,CAAA;AACd;AAQO,SAAS,kBAAkB,IAAA,EAAuB;AACvD,EAAA,OAAO;AAAA,IACL,IAAA,EAAA,aAAA;AAAA,IACA,IAAA;AAAA,IACA,aAAa;AAAC,GAChB;AACF;AAUO,SAAS,oBAAA,CACd,EAAA,EACA,IAAA,EACA,IAAA,EACS;AACT,EAAA,OAAO;AAAA,IACL,IAAA,EAAA,UAAA;AAAA,IACA,EAAA;AAAA,IACA,IAAA;AAAA,IACA,WAAW,OAAO,IAAA,KAAS,WAAW,IAAA,GAAO,IAAA,CAAK,UAAU,IAAI;AAAA,GAClE;AACF;AA0BO,SAAS,mBAAmB,UAAA,EAA2C;AAC5E,EAAA,QAAQ,UAAA;AAAY,IAClB,KAAK,UAAA;AAAA,IACL,KAAK,UAAA;AAAA,IACL,KAAK,eAAA;AACH,MAAA,OAAO,WAAA;AAAA,IACT,KAAK,YAAA;AACH,MAAA,OAAO,YAAA;AAAA,IACT;AACE,MAAA,OAAO,YAAA;AAAA;AAEb;AAKO,SAAS,gBAAgB,YAAA,EAAuC;AACrE,EAAA,QAAQ,YAAA;AAAc,IACpB,KAAK,MAAA;AACH,MAAA,OAAO,WAAA;AAAA,IACT,KAAK,YAAA;AACH,MAAA,OAAO,YAAA;AAAA,IACT,KAAK,QAAA;AAAA,IACL,KAAK,YAAA;AACH,MAAA,OAAO,QAAA;AAAA,IACT,KAAK,OAAA;AAAA,IACL;AACE,MAAA,OAAO,YAAA;AAAA;AAEb;AAQO,SAAS,mBAAmB,QAAA,EAA2B;AAC5D,EAAA,MAAM,OAAO,UAAA,EAAW;AACxB,EAAA,OAAkB,CAAA,EAAG,QAAQ,CAAA,CAAA,EAAI,IAAI,CAAA,CAAA,CAAK;AAC5C;;;AC9LO,SAAS,qBACd,KAAA,EAC0B;AAC1B,EAAA,OAAO,MAAM,MAAA,CAAO,CAAC,CAAA,KAAmC,CAAA,CAAE,SAAS,UAAU,CAAA;AAC/E;AASO,SAAS,6BACd,KAAA,EACsB;AACtB,EAAA,OAAO,oBAAA,CAAqB,KAAK,CAAA,CAAE,GAAA,CAAI,CAAC,IAAA,MAAU;AAAA,IAChD,IAAA,EAAM,KAAK,QAAA,CAAS,IAAA;AAAA,IACpB,WAAA,EAAa,IAAA,CAAK,QAAA,CAAS,WAAA,IAAe,EAAA;AAAA,IAC1C,UAAA,EAAY,KAAK,QAAA,CAAS,UAAA,IAAc,EAAE,IAAA,EAAM,QAAA,EAAU,UAAA,EAAY,EAAC;AAAE,GAC3E,CAAE,CAAA;AACJ;AAQO,SAAS,sBAAsB,IAAA,EAA0B;AAC9D,EAAA,OAAO;AAAA,IACL,MAAM,IAAA,CAAK,IAAA;AAAA,IACX,aAAa,IAAA,CAAK,WAAA;AAAA,IAClB,cAAc,IAAA,CAAK;AAAA,GACrB;AACF;;;ACAO,IAAe,gBAAf,MAGL;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EA4CU,eAAe,KAAA,EAA0C;AACjE,IAAA,IAAI,OAAO,UAAU,QAAA,EAAU;AAC7B,MAAA,OAAO;AAAA,QACL;AAAA,UACE,IAAA,EAAM,SAAA;AAAA,UACN,IAAA,EAAA,MAAA;AAAA,UACA,SAAS,CAAC,EAAE,IAAA,EAAA,YAAA,mBAA8B,IAAA,EAAM,OAAO;AAAA;AACzD,OACF;AAAA,IACF;AACA,IAAA,OAAO,KAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA,EAMU,QAAQ,IAAA,EAA2B;AAE3C,IAAA,IAAI,IAAA,KAAA,WAAA,kBAAgC;AAClC,MAAA,OAAO,MAAA;AAAA,IACT;AACA,IAAA,OAAO,IAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKU,aAAa,KAAA,EAAuC;AAC5D,IAAA,IAAI,CAAC,KAAA,IAAS,KAAA,CAAM,MAAA,KAAW,CAAA,EAAG;AAChC,MAAA,OAAO,MAAA;AAAA,IACT;AAEA,IAAA,MAAM,aAAA,GAAgB,6BAA6B,KAAK,CAAA;AACxD,IAAA,OAAO,cAAc,GAAA,CAAI,CAAC,SAAS,IAAA,CAAK,aAAA,CAAc,IAAI,CAAC,CAAA;AAAA,EAC7D;AAAA;AAAA;AAAA;AAAA;AAAA,EAMU,kBAAA,CAAmB,MAAc,UAAA,EAA6B;AACtE,IAAA,IAAI;AACF,MAAA,OAAO,IAAA,CAAK,MAAM,UAAU,CAAA;AAAA,IAC9B,SAAS,UAAA,EAAY;AACnB,MAAA,MAAM,IAAI,yBAAA;AAAA,QACR,IAAA;AAAA,QACA,UAAA;AAAA,QACA,sBAAsB,KAAA,GAAQ,UAAA,GAAa,IAAI,KAAA,CAAM,MAAA,CAAO,UAAU,CAAC;AAAA,OACzE;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAMU,aAAa,GAAA,EAAqC;AAC1D,IAAA,MAAM,OAAA,GAAU,GAAA,CAAI,KAAA,CAAM,iCAAiC,CAAA;AAC3D,IAAA,IAAI,CAAC,OAAA,IAAW,OAAA,CAAQ,MAAA,GAAS,CAAA,EAAG;AAClC,MAAA,OAAO,IAAA;AAAA,IACT;AAEA,IAAA,MAAM,MAAA,GAAS,QAAQ,CAAC,CAAA;AACxB,IAAA,MAAM,IAAA,GAAO,QAAQ,CAAC,CAAA;AAEtB,IAAA,OAAO;AAAA,MACL,MAAA;AAAA,MACA,SAAA,EAAW,SAAS,MAAM,CAAA,CAAA;AAAA,MAC1B;AAAA,KACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKU,UAAU,GAAA,EAAsB;AACxC,IAAA,OAAO,GAAA,CAAI,WAAW,OAAO,CAAA;AAAA,EAC/B;AAAA;AAAA;AAAA;AAAA,EAKU,cAAc,OAAA,EAOR;AACd,IAAA,OAAO,gBAAA,CAAiB;AAAA,MACtB,UAAU,IAAA,CAAK,YAAA;AAAA,MACf,GAAG;AAAA,KACJ,CAAA;AAAA,EACH;AAAA;AAAA;AAAA;AAAA,EAKU,WAAW,IAAA,EAAuB;AAC1C,IAAA,OAAO,kBAAkB,IAAI,CAAA;AAAA,EAC/B;AAAA;AAAA;AAAA;AAAA,EAKU,aAAA,CAAc,EAAA,EAAY,IAAA,EAAc,IAAA,EAAiD;AACjG,IAAA,OAAO,oBAAA,CAAqB,EAAA,EAAI,IAAA,EAAM,IAAI,CAAA;AAAA,EAC5C;AAAA;AAAA;AAAA;AAAA,EAKU,YAAY,OAAA,EAA4B;AAChD,IAAA,OAAO,OAAA,CACJ,MAAA,CAAO,CAAC,CAAA,KAAM,EAAE,IAAA,KAAA,aAAA,mBAAgC,CAChD,GAAA,CAAI,CAAC,CAAA,KAAO,CAAA,CAAuB,IAAI,CAAA,CACvC,KAAK,IAAI,CAAA;AAAA,EACd;AAAA;AAAA;AAAA;AAAA;AAAA,EAMU,mBAAA,CACR,SAEA,SAAA,EAWS;AACT,IAAA,MAAM,QAAA,GAAW,SAAA;AAEjB,IAAA,QAAQ,QAAQ,IAAA;AAAM,MACpB,KAAA,YAAA;AAAA,MACA,KAAA,aAAA;AACE,QAAA,QAAA,CAAS,MAAA,GAAU,QAA6B,IAAI,CAAA;AACpD,QAAA,OAAO,IAAA;AAAA,MAET,KAAA,iBAAA,wBAAkC;AAChC,QAAA,MAAM,UAAA,GAAa,OAAA;AACnB,QAAA,MAAM,MAAA,GAAS,IAAA,CAAK,YAAA,CAAa,UAAA,CAAW,UAAU,GAAG,CAAA;AACzD,QAAA,QAAA,CAAS,OAAA,GAAU,UAAA,CAAW,SAAA,CAAU,GAAA,EAAK,MAAM,CAAA;AACnD,QAAA,OAAO,IAAA;AAAA,MACT;AAAA,MAEA,KAAA,UAAA,iBAA2B;AACzB,QAAA,MAAM,WAAA,GAAc,OAAA;AACpB,QAAA,MAAM,aAAa,IAAA,CAAK,kBAAA,CAAmB,WAAA,CAAY,IAAA,EAAM,YAAY,SAAS,CAAA;AAClF,QAAA,QAAA,CAAS,SAAA,GAAY,WAAA,CAAY,EAAA,EAAI,WAAA,CAAY,MAAM,UAAU,CAAA;AACjE,QAAA,OAAO,IAAA;AAAA,MACT;AAAA,MAEA,KAAA,aAAA,oBAA8B;AAC5B,QAAA,MAAM,aAAA,GAAgB,OAAA;AAKtB,QAAA,MAAM,OAAA,GAAU,CAAC,CAAC,aAAA,CAAc,KAAA;AAChC,QAAA,QAAA,CAAS,YAAA;AAAA,UACP,aAAA,CAAc,WAAA;AAAA,UACd,aAAA,CAAc,OAAA;AAAA,UACd,OAAA;AAAA,UACA,aAAA,CAAc;AAAA,SAChB;AACA,QAAA,OAAO,IAAA;AAAA,MACT;AAAA,MAEA;AACE,QAAA,OAAO,KAAA;AAAA;AACX,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAYA,KAAA,GAAc;AAAA,EAGd;AAAA;AAAA;AAAA;AAAA,EAKA,KAAA,GAAc;AACZ,IAAA,IAAA,CAAK,KAAA,EAAM;AAAA,EACb;AACF,CAAA;;;ACpSO,IAAM,kBAAA,GAAN,cAAiC,aAAA,CAAgE;AAAA,EAC7F,YAAA,GAAe,WAAA;AAAA;AAAA;AAAA;AAAA,EAKxB,eAAe,OAAA,EAA6D;AAC1E,IAAA,MAAM,QAAA,GAAW,IAAA,CAAK,eAAA,CAAgB,OAAA,CAAQ,KAAK,CAAA;AACnD,IAAA,MAAM,KAAA,GAAQ,IAAA,CAAK,qBAAA,CAAsB,OAAA,CAAQ,KAAK,CAAA;AAEtD,IAAA,MAAM,MAAA,GAAwC;AAAA,MAC5C,OAAO,OAAA,CAAQ,KAAA;AAAA,MACf,UAAA,EAAY,QAAQ,iBAAA,IAAqB,IAAA;AAAA,MACzC;AAAA,KACF;AAGA,IAAA,IAAI,QAAQ,YAAA,EAAc;AACxB,MAAA,MAAA,CAAO,SAAS,OAAA,CAAQ,YAAA;AAAA,IAC1B;AAGA,IAAA,IAAI,KAAA,IAAS,KAAA,CAAM,MAAA,GAAS,CAAA,EAAG;AAC7B,MAAA,MAAA,CAAO,KAAA,GAAQ,KAAA;AAAA,IACjB;AAGA,IAAA,IAAI,OAAA,CAAQ,gBAAgB,MAAA,EAAW;AACrC,MAAA,MAAA,CAAO,cAAc,OAAA,CAAQ,WAAA;AAAA,IAC/B;AAEA,IAAA,OAAO,MAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,gBAAgB,QAAA,EAA0C;AACxD,IAAA,OAAO,KAAK,aAAA,CAAc;AAAA,MACxB,OAAO,QAAA,CAAS,EAAA;AAAA,MAChB,OAAO,QAAA,CAAS,KAAA;AAAA,MAChB,MAAA,EAAQ,IAAA,CAAK,iBAAA,CAAkB,QAAA,CAAS,WAAW,CAAA;AAAA,MACnD,OAAA,EAAS,IAAA,CAAK,sBAAA,CAAuB,QAAA,CAAS,OAAO,CAAA;AAAA,MACrD,WAAW,QAAA,CAAS,EAAA;AAAA,MACpB,KAAA,EAAO;AAAA,QACL,WAAA,EAAa,SAAS,KAAA,CAAM,YAAA;AAAA,QAC5B,YAAA,EAAc,SAAS,KAAA,CAAM;AAAA;AAC/B,KACD,CAAA;AAAA,EACH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASU,cAAc,IAAA,EAA0C;AAChE,IAAA,OAAO;AAAA,MACL,GAAG,sBAAsB,IAAI,CAAA;AAAA,MAC7B,YAAA,EAAc;AAAA,QACZ,IAAA,EAAM,QAAA;AAAA,QACN,GAAG,IAAA,CAAK;AAAA;AACV,KACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKU,uBAAuB,MAAA,EAA8B;AAC7D,IAAA,MAAM,UAAqB,EAAC;AAE5B,IAAA,KAAA,MAAW,SAAS,MAAA,EAAoC;AACtD,MAAA,IAAI,KAAA,CAAM,SAAS,MAAA,EAAQ;AACzB,QAAA,OAAA,CAAQ,IAAA,CAAK,IAAA,CAAK,UAAA,CAAW,KAAA,CAAM,IAAI,CAAC,CAAA;AAAA,MAC1C,CAAA,MAAA,IAAW,KAAA,CAAM,IAAA,KAAS,UAAA,EAAY;AACpC,QAAA,OAAA,CAAQ,IAAA,CAAK,KAAK,aAAA,CAAc,KAAA,CAAM,IAAI,KAAA,CAAM,IAAA,EAAM,KAAA,CAAM,KAAgC,CAAC,CAAA;AAAA,MAC/F;AAAA,IACF;AAEA,IAAA,OAAO,OAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKU,kBAAkB,MAAA,EAAiC;AAC3D,IAAA,OAAO,mBAAmB,MAAuB,CAAA;AAAA,EACnD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASQ,gBAAgB,KAAA,EAAuD;AAC7E,IAAA,IAAI,OAAO,UAAU,QAAA,EAAU;AAC7B,MAAA,OAAO,CAAC,EAAE,IAAA,EAAM,MAAA,EAAQ,OAAA,EAAS,OAAO,CAAA;AAAA,IAC1C;AAEA,IAAA,MAAM,WAAqC,EAAC;AAE5C,IAAA,KAAA,MAAW,QAAQ,KAAA,EAAO;AACxB,MAAA,IAAI,IAAA,CAAK,SAAS,SAAA,EAAW;AAE3B,QAAA,MAAM,IAAA,GAAO,IAAA,CAAK,OAAA,CAAQ,IAAA,CAAK,IAAI,CAAA;AAGnC,QAAA,MAAM,OAAA,GAAU,IAAA,CAAK,cAAA,CAAe,IAAA,CAAK,OAAO,CAAA;AAEhD,QAAA,QAAA,CAAS,IAAA,CAAK;AAAA,UACZ,IAAA;AAAA,UACA;AAAA,SACD,CAAA;AAAA,MACH;AAAA,IACF;AAEA,IAAA,OAAO,QAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKQ,eAAe,OAAA,EAAuD;AAC5E,IAAA,MAAM,SAAqI,EAAC;AAE5I,IAAA,KAAA,MAAW,KAAK,OAAA,EAAS;AACvB,MAAA,QAAQ,EAAE,IAAA;AAAM,QACd,KAAA,YAAA;AAAA,QACA,KAAA,aAAA;AACE,UAAA,MAAA,CAAO,IAAA,CAAK;AAAA,YACV,IAAA,EAAM,MAAA;AAAA,YACN,MAAO,CAAA,CAAuB;AAAA,WAC/B,CAAA;AACD,UAAA;AAAA,QAEF,KAAA,iBAAA,wBAAkC;AAChC,UAAA,MAAM,UAAA,GAAa,CAAA;AACnB,UAAA,MAAM,KAAA,GAAQ,IAAA,CAAK,4BAAA,CAA6B,UAAA,CAAW,UAAU,GAAG,CAAA;AACxE,UAAA,IAAI,KAAA,EAAO;AACT,YAAA,MAAA,CAAO,KAAK,KAAK,CAAA;AAAA,UACnB;AACA,UAAA;AAAA,QACF;AAAA,QAEA,KAAA,aAAA,oBAA8B;AAC5B,UAAA,MAAM,aAAA,GAAgB,CAAA;AAKtB,UAAA,MAAA,CAAO,IAAA,CAAK,IAAA,CAAK,iCAAA,CAAkC,aAAa,CAAC,CAAA;AACjE,UAAA;AAAA,QACF;AAAA,QAEA,KAAA,UAAA,iBAA2B;AACzB,UAAA,MAAM,WAAA,GAAc,CAAA;AACpB,UAAA,MAAM,cAAc,IAAA,CAAK,kBAAA,CAAmB,WAAA,CAAY,IAAA,EAAM,YAAY,SAAS,CAAA;AACnF,UAAA,MAAA,CAAO,IAAA,CAAK;AAAA,YACV,IAAA,EAAM,UAAA;AAAA,YACN,IAAI,WAAA,CAAY,EAAA;AAAA,YAChB,MAAM,WAAA,CAAY,IAAA;AAAA,YAClB,KAAA,EAAO;AAAA,WACR,CAAA;AACD,UAAA;AAAA,QACF;AAAA;AACF,IACF;AAGA,IAAA,IAAI,OAAO,MAAA,KAAW,CAAA,IAAK,OAAO,CAAC,CAAA,EAAG,SAAS,MAAA,EAAQ;AACrD,MAAA,OAAQ,MAAA,CAAO,CAAC,CAAA,CAA+B,IAAA;AAAA,IACjD;AAEA,IAAA,OAAO,MAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKQ,6BAA6B,GAAA,EAA+C;AAClF,IAAA,MAAM,MAAA,GAAS,IAAA,CAAK,YAAA,CAAa,GAAG,CAAA;AAEpC,IAAA,IAAI,MAAA,EAAQ;AAEV,MAAA,OAAO;AAAA,QACL,IAAA,EAAM,OAAA;AAAA,QACN,MAAA,EAAQ;AAAA,UACN,IAAA,EAAM,QAAA;AAAA,UACN,YAAY,MAAA,CAAO,SAAA;AAAA,UACnB,MAAM,MAAA,CAAO;AAAA;AACf,OACF;AAAA,IACF,CAAA,MAAO;AAGL,MAAA,OAAO;AAAA,QACL,IAAA,EAAM,OAAA;AAAA,QACN,MAAA,EAAQ;AAAA,UACN,IAAA,EAAM,KAAA;AAAA,UACN;AAAA;AACF,OACF;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAMQ,kCAAkC,aAAA,EAIP;AACjC,IAAA,MAAM,OAAA,GAAU,CAAC,CAAC,aAAA,CAAc,KAAA;AAChC,IAAA,IAAI,iBAAA;AAEJ,IAAA,IAAI,OAAO,aAAA,CAAc,OAAA,KAAY,QAAA,EAAU;AAE7C,MAAA,iBAAA,GAAoB,aAAA,CAAc,OAAA,KAAY,OAAA,GAAU,aAAA,CAAc,KAAA,GAAS,EAAA,CAAA;AAAA,IACjF,CAAA,MAAO;AACL,MAAA,iBAAA,GAAoB,IAAA,CAAK,SAAA,CAAU,aAAA,CAAc,OAAO,CAAA;AAAA,IAC1D;AAGA,IAAA,IAAI,OAAA,IAAW,CAAC,iBAAA,EAAmB;AACjC,MAAA,iBAAA,GAAoB,cAAc,KAAA,IAAS,uBAAA;AAAA,IAC7C;AAEA,IAAA,OAAO;AAAA,MACL,IAAA,EAAM,aAAA;AAAA,MACN,aAAa,aAAA,CAAc,WAAA;AAAA,MAC3B,OAAA,EAAS,iBAAA;AAAA,MACT,QAAA,EAAU;AAAA,KACZ;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAMQ,sBAAsB,KAAA,EAA8C;AAC1E,IAAA,IAAI,CAAC,KAAA,IAAS,KAAA,CAAM,MAAA,KAAW,CAAA,EAAG;AAChC,MAAA,OAAO,MAAA;AAAA,IACT;AAEA,IAAA,MAAM,aAAA,GAAgB,6BAA6B,KAAK,CAAA;AACxD,IAAA,OAAO,cAAc,GAAA,CAAI,CAAC,SAAS,IAAA,CAAK,aAAA,CAAc,IAAI,CAAC,CAAA;AAAA,EAC7D;AACF,CAAA;;;AC5OO,IAAe,sBAAf,MAAqD;AAAA;AAAA;AAAA;AAAA;AAAA,EAMhD,UAAA,GAAqB,EAAA;AAAA;AAAA,EAGrB,KAAA,GAAgB,EAAA;AAAA;AAAA,EAGhB,cAAA,GAAyB,CAAA;AAAA;AAAA,EAGzB,KAAA,GAAqB,EAAE,WAAA,EAAa,CAAA,EAAG,cAAc,CAAA,EAAE;AAAA;AAAA,EAGvD,eAAA,uBAAmD,GAAA,EAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EA2BjE,OAAO,aAAA,CACL,MAAA,EACA,KAAA,EACoC;AAEpC,IAAA,IAAA,CAAK,KAAA,EAAM;AACX,IAAA,IAAI,KAAA,EAAO;AACT,MAAA,IAAA,CAAK,KAAA,GAAQ,KAAA;AAAA,IACf;AAEA,IAAA,IAAI;AACF,MAAA,WAAA,MAAiB,SAAS,MAAA,EAAQ;AAChC,QAAA,MAAM,SAAA,GAAY,IAAA,CAAK,YAAA,CAAa,KAAK,CAAA;AACzC,QAAA,KAAA,MAAW,OAAO,SAAA,EAAW;AAC3B,UAAA,MAAM,GAAA;AAAA,QACR;AAAA,MACF;AAAA,IACF,CAAA,SAAE;AAAA,IAGF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,KAAA,GAAc;AACZ,IAAA,IAAA,CAAK,UAAA,GAAa,EAAA;AAClB,IAAA,IAAA,CAAK,KAAA,GAAQ,EAAA;AACb,IAAA,IAAA,CAAK,cAAA,GAAiB,CAAA;AACtB,IAAA,IAAA,CAAK,KAAA,GAAQ,EAAE,WAAA,EAAa,CAAA,EAAG,cAAc,CAAA,EAAE;AAC/C,IAAA,IAAA,CAAK,gBAAgB,KAAA,EAAM;AAAA,EAC7B;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,KAAA,GAAc;AACZ,IAAA,IAAA,CAAK,KAAA,EAAM;AAAA,EACb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASU,kBAAA,GAA6B;AACrC,IAAA,MAAM,IAAA,GAAO,OAAO,UAAA,EAAW;AAC/B,IAAA,OAAO,CAAA,KAAA,EAAQ,IAAA,CAAK,YAAY,CAAA,CAAA,EAAI,IAAI,CAAA,CAAA;AAAA,EAC1C;AAAA;AAAA;AAAA;AAAA,EAKU,YAAA,GAAuB;AAC/B,IAAA,OAAO,IAAA,CAAK,cAAA,EAAA;AAAA,EACd;AAAA;AAAA;AAAA;AAAA,EAKU,oBAAoB,UAAA,EAAkC;AAC9D,IAAA,IAAI,UAAA,EAAY;AACd,MAAA,IAAA,CAAK,UAAA,GAAa,UAAA;AAAA,IACpB,CAAA,MAAA,IAAW,CAAC,IAAA,CAAK,UAAA,EAAY;AAC3B,MAAA,IAAA,CAAK,UAAA,GAAa,KAAK,kBAAA,EAAmB;AAAA,IAC5C;AAEA,IAAA,OAAO;AAAA,MACL,IAAA,EAAA,kBAAA;AAAA,MACA,aAAa,IAAA,CAAK,UAAA;AAAA,MAClB,OAAO,IAAA,CAAK,KAAA;AAAA,MACZ,UAAA,EAAY,KAAK,GAAA;AAAI,KACvB;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKU,aAAA,CACR,OACA,OAAA,EACa;AACb,IAAA,OAAO;AAAA,MACL,IAAA,EAAA,4BAAA;AAAA,MACA,aAAa,IAAA,CAAK,UAAA;AAAA,MAClB,OAAA,EAAS,OAAA,EAAS,MAAA,IAAU,CAAA,IAAA,EAAO,KAAK,UAAU,CAAA,CAAA;AAAA,MAClD,YAAA,EAAc,SAAS,WAAA,IAAe,CAAA;AAAA,MACtC,aAAA,EAAe,SAAS,YAAA,IAAgB,CAAA;AAAA,MACxC,KAAA;AAAA,MACA,eAAA,EAAiB,KAAK,YAAA;AAAa,KACrC;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKU,iBAAA,CAAkB,UAAA,EAAoB,QAAA,EAAkB,MAAA,EAA8B;AAE9F,IAAA,IAAA,CAAK,eAAA,CAAgB,IAAI,UAAA,EAAY;AAAA,MACnC,EAAA,EAAI,UAAA;AAAA,MACJ,IAAA,EAAM,QAAA;AAAA,MACN,IAAA,EAAM;AAAA,KACP,CAAA;AAED,IAAA,OAAO;AAAA,MACL,IAAA,EAAA,0BAAA;AAAA,MACA,aAAa,IAAA,CAAK,UAAA;AAAA,MAClB,OAAA,EAAS,MAAA,IAAU,CAAA,IAAA,EAAO,IAAA,CAAK,UAAU,CAAA,CAAA;AAAA,MACzC,YAAA,EAAc,UAAA;AAAA,MACd,SAAA,EAAW;AAAA,KACb;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKU,qBAAA,CACR,UAAA,EACA,KAAA,EACA,QAAA,EACa;AAEb,IAAA,MAAM,MAAA,GAAS,IAAA,CAAK,eAAA,CAAgB,GAAA,CAAI,UAAU,CAAA;AAClD,IAAA,IAAI,MAAA,EAAQ;AACV,MAAA,MAAA,CAAO,IAAA,IAAQ,KAAA;AAAA,IACjB;AAEA,IAAA,OAAO;AAAA,MACL,IAAA,EAAA,oCAAA;AAAA,MACA,aAAa,IAAA,CAAK,UAAA;AAAA,MAClB,OAAA,EAAS,CAAA,IAAA,EAAO,IAAA,CAAK,UAAU,CAAA,CAAA;AAAA,MAC/B,YAAA,EAAc,UAAA;AAAA,MACd,SAAA,EAAW,QAAA,IAAY,MAAA,EAAQ,IAAA,IAAQ,EAAA;AAAA,MACvC,KAAA;AAAA,MACA,eAAA,EAAiB,KAAK,YAAA;AAAa,KACrC;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKU,oBAAA,CAAqB,YAAoB,QAAA,EAAgC;AACjF,IAAA,MAAM,MAAA,GAAS,IAAA,CAAK,eAAA,CAAgB,GAAA,CAAI,UAAU,CAAA;AAClD,IAAA,MAAM,IAAA,GAAO,QAAQ,IAAA,IAAQ,IAAA;AAC7B,IAAA,MAAM,IAAA,GAAO,QAAA,IAAY,MAAA,EAAQ,IAAA,IAAQ,EAAA;AAEzC,IAAA,OAAO;AAAA,MACL,IAAA,EAAA,mCAAA;AAAA,MACA,aAAa,IAAA,CAAK,UAAA;AAAA,MAClB,YAAA,EAAc,UAAA;AAAA,MACd,SAAA,EAAW,IAAA;AAAA,MACX,SAAA,EAAW;AAAA,KACb;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKU,oBAAA,CAAqB,SAAgD,WAAA,EAA0B;AACvG,IAAA,OAAO;AAAA,MACL,IAAA,EAAA,mBAAA;AAAA,MACA,aAAa,IAAA,CAAK,UAAA;AAAA,MAClB,MAAA;AAAA,MACA,KAAA,EAAO;AAAA,QACL,YAAA,EAAc,KAAK,KAAA,CAAM,WAAA;AAAA,QACzB,aAAA,EAAe,KAAK,KAAA,CAAM,YAAA;AAAA,QAC1B,YAAA,EAAc,IAAA,CAAK,KAAA,CAAM,WAAA,GAAc,KAAK,KAAA,CAAM;AAAA,OACpD;AAAA,MACA,UAAA,EAAY;AAAA,KACd;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKU,WAAA,CAAY,aAAsB,YAAA,EAA6B;AACvE,IAAA,IAAI,gBAAgB,MAAA,EAAW;AAC7B,MAAA,IAAA,CAAK,MAAM,WAAA,GAAc,WAAA;AAAA,IAC3B;AACA,IAAA,IAAI,iBAAiB,MAAA,EAAW;AAC9B,MAAA,IAAA,CAAK,MAAM,YAAA,GAAe,YAAA;AAAA,IAC5B;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKU,mBAAmB,UAAA,EAA4B;AACvD,IAAA,OAAO,IAAA,CAAK,eAAA,CAAgB,GAAA,CAAI,UAAU,GAAG,IAAA,IAAQ,IAAA;AAAA,EACvD;AAAA;AAAA;AAAA;AAAA,EAKU,kBAAkB,UAAA,EAA6B;AACvD,IAAA,OAAO,IAAA,CAAK,eAAA,CAAgB,GAAA,CAAI,UAAU,CAAA;AAAA,EAC5C;AACF,CAAA;;;ACnQO,IAAM,wBAAA,GAAN,cAAuC,mBAAA,CAAkD;AAAA,EACrF,YAAA,GAAe,WAAA;AAAA;AAAA,EAGhB,iBAAA,uBAAuD,GAAA,EAAI;AAAA;AAAA;AAAA;AAAA,EAKzD,aAAa,KAAA,EAAoD;AACzE,IAAA,MAAM,YAAY,KAAA,CAAM,IAAA;AAExB,IAAA,QAAQ,SAAA;AAAW,MACjB,KAAK,eAAA;AACH,QAAA,OAAO,IAAA,CAAK,mBAAmB,KAAoC,CAAA;AAAA,MAErE,KAAK,qBAAA;AACH,QAAA,OAAO,IAAA,CAAK,wBAAwB,KAAyC,CAAA;AAAA,MAE/E,KAAK,qBAAA;AACH,QAAA,OAAO,IAAA,CAAK,wBAAwB,KAAyC,CAAA;AAAA,MAE/E,KAAK,oBAAA;AACH,QAAA,OAAO,IAAA,CAAK,uBAAuB,KAAwC,CAAA;AAAA,MAE7E,KAAK,eAAA;AACH,QAAA,OAAO,IAAA,CAAK,mBAAmB,KAAoC,CAAA;AAAA,MAErE,KAAK,cAAA;AACH,QAAA,OAAO,KAAK,iBAAA,EAAkB;AAAA,MAEhC;AAEE,QAAA,OAAO,EAAC;AAAA;AACZ,EACF;AAAA;AAAA;AAAA;AAAA,EAKS,KAAA,GAAc;AACrB,IAAA,KAAA,CAAM,KAAA,EAAM;AACZ,IAAA,IAAA,CAAK,kBAAkB,KAAA,EAAM;AAAA,EAC/B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASQ,mBAAmB,KAAA,EAAmD;AAC5E,IAAA,IAAA,CAAK,UAAA,GAAa,MAAM,OAAA,CAAQ,EAAA;AAGhC,IAAA,IAAI,KAAA,CAAM,QAAQ,KAAA,EAAO;AACvB,MAAA,IAAA,CAAK,WAAA,CAAY,KAAA,CAAM,OAAA,CAAQ,KAAA,CAAM,cAAc,MAAS,CAAA;AAAA,IAC9D;AAEA,IAAA,OAAO,CAAC,IAAA,CAAK,mBAAA,CAAoB,IAAA,CAAK,UAAU,CAAC,CAAA;AAAA,EACnD;AAAA;AAAA;AAAA;AAAA,EAKQ,wBAAwB,KAAA,EAAwD;AACtF,IAAA,MAAM,QAAQ,KAAA,CAAM,KAAA;AACpB,IAAA,MAAM,QAAQ,KAAA,CAAM,aAAA;AAGpB,IAAA,IAAI,KAAA,CAAM,SAAS,MAAA,EAAQ;AACzB,MAAA,IAAA,CAAK,kBAAkB,GAAA,CAAI,KAAA,EAAO,EAAE,IAAA,EAAM,QAAQ,CAAA;AAClD,MAAA,OAAO,EAAC;AAAA,IACV,CAAA,MAAA,IAAW,KAAA,CAAM,IAAA,KAAS,UAAA,EAAY;AACpC,MAAA,IAAA,CAAK,iBAAA,CAAkB,IAAI,KAAA,EAAO;AAAA,QAChC,IAAA,EAAM,UAAA;AAAA,QACN,IAAI,KAAA,CAAM,EAAA;AAAA,QACV,MAAM,KAAA,CAAM;AAAA,OACb,CAAA;AAED,MAAA,OAAO,CAAC,IAAA,CAAK,iBAAA,CAAkB,KAAA,CAAM,EAAA,EAAI,KAAA,CAAM,IAAA,EAAM,CAAA,IAAA,EAAO,IAAA,CAAK,UAAU,CAAA,CAAE,CAAC,CAAA;AAAA,IAChF;AAEA,IAAA,OAAO,EAAC;AAAA,EACV;AAAA;AAAA;AAAA;AAAA,EAKQ,wBAAwB,KAAA,EAAwD;AACtF,IAAA,MAAM,QAAQ,KAAA,CAAM,KAAA;AACpB,IAAA,MAAM,QAAQ,KAAA,CAAM,KAAA;AACpB,IAAA,MAAM,SAAA,GAAY,IAAA,CAAK,iBAAA,CAAkB,GAAA,CAAI,KAAK,CAAA;AAElD,IAAA,IAAI,CAAC,SAAA,EAAW,OAAO,EAAC;AAExB,IAAA,IAAI,KAAA,CAAM,SAAS,YAAA,EAAc;AAC/B,MAAA,OAAO;AAAA,QACL,IAAA,CAAK,aAAA,CAAc,KAAA,CAAM,IAAA,EAAM;AAAA,UAC7B,MAAA,EAAQ,CAAA,IAAA,EAAO,IAAA,CAAK,UAAU,CAAA,CAAA;AAAA,UAC9B,YAAA,EAAc;AAAA,SACf;AAAA,OACH;AAAA,IACF,CAAA,MAAA,IAAW,KAAA,CAAM,IAAA,KAAS,kBAAA,EAAoB;AAC5C,MAAA,MAAM,UAAA,GAAa,UAAU,EAAA,IAAM,EAAA;AACnC,MAAA,OAAO,CAAC,KAAK,qBAAA,CAAsB,UAAA,EAAY,MAAM,YAAA,EAAc,SAAA,CAAU,IAAI,CAAC,CAAA;AAAA,IACpF;AAEA,IAAA,OAAO,EAAC;AAAA,EACV;AAAA;AAAA;AAAA;AAAA,EAKQ,uBAAuB,KAAA,EAAuD;AACpF,IAAA,MAAM,QAAQ,KAAA,CAAM,KAAA;AACpB,IAAA,MAAM,SAAA,GAAY,IAAA,CAAK,iBAAA,CAAkB,GAAA,CAAI,KAAK,CAAA;AAElD,IAAA,IAAI,CAAC,SAAA,EAAW,OAAO,EAAC;AAGxB,IAAA,IAAI,SAAA,CAAU,SAAS,UAAA,EAAY;AACjC,MAAA,OAAO,CAAC,KAAK,oBAAA,CAAqB,SAAA,CAAU,MAAM,EAAA,EAAI,SAAA,CAAU,IAAI,CAAC,CAAA;AAAA,IACvE;AAEA,IAAA,OAAO,EAAC;AAAA,EACV;AAAA;AAAA;AAAA;AAAA,EAKQ,mBAAmB,KAAA,EAAmD;AAG5E,IAAA,IAAI,MAAM,KAAA,EAAO;AACf,MAAA,IAAA,CAAK,WAAA,CAAY,MAAA,EAAW,KAAA,CAAM,KAAA,CAAM,aAAa,CAAA;AAAA,IACvD;AAGA,IAAA,OAAO,EAAC;AAAA,EACV;AAAA;AAAA;AAAA;AAAA,EAKQ,iBAAA,GAAmC;AACzC,IAAA,OAAO,CAAC,IAAA,CAAK,oBAAA,CAAqB,WAAW,CAAC,CAAA;AAAA,EAChD;AACF,CAAA;;;AC5JO,IAAM,qBAAA,GAAN,cAAoC,gBAAA,CAAiB;AAAA,EACjD,IAAA,GAAO,WAAA;AAAA,EACP,YAAA,GAAqC;AAAA,IAC5C,IAAA,EAAM,IAAA;AAAA,IACN,MAAA,EAAQ,IAAA;AAAA;AAAA,IACR,MAAA,EAAQ,KAAA;AAAA,IACR,KAAA,EAAO;AAAA,GACT;AAAA,EAEQ,MAAA;AAAA,EACA,SAAA;AAAA,EACA,eAAA;AAAA,EAER,YAAY,MAAA,EAAyB;AACnC,IAAA,KAAA,CAAM,MAAM,CAAA;AAEZ,IAAA,IAAA,CAAK,MAAA,GAAS,IAAI,SAAA,CAAU;AAAA,MAC1B,MAAA,EAAQ,KAAK,SAAA,EAAU;AAAA,MACvB,OAAA,EAAS,KAAK,UAAA,EAAW;AAAA,MACzB,UAAA,EAAY,KAAK,aAAA;AAAc,KAChC,CAAA;AACD,IAAA,IAAA,CAAK,SAAA,GAAY,IAAI,kBAAA,EAAmB;AACxC,IAAA,IAAA,CAAK,eAAA,GAAkB,IAAI,wBAAA,EAAyB;AAAA,EACtD;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,SAAS,OAAA,EAAoD;AACjE,IAAA,OAAO,IAAA,CAAK,0BAA0B,YAAY;AAChD,MAAA,IAAI;AAEF,QAAA,MAAM,gBAAA,GAAmB,IAAA,CAAK,SAAA,CAAU,cAAA,CAAe,OAAO,CAAA;AAG9D,QAAA,MAAM,iBAAA,GAAoB,MAAM,IAAA,CAAK,MAAA,CAAO,SAAS,MAAA,CAAO;AAAA,UAC1D,GAAG,gBAAA;AAAA,UACH,MAAA,EAAQ;AAAA,SACT,CAAA;AAGD,QAAA,OAAO,IAAA,CAAK,SAAA,CAAU,eAAA,CAAgB,iBAAiB,CAAA;AAAA,MACzD,SAAS,KAAA,EAAY;AACnB,QAAA,IAAA,CAAK,YAAY,KAAK,CAAA;AACtB,QAAA,MAAM,KAAA;AAAA,MACR;AAAA,IACF,CAAA,EAAG,QAAQ,KAAK,CAAA;AAAA,EAClB;AAAA;AAAA;AAAA;AAAA,EAKA,OAAO,eAAe,OAAA,EAAkE;AACtF,IAAA,IAAI;AAEF,MAAA,MAAM,gBAAA,GAAmB,IAAA,CAAK,SAAA,CAAU,cAAA,CAAe,OAAO,CAAA;AAG9D,MAAA,MAAM,MAAA,GAAS,MAAM,IAAA,CAAK,MAAA,CAAO,SAAS,MAAA,CAAO;AAAA,QAC/C,GAAG,gBAAA;AAAA,QACH,MAAA,EAAQ;AAAA,OACT,CAAA;AAGD,MAAA,IAAA,CAAK,gBAAgB,KAAA,EAAM;AAG3B,MAAA,OAAO,IAAA,CAAK,eAAA,CAAgB,aAAA,CAAc,MAAA,EAAQ,QAAQ,KAAK,CAAA;AAAA,IACjE,SAAS,KAAA,EAAY;AACnB,MAAA,IAAA,CAAK,YAAY,KAAK,CAAA;AACtB,MAAA,MAAM,KAAA;AAAA,IACR,CAAA,SAAE;AAGA,MAAA,IAAA,CAAK,gBAAgB,KAAA,EAAM;AAAA,IAC7B;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,qBAAqB,KAAA,EAAkC;AAErD,IAAA,IAAI,KAAA,CAAM,QAAA,CAAS,iBAAiB,CAAA,IAAK,KAAA,CAAM,QAAA,CAAS,eAAe,CAAA,IAAK,KAAA,CAAM,QAAA,CAAS,gBAAgB,CAAA,EAAG;AAC5G,MAAA,OAAO;AAAA,QACL,aAAA,EAAe,IAAA;AAAA,QACf,cAAA,EAAgB,IAAA;AAAA,QAChB,YAAA,EAAc,IAAA;AAAA,QACd,kBAAA,EAAoB,KAAA;AAAA;AAAA,QACpB,SAAA,EAAW,GAAA;AAAA,QACX,eAAA,EAAiB;AAAA,OACnB;AAAA,IACF;AAGA,IAAA,IAAI,MAAM,QAAA,CAAS,mBAAmB,KAAK,KAAA,CAAM,QAAA,CAAS,mBAAmB,CAAA,EAAG;AAC9E,MAAA,OAAO;AAAA,QACL,aAAA,EAAe,IAAA;AAAA,QACf,cAAA,EAAgB,IAAA;AAAA,QAChB,YAAA,EAAc,IAAA;AAAA,QACd,kBAAA,EAAoB,KAAA;AAAA,QACpB,SAAA,EAAW,GAAA;AAAA,QACX,eAAA,EAAiB;AAAA,OACnB;AAAA,IACF;AAGA,IAAA,IAAI,KAAA,CAAM,QAAA,CAAS,eAAe,CAAA,EAAG;AACnC,MAAA,OAAO;AAAA,QACL,aAAA,EAAe,IAAA;AAAA,QACf,cAAA,EAAgB,IAAA;AAAA,QAChB,YAAA,EAAc,IAAA;AAAA,QACd,kBAAA,EAAoB,KAAA;AAAA,QACpB,SAAA,EAAW,GAAA;AAAA,QACX,eAAA,EAAiB;AAAA,OACnB;AAAA,IACF;AAGA,IAAA,IAAI,KAAA,CAAM,QAAA,CAAS,iBAAiB,CAAA,EAAG;AACrC,MAAA,OAAO;AAAA,QACL,aAAA,EAAe,IAAA;AAAA,QACf,cAAA,EAAgB,IAAA;AAAA,QAChB,YAAA,EAAc,IAAA;AAAA,QACd,kBAAA,EAAoB,KAAA;AAAA,QACpB,SAAA,EAAW,GAAA;AAAA,QACX,eAAA,EAAiB;AAAA,OACnB;AAAA,IACF;AAGA,IAAA,IAAI,KAAA,CAAM,QAAA,CAAS,gBAAgB,CAAA,EAAG;AACpC,MAAA,OAAO;AAAA,QACL,aAAA,EAAe,IAAA;AAAA,QACf,cAAA,EAAgB,IAAA;AAAA,QAChB,YAAA,EAAc,IAAA;AAAA,QACd,kBAAA,EAAoB,KAAA;AAAA,QACpB,SAAA,EAAW,GAAA;AAAA,QACX,eAAA,EAAiB;AAAA,OACnB;AAAA,IACF;AAIA,IAAA,OAAO;AAAA,MACL,aAAA,EAAe,IAAA;AAAA,MACf,cAAA,EAAgB,IAAA;AAAA,MAChB,YAAA,EAAc,IAAA;AAAA,MACd,kBAAA,EAAoB,KAAA;AAAA,MACpB,SAAA,EAAW,GAAA;AAAA,MACX,eAAA,EAAiB;AAAA,KACnB;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,YAAY,KAAA,EAAmB;AACrC,IAAA,IAAI,KAAA,CAAM,WAAW,GAAA,EAAK;AACxB,MAAA,MAAM,IAAI,iBAAA,CAAkB,WAAA,EAAa,iBAAiB,CAAA;AAAA,IAC5D;AAEA,IAAA,IAAI,KAAA,CAAM,WAAW,GAAA,EAAK;AACxB,MAAA,MAAM,UAAA,GAAa,KAAA,CAAM,OAAA,GAAU,aAAa,CAAA;AAChD,MAAA,MAAM,IAAI,sBAAA;AAAA,QACR,WAAA;AAAA,QACA,UAAA,GAAa,QAAA,CAAS,UAAU,CAAA,GAAI,GAAA,GAAO;AAAA,OAC7C;AAAA,IACF;AAEA,IAAA,IACE,KAAA,CAAM,IAAA,KAAS,uBAAA,KACd,KAAA,CAAM,OAAA,EAAS,QAAA,CAAS,oBAAoB,CAAA,IAC3C,KAAA,CAAM,OAAA,EAAS,QAAA,CAAS,wBAAwB,CAAA,CAAA,EAClD;AACA,MAAA,MAAM,IAAI,0BAAA,CAA2B,WAAA,EAAa,GAAM,CAAA;AAAA,IAC1D;AAGA,IAAA,MAAM,KAAA;AAAA,EACR;AACF,CAAA;;;ACvLA,IAAM,kBAAA,GAAqB,GAAA;AAC3B,IAAM,sBAAA,GAAyB,KAAK,IAAA,GAAO,IAAA;AAM3C,eAAsB,kBAAA,CACpB,KACA,OAAA,EACoB;AACpB,EAAA,MAAM,EAAE,SAAA,GAAY,kBAAA,EAAoB,eAAe,sBAAA,EAAuB,GAAe,EAAC;AAG9F,EAAA,IAAI,GAAA,CAAI,UAAA,CAAW,aAAa,CAAA,EAAG;AACjC,IAAA,MAAM,OAAA,GAAU,GAAA,CAAI,KAAA,CAAM,iCAAiC,CAAA;AAC3D,IAAA,IAAI,OAAA,EAAS;AACX,MAAA,MAAM,UAAA,GAAa,OAAA,CAAQ,CAAC,CAAA,IAAK,EAAA;AACjC,MAAA,MAAM,IAAA,GAAO,oBAAoB,UAAU,CAAA;AAG3C,MAAA,IAAI,OAAO,YAAA,EAAc;AACvB,QAAA,MAAM,IAAI,KAAA,CAAM,CAAA,YAAA,EAAe,WAAA,CAAY,IAAI,CAAC,CAAA,2BAAA,EAA8B,WAAA,CAAY,YAAY,CAAC,CAAA,CAAA,CAAG,CAAA;AAAA,MAC5G;AAEA,MAAA,OAAO;AAAA,QACL,QAAA,EAAU,OAAA,CAAQ,CAAC,CAAA,IAAK,WAAA;AAAA,QACxB,UAAA;AAAA,QACA;AAAA,OACF;AAAA,IACF;AAAA,EACF;AAGA,EAAA,MAAM,UAAA,GAAa,IAAI,eAAA,EAAgB;AACvC,EAAA,MAAM,YAAY,UAAA,CAAW,MAAM,UAAA,CAAW,KAAA,IAAS,SAAS,CAAA;AAEhE,EAAA,IAAI;AACF,IAAA,MAAM,QAAA,GAAW,MAAM,KAAA,CAAM,GAAA,EAAK;AAAA,MAChC,QAAQ,UAAA,CAAW;AAAA,KACpB,CAAA;AAED,IAAA,IAAI,CAAC,SAAS,EAAA,EAAI;AAChB,MAAA,MAAM,IAAI,MAAM,CAAA,uBAAA,EAA0B,QAAA,CAAS,MAAM,CAAA,CAAA,EAAI,QAAA,CAAS,UAAU,CAAA,CAAE,CAAA;AAAA,IACpF;AAGA,IAAA,MAAM,aAAA,GAAgB,QAAA,CAAS,OAAA,CAAQ,GAAA,CAAI,gBAAgB,CAAA;AAC3D,IAAA,IAAI,aAAA,EAAe;AACjB,MAAA,MAAM,IAAA,GAAO,QAAA,CAAS,aAAA,EAAe,EAAE,CAAA;AACvC,MAAA,IAAI,OAAO,YAAA,EAAc;AACvB,QAAA,MAAM,IAAI,KAAA;AAAA,UACR,eAAe,WAAA,CAAY,IAAI,CAAC,CAAA,2BAAA,EAA8B,WAAA,CAAY,YAAY,CAAC,CAAA,CAAA;AAAA,SACzF;AAAA,MACF;AAAA,IACF;AAGA,IAAA,MAAM,MAAA,GAAS,QAAA,CAAS,IAAA,EAAM,SAAA,EAAU;AACxC,IAAA,IAAI,CAAC,MAAA,EAAQ;AACX,MAAA,MAAM,IAAI,MAAM,oCAAoC,CAAA;AAAA,IACtD;AAEA,IAAA,MAAM,SAAuB,EAAC;AAC9B,IAAA,IAAI,SAAA,GAAY,CAAA;AAEhB,IAAA,OAAO,IAAA,EAAM;AACX,MAAA,MAAM,EAAE,IAAA,EAAM,KAAA,EAAM,GAAI,MAAM,OAAO,IAAA,EAAK;AAC1C,MAAA,IAAI,IAAA,EAAM;AAEV,MAAA,SAAA,IAAa,KAAA,CAAM,MAAA;AACnB,MAAA,IAAI,YAAY,YAAA,EAAc;AAC5B,QAAA,MAAA,CAAO,MAAA,EAAO;AACd,QAAA,MAAM,IAAI,KAAA;AAAA,UACR,CAAA,oCAAA,EAAuC,WAAA,CAAY,YAAY,CAAC,CAAA,CAAA;AAAA,SAClE;AAAA,MACF;AACA,MAAA,MAAA,CAAO,KAAK,KAAK,CAAA;AAAA,IACnB;AAGA,IAAA,MAAM,MAAA,GAAS,MAAA,CAAO,MAAA,CAAO,MAAA,CAAO,GAAA,CAAI,CAAC,KAAA,KAAU,MAAA,CAAO,IAAA,CAAK,KAAK,CAAC,CAAC,CAAA;AACtE,IAAA,MAAM,UAAA,GAAa,MAAA,CAAO,QAAA,CAAS,QAAQ,CAAA;AAG3C,IAAA,IAAI,QAAA,GAAW,QAAA,CAAS,OAAA,CAAQ,GAAA,CAAI,cAAc,CAAA,IAAK,WAAA;AAGvD,IAAA,IAAI,CAAC,QAAA,CAAS,UAAA,CAAW,QAAQ,CAAA,EAAG;AAElC,MAAA,QAAA,GAAW,4BAA4B,MAAM,CAAA;AAAA,IAC/C;AAEA,IAAA,OAAO;AAAA,MACL,QAAA;AAAA,MACA,UAAA;AAAA,MACA,MAAM,MAAA,CAAO;AAAA,KACf;AAAA,EACF,SAAS,KAAA,EAAY;AACnB,IAAA,IAAI,KAAA,CAAM,SAAS,YAAA,EAAc;AAC/B,MAAA,MAAM,IAAI,KAAA,CAAM,CAAA,4BAAA,EAA+B,SAAS,CAAA,EAAA,CAAI,CAAA;AAAA,IAC9D;AACA,IAAA,MAAM,IAAI,KAAA,CAAM,CAAA,gCAAA,EAAmC,KAAA,CAAM,OAAO,CAAA,CAAE,CAAA;AAAA,EACpE,CAAA,SAAE;AACA,IAAA,YAAA,CAAa,SAAS,CAAA;AAAA,EACxB;AACF;AAKA,SAAS,4BAA4B,MAAA,EAAwB;AAC3D,EAAA,MAAM,QAAQ,MAAA,CAAO,KAAA,CAAM,GAAG,CAAC,CAAA,CAAE,SAAS,KAAK,CAAA;AAE/C,EAAA,IAAI,KAAA,CAAM,UAAA,CAAW,UAAU,CAAA,EAAG,OAAO,WAAA;AACzC,EAAA,IAAI,KAAA,CAAM,UAAA,CAAW,QAAQ,CAAA,EAAG,OAAO,YAAA;AACvC,EAAA,IAAI,KAAA,CAAM,UAAA,CAAW,UAAU,CAAA,EAAG,OAAO,WAAA;AACzC,EAAA,IAAI,KAAA,CAAM,UAAA,CAAW,UAAU,CAAA,EAAG,OAAO,YAAA;AAEzC,EAAA,MAAM,IAAI,MAAM,qCAAqC,CAAA;AACvD;AAqBO,SAAS,oBAAoB,UAAA,EAA4B;AAE9D,EAAA,MAAM,IAAA,GAAO,UAAA,CAAW,QAAA,CAAS,GAAG,CAAA,GAAI,WAAW,KAAA,CAAM,GAAG,CAAA,CAAE,CAAC,CAAA,GAAI,UAAA;AAEnE,EAAA,IAAI,CAAC,IAAA,IAAQ,IAAA,CAAK,MAAA,KAAW,GAAG,OAAO,CAAA;AAGvC,EAAA,IAAI,OAAA,GAAU,CAAA;AACd,EAAA,IAAI,IAAA,CAAK,QAAA,CAAS,IAAI,CAAA,EAAG,OAAA,GAAU,CAAA;AAAA,OAAA,IAC1B,IAAA,CAAK,QAAA,CAAS,GAAG,CAAA,EAAG,OAAA,GAAU,CAAA;AAGvC,EAAA,OAAO,KAAK,KAAA,CAAO,IAAA,CAAK,MAAA,GAAS,CAAA,GAAK,CAAC,CAAA,GAAI,OAAA;AAC7C;AAKA,SAAS,YAAY,KAAA,EAAuB;AAC1C,EAAA,IAAI,KAAA,GAAQ,IAAA,EAAM,OAAO,CAAA,EAAG,KAAK,CAAA,MAAA,CAAA;AACjC,EAAA,IAAI,KAAA,GAAQ,OAAO,IAAA,EAAM,OAAO,IAAI,KAAA,GAAQ,IAAA,EAAM,OAAA,CAAQ,CAAC,CAAC,CAAA,GAAA,CAAA;AAC5D,EAAA,OAAO,IAAI,KAAA,IAAS,IAAA,GAAO,IAAA,CAAA,EAAO,OAAA,CAAQ,CAAC,CAAC,CAAA,GAAA,CAAA;AAC9C;;;ACzJO,IAAM,kBAAN,MAAsB;AAAA;AAAA,EAEnB,eAAA,uBAA2C,GAAA,EAAI;AAAA;AAAA,EAE/C,iBAAA,uBAA6C,GAAA,EAAI;AAAA;AAAA;AAAA;AAAA,EAKzD,MAAM,eAAe,OAAA,EAA4C;AAE/D,IAAA,IAAI,QAAQ,GAAA,CAAI,YAAA,IAAgB,MAAM,OAAA,CAAQ,OAAA,CAAQ,KAAK,CAAA,EAAG;AAC5D,MAAA,OAAA,CAAQ,KAAA,CAAM,2BAA2B,IAAA,CAAK,SAAA,CAAU,QAAQ,KAAA,CAAM,GAAA,CAAI,CAAC,GAAA,MAAc;AAAA,QACvF,MAAM,GAAA,CAAI,IAAA;AAAA,QACV,MAAM,GAAA,CAAI,IAAA;AAAA,QACV,cAAc,GAAA,CAAI,OAAA,EAAS,IAAI,CAAC,CAAA,KAAW,EAAE,IAAI;AAAA,OACnD,CAAE,CAAA,EAAG,IAAA,EAAM,CAAC,CAAC,CAAA;AAAA,IACf;AAEA,IAAA,MAAM,QAAA,GAAW,MAAM,IAAA,CAAK,eAAA,CAAgB,QAAQ,KAAK,CAAA;AACzD,IAAA,MAAM,KAAA,GAAQ,IAAA,CAAK,YAAA,CAAa,OAAA,CAAQ,KAAK,CAAA;AAG7C,IAAA,IAAI,OAAA,CAAQ,IAAI,YAAA,EAAc;AAC5B,MAAA,OAAA,CAAQ,KAAA,CAAM,sCAAA,EAAwC,QAAA,CAAS,MAAM,CAAA;AAAA,IACvE;AAEA,IAAA,MAAM,OAAA,GAAe;AAAA,MACnB;AAAA,KACF;AAGA,IAAA,IAAI,QAAQ,YAAA,EAAc;AACxB,MAAA,OAAA,CAAQ,iBAAA,GAAoB,EAAE,KAAA,EAAO,CAAC,EAAE,IAAA,EAAM,OAAA,CAAQ,YAAA,EAAc,CAAA,EAAE;AAAA,IACxE;AAGA,IAAA,IAAI,KAAA,IAAS,KAAA,CAAM,MAAA,GAAS,CAAA,EAAG;AAC7B,MAAA,OAAA,CAAQ,KAAA,GAAQ,CAAC,EAAE,oBAAA,EAAsB,OAAO,CAAA;AAGhD,MAAA,OAAA,CAAQ,UAAA,GAAa;AAAA,QACnB,qBAAA,EAAuB;AAAA,UACrB,IAAA,EAAM,OAAA,CAAQ,WAAA,KAAgB,UAAA,GAAa,KAAA,GAAQ;AAAA;AACrD,OACF;AAAA,IACF;AAGA,IAAA,OAAA,CAAQ,gBAAA,GAAmB;AAAA,MACzB,aAAa,OAAA,CAAQ,WAAA;AAAA,MACrB,iBAAiB,OAAA,CAAQ;AAAA,KAC3B;AAGA,IAAA,IAAI,OAAA,CAAQ,eAAe,aAAA,EAAe;AACxC,MAAA,OAAA,CAAQ,iBAAiB,cAAA,GAAiB;AAAA,QACxC,aAAA,EAAe,QAAQ,aAAA,CAAc;AAAA,OACvC;AAAA,IACF;AAIA,IAAA,IAAI,KAAA,IAAS,KAAA,CAAM,MAAA,GAAS,CAAA,EAAG;AAC7B,MAAA,OAAA,CAAQ,iBAAiB,kBAAA,GAAqB,KAAA;AAAA,IAChD;AAGA,IAAA,IAAI,QAAQ,eAAA,EAAiB;AAC3B,MAAA,IAAI,OAAA,CAAQ,eAAA,CAAgB,IAAA,KAAS,aAAA,EAAe;AAClD,QAAA,OAAA,CAAQ,iBAAiB,gBAAA,GAAmB,kBAAA;AAAA,MAC9C,CAAA,MAAA,IAAW,OAAA,CAAQ,eAAA,CAAgB,IAAA,KAAS,aAAA,EAAe;AACzD,QAAA,OAAA,CAAQ,iBAAiB,gBAAA,GAAmB,kBAAA;AAAA,MAE9C;AAAA,IACF;AAEA,IAAA,OAAO,OAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,gBAAgB,KAAA,EAAuD;AACnF,IAAA,IAAI,OAAO,UAAU,QAAA,EAAU;AAC7B,MAAA,OAAO;AAAA,QACL;AAAA,UACE,IAAA,EAAM,MAAA;AAAA,UACN,KAAA,EAAO,CAAC,EAAE,IAAA,EAAM,OAAO;AAAA;AACzB,OACF;AAAA,IACF;AAEA,IAAA,MAAM,WAA4B,EAAC;AAEnC,IAAA,KAAA,MAAW,QAAQ,KAAA,EAAO;AACxB,MAAA,IAAI,IAAA,CAAK,SAAS,SAAA,EAAW;AAE3B,QAAA,MAAM,IAAA,GAAO,IAAA,CAAK,IAAA,KAAA,MAAA,eAA6B,IAAA,CAAK,uCAAiC,MAAA,GAAS,OAAA;AAG9F,QAAA,MAAM,KAAA,GAAQ,MAAM,IAAA,CAAK,qBAAA,CAAsB,KAAK,OAAO,CAAA;AAG3D,QAAA,IAAI,OAAA,CAAQ,IAAI,YAAA,EAAc;AAC5B,UAAA,OAAA,CAAQ,KAAA;AAAA,YAAM,sCAAsC,IAAA,CAAK,IAAI,WAAM,IAAI,CAAA,SAAA,EAAY,MAAM,MAAM,CAAA,CAAA;AAAA,YAC7F,MAAM,GAAA,CAAI,CAAC,MAAW,MAAA,CAAO,IAAA,CAAK,CAAC,CAAC;AAAA,WAAC;AAAA,QACzC;AAEA,QAAA,IAAI,KAAA,CAAM,SAAS,CAAA,EAAG;AACpB,UAAA,QAAA,CAAS,IAAA,CAAK;AAAA,YACZ,IAAA;AAAA,YACA;AAAA,WACD,CAAA;AAAA,QACH;AAAA,MACF;AAAA,IACF;AAEA,IAAA,OAAO,QAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,sBAAsB,OAAA,EAAqC;AACvE,IAAA,MAAM,QAAgB,EAAC;AAEvB,IAAA,KAAA,MAAW,KAAK,OAAA,EAAS;AACvB,MAAA,QAAQ,EAAE,IAAA;AAAM,QACd,KAAA,YAAA;AAAA,QACA,KAAA,aAAA;AACE,UAAA,KAAA,CAAM,IAAA,CAAK,EAAE,IAAA,EAAM,CAAA,CAAE,MAAM,CAAA;AAC3B,UAAA;AAAA,QAEF,KAAA,iBAAA;AAEE,UAAA,IAAI;AACF,YAAA,MAAM,SAAA,GAAY,MAAM,kBAAA,CAAmB,CAAA,CAAE,UAAU,GAAG,CAAA;AAC1D,YAAA,KAAA,CAAM,IAAA,CAAK;AAAA,cACT,UAAA,EAAY;AAAA,gBACV,UAAU,SAAA,CAAU,QAAA;AAAA,gBACpB,MAAM,SAAA,CAAU;AAAA;AAClB,aACD,CAAA;AAAA,UACH,SAAS,KAAA,EAAY;AAEnB,YAAA,OAAA,CAAQ,KAAA,CAAM,CAAA,uBAAA,EAA0B,KAAA,CAAM,OAAO,CAAA,CAAE,CAAA;AACvD,YAAA,KAAA,CAAM,IAAA,CAAK;AAAA,cACT,IAAA,EAAM,CAAA,kCAAA,EAAqC,CAAA,CAAE,SAAA,CAAU,GAAG,CAAA,CAAA;AAAA,aAC3D,CAAA;AAAA,UACH;AACA,UAAA;AAAA,QAEF,KAAA,UAAA;AAEE,UAAA,IAAA,CAAK,eAAA,CAAgB,GAAA,CAAI,CAAA,CAAE,EAAA,EAAI,EAAE,IAAI,CAAA;AAGrC,UAAA,IAAI,UAAA;AACJ,UAAA,IAAI;AACF,YAAA,UAAA,GAAa,IAAA,CAAK,KAAA,CAAM,CAAA,CAAE,SAAS,CAAA;AAAA,UACrC,SAAS,UAAA,EAAY;AACnB,YAAA,MAAM,IAAI,yBAAA;AAAA,cACR,CAAA,CAAE,IAAA;AAAA,cACF,CAAA,CAAE,SAAA;AAAA,cACF,sBAAsB,KAAA,GAAQ,UAAA,GAAa,IAAI,KAAA,CAAM,MAAA,CAAO,UAAU,CAAC;AAAA,aACzE;AAAA,UACF;AAGA,UAAA,MAAM,gBAAA,GAAwB;AAAA,YAC5B,YAAA,EAAc;AAAA,cACZ,MAAM,CAAA,CAAE,IAAA;AAAA,cACR,IAAA,EAAM;AAAA;AACR,WACF;AAGA,UAAA,MAAM,SAAA,GAAY,IAAA,CAAK,iBAAA,CAAkB,GAAA,CAAI,EAAE,EAAE,CAAA;AAEjD,UAAA,IAAI,OAAA,CAAQ,IAAI,YAAA,EAAc;AAC5B,YAAA,OAAA,CAAQ,KAAA,CAAM,CAAA,0CAAA,EAA6C,CAAA,CAAE,EAAE,CAAA,CAAE,CAAA;AACjE,YAAA,OAAA,CAAQ,KAAA,CAAM,CAAA,wBAAA,CAAA,EAA4B,SAAA,GAAY,KAAA,GAAQ,IAAI,CAAA;AAClE,YAAA,OAAA,CAAQ,KAAA,CAAM,iCAAiC,KAAA,CAAM,IAAA,CAAK,KAAK,iBAAA,CAAkB,IAAA,EAAM,CAAC,CAAA;AAAA,UAC1F;AAEA,UAAA,IAAI,SAAA,EAAW;AACb,YAAA,gBAAA,CAAiB,gBAAA,GAAmB,SAAA;AAAA,UACtC;AAEA,UAAA,KAAA,CAAM,KAAK,gBAAgB,CAAA;AAC3B,UAAA;AAAA,QAEF,KAAA,aAAA;AAEE,UAAA,MAAM,YAAA,GAAe,IAAA,CAAK,eAAA,CAAgB,GAAA,CAAI,CAAA,CAAE,WAAW,CAAA,IAAK,IAAA,CAAK,eAAA,CAAgB,CAAA,CAAE,WAAW,CAAA;AAElG,UAAA,KAAA,CAAM,IAAA,CAAK;AAAA,YACT,gBAAA,EAAkB;AAAA,cAChB,IAAA,EAAM,YAAA;AAAA;AAAA,cACN,QAAA,EAAU;AAAA,gBACR,QAAQ,OAAO,CAAA,CAAE,YAAY,QAAA,GAAW,CAAA,CAAE,UAAU,CAAA,CAAE;AAAA;AACxD;AACF,WACD,CAAA;AACD,UAAA;AAAA;AACJ,IACF;AAEA,IAAA,OAAO,KAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKQ,aAAa,KAAA,EAAmD;AACtE,IAAA,IAAI,CAAC,KAAA,IAAS,KAAA,CAAM,MAAA,KAAW,CAAA,EAAG;AAChC,MAAA,OAAO,MAAA;AAAA,IACT;AAGA,IAAA,MAAM,aAAA,GAAgB,6BAA6B,KAAK,CAAA;AACxD,IAAA,OAAO,aAAA,CAAc,GAAA,CAAI,CAAC,IAAA,MAAU;AAAA,MAClC,MAAM,IAAA,CAAK,IAAA;AAAA,MACX,aAAa,IAAA,CAAK,WAAA;AAAA,MAClB,UAAA,EAAY,IAAA,CAAK,uBAAA,CAAwB,IAAA,CAAK,UAAU;AAAA,KAC1D,CAAE,CAAA;AAAA,EACJ;AAAA;AAAA;AAAA;AAAA,EAKQ,wBAAwB,MAAA,EAAkB;AAChD,IAAA,IAAI,CAAC,QAAQ,OAAO,MAAA;AAEpB,IAAA,MAAM,SAAA,GAAiB;AAAA,MACrB,IAAA,EAAM,QAAA;AAAA;AAAA,MACN,YAAY;AAAC,KACf;AAGA,IAAA,IAAI,OAAO,UAAA,EAAY;AACrB,MAAA,KAAA,MAAW,CAAC,KAAK,KAAK,CAAA,IAAK,OAAO,OAAA,CAAQ,MAAA,CAAO,UAAU,CAAA,EAAG;AAC5D,QAAA,MAAM,IAAA,GAAO,KAAA;AACb,QAAA,SAAA,CAAU,UAAA,CAAW,GAAG,CAAA,GAAI;AAAA,UAC1B,IAAA,EAAM,IAAA,CAAK,IAAA,EAAM,WAAA,EAAY,IAAK,QAAA;AAAA,UAClC,aAAa,IAAA,CAAK;AAAA,SACpB;AAGA,QAAA,IAAI,KAAK,IAAA,EAAM;AACb,UAAA,SAAA,CAAU,UAAA,CAAW,GAAG,CAAA,CAAE,IAAA,GAAO,IAAA,CAAK,IAAA;AAAA,QACxC;AAGA,QAAA,IAAI,IAAA,CAAK,IAAA,KAAS,QAAA,IAAY,IAAA,CAAK,UAAA,EAAY;AAC7C,UAAA,SAAA,CAAU,UAAA,CAAW,GAAG,CAAA,GAAI,IAAA,CAAK,wBAAwB,IAAI,CAAA;AAAA,QAC/D;AACA,QAAA,IAAI,IAAA,CAAK,IAAA,KAAS,OAAA,IAAW,IAAA,CAAK,KAAA,EAAO;AACvC,UAAA,SAAA,CAAU,WAAW,GAAG,CAAA,CAAE,QAAQ,IAAA,CAAK,uBAAA,CAAwB,KAAK,KAAK,CAAA;AAAA,QAC3E;AAAA,MACF;AAAA,IACF;AAGA,IAAA,IAAI,OAAO,QAAA,EAAU;AACnB,MAAA,SAAA,CAAU,WAAW,MAAA,CAAO,QAAA;AAAA,IAC9B;AAEA,IAAA,OAAO,SAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,gBAAgB,QAAA,EAA4B;AAC1C,IAAA,MAAM,SAAA,GAAY,QAAA,CAAS,UAAA,GAAa,CAAC,CAAA;AACzC,IAAA,MAAM,gBAAgB,SAAA,EAAW,OAAA;AAGjC,IAAA,MAAM,UAAU,IAAA,CAAK,2BAAA,CAA4B,aAAA,EAAe,KAAA,IAAS,EAAE,CAAA;AAG3E,IAAA,IAAI,OAAA,CAAQ,IAAI,YAAA,EAAc;AAC5B,MAAA,OAAA,CAAQ,MAAM,wBAAA,EAA0B,IAAA,CAAK,UAAU,OAAA,EAAS,IAAA,EAAM,CAAC,CAAC,CAAA;AACxE,MAAA,OAAA,CAAQ,KAAA,CAAM,sBAAsB,IAAA,CAAK,SAAA,CAAU,eAAe,KAAA,EAAO,IAAA,EAAM,CAAC,CAAC,CAAA;AAAA,IACnF;AAEA,IAAA,OAAO,gBAAA,CAAiB;AAAA,MACtB,QAAA,EAAU,QAAA;AAAA,MACV,KAAA,EAAO,SAAS,YAAA,IAAgB,QAAA;AAAA,MAChC,MAAA,EAAQ,eAAA,CAAgB,SAAA,EAAW,YAAY,CAAA;AAAA,MAC/C,OAAA;AAAA,MACA,WAAW,QAAA,CAAS,EAAA;AAAA,MACpB,KAAA,EAAO;AAAA,QACL,WAAA,EAAa,QAAA,CAAS,aAAA,EAAe,gBAAA,IAAoB,CAAA;AAAA,QACzD,YAAA,EAAc,QAAA,CAAS,aAAA,EAAe,oBAAA,IAAwB,CAAA;AAAA,QAC9D,WAAA,EAAa,QAAA,CAAS,aAAA,EAAe,eAAA,IAAmB;AAAA;AAC1D,KACD,CAAA;AAAA,EACH;AAAA;AAAA;AAAA;AAAA,EAKQ,4BAA4B,KAAA,EAA0B;AAC5D,IAAA,MAAM,UAAqB,EAAC;AAE5B,IAAA,KAAA,MAAW,QAAQ,KAAA,EAAO;AACxB,MAAA,IAAI,MAAA,IAAU,IAAA,IAAQ,IAAA,CAAK,IAAA,EAAM;AAC/B,QAAA,OAAA,CAAQ,IAAA,CAAK,iBAAA,CAAkB,IAAA,CAAK,IAAI,CAAC,CAAA;AAAA,MAC3C,CAAA,MAAA,IAAW,cAAA,IAAkB,IAAA,IAAQ,IAAA,CAAK,YAAA,EAAc;AACtD,QAAA,MAAM,MAAA,GAAS,mBAAmB,QAAQ,CAAA;AAC1C,QAAA,MAAM,YAAA,GAAe,IAAA,CAAK,YAAA,CAAa,IAAA,IAAQ,EAAA;AAG/C,QAAA,IAAI,kBAAA,IAAsB,IAAA,IAAQ,IAAA,CAAK,gBAAA,EAAkB;AACvD,UAAA,MAAM,MAAM,IAAA,CAAK,gBAAA;AACjB,UAAA,IAAA,CAAK,iBAAA,CAAkB,GAAA,CAAI,MAAA,EAAQ,GAAG,CAAA;AAEtC,UAAA,IAAI,OAAA,CAAQ,IAAI,YAAA,EAAc;AAC5B,YAAA,OAAA,CAAQ,KAAA,CAAM,CAAA,gDAAA,EAAmD,MAAM,CAAA,CAAE,CAAA;AACzE,YAAA,OAAA,CAAQ,KAAA,CAAM,CAAA,yBAAA,CAAA,EAA6B,GAAA,CAAI,MAAM,CAAA;AAAA,UACvD;AAAA,QACF,CAAA,MAAA,IAAW,OAAA,CAAQ,GAAA,CAAI,YAAA,EAAc;AACnC,UAAA,OAAA,CAAQ,KAAA,CAAM,CAAA,yCAAA,EAA4C,YAAY,CAAA,CAAE,CAAA;AACxE,UAAA,OAAA,CAAQ,KAAA,CAAM,CAAA,kBAAA,CAAA,EAAsB,MAAA,CAAO,IAAA,CAAK,IAAI,CAAC,CAAA;AAAA,QACvD;AAEA,QAAA,OAAA,CAAQ,IAAA,CAAK,qBAAqB,MAAA,EAAQ,YAAA,EAAc,KAAK,YAAA,CAAa,IAAA,IAAQ,EAAE,CAAC,CAAA;AAAA,MACvF;AAAA,IACF;AAEA,IAAA,OAAO,OAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKQ,gBAAgB,SAAA,EAA2B;AACjD,IAAA,MAAM,IAAA,GAAO,IAAA,CAAK,eAAA,CAAgB,GAAA,CAAI,SAAS,CAAA;AAC/C,IAAA,IAAI,IAAA,EAAM;AACR,MAAA,OAAO,IAAA;AAAA,IACT;AAEA,IAAA,OAAA,CAAQ,IAAA,CAAK,CAAA,8CAAA,EAAiD,SAAS,CAAA,CAAE,CAAA;AACzE,IAAA,OAAO,cAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,aAAA,GAAsB;AACpB,IAAA,IAAA,CAAK,gBAAgB,KAAA,EAAM;AAC3B,IAAA,IAAA,CAAK,kBAAkB,KAAA,EAAM;AAAA,EAC/B;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,KAAA,GAAc;AACZ,IAAA,IAAA,CAAK,aAAA,EAAc;AAAA,EACrB;AACF,CAAA;AC7XO,IAAM,wBAAN,MAA4B;AAAA,EACzB,UAAA,GAAqB,EAAA;AAAA,EACrB,KAAA,GAAgB,EAAA;AAAA,EAChB,cAAA,GAAyB,CAAA;AAAA,EACzB,OAAA,GAAmB,IAAA;AAAA,EACnB,eAAA,uBAAmE,GAAA,EAAI;AAAA;AAAA;AAAA;AAAA,EAK/E,OAAO,aAAA,CACL,YAAA,EACA,KAAA,EACoC;AACpC,IAAA,IAAA,CAAK,KAAA,GAAQ,KAAA;AACb,IAAA,IAAA,CAAK,cAAA,GAAiB,CAAA;AACtB,IAAA,IAAA,CAAK,OAAA,GAAU,IAAA;AACf,IAAA,IAAA,CAAK,gBAAgB,KAAA,EAAM;AAE3B,IAAA,IAAI,SAAA,GAAmF;AAAA,MACrF,YAAA,EAAc,CAAA;AAAA,MACd,aAAA,EAAe,CAAA;AAAA,MACf,YAAA,EAAc;AAAA,KAChB;AAEA,IAAA,WAAA,MAAiB,SAAS,YAAA,EAAc;AACtC,MAAA,IAAI,KAAK,OAAA,EAAS;AAChB,QAAA,IAAA,CAAK,UAAA,GAAa,KAAK,kBAAA,EAAmB;AAC1C,QAAA,MAAM;AAAA,UACJ,IAAA,EAAA,kBAAA;AAAA,UACA,aAAa,IAAA,CAAK,UAAA;AAAA,UAClB,OAAO,IAAA,CAAK,KAAA;AAAA,UACZ,UAAA,EAAY,KAAK,GAAA;AAAI,SACvB;AACA,QAAA,IAAA,CAAK,OAAA,GAAU,KAAA;AAAA,MACjB;AAGA,MAAA,MAAM,KAAA,GAAQ,IAAA,CAAK,YAAA,CAAa,KAAK,CAAA;AACrC,MAAA,IAAI,KAAA,EAAO;AACT,QAAA,SAAA,GAAY,KAAA;AAAA,MACd;AAEA,MAAA,MAAM,MAAA,GAAS,IAAA,CAAK,YAAA,CAAa,KAAK,CAAA;AACtC,MAAA,KAAA,MAAW,SAAS,MAAA,EAAQ;AAC1B,QAAA,MAAM,KAAA;AAAA,MACR;AAAA,IACF;AAGA,IAAA,IAAI,IAAA,CAAK,eAAA,CAAgB,IAAA,GAAO,CAAA,EAAG;AACjC,MAAA,KAAA,MAAW,CAAC,UAAA,EAAY,MAAM,CAAA,IAAK,KAAK,eAAA,EAAiB;AACvD,QAAA,MAAM;AAAA,UACJ,IAAA,EAAA,mCAAA;AAAA,UACA,aAAa,IAAA,CAAK,UAAA;AAAA,UAClB,YAAA,EAAc,UAAA;AAAA,UACd,WAAW,MAAA,CAAO,IAAA;AAAA,UAClB,WAAW,MAAA,CAAO;AAAA,SACpB;AAAA,MACF;AAAA,IACF;AAGA,IAAA,MAAM;AAAA,MACJ,IAAA,EAAA,mBAAA;AAAA,MACA,aAAa,IAAA,CAAK,UAAA;AAAA,MAClB,MAAA,EAAQ,WAAA;AAAA,MACR,KAAA,EAAO,SAAA;AAAA,MACP,UAAA,EAAY;AAAA,KACd;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,aAAa,KAAA,EAA8G;AACjI,IAAA,MAAM,QAAQ,KAAA,CAAM,aAAA;AACpB,IAAA,IAAI,CAAC,OAAO,OAAO,IAAA;AAEnB,IAAA,OAAO;AAAA,MACL,YAAA,EAAc,MAAM,gBAAA,IAAoB,CAAA;AAAA,MACxC,aAAA,EAAe,MAAM,oBAAA,IAAwB,CAAA;AAAA,MAC7C,YAAA,EAAc,MAAM,eAAA,IAAmB;AAAA,KACzC;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,aAAa,KAAA,EAA+C;AAClE,IAAA,MAAM,SAAwB,EAAC;AAE/B,IAAA,MAAM,SAAA,GAAY,KAAA,CAAM,UAAA,GAAa,CAAC,CAAA;AACtC,IAAA,IAAI,CAAC,SAAA,EAAW,OAAA,EAAS,KAAA,EAAO,OAAO,MAAA;AAEvC,IAAA,KAAA,MAAW,IAAA,IAAQ,SAAA,CAAU,OAAA,CAAQ,KAAA,EAAO;AAC1C,MAAA,IAAI,KAAK,IAAA,EAAM;AAEb,QAAA,MAAA,CAAO,IAAA,CAAK;AAAA,UACV,IAAA,EAAA,4BAAA;AAAA,UACA,aAAa,IAAA,CAAK,UAAA;AAAA,UAClB,OAAA,EAAS,CAAA,IAAA,EAAO,IAAA,CAAK,UAAU,CAAA,CAAA;AAAA,UAC/B,YAAA,EAAc,CAAA;AAAA,UACd,aAAA,EAAe,CAAA;AAAA,UACf,OAAO,IAAA,CAAK,IAAA;AAAA,UACZ,iBAAiB,IAAA,CAAK,cAAA;AAAA,SACvB,CAAA;AAAA,MACH,CAAA,MAAA,IAAW,KAAK,YAAA,EAAc;AAE5B,QAAA,MAAM,eAAe,IAAA,CAAK,YAAA;AAC1B,QAAA,MAAM,QAAA,GAAW,aAAa,IAAA,IAAQ,SAAA;AACtC,QAAA,MAAM,UAAA,GAAa,CAAA,KAAA,EAAQ,IAAA,CAAK,UAAU,IAAI,QAAQ,CAAA,CAAA;AAGtD,QAAA,IAAI,CAAC,IAAA,CAAK,eAAA,CAAgB,GAAA,CAAI,UAAU,CAAA,EAAG;AACzC,UAAA,IAAA,CAAK,eAAA,CAAgB,IAAI,UAAA,EAAY;AAAA,YACnC,IAAA,EAAM,QAAA;AAAA,YACN,IAAA,EAAM;AAAA,WACP,CAAA;AAED,UAAA,MAAA,CAAO,IAAA,CAAK;AAAA,YACV,IAAA,EAAA,0BAAA;AAAA,YACA,aAAa,IAAA,CAAK,UAAA;AAAA,YAClB,OAAA,EAAS,CAAA,IAAA,EAAO,IAAA,CAAK,UAAU,CAAA,CAAA;AAAA,YAC/B,YAAA,EAAc,UAAA;AAAA,YACd,SAAA,EAAW;AAAA,WACZ,CAAA;AAAA,QACH;AAGA,QAAA,IAAI,aAAa,IAAA,EAAM;AACrB,UAAA,MAAM,QAAA,GAAW,IAAA,CAAK,SAAA,CAAU,YAAA,CAAa,IAAI,CAAA;AACjD,UAAA,MAAM,MAAA,GAAS,IAAA,CAAK,eAAA,CAAgB,GAAA,CAAI,UAAU,CAAA;AAGlD,UAAA,IAAI,QAAA,KAAa,OAAO,IAAA,EAAM;AAC5B,YAAA,MAAM,KAAA,GAAQ,QAAA,CAAS,KAAA,CAAM,MAAA,CAAO,KAAK,MAAM,CAAA;AAC/C,YAAA,MAAA,CAAO,IAAA,GAAO,QAAA;AAEd,YAAA,IAAI,KAAA,EAAO;AACT,cAAA,MAAA,CAAO,IAAA,CAAK;AAAA,gBACV,IAAA,EAAA,oCAAA;AAAA,gBACA,aAAa,IAAA,CAAK,UAAA;AAAA,gBAClB,OAAA,EAAS,CAAA,IAAA,EAAO,IAAA,CAAK,UAAU,CAAA,CAAA;AAAA,gBAC/B,YAAA,EAAc,UAAA;AAAA,gBACd,SAAA,EAAW,QAAA;AAAA,gBACX,KAAA;AAAA,gBACA,iBAAiB,IAAA,CAAK,cAAA;AAAA,eACvB,CAAA;AAAA,YACH;AAAA,UACF;AAAA,QACF;AAAA,MACF;AAAA,IACF;AAEA,IAAA,OAAO,MAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKQ,kBAAA,GAA6B;AACnC,IAAA,OAAO,CAAA,YAAA,EAAeC,YAAY,CAAA,CAAA;AAAA,EACpC;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,KAAA,GAAc;AACZ,IAAA,IAAA,CAAK,UAAA,GAAa,EAAA;AAClB,IAAA,IAAA,CAAK,KAAA,GAAQ,EAAA;AACb,IAAA,IAAA,CAAK,cAAA,GAAiB,CAAA;AACtB,IAAA,IAAA,CAAK,OAAA,GAAU,IAAA;AACf,IAAA,IAAA,CAAK,gBAAgB,KAAA,EAAM;AAAA,EAC7B;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,KAAA,GAAc;AACZ,IAAA,IAAA,CAAK,KAAA,EAAM;AAAA,EACb;AACF,CAAA;;;AChLO,IAAM,kBAAA,GAAN,cAAiC,gBAAA,CAAiB;AAAA,EAC9C,IAAA,GAAO,QAAA;AAAA,EACP,YAAA,GAAqC;AAAA,IAC5C,IAAA,EAAM,IAAA;AAAA,IACN,MAAA,EAAQ,IAAA;AAAA;AAAA,IACR,MAAA,EAAQ,KAAA;AAAA,IACR,KAAA,EAAO;AAAA,GACT;AAAA,EAEQ,MAAA;AAAA,EACA,SAAA;AAAA,EACA,eAAA;AAAA,EAER,YAAY,MAAA,EAAsB;AAChC,IAAA,KAAA,CAAM,MAAM,CAAA;AAGZ,IAAA,IAAA,CAAK,MAAA,GAAS,IAAI,WAAA,CAAY;AAAA,MAC5B,MAAA,EAAQ,KAAK,SAAA;AAAU,KACxB,CAAA;AACD,IAAA,IAAA,CAAK,SAAA,GAAY,IAAI,eAAA,EAAgB;AACrC,IAAA,IAAA,CAAK,eAAA,GAAkB,IAAI,qBAAA,EAAsB;AAAA,EACnD;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,SAAS,OAAA,EAAoD;AACjE,IAAA,OAAO,IAAA,CAAK,0BAA0B,YAAY;AAChD,MAAA,IAAI;AAEF,QAAA,MAAM,aAAA,GAAgB,MAAM,IAAA,CAAK,SAAA,CAAU,eAAe,OAAO,CAAA;AAGjE,QAAA,IAAI,OAAA,CAAQ,IAAI,YAAA,EAAc;AAC5B,UAAA,OAAA,CAAQ,KAAA,CAAM,yBAAA,EAA2B,IAAA,CAAK,SAAA,CAAU;AAAA,YACtD,OAAO,OAAA,CAAQ,KAAA;AAAA,YACf,OAAO,aAAA,CAAc,KAAA;AAAA,YACrB,YAAY,aAAA,CAAc,UAAA;AAAA,YAC1B,kBAAkB,aAAA,CAAc,gBAAA;AAAA,YAChC,QAAA,EAAU,aAAA,CAAc,QAAA,EAAU,KAAA,CAAM,GAAG,CAAC;AAAA;AAAA,WAC9C,EAAG,IAAA,EAAM,CAAC,CAAC,CAAA;AAAA,QACb;AAIA,QAAA,MAAM,MAAA,GAAS,MAAM,IAAA,CAAK,MAAA,CAAO,OAAO,eAAA,CAAgB;AAAA,UACtD,OAAO,OAAA,CAAQ,KAAA;AAAA,UACf,UAAU,aAAA,CAAc,QAAA;AAAA,UACxB,MAAA,EAAQ;AAAA,YACN,mBAAmB,aAAA,CAAc,iBAAA;AAAA,YACjC,OAAO,aAAA,CAAc,KAAA;AAAA,YACrB,YAAY,aAAA,CAAc,UAAA;AAAA,YAC1B,GAAG,aAAA,CAAc;AAAA;AACnB,SACD,CAAA;AAGD,QAAA,IAAI,OAAA,CAAQ,IAAI,YAAA,EAAc;AAC5B,UAAA,OAAA,CAAQ,KAAA,CAAM,0BAAA,EAA4B,IAAA,CAAK,SAAA,CAAU;AAAA,YACvD,UAAA,EAAY,MAAA,CAAO,UAAA,EAAY,GAAA,CAAI,CAAC,CAAA,MAAY;AAAA,cAC9C,cAAc,CAAA,CAAE,YAAA;AAAA,cAChB,SAAS,CAAA,CAAE;AAAA,aACb,CAAE,CAAA;AAAA,YACF,eAAe,MAAA,CAAO;AAAA,WACxB,EAAG,IAAA,EAAM,CAAC,CAAC,CAAA;AAAA,QACb;AAGA,QAAA,MAAM,QAAA,GAAW,IAAA,CAAK,SAAA,CAAU,eAAA,CAAgB,MAAM,CAAA;AAEtD,QAAA,OAAO,QAAA;AAAA,MACT,SAAS,KAAA,EAAY;AACnB,QAAA,IAAA,CAAK,YAAY,KAAK,CAAA;AACtB,QAAA,MAAM,KAAA;AAAA,MACR,CAAA,SAAE;AAGA,QAAA,IAAA,CAAK,UAAU,aAAA,EAAc;AAAA,MAC/B;AAAA,IACF,CAAA,EAAG,QAAQ,KAAK,CAAA;AAAA,EAClB;AAAA;AAAA;AAAA;AAAA,EAKA,OAAO,eAAe,OAAA,EAAkE;AACtF,IAAA,IAAI;AAEF,MAAA,MAAM,aAAA,GAAgB,MAAM,IAAA,CAAK,SAAA,CAAU,eAAe,OAAO,CAAA;AAIjE,MAAA,MAAM,MAAA,GAAS,MAAM,IAAA,CAAK,MAAA,CAAO,OAAO,qBAAA,CAAsB;AAAA,QAC5D,OAAO,OAAA,CAAQ,KAAA;AAAA,QACf,UAAU,aAAA,CAAc,QAAA;AAAA,QACxB,MAAA,EAAQ;AAAA,UACN,mBAAmB,aAAA,CAAc,iBAAA;AAAA,UACjC,OAAO,aAAA,CAAc,KAAA;AAAA,UACrB,YAAY,aAAA,CAAc,UAAA;AAAA,UAC1B,GAAG,aAAA,CAAc;AAAA;AACnB,OACD,CAAA;AAGD,MAAA,IAAA,CAAK,gBAAgB,KAAA,EAAM;AAG3B,MAAA,OAAO,IAAA,CAAK,eAAA,CAAgB,aAAA,CAAc,MAAA,EAAQ,QAAQ,KAAK,CAAA;AAAA,IACjE,SAAS,KAAA,EAAY;AACnB,MAAA,IAAA,CAAK,YAAY,KAAK,CAAA;AACtB,MAAA,MAAM,KAAA;AAAA,IACR,CAAA,SAAE;AAGA,MAAA,IAAA,CAAK,UAAU,aAAA,EAAc;AAC7B,MAAA,IAAA,CAAK,gBAAgB,KAAA,EAAM;AAAA,IAC7B;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,qBAAqB,KAAA,EAAkC;AAErD,IAAA,IACE,KAAA,CAAM,SAAS,UAAU,CAAA,IACzB,MAAM,QAAA,CAAS,YAAY,CAAA,IAC3B,KAAA,CAAM,QAAA,CAAS,YAAY,KAC3B,KAAA,CAAM,QAAA,CAAS,YAAY,CAAA,IAC3B,KAAA,CAAM,QAAA,CAAS,YAAY,CAAA,IAC3B,KAAA,CAAM,QAAA,CAAS,cAAc,CAAA,EAC7B;AACA,MAAA,OAAO;AAAA,QACL,aAAA,EAAe,IAAA;AAAA,QACf,cAAA,EAAgB,IAAA;AAAA,QAChB,YAAA,EAAc,IAAA;AAAA,QACd,kBAAA,EAAoB,KAAA;AAAA,QACpB,SAAA,EAAW,OAAA;AAAA;AAAA,QACX,eAAA,EAAiB;AAAA,OACnB;AAAA,IACF;AAGA,IAAA,OAAO;AAAA,MACL,aAAA,EAAe,IAAA;AAAA,MACf,cAAA,EAAgB,IAAA;AAAA,MAChB,YAAA,EAAc,IAAA;AAAA,MACd,kBAAA,EAAoB,KAAA;AAAA,MACpB,SAAA,EAAW,OAAA;AAAA,MACX,eAAA,EAAiB;AAAA,KACnB;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,YAAY,KAAA,EAAmB;AACrC,IAAA,MAAM,YAAA,GAAe,MAAM,OAAA,IAAW,EAAA;AAEtC,IAAA,IAAI,MAAM,MAAA,KAAW,GAAA,IAAO,YAAA,CAAa,QAAA,CAAS,mBAAmB,CAAA,EAAG;AACtE,MAAA,MAAM,IAAI,iBAAA,CAAkB,QAAA,EAAU,iBAAiB,CAAA;AAAA,IACzD;AAEA,IAAA,IAAI,MAAM,MAAA,KAAW,GAAA,IAAO,YAAA,CAAa,QAAA,CAAS,oBAAoB,CAAA,EAAG;AACvE,MAAA,MAAM,IAAI,uBAAuB,QAAQ,CAAA;AAAA,IAC3C;AAEA,IAAA,IAAI,aAAa,QAAA,CAAS,gBAAgB,KAAK,YAAA,CAAa,QAAA,CAAS,UAAU,CAAA,EAAG;AAChF,MAAA,MAAM,IAAI,0BAAA,CAA2B,QAAA,EAAU,OAAO,CAAA;AAAA,IACxD;AAGA,IAAA,MAAM,KAAA;AAAA,EACR;AACF,CAAA;AC7KO,IAAM,oBAAA,GAAN,cAAmC,gBAAA,CAAiB;AAAA,EAChD,IAAA,GAAO,WAAA;AAAA,EACP,YAAA,GAAqC;AAAA,IAC5C,IAAA,EAAM,IAAA;AAAA,IACN,MAAA,EAAQ,IAAA;AAAA,IACR,MAAA,EAAQ,IAAA;AAAA;AAAA,IACR,KAAA,EAAO;AAAA;AAAA,GACT;AAAA,EAEQ,MAAA;AAAA,EACA,SAAA;AAAA,EACW,MAAA;AAAA,EAEnB,YAAY,MAAA,EAAwB;AAClC,IAAA,KAAA,CAAM,MAAM,CAAA;AACZ,IAAA,IAAA,CAAK,MAAA,GAAS,MAAA;AAGd,IAAA,IAAI,CAAC,OAAO,SAAA,EAAW;AACrB,MAAA,MAAM,IAAI,mBAAmB,8BAA8B,CAAA;AAAA,IAC7D;AACA,IAAA,IAAI,CAAC,OAAO,QAAA,EAAU;AACpB,MAAA,MAAM,IAAI,mBAAmB,mDAAmD,CAAA;AAAA,IAClF;AAGA,IAAA,OAAA,CAAQ,IAAI,yBAAA,GAA4B,MAAA;AACxC,IAAA,OAAA,CAAQ,GAAA,CAAI,uBAAuB,MAAA,CAAO,SAAA;AAC1C,IAAA,OAAA,CAAQ,GAAA,CAAI,wBAAwB,MAAA,CAAO,QAAA;AAG3C,IAAA,IAAI,OAAO,WAAA,EAAa;AAMxB,IAAA,IAAA,CAAK,MAAA,GAAS,IAAIC,WAAAA,CAAY;AAAA;AAAA,KAE7B,CAAA;AAGD,IAAA,IAAA,CAAK,SAAA,GAAY,IAAI,eAAA,EAAgB;AAAA,EACvC;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,SAAS,OAAA,EAAoD;AACjE,IAAA,IAAI;AAEF,MAAA,MAAM,aAAA,GAAgB,MAAM,IAAA,CAAK,SAAA,CAAU,eAAe,OAAO,CAAA;AAIjE,MAAA,MAAM,MAAA,GAAS,MAAM,IAAA,CAAK,MAAA,CAAO,OAAO,eAAA,CAAgB;AAAA,QACtD,OAAO,OAAA,CAAQ,KAAA;AAAA,QACf,UAAU,aAAA,CAAc,QAAA;AAAA,QACxB,MAAA,EAAQ;AAAA,UACN,mBAAmB,aAAA,CAAc,iBAAA;AAAA,UACjC,OAAO,aAAA,CAAc,KAAA;AAAA,UACrB,YAAY,aAAA,CAAc,UAAA;AAAA,UAC1B,GAAG,aAAA,CAAc;AAAA;AACnB,OACD,CAAA;AAGD,MAAA,OAAO,IAAA,CAAK,SAAA,CAAU,eAAA,CAAgB,MAAM,CAAA;AAAA,IAC9C,SAAS,KAAA,EAAY;AACnB,MAAA,IAAA,CAAK,YAAY,KAAK,CAAA;AACtB,MAAA,MAAM,KAAA;AAAA,IACR;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,OAAO,eAAe,OAAA,EAAkE;AACtF,IAAA,IAAI;AAEF,MAAA,MAAM,aAAA,GAAgB,MAAM,IAAA,CAAK,SAAA,CAAU,eAAe,OAAO,CAAA;AAIjE,MAAA,MAAM,MAAA,GAAS,MAAM,IAAA,CAAK,MAAA,CAAO,OAAO,qBAAA,CAAsB;AAAA,QAC5D,OAAO,OAAA,CAAQ,KAAA;AAAA,QACf,UAAU,aAAA,CAAc,QAAA;AAAA,QACxB,MAAA,EAAQ;AAAA,UACN,mBAAmB,aAAA,CAAc,iBAAA;AAAA,UACjC,OAAO,aAAA,CAAc,KAAA;AAAA,UACrB,YAAY,aAAA,CAAc,UAAA;AAAA,UAC1B,GAAG,aAAA,CAAc;AAAA;AACnB,OACD,CAAA;AAGD,MAAA,MAAM,eAAA,GAAkB,IAAI,qBAAA,EAAsB;AAClD,MAAA,OAAO,eAAA,CAAgB,aAAA,CAAc,MAAA,EAAQ,OAAA,CAAQ,KAAK,CAAA;AAAA,IAC5D,SAAS,KAAA,EAAY;AACnB,MAAA,IAAA,CAAK,YAAY,KAAK,CAAA;AACtB,MAAA,MAAM,KAAA;AAAA,IACR;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,qBAAqB,KAAA,EAAkC;AAErD,IAAA,IACE,KAAA,CAAM,SAAS,UAAU,CAAA,IACzB,MAAM,QAAA,CAAS,YAAY,CAAA,IAC3B,KAAA,CAAM,QAAA,CAAS,YAAY,KAC3B,KAAA,CAAM,QAAA,CAAS,YAAY,CAAA,IAC3B,KAAA,CAAM,QAAA,CAAS,YAAY,CAAA,IAC3B,KAAA,CAAM,QAAA,CAAS,cAAc,CAAA,EAC7B;AACA,MAAA,OAAO;AAAA,QACL,aAAA,EAAe,IAAA;AAAA,QACf,cAAA,EAAgB,IAAA;AAAA,QAChB,YAAA,EAAc,IAAA;AAAA,QACd,kBAAA,EAAoB,KAAA;AAAA,QACpB,SAAA,EAAW,OAAA;AAAA;AAAA,QACX,eAAA,EAAiB;AAAA,OACnB;AAAA,IACF;AAGA,IAAA,OAAO;AAAA,MACL,aAAA,EAAe,IAAA;AAAA,MACf,cAAA,EAAgB,IAAA;AAAA,MAChB,YAAA,EAAc,IAAA;AAAA,MACd,kBAAA,EAAoB,KAAA;AAAA,MACpB,SAAA,EAAW,OAAA;AAAA,MACX,eAAA,EAAiB;AAAA,KACnB;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,YAAY,KAAA,EAAmB;AACrC,IAAA,MAAM,YAAA,GAAe,MAAM,OAAA,IAAW,EAAA;AAGtC,IAAA,IACE,KAAA,CAAM,MAAA,KAAW,GAAA,IACjB,KAAA,CAAM,MAAA,KAAW,GAAA,IACjB,YAAA,CAAa,QAAA,CAAS,mBAAmB,CAAA,IACzC,YAAA,CAAa,QAAA,CAAS,mBAAmB,CAAA,EACzC;AACA,MAAA,MAAM,IAAI,iBAAA;AAAA,QACR,WAAA;AAAA,QACA;AAAA,OACF;AAAA,IACF;AAEA,IAAA,IAAI,MAAM,MAAA,KAAW,GAAA,IAAO,YAAA,CAAa,QAAA,CAAS,oBAAoB,CAAA,EAAG;AACvE,MAAA,MAAM,IAAI,uBAAuB,WAAW,CAAA;AAAA,IAC9C;AAEA,IAAA,IAAI,aAAa,QAAA,CAAS,gBAAgB,KAAK,YAAA,CAAa,QAAA,CAAS,UAAU,CAAA,EAAG;AAChF,MAAA,MAAM,IAAI,0BAAA,CAA2B,WAAA,EAAa,OAAO,CAAA;AAAA,IAC3D;AAGA,IAAA,MAAM,KAAA;AAAA,EACR;AACF,CAAA;;;AC1KO,IAAM,qBAAA,GAAN,cAAoC,kBAAA,CAAmB;AAAA,EACnD,IAAA;AAAA,EACA,YAAA;AAAA,EAET,WAAA,CACE,IAAA,EACA,MAAA,EACA,YAAA,EACA;AACA,IAAA,KAAA,CAAM,MAAa,CAAA;AACnB,IAAA,IAAA,CAAK,IAAA,GAAO,IAAA;AAGZ,IAAA,IAAI,YAAA,EAAc;AAChB,MAAA,IAAA,CAAK,YAAA,GAAe;AAAA,QAClB,IAAA,EAAM,aAAa,IAAA,IAAQ,IAAA;AAAA,QAC3B,MAAA,EAAQ,aAAa,MAAA,IAAU,KAAA;AAAA,QAC/B,MAAA,EAAQ,aAAa,MAAA,IAAU,KAAA;AAAA,QAC/B,KAAA,EAAO,aAAa,KAAA,IAAS;AAAA,OAC/B;AAAA,IACF,CAAA,MAAO;AAEL,MAAA,IAAA,CAAK,YAAA,GAAe;AAAA,QAClB,IAAA,EAAM,IAAA;AAAA,QACN,MAAA,EAAQ,KAAA;AAAA;AAAA,QACR,MAAA,EAAQ,KAAA;AAAA,QACR,KAAA,EAAO;AAAA,OACT;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,qBAAqB,KAAA,EAAkC;AAErD,IAAA,MAAM,YACJ,KAAA,CAAM,WAAA,EAAY,CAAE,QAAA,CAAS,QAAQ,CAAA,IACrC,KAAA,CAAM,WAAA,EAAY,CAAE,SAAS,OAAO,CAAA,IACpC,MAAM,WAAA,EAAY,CAAE,SAAS,eAAe,CAAA;AAG9C,IAAA,MAAM,cAAA,GACJ,KAAA,CAAM,QAAA,CAAS,MAAM,CAAA,IACrB,KAAA,CAAM,QAAA,CAAS,MAAM,CAAA,IACrB,KAAA,CAAM,WAAA,EAAY,CAAE,SAAS,UAAU,CAAA;AAEzC,IAAA,OAAO;AAAA,MACL,aAAA,EAAe,IAAA;AAAA;AAAA,MACf,cAAA,EAAgB,SAAA;AAAA,MAChB,YAAA,EAAc,IAAA;AAAA;AAAA,MACd,kBAAA,EAAoB,KAAA;AAAA;AAAA,MACpB,SAAA,EAAW,iBAAiB,KAAA,GAAS,IAAA;AAAA;AAAA,MACrC,eAAA,EAAiB;AAAA;AAAA,KACnB;AAAA,EACF;AACF,CAAA;;;ACtDO,SAAS,eAAe,SAAA,EAAqC;AAElE,EAAA,MAAM,gBAAA,GAAmB,SAAA,CAAU,UAAA,EAAW,CAAE,QAAA;AAChD,EAAA,IAAI,gBAAA,IAAoB,OAAQ,gBAAA,CAAyB,QAAA,KAAa,UAAA,EAAY;AAChF,IAAA,OAAO,gBAAA;AAAA,EACT;AAEA,EAAA,MAAM,SAAS,SAAA,CAAU,MAAA;AAEzB,EAAA,IAAI,CAAC,MAAA,EAAQ;AACX,IAAA,MAAM,IAAI,KAAA;AAAA,MACR,CAAA,WAAA,EAAc,UAAU,IAAI,CAAA,+DAAA;AAAA,KAE9B;AAAA,EACF;AAGA,EAAA,MAAM,MAAA,GAAS,sBAAsB,SAAS,CAAA;AAE9C,EAAA,QAAQ,MAAA;AAAQ,IACd,KAAK,MAAA,CAAO,MAAA;AACV,MAAA,OAAO,IAAI,kBAAA,CAAmB;AAAA,QAC5B,GAAG,MAAA;AAAA,QACH,YAAA,EAAc,SAAA,CAAU,UAAA,EAAW,CAAE,YAAA;AAAA,QACrC,OAAA,EAAS,SAAA,CAAU,UAAA,EAAW,CAAE;AAAA,OACjC,CAAA;AAAA,IAEH,KAAK,MAAA,CAAO,SAAA;AACV,MAAA,OAAO,IAAI,qBAAA,CAAsB;AAAA,QAC/B,GAAG,MAAA;AAAA,QACH,gBAAA,EAAkB,SAAA,CAAU,UAAA,EAAW,CAAE;AAAA,OAC1C,CAAA;AAAA,IAEH,KAAK,MAAA,CAAO,MAAA;AACV,MAAA,OAAO,IAAI,mBAAmB,MAAM,CAAA;AAAA,IAEtC,KAAK,MAAA,CAAO,YAAA;AACV,MAAA,OAAO,IAAI,oBAAA,CAAqB;AAAA,QAC9B,GAAG,MAAA;AAAA,QACH,SAAA,EAAW,SAAA,CAAU,UAAA,EAAW,CAAE,SAAA,IAAuB,EAAA;AAAA,QACzD,QAAA,EAAU,SAAA,CAAU,UAAA,EAAW,CAAE,QAAA,IAAsB;AAAA,OACxD,CAAA;AAAA;AAAA,IAGH,KAAK,MAAA,CAAO,IAAA;AACV,MAAA,OAAO,IAAI,qBAAA,CAAsB,SAAA,CAAU,IAAA,EAAM;AAAA,QAC/C,GAAG,MAAA;AAAA,QACH,OAAA,EAAS,OAAO,OAAA,IAAW;AAAA,OAC5B,CAAA;AAAA,IAEH,KAAK,MAAA,CAAO,QAAA;AACV,MAAA,OAAO,IAAI,qBAAA,CAAsB,SAAA,CAAU,IAAA,EAAM;AAAA,QAC/C,GAAG,MAAA;AAAA,QACH,OAAA,EAAS,OAAO,OAAA,IAAW;AAAA,OAC5B,CAAA;AAAA,IAEH,KAAK,MAAA,CAAO,UAAA;AACV,MAAA,OAAO,IAAI,qBAAA,CAAsB,SAAA,CAAU,IAAA,EAAM;AAAA,QAC/C,GAAG,MAAA;AAAA,QACH,OAAA,EAAS,OAAO,OAAA,IAAW;AAAA,OAC5B,CAAA;AAAA,IAEH,KAAK,MAAA,CAAO,IAAA;AACV,MAAA,OAAO,IAAI,qBAAA,CAAsB,SAAA,CAAU,IAAA,EAAM;AAAA,QAC/C,GAAG,MAAA;AAAA,QACH,OAAA,EAAS,OAAO,OAAA,IAAW;AAAA,OAC5B,CAAA;AAAA,IAEH,KAAK,MAAA,CAAO,QAAA;AACV,MAAA,OAAO,IAAI,qBAAA,CAAsB,SAAA,CAAU,IAAA,EAAM;AAAA,QAC/C,GAAG,MAAA;AAAA,QACH,OAAA,EAAS,OAAO,OAAA,IAAW;AAAA,OAC5B,CAAA;AAAA,IAEH,KAAK,MAAA,CAAO,OAAA;AACV,MAAA,OAAO,IAAI,qBAAA,CAAsB,SAAA,CAAU,IAAA,EAAM;AAAA,QAC/C,GAAG,MAAA;AAAA,QACH,OAAA,EAAS,OAAO,OAAA,IAAW;AAAA,OAC5B,CAAA;AAAA,IAEH,KAAK,MAAA,CAAO,MAAA;AACV,MAAA,OAAO,IAAI,qBAAA,CAAsB,SAAA,CAAU,IAAA,EAAM;AAAA,QAC/C,GAAG,MAAA;AAAA,QACH,OAAA,EAAS,OAAO,OAAA,IAAW;AAAA,OAC5B,CAAA;AAAA,IAEH,KAAK,MAAA,CAAO,MAAA;AACV,MAAA,IAAI,CAAC,OAAO,OAAA,EAAS;AACnB,QAAA,MAAM,IAAI,KAAA;AAAA,UACR,CAAA,WAAA,EAAc,UAAU,IAAI,CAAA,qCAAA;AAAA,SAC9B;AAAA,MACF;AACA,MAAA,OAAO,IAAI,qBAAA,CAAsB,SAAA,CAAU,IAAA,EAAM;AAAA,QAC/C,GAAG,MAAA;AAAA,QACH,SAAS,MAAA,CAAO;AAAA,OACjB,CAAA;AAAA,IAEH;AACE,MAAA,MAAM,IAAI,KAAA,CAAM,CAAA,gBAAA,EAAmB,MAAM,CAAA,CAAE,CAAA;AAAA;AAEjD;AAKA,SAAS,sBAAsB,SAAA,EAAsC;AACnE,EAAA,MAAM,IAAA,GAAO,UAAU,MAAA,CAAO,IAAA;AAG9B,EAAA,IAAI,MAAA;AAEJ,EAAA,IAAI,IAAA,CAAK,SAAS,SAAA,EAAW;AAC3B,IAAA,MAAA,GAAS,IAAA,CAAK,MAAA;AAAA,EAChB,CAAA,MAAA,IAAW,IAAA,CAAK,IAAA,KAAS,MAAA,EAAQ;AAE/B,IAAA,MAAA,GAAS,UAAA;AAAA,EACX,CAAA,MAAA,IAAW,IAAA,CAAK,IAAA,KAAS,OAAA,EAAS;AAGhC,IAAA,MAAM,IAAI,KAAA;AAAA,MACR,CAAA,WAAA,EAAc,UAAU,IAAI,CAAA,sEAAA;AAAA,KAE9B;AAAA,EACF,CAAA,MAAA,IAAW,IAAA,CAAK,IAAA,KAAS,KAAA,EAAO;AAC9B,IAAA,MAAM,IAAI,KAAA;AAAA,MACR,CAAA,WAAA,EAAc,UAAU,IAAI,CAAA,gEAAA;AAAA,KAE9B;AAAA,EACF,CAAA,MAAO;AACL,IAAA,MAAM,IAAI,KAAA,CAAM,CAAA,iCAAA,EAAoC,SAAA,CAAU,IAAI,CAAA,CAAA,CAAG,CAAA;AAAA,EACvE;AAEA,EAAA,OAAO;AAAA,IACL,MAAA;AAAA,IACA,OAAA,EAAS,UAAU,MAAA,CAAO,OAAA;AAAA,IAC1B,OAAA,EAAS,SAAA,CAAU,UAAA,EAAW,CAAE,OAAA;AAAA,IAChC,UAAA,EAAY,SAAA,CAAU,UAAA,EAAW,CAAE;AAAA,GACrC;AACF;;;ApDiGO,IAAe,SAAA,GAAf,cAIGV,YAAAA,CAAsB;AAAA;AAAA,EAErB,IAAA;AAAA,EACA,SAAA;AAAA,EACA,KAAA;AAAA;AAAA,EAGC,OAAA;AAAA,EACA,aAAA;AAAA;AAAA,EACA,kBAAA;AAAA,EACA,YAAA,GAAe,KAAA;AAAA,EACf,oBAAuD,EAAC;AAAA,EACxD,OAAA;AAAA,EACA,eAAA;AAAA;AAAA,EAGA,cAAA,GAA2C,IAAA;AAAA,EAC3C,iBAAA,GAA2D,IAAA;AAAA,EAC3D,mBAAA,GAA+C,IAAA;AAAA;AAAA,EAGjD,eAAA,GAAwC,IAAA;AAAA;AAAA,EAIhD,WAAA,CAAY,QAAiB,eAAA,EAAyB;AACpD,IAAA,KAAA,EAAM;AACN,IAAA,IAAA,CAAK,OAAA,GAAU,MAAA;AAGf,IAAA,IAAA,CAAK,SAAA,GAAY,IAAA,CAAK,gBAAA,CAAiB,MAAA,CAAO,SAAS,CAAA;AAGvD,IAAA,IAAA,CAAK,IAAA,GAAO,MAAA,CAAO,IAAA,IAAQ,CAAA,EAAG,IAAA,CAAK,cAAc,CAAA,CAAA,EAAI,IAAA,CAAK,GAAA,EAAK,CAAA,CAAA;AAC/D,IAAA,IAAA,CAAK,QAAQ,MAAA,CAAO,KAAA;AAGpB,IAAA,IAAA,CAAK,OAAA,GAAU,OAAO,KAAA,CAAM;AAAA,MAC1B,SAAA,EAAW,eAAA;AAAA,MACX,WAAW,IAAA,CAAK,IAAA;AAAA,MAChB,OAAO,IAAA,CAAK,KAAA;AAAA,MACZ,SAAA,EAAW,KAAK,SAAA,CAAU;AAAA,KAC3B,CAAA;AAGD,IAAA,IAAA,CAAK,aAAA,GAAgB,IAAA,CAAK,sBAAA,CAAuB,MAAM,CAAA;AAGvD,IAAA,IAAI,OAAO,KAAA,EAAO;AAChB,MAAA,KAAA,MAAW,IAAA,IAAQ,OAAO,KAAA,EAAO;AAC/B,QAAA,IAAA,CAAK,aAAA,CAAc,KAAA,CAAM,QAAA,CAAS,IAAI,CAAA;AAAA,MACxC;AAAA,IACF;AAGA,IAAA,IAAA,CAAK,qBAAqB,IAAA,CAAK,2BAAA,CAA4B,MAAA,CAAO,WAAA,EAAa,OAAO,KAAK,CAAA;AAG3F,IAAA,IAAA,CAAK,eAAA,GAAkB,MAAA,CAAO,cAAA,IAAkB,EAAC;AAAA,EACnD;AAAA;AAAA;AAAA;AAAA;AAAA,EAcU,iBAAiB,GAAA,EAAoC;AAC7D,IAAA,IAAI,OAAO,QAAQ,QAAA,EAAU;AAC3B,MAAA,OAAO,SAAA,CAAU,IAAI,GAAG,CAAA;AAAA,IAC1B;AACA,IAAA,OAAO,GAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOU,uBAAuB,MAAA,EAA+B;AAE9D,IAAA,IAAI,MAAA,CAAO,mBAAmB,YAAA,EAAc;AAC1C,MAAA,OAAO,MAAA,CAAO,OAAA;AAAA,IAChB;AAKA,IAAA,MAAM,aAAA,GAAoC;AAAA,MACxC,OAAO,MAAA,CAAO,KAAA;AAAA,MACd,SAAS,MAAA,CAAO,IAAA;AAAA;AAAA,MAEhB,OAAA,EAAS,OAAO,OAAA,EAAS,OAAA;AAAA;AAAA,MAEzB,GAAI,OAAO,MAAA,CAAO,OAAA,KAAY,QAAA,IAAY,OAAO,OAAA,KAAY,IAAA,GAAO,MAAA,CAAO,OAAA,GAAU;AAAC,KACxF;AAEA,IAAA,OAAO,YAAA,CAAa,OAAO,aAAa,CAAA;AAAA,EAC1C;AAAA;AAAA;AAAA;AAAA,EAKU,2BAAA,CACR,QACA,KAAA,EACuB;AACvB,IAAA,MAAM,OAAA,GAAU,IAAI,qBAAA,CAAsB,MAAM,CAAA;AAGhD,IAAA,IAAI,KAAA,EAAO;AACT,MAAA,KAAA,MAAW,QAAQ,KAAA,EAAO;AACxB,QAAA,IAAI,KAAK,UAAA,EAAY;AACnB,UAAA,OAAA,CAAQ,cAAc,IAAA,CAAK,UAAA,CAAW,QAAA,CAAS,IAAA,EAAM,KAAK,UAAU,CAAA;AAAA,QACtE;AAAA,MACF;AAAA,IACF;AAEA,IAAA,OAAO,OAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA,EAMU,kBAAkB,aAAA,EAAyC;AACnE,IAAA,IAAI,CAAC,aAAA,EAAe;AAClB,MAAA;AAAA,IACF;AAEA,IAAA,IAAA,CAAK,cAAA,GAAiB,aAAA;AAEtB,IAAA,IAAI,cAAc,EAAA,EAAI;AAEpB,MAAA,IAAA,CAAK,mBAAA,GAAsB,IAAA,CAAK,WAAA,CAAY,aAAA,CAAc,EAAE,CAAA;AAAA,IAC9D;AAGA,IAAA,IAAI,cAAc,QAAA,EAAU;AAC1B,MAAA,MAAM,QAAA,GAAW,cAAc,kBAAA,IAAsB,GAAA;AACrD,MAAA,IAAA,CAAK,iBAAA,GAAoB,YAAY,YAAY;AAC/C,QAAA,IAAI;AACF,UAAA,IAAI,IAAA,CAAK,cAAc,SAAA,EAAW;AAChC,YAAA,MAAM,IAAA,CAAK,cAAc,IAAA,EAAK;AAC9B,YAAA,IAAA,CAAK,OAAA,CAAQ,MAAM,EAAE,SAAA,EAAW,KAAK,aAAA,CAAc,SAAA,IAAa,oBAAoB,CAAA;AAAA,UACtF;AAAA,QACF,SAAS,KAAA,EAAO;AACd,UAAA,IAAA,CAAK,QAAQ,KAAA,CAAM,EAAE,OAAQ,KAAA,CAAgB,OAAA,IAAW,kBAAkB,CAAA;AAAA,QAC5E;AAAA,MACF,GAAG,QAAQ,CAAA;AAAA,IACb;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAgB,mBAAA,GAAqC;AACnD,IAAA,IAAI,KAAK,mBAAA,EAAqB;AAC5B,MAAA,MAAM,IAAA,CAAK,mBAAA;AACX,MAAA,IAAA,CAAK,mBAAA,GAAsB,IAAA;AAAA,IAC7B;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,YAAA,GAA8B;AAC5B,IAAA,OAAO,KAAK,aAAA,CAAc,SAAA;AAAA,EAC5B;AAAA;AAAA;AAAA;AAAA,EAKA,UAAA,GAAsB;AACpB,IAAA,OAAO,IAAA,CAAK,cAAc,OAAA,KAAY,IAAA;AAAA,EACxC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUA,MAAM,WAAA,CAAY,SAAA,EAAoB,QAAA,EAAkD;AACtF,IAAA,MAAM,KAAK,mBAAA,EAAoB;AAE/B,IAAA,MAAM,KAAA,GAAQ,MAAM,IAAA,CAAK,eAAA,EAAgB;AACzC,IAAA,MAAM,IAAA,CAAK,aAAA,CAAc,IAAA,CAAK,SAAA,EAAW,UAAU,KAAK,CAAA;AACxD,IAAA,IAAA,CAAK,OAAA,CAAQ,MAAM,EAAE,SAAA,EAAW,KAAK,aAAA,CAAc,SAAA,IAAa,eAAe,CAAA;AAE/E,IAAC,IAAA,CAAK,KAAa,eAAA,EAAiB,EAAE,WAAW,IAAA,CAAK,aAAA,CAAc,WAAW,CAAA;AAAA,EACjF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUA,MAAM,YAAY,SAAA,EAAqC;AAErD,IAAA,MAAM,MAAA,GAAS,MAAM,IAAA,CAAK,aAAA,CAAc,QAAQ,SAAS,CAAA;AACzD,IAAA,IAAI,CAAC,MAAA,EAAQ;AACX,MAAA,IAAA,CAAK,OAAA,CAAQ,IAAA,CAAK,EAAE,SAAA,IAAa,mBAAmB,CAAA;AACpD,MAAA,OAAO,KAAA;AAAA,IACT;AAEA,IAAA,MAAM,IAAA,CAAK,mBAAA,CAAoB,MAAA,CAAO,KAAK,CAAA;AAC3C,IAAA,IAAA,CAAK,OAAA,CAAQ,IAAA,CAAK,EAAE,SAAA,IAAa,gBAAgB,CAAA;AAEjD,IAAC,IAAA,CAAK,IAAA,CAAa,gBAAA,EAAkB,EAAE,WAAW,CAAA;AAClD,IAAA,OAAO,IAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,MAAM,cAAc,SAAA,EAAqC;AACvD,IAAA,OAAO,IAAA,CAAK,aAAA,CAAc,aAAA,CAAc,SAAS,CAAA;AAAA,EACnD;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,MAAM,cAAc,SAAA,EAAmC;AACrD,IAAA,MAAM,IAAA,CAAK,aAAA,CAAc,aAAA,CAAc,SAAS,CAAA;AAChD,IAAA,IAAA,CAAK,OAAA,CAAQ,KAAA,CAAM,EAAE,SAAA,IAAa,iBAAiB,CAAA;AAAA,EACrD;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,MAAM,eAAA,GAAoF;AACxF,IAAA,OAAO,IAAA,CAAK,cAAc,QAAA,EAAS;AAAA,EACrC;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,MAAM,oBAAoB,KAAA,EAA+E;AACvG,IAAA,MAAM,IAAA,CAAK,aAAA,CAAc,YAAA,CAAa,KAAK,CAAA;AAAA,EAC7C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,IAAI,KAAA,GAAqB;AACvB,IAAA,OAAO,KAAK,aAAA,CAAc,KAAA;AAAA,EAC5B;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,IAAI,OAAA,GAAwB;AAC1B,IAAA,OAAO,IAAA,CAAK,aAAA;AAAA,EACd;AAAA;AAAA;AAAA;AAAA,EAKA,IAAI,WAAA,GAAqC;AACvC,IAAA,OAAO,IAAA,CAAK,kBAAA;AAAA,EACd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,QAAQ,IAAA,EAA0B;AAChC,IAAA,IAAA,CAAK,aAAA,CAAc,KAAA,CAAM,QAAA,CAAS,IAAI,CAAA;AAGtC,IAAA,IAAI,KAAK,UAAA,EAAY;AACnB,MAAA,IAAA,CAAK,mBAAmB,aAAA,CAAc,IAAA,CAAK,WAAW,QAAA,CAAS,IAAA,EAAM,KAAK,UAAU,CAAA;AAAA,IACtF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,WAAW,QAAA,EAAwB;AACjC,IAAA,IAAA,CAAK,aAAA,CAAc,KAAA,CAAM,UAAA,CAAW,QAAQ,CAAA;AAAA,EAC9C;AAAA;AAAA;AAAA;AAAA,EAKA,SAAA,GAAsB;AACpB,IAAA,OAAO,IAAA,CAAK,aAAA,CAAc,KAAA,CAAM,WAAA,EAAY;AAAA,EAC9C;AAAA;AAAA;AAAA;AAAA,EAKA,SAAS,KAAA,EAA6B;AACpC,IAAA,IAAA,CAAK,aAAA,CAAc,MAAM,KAAA,EAAM;AAC/B,IAAA,KAAA,MAAW,QAAQ,KAAA,EAAO;AACxB,MAAA,IAAA,CAAK,aAAA,CAAc,KAAA,CAAM,QAAA,CAAS,IAAI,CAAA;AACtC,MAAA,IAAI,KAAK,UAAA,EAAY;AACnB,QAAA,IAAA,CAAK,mBAAmB,aAAA,CAAc,IAAA,CAAK,WAAW,QAAA,CAAS,IAAA,EAAM,KAAK,UAAU,CAAA;AAAA,MACtF;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAMU,yBAAA,GAA2F;AACnG,IAAA,OAAO,IAAA,CAAK,cAAc,KAAA,CAAM,UAAA,GAAa,GAAA,CAAI,CAAC,CAAA,KAAM,CAAA,CAAE,UAAU,CAAA;AAAA,EACtE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQQ,iBAAA,GAAmC;AACzC,IAAA,IAAI,CAAC,KAAK,eAAA,EAAiB;AACzB,MAAA,IAAA,CAAK,eAAA,GAAkB,cAAA,CAAe,IAAA,CAAK,SAAS,CAAA;AAAA,IACtD;AACA,IAAA,OAAO,IAAA,CAAK,eAAA;AAAA,EACd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EA6CA,MAAM,SAAA,CACJ,KAAA,EACA,OAAA,GAA6B,EAAC,EACR;AACtB,IAAA,IAAI,KAAK,YAAA,EAAc;AACrB,MAAA,MAAM,IAAI,MAAM,0BAA0B,CAAA;AAAA,IAC5C;AAEA,IAAA,MAAM,QAAA,GAAW,KAAK,iBAAA,EAAkB;AAExC,IAAA,MAAM,eAAA,GAAkB;AAAA,MACtB,OAAO,IAAA,CAAK,KAAA;AAAA,MACZ,KAAA;AAAA,MACA,cAAc,OAAA,CAAQ,YAAA;AAAA,MACtB,KAAA,EAAO,OAAA,CAAQ,YAAA,GAAe,IAAA,CAAK,2BAA0B,GAAI,MAAA;AAAA,MACjE,aAAa,OAAA,CAAQ,WAAA;AAAA,MACrB,mBAAmB,OAAA,CAAQ,eAAA;AAAA,MAC3B,iBAAiB,OAAA,CAAQ,cAAA;AAAA,MACzB,eAAe,OAAA,CAAQ;AAAA,KACzB;AAEA,IAAA,IAAA,CAAK,QAAQ,KAAA,CAAM,EAAE,WAAW,OAAO,KAAA,IAAS,kBAAkB,CAAA;AAElE,IAAA,IAAI;AACF,MAAA,MAAM,QAAA,GAAW,MAAM,QAAA,CAAS,QAAA,CAAS,eAAe,CAAA;AACxD,MAAA,IAAA,CAAK,OAAA,CAAQ,MAAM,EAAE,YAAA,EAAc,SAAS,WAAA,EAAa,MAAA,IAAU,qBAAqB,CAAA;AACxF,MAAA,OAAO,QAAA;AAAA,IACT,SAAS,KAAA,EAAO;AACd,MAAA,IAAA,CAAK,QAAQ,KAAA,CAAM,EAAE,OAAQ,KAAA,CAAgB,OAAA,IAAW,kBAAkB,CAAA;AAC1E,MAAA,MAAM,KAAA;AAAA,IACR;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAqBA,OAAO,YAAA,CACL,KAAA,EACA,OAAA,GAA6B,EAAC,EACM;AACpC,IAAA,IAAI,KAAK,YAAA,EAAc;AACrB,MAAA,MAAM,IAAI,MAAM,0BAA0B,CAAA;AAAA,IAC5C;AAEA,IAAA,MAAM,QAAA,GAAW,KAAK,iBAAA,EAAkB;AAExC,IAAA,MAAM,eAAA,GAAkB;AAAA,MACtB,OAAO,IAAA,CAAK,KAAA;AAAA,MACZ,KAAA;AAAA,MACA,cAAc,OAAA,CAAQ,YAAA;AAAA,MACtB,KAAA,EAAO,OAAA,CAAQ,YAAA,GAAe,IAAA,CAAK,2BAA0B,GAAI,MAAA;AAAA,MACjE,aAAa,OAAA,CAAQ,WAAA;AAAA,MACrB,mBAAmB,OAAA,CAAQ,eAAA;AAAA,MAC3B,iBAAiB,OAAA,CAAQ,cAAA;AAAA,MACzB,eAAe,OAAA,CAAQ;AAAA,KACzB;AAEA,IAAA,IAAA,CAAK,QAAQ,KAAA,CAAM,EAAE,WAAW,OAAO,KAAA,IAAS,qBAAqB,CAAA;AAErE,IAAA,IAAI;AACF,MAAA,OAAO,QAAA,CAAS,eAAe,eAAe,CAAA;AAC9C,MAAA,IAAA,CAAK,OAAA,CAAQ,MAAM,wBAAwB,CAAA;AAAA,IAC7C,SAAS,KAAA,EAAO;AACd,MAAA,IAAA,CAAK,QAAQ,KAAA,CAAM,EAAE,OAAQ,KAAA,CAAgB,OAAA,IAAW,qBAAqB,CAAA;AAC7E,MAAA,MAAM,KAAA;AAAA,IACR;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,IAAI,cAAA,GAAsC;AACxC,IAAA,OAAO,IAAA,CAAK,eAAA;AAAA,EACd;AAAA;AAAA;AAAA;AAAA,EAKA,kBAAkB,KAAA,EAA2C;AAC3D,IAAA,IAAA,CAAK,kBAAkB,EAAE,GAAG,IAAA,CAAK,eAAA,EAAiB,GAAG,KAAA,EAAM;AAAA,EAC7D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,MAAgB,0BAA0B,OAAA,EAAkD;AAC1F,IAAA,IAAI,IAAA,CAAK,gBAAgB,mBAAA,EAAqB;AAC5C,MAAA,IAAI;AACF,QAAA,MAAM,IAAA,CAAK,eAAA,CAAgB,mBAAA,CAAoB,OAAO,CAAA;AAAA,MACxD,SAAS,KAAA,EAAO;AACd,QAAA,IAAA,CAAK,OAAA,CAAQ,KAAA;AAAA,UACX,EAAE,KAAA,EAAQ,KAAA,CAAgB,OAAA,EAAS,QAAA,EAAU,QAAQ,QAAA,EAAS;AAAA,UAC9D;AAAA,SACF;AACA,QAAA,MAAM,KAAA;AAAA,MACR;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,MAAgB,yBAAyB,MAAA,EAA4C;AACnF,IAAA,IAAI,IAAA,CAAK,gBAAgB,kBAAA,EAAoB;AAC3C,MAAA,IAAI;AACF,QAAA,MAAM,IAAA,CAAK,eAAA,CAAgB,kBAAA,CAAmB,MAAM,CAAA;AAAA,MACtD,SAAS,KAAA,EAAO;AACd,QAAA,IAAA,CAAK,OAAA,CAAQ,KAAA;AAAA,UACX,EAAE,KAAA,EAAQ,KAAA,CAAgB,OAAA,EAAS,QAAA,EAAU,OAAO,QAAA,EAAS;AAAA,UAC7D;AAAA,SACF;AAAA,MAEF;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,MAAgB,0BAAA,GAA4C;AAC1D,IAAA,IAAI,IAAA,CAAK,gBAAgB,oBAAA,EAAsB;AAC7C,MAAA,IAAI;AACF,QAAA,MAAM,IAAA,CAAK,eAAA,CAAgB,oBAAA,CAAqB,IAAA,CAAK,IAAI,CAAA;AAAA,MAC3D,SAAS,KAAA,EAAO;AACd,QAAA,IAAA,CAAK,OAAA,CAAQ,KAAA;AAAA,UACX,EAAE,KAAA,EAAQ,KAAA,CAAgB,OAAA,EAAQ;AAAA,UAClC;AAAA,SACF;AAAA,MAEF;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,MAAgB,uBAAuB,OAAA,EAAiD;AACtF,IAAA,IAAI,IAAA,CAAK,gBAAgB,gBAAA,EAAkB;AACzC,MAAA,IAAI;AACF,QAAA,MAAM,IAAA,CAAK,eAAA,CAAgB,gBAAA,CAAiB,OAAO,CAAA;AAAA,MACrD,SAAS,KAAA,EAAO;AACd,QAAA,IAAA,CAAK,OAAA,CAAQ,KAAA;AAAA,UACX;AAAA,YACE,OAAQ,KAAA,CAAgB,OAAA;AAAA,YACxB,UAAU,OAAA,CAAQ,QAAA;AAAA,YAClB,uBAAuB,OAAA,CAAQ;AAAA,WACjC;AAAA,UACA;AAAA,SACF;AAAA,MAEF;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,MAAgB,qBAAA,CAAsB,GAAA,EAAe,WAAA,EAAoC;AACvF,IAAA,IAAI,IAAA,CAAK,gBAAgB,eAAA,EAAiB;AACxC,MAAA,IAAI;AACF,QAAA,MAAM,IAAA,CAAK,eAAA,CAAgB,eAAA,CAAgB,GAAA,EAAK,WAAW,CAAA;AAAA,MAC7D,SAAS,KAAA,EAAO;AACd,QAAA,IAAA,CAAK,OAAA,CAAQ,KAAA;AAAA,UACX,EAAE,KAAA,EAAQ,KAAA,CAAgB,OAAA,EAAS,WAAA,EAAY;AAAA,UAC/C;AAAA,SACF;AAAA,MAEF;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,MAAgB,aAAA,CAAc,KAAA,EAAc,KAAA,EAA8B;AACxE,IAAA,IAAI,IAAA,CAAK,gBAAgB,OAAA,EAAS;AAChC,MAAA,IAAI;AACF,QAAA,MAAM,IAAA,CAAK,gBAAgB,OAAA,CAAQ,KAAA,EAAO,EAAE,KAAA,EAAO,OAAA,EAAS,IAAA,CAAK,IAAA,EAAM,CAAA;AAAA,MACzE,SAAS,SAAA,EAAW;AAClB,QAAA,IAAA,CAAK,OAAA,CAAQ,KAAA;AAAA,UACX,EAAE,KAAA,EAAQ,SAAA,CAAoB,SAAS,aAAA,EAAe,KAAA,CAAM,SAAS,KAAA,EAAM;AAAA,UAC3E;AAAA,SACF;AAAA,MAEF;AAAA,IACF;AAAA,EACF;AAAA;AAAA,EAIA,IAAI,WAAA,GAAuB;AACzB,IAAA,OAAO,IAAA,CAAK,YAAA;AAAA,EACd;AAAA;AAAA;AAAA;AAAA,EAKA,UAAU,QAAA,EAA4C;AACpD,IAAA,IAAA,CAAK,iBAAA,CAAkB,KAAK,QAAQ,CAAA;AAAA,EACtC;AAAA;AAAA;AAAA;AAAA;AAAA,EAMU,WAAA,GAAoB;AAC5B,IAAA,IAAI,KAAK,YAAA,EAAc;AACrB,MAAA;AAAA,IACF;AACA,IAAA,IAAA,CAAK,YAAA,GAAe,IAAA;AAEpB,IAAA,IAAA,CAAK,OAAA,CAAQ,MAAM,uBAAuB,CAAA;AAG1C,IAAA,IAAI,KAAK,iBAAA,EAAmB;AAC1B,MAAA,aAAA,CAAc,KAAK,iBAAiB,CAAA;AACpC,MAAA,IAAA,CAAK,iBAAA,GAAoB,IAAA;AAAA,IAC3B;AAGA,IAAA,IAAA,CAAK,cAAc,OAAA,EAAQ;AAG3B,IAAA,IAAA,CAAK,mBAAmB,kBAAA,EAAmB;AAG3C,IAAA,IAAA,CAAK,kBAAA,EAAmB;AAAA,EAK1B;AAAA;AAAA;AAAA;AAAA,EAKA,MAAgB,mBAAA,GAAqC;AACnD,IAAA,KAAA,MAAW,QAAA,IAAY,KAAK,iBAAA,EAAmB;AAC7C,MAAA,IAAI;AACF,QAAA,MAAM,QAAA,EAAS;AAAA,MACjB,SAAS,KAAA,EAAO;AACd,QAAA,IAAA,CAAK,QAAQ,KAAA,CAAM,EAAE,OAAQ,KAAA,CAAgB,OAAA,IAAW,wBAAwB,CAAA;AAAA,MAClF;AAAA,IACF;AACA,IAAA,IAAA,CAAK,oBAAoB,EAAC;AAAA,EAC5B;AACF,CAAA;;;AqD13BO,IAAK,aAAA,qBAAAW,cAAAA,KAAL;AACL,EAAAA,eAAA,SAAA,CAAA,GAAU,SAAA;AACV,EAAAA,eAAA,WAAA,CAAA,GAAY,WAAA;AACZ,EAAAA,eAAA,WAAA,CAAA,GAAY,WAAA;AACZ,EAAAA,eAAA,QAAA,CAAA,GAAS,QAAA;AACT,EAAAA,eAAA,SAAA,CAAA,GAAU,SAAA;AALA,EAAA,OAAAA,cAAAA;AAAA,CAAA,EAAA,aAAA,IAAA,EAAA;AAsKL,SAAS,mBAAA,CACd,IAAA,EACA,SAAA,GAAY,EAAA,EACJ;AACR,EAAA,IAAI,CAAC,IAAA,IAAQ,OAAO,IAAA,KAAS,QAAA,EAAU;AACrC,IAAA,OAAO,EAAA;AAAA,EACT;AAGA,EAAA,MAAM,YAAA,GAAe;AAAA,IACnB,WAAA;AAAA,IAAa,MAAA;AAAA,IAAQ,SAAA;AAAA,IAAW,OAAA;AAAA,IAAS,SAAA;AAAA,IAAW,KAAA;AAAA,IACpD,KAAA;AAAA,IAAO,MAAA;AAAA,IAAQ,SAAA;AAAA,IAAW,SAAA;AAAA,IAAW,YAAA;AAAA,IAAc;AAAA,GACrD;AAGA,EAAA,KAAA,MAAW,OAAO,YAAA,EAAc;AAC9B,IAAA,IAAI,GAAA,IAAO,IAAA,IAAQ,IAAA,CAAK,GAAG,KAAK,IAAA,EAAM;AACpC,MAAA,MAAM,KAAA,GAAQ,KAAK,GAAG,CAAA;AACtB,MAAA,MAAM,MAAM,OAAO,KAAA,KAAU,WAAW,KAAA,GAAQ,IAAA,CAAK,UAAU,KAAK,CAAA;AACpE,MAAA,OAAO,GAAA,CAAI,SAAS,SAAA,GAAY,GAAA,CAAI,MAAM,CAAA,EAAG,SAAA,GAAY,CAAC,CAAA,GAAI,KAAA,GAAQ,GAAA;AAAA,IACxE;AAAA,EACF;AAGA,EAAA,KAAA,MAAW,GAAG,KAAK,KAAK,MAAA,CAAO,OAAA,CAAQ,IAAI,CAAA,EAAG;AAC5C,IAAA,IAAI,OAAO,KAAA,KAAU,QAAA,IAAY,KAAA,CAAM,SAAS,CAAA,EAAG;AACjD,MAAA,OAAO,KAAA,CAAM,SAAS,SAAA,GAAY,KAAA,CAAM,MAAM,CAAA,EAAG,SAAA,GAAY,CAAC,CAAA,GAAI,KAAA,GAAQ,KAAA;AAAA,IAC5E;AAAA,EACF;AAGA,EAAA,MAAM,UAAA,GAAa,MAAA,CAAO,OAAA,CAAQ,IAAI,EAAE,CAAC,CAAA;AACzC,EAAA,IAAI,UAAA,EAAY;AACd,IAAA,MAAM,CAAC,GAAA,EAAK,KAAK,CAAA,GAAI,UAAA;AACrB,IAAA,MAAM,MAAM,OAAO,KAAA,KAAU,WAAW,KAAA,GAAQ,IAAA,CAAK,UAAU,KAAK,CAAA;AACpE,IAAA,IAAI,GAAA,CAAI,SAAS,SAAA,EAAW;AAC1B,MAAA,OAAO,CAAA,EAAG,GAAG,CAAA,CAAA,EAAI,GAAA,CAAI,KAAA,CAAM,GAAG,SAAA,GAAY,GAAA,CAAI,MAAA,GAAS,CAAC,CAAC,CAAA,GAAA,CAAA;AAAA,IAC3D;AACA,IAAA,OAAO,CAAA,EAAG,GAAG,CAAA,CAAA,EAAI,GAAG,CAAA,CAAA;AAAA,EACtB;AAEA,EAAA,OAAO,EAAA;AACT;AAUO,SAAS,sBAAA,CACd,MACA,IAAA,EACQ;AACR,EAAA,IAAI,KAAK,YAAA,EAAc;AACrB,IAAA,IAAI;AACF,MAAA,OAAO,IAAA,CAAK,aAAa,IAAI,CAAA;AAAA,IAC/B,CAAA,CAAA,MAAQ;AAAA,IAER;AAAA,EACF;AACA,EAAA,OAAO,oBAAoB,IAA+B,CAAA;AAC5D;;;AC/LO,IAAM,mBAAN,MAAuB;AAAA;AAAA,EAEnB,WAAA;AAAA,EACA,SAAA;AAAA,EACT,SAAA,GAAoB,CAAA;AAAA;AAAA,EAGX,SAAA,uBAAuC,GAAA,EAAI;AAAA,EAC3C,WAAA,uBAA2C,GAAA,EAAI;AAAA;AAAA,EAGxD,MAAA,GAAkB,KAAA;AAAA,EAClB,WAAA;AAAA,EACA,SAAA,GAAqB,KAAA;AAAA,EACrB,YAAA;AAAA;AAAA,EAGS,QAAA,uBAAiC,GAAA,EAAI;AAAA;AAAA,EAG7B,MAAA;AAAA,EACA,aAAgC,EAAC;AAAA,EACjC,qBAAyC,EAAC;AAAA;AAAA,EAGlD,OAAA,GAA4B;AAAA,IACnC,aAAA,EAAe,CAAA;AAAA,IACf,WAAA,EAAa,CAAA;AAAA,IACb,YAAA,EAAc,CAAA;AAAA,IACd,YAAA,EAAc,CAAA;AAAA,IACd,cAAA,EAAgB,CAAA;AAAA,IAChB,aAAA,EAAe,CAAA;AAAA,IACf,gBAAA,EAAkB,CAAA;AAAA,IAClB,gBAAA,EAAkB,CAAA;AAAA,IAClB,gBAAA,EAAkB,CAAA;AAAA,IAClB,WAAA,EAAa,CAAA;AAAA,IACb,YAAA,EAAc,CAAA;AAAA,IACd,WAAA,EAAa,CAAA;AAAA,IACb,QAAQ;AAAC,GACX;AAAA;AAAA,EAGiB,aAA2B,EAAC;AAAA,EAE7C,WAAA,CACE,WAAA,EACA,MAAA,GAAiC,EAAC,EAClC;AACA,IAAA,IAAA,CAAK,WAAA,GAAc,WAAA;AACnB,IAAA,IAAA,CAAK,SAAA,uBAAgB,IAAA,EAAK;AAC1B,IAAA,IAAA,CAAK,MAAA,GAAS;AAAA,MACZ,cAAA,EAAgB,OAAO,cAAA,IAAkB,EAAA;AAAA,MACzC,WAAA,EAAa,OAAO,WAAA,IAAe,SAAA;AAAA,MACnC,iBAAA,EAAmB,OAAO,iBAAA,IAAqB;AAAA,KACjD;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,aAAa,MAAA,EAA+B;AAC1C,IAAA,QAAQ,IAAA,CAAK,OAAO,WAAA;AAAa,MAC/B,KAAK,MAAA;AAEH,QAAA;AAAA,MAEF,KAAK,SAAA;AAEH,QAAA,IAAA,CAAK,mBAAmB,IAAA,CAAK;AAAA,UAC3B,WAAW,MAAA,CAAO,SAAA;AAAA,UAClB,MAAA,EAAQ,MAAA,CAAO,QAAA,CAAS,KAAA,CAAM,YAAA;AAAA,UAC9B,SAAA,EAAW,OAAO,SAAA,CAAU,MAAA;AAAA,UAC5B,UAAU,MAAA,CAAO,OAAA,CAAQ,SAAQ,GAAI,MAAA,CAAO,UAAU,OAAA,EAAQ;AAAA,UAC9D,WAAW,MAAA,CAAO;AAAA,SACnB,CAAA;AAGD,QAAA,IAAI,IAAA,CAAK,kBAAA,CAAmB,MAAA,GAAS,IAAA,CAAK,OAAO,cAAA,EAAiB;AAChE,UAAA,IAAA,CAAK,mBAAmB,KAAA,EAAM;AAAA,QAChC;AACA,QAAA;AAAA,MAEF,KAAK,MAAA;AAEH,QAAA,IAAA,CAAK,UAAA,CAAW,KAAK,MAAM,CAAA;AAG3B,QAAA,IAAI,IAAA,CAAK,UAAA,CAAW,MAAA,GAAS,IAAA,CAAK,OAAO,cAAA,EAAiB;AACxD,UAAA,IAAA,CAAK,WAAW,KAAA,EAAM;AAAA,QACxB;AACA,QAAA;AAAA;AACJ,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,UAAA,GAAqD;AACnD,IAAA,OAAO,KAAK,MAAA,CAAO,WAAA,KAAgB,MAAA,GAAS,IAAA,CAAK,aAAa,IAAA,CAAK,kBAAA;AAAA,EACrE;AAAA;AAAA;AAAA;AAAA,EAKA,KAAA,CAAM,IAAA,EAA0B,OAAA,EAAc,QAAA,EAAmB,QAAA,EAAyB;AACxF,IAAA,IAAA,CAAK,WAAW,IAAA,CAAK;AAAA,MACnB,SAAA,sBAAe,IAAA,EAAK;AAAA,MACpB,IAAA;AAAA,MACA,QAAA;AAAA,MACA,QAAA;AAAA,MACA;AAAA,KACD,CAAA;AAGD,IAAA,IAAI,IAAA,CAAK,UAAA,CAAW,MAAA,GAAS,IAAA,CAAK,OAAO,iBAAA,EAAoB;AAC3D,MAAA,IAAA,CAAK,WAAW,KAAA,EAAM;AAAA,IACxB;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,aAAA,GAAuC;AACrC,IAAA,OAAO,IAAA,CAAK,UAAA;AAAA,EACd;AAAA;AAAA;AAAA;AAAA,EAKA,cAAc,MAAA,EAAyC;AACrD,IAAA,MAAA,CAAO,MAAA,CAAO,IAAA,CAAK,OAAA,EAAS,MAAM,CAAA;AAAA,EACpC;AAAA;AAAA;AAAA;AAAA,EAKA,YAAY,QAAA,EAA0B;AACpC,IAAA,IAAA,CAAK,SAAA,CAAU,GAAA,CAAI,QAAA,CAAS,EAAA,EAAI,QAAQ,CAAA;AACxC,IAAA,IAAA,CAAK,OAAA,CAAQ,aAAA,EAAA;AAAA,EACf;AAAA;AAAA;AAAA;AAAA,EAKA,cAAc,MAAA,EAA0B;AACtC,IAAA,IAAA,CAAK,WAAA,CAAY,GAAA,CAAI,MAAA,CAAO,WAAA,EAAa,MAAM,CAAA;AAG/C,IAAA,IAAI,OAAO,KAAA,KAAA,WAAA,kBAAmC;AAC5C,MAAA,IAAA,CAAK,OAAA,CAAQ,gBAAA,EAAA;AAAA,IACf,CAAA,MAAA,IAAW,OAAO,KAAA,KAAA,QAAA,eAAgC;AAChD,MAAA,IAAA,CAAK,OAAA,CAAQ,gBAAA,EAAA;AAAA,IACf,CAAA,MAAA,IAAW,OAAO,KAAA,KAAA,SAAA,gBAAiC;AACjD,MAAA,IAAA,CAAK,OAAA,CAAQ,gBAAA,EAAA;AAAA,IACf;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,YAAY,MAAA,EAIH;AACP,IAAA,IAAI,CAAC,MAAA,EAAQ;AAGb,IAAA,IAAI,OAAO,gBAAA,EAAkB;AAC3B,MAAA,MAAM,UAAU,IAAA,CAAK,GAAA,EAAI,GAAI,IAAA,CAAK,UAAU,OAAA,EAAQ;AACpD,MAAA,IAAI,OAAA,GAAU,OAAO,gBAAA,EAAkB;AACrC,QAAA,MAAM,IAAI,KAAA;AAAA,UACR,CAAA,+BAAA,EAAkC,OAAO,CAAA,KAAA,EAAQ,MAAA,CAAO,gBAAgB,CAAA,EAAA;AAAA,SAC1E;AAAA,MACF;AAAA,IACF;AAGA,IAAA,IAAI,OAAO,YAAA,IAAgB,IAAA,CAAK,SAAA,CAAU,IAAA,GAAO,OAAO,YAAA,EAAc;AACpE,MAAA,MAAM,IAAI,KAAA;AAAA,QACR,6BAA6B,IAAA,CAAK,SAAA,CAAU,IAAI,CAAA,GAAA,EAAM,OAAO,YAAY,CAAA;AAAA,OAC3E;AAAA,IACF;AAGA,IAAA,IAAI,OAAO,cAAA,EAAgB;AACzB,MAAA,MAAM,IAAA,GAAO,KAAK,YAAA,EAAa;AAC/B,MAAA,IAAI,IAAA,GAAO,OAAO,cAAA,EAAgB;AAChC,QAAA,MAAM,IAAI,KAAA;AAAA,UACR,CAAA,6BAAA,EAAgC,IAAI,CAAA,SAAA,EAAY,MAAA,CAAO,cAAc,CAAA,MAAA;AAAA,SACvE;AAAA,MACF;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,YAAA,GAAuB;AAC7B,IAAA,IAAI;AACF,MAAA,MAAM,IAAA,GAAO;AAAA,QACX,WAAW,KAAA,CAAM,IAAA,CAAK,IAAA,CAAK,SAAA,CAAU,QAAQ,CAAA;AAAA,QAC7C,aAAa,KAAA,CAAM,IAAA,CAAK,IAAA,CAAK,WAAA,CAAY,QAAQ,CAAA;AAAA,QACjD,YAAY,IAAA,CAAK,MAAA,CAAO,gBAAgB,MAAA,GAAS,IAAA,CAAK,aAAa,IAAA,CAAK,kBAAA;AAAA,QACxE,YAAY,IAAA,CAAK;AAAA,OACnB;AACA,MAAA,OAAO,IAAA,CAAK,SAAA,CAAU,IAAI,CAAA,CAAE,MAAA;AAAA,IAC9B,CAAA,CAAA,MAAQ;AACN,MAAA,OAAO,CAAA;AAAA,IACT;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,OAAA,GAAgB;AAEd,IAAA,MAAM,OAAA,GAAU;AAAA,MACd,aAAa,IAAA,CAAK,WAAA;AAAA,MAClB,iBAAiB,IAAA,CAAK,SAAA;AAAA,MACtB,cAAA,EAAgB,KAAK,OAAA,CAAQ,aAAA;AAAA,MAC7B,eAAe,IAAA,CAAK,GAAA,EAAI,GAAI,IAAA,CAAK,UAAU,OAAA,EAAQ;AAAA,MACnD,SAAS,CAAC,IAAA,CAAK,aAAa,IAAA,CAAK,OAAA,CAAQ,OAAO,MAAA,KAAW;AAAA,KAC7D;AAGA,IAAA,IAAA,CAAK,UAAU,KAAA,EAAM;AACrB,IAAA,IAAA,CAAK,YAAY,KAAA,EAAM;AACvB,IAAA,IAAA,CAAK,SAAS,KAAA,EAAM;AAGpB,IAAA,IAAA,CAAK,WAAW,MAAA,GAAS,CAAA;AACzB,IAAA,IAAA,CAAK,mBAAmB,MAAA,GAAS,CAAA;AACjC,IAAA,IAAA,CAAK,WAAW,MAAA,GAAS,CAAA;AACzB,IAAA,IAAA,CAAK,OAAA,CAAQ,OAAO,MAAA,GAAS,CAAA;AAG7B,IAAA,IAAA,CAAK,QAAA,CAAS,GAAA,CAAI,mBAAA,EAAqB,OAAO,CAAA;AAAA,EAChD;AAAA;AAAA;AAAA;AAAA,EAKA,UAAA,GAAa;AACX,IAAA,OAAO;AAAA,MACL,aAAa,IAAA,CAAK,WAAA;AAAA,MAClB,WAAW,IAAA,CAAK,SAAA;AAAA,MAChB,kBAAkB,IAAA,CAAK,SAAA;AAAA,MACvB,QAAQ,IAAA,CAAK,MAAA;AAAA,MACb,WAAW,IAAA,CAAK,SAAA;AAAA,MAChB,OAAA,EAAS,EAAE,GAAG,IAAA,CAAK,OAAA,EAAQ;AAAA,MAC3B,eAAe,IAAA,CAAK,GAAA,EAAI,GAAI,IAAA,CAAK,UAAU,OAAA;AAAQ,KACrD;AAAA,EACF;AACF;;;AC7TO,IAAM,cAAN,MAAkB;AAAA,EACf,KAAA,uBAA6C,GAAA,EAAI;AAAA,EACjD,OAAA;AAAA,EACA,QAAA;AAAA;AAAA,EAEA,eAAA,uBAA2C,GAAA,EAAI;AAAA;AAAA,EAE/C,aAAA,uBAAiC,GAAA,EAAI;AAAA,EACrC,oBAAA,GAA+B,CAAA;AAAA,EAC/B,OAAA;AAAA,EAER,WAAA,CACE,MAAA,GAAqB,EAAC,EACtB,SACA,aAAA,EACA;AACA,IAAA,IAAA,CAAK,OAAA,GAAU,OAAO,WAAA,IAAe,GAAA;AACrC,IAAA,IAAA,CAAK,QAAA,GAAW,OAAO,aAAA,IAAiB,KAAA;AACxC,IAAA,IAAA,CAAK,OAAA,GAAU,OAAA;AACf,IAAA,IAAA,CAAK,oBAAA,GAAuB,eAAe,oBAAA,IAAwB,CAAA;AAGnE,IAAA,IAAA,CAAK,mBAAmB,MAAM,CAAA;AAAA,EAChC;AAAA;AAAA;AAAA;AAAA,EAKQ,mBAAmB,MAAA,EAA0B;AACnD,IAAA,MAAM,SAAA,GAAwB;AAAA,MAC5B,kBAAA;AAAA,MACA,iBAAA;AAAA,MACA,YAAA;AAAA,MACA,WAAA;AAAA,MACA,aAAA;AAAA,MACA,YAAA;AAAA,MACA,cAAA;AAAA,MACA;AAAA,KACF;AAEA,IAAA,KAAA,MAAW,QAAQ,SAAA,EAAW;AAC5B,MAAA,MAAM,IAAA,GAAO,OAAO,IAAI,CAAA;AACxB,MAAA,IAAI,IAAA,EAAM;AACR,QAAA,IAAA,CAAK,QAAA,CAAS,MAAM,IAAI,CAAA;AAAA,MAC1B;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,QAAA,CAAS,MAAgB,IAAA,EAA4B;AAEnD,IAAA,IAAI,OAAO,SAAS,UAAA,EAAY;AAC9B,MAAA,MAAM,IAAI,KAAA,CAAM,CAAA,8BAAA,EAAiC,OAAO,IAAI,CAAA,CAAE,CAAA;AAAA,IAChE;AAGA,IAAA,IAAI,CAAC,IAAA,CAAK,KAAA,CAAM,GAAA,CAAI,IAAI,CAAA,EAAG;AACzB,MAAA,IAAA,CAAK,KAAA,CAAM,GAAA,CAAI,IAAA,EAAM,EAAE,CAAA;AAAA,IACzB;AAEA,IAAA,MAAM,QAAA,GAAW,IAAA,CAAK,KAAA,CAAM,GAAA,CAAI,IAAI,CAAA;AAGpC,IAAA,IAAI,QAAA,CAAS,UAAU,EAAA,EAAI;AACzB,MAAA,MAAM,IAAI,KAAA,CAAM,CAAA,mBAAA,EAAsB,IAAI,CAAA,UAAA,CAAY,CAAA;AAAA,IACxD;AAEA,IAAA,QAAA,CAAS,KAAK,IAAI,CAAA;AAAA,EACpB;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,YAAA,CACJ,IAAA,EACA,OAAA,EACA,aAAA,EACsC;AACtC,IAAA,MAAM,KAAA,GAAQ,IAAA,CAAK,KAAA,CAAM,GAAA,CAAI,IAAI,CAAA;AAEjC,IAAA,IAAI,CAAC,KAAA,IAAS,KAAA,CAAM,MAAA,KAAW,CAAA,EAAG;AAChC,MAAA,OAAO,aAAA;AAAA,IACT;AAGA,IAAA,IAAI,IAAA,CAAK,QAAA,IAAY,KAAA,CAAM,MAAA,GAAS,CAAA,EAAG;AACrC,MAAA,OAAO,IAAA,CAAK,oBAAA,CAAqB,KAAA,EAAO,OAAA,EAAS,aAAa,CAAA;AAAA,IAChE;AAGA,IAAA,OAAO,IAAA,CAAK,sBAAA,CAAuB,KAAA,EAAO,OAAA,EAAS,aAAa,CAAA;AAAA,EAClE;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,sBAAA,CACZ,KAAA,EACA,OAAA,EACA,aAAA,EACY;AACZ,IAAA,IAAI,MAAA,GAAS,aAAA;AAEb,IAAA,KAAA,IAAS,CAAA,GAAI,CAAA,EAAG,CAAA,GAAI,KAAA,CAAM,QAAQ,CAAA,EAAA,EAAK;AACrC,MAAA,MAAM,IAAA,GAAO,MAAM,CAAC,CAAA;AACpB,MAAA,MAAM,OAAA,GAAU,IAAA,CAAK,UAAA,CAAW,IAAA,EAAM,CAAC,CAAA;AACvC,MAAA,MAAM,aAAa,MAAM,IAAA,CAAK,iBAAA,CAAkB,IAAA,EAAM,SAAS,OAAO,CAAA;AAGtE,MAAA,IAAI,eAAe,IAAA,EAAM;AACvB,QAAA;AAAA,MACF;AAGA,MAAA,MAAA,GAAS,EAAE,GAAG,MAAA,EAAQ,GAAG,UAAA,EAAW;AAGpC,MAAA,IAAK,UAAA,CAAmB,SAAS,IAAA,EAAM;AACrC,QAAA;AAAA,MACF;AAAA,IACF;AAEA,IAAA,OAAO,MAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,oBAAA,CACZ,KAAA,EACA,OAAA,EACA,aAAA,EACY;AAEZ,IAAA,MAAM,OAAA,GAAU,MAAM,OAAA,CAAQ,GAAA;AAAA,MAC5B,KAAA,CAAM,GAAA,CAAI,CAAC,IAAA,EAAM,CAAA,KAAM;AACrB,QAAA,MAAM,OAAA,GAAU,IAAA,CAAK,UAAA,CAAW,IAAA,EAAM,CAAC,CAAA;AACvC,QAAA,OAAO,IAAA,CAAK,iBAAA,CAAkB,IAAA,EAAM,OAAA,EAAS,OAAO,CAAA;AAAA,MACtD,CAAC;AAAA,KACH;AAGA,IAAA,MAAM,eAAe,OAAA,CAAQ,MAAA,CAAO,CAAC,CAAA,KAAM,MAAM,IAAI,CAAA;AAErD,IAAA,OAAO,YAAA,CAAa,MAAA;AAAA,MAClB,CAAC,GAAA,EAAK,UAAA,MAAgB,EAAE,GAAG,GAAA,EAAK,GAAG,UAAA,EAAW,CAAA;AAAA,MAC9C;AAAA,KACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,UAAA,CAAW,MAAsB,KAAA,EAAuB;AAC9D,IAAA,OAAO,CAAA,EAAG,IAAA,CAAK,IAAA,IAAQ,WAAW,IAAI,KAAK,CAAA,CAAA;AAAA,EAC7C;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,iBAAA,CACZ,IAAA,EACA,OAAA,EACA,OAAA,EACmB;AACnB,IAAA,MAAM,GAAA,GAAM,OAAA,IAAW,IAAA,CAAK,IAAA,IAAQ,WAAA;AAGpC,IAAA,IAAI,IAAA,CAAK,aAAA,CAAc,GAAA,CAAI,GAAG,CAAA,EAAG;AAC/B,MAAA,OAAO,IAAA;AAAA,IACT;AAEA,IAAA,MAAM,SAAA,GAAY,KAAK,GAAA,EAAI;AAE3B,IAAA,IAAI;AAEF,MAAA,MAAM,MAAA,GAAS,MAAM,OAAA,CAAQ,IAAA,CAAK;AAAA,QAChC,KAAK,OAAO,CAAA;AAAA,QACZ,IAAI,OAAA;AAAA,UAAe,CAAC,CAAA,EAAG,MAAA,KACrB,UAAA,CAAW,MAAM,MAAA,CAAO,IAAI,KAAA,CAAM,cAAc,CAAC,CAAA,EAAG,IAAA,CAAK,OAAO;AAAA;AAClE,OACD,CAAA;AAGD,MAAA,IAAA,CAAK,eAAA,CAAgB,OAAO,GAAG,CAAA;AAG/B,MAAA,MAAM,QAAA,GAAW,IAAA,CAAK,GAAA,EAAI,GAAI,SAAA;AAC9B,MAAA,IAAI,OAAA,CAAQ,SAAS,aAAA,EAAe;AAClC,QAAA,OAAA,CAAQ,QAAQ,aAAA,CAAc;AAAA,UAC5B,YAAA,EAAA,CAAe,OAAA,CAAQ,OAAA,CAAQ,OAAA,CAAQ,gBAAgB,CAAA,IAAK;AAAA,SAC7D,CAAA;AAAA,MACH;AAEA,MAAA,OAAO,MAAA;AAAA,IACT,SAAS,KAAA,EAAO;AAEd,MAAA,MAAM,cAAc,IAAA,CAAK,eAAA,CAAgB,GAAA,CAAI,GAAG,KAAK,CAAA,IAAK,CAAA;AAC1D,MAAA,IAAA,CAAK,eAAA,CAAgB,GAAA,CAAI,GAAA,EAAK,UAAU,CAAA;AAGxC,MAAA,IAAA,CAAK,OAAA,CAAQ,KAAK,YAAA,EAAc;AAAA,QAC9B,aAAa,OAAA,CAAQ,WAAA;AAAA,QACrB,QAAA,EAAU,KAAK,IAAA,IAAQ,WAAA;AAAA,QACvB,KAAA;AAAA,QACA,iBAAA,EAAmB,UAAA;AAAA,QACnB,SAAA,sBAAe,IAAA;AAAK,OACrB,CAAA;AAGD,MAAA,IAAI,UAAA,IAAc,KAAK,oBAAA,EAAsB;AAE3C,QAAA,IAAA,CAAK,aAAA,CAAc,IAAI,GAAG,CAAA;AAC1B,QAAA,OAAA,CAAQ,IAAA;AAAA,UACN,SAAS,GAAG,CAAA,iBAAA,EAAoB,UAAU,CAAA,mCAAA,EAAuC,MAAgB,OAAO,CAAA;AAAA,SAC1G;AAAA,MACF,CAAA,MAAO;AAEL,QAAA,OAAA,CAAQ,IAAA;AAAA,UACN,CAAA,uBAAA,EAA0B,GAAG,CAAA,GAAA,EAAO,KAAA,CAAgB,OAAO,CAAA,EAAA,EAAK,UAAU,CAAA,CAAA,EAAI,IAAA,CAAK,oBAAoB,CAAA,QAAA;AAAA,SACzG;AAAA,MACF;AAEA,MAAA,OAAO,IAAA;AAAA,IACT;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,SAAS,IAAA,EAAyB;AAChC,IAAA,MAAM,KAAA,GAAQ,IAAA,CAAK,KAAA,CAAM,GAAA,CAAI,IAAI,CAAA;AACjC,IAAA,OAAO,CAAC,CAAC,KAAA,IAAS,KAAA,CAAM,MAAA,GAAS,CAAA;AAAA,EACnC;AAAA;AAAA;AAAA;AAAA,EAKA,aAAa,IAAA,EAAyB;AACpC,IAAA,IAAI,IAAA,EAAM;AACR,MAAA,OAAO,IAAA,CAAK,KAAA,CAAM,GAAA,CAAI,IAAI,GAAG,MAAA,IAAU,CAAA;AAAA,IACzC;AAEA,IAAA,OAAO,KAAA,CAAM,IAAA,CAAK,IAAA,CAAK,KAAA,CAAM,QAAQ,CAAA,CAAE,MAAA,CAAO,CAAC,GAAA,EAAK,GAAA,KAAQ,GAAA,GAAM,GAAA,CAAI,QAAQ,CAAC,CAAA;AAAA,EACjF;AAAA;AAAA;AAAA;AAAA,EAKA,KAAA,GAAc;AACZ,IAAA,IAAA,CAAK,MAAM,KAAA,EAAM;AACjB,IAAA,IAAA,CAAK,gBAAgB,KAAA,EAAM;AAC3B,IAAA,IAAA,CAAK,cAAc,KAAA,EAAM;AAAA,EAC3B;AAAA;AAAA;AAAA;AAAA,EAKA,WAAW,OAAA,EAAuB;AAChC,IAAA,IAAA,CAAK,aAAA,CAAc,OAAO,OAAO,CAAA;AACjC,IAAA,IAAA,CAAK,eAAA,CAAgB,OAAO,OAAO,CAAA;AAAA,EACrC;AAAA;AAAA;AAAA;AAAA,EAKA,gBAAA,GAA6B;AAC3B,IAAA,OAAO,KAAA,CAAM,IAAA,CAAK,IAAA,CAAK,aAAa,CAAA;AAAA,EACtC;AACF;;;ACxQO,IAAM,cAAN,MAAkB;AAAA;AAAA,EAEhB,UAAA;AAAA,EACA,KAAA;AAAA,EACA,SAAA;AAAA;AAAA,EAGC,WAAA;AAAA;AAAA,EAGA,eAAA;AAAA;AAAA,EAGA,kBAAA;AAAA;AAAA,EAGA,WAAA;AAAA;AAAA,EAGD,gBAAA;AAAA,EACA,KAAA;AAAA,EACA,MAAA;AAAA,EACA,SAAA;AAAA,EACA,OAAA;AAAA;AAAA,EAGA,WAAA;AAAA,EACA,eAAA;AAAA,EACA,cAAA;AAAA,EAEP,WAAA,CAAY,UAAA,EAAoB,KAAA,EAAe,SAAA,EAAoB;AACjE,IAAA,IAAA,CAAK,UAAA,GAAa,UAAA;AAClB,IAAA,IAAA,CAAK,KAAA,GAAQ,KAAA;AACb,IAAA,IAAA,CAAK,SAAA,GAAY,SAAA,IAAa,IAAA,CAAK,GAAA,EAAI;AAEvC,IAAA,IAAA,CAAK,WAAA,uBAAkB,GAAA,EAAI;AAC3B,IAAA,IAAA,CAAK,eAAA,uBAAsB,GAAA,EAAI;AAC/B,IAAA,IAAA,CAAK,qBAAqB,EAAC;AAC3B,IAAA,IAAA,CAAK,WAAA,uBAAkB,GAAA,EAAI;AAE3B,IAAA,IAAA,CAAK,gBAAA,GAAmB,CAAA;AACxB,IAAA,IAAA,CAAK,KAAA,GAAQ;AAAA,MACX,YAAA,EAAc,CAAA;AAAA,MACd,aAAA,EAAe,CAAA;AAAA,MACf,YAAA,EAAc;AAAA,KAChB;AACA,IAAA,IAAA,CAAK,MAAA,GAAS,aAAA;AACd,IAAA,IAAA,CAAK,SAAA,uBAAgB,IAAA,EAAK;AAE1B,IAAA,IAAA,CAAK,WAAA,GAAc,CAAA;AACnB,IAAA,IAAA,CAAK,eAAA,GAAkB,CAAA;AACvB,IAAA,IAAA,CAAK,cAAA,GAAiB,CAAA;AAAA,EACxB;AAAA;AAAA;AAAA;AAAA,EAKA,mBAAA,CAAoB,QAAgB,KAAA,EAAqB;AACvD,IAAA,IAAI,CAAC,IAAA,CAAK,WAAA,CAAY,GAAA,CAAI,MAAM,CAAA,EAAG;AACjC,MAAA,IAAA,CAAK,WAAA,CAAY,GAAA,CAAI,MAAA,EAAQ,EAAE,CAAA;AAAA,IACjC;AACA,IAAA,IAAA,CAAK,WAAA,CAAY,GAAA,CAAI,MAAM,CAAA,CAAG,KAAK,KAAK,CAAA;AACxC,IAAA,IAAA,CAAK,eAAA,EAAA;AACL,IAAA,IAAA,CAAK,WAAA,EAAA;AAAA,EACP;AAAA;AAAA;AAAA;AAAA,EAKA,gBAAgB,MAAA,EAAwB;AACtC,IAAA,MAAM,MAAA,GAAS,IAAA,CAAK,WAAA,CAAY,GAAA,CAAI,MAAM,CAAA;AAC1C,IAAA,OAAO,MAAA,GAAS,MAAA,CAAO,IAAA,CAAK,EAAE,CAAA,GAAI,EAAA;AAAA,EACpC;AAAA;AAAA;AAAA;AAAA,EAKA,UAAA,GAAqB;AACnB,IAAA,MAAM,UAAoB,EAAC;AAC3B,IAAA,KAAA,MAAW,MAAA,IAAU,IAAA,CAAK,WAAA,CAAY,MAAA,EAAO,EAAG;AAC9C,MAAA,OAAA,CAAQ,IAAA,CAAK,MAAA,CAAO,IAAA,CAAK,EAAE,CAAC,CAAA;AAAA,IAC9B;AACA,IAAA,OAAO,OAAA,CAAQ,KAAK,EAAE,CAAA;AAAA,EACxB;AAAA;AAAA;AAAA;AAAA,EAKA,aAAA,CAAc,YAAoB,QAAA,EAAwB;AACxD,IAAA,IAAA,CAAK,eAAA,CAAgB,IAAI,UAAA,EAAY;AAAA,MACnC,QAAA;AAAA,MACA,gBAAgB,EAAC;AAAA,MACjB,UAAA,EAAY,KAAA;AAAA,MACZ,SAAA,sBAAe,IAAA;AAAK,KACrB,CAAA;AAAA,EACH;AAAA;AAAA;AAAA;AAAA,EAKA,uBAAA,CAAwB,YAAoB,KAAA,EAAqB;AAC/D,IAAA,MAAM,MAAA,GAAS,IAAA,CAAK,eAAA,CAAgB,GAAA,CAAI,UAAU,CAAA;AAClD,IAAA,IAAI,CAAC,MAAA,EAAQ;AACX,MAAA,MAAM,IAAI,KAAA,CAAM,CAAA,mCAAA,EAAsC,UAAU,CAAA,CAAE,CAAA;AAAA,IACpE;AACA,IAAA,MAAA,CAAO,cAAA,CAAe,KAAK,KAAK,CAAA;AAChC,IAAA,IAAA,CAAK,WAAA,EAAA;AAAA,EACP;AAAA;AAAA;AAAA;AAAA,EAKA,iBAAiB,UAAA,EAA0B;AACzC,IAAA,MAAM,MAAA,GAAS,IAAA,CAAK,eAAA,CAAgB,GAAA,CAAI,UAAU,CAAA;AAClD,IAAA,IAAI,CAAC,MAAA,EAAQ;AACX,MAAA,MAAM,IAAI,KAAA,CAAM,CAAA,mCAAA,EAAsC,UAAU,CAAA,CAAE,CAAA;AAAA,IACpE;AACA,IAAA,MAAA,CAAO,UAAA,GAAa,IAAA;AACpB,IAAA,IAAA,CAAK,cAAA,EAAA;AAAA,EACP;AAAA;AAAA;AAAA;AAAA,EAKA,yBAAyB,UAAA,EAA4B;AACnD,IAAA,MAAM,MAAA,GAAS,IAAA,CAAK,eAAA,CAAgB,GAAA,CAAI,UAAU,CAAA;AAClD,IAAA,IAAI,CAAC,MAAA,EAAQ;AACX,MAAA,MAAM,IAAI,KAAA,CAAM,CAAA,mCAAA,EAAsC,UAAU,CAAA,CAAE,CAAA;AAAA,IACpE;AACA,IAAA,OAAO,MAAA,CAAO,cAAA,CAAe,IAAA,CAAK,EAAE,CAAA;AAAA,EACtC;AAAA;AAAA;AAAA;AAAA,EAKA,mBAAmB,UAAA,EAA6B;AAC9C,IAAA,MAAM,MAAA,GAAS,IAAA,CAAK,eAAA,CAAgB,GAAA,CAAI,UAAU,CAAA;AAClD,IAAA,OAAO,MAAA,GAAS,OAAO,UAAA,GAAa,KAAA;AAAA,EACtC;AAAA;AAAA;AAAA;AAAA,EAKA,YAAY,UAAA,EAAwC;AAClD,IAAA,OAAO,IAAA,CAAK,eAAA,CAAgB,GAAA,CAAI,UAAU,CAAA,EAAG,QAAA;AAAA,EAC/C;AAAA;AAAA;AAAA;AAAA,EAKA,qBAAqB,QAAA,EAA0B;AAC7C,IAAA,IAAA,CAAK,kBAAA,CAAmB,KAAK,QAAQ,CAAA;AAAA,EACvC;AAAA;AAAA;AAAA;AAAA,EAKA,qBAAA,GAAoC;AAClC,IAAA,OAAO,CAAC,GAAG,IAAA,CAAK,kBAAkB,CAAA;AAAA,EACpC;AAAA;AAAA;AAAA;AAAA,EAKA,aAAA,CAAc,YAAoB,MAAA,EAAmB;AACnD,IAAA,IAAA,CAAK,WAAA,CAAY,GAAA,CAAI,UAAA,EAAY,MAAM,CAAA;AAAA,EACzC;AAAA;AAAA;AAAA;AAAA,EAKA,cAAc,UAAA,EAAyB;AACrC,IAAA,OAAO,IAAA,CAAK,WAAA,CAAY,GAAA,CAAI,UAAU,CAAA;AAAA,EACxC;AAAA;AAAA;AAAA;AAAA,EAKA,YAAY,KAAA,EAAkC;AAC5C,IAAA,IAAI,KAAA,CAAM,iBAAiB,MAAA,EAAW;AACpC,MAAA,IAAA,CAAK,KAAA,CAAM,eAAe,KAAA,CAAM,YAAA;AAAA,IAClC;AACA,IAAA,IAAI,KAAA,CAAM,kBAAkB,MAAA,EAAW;AACrC,MAAA,IAAA,CAAK,KAAA,CAAM,gBAAgB,KAAA,CAAM,aAAA;AAAA,IACnC;AACA,IAAA,IAAI,KAAA,CAAM,iBAAiB,MAAA,EAAW;AACpC,MAAA,IAAA,CAAK,KAAA,CAAM,eAAe,KAAA,CAAM,YAAA;AAAA,IAClC,CAAA,MAAO;AAEL,MAAA,IAAA,CAAK,MAAM,YAAA,GAAe,IAAA,CAAK,KAAA,CAAM,YAAA,GAAe,KAAK,KAAA,CAAM,aAAA;AAAA,IACjE;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,gBAAgB,KAAA,EAAkC;AAChD,IAAA,IAAI,KAAA,CAAM,iBAAiB,MAAA,EAAW;AACpC,MAAA,IAAA,CAAK,KAAA,CAAM,gBAAgB,KAAA,CAAM,YAAA;AAAA,IACnC;AACA,IAAA,IAAI,KAAA,CAAM,kBAAkB,MAAA,EAAW;AACrC,MAAA,IAAA,CAAK,KAAA,CAAM,iBAAiB,KAAA,CAAM,aAAA;AAAA,IACpC;AACA,IAAA,IAAI,KAAA,CAAM,iBAAiB,MAAA,EAAW;AACpC,MAAA,IAAA,CAAK,KAAA,CAAM,gBAAgB,KAAA,CAAM,YAAA;AAAA,IACnC,CAAA,MAAO;AAEL,MAAA,IAAA,CAAK,MAAM,YAAA,GAAe,IAAA,CAAK,KAAA,CAAM,YAAA,GAAe,KAAK,KAAA,CAAM,aAAA;AAAA,IACjE;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,YAAA,CAAa,SAAgD,WAAA,EAAmB;AAC9E,IAAA,IAAA,CAAK,MAAA,GAAS,MAAA;AACd,IAAA,IAAA,CAAK,OAAA,uBAAc,IAAA,EAAK;AAAA,EAC1B;AAAA;AAAA;AAAA;AAAA,EAKA,WAAA,GAAsB;AACpB,IAAA,MAAM,GAAA,GAAM,IAAA,CAAK,OAAA,oBAAW,IAAI,IAAA,EAAK;AACrC,IAAA,OAAO,GAAA,CAAI,OAAA,EAAQ,GAAI,IAAA,CAAK,UAAU,OAAA,EAAQ;AAAA,EAChD;AAAA;AAAA;AAAA;AAAA,EAKA,kBAAA,GAA2B;AACzB,IAAA,IAAA,CAAK,gBAAA,EAAA;AAAA,EACP;AAAA;AAAA;AAAA;AAAA,EAKA,aAAA,GAAgB;AACd,IAAA,OAAO;AAAA,MACL,YAAY,IAAA,CAAK,UAAA;AAAA,MACjB,OAAO,IAAA,CAAK,KAAA;AAAA,MACZ,QAAQ,IAAA,CAAK,MAAA;AAAA,MACb,YAAY,IAAA,CAAK,gBAAA;AAAA,MACjB,aAAa,IAAA,CAAK,WAAA;AAAA,MAClB,iBAAiB,IAAA,CAAK,eAAA;AAAA,MACtB,gBAAgB,IAAA,CAAK,cAAA;AAAA,MACrB,cAAA,EAAgB,KAAK,WAAA,CAAY,IAAA;AAAA,MACjC,oBAAA,EAAsB,KAAK,eAAA,CAAgB,IAAA;AAAA,MAC3C,uBAAA,EAAyB,KAAK,kBAAA,CAAmB,MAAA;AAAA,MACjD,UAAA,EAAY,KAAK,WAAA,EAAY;AAAA,MAC7B,KAAA,EAAO,EAAE,GAAG,IAAA,CAAK,KAAA;AAAM,KACzB;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,OAAA,GAAmB;AACjB,IAAA,OAAO,IAAA,CAAK,YAAY,IAAA,GAAO,CAAA;AAAA,EACjC;AAAA;AAAA;AAAA;AAAA,EAKA,YAAA,GAAwB;AACtB,IAAA,OAAO,IAAA,CAAK,gBAAgB,IAAA,GAAO,CAAA;AAAA,EACrC;AAAA;AAAA;AAAA;AAAA,EAKA,KAAA,GAAc;AACZ,IAAA,IAAA,CAAK,YAAY,KAAA,EAAM;AACvB,IAAA,IAAA,CAAK,gBAAgB,KAAA,EAAM;AAC3B,IAAA,IAAA,CAAK,qBAAqB,EAAC;AAC3B,IAAA,IAAA,CAAK,YAAY,KAAA,EAAM;AAAA,EACzB;AAAA;AAAA;AAAA;AAAA,EAKA,cAAA,GAAiB;AACf,IAAA,OAAO;AAAA,MACL,YAAY,IAAA,CAAK,UAAA;AAAA,MACjB,OAAO,IAAA,CAAK,KAAA;AAAA,MACZ,WAAW,IAAA,CAAK,SAAA;AAAA,MAChB,WAAA,EAAa,IAAI,GAAA,CAAI,IAAA,CAAK,WAAW,CAAA;AAAA,MACrC,eAAA,EAAiB,IAAI,GAAA,CAAI,IAAA,CAAK,eAAe,CAAA;AAAA,MAC7C,kBAAA,EAAoB,CAAC,GAAG,IAAA,CAAK,kBAAkB,CAAA;AAAA,MAC/C,WAAA,EAAa,IAAI,GAAA,CAAI,IAAA,CAAK,WAAW,CAAA;AAAA,MACrC,kBAAkB,IAAA,CAAK,gBAAA;AAAA,MACvB,KAAA,EAAO,EAAE,GAAG,IAAA,CAAK,KAAA,EAAM;AAAA,MACvB,QAAQ,IAAA,CAAK,MAAA;AAAA,MACb,WAAW,IAAA,CAAK,SAAA;AAAA,MAChB,SAAS,IAAA,CAAK;AAAA,KAChB;AAAA,EACF;AACF;;;ACpOO,IAAM,WAAA,GAAN,cAA0BX,YAAAA,CAAgC;AAAA,EAY/D,WAAA,CACU,QAAA,EACA,YAAA,EACR,UAAA,EACA,aAAA,EACA;AACA,IAAA,KAAA,EAAM;AALE,IAAA,IAAA,CAAA,QAAA,GAAA,QAAA;AACA,IAAA,IAAA,CAAA,YAAA,GAAA,YAAA;AAKR,IAAA,IAAA,CAAK,cAAc,IAAI,WAAA;AAAA,MACrB,cAAc,EAAC;AAAA,MACf,IAAA;AAAA,MACA;AAAA,KACF;AAAA,EACF;AAAA,EAvBQ,WAAA;AAAA,EACA,OAAA,GAAmC,IAAA;AAAA;AAAA,EAGnC,MAAA,GAAkB,KAAA;AAAA,EAClB,YAAA,GAAqC,IAAA;AAAA,EACrC,cAAA,GAAsC,IAAA;AAAA,EACtC,SAAA,GAAqB,KAAA;AAAA;AAAA,EAErB,gBAAA,GAAkC,QAAQ,OAAA,EAAQ;AAAA;AAAA;AAAA;AAAA,EAmB1D,MAAM,QAAQ,MAAA,EAAmD;AAE/D,IAAA,MAAM,WAAA,GAAc,CAAA,KAAA,EAAQS,UAAAA,EAAY,CAAA,CAAA;AAGxC,IAAA,IAAA,CAAK,OAAA,GAAU,IAAI,gBAAA,CAAiB,WAAA,EAAa;AAAA,MAC/C,cAAA,EAAgB,EAAA;AAAA,MAChB,WAAA,EAAa,OAAO,WAAA,IAAe,SAAA;AAAA,MACnC,iBAAA,EAAmB;AAAA,KACpB,CAAA;AAGD,IAAA,IAAA,CAAK,MAAA,GAAS,KAAA;AACd,IAAA,IAAA,CAAK,SAAA,GAAY,KAAA;AAGjB,IAAA,MAAM,eAAA,GAAkB,CAAC,CAAC,MAAA,CAAO,YAAA;AACjC,IAAA,MAAM,eAAe,MAAA,CAAO,YAAA;AAG5B,IAAA,IAAI,mBAAmB,YAAA,EAAc;AACnC,MAAA,IAAI,OAAO,MAAA,CAAO,KAAA,KAAU,QAAA,EAAU;AACpC,QAAA,YAAA,CAAa,cAAA,CAAe,OAAO,KAAK,CAAA;AAAA,MAC1C,CAAA,MAAA,IAAW,KAAA,CAAM,OAAA,CAAQ,MAAA,CAAO,KAAK,CAAA,EAAG;AACtC,QAAA,YAAA,CAAa,aAAA,CAAc,OAAO,KAAK,CAAA;AAAA,MACzC;AAAA,IACF;AAGA,IAAA,IAAA,CAAK,KAAK,iBAAA,EAAmB;AAAA,MAC3B,WAAA;AAAA,MACA,MAAA;AAAA,MACA,SAAA,sBAAe,IAAA;AAAK,KACrB,CAAA;AAGD,IAAA,MAAM,IAAA,CAAK,WAAA,CAAY,YAAA,CAAa,kBAAA,EAAoB;AAAA,MACtD,WAAA;AAAA,MACA,MAAA;AAAA,MACA,SAAA,sBAAe,IAAA;AAAK,OACnB,MAAgB,CAAA;AAGnB,IAAA,IAAI,eAAe,MAAA,CAAO,KAAA;AAC1B,IAAA,IAAI,SAAA,GAAY,CAAA;AAChB,IAAA,IAAI,aAAA;AAEJ,IAAA,IAAI;AACF,MAAA,OAAO,SAAA,GAAY,OAAO,aAAA,EAAe;AAEvC,QAAA,MAAM,KAAK,UAAA,EAAW;AAGtB,QAAA,IAAI,KAAK,SAAA,EAAW;AAClB,UAAA,MAAM,IAAI,MAAM,qBAAqB,CAAA;AAAA,QACvC;AAGA,QAAA,IAAA,CAAK,OAAA,CAAQ,WAAA,CAAY,MAAA,CAAO,MAAM,CAAA;AAGtC,QAAA,MAAM,UAAA,GAAa,MAAM,IAAA,CAAK,WAAA,CAAY,aAAa,aAAA,EAAe;AAAA,UACpE,WAAA;AAAA,UACA,SAAA;AAAA,UACA,SAAS,IAAA,CAAK,OAAA;AAAA,UACd,SAAA,sBAAe,IAAA;AAAK,SACtB,EAAG,EAAE,WAAA,EAAa,KAAA,EAAO,CAAA;AAEzB,QAAA,IAAI,WAAW,WAAA,EAAa;AAC1B,UAAA,IAAA,CAAK,KAAA,CAAM,UAAA,CAAW,MAAA,IAAU,sBAAsB,CAAA;AACtD,UAAA,MAAM,KAAK,UAAA,EAAW;AAAA,QACxB;AAGA,QAAA,IAAA,CAAK,QAAQ,SAAA,GAAY,SAAA;AAGzB,QAAA,IAAA,CAAK,KAAK,iBAAA,EAAmB;AAAA,UAC3B,WAAA;AAAA,UACA,SAAA;AAAA,UACA,SAAA,sBAAe,IAAA;AAAK,SACrB,CAAA;AAED,QAAA,MAAM,kBAAA,GAAqB,KAAK,GAAA,EAAI;AAGpC,QAAA,IAAI,QAAA;AACJ,QAAA,IAAI,mBAAmB,YAAA,EAAc;AAEnC,UAAA,MAAM,QAAA,GAAW,MAAM,YAAA,CAAa,mBAAA,CAAoB;AAAA,YACtD,qBAAqB,MAAA,CAAO;AAAA,WAC7B,CAAA;AACD,UAAA,QAAA,GAAW,QAAA,CAAS,KAAA;AAAA,QACtB,CAAA,MAAO;AAEL,UAAA,QAAA,GAAW,YAAA;AAAA,QACb;AAGA,QAAA,MAAM,WAAW,MAAM,IAAA,CAAK,kBAAkB,MAAA,EAAQ,QAAA,EAAU,WAAW,WAAW,CAAA;AAGtF,QAAA,MAAM,YAAY,IAAA,CAAK,gBAAA,CAAiB,QAAA,CAAS,MAAA,EAAQ,OAAO,KAAK,CAAA;AAGrE,QAAA,IAAI,mBAAmB,YAAA,EAAc;AACnC,UAAA,YAAA,CAAa,oBAAA,CAAqB,SAAS,MAAM,CAAA;AAAA,QACnD;AAGA,QAAA,IAAI,SAAA,CAAU,SAAS,CAAA,EAAG;AACxB,UAAA,IAAA,CAAK,KAAK,eAAA,EAAiB;AAAA,YACzB,WAAA;AAAA,YACA,SAAA;AAAA,YACA,SAAA;AAAA,YACA,SAAA,sBAAe,IAAA;AAAK,WACrB,CAAA;AAAA,QACH;AAGA,QAAA,IAAI,SAAA,CAAU,WAAW,CAAA,EAAG;AAE1B,UAAA,IAAA,CAAK,KAAK,oBAAA,EAAsB;AAAA,YAC9B,WAAA;AAAA,YACA,SAAA;AAAA,YACA,QAAA;AAAA,YACA,SAAA,sBAAe,IAAA,EAAK;AAAA,YACpB,QAAA,EAAU,IAAA,CAAK,GAAA,EAAI,GAAI;AAAA,WACxB,CAAA;AAED,UAAA,aAAA,GAAgB,QAAA;AAChB,UAAA;AAAA,QACF;AAGA,QAAA,MAAM,cAAc,MAAM,IAAA,CAAK,sBAAsB,SAAA,EAAW,SAAA,EAAW,aAAa,MAAM,CAAA;AAG9F,QAAA,IAAI,mBAAmB,YAAA,EAAc;AACnC,UAAA,YAAA,CAAa,eAAe,WAAW,CAAA;AAAA,QACzC;AAGA,QAAA,IAAA,CAAK,QAAQ,YAAA,CAAa;AAAA,UACxB,SAAA;AAAA,UACA,OAAA,EAAS;AAAA,YACP,OAAO,MAAA,CAAO,KAAA;AAAA,YACd,KAAA,EAAO,kBAAkB,QAAA,GAAW,YAAA;AAAA,YACpC,cAAc,MAAA,CAAO,YAAA;AAAA,YACrB,OAAO,MAAA,CAAO,KAAA;AAAA,YACd,aAAa,MAAA,CAAO;AAAA,WACtB;AAAA,UACA,QAAA;AAAA,UACA,SAAA;AAAA,UACA,WAAA;AAAA,UACA,SAAA,EAAW,IAAI,IAAA,CAAK,kBAAkB,CAAA;AAAA,UACtC,OAAA,sBAAa,IAAA;AAAK,SACnB,CAAA;AAGD,QAAA,IAAA,CAAK,QAAQ,aAAA,CAAc;AAAA,UACzB,gBAAgB,SAAA,GAAY,CAAA;AAAA,UAC5B,aAAa,IAAA,CAAK,OAAA,CAAQ,QAAQ,WAAA,IAAe,QAAA,CAAS,OAAO,YAAA,IAAgB,CAAA,CAAA;AAAA,UACjF,cAAc,IAAA,CAAK,OAAA,CAAQ,QAAQ,YAAA,IAAgB,QAAA,CAAS,OAAO,aAAA,IAAiB,CAAA,CAAA;AAAA,UACpF,aAAa,IAAA,CAAK,OAAA,CAAQ,QAAQ,WAAA,IAAe,QAAA,CAAS,OAAO,YAAA,IAAgB,CAAA;AAAA,SAClF,CAAA;AAGD,QAAA,IAAA,CAAK,KAAK,oBAAA,EAAsB;AAAA,UAC9B,WAAA;AAAA,UACA,SAAA;AAAA,UACA,QAAA;AAAA,UACA,SAAA,sBAAe,IAAA,EAAK;AAAA,UACpB,QAAA,EAAU,IAAA,CAAK,GAAA,EAAI,GAAI;AAAA,SACxB,CAAA;AAGD,QAAA,IAAI,CAAC,eAAA,EAAiB;AAEpB,UAAA,MAAM,WAAA,GAAc,IAAA,CAAK,gBAAA,CAAiB,QAAA,CAAS,QAAQ,WAAW,CAAA;AACtE,UAAA,YAAA,GAAe,IAAA,CAAK,eAAA,CAAgB,YAAA,EAAc,WAAW,CAAA;AAG7D,UAAA,MAAM,gBAAA,GAAmB,MAAA,CAAO,MAAA,EAAQ,gBAAA,IAAoB,EAAA;AAC5D,UAAA,YAAA,GAAe,IAAA,CAAK,kBAAA,CAAmB,YAAA,EAAc,gBAAgB,CAAA;AAAA,QACvE;AAEA,QAAA,SAAA,EAAA;AAAA,MACF;AAGA,MAAA,IAAI,SAAA,IAAa,OAAO,aAAA,EAAe;AACrC,QAAA,MAAM,IAAI,KAAA,CAAM,CAAA,gBAAA,EAAmB,MAAA,CAAO,aAAa,CAAA,4BAAA,CAA8B,CAAA;AAAA,MACvF;AAGA,MAAA,MAAM,gBAAgB,IAAA,CAAK,GAAA,KAAQ,IAAA,CAAK,OAAA,CAAQ,UAAU,OAAA,EAAQ;AAClE,MAAA,IAAA,CAAK,OAAA,CAAQ,aAAA,CAAc,EAAE,aAAA,EAAe,CAAA;AAG5C,MAAA,MAAM,IAAA,CAAK,WAAA,CAAY,YAAA,CAAa,iBAAA,EAAmB;AAAA,QACrD,WAAA;AAAA,QACA,QAAA,EAAU,aAAA;AAAA,QACV,SAAS,IAAA,CAAK,OAAA;AAAA,QACd,SAAA,sBAAe,IAAA,EAAK;AAAA,QACpB,QAAA,EAAU;AAAA,SACT,KAAA,CAAgB,CAAA;AAGnB,MAAA,IAAA,CAAK,KAAK,oBAAA,EAAsB;AAAA,QAC9B,WAAA;AAAA,QACA,QAAA,EAAU,aAAA;AAAA,QACV,SAAA,sBAAe,IAAA,EAAK;AAAA,QACpB,QAAA,EAAU;AAAA,OACX,CAAA;AAED,MAAA,OAAO,aAAA;AAAA,IACT,SAAS,KAAA,EAAO;AAEd,MAAA,IAAA,CAAK,KAAK,iBAAA,EAAmB;AAAA,QAC3B,WAAA;AAAA,QACA,KAAA;AAAA,QACA,SAAA,sBAAe,IAAA;AAAK,OACrB,CAAA;AAGD,MAAA,IAAA,CAAK,OAAA,EAAS,OAAA,CAAQ,MAAA,CAAO,IAAA,CAAK;AAAA,QAChC,IAAA,EAAM,iBAAA;AAAA,QACN,SAAU,KAAA,CAAgB,OAAA;AAAA,QAC1B,SAAA,sBAAe,IAAA;AAAK,OACrB,CAAA;AAED,MAAA,MAAM,KAAA;AAAA,IACR,CAAA,SAAE;AAEA,MAAA,IAAA,CAAK,SAAS,OAAA,EAAQ;AACtB,MAAA,IAAA,CAAK,YAAY,KAAA,EAAM;AAAA,IACzB;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,OAAO,iBAAiB,MAAA,EAA+D;AAErF,IAAA,MAAM,WAAA,GAAc,CAAA,KAAA,EAAQA,UAAAA,EAAY,CAAA,CAAA;AAGxC,IAAA,IAAA,CAAK,OAAA,GAAU,IAAI,gBAAA,CAAiB,WAAA,EAAa;AAAA,MAC/C,cAAA,EAAgB,EAAA;AAAA,MAChB,WAAA,EAAa,OAAO,WAAA,IAAe,SAAA;AAAA,MACnC,iBAAA,EAAmB;AAAA,KACpB,CAAA;AAGD,IAAA,IAAA,CAAK,MAAA,GAAS,KAAA;AACd,IAAA,IAAA,CAAK,SAAA,GAAY,KAAA;AACjB,IAAA,IAAA,CAAK,YAAA,GAAe,IAAA;AACpB,IAAA,IAAA,CAAK,cAAA,GAAiB,IAAA;AAGtB,IAAA,MAAM,eAAA,GAAkB,CAAC,CAAC,MAAA,CAAO,YAAA;AACjC,IAAA,MAAM,eAAe,MAAA,CAAO,YAAA;AAG5B,IAAA,IAAI,mBAAmB,YAAA,EAAc;AACnC,MAAA,IAAI,OAAO,MAAA,CAAO,KAAA,KAAU,QAAA,EAAU;AACpC,QAAA,YAAA,CAAa,cAAA,CAAe,OAAO,KAAK,CAAA;AAAA,MAC1C,CAAA,MAAA,IAAW,KAAA,CAAM,OAAA,CAAQ,MAAA,CAAO,KAAK,CAAA,EAAG;AACtC,QAAA,YAAA,CAAa,aAAA,CAAc,OAAO,KAAK,CAAA;AAAA,MACzC;AAAA,IACF;AAEA,IAAA,MAAM,SAAA,GAAY,KAAK,GAAA,EAAI;AAC3B,IAAA,IAAI,SAAA,GAAY,CAAA;AAChB,IAAA,IAAI,eAAqC,MAAA,CAAO,KAAA;AAGhD,IAAA,MAAM,iBAAA,GAAoB,IAAI,WAAA,CAAY,WAAA,EAAa,OAAO,KAAK,CAAA;AAEnE,IAAA,IAAI;AAEF,MAAA,IAAA,CAAK,KAAK,iBAAA,EAAmB;AAAA,QAC3B,WAAA;AAAA,QACA,OAAO,MAAA,CAAO,KAAA;AAAA,QACd,SAAA,sBAAe,IAAA;AAAK,OACrB,CAAA;AAGD,MAAA,MAAM,IAAA,CAAK,WAAA,CAAY,YAAA,CAAa,kBAAA,EAAoB;AAAA,QACtD,WAAA;AAAA,QACA,MAAA;AAAA,QACA,SAAA,sBAAe,IAAA;AAAK,SACnB,KAAA,CAAgB,CAAA;AAGnB,MAAA,OAAO,SAAA,GAAY,OAAO,aAAA,EAAe;AACvC,QAAA,SAAA,EAAA;AAGA,QAAA,MAAM,KAAK,UAAA,EAAW;AAGtB,QAAA,IAAI,KAAK,SAAA,EAAW;AAClB,UAAA,IAAA,CAAK,IAAA,CAAK,uBAAuB,EAAE,WAAA,EAAa,WAAW,SAAA,kBAAW,IAAI,IAAA,EAAK,EAAG,CAAA;AAClF,UAAA;AAAA,QACF;AAGA,QAAA,IAAI,KAAK,OAAA,EAAS;AAChB,UAAA,IAAA,CAAK,OAAA,CAAQ,WAAA,CAAY,MAAA,CAAO,MAAM,CAAA;AAAA,QACxC;AAGA,QAAA,MAAM,UAAA,GAAa,MAAM,IAAA,CAAK,WAAA,CAAY,aAAa,aAAA,EAAe;AAAA,UACpE,WAAA;AAAA,UACA,SAAA;AAAA,UACA,SAAS,IAAA,CAAK,OAAA;AAAA,UACd,SAAA,sBAAe,IAAA;AAAK,SACtB,EAAG,EAAE,WAAA,EAAa,KAAA,EAAO,CAAA;AAEzB,QAAA,IAAI,WAAW,WAAA,EAAa;AAC1B,UAAA,IAAA,CAAK,KAAA,EAAM;AAAA,QACb;AAGA,QAAA,IAAA,CAAK,KAAK,iBAAA,EAAmB;AAAA,UAC3B,WAAA;AAAA,UACA,SAAA;AAAA,UACA,SAAA,sBAAe,IAAA;AAAK,SACrB,CAAA;AAGD,QAAA,IAAI,QAAA;AACJ,QAAA,IAAI,mBAAmB,YAAA,EAAc;AAEnC,UAAA,MAAM,QAAA,GAAW,MAAM,YAAA,CAAa,mBAAA,CAAoB;AAAA,YACtD,qBAAqB,MAAA,CAAO;AAAA,WAC7B,CAAA;AACD,UAAA,QAAA,GAAW,QAAA,CAAS,KAAA;AAAA,QACtB,CAAA,MAAO;AAEL,UAAA,QAAA,GAAW,YAAA;AAAA,QACb;AAGA,QAAA,MAAM,oBAAA,GAAuB,IAAI,WAAA,CAAY,WAAA,EAAa,OAAO,KAAK,CAAA;AACtE,QAAA,MAAM,YAAA,uBAAmB,GAAA,EAA4C;AAGrE,QAAA,OAAO,KAAK,uBAAA,CAAwB,MAAA,EAAQ,UAAU,SAAA,EAAW,WAAA,EAAa,sBAAsB,YAAY,CAAA;AAGhH,QAAA,iBAAA,CAAkB,eAAA,CAAgB,qBAAqB,KAAK,CAAA;AAG5D,QAAA,MAAM,YAAwB,EAAC;AAC/B,QAAA,KAAA,MAAW,CAAC,UAAA,EAAY,MAAM,CAAA,IAAK,YAAA,EAAc;AAC/C,UAAA,SAAA,CAAU,IAAA,CAAK;AAAA,YACb,EAAA,EAAI,UAAA;AAAA,YACJ,IAAA,EAAM,UAAA;AAAA,YACN,QAAA,EAAU;AAAA,cACR,MAAM,MAAA,CAAO,IAAA;AAAA,cACb,WAAW,MAAA,CAAO;AAAA,aACpB;AAAA,YACA,QAAA,EAAU,IAAA;AAAA,YACV,KAAA,EAAA,SAAA;AAAA,WACD,CAAA;AAAA,QACH;AAGA,QAAA,IAAI,SAAA,CAAU,WAAW,CAAA,EAAG;AAE1B,UAAA,MAAM;AAAA,YACJ,IAAA,EAAA,6BAAA;AAAA,YACA,WAAA,EAAa,WAAA;AAAA,YACb,SAAA;AAAA,YACA,gBAAA,EAAkB,CAAA;AAAA,YAClB,mBAAA,EAAqB;AAAA,WACvB;AAGA,UAAA,MAAM;AAAA,YACJ,IAAA,EAAA,mBAAA;AAAA,YACA,WAAA,EAAa,WAAA;AAAA,YACb,MAAA,EAAQ,WAAA;AAAA,YACR,OAAO,iBAAA,CAAkB,KAAA;AAAA,YACzB,UAAA,EAAY,SAAA;AAAA,YACZ,WAAA,EAAa,IAAA,CAAK,GAAA,EAAI,GAAI;AAAA,WAC5B;AAEA,UAAA;AAAA,QACF;AAGA,QAAA,MAAM,cAA4B,EAAC;AAEnC,QAAA,KAAA,MAAW,YAAY,SAAA,EAAW;AAEhC,UAAA,IAAI,UAAA;AACJ,UAAA,IAAI;AACF,YAAA,UAAA,GAAa,IAAA,CAAK,KAAA,CAAM,QAAA,CAAS,QAAA,CAAS,SAAS,CAAA;AAAA,UACrD,SAAS,KAAA,EAAO;AAEd,YAAA,MAAM;AAAA,cACJ,IAAA,EAAA,8BAAA;AAAA,cACA,WAAA,EAAa,WAAA;AAAA,cACb,cAAc,QAAA,CAAS,EAAA;AAAA,cACvB,SAAA,EAAW,SAAS,QAAA,CAAS,IAAA;AAAA,cAC7B,MAAA,EAAQ,IAAA;AAAA,cACR,iBAAA,EAAmB,CAAA;AAAA,cACnB,KAAA,EAAO,CAAA,6BAAA,EAAiC,KAAA,CAAgB,OAAO,CAAA;AAAA,aACjE;AACA,YAAA;AAAA,UACF;AAGA,UAAA,MAAM;AAAA,YACJ,IAAA,EAAA,+BAAA;AAAA,YACA,WAAA,EAAa,WAAA;AAAA,YACb,cAAc,QAAA,CAAS,EAAA;AAAA,YACvB,SAAA,EAAW,SAAS,QAAA,CAAS,IAAA;AAAA,YAC7B,SAAA,EAAW;AAAA,WACb;AAEA,UAAA,MAAM,aAAA,GAAgB,KAAK,GAAA,EAAI;AAE/B,UAAA,IAAI;AAEF,YAAA,MAAM,SAAS,MAAM,IAAA,CAAK,qBAAqB,QAAA,EAAU,SAAA,EAAW,aAAa,MAAM,CAAA;AACvF,YAAA,WAAA,CAAY,KAAK,MAAM,CAAA;AAGvB,YAAA,MAAM;AAAA,cACJ,IAAA,EAAA,8BAAA;AAAA,cACA,WAAA,EAAa,WAAA;AAAA,cACb,cAAc,QAAA,CAAS,EAAA;AAAA,cACvB,SAAA,EAAW,SAAS,QAAA,CAAS,IAAA;AAAA,cAC7B,QAAQ,MAAA,CAAO,OAAA;AAAA,cACf,iBAAA,EAAmB,IAAA,CAAK,GAAA,EAAI,GAAI;AAAA,aAClC;AAAA,UACF,SAAS,KAAA,EAAO;AAEd,YAAA,MAAM;AAAA,cACJ,IAAA,EAAA,8BAAA;AAAA,cACA,WAAA,EAAa,WAAA;AAAA,cACb,cAAc,QAAA,CAAS,EAAA;AAAA,cACvB,SAAA,EAAW,SAAS,QAAA,CAAS,IAAA;AAAA,cAC7B,MAAA,EAAQ,IAAA;AAAA,cACR,iBAAA,EAAmB,IAAA,CAAK,GAAA,EAAI,GAAI,aAAA;AAAA,cAChC,OAAQ,KAAA,CAAgB;AAAA,aAC1B;AAGA,YAAA,MAAM,WAAA,GAAc,MAAA,CAAO,aAAA,EAAe,eAAA,IAAmB,UAAA;AAC7D,YAAA,IAAI,gBAAgB,MAAA,EAAQ;AAC1B,cAAA,MAAM,KAAA;AAAA,YACR;AAGA,YAAA,WAAA,CAAY,IAAA,CAAK;AAAA,cACf,aAAa,QAAA,CAAS,EAAA;AAAA,cACtB,OAAA,EAAS,EAAA;AAAA,cACT,OAAQ,KAAA,CAAgB,OAAA;AAAA,cACxB,KAAA,EAAA,QAAA;AAAA,aACD,CAAA;AAAA,UACH;AAAA,QACF;AAGA,QAAA,MAAM,gBAAA,GAA8B;AAAA,UAClC,IAAA,EAAM,SAAA;AAAA,UACN,IAAA,EAAA,WAAA;AAAA,UACA,OAAA,EAAS;AAAA,YACP;AAAA,cACE,IAAA,EAAA,aAAA;AAAA,cACA,IAAA,EAAM,qBAAqB,UAAA;AAAW,aACxC;AAAA,YACA,GAAG,SAAA,CAAU,GAAA,CAAI,CAAC,EAAA,MAAQ;AAAA,cACxB,IAAA,EAAA,UAAA;AAAA,cACA,IAAI,EAAA,CAAG,EAAA;AAAA,cACP,IAAA,EAAM,GAAG,QAAA,CAAS,IAAA;AAAA,cAClB,SAAA,EAAW,GAAG,QAAA,CAAS;AAAA,aACzB,CAAE;AAAA;AACJ,SACF;AAEA,QAAA,MAAM,kBAAA,GAAgC;AAAA,UACpC,IAAA,EAAM,SAAA;AAAA,UACN,IAAA,EAAA,MAAA;AAAA,UACA,OAAA,EAAS,WAAA,CAAY,GAAA,CAAI,CAAC,EAAA,MAAQ;AAAA,YAChC,IAAA,EAAA,aAAA;AAAA,YACA,aAAa,EAAA,CAAG,WAAA;AAAA,YAChB,SAAS,EAAA,CAAG,OAAA;AAAA,YACZ,OAAO,EAAA,CAAG;AAAA,WACZ,CAAE;AAAA,SACJ;AAGA,QAAA,IAAI,mBAAmB,YAAA,EAAc;AAEnC,UAAA,YAAA,CAAa,aAAA,CAAc,CAAC,gBAAgB,CAAC,CAAA;AAE7C,UAAA,YAAA,CAAa,eAAe,WAAW,CAAA;AAAA,QACzC,CAAA,MAAO;AAEL,UAAA,MAAM,WAAA,GAA2B,CAAC,gBAAA,EAAkB,kBAAkB,CAAA;AACtE,UAAA,YAAA,GAAe,IAAA,CAAK,eAAA,CAAgB,YAAA,EAAc,WAAW,CAAA;AAG7D,UAAA,MAAM,gBAAA,GAAmB,MAAA,CAAO,MAAA,EAAQ,gBAAA,IAAoB,EAAA;AAC5D,UAAA,YAAA,GAAe,IAAA,CAAK,kBAAA,CAAmB,YAAA,EAAc,gBAAgB,CAAA;AAAA,QACvE;AAGA,QAAA,MAAM;AAAA,UACJ,IAAA,EAAA,6BAAA;AAAA,UACA,WAAA,EAAa,WAAA;AAAA,UACb,SAAA;AAAA,UACA,kBAAkB,SAAA,CAAU,MAAA;AAAA,UAC5B,mBAAA,EAAqB;AAAA,SACvB;AAGA,QAAA,IAAI,KAAK,OAAA,EAAS;AAChB,UAAA,iBAAA,CAAkB,kBAAA,EAAmB;AAAA,QACvC;AAGA,QAAA,oBAAA,CAAqB,KAAA,EAAM;AAC3B,QAAA,YAAA,CAAa,KAAA,EAAM;AAAA,MACrB;AAGA,MAAA,IAAI,SAAA,IAAa,OAAO,aAAA,EAAe;AACrC,QAAA,MAAM;AAAA,UACJ,IAAA,EAAA,mBAAA;AAAA,UACA,WAAA,EAAa,WAAA;AAAA,UACb,MAAA,EAAQ,YAAA;AAAA;AAAA,UACR,OAAO,iBAAA,CAAkB,KAAA;AAAA,UACzB,UAAA,EAAY,SAAA;AAAA,UACZ,WAAA,EAAa,IAAA,CAAK,GAAA,EAAI,GAAI;AAAA,SAC5B;AAAA,MACF;AAGA,MAAA,MAAM,IAAA,CAAK,WAAA,CAAY,YAAA,CAAa,iBAAA,EAAmB;AAAA,QACrD,WAAA;AAAA,QACA,QAAA,EAAU,IAAA;AAAA;AAAA,QACV,SAAS,IAAA,CAAK,OAAA;AAAA,QACd,SAAA,sBAAe,IAAA,EAAK;AAAA,QACpB,QAAA,EAAU,IAAA,CAAK,GAAA,EAAI,GAAI;AAAA,SACtB,KAAA,CAAgB,CAAA;AAGnB,MAAA,IAAA,CAAK,KAAK,oBAAA,EAAsB;AAAA,QAC9B,WAAA;AAAA,QACA,UAAA,EAAY,SAAA;AAAA,QACZ,QAAA,EAAU,IAAA,CAAK,GAAA,EAAI,GAAI,SAAA;AAAA,QACvB,SAAA,sBAAe,IAAA;AAAK,OACrB,CAAA;AAAA,IACH,SAAS,KAAA,EAAO;AAEd,MAAA,IAAA,CAAK,KAAK,iBAAA,EAAmB;AAAA,QAC3B,WAAA;AAAA,QACA,KAAA;AAAA,QACA,SAAA,sBAAe,IAAA;AAAK,OACrB,CAAA;AAGD,MAAA,MAAM;AAAA,QACJ,IAAA,EAAA,gBAAA;AAAA,QACA,WAAA,EAAa,WAAA;AAAA,QACb,KAAA,EAAO;AAAA,UACL,IAAA,EAAM,iBAAA;AAAA,UACN,SAAU,KAAA,CAAgB;AAAA,SAC5B;AAAA,QACA,WAAA,EAAa;AAAA,OACf;AAEA,MAAA,MAAM,KAAA;AAAA,IACR,CAAA,SAAE;AAEA,MAAA,iBAAA,CAAkB,KAAA,EAAM;AACxB,MAAA,IAAA,CAAK,SAAS,OAAA,EAAQ;AACtB,MAAA,IAAA,CAAK,YAAY,KAAA,EAAM;AAAA,IACzB;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,OAAe,uBAAA,CACb,MAAA,EACA,OACA,SAAA,EACA,WAAA,EACA,aACA,YAAA,EACoC;AACpC,IAAA,MAAM,YAAA,GAAe,KAAK,GAAA,EAAI;AAG9B,IAAA,IAAI,eAAA,GAAuC;AAAA,MACzC,OAAO,MAAA,CAAO,KAAA;AAAA,MACd,KAAA;AAAA,MACA,cAAc,MAAA,CAAO,YAAA;AAAA,MACrB,OAAO,MAAA,CAAO,KAAA;AAAA,MACd,WAAA,EAAa,MAAA;AAAA,MACb,aAAa,MAAA,CAAO,WAAA;AAAA,MACpB,eAAe,MAAA,CAAO;AAAA,KACxB;AAGA,IAAA,MAAM,IAAA,CAAK,WAAA,CAAY,YAAA,CAAa,YAAA,EAAc;AAAA,MAChD,WAAA;AAAA,MACA,SAAA;AAAA,MACA,OAAA,EAAS,eAAA;AAAA,MACT,SAAS,IAAA,CAAK,OAAA;AAAA,MACd,SAAA,sBAAe,IAAA;AAAK,KACtB,EAAG,EAAE,CAAA;AAGL,IAAA,IAAA,CAAK,KAAK,aAAA,EAAe;AAAA,MACvB,WAAA;AAAA,MACA,SAAA;AAAA,MACA,OAAO,MAAA,CAAO,KAAA;AAAA,MACd,SAAA,sBAAe,IAAA;AAAK,KACrB,CAAA;AAED,IAAA,IAAI;AAEF,MAAA,WAAA,MAAiB,KAAA,IAAS,IAAA,CAAK,QAAA,CAAS,cAAA,CAAe,eAAe,CAAA,EAAG;AAEvE,QAAA,IAAI,MAAM,IAAA,KAAA,4BAAA,0BAA4C;AACpD,UAAA,WAAA,CAAY,mBAAA,CAAoB,KAAA,CAAM,OAAA,EAAS,KAAA,CAAM,KAAK,CAAA;AAAA,QAC5D,CAAA,MAAA,IAAW,MAAM,IAAA,KAAA,0BAAA,wBAA0C;AACzD,UAAA,WAAA,CAAY,aAAA,CAAc,KAAA,CAAM,YAAA,EAAc,KAAA,CAAM,SAAS,CAAA;AAC7D,UAAA,YAAA,CAAa,GAAA,CAAI,MAAM,YAAA,EAAc,EAAE,MAAM,KAAA,CAAM,SAAA,EAAW,IAAA,EAAM,EAAA,EAAI,CAAA;AAAA,QAC1E,CAAA,MAAA,IAAW,MAAM,IAAA,KAAA,oCAAA,kCAAoD;AACnE,UAAA,WAAA,CAAY,uBAAA,CAAwB,KAAA,CAAM,YAAA,EAAc,KAAA,CAAM,KAAK,CAAA;AACnE,UAAA,MAAM,MAAA,GAAS,YAAA,CAAa,GAAA,CAAI,KAAA,CAAM,YAAY,CAAA;AAClD,UAAA,IAAI,MAAA,EAAQ;AACV,YAAA,MAAA,CAAO,QAAQ,KAAA,CAAM,KAAA;AAAA,UACvB;AAAA,QACF,CAAA,MAAA,IAAW,uBAAA,CAAwB,KAAK,CAAA,EAAG;AACzC,UAAA,WAAA,CAAY,gBAAA,CAAiB,MAAM,YAAY,CAAA;AAC/C,UAAA,MAAM,MAAA,GAAS,YAAA,CAAa,GAAA,CAAI,KAAA,CAAM,YAAY,CAAA;AAClD,UAAA,IAAI,MAAA,EAAQ;AACV,YAAA,MAAA,CAAO,OAAO,KAAA,CAAM,SAAA;AAAA,UACtB;AAAA,QACF,CAAA,MAAA,IAAW,MAAM,IAAA,KAAA,mBAAA,0BAA4C;AAC3D,UAAA,WAAA,CAAY,WAAA,CAAY,MAAM,KAAK,CAAA;AAEnC,UAAA,IAAI,OAAA,CAAQ,IAAI,eAAA,EAAiB;AAC/B,YAAA,OAAA,CAAQ,KAAA,CAAM,uCAAA,EAAyC,KAAA,CAAM,KAAK,CAAA;AAClE,YAAA,OAAA,CAAQ,KAAA,CAAM,yCAAA,EAA2C,WAAA,CAAY,KAAK,CAAA;AAAA,UAC5E;AAGA,UAAA;AAAA,QACF;AAGA,QAAA,MAAM,KAAA;AAAA,MACR;AAGA,MAAA,IAAI,KAAK,OAAA,EAAS;AAChB,QAAA,IAAA,CAAK,OAAA,CAAQ,OAAA,CAAQ,WAAA,IAAe,IAAA,CAAK,KAAI,GAAI,YAAA;AACjD,QAAA,IAAA,CAAK,OAAA,CAAQ,OAAA,CAAQ,WAAA,IAAe,WAAA,CAAY,KAAA,CAAM,YAAA;AACtD,QAAA,IAAA,CAAK,OAAA,CAAQ,OAAA,CAAQ,YAAA,IAAgB,WAAA,CAAY,KAAA,CAAM,aAAA;AACvD,QAAA,IAAA,CAAK,OAAA,CAAQ,OAAA,CAAQ,WAAA,IAAe,WAAA,CAAY,KAAA,CAAM,YAAA;AAAA,MACxD;AAEA,MAAA,IAAI,OAAA,CAAQ,IAAI,eAAA,EAAiB;AAC/B,QAAA,OAAA,CAAQ,KAAA,CAAM,2CAAA,EAA6C,WAAA,CAAY,KAAK,CAAA;AAAA,MAC9E;AAGA,MAAA,MAAM,IAAA,CAAK,WAAA,CAAY,YAAA,CAAa,WAAA,EAAa;AAAA,QAC/C,WAAA;AAAA,QACA,SAAA;AAAA,QACA,QAAA,EAAU,IAAA;AAAA;AAAA,QACV,SAAS,IAAA,CAAK,OAAA;AAAA,QACd,SAAA,sBAAe,IAAA,EAAK;AAAA,QACpB,QAAA,EAAU,IAAA,CAAK,GAAA,EAAI,GAAI;AAAA,OACzB,EAAG,EAAE,CAAA;AAGL,MAAA,IAAA,CAAK,KAAK,cAAA,EAAgB;AAAA,QACxB,WAAA;AAAA,QACA,SAAA;AAAA,QACA,SAAA,sBAAe,IAAA;AAAK,OACrB,CAAA;AAAA,IACH,SAAS,KAAA,EAAO;AACd,MAAA,IAAA,CAAK,KAAK,WAAA,EAAa;AAAA,QACrB,WAAA;AAAA,QACA,SAAA;AAAA,QACA,KAAA;AAAA,QACA,SAAA,sBAAe,IAAA;AAAK,OACrB,CAAA;AACD,MAAA,MAAM,KAAA;AAAA,IACR;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,MAAc,mBAAA,CACZ,QAAA,EACA,SAAA,EACA,aACA,MAAA,EACkB;AAClB,IAAA,MAAM,oBAAoB,MAAA,CAAO,iBAAA;AACjC,IAAA,IAAI,CAAC,iBAAA,EAAmB;AAEtB,MAAA,OAAO,IAAA;AAAA,IACT;AAEA,IAAA,MAAM,QAAA,GAAW,SAAS,QAAA,CAAS,IAAA;AAGnC,IAAA,IAAI,iBAAA,CAAkB,SAAA,CAAU,QAAQ,CAAA,EAAG;AACzC,MAAA,IAAA,CAAK,OAAA,EAAS,MAAM,cAAA,EAAgB,EAAE,QAAQ,qBAAA,EAAsB,EAAG,QAAW,QAAQ,CAAA;AAC1F,MAAA,MAAM,IAAI,KAAA,CAAM,CAAA,MAAA,EAAS,QAAQ,CAAA,mCAAA,CAAqC,CAAA;AAAA,IACxE;AAGA,IAAA,IAAI,iBAAA,CAAkB,UAAA,CAAW,QAAQ,CAAA,EAAG;AAC1C,MAAA,OAAO,IAAA;AAAA,IACT;AAGA,IAAA,MAAM,WAAA,GAAc,iBAAA,CAAkB,eAAA,CAAgB,QAAQ,CAAA;AAC9D,IAAA,IAAI,CAAC,YAAY,aAAA,EAAe;AAE9B,MAAA,OAAO,IAAA;AAAA,IACT;AAGA,IAAA,IAAI,aAAsC,EAAC;AAC3C,IAAA,IAAI;AACF,MAAA,UAAA,GAAa,IAAA,CAAK,KAAA,CAAM,QAAA,CAAS,QAAA,CAAS,SAAS,CAAA;AAAA,IACrD,CAAA,CAAA,MAAQ;AAAA,IAER;AAGA,IAAA,MAAM,OAAA,GAAkC;AAAA,MACtC,QAAA;AAAA,MACA,UAAA;AAAA,MACA,MAAA,EAAQ,WAAA,CAAY,MAAA,IAAU,EAAC;AAAA,MAC/B,WAAA;AAAA,MACA,SAAA;AAAA,MACA,SAAA,EAAW,OAAO,SAAA,IAAa,OAAA;AAAA,MAC/B,UAAU,MAAA,CAAO;AAAA,KACnB;AAGA,IAAA,MAAM,QAAA,GAAW,MAAM,iBAAA,CAAkB,eAAA,CAAgB,OAAO,CAAA;AAEhE,IAAA,IAAI,SAAS,QAAA,EAAU;AACrB,MAAA,IAAA,CAAK,OAAA,EAAS,MAAM,0BAAA,EAA4B;AAAA,QAC9C,OAAO,QAAA,CAAS,KAAA;AAAA,QAChB,YAAY,QAAA,CAAS;AAAA,OACvB,EAAG,QAAW,QAAQ,CAAA;AACtB,MAAA,OAAO,IAAA;AAAA,IACT;AAIA,IAAA,OAAO,KAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,MAAc,oBAAA,CACZ,QAAA,EACA,SAAA,EACA,aACA,MAAA,EACqB;AACrB,IAAA,MAAM,aAAA,GAAgB,KAAK,GAAA,EAAI;AAE/B,IAAA,QAAA,CAAS,KAAA,GAAA,WAAA;AACT,IAAA,QAAA,CAAS,SAAA,uBAAgB,IAAA,EAAK;AAG9B,IAAA,MAAM,IAAA,CAAK,WAAA,CAAY,YAAA,CAAa,aAAA,EAAe;AAAA,MACjD,WAAA;AAAA,MACA,SAAA;AAAA,MACA,QAAA;AAAA,MACA,SAAS,IAAA,CAAK,OAAA;AAAA,MACd,SAAA,sBAAe,IAAA;AAAK,KACtB,EAAG,EAAE,CAAA;AAIL,IAAA,MAAM,qBAAqB,MAAM,IAAA,CAAK,oBAAoB,QAAA,EAAU,SAAA,EAAW,aAAa,MAAM,CAAA;AAIlG,IAAA,IAAI,CAAC,kBAAA,IAAsB,IAAA,CAAK,WAAA,CAAY,QAAA,CAAS,cAAc,CAAA,EAAG;AACpE,MAAA,MAAM,QAAA,GAAW,MAAM,IAAA,CAAK,WAAA,CAAY,aAAa,cAAA,EAAgB;AAAA,QACnE,WAAA;AAAA,QACA,SAAA;AAAA,QACA,QAAA;AAAA,QACA,SAAS,IAAA,CAAK,OAAA;AAAA,QACd,SAAA,sBAAe,IAAA;AAAK,OACtB,EAAG,EAAE,QAAA,EAAU,kBAAA,EAAoB,CAAA;AAEnC,MAAA,IAAI,CAAC,SAAS,QAAA,EAAU;AACtB,QAAA,MAAM,IAAI,KAAA,CAAM,CAAA,yBAAA,EAA4B,QAAA,CAAS,MAAA,IAAU,oBAAoB,CAAA,CAAE,CAAA;AAAA,MACvF;AAAA,IACF;AAGA,IAAA,IAAA,CAAK,KAAK,YAAA,EAAc;AAAA,MACtB,WAAA;AAAA,MACA,SAAA;AAAA,MACA,QAAA;AAAA,MACA,SAAA,sBAAe,IAAA;AAAK,KACrB,CAAA;AAED,IAAA,IAAI;AAEF,MAAA,MAAM,IAAA,GAAO,IAAA,CAAK,KAAA,CAAM,QAAA,CAAS,SAAS,SAAS,CAAA;AACnD,MAAA,MAAM,MAAA,GAAS,MAAM,IAAA,CAAK,kBAAA;AAAA,QACxB,MAAM,IAAA,CAAK,YAAA,CAAa,QAAQ,QAAA,CAAS,QAAA,CAAS,MAAM,IAAI,CAAA;AAAA,QAC5D,OAAO,WAAA,IAAe;AAAA,OACxB;AAGA,MAAA,MAAM,UAAA,GAAyB;AAAA,QAC7B,aAAa,QAAA,CAAS,EAAA;AAAA,QACtB,OAAA,EAAS,MAAA;AAAA,QACT,aAAA,EAAe,IAAA,CAAK,GAAA,EAAI,GAAI,aAAA;AAAA,QAC5B,KAAA,EAAA,WAAA;AAAA,OACF;AAEA,MAAA,QAAA,CAAS,KAAA,GAAA,WAAA;AACT,MAAA,QAAA,CAAS,OAAA,uBAAc,IAAA,EAAK;AAG5B,MAAA,MAAM,IAAA,CAAK,WAAA,CAAY,YAAA,CAAa,YAAA,EAAc;AAAA,QAChD,WAAA;AAAA,QACA,SAAA;AAAA,QACA,QAAA;AAAA,QACA,MAAA,EAAQ,UAAA;AAAA,QACR,SAAS,IAAA,CAAK,OAAA;AAAA,QACd,SAAA,sBAAe,IAAA;AAAK,OACtB,EAAG,EAAE,CAAA;AAGL,MAAA,IAAI,KAAK,OAAA,EAAS;AAChB,QAAA,IAAA,CAAK,QAAQ,OAAA,CAAQ,aAAA,EAAA;AACrB,QAAA,IAAA,CAAK,QAAQ,OAAA,CAAQ,gBAAA,EAAA;AACrB,QAAA,IAAA,CAAK,OAAA,CAAQ,OAAA,CAAQ,YAAA,IAAgB,UAAA,CAAW,aAAA,IAAiB,CAAA;AAAA,MACnE;AAGA,MAAA,IAAA,CAAK,KAAK,eAAA,EAAiB;AAAA,QACzB,WAAA;AAAA,QACA,SAAA;AAAA,QACA,QAAA;AAAA,QACA,MAAA,EAAQ,UAAA;AAAA,QACR,SAAA,sBAAe,IAAA;AAAK,OACrB,CAAA;AAED,MAAA,OAAO,UAAA;AAAA,IACT,SAAS,KAAA,EAAO;AACd,MAAA,QAAA,CAAS,KAAA,GAAA,QAAA;AACT,MAAA,QAAA,CAAS,OAAA,uBAAc,IAAA,EAAK;AAC5B,MAAA,QAAA,CAAS,QAAS,KAAA,CAAgB,OAAA;AAGlC,MAAA,IAAI,KAAK,OAAA,EAAS;AAChB,QAAA,IAAA,CAAK,QAAQ,OAAA,CAAQ,gBAAA,EAAA;AAAA,MACvB;AAGA,MAAA,IAAA,CAAK,KAAK,YAAA,EAAc;AAAA,QACtB,WAAA;AAAA,QACA,SAAA;AAAA,QACA,QAAA;AAAA,QACA,KAAA;AAAA,QACA,SAAA,sBAAe,IAAA;AAAK,OACrB,CAAA;AAED,MAAA,MAAM,KAAA;AAAA,IACR;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,iBAAA,CACZ,MAAA,EACA,KAAA,EACA,WACA,WAAA,EACwB;AACxB,IAAA,MAAM,YAAA,GAAe,KAAK,GAAA,EAAI;AAG9B,IAAA,IAAI,eAAA,GAAuC;AAAA,MACzC,OAAO,MAAA,CAAO,KAAA;AAAA,MACd,KAAA;AAAA,MACA,cAAc,MAAA,CAAO,YAAA;AAAA,MACrB,OAAO,MAAA,CAAO,KAAA;AAAA,MACd,WAAA,EAAa,MAAA;AAAA,MACb,aAAa,MAAA,CAAO,WAAA;AAAA,MACpB,eAAe,MAAA,CAAO;AAAA,KACxB;AAGA,IAAA,MAAM,SAAA,GAAY,MAAM,IAAA,CAAK,WAAA,CAAY,aAAa,YAAA,EAAc;AAAA,MAClE,WAAA;AAAA,MACA,SAAA;AAAA,MACA,OAAA,EAAS,eAAA;AAAA,MACT,SAAS,IAAA,CAAK,OAAA;AAAA,MACd,SAAA,sBAAe,IAAA;AAAK,KACtB,EAAG,EAAE,CAAA;AAGL,IAAA,IAAI,UAAU,QAAA,EAAU;AACtB,MAAA,eAAA,GAAkB,EAAE,GAAG,eAAA,EAAiB,GAAG,UAAU,QAAA,EAAS;AAAA,IAChE;AAGA,IAAA,IAAI,UAAU,IAAA,EAAM;AAClB,MAAA,MAAM,IAAI,MAAM,0BAA0B,CAAA;AAAA,IAC5C;AAGA,IAAA,IAAA,CAAK,KAAK,aAAA,EAAe;AAAA,MACvB,WAAA;AAAA,MACA,SAAA;AAAA,MACA,OAAA,EAAS,eAAA;AAAA,MACT,SAAA,sBAAe,IAAA;AAAK,KACrB,CAAA;AAED,IAAA,IAAI;AAEF,MAAA,MAAM,QAAA,GAAW,MAAM,IAAA,CAAK,QAAA,CAAS,SAAS,eAAe,CAAA;AAE7D,MAAA,MAAM,WAAA,GAAc,IAAA,CAAK,GAAA,EAAI,GAAI,YAAA;AAGjC,MAAA,IAAA,CAAK,SAAS,aAAA,CAAc;AAAA,QAC1B,WAAA,EAAA,CAAc,IAAA,CAAK,OAAA,CAAQ,OAAA,CAAQ,eAAe,CAAA,IAAK;AAAA,OACxD,CAAA;AAGD,MAAA,IAAA,CAAK,KAAK,cAAA,EAAgB;AAAA,QACxB,WAAA;AAAA,QACA,SAAA;AAAA,QACA,QAAA;AAAA,QACA,SAAA,sBAAe,IAAA,EAAK;AAAA,QACpB,QAAA,EAAU;AAAA,OACX,CAAA;AAGD,MAAA,MAAM,IAAA,CAAK,WAAA,CAAY,YAAA,CAAa,WAAA,EAAa;AAAA,QAC/C,WAAA;AAAA,QACA,SAAA;AAAA,QACA,QAAA;AAAA,QACA,SAAS,IAAA,CAAK,OAAA;AAAA,QACd,SAAA,sBAAe,IAAA,EAAK;AAAA,QACpB,QAAA,EAAU;AAAA,OACZ,EAAG,EAAE,CAAA;AAEL,MAAA,OAAO,QAAA;AAAA,IACT,SAAS,KAAA,EAAO;AAEd,MAAA,IAAA,CAAK,KAAK,WAAA,EAAa;AAAA,QACrB,WAAA;AAAA,QACA,SAAA;AAAA,QACA,KAAA;AAAA,QACA,SAAA,sBAAe,IAAA;AAAK,OACrB,CAAA;AAED,MAAA,MAAM,KAAA;AAAA,IACR;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,qBAAA,CACZ,SAAA,EACA,SAAA,EACA,aACA,MAAA,EACuB;AACvB,IAAA,MAAM,UAAwB,EAAC;AAE/B,IAAA,KAAA,MAAW,YAAY,SAAA,EAAW;AAEhC,MAAA,IAAA,CAAK,OAAA,EAAS,YAAY,QAAQ,CAAA;AAGlC,MAAA,MAAM,KAAK,UAAA,EAAW;AAGtB,MAAA,MAAM,UAAA,GAAa,MAAM,IAAA,CAAK,WAAA,CAAY,aAAa,aAAA,EAAe;AAAA,QACpE,WAAA;AAAA,QACA,SAAA;AAAA,QACA,QAAA;AAAA,QACA,SAAS,IAAA,CAAK,OAAA;AAAA,QACd,SAAA,sBAAe,IAAA;AAAK,OACtB,EAAG,EAAE,CAAA;AAGL,MAAA,IAAI,WAAW,IAAA,EAAM;AACnB,QAAA,IAAA,CAAK,OAAA,EAAS,MAAM,cAAA,EAAgB,EAAE,UAAS,EAAG,MAAA,EAAW,QAAA,CAAS,QAAA,CAAS,IAAI,CAAA;AAEnF,QAAA,MAAM,UAAA,GAAyB;AAAA,UAC7B,aAAa,QAAA,CAAS,EAAA;AAAA,UACtB,OAAA,EAAS,WAAW,UAAA,IAAc,EAAA;AAAA,UAClC,KAAA,EAAA,WAAA;AAAA,UACA,aAAA,EAAe;AAAA,SACjB;AAEA,QAAA,OAAA,CAAQ,KAAK,UAAU,CAAA;AACvB,QAAA,IAAA,CAAK,OAAA,EAAS,cAAc,UAAU,CAAA;AACtC,QAAA;AAAA,MACF;AAGA,MAAA,IAAI,WAAW,QAAA,EAAU;AACvB,QAAA,MAAA,CAAO,MAAA,CAAO,QAAA,EAAU,UAAA,CAAW,QAAQ,CAAA;AAC3C,QAAA,IAAA,CAAK,OAAA,EAAS,KAAA,CAAM,eAAA,EAAiB,EAAE,aAAA,EAAe,UAAA,CAAW,QAAA,EAAS,EAAG,MAAA,EAAW,QAAA,CAAS,QAAA,CAAS,IAAI,CAAA;AAAA,MAChH;AAGA,MAAA,IAAI,kBAAA,GAAqB,IAAA;AACzB,MAAA,IAAI;AACF,QAAA,kBAAA,GAAqB,MAAM,IAAA,CAAK,mBAAA,CAAoB,QAAA,EAAU,SAAA,EAAW,aAAa,MAAM,CAAA;AAAA,MAC9F,SAAS,KAAA,EAAO;AAEd,QAAA,IAAA,CAAK,OAAA,EAAS,KAAA,CAAM,cAAA,EAAgB,EAAE,MAAA,EAAS,KAAA,CAAgB,OAAA,EAAQ,EAAG,MAAA,EAAW,QAAA,CAAS,QAAA,CAAS,IAAI,CAAA;AAE3G,QAAA,MAAM,aAAA,GAA4B;AAAA,UAChC,aAAa,QAAA,CAAS,EAAA;AAAA,UACtB,OAAA,EAAS,EAAA;AAAA,UACT,OAAQ,KAAA,CAAgB,OAAA;AAAA,UACxB,KAAA,EAAA,QAAA;AAAA,SACF;AAEA,QAAA,OAAA,CAAQ,KAAK,aAAa,CAAA;AAC1B,QAAA,IAAA,CAAK,OAAA,EAAS,cAAc,aAAa,CAAA;AACzC,QAAA;AAAA,MACF;AAGA,MAAA,IAAI,CAAC,kBAAA,IAAsB,IAAA,CAAK,WAAA,CAAY,QAAA,CAAS,cAAc,CAAA,EAAG;AACpE,QAAA,MAAM,QAAA,GAAW,MAAM,IAAA,CAAK,WAAA,CAAY,aAAa,cAAA,EAAgB;AAAA,UACnE,WAAA;AAAA,UACA,SAAA;AAAA,UACA,QAAA;AAAA,UACA,SAAS,IAAA,CAAK,OAAA;AAAA,UACd,SAAA,sBAAe,IAAA;AAAK,SACtB,EAAG,EAAE,QAAA,EAAU,kBAAA,EAAoB,CAAA;AAEnC,QAAA,IAAI,CAAC,SAAS,QAAA,EAAU;AACtB,UAAA,IAAA,CAAK,OAAA,EAAS,KAAA,CAAM,eAAA,EAAiB,EAAE,MAAA,EAAQ,QAAA,CAAS,MAAA,EAAO,EAAG,MAAA,EAAW,QAAA,CAAS,QAAA,CAAS,IAAI,CAAA;AAEnG,UAAA,MAAM,cAAA,GAA6B;AAAA,YACjC,aAAa,QAAA,CAAS,EAAA;AAAA,YACtB,OAAA,EAAS,EAAA;AAAA,YACT,KAAA,EAAO,CAAA,eAAA,EAAkB,QAAA,CAAS,MAAA,IAAU,cAAc,CAAA,CAAA;AAAA,YAC1D,KAAA,EAAA,QAAA;AAAA,WACF;AAEA,UAAA,OAAA,CAAQ,KAAK,cAAc,CAAA;AAC3B,UAAA,IAAA,CAAK,OAAA,EAAS,cAAc,cAAc,CAAA;AAC1C,UAAA;AAAA,QACF;AAEA,QAAA,IAAA,CAAK,OAAA,EAAS,KAAA,CAAM,eAAA,EAAiB,EAAE,MAAA,EAAQ,QAAA,CAAS,MAAA,EAAO,EAAG,MAAA,EAAW,QAAA,CAAS,QAAA,CAAS,IAAI,CAAA;AAAA,MACrG;AAGA,MAAA,QAAA,CAAS,KAAA,GAAA,WAAA;AACT,MAAA,QAAA,CAAS,SAAA,uBAAgB,IAAA,EAAK;AAG9B,MAAA,IAAA,CAAK,KAAK,YAAA,EAAc;AAAA,QACtB,WAAA;AAAA,QACA,SAAA;AAAA,QACA,QAAA;AAAA,QACA,SAAA,sBAAe,IAAA;AAAK,OACrB,CAAA;AAED,MAAA,MAAM,aAAA,GAAgB,KAAK,GAAA,EAAI;AAE/B,MAAA,IAAI;AAEF,QAAA,MAAM,OAAA,GAAU,OAAO,WAAA,IAAe,GAAA;AACtC,QAAA,MAAM,MAAA,GAAS,MAAM,IAAA,CAAK,kBAAA;AAAA,UACxB,MAAM,KAAK,YAAA,CAAa,OAAA;AAAA,YACtB,SAAS,QAAA,CAAS,IAAA;AAAA,YAClB,IAAA,CAAK,KAAA,CAAM,QAAA,CAAS,QAAA,CAAS,SAAS;AAAA,WACxC;AAAA,UACA;AAAA,SACF;AAEA,QAAA,QAAA,CAAS,KAAA,GAAA,WAAA;AACT,QAAA,QAAA,CAAS,OAAA,uBAAc,IAAA,EAAK;AAE5B,QAAA,IAAI,UAAA,GAAyB;AAAA,UAC3B,aAAa,QAAA,CAAS,EAAA;AAAA,UACtB,OAAA,EAAS,MAAA;AAAA,UACT,KAAA,EAAA,WAAA;AAAA,UACA,aAAA,EAAe,IAAA,CAAK,GAAA,EAAI,GAAI;AAAA,SAC9B;AAGA,QAAA,MAAM,SAAA,GAAY,MAAM,IAAA,CAAK,WAAA,CAAY,aAAa,YAAA,EAAc;AAAA,UAClE,WAAA;AAAA,UACA,SAAA;AAAA,UACA,QAAA;AAAA,UACA,MAAA,EAAQ,UAAA;AAAA,UACR,SAAS,IAAA,CAAK,OAAA;AAAA,UACd,SAAA,sBAAe,IAAA;AAAK,SACtB,EAAG,EAAE,CAAA;AAGL,QAAA,IAAI,UAAU,QAAA,EAAU;AACtB,UAAA,UAAA,GAAa,EAAE,GAAG,UAAA,EAAY,GAAG,UAAU,QAAA,EAAS;AAAA,QACtD;AAEA,QAAA,OAAA,CAAQ,KAAK,UAAU,CAAA;AACvB,QAAA,IAAA,CAAK,OAAA,EAAS,cAAc,UAAU,CAAA;AAGtC,QAAA,IAAA,CAAK,SAAS,aAAA,CAAc;AAAA,UAC1B,eAAe,IAAA,CAAK,OAAA,CAAQ,OAAA,CAAQ,YAAA,IAAgB,KAAK,UAAA,CAAW;AAAA,SACrE,CAAA;AAGD,QAAA,IAAA,CAAK,KAAK,eAAA,EAAiB;AAAA,UACzB,WAAA;AAAA,UACA,SAAA;AAAA,UACA,QAAA;AAAA,UACA,MAAA,EAAQ,UAAA;AAAA,UACR,SAAA,sBAAe,IAAA;AAAK,SACrB,CAAA;AAAA,MACH,SAAS,KAAA,EAAO;AACd,QAAA,QAAA,CAAS,KAAA,GAAA,QAAA;AACT,QAAA,QAAA,CAAS,OAAA,uBAAc,IAAA,EAAK;AAC5B,QAAA,QAAA,CAAS,QAAS,KAAA,CAAgB,OAAA;AAElC,QAAA,MAAM,UAAA,GAAyB;AAAA,UAC7B,aAAa,QAAA,CAAS,EAAA;AAAA,UACtB,OAAA,EAAS,EAAA;AAAA,UACT,OAAQ,KAAA,CAAgB,OAAA;AAAA,UACxB,KAAA,EAAA,QAAA;AAAA,SACF;AAEA,QAAA,OAAA,CAAQ,KAAK,UAAU,CAAA;AACvB,QAAA,IAAA,CAAK,OAAA,EAAS,cAAc,UAAU,CAAA;AAGtC,QAAA,IAAA,CAAK,OAAA,EAAS,OAAA,CAAQ,MAAA,CAAO,IAAA,CAAK;AAAA,UAChC,IAAA,EAAM,YAAA;AAAA,UACN,SAAU,KAAA,CAAgB,OAAA;AAAA,UAC1B,SAAA,sBAAe,IAAA;AAAK,SACrB,CAAA;AAGD,QAAA,IAAI,iBAAiB,gBAAA,EAAkB;AACrC,UAAA,IAAA,CAAK,KAAK,cAAA,EAAgB;AAAA,YACxB,WAAA;AAAA,YACA,SAAA;AAAA,YACA,QAAA;AAAA,YACA,OAAA,EAAS,OAAO,WAAA,IAAe,GAAA;AAAA,YAC/B,SAAA,sBAAe,IAAA;AAAK,WACrB,CAAA;AAAA,QACH,CAAA,MAAO;AACL,UAAA,IAAA,CAAK,KAAK,YAAA,EAAc;AAAA,YACtB,WAAA;AAAA,YACA,SAAA;AAAA,YACA,QAAA;AAAA,YACA,KAAA;AAAA,YACA,SAAA,sBAAe,IAAA;AAAK,WACrB,CAAA;AAAA,QACH;AAGA,QAAA,MAAM,WAAA,GAAc,MAAA,CAAO,aAAA,EAAe,eAAA,IAAmB,UAAA;AAC7D,QAAA,IAAI,gBAAgB,MAAA,EAAQ;AAE1B,UAAA,MAAM,KAAA;AAAA,QACR;AAAA,MAIF;AAAA,IACF;AAEA,IAAA,OAAO,OAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKQ,gBAAA,CAAiB,QAAsB,eAAA,EAAqC;AAClF,IAAA,MAAM,YAAwB,EAAC;AAG/B,IAAA,MAAM,OAAA,uBAAc,GAAA,EAAkB;AACtC,IAAA,KAAA,MAAW,QAAQ,eAAA,EAAiB;AAClC,MAAA,IAAI,IAAA,CAAK,SAAS,UAAA,EAAY;AAC5B,QAAA,OAAA,CAAQ,GAAA,CAAI,IAAA,CAAK,QAAA,CAAS,IAAA,EAAM,IAAI,CAAA;AAAA,MACtC;AAAA,IACF;AAGA,IAAA,KAAA,MAAW,QAAQ,MAAA,EAAQ;AACzB,MAAA,IAAI,IAAA,CAAK,IAAA,KAAS,SAAA,IAAa,IAAA,CAAK,IAAA,KAAA,WAAA,kBAAgC;AAClE,QAAA,KAAA,MAAW,OAAA,IAAW,KAAK,OAAA,EAAS;AAClC,UAAA,IAAI,QAAQ,IAAA,KAAA,UAAA,iBAA+B;AACzC,YAAA,MAAM,OAAA,GAAU,OAAA,CAAQ,GAAA,CAAI,OAAA,CAAQ,IAAI,CAAA;AACxC,YAAA,MAAM,UAAA,GAAa,SAAS,QAAA,KAAa,KAAA;AAEzC,YAAA,MAAM,QAAA,GAAqB;AAAA,cACzB,IAAI,OAAA,CAAQ,EAAA;AAAA,cACZ,IAAA,EAAM,UAAA;AAAA,cACN,QAAA,EAAU;AAAA,gBACR,MAAM,OAAA,CAAQ,IAAA;AAAA,gBACd,WAAW,OAAA,CAAQ;AAAA,eACrB;AAAA,cACA,QAAA,EAAU,UAAA;AAAA,cACV,KAAA,EAAA,SAAA;AAAA,aACF;AAEA,YAAA,SAAA,CAAU,KAAK,QAAQ,CAAA;AAAA,UACzB;AAAA,QACF;AAAA,MACF;AAAA,IACF;AAEA,IAAA,OAAO,SAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,kBAAA,CAAsB,EAAA,EAAsB,SAAA,EAA+B;AACvF,IAAA,OAAO,IAAI,OAAA,CAAQ,CAAC3B,QAAAA,EAAS,MAAA,KAAW;AACtC,MAAA,MAAM,KAAA,GAAQ,WAAW,MAAM;AAC7B,QAAA,MAAA,CAAO,IAAI,gBAAA,CAAiB,MAAA,EAAQ,SAAS,CAAC,CAAA;AAAA,MAChD,GAAG,SAAS,CAAA;AAEZ,MAAA,EAAA,EAAG,CACA,IAAA,CAAK,CAAC,MAAA,KAAW;AAChB,QAAA,YAAA,CAAa,KAAK,CAAA;AAClB,QAAAA,SAAQ,MAAM,CAAA;AAAA,MAChB,CAAC,CAAA,CACA,KAAA,CAAM,CAAC,KAAA,KAAU;AAChB,QAAA,YAAA,CAAa,KAAK,CAAA;AAClB,QAAA,MAAA,CAAO,KAAK,CAAA;AAAA,MACd,CAAC,CAAA;AAAA,IACL,CAAC,CAAA;AAAA,EACH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQQ,gBAAA,CACN,gBACA,WAAA,EACa;AACb,IAAA,MAAM,WAAwB,EAAC;AAG/B,IAAA,KAAA,MAAW,QAAQ,cAAA,EAAgB;AACjC,MAAA,IAAI,IAAA,CAAK,SAAS,SAAA,EAAW;AAC3B,QAAA,QAAA,CAAS,KAAK,IAAI,CAAA;AAAA,MACpB;AAAA,IACF;AAGA,IAAA,MAAM,kBAAA,GAA0C,WAAA,CAAY,GAAA,CAAI,CAAC,MAAA,MAAY;AAAA,MAC3E,IAAA,EAAA,aAAA;AAAA,MACA,aAAa,MAAA,CAAO,WAAA;AAAA,MACpB,SAAS,MAAA,CAAO,OAAA;AAAA,MAChB,OAAO,MAAA,CAAO;AAAA,KAChB,CAAE,CAAA;AAEF,IAAA,IAAI,kBAAA,CAAmB,SAAS,CAAA,EAAG;AACjC,MAAA,QAAA,CAAS,IAAA,CAAK;AAAA,QACZ,IAAA,EAAM,SAAA;AAAA,QACN,IAAA,EAAA,MAAA;AAAA,QACA,OAAA,EAAS;AAAA,OACV,CAAA;AAAA,IACH;AAEA,IAAA,OAAO,QAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA,EAMQ,eAAA,CACN,cACA,WAAA,EACa;AACb,IAAA,IAAI,KAAA,CAAM,OAAA,CAAQ,YAAY,CAAA,EAAG;AAC/B,MAAA,OAAO,CAAC,GAAG,YAAA,EAAc,GAAG,WAAW,CAAA;AAAA,IACzC;AAGA,IAAA,OAAO;AAAA,MACL;AAAA,QACE,IAAA,EAAM,SAAA;AAAA,QACN,IAAA,EAAA,MAAA;AAAA,QACA,SAAS,CAAC,EAAE,IAAA,EAAA,YAAA,mBAA8B,IAAA,EAAM,cAAc;AAAA,OAChE;AAAA,MACA,GAAG;AAAA,KACL;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOQ,kBAAA,CACN,KAAA,EACA,WAAA,GAAsB,EAAA,EACT;AACb,IAAA,IAAI,KAAA,CAAM,UAAU,WAAA,EAAa;AAC/B,MAAA,OAAO,KAAA;AAAA,IACT;AAGA,IAAA,MAAM,YAAA,GAAe,MAAM,CAAC,CAAA;AAC5B,IAAA,MAAM,eAAA,GAAkB,YAAA,EAAc,IAAA,KAAS,SAAA,IAC7C,YAAA,CAAa,IAAA,KAAA,WAAA;AAGf,IAAA,MAAM,SAAA,GAAY,eAAA,GAAkB,WAAA,GAAc,CAAA,GAAI,WAAA;AAGtD,IAAA,MAAM,eAAe,IAAA,CAAK,oBAAA,CAAqB,KAAA,EAAO,KAAA,CAAM,SAAS,SAAS,CAAA;AAG9E,IAAA,MAAM,cAAA,GAAiB,KAAA,CAAM,KAAA,CAAM,YAAY,CAAA;AAE/C,IAAA,IAAI,eAAA,EAAiB;AACnB,MAAA,OAAO,CAAC,YAAA,EAAc,GAAG,cAAc,CAAA;AAAA,IACzC;AAEA,IAAA,OAAO,cAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA,EAMQ,oBAAA,CAAqB,OAAoB,WAAA,EAA6B;AAE5E,IAAA,IAAI,QAAA,GAAW,IAAA,CAAK,GAAA,CAAI,CAAA,EAAG,IAAA,CAAK,IAAI,WAAA,EAAa,KAAA,CAAM,MAAA,GAAS,CAAC,CAAC,CAAA;AAIlE,IAAA,OAAO,QAAA,GAAW,KAAA,CAAM,MAAA,GAAS,CAAA,EAAG;AAClC,MAAA,IAAI,IAAA,CAAK,kBAAA,CAAmB,KAAA,EAAO,QAAQ,CAAA,EAAG;AAC5C,QAAA,OAAO,QAAA;AAAA,MACT;AACA,MAAA,QAAA,EAAA;AAAA,IACF;AAGA,IAAA,QAAA,GAAW,IAAA,CAAK,GAAA,CAAI,CAAA,EAAG,WAAW,CAAA;AAClC,IAAA,OAAO,WAAW,CAAA,EAAG;AACnB,MAAA,IAAI,IAAA,CAAK,kBAAA,CAAmB,KAAA,EAAO,QAAQ,CAAA,EAAG;AAC5C,QAAA,OAAO,QAAA;AAAA,MACT;AACA,MAAA,QAAA,EAAA;AAAA,IACF;AAGA,IAAA,OAAO,IAAA,CAAK,GAAA,CAAI,CAAA,EAAG,WAAW,CAAA;AAAA,EAChC;AAAA;AAAA;AAAA;AAAA;AAAA,EAMQ,kBAAA,CAAmB,OAAoB,UAAA,EAA6B;AAC1E,IAAA,MAAM,cAAA,GAAiB,KAAA,CAAM,KAAA,CAAM,UAAU,CAAA;AAG7C,IAAA,MAAM,UAAA,uBAAiB,GAAA,EAAY;AACnC,IAAA,MAAM,aAAA,uBAAoB,GAAA,EAAY;AAEtC,IAAA,KAAA,MAAW,QAAQ,cAAA,EAAgB;AACjC,MAAA,IAAI,IAAA,CAAK,SAAS,SAAA,EAAW;AAE7B,MAAA,KAAA,MAAW,OAAA,IAAW,KAAK,OAAA,EAAS;AAClC,QAAA,IAAI,QAAQ,IAAA,KAAA,UAAA,iBAA+B;AACzC,UAAA,UAAA,CAAW,GAAA,CAAI,QAAQ,EAAE,CAAA;AAAA,QAC3B,CAAA,MAAA,IAAW,QAAQ,IAAA,KAAA,aAAA,oBAAkC;AACnD,UAAA,aAAA,CAAc,GAAA,CAAI,QAAQ,WAAW,CAAA;AAAA,QACvC;AAAA,MACF;AAAA,IACF;AAIA,IAAA,KAAA,MAAW,YAAY,aAAA,EAAe;AACpC,MAAA,IAAI,CAAC,UAAA,CAAW,GAAA,CAAI,QAAQ,CAAA,EAAG;AAC7B,QAAA,OAAO,KAAA;AAAA,MACT;AAAA,IACF;AAKA,IAAA,KAAA,MAAW,SAAS,UAAA,EAAY;AAC9B,MAAA,IAAI,CAAC,aAAA,CAAc,GAAA,CAAI,KAAK,CAAA,EAAG;AAG7B,QAAA,MAAM,WAAA,GAAc,cAAA,CAAe,cAAA,CAAe,MAAA,GAAS,CAAC,CAAA;AAC5D,QAAA,MAAM,+BACJ,WAAA,EAAa,IAAA,KAAS,aACtB,WAAA,CAAY,IAAA,KAAA,WAAA,oBACZ,YAAY,OAAA,CAAQ,IAAA;AAAA,UAClB,CAAC,CAAA,KAAW,CAAA,CAAE,IAAA,KAAA,UAAA,mBAAiC,EAAE,EAAA,KAAO;AAAA,SAC1D;AAEF,QAAA,IAAI,CAAC,4BAAA,EAA8B;AACjC,UAAA,OAAO,KAAA;AAAA,QACT;AAAA,MACF;AAAA,IACF;AAEA,IAAA,OAAO,IAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAMA,MAAM,MAAA,EAAuB;AAE3B,IAAA,IAAA,CAAK,gBAAA,GAAmB,IAAA,CAAK,gBAAA,CAAiB,IAAA,CAAK,MAAM;AACvD,MAAA,IAAA,CAAK,SAAS,MAAM,CAAA;AAAA,IACtB,CAAC,CAAA;AAAA,EACH;AAAA;AAAA;AAAA;AAAA,EAKQ,SAAS,MAAA,EAAuB;AACtC,IAAA,IAAI,KAAK,MAAA,EAAQ;AAEjB,IAAA,IAAA,CAAK,MAAA,GAAS,IAAA;AACd,IAAA,IAAA,CAAK,YAAA,GAAe,IAAI,OAAA,CAAQ,CAACA,QAAAA,KAAY;AAC3C,MAAA,IAAA,CAAK,cAAA,GAAiBA,QAAAA;AAAA,IACxB,CAAC,CAAA;AAED,IAAA,IAAI,KAAK,OAAA,EAAS;AAChB,MAAA,IAAA,CAAK,QAAQ,MAAA,GAAS,IAAA;AACtB,MAAA,IAAA,CAAK,QAAQ,WAAA,GAAc,MAAA;AAC3B,MAAA,IAAA,CAAK,OAAA,CAAQ,KAAA,CAAM,kBAAA,EAAoB,EAAE,QAAQ,CAAA;AAAA,IACnD;AAEA,IAAA,IAAA,CAAK,KAAK,kBAAA,EAAoB;AAAA,MAC5B,WAAA,EAAa,IAAA,CAAK,OAAA,EAAS,WAAA,IAAe,SAAA;AAAA,MAC1C,QAAQ,MAAA,IAAU,cAAA;AAAA,MAClB,SAAA,sBAAe,IAAA;AAAK,KACrB,CAAA;AAAA,EACH;AAAA;AAAA;AAAA;AAAA,EAKA,MAAA,GAAe;AAEb,IAAA,IAAA,CAAK,gBAAA,GAAmB,IAAA,CAAK,gBAAA,CAAiB,IAAA,CAAK,MAAM;AACvD,MAAA,IAAA,CAAK,SAAA,EAAU;AAAA,IACjB,CAAC,CAAA;AAAA,EACH;AAAA;AAAA;AAAA;AAAA,EAKQ,SAAA,GAAkB;AACxB,IAAA,IAAI,CAAC,KAAK,MAAA,EAAQ;AAElB,IAAA,IAAA,CAAK,MAAA,GAAS,KAAA;AAEd,IAAA,IAAI,KAAK,OAAA,EAAS;AAChB,MAAA,IAAA,CAAK,QAAQ,MAAA,GAAS,KAAA;AACtB,MAAA,IAAA,CAAK,QAAQ,WAAA,GAAc,MAAA;AAC3B,MAAA,IAAA,CAAK,OAAA,CAAQ,KAAA,CAAM,mBAAA,EAAqB,EAAE,CAAA;AAAA,IAC5C;AAEA,IAAA,IAAI,KAAK,cAAA,EAAgB;AACvB,MAAA,IAAA,CAAK,cAAA,EAAe;AACpB,MAAA,IAAA,CAAK,cAAA,GAAiB,IAAA;AAAA,IACxB;AAEA,IAAA,IAAA,CAAK,YAAA,GAAe,IAAA;AAEpB,IAAA,IAAA,CAAK,KAAK,mBAAA,EAAqB;AAAA,MAC7B,WAAA,EAAa,IAAA,CAAK,OAAA,EAAS,WAAA,IAAe,SAAA;AAAA,MAC1C,SAAA,sBAAe,IAAA;AAAK,KACrB,CAAA;AAAA,EACH;AAAA;AAAA;AAAA;AAAA,EAKA,OAAO,MAAA,EAAuB;AAC5B,IAAA,IAAA,CAAK,SAAA,GAAY,IAAA;AAEjB,IAAA,IAAI,KAAK,OAAA,EAAS;AAChB,MAAA,IAAA,CAAK,QAAQ,SAAA,GAAY,IAAA;AACzB,MAAA,IAAA,CAAK,QAAQ,YAAA,GAAe,MAAA;AAAA,IAC9B;AAIA,IAAA,IAAI,KAAK,MAAA,EAAQ;AACf,MAAA,IAAA,CAAK,SAAA,EAAU;AAAA,IACjB;AAEA,IAAA,IAAA,CAAK,KAAK,qBAAA,EAAuB;AAAA,MAC/B,WAAA,EAAa,IAAA,CAAK,OAAA,EAAS,WAAA,IAAe,SAAA;AAAA,MAC1C,QAAQ,MAAA,IAAU,qBAAA;AAAA,MAClB,SAAA,sBAAe,IAAA;AAAK,KACrB,CAAA;AAAA,EACH;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,UAAA,GAA4B;AACxC,IAAA,IAAI,IAAA,CAAK,MAAA,IAAU,IAAA,CAAK,YAAA,EAAc;AACpC,MAAA,MAAM,IAAA,CAAK,YAAA;AAAA,IACb;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,UAAA,GAAsC;AACpC,IAAA,OAAO,IAAA,CAAK,OAAA;AAAA,EACd;AAAA;AAAA;AAAA;AAAA,EAKA,SAAA,GAAqB;AACnB,IAAA,OAAO,IAAA,CAAK,OAAA,KAAY,IAAA,IAAQ,CAAC,IAAA,CAAK,SAAA;AAAA,EACxC;AAAA;AAAA;AAAA;AAAA,EAKA,QAAA,GAAoB;AAClB,IAAA,OAAO,IAAA,CAAK,MAAA;AAAA,EACd;AAAA;AAAA;AAAA;AAAA,EAKA,WAAA,GAAuB;AACrB,IAAA,OAAO,IAAA,CAAK,SAAA;AAAA,EACd;AACF,CAAA;;;ACxnDO,SAAS,kBAAA,CAAmB,KAAqC,SAAA,EAAyB;AAC/F,EAAA,IAAI,IAAI,WAAA,EAAa;AACnB,IAAA,MAAM,IAAI,KAAA,CAAM,CAAA,OAAA,EAAU,SAAS,CAAA,6BAAA,CAA+B,CAAA;AAAA,EACpE;AACF;;;AClCA,YAAA,EAAA;AAoEO,IAAM,KAAA,GAAN,MAAM,MAAA,SAAc,SAAA,CAAiE;AAAA;AAAA,EAElF,QAAA;AAAA,EACA,WAAA;AAAA,EACA,cAAA,uBAA6E,GAAA,EAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAiBzF,OAAO,OAAO,MAAA,EAA4B;AACxC,IAAA,OAAO,IAAI,OAAM,MAAM,CAAA;AAAA,EACzB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAcA,aAAa,MAAA,CACX,SAAA,EACA,MAAA,EACgB;AAChB,IAAA,MAAM,KAAA,GAAQ,IAAI,MAAA,CAAM;AAAA,MACtB,GAAG,MAAA;AAAA,MACH,OAAA,EAAS;AAAA,QACP,GAAG,MAAA,CAAO,OAAA;AAAA,QACV,EAAA,EAAI;AAAA;AACN,KACD,CAAA;AAGD,IAAA,MAAM,MAAM,mBAAA,EAAoB;AAEhC,IAAA,OAAO,KAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EA+BA,aAAa,WAAA,CACX,OAAA,EACA,OAAA,EACA,SAAA,EACuB;AACvB,IAAA,MAAM,UAAA,GAAa,MAAM,OAAA,CAAQ,IAAA,CAAK,OAAO,CAAA;AAC7C,IAAA,IAAI,CAAC,UAAA,EAAY;AACf,MAAA,OAAO,IAAA;AAAA,IACT;AAGA,IAAA,MAAM,MAAA,GAAsB;AAAA,MAC1B,SAAA,EAAW,WAAW,SAAA,CAAU,IAAA;AAAA,MAChC,KAAA,EAAO,WAAW,SAAA,CAAU,KAAA;AAAA,MAC5B,cAAc,UAAA,CAAW,YAAA;AAAA,MACzB,OAAA,EAAS;AAAA,QACP,SAAS,UAAA,CAAW,OAAA;AAAA,QACpB,cAAc,UAAA,CAAW,YAAA;AAAA,QACzB,cAAc,UAAA,CAAW,YAAA;AAAA,QACzB,UAAU,UAAA,CAAW;AAAA,OACvB;AAAA,MACA,GAAG,UAAA,CAAW,UAAA;AAAA,MACd,GAAG;AAAA,KACL;AAEA,IAAA,OAAO,IAAI,OAAM,MAAM,CAAA;AAAA,EACzB;AAAA;AAAA,EAIQ,YAAY,MAAA,EAAqB;AACvC,IAAA,KAAA,CAAM,QAAQ,OAAO,CAAA;AAErB,IAAA,IAAA,CAAK,OAAA,CAAQ,KAAA,CAAM,EAAE,MAAA,IAAU,eAAe,CAAA;AAC9C,IAAA,OAAA,CAAQ,SAAA,CAAU,iBAAiB,CAAA,EAAG;AAAA,MACpC,OAAO,IAAA,CAAK,KAAA;AAAA,MACZ,SAAA,EAAW,KAAK,SAAA,CAAU;AAAA,KAC3B,CAAA;AAGD,IAAA,IAAA,CAAK,QAAA,GAAW,cAAA,CAAe,IAAA,CAAK,SAAS,CAAA;AAG7C,IAAA,IAAI,OAAO,YAAA,EAAc;AACvB,MAAA,IAAA,CAAK,aAAA,CAAc,eAAe,MAAA,CAAO,YAAA;AAAA,IAC3C;AACA,IAAA,IAAA,CAAK,OAAA,CAAQ,MAAM,6CAA6C,CAAA;AAGhE,IAAA,IAAA,CAAK,cAAc,KAAA,CAAM,EAAA,CAAG,mBAAmB,CAAC,EAAE,MAAK,KAAM;AAC3D,MAAA,MAAM,UAAA,GAAa,IAAA,CAAK,aAAA,CAAc,KAAA,CAAM,cAAc,IAAI,CAAA;AAC9D,MAAA,IAAI,UAAA,EAAY;AACd,QAAA,IAAA,CAAK,kBAAA,CAAmB,aAAA,CAAc,IAAA,EAAM,UAAU,CAAA;AAAA,MACxD;AAAA,IACF,CAAC,CAAA;AAID,IAAA,IAAA,CAAK,cAAc,IAAI,WAAA;AAAA,MACrB,IAAA,CAAK,QAAA;AAAA,MACL,KAAK,aAAA,CAAc,KAAA;AAAA,MACnB,MAAA,CAAO,KAAA;AAAA,MACP,MAAA,CAAO;AAAA,KACT;AAGA,IAAA,IAAA,CAAK,oBAAA,EAAqB;AAG1B,IAAA,IAAA,CAAK,iBAAA,CAAkB,OAAO,OAAO,CAAA;AAAA,EACvC;AAAA;AAAA,EAIU,YAAA,GAA2D;AACnE,IAAA,OAAO,OAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUA,UAAA,GAAsB;AACpB,IAAA,OAAO,IAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,eAAA,GAAwD;AAC5D,IAAA,OAAO,IAAA,CAAK,cAAc,QAAA,EAAS;AAAA,EACrC;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,oBAAoB,KAAA,EAAmD;AAC3E,IAAA,MAAM,IAAA,CAAK,aAAA,CAAc,YAAA,CAAa,KAAK,CAAA;AAAA,EAC7C;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,MAAM,IAAI,KAAA,EAAqD;AAC7D,IAAA,kBAAA,CAAmB,MAAM,WAAW,CAAA;AAGpC,IAAA,MAAM,KAAK,mBAAA,EAAoB;AAE/B,IAAA,MAAM,YAAA,GAAe,OAAO,KAAA,KAAU,QAAA,GAClC,KAAA,CAAM,SAAA,CAAU,CAAA,EAAG,GAAG,CAAA,GACtB,CAAA,EAAG,KAAA,CAAM,MAAM,CAAA,SAAA,CAAA;AAEnB,IAAA,IAAA,CAAK,QAAQ,IAAA,CAAK;AAAA,MAChB,YAAA;AAAA,MACA,SAAA,EAAW,IAAA,CAAK,OAAA,CAAQ,KAAA,EAAO,MAAA,IAAU;AAAA,OACxC,mBAAmB,CAAA;AAEtB,IAAA,OAAA,CAAQ,SAAA,CAAU,qBAAqB,CAAA,EAAG;AAAA,MACxC,OAAO,IAAA,CAAK,KAAA;AAAA,MACZ,SAAA,EAAW,KAAK,SAAA,CAAU;AAAA,KAC3B,CAAA;AAED,IAAA,MAAM,SAAA,GAAY,KAAK,GAAA,EAAI;AAG3B,IAAA,MAAM,WAAA,GAAc,OAAO,KAAA,KAAU,QAAA,GACjC,QACA,KAAA,CAAM,GAAA,CAAI,CAAA,CAAA,KAAK,IAAA,CAAK,SAAA,CAAU,CAAC,CAAC,CAAA,CAAE,KAAK,IAAI,CAAA;AAC/C,IAAA,IAAA,CAAK,aAAA,CAAc,gBAAgB,WAAW,CAAA;AAE9C,IAAA,IAAI;AAEF,MAAA,MAAM,KAAA,GAAQ,KAAK,yBAAA,EAA0B;AAE7C,MAAA,MAAM,UAAA,GAAgC;AAAA,QACpC,OAAO,IAAA,CAAK,KAAA;AAAA,QACZ,KAAA;AAAA,QACA,YAAA,EAAc,KAAK,OAAA,CAAQ,YAAA;AAAA,QAC3B,KAAA;AAAA,QACA,WAAA,EAAa,KAAK,OAAA,CAAQ,WAAA;AAAA,QAC1B,aAAA,EAAe,IAAA,CAAK,OAAA,CAAQ,aAAA,IAAiB,EAAA;AAAA,QAC7C,aAAA,EAAe,KAAK,OAAA,CAAQ,aAAA;AAAA,QAC5B,KAAA,EAAO,KAAK,OAAA,CAAQ,KAAA;AAAA,QACpB,WAAA,EAAa,KAAK,OAAA,CAAQ,WAAA;AAAA,QAC1B,MAAA,EAAQ,KAAK,OAAA,CAAQ,MAAA;AAAA,QACrB,aAAA,EAAe,KAAK,OAAA,CAAQ,aAAA;AAAA,QAC5B,mBAAmB,IAAA,CAAK,kBAAA;AAAA,QACxB,SAAA,EAAW,OAAA;AAAA;AAAA;AAAA,QAGX,cAAc,IAAA,CAAK;AAAA,OACrB;AAEA,MAAA,MAAM,QAAA,GAAW,MAAM,IAAA,CAAK,WAAA,CAAY,QAAQ,UAAU,CAAA;AAE1D,MAAA,MAAM,QAAA,GAAW,IAAA,CAAK,GAAA,EAAI,GAAI,SAAA;AAI9B,MAAA,IAAA,CAAK,OAAA,CAAQ,IAAA,CAAK,EAAE,QAAA,IAAY,qBAAqB,CAAA;AAErD,MAAA,OAAA,CAAQ,MAAA,CAAO,sBAAsB,QAAA,EAAU;AAAA,QAC7C,OAAO,IAAA,CAAK,KAAA;AAAA,QACZ,SAAA,EAAW,KAAK,SAAA,CAAU;AAAA,OAC3B,CAAA;AAED,MAAA,OAAA,CAAQ,SAAA,CAAU,uBAAuB,CAAA,EAAG;AAAA,QAC1C,OAAO,IAAA,CAAK,KAAA;AAAA,QACZ,SAAA,EAAW,KAAK,SAAA,CAAU,IAAA;AAAA,QAC1B,MAAA,EAAQ;AAAA,OACT,CAAA;AAED,MAAA,OAAO,QAAA;AAAA,IACT,SAAS,KAAA,EAAO;AACd,MAAA,MAAM,QAAA,GAAW,IAAA,CAAK,GAAA,EAAI,GAAI,SAAA;AAE9B,MAAA,IAAA,CAAK,QAAQ,KAAA,CAAM;AAAA,QACjB,OAAQ,KAAA,CAAgB,OAAA;AAAA,QACxB;AAAA,SACC,kBAAkB,CAAA;AAErB,MAAA,OAAA,CAAQ,SAAA,CAAU,uBAAuB,CAAA,EAAG;AAAA,QAC1C,OAAO,IAAA,CAAK,KAAA;AAAA,QACZ,SAAA,EAAW,KAAK,SAAA,CAAU,IAAA;AAAA,QAC1B,MAAA,EAAQ;AAAA,OACT,CAAA;AAED,MAAA,MAAM,KAAA;AAAA,IACR;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,OAAO,OAAO,KAAA,EAAiE;AAC7E,IAAA,kBAAA,CAAmB,MAAM,mBAAmB,CAAA;AAG5C,IAAA,MAAM,KAAK,mBAAA,EAAoB;AAE/B,IAAA,MAAM,YAAA,GAAe,OAAO,KAAA,KAAU,QAAA,GAClC,KAAA,CAAM,SAAA,CAAU,CAAA,EAAG,GAAG,CAAA,GACtB,CAAA,EAAG,KAAA,CAAM,MAAM,CAAA,SAAA,CAAA;AAEnB,IAAA,IAAA,CAAK,QAAQ,IAAA,CAAK;AAAA,MAChB,YAAA;AAAA,MACA,SAAA,EAAW,IAAA,CAAK,OAAA,CAAQ,KAAA,EAAO,MAAA,IAAU;AAAA,OACxC,sBAAsB,CAAA;AAEzB,IAAA,OAAA,CAAQ,SAAA,CAAU,wBAAwB,CAAA,EAAG;AAAA,MAC3C,OAAO,IAAA,CAAK,KAAA;AAAA,MACZ,SAAA,EAAW,KAAK,SAAA,CAAU;AAAA,KAC3B,CAAA;AAED,IAAA,MAAM,SAAA,GAAY,KAAK,GAAA,EAAI;AAG3B,IAAA,MAAM,WAAA,GAAc,OAAO,KAAA,KAAU,QAAA,GACjC,QACA,KAAA,CAAM,GAAA,CAAI,CAAA,CAAA,KAAK,IAAA,CAAK,SAAA,CAAU,CAAC,CAAC,CAAA,CAAE,KAAK,IAAI,CAAA;AAC/C,IAAA,IAAA,CAAK,aAAA,CAAc,gBAAgB,WAAW,CAAA;AAE9C,IAAA,IAAI;AAEF,MAAA,MAAM,KAAA,GAAQ,KAAK,yBAAA,EAA0B;AAE7C,MAAA,MAAM,UAAA,GAAgC;AAAA,QACpC,OAAO,IAAA,CAAK,KAAA;AAAA,QACZ,KAAA;AAAA,QACA,YAAA,EAAc,KAAK,OAAA,CAAQ,YAAA;AAAA,QAC3B,KAAA;AAAA,QACA,WAAA,EAAa,KAAK,OAAA,CAAQ,WAAA;AAAA,QAC1B,aAAA,EAAe,IAAA,CAAK,OAAA,CAAQ,aAAA,IAAiB,EAAA;AAAA,QAC7C,aAAA,EAAe,KAAK,OAAA,CAAQ,aAAA;AAAA,QAC5B,KAAA,EAAO,KAAK,OAAA,CAAQ,KAAA;AAAA,QACpB,WAAA,EAAa,KAAK,OAAA,CAAQ,WAAA;AAAA,QAC1B,MAAA,EAAQ,KAAK,OAAA,CAAQ,MAAA;AAAA,QACrB,aAAA,EAAe,KAAK,OAAA,CAAQ,aAAA;AAAA,QAC5B,mBAAmB,IAAA,CAAK,kBAAA;AAAA,QACxB,SAAA,EAAW,OAAA;AAAA;AAAA;AAAA,QAGX,cAAc,IAAA,CAAK;AAAA,OACrB;AAEA,MAAA,WAAA,MAAiB,KAAA,IAAS,IAAA,CAAK,WAAA,CAAY,gBAAA,CAAiB,UAAU,CAAA,EAAG;AACvE,QAAA,MAAM,KAAA;AAAA,MACR;AAIA,MAAA,MAAM,QAAA,GAAW,IAAA,CAAK,GAAA,EAAI,GAAI,SAAA;AAE9B,MAAA,IAAA,CAAK,OAAA,CAAQ,IAAA,CAAK,EAAE,QAAA,IAAY,wBAAwB,CAAA;AAExD,MAAA,OAAA,CAAQ,MAAA,CAAO,yBAAyB,QAAA,EAAU;AAAA,QAChD,OAAO,IAAA,CAAK,KAAA;AAAA,QACZ,SAAA,EAAW,KAAK,SAAA,CAAU;AAAA,OAC3B,CAAA;AAED,MAAA,OAAA,CAAQ,SAAA,CAAU,0BAA0B,CAAA,EAAG;AAAA,QAC7C,OAAO,IAAA,CAAK,KAAA;AAAA,QACZ,SAAA,EAAW,KAAK,SAAA,CAAU,IAAA;AAAA,QAC1B,MAAA,EAAQ;AAAA,OACT,CAAA;AAAA,IACH,SAAS,KAAA,EAAO;AACd,MAAA,MAAM,QAAA,GAAW,IAAA,CAAK,GAAA,EAAI,GAAI,SAAA;AAE9B,MAAA,IAAA,CAAK,QAAQ,KAAA,CAAM;AAAA,QACjB,OAAQ,KAAA,CAAgB,OAAA;AAAA,QACxB;AAAA,SACC,qBAAqB,CAAA;AAExB,MAAA,OAAA,CAAQ,SAAA,CAAU,0BAA0B,CAAA,EAAG;AAAA,QAC7C,OAAO,IAAA,CAAK,KAAA;AAAA,QACZ,SAAA,EAAW,KAAK,SAAA,CAAU,IAAA;AAAA,QAC1B,MAAA,EAAQ;AAAA,OACT,CAAA;AAED,MAAA,MAAM,KAAA;AAAA,IACR;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUA,sBAAsB,QAAA,EAAwB;AAC5C,IAAA,IAAA,CAAK,kBAAA,CAAmB,kBAAkB,QAAQ,CAAA;AAAA,EACpD;AAAA;AAAA;AAAA;AAAA,EAKA,mBAAmB,QAAA,EAAwB;AACzC,IAAA,IAAA,CAAK,kBAAA,CAAmB,OAAO,QAAQ,CAAA;AAAA,EACzC;AAAA;AAAA;AAAA;AAAA,EAKA,gBAAA,GAA6B;AAC3B,IAAA,OAAO,IAAA,CAAK,mBAAmB,gBAAA,EAAiB;AAAA,EAClD;AAAA;AAAA;AAAA;AAAA,EAKA,kBAAkB,QAAA,EAA2B;AAC3C,IAAA,OAAO,IAAA,CAAK,kBAAA,CAAmB,eAAA,CAAgB,QAAQ,CAAA,CAAE,aAAA;AAAA,EAC3D;AAAA;AAAA;AAAA;AAAA,EAKA,cAAc,QAAA,EAA2B;AACvC,IAAA,OAAO,IAAA,CAAK,kBAAA,CAAmB,SAAA,CAAU,QAAQ,CAAA;AAAA,EACnD;AAAA;AAAA;AAAA;AAAA,EAKA,cAAc,QAAA,EAAwB;AACpC,IAAA,IAAA,CAAK,kBAAA,CAAmB,aAAa,QAAQ,CAAA;AAAA,EAC/C;AAAA;AAAA;AAAA;AAAA,EAKA,cAAc,QAAA,EAAwB;AACpC,IAAA,IAAA,CAAK,kBAAA,CAAmB,aAAa,QAAQ,CAAA;AAAA,EAC/C;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,SAAS,KAAA,EAAqB;AAC5B,IAAC,KAA2B,KAAA,GAAQ,KAAA;AACpC,IAAA,IAAA,CAAK,QAAQ,KAAA,GAAQ,KAAA;AAAA,EACvB;AAAA;AAAA;AAAA;AAAA,EAKA,cAAA,GAAqC;AACnC,IAAA,OAAO,KAAK,OAAA,CAAQ,WAAA;AAAA,EACtB;AAAA;AAAA;AAAA;AAAA,EAKA,eAAe,WAAA,EAA2B;AACxC,IAAA,IAAA,CAAK,QAAQ,WAAA,GAAc,WAAA;AAAA,EAC7B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAiCA,MAAM,cAAA,CACJ,OAAA,EACA,QAAA,EACe;AACf,IAAA,MAAM,GAAA,GAAA,iBAAM,IAAI,IAAA,EAAK,EAAE,WAAA,EAAY;AAEnC,IAAA,MAAM,UAAA,GAAoC;AAAA,MACxC,OAAA,EAAS,CAAA;AAAA,MACT,OAAA,EAAS,KAAK,aAAA,CAAc,OAAA;AAAA,MAC5B,MAAM,QAAA,EAAU,WAAA,GAAc,KAAK,aAAA,CAAc,OAAA,GAAU,KAAK,aAAA,CAAc,OAAA;AAAA,MAC9E,SAAA,EAAW,OAAA;AAAA,MACX,SAAA,EAAW,GAAA;AAAA,MACX,SAAA,EAAW,GAAA;AAAA,MACX,SAAA,EAAW;AAAA,QACT,IAAA,EAAM,KAAK,SAAA,CAAU,IAAA;AAAA,QACrB,OAAO,IAAA,CAAK;AAAA,OACd;AAAA,MACA,YAAA,EAAc,KAAK,aAAA,CAAc,YAAA;AAAA,MACjC,YAAA,EAAc,KAAK,OAAA,CAAQ,YAAA;AAAA,MAC3B,QAAA,EAAU,KAAK,aAAA,CAAc,QAAA;AAAA,MAC7B,QAAA;AAAA,MACA,UAAA,EAAY;AAAA,QACV,WAAA,EAAa,KAAK,OAAA,CAAQ,WAAA;AAAA,QAC1B,aAAA,EAAe,KAAK,OAAA,CAAQ,aAAA;AAAA,QAC5B,aAAA,EAAe,KAAK,OAAA,CAAQ;AAAA;AAC9B,KACF;AAEA,IAAA,MAAM,OAAA,CAAQ,KAAK,UAAU,CAAA;AAAA,EAC/B;AAAA;AAAA,EAIA,MAAM,MAAA,EAAuB;AAC3B,IAAA,IAAA,CAAK,WAAA,CAAY,MAAM,MAAM,CAAA;AAAA,EAC/B;AAAA,EAEA,MAAA,GAAe;AACb,IAAA,IAAA,CAAK,YAAY,MAAA,EAAO;AAAA,EAC1B;AAAA,EAEA,OAAO,MAAA,EAAuB;AAC5B,IAAA,IAAA,CAAK,WAAA,CAAY,OAAO,MAAM,CAAA;AAAA,EAChC;AAAA;AAAA,EAIA,UAAA,GAAsC;AACpC,IAAA,OAAO,IAAA,CAAK,YAAY,UAAA,EAAW;AAAA,EACrC;AAAA,EAEA,UAAA,GAAa;AACX,IAAA,OAAO,IAAA,CAAK,WAAA,CAAY,UAAA,EAAW,EAAG,OAAA,IAAW,IAAA;AAAA,EACnD;AAAA,EAEA,UAAA,GAAa;AACX,IAAA,OAAO,IAAA,CAAK,WAAA,CAAY,UAAA,EAAW,EAAG,YAAW,IAAK,IAAA;AAAA,EACxD;AAAA,EAEA,aAAA,GAAgB;AACd,IAAA,OAAO,KAAK,WAAA,CAAY,UAAA,EAAW,EAAG,aAAA,MAAmB,EAAC;AAAA,EAC5D;AAAA;AAAA;AAAA;AAAA,EAKA,gCAAA,GAAmC;AACjC,IAAA,IAAI,0BAAA,IAA8B,KAAK,QAAA,EAAU;AAC/C,MAAA,OAAQ,IAAA,CAAK,SAAiB,wBAAA,EAAyB;AAAA,IACzD;AACA,IAAA,OAAO,IAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,2BAAA,GAA8B;AAC5B,IAAA,OAAO,IAAA,CAAK,aAAA,CAAc,KAAA,CAAM,uBAAA,EAAwB;AAAA,EAC1D;AAAA;AAAA;AAAA;AAAA,EAKA,6BAA6B,QAAA,EAAkB;AAC7C,IAAA,OAAO,IAAA,CAAK,aAAA,CAAc,KAAA,CAAM,4BAAA,CAA6B,QAAQ,CAAA;AAAA,EACvE;AAAA;AAAA;AAAA;AAAA,EAKA,wBAAwB,QAAA,EAAwB;AAC9C,IAAA,IAAA,CAAK,aAAA,CAAc,KAAA,CAAM,uBAAA,CAAwB,QAAQ,CAAA;AACzD,IAAA,IAAA,CAAK,OAAA,CAAQ,IAAA,CAAK,EAAE,QAAA,IAAY,oCAAoC,CAAA;AAAA,EACtE;AAAA,EAEA,SAAA,GAAqB;AACnB,IAAA,OAAO,IAAA,CAAK,YAAY,SAAA,EAAU;AAAA,EACpC;AAAA,EAEA,QAAA,GAAoB;AAClB,IAAA,OAAO,IAAA,CAAK,YAAY,QAAA,EAAS;AAAA,EACnC;AAAA,EAEA,WAAA,GAAuB;AACrB,IAAA,OAAO,IAAA,CAAK,YAAY,WAAA,EAAY;AAAA,EACtC;AAAA;AAAA,EAIA,OAAA,GAAgB;AACd,IAAA,IAAI,KAAK,YAAA,EAAc;AACrB,MAAA;AAAA,IACF;AAEA,IAAA,IAAA,CAAK,OAAA,CAAQ,MAAM,uBAAuB,CAAA;AAG1C,IAAA,IAAI;AACF,MAAA,IAAA,CAAK,WAAA,CAAY,OAAO,iBAAiB,CAAA;AAAA,IAC3C,CAAA,CAAA,MAAQ;AAAA,IAER;AAGA,IAAA,KAAA,MAAW,CAAC,SAAA,EAAW,OAAO,CAAA,IAAK,KAAK,cAAA,EAAgB;AACtD,MAAA,IAAA,CAAK,WAAA,CAAY,GAAA,CAAI,SAAA,EAAW,OAAO,CAAA;AAAA,IACzC;AACA,IAAA,IAAA,CAAK,eAAe,KAAA,EAAM;AAK1B,IAAA,KAAA,MAAW,QAAA,IAAY,KAAK,iBAAA,EAAmB;AAC7C,MAAA,IAAI;AACF,QAAA,QAAA,EAAS;AAAA,MACX,SAAS,KAAA,EAAO;AACd,QAAA,IAAA,CAAK,QAAQ,KAAA,CAAM,EAAE,OAAQ,KAAA,CAAgB,OAAA,IAAW,wBAAwB,CAAA;AAAA,MAClF;AAAA,IACF;AACA,IAAA,IAAA,CAAK,oBAAoB,EAAC;AAG1B,IAAA,IAAA,CAAK,WAAA,EAAY;AAEjB,IAAA,OAAA,CAAQ,SAAA,CAAU,mBAAmB,CAAA,EAAG;AAAA,MACtC,OAAO,IAAA,CAAK,KAAA;AAAA,MACZ,SAAA,EAAW,KAAK,SAAA,CAAU;AAAA,KAC3B,CAAA;AAED,IAAA,IAAA,CAAK,OAAA,CAAQ,MAAM,iBAAiB,CAAA;AAAA,EACtC;AAAA;AAAA,EAIQ,oBAAA,GAA6B;AACnC,IAAA,MAAM,UAAA,GAA6C;AAAA,MACjD,iBAAA;AAAA,MACA,oBAAA;AAAA,MACA,iBAAA;AAAA,MACA,kBAAA;AAAA,MACA,mBAAA;AAAA,MACA,qBAAA;AAAA,MACA,iBAAA;AAAA,MACA,oBAAA;AAAA,MACA,aAAA;AAAA,MACA,cAAA;AAAA,MACA,WAAA;AAAA,MACA,eAAA;AAAA,MACA,YAAA;AAAA,MACA,eAAA;AAAA,MACA,YAAA;AAAA,MACA,cAAA;AAAA,MACA;AAAA,KACF;AAEA,IAAA,MAAM,aAAyE,EAAC;AAEhF,IAAA,IAAI;AACF,MAAA,KAAA,MAAW,aAAa,UAAA,EAAY;AAClC,QAAA,MAAM,OAAA,GAAU,CAAC,IAAA,KAAc;AAC7B,UAAA,IAAI,CAAC,KAAK,YAAA,EAAc;AACtB,YAAA,IAAA,CAAK,IAAA,CAAK,WAAW,IAAI,CAAA;AAAA,UAC3B;AAAA,QACF,CAAA;AACA,QAAA,IAAA,CAAK,WAAA,CAAY,EAAA,CAAG,SAAA,EAAW,OAAO,CAAA;AACtC,QAAA,UAAA,CAAW,IAAA,CAAK,CAAC,SAAA,EAAW,OAAO,CAAC,CAAA;AACpC,QAAA,IAAA,CAAK,cAAA,CAAe,GAAA,CAAI,SAAA,EAAW,OAAO,CAAA;AAAA,MAC5C;AAAA,IACF,SAAS,KAAA,EAAO;AAEd,MAAA,KAAA,MAAW,CAAC,SAAA,EAAW,OAAO,CAAA,IAAK,UAAA,EAAY;AAC7C,QAAA,IAAA,CAAK,WAAA,CAAY,GAAA,CAAI,SAAA,EAAW,OAAO,CAAA;AAAA,MACzC;AACA,MAAA,MAAM,KAAA;AAAA,IACR;AAAA,EACF;AACF;;;ACntBO,SAAS,qBAAqB,OAAA,EAAuC;AAC1E,EAAA,MAAM,QAAwB,EAAC;AAG/B,EAAA,KAAA,CAAM,IAAA,CAAK,wBAAwB,CAAA;AAGnC,EAAA,IAAI,OAAA,CAAQ,gBAAA,CAAiB,QAAQ,CAAA,EAAG;AACtC,IAAA,KAAA,CAAM,IAAA,CAAK,uBAAuB,CAAA;AAClC,IAAA,KAAA,CAAM,IAAA,CAAK,0BAA0B,CAAA;AACrC,IAAA,KAAA,CAAM,IAAA,CAAK,wBAAwB,CAAA;AACnC,IAAA,KAAA,CAAM,IAAA,CAAK,uBAAuB,CAAA;AAClC,IAAA,KAAA,CAAM,IAAA,CAAK,4BAA4B,CAAA;AAAA,EACzC;AAKA,EAAA,OAAO,KAAA;AACT;AAKO,SAAS,0BAAA,GAA6C;AAC3D,EAAA,OAAO,CAAC,wBAAwB,CAAA;AAClC;AAKO,SAAS,cAAA,GAAiC;AAC/C,EAAA,OAAO;AAAA,IACL,qBAAA,EAAsB;AAAA,IACtB,wBAAA,EAAyB;AAAA,IACzB,sBAAA,EAAuB;AAAA,IACvB,qBAAA,EAAsB;AAAA,IACtB,0BAAA;AAA2B,GAC7B;AACF;CCpEO,MAAmB;AAAA,EACxB,OAAe,aAAA,GAAgB;AAAA,IAC7B,yBAAA;AAAA,IACA8B,IAAAA,CAAKC,OAAAA,EAAQ,EAAG,YAAA,EAAc,aAAa;AAAA,GAC7C;AAAA;AAAA;AAAA;AAAA,EAKA,aAAa,KAAK9B,KAAAA,EAAyC;AACzD,IAAA,MAAM,aAAaA,KAAAA,GAAO,OAAA,CAAQA,KAAI,CAAA,GAAI,MAAM,KAAK,UAAA,EAAW;AAEhE,IAAA,IAAI,CAAC,UAAA,EAAY;AACf,MAAA,MAAM,IAAI,KAAA,CAAM,0CAAA,GAA6C,KAAK,aAAA,CAAc,IAAA,CAAK,IAAI,CAAC,CAAA;AAAA,IAC5F;AAEA,IAAA,IAAI;AACF,MAAA,MAAM,OAAA,GAAU,MAAMF,QAAAA,CAAG,QAAA,CAAS,YAAY,OAAO,CAAA;AACrD,MAAA,IAAI,MAAA,GAA0B,IAAA,CAAK,KAAA,CAAM,OAAO,CAAA;AAGhD,MAAA,MAAA,GAAS,IAAA,CAAK,mBAAmB,MAAM,CAAA;AAGvC,MAAA,IAAA,CAAK,SAAS,MAAM,CAAA;AAEpB,MAAA,OAAO,MAAA;AAAA,IACT,SAAS,KAAA,EAAO;AACd,MAAA,IAAI,iBAAiB,WAAA,EAAa;AAChC,QAAA,MAAM,IAAI,KAAA,CAAM,CAAA,oCAAA,EAAuC,UAAU,CAAA,GAAA,EAAM,KAAA,CAAM,OAAO,CAAA,CAAE,CAAA;AAAA,MACxF;AACA,MAAA,MAAM,KAAA;AAAA,IACR;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,OAAO,SAASE,KAAAA,EAAgC;AAC9C,IAAA,MAAM,aAAaA,KAAAA,GAAO,OAAA,CAAQA,KAAI,CAAA,GAAI,KAAK,cAAA,EAAe;AAE9D,IAAA,IAAI,CAAC,UAAA,EAAY;AACf,MAAA,MAAM,IAAI,KAAA,CAAM,0CAAA,GAA6C,KAAK,aAAA,CAAc,IAAA,CAAK,IAAI,CAAC,CAAA;AAAA,IAC5F;AAEA,IAAA,IAAI;AACF,MAAA,MAAMF,IAAAA,GAAK,UAAQ,IAAI,CAAA;AACvB,MAAA,MAAM,OAAA,GAAUA,IAAAA,CAAG,YAAA,CAAa,UAAA,EAAY,OAAO,CAAA;AACnD,MAAA,IAAI,MAAA,GAA0B,IAAA,CAAK,KAAA,CAAM,OAAO,CAAA;AAGhD,MAAA,MAAA,GAAS,IAAA,CAAK,mBAAmB,MAAM,CAAA;AAGvC,MAAA,IAAA,CAAK,SAAS,MAAM,CAAA;AAEpB,MAAA,OAAO,MAAA;AAAA,IACT,SAAS,KAAA,EAAO;AACd,MAAA,IAAI,iBAAiB,WAAA,EAAa;AAChC,QAAA,MAAM,IAAI,KAAA,CAAM,CAAA,oCAAA,EAAuC,UAAU,CAAA,GAAA,EAAM,KAAA,CAAM,OAAO,CAAA,CAAE,CAAA;AAAA,MACxF;AACA,MAAA,MAAM,KAAA;AAAA,IACR;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,aAAqB,UAAA,GAAqC;AACxD,IAAA,KAAA,MAAWE,KAAAA,IAAQ,KAAK,aAAA,EAAe;AACrC,MAAA,IAAI;AACF,QAAA,MAAMF,QAAAA,CAAG,MAAA,CAAO,OAAA,CAAQE,KAAI,CAAC,CAAA;AAC7B,QAAA,OAAO,QAAQA,KAAI,CAAA;AAAA,MACrB,CAAA,CAAA,MAAQ;AAAA,MAER;AAAA,IACF;AACA,IAAA,OAAO,IAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,OAAe,cAAA,GAAgC;AAC7C,IAAA,MAAMF,IAAAA,GAAK,UAAQ,IAAI,CAAA;AACvB,IAAA,KAAA,MAAWE,KAAAA,IAAQ,KAAK,aAAA,EAAe;AACrC,MAAA,IAAI;AACF,QAAAF,IAAAA,CAAG,UAAA,CAAW,OAAA,CAAQE,KAAI,CAAC,CAAA;AAC3B,QAAA,OAAO,QAAQA,KAAI,CAAA;AAAA,MACrB,CAAA,CAAA,MAAQ;AAAA,MAER;AAAA,IACF;AACA,IAAA,OAAO,IAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,OAAe,mBAAmB,MAAA,EAA0C;AAC1E,IAAA,MAAM,UAAA,GAAa,IAAA,CAAK,SAAA,CAAU,MAAM,CAAA;AACxC,IAAA,MAAM,eAAe,UAAA,CAAW,OAAA,CAAQ,gBAAA,EAAkB,CAAC,OAAO,MAAA,KAAW;AAC3E,MAAA,MAAM,KAAA,GAAQ,OAAA,CAAQ,GAAA,CAAI,MAAM,CAAA;AAChC,MAAA,IAAI,UAAU,MAAA,EAAW;AAEvB,QAAA,OAAA,CAAQ,IAAA,CAAK,CAAA,+BAAA,EAAkC,MAAM,CAAA,YAAA,CAAc,CAAA;AACnE,QAAA,OAAO,KAAA;AAAA,MACT;AACA,MAAA,OAAO,KAAA;AAAA,IACT,CAAC,CAAA;AAED,IAAA,OAAO,IAAA,CAAK,MAAM,YAAY,CAAA;AAAA,EAChC;AAAA;AAAA;AAAA;AAAA,EAKA,OAAe,SAAS,MAAA,EAA+B;AACrD,IAAA,IAAI,OAAO,MAAA,KAAW,QAAA,IAAY,MAAA,KAAW,IAAA,EAAM;AACjD,MAAA,MAAM,IAAI,MAAM,iCAAiC,CAAA;AAAA,IACnD;AAGA,IAAA,IAAI,OAAO,GAAA,EAAK;AACd,MAAA,IAAI,CAAC,KAAA,CAAM,OAAA,CAAQ,MAAA,CAAO,GAAA,CAAI,OAAO,CAAA,EAAG;AACtC,QAAA,MAAM,IAAI,MAAM,+CAA+C,CAAA;AAAA,MACjE;AAEA,MAAA,KAAA,MAAW,MAAA,IAAU,MAAA,CAAO,GAAA,CAAI,OAAA,EAAS;AACvC,QAAA,IAAI,CAAC,OAAO,IAAA,EAAM;AAChB,UAAA,MAAM,IAAI,MAAM,0CAA0C,CAAA;AAAA,QAC5D;AACA,QAAA,IAAI,CAAC,OAAO,SAAA,EAAW;AACrB,UAAA,MAAM,IAAI,KAAA,CAAM,CAAA,YAAA,EAAe,MAAA,CAAO,IAAI,CAAA,+BAAA,CAAiC,CAAA;AAAA,QAC7E;AACA,QAAA,IAAI,CAAC,OAAO,eAAA,EAAiB;AAC3B,UAAA,MAAM,IAAI,KAAA,CAAM,CAAA,YAAA,EAAe,MAAA,CAAO,IAAI,CAAA,qCAAA,CAAuC,CAAA;AAAA,QACnF;AAAA,MACF;AAAA,IACF;AAAA,EACF;AACF;;;ACnJO,IAAM,QAAA,GAAN,cAAuB,KAAA,CAAM;AAAA,EAClC,WAAA,CACE,OAAA,EACgB,UAAA,EACA,KAAA,EAChB;AACA,IAAA,KAAA,CAAM,OAAO,CAAA;AAHG,IAAA,IAAA,CAAA,UAAA,GAAA,UAAA;AACA,IAAA,IAAA,CAAA,KAAA,GAAA,KAAA;AAGhB,IAAA,IAAA,CAAK,IAAA,GAAO,UAAA;AACZ,IAAA,IAAI,KAAA,EAAO;AACT,MAAA,IAAA,CAAK,KAAA,GAAQ,CAAA,EAAG,IAAA,CAAK,KAAK;AAAA,WAAA,EAAgB,MAAM,KAAK,CAAA,CAAA;AAAA,IACvD;AAAA,EACF;AACF;AAKO,IAAM,kBAAA,GAAN,cAAiC,QAAA,CAAS;AAAA,EAC/C,WAAA,CAAY,OAAA,EAAiB,UAAA,EAAqB,KAAA,EAAe;AAC/D,IAAA,KAAA,CAAM,OAAA,EAAS,YAAY,KAAK,CAAA;AAChC,IAAA,IAAA,CAAK,IAAA,GAAO,oBAAA;AAAA,EACd;AACF;AAKO,IAAM,eAAA,GAAN,cAA8B,QAAA,CAAS;AAAA,EAC5C,WAAA,CACE,OAAA,EACgB,SAAA,EAChB,UAAA,EACA,KAAA,EACA;AACA,IAAA,KAAA,CAAM,OAAA,EAAS,YAAY,KAAK,CAAA;AAJhB,IAAA,IAAA,CAAA,SAAA,GAAA,SAAA;AAKhB,IAAA,IAAA,CAAK,IAAA,GAAO,iBAAA;AAAA,EACd;AACF;AAKO,IAAM,gBAAA,GAAN,cAA+B,QAAA,CAAS;AAAA,EAC7C,WAAA,CAAY,OAAA,EAAiB,UAAA,EAAqB,KAAA,EAAe;AAC/D,IAAA,KAAA,CAAM,OAAA,EAAS,YAAY,KAAK,CAAA;AAChC,IAAA,IAAA,CAAK,IAAA,GAAO,kBAAA;AAAA,EACd;AACF;AAKO,IAAM,YAAA,GAAN,cAA2B,QAAA,CAAS;AAAA,EACzC,WAAA,CACE,OAAA,EACgB,QAAA,EAChB,UAAA,EACA,KAAA,EACA;AACA,IAAA,KAAA,CAAM,OAAA,EAAS,YAAY,KAAK,CAAA;AAJhB,IAAA,IAAA,CAAA,QAAA,GAAA,QAAA;AAKhB,IAAA,IAAA,CAAK,IAAA,GAAO,cAAA;AAAA,EACd;AACF;AAKO,IAAM,gBAAA,GAAN,cAA+B,QAAA,CAAS;AAAA,EAC7C,WAAA,CACE,OAAA,EACgB,WAAA,EAChB,UAAA,EACA,KAAA,EACA;AACA,IAAA,KAAA,CAAM,OAAA,EAAS,YAAY,KAAK,CAAA;AAJhB,IAAA,IAAA,CAAA,WAAA,GAAA,WAAA;AAKhB,IAAA,IAAA,CAAK,IAAA,GAAO,kBAAA;AAAA,EACd;AACF;;;ACwEO,SAAS,mBAAA,CACd,QACA,QAAA,EAMA;AACA,EAAA,OAAO;AAAA,IACL,MAAM,MAAA,CAAO,IAAA;AAAA,IACb,aAAa,MAAA,CAAO,WAAA;AAAA,IACpB,aAAa,MAAA,CAAO,WAAA;AAAA,IACpB,WAAW,MAAA,CAAO,SAAA;AAAA,IAClB,iBAAiB,MAAA,CAAO,eAAA;AAAA,IACxB,WAAA,EAAa,MAAA,CAAO,WAAA,IAAe,QAAA,EAAU,WAAA,IAAe,KAAA;AAAA,IAC5D,aAAA,EAAe,MAAA,CAAO,aAAA,IAAiB,QAAA,EAAU,aAAA,IAAiB,IAAA;AAAA,IAClE,mBAAA,EAAqB,MAAA,CAAO,mBAAA,IAAuB,QAAA,EAAU,mBAAA,IAAuB,GAAA;AAAA,IACpF,oBAAA,EAAsB,MAAA,CAAO,oBAAA,IAAwB,QAAA,EAAU,oBAAA,IAAwB,EAAA;AAAA,IACvF,gBAAA,EAAkB,MAAA,CAAO,gBAAA,IAAoB,QAAA,EAAU,gBAAA,IAAoB,GAAA;AAAA,IAC3E,qBAAA,EAAuB,MAAA,CAAO,qBAAA,IAAyB,QAAA,EAAU,qBAAA,IAAyB,GAAA;AAAA,IAC1F,aAAA,EAAe,MAAA,CAAO,aAAA,IAAiB,CAAA,IAAA,EAAO,OAAO,IAAI,CAAA,CAAA;AAAA,IACzD,aAAa,MAAA,CAAO;AAAA,GACtB;AACF;;;ACxKO,SAAS,oBAAA,CACd,IAAA,EACA,MAAA,EACA,SAAA,EACc;AACd,EAAA,MAAM,QAAA,GAAW,CAAA,EAAG,SAAS,CAAA,CAAA,EAAI,KAAK,IAAI,CAAA,CAAA;AAE1C,EAAA,OAAO;AAAA,IACL,UAAA,EAAY;AAAA,MACV,IAAA,EAAM,UAAA;AAAA,MACN,QAAA,EAAU;AAAA,QACR,IAAA,EAAM,QAAA;AAAA,QACN,WAAA,EAAa,KAAK,WAAA,IAAe,CAAA,UAAA,EAAa,KAAK,IAAI,CAAA,eAAA,EAAkB,OAAO,IAAI,CAAA,CAAA,CAAA;AAAA,QACpF,YAAY,IAAA,CAAK;AAAA;AACnB,KACF;AAAA,IAEA,MAAM,QAAQ,IAAA,EAAgE;AAC5E,MAAA,IAAI;AACF,QAAA,MAAM,SAAS,MAAM,MAAA,CAAO,QAAA,CAAS,IAAA,CAAK,MAAM,IAAI,CAAA;AAGpD,QAAA,IAAI,MAAA,CAAO,SAAS,MAAA,KAAW,CAAA,IAAK,OAAO,OAAA,CAAQ,CAAC,CAAA,EAAG,IAAA,KAAS,MAAA,EAAQ;AACtE,UAAA,OAAO,MAAA,CAAO,OAAA,CAAQ,CAAC,CAAA,CAAE,IAAA,IAAQ,EAAA;AAAA,QACnC;AAGA,QAAA,OAAO,MAAA;AAAA,MACT,SAAS,KAAA,EAAO;AACd,QAAA,IAAI,iBAAiB,YAAA,EAAc;AACjC,UAAA,MAAM,KAAA;AAAA,QACR;AACA,QAAA,MAAM,IAAI,YAAA;AAAA,UACR,CAAA,4BAAA,EAA+B,KAAK,IAAI,CAAA,CAAA,CAAA;AAAA,UACxC,IAAA,CAAK,IAAA;AAAA,UACL,MAAA,CAAO,IAAA;AAAA,UACP;AAAA,SACF;AAAA,MACF;AAAA,IACF,CAAA;AAAA,IAEA,aAAa,IAAA,EAAuC;AAElD,MAAA,MAAM,UAAA,GAAa;AAAA,QACjB,WAAA;AAAA,QACA,MAAA;AAAA,QACA,KAAA;AAAA,QACA,KAAA;AAAA,QACA,OAAA;AAAA,QACA,SAAA;AAAA,QACA,MAAA;AAAA,QACA,IAAA;AAAA,QACA;AAAA,OACF;AAEA,MAAA,KAAA,MAAW,OAAO,UAAA,EAAY;AAC5B,QAAA,IAAI,OAAO,IAAA,IAAQ,OAAO,IAAA,CAAK,GAAG,MAAM,QAAA,EAAU;AAChD,UAAA,OAAO,KAAK,GAAG,CAAA;AAAA,QACjB;AAAA,MACF;AAGA,MAAA,KAAA,MAAW,KAAA,IAAS,MAAA,CAAO,MAAA,CAAO,IAAI,CAAA,EAAG;AACvC,QAAA,IAAI,OAAO,KAAA,KAAU,QAAA,IAAY,KAAA,CAAM,SAAS,CAAA,EAAG;AACjD,UAAA,OAAO,KAAA,CAAM,SAAS,EAAA,GAAK,CAAA,EAAG,MAAM,SAAA,CAAU,CAAA,EAAG,EAAE,CAAC,CAAA,GAAA,CAAA,GAAQ,KAAA;AAAA,QAC9D;AAAA,MACF;AAGA,MAAA,OAAO,IAAA,CAAK,IAAA;AAAA,IACd;AAAA,GACF;AACF;AAKO,SAAS,qBAAA,CACd,KAAA,EACA,MAAA,EACA,SAAA,EACgB;AAChB,EAAA,OAAO,KAAA,CAAM,IAAI,CAAC,IAAA,KAAS,qBAAqB,IAAA,EAAM,MAAA,EAAQ,SAAS,CAAC,CAAA;AAC1E;;;AC/CO,IAAM,SAAA,GAAN,cAAwBiB,YAAAA,CAAgD;AAAA,EAC7D,IAAA;AAAA,EACC,MAAA;AAAA,EACT,MAAA,GAAwB,IAAA;AAAA,EACxB,SAAA,GAA8B,IAAA;AAAA,EAC9B,MAAA,GAAmC,cAAA;AAAA,EACnC,aAAA;AAAA,EACA,SAAoB,EAAC;AAAA,EACrB,iBAAA,GAAoB,CAAA;AAAA,EACpB,cAAA;AAAA,EACA,gBAAA;AAAA,EACA,mBAAA,uBAA0B,GAAA,EAAY;AAAA,EACtC,mBAAA,uBAA0B,GAAA,EAAY;AAAA,EACtC,YAAA,GAAe,KAAA;AAAA,EAEvB,WAAA,CAAY,QAAyB,QAAA,EAAyC;AAC5E,IAAA,KAAA,EAAM;AACN,IAAA,IAAA,CAAK,OAAO,MAAA,CAAO,IAAA;AACnB,IAAA,IAAA,CAAK,MAAA,GAAS,mBAAA,CAAoB,MAAA,EAAQ,QAAQ,CAAA;AAAA,EACpD;AAAA;AAAA,EAIA,IAAI,KAAA,GAAkC;AACpC,IAAA,OAAO,IAAA,CAAK,MAAA;AAAA,EACd;AAAA,EAEA,IAAI,YAAA,GAAkD;AACpD,IAAA,OAAO,IAAA,CAAK,aAAA;AAAA,EACd;AAAA,EAEA,IAAI,KAAA,GAAmB;AACrB,IAAA,OAAO,IAAA,CAAK,MAAA;AAAA,EACd;AAAA;AAAA,EAIA,MAAM,OAAA,GAAyB;AAC7B,IAAA,IAAI,IAAA,CAAK,MAAA,KAAW,WAAA,IAAe,IAAA,CAAK,WAAW,YAAA,EAAc;AAC/D,MAAA;AAAA,IACF;AAEA,IAAA,IAAA,CAAK,MAAA,GAAS,YAAA;AACd,IAAA,IAAA,CAAK,KAAK,YAAY,CAAA;AAEtB,IAAA,IAAI;AAEF,MAAA,IAAA,CAAK,SAAA,GAAY,KAAK,eAAA,EAAgB;AAGtC,MAAA,IAAA,CAAK,SAAS,IAAI,MAAA;AAAA,QAChB;AAAA,UACE,IAAA,EAAM,mBAAA;AAAA,UACN,OAAA,EAAS;AAAA,SACX;AAAA,QACA;AAAA,UACE,YAAA,EAAc;AAAA;AAAA;AAEd;AACF,OACF;AAGA,MAAA,MAAM,IAAA,CAAK,MAAA,CAAO,OAAA,CAAQ,IAAA,CAAK,SAAS,CAAA;AAIxC,MAAA,IAAA,CAAK,gBAAgB,EAAC;AAGtB,MAAA,IAAA,CAAK,MAAA,GAAS,WAAA;AACd,MAAA,IAAA,CAAK,iBAAA,GAAoB,CAAA;AAGzB,MAAA,MAAM,KAAK,YAAA,EAAa;AAExB,MAAA,IAAA,CAAK,KAAK,WAAW,CAAA;AAGrB,MAAA,IAAA,CAAK,gBAAA,EAAiB;AAAA,IACxB,SAAS,KAAA,EAAO;AAEd,MAAA,IAAA,CAAK,eAAA,EAAgB;AAErB,MAAA,IAAI,KAAK,MAAA,EAAQ;AACf,QAAA,IAAI;AACF,UAAA,MAAM,IAAA,CAAK,OAAO,KAAA,EAAM;AAAA,QAC1B,CAAA,CAAA,MAAQ;AAAA,QAER;AACA,QAAA,IAAA,CAAK,MAAA,GAAS,IAAA;AAAA,MAChB;AACA,MAAA,IAAA,CAAK,SAAA,GAAY,IAAA;AACjB,MAAA,IAAA,CAAK,SAAS,EAAC;AACf,MAAA,IAAA,CAAK,aAAA,GAAgB,MAAA;AAErB,MAAA,IAAA,CAAK,MAAA,GAAS,QAAA;AACd,MAAA,MAAM,WAAW,IAAI,kBAAA;AAAA,QACnB,CAAA,iCAAA,EAAoC,KAAK,IAAI,CAAA,CAAA,CAAA;AAAA,QAC7C,IAAA,CAAK,IAAA;AAAA,QACL;AAAA,OACF;AACA,MAAA,IAAA,CAAK,IAAA,CAAK,UAAU,QAAQ,CAAA;AAC5B,MAAA,IAAA,CAAK,IAAA,CAAK,SAAS,QAAQ,CAAA;AAG3B,MAAA,IAAI,IAAA,CAAK,OAAO,aAAA,EAAe;AAC7B,QAAA,IAAA,CAAK,iBAAA,EAAkB;AAAA,MACzB,CAAA,MAAO;AACL,QAAA,MAAM,QAAA;AAAA,MACR;AAAA,IACF;AAAA,EACF;AAAA,EAEA,MAAM,UAAA,GAA4B;AAChC,IAAA,IAAA,CAAK,eAAA,EAAgB;AACrB,IAAA,IAAA,CAAK,aAAA,EAAc;AAEnB,IAAA,IAAI,IAAA,CAAK,MAAA,IAAU,IAAA,CAAK,SAAA,EAAW;AACjC,MAAA,IAAI;AACF,QAAA,MAAM,IAAA,CAAK,OAAO,KAAA,EAAM;AAAA,MAC1B,SAAS,KAAA,EAAO;AAAA,MAEhB;AAAA,IACF;AAEA,IAAA,IAAA,CAAK,MAAA,GAAS,IAAA;AACd,IAAA,IAAA,CAAK,SAAA,GAAY,IAAA;AACjB,IAAA,IAAA,CAAK,MAAA,GAAS,cAAA;AACd,IAAA,IAAA,CAAK,SAAS,EAAC;AACf,IAAA,IAAA,CAAK,KAAK,cAAc,CAAA;AAAA,EAC1B;AAAA,EAEA,MAAM,SAAA,GAA2B;AAC/B,IAAA,MAAM,KAAK,UAAA,EAAW;AACtB,IAAA,MAAM,KAAK,OAAA,EAAQ;AAAA,EACrB;AAAA,EAEA,WAAA,GAAuB;AACrB,IAAA,OAAO,KAAK,MAAA,KAAW,WAAA;AAAA,EACzB;AAAA,EAEA,MAAM,IAAA,GAAyB;AAC7B,IAAA,IAAI,CAAC,IAAA,CAAK,MAAA,IAAU,CAAC,IAAA,CAAK,aAAY,EAAG;AACvC,MAAA,OAAO,KAAA;AAAA,IACT;AAEA,IAAA,IAAI;AACF,MAAA,MAAM,IAAA,CAAK,OAAO,IAAA,EAAK;AACvB,MAAA,OAAO,IAAA;AAAA,IACT,SAAS,KAAA,EAAO;AACd,MAAA,OAAO,KAAA;AAAA,IACT;AAAA,EACF;AAAA;AAAA,EAIA,MAAM,SAAA,GAAgC;AACpC,IAAA,IAAA,CAAK,eAAA,EAAgB;AAErB,IAAA,IAAI;AACF,MAAA,MAAM,QAAA,GAAW,MAAM,IAAA,CAAK,MAAA,CAAQ,QAAQ,EAAE,MAAA,EAAQ,YAAA,EAAa,EAAG,qBAAqB,CAAA;AAE3F,MAAA,IAAA,CAAK,MAAA,GAAS,QAAA,CAAS,KAAA,CAAM,GAAA,CAAI,CAAC,IAAA,MAAU;AAAA,QAC1C,MAAM,IAAA,CAAK,IAAA;AAAA,QACX,aAAa,IAAA,CAAK,WAAA;AAAA,QAClB,aAAa,IAAA,CAAK;AAAA,OACpB,CAAE,CAAA;AAEF,MAAA,OAAO,IAAA,CAAK,MAAA;AAAA,IACd,SAAS,KAAA,EAAO;AACd,MAAA,MAAM,IAAI,SAAS,CAAA,kCAAA,EAAqC,IAAA,CAAK,IAAI,CAAA,CAAA,CAAA,EAAK,IAAA,CAAK,MAAM,KAAc,CAAA;AAAA,IACjG;AAAA,EACF;AAAA,EAEA,MAAM,QAAA,CAAS,IAAA,EAAc,IAAA,EAAuD;AAClF,IAAA,IAAA,CAAK,eAAA,EAAgB;AAErB,IAAA,IAAA,CAAK,IAAA,CAAK,aAAA,EAAe,IAAA,EAAM,IAAI,CAAA;AAEnC,IAAA,IAAI;AACF,MAAA,MAAM,QAAA,GAAW,MAAM,IAAA,CAAK,MAAA,CAAQ,OAAA;AAAA,QAClC;AAAA,UACE,MAAA,EAAQ,YAAA;AAAA,UACR,MAAA,EAAQ;AAAA,YACN,IAAA;AAAA,YACA,SAAA,EAAW;AAAA;AACb,SACF;AAAA,QACA;AAAA,OACF;AAEA,MAAA,MAAM,MAAA,GAAwB;AAAA,QAC5B,OAAA,EAAS,QAAA,CAAS,OAAA,CAAQ,GAAA,CAAI,CAAC,IAAA,MAAU;AAAA,UACvC,MAAM,IAAA,CAAK,IAAA;AAAA,UACX,IAAA,EAAM,MAAA,IAAU,IAAA,GAAO,IAAA,CAAK,IAAA,GAAO,KAAA,CAAA;AAAA,UACnC,IAAA,EAAM,MAAA,IAAU,IAAA,GAAO,IAAA,CAAK,IAAA,GAAO,KAAA,CAAA;AAAA,UACnC,QAAA,EAAU,UAAA,IAAc,IAAA,GAAO,IAAA,CAAK,QAAA,GAAW,KAAA,CAAA;AAAA,UAC/C,GAAA,EAAK,KAAA,IAAS,IAAA,GAAO,IAAA,CAAK,GAAA,GAAM,KAAA;AAAA,SAClC,CAAE,CAAA;AAAA,QACF,SAAS,QAAA,CAAS;AAAA,OACpB;AAEA,MAAA,IAAA,CAAK,IAAA,CAAK,aAAA,EAAe,IAAA,EAAM,MAAM,CAAA;AAErC,MAAA,IAAI,OAAO,OAAA,EAAS;AAClB,QAAA,MAAM,SAAA,GAAY,MAAA,CAAO,OAAA,CAAQ,IAAA,CAAK,CAAC,MAAM,CAAA,CAAE,IAAA,KAAS,MAAM,CAAA,EAAG,IAAA,IAAQ,eAAA;AACzE,QAAA,MAAM,IAAI,YAAA,CAAa,SAAA,EAAW,IAAA,EAAM,KAAK,IAAI,CAAA;AAAA,MACnD;AAEA,MAAA,OAAO,MAAA;AAAA,IACT,SAAS,KAAA,EAAO;AACd,MAAA,IAAI,iBAAiB,YAAA,EAAc;AACjC,QAAA,MAAM,KAAA;AAAA,MACR;AACA,MAAA,MAAM,IAAI,YAAA;AAAA,QACR,CAAA,qBAAA,EAAwB,IAAI,CAAA,aAAA,EAAgB,IAAA,CAAK,IAAI,CAAA,CAAA,CAAA;AAAA,QACrD,IAAA;AAAA,QACA,IAAA,CAAK,IAAA;AAAA,QACL;AAAA,OACF;AAAA,IACF;AAAA,EACF;AAAA,EAEA,cAAc,WAAA,EAAgC;AAC5C,IAAA,IAAI,IAAA,CAAK,MAAA,CAAO,MAAA,KAAW,CAAA,EAAG;AAC5B,MAAA;AAAA,IACF;AAGA,IAAA,MAAM,gBAAgB,qBAAA,CAAsB,IAAA,CAAK,QAAQ,IAAA,EAAM,IAAA,CAAK,OAAO,aAAa,CAAA;AAGxF,IAAA,KAAA,MAAW,UAAU,aAAA,EAAe;AAClC,MAAA,MAAM,QAAA,GAAW,MAAA,CAAO,UAAA,CAAW,QAAA,CAAS,IAAA;AAE5C,MAAA,WAAA,CAAY,SAAS,MAAA,EAAQ;AAAA,QAC3B,SAAA,EAAW,KAAK,MAAA,CAAO,aAAA;AAAA,QACvB,OAAA,EAAS,IAAA;AAAA,QACT,UAAA,EAAY,IAAA,CAAK,MAAA,CAAO,WAAA,GACpB;AAAA,UACE,KAAA,EAAO,IAAA,CAAK,MAAA,CAAO,WAAA,CAAY,YAAA;AAAA,UAC/B,SAAA,EAAW,IAAA,CAAK,MAAA,CAAO,WAAA,CAAY;AAAA,SACrC,GACA;AAAA,OACL,CAAA;AAED,MAAA,IAAA,CAAK,mBAAA,CAAoB,IAAI,QAAQ,CAAA;AAAA,IACvC;AAAA,EACF;AAAA,EAEA,gBAAgB,WAAA,EAAgC;AAC9C,IAAA,KAAA,MAAW,QAAA,IAAY,KAAK,mBAAA,EAAqB;AAC/C,MAAA,WAAA,CAAY,WAAW,QAAQ,CAAA;AAAA,IACjC;AACA,IAAA,IAAA,CAAK,oBAAoB,KAAA,EAAM;AAAA,EACjC;AAAA;AAAA,EAIA,MAAM,aAAA,GAAwC;AAC5C,IAAA,IAAA,CAAK,eAAA,EAAgB;AAErB,IAAA,IAAI;AACF,MAAA,MAAM,QAAA,GAAW,MAAM,IAAA,CAAK,MAAA,CAAQ,QAAQ,EAAE,MAAA,EAAQ,gBAAA,EAAiB,EAAG,yBAAyB,CAAA;AAEnG,MAAA,OAAO,QAAA,CAAS,SAAA,CAAU,GAAA,CAAI,CAAC,QAAA,MAAc;AAAA,QAC3C,KAAK,QAAA,CAAS,GAAA;AAAA,QACd,MAAM,QAAA,CAAS,IAAA;AAAA,QACf,aAAa,QAAA,CAAS,WAAA;AAAA,QACtB,UAAU,QAAA,CAAS;AAAA,OACrB,CAAE,CAAA;AAAA,IACJ,SAAS,KAAA,EAAO;AACd,MAAA,MAAM,IAAI,QAAA;AAAA,QACR,CAAA,sCAAA,EAAyC,KAAK,IAAI,CAAA,CAAA,CAAA;AAAA,QAClD,IAAA,CAAK,IAAA;AAAA,QACL;AAAA,OACF;AAAA,IACF;AAAA,EACF;AAAA,EAEA,MAAM,aAAa,GAAA,EAA0C;AAC3D,IAAA,IAAA,CAAK,eAAA,EAAgB;AAErB,IAAA,IAAI;AACF,MAAA,MAAM,QAAA,GAAW,MAAM,IAAA,CAAK,MAAA,CAAQ,OAAA;AAAA,QAClC;AAAA,UACE,MAAA,EAAQ,gBAAA;AAAA,UACR,MAAA,EAAQ,EAAE,GAAA;AAAI,SAChB;AAAA,QACA;AAAA,OACF;AAEA,MAAA,MAAM,OAAA,GAAU,QAAA,CAAS,QAAA,GAAW,CAAC,CAAA;AACrC,MAAA,IAAI,CAAC,OAAA,EAAS;AACZ,QAAA,MAAM,IAAI,QAAA,CAAS,CAAA,kCAAA,EAAqC,GAAG,CAAA,CAAA,CAAA,EAAK,KAAK,IAAI,CAAA;AAAA,MAC3E;AAEA,MAAA,OAAO;AAAA,QACL,KAAK,OAAA,CAAQ,GAAA;AAAA,QACb,UAAU,OAAA,CAAQ,QAAA;AAAA,QAClB,IAAA,EAAM,MAAA,IAAU,OAAA,GAAU,OAAA,CAAQ,IAAA,GAAO,KAAA,CAAA;AAAA,QACzC,IAAA,EAAM,MAAA,IAAU,OAAA,GAAU,OAAA,CAAQ,IAAA,GAAO,KAAA;AAAA,OAC3C;AAAA,IACF,SAAS,KAAA,EAAO;AACd,MAAA,MAAM,IAAI,QAAA;AAAA,QACR,CAAA,yBAAA,EAA4B,GAAG,CAAA,eAAA,EAAkB,IAAA,CAAK,IAAI,CAAA,CAAA,CAAA;AAAA,QAC1D,IAAA,CAAK,IAAA;AAAA,QACL;AAAA,OACF;AAAA,IACF;AAAA,EACF;AAAA,EAEA,MAAM,kBAAkB,GAAA,EAA4B;AAClD,IAAA,IAAA,CAAK,eAAA,EAAgB;AAErB,IAAA,IAAI,CAAC,IAAA,CAAK,aAAA,EAAe,SAAA,EAAW,SAAA,EAAW;AAC7C,MAAA,MAAM,IAAI,QAAA,CAAS,CAAA,QAAA,EAAW,KAAK,IAAI,CAAA,yCAAA,CAAA,EAA6C,KAAK,IAAI,CAAA;AAAA,IAC/F;AAEA,IAAA,IAAI;AAEF,MAAA,MAAM,KAAK,MAAA,CAAQ,OAAA;AAAA,QACjB;AAAA,UACE,MAAA,EAAQ,qBAAA;AAAA,UACR,MAAA,EAAQ,EAAE,GAAA;AAAI,SAChB;AAAA,QACA;AAAC;AAAA,OACH;AAEA,MAAA,IAAA,CAAK,mBAAA,CAAoB,IAAI,GAAG,CAAA;AAAA,IAClC,SAAS,KAAA,EAAO;AACd,MAAA,MAAM,IAAI,QAAA;AAAA,QACR,CAAA,iCAAA,EAAoC,GAAG,CAAA,aAAA,EAAgB,IAAA,CAAK,IAAI,CAAA,CAAA,CAAA;AAAA,QAChE,IAAA,CAAK,IAAA;AAAA,QACL;AAAA,OACF;AAAA,IACF;AAAA,EACF;AAAA,EAEA,MAAM,oBAAoB,GAAA,EAA4B;AACpD,IAAA,IAAA,CAAK,eAAA,EAAgB;AAErB,IAAA,IAAI;AAEF,MAAA,MAAM,KAAK,MAAA,CAAQ,OAAA;AAAA,QACjB;AAAA,UACE,MAAA,EAAQ,uBAAA;AAAA,UACR,MAAA,EAAQ,EAAE,GAAA;AAAI,SAChB;AAAA,QACA;AAAC;AAAA,OACH;AAEA,MAAA,IAAA,CAAK,mBAAA,CAAoB,OAAO,GAAG,CAAA;AAAA,IACrC,SAAS,KAAA,EAAO;AACd,MAAA,MAAM,IAAI,QAAA;AAAA,QACR,CAAA,qCAAA,EAAwC,GAAG,CAAA,aAAA,EAAgB,IAAA,CAAK,IAAI,CAAA,CAAA,CAAA;AAAA,QACpE,IAAA,CAAK,IAAA;AAAA,QACL;AAAA,OACF;AAAA,IACF;AAAA,EACF;AAAA;AAAA,EAIA,MAAM,WAAA,GAAoC;AACxC,IAAA,IAAA,CAAK,eAAA,EAAgB;AAErB,IAAA,IAAI;AACF,MAAA,MAAM,QAAA,GAAW,MAAM,IAAA,CAAK,MAAA,CAAQ,QAAQ,EAAE,MAAA,EAAQ,cAAA,EAAe,EAAG,uBAAuB,CAAA;AAE/F,MAAA,OAAO,QAAA,CAAS,OAAA,CAAQ,GAAA,CAAI,CAAC,MAAA,MAAY;AAAA,QACvC,MAAM,MAAA,CAAO,IAAA;AAAA,QACb,aAAa,MAAA,CAAO,WAAA;AAAA,QACpB,WAAW,MAAA,CAAO;AAAA,OACpB,CAAE,CAAA;AAAA,IACJ,SAAS,KAAA,EAAO;AACd,MAAA,MAAM,IAAI,SAAS,CAAA,oCAAA,EAAuC,IAAA,CAAK,IAAI,CAAA,CAAA,CAAA,EAAK,IAAA,CAAK,MAAM,KAAc,CAAA;AAAA,IACnG;AAAA,EACF;AAAA,EAEA,MAAM,SAAA,CAAU,IAAA,EAAc,IAAA,EAA0D;AACtF,IAAA,IAAA,CAAK,eAAA,EAAgB;AAErB,IAAA,IAAI;AACF,MAAA,MAAM,QAAA,GAAW,MAAM,IAAA,CAAK,MAAA,CAAQ,OAAA;AAAA,QAClC;AAAA,UACE,MAAA,EAAQ,aAAA;AAAA,UACR,MAAA,EAAQ;AAAA,YACN,IAAA;AAAA,YACA,SAAA,EAAW;AAAA;AACb,SACF;AAAA,QACA;AAAA,OACF;AAEA,MAAA,OAAO;AAAA,QACL,aAAa,QAAA,CAAS,WAAA;AAAA,QACtB,QAAA,EAAU,QAAA,CAAS,QAAA,CAAS,GAAA,CAAI,CAAC,GAAA,MAAS;AAAA,UACxC,MAAM,GAAA,CAAI,IAAA;AAAA,UACV,OAAA,EAAS;AAAA,YACP,IAAA,EAAM,IAAI,OAAA,CAAQ,IAAA;AAAA,YAClB,MAAM,MAAA,IAAU,GAAA,CAAI,OAAA,GAAU,GAAA,CAAI,QAAQ,IAAA,GAAO,KAAA,CAAA;AAAA,YACjD,MAAM,MAAA,IAAU,GAAA,CAAI,OAAA,GAAU,GAAA,CAAI,QAAQ,IAAA,GAAO,KAAA,CAAA;AAAA,YACjD,UAAU,UAAA,IAAc,GAAA,CAAI,OAAA,GAAU,GAAA,CAAI,QAAQ,QAAA,GAAW,KAAA,CAAA;AAAA,YAC7D,KAAK,KAAA,IAAS,GAAA,CAAI,OAAA,GAAU,GAAA,CAAI,QAAQ,GAAA,GAAM,KAAA;AAAA;AAChD,SACF,CAAE;AAAA,OACJ;AAAA,IACF,SAAS,KAAA,EAAO;AACd,MAAA,MAAM,IAAI,QAAA;AAAA,QACR,CAAA,sBAAA,EAAyB,IAAI,CAAA,eAAA,EAAkB,IAAA,CAAK,IAAI,CAAA,CAAA,CAAA;AAAA,QACxD,IAAA,CAAK,IAAA;AAAA,QACL;AAAA,OACF;AAAA,IACF;AAAA,EACF;AAAA;AAAA,EAIA,QAAA,GAA2B;AACzB,IAAA,OAAO;AAAA,MACL,MAAM,IAAA,CAAK,IAAA;AAAA,MACX,OAAO,IAAA,CAAK,MAAA;AAAA,MACZ,cAAc,IAAA,CAAK,aAAA;AAAA,MACnB,mBAAA,EAAqB,KAAA,CAAM,IAAA,CAAK,IAAA,CAAK,mBAAmB,CAAA;AAAA,MACxD,iBAAiB,IAAA,CAAK,MAAA,KAAW,WAAA,GAAc,IAAA,CAAK,KAAI,GAAI,MAAA;AAAA,MAC5D,oBAAoB,IAAA,CAAK;AAAA,KAC3B;AAAA,EACF;AAAA,EAEA,UAAU,KAAA,EAA6B;AACrC,IAAA,IAAA,CAAK,mBAAA,GAAsB,IAAI,GAAA,CAAI,KAAA,CAAM,mBAAmB,CAAA;AAC5D,IAAA,IAAA,CAAK,oBAAoB,KAAA,CAAM,kBAAA;AAAA,EACjC;AAAA;AAAA;AAAA;AAAA,EAKA,IAAI,WAAA,GAAuB;AACzB,IAAA,OAAO,IAAA,CAAK,YAAA;AAAA,EACd;AAAA,EAEA,OAAA,GAAgB;AACd,IAAA,IAAI,KAAK,YAAA,EAAc;AACvB,IAAA,IAAA,CAAK,YAAA,GAAe,IAAA;AACpB,IAAA,IAAA,CAAK,eAAA,EAAgB;AACrB,IAAA,IAAA,CAAK,aAAA,EAAc;AACnB,IAAA,IAAI,KAAK,MAAA,EAAQ;AACf,MAAA,IAAA,CAAK,MAAA,CAAO,KAAA,EAAM,CAAE,KAAA,CAAM,MAAM;AAAA,MAAC,CAAC,CAAA;AAClC,MAAA,IAAA,CAAK,MAAA,GAAS,IAAA;AAAA,IAChB;AACA,IAAA,IAAA,CAAK,SAAA,GAAY,IAAA;AACjB,IAAA,IAAA,CAAK,SAAS,EAAC;AACf,IAAA,IAAA,CAAK,aAAA,GAAgB,MAAA;AACrB,IAAA,IAAA,CAAK,MAAA,GAAS,cAAA;AACd,IAAA,IAAA,CAAK,oBAAoB,KAAA,EAAM;AAC/B,IAAA,IAAA,CAAK,oBAAoB,KAAA,EAAM;AAC/B,IAAA,IAAA,CAAK,kBAAA,EAAmB;AAAA,EAC1B;AAAA;AAAA,EAIQ,eAAA,GAA6B;AACnC,IAAA,MAAM,EAAE,SAAA,EAAW,eAAA,EAAgB,GAAI,IAAA,CAAK,MAAA;AAE5C,IAAA,IAAI,cAAc,OAAA,EAAS;AACzB,MAAA,MAAM,WAAA,GAAc,eAAA;AACpB,MAAA,OAAO,IAAI,oBAAA,CAAqB;AAAA,QAC9B,SAAS,WAAA,CAAY,OAAA;AAAA,QACrB,MAAM,WAAA,CAAY,IAAA;AAAA,QAClB,KAAK,WAAA,CAAY;AAAA,OAClB,CAAA;AAAA,IACH;AAEA,IAAA,IAAI,SAAA,KAAc,MAAA,IAAU,SAAA,KAAc,OAAA,EAAS;AACjD,MAAA,MAAM,UAAA,GAAa,eAAA;AAGnB,MAAA,MAAM,OAAA,GAAkC,EAAE,GAAG,UAAA,CAAW,OAAA,EAAQ;AAChE,MAAA,IAAI,WAAW,KAAA,EAAO;AACpB,QAAA,OAAA,CAAQ,eAAe,CAAA,GAAI,CAAA,OAAA,EAAU,UAAA,CAAW,KAAK,CAAA,CAAA;AAAA,MACvD;AAEA,MAAA,OAAO,IAAI,6BAAA,CAA8B,IAAI,GAAA,CAAI,UAAA,CAAW,GAAG,CAAA,EAAG;AAAA,QAChE,WAAW,UAAA,CAAW,SAAA;AAAA,QACtB,WAAA,EAAa;AAAA,UACX,OAAA;AAAA,UACA,GAAI,WAAW,SAAA,IAAa,EAAE,QAAQ,WAAA,CAAY,OAAA,CAAQ,UAAA,CAAW,SAAS,CAAA;AAAE,SAClF;AAAA,QACA,mBAAA,EAAqB,WAAW,YAAA,GAC5B;AAAA,UACE,oBAAA,EAAsB,UAAA,CAAW,YAAA,CAAa,oBAAA,IAAwB,GAAA;AAAA,UACtE,wBAAA,EAA0B,UAAA,CAAW,YAAA,CAAa,wBAAA,IAA4B,GAAA;AAAA,UAC9E,2BAAA,EAA6B,UAAA,CAAW,YAAA,CAAa,2BAAA,IAA+B,GAAA;AAAA,UACpF,UAAA,EAAY,UAAA,CAAW,YAAA,CAAa,UAAA,IAAc;AAAA,SACpD,GACA;AAAA,OACL,CAAA;AAAA,IACH;AAEA,IAAA,MAAM,IAAI,QAAA,CAAS,CAAA,WAAA,EAAc,SAAS,CAAA,eAAA,CAAA,EAAmB,KAAK,IAAI,CAAA;AAAA,EACxE;AAAA,EAEQ,eAAA,GAAwB;AAC9B,IAAA,IAAI,CAAC,IAAA,CAAK,MAAA,IAAU,CAAC,IAAA,CAAK,aAAY,EAAG;AACvC,MAAA,MAAM,IAAI,kBAAA,CAAmB,CAAA,YAAA,EAAe,KAAK,IAAI,CAAA,kBAAA,CAAA,EAAsB,KAAK,IAAI,CAAA;AAAA,IACtF;AAAA,EACF;AAAA,EAEA,MAAc,YAAA,GAA8B;AAC1C,IAAA,IAAI;AACF,MAAA,MAAM,KAAK,SAAA,EAAU;AAAA,IACvB,SAAS,KAAA,EAAO;AAEd,MAAA,IAAA,CAAK,IAAA,CAAK,SAAS,KAAK,CAAA;AAAA,IAC1B;AAAA,EACF;AAAA,EAEQ,gBAAA,GAAyB;AAC/B,IAAA,IAAI,IAAA,CAAK,MAAA,CAAO,qBAAA,IAAyB,CAAA,EAAG;AAC1C,MAAA;AAAA,IACF;AAEA,IAAA,IAAA,CAAK,gBAAA,GAAmB,YAAY,YAAY;AAC9C,MAAA,MAAM,KAAA,GAAQ,MAAM,IAAA,CAAK,IAAA,EAAK;AAC9B,MAAA,IAAI,CAAC,KAAA,IAAS,IAAA,CAAK,MAAA,KAAW,WAAA,EAAa;AACzC,QAAA,IAAA,CAAK,IAAA,CAAK,OAAA,EAAS,IAAI,kBAAA,CAAmB,CAAA,gCAAA,EAAmC,KAAK,IAAI,CAAA,CAAA,CAAA,EAAK,IAAA,CAAK,IAAI,CAAC,CAAA;AACrG,QAAA,IAAI,IAAA,CAAK,OAAO,aAAA,EAAe;AAC7B,UAAA,MAAM,KAAK,SAAA,EAAU;AAAA,QACvB;AAAA,MACF;AAAA,IACF,CAAA,EAAG,IAAA,CAAK,MAAA,CAAO,qBAAqB,CAAA;AAAA,EACtC;AAAA,EAEQ,eAAA,GAAwB;AAC9B,IAAA,IAAI,KAAK,gBAAA,EAAkB;AACzB,MAAA,aAAA,CAAc,KAAK,gBAAgB,CAAA;AACnC,MAAA,IAAA,CAAK,gBAAA,GAAmB,MAAA;AAAA,IAC1B;AAAA,EACF;AAAA,EAEQ,iBAAA,GAA0B;AAChC,IAAA,IAAI,IAAA,CAAK,iBAAA,IAAqB,IAAA,CAAK,MAAA,CAAO,oBAAA,EAAsB;AAC9D,MAAA,IAAA,CAAK,IAAA,CAAK,OAAA,EAAS,IAAI,kBAAA,CAAmB,CAAA,2CAAA,EAA8C,KAAK,IAAI,CAAA,CAAA,CAAA,EAAK,IAAA,CAAK,IAAI,CAAC,CAAA;AAChH,MAAA;AAAA,IACF;AAEA,IAAA,IAAA,CAAK,iBAAA,EAAA;AACL,IAAA,IAAA,CAAK,MAAA,GAAS,cAAA;AACd,IAAA,IAAA,CAAK,IAAA,CAAK,cAAA,EAAgB,IAAA,CAAK,iBAAiB,CAAA;AAGhD,IAAA,MAAM,KAAA,GAAQ,KAAK,MAAA,CAAO,mBAAA,GAAsB,KAAK,GAAA,CAAI,CAAA,EAAG,IAAA,CAAK,iBAAA,GAAoB,CAAC,CAAA;AAEtF,IAAA,IAAA,CAAK,cAAA,GAAiB,WAAW,YAAY;AAC3C,MAAA,IAAI;AACF,QAAA,MAAM,KAAK,OAAA,EAAQ;AAAA,MACrB,SAAS,KAAA,EAAO;AAAA,MAEhB;AAAA,IACF,GAAG,KAAK,CAAA;AAAA,EACV;AAAA,EAEQ,aAAA,GAAsB;AAC5B,IAAA,IAAI,KAAK,cAAA,EAAgB;AACvB,MAAA,YAAA,CAAa,KAAK,cAAc,CAAA;AAChC,MAAA,IAAA,CAAK,cAAA,GAAiB,MAAA;AAAA,IACxB;AAAA,EACF;AACF;AC3lBO,IAAM,cAAN,MAAkB;AAAA,EACvB,OAAe,OAAA,mBAAU,IAAI,GAAA,EAAwB;AAAA;AAAA;AAAA;AAAA,EAKrD,OAAO,MAAA,CAAO,MAAA,EAAyB,QAAA,EAAqD;AAC1F,IAAA,IAAI,IAAA,CAAK,OAAA,CAAQ,GAAA,CAAI,MAAA,CAAO,IAAI,CAAA,EAAG;AACjC,MAAA,MAAM,IAAI,QAAA,CAAS,CAAA,YAAA,EAAe,MAAA,CAAO,IAAI,CAAA,uBAAA,CAAyB,CAAA;AAAA,IACxE;AAEA,IAAA,MAAM,MAAA,GAAS,IAAI,SAAA,CAAU,MAAA,EAAQ,QAAQ,CAAA;AAC7C,IAAA,IAAA,CAAK,OAAA,CAAQ,GAAA,CAAI,MAAA,CAAO,IAAA,EAAM,MAAM,CAAA;AAEpC,IAAA,OAAO,MAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,OAAO,IAAI,IAAA,EAA0B;AACnC,IAAA,MAAM,MAAA,GAAS,IAAA,CAAK,OAAA,CAAQ,GAAA,CAAI,IAAI,CAAA;AACpC,IAAA,IAAI,CAAC,MAAA,EAAQ;AACX,MAAA,MAAM,IAAI,QAAA,CAAS,CAAA,YAAA,EAAe,IAAI,CAAA,uBAAA,CAAyB,CAAA;AAAA,IACjE;AACA,IAAA,OAAO,MAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,OAAO,IAAI,IAAA,EAAuB;AAChC,IAAA,OAAO,IAAA,CAAK,OAAA,CAAQ,GAAA,CAAI,IAAI,CAAA;AAAA,EAC9B;AAAA;AAAA;AAAA;AAAA,EAKA,OAAO,IAAA,GAAiB;AACtB,IAAA,OAAO,KAAA,CAAM,IAAA,CAAK,IAAA,CAAK,OAAA,CAAQ,MAAM,CAAA;AAAA,EACvC;AAAA;AAAA;AAAA;AAAA,EAKA,OAAO,QAAQ,IAAA,EAKb;AACA,IAAA,MAAM,MAAA,GAAS,IAAA,CAAK,GAAA,CAAI,IAAI,CAAA;AAC5B,IAAA,OAAO;AAAA,MACL,MAAM,MAAA,CAAO,IAAA;AAAA,MACb,OAAO,MAAA,CAAO,KAAA;AAAA,MACd,SAAA,EAAW,OAAO,WAAA,EAAY;AAAA,MAC9B,SAAA,EAAW,OAAO,KAAA,CAAM;AAAA,KAC1B;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,OAAO,UAAA,GAKJ;AACD,IAAA,OAAO,KAAA,CAAM,IAAA,CAAK,IAAA,CAAK,OAAA,CAAQ,IAAA,EAAM,CAAA,CAAE,GAAA,CAAI,CAAC,IAAA,KAAS,IAAA,CAAK,OAAA,CAAQ,IAAI,CAAC,CAAA;AAAA,EACzE;AAAA;AAAA;AAAA;AAAA,EAKA,OAAO,iBAAiB,MAAA,EAAwC;AAC9D,IAAA,MAAM,UAAwB,EAAC;AAE/B,IAAA,KAAA,MAAW,YAAA,IAAgB,OAAO,OAAA,EAAS;AACzC,MAAA,MAAM,MAAA,GAAS,IAAA,CAAK,MAAA,CAAO,YAAA,EAAc,OAAO,QAAQ,CAAA;AACxD,MAAA,OAAA,CAAQ,KAAK,MAAM,CAAA;AAAA,IACrB;AAEA,IAAA,OAAO,OAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,aAAa,mBAAmBjB,KAAAA,EAAqC;AACnE,IAAA,IAAI;AACF,MAAA,MAAM,UAAA,GAAaD,QAAQC,KAAI,CAAA;AAC/B,MAAA,MAAM,OAAA,GAAU,MAAMF,QAAAA,CAAG,QAAA,CAAS,YAAY,OAAO,CAAA;AACrD,MAAA,MAAM,MAAA,GAA0B,IAAA,CAAK,KAAA,CAAM,OAAO,CAAA;AAElD,MAAA,IAAI,CAAC,OAAO,GAAA,EAAK;AACf,QAAA,MAAM,IAAI,SAAS,iDAAiD,CAAA;AAAA,MACtE;AAGA,MAAA,MAAM,kBAAA,GAAqB,IAAA,CAAK,kBAAA,CAAmB,MAAA,CAAO,GAAG,CAAA;AAE7D,MAAA,OAAO,IAAA,CAAK,iBAAiB,kBAAkB,CAAA;AAAA,IACjD,SAAS,KAAA,EAAO;AACd,MAAA,IAAI,iBAAiB,QAAA,EAAU;AAC7B,QAAA,MAAM,KAAA;AAAA,MACR;AACA,MAAA,MAAM,IAAI,QAAA,CAAS,CAAA,uCAAA,EAA0CE,KAAI,CAAA,CAAA,CAAA,EAAK,QAAW,KAAc,CAAA;AAAA,IACjG;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,aAAa,UAAA,GAA4B;AACvC,IAAA,MAAM,kBAAmC,EAAC;AAE1C,IAAA,KAAA,MAAW,MAAA,IAAU,IAAA,CAAK,OAAA,CAAQ,MAAA,EAAO,EAAG;AAC1C,MAAA,IAAI,CAAC,MAAA,CAAO,WAAA,EAAY,EAAG;AACzB,QAAA,eAAA,CAAgB,IAAA,CAAK,MAAA,CAAO,OAAA,EAAS,CAAA;AAAA,MACvC;AAAA,IACF;AAEA,IAAA,MAAM,OAAA,CAAQ,IAAI,eAAe,CAAA;AAAA,EACnC;AAAA;AAAA;AAAA;AAAA,EAKA,aAAa,aAAA,GAA+B;AAC1C,IAAA,MAAM,qBAAsC,EAAC;AAE7C,IAAA,KAAA,MAAW,MAAA,IAAU,IAAA,CAAK,OAAA,CAAQ,MAAA,EAAO,EAAG;AAC1C,MAAA,IAAI,MAAA,CAAO,aAAY,EAAG;AACxB,QAAA,kBAAA,CAAmB,IAAA,CAAK,MAAA,CAAO,UAAA,EAAY,CAAA;AAAA,MAC7C;AAAA,IACF;AAEA,IAAA,MAAM,OAAA,CAAQ,IAAI,kBAAkB,CAAA;AAAA,EACtC;AAAA;AAAA;AAAA;AAAA,EAKA,OAAO,UAAA,GAAmB;AACxB,IAAA,KAAA,MAAW,MAAA,IAAU,IAAA,CAAK,OAAA,CAAQ,MAAA,EAAO,EAAG;AAC1C,MAAA,MAAA,CAAO,OAAA,EAAQ;AAAA,IACjB;AACA,IAAA,IAAA,CAAK,QAAQ,KAAA,EAAM;AAAA,EACrB;AAAA;AAAA;AAAA;AAAA,EAKA,OAAO,KAAA,GAAc;AACnB,IAAA,IAAA,CAAK,UAAA,EAAW;AAAA,EAClB;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,OAAe,mBAAmB,MAAA,EAA4C;AAC5E,IAAA,MAAM,UAAA,GAAa,IAAA,CAAK,SAAA,CAAU,MAAM,CAAA;AACxC,IAAA,MAAM,eAAe,UAAA,CAAW,OAAA,CAAQ,gBAAA,EAAkB,CAAC,QAAQ,MAAA,KAAW;AAC5E,MAAA,MAAM,KAAA,GAAQ,OAAA,CAAQ,GAAA,CAAI,MAAM,CAAA;AAChC,MAAA,IAAI,UAAU,MAAA,EAAW;AACvB,QAAA,MAAM,IAAI,QAAA,CAAS,CAAA,sBAAA,EAAyB,MAAM,CAAA,YAAA,CAAc,CAAA;AAAA,MAClE;AACA,MAAA,OAAO,KAAA;AAAA,IACT,CAAC,CAAA;AAED,IAAA,OAAO,IAAA,CAAK,MAAM,YAAY,CAAA;AAAA,EAChC;AACF;;;AC1LA,cAAA,EAAA;;;ACEA,mBAAA,EAAA;AACA,WAAA,EAAA;AACA,YAAA,EAAA;AAMO,IAAe,iBAAA,GAAf,cAAyC,YAAA,CAAkC;AAAA,EACtE,cAAA;AAAA,EACA,MAAA;AAAA,EACF,2BAAA,GAA8B,KAAA;AAAA,EAEtC,YAAY,MAAA,EAAa;AACvB,IAAA,KAAA,CAAM,MAAM,CAAA;AAGZ,IAAA,IAAA,CAAK,MAAA,GAAS,OAAO,KAAA,CAAM;AAAA,MACzB,SAAA,EAAW,eAAA;AAAA,MACX,QAAA,EAAU;AAAA,KACX,CAAA;AAAA,EAGH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOQ,8BAAA,GAAuC;AAC7C,IAAA,IAAI,KAAK,2BAAA,EAA6B;AACpC,MAAA;AAAA,IACF;AAEA,IAAA,MAAM,YAAA,GAAe,KAAK,IAAA,IAAQ,SAAA;AAGlC,IAAA,MAAM,QAAA,GAAY,IAAA,CAAK,MAAA,CAAe,cAAA,IAAkB,8BAAA;AACxD,IAAA,IAAA,CAAK,iBAAiB,IAAI,cAAA;AAAA,MACxB,kBAAkB,YAAY,CAAA,CAAA;AAAA,MAC9B;AAAA,KACF;AAGA,IAAA,IAAA,CAAK,MAAA,GAAS,OAAO,KAAA,CAAM;AAAA,MACzB,SAAA,EAAW,eAAA;AAAA,MACX,QAAA,EAAU;AAAA,KACX,CAAA;AAGD,IAAA,IAAA,CAAK,cAAA,CAAe,EAAA,CAAG,QAAA,EAAU,CAAC,IAAA,KAAS;AACzC,MAAA,IAAA,CAAK,MAAA,CAAO,IAAA,CAAK,IAAA,EAAM,wBAAwB,CAAA;AAC/C,MAAA,OAAA,CAAQ,SAAA,CAAU,0BAA0B,CAAA,EAAG;AAAA,QAC7C,SAAS,IAAA,CAAK,IAAA;AAAA,QACd,QAAA,EAAU;AAAA,OACX,CAAA;AAAA,IACH,CAAC,CAAA;AAED,IAAA,IAAA,CAAK,cAAA,CAAe,EAAA,CAAG,QAAA,EAAU,CAAC,IAAA,KAAS;AACzC,MAAA,IAAA,CAAK,MAAA,CAAO,IAAA,CAAK,IAAA,EAAM,wBAAwB,CAAA;AAC/C,MAAA,OAAA,CAAQ,SAAA,CAAU,0BAA0B,CAAA,EAAG;AAAA,QAC7C,SAAS,IAAA,CAAK,IAAA;AAAA,QACd,QAAA,EAAU;AAAA,OACX,CAAA;AAAA,IACH,CAAC,CAAA;AAED,IAAA,IAAA,CAAK,2BAAA,GAA8B,IAAA;AAAA,EACrC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUA,MAAgB,yBAAA,CACd,SAAA,EACA,aAAA,EACA,QAAA,EACkB;AAElB,IAAA,IAAA,CAAK,8BAAA,EAA+B;AAEpC,IAAA,MAAM,SAAA,GAAY,KAAK,GAAA,EAAI;AAC3B,IAAA,MAAM,YAAA,GAAe;AAAA,MACnB,UAAU,IAAA,CAAK,IAAA;AAAA,MACf,SAAA,EAAW,aAAA;AAAA,MACX,GAAG;AAAA,KACL;AAEA,IAAA,IAAI;AAEF,MAAA,MAAM,MAAA,GAAS,MAAM,IAAA,CAAK,cAAA,CAAgB,QAAQ,SAAS,CAAA;AAG3D,MAAA,MAAM,QAAA,GAAW,IAAA,CAAK,GAAA,EAAI,GAAI,SAAA;AAC9B,MAAA,OAAA,CAAQ,SAAA,CAAU,CAAA,EAAG,aAAa,CAAA,SAAA,CAAA,EAAa,UAAU,YAAY,CAAA;AACrE,MAAA,OAAA,CAAQ,SAAA,CAAU,CAAA,EAAG,aAAa,CAAA,QAAA,CAAA,EAAY,GAAG,YAAY,CAAA;AAE7D,MAAA,IAAA,CAAK,MAAA,CAAO,KAAA;AAAA,QACV,EAAE,SAAA,EAAW,aAAA,EAAe,QAAA,EAAU,GAAG,QAAA,EAAS;AAAA,QAClD;AAAA,OACF;AAEA,MAAA,OAAO,MAAA;AAAA,IACT,SAAS,KAAA,EAAO;AAEd,MAAA,MAAM,QAAA,GAAW,IAAA,CAAK,GAAA,EAAI,GAAI,SAAA;AAC9B,MAAA,OAAA,CAAQ,SAAA,CAAU,CAAA,EAAG,aAAa,CAAA,MAAA,CAAA,EAAU,CAAA,EAAG;AAAA,QAC7C,GAAG,YAAA;AAAA,QACH,KAAA,EAAO,KAAA,YAAiB,KAAA,GAAQ,KAAA,CAAM,IAAA,GAAO;AAAA,OAC9C,CAAA;AAED,MAAA,IAAA,CAAK,MAAA,CAAO,KAAA;AAAA,QACV;AAAA,UACE,SAAA,EAAW,aAAA;AAAA,UACX,QAAA;AAAA,UACA,OAAO,KAAA,YAAiB,KAAA,GAAQ,KAAA,CAAM,OAAA,GAAU,OAAO,KAAK,CAAA;AAAA,UAC5D,GAAG;AAAA,SACL;AAAA,QACA;AAAA,OACF;AAEA,MAAA,MAAM,KAAA;AAAA,IACR;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAMU,iBAAA,CAAkB,WAAmB,OAAA,EAAwC;AACrF,IAAA,IAAA,CAAK,8BAAA,EAA+B;AACpC,IAAA,IAAA,CAAK,MAAA,CAAO,KAAK,EAAE,SAAA,EAAW,GAAG,OAAA,EAAQ,EAAG,CAAA,EAAG,SAAS,CAAA,QAAA,CAAU,CAAA;AAAA,EACpE;AAAA;AAAA;AAAA;AAAA,EAKU,oBAAA,CAAqB,WAAmB,OAAA,EAAwC;AACxF,IAAA,IAAA,CAAK,8BAAA,EAA+B;AACpC,IAAA,IAAA,CAAK,MAAA,CAAO,KAAK,EAAE,SAAA,EAAW,GAAG,OAAA,EAAQ,EAAG,CAAA,EAAG,SAAS,CAAA,UAAA,CAAY,CAAA;AAAA,EACtE;AACF;;;AC1HO,IAAM,aAAA,GAA8B;AAAA,EACzC,EAAE,EAAA,EAAI,OAAA,EAAS,IAAA,EAAM,OAAA,EAAS,UAAU,OAAA,EAAS,MAAA,EAAQ,SAAA,EAAW,SAAA,EAAW,IAAA,EAAK;AAAA,EACpF,EAAE,IAAI,KAAA,EAAO,IAAA,EAAM,OAAO,QAAA,EAAU,OAAA,EAAS,QAAQ,MAAA,EAAO;AAAA,EAC5D,EAAE,IAAI,QAAA,EAAU,IAAA,EAAM,UAAU,QAAA,EAAU,OAAA,EAAS,QAAQ,MAAA,EAAO;AAAA,EAClE,EAAE,IAAI,OAAA,EAAS,IAAA,EAAM,SAAS,QAAA,EAAU,OAAA,EAAS,QAAQ,QAAA,EAAS;AAAA,EAClE,EAAE,IAAI,MAAA,EAAQ,IAAA,EAAM,QAAQ,QAAA,EAAU,OAAA,EAAS,QAAQ,MAAA,EAAO;AAAA,EAC9D,EAAE,EAAA,EAAI,OAAA,EAAS,IAAA,EAAM,OAAA,EAAS,UAAU,OAAA,EAAS,MAAA,EAAQ,SAAA,EAAW,MAAA,EAAQ,SAAA,EAAU;AAAA,EACtF,EAAE,IAAI,MAAA,EAAQ,IAAA,EAAM,QAAQ,QAAA,EAAU,OAAA,EAAS,QAAQ,QAAA,EAAS;AAAA,EAChE,EAAE,IAAI,MAAA,EAAQ,IAAA,EAAM,QAAQ,QAAA,EAAU,OAAA,EAAS,QAAQ,MAAA,EAAO;AAAA,EAC9D,EAAE,IAAI,MAAA,EAAQ,IAAA,EAAM,QAAQ,QAAA,EAAU,OAAA,EAAS,QAAQ,QAAA,EAAS;AAAA,EAChE,EAAE,IAAI,SAAA,EAAW,IAAA,EAAM,WAAW,QAAA,EAAU,OAAA,EAAS,QAAQ,QAAA,EAAS;AAAA,EACtE,EAAE,IAAI,OAAA,EAAS,IAAA,EAAM,SAAS,QAAA,EAAU,OAAA,EAAS,QAAQ,SAAA,EAAU;AAAA,EACnE,EAAE,IAAI,OAAA,EAAS,IAAA,EAAM,SAAS,QAAA,EAAU,OAAA,EAAS,QAAQ,QAAA,EAAS;AAAA,EAClE,EAAE,IAAI,OAAA,EAAS,IAAA,EAAM,SAAS,QAAA,EAAU,OAAA,EAAS,QAAQ,MAAA;AAC3D,CAAA;AAOO,IAAM,aAAA,GAA8B;AAAA;AAAA,EAEzC,EAAE,EAAA,EAAI,MAAA,EAAQ,IAAA,EAAM,MAAA,EAAQ,UAAU,OAAA,EAAS,MAAA,EAAQ,QAAA,EAAU,SAAA,EAAW,IAAA,EAAK;AAAA;AAAA,EAEjF,EAAE,IAAI,MAAA,EAAQ,IAAA,EAAM,QAAQ,QAAA,EAAU,OAAA,EAAS,QAAQ,SAAA,EAAU;AAAA,EACjE,EAAE,IAAI,QAAA,EAAU,IAAA,EAAM,UAAU,QAAA,EAAU,OAAA,EAAS,QAAQ,MAAA,EAAO;AAAA,EAClE,EAAE,IAAI,QAAA,EAAU,IAAA,EAAM,UAAU,QAAA,EAAU,OAAA,EAAS,QAAQ,MAAA,EAAO;AAAA,EAClE,EAAE,IAAI,QAAA,EAAU,IAAA,EAAM,UAAU,QAAA,EAAU,OAAA,EAAS,QAAQ,SAAA,EAAU;AAAA,EACrE,EAAE,IAAI,MAAA,EAAQ,IAAA,EAAM,QAAQ,QAAA,EAAU,OAAA,EAAS,QAAQ,QAAA,EAAS;AAAA,EAChE,EAAE,IAAI,MAAA,EAAQ,IAAA,EAAM,QAAQ,QAAA,EAAU,OAAA,EAAS,QAAQ,MAAA,EAAO;AAAA,EAC9D,EAAE,IAAI,OAAA,EAAS,IAAA,EAAM,SAAS,QAAA,EAAU,OAAA,EAAS,QAAQ,QAAA,EAAS;AAAA;AAAA,EAElE,EAAE,IAAI,YAAA,EAAc,IAAA,EAAM,cAAc,QAAA,EAAU,OAAA,EAAS,QAAQ,QAAA,EAAS;AAAA,EAC5E,EAAE,IAAI,SAAA,EAAW,IAAA,EAAM,WAAW,QAAA,EAAU,OAAA,EAAS,QAAQ,QAAA,EAAS;AAAA,EACtE,EAAE,IAAI,WAAA,EAAa,IAAA,EAAM,aAAa,QAAA,EAAU,OAAA,EAAS,QAAQ,MAAA,EAAO;AAAA,EACxE,EAAE,IAAI,SAAA,EAAW,IAAA,EAAM,WAAW,QAAA,EAAU,OAAA,EAAS,QAAQ,MAAA,EAAO;AAAA,EACpE,EAAE,IAAI,SAAA,EAAW,IAAA,EAAM,WAAW,QAAA,EAAU,OAAA,EAAS,QAAQ,SAAA,EAAU;AAAA,EACvE,EAAE,IAAI,SAAA,EAAW,IAAA,EAAM,WAAW,QAAA,EAAU,OAAA,EAAS,QAAQ,MAAA,EAAO;AAAA,EACpE,EAAE,IAAI,SAAA,EAAW,IAAA,EAAM,WAAW,QAAA,EAAU,OAAA,EAAS,QAAQ,QAAA,EAAS;AAAA,EACtE,EAAE,IAAI,SAAA,EAAW,IAAA,EAAM,WAAW,QAAA,EAAU,OAAA,EAAS,QAAQ,QAAA,EAAS;AAAA,EACtE,EAAE,IAAI,SAAA,EAAW,IAAA,EAAM,WAAW,QAAA,EAAU,OAAA,EAAS,QAAQ,MAAA,EAAO;AAAA,EACpE,EAAE,IAAI,YAAA,EAAc,IAAA,EAAM,cAAc,QAAA,EAAU,OAAA,EAAS,QAAQ,MAAA,EAAO;AAAA,EAC1E,EAAE,IAAI,WAAA,EAAa,IAAA,EAAM,aAAa,QAAA,EAAU,OAAA,EAAS,QAAQ,QAAA,EAAS;AAAA,EAC1E,EAAE,IAAI,UAAA,EAAY,IAAA,EAAM,YAAY,QAAA,EAAU,OAAA,EAAS,QAAQ,MAAA,EAAO;AAAA,EACtE,EAAE,IAAI,SAAA,EAAW,IAAA,EAAM,WAAW,QAAA,EAAU,OAAA,EAAS,QAAQ,MAAA,EAAO;AAAA,EACpE,EAAE,IAAI,SAAA,EAAW,IAAA,EAAM,WAAW,QAAA,EAAU,OAAA,EAAS,QAAQ,QAAA,EAAS;AAAA,EACtE,EAAE,IAAI,QAAA,EAAU,IAAA,EAAM,UAAU,QAAA,EAAU,OAAA,EAAS,QAAQ,MAAA,EAAO;AAAA,EAClE,EAAE,IAAI,aAAA,EAAe,IAAA,EAAM,eAAe,QAAA,EAAU,OAAA,EAAS,QAAQ,QAAA,EAAS;AAAA,EAC9E,EAAE,IAAI,QAAA,EAAU,IAAA,EAAM,UAAU,QAAA,EAAU,OAAA,EAAS,QAAQ,MAAA,EAAO;AAAA,EAClE,EAAE,IAAI,eAAA,EAAiB,IAAA,EAAM,iBAAiB,QAAA,EAAU,OAAA,EAAS,QAAQ,MAAA,EAAO;AAAA,EAChF,EAAE,IAAI,cAAA,EAAgB,IAAA,EAAM,gBAAgB,QAAA,EAAU,OAAA,EAAS,QAAQ,QAAA,EAAS;AAAA,EAChF,EAAE,IAAI,WAAA,EAAa,IAAA,EAAM,aAAa,QAAA,EAAU,OAAA,EAAS,QAAQ,MAAA,EAAO;AAAA,EACxE,EAAE,IAAI,YAAA,EAAc,IAAA,EAAM,cAAc,QAAA,EAAU,OAAA,EAAS,QAAQ,MAAA,EAAO;AAAA,EAC1E,EAAE,IAAI,SAAA,EAAW,IAAA,EAAM,WAAW,QAAA,EAAU,OAAA,EAAS,QAAQ,QAAA;AAC/D,CAAA;AAMO,IAAM,oBAAA,GAAuB;AAAA,EAClC,OAAA;AAAA;AAAA,EACA,IAAA;AAAA;AAAA,EACA,OAAA;AAAA;AAAA,EACA,OAAA;AAAA;AAAA,EACA,OAAA;AAAA;AAAA,EACA,IAAA;AAAA;AAAA,EACA,OAAA;AAAA;AAAA,EACA,IAAA;AAAA;AAAA,EACA,IAAA;AAAA;AAAA,EACA,IAAA;AAAA;AAAA,EACA,IAAA;AAAA;AAAA,EACA,IAAA;AAAA;AAAA,EACA,IAAA;AAAA;AAAA,EACA,IAAA;AAAA;AAAA,EACA,IAAA;AAAA;AAAA,EACA,OAAA;AAAA;AAAA,EACA,IAAA;AAAA;AAAA,EACA,IAAA;AAAA;AAAA,EACA,IAAA;AAAA;AAAA,EACA,IAAA;AAAA;AAAA,EACA,IAAA;AAAA;AAAA,EACA,IAAA;AAAA;AAAA,EACA,IAAA;AAAA;AAAA,EACA;AAAA;AACF,CAAA;AAUO,IAAM,gBAAA,GAAmB;AAAA;AAAA;AAAA;AAAA;AAAA,EAK9B,UAAA,EAAY;AAAA,IACV,IAAA;AAAA,IAAM,IAAA;AAAA,IAAM,IAAA;AAAA,IAAM,IAAA;AAAA,IAAM,IAAA;AAAA,IAAM,IAAA;AAAA,IAAM,IAAA;AAAA,IAAM,IAAA;AAAA,IAAM,IAAA;AAAA,IAAM,IAAA;AAAA,IAAM,IAAA;AAAA,IAAM,IAAA;AAAA,IAAM,IAAA;AAAA,IACxE,IAAA;AAAA,IAAM,IAAA;AAAA,IAAM,IAAA;AAAA,IAAM,IAAA;AAAA,IAAM,IAAA;AAAA,IAAM,IAAA;AAAA,IAAM,IAAA;AAAA,IAAM,IAAA;AAAA,IAAM,IAAA;AAAA,IAAM,IAAA;AAAA,IAAM,IAAA;AAAA,IAAM,IAAA;AAAA,IAAM,IAAA;AAAA,IACxE,IAAA;AAAA,IAAM,IAAA;AAAA,IAAM,IAAA;AAAA,IAAM,IAAA;AAAA,IAAM,IAAA;AAAA,IAAM,IAAA;AAAA,IAAM,IAAA;AAAA,IAAM,IAAA;AAAA,IAAM,IAAA;AAAA,IAAM,IAAA;AAAA,IAAM,IAAA;AAAA,IAAM,IAAA;AAAA,IAAM,IAAA;AAAA,IACxE,IAAA;AAAA,IAAM,IAAA;AAAA,IAAM,IAAA;AAAA,IAAM,IAAA;AAAA,IAAM,IAAA;AAAA,IAAM,IAAA;AAAA,IAAM,IAAA;AAAA,IAAM,IAAA;AAAA,IAAM,IAAA;AAAA,IAAM,IAAA;AAAA,IAAM,IAAA;AAAA,IAAM,IAAA;AAAA,IAAM,IAAA;AAAA,IACxE,IAAA;AAAA,IAAM;AAAA,GA0BV,CAAA;AASO,IAAM,aAAA,GAAgB;AAAA;AAAA;AAAA;AAAA;AAAA,EAK3B,YAAY,CAAC,KAAA,EAAO,QAAQ,KAAA,EAAO,MAAA,EAAQ,OAAO,KAAK,CAAA;AAAA,EAUvB;AAAA;AAAA;AAAA,EAKhC,SAAA,EAAW,CAAC,KAAA,EAAO,KAAA,EAAO,MAAA,EAAQ,QAAQ,KAAA,EAAO,KAAA,EAAO,MAAA,EAAQ,MAAA,EAAQ,KAAK;AAC/E,CAAA;;;AC/KO,IAAM,iBAAA,GAAN,cAAgC,iBAAA,CAAmD;AAAA,EAC/E,IAAA,GAAe,YAAA;AAAA,EACf,MAAA,GAAS,QAAA;AAAA,EACT,YAAA,GAAqC;AAAA,IAC5C,IAAA,EAAM,KAAA;AAAA,IACN,MAAA,EAAQ,KAAA;AAAA,IACR,MAAA,EAAQ,KAAA;AAAA,IACR,KAAA,EAAO,IAAA;AAAA,IACP,QAAA,EAAU;AAAA,MACR,YAAA,EAAc;AAAA;AAChB,GACF;AAAA,EAEQ,MAAA;AAAA,EAER,YAAY,MAAA,EAA2B;AACrC,IAAA,KAAA,CAAM,EAAE,MAAA,EAAQ,MAAA,CAAO,KAAK,MAAA,EAAQ,GAAG,QAAQ,CAAA;AAE/C,IAAA,IAAA,CAAK,MAAA,GAAS,IAAIyB,OAAAA,CAAO;AAAA,MACvB,MAAA,EAAQ,OAAO,IAAA,CAAK,MAAA;AAAA,MACpB,SAAS,MAAA,CAAO,OAAA;AAAA,MAChB,cAAc,MAAA,CAAO,YAAA;AAAA,MACrB,OAAA,EAAS,OAAO,OAAA,IAAW,GAAA;AAAA,MAC3B,UAAA,EAAY,OAAO,UAAA,IAAc;AAAA,KAClC,CAAA;AAAA,EACH;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,WAAW,OAAA,EAA2C;AAC1D,IAAA,OAAO,IAAA,CAAK,yBAAA;AAAA,MACV,YAAY;AACV,QAAA,IAAI;AAEF,UAAA,MAAM,MAAA,GAAS,IAAA,CAAK,SAAA,CAAU,OAAA,CAAQ,MAAM,CAAA;AAG5C,UAAA,MAAM,aAAA,GAAiD;AAAA,YACrD,OAAO,OAAA,CAAQ,KAAA;AAAA,YACf,OAAO,OAAA,CAAQ,KAAA;AAAA,YACf,OAAO,OAAA,CAAQ,KAAA;AAAA,YACf,eAAA,EAAiB,MAAA;AAAA,YACjB,OAAO,OAAA,CAAQ;AAAA,WACjB;AAGA,UAAA,IAAI,OAAA,CAAQ,eAAe,YAAA,EAAc;AACvC,YAAC,aAAA,CAAsB,YAAA,GAAe,OAAA,CAAQ,aAAA,CAAc,YAAA;AAAA,UAC9D;AAEA,UAAA,IAAA,CAAK,kBAAkB,gBAAA,EAAkB;AAAA,YACvC,OAAO,OAAA,CAAQ,KAAA;AAAA,YACf,OAAO,OAAA,CAAQ,KAAA;AAAA,YACf,WAAA,EAAa,QAAQ,KAAA,CAAM;AAAA,WAC5B,CAAA;AAED,UAAA,MAAM,WAAW,MAAM,IAAA,CAAK,OAAO,KAAA,CAAM,MAAA,CAAO,OAAO,aAAa,CAAA;AAGpE,UAAA,MAAM,WAAA,GAAc,MAAM,QAAA,CAAS,WAAA,EAAY;AAC/C,UAAA,MAAM,KAAA,GAAQ,MAAA,CAAO,IAAA,CAAK,WAAW,CAAA;AAErC,UAAA,IAAA,CAAK,qBAAqB,gBAAA,EAAkB;AAAA,YAC1C,OAAO,OAAA,CAAQ,KAAA;AAAA,YACf,WAAW,KAAA,CAAM;AAAA,WAClB,CAAA;AAED,UAAA,OAAO;AAAA,YACL,KAAA;AAAA,YACA,MAAA,EAAQ,QAAQ,MAAA,IAAU,KAAA;AAAA,YAC1B,cAAA,EAAgB,QAAQ,KAAA,CAAM;AAAA,WAChC;AAAA,QACF,SAAS,KAAA,EAAY;AACnB,UAAA,IAAA,CAAK,YAAY,KAAK,CAAA;AACtB,UAAA,MAAM,KAAA;AAAA,QACR;AAAA,MACF,CAAA;AAAA,MACA,gBAAA;AAAA,MACA,EAAE,KAAA,EAAO,OAAA,CAAQ,KAAA,EAAO,KAAA,EAAO,QAAQ,KAAA;AAAM,KAC/C;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,UAAA,GAAoC;AACxC,IAAA,OAAO,aAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKQ,UACN,MAAA,EACoD;AACpD,IAAA,QAAQ,MAAA;AAAQ,MACd,KAAK,KAAA;AACH,QAAA,OAAO,KAAA;AAAA,MACT,KAAK,MAAA;AACH,QAAA,OAAO,MAAA;AAAA,MACT,KAAK,KAAA;AACH,QAAA,OAAO,KAAA;AAAA,MACT,KAAK,MAAA;AACH,QAAA,OAAO,MAAA;AAAA,MACT,KAAK,KAAA;AACH,QAAA,OAAO,KAAA;AAAA,MACT,KAAK,KAAA;AACH,QAAA,OAAO,KAAA;AAAA,MACT;AACE,QAAA,OAAO,KAAA;AAAA;AACX,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,YAAY,KAAA,EAAmB;AACrC,IAAA,IAAI,KAAA,YAAiBA,QAAO,QAAA,EAAU;AACpC,MAAA,MAAM,SAAS,KAAA,CAAM,MAAA;AACrB,MAAA,MAAM,OAAA,GAAU,MAAM,OAAA,IAAW,0BAAA;AAEjC,MAAA,IAAI,WAAW,GAAA,EAAK;AAClB,QAAA,MAAM,IAAI,iBAAA,CAAkB,QAAA,EAAU,iBAAiB,CAAA;AAAA,MACzD;AAEA,MAAA,IAAI,WAAW,GAAA,EAAK;AAClB,QAAA,MAAM,IAAI,uBAAuB,QAAQ,CAAA;AAAA,MAC3C;AAEA,MAAA,IAAI,WAAW,GAAA,EAAK;AAClB,QAAA,MAAM,IAAI,aAAA,CAAc,QAAA,EAAU,CAAA,aAAA,EAAgB,OAAO,CAAA,CAAE,CAAA;AAAA,MAC7D;AAEA,MAAA,MAAM,IAAI,aAAA,CAAc,QAAA,EAAU,OAAO,CAAA;AAAA,IAC3C;AAEA,IAAA,MAAM,KAAA;AAAA,EACR;AACF,CAAA;AC5IO,IAAM,iBAAA,GAAN,cAAgC,iBAAA,CAAmD;AAAA,EAC/E,IAAA,GAAe,YAAA;AAAA,EACf,MAAA,GAAS,QAAA;AAAA,EACT,YAAA,GAAqC;AAAA,IAC5C,IAAA,EAAM,KAAA;AAAA,IACN,MAAA,EAAQ,KAAA;AAAA,IACR,MAAA,EAAQ,KAAA;AAAA,IACR,KAAA,EAAO,IAAA;AAAA,IACP,QAAA,EAAU;AAAA,MACR,YAAA,EAAc;AAAA;AAChB,GACF;AAAA,EAEQ,MAAA;AAAA,EAER,YAAY,MAAA,EAA2B;AACrC,IAAA,KAAA,CAAM,EAAE,MAAA,EAAQ,MAAA,CAAO,KAAK,MAAA,EAAQ,GAAG,QAAQ,CAAA;AAE/C,IAAA,IAAA,CAAK,MAAA,GAAS,IAAIA,OAAAA,CAAO;AAAA,MACvB,MAAA,EAAQ,OAAO,IAAA,CAAK,MAAA;AAAA,MACpB,SAAS,MAAA,CAAO,OAAA;AAAA,MAChB,cAAc,MAAA,CAAO,YAAA;AAAA,MACrB,OAAA,EAAS,OAAO,OAAA,IAAW,IAAA;AAAA;AAAA,MAC3B,UAAA,EAAY,OAAO,UAAA,IAAc;AAAA,KAClC,CAAA;AAAA,EACH;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,WAAW,OAAA,EAA2C;AAC1D,IAAA,OAAO,IAAA,CAAK,yBAAA;AAAA,MACV,YAAY;AACV,QAAA,IAAI;AACF,UAAA,IAAA,CAAK,kBAAkB,gBAAA,EAAkB;AAAA,YACvC,OAAO,OAAA,CAAQ,KAAA;AAAA,YACf,UAAU,OAAA,CAAQ,QAAA;AAAA,YAClB,QAAQ,OAAA,CAAQ;AAAA,WACjB,CAAA;AAGD,UAAA,MAAM,SAAA,GAAY,MAAM,IAAA,CAAK,gBAAA,CAAiB,QAAQ,KAAK,CAAA;AAG3D,UAAA,MAAM,aAAA,GAAiE;AAAA,YACrE,OAAO,OAAA,CAAQ,KAAA;AAAA,YACf,IAAA,EAAM,SAAA;AAAA,YACN,UAAU,OAAA,CAAQ,QAAA;AAAA,YAClB,QAAQ,OAAA,CAAQ,MAAA;AAAA,YAChB,aAAa,OAAA,CAAQ;AAAA,WACvB;AAGA,UAAA,IAAI,QAAQ,YAAA,EAAc;AACxB,YAAA,aAAA,CAAc,eAAA,GAAkB,IAAA,CAAK,eAAA,CAAgB,OAAA,CAAQ,YAAY,CAAA;AAAA,UAC3E,CAAA,MAAA,IAAW,QAAQ,iBAAA,EAAmB;AACpC,YAAA,aAAA,CAAc,eAAA,GAAkB,cAAA;AAAA,UAClC;AAGA,UAAA,IAAI,OAAA,CAAQ,iBAAA,IAAqB,OAAA,CAAQ,oBAAA,EAAsB;AAC7D,YAAA,aAAA,CAAc,uBAAA,GAA0B,CAAC,OAAA,CAAQ,oBAAoB,CAAA;AAAA,UACvE;AAGA,UAAA,IAAI,QAAQ,KAAA,CAAM,QAAA,CAAS,SAAS,CAAA,IAAK,OAAA,CAAQ,eAAe,YAAA,EAAc;AAC5E,YAAC,aAAA,CAAsB,YAAA,GAAe,OAAA,CAAQ,aAAA,CAAc,YAAA;AAAA,UAC9D;AAEA,UAAA,MAAM,QAAA,GAAgB,MAAM,IAAA,CAAK,MAAA,CAAO,MAAM,cAAA,CAAe,MAAA;AAAA,YAC3D;AAAA,WACF;AAEA,UAAA,IAAA,CAAK,qBAAqB,gBAAA,EAAkB;AAAA,YAC1C,OAAO,OAAA,CAAQ,KAAA;AAAA,YACf,UAAA,EAAY,OAAO,QAAA,KAAa,QAAA,GAAW,SAAS,MAAA,GAAS,QAAA,CAAS,MAAM,MAAA,IAAU;AAAA,WACvF,CAAA;AAED,UAAA,OAAO,IAAA,CAAK,gBAAgB,QAAQ,CAAA;AAAA,QACtC,SAAS,KAAA,EAAY;AACnB,UAAA,IAAA,CAAK,YAAY,KAAK,CAAA;AACtB,UAAA,MAAM,KAAA;AAAA,QACR;AAAA,MACF,CAAA;AAAA,MACA,gBAAA;AAAA,MACA,EAAE,KAAA,EAAO,OAAA,CAAQ,KAAA;AAAM,KACzB;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,UAAU,OAAA,EAA2C;AACzD,IAAA,OAAO,IAAA,CAAK,yBAAA;AAAA,MACV,YAAY;AACV,QAAA,IAAI;AACF,UAAA,IAAA,CAAK,kBAAkB,eAAA,EAAiB;AAAA,YACtC,OAAO,OAAA,CAAQ;AAAA,WAChB,CAAA;AAED,UAAA,MAAM,SAAA,GAAY,MAAM,IAAA,CAAK,gBAAA,CAAiB,QAAQ,KAAK,CAAA;AAE3D,UAAA,MAAM,aAAA,GAA+D;AAAA,YACnE,OAAO,OAAA,CAAQ,KAAA;AAAA,YACf,IAAA,EAAM,SAAA;AAAA,YACN,QAAQ,OAAA,CAAQ,MAAA;AAAA,YAChB,aAAa,OAAA,CAAQ;AAAA,WACvB;AAEA,UAAA,IAAI,QAAQ,YAAA,EAAc;AAExB,YAAA,aAAA,CAAc,eAAA,GAAkB,IAAA,CAAK,eAAA,CAAgB,OAAA,CAAQ,YAAY,CAAA;AAAA,UAM3E;AAEA,UAAA,MAAM,QAAA,GAAgB,MAAM,IAAA,CAAK,MAAA,CAAO,MAAM,YAAA,CAAa,MAAA;AAAA,YACzD;AAAA,WACF;AAEA,UAAA,IAAA,CAAK,qBAAqB,eAAA,EAAiB;AAAA,YACzC,OAAO,OAAA,CAAQ,KAAA;AAAA,YACf,UAAA,EAAY,OAAO,QAAA,KAAa,QAAA,GAAW,SAAS,MAAA,GAAS,QAAA,CAAS,MAAM,MAAA,IAAU;AAAA,WACvF,CAAA;AAED,UAAA,OAAO,IAAA,CAAK,gBAAgB,QAAQ,CAAA;AAAA,QACtC,SAAS,KAAA,EAAY;AACnB,UAAA,IAAA,CAAK,YAAY,KAAK,CAAA;AACtB,UAAA,MAAM,KAAA;AAAA,QACR;AAAA,MACF,CAAA;AAAA,MACA,eAAA;AAAA,MACA,EAAE,KAAA,EAAO,OAAA,CAAQ,KAAA;AAAM,KACzB;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,MAAc,iBAAiB,KAAA,EAAsC;AACnE,IAAA,IAAI,MAAA,CAAO,QAAA,CAAS,KAAK,CAAA,EAAG;AAE1B,MAAA,MAAM,IAAA,GAAO,IAAI,IAAA,CAAK,CAAC,KAAK,CAAC,CAAA;AAC7B,MAAA,OAAO,IAAI,KAAK,CAAC,IAAI,GAAG,WAAA,EAAa,EAAE,IAAA,EAAM,WAAA,EAAa,CAAA;AAAA,IAC5D,CAAA,MAAA,IAAW,OAAO,KAAA,KAAU,QAAA,EAAU;AAEpC,MAAA,OAAUM,sBAAiB,KAAK,CAAA;AAAA,IAClC,CAAA,MAAO;AACL,MAAA,MAAM,IAAI,MAAM,kDAAkD,CAAA;AAAA,IACpE;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,gBAAgB,MAAA,EAA2D;AACjF,IAAA,QAAQ,MAAA;AAAQ,MACd,KAAK,MAAA;AACH,QAAA,OAAO,MAAA;AAAA,MACT,KAAK,MAAA;AACH,QAAA,OAAO,MAAA;AAAA,MACT,KAAK,KAAA;AACH,QAAA,OAAO,KAAA;AAAA,MACT,KAAK,KAAA;AACH,QAAA,OAAO,KAAA;AAAA,MACT,KAAK,cAAA;AACH,QAAA,OAAO,cAAA;AAAA,MACT;AACE,QAAA,OAAO,MAAA;AAAA;AACX,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,gBAAgB,QAAA,EAA4D;AAElF,IAAA,IAAI,OAAO,aAAa,QAAA,EAAU;AAChC,MAAA,OAAO,EAAE,MAAM,QAAA,EAAS;AAAA,IAC1B;AAGA,IAAA,MAAM,WAAA,GAAc,QAAA;AAGpB,IAAA,MAAM,MAAA,GAAsB;AAAA,MAC1B,MAAM,QAAA,CAAS,IAAA;AAAA,MACf,UAAU,WAAA,CAAY,QAAA;AAAA,MACtB,iBAAiB,WAAA,CAAY;AAAA,KAC/B;AAGA,IAAA,IAAK,SAAiB,KAAA,EAAO;AAC3B,MAAA,MAAA,CAAO,KAAA,GAAS,QAAA,CAAiB,KAAA,CAAM,GAAA,CAAI,CAAC,CAAA,MAAY;AAAA,QACtD,MAAM,CAAA,CAAE,IAAA;AAAA,QACR,OAAO,CAAA,CAAE,KAAA;AAAA,QACT,KAAK,CAAA,CAAE;AAAA,OACT,CAAE,CAAA;AAAA,IACJ;AAGA,IAAA,IAAK,SAAiB,QAAA,EAAU;AAC9B,MAAA,MAAA,CAAO,QAAA,GAAY,QAAA,CAAiB,QAAA,CAAS,GAAA,CAAI,CAAC,CAAA,MAAY;AAAA,QAC5D,IAAI,CAAA,CAAE,EAAA;AAAA,QACN,MAAM,CAAA,CAAE,IAAA;AAAA,QACR,OAAO,CAAA,CAAE,KAAA;AAAA,QACT,KAAK,CAAA,CAAE,GAAA;AAAA,QACP,QAAQ,CAAA,CAAE;AAAA,OACZ,CAAE,CAAA;AAAA,IACJ;AAEA,IAAA,OAAO,MAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKQ,YAAY,KAAA,EAAmB;AACrC,IAAA,IAAI,KAAA,YAAiBN,QAAO,QAAA,EAAU;AACpC,MAAA,MAAM,SAAS,KAAA,CAAM,MAAA;AACrB,MAAA,MAAM,OAAA,GAAU,MAAM,OAAA,IAAW,0BAAA;AAEjC,MAAA,IAAI,WAAW,GAAA,EAAK;AAClB,QAAA,MAAM,IAAI,iBAAA,CAAkB,QAAA,EAAU,iBAAiB,CAAA;AAAA,MACzD;AAEA,MAAA,IAAI,WAAW,GAAA,EAAK;AAClB,QAAA,MAAM,IAAI,uBAAuB,QAAQ,CAAA;AAAA,MAC3C;AAEA,MAAA,IAAI,WAAW,GAAA,EAAK;AAClB,QAAA,MAAM,IAAI,aAAA,CAAc,QAAA,EAAU,CAAA,aAAA,EAAgB,OAAO,CAAA,CAAE,CAAA;AAAA,MAC7D;AAEA,MAAA,IAAI,WAAW,GAAA,EAAK;AAClB,QAAA,MAAM,IAAI,aAAA,CAAc,QAAA,EAAU,iCAAiC,CAAA;AAAA,MACrE;AAEA,MAAA,MAAM,IAAI,aAAA,CAAc,QAAA,EAAU,OAAO,CAAA;AAAA,IAC3C;AAEA,IAAA,MAAM,KAAA;AAAA,EACR;AACF,CAAA;ACtPO,IAAM,iBAAA,GAAN,cAAgC,iBAAA,CAAmD;AAAA,EAC/E,IAAA,GAAe,YAAA;AAAA,EACf,MAAA,GAAS,QAAA;AAAA,EACT,YAAA,GAAqC;AAAA,IAC5C,IAAA,EAAM,KAAA;AAAA,IACN,MAAA,EAAQ,KAAA;AAAA,IACR,MAAA,EAAQ,KAAA;AAAA,IACR,KAAA,EAAO,IAAA;AAAA,IACP,QAAA,EAAU;AAAA,MACR,YAAA,EAAc;AAAA;AAChB,GACF;AAAA,EAEQ,MAAA;AAAA,EAER,YAAY,MAAA,EAAsB;AAChC,IAAA,KAAA,CAAM,MAAM,CAAA;AAEZ,IAAA,IAAA,CAAK,MAAA,GAAS,IAAIE,WAAAA,CAAY;AAAA,MAC5B,QAAQ,MAAA,CAAO;AAAA,KAChB,CAAA;AAAA,EACH;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,WAAW,OAAA,EAA2C;AAC1D,IAAA,OAAO,IAAA,CAAK,yBAAA;AAAA,MACV,YAAY;AACV,QAAA,IAAI;AACF,UAAA,IAAA,CAAK,kBAAkB,gBAAA,EAAkB;AAAA,YACvC,OAAO,OAAA,CAAQ,KAAA;AAAA,YACf,OAAO,OAAA,CAAQ,KAAA;AAAA,YACf,WAAA,EAAa,QAAQ,KAAA,CAAM;AAAA,WAC5B,CAAA;AAGD,UAAA,MAAM,MAAA,GAAS,MAAM,IAAA,CAAK,MAAA,CAAO,OAAO,eAAA,CAAgB;AAAA,YACtD,OAAO,OAAA,CAAQ,KAAA;AAAA,YACf,QAAA,EAAU;AAAA,cACR;AAAA,gBACE,OAAO,CAAC,EAAE,IAAA,EAAM,OAAA,CAAQ,OAAO;AAAA;AACjC,aACF;AAAA,YACA,MAAA,EAAQ;AAAA,cACN,kBAAA,EAAoB,CAAC,OAAO,CAAA;AAAA,cAC5B,YAAA,EAAc;AAAA,gBACZ,WAAA,EAAa;AAAA,kBACX,mBAAA,EAAqB;AAAA,oBACnB,SAAA,EAAW,QAAQ,KAAA,IAAS;AAAA;AAC9B;AACF;AACF;AACF,WACD,CAAA;AAGD,UAAA,MAAM,SAAA,GAAY,IAAA,CAAK,gBAAA,CAAiB,MAAM,CAAA;AAE9C,UAAA,IAAI,CAAC,SAAA,EAAW;AACd,YAAA,MAAM,IAAI,aAAA,CAAc,QAAA,EAAU,2BAA2B,CAAA;AAAA,UAC/D;AAEA,UAAA,IAAA,CAAK,qBAAqB,gBAAA,EAAkB;AAAA,YAC1C,OAAO,OAAA,CAAQ,KAAA;AAAA,YACf,WAAW,SAAA,CAAU;AAAA,WACtB,CAAA;AAED,UAAA,OAAO;AAAA,YACL,KAAA,EAAO,SAAA;AAAA,YACP,MAAA,EAAQ,KAAA;AAAA;AAAA,YACR,cAAA,EAAgB,QAAQ,KAAA,CAAM;AAAA,WAChC;AAAA,QACF,SAAS,KAAA,EAAY;AACnB,UAAA,IAAA,CAAK,YAAY,KAAK,CAAA;AACtB,UAAA,MAAM,KAAA;AAAA,QACR;AAAA,MACF,CAAA;AAAA,MACA,gBAAA;AAAA,MACA,EAAE,KAAA,EAAO,OAAA,CAAQ,KAAA,EAAO,KAAA,EAAO,QAAQ,KAAA;AAAM,KAC/C;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,UAAA,GAAoC;AACxC,IAAA,OAAO,aAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA,EAMQ,iBAAiB,MAAA,EAA4B;AACnD,IAAA,MAAM,aAAa,MAAA,CAAO,UAAA;AAC1B,IAAA,IAAI,CAAC,UAAA,IAAc,UAAA,CAAW,MAAA,KAAW,CAAA,EAAG;AAC1C,MAAA,OAAO,IAAA;AAAA,IACT;AAEA,IAAA,MAAM,OAAA,GAAU,UAAA,CAAW,CAAC,CAAA,EAAG,OAAA;AAC/B,IAAA,IAAI,CAAC,OAAA,EAAS,KAAA,IAAS,OAAA,CAAQ,KAAA,CAAM,WAAW,CAAA,EAAG;AACjD,MAAA,OAAO,IAAA;AAAA,IACT;AAGA,IAAA,KAAA,MAAW,IAAA,IAAQ,QAAQ,KAAA,EAAO;AAChC,MAAA,IAAI,IAAA,CAAK,YAAY,IAAA,EAAM;AAEzB,QAAA,MAAM,SAAS,MAAA,CAAO,IAAA,CAAK,IAAA,CAAK,UAAA,CAAW,MAAM,QAAQ,CAAA;AAGzD,QAAA,OAAO,IAAA,CAAK,QAAA,CAAS,MAAA,EAAQ,IAAA,EAAO,GAAG,EAAE,CAAA;AAAA,MAC3C;AAAA,IACF;AAEA,IAAA,OAAO,IAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASQ,SACN,OAAA,EACA,UAAA,GAAqB,MACrB,QAAA,GAAmB,CAAA,EACnB,gBAAwB,EAAA,EAChB;AACR,IAAA,MAAM,QAAA,GAAY,UAAA,GAAa,QAAA,GAAW,aAAA,GAAiB,CAAA;AAC3D,IAAA,MAAM,UAAA,GAAc,WAAW,aAAA,GAAiB,CAAA;AAChD,IAAA,MAAM,WAAW,OAAA,CAAQ,MAAA;AACzB,IAAA,MAAM,UAAA,GAAa,EAAA;AACnB,IAAA,MAAM,WAAW,UAAA,GAAa,QAAA;AAE9B,IAAA,MAAM,MAAA,GAAS,MAAA,CAAO,KAAA,CAAM,UAAU,CAAA;AAGtC,IAAA,MAAA,CAAO,KAAA,CAAM,QAAQ,CAAC,CAAA;AACtB,IAAA,MAAA,CAAO,aAAA,CAAc,QAAA,GAAW,CAAA,EAAG,CAAC,CAAA;AACpC,IAAA,MAAA,CAAO,KAAA,CAAM,QAAQ,CAAC,CAAA;AAGtB,IAAA,MAAA,CAAO,KAAA,CAAM,QAAQ,EAAE,CAAA;AACvB,IAAA,MAAA,CAAO,aAAA,CAAc,IAAI,EAAE,CAAA;AAC3B,IAAA,MAAA,CAAO,aAAA,CAAc,GAAG,EAAE,CAAA;AAC1B,IAAA,MAAA,CAAO,aAAA,CAAc,UAAU,EAAE,CAAA;AACjC,IAAA,MAAA,CAAO,aAAA,CAAc,YAAY,EAAE,CAAA;AACnC,IAAA,MAAA,CAAO,aAAA,CAAc,UAAU,EAAE,CAAA;AACjC,IAAA,MAAA,CAAO,aAAA,CAAc,YAAY,EAAE,CAAA;AACnC,IAAA,MAAA,CAAO,aAAA,CAAc,eAAe,EAAE,CAAA;AAGtC,IAAA,MAAA,CAAO,KAAA,CAAM,QAAQ,EAAE,CAAA;AACvB,IAAA,MAAA,CAAO,aAAA,CAAc,UAAU,EAAE,CAAA;AAEjC,IAAA,OAAO,MAAA,CAAO,MAAA,CAAO,CAAC,MAAA,EAAQ,OAAO,CAAC,CAAA;AAAA,EACxC;AAAA;AAAA;AAAA;AAAA,EAKQ,YAAY,KAAA,EAAmB;AACrC,IAAA,MAAM,OAAA,GAAU,MAAM,OAAA,IAAW,0BAAA;AACjC,IAAA,MAAM,MAAA,GAAS,KAAA,CAAM,MAAA,IAAU,KAAA,CAAM,IAAA;AAErC,IAAA,IAAI,MAAA,KAAW,GAAA,IAAO,OAAA,CAAQ,QAAA,CAAS,mBAAmB,CAAA,EAAG;AAC3D,MAAA,MAAM,IAAI,iBAAA,CAAkB,QAAA,EAAU,iBAAiB,CAAA;AAAA,IACzD;AAEA,IAAA,IAAI,MAAA,KAAW,GAAA,IAAO,OAAA,CAAQ,QAAA,CAAS,oBAAoB,CAAA,EAAG;AAC5D,MAAA,MAAM,IAAI,sBAAA,CAAuB,QAAA,EAAU,OAAO,CAAA;AAAA,IACpD;AAEA,IAAA,IAAI,WAAW,GAAA,EAAK;AAClB,MAAA,MAAM,IAAI,aAAA,CAAc,QAAA,EAAU,CAAA,aAAA,EAAgB,OAAO,CAAA,CAAE,CAAA;AAAA,IAC7D;AAEA,IAAA,MAAM,IAAI,aAAA,CAAc,QAAA,EAAU,OAAO,CAAA;AAAA,EAC3C;AACF,CAAA;;;ACzLO,SAAS,kBAAkB,SAAA,EAA6C;AAC7E,EAAA,MAAM,SAAS,SAAA,CAAU,MAAA;AAEzB,EAAA,QAAQ,MAAA;AAAQ,IACd,KAAK,MAAA,CAAO,MAAA;AACV,MAAA,OAAO,IAAI,iBAAA,CAAkB,mBAAA,CAAoB,SAAS,CAAC,CAAA;AAAA,IAE7D,KAAK,MAAA,CAAO,MAAA;AACV,MAAA,OAAO,IAAI,iBAAA,CAAkB,mBAAA,CAAoB,SAAS,CAAC,CAAA;AAAA,IAE7D;AACE,MAAA,MAAM,IAAI,KAAA;AAAA,QACR,yCAAyC,MAAM,CAAA,qBAAA,EACzB,OAAO,MAAM,CAAA,EAAA,EAAK,OAAO,MAAM,CAAA;AAAA,OACvD;AAAA;AAEN;AAKO,SAAS,kBAAkB,SAAA,EAA6C;AAC7E,EAAA,MAAM,SAAS,SAAA,CAAU,MAAA;AAEzB,EAAA,QAAQ,MAAA;AAAQ,IACd,KAAK,MAAA,CAAO,MAAA;AACV,MAAA,OAAO,IAAI,iBAAA,CAAkB,mBAAA,CAAoB,SAAS,CAAC,CAAA;AAAA,IAE7D,KAAK,MAAA,CAAO,IAAA;AAEV,MAAA,MAAM,IAAI,MAAM,CAAA,qCAAA,CAAuC,CAAA;AAAA,IAEzD,KAAK,MAAA,CAAO,MAAA;AAEV,MAAA,MAAM,IAAI,MAAM,CAAA,uCAAA,CAAyC,CAAA;AAAA,IAE3D;AACE,MAAA,MAAM,IAAI,KAAA;AAAA,QACR,yCAAyC,MAAM,CAAA,qBAAA,EACzB,OAAO,MAAM,CAAA,EAAA,EAAK,OAAO,IAAI,CAAA;AAAA,OACrD;AAAA;AAEN;AAKA,SAAS,oBAAoB,SAAA,EAAyC;AACpE,EAAA,MAAM,IAAA,GAAO,UAAU,MAAA,CAAO,IAAA;AAE9B,EAAA,IAAI,IAAA,CAAK,SAAS,SAAA,EAAW;AAC3B,IAAA,MAAM,IAAI,MAAM,wCAAwC,CAAA;AAAA,EAC1D;AAEA,EAAA,MAAM,OAAA,GAAU,UAAU,UAAA,EAAW;AAErC,EAAA,OAAO;AAAA,IACL,IAAA,EAAM;AAAA,MACJ,IAAA,EAAM,SAAA;AAAA,MACN,QAAQ,IAAA,CAAK;AAAA,KACf;AAAA,IACA,SAAS,SAAA,CAAU,OAAA;AAAA,IACnB,cAAc,OAAA,CAAQ,YAAA;AAAA,IACtB,SAAS,OAAA,CAAQ,OAAA;AAAA,IACjB,YAAY,OAAA,CAAQ;AAAA,GACtB;AACF;AAKA,SAAS,oBAAoB,SAAA,EAAoC;AAC/D,EAAA,MAAM,IAAA,GAAO,UAAU,MAAA,CAAO,IAAA;AAE9B,EAAA,IAAI,IAAA,CAAK,SAAS,SAAA,EAAW;AAC3B,IAAA,MAAM,IAAI,MAAM,wCAAwC,CAAA;AAAA,EAC1D;AAEA,EAAA,OAAO;AAAA,IACL,QAAQ,IAAA,CAAK;AAAA,GACf;AACF;;;AC7EO,SAAS,sBACd,QAAA,EACA;AACA,EAAA,OAAO;AAAA;AAAA;AAAA;AAAA,IAIL,OAAA,EAAS,CAAC,SAAA,KAAqC;AAC7C,MAAA,OAAO,SAAS,SAAS,CAAA;AAAA,IAC3B,CAAA;AAAA;AAAA;AAAA;AAAA,IAKA,WAAA,EAAa,CAAC,MAAA,KAA4B;AACxC,MAAA,OAAO,MAAA,CAAO,MAAA,CAAO,QAAQ,CAAA,CAAE,MAAA;AAAA,QAC7B,CAAC,KAAA,KAAU,KAAA,CAAM,QAAA,KAAa,UAAU,KAAA,CAAM;AAAA,OAChD;AAAA,IACF,CAAA;AAAA;AAAA;AAAA;AAAA,IAKA,WAAW,MAAW;AACpB,MAAA,OAAO,MAAA,CAAO,OAAO,QAAQ,CAAA,CAAE,OAAO,CAAC,KAAA,KAAU,MAAM,QAAQ,CAAA;AAAA,IACjE,CAAA;AAAA;AAAA;AAAA;AAAA,IAKA,QAAQ,MAAW;AACjB,MAAA,OAAO,MAAA,CAAO,OAAO,QAAQ,CAAA;AAAA,IAC/B,CAAA;AAAA;AAAA;AAAA;AAAA,IAKA,GAAA,EAAK,CAAC,SAAA,KAA+B;AACnC,MAAA,OAAO,SAAA,IAAa,QAAA;AAAA,IACtB;AAAA,GACF;AACF;;;ACyBO,IAAM,UAAA,GAAa;AAAA,EACxB,CAAC,MAAA,CAAO,MAAM,GAAG;AAAA;AAAA,IAEf,eAAA,EAAiB,iBAAA;AAAA;AAAA,IAEjB,KAAA,EAAO,OAAA;AAAA;AAAA,IAEP,QAAA,EAAU;AAAA,GACZ;AAAA,EACA,CAAC,MAAA,CAAO,MAAM,GAAG;AAAA;AAAA,IAEf,oBAAA,EAAsB,8BAAA;AAAA;AAAA,IAEtB,kBAAA,EAAoB;AAAA;AAExB;AASA,IAAM,eAAA,GAAqE;AAAA,EACzE,MAAA,EAAQ,aAAA;AAAA,EACR,SAAS,aAAA,CAAc,UAAA;AAAA,EACvB,WAAW,gBAAA,CAAiB,UAAA;AAAA,EAC5B,KAAA,EAAO,EAAE,SAAA,EAAW,IAAA,EAAM,KAAK,IAAA,EAAM,GAAA,EAAK,CAAA,EAAK,OAAA,EAAS,CAAA;AAC1D,CAAA;AAUO,IAAM,kBAAA,GAA2D;AAAA;AAAA,EAGtE,iBAAA,EAAmB;AAAA,IACjB,IAAA,EAAM,iBAAA;AAAA,IACN,WAAA,EAAa,iBAAA;AAAA,IACb,UAAU,MAAA,CAAO,MAAA;AAAA,IACjB,WAAA,EAAa,8DAAA;AAAA,IACb,QAAA,EAAU,IAAA;AAAA,IACV,WAAA,EAAa,YAAA;AAAA,IACb,OAAA,EAAS;AAAA,MACP,aAAA,EAAe,wDAAA;AAAA,MACf,OAAA,EAAS,4BAAA;AAAA,MACT,YAAA,EAAc;AAAA,KAChB;AAAA,IACA,YAAA,EAAc;AAAA,MACZ,GAAG,eAAA;AAAA,MACH,QAAA,EAAU;AAAA,QACR,SAAA,EAAW,KAAA;AAAA;AAAA,QACX,IAAA,EAAM,KAAA;AAAA,QACN,QAAA,EAAU,IAAA;AAAA;AAAA,QACV,YAAA,EAAc,IAAA;AAAA,QACd,cAAA,EAAgB,KAAA;AAAA,QAChB,mBAAA,EAAqB;AAAA,OACvB;AAAA,MACA,MAAA,EAAQ,EAAE,cAAA,EAAgB,GAAA,EAAK;AAAA,MAC/B,aAAA,EAAe;AAAA,QACb,YAAA,EAAc;AAAA,UACZ,IAAA,EAAM,QAAA;AAAA,UACN,WAAA,EAAa;AAAA;AACf;AACF,KACF;AAAA,IACA,OAAA,EAAS,EAAE,eAAA,EAAiB,KAAA,EAAO,UAAU,KAAA;AAAM,GACrD;AAAA,EAEA,OAAA,EAAS;AAAA,IACP,IAAA,EAAM,OAAA;AAAA,IACN,WAAA,EAAa,OAAA;AAAA,IACb,UAAU,MAAA,CAAO,MAAA;AAAA,IACjB,WAAA,EAAa,8DAAA;AAAA,IACb,QAAA,EAAU,IAAA;AAAA,IACV,WAAA,EAAa,YAAA;AAAA,IACb,OAAA,EAAS;AAAA,MACP,aAAA,EAAe,wDAAA;AAAA,MACf,OAAA,EAAS,4BAAA;AAAA,MACT,YAAA,EAAc;AAAA,KAChB;AAAA,IACA,YAAA,EAAc;AAAA,MACZ,GAAG,eAAA;AAAA,MACH,QAAA,EAAU;AAAA,QACR,SAAA,EAAW,KAAA;AAAA;AAAA,QACX,IAAA,EAAM,KAAA;AAAA,QACN,QAAA,EAAU,KAAA;AAAA,QACV,YAAA,EAAc,KAAA;AAAA,QACd,cAAA,EAAgB;AAAA,OAClB;AAAA,MACA,MAAA,EAAQ,EAAE,cAAA,EAAgB,IAAA;AAAK,KACjC;AAAA,IACA,OAAA,EAAS,EAAE,eAAA,EAAiB,KAAA,EAAO,UAAU,KAAA;AAAM,GACrD;AAAA,EAEA,UAAA,EAAY;AAAA,IACV,IAAA,EAAM,UAAA;AAAA,IACN,WAAA,EAAa,UAAA;AAAA,IACb,UAAU,MAAA,CAAO,MAAA;AAAA,IACjB,WAAA,EAAa,4DAAA;AAAA,IACb,QAAA,EAAU,IAAA;AAAA,IACV,WAAA,EAAa,YAAA;AAAA,IACb,OAAA,EAAS;AAAA,MACP,aAAA,EAAe,wDAAA;AAAA,MACf,OAAA,EAAS,4BAAA;AAAA,MACT,YAAA,EAAc;AAAA,KAChB;AAAA,IACA,YAAA,EAAc;AAAA,MACZ,GAAG,eAAA;AAAA,MACH,QAAA,EAAU;AAAA,QACR,SAAA,EAAW,KAAA;AAAA;AAAA,QACX,IAAA,EAAM,KAAA;AAAA,QACN,QAAA,EAAU,KAAA;AAAA,QACV,YAAA,EAAc,KAAA;AAAA,QACd,cAAA,EAAgB;AAAA,OAClB;AAAA,MACA,MAAA,EAAQ,EAAE,cAAA,EAAgB,IAAA;AAAK,KACjC;AAAA,IACA,OAAA,EAAS,EAAE,eAAA,EAAiB,IAAA,EAAO,UAAU,KAAA;AAAM,GACrD;AAAA;AAAA,EAIA,8BAAA,EAAgC;AAAA,IAC9B,IAAA,EAAM,8BAAA;AAAA,IACN,WAAA,EAAa,sBAAA;AAAA,IACb,UAAU,MAAA,CAAO,MAAA;AAAA,IACjB,WAAA,EAAa,yDAAA;AAAA,IACb,QAAA,EAAU,IAAA;AAAA,IACV,WAAA,EAAa,YAAA;AAAA,IACb,OAAA,EAAS;AAAA,MACP,aAAA,EAAe,yDAAA;AAAA,MACf,OAAA,EAAS,+BAAA;AAAA,MACT,YAAA,EAAc;AAAA,KAChB;AAAA,IACA,YAAA,EAAc;AAAA,MACZ,MAAA,EAAQ,aAAA;AAAA,MACR,OAAA,EAAS,CAAC,KAAK,CAAA;AAAA;AAAA,MACf,SAAA,EAAW,CAAC,GAAG,oBAAoB,CAAA;AAAA,MACnC,KAAA,EAAO,EAAE,SAAA,EAAW,KAAA,EAAM;AAAA;AAAA,MAC1B,QAAA,EAAU;AAAA,QACR,SAAA,EAAW,KAAA;AAAA;AAAA,QACX,IAAA,EAAM,KAAA;AAAA,QACN,QAAA,EAAU,IAAA;AAAA;AAAA,QACV,YAAA,EAAc,KAAA;AAAA,QACd,cAAA,EAAgB;AAAA,OAClB;AAAA,MACA,MAAA,EAAQ,EAAE,cAAA,EAAgB,IAAA;AAAM;AAAA;AAClC,GACF;AAAA,EAEA,4BAAA,EAA8B;AAAA,IAC5B,IAAA,EAAM,4BAAA;AAAA,IACN,WAAA,EAAa,oBAAA;AAAA,IACb,UAAU,MAAA,CAAO,MAAA;AAAA,IACjB,WAAA,EAAa,mDAAA;AAAA,IACb,QAAA,EAAU,IAAA;AAAA,IACV,WAAA,EAAa,YAAA;AAAA,IACb,OAAA,EAAS;AAAA,MACP,aAAA,EAAe,yDAAA;AAAA,MACf,OAAA,EAAS,+BAAA;AAAA,MACT,YAAA,EAAc;AAAA,KAChB;AAAA,IACA,YAAA,EAAc;AAAA,MACZ,MAAA,EAAQ,aAAA;AAAA,MACR,OAAA,EAAS,CAAC,KAAK,CAAA;AAAA;AAAA,MACf,SAAA,EAAW,CAAC,GAAG,oBAAoB,CAAA;AAAA,MACnC,KAAA,EAAO,EAAE,SAAA,EAAW,KAAA,EAAM;AAAA;AAAA,MAC1B,QAAA,EAAU;AAAA,QACR,SAAA,EAAW,KAAA;AAAA;AAAA,QACX,IAAA,EAAM,KAAA;AAAA,QACN,QAAA,EAAU,IAAA;AAAA;AAAA,QACV,YAAA,EAAc,KAAA;AAAA,QACd,cAAA,EAAgB;AAAA,OAClB;AAAA,MACA,MAAA,EAAQ,EAAE,cAAA,EAAgB,IAAA;AAAM;AAAA;AAClC;AAEJ;AAMA,IAAM,OAAA,GAAU,sBAAsB,kBAAkB,CAAA;AAEjD,IAAM,kBAAkB,OAAA,CAAQ;AAChC,IAAM,uBAAuB,OAAA,CAAQ;AACrC,IAAM,qBAAqB,OAAA,CAAQ;AAKnC,SAAS,wBACd,OAAA,EACwB;AACxB,EAAA,OAAO,MAAA,CAAO,MAAA,CAAO,kBAAkB,CAAA,CAAE,MAAA;AAAA,IACvC,CAAC,KAAA,KAAU,KAAA,CAAM,YAAY,KAAA,CAAM,YAAA,CAAa,SAAS,OAAO;AAAA,GAClE;AACF;AAKO,SAAS,gBAAA,CAAiB,WAAmB,cAAA,EAAuC;AACzF,EAAA,MAAM,KAAA,GAAQ,gBAAgB,SAAS,CAAA;AACvC,EAAA,IAAI,CAAC,KAAA,EAAO,OAAA,EAAS,OAAO,IAAA;AAC5B,EAAA,OAAQ,cAAA,GAAiB,GAAA,GAAQ,KAAA,CAAM,OAAA,CAAQ,eAAA;AACjD;AR5PO,IAAM,YAAA,GAAN,MAAM,aAAA,CAAa;AAAA,EAChB,QAAA;AAAA,EACA,MAAA;AAAA;AAAA;AAAA;AAAA,EAKR,OAAO,OAAO,MAAA,EAA0C;AACtD,IAAA,OAAO,IAAI,cAAa,MAAM,CAAA;AAAA,EAChC;AAAA,EAEQ,YAAY,MAAA,EAA4B;AAC9C,IAAA,MAAM,SAAA,GAAY,OAAO,MAAA,CAAO,SAAA,KAAc,QAAA,GAC1C,UAAU,GAAA,CAAI,MAAA,CAAO,SAAS,CAAA,GAC9B,MAAA,CAAO,SAAA;AAEX,IAAA,IAAA,CAAK,QAAA,GAAW,kBAAkB,SAAS,CAAA;AAC3C,IAAA,IAAA,CAAK,MAAA,GAAS,MAAA;AAAA,EAChB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAWA,MAAM,UAAA,CACJ,IAAA,EACA,OAAA,EACsB;AACtB,IAAA,MAAM,WAAA,GAA0B;AAAA,MAC9B,KAAA,EAAO,IAAA,CAAK,MAAA,CAAO,KAAA,IAAS,KAAK,eAAA,EAAgB;AAAA,MACjD,KAAA,EAAO,IAAA;AAAA,MACP,OAAO,OAAA,EAAS,KAAA,IAAS,KAAK,MAAA,CAAO,KAAA,IAAS,KAAK,eAAA,EAAgB;AAAA,MACnE,MAAA,EAAQ,OAAA,EAAS,MAAA,IAAU,IAAA,CAAK,MAAA,CAAO,MAAA;AAAA,MACvC,KAAA,EAAO,OAAA,EAAS,KAAA,IAAS,IAAA,CAAK,MAAA,CAAO,KAAA;AAAA,MACrC,eAAe,OAAA,EAAS;AAAA,KAC1B;AAEA,IAAA,OAAO,IAAA,CAAK,QAAA,CAAS,UAAA,CAAW,WAAW,CAAA;AAAA,EAC7C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,MAAM,MAAA,CACJ,IAAA,EACA,QAAA,EACA,OAAA,EACe;AACf,IAAA,MAAM,QAAA,GAAW,MAAM,IAAA,CAAK,UAAA,CAAW,MAAM,OAAO,CAAA;AACpD,IAAA,MAASK,IAAA,CAAA,SAAA,CAAU,QAAA,EAAU,QAAA,CAAS,KAAK,CAAA;AAAA,EAC7C;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,aAAa,KAAA,EAAsC;AACjD,IAAA,MAAM,cAAc,KAAA,IAAS,IAAA,CAAK,MAAA,CAAO,KAAA,IAAS,KAAK,eAAA,EAAgB;AACvE,IAAA,MAAM,IAAA,GAAO,gBAAgB,WAAW,CAAA;AAExC,IAAA,IAAI,CAAC,IAAA,EAAM;AACT,MAAA,MAAM,IAAI,KAAA,CAAM,CAAA,mBAAA,EAAsB,WAAW,CAAA,CAAE,CAAA;AAAA,IACrD;AAEA,IAAA,OAAO,IAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,qBAAqB,KAAA,EAAgB;AACnC,IAAA,OAAO,IAAA,CAAK,YAAA,CAAa,KAAK,CAAA,CAAE,YAAA;AAAA,EAClC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,MAAM,WAAW,KAAA,EAAuC;AAEtD,IAAA,IAAI,IAAA,CAAK,SAAS,UAAA,EAAY;AAC5B,MAAA,OAAO,IAAA,CAAK,SAAS,UAAA,EAAW;AAAA,IAClC;AAGA,IAAA,MAAM,IAAA,GAAO,IAAA,CAAK,oBAAA,CAAqB,KAAK,CAAA;AAC5C,IAAA,OAAO,IAAA,CAAK,MAAA;AAAA,EACd;AAAA;AAAA;AAAA;AAAA,EAKA,mBAAA,GAA8C;AAC5C,IAAA,MAAM,MAAA,GAAS,KAAK,QAAA,CAAS,MAAA;AAC7B,IAAA,IAAI,CAAC,MAAA,EAAQ;AACX,MAAA,OAAO,EAAC;AAAA,IACV;AACA,IAAA,OAAO,qBAAqB,MAAa,CAAA;AAAA,EAC3C;AAAA;AAAA;AAAA;AAAA,EAKA,eAAA,CACE,SACA,KAAA,EACS;AACT,IAAA,MAAM,IAAA,GAAO,IAAA,CAAK,oBAAA,CAAqB,KAAK,CAAA;AAC5C,IAAA,OAAO,OAAA,CAAQ,IAAA,CAAK,QAAA,CAAS,OAAO,CAAC,CAAA;AAAA,EACvC;AAAA;AAAA;AAAA;AAAA,EAKA,oBAAoB,KAAA,EAAwD;AAC1E,IAAA,OAAO,IAAA,CAAK,oBAAA,CAAqB,KAAK,CAAA,CAAE,OAAA;AAAA,EAC1C;AAAA;AAAA;AAAA;AAAA,EAKA,sBAAsB,KAAA,EAA8C;AAClE,IAAA,OAAO,IAAA,CAAK,oBAAA,CAAqB,KAAK,CAAA,CAAE,SAAA;AAAA,EAC1C;AAAA;AAAA;AAAA;AAAA,EAKA,qBAAqB,KAAA,EAAyB;AAC5C,IAAA,OAAO,IAAA,CAAK,oBAAA,CAAqB,KAAK,CAAA,CAAE,KAAA,CAAM,SAAA;AAAA,EAChD;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,SAAS,KAAA,EAAqB;AAC5B,IAAA,IAAA,CAAK,OAAO,KAAA,GAAQ,KAAA;AAAA,EACtB;AAAA;AAAA;AAAA;AAAA,EAKA,SAAS,KAAA,EAAqB;AAC5B,IAAA,IAAA,CAAK,OAAO,KAAA,GAAQ,KAAA;AAAA,EACtB;AAAA;AAAA;AAAA;AAAA,EAKA,UAAU,MAAA,EAA2B;AACnC,IAAA,IAAA,CAAK,OAAO,MAAA,GAAS,MAAA;AAAA,EACvB;AAAA;AAAA;AAAA;AAAA,EAKA,SAAS,KAAA,EAAqB;AAC5B,IAAA,IAAA,CAAK,OAAO,KAAA,GAAQ,KAAA;AAAA,EACtB;AAAA;AAAA;AAAA;AAAA;AAAA,EAOQ,eAAA,GAA0B;AAChC,IAAA,MAAM,MAAA,GAAS,KAAK,mBAAA,EAAoB;AACxC,IAAA,MAAM,UAAA,GAAa,OAAO,CAAC,CAAA;AAC3B,IAAA,IAAI,CAAC,UAAA,EAAY;AACf,MAAA,MAAM,IAAI,MAAM,2CAA2C,CAAA;AAAA,IAC7D;AACA,IAAA,OAAO,UAAA,CAAW,IAAA;AAAA,EACpB;AAAA;AAAA;AAAA;AAAA,EAKQ,eAAA,GAA0B;AAChC,IAAA,MAAM,IAAA,GAAO,IAAA,CAAK,YAAA,EAAa,CAAE,YAAA;AACjC,IAAA,MAAM,eAAe,IAAA,CAAK,MAAA,CAAO,KAAK,CAAC,CAAA,KAAM,EAAE,SAAS,CAAA;AACxD,IAAA,OAAO,cAAc,EAAA,IAAM,IAAA,CAAK,MAAA,CAAO,CAAC,GAAG,EAAA,IAAM,OAAA;AAAA,EACnD;AACF;;;AS9OA,cAAA,EAAA;;;AC+EO,IAAM,UAAA,GAAa;AAAA,EACxB,CAAC,MAAA,CAAO,MAAM,GAAG;AAAA;AAAA,IAEf,iBAAA,EAAmB,mBAAA;AAAA;AAAA,IAEnB,yBAAA,EAA2B,2BAAA;AAAA;AAAA,IAE3B,SAAA,EAAW;AAAA,GACb;AAAA,EACA,CAAC,MAAA,CAAO,IAAI,GAAG;AAAA;AAAA,IAEb,gBAAA,EAAkB,kBAAA;AAAA;AAAA,IAElB,cAAA,EAAgB;AAAA;AAEpB;AASA,IAAM,yBAAA,GAA+E;AAAA,EACnF,cAAc,aAAA,CAAc,SAAA;AAAA,EAC5B,eAAe,CAAC,MAAA,EAAQ,MAAA,EAAQ,KAAA,EAAO,OAAO,cAAc,CAAA;AAAA,EAC5D,WAAW,EAAC;AAAA;AAAA,EACZ,UAAA,EAAY,EAAE,SAAA,EAAW,IAAA,EAAM,eAAe,CAAC,MAAA,EAAQ,SAAS,CAAA;AAClE,CAAA;AAUO,IAAM,kBAAA,GAA2D;AAAA;AAAA,EAGtE,mBAAA,EAAqB;AAAA,IACnB,IAAA,EAAM,mBAAA;AAAA,IACN,WAAA,EAAa,mBAAA;AAAA,IACb,UAAU,MAAA,CAAO,MAAA;AAAA,IACjB,WAAA,EAAa,6EAAA;AAAA,IACb,QAAA,EAAU,IAAA;AAAA,IACV,WAAA,EAAa,YAAA;AAAA,IACb,OAAA,EAAS;AAAA,MACP,aAAA,EAAe,wDAAA;AAAA,MACf,OAAA,EAAS,4BAAA;AAAA,MACT,YAAA,EAAc;AAAA,KAChB;AAAA,IACA,YAAA,EAAc;AAAA,MACZ,GAAG,yBAAA;AAAA,MACH,QAAA,EAAU;AAAA,QACR,WAAA,EAAa,IAAA;AAAA,QACb,WAAA,EAAa,KAAA;AAAA,QACb,SAAA,EAAW,KAAA;AAAA;AAAA,QACX,WAAA,EAAa,IAAA;AAAA,QACb,eAAA,EAAiB;AAAA,OACnB;AAAA,MACA,MAAA,EAAQ,EAAE,aAAA,EAAe,EAAA,EAAI,oBAAoB,IAAA;AAAK,KACxD;AAAA,IACA,OAAA,EAAS,EAAE,SAAA,EAAW,IAAA,EAAO,UAAU,KAAA;AAAM,GAC/C;AAAA,EAEA,2BAAA,EAA6B;AAAA,IAC3B,IAAA,EAAM,2BAAA;AAAA,IACN,WAAA,EAAa,iCAAA;AAAA,IACb,UAAU,MAAA,CAAO,MAAA;AAAA,IACjB,WAAA,EAAa,kDAAA;AAAA,IACb,QAAA,EAAU,IAAA;AAAA,IACV,WAAA,EAAa,YAAA;AAAA,IACb,OAAA,EAAS;AAAA,MACP,aAAA,EAAe,wDAAA;AAAA,MACf,OAAA,EAAS,4BAAA;AAAA,MACT,YAAA,EAAc;AAAA,KAChB;AAAA,IACA,YAAA,EAAc;AAAA,MACZ,GAAG,yBAAA;AAAA,MACH,aAAA,EAAe,CAAC,MAAA,EAAQ,cAAc,CAAA;AAAA,MACtC,QAAA,EAAU;AAAA,QACR,WAAA,EAAa,IAAA;AAAA,QACb,WAAA,EAAa,IAAA;AAAA;AAAA,QACb,SAAA,EAAW,KAAA;AAAA,QACX,WAAA,EAAa,IAAA;AAAA,QACb,eAAA,EAAiB;AAAA,OACnB;AAAA,MACA,MAAA,EAAQ,EAAE,aAAA,EAAe,EAAA,EAAI,oBAAoB,IAAA,EAAK;AAAA,MACtD,aAAA,EAAe;AAAA,QACb,YAAA,EAAc;AAAA,UACZ,IAAA,EAAM,QAAA;AAAA,UACN,WAAA,EAAa,sCAAA;AAAA,UACb,GAAA,EAAK,CAAA;AAAA,UACL,GAAA,EAAK,EAAA;AAAA,UACL,OAAA,EAAS;AAAA;AACX;AACF,KACF;AAAA,IACA,OAAA,EAAS,EAAE,SAAA,EAAW,KAAA,EAAO,UAAU,KAAA;AAAM;AAAA,GAC/C;AAAA,EAEA,WAAA,EAAa;AAAA,IACX,IAAA,EAAM,WAAA;AAAA,IACN,WAAA,EAAa,SAAA;AAAA,IACb,UAAU,MAAA,CAAO,MAAA;AAAA,IACjB,WAAA,EAAa,mDAAA;AAAA,IACb,QAAA,EAAU,IAAA;AAAA,IACV,WAAA,EAAa,YAAA;AAAA,IACb,OAAA,EAAS;AAAA,MACP,aAAA,EAAe,wDAAA;AAAA,MACf,OAAA,EAAS,4BAAA;AAAA,MACT,YAAA,EAAc;AAAA,KAChB;AAAA,IACA,YAAA,EAAc;AAAA,MACZ,GAAG,yBAAA;AAAA,MACH,YAAA,EAAc,CAAC,KAAA,EAAO,KAAA,EAAO,QAAQ,MAAA,EAAQ,KAAA,EAAO,OAAO,MAAM,CAAA;AAAA,MACjE,QAAA,EAAU;AAAA,QACR,WAAA,EAAa,IAAA;AAAA,QACb,WAAA,EAAa,KAAA;AAAA,QACb,SAAA,EAAW,KAAA;AAAA,QACX,WAAA,EAAa,IAAA;AAAA,QACb,eAAA,EAAiB;AAAA,OACnB;AAAA,MACA,MAAA,EAAQ,EAAE,aAAA,EAAe,EAAA;AAAG,KAC9B;AAAA,IACA,OAAA,EAAS,EAAE,SAAA,EAAW,IAAA,EAAO,UAAU,KAAA;AAAM,GAC/C;AAAA;AAAA,EAIA,kBAAA,EAAoB;AAAA,IAClB,IAAA,EAAM,kBAAA;AAAA,IACN,WAAA,EAAa,yBAAA;AAAA,IACb,UAAU,MAAA,CAAO,IAAA;AAAA,IACjB,WAAA,EAAa,2DAAA;AAAA,IACb,QAAA,EAAU,IAAA;AAAA,IACV,WAAA,EAAa,YAAA;AAAA,IACb,OAAA,EAAS;AAAA,MACP,aAAA,EAAe,2CAAA;AAAA,MACf,OAAA,EAAS,2BAAA;AAAA,MACT,YAAA,EAAc;AAAA,KAChB;AAAA,IACA,YAAA,EAAc;AAAA,MACZ,GAAG,yBAAA;AAAA,MACH,YAAY,EAAE,SAAA,EAAW,MAAM,aAAA,EAAe,CAAC,SAAS,CAAA,EAAE;AAAA,MAC1D,aAAA,EAAe,CAAC,MAAA,EAAQ,MAAA,EAAQ,cAAc,CAAA;AAAA,MAC9C,QAAA,EAAU;AAAA,QACR,WAAA,EAAa,IAAA;AAAA,QACb,WAAA,EAAa,KAAA;AAAA,QACb,SAAA,EAAW,KAAA;AAAA,QACX,WAAA,EAAa,IAAA;AAAA,QACb,eAAA,EAAiB;AAAA,OACnB;AAAA,MACA,MAAA,EAAQ,EAAE,aAAA,EAAe,EAAA;AAAG,KAC9B;AAAA,IACA,OAAA,EAAS,EAAE,SAAA,EAAW,IAAA,EAAQ,UAAU,KAAA;AAAM;AAAA,GAChD;AAAA,EAEA,4BAAA,EAA8B;AAAA,IAC5B,IAAA,EAAM,4BAAA;AAAA,IACN,WAAA,EAAa,uBAAA;AAAA,IACb,UAAU,MAAA,CAAO,IAAA;AAAA,IACjB,WAAA,EAAa,6CAAA;AAAA,IACb,QAAA,EAAU,IAAA;AAAA,IACV,WAAA,EAAa,YAAA;AAAA,IACb,OAAA,EAAS;AAAA,MACP,aAAA,EAAe,2CAAA;AAAA,MACf,OAAA,EAAS,2BAAA;AAAA,MACT,YAAA,EAAc;AAAA,KAChB;AAAA,IACA,YAAA,EAAc;AAAA,MACZ,cAAc,aAAA,CAAc,SAAA;AAAA,MAC5B,aAAA,EAAe,CAAC,MAAA,EAAQ,MAAA,EAAQ,cAAc,CAAA;AAAA,MAC9C,SAAA,EAAW,CAAC,IAAI,CAAA;AAAA;AAAA,MAChB,YAAY,EAAE,SAAA,EAAW,MAAM,aAAA,EAAe,CAAC,SAAS,CAAA,EAAE;AAAA,MAC1D,QAAA,EAAU;AAAA,QACR,WAAA,EAAa,KAAA;AAAA,QACb,WAAA,EAAa,KAAA;AAAA,QACb,SAAA,EAAW,KAAA;AAAA,QACX,WAAA,EAAa,IAAA;AAAA,QACb,eAAA,EAAiB;AAAA,OACnB;AAAA,MACA,MAAA,EAAQ,EAAE,aAAA,EAAe,EAAA;AAAG,KAC9B;AAAA,IACA,OAAA,EAAS,EAAE,SAAA,EAAW,KAAA,EAAS,UAAU,KAAA;AAAM;AAEnD;AAMA,IAAMC,QAAAA,GAAU,sBAAsB,kBAAkB,CAAA;AAEjD,IAAM,kBAAkBA,QAAAA,CAAQ;AAChC,IAAM,uBAAuBA,QAAAA,CAAQ;AACrC,IAAM,qBAAqBA,QAAAA,CAAQ;AAKnC,SAAS,wBACd,OAAA,EACwB;AACxB,EAAA,OAAO,MAAA,CAAO,MAAA,CAAO,kBAAkB,CAAA,CAAE,MAAA;AAAA,IACvC,CAAC,KAAA,KAAU,KAAA,CAAM,YAAY,KAAA,CAAM,YAAA,CAAa,SAAS,OAAO;AAAA,GAClE;AACF;AAKO,SAAS,gBAAA,CAAiB,WAAmB,eAAA,EAAwC;AAC1F,EAAA,MAAM,KAAA,GAAQ,gBAAgB,SAAS,CAAA;AACvC,EAAA,IAAI,CAAC,KAAA,EAAO,OAAA,EAAS,OAAO,IAAA;AAC5B,EAAA,OAAQ,eAAA,GAAkB,EAAA,GAAM,KAAA,CAAM,OAAA,CAAQ,SAAA;AAChD;ADjQO,IAAM,YAAA,GAAN,MAAM,aAAA,CAAa;AAAA,EAChB,QAAA;AAAA,EACA,MAAA;AAAA;AAAA;AAAA;AAAA,EAKR,OAAO,OAAO,MAAA,EAA0C;AACtD,IAAA,OAAO,IAAI,cAAa,MAAM,CAAA;AAAA,EAChC;AAAA,EAEQ,YAAY,MAAA,EAA4B;AAC9C,IAAA,MAAM,SAAA,GAAY,OAAO,MAAA,CAAO,SAAA,KAAc,QAAA,GAC1C,UAAU,GAAA,CAAI,MAAA,CAAO,SAAS,CAAA,GAC9B,MAAA,CAAO,SAAA;AAEX,IAAA,IAAA,CAAK,QAAA,GAAW,kBAAkB,SAAS,CAAA;AAC3C,IAAA,IAAA,CAAK,MAAA,GAAS,MAAA;AAAA,EAChB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAWA,MAAM,UAAA,CACJ,KAAA,EACA,OAAA,EACsB;AACtB,IAAA,MAAM,WAAA,GAA0B;AAAA,MAC9B,KAAA,EAAO,IAAA,CAAK,MAAA,CAAO,KAAA,IAAS,KAAK,eAAA,EAAgB;AAAA,MACjD,KAAA;AAAA,MACA,QAAA,EAAU,OAAA,EAAS,QAAA,IAAY,IAAA,CAAK,MAAA,CAAO,QAAA;AAAA,MAC3C,cAAc,OAAA,EAAS,YAAA;AAAA,MACvB,mBAAmB,OAAA,EAAS,iBAAA;AAAA,MAC5B,sBAAsB,OAAA,EAAS,oBAAA;AAAA,MAC/B,QAAQ,OAAA,EAAS,MAAA;AAAA,MACjB,WAAA,EAAa,OAAA,EAAS,WAAA,IAAe,IAAA,CAAK,MAAA,CAAO,WAAA;AAAA,MACjD,eAAe,OAAA,EAAS;AAAA,KAC1B;AAEA,IAAA,OAAO,IAAA,CAAK,QAAA,CAAS,UAAA,CAAW,WAAW,CAAA;AAAA,EAC7C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,MAAM,cAAA,CACJ,QAAA,EACA,OAAA,EACsB;AACtB,IAAA,MAAM,KAAA,GAAQ,MAASC,IAAA,CAAA,QAAA,CAAS,QAAQ,CAAA;AACxC,IAAA,OAAO,IAAA,CAAK,UAAA,CAAW,KAAA,EAAO,OAAO,CAAA;AAAA,EACvC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,MAAM,wBAAA,CACJ,KAAA,EACA,WAAA,GAAkC,WAClC,OAAA,EACsB;AACtB,IAAA,OAAO,IAAA,CAAK,WAAW,KAAA,EAAO;AAAA,MAC5B,GAAG,OAAA;AAAA,MACH,YAAA,EAAc,cAAA;AAAA,MACd,iBAAA,EAAmB,IAAA;AAAA,MACnB,oBAAA,EAAsB;AAAA,KACvB,CAAA;AAAA,EACH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,MAAM,SAAA,CACJ,KAAA,EACA,OAAA,EACsB;AACtB,IAAA,IAAI,CAAC,IAAA,CAAK,QAAA,CAAS,SAAA,EAAW;AAC5B,MAAA,MAAM,IAAI,MAAM,4CAA4C,CAAA;AAAA,IAC9D;AAEA,IAAA,MAAM,WAAA,GAA0B;AAAA,MAC9B,KAAA,EAAO,IAAA,CAAK,MAAA,CAAO,KAAA,IAAS,KAAK,eAAA,EAAgB;AAAA,MACjD,KAAA;AAAA,MACA,cAAc,OAAA,EAAS,YAAA;AAAA,MACvB,QAAQ,OAAA,EAAS,MAAA;AAAA,MACjB,WAAA,EAAa,OAAA,EAAS,WAAA,IAAe,IAAA,CAAK,MAAA,CAAO,WAAA;AAAA,MACjD,eAAe,OAAA,EAAS;AAAA,KAC1B;AAEA,IAAA,OAAO,IAAA,CAAK,QAAA,CAAS,SAAA,CAAU,WAAW,CAAA;AAAA,EAC5C;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,aAAa,KAAA,EAAsC;AACjD,IAAA,MAAM,cAAc,KAAA,IAAS,IAAA,CAAK,MAAA,CAAO,KAAA,IAAS,KAAK,eAAA,EAAgB;AACvE,IAAA,MAAM,IAAA,GAAO,gBAAgB,WAAW,CAAA;AAExC,IAAA,IAAI,CAAC,IAAA,EAAM;AACT,MAAA,MAAM,IAAI,KAAA,CAAM,CAAA,mBAAA,EAAsB,WAAW,CAAA,CAAE,CAAA;AAAA,IACrD;AAEA,IAAA,OAAO,IAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,qBAAqB,KAAA,EAAgB;AACnC,IAAA,OAAO,IAAA,CAAK,YAAA,CAAa,KAAK,CAAA,CAAE,YAAA;AAAA,EAClC;AAAA;AAAA;AAAA;AAAA,EAKA,mBAAA,GAA8C;AAC5C,IAAA,MAAM,MAAA,GAAS,KAAK,QAAA,CAAS,MAAA;AAC7B,IAAA,IAAI,CAAC,MAAA,EAAQ;AACX,MAAA,OAAO,EAAC;AAAA,IACV;AACA,IAAA,OAAO,qBAAqB,MAAa,CAAA;AAAA,EAC3C;AAAA;AAAA;AAAA;AAAA,EAKA,eAAA,CACE,SACA,KAAA,EACS;AACT,IAAA,MAAM,IAAA,GAAO,IAAA,CAAK,oBAAA,CAAqB,KAAK,CAAA;AAC5C,IAAA,OAAO,OAAA,CAAQ,IAAA,CAAK,QAAA,CAAS,OAAO,CAAC,CAAA;AAAA,EACvC;AAAA;AAAA;AAAA;AAAA,EAKA,yBAAyB,KAAA,EAA8C;AACrE,IAAA,OAAO,IAAA,CAAK,oBAAA,CAAqB,KAAK,CAAA,CAAE,YAAA;AAAA,EAC1C;AAAA;AAAA;AAAA;AAAA,EAKA,0BAA0B,KAAA,EAAmC;AAC3D,IAAA,OAAO,IAAA,CAAK,oBAAA,CAAqB,KAAK,CAAA,CAAE,aAAA;AAAA,EAC1C;AAAA;AAAA;AAAA;AAAA,EAKA,sBAAsB,KAAA,EAAmC;AACvD,IAAA,OAAO,IAAA,CAAK,oBAAA,CAAqB,KAAK,CAAA,CAAE,SAAA;AAAA,EAC1C;AAAA;AAAA;AAAA;AAAA,EAKA,mBAAmB,KAAA,EAAyB;AAC1C,IAAA,OAAO,IAAA,CAAK,oBAAA,CAAqB,KAAK,CAAA,CAAE,UAAA,CAAW,SAAA;AAAA,EACrD;AAAA;AAAA;AAAA;AAAA,EAKA,oBAAoB,KAAA,EAAyB;AAC3C,IAAA,OAAO,IAAA,CAAK,eAAA,CAAgB,aAAA,EAAe,KAAK,CAAA;AAAA,EAClD;AAAA;AAAA;AAAA;AAAA,EAKA,oBAAoB,KAAA,EAAyB;AAC3C,IAAA,OAAO,IAAA,CAAK,eAAA,CAAgB,aAAA,EAAe,KAAK,CAAA;AAAA,EAClD;AAAA;AAAA;AAAA;AAAA,EAKA,0BAA0B,KAAA,EAAoD;AAC5E,IAAA,OAAO,IAAA,CAAK,oBAAA,CAAqB,KAAK,CAAA,CAAE,UAAA,CAAW,aAAA;AAAA,EACrD;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,SAAS,KAAA,EAAqB;AAC5B,IAAA,IAAA,CAAK,OAAO,KAAA,GAAQ,KAAA;AAAA,EACtB;AAAA;AAAA;AAAA;AAAA,EAKA,YAAY,QAAA,EAAwB;AAClC,IAAA,IAAA,CAAK,OAAO,QAAA,GAAW,QAAA;AAAA,EACzB;AAAA;AAAA;AAAA;AAAA,EAKA,eAAe,WAAA,EAA2B;AACxC,IAAA,IAAA,CAAK,OAAO,WAAA,GAAc,WAAA;AAAA,EAC5B;AAAA;AAAA;AAAA;AAAA;AAAA,EAOQ,eAAA,GAA0B;AAChC,IAAA,MAAM,MAAA,GAAS,KAAK,mBAAA,EAAoB;AACxC,IAAA,MAAM,UAAA,GAAa,OAAO,CAAC,CAAA;AAC3B,IAAA,IAAI,CAAC,UAAA,EAAY;AACf,MAAA,MAAM,IAAI,MAAM,2CAA2C,CAAA;AAAA,IAC7D;AACA,IAAA,OAAO,UAAA,CAAW,IAAA;AAAA,EACpB;AACF;AEtQO,IAAM,mBAAA,GAAN,cAAkC,iBAAA,CAA4C;AAAA,EAC1E,IAAA,GAAe,cAAA;AAAA,EACf,MAAA,GAAS,QAAA;AAAA,EACT,YAAA,GAAqC;AAAA,IAC5C,IAAA,EAAM,KAAA;AAAA,IACN,MAAA,EAAQ,IAAA;AAAA,IACR,MAAA,EAAQ,KAAA;AAAA,IACR,KAAA,EAAO,KAAA;AAAA,IACP,QAAA,EAAU;AAAA,MACR,eAAA,EAAiB,IAAA;AAAA,MACjB,YAAA,EAAc;AAAA;AAChB,GACF;AAAA,EAEQ,MAAA;AAAA,EAER,YAAY,MAAA,EAA2B;AACrC,IAAA,KAAA,CAAM,EAAE,MAAA,EAAQ,MAAA,CAAO,KAAK,MAAA,EAAQ,GAAG,QAAQ,CAAA;AAE/C,IAAA,IAAA,CAAK,MAAA,GAAS,IAAIT,OAAAA,CAAO;AAAA,MACvB,MAAA,EAAQ,OAAO,IAAA,CAAK,MAAA;AAAA,MACpB,SAAS,MAAA,CAAO,OAAA;AAAA,MAChB,cAAc,MAAA,CAAO,YAAA;AAAA,MACrB,SAAS,MAAA,CAAO,OAAA;AAAA,MAChB,YAAY,MAAA,CAAO;AAAA,KACpB,CAAA;AAAA,EACH;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,cAAc,OAAA,EAAuD;AACzE,IAAA,OAAO,IAAA,CAAK,yBAAA;AAAA,MACV,YAAY;AACV,QAAA,IAAI;AACF,UAAA,IAAA,CAAK,kBAAkB,gBAAA,EAAkB;AAAA,YACvC,OAAO,OAAA,CAAQ,KAAA;AAAA,YACf,MAAM,OAAA,CAAQ,IAAA;AAAA,YACd,SAAS,OAAA,CAAQ,OAAA;AAAA,YACjB,GAAG,OAAA,CAAQ;AAAA,WACZ,CAAA;AAGD,UAAA,MAAM,UAAA,GAAa,QAAQ,KAAA,KAAU,aAAA;AAErC,UAAA,MAAM,MAAA,GAAc;AAAA,YAClB,OAAO,OAAA,CAAQ,KAAA;AAAA,YACf,QAAQ,OAAA,CAAQ,MAAA;AAAA,YAChB,MAAM,OAAA,CAAQ,IAAA;AAAA,YACd,SAAS,OAAA,CAAQ,OAAA;AAAA,YACjB,OAAO,OAAA,CAAQ,KAAA;AAAA,YACf,CAAA,EAAG,QAAQ,CAAA,IAAK;AAAA,WAClB;AAGA,UAAA,IAAI,CAAC,UAAA,EAAY;AACf,YAAA,MAAA,CAAO,eAAA,GAAkB,QAAQ,eAAA,IAAmB,UAAA;AAAA,UACtD;AAEA,UAAA,MAAM,WAAW,MAAM,IAAA,CAAK,MAAA,CAAO,MAAA,CAAO,SAAS,MAAM,CAAA;AAEzD,UAAA,MAAM,IAAA,GAAO,QAAA,CAAS,IAAA,IAAQ,EAAC;AAE/B,UAAA,IAAA,CAAK,qBAAqB,gBAAA,EAAkB;AAAA,YAC1C,OAAO,OAAA,CAAQ,KAAA;AAAA,YACf,iBAAiB,IAAA,CAAK;AAAA,WACvB,CAAA;AAED,UAAA,OAAO;AAAA,YACL,SAAS,QAAA,CAAS,OAAA;AAAA,YAClB,IAAA,EAAM,IAAA,CAAK,GAAA,CAAI,CAAC,GAAA,MAAS;AAAA,cACvB,KAAK,GAAA,CAAI,GAAA;AAAA,cACT,UAAU,GAAA,CAAI,QAAA;AAAA,cACd,gBAAgB,GAAA,CAAI;AAAA,aACtB,CAAE;AAAA,WACJ;AAAA,QACF,SAAS,KAAA,EAAY;AACnB,UAAA,IAAA,CAAK,YAAY,KAAK,CAAA;AACtB,UAAA,MAAM,KAAA;AAAA,QACR;AAAA,MACF,CAAA;AAAA,MACA,gBAAA;AAAA,MACA,EAAE,KAAA,EAAO,OAAA,CAAQ,KAAA;AAAM,KACzB;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,MAAM,UAAU,OAAA,EAAmD;AACjE,IAAA,OAAO,IAAA,CAAK,yBAAA;AAAA,MACV,YAAY;AACV,QAAA,IAAI;AACF,UAAA,IAAA,CAAK,kBAAkB,YAAA,EAAc;AAAA,YACnC,OAAO,OAAA,CAAQ,KAAA;AAAA,YACf,MAAM,OAAA,CAAQ,IAAA;AAAA,YACd,GAAG,OAAA,CAAQ;AAAA,WACZ,CAAA;AAGD,UAAA,MAAM,KAAA,GAAQ,IAAA,CAAK,iBAAA,CAAkB,OAAA,CAAQ,KAAK,CAAA;AAClD,UAAA,MAAM,OAAO,OAAA,CAAQ,IAAA,GAAO,KAAK,iBAAA,CAAkB,OAAA,CAAQ,IAAI,CAAA,GAAI,KAAA,CAAA;AAGnE,UAAA,MAAM,UAAA,GAAa,QAAQ,KAAA,KAAU,aAAA;AAErC,UAAA,MAAM,MAAA,GAAc;AAAA,YAClB,OAAO,OAAA,CAAQ,KAAA;AAAA,YACf,KAAA;AAAA,YACA,QAAQ,OAAA,CAAQ,MAAA;AAAA,YAChB,IAAA;AAAA,YACA,MAAM,OAAA,CAAQ,IAAA;AAAA,YACd,CAAA,EAAG,QAAQ,CAAA,IAAK;AAAA,WAClB;AAGA,UAAA,IAAI,CAAC,UAAA,EAAY;AACf,YAAA,MAAA,CAAO,eAAA,GAAkB,QAAQ,eAAA,IAAmB,UAAA;AAAA,UACtD;AAEA,UAAA,MAAM,WAAW,MAAM,IAAA,CAAK,MAAA,CAAO,MAAA,CAAO,KAAK,MAAM,CAAA;AAErD,UAAA,MAAM,IAAA,GAAO,QAAA,CAAS,IAAA,IAAQ,EAAC;AAE/B,UAAA,IAAA,CAAK,qBAAqB,YAAA,EAAc;AAAA,YACtC,OAAO,OAAA,CAAQ,KAAA;AAAA,YACf,iBAAiB,IAAA,CAAK;AAAA,WACvB,CAAA;AAED,UAAA,OAAO;AAAA,YACL,SAAS,QAAA,CAAS,OAAA;AAAA,YAClB,IAAA,EAAM,IAAA,CAAK,GAAA,CAAI,CAAC,GAAA,MAAS;AAAA,cACvB,KAAK,GAAA,CAAI,GAAA;AAAA,cACT,UAAU,GAAA,CAAI,QAAA;AAAA,cACd,gBAAgB,GAAA,CAAI;AAAA,aACtB,CAAE;AAAA,WACJ;AAAA,QACF,SAAS,KAAA,EAAY;AACnB,UAAA,IAAA,CAAK,YAAY,KAAK,CAAA;AACtB,UAAA,MAAM,KAAA;AAAA,QACR;AAAA,MACF,CAAA;AAAA,MACA,YAAA;AAAA,MACA,EAAE,KAAA,EAAO,OAAA,CAAQ,KAAA;AAAM,KACzB;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,MAAM,gBAAgB,OAAA,EAAwD;AAC5E,IAAA,OAAO,IAAA,CAAK,yBAAA;AAAA,MACV,YAAY;AACV,QAAA,IAAI;AACF,UAAA,IAAA,CAAK,kBAAkB,iBAAA,EAAmB;AAAA,YACxC,OAAO,OAAA,CAAQ,KAAA;AAAA,YACf,MAAM,OAAA,CAAQ,IAAA;AAAA,YACd,GAAG,OAAA,CAAQ;AAAA,WACZ,CAAA;AAGD,UAAA,MAAM,KAAA,GAAQ,IAAA,CAAK,iBAAA,CAAkB,OAAA,CAAQ,KAAK,CAAA;AAElD,UAAA,MAAM,QAAA,GAAW,MAAM,IAAA,CAAK,MAAA,CAAO,OAAO,eAAA,CAAgB;AAAA,YACxD,OAAO,OAAA,CAAQ,KAAA;AAAA,YACf,KAAA;AAAA,YACA,MAAM,OAAA,CAAQ,IAAA;AAAA,YACd,CAAA,EAAG,QAAQ,CAAA,IAAK,CAAA;AAAA,YAChB,eAAA,EAAiB,QAAQ,eAAA,IAAmB;AAAA,WAC7C,CAAA;AAED,UAAA,MAAM,IAAA,GAAO,QAAA,CAAS,IAAA,IAAQ,EAAC;AAE/B,UAAA,IAAA,CAAK,qBAAqB,iBAAA,EAAmB;AAAA,YAC3C,OAAO,OAAA,CAAQ,KAAA;AAAA,YACf,iBAAiB,IAAA,CAAK;AAAA,WACvB,CAAA;AAED,UAAA,OAAO;AAAA,YACL,SAAS,QAAA,CAAS,OAAA;AAAA,YAClB,IAAA,EAAM,IAAA,CAAK,GAAA,CAAI,CAAC,GAAA,MAAS;AAAA,cACvB,KAAK,GAAA,CAAI,GAAA;AAAA,cACT,UAAU,GAAA,CAAI,QAAA;AAAA,cACd,gBAAgB,GAAA,CAAI;AAAA,aACtB,CAAE;AAAA,WACJ;AAAA,QACF,SAAS,KAAA,EAAY;AACnB,UAAA,IAAA,CAAK,YAAY,KAAK,CAAA;AACtB,UAAA,MAAM,KAAA;AAAA,QACR;AAAA,MACF,CAAA;AAAA,MACA,iBAAA;AAAA,MACA,EAAE,KAAA,EAAO,OAAA,CAAQ,KAAA;AAAM,KACzB;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,UAAA,GAAgC;AACpC,IAAA,OAAO,CAAC,aAAA,EAAe,UAAA,EAAY,UAAU,CAAA;AAAA,EAC/C;AAAA;AAAA;AAAA;AAAA,EAKQ,kBAAkB,KAAA,EAA6B;AACrD,IAAA,IAAI,MAAA,CAAO,QAAA,CAAS,KAAK,CAAA,EAAG;AAE1B,MAAA,OAAO,IAAI,KAAK,CAAC,KAAK,GAAG,WAAA,EAAa,EAAE,IAAA,EAAM,WAAA,EAAa,CAAA;AAAA,IAC7D;AAGA,IAAA,OAAUU,sBAAiB,KAAK,CAAA;AAAA,EAClC;AAAA;AAAA;AAAA;AAAA,EAKQ,YAAY,KAAA,EAAmB;AACrC,IAAA,MAAM,OAAA,GAAU,MAAM,OAAA,IAAW,0BAAA;AACjC,IAAA,MAAM,SAAS,KAAA,CAAM,MAAA;AAErB,IAAA,IAAI,WAAW,GAAA,EAAK;AAClB,MAAA,MAAM,IAAI,iBAAA,CAAkB,QAAA,EAAU,iBAAiB,CAAA;AAAA,IACzD;AAEA,IAAA,IAAI,WAAW,GAAA,EAAK;AAClB,MAAA,MAAM,IAAI,sBAAA,CAAuB,QAAA,EAAU,OAAO,CAAA;AAAA,IACpD;AAEA,IAAA,IAAI,WAAW,GAAA,EAAK;AAElB,MAAA,IAAI,OAAA,CAAQ,QAAA,CAAS,eAAe,CAAA,EAAG;AACrC,QAAA,MAAM,IAAI,aAAA,CAAc,QAAA,EAAU,CAAA,0BAAA,EAA6B,OAAO,CAAA,CAAE,CAAA;AAAA,MAC1E;AACA,MAAA,MAAM,IAAI,aAAA,CAAc,QAAA,EAAU,CAAA,aAAA,EAAgB,OAAO,CAAA,CAAE,CAAA;AAAA,IAC7D;AAEA,IAAA,MAAM,IAAI,aAAA,CAAc,QAAA,EAAU,OAAO,CAAA;AAAA,EAC3C;AACF,CAAA;ACrOO,IAAM,mBAAA,GAAN,cAAkC,iBAAA,CAA4C;AAAA,EAC1E,IAAA,GAAe,cAAA;AAAA,EACf,MAAA,GAAS,QAAA;AAAA,EACT,YAAA,GAAqC;AAAA,IAC5C,IAAA,EAAM,KAAA;AAAA,IACN,MAAA,EAAQ,IAAA;AAAA,IACR,MAAA,EAAQ,KAAA;AAAA,IACR,KAAA,EAAO,KAAA;AAAA,IACP,QAAA,EAAU;AAAA,MACR,eAAA,EAAiB,IAAA;AAAA,MACjB,YAAA,EAAc;AAAA;AAChB,GACF;AAAA,EAEQ,MAAA;AAAA,EAER,YAAY,MAAA,EAAsB;AAChC,IAAA,KAAA,CAAM,MAAM,CAAA;AAEZ,IAAA,IAAA,CAAK,MAAA,GAAS,IAAIR,WAAAA,CAAY;AAAA,MAC5B,QAAQ,MAAA,CAAO;AAAA,KAChB,CAAA;AAAA,EACH;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,cAAc,OAAA,EAAuD;AACzE,IAAA,OAAO,IAAA,CAAK,yBAAA;AAAA,MACV,YAAY;AACV,QAAA,IAAI;AACF,UAAA,IAAA,CAAK,kBAAkB,gBAAA,EAAkB;AAAA,YACvC,OAAO,OAAA,CAAQ,KAAA;AAAA,YACf,GAAG,OAAA,CAAQ;AAAA,WACZ,CAAA;AAED,UAAA,MAAM,aAAA,GAAgB,OAAA;AAEtB,UAAA,MAAM,QAAA,GAAW,MAAM,IAAA,CAAK,MAAA,CAAO,OAAO,cAAA,CAAe;AAAA,YACvD,OAAO,OAAA,CAAQ,KAAA;AAAA,YACf,QAAQ,OAAA,CAAQ,MAAA;AAAA,YAChB,MAAA,EAAQ;AAAA,cACN,cAAA,EAAgB,QAAQ,CAAA,IAAK,CAAA;AAAA,cAC7B,gBAAgB,aAAA,CAAc,cAAA;AAAA,cAC9B,aAAa,aAAA,CAAc,WAAA;AAAA,cAC3B,MAAM,aAAA,CAAc,IAAA;AAAA,cACpB,gBAAgB,aAAA,CAAc,cAAA;AAAA,cAC9B,kBAAkB,aAAA,CAAc;AAAA;AAClC,WACD,CAAA;AAED,UAAA,MAAM,MAAA,GAAS,QAAA,CAAS,eAAA,IAAmB,EAAC;AAE5C,UAAA,IAAA,CAAK,qBAAqB,gBAAA,EAAkB;AAAA,YAC1C,OAAO,OAAA,CAAQ,KAAA;AAAA,YACf,iBAAiB,MAAA,CAAO;AAAA,WACzB,CAAA;AAED,UAAA,OAAO;AAAA,YACL,SAAS,IAAA,CAAK,KAAA,CAAM,IAAA,CAAK,GAAA,KAAQ,GAAI,CAAA;AAAA,YACrC,IAAA,EAAM,MAAA,CAAO,GAAA,CAAI,CAAC,GAAA,MAAc;AAAA,cAC9B,QAAA,EAAU,IAAI,KAAA,EAAO;AAAA;AAAA,aAEvB,CAAE;AAAA,WACJ;AAAA,QACF,SAAS,KAAA,EAAY;AACnB,UAAA,IAAA,CAAK,YAAY,KAAK,CAAA;AACtB,UAAA,MAAM,KAAA;AAAA,QACR;AAAA,MACF,CAAA;AAAA,MACA,gBAAA;AAAA,MACA,EAAE,KAAA,EAAO,OAAA,CAAQ,KAAA;AAAM,KACzB;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,MAAM,UAAU,OAAA,EAAmD;AACjE,IAAA,OAAO,IAAA,CAAK,yBAAA;AAAA,MACV,YAAY;AACV,QAAA,IAAI;AACF,UAAA,IAAA,CAAK,kBAAkB,YAAA,EAAc;AAAA,YACnC,OAAO,OAAA,CAAQ,KAAA;AAAA,YACf,GAAG,OAAA,CAAQ;AAAA,WACZ,CAAA;AAGD,UAAA,MAAM,cAAA,GAAiB,MAAM,IAAA,CAAK,qBAAA,CAAsB,QAAQ,KAAK,CAAA;AAErE,UAAA,MAAM,QAAA,GAAW,MAAM,IAAA,CAAK,MAAA,CAAO,OAAO,SAAA,CAAU;AAAA,YAClD,KAAA,EAAO,QAAQ,KAAA,IAAS,2BAAA;AAAA,YACxB,QAAQ,OAAA,CAAQ,MAAA;AAAA,YAChB,eAAA,EAAiB,CAAC,cAAc,CAAA;AAAA,YAChC,MAAA,EAAQ;AAAA,cACN,cAAA,EAAgB,QAAQ,CAAA,IAAK;AAAA;AAC/B,WACD,CAAA;AAED,UAAA,MAAM,MAAA,GAAS,QAAA,CAAS,eAAA,IAAmB,EAAC;AAE5C,UAAA,IAAA,CAAK,qBAAqB,YAAA,EAAc;AAAA,YACtC,OAAO,OAAA,CAAQ,KAAA;AAAA,YACf,iBAAiB,MAAA,CAAO;AAAA,WACzB,CAAA;AAED,UAAA,OAAO;AAAA,YACL,SAAS,IAAA,CAAK,KAAA,CAAM,IAAA,CAAK,GAAA,KAAQ,GAAI,CAAA;AAAA,YACrC,IAAA,EAAM,MAAA,CAAO,GAAA,CAAI,CAAC,GAAA,MAAc;AAAA,cAC9B,QAAA,EAAU,IAAI,KAAA,EAAO;AAAA,aACvB,CAAE;AAAA,WACJ;AAAA,QACF,SAAS,KAAA,EAAY;AACnB,UAAA,IAAA,CAAK,YAAY,KAAK,CAAA;AACtB,UAAA,MAAM,KAAA;AAAA,QACR;AAAA,MACF,CAAA;AAAA,MACA,YAAA;AAAA,MACA,EAAE,KAAA,EAAO,OAAA,CAAQ,KAAA;AAAM,KACzB;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,UAAA,GAAgC;AACpC,IAAA,OAAO;AAAA,MACL,yBAAA;AAAA,MACA,+BAAA;AAAA,MACA;AAAA,KACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,sBAAsB,KAAA,EAAsC;AACxE,IAAA,IAAI,UAAA;AAEJ,IAAA,IAAI,MAAA,CAAO,QAAA,CAAS,KAAK,CAAA,EAAG;AAC1B,MAAA,UAAA,GAAa,KAAA,CAAM,SAAS,QAAQ,CAAA;AAAA,IACtC,CAAA,MAAO;AAEL,MAAA,MAAM7B,IAAAA,GAAK,MAAM,OAAO,IAAI,CAAA;AAC5B,MAAA,MAAM,MAAA,GAASA,IAAAA,CAAG,YAAA,CAAa,KAAK,CAAA;AACpC,MAAA,UAAA,GAAa,MAAA,CAAO,SAAS,QAAQ,CAAA;AAAA,IACvC;AAGA,IAAA,OAAO;AAAA,MACL,cAAA,EAAgB;AAAA,QACd,KAAA,EAAO;AAAA,UACL;AAAA;AACF,OACF;AAAA,MACA,aAAA,EAAe;AAAA,KACjB;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,YAAY,KAAA,EAAmB;AACrC,IAAA,MAAM,OAAA,GAAU,MAAM,OAAA,IAAW,0BAAA;AACjC,IAAA,MAAM,MAAA,GAAS,KAAA,CAAM,MAAA,IAAU,KAAA,CAAM,IAAA;AAErC,IAAA,IAAI,MAAA,KAAW,GAAA,IAAO,OAAA,CAAQ,QAAA,CAAS,mBAAmB,CAAA,EAAG;AAC3D,MAAA,MAAM,IAAI,iBAAA,CAAkB,QAAA,EAAU,iBAAiB,CAAA;AAAA,IACzD;AAEA,IAAA,IAAI,MAAA,KAAW,GAAA,IAAO,OAAA,CAAQ,QAAA,CAAS,oBAAoB,CAAA,EAAG;AAC5D,MAAA,MAAM,IAAI,sBAAA,CAAuB,QAAA,EAAU,OAAO,CAAA;AAAA,IACpD;AAEA,IAAA,IAAI,WAAW,GAAA,EAAK;AAElB,MAAA,IACE,OAAA,CAAQ,QAAA,CAAS,QAAQ,CAAA,IACzB,OAAA,CAAQ,QAAA,CAAS,SAAS,CAAA,IAC1B,OAAA,CAAQ,QAAA,CAAS,gBAAgB,CAAA,EACjC;AACA,QAAA,MAAM,IAAI,aAAA,CAAc,QAAA,EAAU,CAAA,0BAAA,EAA6B,OAAO,CAAA,CAAE,CAAA;AAAA,MAC1E;AACA,MAAA,MAAM,IAAI,aAAA,CAAc,QAAA,EAAU,CAAA,aAAA,EAAgB,OAAO,CAAA,CAAE,CAAA;AAAA,IAC7D;AAEA,IAAA,MAAM,IAAI,aAAA,CAAc,QAAA,EAAU,OAAO,CAAA;AAAA,EAC3C;AACF,CAAA;;;ACpNO,SAAS,oBAAoB,SAAA,EAAsC;AACxE,EAAA,MAAM,SAAS,SAAA,CAAU,MAAA;AAEzB,EAAA,QAAQ,MAAA;AAAQ,IACd,KAAK,MAAA,CAAO,MAAA;AACV,MAAA,OAAO,IAAI,mBAAA,CAAoBsC,oBAAAA,CAAoB,SAAS,CAAC,CAAA;AAAA,IAE/D,KAAK,MAAA,CAAO,MAAA;AACV,MAAA,OAAO,IAAI,mBAAA,CAAoBC,oBAAAA,CAAoB,SAAS,CAAC,CAAA;AAAA,IAE/D;AACE,MAAA,MAAM,IAAI,KAAA;AAAA,QACR,2CAA2C,MAAM,CAAA,qBAAA,EAC3B,OAAO,MAAM,CAAA,EAAA,EAAK,OAAO,MAAM,CAAA;AAAA,OACvD;AAAA;AAEN;AAKA,SAASD,qBAAoB,SAAA,EAAyC;AACpE,EAAA,MAAM,IAAA,GAAO,UAAU,MAAA,CAAO,IAAA;AAE9B,EAAA,IAAI,IAAA,CAAK,SAAS,SAAA,EAAW;AAC3B,IAAA,MAAM,IAAI,MAAM,wCAAwC,CAAA;AAAA,EAC1D;AAEA,EAAA,MAAM,OAAA,GAAU,UAAU,UAAA,EAAW;AAErC,EAAA,OAAO;AAAA,IACL,IAAA,EAAM;AAAA,MACJ,IAAA,EAAM,SAAA;AAAA,MACN,QAAQ,IAAA,CAAK;AAAA,KACf;AAAA,IACA,SAAS,SAAA,CAAU,OAAA;AAAA,IACnB,cAAc,OAAA,CAAQ,YAAA;AAAA,IACtB,SAAS,OAAA,CAAQ,OAAA;AAAA,IACjB,YAAY,OAAA,CAAQ;AAAA,GACtB;AACF;AAKA,SAASC,qBAAoB,SAAA,EAAoC;AAC/D,EAAA,MAAM,IAAA,GAAO,UAAU,MAAA,CAAO,IAAA;AAE9B,EAAA,IAAI,IAAA,CAAK,SAAS,SAAA,EAAW;AAC3B,IAAA,MAAM,IAAI,MAAM,wCAAwC,CAAA;AAAA,EAC1D;AAEA,EAAA,OAAO;AAAA,IACL,QAAQ,IAAA,CAAK;AAAA,GACf;AACF;;;AC7DA,WAAA,EAAA;AACA,YAAA,EAAA;AAiEA,IAAM,0BAAA,GAA6B;AAAA,EACjC,YAAA;AAAA,EACA,cAAA;AAAA,EACA,WAAA;AAAA,EACA,WAAA;AAAA,EACA,WAAA;AAAA,EACA,YAAA;AAAA,EACA,YAAA;AAAA,EACA,KAAA;AAAA,EACA,KAAA;AAAA,EACA,KAAA;AAAA,EACA,KAAA;AAAA,EACA,KAAA;AAAA,EACA,SAAA;AAAA,EACA;AACF,CAAA;AAgCO,IAAM,YAAA,GAAN,cAA2BpB,YAAAA,CAAiC;AAAA,EACzD,MAAA;AAAA,EACA,MAAA;AAAA,EAER,WAAA,CAAY,MAAA,GAA6B,EAAC,EAAG;AAC3C,IAAA,KAAA,EAAM;AAEN,IAAA,MAAM,YAAA,GAAe,OAAA,CAAQ,GAAA,CAAI,QAAA,KAAa,YAAA;AAE9C,IAAA,IAAA,CAAK,MAAA,GAAS;AAAA,MACZ,SAAA,EAAW,OAAO,SAAA,IAAa,IAAA;AAAA,MAC/B,iBAAA,EAAmB,MAAA,CAAO,iBAAA,IAAqB,CAAC,YAAA;AAAA,MAChD,cAAA,EAAgB,MAAA,CAAO,cAAA,KAAmB,CAAC,CAAA,KAAM,CAAA,CAAA;AAAA,MACjD,iBAAA,EAAmB,OAAO,iBAAA,IAAqB,0BAAA;AAAA,MAC/C,UAAA,EAAY,OAAO,UAAA,IAAc,CAAA;AAAA,MACjC,gBAAA,EAAkB,OAAO,gBAAA,IAAoB,GAAA;AAAA,MAC7C,eAAA,EAAiB,OAAO,eAAA,IAAmB;AAAA,KAC7C;AAEA,IAAA,IAAA,CAAK,SAAS,MAAA,CAAO,KAAA,CAAM,EAAE,SAAA,EAAW,gBAAgB,CAAA;AAAA,EAC1D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,MAAA,CAAO,OAAc,OAAA,EAA6B;AAChD,IAAA,MAAM,WAAA,GAAc,IAAA,CAAK,MAAA,CAAO,cAAA,CAAe,OAAO,OAAO,CAAA;AAC7D,IAAA,MAAM,WAAA,GAAc,IAAA,CAAK,aAAA,CAAc,WAAW,CAAA;AAGlD,IAAA,IAAI,IAAA,CAAK,OAAO,SAAA,EAAW;AACzB,MAAA,IAAA,CAAK,QAAA,CAAS,WAAA,EAAa,OAAA,EAAS,WAAW,CAAA;AAAA,IACjD;AAGA,IAAA,IAAA,CAAK,aAAA,CAAc,WAAA,EAAa,OAAA,EAAS,WAAW,CAAA;AAGpD,IAAA,IAAA,CAAK,KAAK,OAAA,EAAS,EAAE,OAAO,WAAA,EAAa,OAAA,EAAS,aAAa,CAAA;AAE/D,IAAA,IAAI,CAAC,WAAA,EAAa;AAChB,MAAA,IAAA,CAAK,KAAK,aAAA,EAAe,EAAE,KAAA,EAAO,WAAA,EAAa,SAAS,CAAA;AAAA,IAC1D;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUA,MAAM,gBAAA,CACJ,EAAA,EACA,OAAA,EACY;AACZ,IAAA,IAAI,SAAA;AAEJ,IAAA,KAAA,IAAS,UAAU,CAAA,EAAG,OAAA,IAAW,IAAA,CAAK,MAAA,CAAO,YAAY,OAAA,EAAA,EAAW;AAClE,MAAA,IAAI;AACF,QAAA,OAAO,MAAM,EAAA,EAAG;AAAA,MAClB,SAAS,KAAA,EAAO;AACd,QAAA,SAAA,GAAY,KAAA;AAGZ,QAAA,MAAM,aAAA,GAAgB,OAAA,KAAY,IAAA,CAAK,MAAA,CAAO,UAAA;AAC9C,QAAA,MAAM,WAAA,GAAc,CAAC,aAAA,IAAiB,IAAA,CAAK,YAAY,SAAS,CAAA;AAEhE,QAAA,IAAI,CAAC,WAAA,EAAa;AAChB,UAAA,IAAA,CAAK,MAAA,CAAO,WAAW,OAAO,CAAA;AAC9B,UAAA,MAAM,SAAA;AAAA,QACR;AAGA,QAAA,MAAM,KAAA,GAAQ,IAAA,CAAK,mBAAA,CAAoB,OAAO,CAAA;AAG9C,QAAA,IAAA,CAAK,KAAK,gBAAA,EAAkB;AAAA,UAC1B,KAAA,EAAO,SAAA;AAAA,UACP,OAAA;AAAA,UACA,OAAA;AAAA,UACA,OAAA,EAAS;AAAA,SACV,CAAA;AAGD,QAAA,IAAI,IAAA,CAAK,OAAO,SAAA,EAAW;AACzB,UAAA,IAAA,CAAK,MAAA,CAAO,IAAA;AAAA,YACV;AAAA,cACE,OAAO,SAAA,CAAU,OAAA;AAAA,cACjB,OAAA;AAAA,cACA,WAAA,EAAa,KAAK,MAAA,CAAO,UAAA;AAAA,cACzB,OAAA,EAAS,KAAA;AAAA,cACT,GAAG,IAAA,CAAK,kBAAA,CAAmB,OAAO;AAAA,aACpC;AAAA,YACA,CAAA,8BAAA,EAAiC,OAAO,CAAA,CAAA,EAAI,IAAA,CAAK,OAAO,UAAU,CAAA,CAAA;AAAA,WACpE;AAAA,QACF;AAGA,QAAA,MAAM,IAAA,CAAK,MAAM,KAAK,CAAA;AAAA,MACxB;AAAA,IACF;AAGA,IAAA,MAAM,SAAA;AAAA,EACR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUA,IAAA,CACE,IACA,cAAA,EACsC;AACtC,IAAA,OAAO,UAAU,IAAA,KAAkC;AACjD,MAAA,IAAI;AACF,QAAA,OAAO,MAAM,EAAA,CAAG,GAAG,IAAI,CAAA;AAAA,MACzB,SAAS,KAAA,EAAO;AACd,QAAA,IAAA,CAAK,MAAA,CAAO,KAAA,EAAgB,cAAA,CAAe,GAAG,IAAI,CAAC,CAAA;AACnD,QAAA,MAAM,KAAA;AAAA,MACR;AAAA,IACF,CAAA;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,cAAc,KAAA,EAAuB;AAEnC,IAAA,IAAI,IAAA,CAAK,WAAA,CAAY,KAAK,CAAA,EAAG;AAC3B,MAAA,OAAO,IAAA;AAAA,IACT;AAGA,IAAA,MAAM,gBAAA,GAAmB;AAAA,MACvB,gBAAA;AAAA,MACA,cAAA;AAAA,MACA,cAAA;AAAA,MACA;AAAA,KACF;AAEA,IAAA,OAAO,gBAAA,CAAiB,IAAA;AAAA,MACtB,CAAC,IAAA,KAAS,KAAA,CAAM,SAAS,IAAA,IAAQ,KAAA,CAAM,YAAY,IAAA,KAAS;AAAA,KAC9D;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,YAAY,KAAA,EAAuB;AACjC,IAAA,MAAM,cAAc,CAAA,EAAG,KAAA,CAAM,IAAI,CAAA,CAAA,EAAI,MAAM,OAAO,CAAA,CAAA;AAClD,IAAA,OAAO,IAAA,CAAK,OAAO,iBAAA,CAAkB,IAAA;AAAA,MAAK,CAAC,OAAA,KACzC,WAAA,CAAY,QAAA,CAAS,OAAO;AAAA,KAC9B;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,oBAAoB,OAAA,EAAuB;AACzC,IAAA,IAAI,CAAC,IAAA,CAAK,MAAA,CAAO,iBAAA,CAAkB,QAAA,CAAS,OAAO,CAAA,EAAG;AACpD,MAAA,IAAA,CAAK,MAAA,CAAO,iBAAA,CAAkB,IAAA,CAAK,OAAO,CAAA;AAAA,IAC5C;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,uBAAuB,OAAA,EAAuB;AAC5C,IAAA,MAAM,KAAA,GAAQ,IAAA,CAAK,MAAA,CAAO,iBAAA,CAAkB,QAAQ,OAAO,CAAA;AAC3D,IAAA,IAAI,UAAU,EAAA,EAAI;AAChB,MAAA,IAAA,CAAK,MAAA,CAAO,iBAAA,CAAkB,MAAA,CAAO,KAAA,EAAO,CAAC,CAAA;AAAA,IAC/C;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,SAAA,GAAoD;AAClD,IAAA,OAAO,EAAE,GAAG,IAAA,CAAK,MAAA,EAAO;AAAA,EAC1B;AAAA;AAAA,EAIQ,QAAA,CAAS,KAAA,EAAc,OAAA,EAAuB,WAAA,EAA4B;AAChF,IAAA,MAAM,KAAA,GAAQ,cAAc,MAAA,GAAS,OAAA;AACrC,IAAA,MAAM,OAAA,GAAU;AAAA,MACd,OAAO,KAAA,CAAM,OAAA;AAAA,MACb,WAAW,KAAA,CAAM,IAAA;AAAA,MACjB,WAAA;AAAA,MACA,GAAG,IAAA,CAAK,kBAAA,CAAmB,OAAO;AAAA,KACpC;AAEA,IAAA,IAAI,IAAA,CAAK,MAAA,CAAO,iBAAA,IAAqB,KAAA,CAAM,KAAA,EAAO;AAChD,MAAC,OAAA,CAAgB,QAAQ,KAAA,CAAM,KAAA;AAAA,IACjC;AAEA,IAAA,IAAA,CAAK,OAAO,KAAK,CAAA,CAAE,SAAS,CAAA,SAAA,EAAY,OAAA,CAAQ,SAAS,CAAA,CAAE,CAAA;AAAA,EAC7D;AAAA,EAEQ,mBAAmB,OAAA,EAAgD;AACzE,IAAA,OAAO;AAAA,MACL,WAAW,OAAA,CAAQ,SAAA;AAAA,MACnB,SAAS,OAAA,CAAQ,OAAA;AAAA,MACjB,WAAW,OAAA,CAAQ,SAAA;AAAA,MACnB,GAAI,OAAA,CAAQ,QAAA,IAAY;AAAC,KAC3B;AAAA,EACF;AAAA,EAEQ,aAAA,CAAc,KAAA,EAAc,OAAA,EAAuB,WAAA,EAA4B;AACrF,IAAA,OAAA,CAAQ,SAAA,CAAU,iBAAiB,CAAA,EAAG;AAAA,MACpC,WAAW,OAAA,CAAQ,SAAA;AAAA,MACnB,WAAW,OAAA,CAAQ,SAAA;AAAA,MACnB,WAAW,KAAA,CAAM,IAAA;AAAA,MACjB,WAAA,EAAa,OAAO,WAAW;AAAA,KAChC,CAAA;AAAA,EACH;AAAA,EAEQ,oBAAoB,OAAA,EAAyB;AAEnD,IAAA,MAAM,gBAAA,GAAmB,KAAK,MAAA,CAAO,gBAAA,GAAmB,KAAK,GAAA,CAAI,CAAA,EAAG,UAAU,CAAC,CAAA;AAG/E,IAAA,MAAM,MAAA,GAAS,gBAAA,IAAoB,GAAA,GAAM,IAAA,CAAK,QAAO,GAAI,GAAA,CAAA;AAGzD,IAAA,OAAO,IAAA,CAAK,GAAA,CAAI,MAAA,EAAQ,IAAA,CAAK,OAAO,eAAe,CAAA;AAAA,EACrD;AAAA,EAEQ,MAAM,EAAA,EAA2B;AACvC,IAAA,OAAO,IAAI,OAAA,CAAQ,CAAClB,aAAY,UAAA,CAAWA,QAAAA,EAAS,EAAE,CAAC,CAAA;AAAA,EACzD;AACF;AAMO,IAAM,kBAAA,GAAqB,IAAI,YAAA;;;ACpVtC,cAAA,EAAA;;;ACwEO,IAAM,YAAA,GAAe;AAAA,EAC1B,CAAC,MAAA,CAAO,MAAM,GAAG;AAAA;AAAA,IAEf,WAAA,EAAa,aAAA;AAAA;AAAA,IAEb,QAAA,EAAU,UAAA;AAAA;AAAA,IAEV,QAAA,EAAU;AAAA,GACZ;AAAA,EACA,CAAC,MAAA,CAAO,MAAM,GAAG;AAAA;AAAA,IAEf,iBAAA,EAAmB,yBAAA;AAAA;AAAA,IAEnB,cAAA,EAAgB,+BAAA;AAAA;AAAA,IAEhB,aAAA,EAAe;AAAA;AAEnB;AAUO,IAAM,oBAAA,GAA+D;AAAA;AAAA,EAG1E,aAAA,EAAe;AAAA,IACb,IAAA,EAAM,aAAA;AAAA,IACN,WAAA,EAAa,aAAA;AAAA,IACb,UAAU,MAAA,CAAO,MAAA;AAAA,IACjB,WAAA,EAAa,qEAAA;AAAA,IACb,QAAA,EAAU,IAAA;AAAA,IACV,WAAA,EAAa,YAAA;AAAA,IACb,OAAA,EAAS;AAAA,MACP,aAAA,EAAe,gDAAA;AAAA,MACf,OAAA,EAAS,4BAAA;AAAA,MACT,YAAA,EAAc;AAAA,KAChB;AAAA,IACA,YAAA,EAAc;AAAA,MACZ,KAAA,EAAO,CAAC,WAAA,EAAa,WAAA,EAAa,aAAa,MAAM,CAAA;AAAA,MACrD,mBAAA,EAAqB,CAAA;AAAA,MACrB,aAAA,EAAe,CAAC,KAAA,EAAO,MAAA,EAAQ,MAAM,CAAA;AAAA,MACrC,QAAA,EAAU;AAAA,QACR,UAAA,EAAY,IAAA;AAAA,QACZ,OAAA,EAAS,IAAA;AAAA,QACT,UAAA,EAAY,KAAA;AAAA,QACZ,YAAA,EAAc,KAAA;AAAA,QACd,cAAA,EAAgB,IAAA;AAAA,QAChB,YAAA,EAAc,IAAA;AAAA,QACd,cAAA,EAAgB;AAAA,OAClB;AAAA,MACA,MAAA,EAAQ,EAAE,eAAA,EAAiB,IAAA,EAAM;AAAA,MACjC,aAAA,EAAe;AAAA,QACb,UAAA,EAAY;AAAA,UACV,IAAA,EAAM,QAAA;AAAA,UACN,WAAA,EAAa;AAAA,SACf;AAAA,QACA,aAAA,EAAe;AAAA,UACb,IAAA,EAAM,QAAA;AAAA,UACN,WAAA,EAAa;AAAA;AACf;AACF,KACF;AAAA,IACA,OAAA,EAAS;AAAA,MACP,gBAAA,EAAkB,KAAA;AAAA,MAClB,UAAA,EAAY,KAAA;AAAA,MACZ,QAAA,EAAU;AAAA;AACZ,GACF;AAAA,EAEA,UAAA,EAAY;AAAA,IACV,IAAA,EAAM,UAAA;AAAA,IACN,WAAA,EAAa,UAAA;AAAA,IACb,UAAU,MAAA,CAAO,MAAA;AAAA,IACjB,WAAA,EAAa,oDAAA;AAAA,IACb,QAAA,EAAU,IAAA;AAAA,IACV,WAAA,EAAa,YAAA;AAAA,IACb,OAAA,EAAS;AAAA,MACP,aAAA,EAAe,gDAAA;AAAA,MACf,OAAA,EAAS,4BAAA;AAAA,MACT,YAAA,EAAc;AAAA,KAChB;AAAA,IACA,YAAA,EAAc;AAAA,MACZ,KAAA,EAAO,CAAC,WAAA,EAAa,WAAA,EAAa,WAAW,CAAA;AAAA,MAC7C,mBAAA,EAAqB,CAAA;AAAA,MACrB,aAAA,EAAe,CAAC,KAAA,EAAO,KAAK,CAAA;AAAA,MAC5B,QAAA,EAAU;AAAA,QACR,UAAA,EAAY,IAAA;AAAA,QACZ,OAAA,EAAS,KAAA;AAAA,QACT,UAAA,EAAY,KAAA;AAAA,QACZ,YAAA,EAAc,IAAA;AAAA,QACd,cAAA,EAAgB,IAAA;AAAA,QAChB,YAAA,EAAc,KAAA;AAAA,QACd,cAAA,EAAgB;AAAA,OAClB;AAAA,MACA,MAAA,EAAQ,EAAE,eAAA,EAAiB,GAAA,EAAK;AAAA,MAChC,aAAA,EAAe;AAAA,QACb,KAAA,EAAO;AAAA,UACL,IAAA,EAAM,QAAA;AAAA,UACN,WAAA,EAAa;AAAA;AACf;AACF,KACF;AAAA,IACA,OAAA,EAAS;AAAA,MACP,gBAAA,EAAkB,IAAA;AAAA,MAClB,UAAA,EAAY,IAAA;AAAA,MACZ,QAAA,EAAU;AAAA;AACZ,GACF;AAAA,EAEA,UAAA,EAAY;AAAA,IACV,IAAA,EAAM,UAAA;AAAA,IACN,WAAA,EAAa,UAAA;AAAA,IACb,UAAU,MAAA,CAAO,MAAA;AAAA,IACjB,WAAA,EAAa,0DAAA;AAAA,IACb,QAAA,EAAU,IAAA;AAAA,IACV,WAAA,EAAa,YAAA;AAAA,IACb,OAAA,EAAS;AAAA,MACP,aAAA,EAAe,gDAAA;AAAA,MACf,OAAA,EAAS,4BAAA;AAAA,MACT,YAAA,EAAc;AAAA,KAChB;AAAA,IACA,YAAA,EAAc;AAAA,MACZ,KAAA,EAAO,CAAC,SAAA,EAAW,SAAA,EAAW,WAAW,CAAA;AAAA,MACzC,mBAAA,EAAqB,EAAA;AAAA,MACrB,aAAA,EAAe,CAAC,KAAA,EAAO,KAAK,CAAA;AAAA,MAC5B,QAAA,EAAU;AAAA,QACR,UAAA,EAAY,IAAA;AAAA,QACZ,OAAA,EAAS,IAAA;AAAA,QACT,UAAA,EAAY,IAAA;AAAA,QACZ,YAAA,EAAc,KAAA;AAAA,QACd,cAAA,EAAgB,KAAA;AAAA,QAChB,YAAA,EAAc,KAAA;AAAA,QACd,cAAA,EAAgB;AAAA,OAClB;AAAA,MACA,MAAA,EAAQ,EAAE,eAAA,EAAiB,GAAA;AAAK,KAClC;AAAA,IACA,OAAA,EAAS;AAAA,MACP,QAAA,EAAU,IAAA;AAAA,MACV,QAAA,EAAU;AAAA;AACZ,GACF;AAAA;AAAA,EAIA,yBAAA,EAA2B;AAAA,IACzB,IAAA,EAAM,yBAAA;AAAA,IACN,WAAA,EAAa,qBAAA;AAAA,IACb,UAAU,MAAA,CAAO,MAAA;AAAA,IACjB,WAAA,EAAa,uDAAA;AAAA,IACb,QAAA,EAAU,IAAA;AAAA,IACV,WAAA,EAAa,YAAA;AAAA,IACb,OAAA,EAAS;AAAA,MACP,aAAA,EAAe,8CAAA;AAAA,MACf,OAAA,EAAS,+BAAA;AAAA,MACT,YAAA,EAAc;AAAA,KAChB;AAAA,IACA,YAAA,EAAc;AAAA,MACZ,KAAA,EAAO,CAAC,WAAW,CAAA;AAAA,MACnB,cAAc,CAAC,KAAA,EAAO,KAAA,EAAO,KAAA,EAAO,QAAQ,MAAM,CAAA;AAAA,MAClD,mBAAA,EAAqB,CAAA;AAAA,MACrB,aAAA,EAAe,CAAC,KAAA,EAAO,MAAM,CAAA;AAAA,MAC7B,QAAA,EAAU;AAAA,QACR,UAAA,EAAY,IAAA;AAAA,QACZ,OAAA,EAAS,KAAA;AAAA,QACT,UAAA,EAAY,KAAA;AAAA,QACZ,YAAA,EAAc,KAAA;AAAA,QACd,cAAA,EAAgB,KAAA;AAAA,QAChB,YAAA,EAAc,KAAA;AAAA,QACd,cAAA,EAAgB;AAAA,OAClB;AAAA,MACA,MAAA,EAAQ,EAAE,eAAA,EAAiB,GAAA,EAAI;AAAA,MAC/B,aAAA,EAAe;AAAA,QACb,cAAA,EAAgB;AAAA,UACd,IAAA,EAAM,QAAA;AAAA,UACN,WAAA,EAAa;AAAA,SACf;AAAA,QACA,IAAA,EAAM;AAAA,UACJ,IAAA,EAAM,QAAA;AAAA,UACN,WAAA,EAAa;AAAA,SACf;AAAA,QACA,WAAA,EAAa;AAAA,UACX,IAAA,EAAM,QAAA;AAAA,UACN,WAAA,EAAa;AAAA;AACf;AACF,KACF;AAAA,IACA,OAAA,EAAS;AAAA,MACP,QAAA,EAAU,IAAA;AAAA,MACV,QAAA,EAAU;AAAA;AACZ,GACF;AAAA,EAEA,+BAAA,EAAiC;AAAA,IAC/B,IAAA,EAAM,+BAAA;AAAA,IACN,WAAA,EAAa,kBAAA;AAAA,IACb,UAAU,MAAA,CAAO,MAAA;AAAA,IACjB,WAAA,EAAa,4DAAA;AAAA,IACb,QAAA,EAAU,IAAA;AAAA,IACV,WAAA,EAAa,YAAA;AAAA,IACb,OAAA,EAAS;AAAA,MACP,aAAA,EAAe,8CAAA;AAAA,MACf,OAAA,EAAS,+BAAA;AAAA,MACT,YAAA,EAAc;AAAA,KAChB;AAAA,IACA,YAAA,EAAc;AAAA,MACZ,KAAA,EAAO,CAAC,WAAW,CAAA;AAAA,MACnB,cAAc,CAAC,KAAA,EAAO,KAAA,EAAO,KAAA,EAAO,QAAQ,MAAM,CAAA;AAAA,MAClD,mBAAA,EAAqB,CAAA;AAAA,MACrB,aAAA,EAAe,CAAC,KAAA,EAAO,MAAM,CAAA;AAAA,MAC7B,QAAA,EAAU;AAAA,QACR,UAAA,EAAY,IAAA;AAAA,QACZ,OAAA,EAAS,KAAA;AAAA,QACT,UAAA,EAAY,KAAA;AAAA,QACZ,YAAA,EAAc,KAAA;AAAA,QACd,cAAA,EAAgB,IAAA;AAAA,QAChB,YAAA,EAAc,KAAA;AAAA,QACd,cAAA,EAAgB;AAAA,OAClB;AAAA,MACA,MAAA,EAAQ,EAAE,eAAA,EAAiB,GAAA;AAAI,KACjC;AAAA,IACA,OAAA,EAAS;AAAA,MACP,QAAA,EAAU,IAAA;AAAA,MACV,QAAA,EAAU;AAAA;AACZ,GACF;AAAA,EAEA,8BAAA,EAAgC;AAAA,IAC9B,IAAA,EAAM,8BAAA;AAAA,IACN,WAAA,EAAa,iBAAA;AAAA,IACb,UAAU,MAAA,CAAO,MAAA;AAAA,IACjB,WAAA,EAAa,8CAAA;AAAA,IACb,QAAA,EAAU,IAAA;AAAA,IACV,WAAA,EAAa,YAAA;AAAA,IACb,OAAA,EAAS;AAAA,MACP,aAAA,EAAe,8CAAA;AAAA,MACf,OAAA,EAAS,+BAAA;AAAA,MACT,YAAA,EAAc;AAAA,KAChB;AAAA,IACA,YAAA,EAAc;AAAA,MACZ,KAAA,EAAO,CAAC,WAAW,CAAA;AAAA,MACnB,cAAc,CAAC,KAAA,EAAO,KAAA,EAAO,KAAA,EAAO,QAAQ,MAAM,CAAA;AAAA,MAClD,mBAAA,EAAqB,CAAA;AAAA,MACrB,aAAA,EAAe,CAAC,KAAA,EAAO,MAAM,CAAA;AAAA,MAC7B,QAAA,EAAU;AAAA,QACR,UAAA,EAAY,IAAA;AAAA,QACZ,OAAA,EAAS,KAAA;AAAA,QACT,UAAA,EAAY,KAAA;AAAA,QACZ,YAAA,EAAc,KAAA;AAAA,QACd,cAAA,EAAgB,KAAA;AAAA,QAChB,YAAA,EAAc,KAAA;AAAA,QACd,cAAA,EAAgB;AAAA,OAClB;AAAA,MACA,MAAA,EAAQ,EAAE,eAAA,EAAiB,GAAA;AAAI,KACjC;AAAA,IACA,OAAA,EAAS;AAAA,MACP,QAAA,EAAU,IAAA;AAAA,MACV,QAAA,EAAU;AAAA;AACZ;AAEJ;AAMA,IAAMkC,QAAAA,GAAU,sBAAsB,oBAAoB,CAAA;AAEnD,IAAM,oBAAoBA,QAAAA,CAAQ;AAClC,IAAM,yBAAyBA,QAAAA,CAAQ;AACvC,IAAM,uBAAuBA,QAAAA,CAAQ;AAKrC,SAAS,0BACd,OAAA,EAC0B;AAC1B,EAAA,OAAO,MAAA,CAAO,MAAA,CAAO,oBAAoB,CAAA,CAAE,MAAA;AAAA,IACzC,CAAC,KAAA,KAAU,KAAA,CAAM,YAAY,KAAA,CAAM,YAAA,CAAa,SAAS,OAAO;AAAA,GAClE;AACF;AAKO,SAAS,kBAAA,CACd,SAAA,EACA,UAAA,EACA,OAAA,GAA6B,UAAA,EACd;AACf,EAAA,MAAM,KAAA,GAAQ,kBAAkB,SAAS,CAAA;AACzC,EAAA,IAAI,CAAC,KAAA,EAAO,OAAA,EAAS,OAAO,IAAA;AAE5B,EAAA,IAAI,KAAA,CAAM,QAAQ,QAAA,EAAU;AAC1B,IAAA,OAAO,UAAA,GAAa,MAAM,OAAA,CAAQ,QAAA;AAAA,EACpC;AAEA,EAAA,MAAM,gBACJ,OAAA,KAAY,IAAA,GAAO,MAAM,OAAA,CAAQ,UAAA,GAAa,MAAM,OAAA,CAAQ,gBAAA;AAE9D,EAAA,IAAI,CAAC,eAAe,OAAO,IAAA;AAC3B,EAAA,OAAO,UAAA,GAAa,aAAA;AACtB;;;ADhVO,IAAM,eAAA,GAAN,MAAM,gBAAA,CAAgB;AAAA,EACnB,QAAA;AAAA,EACA,SAAA;AAAA,EACA,YAAA;AAAA,EAEA,YAAY,SAAA,EAAsB;AACxC,IAAA,IAAA,CAAK,SAAA,GAAY,SAAA;AACjB,IAAA,IAAA,CAAK,QAAA,GAAW,oBAAoB,SAAS,CAAA;AAC7C,IAAA,IAAA,CAAK,YAAA,GAAe,KAAK,eAAA,EAAgB;AAAA,EAC3C;AAAA;AAAA;AAAA;AAAA,EAKA,OAAO,OAAO,OAAA,EAAwD;AACpE,IAAA,MAAM,SAAA,GACJ,OAAO,OAAA,CAAQ,SAAA,KAAc,QAAA,GACzB,UAAU,GAAA,CAAI,OAAA,CAAQ,SAAS,CAAA,GAC/B,OAAA,CAAQ,SAAA;AAEd,IAAA,IAAI,CAAC,SAAA,EAAW;AACd,MAAA,MAAM,IAAI,KAAA,CAAM,CAAA,qBAAA,EAAwB,OAAA,CAAQ,SAAS,CAAA,CAAE,CAAA;AAAA,IAC7D;AAEA,IAAA,OAAO,IAAI,iBAAgB,SAAS,CAAA;AAAA,EACtC;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,SAAS,OAAA,EAAwD;AACrE,IAAA,MAAM,WAAA,GAAoC;AAAA,MACxC,KAAA,EAAO,OAAA,CAAQ,KAAA,IAAS,IAAA,CAAK,YAAA;AAAA,MAC7B,QAAQ,OAAA,CAAQ,MAAA;AAAA,MAChB,MAAM,OAAA,CAAQ,IAAA;AAAA,MACd,SAAS,OAAA,CAAQ,OAAA;AAAA,MACjB,OAAO,OAAA,CAAQ,KAAA;AAAA,MACf,GAAG,OAAA,CAAQ,CAAA;AAAA,MACX,eAAA,EAAiB,QAAQ,eAAA,IAAmB;AAAA,KAC9C;AAEA,IAAA,OAAO,IAAA,CAAK,QAAA,CAAS,aAAA,CAAc,WAAW,CAAA;AAAA,EAChD;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,MAAM,KAAK,OAAA,EAAmD;AAC5D,IAAA,IAAI,CAAC,IAAA,CAAK,QAAA,CAAS,SAAA,EAAW;AAC5B,MAAA,MAAM,IAAI,KAAA,CAAM,CAAA,+BAAA,EAAkC,IAAA,CAAK,QAAA,CAAS,IAAI,CAAA,CAAE,CAAA;AAAA,IACxE;AAEA,IAAA,MAAM,WAAA,GAAgC;AAAA,MACpC,GAAG,OAAA;AAAA,MACH,KAAA,EAAO,OAAA,CAAQ,KAAA,IAAS,IAAA,CAAK,YAAA;AAAa,KAC5C;AAEA,IAAA,OAAO,IAAA,CAAK,QAAA,CAAS,SAAA,CAAU,WAAW,CAAA;AAAA,EAC5C;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,MAAM,gBAAgB,OAAA,EAAwD;AAC5E,IAAA,IAAI,CAAC,IAAA,CAAK,QAAA,CAAS,eAAA,EAAiB;AAClC,MAAA,MAAM,IAAI,KAAA,CAAM,CAAA,kCAAA,EAAqC,IAAA,CAAK,QAAA,CAAS,IAAI,CAAA,CAAE,CAAA;AAAA,IAC3E;AAEA,IAAA,MAAM,WAAA,GAAqC;AAAA,MACzC,GAAG,OAAA;AAAA,MACH,KAAA,EAAO,QAAQ,KAAA,IAAS;AAAA;AAAA,KAC1B;AAEA,IAAA,OAAO,IAAA,CAAK,QAAA,CAAS,eAAA,CAAgB,WAAW,CAAA;AAAA,EAClD;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,UAAA,GAAgC;AACpC,IAAA,IAAI,IAAA,CAAK,SAAS,UAAA,EAAY;AAC5B,MAAA,OAAO,IAAA,CAAK,SAAS,UAAA,EAAW;AAAA,IAClC;AAGA,IAAA,MAAM,MAAA,GAAS,KAAK,SAAA,CAAU,MAAA;AAC9B,IAAA,IAAI,MAAA,IAAU,YAAA,CAAa,MAAmC,CAAA,EAAG;AAC/D,MAAA,OAAO,MAAA,CAAO,MAAA,CAAO,YAAA,CAAa,MAAmC,CAAC,CAAA;AAAA,IACxE;AAEA,IAAA,OAAO,EAAC;AAAA,EACV;AAAA;AAAA;AAAA;AAAA,EAKA,aAAa,SAAA,EAAmB;AAC9B,IAAA,OAAO,kBAAkB,SAAS,CAAA;AAAA,EACpC;AAAA;AAAA;AAAA;AAAA,EAKA,WAAA,GAA8B;AAC5B,IAAA,OAAO,IAAA,CAAK,QAAA;AAAA,EACd;AAAA;AAAA;AAAA;AAAA,EAKA,YAAA,GAA0B;AACxB,IAAA,OAAO,IAAA,CAAK,SAAA;AAAA,EACd;AAAA;AAAA;AAAA;AAAA,EAKQ,eAAA,GAA0B;AAChC,IAAA,MAAM,MAAA,GAAS,KAAK,SAAA,CAAU,MAAA;AAE9B,IAAA,QAAQ,MAAA;AAAQ,MACd,KAAK,MAAA,CAAO,MAAA;AACV,QAAA,OAAO,YAAA,CAAa,MAAA,CAAO,MAAM,CAAA,CAAE,QAAA;AAAA,MACrC,KAAK,MAAA,CAAO,MAAA;AACV,QAAA,OAAO,YAAA,CAAa,MAAA,CAAO,MAAM,CAAA,CAAE,iBAAA;AAAA,MACrC;AACE,QAAA,MAAM,IAAI,KAAA,CAAM,CAAA,mCAAA,EAAsC,MAAM,CAAA,CAAE,CAAA;AAAA;AAClE,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,YAAA,GAAuB;AAC7B,IAAA,MAAM,MAAA,GAAS,KAAK,SAAA,CAAU,MAAA;AAE9B,IAAA,QAAQ,MAAA;AAAQ,MACd,KAAK,MAAA,CAAO,MAAA;AACV,QAAA,OAAO,YAAA,CAAa,MAAA,CAAO,MAAM,CAAA,CAAE,WAAA;AAAA,MACrC,KAAK,MAAA,CAAO,MAAA;AAEV,QAAA,OAAO,YAAA,CAAa,MAAA,CAAO,MAAM,CAAA,CAAE,iBAAA;AAAA,MACrC;AACE,QAAA,MAAM,IAAI,KAAA,CAAM,CAAA,0BAAA,EAA6B,MAAM,CAAA,CAAE,CAAA;AAAA;AACzD,EACF;AACF;;;AE3LA,cAAA,EAAA;ACZO,IAAM,kBAAA,GAAN,cAAiC,iBAAA,CAA4C;AAAA,EACzE,IAAA,GAAe,cAAA;AAAA,EACf,MAAA,GAAS,QAAA;AAAA,EACT,YAAA,GAAqC;AAAA,IAC5C,IAAA,EAAM,KAAA;AAAA,IACN,MAAA,EAAQ,KAAA;AAAA,IACR,MAAA,EAAQ,IAAA;AAAA,IACR,KAAA,EAAO,KAAA;AAAA,IACP,QAAA,EAAU;AAAA,MACR,eAAA,EAAiB,IAAA;AAAA,MACjB,YAAA,EAAc,IAAA;AAAA,MACd,cAAA,EAAgB;AAAA;AAClB,GACF;AAAA,EAEQ,MAAA;AAAA,EAER,YAAY,MAAA,EAA2B;AACrC,IAAA,KAAA,CAAM,EAAE,MAAA,EAAQ,MAAA,CAAO,KAAK,MAAA,EAAQ,GAAG,QAAQ,CAAA;AAE/C,IAAA,IAAA,CAAK,MAAA,GAAS,IAAIR,OAAAA,CAAO;AAAA,MACvB,MAAA,EAAQ,OAAO,IAAA,CAAK,MAAA;AAAA,MACpB,SAAS,MAAA,CAAO,OAAA;AAAA,MAChB,cAAc,MAAA,CAAO,YAAA;AAAA,MACrB,SAAS,MAAA,CAAO,OAAA;AAAA,MAChB,YAAY,MAAA,CAAO;AAAA,KACpB,CAAA;AAAA,EACH;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,cAAc,OAAA,EAAuD;AACzE,IAAA,OAAO,IAAA,CAAK,yBAAA;AAAA,MACV,YAAY;AACV,QAAA,IAAI;AACF,UAAA,IAAA,CAAK,kBAAkB,gBAAA,EAAkB;AAAA,YACvC,OAAO,OAAA,CAAQ,KAAA;AAAA,YACf,UAAU,OAAA,CAAQ,QAAA;AAAA,YAClB,YAAY,OAAA,CAAQ;AAAA,WACrB,CAAA;AAED,UAAA,MAAM,KAAA,GAAS,QAAQ,KAAA,IAAS,QAAA;AAQhC,UAAA,MAAM,OAAA,GAAU,IAAA,CAAK,iBAAA,CAAkB,OAAA,CAAQ,YAAY,CAAC,CAAA;AAG5D,UAAA,MAAM,MAAA,GAMF;AAAA,YACF,QAAQ,OAAA,CAAQ,MAAA;AAAA,YAChB,KAAA;AAAA,YACA;AAAA,WACF;AAGA,UAAA,IAAI,QAAQ,UAAA,EAAY;AACtB,YAAA,MAAA,CAAO,IAAA,GAAO,IAAA,CAAK,gBAAA,CAAiB,OAAA,CAAQ,UAAU,CAAA;AAAA,UACxD,CAAA,MAAA,IAAW,QAAQ,WAAA,EAAa;AAC9B,YAAA,MAAA,CAAO,IAAA,GAAO,IAAA,CAAK,iBAAA,CAAkB,OAAA,CAAQ,WAAW,CAAA;AAAA,UAC1D;AAGA,UAAA,IAAI,QAAQ,KAAA,EAAO;AACjB,YAAA,MAAA,CAAO,eAAA,GAAkB,MAAM,IAAA,CAAK,iBAAA,CAAkB,QAAQ,KAAK,CAAA;AAAA,UACrE;AAGA,UAAA,MAAM,WAAW,MAAM,IAAA,CAAK,MAAA,CAAO,MAAA,CAAO,OAAO,MAAM,CAAA;AAEvD,UAAA,IAAA,CAAK,qBAAqB,gBAAA,EAAkB;AAAA,YAC1C,KAAA;AAAA,YACA,OAAO,QAAA,CAAS,EAAA;AAAA,YAChB,QAAQ,QAAA,CAAS;AAAA,WAClB,CAAA;AAED,UAAA,OAAO,IAAA,CAAK,YAAY,QAAQ,CAAA;AAAA,QAClC,SAAS,KAAA,EAAY;AACnB,UAAA,IAAA,CAAK,YAAY,KAAK,CAAA;AACtB,UAAA,MAAM,KAAA;AAAA,QACR;AAAA,MACF,CAAA;AAAA,MACA,gBAAA;AAAA,MACA,EAAE,KAAA,EAAO,OAAA,CAAQ,KAAA;AAAM,KACzB;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,eAAe,KAAA,EAAuC;AAC1D,IAAA,OAAO,IAAA,CAAK,yBAAA;AAAA,MACV,YAAY;AACV,QAAA,IAAI;AACF,UAAA,IAAA,CAAK,iBAAA,CAAkB,cAAA,EAAgB,EAAE,KAAA,EAAO,CAAA;AAEhD,UAAA,MAAM,WAAW,MAAM,IAAA,CAAK,MAAA,CAAO,MAAA,CAAO,SAAS,KAAK,CAAA;AAExD,UAAA,IAAA,CAAK,qBAAqB,cAAA,EAAgB;AAAA,YACxC,KAAA;AAAA,YACA,QAAQ,QAAA,CAAS,MAAA;AAAA,YACjB,UAAU,QAAA,CAAS;AAAA,WACpB,CAAA;AAED,UAAA,OAAO,IAAA,CAAK,YAAY,QAAQ,CAAA;AAAA,QAClC,SAAS,KAAA,EAAY;AACnB,UAAA,IAAA,CAAK,YAAY,KAAK,CAAA;AACtB,UAAA,MAAM,KAAA;AAAA,QACR;AAAA,MACF,CAAA;AAAA,MACA,cAAA;AAAA,MACA,EAAE,KAAA;AAAM,KACV;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,cAAc,KAAA,EAAgC;AAClD,IAAA,OAAO,IAAA,CAAK,yBAAA;AAAA,MACV,YAAY;AACV,QAAA,IAAI;AACF,UAAA,IAAA,CAAK,iBAAA,CAAkB,gBAAA,EAAkB,EAAE,KAAA,EAAO,CAAA;AAGlD,UAAA,MAAM,cAAA,GAAiB,MAAM,IAAA,CAAK,cAAA,CAAe,KAAK,CAAA;AACtD,UAAA,IAAI,cAAA,CAAe,WAAW,WAAA,EAAa;AACzC,YAAA,MAAM,IAAI,aAAA,CAAc,QAAA,EAAU,CAAA,yBAAA,EAA4B,cAAA,CAAe,MAAM,CAAA,CAAE,CAAA;AAAA,UACvF;AAGA,UAAA,MAAM,QAAA,GAAW,MAAM,IAAA,CAAK,MAAA,CAAO,MAAA,CAAO,gBAAgB,KAAA,EAAO,EAAE,OAAA,EAAS,OAAA,EAAS,CAAA;AAGrF,UAAA,MAAM,WAAA,GAAc,MAAM,QAAA,CAAS,WAAA,EAAY;AAC/C,UAAA,MAAM,MAAA,GAAS,MAAA,CAAO,IAAA,CAAK,WAAW,CAAA;AAEtC,UAAA,IAAA,CAAK,qBAAqB,gBAAA,EAAkB;AAAA,YAC1C,KAAA;AAAA,YACA,MAAM,MAAA,CAAO;AAAA,WACd,CAAA;AAED,UAAA,OAAO,MAAA;AAAA,QACT,SAAS,KAAA,EAAY;AACnB,UAAA,IAAI,KAAA,YAAiB,eAAe,MAAM,KAAA;AAC1C,UAAA,IAAA,CAAK,YAAY,KAAK,CAAA;AACtB,UAAA,MAAM,KAAA;AAAA,QACR;AAAA,MACF,CAAA;AAAA,MACA,gBAAA;AAAA,MACA,EAAE,KAAA;AAAM,KACV;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,MAAM,YAAY,OAAA,EAAqD;AACrE,IAAA,OAAO,IAAA,CAAK,yBAAA;AAAA,MACV,YAAY;AACV,QAAA,IAAI;AACF,UAAA,IAAA,CAAK,kBAAkB,cAAA,EAAgB;AAAA,YACrC,OAAO,OAAA,CAAQ,KAAA;AAAA,YACf,gBAAgB,OAAA,CAAQ,cAAA;AAAA,YACxB,WAAW,OAAA,CAAQ;AAAA,WACpB,CAAA;AAGD,UAAA,IAAI,OAAA;AACJ,UAAA,IAAI,OAAO,QAAQ,KAAA,KAAU,QAAA,IAAY,CAAC,OAAA,CAAQ,KAAA,CAAM,UAAA,CAAW,MAAM,CAAA,EAAG;AAE1E,YAAA,OAAA,GAAU,OAAA,CAAQ,KAAA;AAAA,UACpB,CAAA,MAAO;AACL,YAAA,MAAM,IAAI,aAAA;AAAA,cACR,QAAA;AAAA,cACA;AAAA,aACF;AAAA,UACF;AAGA,UAAA,MAAM,MAAA,GAAS,QAAQ,MAAA,IAAU,8BAAA;AACjC,UAAA,MAAM,QAAA,GAAW,MAAM,IAAA,CAAK,MAAA,CAAO,OAAO,KAAA,CAAM,OAAA,EAAS,EAAE,MAAA,EAAQ,CAAA;AAEnE,UAAA,IAAA,CAAK,qBAAqB,cAAA,EAAgB;AAAA,YACxC,OAAO,QAAA,CAAS,EAAA;AAAA,YAChB,QAAQ,QAAA,CAAS;AAAA,WAClB,CAAA;AAED,UAAA,OAAO,IAAA,CAAK,YAAY,QAAQ,CAAA;AAAA,QAClC,SAAS,KAAA,EAAY;AACnB,UAAA,IAAI,KAAA,YAAiB,eAAe,MAAM,KAAA;AAC1C,UAAA,IAAA,CAAK,YAAY,KAAK,CAAA;AACtB,UAAA,MAAM,KAAA;AAAA,QACR;AAAA,MACF,CAAA;AAAA,MACA,cAAA;AAAA,MACA,EAAE,KAAA,EAAO,OAAA,CAAQ,KAAA;AAAM,KACzB;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,UAAA,GAAgC;AACpC,IAAA,OAAO,CAAC,UAAU,YAAY,CAAA;AAAA,EAChC;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,UAAU,KAAA,EAAiC;AAC/C,IAAA,IAAI;AACF,MAAA,MAAM,WAAW,MAAM,IAAA,CAAK,MAAA,CAAO,MAAA,CAAO,OAAO,KAAK,CAAA;AACtD,MAAA,OAAO,QAAA,CAAS,OAAA;AAAA,IAClB,CAAA,CAAA,MAAQ;AACN,MAAA,OAAO,KAAA;AAAA,IACT;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,YAAY,QAAA,EAA8C;AAChE,IAAA,MAAM,MAAA,GAAwB;AAAA,MAC5B,OAAO,QAAA,CAAS,EAAA;AAAA,MAChB,MAAA,EAAQ,IAAA,CAAK,SAAA,CAAU,QAAA,CAAS,MAAM,CAAA;AAAA,MACtC,SAAS,QAAA,CAAS,UAAA;AAAA,MAClB,UAAU,QAAA,CAAS;AAAA,KACrB;AAIA,IAAA,IAAI,QAAA,CAAS,WAAW,WAAA,EAAa;AACnC,MAAA,MAAA,CAAO,KAAA,GAAQ;AAAA,QACb,QAAA,EAAU,IAAA,CAAK,qBAAA,CAAsB,QAAA,CAAS,OAAO,CAAA;AAAA,QACrD,YAAY,QAAA,CAAS,IAAA;AAAA,QACrB,MAAA,EAAQ;AAAA,OACV;AAAA,IACF;AAEA,IAAA,IAAI,QAAA,CAAS,MAAA,KAAW,QAAA,IAAY,QAAA,CAAS,KAAA,EAAO;AAClD,MAAA,MAAA,CAAO,KAAA,GAAQ,QAAA,CAAS,KAAA,CAAM,OAAA,IAAW,yBAAA;AAAA,IAC3C;AAEA,IAAA,OAAO,MAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKQ,UAAU,MAAA,EAAmE;AACnF,IAAA,QAAQ,MAAA;AAAQ,MACd,KAAK,QAAA;AAAA,MACL,KAAK,SAAA;AACH,QAAA,OAAO,SAAA;AAAA,MACT,KAAK,aAAA;AAAA,MACL,KAAK,YAAA;AACH,QAAA,OAAO,YAAA;AAAA,MACT,KAAK,WAAA;AAAA,MACL,KAAK,WAAA;AACH,QAAA,OAAO,WAAA;AAAA,MACT,KAAK,QAAA;AAAA,MACL,KAAK,WAAA;AACH,QAAA,OAAO,QAAA;AAAA,MACT;AACE,QAAA,OAAO,SAAA;AAAA;AACX,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,kBAAkB,QAAA,EAAoC;AAC5D,IAAA,IAAI,QAAA,IAAY,GAAG,OAAO,GAAA;AAC1B,IAAA,IAAI,QAAA,IAAY,GAAG,OAAO,GAAA;AAC1B,IAAA,OAAO,IAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKQ,sBAAsB,OAAA,EAAyB;AACrD,IAAA,OAAO,QAAA,CAAS,OAAA,EAAS,EAAE,CAAA,IAAK,CAAA;AAAA,EAClC;AAAA;AAAA;AAAA;AAAA,EAKQ,iBAAiB,UAAA,EAAyE;AAChG,IAAA,MAAM,UAAA,GAAa,CAAC,UAAA,EAAY,UAAA,EAAY,aAAa,WAAW,CAAA;AACpE,IAAA,IAAI,UAAA,CAAW,QAAA,CAAS,UAAiB,CAAA,EAAG;AAC1C,MAAA,OAAO,UAAA;AAAA,IACT;AAEA,IAAA,OAAO,UAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKQ,kBAAkB,WAAA,EAA0E;AAClG,IAAA,MAAM,GAAA,GAA2E;AAAA,MAC/E,MAAA,EAAQ,UAAA;AAAA,MACR,MAAA,EAAQ,UAAA;AAAA,MACR,WAAA,EAAa,WAAA;AAAA,MACb,WAAA,EAAa;AAAA,KACf;AACA,IAAA,OAAO,GAAA,CAAI,WAAW,CAAA,IAAK,UAAA;AAAA,EAC7B;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,kBAAkB,KAAA,EAAsC;AACpE,IAAA,IAAI,MAAA,CAAO,QAAA,CAAS,KAAK,CAAA,EAAG;AAE1B,MAAA,OAAO,IAAI,KAAK,CAAC,KAAK,GAAG,WAAA,EAAa,EAAE,IAAA,EAAM,WAAA,EAAa,CAAA;AAAA,IAC7D;AAGA,IAAA,IAAI,CAAC,KAAA,CAAM,UAAA,CAAW,MAAM,CAAA,EAAG;AAC7B,MAAA,MAAM3B,IAAAA,GAAK,MAAM,OAAO,IAAI,CAAA;AAC5B,MAAA,MAAM,IAAA,GAAOA,IAAAA,CAAG,YAAA,CAAa,KAAK,CAAA;AAClC,MAAA,OAAO,IAAI,KAAK,CAAC,IAAI,GAAG,WAAA,EAAa,EAAE,IAAA,EAAM,WAAA,EAAa,CAAA;AAAA,IAC5D;AAGA,IAAA,MAAM,QAAA,GAAW,MAAM,KAAA,CAAM,KAAK,CAAA;AAClC,IAAA,MAAM,WAAA,GAAc,MAAM,QAAA,CAAS,WAAA,EAAY;AAC/C,IAAA,OAAO,IAAI,IAAA,CAAK,CAAC,IAAI,UAAA,CAAW,WAAW,CAAC,CAAA,EAAG,WAAA,EAAa,EAAE,IAAA,EAAM,WAAA,EAAa,CAAA;AAAA,EACnF;AAAA;AAAA;AAAA;AAAA,EAKQ,YAAY,KAAA,EAAmB;AACrC,IAAA,MAAM,OAAA,GAAU,MAAM,OAAA,IAAW,0BAAA;AACjC,IAAA,MAAM,SAAS,KAAA,CAAM,MAAA;AAErB,IAAA,IAAI,WAAW,GAAA,EAAK;AAClB,MAAA,MAAM,IAAI,iBAAA,CAAkB,QAAA,EAAU,iBAAiB,CAAA;AAAA,IACzD;AAEA,IAAA,IAAI,WAAW,GAAA,EAAK;AAClB,MAAA,MAAM,IAAI,sBAAA,CAAuB,QAAA,EAAU,OAAO,CAAA;AAAA,IACpD;AAEA,IAAA,IAAI,WAAW,GAAA,EAAK;AAClB,MAAA,IAAI,QAAQ,QAAA,CAAS,QAAQ,KAAK,OAAA,CAAQ,QAAA,CAAS,QAAQ,CAAA,EAAG;AAC5D,QAAA,MAAM,IAAI,aAAA,CAAc,QAAA,EAAU,CAAA,0BAAA,EAA6B,OAAO,CAAA,CAAE,CAAA;AAAA,MAC1E;AACA,MAAA,MAAM,IAAI,aAAA,CAAc,QAAA,EAAU,CAAA,aAAA,EAAgB,OAAO,CAAA,CAAE,CAAA;AAAA,IAC7D;AAEA,IAAA,MAAM,IAAI,aAAA,CAAc,QAAA,EAAU,OAAO,CAAA;AAAA,EAC3C;AACF,CAAA;AChWO,IAAM,iBAAA,GAAN,cAAgC,iBAAA,CAA4C;AAAA,EACxE,IAAA,GAAe,cAAA;AAAA,EACf,MAAA,GAAS,QAAA;AAAA,EACT,YAAA,GAAqC;AAAA,IAC5C,IAAA,EAAM,KAAA;AAAA,IACN,MAAA,EAAQ,KAAA;AAAA,IACR,MAAA,EAAQ,IAAA;AAAA,IACR,KAAA,EAAO,KAAA;AAAA,IACP,QAAA,EAAU;AAAA,MACR,eAAA,EAAiB,IAAA;AAAA,MACjB,YAAA,EAAc,IAAA;AAAA,MACd,cAAA,EAAgB;AAAA;AAClB,GACF;AAAA,EAEQ,MAAA;AAAA,EACA,iBAAA,uBAA0C,GAAA,EAAI;AAAA,EAEtD,YAAY,MAAA,EAA2B;AACrC,IAAA,KAAA,CAAM,EAAE,MAAA,EAAQ,MAAA,CAAO,KAAK,MAAA,EAAQ,GAAG,QAAQ,CAAA;AAE/C,IAAA,IAAA,CAAK,MAAA,GAAS,IAAI6B,WAAAA,CAAY;AAAA,MAC5B,MAAA,EAAQ,OAAO,IAAA,CAAK;AAAA,KACrB,CAAA;AAAA,EACH;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,cAAc,OAAA,EAAuD;AACzE,IAAA,OAAO,IAAA,CAAK,yBAAA;AAAA,MACV,YAAY;AACV,QAAA,IAAI;AACF,UAAA,IAAA,CAAK,kBAAkB,gBAAA,EAAkB;AAAA,YACvC,OAAO,OAAA,CAAQ,KAAA;AAAA,YACf,UAAU,OAAA,CAAQ,QAAA;AAAA,YAClB,YAAY,OAAA,CAAQ;AAAA,WACrB,CAAA;AAED,UAAA,MAAM,KAAA,GAAQ,QAAQ,KAAA,IAAS,0BAAA;AAC/B,UAAA,MAAM,aAAA,GAAiB,OAAA,CAAQ,aAAA,IAAiB,EAAC;AAGjD,UAAA,MAAM,SAAc,EAAC;AAGrB,UAAA,IAAI,QAAQ,WAAA,EAAa;AACvB,YAAA,MAAA,CAAO,cAAc,OAAA,CAAQ,WAAA;AAAA,UAC/B;AAGA,UAAA,IAAI,QAAQ,UAAA,EAAY;AACtB,YAAA,MAAA,CAAO,aAAa,OAAA,CAAQ,UAAA;AAAA,UAC9B;AAGA,UAAA,IAAI,QAAQ,QAAA,EAAU;AACpB,YAAA,MAAA,CAAO,kBAAkB,OAAA,CAAQ,QAAA;AAAA,UACnC;AAGA,UAAA,IAAI,OAAA,CAAQ,SAAS,KAAA,CAAA,EAAW;AAC9B,YAAA,MAAA,CAAO,OAAO,OAAA,CAAQ,IAAA;AAAA,UACxB;AAGA,UAAA,IAAI,cAAc,cAAA,EAAgB;AAChC,YAAA,MAAA,CAAO,iBAAiB,aAAA,CAAc,cAAA;AAAA,UACxC;AAGA,UAAA,IAAI,cAAc,gBAAA,EAAkB;AAClC,YAAA,MAAA,CAAO,mBAAmB,aAAA,CAAc,gBAAA;AAAA,UAC1C;AAGA,UAAA,IAAI,cAAc,iBAAA,EAAmB;AACnC,YAAA,MAAA,CAAO,oBAAoB,aAAA,CAAc,iBAAA;AAAA,UAC3C;AAGA,UAAA,MAAM,OAAA,GAAe;AAAA,YACnB,KAAA;AAAA,YACA,QAAQ,OAAA,CAAQ,MAAA;AAAA,YAChB;AAAA,WACF;AAGA,UAAA,IAAI,QAAQ,KAAA,EAAO;AACjB,YAAA,OAAA,CAAQ,KAAA,GAAQ,MAAM,IAAA,CAAK,iBAAA,CAAkB,QAAQ,KAAK,CAAA;AAAA,UAC5D;AAGA,UAAA,IAAI,cAAc,SAAA,EAAW;AAC3B,YAAA,OAAA,CAAQ,SAAA,GAAY,MAAM,IAAA,CAAK,iBAAA,CAAkB,cAAc,SAAS,CAAA;AAAA,UAC1E;AAGA,UAAA,MAAM,YAAY,MAAO,IAAA,CAAK,MAAA,CAAO,MAAA,CAAe,eAAe,OAAO,CAAA;AAG1E,UAAA,MAAM,KAAA,GAAQ,IAAA,CAAK,YAAA,CAAa,SAAS,CAAA;AACzC,UAAA,IAAA,CAAK,iBAAA,CAAkB,GAAA,CAAI,KAAA,EAAO,SAAS,CAAA;AAE3C,UAAA,IAAA,CAAK,qBAAqB,gBAAA,EAAkB;AAAA,YAC1C,KAAA;AAAA,YACA,KAAA;AAAA,YACA,MAAA,EAAQ;AAAA,WACT,CAAA;AAED,UAAA,OAAO;AAAA,YACL,KAAA;AAAA,YACA,MAAA,EAAQ,SAAA;AAAA,YACR,SAAS,IAAA,CAAK,KAAA,CAAM,IAAA,CAAK,GAAA,KAAQ,GAAI;AAAA,WACvC;AAAA,QACF,SAAS,KAAA,EAAY;AACnB,UAAA,IAAA,CAAK,YAAY,KAAK,CAAA;AACtB,UAAA,MAAM,KAAA;AAAA,QACR;AAAA,MACF,CAAA;AAAA,MACA,gBAAA;AAAA,MACA,EAAE,KAAA,EAAO,OAAA,CAAQ,KAAA;AAAM,KACzB;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,eAAe,KAAA,EAAuC;AAC1D,IAAA,OAAO,IAAA,CAAK,yBAAA;AAAA,MACV,YAAY;AACV,QAAA,IAAI;AACF,UAAA,IAAA,CAAK,iBAAA,CAAkB,cAAA,EAAgB,EAAE,KAAA,EAAO,CAAA;AAGhD,UAAA,IAAI,SAAA,GAAY,IAAA,CAAK,iBAAA,CAAkB,GAAA,CAAI,KAAK,CAAA;AAEhD,UAAA,IAAI,CAAC,SAAA,EAAW;AAEd,YAAA,IAAI;AACF,cAAA,SAAA,GAAY,MAAO,IAAA,CAAK,MAAA,CAAe,UAAA,CAAW,kBAAA,CAAmB;AAAA,gBACnE,SAAA,EAAW,EAAE,IAAA,EAAM,KAAA;AAAM,eAC1B,CAAA;AAAA,YACH,CAAA,CAAA,MAAQ;AACN,cAAA,MAAM,IAAI,aAAA,CAAc,QAAA,EAAU,CAAA,qBAAA,EAAwB,KAAK,CAAA,CAAE,CAAA;AAAA,YACnE;AAAA,UACF;AAGA,UAAA,SAAA,GAAY,MAAO,IAAA,CAAK,MAAA,CAAe,UAAA,CAAW,kBAAA,CAAmB;AAAA,YACnE;AAAA,WACD,CAAA;AAGD,UAAA,IAAA,CAAK,iBAAA,CAAkB,GAAA,CAAI,KAAA,EAAO,SAAS,CAAA;AAE3C,UAAA,MAAM,QAAA,GAAW,IAAA,CAAK,WAAA,CAAY,KAAA,EAAO,SAAS,CAAA;AAElD,UAAA,IAAA,CAAK,qBAAqB,cAAA,EAAgB;AAAA,YACxC,KAAA;AAAA,YACA,QAAQ,QAAA,CAAS;AAAA,WAClB,CAAA;AAGD,UAAA,IAAI,QAAA,CAAS,MAAA,KAAW,WAAA,IAAe,QAAA,CAAS,WAAW,QAAA,EAAU;AACnE,YAAA,IAAA,CAAK,iBAAA,CAAkB,OAAO,KAAK,CAAA;AAAA,UACrC;AAEA,UAAA,OAAO,QAAA;AAAA,QACT,SAAS,KAAA,EAAY;AACnB,UAAA,IAAI,KAAA,YAAiB,eAAe,MAAM,KAAA;AAC1C,UAAA,IAAA,CAAK,YAAY,KAAK,CAAA;AACtB,UAAA,MAAM,KAAA;AAAA,QACR;AAAA,MACF,CAAA;AAAA,MACA,cAAA;AAAA,MACA,EAAE,KAAA;AAAM,KACV;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,cAAc,KAAA,EAAgC;AAClD,IAAA,OAAO,IAAA,CAAK,yBAAA;AAAA,MACV,YAAY;AACV,QAAA,IAAI;AACF,UAAA,IAAA,CAAK,iBAAA,CAAkB,gBAAA,EAAkB,EAAE,KAAA,EAAO,CAAA;AAGlD,UAAA,MAAM,MAAA,GAAS,MAAM,IAAA,CAAK,cAAA,CAAe,KAAK,CAAA;AAC9C,UAAA,IAAI,MAAA,CAAO,WAAW,WAAA,EAAa;AACjC,YAAA,MAAM,IAAI,aAAA,CAAc,QAAA,EAAU,CAAA,yBAAA,EAA4B,MAAA,CAAO,MAAM,CAAA,CAAE,CAAA;AAAA,UAC/E;AAGA,UAAA,MAAM,SAAA,GAAY,IAAA,CAAK,iBAAA,CAAkB,GAAA,CAAI,KAAK,CAAA;AAClD,UAAA,IAAI,CAAC,SAAA,EAAW,QAAA,EAAU,eAAA,GAAkB,CAAC,GAAG,KAAA,EAAO;AACrD,YAAA,MAAM,IAAI,aAAA,CAAc,QAAA,EAAU,iCAAiC,CAAA;AAAA,UACrE;AAGA,UAAA,MAAM,SAAA,GAAY,SAAA,CAAU,QAAA,CAAS,eAAA,CAAgB,CAAC,CAAA,CAAE,KAAA;AACxD,UAAA,MAAM,gBAAA,GAAmB,MAAO,IAAA,CAAK,MAAA,CAAO,MAAc,QAAA,CAAS;AAAA,YACjE,IAAA,EAAM;AAAA,WACP,CAAA;AAED,UAAA,IAAI,MAAA;AACJ,UAAA,IAAI,4BAA4B,MAAA,EAAQ;AACtC,YAAA,MAAA,GAAS,gBAAA;AAAA,UACX,CAAA,MAAA,IAAW,iBAAiB,IAAA,EAAM;AAChC,YAAA,MAAA,GAAS,MAAA,CAAO,IAAA,CAAK,gBAAA,CAAiB,IAAI,CAAA;AAAA,UAC5C,CAAA,MAAO;AACL,YAAA,MAAM,IAAI,aAAA,CAAc,QAAA,EAAU,qCAAqC,CAAA;AAAA,UACzE;AAEA,UAAA,IAAA,CAAK,qBAAqB,gBAAA,EAAkB;AAAA,YAC1C,KAAA;AAAA,YACA,MAAM,MAAA,CAAO;AAAA,WACd,CAAA;AAED,UAAA,OAAO,MAAA;AAAA,QACT,SAAS,KAAA,EAAY;AACnB,UAAA,IAAI,KAAA,YAAiB,eAAe,MAAM,KAAA;AAC1C,UAAA,IAAA,CAAK,YAAY,KAAK,CAAA;AACtB,UAAA,MAAM,KAAA;AAAA,QACR;AAAA,MACF,CAAA;AAAA,MACA,gBAAA;AAAA,MACA,EAAE,KAAA;AAAM,KACV;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,YAAY,OAAA,EAAqD;AACrE,IAAA,OAAO,IAAA,CAAK,yBAAA;AAAA,MACV,YAAY;AACV,QAAA,IAAI;AACF,UAAA,IAAA,CAAK,kBAAkB,cAAA,EAAgB;AAAA,YACrC,OAAO,OAAA,CAAQ,KAAA;AAAA,YACf,gBAAgB,OAAA,CAAQ;AAAA,WACzB,CAAA;AAED,UAAA,MAAM,KAAA,GAAQ,QAAQ,KAAA,IAAS,0BAAA;AAI/B,UAAA,MAAM,OAAA,GAAe;AAAA,YACnB,KAAA;AAAA,YACA,MAAA,EAAQ,QAAQ,MAAA,IAAU,+BAAA;AAAA,YAC1B,MAAA,EAAQ;AAAA,cACN,eAAA,EAAiB,MAAA,CAAO,OAAA,CAAQ,cAAc;AAAA;AAChD,WACF;AAGA,UAAA,IAAI,MAAA,CAAO,QAAA,CAAS,OAAA,CAAQ,KAAK,CAAA,EAAG;AAGlC,YAAA,OAAA,CAAQ,KAAA,GAAQ;AAAA,cACd,UAAA,EAAY,OAAA,CAAQ,KAAA,CAAM,QAAA,CAAS,QAAQ;AAAA,aAC7C;AAAA,UACF,CAAA,MAAO;AACL,YAAA,OAAA,CAAQ,KAAA,GAAQ,EAAE,GAAA,EAAK,OAAA,CAAQ,KAAA,EAAM;AAAA,UACvC;AAEA,UAAA,MAAM,YAAY,MAAO,IAAA,CAAK,MAAA,CAAO,MAAA,CAAe,eAAe,OAAO,CAAA;AAE1E,UAAA,MAAM,KAAA,GAAQ,IAAA,CAAK,YAAA,CAAa,SAAS,CAAA;AACzC,UAAA,IAAA,CAAK,iBAAA,CAAkB,GAAA,CAAI,KAAA,EAAO,SAAS,CAAA;AAE3C,UAAA,IAAA,CAAK,qBAAqB,cAAA,EAAgB;AAAA,YACxC,KAAA;AAAA,YACA,MAAA,EAAQ;AAAA,WACT,CAAA;AAED,UAAA,OAAO;AAAA,YACL,KAAA;AAAA,YACA,MAAA,EAAQ,SAAA;AAAA,YACR,SAAS,IAAA,CAAK,KAAA,CAAM,IAAA,CAAK,GAAA,KAAQ,GAAI;AAAA,WACvC;AAAA,QACF,SAAS,KAAA,EAAY;AACnB,UAAA,IAAA,CAAK,YAAY,KAAK,CAAA;AACtB,UAAA,MAAM,KAAA;AAAA,QACR;AAAA,MACF,CAAA;AAAA,MACA,cAAA;AAAA,MACA,EAAE,KAAA,EAAO,OAAA,CAAQ,KAAA;AAAM,KACzB;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,UAAA,GAAgC;AACpC,IAAA,OAAO;AAAA,MACL,sBAAA;AAAA,MACA,wBAAA;AAAA,MACA,+BAAA;AAAA,MACA;AAAA,KACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,iBAAA,CAAkB,KAAA,EAAe,SAAA,GAAoB,GAAA,EAAgC;AACzF,IAAA,MAAM,SAAA,GAAY,KAAK,GAAA,EAAI;AAC3B,IAAA,MAAM,YAAA,GAAe,GAAA;AAErB,IAAA,OAAO,IAAA,CAAK,GAAA,EAAI,GAAI,SAAA,GAAY,SAAA,EAAW;AACzC,MAAA,MAAM,MAAA,GAAS,MAAM,IAAA,CAAK,cAAA,CAAe,KAAK,CAAA;AAE9C,MAAA,IAAI,MAAA,CAAO,MAAA,KAAW,WAAA,IAAe,MAAA,CAAO,WAAW,QAAA,EAAU;AAC/D,QAAA,OAAO,MAAA;AAAA,MACT;AAGA,MAAA,MAAM,IAAI,OAAA,CAAQ,CAAC5B,aAAY,UAAA,CAAWA,QAAAA,EAAS,YAAY,CAAC,CAAA;AAAA,IAClE;AAEA,IAAA,MAAM,IAAI,aAAA,CAAc,QAAA,EAAU,CAAA,iCAAA,EAAoC,SAAS,CAAA,EAAA,CAAI,CAAA;AAAA,EACrF;AAAA;AAAA;AAAA;AAAA,EAKQ,aAAa,SAAA,EAAwB;AAC3C,IAAA,IAAI,UAAU,IAAA,EAAM;AAClB,MAAA,OAAO,SAAA,CAAU,IAAA;AAAA,IACnB;AAEA,IAAA,OAAO,CAAA,IAAA,EAAO,IAAA,CAAK,GAAA,EAAK,IAAI,IAAA,CAAK,MAAA,EAAO,CAAE,QAAA,CAAS,EAAE,CAAA,CAAE,MAAA,CAAO,CAAA,EAAG,CAAC,CAAC,CAAA,CAAA;AAAA,EACrE;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,kBAAkB,KAAA,EAAsC;AACpE,IAAA,IAAI,MAAA,CAAO,QAAA,CAAS,KAAK,CAAA,EAAG;AAC1B,MAAA,OAAO;AAAA,QACL,UAAA,EAAY,KAAA,CAAM,QAAA,CAAS,QAAQ;AAAA,OACrC;AAAA,IACF;AAGA,IAAA,IAAI,MAAM,UAAA,CAAW,SAAS,KAAK,KAAA,CAAM,UAAA,CAAW,UAAU,CAAA,EAAG;AAC/D,MAAA,OAAO,EAAE,UAAU,KAAA,EAAM;AAAA,IAC3B;AAGA,IAAA,MAAMD,IAAAA,GAAK,MAAM,OAAO,aAAa,CAAA;AACrC,IAAA,MAAM,IAAA,GAAO,MAAMA,IAAAA,CAAG,QAAA,CAAS,KAAK,CAAA;AACpC,IAAA,OAAO;AAAA,MACL,UAAA,EAAY,IAAA,CAAK,QAAA,CAAS,QAAQ;AAAA,KACpC;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,WAAA,CAAY,OAAe,SAAA,EAA+B;AAChE,IAAA,MAAM,MAAA,GAAwB;AAAA,MAC5B,KAAA;AAAA,MACA,MAAA,EAAQ,IAAA,CAAK,SAAA,CAAU,SAAS,CAAA;AAAA,MAChC,SAAS,IAAA,CAAK,KAAA,CAAM,IAAA,CAAK,GAAA,KAAQ,GAAI;AAAA,KACvC;AAEA,IAAA,IAAI,UAAU,IAAA,IAAQ,SAAA,CAAU,QAAA,EAAU,eAAA,GAAkB,CAAC,CAAA,EAAG;AAC9D,MAAA,MAAM,KAAA,GAAQ,SAAA,CAAU,QAAA,CAAS,eAAA,CAAgB,CAAC,CAAA;AAClD,MAAA,MAAA,CAAO,KAAA,GAAQ;AAAA,QACb,QAAA,EAAU,MAAM,KAAA,EAAO,QAAA;AAAA,QACvB,MAAA,EAAQ;AAAA,OACV;AAGA,MAAA,IAAI,KAAA,CAAM,OAAO,GAAA,EAAK;AACpB,QAAA,MAAA,CAAO,KAAA,CAAM,GAAA,GAAM,KAAA,CAAM,KAAA,CAAM,GAAA;AAAA,MACjC;AAAA,IACF;AAEA,IAAA,IAAI,UAAU,KAAA,EAAO;AACnB,MAAA,MAAA,CAAO,KAAA,GAAQ,SAAA,CAAU,KAAA,CAAM,OAAA,IAAW,yBAAA;AAC1C,MAAA,MAAA,CAAO,MAAA,GAAS,QAAA;AAAA,IAClB;AAEA,IAAA,OAAO,MAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKQ,UAAU,SAAA,EAA6B;AAC7C,IAAA,IAAI,UAAU,KAAA,EAAO;AACnB,MAAA,OAAO,QAAA;AAAA,IACT;AACA,IAAA,IAAI,UAAU,IAAA,EAAM;AAClB,MAAA,OAAO,WAAA;AAAA,IACT;AACA,IAAA,IAAI,UAAU,QAAA,EAAU,KAAA,KAAU,YAAY,SAAA,CAAU,QAAA,EAAU,UAAU,YAAA,EAAc;AACxF,MAAA,OAAO,YAAA;AAAA,IACT;AACA,IAAA,OAAO,SAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKQ,YAAY,KAAA,EAAmB;AACrC,IAAA,MAAM,OAAA,GAAU,MAAM,OAAA,IAAW,0BAAA;AACjC,IAAA,MAAM,MAAA,GAAS,KAAA,CAAM,MAAA,IAAU,KAAA,CAAM,IAAA;AAErC,IAAA,IAAI,WAAW,GAAA,IAAO,MAAA,KAAW,OAAO,OAAA,CAAQ,QAAA,CAAS,SAAS,CAAA,EAAG;AACnE,MAAA,MAAM,IAAI,iBAAA,CAAkB,QAAA,EAAU,iBAAiB,CAAA;AAAA,IACzD;AAEA,IAAA,IAAI,MAAA,KAAW,OAAO,OAAA,CAAQ,QAAA,CAAS,OAAO,CAAA,IAAK,OAAA,CAAQ,QAAA,CAAS,MAAM,CAAA,EAAG;AAC3E,MAAA,MAAM,IAAI,sBAAA,CAAuB,QAAA,EAAU,OAAO,CAAA;AAAA,IACpD;AAEA,IAAA,IAAI,WAAW,GAAA,EAAK;AAClB,MAAA,IAAI,QAAQ,QAAA,CAAS,QAAQ,KAAK,OAAA,CAAQ,QAAA,CAAS,SAAS,CAAA,EAAG;AAC7D,QAAA,MAAM,IAAI,aAAA,CAAc,QAAA,EAAU,CAAA,0BAAA,EAA6B,OAAO,CAAA,CAAE,CAAA;AAAA,MAC1E;AACA,MAAA,MAAM,IAAI,aAAA,CAAc,QAAA,EAAU,CAAA,aAAA,EAAgB,OAAO,CAAA,CAAE,CAAA;AAAA,IAC7D;AAEA,IAAA,MAAM,IAAI,aAAA,CAAc,QAAA,EAAU,OAAO,CAAA;AAAA,EAC3C;AACF,CAAA;;;ACtcO,SAAS,oBAAoB,SAAA,EAAsC;AACxE,EAAA,MAAM,SAAS,SAAA,CAAU,MAAA;AAEzB,EAAA,QAAQ,MAAA;AAAQ,IACd,KAAK,MAAA,CAAO,MAAA;AACV,MAAA,OAAO,IAAI,kBAAA,CAAmBsC,oBAAAA,CAAoB,SAAS,CAAC,CAAA;AAAA,IAE9D,KAAK,MAAA,CAAO,MAAA;AACV,MAAA,OAAO,IAAI,iBAAA,CAAkBC,oBAAAA,CAAoB,SAAS,CAAC,CAAA;AAAA,IAE7D;AACE,MAAA,MAAM,IAAI,KAAA;AAAA,QACR,8CAA8C,MAAM,CAAA,qBAAA,EAC5B,OAAO,MAAM,CAAA,EAAA,EAAK,OAAO,MAAM,CAAA;AAAA,OACzD;AAAA;AAEN;AAKA,SAASD,qBAAoB,SAAA,EAAyC;AACpE,EAAA,MAAM,IAAA,GAAO,UAAU,MAAA,CAAO,IAAA;AAE9B,EAAA,IAAI,IAAA,CAAK,SAAS,SAAA,EAAW;AAC3B,IAAA,MAAM,IAAI,MAAM,wCAAwC,CAAA;AAAA,EAC1D;AAEA,EAAA,MAAM,OAAA,GAAU,UAAU,UAAA,EAAW;AAErC,EAAA,OAAO;AAAA,IACL,IAAA,EAAM;AAAA,MACJ,IAAA,EAAM,SAAA;AAAA,MACN,QAAQ,IAAA,CAAK;AAAA,KACf;AAAA,IACA,SAAS,SAAA,CAAU,OAAA;AAAA,IACnB,cAAc,OAAA,CAAQ,YAAA;AAAA,IACtB,SAAS,OAAA,CAAQ,OAAA;AAAA,IACjB,YAAY,OAAA,CAAQ;AAAA,GACtB;AACF;AAKA,SAASC,qBAAoB,SAAA,EAAyC;AACpE,EAAA,MAAM,IAAA,GAAO,UAAU,MAAA,CAAO,IAAA;AAE9B,EAAA,IAAI,IAAA,CAAK,SAAS,SAAA,EAAW;AAC3B,IAAA,MAAM,IAAI,MAAM,wCAAwC,CAAA;AAAA,EAC1D;AAEA,EAAA,MAAM,OAAA,GAAU,UAAU,UAAA,EAAW;AAErC,EAAA,OAAO;AAAA,IACL,IAAA,EAAM;AAAA,MACJ,IAAA,EAAM,SAAA;AAAA,MACN,QAAQ,IAAA,CAAK;AAAA,KACf;AAAA,IACA,SAAS,OAAA,CAAQ,OAAA;AAAA,IACjB,YAAY,OAAA,CAAQ;AAAA,GACtB;AACF;;;ACPO,IAAM,YAAA,GAAe;AAAA,EAC1B,CAAC,MAAA,CAAO,MAAM,GAAG;AAAA,IACf,MAAA,EAAQ,QAAA;AAAA,IACR,UAAA,EAAY;AAAA,GACd;AAAA,EACA,CAAC,MAAA,CAAO,MAAM,GAAG;AAAA;AAAA,IAEf,KAAA,EAAO,sBAAA;AAAA,IACP,KAAA,EAAO,wBAAA;AAAA,IACP,UAAA,EAAY,+BAAA;AAAA,IACZ,OAAA,EAAS;AAAA;AAEb;AAKA,IAAM,cAAA,GAA+B;AAAA,EACnC,aAAA,EAAe,0DAAA;AAAA,EACf,YAAA,EAAc,uDAAA;AAAA,EACd,YAAA,EAAc;AAChB,CAAA;AAEA,IAAM,cAAA,GAA+B;AAAA,EACnC,aAAA,EAAe,2EAAA;AAAA,EACf,YAAA,EAAc,iGAAA;AAAA,EACd,YAAA,EAAc;AAChB,CAAA;AAKO,IAAM,oBAAA,GAA2C;AAAA;AAAA;AAAA;AAAA,EAKtD,QAAA,EAAU;AAAA,IACR,IAAA,EAAM,QAAA;AAAA,IACN,WAAA,EAAa,QAAA;AAAA,IACb,UAAU,MAAA,CAAO,MAAA;AAAA,IACjB,QAAA,EAAU,IAAA;AAAA,IACV,OAAA,EAAS,cAAA;AAAA,IACT,YAAA,EAAc;AAAA,MACZ,SAAA,EAAW,CAAC,CAAA,EAAG,CAAA,EAAG,EAAE,CAAA;AAAA,MACpB,WAAA,EAAa,CAAC,UAAA,EAAY,UAAA,EAAY,aAAa,WAAW,CAAA;AAAA,MAC9D,MAAA,EAAQ,EAAA;AAAA,MACR,KAAA,EAAO,IAAA;AAAA,MACP,YAAA,EAAc,IAAA;AAAA,MACd,cAAA,EAAgB,IAAA;AAAA,MAChB,YAAA,EAAc,KAAA;AAAA,MACd,QAAA,EAAU;AAAA,QACR,SAAA,EAAW,KAAA;AAAA,QACX,YAAA,EAAc,KAAA;AAAA,QACd,cAAA,EAAgB,KAAA;AAAA,QAChB,IAAA,EAAM;AAAA;AACR,KACF;AAAA,IACA,OAAA,EAAS;AAAA,MACP,SAAA,EAAW,IAAA;AAAA,MACX,QAAA,EAAU;AAAA;AACZ,GACF;AAAA,EAEA,YAAA,EAAc;AAAA,IACZ,IAAA,EAAM,YAAA;AAAA,IACN,WAAA,EAAa,YAAA;AAAA,IACb,UAAU,MAAA,CAAO,MAAA;AAAA,IACjB,QAAA,EAAU,IAAA;AAAA,IACV,OAAA,EAAS,cAAA;AAAA,IACT,YAAA,EAAc;AAAA,MACZ,SAAA,EAAW,CAAC,CAAA,EAAG,CAAA,EAAG,EAAE,CAAA;AAAA,MACpB,aAAa,CAAC,UAAA,EAAY,YAAY,WAAA,EAAa,WAAA,EAAa,aAAa,WAAW,CAAA;AAAA,MACxF,MAAA,EAAQ,EAAA;AAAA,MACR,KAAA,EAAO,IAAA;AAAA,MACP,YAAA,EAAc,IAAA;AAAA,MACd,cAAA,EAAgB,IAAA;AAAA,MAChB,YAAA,EAAc,IAAA;AAAA,MACd,QAAA,EAAU;AAAA,QACR,SAAA,EAAW,IAAA;AAAA,QACX,YAAA,EAAc,IAAA;AAAA,QACd,cAAA,EAAgB,KAAA;AAAA,QAChB,IAAA,EAAM;AAAA;AACR,KACF;AAAA,IACA,OAAA,EAAS;AAAA,MACP,SAAA,EAAW,GAAA;AAAA,MACX,QAAA,EAAU;AAAA;AACZ,GACF;AAAA;AAAA;AAAA;AAAA,EAMA,sBAAA,EAAwB;AAAA,IACtB,IAAA,EAAM,sBAAA;AAAA,IACN,WAAA,EAAa,SAAA;AAAA,IACb,UAAU,MAAA,CAAO,MAAA;AAAA,IACjB,QAAA,EAAU,IAAA;AAAA,IACV,OAAA,EAAS,cAAA;AAAA,IACT,YAAA,EAAc;AAAA,MACZ,SAAA,EAAW,CAAC,CAAA,EAAG,CAAA,EAAG,GAAG,CAAC,CAAA;AAAA,MACtB,WAAA,EAAa,CAAC,UAAA,EAAY,UAAA,EAAY,WAAW,CAAA;AAAA,MACjD,MAAA,EAAQ,EAAA;AAAA,MACR,KAAA,EAAO,KAAA;AAAA,MACP,YAAA,EAAc,IAAA;AAAA,MACd,cAAA,EAAgB,KAAA;AAAA,MAChB,YAAA,EAAc,IAAA;AAAA,MACd,QAAA,EAAU;AAAA,QACR,SAAA,EAAW,KAAA;AAAA,QACX,YAAA,EAAc,KAAA;AAAA,QACd,cAAA,EAAgB,IAAA;AAAA,QAChB,IAAA,EAAM;AAAA;AACR,KACF;AAAA,IACA,OAAA,EAAS;AAAA,MACP,SAAA,EAAW,IAAA;AAAA,MACX,QAAA,EAAU;AAAA;AACZ,GACF;AAAA,EAEA,wBAAA,EAA0B;AAAA,IACxB,IAAA,EAAM,wBAAA;AAAA,IACN,WAAA,EAAa,SAAA;AAAA,IACb,UAAU,MAAA,CAAO,MAAA;AAAA,IACjB,QAAA,EAAU,IAAA;AAAA,IACV,OAAA,EAAS,cAAA;AAAA,IACT,YAAA,EAAc;AAAA,MACZ,SAAA,EAAW,CAAC,CAAA,EAAG,CAAA,EAAG,CAAC,CAAA;AAAA,MACnB,WAAA,EAAa,CAAC,MAAA,EAAQ,OAAA,EAAS,YAAY,UAAU,CAAA;AAAA,MACrD,MAAA,EAAQ,EAAA;AAAA,MACR,KAAA,EAAO,IAAA;AAAA,MACP,YAAA,EAAc,IAAA;AAAA,MACd,cAAA,EAAgB,IAAA;AAAA,MAChB,YAAA,EAAc,IAAA;AAAA,MACd,QAAA,EAAU;AAAA,QACR,SAAA,EAAW,IAAA;AAAA,QACX,YAAA,EAAc,IAAA;AAAA,QACd,cAAA,EAAgB,IAAA;AAAA,QAChB,IAAA,EAAM;AAAA;AACR,KACF;AAAA,IACA,OAAA,EAAS;AAAA,MACP,SAAA,EAAW,IAAA;AAAA,MACX,QAAA,EAAU;AAAA;AACZ,GACF;AAAA,EAEA,+BAAA,EAAiC;AAAA,IAC/B,IAAA,EAAM,+BAAA;AAAA,IACN,WAAA,EAAa,cAAA;AAAA,IACb,UAAU,MAAA,CAAO,MAAA;AAAA,IACjB,QAAA,EAAU,IAAA;AAAA,IACV,OAAA,EAAS,cAAA;AAAA,IACT,YAAA,EAAc;AAAA,MACZ,SAAA,EAAW,CAAC,CAAA,EAAG,CAAA,EAAG,CAAC,CAAA;AAAA,MACnB,WAAA,EAAa,CAAC,MAAA,EAAQ,UAAA,EAAY,UAAU,CAAA;AAAA,MAC5C,MAAA,EAAQ,EAAA;AAAA,MACR,KAAA,EAAO,IAAA;AAAA,MACP,YAAA,EAAc,IAAA;AAAA,MACd,cAAA,EAAgB,KAAA;AAAA,MAChB,YAAA,EAAc,KAAA;AAAA,MACd,QAAA,EAAU;AAAA,QACR,SAAA,EAAW,KAAA;AAAA,QACX,YAAA,EAAc,KAAA;AAAA,QACd,cAAA,EAAgB,IAAA;AAAA,QAChB,IAAA,EAAM;AAAA;AACR,KACF;AAAA,IACA,OAAA,EAAS;AAAA,MACP,SAAA,EAAW,IAAA;AAAA,MACX,QAAA,EAAU;AAAA;AACZ,GACF;AAAA,EAEA,0BAAA,EAA4B;AAAA,IAC1B,IAAA,EAAM,0BAAA;AAAA,IACN,WAAA,EAAa,SAAA;AAAA,IACb,UAAU,MAAA,CAAO,MAAA;AAAA,IACjB,QAAA,EAAU,IAAA;AAAA,IACV,OAAA,EAAS,cAAA;AAAA,IACT,YAAA,EAAc;AAAA,MACZ,SAAA,EAAW,CAAC,CAAA,EAAG,CAAA,EAAG,CAAC,CAAA;AAAA,MACnB,aAAa,CAAC,MAAA,EAAQ,OAAA,EAAS,IAAA,EAAM,YAAY,UAAU,CAAA;AAAA,MAC3D,MAAA,EAAQ,EAAA;AAAA,MACR,KAAA,EAAO,IAAA;AAAA,MACP,YAAA,EAAc,IAAA;AAAA,MACd,cAAA,EAAgB,IAAA;AAAA,MAChB,YAAA,EAAc,IAAA;AAAA,MACd,QAAA,EAAU;AAAA,QACR,SAAA,EAAW,IAAA;AAAA,QACX,YAAA,EAAc,IAAA;AAAA,QACd,cAAA,EAAgB,IAAA;AAAA,QAChB,IAAA,EAAM;AAAA;AACR,KACF;AAAA,IACA,OAAA,EAAS;AAAA,MACP,SAAA,EAAW,IAAA;AAAA,MACX,QAAA,EAAU;AAAA;AACZ;AAEJ;AAGA,IAAMJ,QAAAA,GAAU,sBAA8C,oBAAoB,CAAA;AAK3E,IAAM,oBAAoBA,QAAAA,CAAQ;AAKlC,IAAM,yBAAyBA,QAAAA,CAAQ;AAKvC,IAAM,uBAAuBA,QAAAA,CAAQ;AAKrC,SAAS,0BAA0B,OAAA,EAA6E;AACrH,EAAA,OAAO,MAAA,CAAO,MAAA,CAAO,oBAAoB,CAAA,CAAE,MAAA;AAAA,IACzC,CAAC,KAAA,KAAU,KAAA,CAAM,YAAY,KAAA,CAAM,YAAA,CAAa,SAAS,OAAO;AAAA,GAClE;AACF;AAKO,SAAS,uBAAA,GAAoD;AAClE,EAAA,OAAO,MAAA,CAAO,MAAA,CAAO,oBAAoB,CAAA,CAAE,MAAA,CAAO,CAAC,KAAA,KAAU,KAAA,CAAM,QAAA,IAAY,KAAA,CAAM,YAAA,CAAa,KAAK,CAAA;AACzG;AAKO,SAAS,kBAAA,CAAmB,WAAmB,eAAA,EAAwC;AAC5F,EAAA,MAAM,KAAA,GAAQ,qBAAqB,SAAS,CAAA;AAC5C,EAAA,IAAI,CAAC,KAAA,IAAS,CAAC,KAAA,CAAM,OAAA,EAAS;AAC5B,IAAA,OAAO,IAAA;AAAA,EACT;AAEA,EAAA,OAAO,KAAA,CAAM,QAAQ,SAAA,GAAY,eAAA;AACnC;;;AJ9OO,IAAM,eAAA,GAAN,MAAM,gBAAA,CAAgB;AAAA,EACnB,QAAA;AAAA,EACA,SAAA;AAAA,EACA,YAAA;AAAA,EAEA,YAAY,SAAA,EAAsB;AACxC,IAAA,IAAA,CAAK,SAAA,GAAY,SAAA;AACjB,IAAA,IAAA,CAAK,QAAA,GAAW,oBAAoB,SAAS,CAAA;AAC7C,IAAA,IAAA,CAAK,YAAA,GAAe,KAAK,eAAA,EAAgB;AAAA,EAC3C;AAAA;AAAA;AAAA;AAAA,EAKA,OAAO,OAAO,OAAA,EAAwD;AACpE,IAAA,MAAM,SAAA,GACJ,OAAO,OAAA,CAAQ,SAAA,KAAc,QAAA,GACzB,UAAU,GAAA,CAAI,OAAA,CAAQ,SAAS,CAAA,GAC/B,OAAA,CAAQ,SAAA;AAEd,IAAA,IAAI,CAAC,SAAA,EAAW;AACd,MAAA,MAAM,IAAI,KAAA,CAAM,CAAA,qBAAA,EAAwB,OAAA,CAAQ,SAAS,CAAA,CAAE,CAAA;AAAA,IAC7D;AAEA,IAAA,OAAO,IAAI,iBAAgB,SAAS,CAAA;AAAA,EACtC;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,MAAM,SAAS,OAAA,EAA6D;AAC1E,IAAA,MAAM,WAAA,GAAoC;AAAA,MACxC,KAAA,EAAO,OAAA,CAAQ,KAAA,IAAS,IAAA,CAAK,YAAA;AAAA,MAC7B,QAAQ,OAAA,CAAQ,MAAA;AAAA,MAChB,UAAU,OAAA,CAAQ,QAAA;AAAA,MAClB,YAAY,OAAA,CAAQ,UAAA;AAAA,MACpB,aAAa,OAAA,CAAQ,WAAA;AAAA,MACrB,OAAO,OAAA,CAAQ,KAAA;AAAA,MACf,MAAM,OAAA,CAAQ,IAAA;AAAA,MACd,eAAe,OAAA,CAAQ;AAAA,KACzB;AAEA,IAAA,OAAO,IAAA,CAAK,QAAA,CAAS,aAAA,CAAc,WAAW,CAAA;AAAA,EAChD;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,UAAU,KAAA,EAAuC;AACrD,IAAA,OAAO,IAAA,CAAK,QAAA,CAAS,cAAA,CAAe,KAAK,CAAA;AAAA,EAC3C;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,iBAAA,CAAkB,KAAA,EAAe,SAAA,GAAoB,GAAA,EAAgC;AACzF,IAAA,MAAM,SAAA,GAAY,KAAK,GAAA,EAAI;AAC3B,IAAA,MAAM,YAAA,GAAe,GAAA;AAErB,IAAA,OAAO,IAAA,CAAK,GAAA,EAAI,GAAI,SAAA,GAAY,SAAA,EAAW;AACzC,MAAA,MAAM,MAAA,GAAS,MAAM,IAAA,CAAK,QAAA,CAAS,eAAe,KAAK,CAAA;AAEvD,MAAA,IAAI,MAAA,CAAO,WAAW,WAAA,EAAa;AACjC,QAAA,OAAO,MAAA;AAAA,MACT;AAEA,MAAA,IAAI,MAAA,CAAO,WAAW,QAAA,EAAU;AAC9B,QAAA,MAAM,IAAI,aAAA;AAAA,UACR,IAAA,CAAK,UAAU,MAAA,IAAU,SAAA;AAAA,UACzB,CAAA,yBAAA,EAA4B,MAAA,CAAO,KAAA,IAAS,eAAe,CAAA;AAAA,SAC7D;AAAA,MACF;AAGA,MAAA,MAAM,IAAI,OAAA,CAAQ,CAAClC,aAAY,UAAA,CAAWA,QAAAA,EAAS,YAAY,CAAC,CAAA;AAAA,IAClE;AAEA,IAAA,MAAM,IAAI,aAAA;AAAA,MACR,IAAA,CAAK,UAAU,MAAA,IAAU,SAAA;AAAA,MACzB,oCAAoC,SAAS,CAAA,EAAA;AAAA,KAC/C;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,SAAS,KAAA,EAAgC;AAC7C,IAAA,IAAI,CAAC,IAAA,CAAK,QAAA,CAAS,aAAA,EAAe;AAChC,MAAA,MAAM,IAAI,KAAA,CAAM,CAAA,gCAAA,EAAmC,IAAA,CAAK,QAAA,CAAS,IAAI,CAAA,CAAE,CAAA;AAAA,IACzE;AAEA,IAAA,OAAO,IAAA,CAAK,QAAA,CAAS,aAAA,CAAc,KAAK,CAAA;AAAA,EAC1C;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,eAAA,CACJ,OAAA,EACA,SAAA,GAAoB,GAAA,EACI;AACxB,IAAA,MAAM,GAAA,GAAM,MAAM,IAAA,CAAK,QAAA,CAAS,OAAO,CAAA;AACvC,IAAA,OAAO,IAAA,CAAK,iBAAA,CAAkB,GAAA,CAAI,KAAA,EAAO,SAAS,CAAA;AAAA,EACpD;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,MAAM,OAAO,OAAA,EAAqD;AAChE,IAAA,IAAI,CAAC,IAAA,CAAK,QAAA,CAAS,WAAA,EAAa;AAC9B,MAAA,MAAM,IAAI,KAAA,CAAM,CAAA,iCAAA,EAAoC,IAAA,CAAK,QAAA,CAAS,IAAI,CAAA,CAAE,CAAA;AAAA,IAC1E;AAEA,IAAA,MAAM,WAAA,GAAkC;AAAA,MACtC,GAAG,OAAA;AAAA,MACH,KAAA,EAAO,OAAA,CAAQ,KAAA,IAAS,IAAA,CAAK,cAAA;AAAe,KAC9C;AAEA,IAAA,OAAO,IAAA,CAAK,QAAA,CAAS,WAAA,CAAY,WAAW,CAAA;AAAA,EAC9C;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,OAAO,KAAA,EAAiC;AAC5C,IAAA,IAAI,CAAC,IAAA,CAAK,QAAA,CAAS,SAAA,EAAW;AAC5B,MAAA,MAAM,IAAI,KAAA,CAAM,CAAA,kCAAA,EAAqC,IAAA,CAAK,QAAA,CAAS,IAAI,CAAA,CAAE,CAAA;AAAA,IAC3E;AAEA,IAAA,OAAO,IAAA,CAAK,QAAA,CAAS,SAAA,CAAU,KAAK,CAAA;AAAA,EACtC;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,UAAA,GAAgC;AACpC,IAAA,IAAI,IAAA,CAAK,SAAS,UAAA,EAAY;AAC5B,MAAA,OAAO,IAAA,CAAK,SAAS,UAAA,EAAW;AAAA,IAClC;AAGA,IAAA,MAAM,MAAA,GAAS,KAAK,SAAA,CAAU,MAAA;AAC9B,IAAA,IAAI,MAAA,IAAU,YAAA,CAAa,MAAmC,CAAA,EAAG;AAC/D,MAAA,OAAO,MAAA,CAAO,MAAA,CAAO,YAAA,CAAa,MAAmC,CAAC,CAAA;AAAA,IACxE;AAEA,IAAA,OAAO,EAAC;AAAA,EACV;AAAA;AAAA;AAAA;AAAA,EAKA,aAAa,SAAA,EAAmB;AAC9B,IAAA,OAAO,kBAAkB,SAAS,CAAA;AAAA,EACpC;AAAA;AAAA;AAAA;AAAA,EAKA,WAAA,GAA8B;AAC5B,IAAA,OAAO,IAAA,CAAK,QAAA;AAAA,EACd;AAAA;AAAA;AAAA;AAAA,EAKA,YAAA,GAA0B;AACxB,IAAA,OAAO,IAAA,CAAK,SAAA;AAAA,EACd;AAAA;AAAA;AAAA;AAAA,EAKQ,eAAA,GAA0B;AAChC,IAAA,MAAM,MAAA,GAAS,KAAK,SAAA,CAAU,MAAA;AAE9B,IAAA,QAAQ,MAAA;AAAQ,MACd,KAAK,MAAA,CAAO,MAAA;AACV,QAAA,OAAO,YAAA,CAAa,MAAA,CAAO,MAAM,CAAA,CAAE,MAAA;AAAA,MACrC,KAAK,MAAA,CAAO,MAAA;AACV,QAAA,OAAO,YAAA,CAAa,MAAA,CAAO,MAAM,CAAA,CAAE,KAAA;AAAA,MACrC;AACE,QAAA,MAAM,IAAI,KAAA,CAAM,CAAA,mCAAA,EAAsC,MAAM,CAAA,CAAE,CAAA;AAAA;AAClE,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,cAAA,GAAyB;AAC/B,IAAA,MAAM,MAAA,GAAS,KAAK,SAAA,CAAU,MAAA;AAE9B,IAAA,QAAQ,MAAA;AAAQ,MACd,KAAK,MAAA,CAAO,MAAA;AACV,QAAA,OAAO,YAAA,CAAa,MAAA,CAAO,MAAM,CAAA,CAAE,MAAA;AAAA,MACrC,KAAK,MAAA,CAAO,MAAA;AACV,QAAA,OAAO,YAAA,CAAa,MAAA,CAAO,MAAM,CAAA,CAAE,OAAA;AAAA,MACrC;AACE,QAAA,MAAM,IAAI,KAAA,CAAM,CAAA,4BAAA,EAA+B,MAAM,CAAA,CAAE,CAAA;AAAA;AAC3D,EACF;AACF;;;AKlRA,cAAA,EAAA;;;ACuDO,SAAS,iBAAiB,MAAA,EAA2D;AAC1F,EAAA,MAAM,YAAA,GAAe,IAAI,eAAA,EAAgB;AACzC,EAAA,KAAA,MAAW,CAAC,GAAA,EAAK,KAAK,KAAK,MAAA,CAAO,OAAA,CAAQ,MAAM,CAAA,EAAG;AACjD,IAAA,IAAI,KAAA,KAAU,MAAA,IAAa,KAAA,KAAU,IAAA,EAAM;AACzC,MAAA,YAAA,CAAa,MAAA,CAAO,GAAA,EAAK,MAAA,CAAO,KAAK,CAAC,CAAA;AAAA,IACxC;AAAA,EACF;AACA,EAAA,OAAO,aAAa,QAAA,EAAS;AAC/B;AASO,SAAS,mBAAmB,OAAA,EAAsD;AACvF,EAAA,MAAM,EAAE,IAAA,EAAM,WAAA,EAAa,GAAG,MAAK,GAAI,OAAA;AAEvC,EAAA,MAAM,gBAAA,GAA0C;AAAA,IAC9C,GAAG;AAAA,GACL;AAGA,EAAA,IAAI,IAAA,EAAM;AACR,IAAA,gBAAA,CAAiB,IAAA,GAAO,IAAA,CAAK,SAAA,CAAU,IAAI,CAAA;AAE3C,IAAA,gBAAA,CAAiB,OAAA,GAAU;AAAA,MACzB,cAAA,EAAgB,kBAAA;AAAA,MAChB,GAAG,IAAA,CAAK;AAAA,KACV;AAAA,EACF;AAEA,EAAA,OAAO,gBAAA;AACT;AAQO,SAAS,sBAAA,CACd,UACA,WAAA,EACQ;AACR,EAAA,IAAI,CAAC,WAAA,IAAe,MAAA,CAAO,KAAK,WAAW,CAAA,CAAE,WAAW,CAAA,EAAG;AACzD,IAAA,OAAO,QAAA;AAAA,EACT;AACA,EAAA,MAAM,WAAA,GAAc,iBAAiB,WAAW,CAAA;AAChD,EAAA,MAAM,SAAA,GAAY,QAAA,CAAS,QAAA,CAAS,GAAG,IAAI,GAAA,GAAM,GAAA;AACjD,EAAA,OAAO,CAAA,EAAG,QAAQ,CAAA,EAAG,SAAS,GAAG,WAAW,CAAA,CAAA;AAC9C;AAYO,SAAS,iBAAiB,eAAA,EAAgD;AAE/E,EAAA,MAAM,EAAE,SAAA,EAAW,cAAA,EAAe,IAAI,cAAA,EAAA,EAAA,YAAA,CAAA,iBAAA,CAAA,CAAA;AAEtC,EAAA,IAAI,OAAO,oBAAoB,QAAA,EAAU;AACvC,IAAA,OAAO,cAAA,CAAe,IAAI,eAAe,CAAA;AAAA,EAC3C;AACA,EAAA,OAAO,eAAA;AACT;AA0BO,SAAS,4BAA4B,YAAA,EAA0C;AAEpF,EAAA,MAAM,EAAE,SAAA,EAAW,cAAA,EAAe,IAAI,cAAA,EAAA,EAAA,YAAA,CAAA,iBAAA,CAAA,CAAA;AAEtC,EAAA,MAAM,aAAA,GAAgB,eAAe,IAAA,EAAK;AAG1C,EAAA,KAAA,MAAW,eAAe,YAAA,EAAc;AACtC,IAAA,KAAA,MAAW,QAAQ,aAAA,EAAe;AAChC,MAAA,IAAI;AACF,QAAA,MAAM,SAAA,GAAY,cAAA,CAAe,GAAA,CAAI,IAAI,CAAA;AACzC,QAAA,IAAI,SAAA,EAAW,gBAAgB,WAAA,EAAa;AAC1C,UAAA,OAAO,SAAA;AAAA,QACT;AAAA,MACF,CAAA,CAAA,MAAQ;AAAA,MAER;AAAA,IACF;AAAA,EACF;AAEA,EAAA,OAAO,IAAA;AACT;AASO,SAAS,6BAA6B,YAAA,EAAkC;AAC7E,EAAA,MAAM,EAAE,SAAA,EAAW,cAAA,EAAe,IAAI,cAAA,EAAA,EAAA,YAAA,CAAA,iBAAA,CAAA,CAAA;AAEtC,EAAA,MAAM,aAAA,GAAgB,eAAe,IAAA,EAAK;AAC1C,EAAA,MAAM,WAAqB,EAAC;AAE5B,EAAA,KAAA,MAAW,QAAQ,aAAA,EAAe;AAChC,IAAA,IAAI;AACF,MAAA,MAAM,SAAA,GAAY,cAAA,CAAe,GAAA,CAAI,IAAI,CAAA;AACzC,MAAA,IAAI,WAAW,WAAA,IAAe,YAAA,CAAa,QAAA,CAAS,SAAA,CAAU,WAAW,CAAA,EAAG;AAC1E,QAAA,QAAA,CAAS,KAAK,IAAI,CAAA;AAAA,MACpB;AAAA,IACF,CAAA,CAAA,MAAQ;AAAA,IAER;AAAA,EACF;AAEA,EAAA,OAAO,QAAA;AACT;;;ACnMO,IAAM,iBAAN,MAAgD;AAAA,EAGrD,YAAqB,SAAA,EAAsB;AAAtB,IAAA,IAAA,CAAA,SAAA,GAAA,SAAA;AAAA,EAAuB;AAAA,EAFnC,IAAA,GAAO,QAAA;AAAA,EAIhB,MAAM,MAAA,CAAO,KAAA,EAAe,OAAA,GAAyB,EAAC,EAA4B;AAChF,IAAA,MAAM,aAAa,IAAA,CAAK,GAAA,CAAI,OAAA,CAAQ,UAAA,IAAc,IAAI,GAAG,CAAA;AAEzD,IAAA,IAAI;AACF,MAAA,MAAM,eAAe,kBAAA,CAAmB;AAAA,QACtC,MAAA,EAAQ,MAAA;AAAA,QACR,IAAA,EAAM;AAAA,UACJ,CAAA,EAAG,KAAA;AAAA,UACH,GAAA,EAAK,UAAA;AAAA,UACL,GAAI,OAAA,CAAQ,OAAA,IAAW,EAAE,EAAA,EAAI,QAAQ,OAAA,EAAQ;AAAA,UAC7C,GAAI,OAAA,CAAQ,QAAA,IAAY,EAAE,EAAA,EAAI,QAAQ,QAAA,EAAS;AAAA,UAC/C,GAAG,OAAA,CAAQ;AAAA;AACb,OACD,CAAA;AAED,MAAA,MAAM,WAAW,MAAM,IAAA,CAAK,SAAA,CAAU,SAAA,CAAe,WAAW,YAAY,CAAA;AAE5E,MAAA,IAAI,CAAC,SAAS,OAAA,IAAW,CAAC,MAAM,OAAA,CAAQ,QAAA,CAAS,OAAO,CAAA,EAAG;AACzD,QAAA,MAAM,IAAI,MAAM,kCAAkC,CAAA;AAAA,MACpD;AAEA,MAAA,MAAM,OAAA,GAA0B,QAAA,CAAS,OAAA,CACtC,KAAA,CAAM,CAAA,EAAG,UAAU,CAAA,CACnB,GAAA,CAAI,CAAC,MAAA,EAAa,KAAA,MAAmB;AAAA,QACpC,KAAA,EAAO,OAAO,KAAA,IAAS,UAAA;AAAA,QACvB,GAAA,EAAK,OAAO,IAAA,IAAQ,EAAA;AAAA,QACpB,OAAA,EAAS,OAAO,OAAA,IAAW,EAAA;AAAA,QAC3B,UAAU,KAAA,GAAQ;AAAA,OACpB,CAAE,CAAA;AAEJ,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,IAAA;AAAA,QACT,KAAA;AAAA,QACA,UAAU,IAAA,CAAK,IAAA;AAAA,QACf,OAAA;AAAA,QACA,OAAO,OAAA,CAAQ;AAAA,OACjB;AAAA,IACF,SAAS,KAAA,EAAY;AACnB,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,KAAA;AAAA,QACT,KAAA;AAAA,QACA,UAAU,IAAA,CAAK,IAAA;AAAA,QACf,SAAS,EAAC;AAAA,QACV,KAAA,EAAO,CAAA;AAAA,QACP,KAAA,EAAO,MAAM,OAAA,IAAW;AAAA,OAC1B;AAAA,IACF;AAAA,EACF;AACF;;;ACrDO,IAAM,gBAAN,MAA+C;AAAA,EAGpD,YAAqB,SAAA,EAAsB;AAAtB,IAAA,IAAA,CAAA,SAAA,GAAA,SAAA;AAAA,EAAuB;AAAA,EAFnC,IAAA,GAAO,OAAA;AAAA,EAIhB,MAAM,MAAA,CAAO,KAAA,EAAe,OAAA,GAAyB,EAAC,EAA4B;AAChF,IAAA,MAAM,aAAa,IAAA,CAAK,GAAA,CAAI,OAAA,CAAQ,UAAA,IAAc,IAAI,EAAE,CAAA;AAExD,IAAA,IAAI;AACF,MAAA,MAAM,WAAA,GAAyD;AAAA,QAC7D,CAAA,EAAG,KAAA;AAAA,QACH,KAAA,EAAO,UAAA;AAAA,QACP,GAAI,OAAA,CAAQ,OAAA,IAAW,EAAE,OAAA,EAAS,QAAQ,OAAA,EAAQ;AAAA,QAClD,GAAI,OAAA,CAAQ,QAAA,IAAY,EAAE,WAAA,EAAa,QAAQ,QAAA,EAAS;AAAA,QACxD,GAAG,OAAA,CAAQ;AAAA,OACb;AAEA,MAAA,MAAM,WAAA,GAAc,iBAAiB,WAAW,CAAA;AAChD,MAAA,MAAM,WAAW,MAAM,IAAA,CAAK,UAAU,SAAA,CAAe,CAAA,YAAA,EAAe,WAAW,CAAA,CAAA,EAAI;AAAA,QACjF,MAAA,EAAQ;AAAA,OACT,CAAA;AAED,MAAA,IAAI,CAAC,QAAA,CAAS,GAAA,EAAK,OAAA,IAAW,CAAC,MAAM,OAAA,CAAQ,QAAA,CAAS,GAAA,CAAI,OAAO,CAAA,EAAG;AAClE,QAAA,MAAM,IAAI,MAAM,iCAAiC,CAAA;AAAA,MACnD;AAEA,MAAA,MAAM,OAAA,GAA0B,QAAA,CAAS,GAAA,CAAI,OAAA,CAC1C,KAAA,CAAM,CAAA,EAAG,UAAU,CAAA,CACnB,GAAA,CAAI,CAAC,MAAA,EAAa,KAAA,MAAmB;AAAA,QACpC,KAAA,EAAO,OAAO,KAAA,IAAS,UAAA;AAAA,QACvB,GAAA,EAAK,OAAO,GAAA,IAAO,EAAA;AAAA,QACnB,OAAA,EAAS,OAAO,WAAA,IAAe,EAAA;AAAA,QAC/B,UAAU,KAAA,GAAQ;AAAA,OACpB,CAAE,CAAA;AAEJ,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,IAAA;AAAA,QACT,KAAA;AAAA,QACA,UAAU,IAAA,CAAK,IAAA;AAAA,QACf,OAAA;AAAA,QACA,OAAO,OAAA,CAAQ;AAAA,OACjB;AAAA,IACF,SAAS,KAAA,EAAY;AACnB,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,KAAA;AAAA,QACT,KAAA;AAAA,QACA,UAAU,IAAA,CAAK,IAAA;AAAA,QACf,SAAS,EAAC;AAAA,QACV,KAAA,EAAO,CAAA;AAAA,QACP,KAAA,EAAO,MAAM,OAAA,IAAW;AAAA,OAC1B;AAAA,IACF;AAAA,EACF;AACF;;;ACrDO,IAAM,iBAAN,MAAgD;AAAA,EAGrD,YAAqB,SAAA,EAAsB;AAAtB,IAAA,IAAA,CAAA,SAAA,GAAA,SAAA;AAAA,EAAuB;AAAA,EAFnC,IAAA,GAAO,QAAA;AAAA,EAIhB,MAAM,MAAA,CAAO,KAAA,EAAe,OAAA,GAAyB,EAAC,EAA4B;AAChF,IAAA,MAAM,aAAa,IAAA,CAAK,GAAA,CAAI,OAAA,CAAQ,UAAA,IAAc,IAAI,EAAE,CAAA;AAExD,IAAA,IAAI;AAEF,MAAA,MAAM,IAAA,GAAO,IAAA,CAAK,SAAA,CAAU,MAAA,CAAO,IAAA;AACnC,MAAA,MAAM,MAAA,GAAS,IAAA,CAAK,IAAA,KAAS,SAAA,GAAY,KAAK,MAAA,GAAS,EAAA;AAEvD,MAAA,MAAM,eAAe,kBAAA,CAAmB;AAAA,QACtC,MAAA,EAAQ,MAAA;AAAA,QACR,IAAA,EAAM;AAAA,UACJ,OAAA,EAAS,MAAA;AAAA,UACT,KAAA;AAAA,UACA,WAAA,EAAa,UAAA;AAAA,UACb,YAAA,EAAc,OAAA,CAAQ,aAAA,EAAe,YAAA,IAAgB,OAAA;AAAA,UACrD,cAAA,EAAgB,OAAA,CAAQ,aAAA,EAAe,cAAA,IAAkB,KAAA;AAAA,UACzD,mBAAA,EAAqB,OAAA,CAAQ,aAAA,EAAe,mBAAA,IAAuB,KAAA;AAAA,UACnE,GAAG,OAAA,CAAQ;AAAA;AACb,OACD,CAAA;AAED,MAAA,MAAM,WAAW,MAAM,IAAA,CAAK,SAAA,CAAU,SAAA,CAAe,WAAW,YAAY,CAAA;AAE5E,MAAA,IAAI,CAAC,SAAS,OAAA,IAAW,CAAC,MAAM,OAAA,CAAQ,QAAA,CAAS,OAAO,CAAA,EAAG;AACzD,QAAA,MAAM,IAAI,MAAM,kCAAkC,CAAA;AAAA,MACpD;AAEA,MAAA,MAAM,OAAA,GAA0B,QAAA,CAAS,OAAA,CACtC,KAAA,CAAM,CAAA,EAAG,UAAU,CAAA,CACnB,GAAA,CAAI,CAAC,MAAA,EAAa,KAAA,MAAmB;AAAA,QACpC,KAAA,EAAO,OAAO,KAAA,IAAS,UAAA;AAAA,QACvB,GAAA,EAAK,OAAO,GAAA,IAAO,EAAA;AAAA,QACnB,OAAA,EAAS,OAAO,OAAA,IAAW,EAAA;AAAA,QAC3B,UAAU,KAAA,GAAQ;AAAA,OACpB,CAAE,CAAA;AAEJ,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,IAAA;AAAA,QACT,KAAA;AAAA,QACA,UAAU,IAAA,CAAK,IAAA;AAAA,QACf,OAAA;AAAA,QACA,OAAO,OAAA,CAAQ;AAAA,OACjB;AAAA,IACF,SAAS,KAAA,EAAY;AACnB,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,KAAA;AAAA,QACT,KAAA;AAAA,QACA,UAAU,IAAA,CAAK,IAAA;AAAA,QACf,SAAS,EAAC;AAAA,QACV,KAAA,EAAO,CAAA;AAAA,QACP,KAAA,EAAO,MAAM,OAAA,IAAW;AAAA,OAC1B;AAAA,IACF;AAAA,EACF;AACF;;;AC5DA,WAAA,EAAA;AAEA,IAAM,iBAAiB,MAAA,CAAO,KAAA,CAAM,EAAE,SAAA,EAAW,oBAAoB,CAAA;AAE9D,IAAM,mBAAN,MAAkD;AAAA,EAGvD,YAAqB,SAAA,EAAsB;AAAtB,IAAA,IAAA,CAAA,SAAA,GAAA,SAAA;AAAA,EAAuB;AAAA,EAFnC,IAAA,GAAO,UAAA;AAAA,EAIhB,MAAM,MAAA,CAAO,KAAA,EAAe,OAAA,GAAyB,EAAC,EAA4B;AAChF,IAAA,MAAM,aAAa,IAAA,CAAK,GAAA,CAAI,OAAA,CAAQ,UAAA,IAAc,IAAI,GAAG,CAAA;AACzD,IAAA,cAAA,CAAe,MAAM,EAAE,KAAA,EAAO,UAAA,EAAY,OAAA,IAAW,yBAAyB,CAAA;AAE9E,IAAA,IAAI;AAEF,MAAA,MAAM,WAAA,GAAyD;AAAA,QAC7D,CAAA,EAAG,KAAA;AAAA,QACH,GAAA,EAAK,UAAA;AAAA,QACL,KAAA,EAAO,CAAA;AAAA,QACP,kBAAA,EAAoB,KAAA;AAAA,QACpB,WAAA,EAAa,KAAA;AAAA,QACb,qCAAA,EAAuC,KAAA;AAAA,QACvC,IAAA,EAAM,CAAA;AAAA,QACN,GAAI,OAAA,CAAQ,OAAA,IAAW,EAAE,EAAA,EAAI,QAAQ,OAAA,EAAQ;AAAA,QAC7C,GAAI,OAAA,CAAQ,QAAA,IAAY,EAAE,EAAA,EAAI,QAAQ,QAAA,EAAS;AAAA,QAC/C,GAAG,OAAA,CAAQ;AAAA,OACb;AAGA,MAAA,MAAM,OAAA,GAAU,KAAK,SAAA,CAAU,OAAA;AAC/B,MAAA,MAAM,OAAO,OAAA,GAAU,IAAI,GAAA,CAAI,OAAO,EAAE,IAAA,GAAO,qCAAA;AAC/C,MAAA,cAAA,CAAe,KAAA,CAAM,EAAE,OAAA,EAAS,IAAA,IAAQ,qBAAqB,CAAA;AAG7D,MAAA,IAAI,MAAA,GAAS,EAAA;AACb,MAAA,IAAI;AACF,QAAA,MAAA,GAAS,IAAA,CAAK,UAAU,SAAA,EAAU;AAClC,QAAA,cAAA,CAAe,KAAA,CAAM,EAAE,SAAA,EAAW,CAAC,CAAC,QAAQ,SAAA,EAAW,MAAA,EAAQ,MAAA,EAAO,EAAG,aAAa,CAAA;AAAA,MACxF,SAAS,CAAA,EAAQ;AACf,QAAA,cAAA,CAAe,MAAM,EAAE,KAAA,EAAO,CAAA,CAAE,OAAA,IAAW,uBAAuB,CAAA;AAClE,QAAA,MAAM,IAAI,MAAM,mDAAmD,CAAA;AAAA,MACrE;AAEA,MAAA,MAAM,WAAA,GAAc,iBAAiB,WAAW,CAAA;AAChD,MAAA,MAAM,UAAA,GAAa,WAAW,WAAW,CAAA,CAAA;AACzC,MAAA,cAAA,CAAe,MAAM,EAAE,UAAA,EAAY,MAAA,EAAQ,KAAA,IAAS,yBAAyB,CAAA;AAE7E,MAAA,MAAM,QAAA,GAAW,MAAM,IAAA,CAAK,SAAA,CAAU,UAAe,UAAA,EAAY;AAAA,QAC/D,MAAA,EAAQ,KAAA;AAAA,QACR,OAAA,EAAS;AAAA,UACP,gBAAA,EAAkB,MAAA;AAAA,UAClB,iBAAA,EAAmB;AAAA;AACrB,OACD,CAAA;AAED,MAAA,cAAA,CAAe,KAAA,CAAM;AAAA,QACnB,WAAA,EAAa,CAAC,CAAC,QAAA;AAAA,QACf,OAAA,EAAS,CAAC,CAAC,QAAA,EAAU,IAAA;AAAA,QACrB,QAAA,EAAU,UAAU,IAAA,GAAO,MAAA,CAAO,KAAK,QAAA,CAAS,IAAI,IAAI,EAAC;AAAA,QACzD,mBAAmB,CAAC,EAAE,UAAU,IAAA,EAAM,eAAA,IAAmB,UAAU,IAAA,EAAM,OAAA,CAAA;AAAA,QACzE,mBAAA,EAAA,CAAsB,UAAU,IAAA,EAAM,eAAA,IAAmB,UAAU,IAAA,EAAM,OAAA,IAAW,EAAC,EAAG;AAAA,SACvF,4BAA4B,CAAA;AAG/B,MAAA,MAAM,cAAA,GACJ,QAAA,CAAS,IAAA,EAAM,eAAA,IACf,QAAA,CAAS,IAAA,EAAM,OAAA,IACf,QAAA,CAAS,eAAA,IACT,QAAA,CAAS,OAAA,IACT,EAAC;AAEH,MAAA,IAAI,CAAC,KAAA,CAAM,OAAA,CAAQ,cAAc,CAAA,EAAG;AAClC,QAAA,cAAA,CAAe,KAAA,CAAM;AAAA,UACnB,cAAc,OAAO,cAAA;AAAA,UACrB,UAAU,IAAA,CAAK,SAAA,CAAU,QAAQ,CAAA,CAAE,KAAA,CAAM,GAAG,GAAG;AAAA,WAC9C,mDAAmD,CAAA;AACtD,QAAA,MAAM,IAAI,MAAM,uCAAuC,CAAA;AAAA,MACzD;AAEA,MAAA,MAAM,OAAA,GAA0B,eAC7B,KAAA,CAAM,CAAA,EAAG,UAAU,CAAA,CACnB,GAAA,CAAI,CAAC,MAAA,EAAa,KAAA,MAAmB;AAAA,QACpC,KAAA,EAAO,OAAO,KAAA,IAAS,UAAA;AAAA,QACvB,GAAA,EAAK,MAAA,CAAO,IAAA,IAAQ,MAAA,CAAO,GAAA,IAAO,EAAA;AAAA,QAClC,OAAA,EAAS,MAAA,CAAO,OAAA,IAAW,MAAA,CAAO,WAAA,IAAe,EAAA;AAAA,QACjD,UAAU,KAAA,GAAQ;AAAA,OACpB,CAAE,CAAA;AAEJ,MAAA,cAAA,CAAe,KAAA,CAAM;AAAA,QACnB,OAAA,EAAS,IAAA;AAAA,QACT,aAAa,OAAA,CAAQ,MAAA;AAAA,QACrB,UAAA,EAAY,OAAA,CAAQ,CAAC,CAAA,EAAG;AAAA,SACvB,wCAAwC,CAAA;AAE3C,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,IAAA;AAAA,QACT,KAAA;AAAA,QACA,UAAU,IAAA,CAAK,IAAA;AAAA,QACf,OAAA;AAAA,QACA,OAAO,OAAA,CAAQ;AAAA,OACjB;AAAA,IACF,SAAS,KAAA,EAAY;AACnB,MAAA,cAAA,CAAe,KAAA,CAAM;AAAA,QACnB,OAAO,KAAA,CAAM,OAAA;AAAA,QACb,OAAO,KAAA,CAAM;AAAA,SACZ,wBAAwB,CAAA;AAC3B,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,KAAA;AAAA,QACT,KAAA;AAAA,QACA,UAAU,IAAA,CAAK,IAAA;AAAA,QACf,SAAS,EAAC;AAAA,QACV,KAAA,EAAO,CAAA;AAAA,QACP,KAAA,EAAO,MAAM,OAAA,IAAW;AAAA,OAC1B;AAAA,IACF;AAAA,EACF;AACF;;;ALvCO,IAAM,iBAAN,MAAqB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAM1B,OAAO,OAAO,MAAA,EAA+C;AAE3D,IAAA,MAAM,SAAA,GACJ,OAAO,MAAA,CAAO,SAAA,KAAc,QAAA,GACxB,UAAU,GAAA,CAAI,MAAA,CAAO,SAAS,CAAA,GAC9B,MAAA,CAAO,SAAA;AAEb,IAAA,IAAI,CAAC,SAAA,EAAW;AACd,MAAA,MAAM,IAAI,KAAA;AAAA,QACR,wBAAwB,OAAO,MAAA,CAAO,cAAc,QAAA,GAAW,MAAA,CAAO,YAAY,SAAS,CAAA;AAAA,OAC7F;AAAA,IACF;AAGA,IAAA,MAAM,cAAc,SAAA,CAAU,WAAA;AAG9B,IAAA,QAAQ,WAAA;AAAa,MACnB,KAAK,QAAA;AACH,QAAA,OAAO,IAAI,eAAe,SAAS,CAAA;AAAA,MAErC,KAAK,cAAA;AACH,QAAA,OAAO,IAAI,cAAc,SAAS,CAAA;AAAA,MAEpC,KAAK,QAAA;AACH,QAAA,OAAO,IAAI,eAAe,SAAS,CAAA;AAAA,MAErC,KAAK,iBAAA;AACH,QAAA,OAAO,IAAI,iBAAiB,SAAS,CAAA;AAAA,MAEvC;AACE,QAAA,MAAM,IAAI,KAAA;AAAA,UACR,gCAAgC,WAAW,CAAA,0DAAA;AAAA,SAC7C;AAAA;AACJ,EACF;AACF;;;AMmBA,IAAM,gBAAA,uBAAuB,GAAA,EAAiC;AASvD,SAAS,sBAAA,CACd,aACA,aAAA,EACM;AACN,EAAA,gBAAA,CAAiB,GAAA,CAAI,aAAa,aAAa,CAAA;AACjD;AAKO,SAAS,4BAAA,GAAyC;AACvD,EAAA,OAAO,KAAA,CAAM,IAAA,CAAK,gBAAA,CAAiB,IAAA,EAAM,CAAA;AAC3C;AAgCO,IAAM,cAAA,GAAN,MAAM,eAAA,CAAe;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAc1B,OAAO,OAAO,MAAA,EAA+C;AAC3D,IAAA,MAAM,SAAA,GAAY,gBAAA,CAAiB,MAAA,CAAO,SAAS,CAAA;AACnD,IAAA,MAAM,cAAc,SAAA,CAAU,WAAA;AAE9B,IAAA,IAAI,CAAC,WAAA,EAAa;AAChB,MAAA,MAAM,IAAI,KAAA;AAAA,QACR,CAAA,WAAA,EAAc,UAAU,IAAI,CAAA,kEAAA;AAAA,OAE9B;AAAA,IACF;AAEA,IAAA,MAAM,aAAA,GAAgB,gBAAA,CAAiB,GAAA,CAAI,WAAW,CAAA;AAEtD,IAAA,IAAI,CAAC,aAAA,EAAe;AAClB,MAAA,MAAM,aAAa,4BAAA,EAA6B;AAChD,MAAA,MAAM,IAAI,KAAA;AAAA,QACR,CAAA,gDAAA,EAAmD,WAAW,CAAA,yBAAA,EACrC,UAAA,CAAW,MAAA,GAAS,IAAI,UAAA,CAAW,IAAA,CAAK,IAAI,CAAA,GAAI,MAAM,CAAA,0CAAA;AAAA,OAEjF;AAAA,IACF;AAEA,IAAA,OAAO,IAAI,cAAc,SAAS,CAAA;AAAA,EACpC;AAAA;AAAA;AAAA;AAAA,EAKA,OAAO,YAAY,WAAA,EAA8B;AAC/C,IAAA,OAAO,gBAAA,CAAiB,IAAI,WAAW,CAAA;AAAA,EACzC;AAAA;AAAA;AAAA;AAAA,EAKA,OAAO,aAAA,GAA0B;AAC/B,IAAA,OAAO,4BAAA,EAA6B;AAAA,EACtC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAoBA,OAAO,mBAAmB,MAAA,EAAuD;AAC/E,IAAA,MAAM,YAA+B,EAAC;AAGtC,IAAA,SAAA,CAAU,IAAA,CAAK,gBAAe,MAAA,CAAO,EAAE,WAAW,MAAA,CAAO,OAAA,EAAS,CAAC,CAAA;AAGnE,IAAA,IAAI,OAAO,SAAA,EAAW;AACpB,MAAA,KAAA,MAAW,QAAA,IAAY,OAAO,SAAA,EAAW;AACvC,QAAA,IAAI;AACF,UAAA,SAAA,CAAU,KAAK,eAAA,CAAe,MAAA,CAAO,EAAE,SAAA,EAAW,QAAA,EAAU,CAAC,CAAA;AAAA,QAC/D,CAAA,CAAA,MAAQ;AAAA,QAER;AAAA,MACF;AAAA,IACF;AAEA,IAAA,OAAO,IAAI,uBAAuB,SAAS,CAAA;AAAA,EAC7C;AACF;AAOA,IAAM,yBAAN,MAAwD;AAAA,EAItD,YAAoB,SAAA,EAA8B;AAA9B,IAAA,IAAA,CAAA,SAAA,GAAA,SAAA;AAClB,IAAA,IAAI,SAAA,CAAU,WAAW,CAAA,EAAG;AAC1B,MAAA,MAAM,IAAI,MAAM,mDAAmD,CAAA;AAAA,IACrE;AAGA,IAAA,IAAA,CAAK,SAAA,GAAY,SAAA,CAAU,CAAC,CAAA,CAAG,SAAA;AAAA,EACjC;AAAA,EAVS,IAAA,GAAO,UAAA;AAAA,EACP,SAAA;AAAA,EAWT,MAAM,MAAA,CAAO,GAAA,EAAa,OAAA,EAAkD;AAC1E,IAAA,IAAI,SAAA;AACJ,IAAA,MAAM,qBAA+B,EAAC;AAEtC,IAAA,KAAA,MAAW,QAAA,IAAY,KAAK,SAAA,EAAW;AACrC,MAAA,kBAAA,CAAmB,IAAA,CAAK,SAAS,IAAI,CAAA;AAErC,MAAA,IAAI;AACF,QAAA,MAAM,MAAA,GAAS,MAAM,QAAA,CAAS,MAAA,CAAO,KAAK,OAAO,CAAA;AAEjD,QAAA,IAAI,OAAO,OAAA,EAAS;AAClB,UAAA,OAAO;AAAA,YACL,GAAG,MAAA;AAAA,YACH,QAAA,EAAU,CAAA,SAAA,EAAY,QAAA,CAAS,IAAI,CAAA,CAAA;AAAA,WACrC;AAAA,QACF;AAEA,QAAA,SAAA,GAAY,MAAA,CAAO,KAAA;AAAA,MACrB,SAAS,KAAA,EAAY;AACnB,QAAA,SAAA,GAAY,KAAA,CAAM,OAAA;AAAA,MACpB;AAAA,IACF;AAEA,IAAA,OAAO;AAAA,MACL,OAAA,EAAS,KAAA;AAAA,MACT,GAAA;AAAA,MACA,QAAA,EAAU,UAAA;AAAA,MACV,OAAO,CAAA,6BAAA,EAAgC,kBAAA,CAAmB,KAAK,MAAM,CAAC,iBAAiB,SAAS,CAAA;AAAA,KAClG;AAAA,EACF;AAAA,EAEA,gBAAgB,OAAA,EAAiC;AAE/C,IAAA,OAAO,KAAK,SAAA,CAAU,IAAA,CAAK,OAAK,CAAA,CAAE,eAAA,GAAkB,OAAO,CAAC,CAAA;AAAA,EAC9D;AACF,CAAA;;;ACpRO,IAAM,kBAAN,MAAiD;AAAA,EAGtD,YAAqB,SAAA,EAAsB;AAAtB,IAAA,IAAA,CAAA,SAAA,GAAA,SAAA;AAAA,EAAuB;AAAA,EAFnC,IAAA,GAAO,SAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAShB,MAAM,MAAA,CAAO,GAAA,EAAa,OAAA,GAAyB,EAAC,EAA4B;AAC9E,IAAA,MAAM,SAAA,GAAY,KAAK,GAAA,EAAI;AAE3B,IAAA,IAAI;AAEF,MAAA,MAAM,MAAA,GAAS,KAAK,SAAA,EAAU;AAG9B,MAAA,MAAM,cAAc,OAAA,CAAQ,aAAA;AAG5B,MAAA,MAAM,WAAA,GAAyD;AAAA,QAC7D,GAAA;AAAA,QACA,MAAA,EAAQ,MAAA;AAAA;AAAA,QAER,SAAA,EAAW,aAAa,QAAA,IAAY,IAAA;AAAA,QACpC,aAAA,EAAe,aAAa,YAAA,IAAgB;AAAA,OAC9C;AAGA,MAAA,IAAI,OAAA,CAAQ,eAAA,IAAmB,WAAA,EAAa,OAAA,EAAS;AACnD,QAAA,WAAA,CAAY,QAAA,GAAW,OAAA,CAAQ,eAAA,IAAmB,WAAA,EAAa,OAAA,IAAW,EAAA;AAAA,MAC5E;AAEA,MAAA,IAAI,aAAa,IAAA,EAAM;AACrB,QAAA,WAAA,CAAY,OAAO,WAAA,CAAY,IAAA;AAAA,MACjC;AAEA,MAAA,IAAI,OAAA,CAAQ,eAAA,IAAmB,WAAA,EAAa,YAAA,KAAiB,UAAA,EAAY;AACvE,QAAA,WAAA,CAAY,aAAA,GAAgB,UAAA;AAAA,MAC9B;AAEA,MAAA,IAAI,OAAA,CAAQ,iBAAA,IAAqB,WAAA,EAAa,UAAA,EAAY;AACxD,QAAA,WAAA,CAAY,UAAA,GAAa,IAAA;AACzB,QAAA,IAAI,aAAa,kBAAA,EAAoB;AACnC,UAAA,WAAA,CAAY,mBAAA,GAAsB,IAAA;AAAA,QACpC;AAAA,MACF;AAEA,MAAA,IAAI,aAAa,SAAA,EAAW;AAC1B,QAAA,WAAA,CAAY,SAAA,GAAY,IAAA;AAAA,MAC1B;AAEA,MAAA,IAAI,aAAa,YAAA,EAAc;AAC7B,QAAA,WAAA,CAAY,gBAAgB,WAAA,CAAY,YAAA;AAAA,MAC1C;AAEA,MAAA,IAAI,aAAa,cAAA,EAAgB;AAC/B,QAAA,WAAA,CAAY,kBAAkB,WAAA,CAAY,cAAA;AAAA,MAC5C;AAEA,MAAA,IAAI,aAAa,SAAA,EAAW;AAC1B,QAAA,WAAA,CAAY,aAAa,WAAA,CAAY,SAAA;AAAA,MACvC;AAEA,MAAA,IAAI,aAAa,MAAA,EAAQ;AACvB,QAAA,WAAA,CAAY,SAAS,WAAA,CAAY,MAAA;AAAA,MACnC;AAEA,MAAA,IAAI,aAAa,cAAA,EAAgB;AAC/B,QAAA,WAAA,CAAY,eAAA,GAAkB,IAAA;AAAA,MAChC;AAEA,MAAA,IAAI,aAAa,YAAA,EAAc;AAC7B,QAAA,WAAA,CAAY,gBAAgB,WAAA,CAAY,YAAA;AAAA,MAC1C;AAEA,MAAA,IAAI,aAAa,cAAA,EAAgB;AAC/B,QAAA,WAAA,CAAY,kBAAkB,WAAA,CAAY,cAAA;AAAA,MAC5C;AAGA,MAAA,IAAI,OAAA,CAAQ,OAAA,IAAW,WAAA,EAAa,aAAA,KAAkB,KAAA,EAAO;AAC3D,QAAA,WAAA,CAAY,cAAA,GAAiB,IAAA;AAAA,MAC/B;AAGA,MAAA,MAAM,QAAA,GAAW,CAAA,EAAA,EAAK,gBAAA,CAAiB,WAAW,CAAC,CAAA,CAAA;AAGnD,MAAA,MAAM,QAAA,GAAW,MAAM,IAAA,CAAK,SAAA,CAAU,MAAM,QAAA,EAAU;AAAA,QACpD,MAAA,EAAQ,KAAA;AAAA,QACR,SAAS,OAAA,CAAQ,OAAA;AAAA,QACjB,OAAA,EAAS,QAAQ,OAAA,IAAW;AAAA;AAAA,OAC7B,CAAA;AAGD,MAAA,MAAM,UAAU,MAAA,CAAO,WAAA,CAAY,QAAA,CAAS,OAAA,CAAQ,SAAS,CAAA;AAC7D,MAAA,MAAM,QAAA,GAAW,OAAA,CAAQ,cAAc,CAAA,IAAK,GAAA;AAC5C,MAAA,MAAM,aAAa,QAAA,CAAS,OAAA,CAAQ,WAAW,CAAA,IAAK,OAAO,EAAE,CAAA;AAG7D,MAAA,IAAI,CAAC,SAAS,EAAA,EAAI;AAChB,QAAA,MAAM,SAAA,GAAY,MAAM,QAAA,CAAS,IAAA,EAAK;AACtC,QAAA,OAAO;AAAA,UACL,OAAA,EAAS,KAAA;AAAA,UACT,GAAA;AAAA,UACA,UAAU,IAAA,CAAK,IAAA;AAAA,UACf,KAAA,EAAO,CAAA,mBAAA,EAAsB,QAAA,CAAS,MAAM,MAAM,SAAS,CAAA,CAAA;AAAA,UAC3D,YAAY,QAAA,CAAS,MAAA;AAAA,UACrB,UAAA,EAAY,IAAA,CAAK,GAAA,EAAI,GAAI;AAAA,SAC3B;AAAA,MACF;AAGA,MAAA,MAAM,WAAA,GAAc,OAAA,CAAQ,cAAc,CAAA,IAAK,EAAA;AAC/C,MAAA,MAAM,UAAA,GAAa,YAAY,aAAA,KAAkB,UAAA;AACjD,MAAA,MAAM,eAAe,WAAA,CAAY,UAAA;AAEjC,MAAA,IAAI,MAAA;AAEJ,MAAA,IAAI,YAAA,IAAgB,CAAC,UAAA,EAAY;AAE/B,QAAA,MAAM,MAAA,GAAS,MAAM,QAAA,CAAS,IAAA,EAAK;AACnC,QAAA,MAAA,GAAS;AAAA,UACP,KAAA,EAAO,EAAA;AAAA,UACP,OAAA,EAAS,EAAA;AAAA,UACT,UAAA,EAAY;AAAA,SACd;AAAA,MACF,CAAA,MAAO;AACL,QAAA,MAAM,OAAA,GAAU,MAAM,QAAA,CAAS,IAAA,EAAK;AAGpC,QAAA,IAAI,KAAA,GAAQ,EAAA;AACZ,QAAA,IAAI,CAAC,UAAA,IAAc,WAAA,CAAY,QAAA,CAAS,WAAW,CAAA,EAAG;AACpD,UAAA,MAAM,UAAA,GAAa,OAAA,CAAQ,KAAA,CAAM,+BAA+B,CAAA;AAChE,UAAA,KAAA,GAAQ,UAAA,GAAa,CAAC,CAAA,EAAG,IAAA,EAAK,IAAK,EAAA;AAAA,QACrC,WAAW,UAAA,EAAY;AAErB,UAAA,MAAM,YAAA,GAAe,OAAA,CAAQ,KAAA,CAAM,aAAa,CAAA;AAChD,UAAA,KAAA,GAAQ,YAAA,GAAe,CAAC,CAAA,EAAG,IAAA,EAAK,IAAK,EAAA;AAAA,QACvC;AAEA,QAAA,MAAA,GAAS;AAAA,UACP,KAAA;AAAA,UACA,OAAA,EAAS,UAAA,GAAa,OAAA,GAAU,IAAA,CAAK,YAAY,OAAO,CAAA;AAAA,UACxD,IAAA,EAAM,OAAA,CAAQ,WAAA,IAAe,CAAC,aAAa,OAAA,GAAU,KAAA,CAAA;AAAA,UACrD,QAAA,EAAU,aAAa,OAAA,GAAU,KAAA;AAAA,SACnC;AAGA,QAAA,IAAI,OAAA,CAAQ,YAAA,IAAgB,CAAC,UAAA,EAAY;AACvC,UAAA,MAAA,CAAO,KAAA,GAAQ,IAAA,CAAK,YAAA,CAAa,OAAA,EAAS,QAAQ,CAAA;AAAA,QACpD;AAGA,QAAA,IAAI,CAAC,UAAA,EAAY;AACf,UAAA,MAAA,CAAO,QAAA,GAAW,IAAA,CAAK,eAAA,CAAgB,OAAO,CAAA;AAAA,QAChD;AAAA,MACF;AAEA,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,IAAA;AAAA,QACT,GAAA;AAAA,QACA,QAAA;AAAA,QACA,UAAU,IAAA,CAAK,IAAA;AAAA,QACf,MAAA;AAAA,QACA,UAAA;AAAA,QACA,UAAA,EAAY,IAAA,CAAK,GAAA,EAAI,GAAI,SAAA;AAAA,QACzB,UAAA,EAAY,YAAY,SAAA,KAAc;AAAA,OACxC;AAAA,IACF,SAAS,KAAA,EAAY;AACnB,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,KAAA;AAAA,QACT,GAAA;AAAA,QACA,UAAU,IAAA,CAAK,IAAA;AAAA,QACf,KAAA,EAAO,MAAM,OAAA,IAAW,eAAA;AAAA,QACxB,UAAA,EAAY,IAAA,CAAK,GAAA,EAAI,GAAI;AAAA,OAC3B;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,gBAAgB,OAAA,EAAiC;AAC/C,IAAA,MAAM,SAAA,GAA6B;AAAA,MACjC,YAAA;AAAA,MACA,UAAA;AAAA,MACA,YAAA;AAAA,MACA,OAAA;AAAA,MACA,UAAA;AAAA,MACA,OAAA;AAAA,MACA,SAAA;AAAA,MACA;AAAA,KACF;AACA,IAAA,OAAO,SAAA,CAAU,SAAS,OAAO,CAAA;AAAA,EACnC;AAAA;AAAA;AAAA;AAAA,EAKQ,SAAA,GAAoB;AAC1B,IAAA,OAAO,IAAA,CAAK,UAAU,SAAA,EAAU;AAAA,EAClC;AAAA;AAAA;AAAA;AAAA,EAKQ,YAAY,IAAA,EAAsB;AAExC,IAAA,IAAI,IAAA,GAAO,IAAA,CAAK,OAAA,CAAQ,mCAAA,EAAqC,EAAE,CAAA;AAC/D,IAAA,IAAA,GAAO,IAAA,CAAK,OAAA,CAAQ,iCAAA,EAAmC,EAAE,CAAA;AAGzD,IAAA,IAAA,GAAO,IAAA,CAAK,OAAA,CAAQ,UAAA,EAAY,GAAG,CAAA;AAGnC,IAAA,IAAA,GAAO,IAAA,CACJ,QAAQ,SAAA,EAAW,GAAG,EACtB,OAAA,CAAQ,QAAA,EAAU,GAAG,CAAA,CACrB,OAAA,CAAQ,OAAA,EAAS,GAAG,CAAA,CACpB,OAAA,CAAQ,OAAA,EAAS,GAAG,CAAA,CACpB,OAAA,CAAQ,WAAW,GAAG,CAAA,CACtB,OAAA,CAAQ,QAAA,EAAU,GAAG,CAAA;AAGxB,IAAA,IAAA,GAAO,IAAA,CAAK,OAAA,CAAQ,MAAA,EAAQ,GAAG,EAAE,IAAA,EAAK;AAEtC,IAAA,OAAO,IAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKQ,YAAA,CAAa,MAAc,OAAA,EAAuD;AACxF,IAAA,MAAM,QAA8C,EAAC;AACrD,IAAA,MAAM,SAAA,GAAY,kDAAA;AAClB,IAAA,IAAI,KAAA;AAEJ,IAAA,OAAA,CAAQ,KAAA,GAAQ,SAAA,CAAU,IAAA,CAAK,IAAI,OAAO,IAAA,EAAM;AAC9C,MAAA,IAAI;AACF,QAAA,MAAM,IAAA,GAAO,MAAM,CAAC,CAAA;AACpB,QAAA,MAAM,IAAA,GAAO,KAAA,CAAM,CAAC,CAAA,EAAG,MAAK,IAAK,EAAA;AAGjC,QAAA,IAAI,CAAC,IAAA,EAAM;AAGX,QAAA,MAAM,WAAA,GAAc,IAAI,GAAA,CAAI,IAAA,EAAM,OAAO,CAAA,CAAE,IAAA;AAG3C,QAAA,IAAI,CAAC,YAAY,UAAA,CAAW,aAAa,KAAK,CAAC,WAAA,CAAY,UAAA,CAAW,SAAS,CAAA,EAAG;AAChF,UAAA,KAAA,CAAM,KAAK,EAAE,GAAA,EAAK,aAAa,IAAA,EAAM,IAAA,IAAQ,aAAa,CAAA;AAAA,QAC5D;AAAA,MACF,CAAA,CAAA,MAAQ;AAAA,MAER;AAAA,IACF;AAEA,IAAA,OAAO,KAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKQ,gBACN,IAAA,EAC0B;AAC1B,IAAA,MAAM,WAAqC,EAAC;AAG5C,IAAA,MAAM,SAAA,GAAY,6EAAA;AAClB,IAAA,IAAI,KAAA;AAEJ,IAAA,OAAA,CAAQ,KAAA,GAAQ,SAAA,CAAU,IAAA,CAAK,IAAI,OAAO,IAAA,EAAM;AAC9C,MAAA,MAAM,IAAA,GAAO,KAAA,CAAM,CAAC,CAAA,EAAG,WAAA,EAAY;AACnC,MAAA,MAAM,OAAA,GAAU,MAAM,CAAC,CAAA;AAGvB,MAAA,IAAI,CAAC,IAAA,IAAQ,CAAC,OAAA,EAAS;AAEvB,MAAA,IAAI,IAAA,KAAS,aAAA,IAAiB,IAAA,KAAS,gBAAA,EAAkB;AACvD,QAAA,QAAA,CAAS,WAAA,GAAc,SAAS,WAAA,IAAe,OAAA;AAAA,MACjD,CAAA,MAAA,IAAW,SAAS,QAAA,EAAU;AAC5B,QAAA,QAAA,CAAS,MAAA,GAAS,OAAA;AAAA,MACpB,CAAA,MAAA,IAAW,SAAS,cAAA,EAAgB;AAClC,QAAA,QAAA,CAAS,QAAA,GAAW,OAAA;AAAA,MACtB,CAAA,MAAA,IAAW,SAAS,UAAA,EAAY;AAC9B,QAAA,QAAA,CAAS,OAAA,GAAU,OAAA;AAAA,MACrB,CAAA,MAAA,IAAW,SAAS,wBAAA,EAA0B;AAC5C,QAAA,QAAA,CAAS,aAAA,GAAgB,OAAA;AAAA,MAC3B;AAAA,IACF;AAGA,IAAA,MAAM,YAAA,GAAe,IAAA,CAAK,KAAA,CAAM,qEAAqE,CAAA;AACrG,IAAA,IAAI,YAAA,EAAc;AAChB,MAAA,QAAA,CAAS,OAAA,GAAU,aAAa,CAAC,CAAA;AAAA,IACnC;AAEA,IAAA,OAAO,OAAO,IAAA,CAAK,QAAQ,CAAA,CAAE,MAAA,GAAS,IAAI,QAAA,GAAW,MAAA;AAAA,EACvD;AACF,CAAA;AAGA,sBAAA,CAAuB,WAAW,eAAe,CAAA;;;AC7S1C,IAAM,8BAAA,GAAiC;;;AC+BvC,IAAM,+BAAA,GAAkC;;;AC9F/C,cAAA,EAAA;;;ACSO,IAAM,sBAAA,GAAuC,CAAC,WAAA,EAAa,QAAA,EAAU,WAAW,WAAW;AAK3F,SAAS,iBAAiB,MAAA,EAA6B;AAC5D,EAAA,OAAO,sBAAA,CAAuB,SAAS,MAAM,CAAA;AAC/C;AA+UO,SAAS,WAAW,KAAA,EAAwB;AACjD,EAAA,MAAM,GAAA,GAAM,KAAK,GAAA,EAAI;AACrB,EAAA,MAAM,KAAK,KAAA,CAAM,EAAA,IAAM,CAAA,KAAA,EAAQ,IAAA,CAAK,KAAK,CAAA,CAAA,EAAI,IAAA,CAAK,MAAA,GAAS,QAAA,CAAS,EAAE,EAAE,MAAA,CAAO,CAAA,EAAG,CAAC,CAAC,CAAA,CAAA;AAEpF,EAAA,OAAO;AAAA,IACL,EAAA;AAAA,IACA,MAAM,KAAA,CAAM,IAAA;AAAA,IACZ,aAAa,KAAA,CAAM,WAAA;AAAA,IACnB,MAAA,EAAQ,SAAA;AAAA,IACR,SAAA,EAAW,KAAA,CAAM,SAAA,IAAa,EAAC;AAAA,IAC/B,oBAAoB,KAAA,CAAM,kBAAA;AAAA,IAC1B,WAAW,KAAA,CAAM,SAAA;AAAA,IACjB,WAAW,KAAA,CAAM,SAAA;AAAA,IACjB,YAAY,KAAA,CAAM,UAAA;AAAA,IAClB,gBAAgB,KAAA,CAAM,cAAA;AAAA,IACtB,QAAA,EAAU,CAAA;AAAA,IACV,WAAA,EAAa,MAAM,WAAA,IAAe,CAAA;AAAA,IAClC,SAAA,EAAW,GAAA;AAAA,IACX,aAAA,EAAe,GAAA;AAAA,IACf,UAAU,KAAA,CAAM;AAAA,GAClB;AACF;AAMO,SAAS,WAAW,KAAA,EAAwB;AACjD,EAAA,MAAM,GAAA,GAAM,KAAK,GAAA,EAAI;AACrB,EAAA,MAAM,EAAA,GAAK,CAAA,KAAA,EAAQ,IAAA,CAAK,GAAA,EAAK,CAAA,CAAA,EAAI,IAAA,CAAK,MAAA,EAAO,CAAE,SAAS,EAAE,CAAA,CAAE,MAAA,CAAO,CAAA,EAAG,CAAC,CAAC,CAAA,CAAA;AAGxE,EAAA,MAAM,KAAA,GAAQ,MAAM,KAAA,CAAM,GAAA,CAAI,CAAC,SAAA,KAAc,UAAA,CAAW,SAAS,CAAC,CAAA;AAGlE,EAAA,MAAM,QAAA,uBAAe,GAAA,EAAoB;AACzC,EAAA,KAAA,MAAW,QAAQ,KAAA,EAAO;AACxB,IAAA,QAAA,CAAS,GAAA,CAAI,IAAA,CAAK,IAAA,EAAM,IAAA,CAAK,EAAE,CAAA;AAAA,EACjC;AAGA,EAAA,KAAA,IAAS,CAAA,GAAI,CAAA,EAAG,CAAA,GAAI,KAAA,CAAM,QAAQ,CAAA,EAAA,EAAK;AACrC,IAAA,MAAM,SAAA,GAAY,KAAA,CAAM,KAAA,CAAM,CAAC,CAAA;AAC/B,IAAA,MAAM,IAAA,GAAO,MAAM,CAAC,CAAA;AAEpB,IAAA,IAAI,SAAA,CAAU,SAAA,IAAa,SAAA,CAAU,SAAA,CAAU,SAAS,CAAA,EAAG;AACzD,MAAA,IAAA,CAAK,SAAA,GAAY,SAAA,CAAU,SAAA,CAAU,GAAA,CAAI,CAAC,GAAA,KAAQ;AAEhD,QAAA,IAAI,GAAA,CAAI,UAAA,CAAW,OAAO,CAAA,EAAG;AAC3B,UAAA,OAAO,GAAA;AAAA,QACT;AAGA,QAAA,MAAM,UAAA,GAAa,QAAA,CAAS,GAAA,CAAI,GAAG,CAAA;AACnC,QAAA,IAAI,CAAC,UAAA,EAAY;AACf,UAAA,MAAM,IAAI,KAAA,CAAM,CAAA,iBAAA,EAAoB,GAAG,CAAA,mBAAA,CAAqB,CAAA;AAAA,QAC9D;AACA,QAAA,OAAO,UAAA;AAAA,MACT,CAAC,CAAA;AAAA,IACH;AAAA,EACF;AAGA,EAAA,IAAI,CAAC,MAAM,cAAA,EAAgB;AACzB,IAAA,MAAM,KAAA,GAAQ,sBAAsB,KAAK,CAAA;AACzC,IAAA,IAAI,KAAA,EAAO;AAET,MAAA,MAAM,UAAA,GAAa,KAAA,CAAM,GAAA,CAAI,CAAC,MAAA,KAAW;AACvC,QAAA,MAAM,OAAO,KAAA,CAAM,IAAA,CAAK,CAAC,CAAA,KAAM,CAAA,CAAE,OAAO,MAAM,CAAA;AAC9C,QAAA,OAAO,IAAA,GAAO,KAAK,IAAA,GAAO,MAAA;AAAA,MAC5B,CAAC,CAAA;AACD,MAAA,MAAM,IAAI,oBAAA,CAAqB,UAAA,EAAY,EAAE,CAAA;AAAA,IAC/C;AAAA,EACF;AAEA,EAAA,OAAO;AAAA,IACL,EAAA;AAAA,IACA,MAAM,KAAA,CAAM,IAAA;AAAA,IACZ,SAAS,KAAA,CAAM,OAAA;AAAA,IACf,KAAA;AAAA,IACA,aAAa,KAAA,CAAM,WAAA;AAAA,IACnB,iBAAA,EAAmB,MAAM,iBAAA,IAAqB,IAAA;AAAA,IAC9C,MAAA,EAAQ,SAAA;AAAA,IACR,SAAA,EAAW,GAAA;AAAA,IACX,aAAA,EAAe,GAAA;AAAA,IACf,UAAU,KAAA,CAAM;AAAA,GAClB;AACF;AAOO,SAAS,cAAA,CAAe,MAAY,QAAA,EAA2B;AAEpE,EAAA,IAAI,IAAA,CAAK,WAAW,SAAA,EAAW;AAC7B,IAAA,OAAO,KAAA;AAAA,EACT;AAGA,EAAA,IAAI,IAAA,CAAK,SAAA,CAAU,MAAA,GAAS,CAAA,EAAG;AAC7B,IAAA,KAAA,MAAW,KAAA,IAAS,KAAK,SAAA,EAAW;AAClC,MAAA,MAAM,UAAU,QAAA,CAAS,IAAA,CAAK,CAAC,CAAA,KAAM,CAAA,CAAE,OAAO,KAAK,CAAA;AACnD,MAAA,IAAI,CAAC,OAAA,IAAW,OAAA,CAAQ,MAAA,KAAW,WAAA,EAAa;AAC9C,QAAA,OAAO,KAAA;AAAA,MACT;AAAA,IACF;AAAA,EACF;AAEA,EAAA,OAAO,IAAA;AACT;AAKO,SAAS,uBAAuB,IAAA,EAAoB;AACzD,EAAA,MAAM,UAAA,GAAa,IAAA,CAAK,KAAA,CAAM,MAAA,CAAO,CAAC,SAAS,cAAA,CAAe,IAAA,EAAM,IAAA,CAAK,KAAK,CAAC,CAAA;AAE/E,EAAA,IAAI,UAAA,CAAW,WAAW,CAAA,EAAG;AAC3B,IAAA,OAAO,EAAC;AAAA,EACV;AAGA,EAAA,IAAI,CAAC,KAAK,WAAA,EAAa;AACrB,IAAA,OAAO,CAAC,UAAA,CAAW,CAAC,CAAE,CAAA;AAAA,EACxB;AAGA,EAAA,MAAM,YAAA,GAAe,KAAK,KAAA,CAAM,MAAA,CAAO,CAAC,CAAA,KAAM,CAAA,CAAE,MAAA,KAAW,aAAa,CAAA,CAAE,MAAA;AAC1E,EAAA,MAAM,cAAA,GAAiB,IAAA,CAAK,WAAA,CAAY,gBAAA,GAAmB,YAAA;AAE3D,EAAA,IAAI,kBAAkB,CAAA,EAAG;AACvB,IAAA,OAAO,EAAC;AAAA,EACV;AAGA,EAAA,MAAM,aAAA,GAAgB,WAAW,MAAA,CAAO,CAAC,SAAS,IAAA,CAAK,SAAA,EAAW,aAAa,IAAI,CAAA;AAEnF,EAAA,IAAI,aAAA,CAAc,WAAW,CAAA,EAAG;AAE9B,IAAA,OAAO,CAAC,UAAA,CAAW,CAAC,CAAE,CAAA;AAAA,EACxB;AAGA,EAAA,IAAI,WAAA,GAAc,CAAC,GAAG,aAAa,CAAA;AACnC,EAAA,IAAI,IAAA,CAAK,WAAA,CAAY,QAAA,KAAa,UAAA,EAAY;AAC5C,IAAA,WAAA,CAAY,IAAA,CAAK,CAAC,CAAA,EAAG,CAAA,KAAA,CAAO,CAAA,CAAE,SAAA,EAAW,QAAA,IAAY,CAAA,KAAM,CAAA,CAAE,SAAA,EAAW,QAAA,IAAY,CAAA,CAAE,CAAA;AAAA,EACxF;AAIA,EAAA,OAAO,WAAA,CAAY,KAAA,CAAM,CAAA,EAAG,cAAc,CAAA;AAC5C;AAKA,eAAsB,iBAAA,CACpB,WACA,MAAA,EACkB;AAClB,EAAA,MAAM,KAAA,GAAQ,MAAM,MAAA,CAAO,GAAA,CAAI,UAAU,SAAS,CAAA;AAElD,EAAA,QAAQ,UAAU,QAAA;AAAU,IAC1B,KAAK,QAAA;AACH,MAAA,OAAO,KAAA,KAAU,MAAA;AAAA,IAEnB,KAAK,YAAA;AACH,MAAA,OAAO,KAAA,KAAU,MAAA;AAAA,IAEnB,KAAK,QAAA;AACH,MAAA,OAAO,UAAU,SAAA,CAAU,KAAA;AAAA,IAE7B,KAAK,UAAA;AACH,MAAA,IAAI,KAAA,CAAM,OAAA,CAAQ,KAAK,CAAA,EAAG;AACxB,QAAA,OAAO,KAAA,CAAM,QAAA,CAAS,SAAA,CAAU,KAAK,CAAA;AAAA,MACvC;AACA,MAAA,IAAI,OAAO,KAAA,KAAU,QAAA,IAAY,OAAO,SAAA,CAAU,UAAU,QAAA,EAAU;AACpE,QAAA,OAAO,KAAA,CAAM,QAAA,CAAS,SAAA,CAAU,KAAK,CAAA;AAAA,MACvC;AACA,MAAA,OAAO,KAAA;AAAA,IAET,KAAK,QAAA;AACH,MAAA,OAAO,CAAC,CAAC,KAAA;AAAA,IAEX,KAAK,cAAA;AACH,MAAA,IAAI,OAAO,KAAA,KAAU,QAAA,IAAY,OAAO,SAAA,CAAU,UAAU,QAAA,EAAU;AACpE,QAAA,OAAO,QAAQ,SAAA,CAAU,KAAA;AAAA,MAC3B;AACA,MAAA,OAAO,KAAA;AAAA,IAET,KAAK,WAAA;AACH,MAAA,IAAI,OAAO,KAAA,KAAU,QAAA,IAAY,OAAO,SAAA,CAAU,UAAU,QAAA,EAAU;AACpE,QAAA,OAAO,QAAQ,SAAA,CAAU,KAAA;AAAA,MAC3B;AACA,MAAA,OAAO,KAAA;AAAA,IAET;AACE,MAAA,OAAO,KAAA;AAAA;AAEb;AAKO,SAAS,gBAAA,CAAiB,MAAY,MAAA,EAA0B;AACrE,EAAA,MAAM,GAAA,GAAM,KAAK,GAAA,EAAI;AACrB,EAAA,MAAM,OAAA,GAAgB;AAAA,IACpB,GAAG,IAAA;AAAA,IACH,MAAA;AAAA,IACA,aAAA,EAAe;AAAA,GACjB;AAIA,EAAA,IAAI,WAAW,aAAA,EAAe;AAC5B,IAAA,IAAI,CAAC,QAAQ,SAAA,EAAW;AACtB,MAAA,OAAA,CAAQ,SAAA,GAAY,GAAA;AAAA,IACtB;AACA,IAAA,OAAA,CAAQ,QAAA,IAAY,CAAA;AAAA,EACtB;AAGA,EAAA,IAAA,CAAK,WAAW,WAAA,IAAe,MAAA,KAAW,QAAA,KAAa,CAAC,QAAQ,WAAA,EAAa;AAC3E,IAAA,OAAA,CAAQ,WAAA,GAAc,GAAA;AAAA,EACxB;AAEA,EAAA,OAAO,OAAA;AACT;AAKO,SAAS,aAAA,CAAc,MAAY,QAAA,EAA2B;AACnE,EAAA,IAAI,IAAA,CAAK,SAAA,CAAU,MAAA,KAAW,CAAA,EAAG;AAC/B,IAAA,OAAO,KAAA;AAAA,EACT;AAEA,EAAA,KAAA,MAAW,KAAA,IAAS,KAAK,SAAA,EAAW;AAClC,IAAA,MAAM,UAAU,QAAA,CAAS,IAAA,CAAK,CAAC,CAAA,KAAM,CAAA,CAAE,OAAO,KAAK,CAAA;AACnD,IAAA,IAAI,CAAC,OAAA,EAAS;AACZ,MAAA,OAAO,IAAA;AAAA,IACT;AACA,IAAA,IAAI,OAAA,CAAQ,WAAW,WAAA,EAAa;AAClC,MAAA,OAAO,IAAA;AAAA,IACT;AAAA,EACF;AAEA,EAAA,OAAO,KAAA;AACT;AAKO,SAAS,mBAAA,CAAoB,MAAY,QAAA,EAA0B;AACxE,EAAA,IAAI,IAAA,CAAK,SAAA,CAAU,MAAA,KAAW,CAAA,EAAG;AAC/B,IAAA,OAAO,EAAC;AAAA,EACV;AAEA,EAAA,OAAO,KAAK,SAAA,CACT,GAAA,CAAI,CAAC,KAAA,KAAU,QAAA,CAAS,KAAK,CAAC,CAAA,KAAM,CAAA,CAAE,EAAA,KAAO,KAAK,CAAC,CAAA,CACnD,OAAO,CAAC,CAAA,KAAiB,MAAM,MAAS,CAAA;AAC7C;AAMO,SAAS,mBAAA,CAAoB,YAAyB,KAAA,EAAqB;AAEhF,EAAA,MAAM,QAAA,uBAAe,GAAA,EAAoB;AACzC,EAAA,KAAA,MAAW,QAAQ,KAAA,EAAO;AACxB,IAAA,QAAA,CAAS,GAAA,CAAI,IAAA,CAAK,IAAA,EAAM,IAAA,CAAK,EAAE,CAAA;AAAA,EACjC;AAGA,EAAA,KAAA,MAAW,SAAS,UAAA,EAAY;AAC9B,IAAA,IAAI,KAAA,CAAM,SAAA,IAAa,KAAA,CAAM,SAAA,CAAU,SAAS,CAAA,EAAG;AACjD,MAAA,KAAA,CAAM,SAAA,GAAY,KAAA,CAAM,SAAA,CAAU,GAAA,CAAI,CAAC,GAAA,KAAQ;AAE7C,QAAA,IAAI,GAAA,CAAI,UAAA,CAAW,OAAO,CAAA,EAAG;AAC3B,UAAA,OAAO,GAAA;AAAA,QACT;AAGA,QAAA,MAAM,UAAA,GAAa,QAAA,CAAS,GAAA,CAAI,GAAG,CAAA;AACnC,QAAA,IAAI,CAAC,UAAA,EAAY;AACf,UAAA,MAAM,IAAI,KAAA,CAAM,CAAA,iBAAA,EAAoB,GAAG,CAAA,WAAA,CAAa,CAAA;AAAA,QACtD;AACA,QAAA,OAAO,UAAA;AAAA,MACT,CAAC,CAAA;AAAA,IACH;AAAA,EACF;AACF;AAOO,SAAS,sBAAsB,KAAA,EAAgC;AACpE,EAAA,MAAM,OAAA,uBAAc,GAAA,EAAY;AAChC,EAAA,MAAM,QAAA,uBAAe,GAAA,EAAY;AACjC,EAAA,MAAM,OAAA,GAAU,IAAI,GAAA,CAAI,KAAA,CAAM,GAAA,CAAI,CAAC,CAAA,KAAM,CAAC,CAAA,CAAE,EAAA,EAAI,CAAC,CAAC,CAAC,CAAA;AAQnD,EAAA,SAAS,GAAA,CAAI,QAAgBC,KAAAA,EAAiC;AAE5D,IAAA,IAAI,QAAA,CAAS,GAAA,CAAI,MAAM,CAAA,EAAG;AACxB,MAAA,MAAM,UAAA,GAAaA,KAAAA,CAAK,OAAA,CAAQ,MAAM,CAAA;AACtC,MAAA,OAAO,CAAC,GAAGA,KAAAA,CAAK,KAAA,CAAM,UAAU,GAAG,MAAM,CAAA;AAAA,IAC3C;AAGA,IAAA,IAAI,OAAA,CAAQ,GAAA,CAAI,MAAM,CAAA,EAAG;AACvB,MAAA,OAAO,IAAA;AAAA,IACT;AAGA,IAAA,OAAA,CAAQ,IAAI,MAAM,CAAA;AAClB,IAAA,QAAA,CAAS,IAAI,MAAM,CAAA;AAGnB,IAAA,MAAM,IAAA,GAAO,OAAA,CAAQ,GAAA,CAAI,MAAM,CAAA;AAC/B,IAAA,IAAI,IAAA,EAAM;AACR,MAAA,KAAA,MAAW,KAAA,IAAS,KAAK,SAAA,EAAW;AAClC,QAAA,MAAM,QAAQ,GAAA,CAAI,KAAA,EAAO,CAAC,GAAGA,KAAAA,EAAM,MAAM,CAAC,CAAA;AAC1C,QAAA,IAAI,KAAA,EAAO;AACT,UAAA,OAAO,KAAA;AAAA,QACT;AAAA,MACF;AAAA,IACF;AAGA,IAAA,QAAA,CAAS,OAAO,MAAM,CAAA;AACtB,IAAA,OAAO,IAAA;AAAA,EACT;AAGA,EAAA,KAAA,MAAW,QAAQ,KAAA,EAAO;AACxB,IAAA,IAAI,CAAC,OAAA,CAAQ,GAAA,CAAI,IAAA,CAAK,EAAE,CAAA,EAAG;AACzB,MAAA,MAAM,KAAA,GAAQ,GAAA,CAAI,IAAA,CAAK,EAAA,EAAI,EAAE,CAAA;AAC7B,MAAA,IAAI,KAAA,EAAO;AACT,QAAA,OAAO,KAAA;AAAA,MACT;AAAA,IACF;AAAA,EACF;AAEA,EAAA,OAAO,IAAA;AACT;;;AC/nBO,SAAS,gBAAA,CAAiB,EAAA,EAAY,MAAA,EAAqB,IAAA,EAAwB;AACxF,EAAA,MAAM,GAAA,GAAM,KAAK,GAAA,EAAI;AAErB,EAAA,OAAO;AAAA,IACL,EAAA;AAAA,IACA,MAAA,EAAQ,MAAA;AAAA,IACR,MAAA;AAAA,IACA,IAAA;AAAA,IACA,QAAA,EAAU,UAAU,EAAE,CAAA,CAAA;AAAA,IACtB,qBAAqB,EAAC;AAAA,IACtB,SAAA,EAAW,GAAA;AAAA,IACX,cAAA,EAAgB,GAAA;AAAA,IAChB,OAAA,EAAS;AAAA,MACP,aAAA,EAAe,CAAA;AAAA,MACf,cAAA,EAAgB,CAAA;AAAA,MAChB,eAAA,EAAiB,CAAA;AAAA,MACjB,SAAA,EAAW;AAAA;AACb,GACF;AACF;AAKO,SAAS,iBAAA,CAAkB,OAAmB,MAAA,EAAiC;AACpF,EAAA,MAAM,GAAA,GAAM,KAAK,GAAA,EAAI;AAErB,EAAA,MAAM,OAAA,GAAsB;AAAA,IAC1B,GAAG,KAAA;AAAA,IACH,MAAA;AAAA,IACA,cAAA,EAAgB;AAAA,GAClB;AAGA,EAAA,IAAI,MAAA,KAAW,SAAA,IAAa,CAAC,OAAA,CAAQ,SAAA,EAAW;AAC9C,IAAA,OAAA,CAAQ,SAAA,GAAY,GAAA;AAAA,EACtB;AAEA,EAAA,IAAI,MAAA,KAAW,WAAA,IAAe,CAAC,OAAA,CAAQ,WAAA,EAAa;AAClD,IAAA,OAAA,CAAQ,WAAA,GAAc,GAAA;AAAA,EACxB;AAEA,EAAA,IAAA,CAAK,MAAA,KAAW,eAAe,MAAA,KAAW,QAAA,IAAY,WAAW,WAAA,KAAgB,CAAC,QAAQ,WAAA,EAAa;AACrG,IAAA,OAAA,CAAQ,WAAA,GAAc,GAAA;AAAA,EACxB;AAEA,EAAA,OAAO,OAAA;AACT;;;ACzGO,IAAM,UAAA,GAAN,cAAyB,iBAAA,CAAkB;AAAA,EACvC,IAAA,GAAO,MAAA;AAAA,EACP,QAAA,GAAW,CAAA;AAAA;AAAA,EACX,WAAA,GAAc,KAAA;AAAA;AAAA,EAEf,IAAA,GAAoB,IAAA;AAAA;AAAA;AAAA;AAAA,EAK5B,QAAQ,IAAA,EAAkB;AACxB,IAAA,IAAA,CAAK,IAAA,GAAO,IAAA;AAAA,EACd;AAAA;AAAA;AAAA;AAAA,EAKA,OAAA,GAAuB;AACrB,IAAA,OAAO,IAAA,CAAK,IAAA;AAAA,EACd;AAAA;AAAA;AAAA;AAAA,EAKA,SAAA,GAAkB;AAChB,IAAA,IAAA,CAAK,IAAA,GAAO,IAAA;AAAA,EACd;AAAA;AAAA;AAAA;AAAA,EAKA,gBAAA,CAAiB,QAAgB,MAAA,EAA0B;AACzD,IAAA,IAAI,CAAC,KAAK,IAAA,EAAM;AAEhB,IAAA,MAAM,IAAA,GAAO,IAAA,CAAK,IAAA,CAAK,KAAA,CAAM,IAAA,CAAK,CAAA,CAAA,KAAK,CAAA,CAAE,EAAA,KAAO,MAAA,IAAU,CAAA,CAAE,IAAA,KAAS,MAAM,CAAA;AAC3E,IAAA,IAAI,IAAA,EAAM;AACR,MAAA,IAAA,CAAK,MAAA,GAAS,MAAA;AAAA,IAChB;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,QAAQ,MAAA,EAAkC;AACxC,IAAA,IAAI,CAAC,IAAA,CAAK,IAAA,EAAM,OAAO,MAAA;AACvB,IAAA,OAAO,IAAA,CAAK,IAAA,CAAK,KAAA,CAAM,IAAA,CAAK,CAAA,CAAA,KAAK,EAAE,EAAA,KAAO,MAAA,IAAU,CAAA,CAAE,IAAA,KAAS,MAAM,CAAA;AAAA,EACvE;AAAA;AAAA;AAAA;AAAA,EAKA,UAAA,GAAsB;AACpB,IAAA,IAAI,CAAC,IAAA,CAAK,IAAA,EAAM,OAAO,IAAA;AACvB,IAAA,OAAO,IAAA,CAAK,IAAA,CAAK,KAAA,CAAM,KAAA,CAAM,CAAA,CAAA,KAAK,EAAE,MAAA,KAAW,WAAA,IAAe,CAAA,CAAE,MAAA,KAAW,SAAS,CAAA;AAAA,EACtF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,YAAA,GAAkD;AACtD,IAAA,IAAI,CAAC,IAAA,CAAK,IAAA,EAAM,OAAO,IAAA;AAEvB,IAAA,OAAO;AAAA,MACL,MAAM,IAAA,CAAK,IAAA;AAAA,MACX,OAAA,EAAS,IAAA,CAAK,UAAA,CAAW,IAAA,CAAK,IAAI,CAAA;AAAA,MAClC,UAAU,IAAA,CAAK,QAAA;AAAA,MACf,aAAa,IAAA,CAAK,WAAA;AAAA,MAClB,QAAA,EAAU;AAAA,QACR,SAAA,EAAW,IAAA,CAAK,IAAA,CAAK,KAAA,CAAM,MAAA;AAAA,QAC3B,cAAA,EAAgB,KAAK,IAAA,CAAK,KAAA,CAAM,OAAO,CAAA,CAAA,KAAK,CAAA,CAAE,MAAA,KAAW,WAAW,CAAA,CAAE,MAAA;AAAA,QACtE,IAAA,EAAM,KAAK,IAAA,CAAK;AAAA;AAClB,KACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,WAAW,IAAA,EAAoB;AACrC,IAAA,MAAM,KAAA,GAAkB;AAAA,MACtB,iBAAA;AAAA,MACA,EAAA;AAAA,MACA,CAAA,UAAA,EAAa,KAAK,IAAI,CAAA,CAAA;AAAA,MACtB,EAAA;AAAA,MACA;AAAA,KACF;AAEA,IAAA,KAAA,IAAS,IAAI,CAAA,EAAG,CAAA,GAAI,IAAA,CAAK,KAAA,CAAM,QAAQ,CAAA,EAAA,EAAK;AAC1C,MAAA,MAAM,IAAA,GAAO,IAAA,CAAK,KAAA,CAAM,CAAC,CAAA;AACzB,MAAA,IAAI,CAAC,IAAA,EAAM;AAEX,MAAA,MAAM,MAAA,GAAS,KAAK,MAAA,IAAU,SAAA;AAC9B,MAAA,MAAM,WAAA,GAAc,IAAA,CAAK,cAAA,CAAe,MAAM,CAAA;AAC9C,MAAA,MAAM,IAAA,GAAO,IAAA,CAAK,SAAA,IAAa,IAAA,CAAK,SAAA,CAAU,MAAA,GAAS,CAAA,GACnD,CAAA,cAAA,EAAiB,IAAA,CAAK,SAAA,CAAU,IAAA,CAAK,IAAI,CAAC,CAAA,CAAA,CAAA,GAC1C,EAAA;AAEJ,MAAA,KAAA,CAAM,KAAK,CAAA,EAAG,CAAA,GAAI,CAAC,CAAA,EAAA,EAAK,WAAW,CAAA,EAAA,EAAK,MAAM,CAAA,IAAA,EAAO,IAAA,CAAK,IAAI,CAAA,IAAA,EAAO,IAAA,CAAK,WAAW,CAAA,EAAG,IAAI,CAAA,CAAE,CAAA;AAG9F,MAAA,IAAI,IAAA,CAAK,YAAY,kBAAA,EAAoB;AACvC,QAAA,KAAA,CAAM,IAAA,CAAK,CAAA,iBAAA,EAAoB,IAAA,CAAK,UAAA,CAAW,kBAAkB,CAAA,CAAE,CAAA;AAAA,MACrE;AAAA,IACF;AAEA,IAAA,OAAO,KAAA,CAAM,KAAK,IAAI,CAAA;AAAA,EACxB;AAAA;AAAA;AAAA;AAAA,EAKQ,eAAe,MAAA,EAA4B;AACjD,IAAA,QAAQ,MAAA;AAAQ,MACd,KAAK,WAAA;AAAa,QAAA,OAAO,KAAA;AAAA,MACzB,KAAK,aAAA;AAAe,QAAA,OAAO,KAAA;AAAA,MAC3B,KAAK,QAAA;AAAU,QAAA,OAAO,KAAA;AAAA,MACtB,KAAK,SAAA;AAAW,QAAA,OAAO,KAAA;AAAA,MACvB,KAAK,SAAA;AAAW,QAAA,OAAO,KAAA;AAAA,MACvB,KAAK,SAAA;AAAA,MACL;AAAS,QAAA,OAAO,KAAA;AAAA;AAClB,EACF;AAAA;AAAA,EAGS,QAAA,GAAsC;AAC7C,IAAA,OAAO,EAAE,IAAA,EAAM,IAAA,CAAK,IAAA,EAAK;AAAA,EAC3B;AAAA,EAES,aAAa,KAAA,EAAsB;AAC1C,IAAA,MAAM,CAAA,GAAI,KAAA;AACV,IAAA,IAAI,GAAG,IAAA,EAAM;AACX,MAAA,IAAA,CAAK,OAAO,CAAA,CAAE,IAAA;AAAA,IAChB;AAAA,EACF;AACF,CAAA;;;ACpIO,IAAM,YAAA,GAAN,cAA2B,iBAAA,CAAkB;AAAA,EACzC,IAAA,GAAO,cAAA;AAAA,EACP,QAAA,GAAW,CAAA;AAAA;AAAA,EACX,WAAA,GAAc,IAAA;AAAA,EAEf,MAAA;AAAA,EACA,cAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQR,WAAA,CAAY,MAAA,EAAuB,cAAA,GAAyB,CAAA,EAAG;AAC7D,IAAA,KAAA,EAAM;AACN,IAAA,IAAA,CAAK,MAAA,GAAS,MAAA;AACd,IAAA,IAAA,CAAK,cAAA,GAAiB,cAAA;AAAA,EACxB;AAAA;AAAA;AAAA;AAAA,EAKA,SAAA,GAA2B;AACzB,IAAA,OAAO,IAAA,CAAK,MAAA;AAAA,EACd;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,YAAA,GAAkD;AACtD,IAAA,MAAM,KAAA,GAAQ,MAAM,IAAA,CAAK,MAAA,CAAO,WAAA,EAAY;AAG5C,IAAA,IAAI,CAAC,KAAA,IAAS,KAAA,CAAM,IAAA,EAAK,CAAE,WAAW,CAAA,IAAK,KAAA,CAAM,QAAA,CAAS,kBAAkB,CAAA,EAAG;AAC7E,MAAA,OAAO,IAAA;AAAA,IACT;AAEA,IAAA,MAAM,KAAA,GAAQ,MAAM,IAAA,CAAK,MAAA,CAAO,QAAA,EAAS;AAEzC,IAAA,OAAO;AAAA,MACL,MAAM,IAAA,CAAK,IAAA;AAAA,MACX,OAAA,EAAS,KAAA;AAAA,MACT,UAAU,IAAA,CAAK,QAAA;AAAA,MACf,aAAa,IAAA,CAAK,WAAA;AAAA,MAClB,QAAA,EAAU;AAAA,QACR,YAAY,KAAA,CAAM,YAAA;AAAA,QAClB,gBAAgB,KAAA,CAAM,cAAA;AAAA,QACtB,oBAAoB,KAAA,CAAM;AAAA;AAC5B,KACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAe,OAAA,CAAQ,aAAA,EAAuB,SAAA,EAA6C;AAEzF,IAAA,MAAM,WAAA,GAAc,MAAM,IAAA,CAAK,MAAA,CAAO,WAAA,EAAY;AAClD,IAAA,MAAM,YAAA,GAAe,SAAA,CAAU,cAAA,CAAe,WAAW,CAAA;AAGzD,IAAA,MAAM,cAAc,MAAM,IAAA,CAAK,OAAO,KAAA,CAAM,IAAA,CAAK,gBAAgB,KAAK,CAAA;AAEtE,IAAA,IAAI,WAAA,CAAY,WAAW,CAAA,EAAG;AAC5B,MAAA,OAAO,CAAA;AAAA,IACT;AAGA,IAAA,MAAM,UAAA,GAAa,MAAM,IAAA,CAAK,MAAA,CAAO,WAAA,EAAY;AACjD,IAAA,MAAM,WAAA,GAAc,SAAA,CAAU,cAAA,CAAe,UAAU,CAAA;AAEvD,IAAA,OAAO,IAAA,CAAK,GAAA,CAAI,CAAA,EAAG,YAAA,GAAe,WAAW,CAAA;AAAA,EAC/C;AAAA;AAAA;AAAA;AAAA,EAKS,OAAA,GAAgB;AAAA,EAEzB;AAAA;AAAA,EAGS,QAAA,GAAwC;AAC/C,IAAA,OAAO,EAAC;AAAA,EACV;AAAA,EAES,aAAa,MAAA,EAAuB;AAAA,EAE7C;AACF,CAAA;;;AC7GA,oBAAA,EAAA;AAaO,IAAM,yBAAA,GAAN,cAAwCiB,YAAAA,CAAuC;AAAA,EAC5E,WAAA,uBAAkB,GAAA,EAA4B;AAAA,EAC9C,eAAA,uBAAsB,GAAA,EAA4B;AAAA,EAClD,cAAA,uBAAqB,GAAA,EAAY;AAAA;AAAA,EACjC,KAAA;AAAA,EAER,WAAA,CAAY,KAAA,GAAwB,EAAC,EAAG;AACtC,IAAA,KAAA,EAAM;AACN,IAAA,IAAA,CAAK,KAAA,GAAQ,IAAI,GAAA,CAAI,KAAA,CAAM,IAAI,CAAC,CAAA,KAAM,CAAC,CAAA,CAAE,UAAA,CAAW,QAAA,CAAS,IAAA,EAAM,CAAC,CAAC,CAAC,CAAA;AAAA,EACxE;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,aAAa,IAAA,EAA2B;AAC5C,IAAA,IAAI,CAAC,KAAK,kBAAA,EAAoB;AAC5B,MAAA;AAAA,IACF;AAEA,IAAA,MAAM,MAAM,IAAA,CAAK,kBAAA;AAEjB,IAAA,QAAQ,IAAI,IAAA;AAAM,MAChB,KAAK,SAAA;AAEH,QAAA;AAAA,MAEF,KAAK,MAAA;AACH,QAAA,IAAA,CAAK,aAAa,IAAI,CAAA;AACtB,QAAA;AAAA,MAEF,KAAK,WAAA;AACH,QAAA,IAAA,CAAK,aAAa,IAAI,CAAA;AACtB,QAAA;AAIA;AACJ,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,YAAY,IAAA,EAAkB;AAC5B,IAAA,IAAI,CAAC,KAAK,kBAAA,EAAoB;AAC5B,MAAA;AAAA,IACF;AAGA,IAAA,IAAA,CAAK,cAAA,CAAe,GAAA,CAAI,IAAA,CAAK,EAAE,CAAA;AAG/B,IAAA,MAAM,SAAA,GAAY,IAAA,CAAK,WAAA,CAAY,GAAA,CAAI,KAAK,EAAE,CAAA;AAC9C,IAAA,IAAI,SAAA,EAAW;AACb,MAAA,YAAA,CAAa,SAAS,CAAA;AACtB,MAAA,IAAA,CAAK,WAAA,CAAY,MAAA,CAAO,IAAA,CAAK,EAAE,CAAA;AAAA,IACjC;AAEA,IAAA,MAAM,aAAA,GAAgB,IAAA,CAAK,eAAA,CAAgB,GAAA,CAAI,KAAK,EAAE,CAAA;AACtD,IAAA,IAAI,aAAA,EAAe;AACjB,MAAA,YAAA,CAAa,aAAa,CAAA;AAC1B,MAAA,IAAA,CAAK,eAAA,CAAgB,MAAA,CAAO,IAAA,CAAK,EAAE,CAAA;AAAA,IACrC;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,cAAA,CAAe,SAAA,EAAmB,IAAA,EAA8B;AACpE,IAAA,IAAA,CAAK,IAAA,CAAK,kBAAA,EAAoB,EAAE,SAAA,EAAW,MAAM,CAAA;AAAA,EACnD;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,cAAA,CAAe,MAAA,EAAgB,IAAA,EAA8B;AACjE,IAAA,IAAA,CAAK,IAAA,CAAK,kBAAA,EAAoB,EAAE,MAAA,EAAQ,MAAM,CAAA;AAAA,EAChD;AAAA;AAAA;AAAA;AAAA,EAKQ,aAAa,IAAA,EAAkB;AACrC,IAAA,MAAM,MAAM,IAAA,CAAK,kBAAA;AACjB,IAAA,MAAM,aAAa,GAAA,CAAI,UAAA;AAGvB,IAAA,MAAM,aAAA,GAA+B;AAAA,MACnC,QAAA,EAAU,aAAA;AAAA,MACV,gBAAgB,UAAA,CAAW,UAAA;AAAA,MAC3B,UAAA,EAAY,WAAW,UAAA,GAAa,CAAA;AAAA;AAAA,MACpC,MAAA,EAAQ,IAAA;AAAA,MACR,YAAA,EAAc;AAAA;AAAA,KAChB;AAGA,IAAA,IAAA,CAAK,cAAA,CAAe,MAAA,CAAO,IAAA,CAAK,EAAE,CAAA;AAGlC,IAAA,CAAC,YAAY;AACX,MAAA,IAAI,QAAA,GAAW,CAAA;AAEf,MAAA,OAAO,QAAA,GAAW,WAAW,WAAA,EAAa;AAExC,QAAA,IAAI,IAAA,CAAK,cAAA,CAAe,GAAA,CAAI,IAAA,CAAK,EAAE,CAAA,EAAG;AACpC,UAAA,IAAA,CAAK,cAAA,CAAe,MAAA,CAAO,IAAA,CAAK,EAAE,CAAA;AAClC,UAAA;AAAA,QACF;AAEA,QAAA,QAAA,EAAA;AAEA,QAAA,IAAI;AAEF,UAAA,MAAM,IAAA,GAAO,IAAA,CAAK,KAAA,CAAM,GAAA,CAAI,WAAW,QAAQ,CAAA;AAC/C,UAAA,IAAI,CAAC,IAAA,EAAM;AACT,YAAA,OAAA,CAAQ,KAAA,CAAM,CAAA,UAAA,EAAa,UAAA,CAAW,QAAQ,CAAA,UAAA,CAAY,CAAA;AAC1D,YAAA;AAAA,UACF;AAGA,UAAA,MAAM,MAAA,GAAS,MAAM,IAAA,CAAK,OAAA,CAAQ,WAAW,QAAQ,CAAA;AAIrD,UAAA,IAAI,MAAA,EAAQ;AACV,YAAA,IAAA,CAAK,IAAA,CAAK,gBAAgB,EAAE,MAAA,EAAQ,KAAK,EAAA,EAAI,IAAA,EAAM,QAAQ,CAAA;AAC3D,YAAA;AAAA,UACF;AAAA,QACF,SAAS,KAAA,EAAO;AACd,UAAA,OAAA,CAAQ,KAAA,CAAM,CAAA,oBAAA,EAAuB,IAAA,CAAK,EAAE,KAAK,KAAK,CAAA;AAAA,QACxD;AAGA,QAAA,IAAI,QAAA,IAAY,WAAW,WAAA,EAAa;AACtC,UAAA,IAAA,CAAK,KAAK,cAAA,EAAgB,EAAE,MAAA,EAAQ,IAAA,CAAK,IAAI,CAAA;AAC7C,UAAA;AAAA,QACF;AAGA,QAAA,MAAM,KAAA,GAAQ,gBAAA,CAAiB,QAAA,EAAU,aAAa,CAAA;AACtD,QAAA,MAAM,IAAI,OAAA,CAAc,CAAClB,QAAAA,KAAY;AACnC,UAAA,MAAM,KAAA,GAAQ,UAAA,CAAWA,QAAAA,EAAS,KAAK,CAAA;AAEvC,UAAA,IAAA,CAAK,WAAA,CAAY,GAAA,CAAI,IAAA,CAAK,EAAA,EAAI,KAAK,CAAA;AAAA,QACrC,CAAC,CAAA;AAGD,QAAA,IAAI,IAAA,CAAK,cAAA,CAAe,GAAA,CAAI,IAAA,CAAK,EAAE,CAAA,EAAG;AACpC,UAAA,IAAA,CAAK,cAAA,CAAe,MAAA,CAAO,IAAA,CAAK,EAAE,CAAA;AAClC,UAAA;AAAA,QACF;AAAA,MACF;AAAA,IACF,CAAA,GAAG;AAAA,EACL;AAAA;AAAA;AAAA;AAAA,EAKQ,aAAa,IAAA,EAAkB;AACrC,IAAA,MAAM,MAAM,IAAA,CAAK,kBAAA;AACjB,IAAA,MAAM,cAAc,GAAA,CAAI,WAAA;AAExB,IAAA,MAAM,KAAA,GAAQ,WAAA,GAAc,IAAA,CAAK,GAAA,EAAI;AAErC,IAAA,IAAI,SAAS,CAAA,EAAG;AAEd,MAAA,IAAA,CAAK,KAAK,qBAAA,EAAuB,EAAE,MAAA,EAAQ,IAAA,CAAK,IAAI,CAAA;AACpD,MAAA;AAAA,IACF;AAEA,IAAA,MAAM,KAAA,GAAQ,WAAW,MAAM;AAC7B,MAAA,IAAA,CAAK,KAAK,qBAAA,EAAuB,EAAE,MAAA,EAAQ,IAAA,CAAK,IAAI,CAAA;AACpD,MAAA,IAAA,CAAK,eAAA,CAAgB,MAAA,CAAO,IAAA,CAAK,EAAE,CAAA;AAAA,IACrC,GAAG,KAAK,CAAA;AAER,IAAA,IAAA,CAAK,eAAA,CAAgB,GAAA,CAAI,IAAA,CAAK,EAAA,EAAI,KAAK,CAAA;AAAA,EACzC;AAAA;AAAA;AAAA;AAAA,EAKA,OAAA,GAAgB;AAEd,IAAA,KAAA,MAAW,MAAA,IAAU,IAAA,CAAK,WAAA,CAAY,IAAA,EAAK,EAAG;AAC5C,MAAA,IAAA,CAAK,cAAA,CAAe,IAAI,MAAM,CAAA;AAAA,IAChC;AAGA,IAAA,KAAA,MAAW,KAAA,IAAS,IAAA,CAAK,WAAA,CAAY,MAAA,EAAO,EAAG;AAC7C,MAAA,YAAA,CAAa,KAAK,CAAA;AAAA,IACpB;AACA,IAAA,IAAA,CAAK,YAAY,KAAA,EAAM;AAGvB,IAAA,KAAA,MAAW,KAAA,IAAS,IAAA,CAAK,eAAA,CAAgB,MAAA,EAAO,EAAG;AACjD,MAAA,YAAA,CAAa,KAAK,CAAA;AAAA,IACpB;AACA,IAAA,IAAA,CAAK,gBAAgB,KAAA,EAAM;AAAA,EAC7B;AAAA;AAAA;AAAA;AAAA,EAKA,YAAY,KAAA,EAA6B;AACvC,IAAA,IAAA,CAAK,KAAA,GAAQ,IAAI,GAAA,CAAI,KAAA,CAAM,IAAI,CAAC,CAAA,KAAM,CAAC,CAAA,CAAE,UAAA,CAAW,QAAA,CAAS,IAAA,EAAM,CAAC,CAAC,CAAC,CAAA;AAAA,EACxE;AACF;;;AC9NA,mBAAA,EAAA;AAOA,mBAAA,EAAA;AAEA,oBAAA,EAAA;AAQA,oBAAA,EAAA;;;ACTO,IAAM,cAAA,GAAN,MAAM,eAAA,SAAuB,OAAA,CAAQ;AAAA,EAC1C,WAAA,CACkB,cAChB,OAAA,EACA;AACA,IAAA,KAAA,CAAM,OAAA,IAAW,CAAA,0BAAA,EAA6B,YAAY,CAAA,EAAA,CAAA,EAAM,oBAAoB,GAAG,CAAA;AAHvE,IAAA,IAAA,CAAA,YAAA,GAAA,YAAA;AAIhB,IAAA,IAAA,CAAK,IAAA,GAAO,gBAAA;AACZ,IAAA,MAAA,CAAO,cAAA,CAAe,IAAA,EAAM,eAAA,CAAe,SAAS,CAAA;AAAA,EACtD;AACF;AAsBO,IAAM,2BAAA,GAA2D;AAAA,EACtE,WAAA,EAAa,EAAA;AAAA,EACb,QAAA,EAAU,GAAA;AAAA,EACV,OAAA,EAAS,MAAA;AAAA,EACT,SAAA,EAAW;AACb;AAsBO,IAAM,yBAAN,MAA6B;AAAA,EAC1B,MAAA;AAAA,EACA,UAAA;AAAA,EACS,MAAA;AAAA,EACT,YAIH,EAAC;AAAA;AAAA,EAGE,aAAA,GAAgB,CAAA;AAAA,EAChB,iBAAA,GAAoB,CAAA;AAAA,EACpB,WAAA,GAAc,CAAA;AAAA,EAEtB,WAAA,CAAY,MAAA,GAAqC,EAAC,EAAG;AACnD,IAAA,IAAA,CAAK,MAAA,GAAS;AAAA,MACZ,WAAA,EAAa,MAAA,CAAO,WAAA,IAAe,2BAAA,CAA4B,WAAA;AAAA,MAC/D,QAAA,EAAU,MAAA,CAAO,QAAA,IAAY,2BAAA,CAA4B,QAAA;AAAA,MACzD,OAAA,EAAS,MAAA,CAAO,OAAA,IAAW,2BAAA,CAA4B,OAAA;AAAA,MACvD,SAAA,EAAW,MAAA,CAAO,SAAA,IAAa,2BAAA,CAA4B;AAAA,KAC7D;AACA,IAAA,IAAA,CAAK,MAAA,GAAS,KAAK,MAAA,CAAO,WAAA;AAC1B,IAAA,IAAA,CAAK,UAAA,GAAa,KAAK,GAAA,EAAI;AAAA,EAC7B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,MAAM,OAAA,GAAyB;AAC7B,IAAA,IAAA,CAAK,aAAA,EAAA;AACL,IAAA,IAAA,CAAK,MAAA,EAAO;AAEZ,IAAA,IAAI,IAAA,CAAK,SAAS,CAAA,EAAG;AACnB,MAAA,IAAA,CAAK,MAAA,EAAA;AACL,MAAA;AAAA,IACF;AAGA,IAAA,IAAA,CAAK,iBAAA,EAAA;AACL,IAAA,MAAM,QAAA,GAAW,KAAK,WAAA,EAAY;AAElC,IAAA,IAAI,IAAA,CAAK,MAAA,CAAO,OAAA,KAAY,OAAA,EAAS;AACnC,MAAA,MAAM,IAAI,eAAe,QAAQ,CAAA;AAAA,IACnC;AAGA,IAAA,IAAI,QAAA,GAAW,IAAA,CAAK,MAAA,CAAO,SAAA,EAAW;AACpC,MAAA,MAAM,IAAI,cAAA;AAAA,QACR,QAAA;AAAA,QACA,CAAA,UAAA,EAAa,QAAQ,CAAA,eAAA,EAAkB,IAAA,CAAK,OAAO,SAAS,CAAA,EAAA;AAAA,OAC9D;AAAA,IACF;AAEA,IAAA,MAAM,SAAA,GAAY,KAAK,GAAA,EAAI;AAC3B,IAAA,MAAM,IAAA,CAAK,aAAa,QAAQ,CAAA;AAChC,IAAA,IAAA,CAAK,WAAA,IAAe,IAAA,CAAK,GAAA,EAAI,GAAI,SAAA;AAAA,EACnC;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,UAAA,GAAsB;AACpB,IAAA,IAAA,CAAK,aAAA,EAAA;AACL,IAAA,IAAA,CAAK,MAAA,EAAO;AACZ,IAAA,IAAI,IAAA,CAAK,SAAS,CAAA,EAAG;AACnB,MAAA,IAAA,CAAK,MAAA,EAAA;AACL,MAAA,OAAO,IAAA;AAAA,IACT;AACA,IAAA,IAAA,CAAK,iBAAA,EAAA;AACL,IAAA,OAAO,KAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,kBAAA,GAA6B;AAC3B,IAAA,IAAA,CAAK,MAAA,EAAO;AACZ,IAAA,OAAO,IAAA,CAAK,MAAA;AAAA,EACd;AAAA;AAAA;AAAA;AAAA,EAKA,WAAA,GAAsB;AACpB,IAAA,IAAA,CAAK,MAAA,EAAO;AACZ,IAAA,IAAI,IAAA,CAAK,MAAA,GAAS,CAAA,EAAG,OAAO,CAAA;AAE5B,IAAA,MAAM,OAAA,GAAU,IAAA,CAAK,GAAA,EAAI,GAAI,IAAA,CAAK,UAAA;AAClC,IAAA,OAAO,KAAK,GAAA,CAAI,CAAA,EAAG,IAAA,CAAK,MAAA,CAAO,WAAW,OAAO,CAAA;AAAA,EACnD;AAAA;AAAA;AAAA;AAAA,EAKA,UAAA,GAAiC;AAC/B,IAAA,OAAO;AAAA,MACL,eAAe,IAAA,CAAK,aAAA;AAAA,MACpB,mBAAmB,IAAA,CAAK,iBAAA;AAAA,MACxB,aAAa,IAAA,CAAK,WAAA;AAAA,MAClB,WAAW,IAAA,CAAK,iBAAA,GAAoB,IAAI,IAAA,CAAK,WAAA,GAAc,KAAK,iBAAA,GAAoB;AAAA,KACtF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,KAAA,GAAc;AACZ,IAAA,IAAA,CAAK,MAAA,GAAS,KAAK,MAAA,CAAO,WAAA;AAC1B,IAAA,IAAA,CAAK,UAAA,GAAa,KAAK,GAAA,EAAI;AAG3B,IAAA,KAAA,MAAW,MAAA,IAAU,KAAK,SAAA,EAAW;AACnC,MAAA,IAAI,OAAO,OAAA,EAAS;AAClB,QAAA,YAAA,CAAa,OAAO,OAAO,CAAA;AAAA,MAC7B;AAAA,IACF;AACA,IAAA,IAAA,CAAK,YAAY,EAAC;AAAA,EACpB;AAAA;AAAA;AAAA;AAAA,EAKA,YAAA,GAAqB;AACnB,IAAA,IAAA,CAAK,aAAA,GAAgB,CAAA;AACrB,IAAA,IAAA,CAAK,iBAAA,GAAoB,CAAA;AACzB,IAAA,IAAA,CAAK,WAAA,GAAc,CAAA;AAAA,EACrB;AAAA;AAAA;AAAA;AAAA,EAKA,SAAA,GAAyC;AACvC,IAAA,OAAO,EAAE,GAAG,IAAA,CAAK,MAAA,EAAO;AAAA,EAC1B;AAAA;AAAA;AAAA;AAAA,EAKQ,MAAA,GAAe;AACrB,IAAA,MAAM,GAAA,GAAM,KAAK,GAAA,EAAI;AACrB,IAAA,MAAM,OAAA,GAAU,MAAM,IAAA,CAAK,UAAA;AAE3B,IAAA,IAAI,OAAA,IAAW,IAAA,CAAK,MAAA,CAAO,QAAA,EAAU;AAEnC,MAAA,IAAA,CAAK,MAAA,GAAS,KAAK,MAAA,CAAO,WAAA;AAC1B,MAAA,IAAA,CAAK,UAAA,GAAa,GAAA;AAGlB,MAAA,IAAA,CAAK,gBAAA,EAAiB;AAAA,IACxB;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,aAAa,QAAA,EAAiC;AAC1D,IAAA,OAAO,IAAI,OAAA,CAAQ,CAACA,QAAAA,EAAS,MAAA,KAAW;AACtC,MAAA,MAAM,OAAA,GAAU,WAAW,MAAM;AAE/B,QAAA,MAAM,KAAA,GAAQ,KAAK,SAAA,CAAU,SAAA,CAAU,CAAC,CAAA,KAAM,CAAA,CAAE,YAAY,OAAO,CAAA;AACnE,QAAA,IAAI,UAAU,EAAA,EAAI;AAChB,UAAA,IAAA,CAAK,SAAA,CAAU,MAAA,CAAO,KAAA,EAAO,CAAC,CAAA;AAAA,QAChC;AAGA,QAAA,IAAA,CAAK,MAAA,EAAO;AACZ,QAAA,IAAI,IAAA,CAAK,SAAS,CAAA,EAAG;AACnB,UAAA,IAAA,CAAK,MAAA,EAAA;AACL,UAAAA,QAAAA,EAAQ;AAAA,QACV,CAAA,MAAO;AAEL,UAAA,MAAA,CAAO,IAAI,cAAA,CAAe,IAAA,CAAK,WAAA,EAAY,EAAG,oCAAoC,CAAC,CAAA;AAAA,QACrF;AAAA,MACF,GAAG,QAAQ,CAAA;AAEX,MAAA,IAAA,CAAK,UAAU,IAAA,CAAK,EAAE,SAAAA,QAAAA,EAAS,MAAA,EAAQ,SAAS,CAAA;AAAA,IAClD,CAAC,CAAA;AAAA,EACH;AAAA;AAAA;AAAA;AAAA,EAKQ,gBAAA,GAAyB;AAC/B,IAAA,OAAO,KAAK,SAAA,CAAU,MAAA,GAAS,CAAA,IAAK,IAAA,CAAK,SAAS,CAAA,EAAG;AACnD,MAAA,MAAM,MAAA,GAAS,IAAA,CAAK,SAAA,CAAU,KAAA,EAAM;AACpC,MAAA,IAAI,MAAA,EAAQ;AACV,QAAA,IAAI,OAAO,OAAA,EAAS;AAClB,UAAA,YAAA,CAAa,OAAO,OAAO,CAAA;AAAA,QAC7B;AACA,QAAA,IAAA,CAAK,MAAA,EAAA;AACL,QAAA,MAAA,CAAO,OAAA,EAAQ;AAAA,MACjB;AAAA,IACF;AAAA,EACF;AACF;;;AC5NO,SAAS,YAAyB,IAAA,EAAuC;AAC9E,EAAA,IAAI,CAAC,IAAA,IAAQ,OAAO,IAAA,KAAS,QAAA,EAAU;AACrC,IAAA,OAAO;AAAA,MACL,OAAA,EAAS,KAAA;AAAA,MACT,KAAA,EAAO;AAAA,KACT;AAAA,EACF;AAEA,EAAA,MAAM,WAAA,GAAc,KAAK,IAAA,EAAK;AAG9B,EAAA,MAAM,eAAA,GAAkB,qBAAwB,WAAW,CAAA;AAC3D,EAAA,IAAI,gBAAgB,OAAA,EAAS;AAC3B,IAAA,OAAO,eAAA;AAAA,EACT;AAGA,EAAA,MAAM,YAAA,GAAe,kBAAqB,WAAW,CAAA;AACrD,EAAA,IAAI,aAAa,OAAA,EAAS;AACxB,IAAA,OAAO,YAAA;AAAA,EACT;AAGA,EAAA,IAAI;AACF,IAAA,MAAM,IAAA,GAAO,IAAA,CAAK,KAAA,CAAM,WAAW,CAAA;AACnC,IAAA,OAAO;AAAA,MACL,OAAA,EAAS,IAAA;AAAA,MACT,IAAA;AAAA,MACA,OAAA,EAAS,WAAA;AAAA,MACT,MAAA,EAAQ;AAAA,KACV;AAAA,EACF,SAAS,CAAA,EAAG;AACV,IAAA,OAAO;AAAA,MACL,OAAA,EAAS,KAAA;AAAA,MACT,KAAA,EAAO,qCAAqC,CAAA,YAAa,KAAA,GAAQ,EAAE,OAAA,GAAU,MAAA,CAAO,CAAC,CAAC,CAAA;AAAA,KACxF;AAAA,EACF;AACF;AAKA,SAAS,qBAAwB,IAAA,EAAuC;AAEtE,EAAA,MAAM,cAAA,GAAiB,+BAAA;AACvB,EAAA,IAAI,KAAA;AAEJ,EAAA,OAAA,CAAQ,KAAA,GAAQ,cAAA,CAAe,IAAA,CAAK,IAAI,OAAO,IAAA,EAAM;AACnD,IAAA,MAAM,OAAA,GAAU,MAAM,CAAC,CAAA;AACvB,IAAA,IAAI,OAAA,EAAS;AACX,MAAA,MAAM,OAAA,GAAU,QAAQ,IAAA,EAAK;AAC7B,MAAA,IAAI;AACF,QAAA,MAAM,IAAA,GAAO,IAAA,CAAK,KAAA,CAAM,OAAO,CAAA;AAC/B,QAAA,OAAO;AAAA,UACL,OAAA,EAAS,IAAA;AAAA,UACT,IAAA;AAAA,UACA,OAAA,EAAS,OAAA;AAAA,UACT,MAAA,EAAQ;AAAA,SACV;AAAA,MACF,CAAA,CAAA,MAAQ;AAEN,QAAA;AAAA,MACF;AAAA,IACF;AAAA,EACF;AAEA,EAAA,OAAO,EAAE,SAAS,KAAA,EAAM;AAC1B;AAKA,SAAS,kBAAqB,IAAA,EAAuC;AAEnE,EAAA,MAAM,WAAA,GAAc,eAAe,IAAI,CAAA;AACvC,EAAA,IAAI,WAAA,EAAa;AACf,IAAA,IAAI;AACF,MAAA,MAAM,IAAA,GAAO,IAAA,CAAK,KAAA,CAAM,WAAW,CAAA;AACnC,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,IAAA;AAAA,QACT,IAAA;AAAA,QACA,OAAA,EAAS,WAAA;AAAA,QACT,MAAA,EAAQ;AAAA,OACV;AAAA,IACF,CAAA,CAAA,MAAQ;AAAA,IAER;AAAA,EACF;AAGA,EAAA,MAAM,UAAA,GAAa,cAAc,IAAI,CAAA;AACrC,EAAA,IAAI,UAAA,EAAY;AACd,IAAA,IAAI;AACF,MAAA,MAAM,IAAA,GAAO,IAAA,CAAK,KAAA,CAAM,UAAU,CAAA;AAClC,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,IAAA;AAAA,QACT,IAAA;AAAA,QACA,OAAA,EAAS,UAAA;AAAA,QACT,MAAA,EAAQ;AAAA,OACV;AAAA,IACF,CAAA,CAAA,MAAQ;AAAA,IAER;AAAA,EACF;AAEA,EAAA,OAAO,EAAE,SAAS,KAAA,EAAM;AAC1B;AAKA,SAAS,eAAe,IAAA,EAA6B;AACnD,EAAA,MAAM,UAAA,GAAa,IAAA,CAAK,OAAA,CAAQ,GAAG,CAAA;AACnC,EAAA,IAAI,UAAA,KAAe,IAAI,OAAO,IAAA;AAE9B,EAAA,IAAI,KAAA,GAAQ,CAAA;AACZ,EAAA,IAAI,QAAA,GAAW,KAAA;AACf,EAAA,IAAI,OAAA,GAAU,KAAA;AAEd,EAAA,KAAA,IAAS,CAAA,GAAI,UAAA,EAAY,CAAA,GAAI,IAAA,CAAK,QAAQ,CAAA,EAAA,EAAK;AAC7C,IAAA,MAAM,IAAA,GAAO,KAAK,CAAC,CAAA;AAEnB,IAAA,IAAI,OAAA,EAAS;AACX,MAAA,OAAA,GAAU,KAAA;AACV,MAAA;AAAA,IACF;AAEA,IAAA,IAAI,IAAA,KAAS,QAAQ,QAAA,EAAU;AAC7B,MAAA,OAAA,GAAU,IAAA;AACV,MAAA;AAAA,IACF;AAEA,IAAA,IAAI,SAAS,GAAA,EAAK;AAChB,MAAA,QAAA,GAAW,CAAC,QAAA;AACZ,MAAA;AAAA,IACF;AAEA,IAAA,IAAI,QAAA,EAAU;AAEd,IAAA,IAAI,SAAS,GAAA,EAAK;AAChB,MAAA,KAAA,EAAA;AAAA,IACF,CAAA,MAAA,IAAW,SAAS,GAAA,EAAK;AACvB,MAAA,KAAA,EAAA;AACA,MAAA,IAAI,UAAU,CAAA,EAAG;AACf,QAAA,OAAO,IAAA,CAAK,KAAA,CAAM,UAAA,EAAY,CAAA,GAAI,CAAC,CAAA;AAAA,MACrC;AAAA,IACF;AAAA,EACF;AAEA,EAAA,OAAO,IAAA;AACT;AAKA,SAAS,cAAc,IAAA,EAA6B;AAClD,EAAA,MAAM,UAAA,GAAa,IAAA,CAAK,OAAA,CAAQ,GAAG,CAAA;AACnC,EAAA,IAAI,UAAA,KAAe,IAAI,OAAO,IAAA;AAE9B,EAAA,IAAI,KAAA,GAAQ,CAAA;AACZ,EAAA,IAAI,QAAA,GAAW,KAAA;AACf,EAAA,IAAI,OAAA,GAAU,KAAA;AAEd,EAAA,KAAA,IAAS,CAAA,GAAI,UAAA,EAAY,CAAA,GAAI,IAAA,CAAK,QAAQ,CAAA,EAAA,EAAK;AAC7C,IAAA,MAAM,IAAA,GAAO,KAAK,CAAC,CAAA;AAEnB,IAAA,IAAI,OAAA,EAAS;AACX,MAAA,OAAA,GAAU,KAAA;AACV,MAAA;AAAA,IACF;AAEA,IAAA,IAAI,IAAA,KAAS,QAAQ,QAAA,EAAU;AAC7B,MAAA,OAAA,GAAU,IAAA;AACV,MAAA;AAAA,IACF;AAEA,IAAA,IAAI,SAAS,GAAA,EAAK;AAChB,MAAA,QAAA,GAAW,CAAC,QAAA;AACZ,MAAA;AAAA,IACF;AAEA,IAAA,IAAI,QAAA,EAAU;AAEd,IAAA,IAAI,SAAS,GAAA,EAAK;AAChB,MAAA,KAAA,EAAA;AAAA,IACF,CAAA,MAAA,IAAW,SAAS,GAAA,EAAK;AACvB,MAAA,KAAA,EAAA;AACA,MAAA,IAAI,UAAU,CAAA,EAAG;AACf,QAAA,OAAO,IAAA,CAAK,KAAA,CAAM,UAAA,EAAY,CAAA,GAAI,CAAC,CAAA;AAAA,MACrC;AAAA,IACF;AAAA,EACF;AAEA,EAAA,OAAO,IAAA;AACT;AAeO,SAAS,gBAAA,CACd,IAAA,EACA,KAAA,EACA,YAAA,EACG;AACH,EAAA,MAAM,MAAA,GAAS,YAAqC,IAAI,CAAA;AACxD,EAAA,IAAI,OAAO,OAAA,IAAW,MAAA,CAAO,IAAA,IAAQ,KAAA,IAAS,OAAO,IAAA,EAAM;AACzD,IAAA,OAAO,MAAA,CAAO,KAAK,KAAK,CAAA;AAAA,EAC1B;AACA,EAAA,OAAO,YAAA;AACT;AAeO,SAAS,aAAA,CACd,MACA,QAAA,GAAqB;AAAA,EACnB,2CAAA;AAAA,EACA,6CAAA;AAAA,EACA;AACF,CAAA,EACA,eAAuB,CAAA,EACf;AAER,EAAA,MAAM,UAAA,GAAa,YAAqC,IAAI,CAAA;AAC5D,EAAA,IAAI,UAAA,CAAW,OAAA,IAAW,UAAA,CAAW,IAAA,EAAM;AAEzC,IAAA,MAAM,cAAc,CAAC,OAAA,EAAS,mBAAmB,kBAAA,EAAoB,QAAA,EAAU,WAAW,OAAO,CAAA;AACjG,IAAA,KAAA,MAAW,SAAS,WAAA,EAAa;AAC/B,MAAA,IAAI,KAAA,IAAS,WAAW,IAAA,IAAQ,OAAO,WAAW,IAAA,CAAK,KAAK,MAAM,QAAA,EAAU;AAC1E,QAAA,OAAO,UAAA,CAAW,KAAK,KAAK,CAAA;AAAA,MAC9B;AAAA,IACF;AAAA,EACF;AAGA,EAAA,KAAA,MAAW,WAAW,QAAA,EAAU;AAC9B,IAAA,MAAM,KAAA,GAAQ,IAAA,CAAK,KAAA,CAAM,OAAO,CAAA;AAChC,IAAA,IAAI,KAAA,IAAS,KAAA,CAAM,CAAC,CAAA,EAAG;AACrB,MAAA,MAAM,GAAA,GAAM,QAAA,CAAS,KAAA,CAAM,CAAC,GAAG,EAAE,CAAA;AACjC,MAAA,IAAI,CAAC,KAAA,CAAM,GAAG,CAAA,EAAG;AACf,QAAA,OAAO,GAAA;AAAA,MACT;AAAA,IACF;AAAA,EACF;AAEA,EAAA,OAAO,YAAA;AACT;;;ACjSA,IAAM,0BAA0B,aAAA,CAAc,UAAA;AAmDvC,IAAM,YAAA,GAAN,cAA2BkB,YAAAA,CAAwD;AAAA,EAChF,KAAA;AAAA,EACA,YAAA;AAAA,EACA,UAAA;AAAA;AAAA,EAEA,eAAA;AAAA,EACA,iBAAA;AAAA,EACA,KAAA;AAAA,EACA,MAAA;AAAA,EACA,eAAA;AAAA,EACA,WAAA;AAAA,EACA,YAAA,GAAe,KAAA;AAAA;AAAA,EAGf,cAAA,GAAiB;AAAA,IACvB,aAAA,EAAe,CAAA;AAAA,IACf,cAAA,EAAgB,CAAA;AAAA,IAChB,eAAA,EAAiB,CAAA;AAAA,IACjB,SAAA,EAAW;AAAA,GACb;AAAA;AAAA,EAGQ,YAAA,GAAkC,IAAA;AAAA,EAE1C,YACE,KAAA,EACA,YAAA,EACA,YACA,eAAA,EACA,iBAAA,EACA,OACA,MAAA,EACA;AACA,IAAA,KAAA,EAAM;AACN,IAAA,IAAA,CAAK,KAAA,GAAQ,KAAA;AACb,IAAA,IAAA,CAAK,YAAA,GAAe,YAAA;AACpB,IAAA,IAAA,CAAK,UAAA,GAAa,UAAA;AAClB,IAAA,IAAA,CAAK,eAAA,GAAkB,eAAA;AACvB,IAAA,IAAA,CAAK,iBAAA,GAAoB,iBAAA;AACzB,IAAA,IAAA,CAAK,KAAA,GAAQ,KAAA;AACb,IAAA,IAAA,CAAK,MAAA,GAAS,MAAA;AACd,IAAA,IAAA,CAAK,eAAA,GAAkB,IAAI,eAAA,EAAgB;AAG3C,IAAA,IAAI,OAAO,WAAA,EAAa;AACtB,MAAA,IAAA,CAAK,WAAA,GAAc,IAAI,sBAAA,CAAuB;AAAA,QAC5C,WAAA,EAAa,MAAA,CAAO,WAAA,CAAY,oBAAA,IAAwB,EAAA;AAAA,QACxD,QAAA,EAAU,GAAA;AAAA;AAAA,QACV,OAAA,EAAS,MAAA,CAAO,WAAA,CAAY,OAAA,IAAW,MAAA;AAAA,QACvC,SAAA,EAAW,MAAA,CAAO,WAAA,CAAY,SAAA,IAAa;AAAA,OAC5C,CAAA;AAAA,IACH;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,IAAY,MAAA,GAA+B;AACzC,IAAA,OAAO,KAAK,YAAA,CAAa,MAAA;AAAA,EAC3B;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,IAAY,gBAAA,GAA4C;AACtD,IAAA,OAAO,KAAK,YAAA,CAAa,KAAA;AAAA,EAC3B;AAAA;AAAA;AAAA;AAAA,EAKQ,mBAAmB,IAAA,EAA8C;AACvE,IAAA,MAAM,UAAA,uBAAiB,GAAA,EAAiC;AACxD,IAAA,KAAA,MAAW,IAAA,IAAQ,KAAK,KAAA,EAAO;AAE7B,MAAA,MAAM,SAAS,IAAA,CAAK,MAAA;AACpB,MAAA,IAAI,CAAC,SAAA,EAAW,aAAA,EAAe,WAAA,EAAa,QAAA,EAAU,WAAW,WAAW,CAAA,CAAE,QAAA,CAAS,MAAM,CAAA,EAAG;AAC9F,QAAA,UAAA,CAAW,GAAA,CAAI,IAAA,CAAK,EAAA,EAAI,MAAM,CAAA;AAAA,MAChC,CAAA,MAAO;AAEL,QAAA,UAAA,CAAW,GAAA,CAAI,IAAA,CAAK,EAAA,EAAI,SAAS,CAAA;AAAA,MACnC;AAAA,IACF;AACA,IAAA,OAAO,UAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,MAAc,4BAAA,CAA6B,IAAA,EAAY,MAAA,EAA+B;AAEpF,IAAA,IAAI,CAAC,KAAK,MAAA,EAAQ;AAChB,MAAA;AAAA,IACF;AAEA,IAAA,MAAM,UAAA,GAAa,IAAA,CAAK,kBAAA,CAAmB,IAAI,CAAA;AAC/C,IAAA,MAAM,eAAe,MAAM,IAAA,CAAK,MAAA,CAAO,cAAA,CAAe,QAAQ,UAAU,CAAA;AAExE,IAAA,IAAI,YAAA,CAAa,SAAS,CAAA,EAAG;AAC3B,MAAA,IAAA,CAAK,KAAK,sBAAA,EAAwB,EAAE,OAAA,EAAS,YAAA,EAAc,QAAQ,CAAA;AAAA,IACrE;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,OAAA,CAAQ,IAAA,EAAY,KAAA,EAAiD;AAEzE,IAAA,IAAA,CAAK,YAAA,GAAe,KAAA;AAGpB,IAAA,IAAA,CAAK,iBAAA,CAAkB,gBAAgB,KAAK,CAAA;AAG5C,IAAA,IAAA,CAAK,cAAA,GAAiB;AAAA,MACpB,aAAA,EAAe,CAAA;AAAA,MACf,cAAA,EAAgB,CAAA;AAAA,MAChB,eAAA,EAAiB,CAAA;AAAA,MACjB,SAAA,EAAW;AAAA,KACb;AAEA,IAAA,IAAI,SAAA,GAAY,CAAA;AAEhB,IAAA,OAAO,SAAA,GAAY,IAAA,CAAK,MAAA,CAAO,aAAA,EAAe;AAC5C,MAAA,SAAA,EAAA;AAGA,MAAA,IAAI,IAAA,CAAK,cAAA,CAAe,IAAI,CAAA,EAAG;AAC7B,QAAA;AAAA,MACF;AAGA,MAAA,IAAI,IAAA,CAAK,eAAA,CAAgB,IAAI,CAAA,EAAG;AAC9B,QAAA,OAAO;AAAA,UACL,MAAA,EAAQ,WAAA;AAAA,UACR,cAAA,EAAgB,KAAK,KAAA,CAAM,MAAA,CAAO,CAAC,CAAA,KAAM,CAAA,CAAE,MAAA,KAAW,WAAW,CAAA,CAAE,MAAA;AAAA,UACnE,WAAA,EAAa,KAAK,KAAA,CAAM,MAAA,CAAO,CAAC,CAAA,KAAM,CAAA,CAAE,MAAA,KAAW,QAAQ,CAAA,CAAE,MAAA;AAAA,UAC7D,YAAA,EAAc,KAAK,KAAA,CAAM,MAAA,CAAO,CAAC,CAAA,KAAM,CAAA,CAAE,MAAA,KAAW,SAAS,CAAA,CAAE,MAAA;AAAA,UAC/D,SAAS,IAAA,CAAK;AAAA,SAChB;AAAA,MACF;AAGA,MAAA,MAAM,SAAA,GAAY,uBAAuB,IAAI,CAAA;AAE7C,MAAA,IAAI,SAAA,CAAU,WAAW,CAAA,EAAG;AAE1B,QAAA;AAAA,MACF;AAGA,MAAA,MAAM,IAAA,CAAK,oBAAA,CAAqB,IAAA,EAAM,SAAS,CAAA;AAAA,IACjD;AAGA,IAAA,MAAM,WAAA,GAAc,KAAK,KAAA,CAAM,IAAA,CAAK,CAAC,CAAA,KAAM,CAAA,CAAE,WAAW,QAAQ,CAAA;AAChE,IAAA,MAAM,WAAA,GAAc,KAAK,KAAA,CAAM,KAAA;AAAA,MAAM,CAAC,MACpC,CAAC,WAAA,EAAa,WAAW,QAAQ,CAAA,CAAE,QAAA,CAAS,CAAA,CAAE,MAAM;AAAA,KACtD;AAEA,IAAA,OAAO;AAAA,MACL,MAAA,EAAQ,WAAA,GAAc,QAAA,GAAW,WAAA,GAAc,WAAA,GAAc,WAAA;AAAA,MAC7D,cAAA,EAAgB,KAAK,KAAA,CAAM,MAAA,CAAO,CAAC,CAAA,KAAM,CAAA,CAAE,MAAA,KAAW,WAAW,CAAA,CAAE,MAAA;AAAA,MACnE,WAAA,EAAa,KAAK,KAAA,CAAM,MAAA,CAAO,CAAC,CAAA,KAAM,CAAA,CAAE,MAAA,KAAW,QAAQ,CAAA,CAAE,MAAA;AAAA,MAC7D,YAAA,EAAc,KAAK,KAAA,CAAM,MAAA,CAAO,CAAC,CAAA,KAAM,CAAA,CAAE,MAAA,KAAW,SAAS,CAAA,CAAE,MAAA;AAAA,MAC/D,SAAS,IAAA,CAAK;AAAA,KAChB;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAeA,MAAc,oBAAA,CACZ,IAAA,EACA,KAAA,EACuD;AACvD,IAAA,MAAM,WAAA,GAAc,IAAA,CAAK,WAAA,EAAa,WAAA,IAAe,WAAA;AACrD,IAAA,MAAM,YAAoB,EAAC;AAC3B,IAAA,MAAM,SAAwB,EAAC;AAE/B,IAAA,IAAI,gBAAgB,WAAA,EAAa;AAI/B,MAAA,MAAM,OAAA,CAAQ,GAAA,CAAI,KAAA,CAAM,GAAA,CAAI,CAAC,IAAA,KAAS,IAAA,CAAK,WAAA,CAAY,IAAA,EAAM,IAAI,CAAC,CAAC,CAAA;AAGnE,MAAA,KAAA,MAAW,QAAQ,KAAA,EAAO;AACxB,QAAA,IAAI,IAAA,CAAK,WAAW,WAAA,EAAa;AAC/B,UAAA,SAAA,CAAU,KAAK,IAAI,CAAA;AAAA,QACrB,CAAA,MAAA,IAAW,IAAA,CAAK,MAAA,KAAW,QAAA,EAAU;AACnC,UAAA,MAAM,QAAA,GAAW,OAAO,IAAA,CAAK,MAAA,EAAQ,UAAU,QAAA,GAAW,IAAA,CAAK,OAAO,KAAA,GAAQ,aAAA;AAC9E,UAAA,MAAA,CAAO,IAAA,CAAK;AAAA,YACV,QAAQ,IAAA,CAAK,EAAA;AAAA,YACb,UAAU,IAAA,CAAK,IAAA;AAAA,YACf,KAAA,EAAO,IAAI,KAAA,CAAM,QAAQ;AAAA,WAC1B,CAAA;AAAA,QACH;AAAA,MACF;AAEA,MAAA,OAAO,EAAE,WAAW,MAAA,EAAO;AAAA,IAC7B;AAIA,IAAA,MAAM,OAAA,CAAQ,UAAA;AAAA,MACZ,KAAA,CAAM,GAAA,CAAI,OAAO,IAAA,KAAS;AACxB,QAAA,MAAM,IAAA,CAAK,WAAA,CAAY,IAAA,EAAM,IAAI,CAAA;AAAA,MACnC,CAAC;AAAA,KACH;AAGA,IAAA,KAAA,MAAW,QAAQ,KAAA,EAAO;AACxB,MAAA,IAAI,IAAA,CAAK,WAAW,WAAA,EAAa;AAC/B,QAAA,SAAA,CAAU,KAAK,IAAI,CAAA;AAAA,MACrB,CAAA,MAAA,IAAW,IAAA,CAAK,MAAA,KAAW,QAAA,EAAU;AACnC,QAAA,MAAM,QAAA,GAAW,OAAO,IAAA,CAAK,MAAA,EAAQ,UAAU,QAAA,GAAW,IAAA,CAAK,OAAO,KAAA,GAAQ,aAAA;AAC9E,QAAA,MAAA,CAAO,IAAA,CAAK;AAAA,UACV,QAAQ,IAAA,CAAK,EAAA;AAAA,UACb,UAAU,IAAA,CAAK,IAAA;AAAA,UACf,KAAA,EAAO,IAAI,KAAA,CAAM,QAAQ;AAAA,SAC1B,CAAA;AAAA,MACH;AAAA,IAEF;AAGA,IAAA,IAAI,WAAA,KAAgB,UAAA,IAAc,MAAA,CAAO,MAAA,GAAS,CAAA,EAAG;AACnD,MAAA,MAAM,IAAI,mBAAmB,MAAM,CAAA;AAAA,IACrC;AAGA,IAAA,OAAO,EAAE,WAAW,MAAA,EAAO;AAAA,EAC7B;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,MAAc,eAAe,IAAA,EAA8B;AACzD,IAAA,IAAI,CAAC,KAAK,SAAA,EAAW;AACnB,MAAA,OAAO,IAAA;AAAA,IACT;AAEA,IAAA,MAAM,MAAA,GAAS,IAAA,CAAK,MAAA,GAChB,CAAC,QAAgB,IAAA,CAAK,MAAA,CAAQ,QAAA,CAAS,GAAG,CAAA,GAC1C,CAAC,IAAA,KAAiB,OAAA,CAAQ,QAAQ,MAAS,CAAA;AAC/C,IAAA,OAAO,kBAAkB,IAAA,CAAK,SAAA,EAAW,EAAE,GAAA,EAAK,QAAQ,CAAA;AAAA,EAC1D;AAAA;AAAA;AAAA;AAAA,EAKQ,eAAe,IAAA,EAAoB;AAEzC,IAAA,MAAM,cAAA,GAAiB,KAAK,QAAA,EAAU,SAAA;AACtC,IAAA,IAAI,OAAO,cAAA,KAAmB,QAAA,IAAY,cAAA,GAAiB,CAAA,EAAG;AAC5D,MAAA,OAAO,cAAA;AAAA,IACT;AAEA,IAAA,OAAO,IAAA,CAAK,OAAO,WAAA,IAAe,uBAAA;AAAA,EACpC;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,WAAA,CAAY,IAAA,EAAY,IAAA,EAA2B;AAE/D,IAAA,IAAI,KAAK,SAAA,EAAW;AAClB,MAAA,MAAM,YAAA,GAAe,MAAM,IAAA,CAAK,cAAA,CAAe,IAAI,CAAA;AAEnD,MAAA,IAAI,CAAC,YAAA,EAAc;AACjB,QAAA,IAAI,IAAA,CAAK,SAAA,CAAU,OAAA,KAAY,MAAA,EAAQ;AACrC,UAAA,IAAA,CAAK,MAAA,GAAS,SAAA;AACd,UAAA,IAAA,CAAK,KAAK,cAAA,EAAgB,EAAE,IAAA,EAAM,MAAA,EAAQ,qBAAqB,CAAA;AAC/D,UAAA;AAAA,QACF,CAAA,MAAA,IAAW,IAAA,CAAK,SAAA,CAAU,OAAA,KAAY,MAAA,EAAQ;AAC5C,UAAA,IAAA,CAAK,MAAA,GAAS,QAAA;AACd,UAAA,IAAA,CAAK,MAAA,GAAS,EAAE,OAAA,EAAS,KAAA,EAAO,OAAO,mBAAA,EAAoB;AAC3D,UAAA,IAAA,CAAK,IAAA,CAAK,eAAe,EAAE,IAAA,EAAM,OAAO,IAAI,KAAA,CAAM,mBAAmB,CAAA,EAAG,CAAA;AACxE,UAAA;AAAA,QACF;AAEA,QAAA;AAAA,MACF;AAAA,IACF;AAGA,IAAA,IAAI,IAAA,CAAK,OAAO,UAAA,EAAY;AAC1B,MAAA,MAAM,WAAA,GAA2B;AAAA,QAC/B,QAAQ,IAAA,CAAK,EAAA;AAAA,QACb,UAAU,IAAA,CAAK,IAAA;AAAA,QACf,OAAA,EAAS,KAAK,QAAA,GAAW;AAAA,OAC3B;AACA,MAAA,MAAM,aAAa,MAAM,IAAA,CAAK,KAAA,CAAM,UAAA,CAAW,MAAM,WAAW,CAAA;AAChE,MAAA,IAAI,eAAe,MAAA,EAAQ;AACzB,QAAA,IAAA,CAAK,MAAA,GAAS,SAAA;AACd,QAAA,IAAA,CAAK,KAAK,cAAA,EAAgB,EAAE,IAAA,EAAM,MAAA,EAAQ,aAAa,CAAA;AACvD,QAAA;AAAA,MACF;AAAA,IACF;AAGA,IAAA,MAAM,WAAA,GAAc,gBAAA,CAAiB,IAAA,EAAM,aAAa,CAAA;AACxD,IAAA,MAAA,CAAO,MAAA,CAAO,MAAM,WAAW,CAAA;AAC/B,IAAA,IAAA,CAAK,IAAA,CAAK,YAAA,EAAc,EAAE,IAAA,EAAM,CAAA;AAGhC,IAAA,MAAM,SAAA,GAAY,IAAA,CAAK,cAAA,CAAe,IAAI,CAAA;AAE1C,IAAA,IAAI;AAEF,MAAA,MAAM,IAAA,CAAK,sBAAA,CAAuB,IAAA,EAAM,IAAA,EAAM,SAAS,CAAA;AAAA,IACzD,SAAS,KAAA,EAAO;AAEd,MAAA,IAAI,iBAAiB,gBAAA,EAAkB;AACrC,QAAA,IAAA,CAAK,IAAA,CAAK,cAAA,EAAgB,EAAE,IAAA,EAAM,WAAW,CAAA;AAAA,MAE/C;AAGA,MAAA,MAAM,GAAA,GAAM,iBAAiB,KAAA,GAAQ,KAAA,GAAQ,IAAI,KAAA,CAAM,MAAA,CAAO,KAAK,CAAC,CAAA;AAGpE,MAAA,IAAI,WAAA,GAAyC,OAAA;AAC7C,MAAA,IAAI,IAAA,CAAK,OAAO,OAAA,EAAS;AACvB,QAAA,MAAM,YAAA,GAA6B;AAAA,UACjC,IAAA;AAAA,UACA,KAAA,EAAO,GAAA;AAAA,UACP,KAAA,EAAO;AAAA,SACT;AACA,QAAA,WAAA,GAAc,MAAM,IAAA,CAAK,KAAA,CAAM,OAAA,CAAQ,KAAK,YAAY,CAAA;AAAA,MAC1D;AAEA,MAAA,IAAI,gBAAgB,MAAA,EAAQ;AAC1B,QAAA,IAAA,CAAK,MAAA,GAAS,SAAA;AACd,QAAA,IAAA,CAAK,KAAK,cAAA,EAAgB,EAAE,IAAA,EAAM,MAAA,EAAQ,mBAAmB,CAAA;AAC7D,QAAA;AAAA,MACF,CAAA,MAAA,IAAW,gBAAgB,MAAA,EAAQ;AAEjC,QAAA,MAAM,UAAA,GAAa,gBAAA,CAAiB,IAAA,EAAM,QAAQ,CAAA;AAClD,QAAA,UAAA,CAAW,MAAA,GAAS;AAAA,UAClB,OAAA,EAAS,KAAA;AAAA,UACT,OAAO,GAAA,CAAI;AAAA,SACb;AACA,QAAA,MAAA,CAAO,MAAA,CAAO,MAAM,UAAU,CAAA;AAC9B,QAAA,IAAA,CAAK,KAAK,aAAA,EAAe,EAAE,IAAA,EAAM,KAAA,EAAO,KAAK,CAAA;AAC7C,QAAA;AAAA,MACF;AAGA,MAAA,IAAI,IAAA,CAAK,QAAA,GAAW,IAAA,CAAK,WAAA,EAAa;AAEpC,QAAA,MAAM,SAAA,GAAY,gBAAA,CAAiB,IAAA,EAAM,SAAS,CAAA;AAClD,QAAA,MAAA,CAAO,MAAA,CAAO,MAAM,SAAS,CAAA;AAAA,MAC/B,CAAA,MAAO;AAEL,QAAA,MAAM,UAAA,GAAa,gBAAA,CAAiB,IAAA,EAAM,QAAQ,CAAA;AAClD,QAAA,UAAA,CAAW,MAAA,GAAS;AAAA,UAClB,OAAA,EAAS,KAAA;AAAA,UACT,OAAO,GAAA,CAAI;AAAA,SACb;AACA,QAAA,MAAA,CAAO,MAAA,CAAO,MAAM,UAAU,CAAA;AAC9B,QAAA,IAAA,CAAK,KAAK,aAAA,EAAe,EAAE,IAAA,EAAM,KAAA,EAAO,KAAK,CAAA;AAAA,MAC/C;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,sBAAA,CAAuB,IAAA,EAAY,IAAA,EAAY,SAAA,EAAkC;AAC7F,IAAA,OAAO,IAAI,OAAA,CAAc,CAAClB,QAAAA,EAAS,MAAA,KAAW;AAE5C,MAAA,MAAM,SAAA,GAAY,WAAW,MAAM;AACjC,QAAA,MAAA,CAAO,IAAI,gBAAA,CAAiB,IAAA,CAAK,IAAI,IAAA,CAAK,IAAA,EAAM,SAAS,CAAC,CAAA;AAAA,MAC5D,GAAG,SAAS,CAAA;AAGZ,MAAA,IAAA,CAAK,eAAA,CAAgB,IAAA,EAAM,IAAI,CAAA,CAC5B,KAAK,MAAM;AACV,QAAA,YAAA,CAAa,SAAS,CAAA;AACtB,QAAAA,QAAAA,EAAQ;AAAA,MACV,CAAC,CAAA,CACA,KAAA,CAAM,CAAC,KAAA,KAAU;AAChB,QAAA,YAAA,CAAa,SAAS,CAAA;AACtB,QAAA,MAAA,CAAO,KAAK,CAAA;AAAA,MACd,CAAC,CAAA;AAAA,IACL,CAAC,CAAA;AAAA,EACH;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,eAAA,CAAgB,IAAA,EAAY,IAAA,EAA2B;AAEnE,IAAA,MAAM,UAAA,GAAa,IAAA,CAAK,eAAA,CAAgB,IAAA,EAAM,IAAI,CAAA;AAGlD,IAAA,IAAA,CAAK,UAAA,CAAW,QAAQ,IAAI,CAAA;AAC5B,IAAA,IAAA,CAAK,YAAA,CAAa,gBAAgB,UAAU,CAAA;AAG5C,IAAA,MAAM,IAAA,CAAK,aAAa,OAAA,EAAQ;AAGhC,IAAA,IAAA,CAAK,YAAA,CAAa,cAAA,CAAe,MAAA,EAAQ,UAAU,CAAA;AAEnD,IAAA,IAAA,CAAK,KAAK,UAAA,EAAY,EAAE,SAAA,EAAW,IAAA,CAAK,UAAU,CAAA;AAGlD,IAAA,IAAI,WAAkB,CAAC,EAAE,MAAM,MAAA,EAAQ,OAAA,EAAS,YAAY,CAAA;AAC5D,IAAA,IAAI,IAAA,CAAK,OAAO,aAAA,EAAe;AAC7B,MAAA,QAAA,GAAW,MAAM,IAAA,CAAK,KAAA,CAAM,aAAA,CAAc,QAAA,EAAU;AAAA,QAClD,KAAA,EAAO,KAAK,KAAA,CAAM,KAAA;AAAA,QAClB,WAAA,EAAa;AAAA;AAAA,OACd,CAAA;AAAA,IACH;AAIA,IAAA,MAAM,cAAA,GAAiB,IAAA,CAAK,SAAA,EAAW,cAAA,KAAmB,KAAA;AAC1D,IAAA,IAAI,IAAA,CAAK,aAAa,cAAA,EAAgB;AACpC,MAAA,MAAM,QAAA,GAAW,MAAM,IAAA,CAAK,cAAA,CAAe,IAAI,CAAA;AAC/C,MAAA,IAAI,CAAC,QAAA,EAAU;AAEb,QAAA,IAAA,CAAK,MAAA,GAAS,SAAA;AACd,QAAA,IAAA,CAAK,KAAK,cAAA,EAAgB,EAAE,IAAA,EAAM,MAAA,EAAQ,qBAAqB,CAAA;AAC/D,QAAA;AAAA,MACF;AAAA,IACF;AAGA,IAAA,IAAI,KAAK,WAAA,EAAa;AACpB,MAAA,MAAM,IAAA,CAAK,YAAY,OAAA,EAAQ;AAAA,IACjC;AAGA,IAAA,MAAM,QAAA,GAAW,MAAM,IAAA,CAAK,KAAA,CAAM,IAAI,UAAU,CAAA;AAGhD,IAAA,IAAI,SAAS,KAAA,EAAO;AAClB,MAAA,IAAA,CAAK,cAAA,CAAe,aAAA,EAAA;AACpB,MAAA,IAAA,CAAK,cAAA,CAAe,eAAA,IAAmB,QAAA,CAAS,KAAA,CAAM,YAAA,IAAgB,CAAA;AAGtE,MAAA,IAAI,IAAA,CAAK,MAAM,KAAA,IAAS,QAAA,CAAS,MAAM,YAAA,IAAgB,QAAA,CAAS,MAAM,aAAA,EAAe;AACnF,QAAA,MAAM,IAAA,GAAO,aAAA,CAAc,IAAA,CAAK,KAAA,CAAM,KAAA,EAAO,SAAS,KAAA,CAAM,YAAA,EAAc,QAAA,CAAS,KAAA,CAAM,aAAa,CAAA;AACtG,QAAA,IAAI,SAAS,IAAA,EAAM;AACjB,UAAA,IAAA,CAAK,eAAe,SAAA,IAAa,IAAA;AAAA,QACnC;AAAA,MACF;AAAA,IACF;AAGA,IAAA,MAAM,YAAA,GAAe,IAAA,CAAK,KAAA,CAAM,UAAA,EAAW;AAC3C,IAAA,IAAI,YAAA,EAAc;AAChB,MAAA,IAAA,CAAK,cAAA,CAAe,kBAAkB,YAAA,CAAa,aAAA;AAAA,IACrD;AAGA,IAAA,IAAI,IAAA,CAAK,OAAO,YAAA,EAAc;AAC5B,MAAA,MAAM,IAAA,CAAK,KAAA,CAAM,YAAA,CAAa,QAAQ,CAAA;AAAA,IACxC;AAGA,IAAA,IAAI,KAAK,YAAA,EAAc;AACrB,MAAA,MAAM,IAAA,CAAK,iBAAA,CAAkB,SAAA,CAAU,IAAA,CAAK,YAAY,CAAA;AAAA,IAC1D;AAGA,IAAA,MAAM,KAAK,YAAA,CAAa,UAAA,CAAW,WAAA,EAAa,QAAA,CAAS,eAAe,EAAE,CAAA;AAG1E,IAAA,MAAM,mBAAmB,MAAM,IAAA,CAAK,uBAAuB,IAAA,EAAM,QAAA,CAAS,eAAe,EAAE,CAAA;AAG3F,IAAA,IAAA,CAAK,QAAA,GAAW,IAAA,CAAK,QAAA,IAAY,EAAC;AAClC,IAAA,IAAA,CAAK,SAAS,gBAAA,GAAmB,gBAAA;AAGjC,IAAA,IAAI,iBAAiB,oBAAA,EAAsB;AAEzC,MAAA,IAAA,CAAK,KAAK,2BAAA,EAA6B,EAAE,IAAA,EAAM,UAAA,EAAY,kBAAkB,CAAA;AAI7E,MAAA,IAAI,IAAA,CAAK,UAAA,EAAY,IAAA,KAAS,QAAA,EAAU;AACtC,QAAA;AAAA,MACF;AAAA,IACF;AAEA,IAAA,IAAI,CAAC,iBAAiB,UAAA,EAAY;AAEhC,MAAA,IAAI,IAAA,CAAK,UAAA,EAAY,IAAA,KAAS,QAAA,EAAU;AAEtC,QAAA,IAAA,CAAK,KAAK,wBAAA,EAA0B,EAAE,IAAA,EAAM,UAAA,EAAY,kBAAkB,CAAA;AAC1E,QAAA,MAAM,IAAI,mBAAA;AAAA,UACR,IAAA,CAAK,EAAA;AAAA,UACL,IAAA,CAAK,IAAA;AAAA,UACL,CAAA,iBAAA,EAAoB,gBAAA,CAAiB,eAAe,CAAA,mBAAA,EAAsB,iBAAiB,WAAW,CAAA;AAAA,SACxG;AAAA,MACF,CAAA,MAAO;AAEL,QAAA,IAAA,CAAK,KAAK,wBAAA,EAA0B,EAAE,IAAA,EAAM,UAAA,EAAY,kBAAkB,CAAA;AAAA,MAE5E;AAAA,IACF;AAGA,IAAA,MAAM,aAAA,GAAgB,gBAAA,CAAiB,IAAA,EAAM,WAAW,CAAA;AACxD,IAAA,aAAA,CAAc,MAAA,GAAS;AAAA,MACrB,OAAA,EAAS,IAAA;AAAA,MACT,QAAQ,QAAA,CAAS,WAAA;AAAA,MACjB,iBAAiB,gBAAA,CAAiB,eAAA;AAAA,MAClC,uBAAuB,gBAAA,CAAiB;AAAA,KAC1C;AACA,IAAA,MAAA,CAAO,MAAA,CAAO,MAAM,aAAa,CAAA;AAEjC,IAAA,IAAA,CAAK,KAAK,eAAA,EAAiB,EAAE,IAAA,EAAM,MAAA,EAAQ,UAAU,CAAA;AAGrD,IAAA,MAAM,IAAA,CAAK,4BAAA,CAA6B,IAAA,EAAM,IAAA,CAAK,EAAE,CAAA;AAGrD,IAAA,IAAI,IAAA,CAAK,OAAO,SAAA,EAAW;AACzB,MAAA,MAAM,IAAA,CAAK,KAAA,CAAM,SAAA,CAAU,IAAA,EAAM;AAAA,QAC/B,OAAA,EAAS,IAAA;AAAA,QACT,QAAQ,QAAA,CAAS;AAAA,OAClB,CAAA;AAAA,IACH;AAGA,IAAA,IAAI,KAAK,kBAAA,EAAoB;AAC3B,MAAA,IAAA,CAAK,MAAA,GAAS,kBAAA;AAGd,MAAA,IAAI,KAAK,YAAA,EAAc;AACrB,QAAA,MAAM,IAAA,CAAK,iBAAA,CAAkB,UAAA,CAAW,IAAA,CAAK,cAAc,sBAAsB,CAAA;AAAA,MACnF;AAEA,MAAA,MAAM,IAAA,CAAK,eAAA,CAAgB,YAAA,CAAa,IAAI,CAAA;AAC5C,MAAA,IAAA,CAAK,IAAA,CAAK,uBAAA,EAAyB,EAAE,IAAA,EAAM,CAAA;AAAA,IAC7C;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,eAAA,CAAgB,MAAY,IAAA,EAAoB;AACtD,IAAA,MAAM,SAAmB,EAAC;AAE1B,IAAA,MAAA,CAAO,IAAA,CAAK,CAAA,iBAAA,EAAoB,IAAA,CAAK,IAAI,CAAA,CAAE,CAAA;AAC3C,IAAA,MAAA,CAAO,KAAK,EAAE,CAAA;AACd,IAAA,MAAA,CAAO,IAAA,CAAK,CAAA,iBAAA,EAAoB,IAAA,CAAK,WAAW,CAAA,CAAE,CAAA;AAElD,IAAA,IAAI,KAAK,cAAA,EAAgB;AACvB,MAAA,MAAA,CAAO,IAAA,CAAK,CAAA,qBAAA,EAAwB,IAAA,CAAK,cAAc,CAAA,CAAE,CAAA;AAAA,IAC3D;AAEA,IAAA,IAAI,IAAA,CAAK,SAAA,CAAU,MAAA,GAAS,CAAA,EAAG;AAC7B,MAAA,MAAM,OAAO,IAAA,CAAK,KAAA,CACf,MAAA,CAAO,CAAC,MAAM,IAAA,CAAK,SAAA,CAAU,QAAA,CAAS,CAAA,CAAE,EAAE,CAAC,CAAA,CAC3C,IAAI,CAAC,CAAA,KAAM,EAAE,IAAI,CAAA;AACpB,MAAA,MAAA,CAAO,KAAK,CAAA,4BAAA,EAA+B,IAAA,CAAK,IAAA,CAAK,IAAI,CAAC,CAAA,CAAE,CAAA;AAAA,IAC9D;AAEA,IAAA,MAAA,CAAO,KAAK,EAAE,CAAA;AACd,IAAA,MAAA,CAAO,KAAK,sDAAsD,CAAA;AAElE,IAAA,OAAO,MAAA,CAAO,KAAK,IAAI,CAAA;AAAA,EACzB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,MAAc,sBAAA,CACZ,IAAA,EACA,MAAA,EAC+B;AAG/B,IAAA,IAAI,CAAC,IAAA,CAAK,UAAA,IAAc,IAAA,CAAK,WAAW,cAAA,EAAgB;AACtD,MAAA,OAAO;AAAA,QACL,UAAA,EAAY,IAAA;AAAA,QACZ,eAAA,EAAiB,GAAA;AAAA,QACjB,WAAA,EAAa,gDAAA;AAAA,QACb,oBAAA,EAAsB;AAAA,OACxB;AAAA,IACF;AAGA,IAAA,IAAI,IAAA,CAAK,KAAA,EAAO,YAAA,IAAgB,IAAA,CAAK,MAAA,EAAQ;AAC3C,MAAA,MAAM,UAAA,GAAa,EAAE,OAAA,EAAS,IAAA,EAAM,MAAA,EAAO;AAC3C,MAAA,MAAM,UAAA,GAAa,MAAM,IAAA,CAAK,KAAA,CAAM,aAAa,IAAA,EAAM,UAAA,EAAY,KAAK,MAAM,CAAA;AAG9E,MAAA,IAAI,OAAO,eAAe,SAAA,EAAW;AACnC,QAAA,OAAO;AAAA,UACL,UAAA,EAAY,UAAA;AAAA,UACZ,eAAA,EAAiB,aAAa,GAAA,GAAM,CAAA;AAAA,UACpC,WAAA,EAAa,aAAa,0BAAA,GAA6B,yBAAA;AAAA,UACvD,oBAAA,EAAsB;AAAA,SACxB;AAAA,MACF,CAAA,MAAA,IAAW,OAAO,UAAA,KAAe,QAAA,EAAU;AACzC,QAAA,OAAO;AAAA,UACL,UAAA,EAAY,KAAA;AAAA,UACZ,eAAA,EAAiB,CAAA;AAAA,UACjB,WAAA,EAAa,UAAA;AAAA,UACb,oBAAA,EAAsB;AAAA,SACxB;AAAA,MACF,CAAA,MAAO;AAEL,QAAA,OAAO,UAAA;AAAA,MACT;AAAA,IACF;AAGA,IAAA,IAAI,KAAK,UAAA,CAAW,kBAAA,IAAsB,KAAK,UAAA,CAAW,kBAAA,CAAmB,SAAS,CAAA,EAAG;AACvF,MAAA,MAAM,cAAwB,EAAC;AAC/B,MAAA,KAAA,MAAW,GAAA,IAAO,IAAA,CAAK,UAAA,CAAW,kBAAA,EAAoB;AAEpD,QAAA,MAAM,KAAA,GAAQ,KAAK,MAAA,GAAS,MAAM,KAAK,MAAA,CAAO,QAAA,CAAS,GAAG,CAAA,GAAI,MAAA;AAC9D,QAAA,IAAI,UAAU,MAAA,EAAW;AACvB,UAAA,WAAA,CAAY,KAAK,GAAG,CAAA;AAAA,QACtB;AAAA,MACF;AACA,MAAA,IAAI,WAAA,CAAY,SAAS,CAAA,EAAG;AAC1B,QAAA,OAAO;AAAA,UACL,UAAA,EAAY,KAAA;AAAA,UACZ,eAAA,EAAiB,CAAA;AAAA,UACjB,WAAA,EAAa,CAAA,gCAAA,EAAmC,WAAA,CAAY,IAAA,CAAK,IAAI,CAAC,CAAA,CAAA;AAAA,UACtE,oBAAA,EAAsB;AAAA,SACxB;AAAA,MACF;AAAA,IACF;AAGA,IAAA,IAAI,CAAC,KAAK,UAAA,CAAW,kBAAA,IAAsB,KAAK,UAAA,CAAW,kBAAA,CAAmB,WAAW,CAAA,EAAG;AAC1F,MAAA,OAAO;AAAA,QACL,UAAA,EAAY,IAAA;AAAA,QACZ,eAAA,EAAiB,GAAA;AAAA,QACjB,WAAA,EAAa,wDAAA;AAAA,QACb,oBAAA,EAAsB;AAAA,OACxB;AAAA,IACF;AAGA,IAAA,MAAM,gBAAA,GAAmB,IAAA,CAAK,qBAAA,CAAsB,IAAA,EAAM,MAAM,CAAA;AAGhE,IAAA,IAAA,CAAK,KAAK,UAAA,EAAY,EAAE,SAAA,EAAW,IAAA,CAAK,UAAU,CAAA;AAClD,IAAA,MAAM,kBAAA,GAAqB,MAAM,IAAA,CAAK,KAAA,CAAM,IAAI,gBAAgB,CAAA;AAGhE,IAAA,IAAI,mBAAmB,KAAA,EAAO;AAC5B,MAAA,IAAA,CAAK,cAAA,CAAe,aAAA,EAAA;AACpB,MAAA,IAAA,CAAK,cAAA,CAAe,eAAA,IAAmB,kBAAA,CAAmB,KAAA,CAAM,YAAA,IAAgB,CAAA;AAEhF,MAAA,IAAI,IAAA,CAAK,MAAM,KAAA,IAAS,kBAAA,CAAmB,MAAM,YAAA,IAAgB,kBAAA,CAAmB,MAAM,aAAA,EAAe;AACvG,QAAA,MAAM,IAAA,GAAO,aAAA;AAAA,UACX,KAAK,KAAA,CAAM,KAAA;AAAA,UACX,mBAAmB,KAAA,CAAM,YAAA;AAAA,UACzB,mBAAmB,KAAA,CAAM;AAAA,SAC3B;AACA,QAAA,IAAI,SAAS,IAAA,EAAM;AACjB,UAAA,IAAA,CAAK,eAAe,SAAA,IAAa,IAAA;AAAA,QACnC;AAAA,MACF;AAAA,IACF;AAGA,IAAA,MAAM,sBAAA,GAAyB,IAAA,CAAK,KAAA,CAAM,UAAA,EAAW;AACrD,IAAA,IAAI,sBAAA,EAAwB;AAC1B,MAAA,IAAA,CAAK,cAAA,CAAe,kBAAkB,sBAAA,CAAuB,aAAA;AAAA,IAC/D;AAGA,IAAA,OAAO,IAAA,CAAK,uBAAA;AAAA,MACV,IAAA;AAAA,MACA,mBAAmB,WAAA,IAAe;AAAA,KACpC;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,qBAAA,CAAsB,MAAY,MAAA,EAAwB;AAChE,IAAA,MAAM,QAAA,GAAW,IAAA,CAAK,UAAA,EAAY,kBAAA,IAAsB,EAAC;AACzD,IAAA,MAAM,QAAA,GAAW,IAAA,CAAK,UAAA,EAAY,kBAAA,IAAsB,EAAA;AAExD,IAAA,OAAO,CAAA;;AAAA;AAAA,eAAA,EAGM,KAAK,IAAI;AAAA,sBAAA,EACF,KAAK,WAAW;AAAA,EACtC,KAAK,cAAA,GAAiB,CAAA,qBAAA,EAAwB,IAAA,CAAK,cAAc,KAAK,EAAE;;AAAA;AAAA;AAAA,EAIxE,QAAA,CAAS,GAAA,CAAI,CAAC,CAAA,EAAG,MAAM,CAAA,EAAG,CAAA,GAAI,CAAC,CAAA,EAAA,EAAK,CAAC,CAAA,CAAE,CAAA,CAAE,IAAA,CAAK,IAAI,CAAC;;AAAA;AAAA;AAAA;AAAA,EAKnD,MAAM;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kCAAA,EAQ4B,QAAQ,CAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA,0GAAA,EAYgE,QAAQ,CAAA,gCAAA,CAAA;AAAA,EAClH;AAAA;AAAA;AAAA;AAAA,EAKQ,uBAAA,CACN,MACA,YAAA,EACsB;AACtB,IAAA,MAAM,QAAA,GAAW,IAAA,CAAK,UAAA,EAAY,kBAAA,IAAsB,EAAA;AACxD,IAAA,MAAM,eAAA,GAAkB,IAAA,CAAK,UAAA,EAAY,mBAAA,IAAuB,OAAA;AAchE,IAAA,MAAM,gBAAA,GAAmB,YAAgC,YAAY,CAAA;AAErE,IAAA,IAAI,gBAAA,CAAiB,OAAA,IAAW,gBAAA,CAAiB,IAAA,EAAM;AACrD,MAAA,MAAM,SAAS,gBAAA,CAAiB,IAAA;AAEhC,MAAA,MAAM,eAAA,GAAkB,OAAO,MAAA,CAAO,eAAA,KAAoB,WACtD,IAAA,CAAK,GAAA,CAAI,CAAA,EAAG,IAAA,CAAK,GAAA,CAAI,GAAA,EAAK,MAAA,CAAO,eAAe,CAAC,CAAA,GACjD,CAAA;AAEJ,MAAA,MAAM,aAAa,eAAA,IAAmB,QAAA;AAGtC,MAAA,IAAI,oBAAA,GAAuB,KAAA;AAC3B,MAAA,IAAI,cAAA;AAEJ,MAAA,IAAI,oBAAoB,QAAA,EAAU;AAChC,QAAA,oBAAA,GAAuB,IAAA;AACvB,QAAA,cAAA,GAAiB,iDAAA;AAAA,MACnB,CAAA,MAAA,IAAW,oBAAoB,WAAA,EAAa;AAE1C,QAAA,MAAM,kBAAA,GAAqB,IAAA,CAAK,GAAA,CAAI,QAAA,GAAW,IAAI,EAAE,CAAA;AACrD,QAAA,IAAI,eAAA,IAAmB,kBAAA,IAAsB,eAAA,GAAkB,QAAA,EAAU;AACvE,UAAA,oBAAA,GAAuB,IAAA;AACvB,UAAA,cAAA,GAAiB,qBAAqB,eAAe,CAAA,4DAAA,CAAA;AAAA,QACvD;AAAA,MACF;AAEA,MAAA,OAAO;AAAA,QACL,UAAA;AAAA,QACA,eAAA;AAAA,QACA,WAAA,EAAa,OAAO,WAAA,IAAe,yBAAA;AAAA,QACnC,iBAAiB,MAAA,CAAO,eAAA;AAAA,QACxB,oBAAA;AAAA,QACA;AAAA,OACF;AAAA,IACF;AAGA,IAAA,MAAM,KAAA,GAAQ,cAAc,YAAA,EAAc;AAAA,MACxC,mCAAA;AAAA,MACA;AAAA,OACC,EAAE,CAAA;AAEL,IAAA,OAAO;AAAA,MACL,YAAY,KAAA,IAAS,QAAA;AAAA,MACrB,eAAA,EAAiB,KAAA;AAAA,MACjB,WAAA,EAAa,yDAAyD,KAAK,CAAA,CAAA,CAAA;AAAA,MAC3E,oBAAA,EAAsB,eAAA,KAAoB,QAAA,IAAY,eAAA,KAAoB,WAAA;AAAA,MAC1E,cAAA,EAAgB;AAAA,KAClB;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,eAAe,IAAA,EAAqB;AAC1C,IAAA,OAAO,IAAA,CAAK,KAAA,CAAM,KAAA,CAAM,CAAC,CAAA,KAAM,CAAC,WAAA,EAAa,SAAA,EAAW,QAAQ,CAAA,CAAE,QAAA,CAAS,CAAA,CAAE,MAAM,CAAC,CAAA;AAAA,EACtF;AAAA;AAAA;AAAA;AAAA,EAKQ,gBAAgB,IAAA,EAAqB;AAC3C,IAAA,OAAO,KAAK,KAAA,CAAM,IAAA,CAAK,CAAC,CAAA,KAAM,CAAA,CAAE,WAAW,kBAAkB,CAAA;AAAA,EAC/D;AAAA;AAAA;AAAA;AAAA,EAKA,MAAA,GAAe;AACb,IAAA,IAAA,CAAK,gBAAgB,KAAA,EAAM;AAAA,EAC7B;AAAA;AAAA;AAAA;AAAA,EAKA,IAAI,WAAA,GAAuB;AACzB,IAAA,OAAO,IAAA,CAAK,YAAA;AAAA,EACd;AAAA;AAAA;AAAA;AAAA,EAKA,OAAA,GAAgB;AACd,IAAA,IAAA,CAAK,OAAA,EAAQ;AAAA,EACf;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,OAAA,GAAgB;AACd,IAAA,IAAI,KAAK,YAAA,EAAc;AACvB,IAAA,IAAA,CAAK,YAAA,GAAe,IAAA;AACpB,IAAA,IAAA,CAAK,gBAAgB,KAAA,EAAM;AAC3B,IAAA,IAAA,CAAK,kBAAA,EAAmB;AAAA,EAC1B;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,mBAAA,GAA+C;AAC7C,IAAA,OAAO,IAAA,CAAK,gBAAA;AAAA,EACd;AAAA;AAAA;AAAA;AAAA,EAKA,qBAAA,GAA6H;AAC3H,IAAA,IAAI,CAAC,KAAK,WAAA,EAAa;AACrB,MAAA,OAAO,IAAA;AAAA,IACT;AACA,IAAA,OAAO,IAAA,CAAK,YAAY,UAAA,EAAW;AAAA,EACrC;AAAA;AAAA;AAAA;AAAA,EAKA,gBAAA,GAAyB;AACvB,IAAA,IAAA,CAAK,aAAa,KAAA,EAAM;AAAA,EAC1B;AACF;;;AC96BO,IAAM,2BAAA,GAAkD;AAAA,EAC7D,cAAA,EAAgB,CAAA;AAAA,EAChB,aAAA,EAAe,CAAA;AAAA,EACf,UAAA,EAAY,GAAA;AAAA;AAAA,EACZ,kBAAA,EAAoB,IAAA;AAAA,EACpB,IAAA,EAAM;AACR;AAKO,IAAM,oBAAN,MAAwB;AAAA,EACrB,OAAA;AAAA,EACA,QAAA;AAAA,EACA,wBAAA,GAA2B,CAAA;AAAA,EAC3B,uBAAA,GAA0B,CAAA;AAAA,EAC1B,aAAA;AAAA,EACA,kBAAA,uBAAyB,GAAA,EAAmB;AAAA,EAC5C,YAAA,GAAkC,IAAA;AAAA,EAE1C,WAAA,CAAY,OAAA,EAAwB,QAAA,GAA+B,2BAAA,EAA6B;AAC9F,IAAA,IAAA,CAAK,OAAA,GAAU,OAAA;AACf,IAAA,IAAA,CAAK,QAAA,GAAW,QAAA;AAGhB,IAAA,IAAI,IAAA,CAAK,SAAS,UAAA,EAAY;AAC5B,MAAA,IAAA,CAAK,aAAA,GAAgB,YAAY,MAAM;AACrC,QAAA,IAAA,CAAK,uBAAA,EAAwB;AAAA,MAC/B,CAAA,EAAG,IAAA,CAAK,QAAA,CAAS,UAAU,CAAA;AAAA,IAC7B;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,gBAAgB,KAAA,EAAyB;AACvC,IAAA,IAAA,CAAK,YAAA,GAAe,KAAA;AAAA,EACtB;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,WAAW,KAAA,EAAkC;AACjD,IAAA,IAAA,CAAK,wBAAA,EAAA;AAEL,IAAA,IAAI,KAAK,QAAA,CAAS,cAAA,IAAkB,KAAK,wBAAA,IAA4B,IAAA,CAAK,SAAS,cAAA,EAAgB;AACjG,MAAA,MAAM,IAAA,CAAK,UAAA,CAAW,KAAA,EAAO,YAAY,CAAA;AAAA,IAC3C;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,UAAU,KAAA,EAAkC;AAChD,IAAA,IAAA,CAAK,uBAAA,EAAA;AAEL,IAAA,IAAI,KAAK,QAAA,CAAS,aAAA,IAAiB,KAAK,uBAAA,IAA2B,IAAA,CAAK,SAAS,aAAA,EAAe;AAC9F,MAAA,MAAM,IAAA,CAAK,UAAA,CAAW,KAAA,EAAO,WAAW,CAAA;AAAA,IAC1C;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,UAAA,CAAW,KAAA,EAAmB,MAAA,EAA+B;AACjE,IAAA,MAAM,iBAAA,GAAoB,IAAA,CAAK,YAAA,CAAa,KAAA,EAAO,MAAM,CAAA;AAEzD,IAAA,IAAI,IAAA,CAAK,QAAA,CAAS,IAAA,KAAS,MAAA,EAAQ;AACjC,MAAA,MAAM,iBAAA;AAAA,IACR,CAAA,MAAO;AAEL,MAAA,IAAA,CAAK,kBAAA,CAAmB,IAAI,iBAAiB,CAAA;AAC7C,MAAA,iBAAA,CAAkB,QAAQ,MAAM;AAC9B,QAAA,IAAA,CAAK,kBAAA,CAAmB,OAAO,iBAAiB,CAAA;AAAA,MAClD,CAAC,CAAA;AAAA,IACH;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,YAAA,CAAa,KAAA,EAAmB,OAAA,EAAgC;AAC5E,IAAA,IAAI;AAEF,MAAA,MAAM,IAAA,CAAK,OAAA,CAAQ,KAAA,CAAM,IAAA,CAAK,KAAK,CAAA;AAGnC,MAAA,MAAM,IAAA,CAAK,OAAA,CAAQ,IAAA,CAAK,QAAA,CAAS,MAAM,IAAI,CAAA;AAG3C,MAAA,IAAA,CAAK,wBAAA,GAA2B,CAAA;AAChC,MAAA,IAAA,CAAK,uBAAA,GAA0B,CAAA;AAAA,IACjC,SAAS,KAAA,EAAO;AACd,MAAA,OAAA,CAAQ,KAAA,CAAM,CAAA,mBAAA,EAAsB,OAAO,CAAA,EAAA,CAAA,EAAM,KAAK,CAAA;AAAA,IAExD;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,uBAAA,GAAgC;AACtC,IAAA,IAAI,KAAK,YAAA,EAAc;AAErB,MAAA,IAAA,CAAK,UAAA,CAAW,IAAA,CAAK,YAAA,EAAc,UAAU,CAAA;AAAA,IAC/C;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,KAAA,GAAuB;AAC3B,IAAA,MAAM,QAAQ,GAAA,CAAI,KAAA,CAAM,IAAA,CAAK,IAAA,CAAK,kBAAkB,CAAC,CAAA;AAAA,EACvD;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,OAAA,GAAyB;AAC7B,IAAA,IAAI,KAAK,aAAA,EAAe;AACtB,MAAA,aAAA,CAAc,KAAK,aAAa,CAAA;AAAA,IAClC;AAGA,IAAA,MAAM,KAAK,KAAA,EAAM;AAAA,EACnB;AACF;;;AV6FO,IAAM,SAAA,GAAN,MAAM,UAAA,SAAkB,SAAA,CAA4C;AAAA,EAChE,EAAA;AAAA,EACC,KAAA;AAAA,EACA,YAAA;AAAA;AAAA;AAAA,EAGA,KAAA;AAAA,EACA,gBAAA;AAAA;AAAA,EAGA,KAAA;AAAA;AAAA;AAAA,EAGA,WAAA;AAAA,EACA,aAAA;AAAA,EACA,eAAA;AAAA,EACA,YAAA;AAAA,EACA,iBAAA;AAAA,EACA,YAA4B,EAAC;AAAA;AAAA,EAG/B,wBAA2C,EAAC;AAAA;AAAA;AAAA;AAAA;AAAA,EAOpD,OAAO,OAAO,MAAA,EAAoC;AAEhD,IAAA,MAAM,SAAA,GACJ,OAAO,MAAA,CAAO,SAAA,KAAc,QAAA,GAAW,UAAU,GAAA,CAAI,MAAA,CAAO,SAAS,CAAA,GAAI,MAAA,CAAO,SAAA;AAElF,IAAA,IAAI,CAAC,SAAA,EAAW;AACd,MAAA,MAAM,IAAI,KAAA,CAAM,CAAA,WAAA,EAAc,MAAA,CAAO,SAAS,CAAA,WAAA,CAAa,CAAA;AAAA,IAC7D;AAGA,IAAA,MAAM,YAAA,GAAe,MAAA,CAAO,OAAA,IAAW,kBAAA,CAAmB,EAAE,CAAA;AAI5D,IAAA,MAAM,YAAA,GAAe,OAAO,YAAA,IAAgB,qBAAA;AAG5C,IAAA,MAAM,EAAA,GAAK,CAAA,WAAA,EAAc,IAAA,CAAK,GAAA,EAAK,CAAA,CAAA,EAAI,IAAA,CAAK,MAAA,EAAO,CAAE,SAAS,EAAE,CAAA,CAAE,MAAA,CAAO,CAAA,EAAG,CAAC,CAAC,CAAA,CAAA;AAG9E,IAAA,MAAM,SAAA,GAAY,WAAW,EAAE,IAAA,EAAM,IAAI,KAAA,EAAO,IAAI,CAAA;AAEpD,IAAA,MAAM,gBAAA,GAAmB;AAAA,MACvB,eAAe,OAAO,MAAA,CAAO,cAAc,QAAA,GAAW,MAAA,CAAO,YAAY,SAAA,CAAU,IAAA;AAAA,MACnF,OAAO,MAAA,CAAO,KAAA;AAAA,MACd,aAAa,MAAA,CAAO,WAAA;AAAA,MACpB,eAAe,MAAA,CAAO,aAAA;AAAA,MACtB,SAAA,EAAA,CAAY,MAAA,CAAO,KAAA,IAAS,EAAC,EAAG,GAAA,CAAI,CAAC,CAAA,KAAM,CAAA,CAAE,UAAA,CAAW,QAAA,CAAS,IAAI;AAAA,KACvE;AAEA,IAAA,MAAM,KAAA,GAAQ,gBAAA,CAAiB,EAAA,EAAI,gBAAA,EAAkB,SAAS,CAAA;AAG9D,IAAA,MAAM,eAAA,GAAmC;AAAA,MACvC,GAAG,MAAA;AAAA;AAAA,MAEH,OAAA,EAAS;AAAA,QACP,GAAI,OAAO,MAAA,CAAO,YAAY,QAAA,IAAY,MAAA,CAAO,YAAY,IAAA,IAAQ,EAAE,OAAO,OAAA,YAAmB,MAAA,CAAO,eAAe,MAAA,CAAO,OAAO,GAAG,WAAA,CAAA,GAAe,MAAA,CAAO,UAAU,EAAC;AAAA,QACzK,MAAA,EAAQ;AAAA,UACN,SAAS,YAAA,CAAa,MAAA;AAAA,UACtB,GAAG;AAAA;AACL;AACF,KACF;AAEA,IAAA,MAAM,SAAA,GAAY,IAAI,UAAA,CAAU,EAAA,EAAI,OAAO,YAAA,EAAc,eAAA,EAAiB,OAAO,KAAK,CAAA;AAGtF,IAAA,SAAA,CAAU,qBAAqB,eAAe,CAAA;AAE9C,IAAA,OAAO,SAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,aAAa,MAAA,CACX,OAAA,EACA,OAAA,EACoB;AACpB,IAAA,MAAM,QAAQ,MAAM,OAAA,CAAQ,OAAA,CAAQ,KAAA,CAAM,KAAK,OAAO,CAAA;AACtD,IAAA,IAAI,CAAC,KAAA,EAAO;AACV,MAAA,MAAM,IAAI,KAAA,CAAM,CAAA,MAAA,EAAS,OAAO,CAAA,qBAAA,CAAuB,CAAA;AAAA,IACzD;AAGA,IAAA,MAAM,iBAAiB,IAAI,GAAA,CAAI,MAAM,MAAA,CAAO,SAAA,IAAa,EAAE,CAAA;AAC3D,IAAA,MAAM,mBAAmB,IAAI,GAAA;AAAA,MAAA,CAC1B,OAAA,CAAQ,KAAA,IAAS,EAAC,EAAG,GAAA,CAAI,CAAC,CAAA,KAAM,CAAA,CAAE,UAAA,CAAW,QAAA,CAAS,IAAI;AAAA,KAC7D;AAEA,IAAA,MAAM,OAAA,GAAU,CAAC,GAAG,cAAc,CAAA,CAAE,MAAA,CAAO,CAAC,CAAA,KAAM,CAAC,gBAAA,CAAiB,GAAA,CAAI,CAAC,CAAC,CAAA;AAC1E,IAAA,MAAM,KAAA,GAAQ,CAAC,GAAG,gBAAgB,CAAA,CAAE,MAAA,CAAO,CAAC,CAAA,KAAM,CAAC,cAAA,CAAe,GAAA,CAAI,CAAC,CAAC,CAAA;AAExE,IAAA,IAAI,OAAA,CAAQ,SAAS,CAAA,EAAG;AACtB,MAAA,OAAA,CAAQ,IAAA;AAAA,QACN,CAAA,4DAAA,EAA+D,OAAA,CAAQ,IAAA,CAAK,IAAI,CAAC,CAAA,uCAAA;AAAA,OAEnF;AAAA,IACF;AAEA,IAAA,IAAI,KAAA,CAAM,SAAS,CAAA,EAAG;AACpB,MAAA,OAAA,CAAQ,IAAA;AAAA,QACN,CAAA,uDAAA,EAA0D,KAAA,CAAM,IAAA,CAAK,IAAI,CAAC,CAAA;AAAA,OAC5E;AAAA,IACF;AAGA,IAAA,MAAM,MAAA,GAA0B;AAAA,MAC9B,SAAA,EAAW,MAAM,MAAA,CAAO,aAAA;AAAA,MACxB,KAAA,EAAO,MAAM,MAAA,CAAO,KAAA;AAAA,MACpB,KAAA,EAAO,OAAA,CAAQ,KAAA,IAAS,EAAC;AAAA,MACzB,WAAA,EAAa,MAAM,MAAA,CAAO,WAAA;AAAA,MAC1B,aAAA,EAAe,MAAM,MAAA,CAAO,aAAA;AAAA,MAC5B,SAAS,OAAA,CAAQ,OAAA;AAAA,MACjB,OAAO,OAAA,CAAQ,KAAA;AAAA,MACf,SAAS,OAAA,CAAQ,OAAA;AAAA;AAAA,MAEjB,OAAA,EAAS;AAAA,QACP,MAAA,EAAQ;AAAA,UACN,OAAA,EAAS,QAAQ,OAAA,CAAQ,MAAA;AAAA,UACzB,GAAG;AAAA;AACL;AACF,KACF;AAEA,IAAA,MAAM,SAAA,GAAY,IAAI,UAAA,CAAU,OAAA,EAAS,OAAO,OAAA,CAAQ,OAAA,EAAS,MAAA,EAAQ,OAAA,CAAQ,KAAK,CAAA;AAGtF,IAAA,SAAA,CAAU,qBAAqB,MAAM,CAAA;AAErC,IAAA,OAAO,SAAA;AAAA,EACT;AAAA;AAAA,EAIU,WAAA,CACR,EAAA,EACA,KAAA,EACA,YAAA,EACA,QACA,KAAA,EACA;AAGA,IAAA,KAAA,CAAM,QAAQ,WAAW,CAAA;AAEzB,IAAA,IAAA,CAAK,EAAA,GAAK,EAAA;AACV,IAAA,IAAA,CAAK,KAAA,GAAQ,KAAA;AACb,IAAA,IAAA,CAAK,YAAA,GAAe,YAAA;AACpB,IAAA,IAAA,CAAK,KAAA,GAAQ,KAAA;AAKb,IAAA,MAAM,MAAA,GAAS,KAAK,aAAA,CAAc,MAAA;AAClC,IAAA,IAAI,MAAA,EAAQ;AACV,MAAA,MAAM,gBAAgB,CAAC,IAAA,KACrB,IAAA,CAAK,IAAA,CAAK,iBAAiB,IAAI,CAAA;AACjC,MAAA,MAAM,mBAAA,GAAsB,CAAC,IAAA,KAC3B,IAAA,CAAK,IAAA,CAAK,wBAAwB,EAAE,WAAA,EAAa,IAAA,CAAK,kBAAA,EAAoB,CAAA;AAE5E,MAAA,MAAA,CAAO,EAAA,CAAG,UAAU,aAAa,CAAA;AACjC,MAAA,MAAA,CAAO,EAAA,CAAG,iBAAiB,mBAAmB,CAAA;AAG9C,MAAA,IAAA,CAAK,sBAAsB,IAAA,CAAK,MAAM,OAAO,GAAA,CAAI,QAAA,EAAU,aAAa,CAAC,CAAA;AACzE,MAAA,IAAA,CAAK,sBAAsB,IAAA,CAAK,MAAM,OAAO,GAAA,CAAI,eAAA,EAAiB,mBAAmB,CAAC,CAAA;AAAA,IACxF;AAGA,IAAA,IAAA,CAAK,iBAAA,CAAkB,OAAO,OAAO,CAAA;AAAA,EACvC;AAAA;AAAA,EAIU,YAAA,GAA2D;AACnE,IAAA,OAAO,YAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQQ,kBAAkB,IAAA,EAAkC;AAC1D,IAAA,OAAO;AAAA,MACL,GAAG,IAAA;AAAA,MACH,OAAA,EAAS,OAAO,IAAA,EAAW,OAAA,KAAkB;AAI3C,QAAA,MAAM,eAAA,GAAkB;AAAA,UACtB,GAAG,OAAA;AAAA,UACH,MAAA,EAAQ,IAAA,CAAK,aAAA,CAAc,MAAA,EAAQ,SAAA,EAAU;AAAA;AAAA,UAC7C,cAAc,IAAA,CAAK,aAAA;AAAA;AAAA,UACnB,gBAAA,EAAkB,IAAA,CAAK,aAAA,CAAc,KAAA,IAAS,MAAA;AAAA;AAAA,UAC9C,SAAS,IAAA,CAAK;AAAA,SAChB;AAEA,QAAA,IAAI,CAAC,IAAA,CAAK,aAAA,CAAc,KAAA,EAAO;AAC7B,UAAA,OAAO,IAAA,CAAK,OAAA,CAAQ,IAAA,EAAM,eAAe,CAAA;AAAA,QAC3C;AAGA,QAAA,MAAM,SAAS,MAAM,IAAA,CAAK,cAAc,KAAA,CAAM,GAAA,CAAI,MAAM,IAAI,CAAA;AAC5D,QAAA,IAAI,WAAW,MAAA,EAAW;AACxB,UAAA,OAAO,MAAA;AAAA,QACT;AAGA,QAAA,MAAM,MAAA,GAAS,MAAM,IAAA,CAAK,OAAA,CAAQ,MAAM,eAAe,CAAA;AAGvD,QAAA,MAAM,KAAK,aAAA,CAAc,KAAA,CAAM,GAAA,CAAI,IAAA,EAAM,MAAM,MAAM,CAAA;AAErD,QAAA,OAAO,MAAA;AAAA,MACT;AAAA,KACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,qBAAqB,MAAA,EAA+B;AAI1D,IAAA,IAAA,CAAK,YAAY,CAAC,GAAI,MAAA,CAAO,KAAA,IAAS,EAAG,CAAA;AAMzC,IAAA,MAAM,YAAA,GAAe,IAAA,CAAK,aAAA,CAAc,KAAA,CAAM,UAAA,EAAW;AACzD,IAAA,MAAM,WAAA,GAAc,aAAa,GAAA,CAAI,CAAC,SAAS,IAAA,CAAK,iBAAA,CAAkB,IAAI,CAAC,CAAA;AAG3E,IAAA,IAAA,CAAK,KAAA,GAAQ,MAAM,MAAA,CAAO;AAAA,MACxB,WAAW,MAAA,CAAO,SAAA;AAAA,MAClB,OAAO,MAAA,CAAO,KAAA;AAAA,MACd,KAAA,EAAO,WAAA;AAAA,MACP,cAAc,MAAA,CAAO,YAAA;AAAA,MACrB,aAAa,MAAA,CAAO,WAAA;AAAA,MACpB,aAAA,EAAe,OAAO,aAAA,IAAiB,EAAA;AAAA,MACvC,aAAa,MAAA,CAAO,WAAA;AAAA,MACpB,SAAS,IAAA,CAAK;AAAA;AAAA,KACf,CAAA;AAGD,IAAA,MAAM,SAAA,GAAY,YAAA,CAAa,MAAA,CAAO,KAAK,CAAA;AAC3C,IAAA,MAAM,aAAA,GAAgB,SAAA,EAAW,QAAA,CAAS,KAAA,CAAM,UAAU,gBAAA,CAAiB,UAAA;AAC3E,IAAA,IAAA,CAAK,aAAA,CAAc,oBAAoB,aAAa,CAAA;AAGpD,IAAA,IAAI,OAAO,YAAA,EAAc;AACvB,MAAA,IAAA,CAAK,aAAA,CAAc,eAAe,MAAA,CAAO,YAAA;AAAA,IAC3C;AAIA,IAAA,IAAA,CAAK,WAAA,GAAc,IAAI,UAAA,EAAW;AAClC,IAAA,IAAA,CAAK,aAAA,CAAc,cAAA,CAAe,IAAA,CAAK,WAAW,CAAA;AAGlD,IAAA,IAAI,IAAA,CAAK,cAAc,MAAA,EAAQ;AAC7B,MAAA,IAAA,CAAK,aAAA,GAAgB,IAAI,YAAA,CAAa,IAAA,CAAK,cAAc,MAAM,CAAA;AAC/D,MAAA,IAAA,CAAK,aAAA,CAAc,cAAA,CAAe,IAAA,CAAK,aAAa,CAAA;AAAA,IACtD;AAGA,IAAA,IAAA,CAAK,WAAA,CAAY,OAAA,CAAQ,IAAA,CAAK,KAAA,CAAM,IAAI,CAAA;AAGxC,IAAA,IAAA,CAAK,eAAA,GAAkB,IAAI,yBAAA,CAA0B,IAAA,CAAK,SAAS,CAAA;AAGnE,IAAA,IAAA,CAAK,iBAAA,GAAoB,IAAI,iBAAA,CAAkB,IAAA,CAAK,cAAc,2BAA2B,CAAA;AAI7F,IAAA,IAAA,CAAK,eAAe,IAAI,YAAA;AAAA,MACtB,IAAA,CAAK,KAAA;AAAA,MACL,IAAA,CAAK,aAAA;AAAA,MACL,IAAA,CAAK,WAAA;AAAA,MACL,IAAA,CAAK,eAAA;AAAA,MACL,IAAA,CAAK,iBAAA;AAAA,MACL,IAAA,CAAK,KAAA;AAAA,MACL;AAAA,QACE,aAAA,EAAe,OAAO,aAAA,IAAiB;AAAA;AACzC,KACF;AAGA,IAAA,IAAA,CAAK,uBAAA,EAAwB;AAAA,EAC/B;AAAA;AAAA;AAAA;AAAA,EAKQ,uBAAA,GAAgC;AACtC,IAAA,IAAI,CAAC,KAAK,YAAA,EAAc;AAExB,IAAA,MAAM,mBAAmB,CAAC,IAAA,KAAyB,IAAA,CAAK,IAAA,CAAK,cAAc,IAAI,CAAA;AAC/E,IAAA,MAAM,mBAAA,GAAsB,CAAC,IAAA,KAA0C;AACrE,MAAA,IAAA,CAAK,IAAA,CAAK,eAAA,EAAiB,EAAE,IAAA,EAAM,KAAK,IAAA,EAAM,MAAA,EAAQ,EAAE,OAAA,EAAS,IAAA,EAAM,MAAA,EAAQ,IAAA,CAAK,MAAA,IAAU,CAAA;AAE9F,MAAA,IAAI,IAAA,CAAK,OAAO,SAAA,EAAW;AACzB,QAAA,IAAA,CAAK,KAAA,CAAM,SAAA,CAAU,IAAA,CAAK,IAAA,EAAM,EAAE,SAAS,IAAA,EAAM,MAAA,EAAQ,IAAA,CAAK,MAAA,EAAQ,CAAA;AAAA,MACxE;AAAA,IACF,CAAA;AACA,IAAA,MAAM,oBAAoB,CAAC,IAAA,KAAuC,IAAA,CAAK,IAAA,CAAK,eAAe,IAAI,CAAA;AAC/F,IAAA,MAAM,qBAAqB,CAAC,IAAA,KAC1B,IAAA,CAAK,IAAA,CAAK,eAAe,EAAE,IAAA,EAAM,IAAA,CAAK,IAAA,EAAM,OAAO,IAAI,KAAA,CAAM,IAAA,CAAK,MAAM,GAAG,CAAA;AAC7E,IAAA,MAAM,0BAAA,GAA6B,CAAC,IAAA,KAClC,IAAA,CAAK,KAAK,cAAA,EAAgB,EAAE,IAAA,EAAM,IAAA,CAAK,IAAA,EAAM,UAAA,EAAY,IAAA,CAAK,IAAA,CAAK,oBAAoB,CAAA;AACzF,IAAA,MAAM,8BAA8B,CAAC,IAAA,KACnC,IAAA,CAAK,IAAA,CAAK,0BAA0B,IAAI,CAAA;AAE1C,IAAA,IAAA,CAAK,YAAA,CAAa,EAAA,CAAG,YAAA,EAAc,gBAAgB,CAAA;AACnD,IAAA,IAAA,CAAK,YAAA,CAAa,EAAA,CAAG,eAAA,EAAiB,mBAAmB,CAAA;AACzD,IAAA,IAAA,CAAK,YAAA,CAAa,EAAA,CAAG,aAAA,EAAe,iBAAiB,CAAA;AACrD,IAAA,IAAA,CAAK,YAAA,CAAa,EAAA,CAAG,cAAA,EAAgB,kBAAkB,CAAA;AACvD,IAAA,IAAA,CAAK,YAAA,CAAa,EAAA,CAAG,uBAAA,EAAyB,0BAA0B,CAAA;AACxE,IAAA,IAAA,CAAK,YAAA,CAAa,EAAA,CAAG,wBAAA,EAA0B,2BAA2B,CAAA;AAC1E,IAAA,IAAA,CAAK,YAAA,CAAa,EAAA,CAAG,2BAAA,EAA6B,2BAA2B,CAAA;AAG7E,IAAA,IAAA,CAAK,qBAAA,CAAsB,KAAK,MAAM,IAAA,CAAK,cAAc,GAAA,CAAI,YAAA,EAAc,gBAAgB,CAAC,CAAA;AAC5F,IAAA,IAAA,CAAK,qBAAA,CAAsB,KAAK,MAAM,IAAA,CAAK,cAAc,GAAA,CAAI,eAAA,EAAiB,mBAAmB,CAAC,CAAA;AAClG,IAAA,IAAA,CAAK,qBAAA,CAAsB,KAAK,MAAM,IAAA,CAAK,cAAc,GAAA,CAAI,aAAA,EAAe,iBAAiB,CAAC,CAAA;AAC9F,IAAA,IAAA,CAAK,qBAAA,CAAsB,KAAK,MAAM,IAAA,CAAK,cAAc,GAAA,CAAI,cAAA,EAAgB,kBAAkB,CAAC,CAAA;AAChG,IAAA,IAAA,CAAK,qBAAA,CAAsB,KAAK,MAAM,IAAA,CAAK,cAAc,GAAA,CAAI,uBAAA,EAAyB,0BAA0B,CAAC,CAAA;AACjH,IAAA,IAAA,CAAK,qBAAA,CAAsB,KAAK,MAAM,IAAA,CAAK,cAAc,GAAA,CAAI,wBAAA,EAA0B,2BAA2B,CAAC,CAAA;AACnH,IAAA,IAAA,CAAK,qBAAA,CAAsB,KAAK,MAAM,IAAA,CAAK,cAAc,GAAA,CAAI,2BAAA,EAA6B,2BAA2B,CAAC,CAAA;AAAA,EACxH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAaA,UAAA,GAAsB;AACpB,IAAA,OAAO,IAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,MAAM,SAAA,EAA4C;AAEtD,IAAA,MAAM,IAAA,GAAO,WAAW,SAAS,CAAA;AACjC,IAAA,IAAA,CAAK,MAAM,IAAA,GAAO,IAAA;AAClB,IAAA,IAAA,CAAK,KAAA,GAAQ,iBAAA,CAAkB,IAAA,CAAK,KAAA,EAAO,SAAS,CAAA;AAGpD,IAAA,IAAI,IAAA,CAAK,OAAO,OAAA,EAAS;AACvB,MAAA,MAAM,IAAA,CAAK,KAAA,CAAM,OAAA,CAAQ,IAAA,EAAM,IAAI,CAAA;AAAA,IACrC;AAGA,IAAA,IAAA,CAAK,mBAAmB,IAAA,CAAK,WAAA,EAAY,CACtC,IAAA,CAAK,OAAO,MAAA,KAAW;AAEtB,MAAA,IAAI,IAAA,CAAK,OAAO,UAAA,EAAY;AAC1B,QAAA,MAAM,IAAA,CAAK,KAAA,CAAM,UAAA,CAAW,MAAM,CAAA;AAAA,MACpC;AACA,MAAA,OAAO,MAAA;AAAA,IACT,CAAC,CAAA,CACA,KAAA,CAAM,OAAO,KAAA,KAAU;AAEtB,MAAA,IAAI,IAAA,CAAK,OAAO,OAAA,EAAS;AACvB,QAAA,MAAM,IAAA,CAAK,MAAM,OAAA,CAAQ,KAAA,EAAO,EAAE,KAAA,EAAO,KAAA,EAAO,aAAa,CAAA;AAAA,MAC/D;AACA,MAAA,MAAM,KAAA;AAAA,IACR,CAAC,CAAA;AAGH,IAAA,MAAM,IAAA,CAAK,gBAAA,CAAiB,KAAA,CAAM,MAAM;AAAA,IAExC,CAAC,CAAA;AAGD,IAAA,OAAO;AAAA,MACL,SAAS,IAAA,CAAK,EAAA;AAAA,MACd,QAAQ,IAAA,CAAK,EAAA;AAAA,MACb,MAAM,YAAY;AAChB,QAAA,IAAI,CAAC,KAAK,gBAAA,EAAkB;AAC1B,UAAA,MAAM,IAAI,MAAM,0BAA0B,CAAA;AAAA,QAC5C;AACA,QAAA,OAAO,IAAA,CAAK,gBAAA;AAAA,MACd,CAAA;AAAA,MACA,MAAA,EAAQ,MAAM,IAAA,CAAK,KAAA,CAAM;AAAA,KAC3B;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,KAAA,GAAuB;AAC3B,IAAA,IAAA,CAAK,KAAA,GAAQ,iBAAA,CAAkB,IAAA,CAAK,KAAA,EAAO,WAAW,CAAA;AACtD,IAAA,IAAA,CAAK,KAAA,CAAM,KAAK,MAAA,GAAS,WAAA;AAEzB,IAAA,IAAA,CAAK,IAAA,CAAK,iBAAA,EAAmB,EAAE,MAAA,EAAQ,gBAAgB,CAAA;AAAA,EACzD;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,MAAM,MAAA,GAAwB;AAC5B,IAAA,IAAA,CAAK,KAAA,GAAQ,iBAAA,CAAkB,IAAA,CAAK,KAAA,EAAO,SAAS,CAAA;AACpD,IAAA,IAAA,CAAK,KAAA,CAAM,KAAK,MAAA,GAAS,SAAA;AAEzB,IAAA,IAAA,CAAK,IAAA,CAAK,eAAA,EAAiB,EAAE,CAAA;AAG7B,IAAA,MAAM,KAAK,WAAA,EAAY;AAAA,EACzB;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,MAAA,GAAwB;AAC5B,IAAA,IAAA,CAAK,KAAA,GAAQ,iBAAA,CAAkB,IAAA,CAAK,KAAA,EAAO,WAAW,CAAA;AACtD,IAAA,IAAA,CAAK,KAAA,CAAM,KAAK,MAAA,GAAS,WAAA;AAAA,EAC3B;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,eAAA,CAAgB,SAAA,EAAmB,IAAA,EAA8B;AACrE,IAAA,MAAM,IAAA,GAAO,KAAK,KAAA,CAAM,IAAA;AACxB,IAAA,IAAI,CAAC,IAAA,EAAM;AACT,MAAA,MAAM,IAAI,MAAM,iBAAiB,CAAA;AAAA,IACnC;AAGA,IAAA,MAAM,IAAA,GAAO,KAAK,KAAA,CAAM,IAAA,CAAK,CAAC,CAAA,KAAM,CAAA,CAAE,kBAAA,EAAoB,SAAA,KAAc,SAAS,CAAA;AAEjF,IAAA,IAAI,CAAC,IAAA,IAAQ,CAAC,IAAA,CAAK,kBAAA,EAAoB;AACrC,MAAA,MAAM,IAAI,KAAA,CAAM,CAAA,wBAAA,EAA2B,SAAS,CAAA,UAAA,CAAY,CAAA;AAAA,IAClE;AAGA,IAAA,IAAA,CAAK,mBAAmB,KAAA,GAAQ,UAAA;AAChC,IAAA,IAAA,CAAK,mBAAmB,YAAA,GAAe,IAAA;AACvC,IAAA,IAAA,CAAK,kBAAA,CAAmB,UAAA,GAAa,IAAA,CAAK,GAAA,EAAI;AAG9C,IAAA,MAAM,KAAK,MAAA,EAAO;AAAA,EACpB;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,oBAAA,CAAqB,MAAA,EAAgB,MAAA,EAAgC;AACzE,IAAA,MAAM,IAAA,GAAO,KAAK,KAAA,CAAM,IAAA;AACxB,IAAA,IAAI,CAAC,IAAA,EAAM;AACT,MAAA,MAAM,IAAI,MAAM,iBAAiB,CAAA;AAAA,IACnC;AAEA,IAAA,MAAM,IAAA,GAAO,KAAK,KAAA,CAAM,IAAA,CAAK,CAAC,CAAA,KAAM,CAAA,CAAE,OAAO,MAAM,CAAA;AACnD,IAAA,IAAI,CAAC,IAAA,IAAQ,CAAC,IAAA,CAAK,kBAAA,EAAoB;AACrC,MAAA,MAAM,IAAI,KAAA,CAAM,CAAA,KAAA,EAAQ,MAAM,CAAA,yCAAA,CAA2C,CAAA;AAAA,IAC3E;AAGA,IAAA,IAAA,CAAK,mBAAmB,KAAA,GAAQ,UAAA;AAChC,IAAA,IAAA,CAAK,mBAAmB,YAAA,GAAe,MAAA;AACvC,IAAA,IAAA,CAAK,kBAAA,CAAmB,UAAA,GAAa,IAAA,CAAK,GAAA,EAAI;AAAA,EAChD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,MAAM,UAAA,CAAW,OAAA,EAAsB,OAAA,EAA4C;AACjF,IAAA,MAAM,IAAA,GAAO,KAAK,KAAA,CAAM,IAAA;AACxB,IAAA,IAAI,CAAC,IAAA,EAAM;AACT,MAAA,MAAM,IAAI,MAAM,iBAAiB,CAAA;AAAA,IACnC;AAEA,IAAA,IAAI,CAAC,IAAA,CAAK,iBAAA,KAAsB,OAAA,CAAQ,QAAA,IAAY,QAAQ,WAAA,CAAA,EAAc;AACxE,MAAA,MAAM,IAAI,MAAM,0CAA0C,CAAA;AAAA,IAC5D;AAEA,IAAA,MAAM,IAAA,GAAO;AAAA,MACX,sBAAA,EAAwB,SAAS,sBAAA,IAA0B,KAAA;AAAA,MAC3D,cAAA,EAAgB,SAAS,cAAA,IAAkB;AAAA,KAC7C;AAGA,IAAA,IAAI,CAAC,KAAK,sBAAA,IAA0B,OAAA,CAAQ,eAAe,OAAA,CAAQ,WAAA,CAAY,SAAS,CAAA,EAAG;AACzF,MAAA,MAAM,WAAA,GAAc,KAAK,KAAA,CAAM,MAAA;AAAA,QAC7B,CAAC,MAAM,CAAA,CAAE,MAAA,KAAW,iBAAiB,OAAA,CAAQ,WAAA,CAAa,QAAA,CAAS,CAAA,CAAE,EAAE;AAAA,OACzE;AACA,MAAA,IAAI,WAAA,CAAY,SAAS,CAAA,EAAG;AAC1B,QAAA,MAAM,KAAA,GAAQ,YAAY,GAAA,CAAI,CAAC,MAAM,CAAA,CAAE,IAAI,CAAA,CAAE,IAAA,CAAK,IAAI,CAAA;AACtD,QAAA,MAAM,IAAI,KAAA,CAAM,CAAA,4BAAA,EAA+B,KAAK,CAAA,+CAAA,CAAiD,CAAA;AAAA,MACvG;AAAA,IACF;AAGA,IAAA,IAAI,QAAQ,QAAA,EAAU;AACpB,MAAA,KAAA,MAAW,SAAA,IAAa,QAAQ,QAAA,EAAU;AACxC,QAAA,MAAM,IAAA,GAAO,WAAW,SAAS,CAAA;AACjC,QAAA,IAAA,CAAK,KAAA,CAAM,KAAK,IAAI,CAAA;AAAA,MACtB;AAAA,IACF;AAGA,IAAA,IAAI,QAAQ,WAAA,EAAa;AACvB,MAAA,KAAA,MAAW,MAAA,IAAU,QAAQ,WAAA,EAAa;AACxC,QAAA,MAAM,IAAA,GAAO,KAAK,KAAA,CAAM,IAAA,CAAK,CAAC,CAAA,KAAM,CAAA,CAAE,EAAA,KAAO,MAAA,CAAO,EAAE,CAAA;AACtD,QAAA,IAAI,IAAA,EAAM;AACR,UAAA,MAAA,CAAO,MAAA,CAAO,MAAM,MAAM,CAAA;AAAA,QAC5B;AAAA,MACF;AAAA,IACF;AAGA,IAAA,IAAI,QAAQ,WAAA,EAAa;AACvB,MAAA,IAAA,CAAK,KAAA,GAAQ,IAAA,CAAK,KAAA,CAAM,MAAA,CAAO,CAAC,CAAA,KAAM,CAAC,OAAA,CAAQ,WAAA,CAAa,QAAA,CAAS,CAAA,CAAE,EAAE,CAAC,CAAA;AAAA,IAC5E;AAGA,IAAA,IAAI,KAAK,cAAA,EAAgB;AACvB,MAAA,MAAM,KAAA,GAAQ,qBAAA,CAAsB,IAAA,CAAK,KAAK,CAAA;AAC9C,MAAA,IAAI,KAAA,EAAO;AAET,QAAA,MAAM,UAAA,GAAa,KAAA,CAAM,GAAA,CAAI,CAAC,MAAA,KAAW;AACvC,UAAA,MAAM,IAAA,GAAO,KAAK,KAAA,CAAM,IAAA,CAAK,CAAC,CAAA,KAAM,CAAA,CAAE,OAAO,MAAM,CAAA;AACnD,UAAA,OAAO,IAAA,GAAO,KAAK,IAAA,GAAO,MAAA;AAAA,QAC5B,CAAC,CAAA;AACD,QAAA,MAAM,IAAI,oBAAA,CAAqB,UAAA,EAAY,IAAA,CAAK,EAAE,CAAA;AAAA,MACpD;AAAA,IACF;AAEA,IAAA,IAAA,CAAK,aAAA,GAAgB,KAAK,GAAA,EAAI;AAE9B,IAAA,IAAA,CAAK,IAAA,CAAK,cAAA,EAAgB,EAAE,IAAA,EAAM,CAAA;AAAA,EACpC;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,QAAA,GAAuB;AACrB,IAAA,OAAO,IAAA,CAAK,KAAA;AAAA,EACd;AAAA;AAAA;AAAA;AAAA,EAKA,OAAA,GAAgB;AACd,IAAA,IAAI,CAAC,KAAK,KAAA,CAAM,IAAA,IAAQ,CAAC,IAAA,CAAK,KAAA,CAAM,KAAK,IAAA,EAAM;AAC7C,MAAA,MAAM,IAAI,MAAM,iBAAiB,CAAA;AAAA,IACnC;AACA,IAAA,OAAO,KAAK,KAAA,CAAM,IAAA;AAAA,EACpB;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,SAAA,GAAkC;AAChC,IAAA,OAAO,KAAK,aAAA,CAAc,MAAA;AAAA,EAC5B;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,IAAI,MAAA,GAA+B;AACjC,IAAA,OAAO,KAAK,aAAA,CAAc,MAAA;AAAA,EAC5B;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,MAAgB,WAAA,GAAmC;AACjD,IAAA,MAAM,IAAA,GAAO,KAAK,KAAA,CAAM,IAAA;AAExB,IAAA,IAAI,CAAC,KAAK,YAAA,EAAc;AACtB,MAAA,MAAM,IAAI,MAAM,+BAA+B,CAAA;AAAA,IACjD;AAEA,IAAA,IAAI;AAEF,MAAA,MAAM,aAAa,MAAM,IAAA,CAAK,aAAa,OAAA,CAAQ,IAAA,EAAM,KAAK,KAAK,CAAA;AAGnE,MAAA,IAAI,WAAW,OAAA,EAAS;AACtB,QAAA,IAAA,CAAK,KAAA,CAAM,OAAA,CAAQ,aAAA,IAAiB,UAAA,CAAW,OAAA,CAAQ,aAAA;AACvD,QAAA,IAAA,CAAK,KAAA,CAAM,OAAA,CAAQ,cAAA,IAAkB,UAAA,CAAW,OAAA,CAAQ,cAAA;AACxD,QAAA,IAAA,CAAK,KAAA,CAAM,OAAA,CAAQ,eAAA,IAAmB,UAAA,CAAW,OAAA,CAAQ,eAAA;AACzD,QAAA,IAAA,CAAK,KAAA,CAAM,OAAA,CAAQ,SAAA,IAAa,UAAA,CAAW,OAAA,CAAQ,SAAA;AAAA,MACrD;AAGA,MAAA,IAAI,UAAA,CAAW,WAAW,WAAA,EAAa;AACrC,QAAA,IAAA,CAAK,KAAA,GAAQ,iBAAA,CAAkB,IAAA,CAAK,KAAA,EAAO,WAAW,CAAA;AACtD,QAAA,IAAA,CAAK,MAAA,GAAS,WAAA;AAAA,MAChB,CAAA,MAAA,IAAW,UAAA,CAAW,MAAA,KAAW,QAAA,EAAU;AACzC,QAAA,IAAA,CAAK,KAAA,GAAQ,iBAAA,CAAkB,IAAA,CAAK,KAAA,EAAO,QAAQ,CAAA;AACnD,QAAA,IAAA,CAAK,MAAA,GAAS,QAAA;AAAA,MAChB,CAAA,MAAA,IAAW,UAAA,CAAW,MAAA,KAAW,WAAA,EAAa;AAC5C,QAAA,IAAA,CAAK,KAAA,GAAQ,iBAAA,CAAkB,IAAA,CAAK,KAAA,EAAO,WAAW,CAAA;AACtD,QAAA,IAAA,CAAK,MAAA,GAAS,WAAA;AAAA,MAChB;AAGA,MAAA,MAAM,IAAA,CAAK,iBAAA,EAAmB,UAAA,CAAW,IAAA,CAAK,OAAO,oBAAoB,CAAA;AAEzE,MAAA,MAAM,MAAA,GAAqB;AAAA,QACzB,MAAA,EAAQ,UAAA,CAAW,MAAA,KAAW,WAAA,GAAc,cAAc,UAAA,CAAW,MAAA;AAAA,QACrE,OAAA,EAAS;AAAA,UACP,UAAA,EAAY,KAAK,KAAA,CAAM,MAAA;AAAA,UACvB,gBAAgB,UAAA,CAAW,cAAA;AAAA,UAC3B,aAAa,UAAA,CAAW,WAAA;AAAA,UACxB,cAAc,UAAA,CAAW;AAAA;AAC3B,OACF;AAEA,MAAA,IAAA,CAAK,IAAA,CAAK,iBAAA,EAAmB,EAAE,MAAA,EAAQ,CAAA;AAEvC,MAAA,OAAO,MAAA;AAAA,IACT,SAAS,KAAA,EAAO;AAEd,MAAA,MAAM,GAAA,GAAM,iBAAiB,KAAA,GAAQ,KAAA,GAAQ,IAAI,KAAA,CAAM,MAAA,CAAO,KAAK,CAAC,CAAA;AAEpE,MAAA,IAAA,CAAK,KAAA,GAAQ,iBAAA,CAAkB,IAAA,CAAK,KAAA,EAAO,QAAQ,CAAA;AACnD,MAAA,IAAA,CAAK,MAAA,GAAS,QAAA;AAGd,MAAA,IAAI;AACF,QAAA,MAAM,IAAA,CAAK,iBAAA,EAAmB,UAAA,CAAW,IAAA,CAAK,OAAO,kBAAkB,CAAA;AAAA,MACzE,CAAA,CAAA,MAAQ;AAAA,MAER;AAEA,MAAA,MAAM,MAAA,GAAqB;AAAA,QACzB,MAAA,EAAQ,QAAA;AAAA,QACR,OAAO,GAAA,CAAI,OAAA;AAAA,QACX,OAAA,EAAS;AAAA,UACP,UAAA,EAAY,KAAK,KAAA,CAAM,MAAA;AAAA,UACvB,cAAA,EAAgB,KAAK,KAAA,CAAM,MAAA,CAAO,CAAC,CAAA,KAAM,CAAA,CAAE,MAAA,KAAW,WAAW,CAAA,CAAE,MAAA;AAAA,UACnE,WAAA,EAAa,KAAK,KAAA,CAAM,MAAA,CAAO,CAAC,CAAA,KAAM,CAAA,CAAE,MAAA,KAAW,QAAQ,CAAA,CAAE,MAAA;AAAA,UAC7D,YAAA,EAAc,KAAK,KAAA,CAAM,MAAA,CAAO,CAAC,CAAA,KAAM,CAAA,CAAE,MAAA,KAAW,SAAS,CAAA,CAAE;AAAA;AACjE,OACF;AAEA,MAAA,IAAA,CAAK,IAAA,CAAK,iBAAA,EAAmB,EAAE,MAAA,EAAQ,CAAA;AAEvC,MAAA,MAAM,GAAA;AAAA,IACR;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,MAAM,OAAA,GAAyB;AAC7B,IAAA,IAAI,KAAK,YAAA,EAAc;AACrB,MAAA;AAAA,IACF;AAEA,IAAA,IAAA,CAAK,OAAA,CAAQ,MAAM,2BAA2B,CAAA;AAG9C,IAAA,IAAA,CAAK,qBAAA,CAAsB,OAAA,CAAQ,CAAC,OAAA,KAAY,SAAS,CAAA;AACzD,IAAA,IAAA,CAAK,wBAAwB,EAAC;AAG9B,IAAA,IAAA,CAAK,iBAAiB,OAAA,EAAQ;AAC9B,IAAA,MAAM,IAAA,CAAK,mBAAmB,OAAA,EAAQ;AACtC,IAAA,IAAA,CAAK,cAAc,OAAA,EAAQ;AAC3B,IAAA,IAAA,CAAK,OAAO,OAAA,EAAQ;AAGpB,IAAA,MAAM,KAAK,mBAAA,EAAoB;AAG/B,IAAA,IAAA,CAAK,WAAA,EAAY;AAEjB,IAAA,IAAA,CAAK,OAAA,CAAQ,MAAM,qBAAqB,CAAA;AAAA,EAC1C;AACF;;;AW54BA,IAAM,sBAAA,GAAyB,CAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA,kGAAA,CAAA;AA4CxB,IAAM,aAAA,GAAN,MAAM,cAAA,CAAc;AAAA,EACjB,KAAA;AAAA,EACA,MAAA;AAAA,EACA,eAA4B,EAAC;AAAA,EAC7B,gBAAA,GAAmB,KAAA;AAAA,EAEnB,YAAY,MAAA,EAA6B;AAC/C,IAAA,IAAA,CAAK,MAAA,GAAS,MAAA;AAGd,IAAA,MAAM,aAAA,GAAgB,KAAK,wBAAA,EAAyB;AAGpD,IAAA,IAAA,CAAK,KAAA,GAAQ,MAAM,MAAA,CAAO;AAAA,MACxB,WAAW,MAAA,CAAO,SAAA;AAAA,MAClB,OAAO,MAAA,CAAO,KAAA;AAAA,MACd,KAAA,EAAO,aAAA;AAAA,MACP,YAAA,EAAc,sBAAA;AAAA,MACd,WAAA,EAAa,OAAO,mBAAA,IAAuB,GAAA;AAAA;AAAA,MAC3C,aAAA,EAAe,OAAO,qBAAA,IAAyB;AAAA,KAChD,CAAA;AAAA,EACH;AAAA;AAAA;AAAA;AAAA,EAKA,OAAO,OAAO,MAAA,EAA4C;AACxD,IAAA,OAAO,IAAI,eAAc,MAAM,CAAA;AAAA,EACjC;AAAA;AAAA;AAAA;AAAA,EAKQ,wBAAA,GAA2C;AACjD,IAAA,OAAO;AAAA,MACL;AAAA,QACE,UAAA,EAAY;AAAA,UACV,IAAA,EAAM,UAAA;AAAA,UACN,QAAA,EAAU;AAAA,YACR,IAAA,EAAM,aAAA;AAAA,YACN,WAAA,EAAa,sGAAA;AAAA,YACb,UAAA,EAAY;AAAA,cACV,IAAA,EAAM,QAAA;AAAA,cACN,UAAA,EAAY;AAAA,gBACV,IAAA,EAAM;AAAA,kBACJ,IAAA,EAAM,QAAA;AAAA,kBACN,WAAA,EAAa;AAAA,iBACf;AAAA,gBACA,WAAA,EAAa;AAAA,kBACX,IAAA,EAAM,QAAA;AAAA,kBACN,WAAA,EAAa;AAAA,iBACf;AAAA,gBACA,mBAAA,EAAqB;AAAA,kBACnB,IAAA,EAAM,OAAA;AAAA,kBACN,KAAA,EAAO,EAAE,IAAA,EAAM,QAAA,EAAS;AAAA,kBACxB,WAAA,EAAa;AAAA,iBACf;AAAA,gBACA,UAAA,EAAY;AAAA,kBACV,IAAA,EAAM,OAAA;AAAA,kBACN,KAAA,EAAO,EAAE,IAAA,EAAM,QAAA,EAAS;AAAA,kBACxB,WAAA,EAAa;AAAA,iBACf;AAAA,gBACA,QAAA,EAAU;AAAA,kBACR,IAAA,EAAM,SAAA;AAAA,kBACN,WAAA,EAAa;AAAA,iBACf;AAAA,gBACA,eAAA,EAAiB;AAAA,kBACf,IAAA,EAAM,QAAA;AAAA,kBACN,WAAA,EAAa;AAAA,iBACf;AAAA,gBACA,oBAAA,EAAsB;AAAA,kBACpB,IAAA,EAAM,OAAA;AAAA,kBACN,KAAA,EAAO,EAAE,IAAA,EAAM,QAAA,EAAS;AAAA,kBACxB,WAAA,EAAa;AAAA,iBACf;AAAA,gBACA,oBAAA,EAAsB;AAAA,kBACpB,IAAA,EAAM,QAAA;AAAA,kBACN,WAAA,EAAa;AAAA;AACf,eACF;AAAA,cACA,QAAA,EAAU,CAAC,MAAA,EAAQ,aAAa;AAAA;AAClC;AACF,SACF;AAAA,QACA,OAAA,EAAS,OAAO,IAAA,KAAkC;AAChD,UAAA,MAAM,OAAO,IAAA,CAAK,IAAA;AAClB,UAAA,MAAM,cAAc,IAAA,CAAK,WAAA;AACzB,UAAA,MAAM,qBAAqB,IAAA,CAAK,mBAAA;AAChC,UAAA,MAAM,YAAY,IAAA,CAAK,UAAA;AACvB,UAAA,MAAM,WAAW,IAAA,CAAK,QAAA;AACtB,UAAA,MAAM,iBAAiB,IAAA,CAAK,eAAA;AAC5B,UAAA,MAAM,qBAAqB,IAAA,CAAK,oBAAA;AAChC,UAAA,MAAM,qBAAqB,IAAA,CAAK,oBAAA;AAGhC,UAAA,IAAI,UAAA;AACJ,UAAA,IAAI,kBAAA,IAAsB,sBAAsB,kBAAA,EAAoB;AAClE,YAAA,UAAA,GAAa;AAAA,cACX,kBAAA;AAAA,cACA,kBAAA;AAAA,cACA,oBAAoB,kBAAA,IAAsB,EAAA;AAAA,cAC1C,mBAAA,EAAqB,WAAA;AAAA;AAAA,cACrB,IAAA,EAAM;AAAA;AAAA,aACR;AAAA,UACF;AAGA,UAAA,IAAA,CAAK,OAAA,CAAQ;AAAA,YACX,IAAA;AAAA,YACA,WAAA;AAAA,YACA,SAAA;AAAA,YACA,SAAA,EAAW,QAAA,GAAW,EAAE,QAAA,EAAU,MAAK,GAAI,MAAA;AAAA,YAC3C,cAAA;AAAA,YACA;AAAA,WACD,CAAA;AAED,UAAA,OAAO;AAAA,YACL,OAAA,EAAS,IAAA;AAAA,YACT,OAAA,EAAS,SAAS,IAAI,CAAA,SAAA,EAAY,qBAAqB,CAAA,MAAA,EAAS,kBAAA,CAAmB,MAAM,CAAA,oBAAA,CAAA,GAAyB,EAAE,CAAA,CAAA;AAAA,YACpH,SAAA,EAAW,KAAK,YAAA,CAAa;AAAA,WAC/B;AAAA,QACF,CAAA;AAAA,QACA,WAAA,EAAa;AAAA,UACX,IAAA,EAAM;AAAA;AACR,OACF;AAAA,MACA;AAAA,QACE,UAAA,EAAY;AAAA,UACV,IAAA,EAAM,UAAA;AAAA,UACN,QAAA,EAAU;AAAA,YACR,IAAA,EAAM,eAAA;AAAA,YACN,WAAA,EAAa,wGAAA;AAAA,YACb,UAAA,EAAY;AAAA,cACV,IAAA,EAAM,QAAA;AAAA,cACN,YAAY;AAAC;AACf;AACF,SACF;AAAA,QACA,SAAS,YAAY;AACnB,UAAA,IAAA,CAAK,gBAAA,EAAiB;AACtB,UAAA,OAAO;AAAA,YACL,OAAA,EAAS,IAAA;AAAA,YACT,OAAA,EAAS,wCAAA;AAAA,YACT,UAAA,EAAY,KAAK,YAAA,CAAa;AAAA,WAChC;AAAA,QACF,CAAA;AAAA,QACA,WAAA,EAAa;AAAA,UACX,IAAA,EAAM;AAAA;AACR;AACF,KACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,aAAa,KAAA,EAIQ;AAEzB,IAAA,IAAA,CAAK,eAAe,EAAC;AACrB,IAAA,IAAA,CAAK,gBAAA,GAAmB,KAAA;AAGxB,IAAA,MAAM,MAAA,GAAS,IAAA,CAAK,mBAAA,CAAoB,KAAK,CAAA;AAG7C,IAAA,MAAM,QAAA,GAAW,MAAM,IAAA,CAAK,KAAA,CAAM,IAAI,MAAM,CAAA;AAG5C,IAAA,IAAI,CAAC,IAAA,CAAK,gBAAA,IAAoB,IAAA,CAAK,YAAA,CAAa,SAAS,CAAA,EAAG;AAC1D,MAAA,IAAA,CAAK,gBAAA,GAAmB,IAAA;AAAA,IAC1B;AAGA,IAAA,MAAM,OAAO,UAAA,CAAW;AAAA,MACtB,MAAM,KAAA,CAAM,IAAA;AAAA,MACZ,SAAS,KAAA,CAAM,OAAA;AAAA,MACf,OAAO,IAAA,CAAK,YAAA;AAAA,MACZ,iBAAA,EAAmB;AAAA;AAAA,KACpB,CAAA;AAED,IAAA,OAAO;AAAA,MACL,IAAA;AAAA,MACA,SAAA,EAAW,SAAS,WAAA,IAAe,gBAAA;AAAA,MACnC,UAAA,EAAY,IAAA,CAAK,kBAAA,CAAmB,IAAA,CAAK,YAAY;AAAA,KACvD;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,UAAA,CAAW,IAAA,EAAY,QAAA,EAA0C;AAErE,IAAA,IAAA,CAAK,YAAA,GAAe,IAAA,CAAK,KAAA,CAAM,GAAA,CAAI,CAAC,IAAA,MAAU;AAAA,MAC5C,MAAM,IAAA,CAAK,IAAA;AAAA,MACX,aAAa,IAAA,CAAK,WAAA;AAAA,MAClB,WAAW,IAAA,CAAK,SAAA;AAAA,MAChB,gBAAgB,IAAA,CAAK,cAAA;AAAA,MACrB,WAAW,IAAA,CAAK,SAAA;AAAA,MAChB,WAAW,IAAA,CAAK,SAAA;AAAA,MAChB,oBAAoB,IAAA,CAAK,kBAAA;AAAA,MACzB,aAAa,IAAA,CAAK;AAAA,KACpB,CAAE,CAAA;AAEF,IAAA,IAAA,CAAK,gBAAA,GAAmB,KAAA;AAGxB,IAAA,MAAM,MAAA,GAAS,CAAA;;AAAA,uBAAA,EAEM,KAAK,IAAI;AAAA,0BAAA,EACN,IAAA,CAAK,WAAW,MAAM;;AAAA;AAAA,EAGhD,IAAA,CAAK,YAAA,CAAa,GAAA,CAAI,CAAC,CAAA,EAAG,CAAA,KAAM,CAAA,EAAG,CAAA,GAAI,CAAC,CAAA,EAAA,EAAK,CAAA,CAAE,IAAI,KAAK,CAAA,CAAE,WAAW,CAAA,EAAG,CAAA,CAAE,SAAA,EAAW,MAAA,GAAS,CAAA,cAAA,EAAiB,CAAA,CAAE,UAAU,IAAA,CAAK,IAAI,CAAC,CAAA,CAAA,CAAA,GAAM,EAAE,CAAA,CAAE,CAAA,CAAE,IAAA,CAAK,IAAI,CAAC;;AAAA,cAAA,EAE7I,QAAQ;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA,oEAAA,CAAA;AAWpB,IAAA,MAAM,QAAA,GAAW,MAAM,IAAA,CAAK,KAAA,CAAM,IAAI,MAAM,CAAA;AAG5C,IAAA,MAAM,cAAc,UAAA,CAAW;AAAA,MAC7B,MAAM,IAAA,CAAK,IAAA;AAAA,MACX,SAAS,IAAA,CAAK,OAAA;AAAA,MACd,OAAO,IAAA,CAAK,YAAA;AAAA,MACZ,iBAAA,EAAmB;AAAA,KACpB,CAAA;AAED,IAAA,OAAO;AAAA,MACL,IAAA,EAAM,WAAA;AAAA,MACN,SAAA,EAAW,SAAS,WAAA,IAAe,cAAA;AAAA,MACnC,UAAA,EAAY,IAAA,CAAK,kBAAA,CAAmB,IAAA,CAAK,YAAY;AAAA,KACvD;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,oBAAoB,KAAA,EAIjB;AACT,IAAA,MAAM,QAAkB,EAAC;AAEzB,IAAA,KAAA,CAAM,KAAK,2DAA2D,CAAA;AACtE,IAAA,KAAA,CAAM,IAAA,CAAK,CAAA,UAAA,EAAa,KAAA,CAAM,IAAI;AAAA,CAAI,CAAA;AAEtC,IAAA,IAAI,MAAM,OAAA,EAAS;AACjB,MAAA,KAAA,CAAM,IAAA,CAAK,CAAA,aAAA,EAAgB,KAAA,CAAM,OAAO;AAAA,CAAI,CAAA;AAAA,IAC9C;AAEA,IAAA,IAAI,KAAA,CAAM,WAAA,IAAe,KAAA,CAAM,WAAA,CAAY,SAAS,CAAA,EAAG;AACrD,MAAA,KAAA,CAAM,KAAK,oBAAoB,CAAA;AAC/B,MAAA,KAAA,CAAM,WAAA,CAAY,QAAQ,CAAC,CAAA,KAAM,MAAM,IAAA,CAAK,CAAA,EAAA,EAAK,CAAC,CAAA,CAAE,CAAC,CAAA;AACrD,MAAA,KAAA,CAAM,KAAK,EAAE,CAAA;AAAA,IACf;AAEA,IAAA,IAAI,KAAK,MAAA,CAAO,cAAA,IAAkB,KAAK,MAAA,CAAO,cAAA,CAAe,SAAS,CAAA,EAAG;AACvE,MAAA,KAAA,CAAM,KAAK,sCAAsC,CAAA;AACjD,MAAA,IAAA,CAAK,MAAA,CAAO,cAAA,CAAe,OAAA,CAAQ,CAAC,IAAA,KAAS;AAC3C,QAAA,KAAA,CAAM,IAAA,CAAK,CAAA,EAAA,EAAK,IAAA,CAAK,UAAA,CAAW,QAAA,CAAS,IAAI,CAAA,EAAA,EAAK,IAAA,CAAK,UAAA,CAAW,QAAA,CAAS,WAAW,CAAA,CAAE,CAAA;AAAA,MAC1F,CAAC,CAAA;AACD,MAAA,KAAA,CAAM,KAAK,EAAE,CAAA;AAAA,IACf;AAEA,IAAA,KAAA,CAAM,KAAK,qFAAqF,CAAA;AAChG,IAAA,KAAA,CAAM,KAAK,wDAAwD,CAAA;AAEnE,IAAA,OAAO,KAAA,CAAM,KAAK,IAAI,CAAA;AAAA,EACxB;AAAA;AAAA;AAAA;AAAA,EAKQ,mBAAmB,KAAA,EAA+C;AACxE,IAAA,MAAM,YAAY,KAAA,CAAM,MAAA;AACxB,IAAA,MAAM,eAAA,GAAkB,KAAA,CAAM,IAAA,CAAK,CAAC,CAAA,KAAM,EAAE,SAAA,IAAa,CAAA,CAAE,SAAA,CAAU,MAAA,GAAS,CAAC,CAAA;AAC/E,IAAA,MAAM,kBAAkB,KAAA,CAAM,IAAA,CAAK,CAAC,CAAA,KAAM,EAAE,SAAS,CAAA;AACrD,IAAA,MAAM,kBAAkB,KAAA,CAAM,IAAA,CAAK,CAAC,CAAA,KAAM,EAAE,kBAAkB,CAAA;AAE9D,IAAA,IAAI,aAAa,CAAA,IAAK,CAAC,mBAAmB,CAAC,eAAA,IAAmB,CAAC,eAAA,EAAiB;AAC9E,MAAA,OAAO,KAAA;AAAA,IACT;AAEA,IAAA,IAAI,SAAA,IAAa,EAAA,IAAM,CAAC,eAAA,IAAmB,CAAC,eAAA,EAAiB;AAC3D,MAAA,OAAO,QAAA;AAAA,IACT;AAEA,IAAA,OAAO,MAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,eAAA,GAA+B;AAC7B,IAAA,OAAO,CAAC,GAAG,IAAA,CAAK,YAAY,CAAA;AAAA,EAC9B;AAAA;AAAA;AAAA;AAAA,EAKA,QAAQ,IAAA,EAAuB;AAC7B,IAAA,IAAA,CAAK,YAAA,CAAa,KAAK,IAAI,CAAA;AAAA,EAC7B;AAAA;AAAA;AAAA;AAAA,EAKA,UAAA,CAAW,MAAc,OAAA,EAAmC;AAC1D,IAAA,MAAM,IAAA,GAAO,KAAK,YAAA,CAAa,IAAA,CAAK,CAAC,CAAA,KAAM,CAAA,CAAE,SAAS,IAAI,CAAA;AAC1D,IAAA,IAAI,IAAA,EAAM;AACR,MAAA,MAAA,CAAO,MAAA,CAAO,MAAM,OAAO,CAAA;AAAA,IAC7B;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,WAAW,IAAA,EAAoB;AAC7B,IAAA,MAAM,KAAA,GAAQ,KAAK,YAAA,CAAa,SAAA,CAAU,CAAC,CAAA,KAAM,CAAA,CAAE,SAAS,IAAI,CAAA;AAChE,IAAA,IAAI,SAAS,CAAA,EAAG;AACd,MAAA,IAAA,CAAK,YAAA,CAAa,MAAA,CAAO,KAAA,EAAO,CAAC,CAAA;AAAA,IACnC;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,gBAAA,GAAyB;AACvB,IAAA,IAAA,CAAK,gBAAA,GAAmB,IAAA;AAAA,EAC1B;AACF;AAKA,eAAsB,kBAAA,CACpB,MACA,OAAA,EACe;AAEf,EAAA,OAAO,UAAA,CAAW;AAAA,IAChB,IAAA;AAAA,IACA,OAAA;AAAA,IACA,KAAA,EAAO;AAAA,MACL;AAAA,QACE,IAAA,EAAM,cAAA;AAAA,QACN,WAAA,EAAa,qBAAqB,IAAI,CAAA;AAAA;AACxC,KACF;AAAA,IACA,iBAAA,EAAmB;AAAA;AAAA,GACpB,CAAA;AACH;AC7YA,IAAMuB,eAAAA,GAA4C;AAAA,EAChD,eAAe,EAAA,GAAK,IAAA;AAAA;AAAA,EACpB,OAAO,EAAC;AAAA,EACR,cAAc,EAAC;AAAA,EACf,iBAAA,EAAmB,GAAA;AAAA,EACnB,0BAAA,EAA4B,CAAA;AAAA,EAC5B,SAAA,EAAW;AACb,CAAA;AAwCO,IAAM,eAAA,GAAN,cAA8B,iBAAA,CAAkB;AAAA,EAC5C,IAAA,GAAO,oBAAA;AAAA,EACP,QAAA,GAAW,CAAA;AAAA;AAAA,EACX,WAAA,GAAc,IAAA;AAAA,EAEf,MAAA;AAAA,EACA,MAAA;AAAA,EACA,OAAA,uBAAyC,GAAA,EAAI;AAAA,EAC7C,sBAAA,GAAyB,CAAA;AAAA,EACzB,YAAA,GAAe,CAAA;AAAA,EACf,MAAA,GAAS,IAAIL,YAAAA,EAA8B;AAAA,EAEnD,WAAA,CAAY,MAAA,EAAuB,MAAA,GAA0B,EAAC,EAAG;AAC/D,IAAA,KAAA,EAAM;AACN,IAAA,IAAA,CAAK,MAAA,GAAS,MAAA;AACd,IAAA,IAAA,CAAK,MAAA,GAAS,EAAE,GAAGK,eAAAA,EAAgB,GAAG,MAAA,EAAO;AAAA,EAC/C;AAAA;AAAA;AAAA;AAAA,EAKA,EAAA,CACE,OACA,QAAA,EACM;AACN,IAAA,IAAA,CAAK,MAAA,CAAO,EAAA,CAAG,KAAA,EAAO,QAAe,CAAA;AACrC,IAAA,OAAO,IAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,WAAA,CAAY,UAAkB,UAAA,EAA6B;AAEzD,IAAA,IAAI,UAAA,GAAa,IAAA,CAAK,MAAA,CAAO,aAAA,EAAe;AAC1C,MAAA,OAAO,KAAA;AAAA,IACT;AAGA,IAAA,IAAI,IAAA,CAAK,MAAA,CAAO,KAAA,CAAM,MAAA,GAAS,CAAA,EAAG;AAChC,MAAA,IAAI,IAAA,CAAK,MAAA,CAAO,KAAA,CAAM,QAAA,CAAS,QAAQ,CAAA,EAAG;AACxC,QAAA,OAAO,IAAA;AAAA,MACT;AAAA,IACF;AAGA,IAAA,IAAI,IAAA,CAAK,MAAA,CAAO,YAAA,CAAa,MAAA,GAAS,CAAA,EAAG;AACvC,MAAA,KAAA,MAAW,OAAA,IAAW,IAAA,CAAK,MAAA,CAAO,YAAA,EAAc;AAC9C,QAAA,IAAI,OAAA,CAAQ,IAAA,CAAK,QAAQ,CAAA,EAAG;AAC1B,UAAA,OAAO,IAAA;AAAA,QACT;AAAA,MACF;AAAA,IACF;AAGA,IAAA,IAAI,IAAA,CAAK,OAAO,KAAA,CAAM,MAAA,KAAW,KAAK,IAAA,CAAK,MAAA,CAAO,YAAA,CAAa,MAAA,KAAW,CAAA,EAAG;AAC3E,MAAA,OAAO,IAAA;AAAA,IACT;AAEA,IAAA,OAAO,KAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUA,MAAM,YAAA,CAAa,QAAA,EAAkB,MAAA,EAA8C;AAEjF,IAAA,MAAM,YAAY,OAAO,MAAA,KAAW,WAAW,MAAA,GAAS,IAAA,CAAK,UAAU,MAAM,CAAA;AAC7E,IAAA,MAAM,SAAA,GAAY,MAAA,CAAO,UAAA,CAAW,SAAA,EAAW,MAAM,CAAA;AAErD,IAAA,IAAI,CAAC,IAAA,CAAK,WAAA,CAAY,QAAA,EAAU,SAAS,CAAA,EAAG;AAC1C,MAAA,OAAO,MAAA;AAAA,IACT;AAGA,IAAA,MAAM,GAAA,GAAM,CAAA,EAAG,IAAA,CAAK,MAAA,CAAO,SAAS,CAAA,CAAA,EAAI,QAAQ,CAAA,CAAA,EAAI,IAAA,CAAK,GAAA,EAAK,CAAA,CAAA,EAAI,KAAK,YAAA,EAAc,CAAA,CAAA;AACrF,IAAA,MAAM,OAAA,GAAU,aAAA,CAAc,GAAA,EAAK,KAAK,CAAA;AAGxC,IAAA,MAAM,KAAK,MAAA,CAAO,QAAA;AAAA,MAChB,GAAA;AAAA,MACA,CAAA,yBAAA,EAA4B,QAAQ,CAAA,EAAA,EAAKgB,YAAAA,CAAY,SAAS,CAAC,CAAA,CAAA,CAAA;AAAA,MAC/D;AAAA,KACF;AAGA,IAAA,MAAM,KAAA,GAAsB;AAAA,MAC1B,GAAA,EAAK,OAAA;AAAA,MACL,UAAA,EAAY,QAAA;AAAA,MACZ,SAAA;AAAA,MACA,SAAA,EAAW,KAAK,GAAA,EAAI;AAAA,MACpB,QAAA,EAAU,KAAA;AAAA,MACV,kBAAkB;AAAC,KACrB;AAEA,IAAA,IAAA,CAAK,OAAA,CAAQ,GAAA,CAAI,OAAA,EAAS,KAAK,CAAA;AAC/B,IAAA,IAAA,CAAK,MAAA,CAAO,KAAK,SAAA,EAAW,EAAE,KAAK,OAAA,EAAS,IAAA,EAAM,QAAA,EAAU,SAAA,EAAW,CAAA;AAGvE,IAAA,IAAA,CAAK,eAAA,EAAgB;AAErB,IAAA,OAAO,OAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,YAAA,CAAa,QAAgB,UAAA,EAA0B;AACrD,IAAA,MAAM,KAAA,GAAQ,IAAA,CAAK,OAAA,CAAQ,GAAA,CAAI,MAAM,CAAA;AACrC,IAAA,IAAI,KAAA,EAAO;AACT,MAAA,KAAA,CAAM,QAAA,GAAW,IAAA;AACjB,MAAA,KAAA,CAAM,gBAAA,CAAiB,KAAK,UAAU,CAAA;AACtC,MAAA,IAAA,CAAK,OAAO,IAAA,CAAK,UAAA,EAAY,EAAE,GAAA,EAAK,MAAA,EAAQ,YAAY,CAAA;AAAA,IAC1D;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,UAAA,GAA6B;AAC3B,IAAA,OAAO,KAAA,CAAM,IAAA,CAAK,IAAA,CAAK,OAAA,CAAQ,QAAQ,CAAA;AAAA,EACzC;AAAA;AAAA;AAAA;AAAA,EAKA,aAAA,GAAgC;AAC9B,IAAA,OAAO,IAAA,CAAK,YAAW,CAAE,MAAA,CAAO,CAAC,CAAA,KAAM,CAAC,EAAE,QAAQ,CAAA;AAAA,EACpD;AAAA;AAAA;AAAA;AAAA,EAKA,WAAA,GAA8B;AAC5B,IAAA,OAAO,KAAK,UAAA,EAAW,CAAE,OAAO,CAAC,CAAA,KAAM,EAAE,QAAQ,CAAA;AAAA,EACnD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,MAAM,eAAA,GAAqC;AACzC,IAAA,MAAM,QAAA,GAAW,KAAK,WAAA,EAAY;AAClC,IAAA,MAAM,UAAoB,EAAC;AAE3B,IAAA,KAAA,MAAW,SAAS,QAAA,EAAU;AAC5B,MAAA,IAAI;AAEF,QAAA,MAAM,IAAA,GAAO,cAAA,CAAe,KAAA,CAAM,GAAG,CAAA;AACrC,QAAA,IAAI,SAAS,KAAA,EAAO;AAClB,UAAA,MAAM,SAAS,MAAM,IAAA,CAAK,MAAA,CAAO,GAAA,CAAI,MAAM,GAAG,CAAA;AAC9C,UAAA,IAAI,MAAA,EAAQ;AACV,YAAA,MAAM,IAAA,CAAK,MAAA,CAAO,MAAA,CAAO,KAAA,CAAM,GAAG,CAAA;AAClC,YAAA,OAAA,CAAQ,IAAA,CAAK,MAAM,GAAG,CAAA;AAAA,UACxB;AAAA,QACF;AAEA,QAAA,IAAA,CAAK,OAAA,CAAQ,MAAA,CAAO,KAAA,CAAM,GAAG,CAAA;AAAA,MAC/B,CAAA,CAAA,MAAQ;AAAA,MAER;AAAA,IACF;AAEA,IAAA,IAAI,OAAA,CAAQ,SAAS,CAAA,EAAG;AACtB,MAAA,IAAA,CAAK,MAAA,CAAO,KAAK,SAAA,EAAW,EAAE,MAAM,OAAA,EAAS,MAAA,EAAQ,YAAY,CAAA;AAAA,IACnE;AAEA,IAAA,OAAO,OAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,MAAM,QAAQ,IAAA,EAAmC;AAC/C,IAAA,MAAM,UAAoB,EAAC;AAE3B,IAAA,KAAA,MAAW,OAAO,IAAA,EAAM;AACtB,MAAA,IAAI;AACF,QAAA,MAAM,IAAA,GAAO,eAAe,GAAG,CAAA;AAC/B,QAAA,IAAI,SAAS,KAAA,EAAO;AAClB,UAAA,MAAM,MAAA,GAAS,MAAM,IAAA,CAAK,MAAA,CAAO,IAAI,GAAG,CAAA;AACxC,UAAA,IAAI,MAAA,EAAQ;AACV,YAAA,MAAM,IAAA,CAAK,MAAA,CAAO,MAAA,CAAO,GAAG,CAAA;AAC5B,YAAA,OAAA,CAAQ,KAAK,GAAG,CAAA;AAAA,UAClB;AAAA,QACF;AACA,QAAA,IAAA,CAAK,OAAA,CAAQ,OAAO,GAAG,CAAA;AAAA,MACzB,CAAA,CAAA,MAAQ;AAAA,MAER;AAAA,IACF;AAEA,IAAA,IAAI,OAAA,CAAQ,SAAS,CAAA,EAAG;AACtB,MAAA,IAAA,CAAK,MAAA,CAAO,KAAK,SAAA,EAAW,EAAE,MAAM,OAAA,EAAS,MAAA,EAAQ,UAAU,CAAA;AAAA,IACjE;AAEA,IAAA,OAAO,OAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,UAAA,GAAgC;AACpC,IAAA,MAAM,OAAO,KAAA,CAAM,IAAA,CAAK,IAAA,CAAK,OAAA,CAAQ,MAAM,CAAA;AAC3C,IAAA,OAAO,IAAA,CAAK,QAAQ,IAAI,CAAA;AAAA,EAC1B;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,MAAM,WAAA,GAA6B;AACjC,IAAA,IAAA,CAAK,sBAAA,EAAA;AAEL,IAAA,IAAI,IAAA,CAAK,sBAAA,IAA0B,IAAA,CAAK,MAAA,CAAO,0BAAA,EAA4B;AACzE,MAAA,MAAM,KAAK,eAAA,EAAgB;AAC3B,MAAA,IAAA,CAAK,sBAAA,GAAyB,CAAA;AAAA,IAChC;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,aAAa,GAAA,EAAuC;AAClD,IAAA,OAAO,IAAA,CAAK,OAAA,CAAQ,GAAA,CAAI,GAAG,CAAA;AAAA,EAC7B;AAAA;AAAA;AAAA;AAAA,EAMA,MAAM,YAAA,GAAkD;AACtD,IAAA,MAAM,UAAA,GAAa,KAAK,aAAA,EAAc;AACtC,IAAA,IAAI,UAAA,CAAW,WAAW,CAAA,EAAG;AAC3B,MAAA,OAAO,IAAA;AAAA,IACT;AAGA,IAAA,MAAM,KAAA,GAAQ;AAAA,MACZ,sBAAA;AAAA,MACA,EAAA;AAAA,MACA,CAAA,uDAAA,EAA0D,WAAW,MAAM,CAAA,UAAA,CAAA;AAAA,MAC3E;AAAA,KACF;AAEA,IAAA,KAAA,MAAW,SAAS,UAAA,EAAY;AAC9B,MAAA,KAAA,CAAM,IAAA,CAAK,CAAA,IAAA,EAAO,KAAA,CAAM,GAAG,CAAA,WAAA,EAAc,KAAA,CAAM,UAAU,CAAA,IAAA,EAAOA,YAAAA,CAAY,KAAA,CAAM,SAAS,CAAC,CAAA,CAAA,CAAG,CAAA;AAAA,IACjG;AAEA,IAAA,KAAA,CAAM,KAAK,EAAE,CAAA;AACb,IAAA,KAAA,CAAM,KAAK,6DAA6D,CAAA;AACxE,IAAA,KAAA,CAAM,KAAK,oFAAoF,CAAA;AAE/F,IAAA,OAAO;AAAA,MACL,MAAM,IAAA,CAAK,IAAA;AAAA,MACX,OAAA,EAAS,KAAA,CAAM,IAAA,CAAK,IAAI,CAAA;AAAA,MACxB,UAAU,IAAA,CAAK,QAAA;AAAA,MACf,aAAa,IAAA,CAAK,WAAA;AAAA,MAClB,QAAA,EAAU;AAAA,QACR,iBAAiB,UAAA,CAAW,MAAA;AAAA,QAC5B,aAAA,EAAe,IAAA,CAAK,WAAA,EAAY,CAAE,MAAA;AAAA,QAClC,cAAA,EAAgB,WAAW,MAAA,CAAO,CAAC,KAAK,CAAA,KAAM,GAAA,GAAM,CAAA,CAAE,SAAA,EAAW,CAAC;AAAA;AACpE,KACF;AAAA,EACF;AAAA,EAEA,MAAM,OAAA,CAAQ,aAAA,EAAuB,UAAA,EAA8C;AAEjF,IAAA,MAAM,OAAA,GAAU,MAAM,IAAA,CAAK,eAAA,EAAgB;AAE3C,IAAA,OAAO,QAAQ,MAAA,GAAS,EAAA;AAAA,EAC1B;AAAA,EAES,QAAA,GAAqC;AAC5C,IAAA,OAAO;AAAA,MACL,SAAS,KAAA,CAAM,IAAA,CAAK,IAAA,CAAK,OAAA,CAAQ,QAAQ,CAAA;AAAA,MACzC,wBAAwB,IAAA,CAAK;AAAA,KAC/B;AAAA,EACF;AAAA,EAES,aAAa,KAAA,EAAsB;AAC1C,IAAA,MAAM,CAAA,GAAI,KAAA;AACV,IAAA,IAAI,GAAG,OAAA,IAAW,KAAA,CAAM,OAAA,CAAQ,CAAA,CAAE,OAAO,CAAA,EAAG;AAC1C,MAAA,IAAA,CAAK,QAAQ,KAAA,EAAM;AACnB,MAAA,KAAA,MAAW,KAAA,IAAS,EAAE,OAAA,EAAS;AAC7B,QAAA,IAAA,CAAK,OAAA,CAAQ,GAAA,CAAI,KAAA,CAAM,GAAA,EAAK,KAAK,CAAA;AAAA,MACnC;AAAA,IACF;AACA,IAAA,IAAI,OAAO,CAAA,EAAG,sBAAA,KAA2B,QAAA,EAAU;AACjD,MAAA,IAAA,CAAK,yBAAyB,CAAA,CAAE,sBAAA;AAAA,IAClC;AAAA,EACF;AAAA,EAES,OAAA,GAAgB;AACvB,IAAA,IAAA,CAAK,OAAO,kBAAA,EAAmB;AAC/B,IAAA,IAAA,CAAK,QAAQ,KAAA,EAAM;AAAA,EACrB;AAAA;AAAA;AAAA;AAAA,EAMQ,eAAA,GAAwB;AAC9B,IAAA,IAAI,IAAA,CAAK,OAAA,CAAQ,IAAA,IAAQ,IAAA,CAAK,OAAO,iBAAA,EAAmB;AACtD,MAAA;AAAA,IACF;AAGA,IAAA,MAAM,SAAS,KAAA,CAAM,IAAA,CAAK,KAAK,OAAA,CAAQ,OAAA,EAAS,CAAA,CAAE,IAAA;AAAA,MAChD,CAAC,GAAG,CAAC,CAAA,EAAG,GAAG,CAAC,CAAA,KAAM,CAAA,CAAE,SAAA,GAAY,CAAA,CAAE;AAAA,KACpC;AAEA,IAAA,MAAM,QAAA,GAAW,OAAO,KAAA,CAAM,CAAA,EAAG,OAAO,MAAA,GAAS,IAAA,CAAK,OAAO,iBAAiB,CAAA;AAC9E,IAAA,KAAA,MAAW,CAAC,GAAG,CAAA,IAAK,QAAA,EAAU;AAC5B,MAAA,IAAA,CAAK,OAAA,CAAQ,OAAO,GAAG,CAAA;AAAA,IACzB;AAAA,EACF;AACF,CAAA;AAKA,SAASA,aAAY,KAAA,EAAuB;AAC1C,EAAA,IAAI,KAAA,GAAQ,IAAA,EAAM,OAAO,CAAA,EAAG,KAAK,CAAA,EAAA,CAAA;AACjC,EAAA,IAAI,KAAA,GAAQ,OAAO,IAAA,EAAM,OAAO,IAAI,KAAA,GAAQ,IAAA,EAAM,OAAA,CAAQ,CAAC,CAAC,CAAA,GAAA,CAAA;AAC5D,EAAA,OAAO,IAAI,KAAA,IAAS,IAAA,GAAO,IAAA,CAAA,EAAO,OAAA,CAAQ,CAAC,CAAC,CAAA,GAAA,CAAA;AAC9C;;;AC7WO,IAAM,aAAA,GAAN,MAAM,cAAA,SAAsB,SAAA,CAAU;AAAA,EACnC,OAAA,uBAA4C,GAAA,EAAI;AAAA,EAChD,eAAA;AAAA,EACA,aAAA;AAAA,EACA,oBAAA,GAAsC,EAAE,UAAA,EAAY,EAAA,EAAG;AAAA,EACvD,mBAAA,GAAoC,EAAE,OAAA,EAAS,IAAA,GAAO,IAAA,EAAK;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQnE,OAAgB,OAAO,MAAA,EAA4C;AAEjE,IAAA,MAAM,aAAA,GAAgB,OAAO,oBAAA,KAAyB,KAAA,GAClD,oBAAoB,MAAA,CAAO,OAAO,IAClC,EAAC;AAGL,IAAA,MAAM,QAAA,GAAW,CAAC,GAAI,MAAA,CAAO,SAAS,EAAC,EAAI,GAAG,aAAa,CAAA;AAG3D,IAAA,MAAM,eAAA,GAAmC;AAAA,MACvC,GAAG,MAAA;AAAA,MACH,KAAA,EAAO,QAAA;AAAA,MACP,OAAO,MAAA,CAAO,KAAA;AAAA;AAAA,MAEd,OAAA,EAAS;AAAA,QACP,GAAI,MAAA,CAAO,OAAA,IAAW,EAAC;AAAA,QACvB,QAAA,EAAU;AAAA;AACZ,KACF;AAGA,IAAA,MAAM,SAAA,GAAY,SAAA,CAAU,MAAA,CAAO,eAAe,CAAA;AAGlD,IAAA,MAAM,aAAA,GAAgB,MAAA,CAAO,cAAA,CAAe,SAAA,EAAW,eAAc,SAAS,CAAA;AAG9E,IAAA,aAAA,CAAc,mBAAmB,MAAM,CAAA;AAEvC,IAAA,OAAO,aAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKQ,mBAAmB,MAAA,EAAmC;AAE5D,IAAA,IAAA,CAAK,OAAA,uBAAc,GAAA,EAAI;AACvB,IAAA,IAAA,CAAK,oBAAA,GAAuB,EAAE,UAAA,EAAY,EAAA,EAAG;AAC7C,IAAA,IAAA,CAAK,mBAAA,GAAsB,EAAE,OAAA,EAAS,IAAA,GAAO,IAAA,EAAK;AAGlD,IAAA,KAAA,MAAW,MAAA,IAAU,OAAO,OAAA,EAAS;AACnC,MAAA,IAAA,CAAK,OAAA,CAAQ,GAAA,CAAI,MAAA,CAAO,IAAA,EAAM,MAAM,CAAA;AAAA,IACtC;AAGA,IAAA,IAAA,CAAK,gBAAgB,MAAA,CAAO,KAAA;AAC5B,IAAA,IAAA,CAAK,oBAAA,GAAuB,MAAA,CAAO,oBAAA,IAAwB,EAAE,YAAY,EAAA,EAAG;AAC5E,IAAA,IAAA,CAAK,sBAAsB,MAAA,CAAO,mBAAA,IAAuB,EAAE,OAAA,EAAS,OAAO,IAAA,EAAK;AAIhF,IAAA,MAAM,eAAA,GAAmC;AAAA,MACvC,eAAe,EAAA,GAAK,IAAA;AAAA;AAAA,MACpB,YAAA,EAAc,CAAC,iBAAA,EAAmB,YAAA,EAAc,aAAa,CAAA;AAAA,MAC7D,GAAG,MAAA,CAAO;AAAA,KACZ;AAGA,IAAA,IAAI,IAAA,CAAK,cAAc,MAAA,EAAQ;AAC7B,MAAA,IAAA,CAAK,kBAAkB,IAAI,eAAA,CAAgB,IAAA,CAAK,aAAA,CAAc,QAAQ,eAAe,CAAA;AACrF,MAAA,IAAA,CAAK,aAAA,CAAc,cAAA,CAAe,IAAA,CAAK,eAAe,CAAA;AAAA,IACxD;AAGA,IAAA,IAAA,CAAK,yBAAA,EAA0B;AAAA,EACjC;AAAA;AAAA;AAAA;AAAA,EAKQ,yBAAA,GAAkC;AAAA,EAG1C;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,UAAA,GAAgC;AAC9B,IAAA,OAAO,KAAA,CAAM,IAAA,CAAK,IAAA,CAAK,OAAA,CAAQ,QAAQ,CAAA;AAAA,EACzC;AAAA;AAAA;AAAA;AAAA,EAKA,UAAU,IAAA,EAA2C;AACnD,IAAA,OAAO,IAAA,CAAK,OAAA,CAAQ,GAAA,CAAI,IAAI,CAAA;AAAA,EAC9B;AAAA;AAAA;AAAA;AAAA,EAKA,UAAU,MAAA,EAA+B;AACvC,IAAA,IAAA,CAAK,OAAA,CAAQ,GAAA,CAAI,MAAA,CAAO,IAAA,EAAM,MAAM,CAAA;AAAA,EACtC;AAAA;AAAA;AAAA;AAAA,EAKA,aAAa,IAAA,EAAuB;AAClC,IAAA,OAAO,IAAA,CAAK,OAAA,CAAQ,MAAA,CAAO,IAAI,CAAA;AAAA,EACjC;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,aAAA,CACJ,KAAA,EACA,OAAA,EACsE;AACtE,IAAA,MAAM,OAAA,uBAAc,GAAA,EAA4D;AAChF,IAAA,MAAM,gBAAgB,OAAA,EAAS,OAAA,GAC3B,QAAQ,OAAA,CAAQ,GAAA,CAAI,CAAC,IAAA,KAAS,IAAA,CAAK,OAAA,CAAQ,GAAA,CAAI,IAAI,CAAC,CAAA,CAAE,OAAO,OAAO,CAAA,GACpE,KAAK,UAAA,EAAW;AAEpB,IAAA,MAAM,gBAAgB,EAAE,GAAG,IAAA,CAAK,oBAAA,EAAsB,GAAG,OAAA,EAAQ;AAEjE,IAAA,MAAM,OAAA,CAAQ,GAAA;AAAA,MACZ,aAAA,CAAc,GAAA,CAAI,OAAO,MAAA,KAAW;AAClC,QAAA,IAAI;AACF,UAAA,MAAM,QAAA,GAAW,MAAM,MAAA,CAAO,MAAA,CAAO,OAAO,aAAa,CAAA;AACzD,UAAA,OAAA,CAAQ,GAAA,CAAI,MAAA,CAAO,IAAA,EAAM,QAAQ,CAAA;AAGjC,UAAA,IAAI,IAAA,CAAK,eAAe,gBAAA,EAAkB;AACxC,YAAA,MAAM,IAAA,CAAK,cAAc,gBAAA,CAAiB,MAAA,CAAO,MAAM,KAAA,EAAO,QAAA,CAAS,QAAQ,MAAM,CAAA;AAAA,UACvF;AAAA,QACF,SAAS,KAAA,EAAO;AACd,UAAA,OAAA,CAAQ,GAAA,CAAI,OAAO,IAAA,EAAM;AAAA,YACvB,OAAA,EAAS,KAAA;AAAA,YACT,KAAA;AAAA,YACA,SAAS,EAAC;AAAA,YACV,OAAO,KAAA,YAAiB,KAAA,GAAQ,KAAA,CAAM,OAAA,GAAU,OAAO,KAAK;AAAA,WAC7D,CAAA;AAAA,QACH;AAAA,MACF,CAAC;AAAA,KACH;AAEA,IAAA,OAAO,OAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,eAAA,CACJ,UAAA,EACA,SAAA,EACA,OAAA,EAC+C;AAC/C,IAAA,MAAM,MAAA,GAAS,IAAA,CAAK,OAAA,CAAQ,GAAA,CAAI,UAAU,CAAA;AAC1C,IAAA,IAAI,CAAC,MAAA,EAAQ;AACX,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,KAAA;AAAA,QACT,SAAA;AAAA,QACA,OAAA,EAAS,IAAA;AAAA,QACT,KAAA,EAAO,WAAW,UAAU,CAAA,WAAA;AAAA,OAC9B;AAAA,IACF;AAEA,IAAA,MAAM,eAAe,EAAE,GAAG,IAAA,CAAK,mBAAA,EAAqB,GAAG,OAAA,EAAQ;AAE/D,IAAA,IAAI;AACF,MAAA,MAAM,MAAA,GAAS,MAAM,MAAA,CAAO,KAAA,CAAM,WAAW,YAAY,CAAA;AAGzD,MAAA,IAAI,MAAA,CAAO,OAAA,IAAW,MAAA,CAAO,SAAA,IAAa,MAAA,CAAO,SAAA,IAAa,IAAA,CAAK,eAAA,GAAkB,QAAQ,CAAA,EAAG,aAAA,IAAiB,KAAA,CAAA,EAAQ;AACvH,QAAA,MAAM,QAAA,GAAW,MAAM,IAAA,CAAK,eAAA,EAAiB,aAAa,CAAA,eAAA,EAAkB,UAAU,CAAA,CAAA,EAAI,MAAA,CAAO,OAAO,CAAA;AACxG,QAAA,IAAI,QAAA,EAAU;AAEZ,UAAC,OAAe,UAAA,GAAa,QAAA;AAAA,QAC/B;AAAA,MACF;AAGA,MAAA,IAAI,IAAA,CAAK,eAAe,gBAAA,EAAkB;AACxC,QAAA,MAAM,KAAK,aAAA,CAAc,gBAAA,CAAiB,YAAY,SAAA,EAAW,MAAA,CAAO,aAAa,CAAC,CAAA;AAAA,MACxF;AAEA,MAAA,OAAO,MAAA;AAAA,IACT,SAAS,KAAA,EAAO;AACd,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,KAAA;AAAA,QACT,SAAA;AAAA,QACA,OAAA,EAAS,IAAA;AAAA,QACT,OAAO,KAAA,YAAiB,KAAA,GAAQ,KAAA,CAAM,OAAA,GAAU,OAAO,KAAK;AAAA,OAC9D;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,MAAM,YAAA,CACJ,GAAA,EACA,OAAA,EACe;AACf,IAAA,MAAM,MAAA,GAAS,KAAK,aAAA,CAAc,MAAA;AAClC,IAAA,IAAI,CAAC,MAAA,EAAQ;AACX,MAAA,MAAM,IAAI,MAAM,kEAAkE,CAAA;AAAA,IACpF;AAEA,IAAA,MAAM,OAAA,GAAU,aAAA,CAAc,GAAA,EAAK,UAAU,CAAA;AAE7C,IAAA,MAAM,MAAA,CAAO,aAAA;AAAA,MACX,GAAA;AAAA,MACA,CAAA,EAAG,QAAQ,MAAM,CAAA,EAAA,EAAK,QAAQ,OAAA,CAAQ,KAAA,CAAM,CAAA,EAAG,GAAG,CAAC,CAAA,GAAA,CAAA;AAAA,MACnD;AAAA,KACF;AAGA,IAAA,IAAI,IAAA,CAAK,eAAe,eAAA,EAAiB;AACvC,MAAA,MAAM,IAAA,CAAK,aAAA,CAAc,eAAA,CAAgB,OAAA,EAAS,OAAO,CAAA;AAAA,IAC3D;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,MAAM,WAAA,GAAwD;AAC5D,IAAA,MAAM,MAAA,GAAS,KAAK,aAAA,CAAc,MAAA;AAClC,IAAA,IAAI,CAAC,MAAA,EAAQ;AACX,MAAA,OAAO,EAAC;AAAA,IACV;AAEA,IAAA,MAAM,OAAA,GAAU,MAAM,MAAA,CAAO,SAAA,CAAU,UAAU,CAAA;AACjD,IAAA,MAAM,WAA4C,EAAC;AAEnD,IAAA,KAAA,MAAW,SAAS,OAAA,EAAS;AAC3B,MAAA,QAAA,CAAS,KAAA,CAAM,GAAG,CAAA,GAAI,KAAA,CAAM,KAAA;AAAA,IAC9B;AAEA,IAAA,OAAO,QAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,MAAM,oBAAoB,OAAA,EAAoC;AAE5D,IAAA,KAAA,MAAW,OAAO,OAAA,EAAS;AACzB,MAAA,IAAA,CAAK,eAAA,EAAiB,YAAA,CAAa,GAAA,EAAK,gBAAgB,CAAA;AAAA,IAC1D;AAGA,IAAA,MAAM,UAAU,MAAM,IAAA,CAAK,iBAAiB,OAAA,CAAQ,OAAO,KAAK,EAAC;AACjE,IAAA,OAAO,OAAA,CAAQ,MAAA;AAAA,EACjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,MAAM,oBAAoB,IAAA,EAA6C;AACrE,IAAA,MAAM,SAAA,GAAY,KAAK,GAAA,EAAI;AAC3B,IAAA,MAAMC,QAAAA,GAAU;AAAA,MACd,gBAAA,EAAkB,CAAA;AAAA,MAClB,iBAAA,EAAmB,CAAA;AAAA,MACnB,oBAAA,EAAsB,CAAA;AAAA,MACtB,eAAA,EAAiB;AAAA,KACnB;AAEA,IAAA,IAAI,eAAA,GAAkB,CAAA;AACtB,IAAA,IAAI,YAAA,GAAe,CAAA;AACnB,IAAA,IAAI,gBAAA,GAAmB,CAAA;AAEvB,IAAA,IAAI;AAEF,MAAA,MAAM,WAAA,GAAc,KAAK,GAAA,EAAI;AAC7B,MAAA,MAAM,aAAuE,EAAC;AAE9E,MAAA,KAAA,MAAW,SAAA,IAAa,KAAK,OAAA,EAAS;AACpC,QAAA,MAAM,aAAA,GAAgB,MAAM,IAAA,CAAK,aAAA,CAAc,UAAU,KAAA,EAAO;AAAA,UAC9D,YAAY,IAAA,CAAK,kBAAA;AAAA,UACjB,OAAA,EAAS,SAAA,CAAU,OAAA,IAAW,IAAA,CAAK;AAAA,SACpC,CAAA;AAED,QAAA,eAAA,EAAA;AAEA,QAAA,KAAA,MAAW,CAAC,MAAA,EAAQ,QAAQ,CAAA,IAAK,aAAA,EAAe;AAC9C,UAAA,IAAI,SAAS,OAAA,EAAS;AACpB,YAAA,UAAA,CAAW,IAAA,CAAK;AAAA,cACd,MAAA;AAAA,cACA,OAAO,SAAA,CAAU,KAAA;AAAA,cACjB,SAAS,QAAA,CAAS;AAAA,aACnB,CAAA;AACD,YAAA,YAAA,IAAgB,SAAS,OAAA,CAAQ,MAAA;AAAA,UACnC;AAAA,QACF;AAGA,QAAA,IAAI,IAAA,CAAK,eAAe,UAAA,EAAY;AAClC,UAAA,MAAM,IAAA,CAAK,cAAc,UAAA,CAAW;AAAA,YAClC,KAAA,EAAO,WAAA;AAAA,YACP,cAAc,SAAA,CAAU,KAAA;AAAA,YACxB,gBAAA,EAAkB,eAAA;AAAA,YAClB,YAAA,EAAc,KAAK,OAAA,CAAQ,MAAA;AAAA,YAC3B,gBAAA,EAAkB,CAAA;AAAA,YAClB,YAAA,EAAc,YAAA;AAAA,YACd,iBAAA,EAAmB;AAAA,WACpB,CAAA;AAAA,QACH;AAAA,MACF;AAEA,MAAAA,QAAAA,CAAQ,gBAAA,GAAmB,IAAA,CAAK,GAAA,EAAI,GAAI,WAAA;AAGxC,MAAA,MAAM,YAAA,GAAe,KAAK,GAAA,EAAI;AAC9B,MAAA,KAAA,MAAW,aAAa,UAAA,EAAY;AAClC,QAAA,KAAA,MAAW,MAAA,IAAU,UAAU,OAAA,EAAS;AAEtC,UAAA,MAAM,UAAU,MAAM,IAAA,CAAK,gBAAgB,SAAA,CAAU,MAAA,EAAQ,OAAO,SAAS,CAAA;AAC7E,UAAA,gBAAA,EAAA;AAEA,UAAA,IAAI,QAAQ,OAAA,EAAS;AAEnB,YAAA,IAAI,IAAA,CAAK,cAAc,MAAA,EAAQ;AAC7B,cAAA,MAAM,SAAS,CAAA,EAAG,SAAA,CAAU,MAAM,CAAA,CAAA,EAAI,OAAO,EAAE,CAAA,CAAA;AAC/C,cAAA,MAAM,IAAA,CAAK,cAAc,MAAA,CAAO,QAAA;AAAA,gBAC9B,MAAA;AAAA,gBACA,CAAA,iBAAA,EAAoB,SAAA,CAAU,MAAM,CAAA,EAAA,EAAK,OAAO,KAAK,CAAA,CAAA;AAAA,gBACrD,OAAA,CAAQ;AAAA,eACV;AAAA,YACF;AAAA,UACF;AAGA,UAAA,IAAI,IAAA,CAAK,eAAe,UAAA,EAAY;AAClC,YAAA,MAAM,IAAA,CAAK,cAAc,UAAA,CAAW;AAAA,cAClC,KAAA,EAAO,YAAA;AAAA,cACP,eAAe,SAAA,CAAU,MAAA;AAAA,cACzB,gBAAA,EAAkB,eAAA;AAAA,cAClB,YAAA,EAAc,KAAK,OAAA,CAAQ,MAAA;AAAA,cAC3B,gBAAA;AAAA,cACA,YAAA,EAAc,YAAA;AAAA,cACd,iBAAA,EAAmB;AAAA,aACpB,CAAA;AAAA,UACH;AAGA,UAAA,IAAI,IAAA,CAAK,gBAAA,IAAoB,gBAAA,IAAoB,IAAA,CAAK,gBAAA,EAAkB;AACtE,YAAA;AAAA,UACF;AAAA,QACF;AAAA,MACF;AAEA,MAAAA,QAAAA,CAAQ,iBAAA,GAAoB,IAAA,CAAK,GAAA,EAAI,GAAI,YAAA;AAMzC,MAAA,MAAM,QAAA,GAAW,MAAM,IAAA,CAAK,WAAA,EAAY;AACxC,MAAA,MAAM,aAAA,GAAgB,MAAA,CAAO,IAAA,CAAK,QAAQ,CAAA,CAAE,MAAA;AAE5C,MAAAA,QAAAA,CAAQ,eAAA,GAAkB,IAAA,CAAK,GAAA,EAAI,GAAI,SAAA;AAEvC,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,IAAA;AAAA,QACT,MAAM,IAAA,CAAK,IAAA;AAAA,QACX,eAAA;AAAA,QACA,YAAA;AAAA,QACA,gBAAA;AAAA,QACA,aAAA;AAAA,QACA,OAAA,EAAAA;AAAA,OACF;AAAA,IACF,SAAS,KAAA,EAAO;AACd,MAAAA,QAAAA,CAAQ,eAAA,GAAkB,IAAA,CAAK,GAAA,EAAI,GAAI,SAAA;AAEvC,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,KAAA;AAAA,QACT,MAAM,IAAA,CAAK,IAAA;AAAA,QACX,eAAA;AAAA,QACA,YAAA;AAAA,QACA,gBAAA;AAAA,QACA,aAAA,EAAe,CAAA;AAAA,QACf,OAAO,KAAA,YAAiB,KAAA,GAAQ,KAAA,CAAM,OAAA,GAAU,OAAO,KAAK,CAAA;AAAA,QAC5D,OAAA,EAAAA;AAAA,OACF;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,iBAAA,GAKE;AACA,IAAA,IAAI,CAAC,KAAK,eAAA,EAAiB;AACzB,MAAA,OAAO,EAAE,cAAc,CAAA,EAAG,QAAA,EAAU,GAAG,UAAA,EAAY,CAAA,EAAG,gBAAgB,CAAA,EAAE;AAAA,IAC1E;AAEA,IAAA,MAAM,OAAA,GAAU,IAAA,CAAK,eAAA,CAAgB,UAAA,EAAW;AAChD,IAAA,MAAM,WAAW,OAAA,CAAQ,MAAA,CAAO,CAAC,CAAA,KAAM,EAAE,QAAQ,CAAA;AACjD,IAAA,MAAM,aAAa,OAAA,CAAQ,MAAA,CAAO,CAAC,CAAA,KAAM,CAAC,EAAE,QAAQ,CAAA;AAEpD,IAAA,OAAO;AAAA,MACL,cAAc,OAAA,CAAQ,MAAA;AAAA,MACtB,UAAU,QAAA,CAAS,MAAA;AAAA,MACnB,YAAY,UAAA,CAAW,MAAA;AAAA,MACvB,cAAA,EAAgB,QAAQ,MAAA,CAAO,CAAC,KAAK,CAAA,KAAM,GAAA,GAAM,CAAA,CAAE,SAAA,EAAW,CAAC;AAAA,KACjE;AAAA,EACF;AAAA;AAAA,EAIA,MAAe,OAAA,GAAyB;AACtC,IAAA,IAAA,CAAK,QAAQ,KAAA,EAAM;AACnB,IAAA,MAAM,MAAM,OAAA,EAAQ;AAAA,EACtB;AACF;AAoBA,SAAS,oBAAoB,OAAA,EAA4C;AAEvE,EAAA,MAAM,UAAA,uBAAiB,GAAA,EAA6B;AACpD,EAAA,KAAA,MAAW,UAAU,OAAA,EAAS;AAC5B,IAAA,UAAA,CAAW,GAAA,CAAI,MAAA,CAAO,IAAA,EAAM,MAAM,CAAA;AAAA,EACpC;AAEA,EAAA,MAAM,cAAc,OAAA,CAAQ,GAAA,CAAI,CAAC,CAAA,KAAM,EAAE,IAAI,CAAA;AAC7C,EAAA,MAAM,qBAAqB,OAAA,CAAQ,GAAA,CAAI,CAAC,CAAA,KAAM,KAAK,CAAA,CAAE,IAAI,CAAA,EAAA,EAAK,CAAA,CAAE,IAAI,CAAA,GAAA,EAAM,CAAA,CAAE,WAAW,CAAA,CAAE,CAAA,CAAE,KAAK,IAAI,CAAA;AAEpG,EAAA,OAAO;AAAA;AAAA,IAEL;AAAA,MACE,UAAA,EAAY;AAAA,QACV,IAAA,EAAM,UAAA;AAAA,QACN,QAAA,EAAU;AAAA,UACR,IAAA,EAAM,iBAAA;AAAA,UACN,WAAA,EAAa,CAAA;;AAAA;AAAA,EAGrB,kBAAkB;;AAAA,4EAAA,CAAA;AAAA,UAGV,UAAA,EAAY;AAAA,YACV,IAAA,EAAM,QAAA;AAAA,YACN,UAAA,EAAY;AAAA,cACV,KAAA,EAAO;AAAA,gBACL,IAAA,EAAM,QAAA;AAAA,gBACN,WAAA,EAAa;AAAA,eACf;AAAA,cACA,OAAA,EAAS;AAAA,gBACP,IAAA,EAAM,OAAA;AAAA,gBACN,KAAA,EAAO,EAAE,IAAA,EAAM,QAAA,EAAU,MAAM,WAAA,EAAY;AAAA,gBAC3C,WAAA,EAAa;AAAA,eACf;AAAA,cACA,UAAA,EAAY;AAAA,gBACV,IAAA,EAAM,QAAA;AAAA,gBACN,WAAA,EAAa;AAAA;AACf,aACF;AAAA,YACA,QAAA,EAAU,CAAC,OAAO;AAAA;AACpB;AACF,OACF;AAAA,MACA,OAAA,EAAS,OAAO,IAAA,KAAkC;AAChD,QAAA,MAAM,QAAQ,IAAA,CAAK,KAAA;AACnB,QAAA,MAAM,mBAAmB,IAAA,CAAK,OAAA;AAC9B,QAAA,MAAM,UAAA,GAAc,KAAK,UAAA,IAAyB,EAAA;AAGlD,QAAA,MAAM,gBAAgB,gBAAA,IAAoB,gBAAA,CAAiB,MAAA,GAAS,CAAA,GAChE,iBAAiB,GAAA,CAAI,CAAC,IAAA,KAAS,UAAA,CAAW,IAAI,IAAI,CAAC,CAAA,CAAE,MAAA,CAAO,OAAO,CAAA,GACnE,OAAA;AAGJ,QAAA,MAAM,OAAA,uBAAc,GAAA,EAA4D;AAEhF,QAAA,MAAM,OAAA,CAAQ,GAAA;AAAA,UACZ,aAAA,CAAc,GAAA,CAAI,OAAO,MAAA,KAAW;AAClC,YAAA,IAAI;AACF,cAAA,MAAM,WAAW,MAAM,MAAA,CAAO,OAAO,KAAA,EAAO,EAAE,YAAY,CAAA;AAC1D,cAAA,OAAA,CAAQ,GAAA,CAAI,MAAA,CAAO,IAAA,EAAM,QAAQ,CAAA;AAAA,YACnC,SAAS,KAAA,EAAO;AACd,cAAA,OAAA,CAAQ,GAAA,CAAI,OAAO,IAAA,EAAM;AAAA,gBACvB,OAAA,EAAS,KAAA;AAAA,gBACT,KAAA;AAAA,gBACA,SAAS,EAAC;AAAA,gBACV,OAAO,KAAA,YAAiB,KAAA,GAAQ,KAAA,CAAM,OAAA,GAAU,OAAO,KAAK;AAAA,eAC7D,CAAA;AAAA,YACH;AAAA,UACF,CAAC;AAAA,SACH;AAGA,QAAA,MAAM,YAAqC,EAAC;AAC5C,QAAA,KAAA,MAAW,CAAC,MAAA,EAAQ,QAAQ,CAAA,IAAK,OAAA,EAAS;AACxC,UAAA,SAAA,CAAU,MAAM,CAAA,GAAI;AAAA,YAClB,SAAS,QAAA,CAAS,OAAA;AAAA,YAClB,KAAA,EAAO,SAAS,OAAA,CAAQ,MAAA;AAAA,YACxB,OAAA,EAAS,QAAA,CAAS,OAAA,CAAQ,GAAA,CAAI,CAAC,CAAA,MAAO;AAAA,cACpC,IAAI,CAAA,CAAE,EAAA;AAAA,cACN,OAAO,CAAA,CAAE,KAAA;AAAA,cACT,SAAS,CAAA,CAAE,OAAA;AAAA,cACX,WAAW,CAAA,CAAE,SAAA;AAAA,cACb,WAAW,CAAA,CAAE;AAAA,aACf,CAAE,CAAA;AAAA,YACF,OAAO,QAAA,CAAS;AAAA,WAClB;AAAA,QACF;AAEA,QAAA,OAAO;AAAA,UACL,KAAA;AAAA,UACA,OAAA,EAAS,MAAA,CAAO,IAAA,CAAK,SAAS,CAAA;AAAA,UAC9B,OAAA,EAAS,SAAA;AAAA,UACT,YAAA,EAAc,MAAA,CAAO,MAAA,CAAO,SAAS,CAAA,CAAE,MAAA,CAAO,CAAC,GAAA,EAAa,CAAA,KAAW,GAAA,GAAM,CAAA,CAAE,KAAA,EAAO,CAAC;AAAA,SACzF;AAAA,MACF,CAAA;AAAA,MACA,WAAA,EAAa,EAAE,IAAA,EAAM,KAAA,EAAM;AAAA,MAC3B,MAAA,EAAQ,EAAE,YAAA,EAAc,QAAA,EAAS;AAAA,MACjC,YAAA,EAAc,CAAC,IAAA,KAAS,CAAA,CAAA,EAAI,IAAA,CAAK,KAAK,CAAA,KAAA,EAAS,IAAA,CAAK,OAAA,EAAsB,IAAA,CAAK,IAAI,CAAA,IAAK,aAAa,CAAA;AAAA,KACvG;AAAA;AAAA,IAGA;AAAA,MACE,UAAA,EAAY;AAAA,QACV,IAAA,EAAM,UAAA;AAAA,QACN,QAAA,EAAU;AAAA,UACR,IAAA,EAAM,gBAAA;AAAA,UACN,WAAA,EAAa,CAAA;;AAAA;AAAA,uFAAA,CAAA;AAAA,UAIb,UAAA,EAAY;AAAA,YACV,IAAA,EAAM,QAAA;AAAA,YACN,UAAA,EAAY;AAAA,cACV,MAAA,EAAQ;AAAA,gBACN,IAAA,EAAM,QAAA;AAAA,gBACN,IAAA,EAAM,WAAA;AAAA,gBACN,WAAA,EAAa;AAAA,eACf;AAAA,cACA,SAAA,EAAW;AAAA,gBACT,IAAA,EAAM,QAAA;AAAA,gBACN,WAAA,EAAa;AAAA;AACf,aACF;AAAA,YACA,QAAA,EAAU,CAAC,QAAA,EAAU,WAAW;AAAA;AAClC;AACF,OACF;AAAA,MACA,OAAA,EAAS,OAAO,IAAA,KAAkC;AAChD,QAAA,MAAM,aAAa,IAAA,CAAK,MAAA;AACxB,QAAA,MAAM,YAAY,IAAA,CAAK,SAAA;AAEvB,QAAA,MAAM,MAAA,GAAS,UAAA,CAAW,GAAA,CAAI,UAAU,CAAA;AACxC,QAAA,IAAI,CAAC,MAAA,EAAQ;AACX,UAAA,OAAO;AAAA,YACL,OAAA,EAAS,KAAA;AAAA,YACT,SAAA;AAAA,YACA,KAAA,EAAO,WAAW,UAAU,CAAA,WAAA;AAAA,WAC9B;AAAA,QACF;AAEA,QAAA,IAAI;AACF,UAAA,MAAM,MAAA,GAAS,MAAM,MAAA,CAAO,KAAA,CAAM,WAAW,EAAE,OAAA,EAAS,IAAA,GAAO,IAAA,EAAM,CAAA;AAErE,UAAA,OAAO;AAAA,YACL,SAAS,MAAA,CAAO,OAAA;AAAA,YAChB,WAAW,MAAA,CAAO,SAAA;AAAA,YAClB,aAAa,MAAA,CAAO,WAAA;AAAA,YACpB,WAAW,MAAA,CAAO,SAAA;AAAA,YAClB,OAAA,EAAS,MAAA,CAAO,OAAA,GAAU,MAAA,CAAO,OAAA,GAAU,IAAA;AAAA,YAC3C,OAAO,MAAA,CAAO;AAAA,WAChB;AAAA,QACF,SAAS,KAAA,EAAO;AACd,UAAA,OAAO;AAAA,YACL,OAAA,EAAS,KAAA;AAAA,YACT,SAAA;AAAA,YACA,OAAO,KAAA,YAAiB,KAAA,GAAQ,KAAA,CAAM,OAAA,GAAU,OAAO,KAAK;AAAA,WAC9D;AAAA,QACF;AAAA,MACF,CAAA;AAAA,MACA,WAAA,EAAa,EAAE,IAAA,EAAM,KAAA,EAAM;AAAA,MAC3B,MAAA,EAAQ,EAAE,YAAA,EAAc,OAAA,EAAQ;AAAA,MAChC,YAAA,EAAc,CAAC,IAAA,KAAS,CAAA,EAAG,KAAK,MAAM,CAAA,CAAA,EAAI,KAAK,SAAS,CAAA;AAAA,KAC1D;AAAA;AAAA,IAGA;AAAA,MACE,UAAA,EAAY;AAAA,QACV,IAAA,EAAM,UAAA;AAAA,QACN,QAAA,EAAU;AAAA,UACR,IAAA,EAAM,wBAAA;AAAA,UACN,WAAA,EAAa,CAAA;;AAAA;AAAA;;AAAA,6EAAA,CAAA;AAAA,UAMb,UAAA,EAAY;AAAA,YACV,IAAA,EAAM,QAAA;AAAA,YACN,UAAA,EAAY;AAAA,cACV,GAAA,EAAK;AAAA,gBACH,IAAA,EAAM,QAAA;AAAA,gBACN,WAAA,EAAa;AAAA,eACf;AAAA,cACA,MAAA,EAAQ;AAAA,gBACN,IAAA,EAAM,QAAA;AAAA,gBACN,WAAA,EAAa;AAAA,eACf;AAAA,cACA,KAAA,EAAO;AAAA,gBACL,IAAA,EAAM,QAAA;AAAA,gBACN,WAAA,EAAa;AAAA,eACf;AAAA,cACA,OAAA,EAAS;AAAA,gBACP,IAAA,EAAM,QAAA;AAAA,gBACN,WAAA,EAAa;AAAA,eACf;AAAA,cACA,OAAA,EAAS;AAAA,gBACP,IAAA,EAAM,QAAA;AAAA,gBACN,WAAA,EAAa;AAAA,eACf;AAAA,cACA,UAAA,EAAY;AAAA,gBACV,IAAA,EAAM,OAAA;AAAA,gBACN,KAAA,EAAO,EAAE,IAAA,EAAM,QAAA,EAAS;AAAA,gBACxB,WAAA,EAAa;AAAA,eACf;AAAA,cACA,UAAA,EAAY;AAAA,gBACV,IAAA,EAAM,QAAA;AAAA,gBACN,WAAA,EAAa;AAAA;AACf,aACF;AAAA,YACA,UAAU,CAAC,KAAA,EAAO,QAAA,EAAU,OAAA,EAAS,WAAW,YAAY;AAAA;AAC9D;AACF,OACF;AAAA,MACA,OAAA,EAAS,OAAO,IAAA,EAA+B,OAAA,KAA0B;AACvE,QAAA,IAAI,CAAC,SAAS,MAAA,EAAQ;AACpB,UAAA,MAAM,IAAI,kBAAA,CAAmB,wBAAA,EAA0B,+DAA+D,CAAA;AAAA,QACxH;AAEA,QAAA,MAAM,OAAA,GAA2B;AAAA,UAC/B,QAAQ,IAAA,CAAK,MAAA;AAAA,UACb,OAAO,IAAA,CAAK,KAAA;AAAA,UACZ,SAAS,IAAA,CAAK,OAAA;AAAA,UACd,SAAS,IAAA,CAAK,OAAA;AAAA,UACd,YAAY,IAAA,CAAK,UAAA;AAAA,UACjB,YAAY,IAAA,CAAK,UAAA;AAAA,UACjB,SAAA,EAAW,KAAK,GAAA;AAAI,SACtB;AAEA,QAAA,MAAM,OAAA,GAAU,aAAA,CAAc,IAAA,CAAK,GAAA,EAAe,UAAU,CAAA;AAC5D,QAAA,MAAM,cAAc,CAAA,EAAG,OAAA,CAAQ,MAAM,CAAA,EAAA,EAAK,QAAQ,OAAA,CAAQ,KAAA,CAAM,CAAA,EAAG,GAAG,CAAC,CAAA,EAAG,OAAA,CAAQ,QAAQ,MAAA,GAAS,GAAA,GAAM,QAAQ,EAAE,CAAA,CAAA;AAEnH,QAAA,MAAM,OAAA,CAAQ,MAAA,CAAO,GAAA,CAAI,OAAA,EAAS,aAAa,OAAA,EAAS;AAAA,UACtD,KAAA,EAAO,EAAE,IAAA,EAAM,MAAA,EAAO;AAAA,UACtB,QAAA,EAAU;AAAA,SACX,CAAA;AAED,QAAA,OAAO;AAAA,UACL,OAAA,EAAS,IAAA;AAAA,UACT,GAAA,EAAK,OAAA;AAAA,UACL;AAAA,SACF;AAAA,MACF,CAAA;AAAA,MACA,WAAA,EAAa,EAAE,IAAA,EAAM,IAAA,EAAK;AAAA,MAC1B,MAAA,EAAQ,EAAE,YAAA,EAAc,OAAA,EAAQ;AAAA,MAChC,YAAA,EAAc,CAAC,IAAA,KAAS,IAAA,CAAK;AAAA,KAC/B;AAAA;AAAA,IAGA;AAAA,MACE,UAAA,EAAY;AAAA,QACV,IAAA,EAAM,UAAA;AAAA,QACN,QAAA,EAAU;AAAA,UACR,IAAA,EAAM,uBAAA;AAAA,UACN,WAAA,EAAa,6DAAA;AAAA,UACb,UAAA,EAAY;AAAA,YACV,IAAA,EAAM,QAAA;AAAA,YACN,YAAY,EAAC;AAAA,YACb,UAAU;AAAC;AACb;AACF,OACF;AAAA,MACA,SAAS,YAAY;AACnB,QAAA,OAAO;AAAA,UACL,OAAO,OAAA,CAAQ,MAAA;AAAA,UACf,OAAA,EAAS,OAAA,CAAQ,GAAA,CAAI,CAAC,CAAA,MAAO;AAAA,YAC3B,MAAM,CAAA,CAAE,IAAA;AAAA,YACR,MAAM,CAAA,CAAE,IAAA;AAAA,YACR,aAAa,CAAA,CAAE,WAAA;AAAA,YACf,YAAA,EAAc,CAAA,CAAE,eAAA,IAAkB,IAAK;AAAA,cACrC,SAAA,EAAW,IAAA;AAAA,cACX,QAAA,EAAU,IAAA;AAAA,cACV,kBAAA,EAAoB;AAAA;AACtB,WACF,CAAE;AAAA,SACJ;AAAA,MACF,CAAA;AAAA,MACA,WAAA,EAAa,EAAE,IAAA,EAAM,IAAA,EAAK;AAAA,MAC1B,MAAA,EAAQ,EAAE,YAAA,EAAc,OAAA,EAAQ;AAAA,MAChC,cAAc,MAAM;AAAA;AACtB,GACF;AACF;;;ACxwBO,IAAM,kBAAN,MAAiD;AAAA,EAC7C,IAAA;AAAA,EACA,WAAA;AAAA,EACA,IAAA,GAAO,KAAA;AAAA,EAER,cAAA;AAAA,EACA,cAAA;AAAA,EACA,eAAA;AAAA,EAER,YAAY,MAAA,EAA+B;AACzC,IAAA,IAAA,CAAK,OAAO,MAAA,CAAO,IAAA;AACnB,IAAA,IAAA,CAAK,WAAA,GAAc,MAAA,CAAO,WAAA,IAAe,CAAA,eAAA,EAAkB,OAAO,IAAI,CAAA,CAAA;AACtE,IAAA,IAAA,CAAK,iBAAiB,MAAA,CAAO,cAAA;AAC7B,IAAA,IAAA,CAAK,kBAAkB,MAAA,CAAO,eAAA;AAG9B,IAAA,IAAA,CAAK,cAAA,GAAiB,eAAe,MAAA,CAAO;AAAA,MAC1C,WAAW,MAAA,CAAO;AAAA,KACnB,CAAA;AAAA,EAGH;AAAA,EAEA,MAAM,MAAA,CAAO,KAAA,EAAe,OAAA,EAAkD;AAC5E,IAAA,IAAI;AACF,MAAA,MAAM,QAAA,GAAW,MAAM,IAAA,CAAK,cAAA,CAAe,OAAO,KAAA,EAAO;AAAA,QACvD,UAAA,EAAY,SAAS,UAAA,IAAc,EAAA;AAAA,QACnC,UAAU,IAAA,CAAK,eAAA;AAAA,QACf,SAAS,IAAA,CAAK,cAAA;AAAA,QACd,GAAG,OAAA,EAAS;AAAA,OACb,CAAA;AAED,MAAA,OAAO;AAAA,QACL,SAAS,QAAA,CAAS,OAAA;AAAA,QAClB,OAAO,QAAA,CAAS,KAAA;AAAA,QAChB,SAAS,QAAA,CAAS,OAAA,CAAQ,GAAA,CAAI,CAAC,GAAG,KAAA,MAAW;AAAA,UAC3C,EAAA,EAAI,GAAG,IAAA,CAAK,IAAI,IAAI,KAAK,CAAA,CAAA,EAAI,IAAA,CAAK,GAAA,EAAK,CAAA,CAAA;AAAA,UACvC,OAAO,CAAA,CAAE,KAAA;AAAA,UACT,SAAS,CAAA,CAAE,OAAA;AAAA,UACX,WAAW,CAAA,CAAE,GAAA;AAAA,UACb,WAAW,CAAA,GAAK,CAAA,CAAE,QAAA,IAAY,QAAA,CAAS,QAAQ,MAAA,GAAS,CAAA,CAAA;AAAA;AAAA,UACxD,QAAA,EAAU,EAAE,QAAA,EAAU,CAAA,CAAE,QAAA;AAAS,SACnC,CAAE,CAAA;AAAA,QACF,cAAc,QAAA,CAAS,KAAA;AAAA,QACvB,OAAO,QAAA,CAAS;AAAA,OAClB;AAAA,IACF,SAAS,KAAA,EAAO;AACd,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,KAAA;AAAA,QACT,KAAA;AAAA,QACA,SAAS,EAAC;AAAA,QACV,OAAO,KAAA,YAAiB,KAAA,GAAQ,KAAA,CAAM,OAAA,GAAU,OAAO,KAAK;AAAA,OAC9D;AAAA,IACF;AAAA,EACF;AAAA,EAEA,MAAM,KAAA,CAAM,SAAA,EAAmB,OAAA,EAAiD;AAC9E,IAAA,IAAI;AAEF,MAAA,MAAM,UAAA,GAAa,IAAI,eAAA,EAAgB;AACvC,MAAA,MAAM,OAAA,GAAU,SAAS,SAAA,IAAa,GAAA;AAEtC,MAAA,MAAM,YAAY,UAAA,CAAW,MAAM,UAAA,CAAW,KAAA,IAAS,OAAO,CAAA;AAE9D,MAAA,MAAM,OAAA,GAAkC;AAAA,QACtC,YAAA,EAAc,6CAAA;AAAA,QACd,QAAA,EAAU;AAAA,OACZ;AAKA,MAAA,MAAM,QAAA,GAAW,MAAM,KAAA,CAAM,SAAA,EAAW;AAAA,QACtC,OAAA;AAAA,QACA,QAAQ,UAAA,CAAW;AAAA,OACpB,CAAA;AAED,MAAA,YAAA,CAAa,SAAS,CAAA;AAEtB,MAAA,IAAI,CAAC,SAAS,EAAA,EAAI;AAChB,QAAA,OAAO;AAAA,UACL,OAAA,EAAS,KAAA;AAAA,UACT,SAAA;AAAA,UACA,OAAA,EAAS,IAAA;AAAA,UACT,OAAO,CAAA,KAAA,EAAQ,QAAA,CAAS,MAAM,CAAA,EAAA,EAAK,SAAS,UAAU,CAAA;AAAA,SACxD;AAAA,MACF;AAEA,MAAA,MAAM,WAAA,GAAc,QAAA,CAAS,OAAA,CAAQ,GAAA,CAAI,cAAc,CAAA,IAAK,WAAA;AAC5D,MAAA,MAAM,MAAA,GAAS,MAAM,QAAA,CAAS,WAAA,EAAY;AAC1C,MAAA,MAAM,YAAY,MAAA,CAAO,UAAA;AAGzB,MAAA,IAAI,OAAA,EAAS,OAAA,IAAW,SAAA,GAAY,OAAA,CAAQ,OAAA,EAAS;AACnD,QAAA,OAAO;AAAA,UACL,OAAA,EAAS,KAAA;AAAA,UACT,SAAA;AAAA,UACA,OAAA,EAAS,IAAA;AAAA,UACT,KAAA,EAAO,CAAA,mBAAA,EAAsB,SAAS,CAAA,aAAA,EAAgB,QAAQ,OAAO,CAAA,CAAA,CAAA;AAAA,UACrE;AAAA,SACF;AAAA,MACF;AAGA,MAAA,MAAM,OAAA,GAAU,IAAI,WAAA,EAAY;AAChC,MAAA,MAAM,OAAA,GAAU,OAAA,CAAQ,MAAA,CAAO,MAAM,CAAA;AAErC,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,IAAA;AAAA,QACT,SAAA;AAAA,QACA,OAAA;AAAA,QACA,WAAA;AAAA,QACA,SAAA;AAAA,QACA,QAAA,EAAU;AAAA,UACR,YAAY,QAAA,CAAS,MAAA;AAAA,UACrB,SAAS,MAAA,CAAO,WAAA,CAAY,QAAA,CAAS,OAAA,CAAQ,SAAS;AAAA;AACxD,OACF;AAAA,IACF,SAAS,KAAA,EAAO;AACd,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,KAAA;AAAA,QACT,SAAA;AAAA,QACA,OAAA,EAAS,IAAA;AAAA,QACT,OAAO,KAAA,YAAiB,KAAA,GAAQ,KAAA,CAAM,OAAA,GAAU,OAAO,KAAK;AAAA,OAC9D;AAAA,IACF;AAAA,EACF;AAAA,EAEA,MAAM,WAAA,GAAgC;AACpC,IAAA,IAAI;AAEF,MAAA,MAAM,QAAA,GAAW,MAAM,IAAA,CAAK,MAAA,CAAO,QAAQ,EAAE,UAAA,EAAY,GAAG,CAAA;AAC5D,MAAA,OAAO,QAAA,CAAS,OAAA;AAAA,IAClB,CAAA,CAAA,MAAQ;AACN,MAAA,OAAO,KAAA;AAAA,IACT;AAAA,EACF;AAAA,EAEA,eAAA,GAAsC;AACpC,IAAA,OAAO;AAAA,MACL,SAAA,EAAW,IAAA;AAAA,MACX,QAAA,EAAU,IAAA;AAAA,MACV,kBAAA,EAAoB,IAAA;AAAA,MACpB,mBAAA,EAAqB,GAAA;AAAA,MACrB,YAAA,EAAc,CAAC,WAAA,EAAa,YAAA,EAAc,kBAAkB;AAAA,KAC9D;AAAA,EACF;AACF;AAKO,SAAS,qBAAA,CACd,eACA,OAAA,EACiB;AACjB,EAAA,OAAO,IAAI,eAAA,CAAgB;AAAA,IACzB,IAAA,EAAM,OAAA,EAAS,IAAA,IAAQ,CAAA,IAAA,EAAO,aAAa,CAAA,CAAA;AAAA,IAC3C,WAAA,EAAa,OAAA,EAAS,WAAA,IAAe,CAAA,eAAA,EAAkB,aAAa,CAAA,CAAA;AAAA,IACpE,eAAA,EAAiB,aAAA;AAAA,IACjB,GAAG;AAAA,GACJ,CAAA;AACH;;;AC/LA,IAAA,WAAA,GAAqB,OAAA,CAAA,YAAA,EAAA,CAAA;AAkCd,IAAM,mBAAN,MAAkD;AAAA,EAC9C,IAAA;AAAA,EACA,WAAA;AAAA,EACA,IAAA,GAAO,MAAA;AAAA,EAER,QAAA;AAAA,EACA,eAAA;AAAA,EACA,eAAA;AAAA,EACA,WAAA;AAAA,EACA,UAAA;AAAA,EAER,YAAY,MAAA,EAAgC;AAC1C,IAAA,IAAA,CAAK,OAAO,MAAA,CAAO,IAAA;AACnB,IAAA,IAAA,CAAK,WAAA,GAAc,MAAA,CAAO,WAAA,IAAe,CAAA,eAAA,EAAkB,OAAO,QAAQ,CAAA,CAAA;AAC1E,IAAA,IAAA,CAAK,QAAA,GAAgB,KAAA,CAAA,OAAA,CAAQ,MAAA,CAAO,QAAQ,CAAA;AAC5C,IAAA,IAAA,CAAK,eAAA,GAAkB,MAAA,CAAO,eAAA,IAAmB,CAAC,MAAM,CAAA;AACxD,IAAA,IAAA,CAAK,eAAA,GAAkB,MAAA,CAAO,eAAA,IAAmB,CAAC,sBAAsB,YAAY,CAAA;AACpF,IAAA,IAAA,CAAK,WAAA,GAAc,MAAA,CAAO,WAAA,IAAe,IAAA,GAAO,IAAA;AAChD,IAAA,IAAA,CAAK,UAAA,GAAa,OAAO,UAAA,IAAc,MAAA;AAAA,EACzC;AAAA,EAEA,MAAM,MAAA,CAAO,KAAA,EAAe,OAAA,EAAkD;AAC5E,IAAA,IAAI;AACF,MAAA,MAAM,UAA0B,EAAC;AACjC,MAAA,MAAM,UAAA,GAAa,SAAS,UAAA,IAAc,EAAA;AAG1C,MAAA,MAAM,KAAA,GAAQ,MAAA,CAAA,CAAA,EAAM,WAAA,CAAA,IAAA,EAAK,IAAA,CAAK,eAAA,EAAiB;AAAA,QAC7C,KAAK,IAAA,CAAK,QAAA;AAAA,QACV,QAAQ,IAAA,CAAK,eAAA;AAAA,QACb,KAAA,EAAO,IAAA;AAAA,QACP,QAAA,EAAU;AAAA,OACX,CAAA;AAGD,MAAA,KAAA,MAAW,YAAY,KAAA,EAAO;AAC5B,QAAA,IAAI,OAAA,CAAQ,UAAU,UAAA,EAAY;AAElC,QAAA,MAAM,YAAA,GAAoB,KAAA,CAAA,QAAA,CAAS,IAAA,CAAK,QAAA,EAAU,QAAQ,CAAA;AAC1D,QAAA,MAAM,QAAA,GAAgB,eAAS,QAAQ,CAAA;AAGvC,QAAA,IAAI,IAAA,CAAK,UAAA,KAAe,UAAA,IAAc,IAAA,CAAK,eAAe,MAAA,EAAQ;AAChE,UAAA,IAAI,IAAA,CAAK,YAAA,CAAa,QAAA,EAAU,KAAK,CAAA,EAAG;AACtC,YAAA,OAAA,CAAQ,IAAA,CAAK;AAAA,cACX,EAAA,EAAI,CAAA,KAAA,EAAQ,MAAA,CAAO,IAAA,CAAK,YAAY,CAAA,CAAE,QAAA,CAAS,QAAQ,CAAA,CAAE,KAAA,CAAM,CAAA,EAAG,EAAE,CAAC,CAAA,CAAA;AAAA,cACrE,KAAA,EAAO,QAAA;AAAA,cACP,OAAA,EAAS,SAAS,YAAY,CAAA,CAAA;AAAA,cAC9B,SAAA,EAAW,QAAA;AAAA,cACX,SAAA,EAAW,IAAA,CAAK,kBAAA,CAAmB,QAAA,EAAU,KAAK,CAAA;AAAA,cAClD,QAAA,EAAU,EAAE,IAAA,EAAM,gBAAA,EAAkB,YAAA;AAAa,aAClD,CAAA;AACD,YAAA;AAAA,UACF;AAAA,QACF;AAGA,QAAA,IAAI,IAAA,CAAK,UAAA,KAAe,SAAA,IAAa,IAAA,CAAK,eAAe,MAAA,EAAQ;AAC/D,UAAA,IAAI;AACF,YAAA,MAAMpC,KAAAA,GAAO,MAASqC,IAAA,CAAA,IAAA,CAAK,QAAQ,CAAA;AACnC,YAAA,IAAIrC,KAAAA,CAAK,IAAA,GAAO,IAAA,CAAK,WAAA,EAAa;AAElC,YAAA,MAAM,OAAA,GAAU,MAASqC,IAAA,CAAA,QAAA,CAAS,QAAA,EAAU,OAAO,CAAA;AACnD,YAAA,MAAM,KAAA,GAAQ,IAAA,CAAK,gBAAA,CAAiB,OAAA,EAAS,KAAK,CAAA;AAElD,YAAA,IAAI,KAAA,EAAO;AACT,cAAA,OAAA,CAAQ,IAAA,CAAK;AAAA,gBACX,EAAA,EAAI,CAAA,KAAA,EAAQ,MAAA,CAAO,IAAA,CAAK,YAAY,CAAA,CAAE,QAAA,CAAS,QAAQ,CAAA,CAAE,KAAA,CAAM,CAAA,EAAG,EAAE,CAAC,CAAA,CAAA;AAAA,gBACrE,KAAA,EAAO,QAAA;AAAA,gBACP,SAAS,KAAA,CAAM,OAAA;AAAA,gBACf,SAAA,EAAW,QAAA;AAAA,gBACX,WAAW,KAAA,CAAM,SAAA;AAAA,gBACjB,QAAA,EAAU;AAAA,kBACR,IAAA,EAAM,eAAA;AAAA,kBACN,YAAA;AAAA,kBACA,YAAY,KAAA,CAAM;AAAA;AACpB,eACD,CAAA;AAAA,YACH;AAAA,UACF,CAAA,CAAA,MAAQ;AAAA,UAER;AAAA,QACF;AAAA,MACF;AAGA,MAAA,OAAA,CAAQ,IAAA,CAAK,CAAC,CAAA,EAAG,CAAA,KAAA,CAAO,EAAE,SAAA,IAAa,CAAA,KAAM,CAAA,CAAE,SAAA,IAAa,CAAA,CAAE,CAAA;AAE9D,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,IAAA;AAAA,QACT,KAAA;AAAA,QACA,OAAA,EAAS,OAAA,CAAQ,KAAA,CAAM,CAAA,EAAG,UAAU,CAAA;AAAA,QACpC,cAAc,OAAA,CAAQ;AAAA,OACxB;AAAA,IACF,SAAS,KAAA,EAAO;AACd,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,KAAA;AAAA,QACT,KAAA;AAAA,QACA,SAAS,EAAC;AAAA,QACV,OAAO,KAAA,YAAiB,KAAA,GAAQ,KAAA,CAAM,OAAA,GAAU,OAAO,KAAK;AAAA,OAC9D;AAAA,IACF;AAAA,EACF;AAAA,EAEA,MAAM,KAAA,CAAM,SAAA,EAAmB,OAAA,EAAiD;AAC9E,IAAA,IAAI;AAEF,MAAA,MAAM,YAAA,GAAoB,cAAQ,SAAS,CAAA;AAC3C,MAAA,IAAI,CAAC,YAAA,CAAa,UAAA,CAAW,IAAA,CAAK,QAAQ,CAAA,EAAG;AAC3C,QAAA,OAAO;AAAA,UACL,OAAA,EAAS,KAAA;AAAA,UACT,SAAA;AAAA,UACA,OAAA,EAAS,IAAA;AAAA,UACT,KAAA,EAAO;AAAA,SACT;AAAA,MACF;AAEA,MAAA,MAAMrC,KAAAA,GAAO,MAASqC,IAAA,CAAA,IAAA,CAAK,YAAY,CAAA;AACvC,MAAA,MAAM,OAAA,GAAU,OAAA,EAAS,OAAA,IAAW,IAAA,CAAK,WAAA;AAEzC,MAAA,IAAIrC,KAAAA,CAAK,OAAO,OAAA,EAAS;AACvB,QAAA,OAAO;AAAA,UACL,OAAA,EAAS,KAAA;AAAA,UACT,SAAA;AAAA,UACA,OAAA,EAAS,IAAA;AAAA,UACT,KAAA,EAAO,CAAA,gBAAA,EAAmBA,KAAAA,CAAK,IAAI,gBAAgB,OAAO,CAAA,CAAA,CAAA;AAAA,UAC1D,WAAWA,KAAAA,CAAK;AAAA,SAClB;AAAA,MACF;AAEA,MAAA,MAAM,OAAA,GAAU,MAASqC,IAAA,CAAA,QAAA,CAAS,YAAA,EAAc,OAAO,CAAA;AACvD,MAAA,MAAM,GAAA,GAAW,KAAA,CAAA,OAAA,CAAQ,YAAY,CAAA,CAAE,WAAA,EAAY;AAEnD,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,IAAA;AAAA,QACT,SAAA;AAAA,QACA,OAAA;AAAA,QACA,WAAA,EAAa,IAAA,CAAK,cAAA,CAAe,GAAG,CAAA;AAAA,QACpC,WAAWrC,KAAAA,CAAK,IAAA;AAAA,QAChB,QAAA,EAAU;AAAA,UACR,QAAA,EAAe,eAAS,YAAY,CAAA;AAAA,UACpC,SAAA,EAAW,GAAA;AAAA,UACX,UAAA,EAAYA,KAAAA,CAAK,KAAA,CAAM,WAAA;AAAY;AACrC,OACF;AAAA,IACF,SAAS,KAAA,EAAO;AACd,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,KAAA;AAAA,QACT,SAAA;AAAA,QACA,OAAA,EAAS,IAAA;AAAA,QACT,OAAO,KAAA,YAAiB,KAAA,GAAQ,KAAA,CAAM,OAAA,GAAU,OAAO,KAAK;AAAA,OAC9D;AAAA,IACF;AAAA,EACF;AAAA,EAEA,MAAM,WAAA,GAAgC;AACpC,IAAA,IAAI;AACF,MAAA,MAASqC,IAAA,CAAA,MAAA,CAAO,KAAK,QAAQ,CAAA;AAC7B,MAAA,OAAO,IAAA;AAAA,IACT,CAAA,CAAA,MAAQ;AACN,MAAA,OAAO,KAAA;AAAA,IACT;AAAA,EACF;AAAA,EAEA,eAAA,GAAsC;AACpC,IAAA,OAAO;AAAA,MACL,SAAA,EAAW,IAAA;AAAA,MACX,QAAA,EAAU,IAAA;AAAA,MACV,kBAAA,EAAoB,IAAA;AAAA,MACpB,mBAAA,EAAqB,GAAA;AAAA,MACrB,YAAA,EAAc,CAAC,YAAA,EAAc,kBAAA,EAAoB,iBAAiB,iBAAiB;AAAA,KACrF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAMQ,YAAA,CAAa,MAAc,KAAA,EAAwB;AACzD,IAAA,MAAM,SAAA,GAAY,KAAK,WAAA,EAAY;AACnC,IAAA,MAAM,UAAA,GAAa,MAAM,WAAA,EAAY;AAGrC,IAAA,IAAI,SAAA,CAAU,QAAA,CAAS,UAAU,CAAA,EAAG,OAAO,IAAA;AAG3C,IAAA,MAAM,UAAA,GAAa,UAAA,CAAW,KAAA,CAAM,KAAK,CAAA;AACzC,IAAA,OAAO,WAAW,KAAA,CAAM,CAAC,SAAS,SAAA,CAAU,QAAA,CAAS,IAAI,CAAC,CAAA;AAAA,EAC5D;AAAA,EAEQ,kBAAA,CAAmB,MAAc,KAAA,EAAuB;AAC9D,IAAA,MAAM,SAAA,GAAY,KAAK,WAAA,EAAY;AACnC,IAAA,MAAM,UAAA,GAAa,MAAM,WAAA,EAAY;AAGrC,IAAA,IAAI,SAAA,KAAc,YAAY,OAAO,CAAA;AAGrC,IAAA,IAAI,SAAA,CAAU,UAAA,CAAW,UAAU,CAAA,EAAG,OAAO,GAAA;AAG7C,IAAA,IAAI,SAAA,CAAU,QAAA,CAAS,UAAU,CAAA,EAAG,OAAO,GAAA;AAG3C,IAAA,MAAM,UAAA,GAAa,UAAA,CAAW,KAAA,CAAM,KAAK,CAAA;AACzC,IAAA,MAAM,YAAA,GAAe,WAAW,MAAA,CAAO,CAAC,MAAM,SAAA,CAAU,QAAA,CAAS,CAAC,CAAC,CAAA;AACnE,IAAA,OAAQ,YAAA,CAAa,MAAA,GAAS,UAAA,CAAW,MAAA,GAAU,GAAA;AAAA,EACrD;AAAA,EAEQ,gBAAA,CACN,SACA,KAAA,EACmE;AACnE,IAAA,MAAM,KAAA,GAAQ,OAAA,CAAQ,KAAA,CAAM,IAAI,CAAA;AAChC,IAAA,MAAM,UAAA,GAAa,MAAM,WAAA,EAAY;AAErC,IAAA,KAAA,IAAS,CAAA,GAAI,CAAA,EAAG,CAAA,GAAI,KAAA,CAAM,QAAQ,CAAA,EAAA,EAAK;AACrC,MAAA,MAAM,IAAA,GAAO,KAAA,CAAM,CAAC,CAAA,IAAK,EAAA;AACzB,MAAA,MAAM,SAAA,GAAY,KAAK,WAAA,EAAY;AAEnC,MAAA,IAAI,SAAA,CAAU,QAAA,CAAS,UAAU,CAAA,EAAG;AAElC,QAAA,MAAM,KAAA,GAAQ,IAAA,CAAK,GAAA,CAAI,CAAA,EAAG,IAAI,CAAC,CAAA;AAC/B,QAAA,MAAM,MAAM,IAAA,CAAK,GAAA,CAAI,KAAA,CAAM,MAAA,EAAQ,IAAI,CAAC,CAAA;AACxC,QAAA,MAAM,UAAU,KAAA,CAAM,KAAA,CAAM,OAAO,GAAG,CAAA,CAAE,KAAK,IAAI,CAAA;AAEjD,QAAA,OAAO;AAAA,UACL,OAAA,EAAS,QAAQ,MAAA,GAAS,GAAA,GAAM,QAAQ,KAAA,CAAM,CAAA,EAAG,GAAG,CAAA,GAAI,KAAA,GAAQ,OAAA;AAAA,UAChE,SAAA,EAAW,GAAA;AAAA,UACX,YAAY,CAAA,GAAI;AAAA,SAClB;AAAA,MACF;AAAA,IACF;AAEA,IAAA,OAAO,IAAA;AAAA,EACT;AAAA,EAEQ,eAAe,GAAA,EAAqB;AAC1C,IAAA,MAAM,KAAA,GAAgC;AAAA,MACpC,MAAA,EAAQ,YAAA;AAAA,MACR,KAAA,EAAO,eAAA;AAAA,MACP,OAAA,EAAS,kBAAA;AAAA,MACT,KAAA,EAAO,iBAAA;AAAA,MACP,KAAA,EAAO,iBAAA;AAAA,MACP,KAAA,EAAO,eAAA;AAAA,MACP,OAAA,EAAS,WAAA;AAAA,MACT,MAAA,EAAQ,UAAA;AAAA,MACR,MAAA,EAAQ,iBAAA;AAAA,MACR,OAAA,EAAS,WAAA;AAAA,MACT,MAAA,EAAQ;AAAA,KACV;AACA,IAAA,OAAO,KAAA,CAAM,GAAG,CAAA,IAAK,YAAA;AAAA,EACvB;AACF;AAKO,SAAS,sBAAA,CACd,UACA,OAAA,EACkB;AAClB,EAAA,OAAO,IAAI,gBAAA,CAAiB;AAAA,IAC1B,MAAM,OAAA,EAAS,IAAA,IAAQ,CAAA,MAAA,EAAc,KAAA,CAAA,QAAA,CAAS,QAAQ,CAAC,CAAA,CAAA;AAAA,IACvD,QAAA;AAAA,IACA,GAAG;AAAA,GACJ,CAAA;AACH;;;AC5SO,IAAM,oBAAN,MAAqD;AAAA,EAI1D,YAAoB,SAAA,EAA4B;AAA5B,IAAA,IAAA,CAAA,SAAA,GAAA,SAAA;AAAA,EAA6B;AAAA,EAHxC,IAAA,GAAO,UAAA;AAAA,EACP,QAAA,GAAW,EAAA;AAAA,EAIpB,WAAW,SAAA,EAAuC;AAChD,IAAA,OACE,SAAA,CAAU,gBACT,SAAA,CAAU,QAAA,EAAU,aAAa,UAAA,IAAc,SAAA,CAAU,UAAU,WAAA,KAAgB,IAAA,CAAA;AAAA,EAExF;AAAA,EAEA,MAAM,OAAA,CAAQ,SAAA,EAA8B,YAAA,EAAkD;AAC5F,IAAA,IAAI,OAAO,SAAA,CAAU,OAAA,KAAY,QAAA,EAAU;AACzC,MAAA,OAAO,IAAA,CAAK,cAAA,CAAe,SAAA,EAAW,YAAY,CAAA;AAAA,IACpD;AAEA,IAAA,IAAI,KAAA,CAAM,OAAA,CAAQ,SAAA,CAAU,OAAO,CAAA,EAAG;AACpC,MAAA,OAAO,IAAA,CAAK,aAAA,CAAc,SAAA,EAAW,YAAY,CAAA;AAAA,IACnD;AAGA,IAAA,OAAO,SAAA;AAAA,EACT;AAAA,EAEA,gBAAgB,SAAA,EAAsC;AACpD,IAAA,MAAM,OAAA,GAAU,IAAA,CAAK,SAAA,CAAU,kBAAA,CAAmB,UAAU,OAAO,CAAA;AACnE,IAAA,OAAO,IAAA,CAAK,KAAA,CAAM,OAAA,GAAU,GAAG,CAAA;AAAA,EACjC;AAAA,EAEQ,cAAA,CAAe,WAA8B,YAAA,EAAyC;AAC5F,IAAA,MAAM,UAAU,SAAA,CAAU,OAAA;AAC1B,IAAA,MAAM,aAAA,GAAgB,IAAA,CAAK,SAAA,CAAU,cAAA,CAAe,OAAO,CAAA;AAE3D,IAAA,IAAI,iBAAiB,YAAA,EAAc;AACjC,MAAA,OAAO,SAAA;AAAA,IACT;AAGA,IAAA,MAAM,cAAc,YAAA,GAAe,CAAA;AACnC,IAAA,MAAM,SAAA,GAAY,OAAA,CAAQ,SAAA,CAAU,CAAA,EAAG,WAAW,CAAA,GAAI,kBAAA;AAEtD,IAAA,OAAO;AAAA,MACL,GAAG,SAAA;AAAA,MACH,OAAA,EAAS,SAAA;AAAA,MACT,QAAA,EAAU;AAAA,QACR,GAAG,SAAA,CAAU,QAAA;AAAA,QACb,SAAA,EAAW,IAAA;AAAA,QACX,gBAAgB,OAAA,CAAQ,MAAA;AAAA,QACxB,iBAAiB,SAAA,CAAU;AAAA;AAC7B,KACF;AAAA,EACF;AAAA,EAEQ,aAAA,CAAc,WAA8B,YAAA,EAAyC;AAC3F,IAAA,MAAM,UAAU,SAAA,CAAU,OAAA;AAC1B,IAAA,IAAI,MAAA,GAAS,CAAA;AACb,IAAA,MAAM,OAAkB,EAAC;AAGzB,IAAA,KAAA,IAAS,IAAI,OAAA,CAAQ,MAAA,GAAS,CAAA,EAAG,CAAA,IAAK,GAAG,CAAA,EAAA,EAAK;AAC5C,MAAA,MAAM,IAAA,GAAO,QAAQ,CAAC,CAAA;AACtB,MAAA,MAAM,UAAA,GAAa,IAAA,CAAK,SAAA,CAAU,kBAAA,CAAmB,IAAI,CAAA;AAEzD,MAAA,IAAI,MAAA,GAAS,UAAA,GAAa,YAAA,IAAgB,IAAA,CAAK,SAAS,CAAA,EAAG;AACzD,QAAA;AAAA,MACF;AAEA,MAAA,IAAA,CAAK,QAAQ,IAAI,CAAA;AACjB,MAAA,MAAA,IAAU,UAAA;AAAA,IACZ;AAEA,IAAA,MAAM,aAAA,GAAgB,OAAA,CAAQ,MAAA,GAAS,IAAA,CAAK,MAAA;AAG5C,IAAA,IAAI,kBAAkB,CAAA,EAAG;AACvB,MAAA,OAAO,SAAA;AAAA,IACT;AAEA,IAAA,OAAO;AAAA,MACL,GAAG,SAAA;AAAA,MACH,OAAA,EAAS,IAAA;AAAA,MACT,QAAA,EAAU;AAAA,QACR,GAAG,SAAA,CAAU,QAAA;AAAA,QACb,SAAA,EAAW,IAAA;AAAA,QACX,gBAAgB,OAAA,CAAQ,MAAA;AAAA,QACxB,YAAY,IAAA,CAAK,MAAA;AAAA,QACjB;AAAA;AACF,KACF;AAAA,EACF;AACF;;;AChDA,IAAM,qBAAA,GAA8D;AAAA,EAClE,YAAA,EAAc,CAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA,yCAAA,CAAA;AAAA,EAUd,WAAA,EAAa,CAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA,8CAAA,CAAA;AAAA,EASb,cAAA,EAAgB,CAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA,uDAAA,CAAA;AAAA,EAShB,cAAA,EAAgB,CAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA,uDAAA,CAAA;AAAA,EAShB,OAAA,EAAS,CAAA;AAAA;AAAA;AAAA;AAAA;;AAAA,gDAAA;AAOX,CAAA;AAQO,IAAM,qBAAN,MAAsD;AAAA,EAClD,IAAA,GAAO,WAAA;AAAA,EACP,QAAA,GAAW,CAAA;AAAA;AAAA,EAEZ,MAAA;AAAA,EACA,SAAA;AAAA,EAER,WAAA,CAAY,WAA4B,MAAA,EAAkC;AACxE,IAAA,IAAA,CAAK,SAAA,GAAY,SAAA;AACjB,IAAA,IAAA,CAAK,MAAA,GAAS;AAAA,MACZ,cAAc,MAAA,CAAO,YAAA;AAAA,MACrB,KAAA,EAAO,OAAO,KAAA,IAAS,EAAA;AAAA,MACvB,gBAAA,EAAkB,OAAO,gBAAA,IAAoB,GAAA;AAAA,MAC7C,iBAAA,EAAmB,OAAO,iBAAA,IAAqB,IAAA;AAAA,MAC/C,kBAAA,EAAoB,OAAO,kBAAA,IAAsB,IAAA;AAAA,MACjD,WAAA,EAAa,OAAO,WAAA,IAAe;AAAA,KACrC;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,WAAW,SAAA,EAAuC;AAChD,IAAA,OACE,SAAA,CAAU,WAAA,IAAe,SAAA,CAAU,QAAA,EAAU,QAAA,KAAa,WAAA;AAAA,EAE9D;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,OAAA,CACJ,SAAA,EACA,YAAA,EAC4B;AAE5B,IAAA,MAAM,UAAA,GAAa,IAAA,CAAK,gBAAA,CAAiB,SAAA,CAAU,OAAO,CAAA;AAC1D,IAAA,MAAM,aAAA,GAAgB,IAAA,CAAK,SAAA,CAAU,cAAA,CAAe,UAAU,CAAA;AAG9D,IAAA,IAAI,iBAAiB,YAAA,EAAc;AACjC,MAAA,OAAO,SAAA;AAAA,IACT;AAGA,IAAA,MAAM,WAAA,GAAc,IAAA,CAAK,iBAAA,CAAkB,SAAS,CAAA;AAEpD,IAAA,IAAI;AAEF,MAAA,MAAM,UAAU,MAAM,IAAA,CAAK,SAAA,CAAU,UAAA,EAAY,aAAa,YAAY,CAAA;AAG1E,MAAA,MAAM,aAAA,GAAgB,IAAA,CAAK,SAAA,CAAU,cAAA,CAAe,OAAO,CAAA;AAC3D,MAAA,IAAI,aAAA,IAAiB,gBAAgB,GAAA,EAAK;AAExC,QAAA,IAAI,IAAA,CAAK,OAAO,kBAAA,EAAoB;AAClC,UAAA,OAAO,IAAA,CAAK,gBAAA,CAAiB,SAAA,EAAW,UAAA,EAAY,YAAY,CAAA;AAAA,QAClE;AAAA,MACF;AAEA,MAAA,OAAO;AAAA,QACL,GAAG,SAAA;AAAA,QACH,OAAA,EAAS,OAAA;AAAA,QACT,QAAA,EAAU;AAAA,UACR,GAAG,SAAA,CAAU,QAAA;AAAA,UACb,UAAA,EAAY,IAAA;AAAA,UACZ,cAAA,EAAgB,aAAA;AAAA,UAChB,YAAA,EAAc,aAAA;AAAA,UACd,kBAAkB,IAAA,CAAK,KAAA;AAAA,YAAA,CACnB,aAAA,GAAgB,iBAAiB,aAAA,GAAiB;AAAA,WACtD;AAAA,UACA;AAAA;AACF,OACF;AAAA,IACF,SAAS,KAAA,EAAO;AAEd,MAAA,IAAI,IAAA,CAAK,OAAO,kBAAA,EAAoB;AAClC,QAAA,OAAA,CAAQ,IAAA;AAAA,UACN,CAAA,iDAAA,EAAoD,UAAU,IAAI,CAAA,6BAAA,CAAA;AAAA,UAClE,KAAA,YAAiB,KAAA,GAAQ,KAAA,CAAM,OAAA,GAAU,OAAO,KAAK;AAAA,SACvD;AACA,QAAA,OAAO,IAAA,CAAK,gBAAA,CAAiB,SAAA,EAAW,UAAA,EAAY,YAAY,CAAA;AAAA,MAClE;AAGA,MAAA,MAAM,KAAA;AAAA,IACR;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,gBAAgB,SAAA,EAAsC;AACpD,IAAA,MAAM,OAAA,GAAU,IAAA,CAAK,SAAA,CAAU,kBAAA,CAAmB,UAAU,OAAO,CAAA;AAEnE,IAAA,OAAO,IAAA,CAAK,KAAA,CAAM,OAAA,GAAU,GAAG,CAAA;AAAA,EACjC;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,SAAA,CACZ,OAAA,EACA,WAAA,EACA,YAAA,EACiB;AACjB,IAAA,MAAM,YAAA,GAAe,sBAAsB,WAAW,CAAA;AACtD,IAAA,MAAM,mBAAmB,IAAA,CAAK,GAAA,CAAI,YAAA,EAAc,IAAA,CAAK,OAAO,gBAAgB,CAAA;AAE5E,IAAA,MAAM,qBAAA,GAAwB,IAAA,CAAK,MAAA,CAAO,iBAAA,GACtC,gGAAA,GACA,EAAA;AAEJ,IAAA,MAAM,MAAA,GAAS,CAAA,EAAG,YAAY,CAAA,EAAG,qBAAqB;;AAAA,qCAAA,EAEnB,gBAAgB,CAAA,SAAA,EAAY,gBAAA,GAAmB,CAAC,CAAA;;AAAA;AAAA;AAAA,EAIrF,OAAO;AAAA;;AAAA,oBAAA,CAAA;AAKL,IAAA,MAAM,QAAA,GAAW,MAAM,IAAA,CAAK,MAAA,CAAO,aAAa,QAAA,CAAS;AAAA,MACvD,KAAA,EAAO,IAAA,CAAK,MAAA,CAAO,KAAA,IAAS,aAAA;AAAA;AAAA,MAC5B,KAAA,EAAO,MAAA;AAAA,MACP,WAAA,EAAa,KAAK,MAAA,CAAO,WAAA;AAAA,MACzB,mBAAmB,gBAAA,GAAmB;AAAA;AAAA,KACvC,CAAA;AAED,IAAA,OAAO,SAAS,WAAA,IAAe,OAAA;AAAA,EACjC;AAAA;AAAA;AAAA;AAAA,EAKQ,gBAAA,CACN,SAAA,EACA,UAAA,EACA,YAAA,EACmB;AACnB,IAAA,MAAM,cAAc,YAAA,GAAe,CAAA;AACnC,IAAA,MAAM,SAAA,GACJ,UAAA,CAAW,SAAA,CAAU,CAAA,EAAG,WAAW,CAAA,GACnC,uDAAA;AAEF,IAAA,OAAO;AAAA,MACL,GAAG,SAAA;AAAA,MACH,OAAA,EAAS,SAAA;AAAA,MACT,QAAA,EAAU;AAAA,QACR,GAAG,SAAA,CAAU,QAAA;AAAA,QACb,SAAA,EAAW,IAAA;AAAA,QACX,eAAe,UAAA,CAAW,MAAA;AAAA,QAC1B,aAAa,SAAA,CAAU,MAAA;AAAA,QACvB,mBAAA,EAAqB;AAAA;AACvB,KACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,kBAAkB,SAAA,EAAoD;AAE5E,IAAA,IAAI,SAAA,CAAU,UAAU,WAAA,EAAa;AACnC,MAAA,OAAO,UAAU,QAAA,CAAS,WAAA;AAAA,IAC5B;AAGA,IAAA,MAAM,IAAA,GAAO,SAAA,CAAU,IAAA,CAAK,WAAA,EAAY;AAExC,IAAA,IACE,IAAA,CAAK,QAAA,CAAS,cAAc,CAAA,IAC5B,IAAA,CAAK,QAAA,CAAS,SAAS,CAAA,IACvB,IAAA,CAAK,QAAA,CAAS,UAAU,CAAA,EACxB;AACA,MAAA,OAAO,cAAA;AAAA,IACT;AAEA,IAAA,IAAI,IAAA,CAAK,QAAA,CAAS,QAAQ,CAAA,EAAG;AAC3B,MAAA,OAAO,gBAAA;AAAA,IACT;AAEA,IAAA,IAAI,KAAK,QAAA,CAAS,QAAQ,KAAK,IAAA,CAAK,QAAA,CAAS,OAAO,CAAA,EAAG;AACrD,MAAA,OAAO,gBAAA;AAAA,IACT;AAEA,IAAA,IAAI,KAAK,QAAA,CAAS,MAAM,KAAK,IAAA,CAAK,QAAA,CAAS,QAAQ,CAAA,EAAG;AACpD,MAAA,OAAO,aAAA;AAAA,IACT;AAEA,IAAA,OAAO,SAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKQ,iBAAiB,OAAA,EAA0B;AACjD,IAAA,IAAI,OAAO,YAAY,QAAA,EAAU;AAC/B,MAAA,OAAO,OAAA;AAAA,IACT;AAEA,IAAA,IAAI,KAAA,CAAM,OAAA,CAAQ,OAAO,CAAA,EAAG;AAE1B,MAAA,OAAO,OAAA,CACJ,GAAA,CAAI,CAAC,IAAA,KAAS;AACb,QAAA,IAAI,OAAO,IAAA,KAAS,QAAA,EAAU,OAAO,IAAA;AACrC,QAAA,IAAI,IAAA,IAAQ,OAAO,IAAA,KAAS,QAAA,EAAU;AAEpC,UAAA,IAAI,MAAA,IAAU,IAAA,IAAQ,SAAA,IAAa,IAAA,EAAM;AACvC,YAAA,OAAO,CAAA,CAAA,EAAI,IAAA,CAAK,IAAI,CAAA,GAAA,EAAM,KAAK,OAAO,CAAA,CAAA;AAAA,UACxC;AAEA,UAAA,IAAI,MAAA,IAAU,IAAA,IAAQ,QAAA,IAAY,IAAA,EAAM;AACtC,YAAA,OAAO,CAAA,CAAA,EAAI,KAAK,IAAI,CAAA,GAAA,EAAM,KAAK,SAAA,CAAU,IAAA,CAAK,MAAM,CAAC,CAAA,CAAA;AAAA,UACvD;AAAA,QACF;AACA,QAAA,OAAO,IAAA,CAAK,UAAU,IAAI,CAAA;AAAA,MAC5B,CAAC,CAAA,CACA,IAAA,CAAK,MAAM,CAAA;AAAA,IAChB;AAGA,IAAA,OAAO,IAAA,CAAK,SAAA,CAAU,OAAA,EAAS,IAAA,EAAM,CAAC,CAAA;AAAA,EACxC;AACF;;;ACpUO,IAAM,0BAAN,MAA2D;AAAA,EAIhE,YAAoB,SAAA,EAA4B;AAA5B,IAAA,IAAA,CAAA,SAAA,GAAA,SAAA;AAAA,EAA6B;AAAA,EAHxC,IAAA,GAAO,iBAAA;AAAA,EACP,QAAA,GAAW,CAAA;AAAA,EAIpB,WAAW,SAAA,EAAuC;AAChD,IAAA,OACE,UAAU,WAAA,KACT,SAAA,CAAU,UAAU,QAAA,KAAa,OAAA,IAAW,UAAU,IAAA,KAAS,cAAA,CAAA;AAAA,EAEpE;AAAA,EAEA,MAAM,OAAA,CAAQ,SAAA,EAA8B,YAAA,EAAkD;AAE5F,IAAA,IAAI,UAAU,QAAA,EAAU,KAAA,IAAS,OAAO,SAAA,CAAU,QAAA,CAAS,UAAU,UAAA,EAAY;AAC/E,MAAA,MAAM,aAAA,GAAgB,IAAA,CAAK,SAAA,CAAU,kBAAA,CAAmB,UAAU,OAAO,CAAA;AACzE,MAAA,MAAM,YAAA,GAAe,IAAA,CAAK,GAAA,CAAI,CAAA,EAAG,gBAAgB,YAAY,CAAA;AAG7D,MAAA,MAAM,YAAA,GAAe,SAAA,CAAU,QAAA,CAAS,YAAA,IAA0B,GAAA;AAClE,MAAA,MAAM,cAAA,GAAiB,IAAA,CAAK,IAAA,CAAK,YAAA,GAAe,YAAY,CAAA;AAE5D,MAAA,IAAI,iBAAiB,CAAA,EAAG;AAEtB,QAAA,MAAO,SAAA,CAAU,QAAA,CAAS,KAAA,CAA2C,cAAc,CAAA;AAGnF,QAAA,IAAI,UAAU,QAAA,CAAS,iBAAA,IAAqB,OAAO,SAAA,CAAU,QAAA,CAAS,sBAAsB,UAAA,EAAY;AACtG,UAAA,MAAM,cAAA,GAAiB,MAAO,SAAA,CAAU,QAAA,CAAS,iBAAA,EAA6C;AAE9F,UAAA,OAAO;AAAA,YACL,GAAG,SAAA;AAAA,YACH,OAAA,EAAS,cAAA;AAAA,YACT,QAAA,EAAU;AAAA,cACR,GAAG,SAAA,CAAU,QAAA;AAAA,cACb,OAAA,EAAS,IAAA;AAAA,cACT,YAAA,EAAc;AAAA;AAChB,WACF;AAAA,QACF;AAAA,MACF;AAAA,IACF;AAGA,IAAA,OAAO,SAAA;AAAA,EACT;AAAA,EAEA,gBAAgB,SAAA,EAAsC;AAEpD,IAAA,MAAM,YAAA,GAAe,SAAA,CAAU,QAAA,EAAU,YAAA,IAA0B,GAAA;AACnE,IAAA,OAAO,YAAA,GAAe,CAAA;AAAA,EACxB;AACF;;;ACjDO,IAAM,4BAAN,MAA2D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUhE,cAAA,CAAe,IAAA,EAAc,WAAA,GAAgC,OAAA,EAAiB;AAC5E,IAAA,IAAI,CAAC,IAAA,IAAQ,IAAA,CAAK,MAAA,KAAW,CAAA,EAAG;AAC9B,MAAA,OAAO,CAAA;AAAA,IACT;AAGA,IAAA,MAAM,gBAAgB,WAAA,KAAgB,MAAA,GAAS,CAAA,GAAI,WAAA,KAAgB,UAAU,CAAA,GAAI,GAAA;AACjF,IAAA,OAAO,IAAA,CAAK,IAAA,CAAK,IAAA,CAAK,MAAA,GAAS,aAAa,CAAA;AAAA,EAC9C;AAAA;AAAA;AAAA;AAAA,EAKA,kBAAA,CAAmB,IAAA,EAAe,WAAA,GAAgC,OAAA,EAAiB;AACjF,IAAA,IAAI,IAAA,KAAS,IAAA,IAAQ,IAAA,KAAS,MAAA,EAAW;AACvC,MAAA,OAAO,CAAA;AAAA,IACT;AAGA,IAAA,IAAI;AACF,MAAA,MAAM,UAAA,GAAa,IAAA,CAAK,SAAA,CAAU,IAAI,CAAA;AACtC,MAAA,OAAO,IAAA,CAAK,cAAA,CAAe,UAAA,EAAY,WAAW,CAAA;AAAA,IACpD,CAAA,CAAA,MAAQ;AAEN,MAAA,OAAO,GAAA;AAAA,IACT;AAAA,EACF;AACF;;;ACxCO,SAAS,gBAAgB,IAAA,EAA+B;AAC7D,EAAA,QAAQ,IAAA;AAAM,IACZ,KAAK,aAAA;AACH,MAAA,OAAO,IAAI,yBAAA,EAA0B;AAAA,IACvC,KAAK,UAAA;AAEH,MAAA,MAAM,IAAI,MAAM,oEAAoE,CAAA;AAAA,IACtF;AACE,MAAA,MAAM,IAAI,KAAA,CAAM,CAAA,yBAAA,EAA4B,IAAI,CAAA,CAAE,CAAA;AAAA;AAExD;;;ACoJO,IAAM,8BAAA,GAAkE;AAAA,EAC7E,WAAA,EAAa,EAAA;AAAA,EACb,SAAA,EAAW,IAAA;AAAA,EACX,kBAAA,EAAoB,gBAAA;AAAA,EACpB,mBAAA,EAAqB;AACvB;;;AC7JO,IAAM,yBAAN,MAAwD;AAAA,EACrD,WAA6B,EAAC;AAAA,EAC9B,YAAgF,EAAC;AAAA,EAEzF,MAAM,WAAW,OAAA,EAAwC;AACvD,IAAA,IAAA,CAAK,QAAA,CAAS,KAAK,OAAO,CAAA;AAAA,EAC5B;AAAA,EAEA,MAAM,WAAA,GAAyC;AAC7C,IAAA,OAAO,CAAC,GAAG,IAAA,CAAK,QAAQ,CAAA;AAAA,EAC1B;AAAA,EAEA,MAAM,kBAAkB,KAAA,EAA0C;AAChE,IAAA,OAAO,IAAA,CAAK,QAAA,CAAS,KAAA,CAAM,CAAC,KAAK,CAAA;AAAA,EACnC;AAAA,EAEA,MAAM,cAAc,EAAA,EAA2B;AAC7C,IAAA,MAAM,QAAQ,IAAA,CAAK,QAAA,CAAS,UAAU,CAAA,CAAA,KAAK,CAAA,CAAE,OAAO,EAAE,CAAA;AACtD,IAAA,IAAI,SAAS,CAAA,EAAG;AACd,MAAA,IAAA,CAAK,QAAA,CAAS,MAAA,CAAO,KAAA,EAAO,CAAC,CAAA;AAAA,IAC/B;AAAA,EACF;AAAA,EAEA,MAAM,gBAAgB,SAAA,EAAoC;AACxD,IAAA,MAAM,cAAA,GAAiB,KAAK,QAAA,CAAS,MAAA;AACrC,IAAA,IAAA,CAAK,WAAW,IAAA,CAAK,QAAA,CAAS,OAAO,CAAA,CAAA,KAAK,CAAA,CAAE,aAAa,SAAS,CAAA;AAClE,IAAA,OAAO,cAAA,GAAiB,KAAK,QAAA,CAAS,MAAA;AAAA,EACxC;AAAA,EAEA,MAAM,KAAA,GAAuB;AAC3B,IAAA,IAAA,CAAK,WAAW,EAAC;AACjB,IAAA,IAAA,CAAK,YAAY,EAAC;AAAA,EACpB;AAAA,EAEA,MAAM,QAAA,GAA4B;AAChC,IAAA,OAAO,KAAK,QAAA,CAAS,MAAA;AAAA,EACvB;AAAA,EAEA,MAAM,QAAA,GAA4C;AAChD,IAAA,OAAO;AAAA,MACL,OAAA,EAAS,CAAA;AAAA,MACT,QAAA,EAAU,CAAC,GAAG,IAAA,CAAK,QAAQ,CAAA;AAAA,MAC3B,SAAA,EAAW,CAAC,GAAG,IAAA,CAAK,SAAS;AAAA,KAC/B;AAAA,EACF;AAAA,EAEA,MAAM,aAAa,KAAA,EAA8C;AAC/D,IAAA,IAAA,CAAK,QAAA,GAAW,CAAC,GAAG,KAAA,CAAM,QAAQ,CAAA;AAClC,IAAA,IAAA,CAAK,SAAA,GAAY,MAAM,SAAA,GAAY,CAAC,GAAG,KAAA,CAAM,SAAS,IAAI,EAAC;AAAA,EAC7D;AACF;ACCA,SAASC,wBAAAA,GAAkC;AACzC,EAAA,MAAMpB,YAAW,OAAA,CAAQ,QAAA;AAEzB,EAAA,IAAIA,cAAa,OAAA,EAAS;AAExB,IAAA,MAAM,OAAA,GAAU,OAAA,CAAQ,GAAA,CAAI,OAAA,IAAW,QAAQ,GAAA,CAAI,YAAA;AACnD,IAAA,IAAI,OAAA,EAAS;AACX,MAAA,OAAOQ,IAAAA,CAAK,OAAA,EAAS,WAAA,EAAa,QAAQ,CAAA;AAAA,IAC5C;AAAA,EACF;AAGA,EAAA,OAAOA,IAAAA,CAAKC,OAAAA,EAAQ,EAAG,YAAA,EAAc,QAAQ,CAAA;AAC/C;AAMA,SAAS,WAAW,EAAA,EAAoB;AACtC,EAAA,OAAO,EAAA,CACJ,OAAA,CAAQ,iBAAA,EAAmB,GAAG,EAC9B,OAAA,CAAQ,KAAA,EAAO,GAAG,CAAA,CAClB,OAAA,CAAQ,QAAA,EAAU,EAAE,CAAA,CACpB,aAAY,IACV,SAAA;AACP;AAKA,IAAM,cAAA,GAAiB,8BAAA;AAKhB,IAAM,qBAAN,MAAoD;AAAA,EACxC,OAAA;AAAA,EACA,iBAAA;AAAA,EACA,SAAA;AAAA,EACA,WAAA;AAAA,EACT,KAAA,GAA6B,IAAA;AAAA,EAErC,YAAY,MAAA,EAAkC;AAC5C,IAAA,IAAA,CAAK,UAAU,MAAA,CAAO,OAAA;AACtB,IAAA,MAAM,gBAAA,GAAmB,UAAA,CAAW,MAAA,CAAO,OAAO,CAAA;AAClD,IAAA,MAAM,OAAA,GAAU,MAAA,CAAO,aAAA,IAAiBW,wBAAAA,EAAwB;AAChE,IAAA,IAAA,CAAK,WAAA,GAAc,OAAO,WAAA,IAAe,IAAA;AAGzC,IAAA,IAAA,CAAK,iBAAA,GAAoBZ,IAAAA,CAAK,OAAA,EAAS,gBAAA,EAAkB,UAAU,CAAA;AACnE,IAAA,IAAA,CAAK,SAAA,GAAYA,IAAAA,CAAK,IAAA,CAAK,iBAAA,EAAmB,aAAa,CAAA;AAAA,EAC7D;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,IAAA,CACJ,SAAA,EACA,KAAA,EACA,QAAA,EACe;AACf,IAAA,MAAM,KAAK,eAAA,EAAgB;AAE3B,IAAA,MAAM,GAAA,GAAA,iBAAM,IAAI,IAAA,EAAK,EAAE,WAAA,EAAY;AACnC,IAAA,MAAM,kBAAA,GAAqB,WAAW,SAAS,CAAA;AAC/C,IAAA,MAAM,QAAA,GAAW,IAAA,CAAK,WAAA,CAAY,kBAAkB,CAAA;AAGpD,IAAA,IAAI,SAAA,GAAY,GAAA;AAChB,IAAA,MAAM,QAAA,GAAW,MAAM,IAAA,CAAK,OAAA,CAAQ,kBAAkB,CAAA;AACtD,IAAA,IAAI,QAAA,EAAU;AACZ,MAAA,SAAA,GAAY,QAAA,CAAS,SAAA;AAAA,IACvB;AAGA,IAAA,MAAM,aAAA,GAAsC;AAAA,MAC1C,OAAA,EAAS,cAAA;AAAA,MACT,SAAA;AAAA,MACA,SAAA;AAAA,MACA,WAAA,EAAa,GAAA;AAAA,MACb,KAAA;AAAA,MACA,QAAA,EAAU,YAAY;AAAC,KACzB;AAGA,IAAA,MAAM,IAAA,GAAO,IAAA,CAAK,WAAA,GACd,IAAA,CAAK,SAAA,CAAU,aAAA,EAAe,IAAA,EAAM,CAAC,CAAA,GACrC,IAAA,CAAK,SAAA,CAAU,aAAa,CAAA;AAEhC,IAAA,MAAM,QAAA,GAAW,GAAG,QAAQ,CAAA,IAAA,CAAA;AAC5B,IAAA,IAAI;AACF,MAAA,MAAM/B,QAAAA,CAAG,SAAA,CAAU,QAAA,EAAU,IAAA,EAAM,OAAO,CAAA;AAC1C,MAAA,MAAMA,QAAAA,CAAG,MAAA,CAAO,QAAA,EAAU,QAAQ,CAAA;AAAA,IACpC,SAAS,KAAA,EAAO;AAEd,MAAA,IAAI;AACF,QAAA,MAAMA,QAAAA,CAAG,OAAO,QAAQ,CAAA;AAAA,MAC1B,CAAA,CAAA,MAAQ;AAAA,MAER;AACA,MAAA,MAAM,KAAA;AAAA,IACR;AAGA,IAAA,MAAM,IAAA,CAAK,YAAY,aAAa,CAAA;AAAA,EACtC;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,KAAK,SAAA,EAAyD;AAClE,IAAA,MAAM,kBAAA,GAAqB,WAAW,SAAS,CAAA;AAC/C,IAAA,OAAO,IAAA,CAAK,QAAQ,kBAAkB,CAAA;AAAA,EACxC;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,OAAO,SAAA,EAAkC;AAC7C,IAAA,MAAM,kBAAA,GAAqB,WAAW,SAAS,CAAA;AAC/C,IAAA,MAAM,QAAA,GAAW,IAAA,CAAK,WAAA,CAAY,kBAAkB,CAAA;AAEpD,IAAA,IAAI;AACF,MAAA,MAAMA,QAAAA,CAAG,OAAO,QAAQ,CAAA;AAAA,IAC1B,SAAS,KAAA,EAAgB;AACvB,MAAA,IAAI,iBAAiB,KAAA,IAAS,MAAA,IAAU,KAAA,IAAU,KAAA,CAAgC,SAAS,QAAA,EAAU;AACnG,QAAA,MAAM,KAAA;AAAA,MACR;AAAA,IAEF;AAGA,IAAA,MAAM,IAAA,CAAK,gBAAgB,SAAS,CAAA;AAAA,EACtC;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,OAAO,SAAA,EAAqC;AAChD,IAAA,MAAM,kBAAA,GAAqB,WAAW,SAAS,CAAA;AAC/C,IAAA,MAAM,QAAA,GAAW,IAAA,CAAK,WAAA,CAAY,kBAAkB,CAAA;AAEpD,IAAA,IAAI;AACF,MAAA,MAAMA,QAAAA,CAAG,OAAO,QAAQ,CAAA;AACxB,MAAA,OAAO,IAAA;AAAA,IACT,CAAA,CAAA,MAAQ;AACN,MAAA,OAAO,KAAA;AAAA,IACT;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,KAAK,OAAA,EAAuE;AAChF,IAAA,MAAM,KAAA,GAAQ,MAAM,IAAA,CAAK,SAAA,EAAU;AACnC,IAAA,IAAI,OAAA,GAAU,CAAC,GAAG,KAAA,CAAM,QAAQ,CAAA;AAGhC,IAAA,IAAI,OAAA,EAAS,IAAA,IAAQ,OAAA,CAAQ,IAAA,CAAK,SAAS,CAAA,EAAG;AAC5C,MAAA,OAAA,GAAU,OAAA,CAAQ,OAAO,CAAA,CAAA,KAAK;AAC5B,QAAA,MAAM,SAAA,GAAY,CAAA,CAAE,QAAA,CAAS,IAAA,IAAQ,EAAC;AACtC,QAAA,OAAO,QAAQ,IAAA,CAAM,IAAA,CAAK,OAAK,SAAA,CAAU,QAAA,CAAS,CAAC,CAAC,CAAA;AAAA,MACtD,CAAC,CAAA;AAAA,IACH;AAEA,IAAA,IAAI,SAAS,YAAA,EAAc;AACzB,MAAA,MAAM,KAAA,GAAQ,OAAA,CAAQ,YAAA,CAAa,OAAA,EAAQ;AAC3C,MAAA,OAAA,GAAU,OAAA,CAAQ,MAAA,CAAO,CAAA,CAAA,KAAK,IAAI,IAAA,CAAK,EAAE,SAAS,CAAA,CAAE,OAAA,EAAQ,IAAK,KAAK,CAAA;AAAA,IACxE;AAEA,IAAA,IAAI,SAAS,aAAA,EAAe;AAC1B,MAAA,MAAM,MAAA,GAAS,OAAA,CAAQ,aAAA,CAAc,OAAA,EAAQ;AAC7C,MAAA,OAAA,GAAU,OAAA,CAAQ,MAAA,CAAO,CAAA,CAAA,KAAK,IAAI,IAAA,CAAK,EAAE,SAAS,CAAA,CAAE,OAAA,EAAQ,IAAK,MAAM,CAAA;AAAA,IACzE;AAEA,IAAA,IAAI,SAAS,UAAA,EAAY;AACvB,MAAA,MAAM,KAAA,GAAQ,OAAA,CAAQ,UAAA,CAAW,OAAA,EAAQ;AACzC,MAAA,OAAA,GAAU,OAAA,CAAQ,MAAA,CAAO,CAAA,CAAA,KAAK,IAAI,IAAA,CAAK,EAAE,WAAW,CAAA,CAAE,OAAA,EAAQ,IAAK,KAAK,CAAA;AAAA,IAC1E;AAEA,IAAA,IAAI,SAAS,WAAA,EAAa;AACxB,MAAA,MAAM,MAAA,GAAS,OAAA,CAAQ,WAAA,CAAY,OAAA,EAAQ;AAC3C,MAAA,OAAA,GAAU,OAAA,CAAQ,MAAA,CAAO,CAAA,CAAA,KAAK,IAAI,IAAA,CAAK,EAAE,WAAW,CAAA,CAAE,OAAA,EAAQ,IAAK,MAAM,CAAA;AAAA,IAC3E;AAGA,IAAA,OAAA,CAAQ,IAAA;AAAA,MAAK,CAAC,CAAA,EAAG,CAAA,KACf,IAAI,KAAK,CAAA,CAAE,WAAW,CAAA,CAAE,OAAA,KAAY,IAAI,IAAA,CAAK,CAAA,CAAE,WAAW,EAAE,OAAA;AAAQ,KACtE;AAGA,IAAA,IAAI,SAAS,MAAA,EAAQ;AACnB,MAAA,OAAA,GAAU,OAAA,CAAQ,KAAA,CAAM,OAAA,CAAQ,MAAM,CAAA;AAAA,IACxC;AACA,IAAA,IAAI,SAAS,KAAA,EAAO;AAClB,MAAA,OAAA,GAAU,OAAA,CAAQ,KAAA,CAAM,CAAA,EAAG,OAAA,CAAQ,KAAK,CAAA;AAAA,IAC1C;AAGA,IAAA,OAAO,OAAA,CAAQ,IAAI,CAAA,CAAA,MAAM;AAAA,MACvB,WAAW,CAAA,CAAE,SAAA;AAAA,MACb,SAAA,EAAW,IAAI,IAAA,CAAK,CAAA,CAAE,SAAS,CAAA;AAAA,MAC/B,WAAA,EAAa,IAAI,IAAA,CAAK,CAAA,CAAE,WAAW,CAAA;AAAA,MACnC,cAAc,CAAA,CAAE,YAAA;AAAA,MAChB,kBAAkB,CAAA,CAAE,gBAAA;AAAA,MACpB,UAAU,CAAA,CAAE;AAAA,KACd,CAAE,CAAA;AAAA,EACJ;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,cAAA,CACJ,SAAA,EACA,QAAA,EACe;AACf,IAAA,MAAM,MAAA,GAAS,MAAM,IAAA,CAAK,IAAA,CAAK,SAAS,CAAA;AACxC,IAAA,IAAI,CAAC,MAAA,EAAQ;AACX,MAAA,MAAM,IAAI,KAAA,CAAM,CAAA,SAAA,EAAY,SAAS,CAAA,WAAA,CAAa,CAAA;AAAA,IACpD;AAGA,IAAA,MAAA,CAAO,WAAW,EAAE,GAAG,MAAA,CAAO,QAAA,EAAU,GAAG,QAAA,EAAS;AACpD,IAAA,MAAA,CAAO,WAAA,GAAA,iBAAc,IAAI,IAAA,EAAK,EAAE,WAAA,EAAY;AAG5C,IAAA,MAAM,kBAAA,GAAqB,WAAW,SAAS,CAAA;AAC/C,IAAA,MAAM,QAAA,GAAW,IAAA,CAAK,WAAA,CAAY,kBAAkB,CAAA;AACpD,IAAA,MAAM,IAAA,GAAO,IAAA,CAAK,WAAA,GACd,IAAA,CAAK,SAAA,CAAU,MAAA,EAAQ,IAAA,EAAM,CAAC,CAAA,GAC9B,IAAA,CAAK,SAAA,CAAU,MAAM,CAAA;AAEzB,IAAA,MAAMA,QAAAA,CAAG,SAAA,CAAU,QAAA,EAAU,IAAA,EAAM,OAAO,CAAA;AAG1C,IAAA,MAAM,IAAA,CAAK,YAAY,MAAM,CAAA;AAAA,EAC/B;AAAA;AAAA;AAAA;AAAA,EAKA,OAAA,GAAkB;AAChB,IAAA,OAAO,IAAA,CAAK,iBAAA;AAAA,EACd;AAAA;AAAA;AAAA;AAAA,EAKA,UAAA,GAAqB;AACnB,IAAA,OAAO,IAAA,CAAK,OAAA;AAAA,EACd;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,MAAM,YAAA,GAA8B;AAClC,IAAA,MAAM,KAAK,eAAA,EAAgB;AAE3B,IAAA,MAAM,KAAA,GAAQ,MAAMA,QAAAA,CAAG,OAAA,CAAQ,KAAK,iBAAiB,CAAA;AACrD,IAAA,MAAM,YAAA,GAAe,KAAA,CAAM,MAAA,CAAO,CAAA,CAAA,KAAK,CAAA,CAAE,QAAA,CAAS,OAAO,CAAA,IAAK,CAAC,CAAA,CAAE,UAAA,CAAW,GAAG,CAAC,CAAA;AAEhF,IAAA,MAAM,UAA+B,EAAC;AAEtC,IAAA,KAAA,MAAW,QAAQ,YAAA,EAAc;AAC/B,MAAA,IAAI;AACF,QAAA,MAAM,QAAA,GAAW+B,IAAAA,CAAK,IAAA,CAAK,iBAAA,EAAmB,IAAI,CAAA;AAClD,QAAA,MAAM,IAAA,GAAO,MAAM/B,QAAAA,CAAG,QAAA,CAAS,UAAU,OAAO,CAAA;AAChD,QAAA,MAAM,MAAA,GAAS,IAAA,CAAK,KAAA,CAAM,IAAI,CAAA;AAC9B,QAAA,OAAA,CAAQ,IAAA,CAAK,IAAA,CAAK,kBAAA,CAAmB,MAAM,CAAC,CAAA;AAAA,MAC9C,CAAA,CAAA,MAAQ;AAAA,MAER;AAAA,IACF;AAEA,IAAA,IAAA,CAAK,KAAA,GAAQ;AAAA,MACX,OAAA,EAAS,CAAA;AAAA,MACT,SAAS,IAAA,CAAK,OAAA;AAAA,MACd,QAAA,EAAU,OAAA;AAAA,MACV,WAAA,EAAA,iBAAa,IAAI,IAAA,EAAK,EAAE,WAAA;AAAY,KACtC;AAEA,IAAA,MAAM,KAAK,SAAA,EAAU;AAAA,EACvB;AAAA;AAAA;AAAA;AAAA,EAMQ,YAAY,kBAAA,EAAoC;AACtD,IAAA,OAAO+B,IAAAA,CAAK,IAAA,CAAK,iBAAA,EAAmB,CAAA,EAAG,kBAAkB,CAAA,KAAA,CAAO,CAAA;AAAA,EAClE;AAAA,EAEA,MAAc,eAAA,GAAiC;AAC7C,IAAA,IAAI;AACF,MAAA,MAAM/B,SAAG,KAAA,CAAM,IAAA,CAAK,mBAAmB,EAAE,SAAA,EAAW,MAAM,CAAA;AAAA,IAC5D,SAAS,KAAA,EAAgB;AACvB,MAAA,IAAI,iBAAiB,KAAA,IAAS,MAAA,IAAU,KAAA,IAAU,KAAA,CAAgC,SAAS,QAAA,EAAU;AACnG,QAAA,MAAM,KAAA;AAAA,MACR;AAAA,IACF;AAAA,EACF;AAAA,EAEA,MAAc,QAAQ,kBAAA,EAAkE;AACtF,IAAA,MAAM,QAAA,GAAW,IAAA,CAAK,WAAA,CAAY,kBAAkB,CAAA;AAEpD,IAAA,IAAI;AACF,MAAA,MAAM,IAAA,GAAO,MAAMA,QAAAA,CAAG,QAAA,CAAS,UAAU,OAAO,CAAA;AAChD,MAAA,OAAO,IAAA,CAAK,MAAM,IAAI,CAAA;AAAA,IACxB,SAAS,KAAA,EAAgB;AACvB,MAAA,IAAI,iBAAiB,KAAA,IAAS,MAAA,IAAU,KAAA,IAAU,KAAA,CAAgC,SAAS,QAAA,EAAU;AACnG,QAAA,OAAO,IAAA;AAAA,MACT;AAEA,MAAA,IAAI,iBAAiB,WAAA,EAAa;AAChC,QAAA,OAAA,CAAQ,IAAA,CAAK,CAAA,wBAAA,EAA2B,QAAQ,CAAA,CAAE,CAAA;AAClD,QAAA,OAAO,IAAA;AAAA,MACT;AACA,MAAA,MAAM,KAAA;AAAA,IACR;AAAA,EACF;AAAA,EAEA,MAAc,SAAA,GAAmC;AAC/C,IAAA,IAAI,KAAK,KAAA,EAAO;AACd,MAAA,OAAO,IAAA,CAAK,KAAA;AAAA,IACd;AAEA,IAAA,IAAI;AACF,MAAA,MAAM,OAAO,MAAMA,QAAAA,CAAG,QAAA,CAAS,IAAA,CAAK,WAAW,OAAO,CAAA;AACtD,MAAA,IAAA,CAAK,KAAA,GAAQ,IAAA,CAAK,KAAA,CAAM,IAAI,CAAA;AAC5B,MAAA,OAAO,IAAA,CAAK,KAAA;AAAA,IACd,SAAS,KAAA,EAAgB;AACvB,MAAA,IAAI,iBAAiB,KAAA,IAAS,MAAA,IAAU,KAAA,IAAU,KAAA,CAAgC,SAAS,QAAA,EAAU;AAEnG,QAAA,IAAA,CAAK,KAAA,GAAQ;AAAA,UACX,OAAA,EAAS,CAAA;AAAA,UACT,SAAS,IAAA,CAAK,OAAA;AAAA,UACd,UAAU,EAAC;AAAA,UACX,WAAA,EAAA,iBAAa,IAAI,IAAA,EAAK,EAAE,WAAA;AAAY,SACtC;AACA,QAAA,OAAO,IAAA,CAAK,KAAA;AAAA,MACd;AACA,MAAA,MAAM,KAAA;AAAA,IACR;AAAA,EACF;AAAA,EAEA,MAAc,SAAA,GAA2B;AACvC,IAAA,IAAI,CAAC,KAAK,KAAA,EAAO;AAEjB,IAAA,MAAM,KAAK,eAAA,EAAgB;AAC3B,IAAA,IAAA,CAAK,KAAA,CAAM,WAAA,GAAA,iBAAc,IAAI,IAAA,IAAO,WAAA,EAAY;AAChD,IAAA,MAAM,IAAA,GAAO,IAAA,CAAK,WAAA,GACd,IAAA,CAAK,SAAA,CAAU,IAAA,CAAK,KAAA,EAAO,IAAA,EAAM,CAAC,CAAA,GAClC,IAAA,CAAK,SAAA,CAAU,KAAK,KAAK,CAAA;AAE7B,IAAA,MAAMA,QAAAA,CAAG,SAAA,CAAU,IAAA,CAAK,SAAA,EAAW,MAAM,OAAO,CAAA;AAAA,EAClD;AAAA,EAEA,MAAc,YAAY,MAAA,EAA6C;AACrE,IAAA,MAAM,KAAA,GAAQ,MAAM,IAAA,CAAK,SAAA,EAAU;AACnC,IAAA,MAAM,KAAA,GAAQ,IAAA,CAAK,kBAAA,CAAmB,MAAM,CAAA;AAE5C,IAAA,MAAM,WAAA,GAAc,MAAM,QAAA,CAAS,SAAA,CAAU,OAAK,CAAA,CAAE,SAAA,KAAc,OAAO,SAAS,CAAA;AAClF,IAAA,IAAI,eAAe,CAAA,EAAG;AACpB,MAAA,KAAA,CAAM,QAAA,CAAS,WAAW,CAAA,GAAI,KAAA;AAAA,IAChC,CAAA,MAAO;AACL,MAAA,KAAA,CAAM,QAAA,CAAS,KAAK,KAAK,CAAA;AAAA,IAC3B;AAEA,IAAA,MAAM,KAAK,SAAA,EAAU;AAAA,EACvB;AAAA,EAEA,MAAc,gBAAgB,SAAA,EAAkC;AAC9D,IAAA,MAAM,KAAA,GAAQ,MAAM,IAAA,CAAK,SAAA,EAAU;AACnC,IAAA,KAAA,CAAM,WAAW,KAAA,CAAM,QAAA,CAAS,OAAO,CAAA,CAAA,KAAK,CAAA,CAAE,cAAc,SAAS,CAAA;AACrE,IAAA,MAAM,KAAK,SAAA,EAAU;AAAA,EACvB;AAAA,EAEQ,mBAAmB,MAAA,EAAiD;AAC1E,IAAA,OAAO;AAAA,MACL,WAAW,MAAA,CAAO,SAAA;AAAA,MAClB,WAAW,MAAA,CAAO,SAAA;AAAA,MAClB,aAAa,MAAA,CAAO,WAAA;AAAA,MACpB,YAAA,EAAc,MAAA,CAAO,KAAA,CAAM,IAAA,EAAM,SAAS,MAAA,IAAU,CAAA;AAAA,MACpD,gBAAA,EAAkB,MAAA,CAAO,KAAA,CAAM,MAAA,EAAQ,SAAS,MAAA,IAAU,CAAA;AAAA,MAC1D,UAAU,MAAA,CAAO;AAAA,KACnB;AAAA,EACF;AACF;AAwBO,SAAS,wBAAA,CACd,SACA,OAAA,EACoB;AACpB,EAAA,OAAO,IAAI,kBAAA,CAAmB,EAAE,OAAA,EAAS,GAAG,SAAS,CAAA;AACvD;ACvaA,SAAS2C,wBAAAA,GAAkC;AACzC,EAAA,MAAMpB,YAAW,OAAA,CAAQ,QAAA;AAEzB,EAAA,IAAIA,cAAa,OAAA,EAAS;AACxB,IAAA,MAAM,OAAA,GAAU,OAAA,CAAQ,GAAA,CAAI,OAAA,IAAW,QAAQ,GAAA,CAAI,YAAA;AACnD,IAAA,IAAI,OAAA,EAAS;AACX,MAAA,OAAOQ,IAAAA,CAAK,OAAA,EAAS,WAAA,EAAa,QAAQ,CAAA;AAAA,IAC5C;AAAA,EACF;AAEA,EAAA,OAAOA,IAAAA,CAAKC,OAAAA,EAAQ,EAAG,YAAA,EAAc,QAAQ,CAAA;AAC/C;AAKA,SAASY,iBAAgB,OAAA,EAAyB;AAChD,EAAA,OAAO,OAAA,CACJ,OAAA,CAAQ,iBAAA,EAAmB,GAAG,EAC9B,OAAA,CAAQ,KAAA,EAAO,GAAG,CAAA,CAClB,OAAA,CAAQ,QAAA,EAAU,EAAE,CAAA,CACpB,aAAY,IACV,SAAA;AACP;AAKO,IAAM,6BAAN,MAAoE;AAAA,EACxD,aAAA;AAAA,EACA,SAAA;AAAA,EACA,WAAA;AAAA,EACT,KAAA,GAAgC,IAAA;AAAA,EAExC,WAAA,CAAY,MAAA,GAA2C,EAAC,EAAG;AACzD,IAAA,IAAA,CAAK,aAAA,GAAgB,MAAA,CAAO,aAAA,IAAiBD,wBAAAA,EAAwB;AACrE,IAAA,IAAA,CAAK,WAAA,GAAc,OAAO,WAAA,IAAe,IAAA;AACzC,IAAA,IAAA,CAAK,SAAA,GAAYZ,IAAAA,CAAK,IAAA,CAAK,aAAA,EAAe,oBAAoB,CAAA;AAAA,EAChE;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,KAAK,UAAA,EAAkD;AAC3D,IAAA,MAAM,WAAA,GAAca,gBAAAA,CAAgB,UAAA,CAAW,OAAO,CAAA;AACtD,IAAA,MAAM,QAAA,GAAWb,IAAAA,CAAK,IAAA,CAAK,aAAA,EAAe,WAAW,CAAA;AACrD,IAAA,MAAM,QAAA,GAAWA,IAAAA,CAAK,QAAA,EAAU,iBAAiB,CAAA;AAGjD,IAAA,MAAM,IAAA,CAAK,gBAAgB,QAAQ,CAAA;AAGnC,IAAA,MAAM,GAAA,GAAA,iBAAM,IAAI,IAAA,EAAK,EAAE,WAAA,EAAY;AACnC,IAAA,IAAI,CAAC,WAAW,SAAA,EAAW;AAEzB,MAAA,MAAM,QAAA,GAAW,MAAM,IAAA,CAAK,OAAA,CAAQ,WAAW,CAAA;AAC/C,MAAA,UAAA,CAAW,SAAA,GAAY,UAAU,SAAA,IAAa,GAAA;AAAA,IAChD;AACA,IAAA,UAAA,CAAW,SAAA,GAAY,GAAA;AACvB,IAAA,UAAA,CAAW,OAAA,GAAU,+BAAA;AAGrB,IAAA,MAAM,IAAA,GAAO,IAAA,CAAK,WAAA,GACd,IAAA,CAAK,SAAA,CAAU,UAAA,EAAY,IAAA,EAAM,CAAC,CAAA,GAClC,IAAA,CAAK,SAAA,CAAU,UAAU,CAAA;AAE7B,IAAA,MAAM,QAAA,GAAW,GAAG,QAAQ,CAAA,IAAA,CAAA;AAC5B,IAAA,IAAI;AACF,MAAA,MAAM/B,QAAAA,CAAG,SAAA,CAAU,QAAA,EAAU,IAAA,EAAM,OAAO,CAAA;AAC1C,MAAA,MAAMA,QAAAA,CAAG,MAAA,CAAO,QAAA,EAAU,QAAQ,CAAA;AAAA,IACpC,SAAS,KAAA,EAAO;AACd,MAAA,IAAI;AACF,QAAA,MAAMA,QAAAA,CAAG,OAAO,QAAQ,CAAA;AAAA,MAC1B,CAAA,CAAA,MAAQ;AAAA,MAER;AACA,MAAA,MAAM,KAAA;AAAA,IACR;AAGA,IAAA,MAAM,IAAA,CAAK,YAAY,UAAU,CAAA;AAAA,EACnC;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,KAAK,OAAA,EAAwD;AACjE,IAAA,MAAM,WAAA,GAAc4C,iBAAgB,OAAO,CAAA;AAC3C,IAAA,OAAO,IAAA,CAAK,QAAQ,WAAW,CAAA;AAAA,EACjC;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,OAAO,OAAA,EAAgC;AAC3C,IAAA,MAAM,WAAA,GAAcA,iBAAgB,OAAO,CAAA;AAC3C,IAAA,MAAM,QAAA,GAAWb,IAAAA,CAAK,IAAA,CAAK,aAAA,EAAe,WAAW,CAAA;AACrD,IAAA,MAAM,QAAA,GAAWA,IAAAA,CAAK,QAAA,EAAU,iBAAiB,CAAA;AAEjD,IAAA,IAAI;AACF,MAAA,MAAM/B,QAAAA,CAAG,OAAO,QAAQ,CAAA;AAAA,IAC1B,SAAS,KAAA,EAAgB;AACvB,MAAA,IAAI,iBAAiB,KAAA,IAAS,MAAA,IAAU,KAAA,IAAU,KAAA,CAAgC,SAAS,QAAA,EAAU;AACnG,QAAA,MAAM,KAAA;AAAA,MACR;AAAA,IACF;AAGA,IAAA,MAAM,IAAA,CAAK,gBAAgB,OAAO,CAAA;AAAA,EACpC;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,OAAO,OAAA,EAAmC;AAC9C,IAAA,MAAM,WAAA,GAAc4C,iBAAgB,OAAO,CAAA;AAC3C,IAAA,MAAM,QAAA,GAAWb,IAAAA,CAAK,IAAA,CAAK,aAAA,EAAe,aAAa,iBAAiB,CAAA;AAExE,IAAA,IAAI;AACF,MAAA,MAAM/B,QAAAA,CAAG,OAAO,QAAQ,CAAA;AACxB,MAAA,OAAO,IAAA;AAAA,IACT,CAAA,CAAA,MAAQ;AACN,MAAA,OAAO,KAAA;AAAA,IACT;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,KAAK,OAAA,EAAyE;AAClF,IAAA,MAAM,KAAA,GAAQ,MAAM,IAAA,CAAK,SAAA,EAAU;AACnC,IAAA,IAAI,OAAA,GAAU,CAAC,GAAG,KAAA,CAAM,MAAM,CAAA;AAG9B,IAAA,IAAI,SAAS,SAAA,EAAW;AACtB,MAAA,OAAA,GAAU,QAAQ,MAAA,CAAO,CAAA,CAAA,KAAK,CAAA,CAAE,SAAA,KAAc,QAAQ,SAAS,CAAA;AAAA,IACjE;AAEA,IAAA,IAAI,OAAA,EAAS,IAAA,IAAQ,OAAA,CAAQ,IAAA,CAAK,SAAS,CAAA,EAAG;AAC5C,MAAA,OAAA,GAAU,OAAA,CAAQ,OAAO,CAAA,CAAA,KAAK;AAC5B,QAAA,MAAM,SAAA,GAAY,CAAA,CAAE,QAAA,EAAU,IAAA,IAAQ,EAAC;AACvC,QAAA,OAAO,QAAQ,IAAA,CAAM,IAAA,CAAK,OAAK,SAAA,CAAU,QAAA,CAAS,CAAC,CAAC,CAAA;AAAA,MACtD,CAAC,CAAA;AAAA,IACH;AAGA,IAAA,OAAA,CAAQ,IAAA;AAAA,MAAK,CAAC,CAAA,EAAG,CAAA,KACf,IAAI,KAAK,CAAA,CAAE,SAAS,CAAA,CAAE,OAAA,KAAY,IAAI,IAAA,CAAK,CAAA,CAAE,SAAS,EAAE,OAAA;AAAQ,KAClE;AAGA,IAAA,IAAI,SAAS,MAAA,EAAQ;AACnB,MAAA,OAAA,GAAU,OAAA,CAAQ,KAAA,CAAM,OAAA,CAAQ,MAAM,CAAA;AAAA,IACxC;AACA,IAAA,IAAI,SAAS,KAAA,EAAO;AAClB,MAAA,OAAA,GAAU,OAAA,CAAQ,KAAA,CAAM,CAAA,EAAG,OAAA,CAAQ,KAAK,CAAA;AAAA,IAC1C;AAGA,IAAA,OAAO,OAAA,CAAQ,IAAI,CAAA,CAAA,MAAM;AAAA,MACvB,SAAS,CAAA,CAAE,OAAA;AAAA,MACX,MAAM,CAAA,CAAE,IAAA;AAAA,MACR,WAAW,CAAA,CAAE,SAAA;AAAA,MACb,OAAO,CAAA,CAAE,KAAA;AAAA,MACT,SAAA,EAAW,IAAI,IAAA,CAAK,CAAA,CAAE,SAAS,CAAA;AAAA,MAC/B,SAAA,EAAW,IAAI,IAAA,CAAK,CAAA,CAAE,SAAS,CAAA;AAAA,MAC/B,UAAU,CAAA,CAAE;AAAA,KACd,CAAE,CAAA;AAAA,EACJ;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,cAAA,CACJ,OAAA,EACA,QAAA,EACe;AACf,IAAA,MAAM,UAAA,GAAa,MAAM,IAAA,CAAK,IAAA,CAAK,OAAO,CAAA;AAC1C,IAAA,IAAI,CAAC,UAAA,EAAY;AACf,MAAA,MAAM,IAAI,KAAA,CAAM,CAAA,OAAA,EAAU,OAAO,CAAA,WAAA,CAAa,CAAA;AAAA,IAChD;AAEA,IAAA,UAAA,CAAW,WAAW,EAAE,GAAG,UAAA,CAAW,QAAA,EAAU,GAAG,QAAA,EAAS;AAC5D,IAAA,MAAM,IAAA,CAAK,KAAK,UAAU,CAAA;AAAA,EAC5B;AAAA;AAAA;AAAA;AAAA,EAKA,OAAA,GAAkB;AAChB,IAAA,OAAO,IAAA,CAAK,aAAA;AAAA,EACd;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,YAAA,GAA8B;AAClC,IAAA,MAAM,IAAA,CAAK,eAAA,CAAgB,IAAA,CAAK,aAAa,CAAA;AAE7C,IAAA,MAAM,OAAA,GAAU,MAAMA,QAAAA,CAAG,OAAA,CAAQ,KAAK,aAAA,EAAe,EAAE,aAAA,EAAe,IAAA,EAAM,CAAA;AAC5E,IAAA,MAAM,SAAA,GAAY,OAAA,CAAQ,MAAA,CAAO,CAAA,CAAA,KAAK,CAAA,CAAE,WAAA,EAAY,IAAK,CAAC,CAAA,CAAE,IAAA,CAAK,UAAA,CAAW,GAAG,CAAC,CAAA;AAEhF,IAAA,MAAM,eAAuC,EAAC;AAE9C,IAAA,KAAA,MAAW,OAAO,SAAA,EAAW;AAC3B,MAAA,IAAI;AACF,QAAA,MAAM,WAAW+B,IAAAA,CAAK,IAAA,CAAK,aAAA,EAAe,GAAA,CAAI,MAAM,iBAAiB,CAAA;AACrE,QAAA,MAAM,IAAA,GAAO,MAAM/B,QAAAA,CAAG,QAAA,CAAS,UAAU,OAAO,CAAA;AAChD,QAAA,MAAM,UAAA,GAAa,IAAA,CAAK,KAAA,CAAM,IAAI,CAAA;AAClC,QAAA,YAAA,CAAa,IAAA,CAAK,IAAA,CAAK,sBAAA,CAAuB,UAAU,CAAC,CAAA;AAAA,MAC3D,CAAA,CAAA,MAAQ;AAAA,MAER;AAAA,IACF;AAEA,IAAA,IAAA,CAAK,KAAA,GAAQ;AAAA,MACX,OAAA,EAAS,CAAA;AAAA,MACT,MAAA,EAAQ,YAAA;AAAA,MACR,WAAA,EAAA,iBAAa,IAAI,IAAA,EAAK,EAAE,WAAA;AAAY,KACtC;AAEA,IAAA,MAAM,KAAK,SAAA,EAAU;AAAA,EACvB;AAAA;AAAA;AAAA;AAAA,EAMA,MAAc,gBAAgB,GAAA,EAA4B;AACxD,IAAA,IAAI;AACF,MAAA,MAAMA,SAAG,KAAA,CAAM,GAAA,EAAK,EAAE,SAAA,EAAW,MAAM,CAAA;AAAA,IACzC,SAAS,KAAA,EAAgB;AACvB,MAAA,IAAI,iBAAiB,KAAA,IAAS,MAAA,IAAU,KAAA,IAAU,KAAA,CAAgC,SAAS,QAAA,EAAU;AACnG,QAAA,MAAM,KAAA;AAAA,MACR;AAAA,IACF;AAAA,EACF;AAAA,EAEA,MAAc,QAAQ,WAAA,EAA4D;AAChF,IAAA,MAAM,QAAA,GAAW+B,IAAAA,CAAK,IAAA,CAAK,aAAA,EAAe,aAAa,iBAAiB,CAAA;AAExE,IAAA,IAAI;AACF,MAAA,MAAM,IAAA,GAAO,MAAM/B,QAAAA,CAAG,QAAA,CAAS,UAAU,OAAO,CAAA;AAChD,MAAA,OAAO,IAAA,CAAK,MAAM,IAAI,CAAA;AAAA,IACxB,SAAS,KAAA,EAAgB;AACvB,MAAA,IAAI,iBAAiB,KAAA,IAAS,MAAA,IAAU,KAAA,IAAU,KAAA,CAAgC,SAAS,QAAA,EAAU;AACnG,QAAA,OAAO,IAAA;AAAA,MACT;AACA,MAAA,IAAI,iBAAiB,WAAA,EAAa;AAChC,QAAA,OAAA,CAAQ,IAAA,CAAK,CAAA,4BAAA,EAA+B,QAAQ,CAAA,CAAE,CAAA;AACtD,QAAA,OAAO,IAAA;AAAA,MACT;AACA,MAAA,MAAM,KAAA;AAAA,IACR;AAAA,EACF;AAAA,EAEA,MAAc,SAAA,GAAsC;AAClD,IAAA,IAAI,KAAK,KAAA,EAAO;AACd,MAAA,OAAO,IAAA,CAAK,KAAA;AAAA,IACd;AAEA,IAAA,IAAI;AACF,MAAA,MAAM,OAAO,MAAMA,QAAAA,CAAG,QAAA,CAAS,IAAA,CAAK,WAAW,OAAO,CAAA;AACtD,MAAA,IAAA,CAAK,KAAA,GAAQ,IAAA,CAAK,KAAA,CAAM,IAAI,CAAA;AAC5B,MAAA,OAAO,IAAA,CAAK,KAAA;AAAA,IACd,SAAS,KAAA,EAAgB;AACvB,MAAA,IAAI,iBAAiB,KAAA,IAAS,MAAA,IAAU,KAAA,IAAU,KAAA,CAAgC,SAAS,QAAA,EAAU;AACnG,QAAA,IAAA,CAAK,KAAA,GAAQ;AAAA,UACX,OAAA,EAAS,CAAA;AAAA,UACT,QAAQ,EAAC;AAAA,UACT,WAAA,EAAA,iBAAa,IAAI,IAAA,EAAK,EAAE,WAAA;AAAY,SACtC;AACA,QAAA,OAAO,IAAA,CAAK,KAAA;AAAA,MACd;AACA,MAAA,MAAM,KAAA;AAAA,IACR;AAAA,EACF;AAAA,EAEA,MAAc,SAAA,GAA2B;AACvC,IAAA,IAAI,CAAC,KAAK,KAAA,EAAO;AAEjB,IAAA,MAAM,IAAA,CAAK,eAAA,CAAgB,IAAA,CAAK,aAAa,CAAA;AAC7C,IAAA,IAAA,CAAK,KAAA,CAAM,WAAA,GAAA,iBAAc,IAAI,IAAA,IAAO,WAAA,EAAY;AAChD,IAAA,MAAM,IAAA,GAAO,IAAA,CAAK,WAAA,GACd,IAAA,CAAK,SAAA,CAAU,IAAA,CAAK,KAAA,EAAO,IAAA,EAAM,CAAC,CAAA,GAClC,IAAA,CAAK,SAAA,CAAU,KAAK,KAAK,CAAA;AAE7B,IAAA,MAAMA,QAAAA,CAAG,SAAA,CAAU,IAAA,CAAK,SAAA,EAAW,MAAM,OAAO,CAAA;AAAA,EAClD;AAAA,EAEA,MAAc,YAAY,UAAA,EAAkD;AAC1E,IAAA,MAAM,KAAA,GAAQ,MAAM,IAAA,CAAK,SAAA,EAAU;AACnC,IAAA,MAAM,KAAA,GAAQ,IAAA,CAAK,sBAAA,CAAuB,UAAU,CAAA;AAEpD,IAAA,MAAM,WAAA,GAAc,MAAM,MAAA,CAAO,SAAA,CAAU,OAAK,CAAA,CAAE,OAAA,KAAY,WAAW,OAAO,CAAA;AAChF,IAAA,IAAI,eAAe,CAAA,EAAG;AACpB,MAAA,KAAA,CAAM,MAAA,CAAO,WAAW,CAAA,GAAI,KAAA;AAAA,IAC9B,CAAA,MAAO;AACL,MAAA,KAAA,CAAM,MAAA,CAAO,KAAK,KAAK,CAAA;AAAA,IACzB;AAEA,IAAA,MAAM,KAAK,SAAA,EAAU;AAAA,EACvB;AAAA,EAEA,MAAc,gBAAgB,OAAA,EAAgC;AAC5D,IAAA,MAAM,KAAA,GAAQ,MAAM,IAAA,CAAK,SAAA,EAAU;AACnC,IAAA,KAAA,CAAM,SAAS,KAAA,CAAM,MAAA,CAAO,OAAO,CAAA,CAAA,KAAK,CAAA,CAAE,YAAY,OAAO,CAAA;AAC7D,IAAA,MAAM,KAAK,SAAA,EAAU;AAAA,EACvB;AAAA,EAEQ,uBAAuB,UAAA,EAAyD;AACtF,IAAA,OAAO;AAAA,MACL,SAAS,UAAA,CAAW,OAAA;AAAA,MACpB,MAAM,UAAA,CAAW,IAAA;AAAA,MACjB,WAAW,UAAA,CAAW,SAAA;AAAA,MACtB,KAAA,EAAO,WAAW,SAAA,CAAU,KAAA;AAAA,MAC5B,WAAW,UAAA,CAAW,SAAA;AAAA,MACtB,WAAW,UAAA,CAAW,SAAA;AAAA,MACtB,UAAU,UAAA,CAAW;AAAA,KACvB;AAAA,EACF;AACF;AAKO,SAAS,iCACd,MAAA,EAC4B;AAC5B,EAAA,OAAO,IAAI,2BAA2B,MAAM,CAAA;AAC9C;;;ACvXO,IAAM,gBAAN,MAAoB;AAAA;AAAA;AAAA;AAAA;AAAA,EAKzB,aAAa,gBACX,MAAA,EACsB;AACtB,IAAA,IAAI,KAAA,GAA4B,IAAA;AAEhC,IAAA,WAAA,MAAiB,SAAS,MAAA,EAAQ;AAEhC,MAAA,IAAI,CAAC,KAAA,IAAS,KAAA,CAAM,IAAA,KAAA,kBAAA,yBAA2C;AAC7D,QAAA,KAAA,GAAQ,IAAI,WAAA,CAAY,KAAA,CAAM,aAAa,KAAA,CAAM,KAAA,EAAO,MAAM,UAAU,CAAA;AAAA,MAC1E;AAEA,MAAA,IAAI,CAAC,KAAA,EAAO;AAGZ,MAAA,IAAA,CAAK,oBAAA,CAAqB,OAAO,KAAK,CAAA;AAAA,IACxC;AAEA,IAAA,IAAI,CAAC,KAAA,EAAO;AACV,MAAA,MAAM,IAAI,MAAM,2BAA2B,CAAA;AAAA,IAC7C;AAEA,IAAA,OAAO,IAAA,CAAK,uBAAuB,KAAK,CAAA;AAAA,EAC1C;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,cAAc,SACZ,MAAA,EAC+B;AAC/B,IAAA,WAAA,MAAiB,SAAS,MAAA,EAAQ;AAChC,MAAA,IAAI,iBAAA,CAAkB,KAAK,CAAA,EAAG;AAC5B,QAAA,MAAM,KAAA,CAAM,KAAA;AAAA,MACd;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,cAAc,YAAA,CACZ,MAAA,EACA,SAAA,EAC0B;AAC1B,IAAA,WAAA,MAAiB,SAAS,MAAA,EAAQ;AAChC,MAAA,IAAI,KAAA,CAAM,SAAS,SAAA,EAAW;AAC5B,QAAA,MAAM,KAAA;AAAA,MACR;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,aAAa,eACX,MAAA,EACiB;AACjB,IAAA,MAAM,SAAmB,EAAC;AAE1B,IAAA,WAAA,MAAiB,SAAS,MAAA,EAAQ;AAChC,MAAA,IAAI,iBAAA,CAAkB,KAAK,CAAA,EAAG;AAC5B,QAAA,MAAA,CAAO,IAAA,CAAK,MAAM,KAAK,CAAA;AAAA,MACzB;AAAA,IACF;AAEA,IAAA,OAAO,MAAA,CAAO,KAAK,EAAE,CAAA;AAAA,EACvB;AAAA;AAAA;AAAA;AAAA,EAKA,cAAc,YAAA,CACZ,MAAA,EACA,SAAA,EACsC;AACtC,IAAA,IAAI,SAAwB,EAAC;AAE7B,IAAA,WAAA,MAAiB,SAAS,MAAA,EAAQ;AAChC,MAAA,MAAA,CAAO,KAAK,KAAK,CAAA;AAEjB,MAAA,IAAI,MAAA,CAAO,UAAU,SAAA,EAAW;AAC9B,QAAA,MAAM,MAAA;AACN,QAAA,MAAA,GAAS,EAAC;AAAA,MACZ;AAAA,IACF;AAGA,IAAA,IAAI,MAAA,CAAO,SAAS,CAAA,EAAG;AACrB,MAAA,MAAM,MAAA;AAAA,IACR;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,cAAc,GAAA,CACZ,MAAA,EACA,QAAA,EACoC;AACpC,IAAA,WAAA,MAAiB,SAAS,MAAA,EAAQ;AAChC,MAAA,MAAM,SAAS,KAAK,CAAA;AACpB,MAAA,MAAM,KAAA;AAAA,IACR;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,cAAc,IAAA,CACZ,MAAA,EACA,KAAA,EACoC;AACpC,IAAA,IAAI,KAAA,GAAQ,CAAA;AAEZ,IAAA,WAAA,MAAiB,SAAS,MAAA,EAAQ;AAChC,MAAA,IAAI,SAAS,KAAA,EAAO;AACpB,MAAA,MAAM,KAAA;AACN,MAAA,KAAA,EAAA;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,cAAc,IAAA,CACZ,MAAA,EACA,KAAA,EACoC;AACpC,IAAA,IAAI,OAAA,GAAU,CAAA;AAEd,IAAA,WAAA,MAAiB,SAAS,MAAA,EAAQ;AAChC,MAAA,IAAI,UAAU,KAAA,EAAO;AACnB,QAAA,OAAA,EAAA;AACA,QAAA;AAAA,MACF;AACA,MAAA,MAAM,KAAA;AAAA,IACR;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,OAAe,oBAAA,CAAqB,KAAA,EAAoB,KAAA,EAA0B;AAChF,IAAA,QAAQ,MAAM,IAAA;AAAM,MAClB,KAAA,4BAAA;AACE,QAAA,KAAA,CAAM,mBAAA,CAAoB,KAAA,CAAM,OAAA,EAAS,KAAA,CAAM,KAAK,CAAA;AACpD,QAAA;AAAA,MAEF,KAAA,0BAAA;AACE,QAAA,KAAA,CAAM,aAAA,CAAc,KAAA,CAAM,YAAA,EAAc,KAAA,CAAM,SAAS,CAAA;AACvD,QAAA;AAAA,MAEF,KAAA,oCAAA;AACE,QAAA,KAAA,CAAM,uBAAA,CAAwB,KAAA,CAAM,YAAA,EAAc,KAAA,CAAM,KAAK,CAAA;AAC7D,QAAA;AAAA,MAEF,KAAA,mCAAA;AACE,QAAA,KAAA,CAAM,gBAAA,CAAiB,MAAM,YAAY,CAAA;AACzC,QAAA;AAAA,MAEF,KAAA,8BAAA;AACE,QAAA,KAAA,CAAM,aAAA,CAAc,KAAA,CAAM,YAAA,EAAc,KAAA,CAAM,MAAM,CAAA;AACpD,QAAA;AAAA,MAEF,KAAA,6BAAA;AACE,QAAA,KAAA,CAAM,kBAAA,EAAmB;AACzB,QAAA;AAAA,MAEF,KAAA,mBAAA;AAEE,QAAA,IAAI,OAAA,CAAQ,IAAI,eAAA,EAAiB;AAC/B,UAAA,OAAA,CAAQ,KAAA,CAAM,kCAAA,EAAoC,KAAA,CAAM,KAAK,CAAA;AAAA,QAC/D;AACA,QAAA,KAAA,CAAM,WAAA,CAAY,MAAM,KAAK,CAAA;AAC7B,QAAA,KAAA,CAAM,YAAA,CAAa,MAAM,MAAM,CAAA;AAC/B,QAAA;AAAA;AACJ,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,OAAe,uBAAuB,KAAA,EAAiC;AACrE,IAAA,MAAM,SAAuB,EAAC;AAG9B,IAAA,IAAI,KAAA,CAAM,SAAQ,EAAG;AACnB,MAAA,MAAM,WAAA,GAAc,MAAM,UAAA,EAAW;AACrC,MAAA,IAAI,WAAA,EAAa;AACf,QAAA,MAAA,CAAO,IAAA,CAAK;AAAA,UACV,IAAA,EAAM,SAAA;AAAA,UACN,IAAA,EAAA,WAAA;AAAA,UACA,OAAA,EAAS;AAAA,YACP;AAAA,cACE,IAAA,EAAA,aAAA;AAAA,cACA,IAAA,EAAM;AAAA;AACR;AACF,SACD,CAAA;AAAA,MACH;AAAA,IACF;AAGA,IAAA,MAAM,SAAA,GAAY,MAAM,qBAAA,EAAsB;AAC9C,IAAA,IAAI,SAAA,CAAU,SAAS,CAAA,EAAG;AAExB,MAAA,MAAM,cAAA,GAAiB,SAAA,CAAU,GAAA,CAAI,CAAC,EAAA,MAAQ;AAAA,QAC5C,IAAA,EAAA,UAAA;AAAA,QACA,IAAI,EAAA,CAAG,EAAA;AAAA,QACP,IAAA,EAAM,GAAG,QAAA,CAAS,IAAA;AAAA,QAClB,SAAA,EAAW,GAAG,QAAA,CAAS;AAAA,OACzB,CAAE,CAAA;AAEF,MAAA,MAAM,WAAA,GAAc,OAAO,CAAC,CAAA;AAC5B,MAAA,IAAI,WAAA,IAAe,WAAA,CAAY,IAAA,KAAS,SAAA,EAAW;AAEjD,QAAA,WAAA,CAAY,OAAA,CAAQ,IAAA,CAAK,GAAG,cAAc,CAAA;AAAA,MAC5C,CAAA,MAAO;AAEL,QAAA,MAAA,CAAO,IAAA,CAAK;AAAA,UACV,IAAA,EAAM,SAAA;AAAA,UACN,IAAA,EAAA,WAAA;AAAA,UACA,OAAA,EAAS;AAAA,SACV,CAAA;AAAA,MACH;AAAA,IACF;AAGA,IAAA,MAAM,UAAA,GAAa,IAAA,CAAK,iBAAA,CAAkB,MAAM,CAAA;AAEhD,IAAA,OAAO;AAAA,MACL,IAAI,KAAA,CAAM,UAAA;AAAA,MACV,MAAA,EAAQ,UAAA;AAAA,MACR,YAAY,KAAA,CAAM,SAAA;AAAA,MAClB,QAAQ,KAAA,CAAM,MAAA;AAAA,MACd,OAAO,KAAA,CAAM,KAAA;AAAA,MACb,MAAA;AAAA,MACA,WAAA,EAAa,UAAA;AAAA,MACb,OAAO,KAAA,CAAM;AAAA,KACf;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,OAAe,kBAAkB,MAAA,EAA8B;AAC7D,IAAA,MAAM,QAAkB,EAAC;AAEzB,IAAA,KAAA,MAAW,QAAQ,MAAA,EAAQ;AACzB,MAAA,IAAI,IAAA,CAAK,SAAS,SAAA,EAAW;AAC3B,QAAA,KAAA,MAAW,OAAA,IAAW,KAAK,OAAA,EAAS;AAClC,UAAA,IAAI,QAAQ,IAAA,KAAA,aAAA,oBAAkC;AAC5C,YAAA,KAAA,CAAM,IAAA,CAAK,QAAQ,IAAI,CAAA;AAAA,UACzB;AAAA,QACF;AAAA,MACF;AAAA,IACF;AAEA,IAAA,OAAO,KAAA,CAAM,IAAA,CAAK,GAAG,CAAA,CAAE,IAAA,EAAK;AAAA,EAC9B;AACF;;;AC1QO,IAAM,sBAAN,MAA0B;AAAA;AAAA;AAAA;AAAA,EAI/B,OAAO,QAAA,CAAS,KAAA,EAAY,OAAA,EAAwC;AAClE,IAAA,MAAM,EAAE,YAAA,EAAc,gBAAA,GAAmB,KAAA,EAAO,GAAI,OAAA;AAGpD,IAAA,IAAI,iBAAiB,OAAA,EAAS;AAC5B,MAAA,OAAO,KAAA;AAAA,IACT;AAGA,IAAA,MAAM,MAAA,GAAS,KAAA,CAAM,MAAA,IAAU,KAAA,CAAM,cAAc,KAAA,CAAM,IAAA;AACzD,IAAA,MAAM,OAAA,GAAU,KAAA,CAAM,OAAA,IAAW,MAAA,CAAO,KAAK,CAAA;AAC7C,IAAA,MAAM,YAAA,GAAe,QAAQ,WAAA,EAAY;AAGzC,IAAA,IACE,MAAA,KAAW,GAAA,IACX,MAAA,KAAW,GAAA,IACX,YAAA,CAAa,QAAA,CAAS,SAAS,CAAA,IAC/B,YAAA,CAAa,QAAA,CAAS,SAAS,CAAA,IAC/B,YAAA,CAAa,QAAA,CAAS,gBAAgB,CAAA,IACtC,YAAA,CAAa,QAAA,CAAS,cAAc,CAAA,IACpC,YAAA,CAAa,QAAA,CAAS,aAAa,CAAA,IACnC,YAAA,CAAa,QAAA,CAAS,mBAAmB,CAAA,EACzC;AACA,MAAA,OAAO,IAAI,iBAAA,CAAkB,YAAA,EAAc,OAAO,CAAA;AAAA,IACpD;AAGA,IAAA,IACE,MAAA,KAAW,OACX,YAAA,CAAa,QAAA,CAAS,YAAY,CAAA,IAClC,YAAA,CAAa,SAAS,YAAY,CAAA,IAClC,aAAa,QAAA,CAAS,mBAAmB,KACzC,YAAA,CAAa,QAAA,CAAS,oBAAoB,CAAA,IAC1C,YAAA,CAAa,QAAA,CAAS,gBAAgB,CAAA,EACtC;AACA,MAAA,MAAM,UAAA,GAAa,IAAA,CAAK,iBAAA,CAAkB,KAAK,CAAA;AAC/C,MAAA,OAAO,IAAI,sBAAA,CAAuB,YAAA,EAAc,UAAU,CAAA;AAAA,IAC5D;AAGA,IAAA,IACE,MAAA,KAAW,GAAA,IACX,KAAA,CAAM,IAAA,KAAS,6BACf,YAAA,CAAa,QAAA,CAAS,gBAAgB,CAAA,IACtC,YAAA,CAAa,QAAA,CAAS,gBAAgB,CAAA,IACtC,aAAa,QAAA,CAAS,aAAa,CAAA,IACnC,YAAA,CAAa,QAAA,CAAS,UAAU,CAAA,IAChC,YAAA,CAAa,SAAS,iBAAiB,CAAA,IACvC,YAAA,CAAa,QAAA,CAAS,YAAY,CAAA,IAClC,YAAA,CAAa,QAAA,CAAS,oBAAoB,CAAA,EAC1C;AACA,MAAA,OAAO,IAAI,0BAAA,CAA2B,YAAA,EAAc,gBAAgB,CAAA;AAAA,IACtE;AAGA,IAAA,OAAO,IAAI,aAAA,CAAc,YAAA,EAAc,OAAA,EAAS,QAAQ,KAAK,CAAA;AAAA,EAC/D;AAAA;AAAA;AAAA;AAAA,EAKA,OAAe,kBAAkB,KAAA,EAAgC;AAE/D,IAAA,MAAM,gBAAA,GACJ,KAAA,CAAM,OAAA,GAAU,aAAa,CAAA,IAC7B,KAAA,CAAM,OAAA,GAAU,aAAa,CAAA,IAC7B,KAAA,CAAM,OAAA,EAAS,GAAA,GAAM,aAAa,CAAA;AAEpC,IAAA,IAAI,gBAAA,EAAkB;AACpB,MAAA,MAAM,OAAA,GAAU,QAAA,CAAS,gBAAA,EAAkB,EAAE,CAAA;AAC7C,MAAA,IAAI,CAAC,KAAA,CAAM,OAAO,CAAA,EAAG;AACnB,QAAA,OAAO,OAAA,GAAU,GAAA;AAAA,MACnB;AAAA,IACF;AAGA,IAAA,IAAI,MAAM,UAAA,EAAY;AACpB,MAAA,OAAO,OAAO,KAAA,CAAM,UAAA,KAAe,QAAA,GAC/B,KAAA,CAAM,aACN,QAAA,CAAS,KAAA,CAAM,UAAA,EAAY,EAAE,CAAA,GAAI,GAAA;AAAA,IACvC;AAGA,IAAA,IAAI,MAAM,YAAA,EAAc;AACtB,MAAA,KAAA,MAAW,MAAA,IAAU,MAAM,YAAA,EAAc;AACvC,QAAA,IAAI,OAAO,UAAA,EAAY;AAErB,UAAA,MAAM,KAAA,GAAQ,MAAA,CAAO,UAAA,CAAW,KAAA,CAAM,QAAQ,CAAA;AAC9C,UAAA,IAAI,KAAA,EAAO;AACT,YAAA,OAAO,QAAA,CAAS,KAAA,CAAM,CAAC,CAAA,EAAG,EAAE,CAAA,GAAI,GAAA;AAAA,UAClC;AAAA,QACF;AAAA,MACF;AAAA,IACF;AAEA,IAAA,OAAO,MAAA;AAAA,EACT;AACF;;;AC3EO,IAAM,mBAAA,GAAoD;AAAA;AAAA,EAE/D;AAAA,IACE,EAAA,EAAI,OAAA;AAAA,IACJ,IAAA,EAAM,OAAA;AAAA,IACN,QAAA,EAAU,eAAA;AAAA,IACV,UAAA,EAAY,aAAA;AAAA,IACZ,OAAA,EAAS,uBAAA;AAAA,IACT,OAAA,EAAS,+BAAA;AAAA,IACT,YAAA,EAAc,CAAC,YAAA,EAAc,eAAA,EAAiB,YAAY;AAAA,GAC5D;AAAA,EACA;AAAA,IACE,EAAA,EAAI,SAAA;AAAA,IACJ,IAAA,EAAM,SAAA;AAAA,IACN,QAAA,EAAU,eAAA;AAAA,IACV,UAAA,EAAY,+BAAA;AAAA,IACZ,OAAA,EAAS,6BAAA;AAAA,IACT,OAAA,EAAS,qCAAA;AAAA,IACT,YAAA,EAAc,CAAC,KAAA,EAAO,eAAe;AAAA,GACvC;AAAA,EACA;AAAA,IACE,EAAA,EAAI,iBAAA;AAAA,IACJ,IAAA,EAAM,iBAAA;AAAA,IACN,QAAA,EAAU,eAAA;AAAA,IACV,UAAA,EAAY,qDAAA;AAAA,IACZ,OAAA,EAAS,kCAAA;AAAA,IACT,OAAA,EAAS,gEAAA;AAAA,IACT,YAAA,EAAc,CAAC,qBAAA,EAAuB,oBAAoB;AAAA,GAC5D;AAAA,EACA;AAAA,IACE,EAAA,EAAI,UAAA;AAAA,IACJ,IAAA,EAAM,UAAA;AAAA,IACN,QAAA,EAAU,eAAA;AAAA,IACV,UAAA,EAAY,qBAAA;AAAA,IACZ,OAAA,EAAS,0BAAA;AAAA,IACT,OAAA,EAAS;AAAA,GACX;AAAA;AAAA,EAGA;AAAA,IACE,EAAA,EAAI,QAAA;AAAA,IACJ,IAAA,EAAM,QAAA;AAAA,IACN,QAAA,EAAU,aAAA;AAAA,IACV,UAAA,EAAY,mBAAA;AAAA,IACZ,OAAA,EAAS,wBAAA;AAAA,IACT,OAAA,EAAS,iCAAA;AAAA,IACT,YAAA,EAAc,CAAC,MAAA,EAAQ,WAAA,EAAa,UAAU;AAAA,GAChD;AAAA,EACA;AAAA,IACE,EAAA,EAAI,QAAA;AAAA,IACJ,IAAA,EAAM,QAAA;AAAA,IACN,QAAA,EAAU,aAAA;AAAA,IACV,UAAA,EAAY,uBAAA;AAAA,IACZ,OAAA,EAAS,2BAAA;AAAA,IACT,OAAA,EAAS,iCAAA;AAAA,IACT,YAAA,EAAc,CAAC,KAAA,EAAO,WAAA,EAAa,iBAAiB;AAAA,GACtD;AAAA,EACA;AAAA,IACE,EAAA,EAAI,WAAA;AAAA,IACJ,IAAA,EAAM,WAAA;AAAA,IACN,QAAA,EAAU,aAAA;AAAA,IACV,UAAA,EAAY,qCAAA;AAAA,IACZ,OAAA,EAAS,+BAAA;AAAA,IACT,OAAA,EAAS,uDAAA;AAAA,IACT,YAAA,EAAc,CAAC,YAAA,EAAc,aAAa;AAAA,GAC5C;AAAA,EACA;AAAA,IACE,EAAA,EAAI,MAAA;AAAA,IACJ,IAAA,EAAM,MAAA;AAAA,IACN,QAAA,EAAU,aAAA;AAAA,IACV,UAAA,EAAY,8BAAA;AAAA,IACZ,OAAA,EAAS,8CAAA;AAAA,IACT,OAAA,EAAS,8DAAA;AAAA,IACT,YAAA,EAAc,CAAC,gBAAA,EAAkB,iBAAiB;AAAA,GACpD;AAAA,EACA;AAAA,IACE,EAAA,EAAI,QAAA;AAAA,IACJ,IAAA,EAAM,QAAA;AAAA,IACN,QAAA,EAAU,aAAA;AAAA,IACV,UAAA,EAAY,mBAAA;AAAA,IACZ,OAAA,EAAS,gCAAA;AAAA,IACT,OAAA,EAAS,oCAAA;AAAA,IACT,YAAA,EAAc,CAAC,MAAA,EAAQ,OAAO;AAAA,GAChC;AAAA,EACA;AAAA,IACE,EAAA,EAAI,OAAA;AAAA,IACJ,IAAA,EAAM,OAAA;AAAA,IACN,QAAA,EAAU,aAAA;AAAA,IACV,UAAA,EAAY,kBAAA;AAAA,IACZ,OAAA,EAAS,+BAAA;AAAA,IACT,OAAA,EAAS;AAAA,GACX;AAAA,EACA;AAAA,IACE,EAAA,EAAI,QAAA;AAAA,IACJ,IAAA,EAAM,QAAA;AAAA,IACN,QAAA,EAAU,aAAA;AAAA,IACV,UAAA,EAAY,mBAAA;AAAA,IACZ,OAAA,EAAS,0BAAA;AAAA,IACT,OAAA,EAAS,oDAAA;AAAA,IACT,YAAA,EAAc,CAAC,MAAA,EAAQ,OAAO;AAAA,GAChC;AAAA;AAAA,EAGA;AAAA,IACE,EAAA,EAAI,QAAA;AAAA,IACJ,IAAA,EAAM,QAAA;AAAA,IACN,QAAA,EAAU,cAAA;AAAA,IACV,UAAA,EAAY,mBAAA;AAAA,IACZ,OAAA,EAAS,2BAAA;AAAA,IACT,OAAA,EAAS;AAAA,GACX;AAAA,EACA;AAAA,IACE,EAAA,EAAI,UAAA;AAAA,IACJ,IAAA,EAAM,UAAA;AAAA,IACN,QAAA,EAAU,cAAA;AAAA,IACV,UAAA,EAAY,qBAAA;AAAA,IACZ,OAAA,EAAS,6BAAA;AAAA,IACT,OAAA,EAAS,yCAAA;AAAA,IACT,YAAA,EAAc,CAAC,mBAAA,EAAqB,oBAAoB;AAAA,GAC1D;AAAA,EACA;AAAA,IACE,EAAA,EAAI,kBAAA;AAAA,IACJ,IAAA,EAAM,kBAAA;AAAA,IACN,QAAA,EAAU,cAAA;AAAA,IACV,UAAA,EAAY,gDAAA;AAAA,IACZ,OAAA,EAAS,4BAAA;AAAA,IACT,OAAA,EAAS,yCAAA;AAAA,IACT,YAAA,EAAc;AAAA,MACZ,uCAAA;AAAA,MACA;AAAA;AACF,GACF;AAAA,EACA;AAAA,IACE,EAAA,EAAI,eAAA;AAAA,IACJ,IAAA,EAAM,eAAA;AAAA,IACN,QAAA,EAAU,cAAA;AAAA,IACV,UAAA,EAAY,wBAAA;AAAA,IACZ,OAAA,EAAS,kCAAA;AAAA,IACT,OAAA,EAAS,0CAAA;AAAA,IACT,YAAA,EAAc,CAAC,WAAA,EAAa,iBAAA,EAAmB,WAAW;AAAA,GAC5D;AAAA,EACA;AAAA,IACE,EAAA,EAAI,YAAA;AAAA,IACJ,IAAA,EAAM,YAAA;AAAA,IACN,QAAA,EAAU,cAAA;AAAA,IACV,UAAA,EAAY,oCAAA;AAAA,IACZ,OAAA,EAAS,iDAAA;AAAA,IACT,OAAA,EAAS,wDAAA;AAAA,IACT,YAAA,EAAc,CAAC,6BAAA,EAA+B,0BAA0B;AAAA,GAC1E;AAAA;AAAA,EAGA;AAAA,IACE,EAAA,EAAI,YAAA;AAAA,IACJ,IAAA,EAAM,YAAA;AAAA,IACN,QAAA,EAAU,KAAA;AAAA,IACV,UAAA,EAAY,6BAAA;AAAA,IACZ,OAAA,EAAS,0DAAA;AAAA,IACT,OAAA,EAAS,4CAAA;AAAA,IACT,YAAA,EAAc,CAAC,KAAA,EAAO,eAAe;AAAA,GACvC;AAAA,EACA;AAAA,IACE,EAAA,EAAI,SAAA;AAAA,IACJ,IAAA,EAAM,SAAA;AAAA,IACN,QAAA,EAAU,KAAA;AAAA,IACV,UAAA,EAAY,qCAAA;AAAA,IACZ,OAAA,EAAS,wBAAA;AAAA,IACT,OAAA,EAAS,yCAAA;AAAA,IACT,YAAA,EAAc,CAAC,2BAAA,EAA6B,4BAA4B;AAAA,GAC1E;AAAA,EACA;AAAA,IACE,EAAA,EAAI,WAAA;AAAA,IACJ,IAAA,EAAM,WAAA;AAAA,IACN,QAAA,EAAU,KAAA;AAAA,IACV,UAAA,EAAY,sBAAA;AAAA,IACZ,OAAA,EAAS,8BAAA;AAAA,IACT,OAAA,EAAS;AAAA,GACX;AAAA;AAAA,EAGA;AAAA,IACE,EAAA,EAAI,QAAA;AAAA,IACJ,IAAA,EAAM,QAAA;AAAA,IACN,QAAA,EAAU,UAAA;AAAA,IACV,UAAA,EAAY,mBAAA;AAAA,IACZ,OAAA,EAAS,2BAAA;AAAA,IACT,OAAA,EAAS;AAAA,GACX;AAAA,EACA;AAAA,IACE,EAAA,EAAI,QAAA;AAAA,IACJ,IAAA,EAAM,QAAA;AAAA,IACN,QAAA,EAAU,UAAA;AAAA,IACV,UAAA,EAAY,sCAAA;AAAA,IACZ,OAAA,EAAS,6BAAA;AAAA,IACT,OAAA,EAAS;AAAA,GACX;AAAA;AAAA,EAGA;AAAA,IACE,EAAA,EAAI,KAAA;AAAA,IACJ,IAAA,EAAM,qBAAA;AAAA,IACN,QAAA,EAAU,OAAA;AAAA,IACV,UAAA,EAAY,iBAAA;AAAA,IACZ,OAAA,EAAS,wBAAA;AAAA,IACT,OAAA,EAAS;AAAA,GACX;AAAA,EACA;AAAA,IACE,EAAA,EAAI,KAAA;AAAA,IACJ,IAAA,EAAM,uBAAA;AAAA,IACN,QAAA,EAAU,OAAA;AAAA,IACV,UAAA,EAAY,kBAAA;AAAA,IACZ,OAAA,EAAS,4BAAA;AAAA,IACT,OAAA,EAAS;AAAA,GACX;AAAA,EACA;AAAA,IACE,EAAA,EAAI,OAAA;AAAA,IACJ,IAAA,EAAM,iBAAA;AAAA,IACN,QAAA,EAAU,OAAA;AAAA,IACV,UAAA,EAAY,mCAAA;AAAA,IACZ,OAAA,EAAS,8BAAA;AAAA,IACT,OAAA,EAAS;AAAA,GACX;AAAA;AAAA,EAGA;AAAA,IACE,EAAA,EAAI,SAAA;AAAA,IACJ,IAAA,EAAM,SAAA;AAAA,IACN,QAAA,EAAU,SAAA;AAAA,IACV,UAAA,EAAY,oCAAA;AAAA,IACZ,OAAA,EAAS,8BAAA;AAAA,IACT,OAAA,EAAS,kDAAA;AAAA,IACT,YAAA,EAAc,CAAC,oBAAA,EAAsB,qBAAqB;AAAA,GAC5D;AAAA,EACA;AAAA,IACE,EAAA,EAAI,KAAA;AAAA,IACJ,IAAA,EAAM,KAAA;AAAA,IACN,QAAA,EAAU,SAAA;AAAA,IACV,UAAA,EAAY,gBAAA;AAAA,IACZ,OAAA,EAAS,yBAAA;AAAA,IACT,OAAA,EAAS;AAAA,GACX;AAAA,EACA;AAAA,IACE,EAAA,EAAI,cAAA;AAAA,IACJ,IAAA,EAAM,cAAA;AAAA,IACN,QAAA,EAAU,SAAA;AAAA,IACV,UAAA,EAAY,yBAAA;AAAA,IACZ,OAAA,EAAS,qCAAA;AAAA,IACT,OAAA,EAAS,yCAAA;AAAA,IACT,YAAA,EAAc,CAAC,uCAAuC;AAAA,GACxD;AAAA,EACA;AAAA,IACE,EAAA,EAAI,UAAA;AAAA,IACJ,IAAA,EAAM,UAAA;AAAA,IACN,QAAA,EAAU,SAAA;AAAA,IACV,UAAA,EAAY,+BAAA;AAAA,IACZ,OAAA,EAAS,2CAAA;AAAA,IACT,OAAA,EAAS,uDAAA;AAAA,IACT,YAAA,EAAc,CAAC,iBAAiB;AAAA,GAClC;AAAA;AAAA,EAGA;AAAA,IACE,EAAA,EAAI,UAAA;AAAA,IACJ,IAAA,EAAM,UAAA;AAAA,IACN,QAAA,EAAU,OAAA;AAAA,IACV,UAAA,EAAY,qBAAA;AAAA,IACZ,OAAA,EAAS,6BAAA;AAAA,IACT,OAAA,EAAS;AAAA,GACX;AAAA,EACA;AAAA,IACE,EAAA,EAAI,WAAA;AAAA,IACJ,IAAA,EAAM,WAAA;AAAA,IACN,QAAA,EAAU,OAAA;AAAA,IACV,UAAA,EAAY,uCAAA;AAAA,IACZ,OAAA,EAAS,sCAAA;AAAA,IACT,OAAA,EAAS;AAAA,GACX;AAAA,EACA;AAAA,IACE,EAAA,EAAI,UAAA;AAAA,IACJ,IAAA,EAAM,UAAA;AAAA,IACN,QAAA,EAAU,OAAA;AAAA,IACV,UAAA,EAAY,wBAAA;AAAA,IACZ,OAAA,EAAS,6BAAA;AAAA,IACT,OAAA,EAAS;AAAA,GACX;AAAA;AAAA,EAGA;AAAA,IACE,EAAA,EAAI,SAAA;AAAA,IACJ,IAAA,EAAM,SAAA;AAAA,IACN,QAAA,EAAU,YAAA;AAAA,IACV,UAAA,EAAY,sBAAA;AAAA,IACZ,OAAA,EAAS,kCAAA;AAAA,IACT,OAAA,EAAS;AAAA,GACX;AAAA,EACA;AAAA,IACE,EAAA,EAAI,WAAA;AAAA,IACJ,IAAA,EAAM,WAAA;AAAA,IACN,QAAA,EAAU,YAAA;AAAA,IACV,UAAA,EAAY,sBAAA;AAAA,IACZ,OAAA,EAAS,2BAAA;AAAA,IACT,OAAA,EAAS;AAAA,GACX;AAAA,EACA;AAAA,IACE,EAAA,EAAI,QAAA;AAAA,IACJ,IAAA,EAAM,QAAA;AAAA,IACN,QAAA,EAAU,YAAA;AAAA,IACV,UAAA,EAAY,aAAA;AAAA,IACZ,OAAA,EAAS,yBAAA;AAAA,IACT,OAAA,EAAS;AAAA,GACX;AAAA;AAAA,EAGA;AAAA,IACE,EAAA,EAAI,QAAA;AAAA,IACJ,IAAA,EAAM,QAAA;AAAA,IACN,QAAA,EAAU,QAAA;AAAA,IACV,UAAA,EAAY,cAAA;AAAA,IACZ,OAAA,EAAS,2BAAA;AAAA,IACT,OAAA,EAAS;AAAA,GACX;AAAA,EACA;AAAA,IACE,EAAA,EAAI,cAAA;AAAA,IACJ,IAAA,EAAM,cAAA;AAAA,IACN,QAAA,EAAU,QAAA;AAAA,IACV,UAAA,EAAY,0BAAA;AAAA,IACZ,OAAA,EAAS,qCAAA;AAAA,IACT,OAAA,EAAS;AAAA,GACX;AAAA,EACA;AAAA,IACE,EAAA,EAAI,QAAA;AAAA,IACJ,IAAA,EAAM,QAAA;AAAA,IACN,QAAA,EAAU,QAAA;AAAA,IACV,UAAA,EAAY,mBAAA;AAAA,IACZ,OAAA,EAAS,wBAAA;AAAA,IACT,OAAA,EAAS;AAAA,GACX;AAAA,EACA;AAAA,IACE,EAAA,EAAI,iBAAA;AAAA,IACJ,IAAA,EAAM,iBAAA;AAAA,IACN,QAAA,EAAU,QAAA;AAAA,IACV,UAAA,EAAY,yCAAA;AAAA,IACZ,OAAA,EAAS,6CAAA;AAAA,IACT,OAAA,EAAS;AAAA,GACX;AAAA;AAAA,EAGA;AAAA,IACE,EAAA,EAAI,SAAA;AAAA,IACJ,IAAA,EAAM,SAAA;AAAA,IACN,QAAA,EAAU,QAAA;AAAA,IACV,UAAA,EAAY,oBAAA;AAAA,IACZ,OAAA,EAAS,4BAAA;AAAA,IACT,OAAA,EAAS;AAAA,GACX;AAAA;AAAA,EAGA;AAAA,IACE,EAAA,EAAI,QAAA;AAAA,IACJ,IAAA,EAAM,QAAA;AAAA,IACN,QAAA,EAAU,OAAA;AAAA,IACV,UAAA,EAAY,mBAAA;AAAA,IACZ,OAAA,EAAS,mCAAA;AAAA,IACT,OAAA,EAAS;AAAA,GACX;AAAA,EACA;AAAA,IACE,EAAA,EAAI,SAAA;AAAA,IACJ,IAAA,EAAM,SAAA;AAAA,IACN,QAAA,EAAU,OAAA;AAAA,IACV,UAAA,EAAY,eAAA;AAAA,IACZ,OAAA,EAAS,2CAAA;AAAA,IACT,OAAA,EAAS,8CAAA;AAAA,IACT,YAAA,EAAc,CAAC,MAAA,EAAQ,OAAO;AAAA,GAChC;AAAA,EACA;AAAA,IACE,EAAA,EAAI,UAAA;AAAA,IACJ,IAAA,EAAM,UAAA;AAAA,IACN,QAAA,EAAU,OAAA;AAAA,IACV,UAAA,EAAY,oBAAA;AAAA,IACZ,OAAA,EAAS,yBAAA;AAAA,IACT,OAAA,EAAS;AAAA,GACX;AAAA,EACA;AAAA,IACE,EAAA,EAAI,SAAA;AAAA,IACJ,IAAA,EAAM,SAAA;AAAA,IACN,QAAA,EAAU,OAAA;AAAA,IACV,UAAA,EAAY,sBAAA;AAAA,IACZ,OAAA,EAAS,oDAAA;AAAA,IACT,OAAA,EAAS,8BAAA;AAAA,IACT,YAAA,EAAc,CAAC,eAAA,EAAiB,gBAAA,EAAkB,aAAa;AAAA;AAEnE;AAaO,IAAM,WAAW,MAAA,CAAO,WAAA;AAAA,EAC7B,mBAAA,CAAoB,GAAA,CAAI,CAAC,GAAA,KAAQ;AAAA;AAAA,IAE/B,GAAA,CAAI,GACD,KAAA,CAAM,GAAG,EACT,GAAA,CAAI,CAAC,SAAS,IAAA,CAAK,MAAA,CAAO,CAAC,CAAA,CAAE,WAAA,KAAgB,IAAA,CAAK,KAAA,CAAM,CAAC,CAAC,CAAA,CAC1D,KAAK,EAAE,CAAA;AAAA,IACV,GAAA,CAAI;AAAA,GACL;AACH;AAKO,IAAM,oBAAA,GACX,mBAAA,CAAoB,GAAA,CAAI,CAAC,GAAA,MAAS;AAAA,EAChC,SAAS,GAAA,CAAI,EAAA;AAAA,EACb,SAAS,GAAA,CAAI;AACf,CAAA,CAAE;AAiBG,IAAM,eAA4C,MAAA,CAAO,WAAA;AAAA,EAC9D,mBAAA,CAAoB,GAAA,CAAI,CAAC,GAAA,KAAQ;AAAA,IAC/B,GAAA,CAAI,EAAA;AAAA,IACJ;AAAA,MACE,IAAI,GAAA,CAAI,EAAA;AAAA,MACR,MAAM,GAAA,CAAI,IAAA;AAAA,MACV,UAAU,GAAA,CAAI,QAAA;AAAA,MACd,SAAS,GAAA,CAAI,OAAA;AAAA,MACb,SAAS,GAAA,CAAI,OAAA;AAAA,MACb,cAAc,GAAA,CAAI;AAAA;AACpB,GACD;AACH;AAKA,IAAI,gBAAA,GAAuE,IAAA;AAK3E,SAAS,mBAAA,GAAmE;AAC1E,EAAA,IAAI,CAAC,gBAAA,EAAkB;AACrB,IAAA,gBAAA,GAAmB,mBAAA,CAAoB,GAAA,CAAI,CAAC,GAAA,MAAS;AAAA,MACnD,SAAS,GAAA,CAAI,EAAA;AAAA,MACb,SAAS,GAAA,CAAI;AAAA,KACf,CAAE,CAAA;AAAA,EACJ;AACA,EAAA,OAAO,gBAAA;AACT;AAOO,SAAS,qBAAqB,GAAA,EAAiC;AACpE,EAAA,MAAM,WAAW,mBAAA,EAAoB;AAErC,EAAA,KAAA,MAAW,EAAE,OAAA,EAAS,OAAA,EAAQ,IAAK,QAAA,EAAU;AAC3C,IAAA,IAAI,OAAA,CAAQ,IAAA,CAAK,GAAG,CAAA,EAAG;AACrB,MAAA,OAAO,OAAA;AAAA,IACT;AAAA,EACF;AAEA,EAAA,OAAO,MAAA;AACT;AAKO,SAAS,eAAe,WAAA,EAA8C;AAC3E,EAAA,OAAO,aAAa,WAAW,CAAA;AACjC;AAKO,SAAS,qBAAqB,WAAA,EAAoD;AACvF,EAAA,OAAO,oBAAoB,IAAA,CAAK,CAAC,GAAA,KAAQ,GAAA,CAAI,OAAO,WAAW,CAAA;AACjE;AAKO,SAAS,sBAAsB,QAAA,EAAgD;AACpF,EAAA,OAAO,oBAAoB,MAAA,CAAO,CAAC,GAAA,KAAQ,GAAA,CAAI,aAAa,QAAQ,CAAA;AACtE;AAKO,SAAS,gBAAA,GAA6B;AAC3C,EAAA,OAAO,mBAAA,CAAoB,GAAA,CAAI,CAAC,GAAA,KAAQ,IAAI,EAAE,CAAA;AAChD;AAKO,SAAS,eAAe,SAAA,EAA4B;AACzD,EAAA,OAAO,oBAAoB,IAAA,CAAK,CAAC,GAAA,KAAQ,GAAA,CAAI,OAAO,SAAS,CAAA;AAC/D;;;ACyDA,cAAA,EAAA;;;ACrmBA,cAAA,EAAA;AAOA,IAAM,iBAAA,GAAoB,CAAC,eAAA,EAAiB,WAAA,EAAa,WAAW,QAAQ,CAAA;AAK5E,SAAS6C,eAAc,GAAA,EAAsB;AAC3C,EAAA,MAAM,IAAA,uBAAW,OAAA,EAAQ;AACzB,EAAA,OAAO,IAAA,CAAK,SAAA,CAAU,GAAA,EAAK,CAAC,MAAM,KAAA,KAAU;AAC1C,IAAA,IAAI,OAAO,KAAA,KAAU,QAAA,IAAY,KAAA,KAAU,IAAA,EAAM;AAC/C,MAAA,IAAI,IAAA,CAAK,GAAA,CAAI,KAAK,CAAA,EAAG;AACnB,QAAA,OAAO,YAAA;AAAA,MACT;AACA,MAAA,IAAA,CAAK,IAAI,KAAK,CAAA;AAAA,IAChB;AACA,IAAA,OAAO,KAAA;AAAA,EACT,CAAC,CAAA;AACH;AAKA,SAAS,uBAAuB,OAAA,EAA0D;AACxF,EAAA,IAAI,CAAC,OAAA,EAAS,OAAO,EAAC;AAEtB,EAAA,MAAM,WAAmC,EAAC;AAC1C,EAAA,KAAA,MAAW,CAAC,GAAA,EAAK,KAAK,KAAK,MAAA,CAAO,OAAA,CAAQ,OAAO,CAAA,EAAG;AAClD,IAAA,IAAI,CAAC,iBAAA,CAAkB,QAAA,CAAS,GAAA,CAAI,WAAA,EAAa,CAAA,EAAG;AAClD,MAAA,QAAA,CAAS,GAAG,CAAA,GAAI,KAAA;AAAA,IAClB;AAAA,EACF;AACA,EAAA,OAAO,QAAA;AACT;AA0DO,IAAM,iBAAN,MAAqB;AAAA;AAAA,EAE1B,OAAe,SAAA,mBAAY,IAAI,GAAA,EAAgC;AAAA;AAAA,EAG/D,OAAe,gBAAA,mBAAmB,IAAI,GAAA,EAAgC;AAAA;AAAA,EAGtE,OAAe,SAAA,mBAAY,IAAI,GAAA,EAA4B;AAAA;AAAA,EAG3D,OAAwB,cAAA,GAAiB,GAAA;AAAA;AAAA;AAAA;AAAA,EAKzC,OAAO,UAAA,GAAmB;AACxB,IAAA,IAAA,CAAK,iBAAiB,KAAA,EAAM;AAC5B,IAAA,IAAA,CAAK,UAAU,KAAA,EAAM;AAAA,EACvB;AAAA;AAAA;AAAA;AAAA,EAKA,OAAO,gBAAgB,aAAA,EAA6B;AAClD,IAAA,IAAA,CAAK,gBAAA,CAAiB,OAAO,aAAa,CAAA;AAE1C,IAAA,KAAA,MAAW,GAAA,IAAO,IAAA,CAAK,SAAA,CAAU,IAAA,EAAK,EAAG;AACvC,MAAA,IAAI,GAAA,CAAI,UAAA,CAAW,CAAA,EAAG,aAAa,GAAG,CAAA,EAAG;AACvC,QAAA,IAAA,CAAK,SAAA,CAAU,OAAO,GAAG,CAAA;AAAA,MAC3B;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAgBA,OAAO,eAAA,CAAgB,WAAA,EAAqB,OAAA,EAAmC;AAC7E,IAAA,IAAA,CAAK,SAAA,CAAU,GAAA,CAAI,WAAA,EAAa,OAAO,CAAA;AAAA,EACzC;AAAA;AAAA;AAAA;AAAA,EAKA,OAAO,kBAAkB,WAAA,EAA8B;AACrD,IAAA,OAAO,IAAA,CAAK,SAAA,CAAU,MAAA,CAAO,WAAW,CAAA;AAAA,EAC1C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAgBA,OAAO,GAAA,CAAI,eAAA,EAAqC,MAAA,EAAiC;AAC/E,IAAA,MAAM,SAAA,GAAY,IAAA,CAAK,gBAAA,CAAiB,eAAe,CAAA;AACvD,IAAA,MAAM,QAAwB,EAAC;AAG/B,IAAA,IAAI,UAAU,OAAA,EAAS;AACrB,MAAA,KAAA,CAAM,KAAK,IAAA,CAAK,oBAAA,CAAqB,WAAW,EAAE,MAAA,EAAQ,CAAC,CAAA;AAAA,IAC7D;AAGA,IAAA,MAAM,WAAA,GAAc,IAAA,CAAK,aAAA,CAAc,SAAS,CAAA;AAChD,IAAA,IAAI,WAAA,IAAe,IAAA,CAAK,SAAA,CAAU,GAAA,CAAI,WAAW,CAAA,EAAG;AAClD,MAAA,MAAM,OAAA,GAAU,IAAA,CAAK,SAAA,CAAU,GAAA,CAAI,WAAW,CAAA;AAC9C,MAAA,KAAA,CAAM,IAAA,CAAK,GAAG,OAAA,CAAQ,SAAA,EAAW,MAAM,CAAC,CAAA;AAAA,IAC1C;AAEA,IAAA,OAAO,KAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAcA,OAAO,UAAA,CACL,eAAA,EACA,OAAA,EACwD;AACxD,IAAA,MAAM,SAAA,GAAY,IAAA,CAAK,gBAAA,CAAiB,eAAe,CAAA;AACvD,IAAA,OAAO,IAAA,CAAK,oBAAA,CAAqB,SAAA,EAAW,OAAO,CAAA;AAAA,EACrD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,OAAO,YAAA,CAAa,eAAA,EAAqC,MAAA,EAAiC;AACxF,IAAA,MAAM,SAAA,GAAY,IAAA,CAAK,gBAAA,CAAiB,eAAe,CAAA;AACvD,IAAA,MAAM,WAAA,GAAc,IAAA,CAAK,aAAA,CAAc,SAAS,CAAA;AAEhD,IAAA,IAAI,CAAC,WAAA,IAAe,CAAC,KAAK,SAAA,CAAU,GAAA,CAAI,WAAW,CAAA,EAAG;AACpD,MAAA,OAAO,EAAC;AAAA,IACV;AAEA,IAAA,OAAO,KAAK,SAAA,CAAU,GAAA,CAAI,WAAW,CAAA,CAAG,WAAW,MAAM,CAAA;AAAA,EAC3D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAiBA,OAAO,YAAY,MAAA,EAA8C;AAC/D,IAAA,MAAM,MAAA,uBAAa,GAAA,EAA4B;AAE/C,IAAA,KAAA,MAAW,SAAA,IAAa,SAAA,CAAU,OAAA,EAAQ,EAAG;AAI3C,MAAA,MAAM,cAAA,GAAiB,CAAC,CAAC,SAAA,CAAU,MAAA,CAAO,WAAA;AAC1C,MAAA,MAAM,aAAA,GAAgB,SAAA,CAAU,OAAA,IAAW,CAAC,SAAA,CAAU,MAAA;AAEtD,MAAA,IAAI,kBAAkB,aAAA,EAAe;AACnC,QAAA,MAAM,KAAA,GAAQ,IAAA,CAAK,GAAA,CAAI,SAAA,EAAW,MAAM,CAAA;AACxC,QAAA,IAAI,KAAA,CAAM,SAAS,CAAA,EAAG;AACpB,UAAA,MAAA,CAAO,GAAA,CAAI,SAAA,CAAU,IAAA,EAAM,KAAK,CAAA;AAAA,QAClC;AAAA,MACF;AAAA,IACF;AAEA,IAAA,OAAO,MAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,OAAO,cAAc,WAAA,EAA4C;AAC/D,IAAA,OAAO,SAAA,CAAU,OAAA,EAAQ,CAAE,IAAA,CAAK,CAAC,MAAM,IAAA,CAAK,aAAA,CAAc,CAAC,CAAA,KAAM,WAAW,CAAA;AAAA,EAC9E;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,OAAO,eAAe,WAAA,EAAkC;AACtD,IAAA,OAAO,SAAA,CAAU,OAAA,EAAQ,CAAE,MAAA,CAAO,CAAC,MAAM,IAAA,CAAK,aAAA,CAAc,CAAC,CAAA,KAAM,WAAW,CAAA;AAAA,EAChF;AAAA;AAAA;AAAA;AAAA,EAKA,OAAO,qBAAA,GAAkC;AACvC,IAAA,OAAO,KAAA,CAAM,IAAA,CAAK,IAAA,CAAK,SAAA,CAAU,MAAM,CAAA;AAAA,EACzC;AAAA;AAAA;AAAA;AAAA,EAKA,OAAO,gBAAgB,WAAA,EAA8B;AACnD,IAAA,OAAO,IAAA,CAAK,SAAA,CAAU,GAAA,CAAI,WAAW,CAAA;AAAA,EACvC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,OAAO,cAAc,SAAA,EAA0C;AAE7D,IAAA,MAAM,WAAW,SAAA,CAAU,IAAA;AAC3B,IAAA,IAAI,IAAA,CAAK,gBAAA,CAAiB,GAAA,CAAI,QAAQ,CAAA,EAAG;AACvC,MAAA,OAAO,IAAA,CAAK,gBAAA,CAAiB,GAAA,CAAI,QAAQ,CAAA;AAAA,IAC3C;AAEA,IAAA,IAAI,MAAA;AAGJ,IAAA,IAAI,SAAA,CAAU,OAAO,WAAA,EAAa;AAChC,MAAA,MAAA,GAAS,UAAU,MAAA,CAAO,WAAA;AAAA,IAC5B,CAAA,MAAA,IAES,UAAU,OAAA,EAAS;AAC1B,MAAA,MAAA,GAAS,oBAAA,CAAqB,UAAU,OAAO,CAAA;AAAA,IACjD;AAGA,IAAA,IAAA,CAAK,iBAAA,CAAkB,KAAK,gBAAgB,CAAA;AAC5C,IAAA,IAAA,CAAK,gBAAA,CAAiB,GAAA,CAAI,QAAA,EAAU,MAAM,CAAA;AAE1C,IAAA,OAAO,MAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,OAAe,kBAAwB,KAAA,EAAwB;AAC7D,IAAA,IAAI,KAAA,CAAM,IAAA,IAAQ,IAAA,CAAK,cAAA,EAAgB;AAErC,MAAA,MAAM,QAAA,GAAW,IAAA,CAAK,IAAA,CAAK,IAAA,CAAK,iBAAiB,GAAG,CAAA;AACpD,MAAA,MAAM,IAAA,GAAO,MAAM,IAAA,CAAK,KAAA,CAAM,MAAM,CAAA,CAAE,KAAA,CAAM,CAAA,EAAG,QAAQ,CAAA;AACvD,MAAA,KAAA,MAAW,OAAO,IAAA,EAAM;AACtB,QAAA,KAAA,CAAM,OAAO,GAAG,CAAA;AAAA,MAClB;AAAA,IACF;AAAA,EACF;AAAA;AAAA,EAIA,OAAe,iBAAiB,eAAA,EAAgD;AAC9E,IAAA,OAAO,OAAO,eAAA,KAAoB,QAAA,GAAW,SAAA,CAAU,GAAA,CAAI,eAAe,CAAA,GAAI,eAAA;AAAA,EAChF;AAAA,EAEA,OAAe,oBAAA,CACb,SAAA,EACA,OAAA,EACwD;AACxD,IAAA,MAAM,QAAA,GAAW,OAAA,EAAS,QAAA,IAAY,CAAA,EAAG,UAAU,IAAI,CAAA,IAAA,CAAA;AACvD,IAAA,MAAM,SAAS,OAAA,EAAS,MAAA;AAExB,IAAA,MAAM,WAAA,GACJ,OAAA,EAAS,WAAA,IACT,CAAA,kCAAA,EAAqC,SAAA,CAAU,WAAW,CAAA,CAAA,CAAA,IACvD,SAAA,CAAU,OAAA,GAAU,CAAA,WAAA,EAAc,SAAA,CAAU,OAAO,CAAA,CAAA,GAAK,gCAAA,CAAA;AAE7D,IAAA,OAAO;AAAA,MACL,UAAA,EAAY;AAAA,QACV,IAAA,EAAM,UAAA;AAAA,QACN,QAAA,EAAU;AAAA,UACR,IAAA,EAAM,QAAA;AAAA,UACN,WAAA;AAAA,UACA,UAAA,EAAY;AAAA,YACV,IAAA,EAAM,QAAA;AAAA,YACN,UAAA,EAAY;AAAA,cACV,MAAA,EAAQ;AAAA,gBACN,IAAA,EAAM,QAAA;AAAA,gBACN,MAAM,CAAC,KAAA,EAAO,MAAA,EAAQ,KAAA,EAAO,UAAU,OAAO,CAAA;AAAA,gBAC9C,WAAA,EAAa;AAAA,eACf;AAAA,cACA,QAAA,EAAU;AAAA,gBACR,IAAA,EAAM,QAAA;AAAA,gBACN,WAAA,EAAa;AAAA,eACf;AAAA,cACA,IAAA,EAAM;AAAA,gBACJ,IAAA,EAAM,QAAA;AAAA,gBACN,WAAA,EAAa;AAAA,eACf;AAAA,cACA,WAAA,EAAa;AAAA,gBACX,IAAA,EAAM,QAAA;AAAA,gBACN,WAAA,EAAa;AAAA,eACf;AAAA,cACA,OAAA,EAAS;AAAA,gBACP,IAAA,EAAM,QAAA;AAAA,gBACN,WAAA,EAAa;AAAA;AACf,aACF;AAAA,YACA,QAAA,EAAU,CAAC,QAAA,EAAU,UAAU;AAAA;AACjC;AACF,OACF;AAAA,MAEA,OAAA,EAAS,OAAO,IAAA,KAA4D;AAC1E,QAAA,IAAI,MAAM,IAAA,CAAK,QAAA;AAGf,QAAA,IAAI,IAAA,CAAK,eAAe,MAAA,CAAO,IAAA,CAAK,KAAK,WAAW,CAAA,CAAE,SAAS,CAAA,EAAG;AAChE,UAAA,MAAM,MAAA,GAAS,IAAI,eAAA,EAAgB;AACnC,UAAA,KAAA,MAAW,CAAC,KAAK,KAAK,CAAA,IAAK,OAAO,OAAA,CAAQ,IAAA,CAAK,WAAW,CAAA,EAAG;AAC3D,YAAA,MAAA,CAAO,MAAA,CAAO,GAAA,EAAK,MAAA,CAAO,KAAK,CAAC,CAAA;AAAA,UAClC;AACA,UAAA,GAAA,IAAA,CAAQ,IAAI,QAAA,CAAS,GAAG,IAAI,GAAA,GAAM,GAAA,IAAO,OAAO,QAAA,EAAS;AAAA,QAC3D;AAGA,QAAA,MAAM,WAAA,GAAc,sBAAA,CAAuB,IAAA,CAAK,OAAO,CAAA;AAGvD,QAAA,IAAI,OAAA;AACJ,QAAA,IAAI,KAAK,IAAA,EAAM;AACb,UAAA,IAAI;AACF,YAAA,OAAA,GAAUA,cAAAA,CAAc,KAAK,IAAI,CAAA;AAAA,UACnC,SAAS,CAAA,EAAG;AACV,YAAA,OAAO;AAAA,cACL,OAAA,EAAS,KAAA;AAAA,cACT,KAAA,EAAO,qCAAqC,CAAA,YAAa,KAAA,GAAQ,EAAE,OAAA,GAAU,MAAA,CAAO,CAAC,CAAC,CAAA;AAAA,aACxF;AAAA,UACF;AAAA,QACF;AAEA,QAAA,IAAI;AACF,UAAA,MAAM,QAAA,GAAW,MAAM,SAAA,CAAU,KAAA;AAAA,YAC/B,GAAA;AAAA,YACA;AAAA,cACE,QAAQ,IAAA,CAAK,MAAA;AAAA,cACb,OAAA,EAAS;AAAA,gBACP,cAAA,EAAgB,kBAAA;AAAA,gBAChB,GAAG;AAAA,eACL;AAAA,cACA,IAAA,EAAM;AAAA,aACR;AAAA,YACA;AAAA,WACF;AAGA,UAAA,MAAM,IAAA,GAAO,MAAM,QAAA,CAAS,IAAA,EAAK;AACjC,UAAA,IAAI,IAAA;AAEJ,UAAA,IAAI;AACF,YAAA,IAAA,GAAO,IAAA,CAAK,MAAM,IAAI,CAAA;AAAA,UACxB,CAAA,CAAA,MAAQ;AACN,YAAA,IAAA,GAAO,IAAA;AAAA,UACT;AAEA,UAAA,OAAO;AAAA,YACL,SAAS,QAAA,CAAS,EAAA;AAAA,YAClB,QAAQ,QAAA,CAAS,MAAA;AAAA,YACjB,IAAA,EAAM,QAAA,CAAS,EAAA,GAAK,IAAA,GAAO,KAAA,CAAA;AAAA,YAC3B,KAAA,EAAO,SAAS,EAAA,GAAK,KAAA,CAAA,GAAY,OAAO,IAAA,KAAS,QAAA,GAAW,IAAA,GAAOA,cAAAA,CAAc,IAAI;AAAA,WACvF;AAAA,QACF,SAAS,KAAA,EAAO;AACd,UAAA,OAAO;AAAA,YACL,OAAA,EAAS,KAAA;AAAA,YACT,OAAO,KAAA,YAAiB,KAAA,GAAQ,KAAA,CAAM,OAAA,GAAU,OAAO,KAAK;AAAA,WAC9D;AAAA,QACF;AAAA,MACF,CAAA;AAAA,MAEA,YAAA,EAAc,CAAC,IAAA,KAA6B,CAAA,EAAG,KAAK,MAAM,CAAA,CAAA,EAAI,KAAK,QAAQ,CAAA,CAAA;AAAA,MAE3E,UAAA,EAAY,SAAS,UAAA,IAAc;AAAA,QACjC,KAAA,EAAO,SAAA;AAAA,QACP,SAAA,EAAW,QAAA;AAAA,QACX,eAAA,EAAiB,CAAA,8BAAA,EAAiC,SAAA,CAAU,WAAW,CAAA;AAAA;AACzE,KACF;AAAA,EACF;AACF;;;ACheA,iBAAA,EAAA;;;ACuBA,kBAAA,EAAA;;;AClBA,eAAA,EAAA;AAOO,IAAM,cAAN,MAA2C;AAAA,EACxC,SAAA;AAAA,EACA,aAAA;AAAA,EAER,YAAY,MAAA,EAA2B;AACrC,IAAA,IAAI,CAAC,OAAO,aAAA,EAAe;AACzB,MAAA,MAAM,IAAI,KAAA;AAAA,QACR;AAAA,OACF;AAAA,IACF;AAEA,IAAA,IAAA,CAAK,YAAY,MAAA,CAAO,SAAA;AACxB,IAAA,IAAA,CAAK,gBAAgB,MAAA,CAAO,aAAA;AAG5B,IAAA,IAAA,CAAK,eAAA,EAAgB,CAAE,KAAA,CAAM,CAAC,KAAA,KAAU;AACtC,MAAA,OAAA,CAAQ,KAAA,CAAM,qCAAqC,KAAK,CAAA;AAAA,IAC1D,CAAC,CAAA;AAAA,EACH;AAAA,EAEA,MAAc,eAAA,GAAiC;AAC7C,IAAA,IAAI;AACF,MAAA,MAASC,WAAM,IAAA,CAAK,SAAA,EAAW,EAAE,SAAA,EAAW,MAAM,CAAA;AAElD,MAAA,MAASA,IAAA,CAAA,KAAA,CAAM,IAAA,CAAK,SAAA,EAAW,GAAK,CAAA;AAAA,IACtC,SAAS,KAAA,EAAO;AAAA,IAEhB;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,YAAY,GAAA,EAAqB;AAEvC,IAAA,MAAM,IAAA,GAAcC,mBAAW,QAAQ,CAAA,CAAE,OAAO,GAAG,CAAA,CAAE,OAAO,KAAK,CAAA;AACjE,IAAA,OAAYC,KAAA,CAAA,IAAA,CAAK,IAAA,CAAK,SAAA,EAAW,CAAA,EAAG,IAAI,CAAA,MAAA,CAAQ,CAAA;AAAA,EAClD;AAAA,EAEA,MAAM,UAAA,CAAW,GAAA,EAAa,KAAA,EAAmC;AAC/D,IAAA,MAAM,KAAK,eAAA,EAAgB;AAE3B,IAAA,MAAM,QAAA,GAAW,IAAA,CAAK,WAAA,CAAY,GAAG,CAAA;AACrC,IAAA,MAAM,SAAA,GAAY,IAAA,CAAK,SAAA,CAAU,KAAK,CAAA;AACtC,IAAA,MAAM,SAAA,GAAY,OAAA,CAAQ,SAAA,EAAW,IAAA,CAAK,aAAa,CAAA;AAGvD,IAAA,MAASF,IAAA,CAAA,SAAA,CAAU,QAAA,EAAU,SAAA,EAAW,MAAM,CAAA;AAG9C,IAAA,MAASA,IAAA,CAAA,KAAA,CAAM,UAAU,GAAK,CAAA;AAAA,EAChC;AAAA,EAEA,MAAM,SAAS,GAAA,EAA0C;AACvD,IAAA,MAAM,QAAA,GAAW,IAAA,CAAK,WAAA,CAAY,GAAG,CAAA;AAErC,IAAA,IAAI;AACF,MAAA,MAAM,SAAA,GAAY,MAASA,IAAA,CAAA,QAAA,CAAS,QAAA,EAAU,MAAM,CAAA;AACpD,MAAA,MAAM,SAAA,GAAY,OAAA,CAAQ,SAAA,EAAW,IAAA,CAAK,aAAa,CAAA;AACvD,MAAA,OAAO,IAAA,CAAK,MAAM,SAAS,CAAA;AAAA,IAC7B,SAAS,KAAA,EAAY;AACnB,MAAA,IAAI,KAAA,CAAM,SAAS,QAAA,EAAU;AAE3B,QAAA,OAAO,IAAA;AAAA,MACT;AAEA,MAAA,OAAA,CAAQ,KAAA,CAAM,sCAAsC,KAAK,CAAA;AAGzD,MAAA,IAAI;AACF,QAAA,MAASA,YAAO,QAAQ,CAAA;AAAA,MAC1B,CAAA,CAAA,MAAQ;AAAA,MAER;AAEA,MAAA,OAAO,IAAA;AAAA,IACT;AAAA,EACF;AAAA,EAEA,MAAM,YAAY,GAAA,EAA4B;AAC5C,IAAA,MAAM,QAAA,GAAW,IAAA,CAAK,WAAA,CAAY,GAAG,CAAA;AAErC,IAAA,IAAI;AACF,MAAA,MAASA,YAAO,QAAQ,CAAA;AAAA,IAC1B,SAAS,KAAA,EAAY;AACnB,MAAA,IAAI,KAAA,CAAM,SAAS,QAAA,EAAU;AAC3B,QAAA,MAAM,KAAA;AAAA,MACR;AAAA,IAEF;AAAA,EACF;AAAA,EAEA,MAAM,SAAS,GAAA,EAA+B;AAC5C,IAAA,MAAM,QAAA,GAAW,IAAA,CAAK,WAAA,CAAY,GAAG,CAAA;AAErC,IAAA,IAAI;AACF,MAAA,MAASA,YAAO,QAAQ,CAAA;AACxB,MAAA,OAAO,IAAA;AAAA,IACT,CAAA,CAAA,MAAQ;AACN,MAAA,OAAO,KAAA;AAAA,IACT;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,UAAA,GAAgC;AACpC,IAAA,IAAI;AACF,MAAA,MAAM,KAAA,GAAQ,MAASA,IAAA,CAAA,OAAA,CAAQ,IAAA,CAAK,SAAS,CAAA;AAC7C,MAAA,OAAO,MAAM,MAAA,CAAO,CAAC,CAAA,KAAM,CAAA,CAAE,SAAS,QAAQ,CAAC,CAAA,CAAE,GAAA,CAAI,CAAC,CAAA,KAAM,CAAA,CAAE,OAAA,CAAQ,QAAA,EAAU,EAAE,CAAC,CAAA;AAAA,IACrF,CAAA,CAAA,MAAQ;AACN,MAAA,OAAO,EAAC;AAAA,IACV;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,QAAA,GAA0B;AAC9B,IAAA,IAAI;AACF,MAAA,MAAM,KAAA,GAAQ,MAASA,IAAA,CAAA,OAAA,CAAQ,IAAA,CAAK,SAAS,CAAA;AAC7C,MAAA,MAAM,UAAA,GAAa,MAAM,MAAA,CAAO,CAAC,MAAM,CAAA,CAAE,QAAA,CAAS,QAAQ,CAAC,CAAA;AAE3D,MAAA,MAAM,OAAA,CAAQ,GAAA;AAAA,QACZ,UAAA,CAAW,GAAA,CAAI,CAAC,CAAA,KAASA,IAAA,CAAA,MAAA,CAAYE,KAAA,CAAA,IAAA,CAAK,IAAA,CAAK,SAAA,EAAW,CAAC,CAAC,CAAA,CAAE,KAAA,CAAM,MAAM;AAAA,QAAC,CAAC,CAAC;AAAA,OAC/E;AAAA,IACF,CAAA,CAAA,MAAQ;AAAA,IAER;AAAA,EACF;AACF;;;AC9IA,cAAA,EAAA;AAmCA,eAAsB,kBAAA,CACpB,GAAA,EACA,OAAA,EACA,YAAA,EACA,MAAA,EACmB;AAEnB,EAAA,MAAM,SAAA,GAAY,SAAA,CAAU,GAAA,CAAI,YAAY,CAAA;AAG5C,EAAA,MAAM,KAAA,GAAQ,MAAM,SAAA,CAAU,QAAA,CAAS,MAAM,CAAA;AAG7C,EAAA,MAAM,WAAA,GAA2B;AAAA,IAC/B,GAAG,OAAA;AAAA,IACH,OAAA,EAAS;AAAA,MACP,GAAG,OAAA,EAAS,OAAA;AAAA,MACZ,aAAA,EAAe,UAAU,KAAK,CAAA;AAAA;AAChC,GACF;AAGA,EAAA,OAAO,KAAA,CAAM,KAAK,WAAW,CAAA;AAC/B;AA8CO,SAAS,wBAAA,CACd,cACA,MAAA,EACiE;AAEjE,EAAA,SAAA,CAAU,IAAI,YAAY,CAAA;AAE1B,EAAA,OAAO,OAAO,KAAmB,OAAA,KAA0B;AACzD,IAAA,OAAO,kBAAA,CAAmB,GAAA,EAAK,OAAA,EAAS,YAAA,EAAc,MAAM,CAAA;AAAA,EAC9D,CAAA;AACF;;;ACjHA,cAAA,EAAA;AA2BO,SAAS,kBAAA,GAAqE;AACnF,EAAA,OAAO;AAAA,IACL,UAAA,EAAY;AAAA,MACV,IAAA,EAAM,UAAA;AAAA,MACN,QAAA,EAAU;AAAA,QACR,IAAA,EAAM,aAAA;AAAA,QACN,WAAA,EAAa,CAAA;;AAAA;;AAAA;AAAA,EAKnB,SAAA,CAAU,yBAAyB;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,CAAA,CAAA;AAAA,QA+B7B,UAAA,EAAY;AAAA,UACV,IAAA,EAAM,QAAA;AAAA,UACN,UAAA,EAAY;AAAA,YACV,YAAA,EAAc;AAAA,cACZ,IAAA,EAAM,QAAA;AAAA,cACN,IAAA,EAAM,UAAU,IAAA,EAAK;AAAA,cACrB,WAAA,EACE;AAAA,aACJ;AAAA,YACA,GAAA,EAAK;AAAA,cACH,IAAA,EAAM,QAAA;AAAA,cACN,WAAA,EACE;AAAA,aACJ;AAAA,YACA,MAAA,EAAQ;AAAA,cACN,IAAA,EAAM,QAAA;AAAA,cACN,MAAM,CAAC,KAAA,EAAO,MAAA,EAAQ,KAAA,EAAO,UAAU,OAAO,CAAA;AAAA,cAC9C,WAAA,EAAa;AAAA,aACf;AAAA,YACA,IAAA,EAAM;AAAA,cACJ,WAAA,EACE;AAAA,aACJ;AAAA,YACA,OAAA,EAAS;AAAA,cACP,IAAA,EAAM,QAAA;AAAA,cACN,WAAA,EACE;AAAA;AACJ,WACF;AAAA,UACA,QAAA,EAAU,CAAC,cAAA,EAAgB,KAAK;AAAA;AAClC,OACF;AAAA,MACA,QAAA,EAAU,IAAA;AAAA,MACV,OAAA,EAAS;AAAA,KACX;AAAA,IAEA,OAAA,EAAS,OAAO,IAAA,KAAoD;AAClE,MAAA,IAAI;AAEF,QAAA,MAAM,SAAA,GAAY,SAAA,CAAU,GAAA,CAAI,IAAA,CAAK,YAAY,CAAA;AAGjD,QAAA,MAAM,OAAA,GAAU,IAAA,CAAK,GAAA,CAAI,UAAA,CAAW,MAAM,CAAA,GACtC,IAAA,CAAK,GAAA,GACL,CAAA,EAAG,SAAA,CAAU,OAAO,CAAA,EAAG,KAAK,GAAG,CAAA,CAAA;AAGnC,QAAA,MAAM,cAAA,GAA8B;AAAA,UAClC,MAAA,EAAQ,KAAK,MAAA,IAAU,KAAA;AAAA,UACvB,OAAA,EAAS;AAAA,YACP,cAAA,EAAgB,kBAAA;AAAA,YAChB,GAAG,IAAA,CAAK;AAAA;AACV,SACF;AAGA,QAAA,IAAI,IAAA,CAAK,IAAA,KAAS,IAAA,CAAK,MAAA,KAAW,MAAA,IAAU,KAAK,MAAA,KAAW,KAAA,IAAS,IAAA,CAAK,MAAA,KAAW,OAAA,CAAA,EAAU;AAC7F,UAAA,cAAA,CAAe,IAAA,GAAO,IAAA,CAAK,SAAA,CAAU,IAAA,CAAK,IAAI,CAAA;AAAA,QAChD;AAGA,QAAA,MAAM,WAAW,MAAM,kBAAA,CAAmB,OAAA,EAAS,cAAA,EAAgB,KAAK,YAAY,CAAA;AAGpF,QAAA,MAAM,WAAA,GAAc,QAAA,CAAS,OAAA,CAAQ,GAAA,CAAI,cAAc,CAAA,IAAK,EAAA;AAC5D,QAAA,IAAI,IAAA;AAEJ,QAAA,IAAI,WAAA,CAAY,QAAA,CAAS,kBAAkB,CAAA,EAAG;AAC5C,UAAA,IAAA,GAAO,MAAM,SAAS,IAAA,EAAK;AAAA,QAC7B,CAAA,MAAO;AACL,UAAA,IAAA,GAAO,MAAM,SAAS,IAAA,EAAK;AAAA,QAC7B;AAEA,QAAA,OAAO;AAAA,UACL,SAAS,QAAA,CAAS,EAAA;AAAA,UAClB,QAAQ,QAAA,CAAS,MAAA;AAAA,UACjB,YAAY,QAAA,CAAS,UAAA;AAAA,UACrB;AAAA,SACF;AAAA,MACF,SAAS,KAAA,EAAO;AACd,QAAA,OAAO;AAAA,UACL,OAAA,EAAS,KAAA;AAAA,UACT,MAAA,EAAQ,CAAA;AAAA,UACR,UAAA,EAAY,OAAA;AAAA,UACZ,IAAA,EAAM,IAAA;AAAA,UACN,OAAQ,KAAA,CAAgB;AAAA,SAC1B;AAAA,MACF;AAAA,IACF;AAAA,GACF;AACF;;;AHhIA,SAAA,EAAA;AACA,eAAA,EAAA;;;AI8CO,IAAM,wBAAA,GAA2B;;;ACtExC,eAAA,EAAA;AAGA,IAAM,gBAAA,GAAmB,QAAA;AAclB,IAAM,uBAAN,MAA2B;AAAA,EAChC,WAAA,CACU,SACA,aAAA,EACR;AAFQ,IAAA,IAAA,CAAA,OAAA,GAAA,OAAA;AACA,IAAA,IAAA,CAAA,aAAA,GAAA,aAAA;AAER,IAAA,IAAI,CAAC,aAAA,IAAiB,aAAA,CAAc,MAAA,GAAS,EAAA,EAAI;AAC/C,MAAA,MAAM,IAAI,KAAA;AAAA,QACR;AAAA,OACF;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,MAAM,IAAA,CAAK,IAAA,EAAc,MAAA,EAAwC;AAC/D,IAAA,IAAI,CAAC,IAAA,IAAQ,IAAA,CAAK,IAAA,EAAK,CAAE,WAAW,CAAA,EAAG;AACrC,MAAA,MAAM,IAAI,MAAM,4BAA4B,CAAA;AAAA,IAC9C;AAEA,IAAA,MAAM,QAAA,GAAW,MAAM,IAAA,CAAK,OAAA,CAAQ,IAAI,IAAI,CAAA;AAC5C,IAAA,MAAM,GAAA,GAAM,KAAK,GAAA,EAAI;AAErB,IAAA,MAAM,eAAA,GAAkB,IAAA,CAAK,cAAA,CAAe,MAAM,CAAA;AAElD,IAAA,MAAM,MAAA,GAAgC;AAAA,MACpC,MAAA,EAAQ,EAAE,GAAG,eAAA,EAAiB,IAAA,EAAK;AAAA,MACnC,SAAA,EAAW,UAAU,SAAA,IAAa,GAAA;AAAA,MAClC,SAAA,EAAW,GAAA;AAAA,MACX,OAAA,EAAS;AAAA,KACX;AAEA,IAAA,MAAM,IAAA,CAAK,OAAA,CAAQ,IAAA,CAAK,IAAA,EAAM,MAAM,CAAA;AAAA,EACtC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,MAAM,IAAI,IAAA,EAA+C;AACvD,IAAA,MAAM,MAAA,GAAS,MAAM,IAAA,CAAK,OAAA,CAAQ,IAAI,IAAI,CAAA;AAC1C,IAAA,IAAI,CAAC,MAAA,EAAQ;AACX,MAAA,OAAO,IAAA;AAAA,IACT;AAEA,IAAA,OAAO,IAAA,CAAK,cAAA,CAAe,MAAA,CAAO,MAAM,CAAA;AAAA,EAC1C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,MAAM,OAAO,IAAA,EAAgC;AAC3C,IAAA,OAAO,IAAA,CAAK,OAAA,CAAQ,MAAA,CAAO,IAAI,CAAA;AAAA,EACjC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,MAAM,IAAI,IAAA,EAAgC;AACxC,IAAA,OAAO,IAAA,CAAK,OAAA,CAAQ,GAAA,CAAI,IAAI,CAAA;AAAA,EAC9B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,MAAM,IAAA,GAA0B;AAC9B,IAAA,OAAO,IAAA,CAAK,QAAQ,IAAA,EAAK;AAAA,EAC3B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,MAAM,OAAA,GAAsC;AAC1C,IAAA,MAAM,MAAA,GAAS,MAAM,IAAA,CAAK,OAAA,CAAQ,OAAA,EAAQ;AAC1C,IAAA,OAAO,MAAA,CAAO,IAAI,CAAC,CAAA,KAAM,KAAK,cAAA,CAAe,CAAA,CAAE,MAAM,CAAC,CAAA;AAAA,EACxD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,MAAM,YACJ,IAAA,EAC2E;AAC3E,IAAA,MAAM,MAAA,GAAS,MAAM,IAAA,CAAK,OAAA,CAAQ,IAAI,IAAI,CAAA;AAC1C,IAAA,IAAI,CAAC,MAAA,EAAQ;AACX,MAAA,OAAO,IAAA;AAAA,IACT;AACA,IAAA,OAAO;AAAA,MACL,WAAW,MAAA,CAAO,SAAA;AAAA,MAClB,WAAW,MAAA,CAAO,SAAA;AAAA,MAClB,SAAS,MAAA,CAAO;AAAA,KAClB;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQQ,eAAe,MAAA,EAA0C;AAC/D,IAAA,MAAM,MAAA,GAAS,EAAE,GAAG,MAAA,EAAO;AAE3B,IAAA,IAAI,OAAO,IAAA,EAAM;AACf,MAAA,MAAA,CAAO,IAAA,GAAO,IAAA,CAAK,kBAAA,CAAmB,MAAA,CAAO,IAAI,CAAA;AAAA,IACnD;AAEA,IAAA,OAAO,MAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKQ,eAAe,MAAA,EAA0C;AAC/D,IAAA,MAAM,MAAA,GAAS,EAAE,GAAG,MAAA,EAAO;AAE3B,IAAA,IAAI,OAAO,IAAA,EAAM;AACf,MAAA,MAAA,CAAO,IAAA,GAAO,IAAA,CAAK,kBAAA,CAAmB,MAAA,CAAO,IAAI,CAAA;AAAA,IACnD;AAEA,IAAA,OAAO,MAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKQ,mBAAmB,IAAA,EAAoC;AAC7D,IAAA,QAAQ,KAAK,IAAA;AAAM,MACjB,KAAK,SAAA;AACH,QAAA,OAAO;AAAA,UACL,GAAG,IAAA;AAAA,UACH,MAAA,EAAQ,IAAA,CAAK,YAAA,CAAa,IAAA,CAAK,MAAM;AAAA,SACvC;AAAA,MAEF,KAAK,OAAA;AACH,QAAA,OAAO;AAAA,UACL,GAAG,IAAA;AAAA,UACH,cAAc,IAAA,CAAK,YAAA,GACf,KAAK,YAAA,CAAa,IAAA,CAAK,YAAY,CAAA,GACnC,MAAA;AAAA,UACJ,YAAY,IAAA,CAAK,UAAA,GACb,KAAK,YAAA,CAAa,IAAA,CAAK,UAAU,CAAA,GACjC;AAAA,SACN;AAAA,MAEF,KAAK,KAAA;AACH,QAAA,OAAO;AAAA,UACL,GAAG,IAAA;AAAA,UACH,UAAA,EAAY,IAAA,CAAK,YAAA,CAAa,IAAA,CAAK,UAAU;AAAA,SAC/C;AAAA,MAEF;AACE,QAAA,OAAO,IAAA;AAAA;AACX,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,mBAAmB,IAAA,EAAoC;AAC7D,IAAA,QAAQ,KAAK,IAAA;AAAM,MACjB,KAAK,SAAA;AACH,QAAA,OAAO;AAAA,UACL,GAAG,IAAA;AAAA,UACH,MAAA,EAAQ,IAAA,CAAK,YAAA,CAAa,IAAA,CAAK,MAAM;AAAA,SACvC;AAAA,MAEF,KAAK,OAAA;AACH,QAAA,OAAO;AAAA,UACL,GAAG,IAAA;AAAA,UACH,cAAc,IAAA,CAAK,YAAA,GACf,KAAK,YAAA,CAAa,IAAA,CAAK,YAAY,CAAA,GACnC,MAAA;AAAA,UACJ,YAAY,IAAA,CAAK,UAAA,GACb,KAAK,YAAA,CAAa,IAAA,CAAK,UAAU,CAAA,GACjC;AAAA,SACN;AAAA,MAEF,KAAK,KAAA;AACH,QAAA,OAAO;AAAA,UACL,GAAG,IAAA;AAAA,UACH,UAAA,EAAY,IAAA,CAAK,YAAA,CAAa,IAAA,CAAK,UAAU;AAAA,SAC/C;AAAA,MAEF;AACE,QAAA,OAAO,IAAA;AAAA;AACX,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,aAAa,KAAA,EAAuB;AAC1C,IAAA,IAAI,IAAA,CAAK,WAAA,CAAY,KAAK,CAAA,EAAG;AAC3B,MAAA,OAAO,KAAA;AAAA,IACT;AACA,IAAA,MAAM,SAAA,GAAY,OAAA,CAAQ,KAAA,EAAO,IAAA,CAAK,aAAa,CAAA;AACnD,IAAA,OAAO,CAAA,EAAG,gBAAgB,CAAA,EAAG,SAAS,CAAA,CAAA;AAAA,EACxC;AAAA;AAAA;AAAA;AAAA,EAKQ,aAAa,KAAA,EAAuB;AAC1C,IAAA,IAAI,CAAC,IAAA,CAAK,WAAA,CAAY,KAAK,CAAA,EAAG;AAC5B,MAAA,OAAO,KAAA;AAAA,IACT;AACA,IAAA,MAAM,aAAA,GAAgB,KAAA,CAAM,KAAA,CAAM,gBAAA,CAAiB,MAAM,CAAA;AACzD,IAAA,OAAO,OAAA,CAAQ,aAAA,EAAe,IAAA,CAAK,aAAa,CAAA;AAAA,EAClD;AAAA;AAAA;AAAA;AAAA,EAKQ,YAAY,KAAA,EAAwB;AAC1C,IAAA,OAAO,KAAA,CAAM,WAAW,gBAAgB,CAAA;AAAA,EAC1C;AACF;;;ACtPO,IAAM,yBAAN,MAAgE;AAAA,EAC7D,OAAA,uBAAkD,GAAA,EAAI;AAAA,EAE9D,MAAM,IAAA,CAAK,IAAA,EAAc,MAAA,EAA8C;AAErE,IAAA,IAAA,CAAK,OAAA,CAAQ,IAAI,IAAA,EAAM,IAAA,CAAK,MAAM,IAAA,CAAK,SAAA,CAAU,MAAM,CAAC,CAAC,CAAA;AAAA,EAC3D;AAAA,EAEA,MAAM,IAAI,IAAA,EAAqD;AAC7D,IAAA,MAAM,MAAA,GAAS,IAAA,CAAK,OAAA,CAAQ,GAAA,CAAI,IAAI,CAAA;AACpC,IAAA,IAAI,CAAC,MAAA,EAAQ;AACX,MAAA,OAAO,IAAA;AAAA,IACT;AAEA,IAAA,OAAO,IAAA,CAAK,KAAA,CAAM,IAAA,CAAK,SAAA,CAAU,MAAM,CAAC,CAAA;AAAA,EAC1C;AAAA,EAEA,MAAM,OAAO,IAAA,EAAgC;AAC3C,IAAA,OAAO,IAAA,CAAK,OAAA,CAAQ,MAAA,CAAO,IAAI,CAAA;AAAA,EACjC;AAAA,EAEA,MAAM,IAAI,IAAA,EAAgC;AACxC,IAAA,OAAO,IAAA,CAAK,OAAA,CAAQ,GAAA,CAAI,IAAI,CAAA;AAAA,EAC9B;AAAA,EAEA,MAAM,IAAA,GAA0B;AAC9B,IAAA,OAAO,KAAA,CAAM,IAAA,CAAK,IAAA,CAAK,OAAA,CAAQ,MAAM,CAAA;AAAA,EACvC;AAAA,EAEA,MAAM,OAAA,GAA4C;AAEhD,IAAA,OAAO,MAAM,IAAA,CAAK,IAAA,CAAK,OAAA,CAAQ,MAAA,EAAQ,CAAA,CAAE,GAAA;AAAA,MAAI,CAAC,MAAA,KAC5C,IAAA,CAAK,MAAM,IAAA,CAAK,SAAA,CAAU,MAAM,CAAC;AAAA,KACnC;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,KAAA,GAAc;AACZ,IAAA,IAAA,CAAK,QAAQ,KAAA,EAAM;AAAA,EACrB;AAAA;AAAA;AAAA;AAAA,EAKA,IAAA,GAAe;AACb,IAAA,OAAO,KAAK,OAAA,CAAQ,IAAA;AAAA,EACtB;AACF;ACvCO,IAAM,uBAAN,MAA8D;AAAA,EAC3D,SAAA;AAAA,EACA,SAAA;AAAA,EACA,WAAA,GAAc,KAAA;AAAA,EAEtB,YAAY,MAAA,EAAoC;AAC9C,IAAA,IAAI,CAAC,OAAO,SAAA,EAAW;AACrB,MAAA,MAAM,IAAI,MAAM,gDAAgD,CAAA;AAAA,IAClE;AACA,IAAA,IAAA,CAAK,YAAY,MAAA,CAAO,SAAA;AACxB,IAAA,IAAA,CAAK,SAAA,GAAiBC,KAAA,CAAA,IAAA,CAAK,IAAA,CAAK,SAAA,EAAW,aAAa,CAAA;AAAA,EAC1D;AAAA,EAEA,MAAM,IAAA,CAAK,IAAA,EAAc,MAAA,EAA8C;AACrE,IAAA,MAAM,KAAK,eAAA,EAAgB;AAE3B,IAAA,MAAM,QAAA,GAAW,IAAA,CAAK,WAAA,CAAY,IAAI,CAAA;AACtC,IAAA,MAAM,IAAA,GAAO,IAAA,CAAK,SAAA,CAAU,MAAA,EAAQ,MAAM,CAAC,CAAA;AAG3C,IAAA,MAAS,IAAA,CAAA,SAAA,CAAU,QAAA,EAAU,IAAA,EAAM,MAAM,CAAA;AACzC,IAAA,MAAS,IAAA,CAAA,KAAA,CAAM,UAAU,GAAK,CAAA;AAG9B,IAAA,MAAM,IAAA,CAAK,WAAA,CAAY,IAAA,EAAM,KAAK,CAAA;AAAA,EACpC;AAAA,EAEA,MAAM,IAAI,IAAA,EAAqD;AAC7D,IAAA,MAAM,QAAA,GAAW,IAAA,CAAK,WAAA,CAAY,IAAI,CAAA;AAEtC,IAAA,IAAI;AACF,MAAA,MAAM,IAAA,GAAO,MAAS,IAAA,CAAA,QAAA,CAAS,QAAA,EAAU,MAAM,CAAA;AAC/C,MAAA,OAAO,IAAA,CAAK,MAAM,IAAI,CAAA;AAAA,IACxB,SAAS,KAAA,EAAgB;AACvB,MAAA,MAAM,GAAA,GAAM,KAAA;AACZ,MAAA,IAAI,GAAA,CAAI,SAAS,QAAA,EAAU;AACzB,QAAA,OAAO,IAAA;AAAA,MACT;AACA,MAAA,MAAM,KAAA;AAAA,IACR;AAAA,EACF;AAAA,EAEA,MAAM,OAAO,IAAA,EAAgC;AAC3C,IAAA,MAAM,QAAA,GAAW,IAAA,CAAK,WAAA,CAAY,IAAI,CAAA;AAEtC,IAAA,IAAI;AACF,MAAA,MAAS,YAAO,QAAQ,CAAA;AACxB,MAAA,MAAM,IAAA,CAAK,WAAA,CAAY,IAAA,EAAM,QAAQ,CAAA;AACrC,MAAA,OAAO,IAAA;AAAA,IACT,SAAS,KAAA,EAAgB;AACvB,MAAA,MAAM,GAAA,GAAM,KAAA;AACZ,MAAA,IAAI,GAAA,CAAI,SAAS,QAAA,EAAU;AACzB,QAAA,OAAO,KAAA;AAAA,MACT;AACA,MAAA,MAAM,KAAA;AAAA,IACR;AAAA,EACF;AAAA,EAEA,MAAM,IAAI,IAAA,EAAgC;AACxC,IAAA,MAAM,QAAA,GAAW,IAAA,CAAK,WAAA,CAAY,IAAI,CAAA;AAEtC,IAAA,IAAI;AACF,MAAA,MAAS,YAAO,QAAQ,CAAA;AACxB,MAAA,OAAO,IAAA;AAAA,IACT,CAAA,CAAA,MAAQ;AACN,MAAA,OAAO,KAAA;AAAA,IACT;AAAA,EACF;AAAA,EAEA,MAAM,IAAA,GAA0B;AAC9B,IAAA,MAAM,KAAA,GAAQ,MAAM,IAAA,CAAK,SAAA,EAAU;AACnC,IAAA,OAAO,MAAA,CAAO,MAAA,CAAO,KAAA,CAAM,UAAU,CAAA;AAAA,EACvC;AAAA,EAEA,MAAM,OAAA,GAA4C;AAChD,IAAA,MAAM,KAAA,GAAQ,MAAM,IAAA,CAAK,IAAA,EAAK;AAC9B,IAAA,MAAM,UAAmC,EAAC;AAE1C,IAAA,KAAA,MAAW,QAAQ,KAAA,EAAO;AACxB,MAAA,MAAM,MAAA,GAAS,MAAM,IAAA,CAAK,GAAA,CAAI,IAAI,CAAA;AAClC,MAAA,IAAI,MAAA,EAAQ;AACV,QAAA,OAAA,CAAQ,KAAK,MAAM,CAAA;AAAA,MACrB;AAAA,IACF;AAEA,IAAA,OAAO,OAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,KAAA,GAAuB;AAC3B,IAAA,IAAI;AACF,MAAA,MAAM,KAAA,GAAQ,MAAS,IAAA,CAAA,OAAA,CAAQ,IAAA,CAAK,SAAS,CAAA;AAC7C,MAAA,MAAM,iBAAiB,KAAA,CAAM,MAAA;AAAA,QAC3B,CAAC,CAAA,KAAM,CAAA,CAAE,QAAA,CAAS,iBAAiB,KAAK,CAAA,KAAM;AAAA,OAChD;AAEA,MAAA,MAAM,OAAA,CAAQ,GAAA;AAAA,QACZ,cAAA,CAAe,GAAA;AAAA,UAAI,CAAC,CAAA,KACf,IAAA,CAAA,MAAA,CAAYA,KAAA,CAAA,IAAA,CAAK,IAAA,CAAK,WAAW,CAAC,CAAC,CAAA,CAAE,KAAA,CAAM,MAAM;AAAA,UAAC,CAAC;AAAA;AACxD,OACF;AAAA,IACF,CAAA,CAAA,MAAQ;AAAA,IAER;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAOQ,YAAY,IAAA,EAAsB;AACxC,IAAA,MAAM,IAAA,GAAO,IAAA,CAAK,QAAA,CAAS,IAAI,CAAA;AAC/B,IAAA,OAAYA,KAAA,CAAA,IAAA,CAAK,IAAA,CAAK,SAAA,EAAW,CAAA,EAAG,IAAI,CAAA,eAAA,CAAiB,CAAA;AAAA,EAC3D;AAAA;AAAA;AAAA;AAAA,EAKQ,SAAS,IAAA,EAAsB;AACrC,IAAA,OAAcC,OAAA,CAAA,UAAA,CAAW,QAAQ,CAAA,CAAE,MAAA,CAAO,IAAI,CAAA,CAAE,MAAA,CAAO,KAAK,CAAA,CAAE,KAAA,CAAM,CAAA,EAAG,EAAE,CAAA;AAAA,EAC3E;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,eAAA,GAAiC;AAC7C,IAAA,IAAI,KAAK,WAAA,EAAa;AAEtB,IAAA,IAAI;AACF,MAAA,MAAS,WAAM,IAAA,CAAK,SAAA,EAAW,EAAE,SAAA,EAAW,MAAM,CAAA;AAClD,MAAA,MAAS,IAAA,CAAA,KAAA,CAAM,IAAA,CAAK,SAAA,EAAW,GAAK,CAAA;AACpC,MAAA,IAAA,CAAK,WAAA,GAAc,IAAA;AAAA,IACrB,CAAA,CAAA,MAAQ;AAEN,MAAA,IAAA,CAAK,WAAA,GAAc,IAAA;AAAA,IACrB;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,SAAA,GAAgC;AAC5C,IAAA,IAAI;AACF,MAAA,MAAM,IAAA,GAAO,MAAS,IAAA,CAAA,QAAA,CAAS,IAAA,CAAK,WAAW,MAAM,CAAA;AACrD,MAAA,OAAO,IAAA,CAAK,MAAM,IAAI,CAAA;AAAA,IACxB,CAAA,CAAA,MAAQ;AACN,MAAA,OAAO,EAAE,UAAA,EAAY,EAAC,EAAE;AAAA,IAC1B;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,WAAA,CACZ,IAAA,EACA,MAAA,EACe;AACf,IAAA,MAAM,KAAA,GAAQ,MAAM,IAAA,CAAK,SAAA,EAAU;AACnC,IAAA,MAAM,IAAA,GAAO,IAAA,CAAK,QAAA,CAAS,IAAI,CAAA;AAE/B,IAAA,IAAI,WAAW,KAAA,EAAO;AACpB,MAAA,KAAA,CAAM,UAAA,CAAW,IAAI,CAAA,GAAI,IAAA;AAAA,IAC3B,CAAA,MAAO;AACL,MAAA,OAAO,KAAA,CAAM,WAAW,IAAI,CAAA;AAAA,IAC9B;AAEA,IAAA,MAAM,IAAA,GAAO,IAAA,CAAK,SAAA,CAAU,KAAA,EAAO,MAAM,CAAC,CAAA;AAC1C,IAAA,MAAS,IAAA,CAAA,SAAA,CAAU,IAAA,CAAK,SAAA,EAAW,IAAA,EAAM,MAAM,CAAA;AAC/C,IAAA,MAAS,IAAA,CAAA,KAAA,CAAM,IAAA,CAAK,SAAA,EAAW,GAAK,CAAA;AAAA,EACtC;AACF;;;ACtMA,WAAA,EAAA;AAGA,YAAA,EAAA;;;ACIO,IAAM,iBAAN,MAAqB;AAAA,EAClB,WAAwB,EAAC;AAAA;AAAA;AAAA;AAAA,EAKjC,eAAe,IAAA,EAAoB;AACjC,IAAA,IAAA,CAAK,SAAS,IAAA,CAAK;AAAA,MACjB,IAAA,EAAM,SAAA;AAAA,MACN,IAAA,EAAA,MAAA;AAAA,MACA,OAAA,EAAS;AAAA,QACP;AAAA,UACE,IAAA,EAAA,YAAA;AAAA,UACA;AAAA;AACF;AACF,KACD,CAAA;AACD,IAAA,OAAO,IAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,wBAAA,CAAyB,MAAc,SAAA,EAA2B;AAChE,IAAA,MAAM,OAAA,GAAoD;AAAA,MACxD;AAAA,QACE,IAAA,EAAA,YAAA;AAAA,QACA;AAAA;AACF,KACF;AAGA,IAAA,KAAA,MAAW,OAAO,SAAA,EAAW;AAC3B,MAAA,OAAA,CAAQ,IAAA,CAAK;AAAA,QACX,IAAA,EAAA,iBAAA;AAAA,QACA,SAAA,EAAW;AAAA,UACT,GAAA;AAAA,UACA,MAAA,EAAQ;AAAA;AAAA;AACV,OACD,CAAA;AAAA,IACH;AAEA,IAAA,IAAA,CAAK,SAAS,IAAA,CAAK;AAAA,MACjB,IAAA,EAAM,SAAA;AAAA,MACN,IAAA,EAAA,MAAA;AAAA,MACA;AAAA,KACD,CAAA;AAED,IAAA,OAAO,IAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,oBAAoB,IAAA,EAAoB;AACtC,IAAA,IAAA,CAAK,SAAS,IAAA,CAAK;AAAA,MACjB,IAAA,EAAM,SAAA;AAAA,MACN,IAAA,EAAA,WAAA;AAAA,MACA,OAAA,EAAS;AAAA,QACP;AAAA,UACE,IAAA,EAAA,aAAA;AAAA,UACA,IAAA;AAAA,UACA,aAAa;AAAC;AAChB;AACF,KACD,CAAA;AACD,IAAA,OAAO,IAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,oBAAoB,IAAA,EAAoB;AACtC,IAAA,IAAA,CAAK,SAAS,IAAA,CAAK;AAAA,MACjB,IAAA,EAAM,SAAA;AAAA,MACN,IAAA,EAAA,WAAA;AAAA,MACA,OAAA,EAAS;AAAA,QACP;AAAA,UACE,IAAA,EAAA,YAAA;AAAA,UACA;AAAA;AACF;AACF,KACD,CAAA;AACD,IAAA,OAAO,IAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,KAAA,GAAqB;AACnB,IAAA,OAAO,IAAA,CAAK,QAAA;AAAA,EACd;AAAA;AAAA;AAAA;AAAA,EAKA,KAAA,GAAc;AACZ,IAAA,IAAA,CAAK,WAAW,EAAC;AACjB,IAAA,OAAO,IAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,KAAA,GAAgB;AACd,IAAA,OAAO,KAAK,QAAA,CAAS,MAAA;AAAA,EACvB;AACF;AAKO,SAAS,iBAAA,CAAkB,MAAc,IAAA,GAAA,MAAA,aAAiD;AAC/F,EAAA,OAAO;AAAA,IACL,IAAA,EAAM,SAAA;AAAA,IACN,IAAA;AAAA,IACA,OAAA,EAAS;AAAA,MACP;AAAA,QACE,IAAA,EAAA,YAAA;AAAA,QACA;AAAA;AACF;AACF,GACF;AACF;AAKO,SAAS,uBAAA,CACd,IAAA,EACA,SAAA,EACA,IAAA,GAAA,MAAA,aACW;AACX,EAAA,MAAM,OAAA,GAAoD;AAAA,IACxD;AAAA,MACE,IAAA,EAAA,YAAA;AAAA,MACA;AAAA;AACF,GACF;AAEA,EAAA,KAAA,MAAW,OAAO,SAAA,EAAW;AAC3B,IAAA,OAAA,CAAQ,IAAA,CAAK;AAAA,MACX,IAAA,EAAA,iBAAA;AAAA,MACA,SAAA,EAAW;AAAA,QACT,GAAA;AAAA,QACA,MAAA,EAAQ;AAAA;AACV,KACD,CAAA;AAAA,EACH;AAEA,EAAA,OAAO;AAAA,IACL,IAAA,EAAM,SAAA;AAAA,IACN,IAAA;AAAA,IACA;AAAA,GACF;AACF;AC3JA,IAAM,SAAA,GAAY,UAAU,IAAI,CAAA;AAKhC,SAAS,gBAAgB,QAAA,EAAwB;AAC/C,EAAA,IAAI;AACF,IAAA,IAAO,IAAA,CAAA,UAAA,CAAW,QAAQ,CAAA,EAAG;AAC3B,MAAG,gBAAW,QAAQ,CAAA;AAAA,IACxB;AAAA,EACF,CAAA,CAAA,MAAQ;AAAA,EAER;AACF;AAYA,eAAsB,kBAAA,GAAoD;AACxE,EAAA,MAAM3B,YAAc,EAAA,CAAA,QAAA,EAAS;AAE7B,EAAA,IAAI;AACF,IAAA,QAAQA,SAAAA;AAAU,MAChB,KAAK,QAAA;AACH,QAAA,OAAO,MAAM,qBAAA,EAAsB;AAAA,MACrC,KAAK,OAAA;AACH,QAAA,OAAO,MAAM,uBAAA,EAAwB;AAAA,MACvC,KAAK,OAAA;AACH,QAAA,OAAO,MAAM,yBAAA,EAA0B;AAAA,MACzC;AACE,QAAA,OAAO;AAAA,UACL,OAAA,EAAS,KAAA;AAAA,UACT,KAAA,EAAO,yBAAyBA,SAAQ,CAAA;AAAA,SAC1C;AAAA;AACJ,EACF,SAAS,KAAA,EAAY;AACnB,IAAA,OAAO;AAAA,MACL,OAAA,EAAS,KAAA;AAAA,MACT,OAAO,KAAA,CAAM;AAAA,KACf;AAAA,EACF;AACF;AAKA,eAAe,qBAAA,GAAuD;AACpE,EAAA,MAAM,QAAA,GAAgB4B,WAAQ,EAAA,CAAA,MAAA,EAAO,EAAG,aAAa,IAAA,CAAK,GAAA,EAAK,CAAA,IAAA,CAAM,CAAA;AAErE,EAAA,IAAI;AAEF,IAAA,IAAI;AACF,MAAA,MAAM,SAAA,CAAU,CAAA,UAAA,EAAa,QAAQ,CAAA,CAAA,CAAG,CAAA;AACxC,MAAA,OAAO,MAAM,qBAAqB,QAAQ,CAAA;AAAA,IAC5C,SAAS,aAAA,EAAe;AAEtB,MAAA,MAAM,MAAA,GAAS;AAAA,oCAAA,EACiB,QAAQ,CAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAAA,CAAA;AAexC,MAAA,MAAM,EAAE,MAAA,EAAO,GAAI,MAAM,SAAA,CAAU,CAAA,cAAA,EAAiB,MAAM,CAAA,CAAA,CAAG,CAAA;AAE7D,MAAA,IAAI,OAAO,QAAA,CAAS,SAAS,CAAA,IAAQ,IAAA,CAAA,UAAA,CAAW,QAAQ,CAAA,EAAG;AACzD,QAAA,OAAO,MAAM,qBAAqB,QAAQ,CAAA;AAAA,MAC5C;AAEA,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,KAAA;AAAA,QACT,KAAA,EAAO;AAAA,OACT;AAAA,IACF;AAAA,EACF,CAAA,SAAE;AAEA,IAAA,eAAA,CAAgB,QAAQ,CAAA;AAAA,EAC1B;AACF;AAKA,eAAe,uBAAA,GAAyD;AACtE,EAAA,MAAM,QAAA,GAAgBA,WAAQ,EAAA,CAAA,MAAA,EAAO,EAAG,aAAa,IAAA,CAAK,GAAA,EAAK,CAAA,IAAA,CAAM,CAAA;AAErE,EAAA,IAAI;AAEF,IAAA,IAAI;AACF,MAAA,MAAM,SAAA,CAAU,CAAA,8CAAA,EAAiD,QAAQ,CAAA,CAAA,CAAG,CAAA;AAC5E,MAAA,IAAO,gBAAW,QAAQ,CAAA,IAAQ,cAAS,QAAQ,CAAA,CAAE,OAAO,CAAA,EAAG;AAC7D,QAAA,OAAO,MAAM,qBAAqB,QAAQ,CAAA;AAAA,MAC5C;AAAA,IACF,CAAA,CAAA,MAAQ;AAAA,IAER;AAGA,IAAA,IAAI;AACF,MAAA,MAAM,SAAA,CAAU,CAAA,yBAAA,EAA4B,QAAQ,CAAA,CAAA,CAAG,CAAA;AACvD,MAAA,IAAO,gBAAW,QAAQ,CAAA,IAAQ,cAAS,QAAQ,CAAA,CAAE,OAAO,CAAA,EAAG;AAC7D,QAAA,OAAO,MAAM,qBAAqB,QAAQ,CAAA;AAAA,MAC5C;AAAA,IACF,CAAA,CAAA,MAAQ;AAAA,IAER;AAEA,IAAA,OAAO;AAAA,MACL,OAAA,EAAS,KAAA;AAAA,MACT,KAAA,EAAO;AAAA,KACT;AAAA,EACF,CAAA,SAAE;AAEA,IAAA,eAAA,CAAgB,QAAQ,CAAA;AAAA,EAC1B;AACF;AAKA,eAAe,yBAAA,GAA2D;AACxE,EAAA,MAAM,QAAA,GAAgBA,WAAQ,EAAA,CAAA,MAAA,EAAO,EAAG,aAAa,IAAA,CAAK,GAAA,EAAK,CAAA,IAAA,CAAM,CAAA;AAErE,EAAA,IAAI;AAEF,IAAA,MAAM,QAAA,GAAW;AAAA;AAAA;AAAA;AAAA,oBAAA,EAIC,QAAA,CAAS,OAAA,CAAQ,KAAA,EAAO,MAAM,CAAC,CAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAAA,CAAA;AAOjD,IAAA,MAAM,SAAA,CAAU,CAAA,qBAAA,EAAwB,QAAQ,CAAA,CAAA,CAAG,CAAA;AAEnD,IAAA,IAAO,gBAAW,QAAQ,CAAA,IAAQ,cAAS,QAAQ,CAAA,CAAE,OAAO,CAAA,EAAG;AAC7D,MAAA,OAAO,MAAM,qBAAqB,QAAQ,CAAA;AAAA,IAC5C;AAEA,IAAA,OAAO;AAAA,MACL,OAAA,EAAS,KAAA;AAAA,MACT,KAAA,EAAO;AAAA,KACT;AAAA,EACF,CAAA,SAAE;AAEA,IAAA,eAAA,CAAgB,QAAQ,CAAA;AAAA,EAC1B;AACF;AAMA,eAAe,qBAAqB,QAAA,EAAiD;AACnF,EAAA,IAAI;AACF,IAAA,MAAM,WAAA,GAAiB,kBAAa,QAAQ,CAAA;AAC5C,IAAA,MAAM,WAAA,GAAc,WAAA,CAAY,QAAA,CAAS,QAAQ,CAAA;AAGjD,IAAA,MAAM,QAAQ,WAAA,CAAY,KAAA,CAAM,GAAG,CAAC,CAAA,CAAE,SAAS,KAAK,CAAA;AACpD,IAAA,IAAI,QAAA,GAAW,WAAA;AAEf,IAAA,IAAI,KAAA,CAAM,UAAA,CAAW,UAAU,CAAA,EAAG;AAChC,MAAA,QAAA,GAAW,WAAA;AAAA,IACb,CAAA,MAAA,IAAW,KAAA,CAAM,UAAA,CAAW,QAAQ,CAAA,EAAG;AACrC,MAAA,QAAA,GAAW,YAAA;AAAA,IACb,CAAA,MAAA,IAAW,KAAA,CAAM,UAAA,CAAW,UAAU,CAAA,EAAG;AACvC,MAAA,QAAA,GAAW,WAAA;AAAA,IACb,CAAA,MAAA,IAAW,KAAA,CAAM,UAAA,CAAW,UAAU,CAAA,EAAG;AACvC,MAAA,QAAA,GAAW,YAAA;AAAA,IACb;AAEA,IAAA,MAAM,OAAA,GAAU,CAAA,KAAA,EAAQ,QAAQ,CAAA,QAAA,EAAW,WAAW,CAAA,CAAA;AAEtD,IAAA,OAAO;AAAA,MACL,OAAA,EAAS,IAAA;AAAA,MACT,OAAA;AAAA,MACA,MAAA,EAAQ;AAAA,KACV;AAAA,EACF,SAAS,KAAA,EAAY;AACnB,IAAA,OAAO;AAAA,MACL,OAAA,EAAS,KAAA;AAAA,MACT,OAAO,KAAA,CAAM;AAAA,KACf;AAAA,EACF;AACF;AAKA,eAAsB,iBAAA,GAAsC;AAC1D,EAAA,MAAM5B,YAAc,EAAA,CAAA,QAAA,EAAS;AAE7B,EAAA,IAAI;AACF,IAAA,QAAQA,SAAAA;AAAU,MAChB,KAAK,QAAA;AAEH,QAAA,MAAM,EAAE,MAAA,EAAO,GAAI,MAAM,UAAU,+BAA+B,CAAA;AAClE,QAAA,OAAO,OAAO,QAAA,CAAS,oBAAc,CAAA,IAAK,MAAA,CAAO,SAAS,YAAY,CAAA;AAAA,MAExE,KAAK,OAAA;AAEH,QAAA,IAAI;AACF,UAAA,MAAM,UAAU,0DAA0D,CAAA;AAC1E,UAAA,OAAO,IAAA;AAAA,QACT,CAAA,CAAA,MAAQ;AACN,UAAA,OAAO,KAAA;AAAA,QACT;AAAA,MAEF,KAAK,OAAA;AAEH,QAAA,MAAM,OAAA,GAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAAA,CAAA;AAQhB,QAAA,MAAM,EAAE,QAAQ,MAAA,EAAO,GAAI,MAAM,SAAA,CAAU,CAAA,qBAAA,EAAwB,OAAO,CAAA,CAAA,CAAG,CAAA;AAC7E,QAAA,OAAO,MAAA,CAAO,MAAK,KAAM,MAAA;AAAA,MAE3B;AACE,QAAA,OAAO,KAAA;AAAA;AACX,EACF,CAAA,CAAA,MAAQ;AACN,IAAA,OAAO,KAAA;AAAA,EACT;AACF;;;AClQA,IAAA,aAAA,GAAA;AAAA,QAAA,CAAA,aAAA,EAAA;AAAA,EAAA,cAAA,EAAA,MAAA,cAAA;AAAA,EAAA,yBAAA,EAAA,MAAA,yBAAA;AAAA,EAAA,oBAAA,EAAA,MAAA,oBAAA;AAAA,EAAA,IAAA,EAAA,MAAA,IAAA;AAAA,EAAA,cAAA,EAAA,MAAA,cAAA;AAAA,EAAA,kBAAA,EAAA,MAAA,kBAAA;AAAA,EAAA,2BAAA,EAAA,MAAA,2BAAA;AAAA,EAAA,cAAA,EAAA,MAAA,cAAA;AAAA,EAAA,cAAA,EAAA,MAAA,cAAA;AAAA,EAAA,uBAAA,EAAA,MAAA,uBAAA;AAAA,EAAA,kBAAA,EAAA,MAAA,kBAAA;AAAA,EAAA,mBAAA,EAAA,MAAA,mBAAA;AAAA,EAAA,cAAA,EAAA,MAAA,cAAA;AAAA,EAAA,QAAA,EAAA,MAAA,QAAA;AAAA,EAAA,iBAAA,EAAA,MAAA,iBAAA;AAAA,EAAA,WAAA,EAAA,MAAA,WAAA;AAAA,EAAA,kBAAA,EAAA,MAAA,kBAAA;AAAA,EAAA,mBAAA,EAAA,MAAA,mBAAA;AAAA,EAAA,aAAA,EAAA,MAAA,aAAA;AAAA,EAAA,iBAAA,EAAA,MAAA,iBAAA;AAAA,EAAA,eAAA,EAAA,MAAA,eAAA;AAAA,EAAA,kBAAA,EAAA,MAAA,kBAAA;AAAA,EAAA,0BAAA,EAAA,MAAA,0BAAA;AAAA,EAAA,IAAA,EAAA,MAAAN,KAAAA;AAAA,EAAA,IAAA,EAAA,MAAA,IAAA;AAAA,EAAA,gBAAA,EAAA,MAAA,gBAAA;AAAA,EAAA,mBAAA,EAAA,MAAA,mBAAA;AAAA,EAAA,eAAA,EAAA,MAAA,eAAA;AAAA,EAAA,qBAAA,EAAA,MAAA,qBAAA;AAAA,EAAA,aAAA,EAAA,MAAA,aAAA;AAAA,EAAA,QAAA,EAAA,MAAAmC,SAAAA;AAAA,EAAA,YAAA,EAAA,MAAA,YAAA;AAAA,EAAA,YAAA,EAAA,MAAA,YAAA;AAAA,EAAA,QAAA,EAAA,MAAA,QAAA;AAAA,EAAA,UAAA,EAAA,MAAA,UAAA;AAAA,EAAA,SAAA,EAAA,MAAA,SAAA;AAAA,EAAA,SAAA,EAAA,MAAA,SAAA;AAAA,EAAA,SAAA,EAAA,MAAAC;AAAA,CAAA,CAAA;AC6DO,IAAM,yBAAA,GAA4D;AAAA,EACvE,gBAAA,EAAkB,QAAQ,GAAA,EAAI;AAAA,EAC9B,oBAAoB,EAAC;AAAA,EACrB,oBAAoB,CAAC,cAAA,EAAgB,QAAQ,MAAA,EAAQ,KAAA,EAAO,eAAe,QAAQ,CAAA;AAAA,EACnF,WAAA,EAAa,KAAK,IAAA,GAAO,IAAA;AAAA;AAAA,EACzB,UAAA,EAAY,GAAA;AAAA,EACZ,cAAA,EAAgB,KAAA;AAAA,EAChB,iBAAA,EAAmB;AAAA,IACjB,MAAA;AAAA,IAAQ,MAAA;AAAA,IAAQ,KAAA;AAAA,IAAO,QAAA;AAAA,IAAU,MAAA;AAAA,IAAQ,MAAA;AAAA,IAAQ,IAAA;AAAA,IAAM,IAAA;AAAA,IACvD,MAAA;AAAA,IAAQ,MAAA;AAAA,IAAQ,KAAA;AAAA,IAAO,MAAA;AAAA,IAAQ,KAAA;AAAA,IAAO,MAAA;AAAA,IACtC,MAAA;AAAA,IAAQ,MAAA;AAAA,IAAQ,OAAA;AAAA,IAAS,MAAA;AAAA,IAAQ,MAAA;AAAA,IAAQ,MAAA;AAAA,IAAQ,MAAA;AAAA,IAAQ,OAAA;AAAA,IACzD,MAAA;AAAA,IAAQ,MAAA;AAAA,IAAQ,MAAA;AAAA,IAAQ,MAAA;AAAA,IAAQ,MAAA;AAAA,IAAQ,MAAA;AAAA,IACxC,MAAA;AAAA,IAAQ,MAAA;AAAA,IAAQ,OAAA;AAAA,IAAS,MAAA;AAAA,IAAQ,OAAA;AAAA,IAAS,MAAA;AAAA,IAAQ,OAAA;AAAA,IAClD,OAAA;AAAA,IAAS,QAAA;AAAA,IAAU,MAAA;AAAA,IAAQ,MAAA;AAAA,IAAQ;AAAA;AAEvC;AA+EO,SAAS,YAAA,CACd,SAAA,EACA,MAAA,GAA+B,EAAC,EAC0B;AAC1D,EAAA,MAAM,UAAA,GAAa,MAAA,CAAO,gBAAA,IAAoB,OAAA,CAAQ,GAAA,EAAI;AAC1D,EAAA,MAAM,WAAA,GAAc,MAAA,CAAO,kBAAA,IAAsB,EAAC;AAClD,EAAA,MAAM,WAAA,GAAc,MAAA,CAAO,kBAAA,IAAsB,yBAAA,CAA0B,kBAAA;AAG3E,EAAA,IAAI,YAAA,GAAe,SAAA;AACnB,EAAA,IAAI,SAAA,CAAU,UAAA,CAAW,IAAI,CAAA,EAAG;AAC9B,IAAA,YAAA,GAAepD,QAAQ+B,OAAAA,EAAQ,EAAG,SAAA,CAAU,KAAA,CAAM,CAAC,CAAC,CAAA;AAAA,EACtD,CAAA,MAAA,IAAW,cAAc,GAAA,EAAK;AAC5B,IAAA,YAAA,GAAeA,OAAAA,EAAQ;AAAA,EACzB;AAGA,EAAA,IAAI,YAAA;AACJ,EAAA,IAAI,UAAA,CAAW,YAAY,CAAA,EAAG;AAC5B,IAAA,YAAA,GAAe,UAAU,YAAY,CAAA;AAAA,EACvC,CAAA,MAAO;AACL,IAAA,YAAA,GAAe/B,OAAAA,CAAQ,YAAY,YAAY,CAAA;AAAA,EACjD;AAGA,EAAA,MAAM,eAAe,YAAA,CAAa,KAAA,CAAM,GAAG,CAAA,CAAE,OAAO,OAAO,CAAA;AAC3D,EAAA,KAAA,MAAW,WAAW,WAAA,EAAa;AAEjC,IAAA,IAAI,CAAC,OAAA,CAAQ,QAAA,CAAS,GAAG,CAAA,EAAG;AAC1B,MAAA,IAAI,YAAA,CAAa,QAAA,CAAS,OAAO,CAAA,EAAG;AAClC,QAAA,OAAO;AAAA,UACL,KAAA,EAAO,KAAA;AAAA,UACP,YAAA;AAAA,UACA,KAAA,EAAO,iCAAiC,OAAO,CAAA;AAAA,SACjD;AAAA,MACF;AAAA,IACF,CAAA,MAAO;AAEL,MAAA,MAAM,cAAc,UAAA,CAAW,OAAO,IAAI,OAAA,GAAUA,OAAAA,CAAQ,YAAY,OAAO,CAAA;AAC/E,MAAA,IAAI,aAAa,UAAA,CAAW,WAAA,GAAc,GAAG,CAAA,IAAK,iBAAiB,WAAA,EAAa;AAC9E,QAAA,OAAO;AAAA,UACL,KAAA,EAAO,KAAA;AAAA,UACP,YAAA;AAAA,UACA,KAAA,EAAO,iCAAiC,OAAO,CAAA;AAAA,SACjD;AAAA,MACF;AAAA,IACF;AAAA,EACF;AAGA,EAAA,IAAI,WAAA,CAAY,SAAS,CAAA,EAAG;AAC1B,IAAA,IAAI,SAAA,GAAY,KAAA;AAChB,IAAA,KAAA,MAAW,WAAW,WAAA,EAAa;AACjC,MAAA,MAAM,cAAc,UAAA,CAAW,OAAO,IAAI,OAAA,GAAUA,OAAAA,CAAQ,YAAY,OAAO,CAAA;AAC/E,MAAA,IAAI,aAAa,UAAA,CAAW,WAAA,GAAc,GAAG,CAAA,IAAK,iBAAiB,WAAA,EAAa;AAC9E,QAAA,SAAA,GAAY,IAAA;AACZ,QAAA;AAAA,MACF;AAAA,IACF;AACA,IAAA,IAAI,CAAC,SAAA,EAAW;AACd,MAAA,OAAO;AAAA,QACL,KAAA,EAAO,KAAA;AAAA,QACP,YAAA;AAAA,QACA,KAAA,EAAO,CAAA,mCAAA;AAAA,OACT;AAAA,IACF;AAAA,EACF;AAEA,EAAA,OAAO,EAAE,KAAA,EAAO,IAAA,EAAM,YAAA,EAAa;AACrC;AAKO,SAAS,YAAY,SAAA,EAA2B;AACrD,EAAA,IAAI,SAAA,CAAU,UAAA,CAAW,IAAI,CAAA,EAAG;AAC9B,IAAA,OAAOA,QAAQ+B,OAAAA,EAAQ,EAAG,SAAA,CAAU,KAAA,CAAM,CAAC,CAAC,CAAA;AAAA,EAC9C,CAAA,MAAA,IAAW,cAAc,GAAA,EAAK;AAC5B,IAAA,OAAOA,OAAAA,EAAQ;AAAA,EACjB;AACA,EAAA,OAAO,SAAA;AACT;AAKO,SAAS,mBAAA,CACd,QAAA,EACA,iBAAA,GAA8B,yBAAA,CAA0B,iBAAA,EAC/C;AACT,EAAA,MAAM,GAAA,GAAM,SAAS,WAAA,EAAY,CAAE,UAAU,QAAA,CAAS,WAAA,CAAY,GAAG,CAAC,CAAA;AACtE,EAAA,OAAO,iBAAA,CAAkB,SAAS,GAAG,CAAA;AACvC;AChNO,SAAS,kBAAA,CAAmB,MAAA,GAA+B,EAAC,EAA+C;AAChH,EAAA,MAAM,YAAA,GAAe,EAAE,GAAG,yBAAA,EAA2B,GAAG,MAAA,EAAO;AAE/D,EAAA,OAAO;AAAA,IACL,UAAA,EAAY;AAAA,MACV,IAAA,EAAM,UAAA;AAAA,MACN,QAAA,EAAU;AAAA,QACR,IAAA,EAAM,WAAA;AAAA,QACN,WAAA,EAAa,CAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA,sFAAA,CAAA;AAAA,QAuBb,UAAA,EAAY;AAAA,UACV,IAAA,EAAM,QAAA;AAAA,UACN,UAAA,EAAY;AAAA,YACV,SAAA,EAAW;AAAA,cACT,IAAA,EAAM,QAAA;AAAA,cACN,WAAA,EAAa;AAAA,aACf;AAAA,YACA,MAAA,EAAQ;AAAA,cACN,IAAA,EAAM,QAAA;AAAA,cACN,WAAA,EAAa;AAAA,aACf;AAAA,YACA,KAAA,EAAO;AAAA,cACL,IAAA,EAAM,QAAA;AAAA,cACN,WAAA,EAAa;AAAA;AACf,WACF;AAAA,UACA,QAAA,EAAU,CAAC,WAAW;AAAA;AACxB;AACF,KACF;AAAA,IAEA,YAAA,EAAc,CAAC,IAAA,KAA+B;AAC5C,MAAA,IAAI,IAAA,CAAK,MAAA,IAAU,IAAA,CAAK,KAAA,EAAO;AAC7B,QAAA,OAAO,CAAA,EAAG,IAAA,CAAK,SAAS,CAAA,QAAA,EAAW,IAAA,CAAK,MAAM,CAAA,CAAA,EAAI,IAAA,CAAK,MAAA,GAAS,IAAA,CAAK,KAAK,CAAA,CAAA,CAAA;AAAA,MAC5E;AACA,MAAA,OAAO,IAAA,CAAK,SAAA;AAAA,IACd,CAAA;AAAA,IAEA,OAAA,EAAS,OAAO,IAAA,KAAgD;AAC9D,MAAA,MAAM,EAAE,SAAA,EAAW,MAAA,GAAS,CAAA,EAAG,KAAA,GAAQ,KAAK,GAAI,IAAA;AAGhD,MAAA,MAAM,UAAA,GAAa,YAAA,CAAa,SAAA,EAAW,YAAY,CAAA;AACvD,MAAA,IAAI,CAAC,WAAW,KAAA,EAAO;AACrB,QAAA,OAAO;AAAA,UACL,OAAA,EAAS,KAAA;AAAA,UACT,OAAO,UAAA,CAAW,KAAA;AAAA,UAClB,IAAA,EAAM;AAAA,SACR;AAAA,MACF;AAEA,MAAA,MAAM,eAAe,UAAA,CAAW,YAAA;AAGhC,MAAA,IAAI,CAACsB,UAAAA,CAAW,YAAY,CAAA,EAAG;AAC7B,QAAA,OAAO;AAAA,UACL,OAAA,EAAS,KAAA;AAAA,UACT,KAAA,EAAO,mBAAmB,SAAS,CAAA,CAAA;AAAA,UACnC,IAAA,EAAM;AAAA,SACR;AAAA,MACF;AAEA,MAAA,IAAI;AAEF,QAAA,MAAM,KAAA,GAAQ,MAAMjD,IAAAA,CAAK,YAAY,CAAA;AACrC,QAAA,IAAI,CAAC,KAAA,CAAM,MAAA,EAAO,EAAG;AACnB,UAAA,OAAO;AAAA,YACL,OAAA,EAAS,KAAA;AAAA,YACT,KAAA,EAAO,uBAAuB,SAAS,CAAA,4CAAA,CAAA;AAAA,YACvC,IAAA,EAAM;AAAA,WACR;AAAA,QACF;AAEA,QAAA,IAAI,KAAA,CAAM,IAAA,GAAO,YAAA,CAAa,WAAA,EAAa;AACzC,UAAA,OAAO;AAAA,YACL,OAAA,EAAS,KAAA;AAAA,YACT,OAAO,CAAA,mBAAA,EAAA,CAAuB,KAAA,CAAM,IAAA,GAAO,IAAA,GAAO,MAAM,OAAA,CAAQ,CAAC,CAAC,CAAA,qBAAA,EAAA,CAAyB,aAAa,WAAA,GAAc,IAAA,GAAO,IAAA,EAAM,OAAA,CAAQ,CAAC,CAAC,CAAA,2CAAA,CAAA;AAAA,YAC7I,IAAA,EAAM,SAAA;AAAA,YACN,MAAM,KAAA,CAAM;AAAA,WACd;AAAA,QACF;AAGA,QAAA,MAAM,OAAA,GAAU,MAAMkD,QAAA,CAAW,YAAA,EAAc,OAAO,CAAA;AACtD,QAAA,MAAM,QAAA,GAAW,OAAA,CAAQ,KAAA,CAAM,IAAI,CAAA;AACnC,QAAA,MAAM,aAAa,QAAA,CAAS,MAAA;AAG5B,QAAA,MAAM,UAAA,GAAa,IAAA,CAAK,GAAA,CAAI,CAAA,EAAG,SAAS,CAAC,CAAA;AACzC,QAAA,MAAM,QAAA,GAAW,IAAA,CAAK,GAAA,CAAI,UAAA,EAAY,aAAa,KAAK,CAAA;AACxD,QAAA,MAAM,aAAA,GAAgB,QAAA,CAAS,KAAA,CAAM,UAAA,EAAY,QAAQ,CAAA;AAGzD,QAAA,MAAM,eAAA,GAAkB,MAAA,CAAO,QAAQ,CAAA,CAAE,MAAA;AACzC,QAAA,MAAM,cAAA,GAAiB,aAAA,CAAc,GAAA,CAAI,CAAC,MAAM,CAAA,KAAM;AACpD,UAAA,MAAM,OAAA,GAAU,aAAa,CAAA,GAAI,CAAA;AACjC,UAAA,MAAM,YAAY,MAAA,CAAO,OAAO,CAAA,CAAE,QAAA,CAAS,iBAAiB,GAAG,CAAA;AAE/D,UAAA,MAAM,aAAA,GAAgB,KAAK,MAAA,GAAS,GAAA,GAAO,KAAK,SAAA,CAAU,CAAA,EAAG,GAAI,CAAA,GAAI,KAAA,GAAQ,IAAA;AAC7E,UAAA,OAAO,CAAA,EAAG,SAAS,CAAA,CAAA,EAAK,aAAa,CAAA,CAAA;AAAA,QACvC,CAAC,CAAA;AAED,QAAA,MAAM,YAAY,QAAA,GAAW,UAAA;AAC7B,QAAA,MAAM,MAAA,GAAS,cAAA,CAAe,IAAA,CAAK,IAAI,CAAA;AAEvC,QAAA,OAAO;AAAA,UACL,OAAA,EAAS,IAAA;AAAA,UACT,OAAA,EAAS,MAAA;AAAA,UACT,KAAA,EAAO,UAAA;AAAA,UACP,SAAA;AAAA,UACA,QAAA,EAAU,OAAA;AAAA,UACV,MAAM,KAAA,CAAM,IAAA;AAAA,UACZ,IAAA,EAAM;AAAA,SACR;AAAA,MACF,SAAS,KAAA,EAAO;AAEd,QAAA,IAAI,iBAAiB,KAAA,IAAS,KAAA,CAAM,OAAA,CAAQ,QAAA,CAAS,UAAU,CAAA,EAAG;AAChE,UAAA,OAAO;AAAA,YACL,OAAA,EAAS,KAAA;AAAA,YACT,KAAA,EAAO,8DAA8D,SAAS,CAAA,CAAA;AAAA,YAC9E,IAAA,EAAM;AAAA,WACR;AAAA,QACF;AAEA,QAAA,OAAO;AAAA,UACL,OAAA,EAAS,KAAA;AAAA,UACT,KAAA,EAAO,wBAAwB,KAAA,YAAiB,KAAA,GAAQ,MAAM,OAAA,GAAU,MAAA,CAAO,KAAK,CAAC,CAAA,CAAA;AAAA,UACrF,IAAA,EAAM;AAAA,SACR;AAAA,MACF;AAAA,IACF;AAAA,GACF;AACF;AAKO,IAAMH,YAAW,kBAAA;AChKjB,SAAS,mBAAA,CAAoB,MAAA,GAA+B,EAAC,EAAiD;AACnH,EAAA,MAAM,YAAA,GAAe,EAAE,GAAG,yBAAA,EAA2B,GAAG,MAAA,EAAO;AAE/D,EAAA,OAAO;AAAA,IACL,UAAA,EAAY;AAAA,MACV,IAAA,EAAM,UAAA;AAAA,MACN,QAAA,EAAU;AAAA,QACR,IAAA,EAAM,YAAA;AAAA,QACN,WAAA,EAAa,CAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA,uFAAA,CAAA;AAAA,QAsBb,UAAA,EAAY;AAAA,UACV,IAAA,EAAM,QAAA;AAAA,UACN,UAAA,EAAY;AAAA,YACV,SAAA,EAAW;AAAA,cACT,IAAA,EAAM,QAAA;AAAA,cACN,WAAA,EAAa;AAAA,aACf;AAAA,YACA,OAAA,EAAS;AAAA,cACP,IAAA,EAAM,QAAA;AAAA,cACN,WAAA,EAAa;AAAA;AACf,WACF;AAAA,UACA,QAAA,EAAU,CAAC,WAAA,EAAa,SAAS;AAAA;AACnC;AACF,KACF;AAAA,IAEA,YAAA,EAAc,CAAC,IAAA,KAAgC;AAC7C,MAAA,MAAM,IAAA,GAAO,IAAA,CAAK,OAAA,EAAS,MAAA,IAAU,CAAA;AACrC,MAAA,IAAI,OAAO,GAAA,EAAM;AACf,QAAA,OAAO,CAAA,EAAG,KAAK,SAAS,CAAA,EAAA,EAAK,KAAK,KAAA,CAAM,IAAA,GAAO,IAAI,CAAC,CAAA,GAAA,CAAA;AAAA,MACtD;AACA,MAAA,OAAO,IAAA,CAAK,SAAA;AAAA,IACd,CAAA;AAAA,IAEA,OAAA,EAAS,OAAO,IAAA,KAAkD;AAChE,MAAA,MAAM,EAAE,SAAA,EAAW,OAAA,EAAQ,GAAI,IAAA;AAG/B,MAAA,MAAM,UAAA,GAAa,YAAA,CAAa,SAAA,EAAW,YAAY,CAAA;AACvD,MAAA,IAAI,CAAC,WAAW,KAAA,EAAO;AACrB,QAAA,OAAO;AAAA,UACL,OAAA,EAAS,KAAA;AAAA,UACT,OAAO,UAAA,CAAW,KAAA;AAAA,UAClB,IAAA,EAAM;AAAA,SACR;AAAA,MACF;AAEA,MAAA,MAAM,eAAe,UAAA,CAAW,YAAA;AAChC,MAAA,MAAM,UAAA,GAAaE,WAAW,YAAY,CAAA;AAE1C,MAAA,IAAI;AAEF,QAAA,MAAM,SAAA,GAAYE,QAAQ,YAAY,CAAA;AACtC,QAAA,IAAI,CAACF,UAAAA,CAAW,SAAS,CAAA,EAAG;AAC1B,UAAA,MAAMG,KAAAA,CAAM,SAAA,EAAW,EAAE,SAAA,EAAW,MAAM,CAAA;AAAA,QAC5C;AAGA,QAAA,MAAMC,SAAA,CAAY,YAAA,EAAc,OAAA,EAAS,OAAO,CAAA;AAEhD,QAAA,OAAO;AAAA,UACL,OAAA,EAAS,IAAA;AAAA,UACT,IAAA,EAAM,SAAA;AAAA,UACN,YAAA,EAAc,MAAA,CAAO,UAAA,CAAW,OAAA,EAAS,OAAO,CAAA;AAAA,UAChD,SAAS,CAAC;AAAA,SACZ;AAAA,MACF,SAAS,KAAA,EAAO;AACd,QAAA,OAAO;AAAA,UACL,OAAA,EAAS,KAAA;AAAA,UACT,KAAA,EAAO,yBAAyB,KAAA,YAAiB,KAAA,GAAQ,MAAM,OAAA,GAAU,MAAA,CAAO,KAAK,CAAC,CAAA,CAAA;AAAA,UACtF,IAAA,EAAM;AAAA,SACR;AAAA,MACF;AAAA,IACF;AAAA,GACF;AACF;AAKO,IAAML,aAAY,mBAAA;ACjGlB,SAAS,kBAAA,CAAmB,MAAA,GAA+B,EAAC,EAA+C;AAChH,EAAA,MAAM,YAAA,GAAe,EAAE,GAAG,yBAAA,EAA2B,GAAG,MAAA,EAAO;AAE/D,EAAA,OAAO;AAAA,IACL,UAAA,EAAY;AAAA,MACV,IAAA,EAAM,UAAA;AAAA,MACN,QAAA,EAAU;AAAA,QACR,IAAA,EAAM,WAAA;AAAA,QACN,WAAA,EAAa,CAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA,4GAAA,CAAA;AAAA,QAgCb,UAAA,EAAY;AAAA,UACV,IAAA,EAAM,QAAA;AAAA,UACN,UAAA,EAAY;AAAA,YACV,SAAA,EAAW;AAAA,cACT,IAAA,EAAM,QAAA;AAAA,cACN,WAAA,EAAa;AAAA,aACf;AAAA,YACA,UAAA,EAAY;AAAA,cACV,IAAA,EAAM,QAAA;AAAA,cACN,WAAA,EAAa;AAAA,aACf;AAAA,YACA,UAAA,EAAY;AAAA,cACV,IAAA,EAAM,QAAA;AAAA,cACN,WAAA,EAAa;AAAA,aACf;AAAA,YACA,WAAA,EAAa;AAAA,cACX,IAAA,EAAM,SAAA;AAAA,cACN,WAAA,EAAa;AAAA;AACf,WACF;AAAA,UACA,QAAA,EAAU,CAAC,WAAA,EAAa,YAAA,EAAc,YAAY;AAAA;AACpD;AACF,KACF;AAAA,IAEA,YAAA,EAAc,CAAC,IAAA,KAA+B;AAC5C,MAAA,MAAM,IAAA,GAAO,IAAA,CAAK,WAAA,GAAc,gBAAA,GAAmB,EAAA;AACnD,MAAA,OAAO,CAAA,EAAG,IAAA,CAAK,SAAS,CAAA,EAAG,IAAI,CAAA,CAAA;AAAA,IACjC,CAAA;AAAA,IAEA,OAAA,EAAS,OAAO,IAAA,KAAgD;AAC9D,MAAA,MAAM,EAAE,SAAA,EAAW,UAAA,EAAY,UAAA,EAAY,WAAA,GAAc,OAAM,GAAI,IAAA;AAGnE,MAAA,IAAI,eAAe,UAAA,EAAY;AAC7B,QAAA,OAAO;AAAA,UACL,OAAA,EAAS,KAAA;AAAA,UACT,KAAA,EAAO,6CAAA;AAAA,UACP,IAAA,EAAM;AAAA,SACR;AAAA,MACF;AAGA,MAAA,MAAM,UAAA,GAAa,YAAA,CAAa,SAAA,EAAW,YAAY,CAAA;AACvD,MAAA,IAAI,CAAC,WAAW,KAAA,EAAO;AACrB,QAAA,OAAO;AAAA,UACL,OAAA,EAAS,KAAA;AAAA,UACT,OAAO,UAAA,CAAW,KAAA;AAAA,UAClB,IAAA,EAAM;AAAA,SACR;AAAA,MACF;AAEA,MAAA,MAAM,eAAe,UAAA,CAAW,YAAA;AAGhC,MAAA,IAAI,CAACC,UAAAA,CAAW,YAAY,CAAA,EAAG;AAC7B,QAAA,OAAO;AAAA,UACL,OAAA,EAAS,KAAA;AAAA,UACT,KAAA,EAAO,mBAAmB,SAAS,CAAA,CAAA;AAAA,UACnC,IAAA,EAAM;AAAA,SACR;AAAA,MACF;AAEA,MAAA,IAAI;AAEF,QAAA,MAAM,OAAA,GAAU,MAAMC,QAAAA,CAAW,YAAA,EAAc,OAAO,CAAA;AAGtD,QAAA,IAAI,WAAA,GAAc,CAAA;AAClB,QAAA,IAAI,WAAA,GAAc,CAAA;AAClB,QAAA,OAAO,IAAA,EAAM;AACX,UAAA,MAAM,UAAA,GAAa,OAAA,CAAQ,OAAA,CAAQ,UAAA,EAAY,WAAW,CAAA;AAC1D,UAAA,IAAI,eAAe,CAAA,CAAA,EAAI;AACvB,UAAA,WAAA,EAAA;AACA,UAAA,WAAA,GAAc,UAAA,GAAa,CAAA;AAAA,QAC7B;AAGA,QAAA,IAAI,gBAAgB,CAAA,EAAG;AAErB,UAAA,MAAM,UAAA,GAAa,WAAW,IAAA,EAAK;AACnC,UAAA,MAAM,eAAA,GAAkB,OAAA,CAAQ,QAAA,CAAS,UAAU,CAAA;AAEnD,UAAA,IAAI,QAAA,GAAW,CAAA,8BAAA,CAAA;AACf,UAAA,IAAI,eAAA,IAAmB,eAAe,UAAA,EAAY;AAChD,YAAA,QAAA,IAAY,CAAA,iGAAA,CAAA;AAAA,UACd,CAAA,MAAO;AACL,YAAA,QAAA,IAAY,CAAA,gFAAA,CAAA;AAAA,UACd;AAEA,UAAA,OAAO;AAAA,YACL,OAAA,EAAS,KAAA;AAAA,YACT,KAAA,EAAO,QAAA;AAAA,YACP,IAAA,EAAM,SAAA;AAAA,YACN,YAAA,EAAc;AAAA,WAChB;AAAA,QACF;AAEA,QAAA,IAAI,WAAA,GAAc,CAAA,IAAK,CAAC,WAAA,EAAa;AACnC,UAAA,OAAO;AAAA,YACL,OAAA,EAAS,KAAA;AAAA,YACT,KAAA,EAAO,sBAAsB,WAAW,CAAA,uHAAA,CAAA;AAAA,YACxC,IAAA,EAAM,SAAA;AAAA,YACN,YAAA,EAAc;AAAA,WAChB;AAAA,QACF;AAGA,QAAA,IAAI,UAAA;AACJ,QAAA,IAAI,WAAA,EAAa;AACf,UAAA,UAAA,GAAa,OAAA,CAAQ,KAAA,CAAM,UAAU,CAAA,CAAE,KAAK,UAAU,CAAA;AAAA,QACxD,CAAA,MAAO;AACL,UAAA,UAAA,GAAa,OAAA,CAAQ,OAAA,CAAQ,UAAA,EAAY,UAAU,CAAA;AAAA,QACrD;AAGA,QAAA,MAAMG,SAAAA,CAAY,YAAA,EAAc,UAAA,EAAY,OAAO,CAAA;AAGnD,QAAA,MAAM,WAAA,GAAc,mBAAA,CAAoB,UAAA,EAAY,UAAU,CAAA;AAE9D,QAAA,OAAO;AAAA,UACL,OAAA,EAAS,IAAA;AAAA,UACT,IAAA,EAAM,SAAA;AAAA,UACN,YAAA,EAAc,cAAc,WAAA,GAAc,CAAA;AAAA,UAC1C,IAAA,EAAM;AAAA,SACR;AAAA,MACF,SAAS,KAAA,EAAO;AACd,QAAA,OAAO;AAAA,UACL,OAAA,EAAS,KAAA;AAAA,UACT,KAAA,EAAO,wBAAwB,KAAA,YAAiB,KAAA,GAAQ,MAAM,OAAA,GAAU,MAAA,CAAO,KAAK,CAAC,CAAA,CAAA;AAAA,UACrF,IAAA,EAAM;AAAA,SACR;AAAA,MACF;AAAA,IACF;AAAA,GACF;AACF;AAKA,SAAS,mBAAA,CAAoB,QAAgB,MAAA,EAAwB;AACnE,EAAA,MAAM,QAAA,GAAW,MAAA,CAAO,KAAA,CAAM,IAAI,CAAA;AAClC,EAAA,MAAM,QAAA,GAAW,MAAA,CAAO,KAAA,CAAM,IAAI,CAAA;AAElC,EAAA,MAAM,OAAiB,EAAC;AACxB,EAAA,MAAM,WAAW,IAAA,CAAK,GAAA,CAAI,QAAA,CAAS,MAAA,EAAQ,SAAS,MAAM,CAAA;AAG1D,EAAA,MAAM,YAAA,GAAe,IAAA,CAAK,GAAA,CAAI,QAAA,EAAU,CAAC,CAAA;AAEzC,EAAA,IAAA,CAAK,KAAK,SAAS,CAAA;AACnB,EAAA,KAAA,IAAS,CAAA,GAAI,GAAG,CAAA,GAAI,IAAA,CAAK,IAAI,QAAA,CAAS,MAAA,EAAQ,YAAY,CAAA,EAAG,CAAA,EAAA,EAAK;AAChE,IAAA,IAAA,CAAK,IAAA,CAAK,CAAA,EAAA,EAAK,QAAA,CAAS,CAAC,CAAC,CAAA,CAAE,CAAA;AAAA,EAC9B;AACA,EAAA,IAAI,QAAA,CAAS,SAAS,YAAA,EAAc;AAClC,IAAA,IAAA,CAAK,IAAA,CAAK,CAAA,OAAA,EAAU,QAAA,CAAS,MAAA,GAAS,YAAY,CAAA,YAAA,CAAc,CAAA;AAAA,EAClE;AAEA,EAAA,IAAA,CAAK,KAAK,SAAS,CAAA;AACnB,EAAA,KAAA,IAAS,CAAA,GAAI,GAAG,CAAA,GAAI,IAAA,CAAK,IAAI,QAAA,CAAS,MAAA,EAAQ,YAAY,CAAA,EAAG,CAAA,EAAA,EAAK;AAChE,IAAA,IAAA,CAAK,IAAA,CAAK,CAAA,EAAA,EAAK,QAAA,CAAS,CAAC,CAAC,CAAA,CAAE,CAAA;AAAA,EAC9B;AACA,EAAA,IAAI,QAAA,CAAS,SAAS,YAAA,EAAc;AAClC,IAAA,IAAA,CAAK,IAAA,CAAK,CAAA,OAAA,EAAU,QAAA,CAAS,MAAA,GAAS,YAAY,CAAA,YAAA,CAAc,CAAA;AAAA,EAClE;AAEA,EAAA,OAAO,IAAA,CAAK,KAAK,IAAI,CAAA;AACvB;AAKO,IAAM,WAAW,kBAAA;ACxNxB,SAAS,gBAAA,CAAiB,SAAiB,QAAA,EAA2B;AAEpE,EAAA,IAAI,YAAA,GAAe,QAEhB,OAAA,CAAQ,mBAAA,EAAqB,MAAM,CAAA,CAEnC,OAAA,CAAQ,SAAS,cAAc,CAAA,CAE/B,QAAQ,KAAA,EAAO,OAAO,EAEtB,OAAA,CAAQ,KAAA,EAAO,GAAG,CAAA,CAElB,OAAA,CAAQ,qBAAqB,IAAI,CAAA;AAGpC,EAAA,YAAA,GAAe,MAAM,YAAA,GAAe,GAAA;AAEpC,EAAA,IAAI;AACF,IAAA,MAAM,KAAA,GAAQ,IAAI,MAAA,CAAO,YAAY,CAAA;AACrC,IAAA,OAAO,KAAA,CAAM,KAAK,QAAQ,CAAA;AAAA,EAC5B,CAAA,CAAA,MAAQ;AACN,IAAA,OAAO,KAAA;AAAA,EACT;AACF;AAKA,eAAe,SAAA,CACb,KACA,OAAA,EACA,OAAA,EACA,QACA,OAAA,GAA6C,EAAC,EAC9C,KAAA,GAAgB,CAAA,EAC4B;AAE5C,EAAA,IAAI,KAAA,GAAQ,EAAA,IAAM,OAAA,CAAQ,MAAA,IAAU,OAAO,UAAA,EAAY;AACrD,IAAA,OAAO,OAAA;AAAA,EACT;AAEA,EAAA,IAAI;AACF,IAAA,MAAM,UAAU,MAAMC,OAAAA,CAAQ,KAAK,EAAE,aAAA,EAAe,MAAM,CAAA;AAE1D,IAAA,KAAA,MAAW,SAAS,OAAA,EAAS;AAC3B,MAAA,IAAI,OAAA,CAAQ,MAAA,IAAU,MAAA,CAAO,UAAA,EAAY;AAEzC,MAAA,MAAM,QAAA,GAAW5B,IAAAA,CAAK,GAAA,EAAK,KAAA,CAAM,IAAI,CAAA;AACrC,MAAA,MAAM,YAAA,GAAe6B,QAAAA,CAAS,OAAA,EAAS,QAAQ,CAAA;AAG/C,MAAA,IAAI,KAAA,CAAM,aAAY,EAAG;AACvB,QAAA,MAAM,SAAA,GAAY,OAAO,kBAAA,CAAmB,IAAA;AAAA,UAC1C,CAAA,OAAA,KAAW,KAAA,CAAM,IAAA,KAAS,OAAA,IAAW,aAAa,QAAA,CAAS,CAAA,CAAA,EAAI,OAAO,CAAA,CAAA,CAAG,CAAA,IAAK,YAAA,CAAa,UAAA,CAAW,CAAA,EAAG,OAAO,CAAA,CAAA,CAAG;AAAA,SACrH;AACA,QAAA,IAAI,SAAA,EAAW;AAGf,QAAA,MAAM,UAAU,QAAA,EAAU,OAAA,EAAS,SAAS,MAAA,EAAQ,OAAA,EAAS,QAAQ,CAAC,CAAA;AAAA,MACxE,CAAA,MAAA,IAAW,KAAA,CAAM,MAAA,EAAO,EAAG;AAEzB,QAAA,IAAI,gBAAA,CAAiB,OAAA,EAAS,YAAY,CAAA,EAAG;AAC3C,UAAA,IAAI;AACF,YAAA,MAAM,KAAA,GAAQ,MAAMvD,IAAAA,CAAK,QAAQ,CAAA;AACjC,YAAA,OAAA,CAAQ,IAAA,CAAK;AAAA,cACX,IAAA,EAAM,YAAA;AAAA,cACN,OAAO,KAAA,CAAM;AAAA,aACd,CAAA;AAAA,UACH,CAAA,CAAA,MAAQ;AAAA,UAER;AAAA,QACF;AAAA,MACF;AAAA,IACF;AAAA,EACF,CAAA,CAAA,MAAQ;AAAA,EAER;AAEA,EAAA,OAAO,OAAA;AACT;AAKO,SAAS,cAAA,CAAe,MAAA,GAA+B,EAAC,EAAuC;AACpG,EAAA,MAAM,YAAA,GAAe,EAAE,GAAG,yBAAA,EAA2B,GAAG,MAAA,EAAO;AAE/D,EAAA,OAAO;AAAA,IACL,UAAA,EAAY;AAAA,MACV,IAAA,EAAM,UAAA;AAAA,MACN,QAAA,EAAU;AAAA,QACR,IAAA,EAAM,MAAA;AAAA,QACN,WAAA,EAAa,CAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,kDAAA,CAAA;AAAA,QAwBb,UAAA,EAAY;AAAA,UACV,IAAA,EAAM,QAAA;AAAA,UACN,UAAA,EAAY;AAAA,YACV,OAAA,EAAS;AAAA,cACP,IAAA,EAAM,QAAA;AAAA,cACN,WAAA,EAAa;AAAA,aACf;AAAA,YACA,IAAA,EAAM;AAAA,cACJ,IAAA,EAAM,QAAA;AAAA,cACN,WAAA,EAAa;AAAA;AACf,WACF;AAAA,UACA,QAAA,EAAU,CAAC,SAAS;AAAA;AACtB;AACF,KACF;AAAA,IAEA,YAAA,EAAc,CAAC,IAAA,KAA2B;AACxC,MAAA,IAAI,KAAK,IAAA,EAAM;AACb,QAAA,OAAO,CAAA,EAAG,IAAA,CAAK,OAAO,CAAA,IAAA,EAAO,KAAK,IAAI,CAAA,CAAA;AAAA,MACxC;AACA,MAAA,OAAO,IAAA,CAAK,OAAA;AAAA,IACd,CAAA;AAAA,IAEA,OAAA,EAAS,OAAO,IAAA,KAAwC;AACtD,MAAA,MAAM,EAAE,OAAA,EAAS,IAAA,EAAAH,KAAAA,EAAK,GAAI,IAAA;AAG1B,MAAA,MAAM,SAAA,GAAYA,SAAQ,YAAA,CAAa,gBAAA;AAGvC,MAAA,MAAM,UAAA,GAAa,aAAa,SAAA,EAAW;AAAA,QACzC,GAAG,YAAA;AAAA,QACH,oBAAoB;AAAC;AAAA,OACtB,CAAA;AACD,MAAA,IAAI,CAAC,WAAW,KAAA,EAAO;AACrB,QAAA,OAAO;AAAA,UACL,OAAA,EAAS,KAAA;AAAA,UACT,OAAO,UAAA,CAAW;AAAA,SACpB;AAAA,MACF;AAEA,MAAA,MAAM,cAAc,UAAA,CAAW,YAAA;AAG/B,MAAA,IAAI,CAACoD,UAAAA,CAAW,WAAW,CAAA,EAAG;AAC5B,QAAA,OAAO;AAAA,UACL,OAAA,EAAS,KAAA;AAAA,UACT,KAAA,EAAO,wBAAwB,SAAS,CAAA;AAAA,SAC1C;AAAA,MACF;AAEA,MAAA,IAAI;AAEF,QAAA,MAAM,UAAU,MAAM,SAAA,CAAU,WAAA,EAAa,OAAA,EAAS,aAAa,YAAY,CAAA;AAG/E,QAAA,OAAA,CAAQ,KAAK,CAAC,CAAA,EAAG,MAAM,CAAA,CAAE,KAAA,GAAQ,EAAE,KAAK,CAAA;AAGxC,QAAA,MAAM,SAAA,GAAY,OAAA,CAAQ,MAAA,IAAU,YAAA,CAAa,UAAA;AAEjD,QAAA,OAAO;AAAA,UACL,OAAA,EAAS,IAAA;AAAA,UACT,KAAA,EAAO,OAAA,CAAQ,GAAA,CAAI,CAAA,CAAA,KAAK,EAAE,IAAI,CAAA;AAAA,UAC9B,OAAO,OAAA,CAAQ,MAAA;AAAA,UACf;AAAA,SACF;AAAA,MACF,SAAS,KAAA,EAAO;AACd,QAAA,OAAO;AAAA,UACL,OAAA,EAAS,KAAA;AAAA,UACT,KAAA,EAAO,uBAAuB,KAAA,YAAiB,KAAA,GAAQ,MAAM,OAAA,GAAU,MAAA,CAAO,KAAK,CAAC,CAAA;AAAA,SACtF;AAAA,MACF;AAAA,IACF;AAAA,GACF;AACF;AAKO,IAAMrC,QAAO,cAAA;ACpLpB,IAAM,aAAA,GAA0C;AAAA,EAC9C,EAAA,EAAI,CAAC,KAAA,EAAO,MAAM,CAAA;AAAA,EAClB,EAAA,EAAI,CAAC,KAAA,EAAO,MAAA,EAAQ,QAAQ,MAAM,CAAA;AAAA,EAClC,EAAA,EAAI,CAAC,KAAA,EAAO,MAAM,CAAA;AAAA,EAClB,IAAA,EAAM,CAAC,OAAO,CAAA;AAAA,EACd,EAAA,EAAI,CAAC,KAAK,CAAA;AAAA,EACV,IAAA,EAAM,CAAC,KAAK,CAAA;AAAA,EACZ,CAAA,EAAG,CAAC,IAAA,EAAM,IAAI,CAAA;AAAA,EACd,KAAK,CAAC,MAAA,EAAQ,QAAQ,KAAA,EAAO,KAAA,EAAO,QAAQ,MAAM,CAAA;AAAA,EAClD,EAAA,EAAI,CAAC,KAAK,CAAA;AAAA,EACV,EAAA,EAAI,CAAC,KAAK,CAAA;AAAA,EACV,GAAA,EAAK,CAAC,MAAM,CAAA;AAAA,EACZ,KAAA,EAAO,CAAC,QAAQ,CAAA;AAAA,EAChB,MAAA,EAAQ,CAAC,KAAA,EAAO,MAAM,CAAA;AAAA,EACtB,KAAA,EAAO,CAAC,QAAQ,CAAA;AAAA,EAChB,IAAA,EAAM,CAAC,OAAA,EAAS,MAAM,CAAA;AAAA,EACtB,GAAA,EAAK,CAAC,MAAA,EAAQ,OAAA,EAAS,SAAS,OAAO,CAAA;AAAA,EACvC,IAAA,EAAM,CAAC,OAAO,CAAA;AAAA,EACd,IAAA,EAAM,CAAC,OAAA,EAAS,MAAM,CAAA;AAAA,EACtB,GAAA,EAAK,CAAC,MAAM,CAAA;AAAA,EACZ,EAAA,EAAI,CAAC,KAAA,EAAO,WAAW,CAAA;AAAA,EACvB,GAAA,EAAK,CAAC,MAAM,CAAA;AAAA,EACZ,EAAA,EAAI,CAAC,KAAA,EAAO,OAAA,EAAS,MAAM;AAC7B,CAAA;AAKA,eAAe,iBAAA,CACb,GAAA,EACA,OAAA,EACA,MAAA,EACA,WAAA,EACA,UACA,KAAA,GAAkB,EAAC,EACnB,KAAA,GAAgB,CAAA,EACG;AACnB,EAAA,IAAI,QAAQ,EAAA,IAAM,KAAA,CAAM,MAAA,IAAU,MAAA,CAAO,aAAa,EAAA,EAAI;AACxD,IAAA,OAAO,KAAA;AAAA,EACT;AAEA,EAAA,IAAI;AACF,IAAA,MAAM,UAAU,MAAM0C,OAAAA,CAAQ,KAAK,EAAE,aAAA,EAAe,MAAM,CAAA;AAE1D,IAAA,KAAA,MAAW,SAAS,OAAA,EAAS;AAC3B,MAAA,MAAM,QAAA,GAAW5B,IAAAA,CAAK,GAAA,EAAK,KAAA,CAAM,IAAI,CAAA;AAErC,MAAA,IAAI,KAAA,CAAM,aAAY,EAAG;AAEvB,QAAA,MAAM,SAAA,GAAY,OAAO,kBAAA,CAAmB,IAAA;AAAA,UAC1C,CAAA,OAAA,KAAW,MAAM,IAAA,KAAS;AAAA,SAC5B;AACA,QAAA,IAAI,SAAA,EAAW;AAEf,QAAA,MAAM,iBAAA,CAAkB,UAAU,OAAA,EAAS,MAAA,EAAQ,aAAa,QAAA,EAAU,KAAA,EAAO,QAAQ,CAAC,CAAA;AAAA,MAC5F,CAAA,MAAA,IAAW,KAAA,CAAM,MAAA,EAAO,EAAG;AAEzB,QAAA,IAAI,mBAAA,CAAoB,KAAA,CAAM,IAAA,EAAM,MAAA,CAAO,iBAAiB,CAAA,EAAG;AAG/D,QAAA,IAAI,QAAA,EAAU;AACZ,UAAA,MAAM,UAAA,GAAa,aAAA,CAAc,QAAA,CAAS,WAAA,EAAa,CAAA;AACvD,UAAA,IAAI,UAAA,EAAY;AACd,YAAA,MAAM,GAAA,GAAM8B,OAAAA,CAAQ,KAAA,CAAM,IAAI,EAAE,WAAA,EAAY;AAC5C,YAAA,IAAI,CAAC,UAAA,CAAW,QAAA,CAAS,GAAG,CAAA,EAAG;AAAA,UACjC;AAAA,QACF;AAGA,QAAA,IAAI,WAAA,EAAa;AACf,UAAA,MAAM,OAAA,GAAU,YACb,OAAA,CAAQ,KAAA,EAAO,KAAK,CAAA,CACpB,OAAA,CAAQ,KAAA,EAAO,IAAI,CAAA,CACnB,OAAA,CAAQ,gBAAgB,CAAC,CAAA,EAAG,CAAA,KAAM,CAAA,CAAA,EAAI,CAAA,CAAE,KAAA,CAAM,GAAG,CAAA,CAAE,IAAA,CAAK,GAAG,CAAC,CAAA,CAAA,CAAG,CAAA;AAClE,UAAA,MAAM,KAAA,GAAQ,IAAI,MAAA,CAAO,OAAA,GAAU,GAAG,CAAA;AACtC,UAAA,IAAI,CAAC,KAAA,CAAM,IAAA,CAAK,KAAA,CAAM,IAAI,CAAA,EAAG;AAAA,QAC/B;AAEA,QAAA,KAAA,CAAM,KAAK,QAAQ,CAAA;AAAA,MACrB;AAAA,IACF;AAAA,EACF,CAAA,CAAA,MAAQ;AAAA,EAER;AAEA,EAAA,OAAO,KAAA;AACT;AAKA,eAAe,UAAA,CACb,QAAA,EACA,KAAA,EACA,aAAA,EACA,YAAA,EACsB;AACtB,EAAA,MAAM,UAAuB,EAAC;AAE9B,EAAA,IAAI;AACF,IAAA,MAAM,OAAA,GAAU,MAAMT,QAAAA,CAAS,QAAA,EAAU,OAAO,CAAA;AAChD,IAAA,MAAM,KAAA,GAAQ,OAAA,CAAQ,KAAA,CAAM,IAAI,CAAA;AAEhC,IAAA,KAAA,IAAS,CAAA,GAAI,CAAA,EAAG,CAAA,GAAI,KAAA,CAAM,QAAQ,CAAA,EAAA,EAAK;AACrC,MAAA,MAAM,IAAA,GAAO,KAAA,CAAM,CAAC,CAAA,IAAK,EAAA;AACzB,MAAA,KAAA,CAAM,SAAA,GAAY,CAAA;AAElB,MAAA,IAAI,KAAA,CAAM,IAAA,CAAK,IAAI,CAAA,EAAG;AACpB,QAAA,MAAM,KAAA,GAAmB;AAAA,UACvB,IAAA,EAAM,QAAA;AAAA,UACN,MAAM,CAAA,GAAI,CAAA;AAAA,UACV,OAAA,EAAS,KAAK,MAAA,GAAS,GAAA,GAAM,KAAK,SAAA,CAAU,CAAA,EAAG,GAAG,CAAA,GAAI,KAAA,GAAQ;AAAA,SAChE;AAGA,QAAA,IAAI,aAAA,GAAgB,CAAA,IAAK,YAAA,GAAe,CAAA,EAAG;AACzC,UAAA,KAAA,CAAM,OAAA,GAAU;AAAA,YACd,MAAA,EAAQ,MAAM,KAAA,CAAM,IAAA,CAAK,IAAI,CAAA,EAAG,CAAA,GAAI,aAAa,CAAA,EAAG,CAAC,CAAA,CAAE,IAAI,CAAA,CAAA,KAAK,CAAA,CAAE,SAAS,GAAA,GAAM,CAAA,CAAE,UAAU,CAAA,EAAG,GAAG,CAAA,GAAI,KAAA,GAAQ,CAAC,CAAA;AAAA,YAChH,KAAA,EAAO,KAAA,CAAM,KAAA,CAAM,CAAA,GAAI,CAAA,EAAG,KAAK,GAAA,CAAI,KAAA,CAAM,MAAA,EAAQ,CAAA,GAAI,CAAA,GAAI,YAAY,CAAC,CAAA,CAAE,GAAA,CAAI,CAAA,CAAA,KAAK,CAAA,CAAE,MAAA,GAAS,GAAA,GAAM,CAAA,CAAE,SAAA,CAAU,CAAA,EAAG,GAAG,CAAA,GAAI,KAAA,GAAQ,CAAC;AAAA,WACnI;AAAA,QACF;AAEA,QAAA,OAAA,CAAQ,KAAK,KAAK,CAAA;AAAA,MACpB;AAAA,IACF;AAAA,EACF,CAAA,CAAA,MAAQ;AAAA,EAER;AAEA,EAAA,OAAO,OAAA;AACT;AAKO,SAAS,cAAA,CAAe,MAAA,GAA+B,EAAC,EAAuC;AACpG,EAAA,MAAM,YAAA,GAAe,EAAE,GAAG,yBAAA,EAA2B,GAAG,MAAA,EAAO;AAE/D,EAAA,OAAO;AAAA,IACL,UAAA,EAAY;AAAA,MACV,IAAA,EAAM,UAAA;AAAA,MACN,QAAA,EAAU;AAAA,QACR,IAAA,EAAM,MAAA;AAAA,QACN,WAAA,EAAa,CAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,4BAAA,CAAA;AAAA,QAiCb,UAAA,EAAY;AAAA,UACV,IAAA,EAAM,QAAA;AAAA,UACN,UAAA,EAAY;AAAA,YACV,OAAA,EAAS;AAAA,cACP,IAAA,EAAM,QAAA;AAAA,cACN,WAAA,EAAa;AAAA,aACf;AAAA,YACA,IAAA,EAAM;AAAA,cACJ,IAAA,EAAM,QAAA;AAAA,cACN,WAAA,EAAa;AAAA,aACf;AAAA,YACA,IAAA,EAAM;AAAA,cACJ,IAAA,EAAM,QAAA;AAAA,cACN,WAAA,EAAa;AAAA,aACf;AAAA,YACA,IAAA,EAAM;AAAA,cACJ,IAAA,EAAM,QAAA;AAAA,cACN,WAAA,EAAa;AAAA,aACf;AAAA,YACA,WAAA,EAAa;AAAA,cACX,IAAA,EAAM,QAAA;AAAA,cACN,IAAA,EAAM,CAAC,SAAA,EAAW,oBAAA,EAAsB,OAAO,CAAA;AAAA,cAC/C,WAAA,EAAa;AAAA,aACf;AAAA,YACA,gBAAA,EAAkB;AAAA,cAChB,IAAA,EAAM,SAAA;AAAA,cACN,WAAA,EAAa;AAAA,aACf;AAAA,YACA,cAAA,EAAgB;AAAA,cACd,IAAA,EAAM,QAAA;AAAA,cACN,WAAA,EAAa;AAAA,aACf;AAAA,YACA,aAAA,EAAe;AAAA,cACb,IAAA,EAAM,QAAA;AAAA,cACN,WAAA,EAAa;AAAA,aACf;AAAA,YACA,KAAA,EAAO;AAAA,cACL,IAAA,EAAM,QAAA;AAAA,cACN,WAAA,EAAa;AAAA;AACf,WACF;AAAA,UACA,QAAA,EAAU,CAAC,SAAS;AAAA;AACtB;AACF,KACF;AAAA,IAEA,YAAA,EAAc,CAAC,IAAA,KAA2B;AACxC,MAAA,MAAM,KAAA,GAAQ,CAAC,CAAA,CAAA,EAAI,IAAA,CAAK,OAAO,CAAA,CAAA,CAAG,CAAA;AAClC,MAAA,IAAI,KAAK,IAAA,EAAM,KAAA,CAAM,KAAK,CAAA,GAAA,EAAM,IAAA,CAAK,IAAI,CAAA,CAAE,CAAA;AAAA,WAAA,IAClC,KAAK,IAAA,EAAM,KAAA,CAAM,KAAK,CAAA,KAAA,EAAQ,IAAA,CAAK,IAAI,CAAA,CAAE,CAAA;AAClD,MAAA,IAAI,KAAK,IAAA,EAAM,KAAA,CAAM,KAAK,CAAA,CAAA,EAAI,IAAA,CAAK,IAAI,CAAA,CAAA,CAAG,CAAA;AAC1C,MAAA,OAAO,KAAA,CAAM,KAAK,GAAG,CAAA;AAAA,IACvB,CAAA;AAAA,IAEA,OAAA,EAAS,OAAO,IAAA,KAAwC;AACtD,MAAA,MAAM;AAAA,QACJ,OAAA;AAAA,QACA,IAAA,EAAAlD,KAAAA;AAAA,QACA,IAAA,EAAM,WAAA;AAAA,QACN,IAAA,EAAM,QAAA;AAAA,QACN,WAAA,GAAc,oBAAA;AAAA,QACd,gBAAA,GAAmB,KAAA;AAAA,QACnB,cAAA,GAAiB,CAAA;AAAA,QACjB,aAAA,GAAgB,CAAA;AAAA,QAChB;AAAA,OACF,GAAI,IAAA;AAGJ,MAAA,MAAM,UAAA,GAAaA,SAAQ,YAAA,CAAa,gBAAA;AAGxC,MAAA,MAAM,UAAA,GAAa,aAAa,UAAA,EAAY;AAAA,QAC1C,GAAG,YAAA;AAAA,QACH,oBAAoB;AAAC;AAAA,OACtB,CAAA;AACD,MAAA,IAAI,CAAC,WAAW,KAAA,EAAO;AACrB,QAAA,OAAO;AAAA,UACL,OAAA,EAAS,KAAA;AAAA,UACT,OAAO,UAAA,CAAW;AAAA,SACpB;AAAA,MACF;AAEA,MAAA,MAAM,eAAe,UAAA,CAAW,YAAA;AAGhC,MAAA,IAAI,CAACoD,UAAAA,CAAW,YAAY,CAAA,EAAG;AAC7B,QAAA,OAAO;AAAA,UACL,OAAA,EAAS,KAAA;AAAA,UACT,KAAA,EAAO,mBAAmB,UAAU,CAAA;AAAA,SACtC;AAAA,MACF;AAGA,MAAA,IAAI,KAAA;AACJ,MAAA,IAAI;AACF,QAAA,KAAA,GAAQ,IAAI,MAAA,CAAO,OAAA,EAAS,gBAAA,GAAmB,OAAO,GAAG,CAAA;AAAA,MAC3D,SAAS,KAAA,EAAO;AACd,QAAA,OAAO;AAAA,UACL,OAAA,EAAS,KAAA;AAAA,UACT,KAAA,EAAO,0BAA0B,KAAA,YAAiB,KAAA,GAAQ,MAAM,OAAA,GAAU,MAAA,CAAO,KAAK,CAAC,CAAA;AAAA,SACzF;AAAA,MACF;AAEA,MAAA,IAAI;AAEF,QAAA,MAAM,KAAA,GAAQ,MAAMjD,IAAAA,CAAK,YAAY,CAAA;AACrC,QAAA,IAAI,aAAA;AAEJ,QAAA,IAAI,KAAA,CAAM,QAAO,EAAG;AAClB,UAAA,aAAA,GAAgB,CAAC,YAAY,CAAA;AAAA,QAC/B,CAAA,MAAO;AACL,UAAA,aAAA,GAAgB,MAAM,iBAAA;AAAA,YACpB,YAAA;AAAA,YACA,YAAA;AAAA,YACA,YAAA;AAAA,YACA,WAAA;AAAA,YACA;AAAA,WACF;AAAA,QACF;AAGA,QAAA,MAAM,aAA0B,EAAC;AACjC,QAAA,MAAM,eAAA,uBAA2C,GAAA,EAAI;AACrD,QAAA,IAAI,YAAA,GAAe,CAAA;AAEnB,QAAA,KAAA,MAAW,QAAQ,aAAA,EAAe;AAChC,UAAA,IAAI,KAAA,IAAS,UAAA,CAAW,MAAA,IAAU,KAAA,EAAO;AAEzC,UAAA,MAAM,UAAU,MAAM,UAAA;AAAA,YACpB,IAAA;AAAA,YACA,KAAA;AAAA,YACA,WAAA,KAAgB,YAAY,cAAA,GAAiB,CAAA;AAAA,YAC7C,WAAA,KAAgB,YAAY,aAAA,GAAgB;AAAA,WAC9C;AAEA,UAAA,IAAI,OAAA,CAAQ,SAAS,CAAA,EAAG;AACtB,YAAA,YAAA,EAAA;AACA,YAAA,MAAM,YAAA,GAAeuD,QAAAA,CAAS,YAAA,EAAc,IAAI,CAAA,IAAK,IAAA;AAGrD,YAAA,KAAA,MAAW,SAAS,OAAA,EAAS;AAC3B,cAAA,KAAA,CAAM,IAAA,GAAO,YAAA;AAAA,YACf;AAEA,YAAA,eAAA,CAAgB,GAAA,CAAI,YAAA,EAAc,OAAA,CAAQ,MAAM,CAAA;AAEhD,YAAA,IAAI,gBAAgB,SAAA,EAAW;AAC7B,cAAA,MAAM,SAAA,GAAY,KAAA,GAAQ,KAAA,GAAQ,UAAA,CAAW,MAAA,GAAS,QAAA;AACtD,cAAA,UAAA,CAAW,KAAK,GAAG,OAAA,CAAQ,KAAA,CAAM,CAAA,EAAG,SAAS,CAAC,CAAA;AAAA,YAChD,CAAA,MAAO;AAEL,cAAA,MAAM,UAAA,GAAa,QAAQ,CAAC,CAAA;AAC5B,cAAA,IAAI,UAAA,EAAY;AACd,gBAAA,UAAA,CAAW,KAAK,UAAU,CAAA;AAAA,cAC5B;AAAA,YACF;AAAA,UACF;AAAA,QACF;AAGA,QAAA,IAAI,aAAA;AAEJ,QAAA,QAAQ,WAAA;AAAa,UACnB,KAAK,oBAAA;AAEH,YAAA,MAAM,WAAA,GAAc,IAAI,GAAA,CAAI,UAAA,CAAW,IAAI,CAAA,CAAA,KAAK,CAAA,CAAE,IAAI,CAAC,CAAA;AACvD,YAAA,aAAA,GAAgB,KAAA,CAAM,IAAA,CAAK,WAAW,CAAA,CAAE,IAAI,CAAA,IAAA,MAAS;AAAA,cACnD,IAAA;AAAA,cACA,IAAA,EAAM,CAAA;AAAA,cACN,OAAA,EAAS;AAAA,aACX,CAAE,CAAA;AACF,YAAA;AAAA,UAEF,KAAK,OAAA;AACH,YAAA,aAAA,GAAgB,KAAA,CAAM,IAAA,CAAK,eAAA,CAAgB,OAAA,EAAS,CAAA,CAAE,GAAA,CAAI,CAAC,CAAC,IAAA,EAAM,KAAK,CAAA,MAAO;AAAA,cAC5E,IAAA;AAAA,cACA,IAAA,EAAM,KAAA;AAAA,cACN,OAAA,EAAS,GAAG,KAAK,CAAA,QAAA;AAAA,aACnB,CAAE,CAAA;AACF,YAAA;AAAA,UAEF,KAAK,SAAA;AAAA,UACL;AACE,YAAA,aAAA,GAAgB,UAAA;AAAA;AAGpB,QAAA,MAAM,YAAA,GAAe,KAAA,CAAM,IAAA,CAAK,eAAA,CAAgB,MAAA,EAAQ,CAAA,CAAE,MAAA,CAAO,CAAC,CAAA,EAAG,CAAA,KAAM,CAAA,GAAI,GAAG,CAAC,CAAA;AACnF,QAAA,MAAM,YAAY,KAAA,GAAQ,UAAA,CAAW,MAAA,IAAU,KAAA,GAAQ,gBAAgB,YAAA,CAAa,UAAA;AAEpF,QAAA,OAAO;AAAA,UACL,OAAA,EAAS,IAAA;AAAA,UACT,OAAA,EAAS,aAAA;AAAA,UACT,eAAe,aAAA,CAAc,MAAA;AAAA,UAC7B,YAAA;AAAA,UACA,YAAA;AAAA,UACA;AAAA,SACF;AAAA,MACF,SAAS,KAAA,EAAO;AACd,QAAA,OAAO;AAAA,UACL,OAAA,EAAS,KAAA;AAAA,UACT,KAAA,EAAO,uBAAuB,KAAA,YAAiB,KAAA,GAAQ,MAAM,OAAA,GAAU,MAAA,CAAO,KAAK,CAAC,CAAA;AAAA,SACtF;AAAA,MACF;AAAA,IACF;AAAA,GACF;AACF;AAKO,IAAM,OAAO,cAAA;AC3XpB,eAAe,OAAA,CACb,GAAA,EACA,OAAA,EACA,MAAA,EACA,SAAA,EACA,MAAA,EACA,QAAA,GAAmB,CAAA,EACnB,YAAA,GAAuB,CAAA,EACvB,OAAA,GAA4B,EAAC,EACF;AAC3B,EAAA,IAAI,YAAA,GAAe,QAAA,IAAY,OAAA,CAAQ,MAAA,IAAU,OAAO,UAAA,EAAY;AAClE,IAAA,OAAO,OAAA;AAAA,EACT;AAEA,EAAA,IAAI;AACF,IAAA,MAAM,aAAa,MAAMD,OAAAA,CAAQ,KAAK,EAAE,aAAA,EAAe,MAAM,CAAA;AAE7D,IAAA,KAAA,MAAW,SAAS,UAAA,EAAY;AAC9B,MAAA,IAAI,OAAA,CAAQ,MAAA,IAAU,MAAA,CAAO,UAAA,EAAY;AAEzC,MAAA,MAAM,QAAA,GAAW5B,IAAAA,CAAK,GAAA,EAAK,KAAA,CAAM,IAAI,CAAA;AACrC,MAAA,MAAM,YAAA,GAAe6B,QAAAA,CAAS,OAAA,EAAS,QAAQ,CAAA;AAG/C,MAAA,IAAI,KAAA,CAAM,aAAY,IAAK,MAAA,CAAO,mBAAmB,QAAA,CAAS,KAAA,CAAM,IAAI,CAAA,EAAG;AACzE,QAAA;AAAA,MACF;AAEA,MAAA,MAAM,MAAA,GAAS,MAAM,MAAA,EAAO;AAC5B,MAAA,MAAM,KAAA,GAAQ,MAAM,WAAA,EAAY;AAGhC,MAAA,IAAI,MAAA,KAAW,OAAA,IAAW,CAAC,MAAA,EAAQ;AACjC,QAAA,IAAI,SAAS,SAAA,EAAW;AACtB,UAAA,MAAM,OAAA,CAAQ,UAAU,OAAA,EAAS,MAAA,EAAQ,WAAW,MAAA,EAAQ,QAAA,EAAU,YAAA,GAAe,CAAA,EAAG,OAAO,CAAA;AAAA,QACjG;AACA,QAAA;AAAA,MACF;AACA,MAAA,IAAI,MAAA,KAAW,aAAA,IAAiB,CAAC,KAAA,EAAO;AAExC,MAAA,IAAI;AACF,QAAA,MAAM,KAAA,GAAQ,MAAMvD,IAAAA,CAAK,QAAQ,CAAA;AAEjC,QAAA,MAAM,QAAA,GAA2B;AAAA,UAC/B,MAAM,KAAA,CAAM,IAAA;AAAA,UACZ,IAAA,EAAM,YAAA;AAAA,UACN,IAAA,EAAM,SAAS,MAAA,GAAS;AAAA,SAC1B;AAEA,QAAA,IAAI,MAAA,EAAQ;AACV,UAAA,QAAA,CAAS,OAAO,KAAA,CAAM,IAAA;AAAA,QACxB;AACA,QAAA,QAAA,CAAS,QAAA,GAAW,KAAA,CAAM,KAAA,CAAM,WAAA,EAAY;AAE5C,QAAA,OAAA,CAAQ,KAAK,QAAQ,CAAA;AAGrB,QAAA,IAAI,SAAS,SAAA,EAAW;AACtB,UAAA,MAAM,OAAA,CAAQ,UAAU,OAAA,EAAS,MAAA,EAAQ,WAAW,MAAA,EAAQ,QAAA,EAAU,YAAA,GAAe,CAAA,EAAG,OAAO,CAAA;AAAA,QACjG;AAAA,MACF,CAAA,CAAA,MAAQ;AAAA,MAER;AAAA,IACF;AAAA,EACF,CAAA,CAAA,MAAQ;AAAA,EAER;AAEA,EAAA,OAAO,OAAA;AACT;AAKO,SAAS,uBAAA,CAAwB,MAAA,GAA+B,EAAC,EAAyD;AAC/H,EAAA,MAAM,YAAA,GAAe,EAAE,GAAG,yBAAA,EAA2B,GAAG,MAAA,EAAO;AAE/D,EAAA,OAAO;AAAA,IACL,UAAA,EAAY;AAAA,MACV,IAAA,EAAM,UAAA;AAAA,MACN,QAAA,EAAU;AAAA,QACR,IAAA,EAAM,gBAAA;AAAA,QACN,WAAA,EAAa,CAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iEAAA,CAAA;AAAA,QAoBb,UAAA,EAAY;AAAA,UACV,IAAA,EAAM,QAAA;AAAA,UACN,UAAA,EAAY;AAAA,YACV,IAAA,EAAM;AAAA,cACJ,IAAA,EAAM,QAAA;AAAA,cACN,WAAA,EAAa;AAAA,aACf;AAAA,YACA,SAAA,EAAW;AAAA,cACT,IAAA,EAAM,SAAA;AAAA,cACN,WAAA,EAAa;AAAA,aACf;AAAA,YACA,MAAA,EAAQ;AAAA,cACN,IAAA,EAAM,QAAA;AAAA,cACN,IAAA,EAAM,CAAC,OAAA,EAAS,aAAa,CAAA;AAAA,cAC7B,WAAA,EAAa;AAAA,aACf;AAAA,YACA,SAAA,EAAW;AAAA,cACT,IAAA,EAAM,QAAA;AAAA,cACN,WAAA,EAAa;AAAA;AACf,WACF;AAAA,UACA,QAAA,EAAU,CAAC,MAAM;AAAA;AACnB;AACF,KACF;AAAA,IAEA,YAAA,EAAc,CAAC,IAAA,KAAoC;AACjD,MAAA,MAAM,QAAkB,EAAC;AACzB,MAAA,IAAI,IAAA,CAAK,SAAA,EAAW,KAAA,CAAM,IAAA,CAAK,WAAW,CAAA;AAC1C,MAAA,IAAI,IAAA,CAAK,MAAA,EAAQ,KAAA,CAAM,IAAA,CAAK,KAAK,MAAM,CAAA;AACvC,MAAA,IAAI,KAAA,CAAM,SAAS,CAAA,EAAG;AACpB,QAAA,OAAO,GAAG,IAAA,CAAK,IAAI,KAAK,KAAA,CAAM,IAAA,CAAK,IAAI,CAAC,CAAA,CAAA,CAAA;AAAA,MAC1C;AACA,MAAA,OAAO,IAAA,CAAK,IAAA;AAAA,IACd,CAAA;AAAA,IAEA,OAAA,EAAS,OAAO,IAAA,KAA0D;AACxE,MAAA,MAAM,EAAE,MAAAH,KAAAA,EAAM,SAAA,GAAY,OAAO,MAAA,EAAQ,SAAA,GAAY,GAAE,GAAI,IAAA;AAG3D,MAAA,MAAM,UAAA,GAAa,aAAaA,KAAAA,EAAM;AAAA,QACpC,GAAG,YAAA;AAAA,QACH,oBAAoB;AAAC;AAAA,OACtB,CAAA;AACD,MAAA,IAAI,CAAC,WAAW,KAAA,EAAO;AACrB,QAAA,OAAO;AAAA,UACL,OAAA,EAAS,KAAA;AAAA,UACT,OAAO,UAAA,CAAW;AAAA,SACpB;AAAA,MACF;AAEA,MAAA,MAAM,eAAe,UAAA,CAAW,YAAA;AAGhC,MAAA,IAAI,CAACoD,UAAAA,CAAW,YAAY,CAAA,EAAG;AAC7B,QAAA,OAAO;AAAA,UACL,OAAA,EAAS,KAAA;AAAA,UACT,KAAA,EAAO,wBAAwBpD,KAAI,CAAA;AAAA,SACrC;AAAA,MACF;AAEA,MAAA,IAAI;AACF,QAAA,MAAM,KAAA,GAAQ,MAAMG,IAAAA,CAAK,YAAY,CAAA;AACrC,QAAA,IAAI,CAAC,KAAA,CAAM,WAAA,EAAY,EAAG;AACxB,UAAA,OAAO;AAAA,YACL,OAAA,EAAS,KAAA;AAAA,YACT,KAAA,EAAO,4BAA4BH,KAAI,CAAA,sCAAA;AAAA,WACzC;AAAA,QACF;AAGA,QAAA,MAAM,UAAU,MAAM,OAAA;AAAA,UACpB,YAAA;AAAA,UACA,YAAA;AAAA,UACA,YAAA;AAAA,UACA,SAAA;AAAA,UACA,MAAA;AAAA,UACA;AAAA,SACF;AAGA,QAAA,OAAA,CAAQ,IAAA,CAAK,CAAC,CAAA,EAAG,CAAA,KAAM;AACrB,UAAA,IAAI,CAAA,CAAE,IAAA,KAAS,CAAA,CAAE,IAAA,EAAM;AACrB,YAAA,OAAO,CAAA,CAAE,IAAA,KAAS,WAAA,GAAc,CAAA,CAAA,GAAK,CAAA;AAAA,UACvC;AACA,UAAA,OAAO,CAAA,CAAE,IAAA,CAAK,aAAA,CAAc,CAAA,CAAE,IAAI,CAAA;AAAA,QACpC,CAAC,CAAA;AAED,QAAA,MAAM,SAAA,GAAY,OAAA,CAAQ,MAAA,IAAU,YAAA,CAAa,UAAA;AAEjD,QAAA,OAAO;AAAA,UACL,OAAA,EAAS,IAAA;AAAA,UACT,OAAA;AAAA,UACA,OAAO,OAAA,CAAQ,MAAA;AAAA,UACf;AAAA,SACF;AAAA,MACF,SAAS,KAAA,EAAO;AACd,QAAA,OAAO;AAAA,UACL,OAAA,EAAS,KAAA;AAAA,UACT,KAAA,EAAO,6BAA6B,KAAA,YAAiB,KAAA,GAAQ,MAAM,OAAA,GAAU,MAAA,CAAO,KAAK,CAAC,CAAA;AAAA,SAC5F;AAAA,MACF;AAAA,IACF;AAAA,GACF;AACF;AAKO,IAAM,gBAAgB,uBAAA;;;AC9MtB,IAAM,oBAAA,GAAkD;AAAA,EAC7D,gBAAA,EAAkB,QAAQ,GAAA,EAAI;AAAA,EAC9B,cAAA,EAAgB,IAAA;AAAA;AAAA,EAChB,UAAA,EAAY,GAAA;AAAA;AAAA,EACZ,KAAA,EAAO,OAAA,CAAQ,QAAA,KAAa,OAAA,GAAU,SAAA,GAAY,WAAA;AAAA,EAClD,KAAK,EAAC;AAAA,EACN,eAAA,EAAiB;AAAA,IACf,UAAA;AAAA,IACA,WAAA;AAAA,IACA,UAAA;AAAA,IACA,YAAA;AAAA,IACA,MAAA;AAAA,IACA,iBAAA;AAAA,IACA;AAAA;AAAA,GACF;AAAA,EACA,eAAA,EAAiB;AAAA,IACf,qCAAA;AAAA;AAAA,IACA,qBAAA;AAAA;AAAA,IACA,OAAA;AAAA,IACA;AAAA;AAAA,GACF;AAAA,EACA,aAAA,EAAe,GAAA;AAAA,EACf,eAAA,EAAiB;AACnB;AAoBO,SAAS,gBAAA,CACd,OAAA,EACA,MAAA,GAA0B,EAAC,EACY;AACvC,EAAA,MAAM,eAAA,GAAkB,MAAA,CAAO,eAAA,IAAmB,oBAAA,CAAqB,eAAA;AACvE,EAAA,MAAM,eAAA,GAAkB,MAAA,CAAO,eAAA,IAAmB,oBAAA,CAAqB,eAAA;AAGvE,EAAA,KAAA,MAAW,WAAW,eAAA,EAAiB;AACrC,IAAA,IAAI,OAAA,CAAQ,QAAA,CAAS,OAAO,CAAA,EAAG;AAC7B,MAAA,OAAO,EAAE,OAAA,EAAS,IAAA,EAAM,MAAA,EAAQ,CAAA,oCAAA,EAAuC,OAAO,CAAA,CAAA,CAAA,EAAI;AAAA,IACpF;AAAA,EACF;AAGA,EAAA,KAAA,MAAW,WAAW,eAAA,EAAiB;AACrC,IAAA,IAAI,OAAA,CAAQ,IAAA,CAAK,OAAO,CAAA,EAAG;AACzB,MAAA,OAAO,EAAE,OAAA,EAAS,IAAA,EAAM,MAAA,EAAQ,CAAA,+BAAA,CAAA,EAAkC;AAAA,IACpE;AAAA,EACF;AAEA,EAAA,OAAO,EAAE,SAAS,KAAA,EAAM;AAC1B;AC9FA,IAAM,mBAAA,uBAAgG,GAAA,EAAI;AAK1G,SAAS,oBAAA,GAA+B;AACtC,EAAA,OAAO,CAAA,GAAA,EAAM,IAAA,CAAK,GAAA,EAAK,IAAI,IAAA,CAAK,MAAA,EAAO,CAAE,QAAA,CAAS,EAAE,CAAA,CAAE,MAAA,CAAO,CAAA,EAAG,CAAC,CAAC,CAAA,CAAA;AACpE;AAKO,SAAS,cAAA,CAAe,MAAA,GAA0B,EAAC,EAAuC;AAC/F,EAAA,MAAM,YAAA,GAAe,EAAE,GAAG,oBAAA,EAAsB,GAAG,MAAA,EAAO;AAE1D,EAAA,OAAO;AAAA,IACL,UAAA,EAAY;AAAA,MACV,IAAA,EAAM,UAAA;AAAA,MACN,QAAA,EAAU;AAAA,QACR,IAAA,EAAM,MAAA;AAAA,QACN,WAAA,EAAa,CAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,mFAAA,CAAA;AAAA,QAmCb,UAAA,EAAY;AAAA,UACV,IAAA,EAAM,QAAA;AAAA,UACN,UAAA,EAAY;AAAA,YACV,OAAA,EAAS;AAAA,cACP,IAAA,EAAM,QAAA;AAAA,cACN,WAAA,EAAa;AAAA,aACf;AAAA,YACA,OAAA,EAAS;AAAA,cACP,IAAA,EAAM,QAAA;AAAA,cACN,WAAA,EAAa;AAAA,aACf;AAAA,YACA,WAAA,EAAa;AAAA,cACX,IAAA,EAAM,QAAA;AAAA,cACN,WAAA,EAAa;AAAA,aACf;AAAA,YACA,iBAAA,EAAmB;AAAA,cACjB,IAAA,EAAM,SAAA;AAAA,cACN,WAAA,EAAa;AAAA;AACf,WACF;AAAA,UACA,QAAA,EAAU,CAAC,SAAS;AAAA;AACtB;AACF,KACF;AAAA,IAEA,YAAA,EAAc,CAAC,IAAA,KAA2B;AACxC,MAAA,MAAM,MAAM,IAAA,CAAK,OAAA;AACjB,MAAA,MAAM,MAAA,GAAS,EAAA;AACf,MAAA,MAAM,MAAA,GAAS,IAAA,CAAK,iBAAA,GAAoB,OAAA,GAAU,EAAA;AAClD,MAAA,IAAI,GAAA,CAAI,MAAA,GAAS,MAAA,GAAS,MAAA,CAAO,MAAA,EAAQ;AACvC,QAAA,OAAO,MAAA,GAAS,IAAI,KAAA,CAAM,CAAA,EAAG,SAAS,MAAA,CAAO,MAAA,GAAS,CAAC,CAAA,GAAI,KAAA;AAAA,MAC7D;AACA,MAAA,OAAO,MAAA,GAAS,GAAA;AAAA,IAClB,CAAA;AAAA,IAEA,OAAA,EAAS,OAAO,IAAA,KAAwC;AACtD,MAAA,MAAM;AAAA,QACJ,OAAA;AAAA,QACA,UAAU,YAAA,CAAa,cAAA;AAAA,QACvB,iBAAA,GAAoB;AAAA,OACtB,GAAI,IAAA;AAGJ,MAAA,MAAM,UAAA,GAAa,gBAAA,CAAiB,OAAA,EAAS,YAAY,CAAA;AACzD,MAAA,IAAI,WAAW,OAAA,EAAS;AACtB,QAAA,OAAO;AAAA,UACL,OAAA,EAAS,KAAA;AAAA,UACT,KAAA,EAAO,CAAA,4BAAA,EAA+B,UAAA,CAAW,MAAM,CAAA;AAAA,SACzD;AAAA,MACF;AAGA,MAAA,MAAM,gBAAA,GAAmB,IAAA,CAAK,GAAA,CAAI,OAAA,EAAS,aAAa,UAAU,CAAA;AAGlE,MAAA,MAAM,GAAA,GAAM;AAAA,QACV,GAAG,OAAA,CAAQ,GAAA;AAAA,QACX,GAAG,YAAA,CAAa;AAAA,OAClB;AAEA,MAAA,OAAO,IAAI,OAAA,CAAQ,CAACD,QAAAA,KAAY;AAC9B,QAAA,MAAM,SAAA,GAAY,KAAK,GAAA,EAAI;AAG3B,QAAA,MAAM,YAAA,GAAe,KAAA,CAAM,OAAA,EAAS,EAAC,EAAG;AAAA,UACtC,OAAO,YAAA,CAAa,KAAA;AAAA,UACpB,KAAK,YAAA,CAAa,gBAAA;AAAA,UAClB,GAAA;AAAA,UACA,KAAA,EAAO,CAAC,MAAA,EAAQ,MAAA,EAAQ,MAAM;AAAA,SAC/B,CAAA;AAGD,QAAA,IAAI,iBAAA,IAAqB,aAAa,eAAA,EAAiB;AACrD,UAAA,MAAM,OAAO,oBAAA,EAAqB;AAClC,UAAA,MAAM,SAAmB,EAAC;AAE1B,UAAA,mBAAA,CAAoB,IAAI,IAAA,EAAM,EAAE,OAAA,EAAS,YAAA,EAAc,QAAQ,CAAA;AAE/D,UAAA,YAAA,CAAa,MAAA,CAAO,EAAA,CAAG,MAAA,EAAQ,CAAC,IAAA,KAAS;AACvC,YAAA,MAAA,CAAO,IAAA,CAAK,IAAA,CAAK,QAAA,EAAU,CAAA;AAAA,UAC7B,CAAC,CAAA;AAED,UAAA,YAAA,CAAa,MAAA,CAAO,EAAA,CAAG,MAAA,EAAQ,CAAC,IAAA,KAAS;AACvC,YAAA,MAAA,CAAO,IAAA,CAAK,IAAA,CAAK,QAAA,EAAU,CAAA;AAAA,UAC7B,CAAC,CAAA;AAED,UAAA,YAAA,CAAa,EAAA,CAAG,SAAS,MAAM;AAE7B,YAAA,UAAA,CAAW,MAAM;AACf,cAAA,mBAAA,CAAoB,OAAO,IAAI,CAAA;AAAA,YACjC,GAAG,GAAM,CAAA;AAAA,UACX,CAAC,CAAA;AAED,UAAAA,QAAAA,CAAQ;AAAA,YACN,OAAA,EAAS,IAAA;AAAA,YACT,YAAA,EAAc,IAAA;AAAA,YACd,MAAA,EAAQ,0CAA0C,IAAI,CAAA;AAAA,WACvD,CAAA;AACD,UAAA;AAAA,QACF;AAEA,QAAA,IAAI,MAAA,GAAS,EAAA;AACb,QAAA,IAAI,MAAA,GAAS,EAAA;AACb,QAAA,IAAI,MAAA,GAAS,KAAA;AAGb,QAAA,MAAM,SAAA,GAAY,WAAW,MAAM;AACjC,UAAA,MAAA,GAAS,IAAA;AACT,UAAA,YAAA,CAAa,KAAK,SAAS,CAAA;AAC3B,UAAA,UAAA,CAAW,MAAM;AACf,YAAA,IAAI,CAAC,aAAa,MAAA,EAAQ;AACxB,cAAA,YAAA,CAAa,KAAK,SAAS,CAAA;AAAA,YAC7B;AAAA,UACF,GAAG,GAAI,CAAA;AAAA,QACT,GAAG,gBAAgB,CAAA;AAGnB,QAAA,YAAA,CAAa,MAAA,CAAO,EAAA,CAAG,MAAA,EAAQ,CAAC,IAAA,KAAS;AACvC,UAAA,MAAA,IAAU,KAAK,QAAA,EAAS;AAExB,UAAA,IAAI,MAAA,CAAO,MAAA,GAAS,YAAA,CAAa,aAAA,GAAgB,CAAA,EAAG;AAClD,YAAA,MAAA,GAAS,MAAA,CAAO,KAAA,CAAM,CAAC,YAAA,CAAa,aAAa,CAAA;AAAA,UACnD;AAAA,QACF,CAAC,CAAA;AAGD,QAAA,YAAA,CAAa,MAAA,CAAO,EAAA,CAAG,MAAA,EAAQ,CAAC,IAAA,KAAS;AACvC,UAAA,MAAA,IAAU,KAAK,QAAA,EAAS;AACxB,UAAA,IAAI,MAAA,CAAO,MAAA,GAAS,YAAA,CAAa,aAAA,GAAgB,CAAA,EAAG;AAClD,YAAA,MAAA,GAAS,MAAA,CAAO,KAAA,CAAM,CAAC,YAAA,CAAa,aAAa,CAAA;AAAA,UACnD;AAAA,QACF,CAAC,CAAA;AAGD,QAAA,YAAA,CAAa,EAAA,CAAG,OAAA,EAAS,CAAC,IAAA,EAAM,MAAA,KAAW;AACzC,UAAA,YAAA,CAAa,SAAS,CAAA;AACtB,UAAA,MAAM,QAAA,GAAW,IAAA,CAAK,GAAA,EAAI,GAAI,SAAA;AAG9B,UAAA,IAAI,SAAA,GAAY,KAAA;AAChB,UAAA,IAAI,MAAA,CAAO,MAAA,GAAS,YAAA,CAAa,aAAA,EAAe;AAC9C,YAAA,MAAA,GAAS,MAAA,CAAO,KAAA,CAAM,CAAA,EAAG,YAAA,CAAa,aAAa,CAAA,GAAI,0BAAA;AACvD,YAAA,SAAA,GAAY,IAAA;AAAA,UACd;AACA,UAAA,IAAI,MAAA,CAAO,MAAA,GAAS,YAAA,CAAa,aAAA,EAAe;AAC9C,YAAA,MAAA,GAAS,MAAA,CAAO,KAAA,CAAM,CAAA,EAAG,YAAA,CAAa,aAAa,CAAA,GAAI,0BAAA;AACvD,YAAA,SAAA,GAAY,IAAA;AAAA,UACd;AAEA,UAAA,IAAI,MAAA,EAAQ;AACV,YAAAA,QAAAA,CAAQ;AAAA,cACN,OAAA,EAAS,KAAA;AAAA,cACT,MAAA;AAAA,cACA,MAAA;AAAA,cACA,UAAU,IAAA,IAAQ,MAAA;AAAA,cAClB,QAAQ,MAAA,IAAU,MAAA;AAAA,cAClB,QAAA;AAAA,cACA,SAAA;AAAA,cACA,KAAA,EAAO,2BAA2B,gBAAgB,CAAA,EAAA;AAAA,aACnD,CAAA;AAAA,UACH,CAAA,MAAO;AACL,YAAAA,QAAAA,CAAQ;AAAA,cACN,SAAS,IAAA,KAAS,CAAA;AAAA,cAClB,MAAA;AAAA,cACA,MAAA;AAAA,cACA,UAAU,IAAA,IAAQ,MAAA;AAAA,cAClB,QAAQ,MAAA,IAAU,MAAA;AAAA,cAClB,QAAA;AAAA,cACA,SAAA;AAAA,cACA,KAAA,EAAO,IAAA,KAAS,CAAA,GAAI,CAAA,yBAAA,EAA4B,IAAI,CAAA,CAAA,GAAK;AAAA,aAC1D,CAAA;AAAA,UACH;AAAA,QACF,CAAC,CAAA;AAGD,QAAA,YAAA,CAAa,EAAA,CAAG,OAAA,EAAS,CAAC,KAAA,KAAU;AAClC,UAAA,YAAA,CAAa,SAAS,CAAA;AACtB,UAAAA,QAAAA,CAAQ;AAAA,YACN,OAAA,EAAS,KAAA;AAAA,YACT,KAAA,EAAO,CAAA,2BAAA,EAA8B,KAAA,CAAM,OAAO,CAAA,CAAA;AAAA,YAClD,QAAA,EAAU,IAAA,CAAK,GAAA,EAAI,GAAI;AAAA,WACxB,CAAA;AAAA,QACH,CAAC,CAAA;AAAA,MACH,CAAC,CAAA;AAAA,IACH;AAAA,GACF;AACF;AAKO,SAAS,oBAAoB,IAAA,EAAsE;AACxG,EAAA,MAAM,EAAA,GAAK,mBAAA,CAAoB,GAAA,CAAI,IAAI,CAAA;AACvC,EAAA,IAAI,CAAC,EAAA,EAAI;AACP,IAAA,OAAO,EAAE,OAAO,KAAA,EAAM;AAAA,EACxB;AAEA,EAAA,OAAO;AAAA,IACL,KAAA,EAAO,IAAA;AAAA,IACP,MAAA,EAAQ,EAAA,CAAG,MAAA,CAAO,IAAA,CAAK,EAAE,CAAA;AAAA,IACzB,SAAS,CAAC,EAAA,CAAG,QAAQ,MAAA,IAAU,EAAA,CAAG,QAAQ,QAAA,KAAa;AAAA,GACzD;AACF;AAKO,SAAS,sBAAsB,IAAA,EAAuB;AAC3D,EAAA,MAAM,EAAA,GAAK,mBAAA,CAAoB,GAAA,CAAI,IAAI,CAAA;AACvC,EAAA,IAAI,CAAC,EAAA,EAAI;AACP,IAAA,OAAO,KAAA;AAAA,EACT;AAEA,EAAA,EAAA,CAAG,OAAA,CAAQ,KAAK,SAAS,CAAA;AACzB,EAAA,OAAO,IAAA;AACT;AAKO,IAAM,OAAO,cAAA;;;AC5Sb,SAAS,UAAUC,KAAAA,EAAwB;AAChD,EAAA,IAAIA,KAAAA,KAAS,EAAA,IAAMA,KAAAA,KAAS,GAAA,EAAK;AAC/B,IAAA,OAAO,EAAC;AAAA,EACV;AAEA,EAAA,MAAM,IAAA,GAAOA,KAAAA,CAAK,KAAA,CAAM,GAAG,CAAA;AAG3B,EAAA,MAAM,WAAW,IAAA,CAAK,MAAA,CAAO,CAAC,CAAA,KAAM,CAAA,CAAE,SAAS,CAAC,CAAA;AAGhD,EAAA,IAAI,QAAA,CAAS,MAAA,KAAW,IAAA,CAAK,MAAA,EAAQ;AACnC,IAAA,MAAM,IAAI,KAAA,CAAM,CAAA,qBAAA,EAAwBA,KAAI,CAAA,+BAAA,CAAiC,CAAA;AAAA,EAC/E;AAEA,EAAA,OAAO,QAAA;AACT;AAOO,SAAS,cAAA,CAAe,KAAUA,KAAAA,EAAmB;AAC1D,EAAA,MAAM,IAAA,GAAO,UAAUA,KAAI,CAAA;AAC3B,EAAA,IAAI,OAAA,GAAU,GAAA;AAEd,EAAA,KAAA,MAAW,OAAO,IAAA,EAAM;AACtB,IAAA,IAAI,OAAA,KAAY,IAAA,IAAQ,OAAA,KAAY,MAAA,EAAW;AAC7C,MAAA,OAAO,MAAA;AAAA,IACT;AAGA,IAAA,OAAA,GAAU,QAAQ,GAAG,CAAA;AAAA,EACvB;AAEA,EAAA,OAAO,OAAA;AACT;AAUO,SAAS,cAAA,CAAe,GAAA,EAAUA,KAAAA,EAAc,KAAA,EAAqB;AAC1E,EAAA,MAAM,IAAA,GAAO,UAAUA,KAAI,CAAA;AAE3B,EAAA,IAAI,IAAA,CAAK,WAAW,CAAA,EAAG;AACrB,IAAA,MAAM,IAAI,MAAM,iDAAiD,CAAA;AAAA,EACnE;AAEA,EAAA,IAAI,OAAA,GAAU,GAAA;AAGd,EAAA,KAAA,IAAS,IAAI,CAAA,EAAG,CAAA,GAAI,IAAA,CAAK,MAAA,GAAS,GAAG,CAAA,EAAA,EAAK;AACxC,IAAA,MAAM,GAAA,GAAM,KAAK,CAAC,CAAA;AAGlB,IAAA,IAAI,EAAE,GAAA,IAAO,OAAA,CAAA,IAAY,OAAA,CAAQ,GAAG,MAAM,IAAA,IAAQ,OAAA,CAAQ,GAAG,CAAA,KAAM,MAAA,EAAW;AAE5E,MAAA,MAAM,OAAA,GAAU,IAAA,CAAK,CAAA,GAAI,CAAC,CAAA;AAC1B,MAAA,MAAM,YAAA,GAAe,OAAA,KAAY,MAAA,IAAa,OAAA,CAAQ,KAAK,OAAO,CAAA;AAElE,MAAA,OAAA,CAAQ,GAAG,CAAA,GAAI,YAAA,GAAe,KAAK,EAAC;AAAA,IACtC;AAEA,IAAA,OAAA,GAAU,QAAQ,GAAG,CAAA;AAGrB,IAAA,IAAI,OAAA,KAAY,IAAA,IAAQ,OAAA,KAAY,MAAA,EAAW;AAC7C,MAAA,MAAM,IAAI,KAAA,CAAM,CAAA,gDAAA,EAAmD,IAAA,CAAK,KAAA,CAAM,CAAA,EAAG,CAAA,GAAI,CAAC,CAAA,CAAE,IAAA,CAAK,GAAG,CAAC,CAAA,CAAE,CAAA;AAAA,IACrG;AAAA,EACF;AAGA,EAAA,MAAM,OAAA,GAAU,IAAA,CAAK,IAAA,CAAK,MAAA,GAAS,CAAC,CAAA;AAGpC,EAAA,IAAI,KAAA,CAAM,OAAA,CAAQ,OAAO,CAAA,EAAG;AAC1B,IAAA,MAAM,KAAA,GAAQ,SAAS,OAAO,CAAA;AAC9B,IAAA,IAAI,KAAA,CAAM,KAAK,CAAA,EAAG;AAChB,MAAA,MAAM,IAAI,KAAA,CAAM,CAAA,kCAAA,EAAqC,OAAO,CAAA,CAAE,CAAA;AAAA,IAChE;AAEA,IAAA,OAAA,CAAQ,KAAK,CAAA,GAAI,KAAA;AAAA,EACnB,CAAA,MAAO;AACL,IAAA,OAAA,CAAQ,OAAO,CAAA,GAAI,KAAA;AAAA,EACrB;AAEA,EAAA,OAAO,IAAA;AACT;AAQO,SAAS,YAAA,CAAa,KAAUA,KAAAA,EAAuB;AAC5D,EAAA,MAAM,IAAA,GAAO,UAAUA,KAAI,CAAA;AAE3B,EAAA,IAAI,IAAA,CAAK,WAAW,CAAA,EAAG;AACrB,IAAA,MAAM,IAAI,MAAM,oDAAoD,CAAA;AAAA,EACtE;AAEA,EAAA,IAAI,OAAA,GAAU,GAAA;AAGd,EAAA,KAAA,IAAS,IAAI,CAAA,EAAG,CAAA,GAAI,IAAA,CAAK,MAAA,GAAS,GAAG,CAAA,EAAA,EAAK;AACxC,IAAA,MAAM,GAAA,GAAM,KAAK,CAAC,CAAA;AAElB,IAAA,IAAI,EAAE,OAAO,OAAA,CAAA,EAAU;AACrB,MAAA,OAAO,KAAA;AAAA,IACT;AAEA,IAAA,OAAA,GAAU,QAAQ,GAAG,CAAA;AAErB,IAAA,IAAI,OAAA,KAAY,IAAA,IAAQ,OAAA,KAAY,MAAA,EAAW;AAC7C,MAAA,OAAO,KAAA;AAAA,IACT;AAAA,EACF;AAEA,EAAA,MAAM,OAAA,GAAU,IAAA,CAAK,IAAA,CAAK,MAAA,GAAS,CAAC,CAAA;AAGpC,EAAA,IAAI,EAAE,WAAW,OAAA,CAAA,EAAU;AACzB,IAAA,OAAO,KAAA;AAAA,EACT;AAGA,EAAA,IAAI,KAAA,CAAM,OAAA,CAAQ,OAAO,CAAA,EAAG;AAC1B,IAAA,MAAM,KAAA,GAAQ,SAAS,OAAO,CAAA;AAC9B,IAAA,IAAI,MAAM,KAAK,CAAA,IAAK,QAAQ,CAAA,IAAK,KAAA,IAAS,QAAQ,MAAA,EAAQ;AACxD,MAAA,OAAO,KAAA;AAAA,IACT;AACA,IAAA,OAAA,CAAQ,MAAA,CAAO,OAAO,CAAC,CAAA;AAAA,EACzB,CAAA,MAAO;AACL,IAAA,OAAO,QAAQ,OAAO,CAAA;AAAA,EACxB;AAEA,EAAA,OAAO,IAAA;AACT;AAKO,SAAS,UAAA,CAAW,KAAUA,KAAAA,EAAuB;AAC1D,EAAA,IAAI;AACF,IAAA,MAAM,KAAA,GAAQ,cAAA,CAAe,GAAA,EAAKA,KAAI,CAAA;AACtC,IAAA,OAAO,KAAA,KAAU,KAAA,CAAA;AAAA,EACnB,CAAA,CAAA,MAAQ;AACN,IAAA,OAAO,KAAA;AAAA,EACT;AACF;;;ACjJO,IAAM,eAAA,GAA0E;AAAA,EACrF,UAAA,EAAY;AAAA,IACV,IAAA,EAAM,UAAA;AAAA,IACN,QAAA,EAAU;AAAA,MACR,IAAA,EAAM,iBAAA;AAAA,MACN,WAAA,EAAa,CAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,2CAAA,CAAA;AAAA,MA2Db,UAAA,EAAY;AAAA,QACV,IAAA,EAAM,QAAA;AAAA,QACN,UAAA,EAAY;AAAA,UACV,SAAA,EAAW;AAAA,YACT,IAAA,EAAM,QAAA;AAAA,YACN,IAAA,EAAM,CAAC,QAAA,EAAU,KAAA,EAAO,SAAS,CAAA;AAAA,YACjC,WAAA,EACE;AAAA,WACJ;AAAA,UACA,IAAA,EAAM;AAAA,YACJ,IAAA,EAAM,QAAA;AAAA,YACN,WAAA,EACE;AAAA,WACJ;AAAA,UACA,KAAA,EAAO;AAAA,YACL,WAAA,EACE;AAAA,WACJ;AAAA,UACA,MAAA,EAAQ;AAAA,YACN,IAAA,EAAM,QAAA;AAAA,YACN,WAAA,EACE;AAAA;AACJ,SACF;AAAA,QACA,QAAA,EAAU,CAAC,WAAA,EAAa,MAAA,EAAQ,QAAQ;AAAA;AAC1C,KACF;AAAA,IACA,QAAA,EAAU,IAAA;AAAA;AAAA,IACV,OAAA,EAAS;AAAA;AAAA,GACX;AAAA,EAEA,OAAA,EAAS,OAAO,IAAA,KAA4D;AAC1E,IAAA,IAAI;AAEF,MAAA,IAAI,CAAC,CAAC,QAAA,EAAU,KAAA,EAAO,SAAS,CAAA,CAAE,QAAA,CAAS,IAAA,CAAK,SAAS,CAAA,EAAG;AAC1D,QAAA,OAAO;AAAA,UACL,OAAA,EAAS,KAAA;AAAA,UACT,MAAA,EAAQ,IAAA;AAAA,UACR,KAAA,EAAO,CAAA,oBAAA,EAAuB,IAAA,CAAK,SAAS,CAAA,yCAAA;AAAA,SAC9C;AAAA,MACF;AAGA,MAAA,IAAI,CAAC,IAAA,CAAK,MAAA,IAAU,OAAO,IAAA,CAAK,WAAW,QAAA,EAAU;AACnD,QAAA,OAAO;AAAA,UACL,OAAA,EAAS,KAAA;AAAA,UACT,MAAA,EAAQ,IAAA;AAAA,UACR,KAAA,EAAO;AAAA,SACT;AAAA,MACF;AAGA,MAAA,IAAI,YAAA;AACJ,MAAA,IAAI;AACF,QAAA,YAAA,GAAe,KAAK,KAAA,CAAM,IAAA,CAAK,SAAA,CAAU,IAAA,CAAK,MAAM,CAAC,CAAA;AAAA,MACvD,SAAS,KAAA,EAAY;AACnB,QAAA,OAAO;AAAA,UACL,OAAA,EAAS,KAAA;AAAA,UACT,MAAA,EAAQ,IAAA;AAAA,UACR,KAAA,EAAO,CAAA,qBAAA,EAAwB,KAAA,CAAM,OAAO,CAAA,4DAAA;AAAA,SAC9C;AAAA,MACF;AAGA,MAAA,QAAQ,KAAK,SAAA;AAAW,QACtB,KAAK,QAAA,EAAU;AACb,UAAA,IAAI;AACF,YAAA,MAAM,OAAA,GAAU,YAAA,CAAa,YAAA,EAAc,IAAA,CAAK,IAAI,CAAA;AAEpD,YAAA,IAAI,CAAC,OAAA,EAAS;AACZ,cAAA,OAAO;AAAA,gBACL,OAAA,EAAS,KAAA;AAAA,gBACT,MAAA,EAAQ,IAAA;AAAA,gBACR,KAAA,EAAO,CAAA,iBAAA,EAAoB,IAAA,CAAK,IAAI,CAAA,0CAAA;AAAA,eACtC;AAAA,YACF;AAEA,YAAA,OAAO;AAAA,cACL,OAAA,EAAS,IAAA;AAAA,cACT,MAAA,EAAQ,YAAA;AAAA,cACR,OAAA,EAAS,CAAA,qCAAA,EAAwC,IAAA,CAAK,IAAI,CAAA,CAAA;AAAA,aAC5D;AAAA,UACF,SAAS,KAAA,EAAY;AACnB,YAAA,OAAO;AAAA,cACL,OAAA,EAAS,KAAA;AAAA,cACT,MAAA,EAAQ,IAAA;AAAA,cACR,KAAA,EAAO,CAAA,yBAAA,EAA4B,KAAA,CAAM,OAAO,CAAA;AAAA,aAClD;AAAA,UACF;AAAA,QACF;AAAA,QAEA,KAAK,KAAA,EAAO;AAEV,UAAA,IAAI,IAAA,CAAK,UAAU,KAAA,CAAA,EAAW;AAC5B,YAAA,OAAO;AAAA,cACL,OAAA,EAAS,KAAA;AAAA,cACT,MAAA,EAAQ,IAAA;AAAA,cACR,KAAA,EAAO;AAAA,aACT;AAAA,UACF;AAEA,UAAA,IAAI;AACF,YAAA,cAAA,CAAe,YAAA,EAAc,IAAA,CAAK,IAAA,EAAM,IAAA,CAAK,KAAK,CAAA;AAElD,YAAA,OAAO;AAAA,cACL,OAAA,EAAS,IAAA;AAAA,cACT,MAAA,EAAQ,YAAA;AAAA,cACR,OAAA,EAAS,CAAA,mCAAA,EAAsC,IAAA,CAAK,IAAI,CAAA,CAAA;AAAA,aAC1D;AAAA,UACF,SAAS,KAAA,EAAY;AACnB,YAAA,OAAO;AAAA,cACL,OAAA,EAAS,KAAA;AAAA,cACT,MAAA,EAAQ,IAAA;AAAA,cACR,KAAA,EAAO,CAAA,sBAAA,EAAyB,KAAA,CAAM,OAAO,CAAA;AAAA,aAC/C;AAAA,UACF;AAAA,QACF;AAAA,QAEA,KAAK,SAAA,EAAW;AAEd,UAAA,IAAI,IAAA,CAAK,UAAU,KAAA,CAAA,EAAW;AAC5B,YAAA,OAAO;AAAA,cACL,OAAA,EAAS,KAAA;AAAA,cACT,MAAA,EAAQ,IAAA;AAAA,cACR,KAAA,EAAO;AAAA,aACT;AAAA,UACF;AAGA,UAAA,IAAI,CAAC,UAAA,CAAW,YAAA,EAAc,IAAA,CAAK,IAAI,CAAA,EAAG;AACxC,YAAA,OAAO;AAAA,cACL,OAAA,EAAS,KAAA;AAAA,cACT,MAAA,EAAQ,IAAA;AAAA,cACR,KAAA,EAAO,CAAA,iBAAA,EAAoB,IAAA,CAAK,IAAI,CAAA,4CAAA;AAAA,aACtC;AAAA,UACF;AAEA,UAAA,IAAI;AACF,YAAA,cAAA,CAAe,YAAA,EAAc,IAAA,CAAK,IAAA,EAAM,IAAA,CAAK,KAAK,CAAA;AAElD,YAAA,OAAO;AAAA,cACL,OAAA,EAAS,IAAA;AAAA,cACT,MAAA,EAAQ,YAAA;AAAA,cACR,OAAA,EAAS,CAAA,sCAAA,EAAyC,IAAA,CAAK,IAAI,CAAA,CAAA;AAAA,aAC7D;AAAA,UACF,SAAS,KAAA,EAAY;AACnB,YAAA,OAAO;AAAA,cACL,OAAA,EAAS,KAAA;AAAA,cACT,MAAA,EAAQ,IAAA;AAAA,cACR,KAAA,EAAO,CAAA,0BAAA,EAA6B,KAAA,CAAM,OAAO,CAAA;AAAA,aACnD;AAAA,UACF;AAAA,QACF;AAAA,QAEA;AACE,UAAA,OAAO;AAAA,YACL,OAAA,EAAS,KAAA;AAAA,YACT,MAAA,EAAQ,IAAA;AAAA,YACR,KAAA,EAAO,CAAA,mBAAA,EAAsB,IAAA,CAAK,SAAS,CAAA;AAAA,WAC7C;AAAA;AACJ,IACF,SAAS,KAAA,EAAY;AACnB,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,KAAA;AAAA,QACT,MAAA,EAAQ,IAAA;AAAA,QACR,KAAA,EAAO,CAAA,oCAAA,EAAuC,KAAA,CAAM,OAAO,CAAA;AAAA,OAC7D;AAAA,IACF;AAAA,EACF;AACF,CAAA;;;AChPO,SAAS,oBAAA,CACd,IAAA,EACA,IAAA,EACA,CAAA,EACe;AACf,EAAA,MAAM,SAAmB,EAAC;AAC1B,EAAA,IAAI,KAAA,GAAQ,GAAA;AACZ,EAAA,IAAI,UAAA,GAAa,KAAA;AAGjB,EAAA,IAAI,IAAA,CAAK,SAAS,GAAA,EAAK;AACrB,IAAA,MAAA,CAAO,KAAK,oCAAoC,CAAA;AAChD,IAAA,KAAA,IAAS,EAAA;AACT,IAAA,UAAA,GAAa,IAAA;AAAA,EACf;AAGA,EAAA,MAAM,aAAA,GAAgB;AAAA,IACpB,EAAE,OAAA,EAAS,gBAAA,EAAkB,OAAA,EAAS,EAAA,EAAG;AAAA,IACzC,EAAE,OAAA,EAAS,gBAAA,EAAkB,OAAA,EAAS,EAAA,EAAG;AAAA,IACzC,EAAE,OAAA,EAAS,gBAAA,EAAkB,OAAA,EAAS,EAAA,EAAG;AAAA,IACzC,EAAE,OAAA,EAAS,iBAAA,EAAmB,OAAA,EAAS,EAAA,EAAG;AAAA,IAC1C,EAAE,OAAA,EAAS,aAAA,EAAe,OAAA,EAAS,EAAA,EAAG;AAAA,IACtC,EAAE,OAAA,EAAS,2BAAA,EAA6B,OAAA,EAAS,EAAA,EAAG;AAAA,IACpD,EAAE,OAAA,EAAS,sBAAA,EAAwB,OAAA,EAAS,EAAA,EAAG;AAAA,IAC/C,EAAE,OAAA,EAAS,sBAAA,EAAwB,OAAA,EAAS,EAAA;AAAG,GACjD;AAEA,EAAA,KAAA,MAAW,EAAE,OAAA,EAAS,OAAA,EAAQ,IAAK,aAAA,EAAe;AAChD,IAAA,IAAI,QAAQ,IAAA,CAAK,IAAI,KAAK,OAAA,CAAQ,IAAA,CAAK,IAAI,CAAA,EAAG;AAC5C,MAAA,MAAA,CAAO,IAAA,CAAK,CAAA,wBAAA,EAA2B,OAAA,CAAQ,MAAM,CAAA,CAAE,CAAA;AACvD,MAAA,KAAA,IAAS,OAAA;AAAA,IACX;AAAA,EACF;AAGA,EAAA,MAAM,WAAA,GAAc,CAAA,CAAE,QAAQ,CAAA,CAAE,MAAA;AAChC,EAAA,MAAM,aAAa,IAAA,CAAK,MAAA;AAExB,EAAA,IAAI,WAAA,GAAc,EAAA,IAAM,UAAA,GAAa,GAAA,EAAK;AACxC,IAAA,MAAA,CAAO,KAAK,4CAA4C,CAAA;AACxD,IAAA,KAAA,IAAS,EAAA;AACT,IAAA,UAAA,GAAa,IAAA;AAAA,EACf;AAGA,EAAA,MAAM,YAAA,GAAe,CAAA,CAAE,QAAQ,CAAA,CAAE,MAAK,CAAE,MAAA;AACxC,EAAA,IAAI,YAAA,GAAe,UAAA,GAAa,CAAA,IAAK,UAAA,GAAa,GAAA,EAAM;AACtD,IAAA,MAAA,CAAO,KAAK,kCAAkC,CAAA;AAC9C,IAAA,KAAA,IAAS,EAAA;AACT,IAAA,UAAA,GAAa,IAAA;AAAA,EACf;AAGA,EAAA,MAAM,YAAA,GAAe;AAAA,IACnB,EAAE,OAAA,EAAS,YAAA,EAAc,IAAA,EAAM,OAAA,EAAQ;AAAA,IACvC,EAAE,OAAA,EAAS,UAAA,EAAY,IAAA,EAAM,KAAA,EAAM;AAAA,IACnC,EAAE,OAAA,EAAS,cAAA,EAAgB,IAAA,EAAM,SAAA,EAAU;AAAA,IAC3C,EAAE,OAAA,EAAS,gBAAA,EAAkB,IAAA,EAAM,SAAA,EAAU;AAAA,IAC7C,EAAE,OAAA,EAAS,cAAA,EAAgB,IAAA,EAAM,SAAA,EAAU;AAAA,IAC3C,EAAE,OAAA,EAAS,cAAA,EAAgB,IAAA,EAAM,KAAA;AAAM,GACzC;AAEA,EAAA,KAAA,MAAW,aAAa,YAAA,EAAc;AACpC,IAAA,IAAI,SAAA,CAAU,OAAA,CAAQ,IAAA,CAAK,IAAI,CAAA,EAAG;AAChC,MAAA,MAAA,CAAO,IAAA,CAAK,CAAA,EAAG,SAAA,CAAU,IAAI,CAAA,mBAAA,CAAqB,CAAA;AAClD,MAAA,UAAA,GAAa,IAAA;AAAA,IACf;AAAA,EACF;AAGA,EAAA,MAAM,WAAW,CAAA,CAAE,MAAM,CAAA,CAAE,IAAA,GAAO,IAAA,EAAK;AACvC,EAAA,MAAM,QAAA,GAAW,CAAA,CAAE,KAAK,CAAA,CAAE,MAAA;AAE1B,EAAA,IAAI,QAAA,CAAS,MAAA,GAAS,GAAA,IAAO,QAAA,GAAW,CAAA,EAAG;AACzC,IAAA,MAAA,CAAO,KAAK,oDAAoD,CAAA;AAChE,IAAA,KAAA,IAAS,EAAA;AACT,IAAA,UAAA,GAAa,IAAA;AAAA,EACf;AAGA,EAAA,MAAM,QAAA,GAAW,CAAA,CAAE,UAAU,CAAA,CAAE,IAAA,EAAK;AACpC,EAAA,IAAI,QAAA,CAAS,SAAS,EAAA,EAAI;AACxB,IAAA,MAAA,CAAO,KAAK,iDAAiD,CAAA;AAC7D,IAAA,UAAA,GAAa,IAAA;AAAA,EACf;AAGA,EAAA,MAAM,cAAA,GAAiB,CAAA,CAAE,GAAG,CAAA,CAAE,MAAA;AAC9B,EAAA,MAAM,YAAA,GAAe,CAAA,CAAE,wBAAwB,CAAA,CAAE,MAAA;AAEjD,EAAA,IAAI,cAAA,GAAiB,CAAA,IAAK,YAAA,GAAe,CAAA,IAAK,aAAa,GAAA,EAAK;AAC9D,IAAA,MAAA,CAAO,KAAK,qDAAqD,CAAA;AACjE,IAAA,KAAA,IAAS,EAAA;AACT,IAAA,UAAA,GAAa,IAAA;AAAA,EACf;AAGA,EAAA,IAAI,UAAA;AACJ,EAAA,IAAI,UAAA,IAAc,QAAQ,EAAA,EAAI;AAC5B,IAAA,UAAA,GACE,sHAAA;AAAA,EACJ,CAAA,MAAA,IAAW,QAAQ,EAAA,EAAI;AACrB,IAAA,UAAA,GAAa,4EAAA;AAAA,EACf;AAEA,EAAA,OAAO;AAAA,IACL,KAAA,EAAO,KAAK,GAAA,CAAI,CAAA,EAAG,KAAK,GAAA,CAAI,GAAA,EAAK,KAAK,CAAC,CAAA;AAAA,IACvC,UAAA;AAAA,IACA,UAAA;AAAA,IACA;AAAA,GACF;AACF;ACvHA,IAAI,KAAA,GAA6C,IAAA;AAEjD,eAAe,QAAA,GAAkD;AAC/D,EAAA,IAAI,CAAC,KAAA,EAAO;AACV,IAAA,MAAM,KAAA,GAAQ,MAAM,OAAO,OAAO,CAAA;AAClC,IAAA,KAAA,GAAQ,KAAA,CAAM,KAAA;AAAA,EAChB;AACA,EAAA,OAAO,KAAA;AACT;AAsBA,eAAsB,cAAA,CACpB,IAAA,EACA,GAAA,EACA,SAAA,GAAoB,GAAA,EACK;AAEzB,EAAA,MAAM,UAAA,GAAa,MAAM,QAAA,EAAS;AAClC,EAAA,MAAM,MAAM,IAAI,UAAA,CAAW,IAAA,EAAM,EAAE,KAAK,CAAA;AACxC,EAAA,MAAM,QAAA,GAAW,IAAI,MAAA,CAAO,QAAA;AAE5B,EAAA,IAAI,KAAA,GAAQ,SAAS,KAAA,IAAS,EAAA;AAC9B,EAAA,IAAI,MAAA;AACJ,EAAA,IAAI,OAAA;AACJ,EAAA,IAAI,WAAA,GAAc,IAAA;AAClB,EAAA,IAAI,kBAAA,GAAqB,KAAA;AAGzB,EAAA,IAAI;AAEF,IAAA,MAAM,SAAA,GAAY,QAAA,CAAS,SAAA,CAAU,IAAI,CAAA;AACzC,IAAA,MAAM,MAAA,GAAS,IAAI,WAAA,CAAY,SAAS,CAAA;AACxC,IAAA,MAAM,OAAA,GAAU,OAAO,KAAA,EAAM;AAE7B,IAAA,IAAI,WAAW,OAAA,CAAQ,OAAA,IAAW,OAAA,CAAQ,OAAA,CAAQ,SAAS,GAAA,EAAK;AAC9D,MAAA,WAAA,GAAc,OAAA,CAAQ,OAAA;AACtB,MAAA,KAAA,GAAQ,QAAQ,KAAA,IAAS,KAAA;AACzB,MAAA,MAAA,GAAS,QAAQ,MAAA,IAAU,KAAA,CAAA;AAC3B,MAAA,OAAA,GAAU,QAAQ,OAAA,IAAW,KAAA,CAAA;AAC7B,MAAA,kBAAA,GAAqB,IAAA;AAAA,IACvB;AAAA,EACF,CAAA,CAAA,MAAQ;AAAA,EAER;AAGA,EAAA,MAAM,QAAA,GAAW,IAAI,eAAA,CAAgB;AAAA,IACnC,YAAA,EAAc,KAAA;AAAA,IACd,cAAA,EAAgB,QAAA;AAAA,IAChB,gBAAA,EAAkB,GAAA;AAAA,IAClB,WAAA,EAAa;AAAA,GACd,CAAA;AAGD,EAAA,QAAA,CAAS,MAAA,CAAO,CAAC,QAAA,EAAU,OAAA,EAAS,OAAO,QAAA,EAAU,OAAA,EAAS,QAAA,EAAU,UAAU,CAAC,CAAA;AAGnF,EAAA,QAAA,CAAS,QAAQ,KAAA,EAAO;AAAA,IACtB,MAAA,EAAQ,CAAC,KAAK,CAAA;AAAA,IACd,WAAA,EAAa,CAAC,OAAA,EAAiB,IAAA,KAAuB;AACpD,MAAA,MAAM,OAAA,GAAU,IAAA;AAChB,MAAA,MAAM,IAAA,GAAO,OAAA,CAAQ,aAAA,GAAgB,MAAM,CAAA;AAC3C,MAAA,MAAM,OAAO,IAAA,EAAM,SAAA,EAAW,MAAM,gBAAgB,CAAA,GAAI,CAAC,CAAA,IAAK,EAAA;AAC9D,MAAA,MAAM,IAAA,GAAO,MAAM,WAAA,IAAe,OAAA;AAClC,MAAA,OAAO;AAAA,MAAA,EAAW,IAAI;AAAA,EAAK,IAAI;AAAA;AAAA,CAAA;AAAA,IACjC;AAAA,GACD,CAAA;AAGD,EAAA,IAAI,QAAA,GAAW,QAAA,CAAS,QAAA,CAAS,WAAW,CAAA;AAG5C,EAAA,QAAA,GAAW,QAAA,CACR,OAAA,CAAQ,SAAA,EAAW,MAAM,CAAA,CACzB,OAAA,CAAQ,YAAA,EAAc,EAAE,CAAA,CACxB,OAAA,CAAQ,WAAA,EAAa,EAAE,CAAA;AAG1B,EAAA,IAAI,YAAA,GAAe,KAAA;AACnB,EAAA,IAAI,QAAA,CAAS,SAAS,SAAA,EAAW;AAE/B,IAAA,MAAM,UAAA,GAAa,QAAA,CAAS,WAAA,CAAY,MAAA,EAAQ,SAAS,CAAA;AACzD,IAAA,IAAI,UAAA,GAAa,YAAY,GAAA,EAAK;AAChC,MAAA,QAAA,GAAW,QAAA,CAAS,KAAA,CAAM,CAAA,EAAG,UAAU,CAAA,GAAI,4BAAA;AAAA,IAC7C,CAAA,MAAO;AAEL,MAAA,QAAA,GAAW,QAAA,CAAS,KAAA,CAAM,CAAA,EAAG,SAAS,CAAA,GAAI,gBAAA;AAAA,IAC5C;AACA,IAAA,YAAA,GAAe,IAAA;AAAA,EACjB;AAEA,EAAA,OAAO;AAAA,IACL,QAAA;AAAA,IACA,KAAA;AAAA,IACA,MAAA;AAAA,IACA,OAAA;AAAA,IACA,kBAAA;AAAA,IACA;AAAA,GACF;AACF;;;AC/FO,IAAM,QAAA,GAAuD;AAAA,EAClE,UAAA,EAAY;AAAA,IACV,IAAA,EAAM,UAAA;AAAA,IACN,QAAA,EAAU;AAAA,MACR,IAAA,EAAM,WAAA;AAAA,MACN,WAAA,EAAa,CAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,CAAA,CAAA;AAAA,MAmDb,UAAA,EAAY;AAAA,QACV,IAAA,EAAM,QAAA;AAAA,QACN,UAAA,EAAY;AAAA,UACV,GAAA,EAAK;AAAA,YACH,IAAA,EAAM,QAAA;AAAA,YACN,WAAA,EAAa;AAAA,WACf;AAAA,UACA,SAAA,EAAW;AAAA,YACT,IAAA,EAAM,QAAA;AAAA,YACN,WAAA,EAAa;AAAA,WACf;AAAA,UACA,OAAA,EAAS;AAAA,YACP,IAAA,EAAM,QAAA;AAAA,YACN,WAAA,EAAa;AAAA;AACf,SACF;AAAA,QACA,QAAA,EAAU,CAAC,KAAK;AAAA;AAClB,KACF;AAAA,IACA,QAAA,EAAU,IAAA;AAAA,IACV,OAAA,EAAS;AAAA,GACX;AAAA,EAEA,OAAA,EAAS,OAAO,IAAA,KAAgD;AAC9D,IAAA,IAAI;AAEF,MAAA,IAAI;AACF,QAAA,IAAI,GAAA,CAAI,KAAK,GAAG,CAAA;AAAA,MAClB,CAAA,CAAA,MAAQ;AACN,QAAA,OAAO;AAAA,UACL,OAAA,EAAS,KAAA;AAAA,UACT,KAAK,IAAA,CAAK,GAAA;AAAA,UACV,KAAA,EAAO,EAAA;AAAA,UACP,OAAA,EAAS,EAAA;AAAA,UACT,WAAA,EAAa,OAAA;AAAA,UACb,YAAA,EAAc,CAAA;AAAA,UACd,UAAA,EAAY,KAAA;AAAA,UACZ,KAAA,EAAO;AAAA,SACT;AAAA,MACF;AAGA,MAAA,MAAM,UAAA,GAAa,IAAI,eAAA,EAAgB;AACvC,MAAA,MAAM,SAAA,GAAY,WAAW,MAAM,UAAA,CAAW,OAAM,EAAG,IAAA,CAAK,WAAW,GAAK,CAAA;AAE5E,MAAA,MAAM,QAAA,GAAW,MAAM,KAAA,CAAM,IAAA,CAAK,GAAA,EAAK;AAAA,QACrC,OAAA,EAAS;AAAA,UACP,YAAA,EACE,KAAK,SAAA,IACL,+EAAA;AAAA,UACF,MAAA,EAAQ,iEAAA;AAAA,UACR,iBAAA,EAAmB;AAAA,SACrB;AAAA,QACA,QAAQ,UAAA,CAAW;AAAA,OACpB,CAAA;AAED,MAAA,YAAA,CAAa,SAAS,CAAA;AAGtB,MAAA,IAAI,CAAC,SAAS,EAAA,EAAI;AAChB,QAAA,OAAO;AAAA,UACL,OAAA,EAAS,KAAA;AAAA,UACT,KAAK,IAAA,CAAK,GAAA;AAAA,UACV,KAAA,EAAO,EAAA;AAAA,UACP,OAAA,EAAS,EAAA;AAAA,UACT,WAAA,EAAa,OAAA;AAAA,UACb,YAAA,EAAc,CAAA;AAAA,UACd,UAAA,EAAY,KAAA;AAAA,UACZ,OAAO,CAAA,KAAA,EAAQ,QAAA,CAAS,MAAM,CAAA,EAAA,EAAK,SAAS,UAAU,CAAA;AAAA,SACxD;AAAA,MACF;AAGA,MAAA,MAAM,WAAA,GAAc,QAAA,CAAS,OAAA,CAAQ,GAAA,CAAI,cAAc,CAAA,IAAK,EAAA;AAG5D,MAAA,IAAI,WAAA,CAAY,QAAA,CAAS,kBAAkB,CAAA,EAAG;AAC5C,QAAA,MAAM,IAAA,GAAO,MAAM,QAAA,CAAS,IAAA,EAAK;AACjC,QAAA,OAAO;AAAA,UACL,OAAA,EAAS,IAAA;AAAA,UACT,KAAK,IAAA,CAAK,GAAA;AAAA,UACV,KAAA,EAAO,eAAA;AAAA,UACP,OAAA,EAAS,IAAA,CAAK,SAAA,CAAU,IAAA,EAAM,MAAM,CAAC,CAAA;AAAA,UACrC,WAAA,EAAa,MAAA;AAAA,UACb,YAAA,EAAc,GAAA;AAAA,UACd,UAAA,EAAY;AAAA,SACd;AAAA,MACF;AAGA,MAAA,IAAI,WAAA,CAAY,QAAA,CAAS,YAAY,CAAA,EAAG;AACtC,QAAA,MAAM,IAAA,GAAO,MAAM,QAAA,CAAS,IAAA,EAAK;AACjC,QAAA,OAAO;AAAA,UACL,OAAA,EAAS,IAAA;AAAA,UACT,KAAK,IAAA,CAAK,GAAA;AAAA,UACV,KAAA,EAAO,eAAA;AAAA,UACP,OAAA,EAAS,IAAA;AAAA,UACT,WAAA,EAAa,MAAA;AAAA,UACb,YAAA,EAAc,GAAA;AAAA,UACd,UAAA,EAAY;AAAA,SACd;AAAA,MACF;AAGA,MAAA,MAAM,IAAA,GAAO,MAAM,QAAA,CAAS,IAAA,EAAK;AAGjC,MAAA,MAAM,CAAA,GAAI,KAAK,IAAI,CAAA;AAGnB,MAAA,MAAM,QAAA,GAAW,MAAM,cAAA,CAAe,IAAA,EAAM,KAAK,GAAG,CAAA;AAGpD,MAAA,MAAM,KAAA,GAAQ,QAAA,CAAS,KAAA,IAAS,CAAA,CAAE,OAAO,CAAA,CAAE,IAAA,EAAK,IAAK,CAAA,CAAE,IAAI,CAAA,CAAE,KAAA,EAAM,CAAE,MAAK,IAAK,UAAA;AAG/E,MAAA,MAAM,OAAA,GAAU,oBAAA,CAAqB,IAAA,EAAM,QAAA,CAAS,UAAU,CAAC,CAAA;AAE/D,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,IAAA;AAAA,QACT,KAAK,IAAA,CAAK,GAAA;AAAA,QACV,KAAA;AAAA,QACA,SAAS,QAAA,CAAS,QAAA;AAAA,QAClB,WAAA,EAAa,MAAA;AAAA,QACb,cAAc,OAAA,CAAQ,KAAA;AAAA,QACtB,YAAY,OAAA,CAAQ,UAAA;AAAA,QACpB,iBAAiB,OAAA,CAAQ,UAAA;AAAA,QACzB,QAAQ,OAAA,CAAQ,MAAA;AAAA,QAChB,SAAS,QAAA,CAAS,OAAA;AAAA,QAClB,QAAQ,QAAA,CAAS,MAAA;AAAA,QACjB,oBAAoB,QAAA,CAAS,kBAAA;AAAA,QAC7B,cAAc,QAAA,CAAS;AAAA,OACzB;AAAA,IACF,SAAS,KAAA,EAAY;AAEnB,MAAA,IAAI,KAAA,CAAM,SAAS,YAAA,EAAc;AAC/B,QAAA,OAAO;AAAA,UACL,OAAA,EAAS,KAAA;AAAA,UACT,KAAK,IAAA,CAAK,GAAA;AAAA,UACV,KAAA,EAAO,EAAA;AAAA,UACP,OAAA,EAAS,EAAA;AAAA,UACT,WAAA,EAAa,OAAA;AAAA,UACb,YAAA,EAAc,CAAA;AAAA,UACd,UAAA,EAAY,KAAA;AAAA,UACZ,KAAA,EAAO,CAAA,sBAAA,EAAyB,IAAA,CAAK,OAAA,IAAW,GAAK,CAAA,EAAA;AAAA,SACvD;AAAA,MACF;AAEA,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,KAAA;AAAA,QACT,KAAK,IAAA,CAAK,GAAA;AAAA,QACV,KAAA,EAAO,EAAA;AAAA,QACP,OAAA,EAAS,EAAA;AAAA,QACT,WAAA,EAAa,OAAA;AAAA,QACb,YAAA,EAAc,CAAA;AAAA,QACd,UAAA,EAAY,KAAA;AAAA,QACZ,OAAQ,KAAA,CAAgB;AAAA,OAC1B;AAAA,IACF;AAAA,EACF;AACF,CAAA;;;AChPA,IAAI,eAAA,GAAuB,IAAA;AAC3B,IAAI,eAAA,GAAuB,IAAA;AA4B3B,eAAe,aAAA,GAA8B;AAC3C,EAAA,IAAI,CAAC,eAAA,EAAiB;AACpB,IAAA,IAAI;AACF,MAAA,eAAA,GAAkB,MAAM,OAAO,WAAW,CAAA;AAAA,IAC5C,SAAS,KAAA,EAAO;AACd,MAAA,MAAM,IAAI,MAAM,yBAAyB,CAAA;AAAA,IAC3C;AAAA,EACF;AACA,EAAA,OAAO,eAAA;AACT;AAKA,eAAe,UAAA,GAA2B;AACxC,EAAA,IAAI,CAAC,eAAA,EAAiB;AACpB,IAAA,MAAM,SAAA,GAAY,MAAM,aAAA,EAAc;AAEtC,IAAA,eAAA,GAAkB,MAAM,UAAU,MAAA,CAAO;AAAA,MACvC,QAAA,EAAU,IAAA;AAAA,MACV,IAAA,EAAM,CAAC,cAAA,EAAgB,0BAAA,EAA4B,yBAAyB;AAAA,KAC7E,CAAA;AAGD,IAAA,OAAA,CAAQ,EAAA,CAAG,QAAQ,YAAY;AAC7B,MAAA,IAAI,eAAA,EAAiB;AACnB,QAAA,MAAM,gBAAgB,KAAA,EAAM;AAAA,MAC9B;AAAA,IACF,CAAC,CAAA;AAAA,EACH;AACA,EAAA,OAAO,eAAA;AACT;AAEO,IAAM,UAAA,GAA6D;AAAA,EACxE,UAAA,EAAY;AAAA,IACV,IAAA,EAAM,UAAA;AAAA,IACN,QAAA,EAAU;AAAA,MACR,IAAA,EAAM,cAAA;AAAA,MACN,WAAA,EAAa,CAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,CAAA,CAAA;AAAA,MAkEb,UAAA,EAAY;AAAA,QACV,IAAA,EAAM,QAAA;AAAA,QACN,UAAA,EAAY;AAAA,UACV,GAAA,EAAK;AAAA,YACH,IAAA,EAAM,QAAA;AAAA,YACN,WAAA,EAAa;AAAA,WACf;AAAA,UACA,eAAA,EAAiB;AAAA,YACf,IAAA,EAAM,QAAA;AAAA,YACN,WAAA,EACE;AAAA,WACJ;AAAA,UACA,OAAA,EAAS;AAAA,YACP,IAAA,EAAM,QAAA;AAAA,YACN,WAAA,EAAa;AAAA,WACf;AAAA,UACA,cAAA,EAAgB;AAAA,YACd,IAAA,EAAM,SAAA;AAAA,YACN,WAAA,EACE;AAAA;AACJ,SACF;AAAA,QACA,QAAA,EAAU,CAAC,KAAK;AAAA;AAClB,KACF;AAAA,IACA,QAAA,EAAU,IAAA;AAAA,IACV,OAAA,EAAS;AAAA;AAAA,GACX;AAAA,EAEA,OAAA,EAAS,OAAO,IAAA,KAAoD;AAClE,IAAA,IAAI,IAAA,GAAY,IAAA;AAEhB,IAAA,IAAI;AAEF,MAAA,MAAM,OAAA,GAAU,MAAM,UAAA,EAAW;AACjC,MAAA,IAAA,GAAO,MAAM,QAAQ,OAAA,EAAQ;AAG7B,MAAA,MAAM,KAAK,WAAA,CAAY,EAAE,OAAO,IAAA,EAAM,MAAA,EAAQ,KAAK,CAAA;AAGnD,MAAA,MAAM,IAAA,CAAK,YAAA;AAAA,QACT;AAAA,OACF;AAEA,MAAA,MAAM,SAAA,GAAY,KAAK,GAAA,EAAI;AAG3B,MAAA,MAAM,IAAA,CAAK,IAAA,CAAK,IAAA,CAAK,GAAA,EAAK;AAAA,QACxB,SAAA,EAAW,cAAA;AAAA;AAAA,QACX,OAAA,EAAS,KAAK,OAAA,IAAW;AAAA,OAC1B,CAAA;AAGD,MAAA,IAAI,KAAK,eAAA,EAAiB;AACxB,QAAA,MAAM,IAAA,CAAK,eAAA,CAAgB,IAAA,CAAK,eAAA,EAAiB;AAAA,UAC/C,OAAA,EAAS,KAAK,OAAA,IAAW;AAAA,SAC1B,CAAA;AAAA,MACH;AAGA,MAAA,MAAM,IAAA,GAAO,MAAM,IAAA,CAAK,OAAA,EAAQ;AAGhC,MAAA,MAAM,YAAA,GAAe,MAAM,IAAA,CAAK,KAAA,EAAM;AAEtC,MAAA,MAAM,QAAA,GAAW,IAAA,CAAK,GAAA,EAAI,GAAI,SAAA;AAG9B,MAAA,IAAI,UAAA;AACJ,MAAA,IAAI,KAAK,cAAA,EAAgB;AACvB,QAAA,MAAM,MAAA,GAAS,MAAM,IAAA,CAAK,UAAA,CAAW;AAAA,UACnC,IAAA,EAAM,KAAA;AAAA,UACN,QAAA,EAAU;AAAA;AAAA,SACX,CAAA;AACD,QAAA,UAAA,GAAa,MAAA,CAAO,SAAS,QAAQ,CAAA;AAAA,MACvC;AAEA,MAAA,MAAM,KAAK,KAAA,EAAM;AAGjB,MAAA,MAAM,QAAA,GAAW,MAAM,cAAA,CAAe,IAAA,EAAM,KAAK,GAAG,CAAA;AAGpD,MAAA,MAAM,KAAA,GAAQ,YAAA,IAAgB,QAAA,CAAS,KAAA,IAAS,UAAA;AAEhD,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,IAAA;AAAA,QACT,KAAK,IAAA,CAAK,GAAA;AAAA,QACV,KAAA;AAAA,QACA,SAAS,QAAA,CAAS,QAAA;AAAA,QAClB,UAAA;AAAA,QACA,QAAA;AAAA,QACA,SAAS,QAAA,CAAS,OAAA;AAAA,QAClB,QAAQ,QAAA,CAAS,MAAA;AAAA,QACjB,oBAAoB,QAAA,CAAS,kBAAA;AAAA,QAC7B,cAAc,QAAA,CAAS;AAAA,OACzB;AAAA,IACF,SAAS,KAAA,EAAY;AACnB,MAAA,IAAI,IAAA,EAAM;AACR,QAAA,IAAI;AACF,UAAA,MAAM,KAAK,KAAA,EAAM;AAAA,QACnB,CAAA,CAAA,MAAQ;AAAA,QAER;AAAA,MACF;AAGA,MAAA,IAAK,KAAA,CAAgB,YAAY,yBAAA,EAA2B;AAC1D,QAAA,OAAO;AAAA,UACL,OAAA,EAAS,KAAA;AAAA,UACT,KAAK,IAAA,CAAK,GAAA;AAAA,UACV,KAAA,EAAO,EAAA;AAAA,UACP,OAAA,EAAS,EAAA;AAAA,UACT,QAAA,EAAU,CAAA;AAAA,UACV,KAAA,EAAO,4BAAA;AAAA,UACP,UAAA,EACE;AAAA,SACJ;AAAA,MACF;AAEA,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,KAAA;AAAA,QACT,KAAK,IAAA,CAAK,GAAA;AAAA,QACV,KAAA,EAAO,EAAA;AAAA,QACP,OAAA,EAAS,EAAA;AAAA,QACT,QAAA,EAAU,CAAA;AAAA,QACV,OAAQ,KAAA,CAAgB;AAAA,OAC1B;AAAA,IACF;AAAA,EACF;AACF,CAAA;;;ACjQA,WAAA,EAAA;;;ACJA,eAAsB,gBAAA,CACpB,KAAA,EACA,UAAA,EACA,MAAA,EACyB;AACzB,EAAA,MAAM,QAAA,GAAW,MAAM,KAAA,CAAM,kCAAA,EAAoC;AAAA,IAC/D,MAAA,EAAQ,MAAA;AAAA,IACR,OAAA,EAAS;AAAA,MACP,WAAA,EAAa,MAAA;AAAA,MACb,cAAA,EAAgB;AAAA,KAClB;AAAA,IACA,IAAA,EAAM,KAAK,SAAA,CAAU;AAAA,MACnB,CAAA,EAAG,KAAA;AAAA,MACH,GAAA,EAAK;AAAA,KACN;AAAA,GACF,CAAA;AAED,EAAA,IAAI,CAAC,SAAS,EAAA,EAAI;AAChB,IAAA,MAAM,IAAI,MAAM,CAAA,kBAAA,EAAqB,QAAA,CAAS,MAAM,CAAA,CAAA,EAAI,QAAA,CAAS,UAAU,CAAA,CAAE,CAAA;AAAA,EAC/E;AAEA,EAAA,MAAM,IAAA,GAAY,MAAM,QAAA,CAAS,IAAA,EAAK;AAEtC,EAAA,IAAI,CAAC,KAAK,OAAA,IAAW,CAAC,MAAM,OAAA,CAAQ,IAAA,CAAK,OAAO,CAAA,EAAG;AACjD,IAAA,MAAM,IAAI,MAAM,kCAAkC,CAAA;AAAA,EACpD;AAEA,EAAA,OAAO,IAAA,CAAK,QAAQ,KAAA,CAAM,CAAA,EAAG,UAAU,CAAA,CAAE,GAAA,CAAI,CAAC,MAAA,EAAa,KAAA,MAAmB;AAAA,IAC5E,KAAA,EAAO,OAAO,KAAA,IAAS,UAAA;AAAA,IACvB,GAAA,EAAK,OAAO,IAAA,IAAQ,EAAA;AAAA,IACpB,OAAA,EAAS,OAAO,OAAA,IAAW,EAAA;AAAA,IAC3B,UAAU,KAAA,GAAQ;AAAA,GACpB,CAAE,CAAA;AACJ;;;ACtCA,eAAsB,eAAA,CACpB,KAAA,EACA,UAAA,EACA,MAAA,EACyB;AACzB,EAAA,MAAM,MAAM,CAAA,iDAAA,EAAoD,kBAAA,CAAmB,KAAK,CAAC,UAAU,UAAU,CAAA,CAAA;AAE7G,EAAA,MAAM,QAAA,GAAW,MAAM,KAAA,CAAM,GAAA,EAAK;AAAA,IAChC,OAAA,EAAS;AAAA,MACP,sBAAA,EAAwB,MAAA;AAAA,MACxB,MAAA,EAAQ;AAAA;AACV,GACD,CAAA;AAED,EAAA,IAAI,CAAC,SAAS,EAAA,EAAI;AAChB,IAAA,MAAM,IAAI,MAAM,CAAA,iBAAA,EAAoB,QAAA,CAAS,MAAM,CAAA,CAAA,EAAI,QAAA,CAAS,UAAU,CAAA,CAAE,CAAA;AAAA,EAC9E;AAEA,EAAA,MAAM,IAAA,GAAY,MAAM,QAAA,CAAS,IAAA,EAAK;AAEtC,EAAA,IAAI,CAAC,IAAA,CAAK,GAAA,EAAK,OAAA,IAAW,CAAC,MAAM,OAAA,CAAQ,IAAA,CAAK,GAAA,CAAI,OAAO,CAAA,EAAG;AAC1D,IAAA,MAAM,IAAI,MAAM,iCAAiC,CAAA;AAAA,EACnD;AAEA,EAAA,OAAO,IAAA,CAAK,GAAA,CAAI,OAAA,CAAQ,KAAA,CAAM,CAAA,EAAG,UAAU,CAAA,CAAE,GAAA,CAAI,CAAC,MAAA,EAAa,KAAA,MAAmB;AAAA,IAChF,KAAA,EAAO,OAAO,KAAA,IAAS,UAAA;AAAA,IACvB,GAAA,EAAK,OAAO,GAAA,IAAO,EAAA;AAAA,IACnB,OAAA,EAAS,OAAO,WAAA,IAAe,EAAA;AAAA,IAC/B,UAAU,KAAA,GAAQ;AAAA,GACpB,CAAE,CAAA;AACJ;;;AC9BA,eAAsB,gBAAA,CACpB,KAAA,EACA,UAAA,EACA,MAAA,EACyB;AACzB,EAAA,MAAM,QAAA,GAAW,MAAM,KAAA,CAAM,+BAAA,EAAiC;AAAA,IAC5D,MAAA,EAAQ,MAAA;AAAA,IACR,OAAA,EAAS;AAAA,MACP,cAAA,EAAgB;AAAA,KAClB;AAAA,IACA,IAAA,EAAM,KAAK,SAAA,CAAU;AAAA,MACnB,OAAA,EAAS,MAAA;AAAA,MACT,KAAA;AAAA,MACA,WAAA,EAAa,UAAA;AAAA,MACb,YAAA,EAAc,OAAA;AAAA;AAAA,MACd,cAAA,EAAgB,KAAA;AAAA,MAChB,mBAAA,EAAqB;AAAA,KACtB;AAAA,GACF,CAAA;AAED,EAAA,IAAI,CAAC,SAAS,EAAA,EAAI;AAChB,IAAA,MAAM,IAAI,MAAM,CAAA,kBAAA,EAAqB,QAAA,CAAS,MAAM,CAAA,CAAA,EAAI,QAAA,CAAS,UAAU,CAAA,CAAE,CAAA;AAAA,EAC/E;AAEA,EAAA,MAAM,IAAA,GAAY,MAAM,QAAA,CAAS,IAAA,EAAK;AAEtC,EAAA,IAAI,CAAC,KAAK,OAAA,IAAW,CAAC,MAAM,OAAA,CAAQ,IAAA,CAAK,OAAO,CAAA,EAAG;AACjD,IAAA,MAAM,IAAI,MAAM,kCAAkC,CAAA;AAAA,EACpD;AAEA,EAAA,OAAO,IAAA,CAAK,QAAQ,KAAA,CAAM,CAAA,EAAG,UAAU,CAAA,CAAE,GAAA,CAAI,CAAC,MAAA,EAAa,KAAA,MAAmB;AAAA,IAC5E,KAAA,EAAO,OAAO,KAAA,IAAS,UAAA;AAAA,IACvB,GAAA,EAAK,OAAO,GAAA,IAAO,EAAA;AAAA,IACnB,OAAA,EAAS,OAAO,OAAA,IAAW,EAAA;AAAA,IAC3B,UAAU,KAAA,GAAQ;AAAA,GACpB,CAAE,CAAA;AACJ;;;AHpBA,IAAM,eAAe,MAAA,CAAO,KAAA,CAAM,EAAE,SAAA,EAAW,aAAa,CAAA;AAQ5D,IAAM,oBAAA,GAAuB,CAAC,QAAA,EAAU,cAAA,EAAgB,UAAU,iBAAiB,CAAA;AA8B5E,IAAM,SAAA,GAA0D;AAAA,EACrE,UAAA,EAAY;AAAA,IACV,IAAA,EAAM,UAAA;AAAA,IACN,QAAA,EAAU;AAAA,MACR,IAAA,EAAM,YAAA;AAAA,MACN,WAAA,EAAa,CAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,CAAA,CAAA;AAAA,MA0Bb,UAAA,EAAY;AAAA,QACV,IAAA,EAAM,QAAA;AAAA,QACN,UAAA,EAAY;AAAA,UACV,KAAA,EAAO;AAAA,YACL,IAAA,EAAM,QAAA;AAAA,YACN,WAAA,EAAa;AAAA,WACf;AAAA,UACA,UAAA,EAAY;AAAA,YACV,IAAA,EAAM,QAAA;AAAA,YACN,WAAA,EAAa;AAAA,WACf;AAAA,UACA,OAAA,EAAS;AAAA,YACP,IAAA,EAAM,QAAA;AAAA,YACN,WAAA,EAAa;AAAA,WACf;AAAA,UACA,QAAA,EAAU;AAAA,YACR,IAAA,EAAM,QAAA;AAAA,YACN,WAAA,EAAa;AAAA;AACf,SACF;AAAA,QACA,QAAA,EAAU,CAAC,OAAO;AAAA;AACpB,KACF;AAAA,IACA,QAAA,EAAU,IAAA;AAAA,IACV,OAAA,EAAS;AAAA,GACX;AAAA,EAEA,OAAA,EAAS,OAAO,IAAA,KAAkD;AAChE,IAAA,MAAM,UAAA,GAAa,KAAK,UAAA,IAAc,EAAA;AAGtC,IAAA,MAAM,SAAA,GAAY,4BAA4B,oBAAoB,CAAA;AAElE,IAAA,IAAI,SAAA,EAAW;AACb,MAAA,OAAO,MAAM,oBAAA,CAAqB,SAAA,CAAU,IAAA,EAAM,MAAM,UAAU,CAAA;AAAA,IACpE;AAGA,IAAA,OAAO,MAAM,iBAAA,CAAkB,IAAA,EAAM,UAAU,CAAA;AAAA,EACjD,CAAA;AAAA,EAEA,YAAA,EAAc,CAAC,IAAA,KAAwB,CAAA,CAAA,EAAI,IAAA,CAAK,KAAK,CAAA,CAAA,EAAI,IAAA,CAAK,UAAA,GAAa,CAAA,EAAA,EAAK,IAAA,CAAK,UAAU,cAAc,EAAE,CAAA;AACjH,CAAA;AAOA,eAAe,oBAAA,CACb,aAAA,EACA,IAAA,EACA,UAAA,EAC0B;AAC1B,EAAA,YAAA,CAAa,KAAA,CAAM,EAAE,aAAA,EAAc,EAAG,iCAAiC,CAAA;AAEvE,EAAA,IAAI;AACF,IAAA,MAAM,iBAAiB,cAAA,CAAe,MAAA,CAAO,EAAE,SAAA,EAAW,eAAe,CAAA;AAEzE,IAAA,MAAM,QAAA,GAA2B,MAAM,cAAA,CAAe,MAAA,CAAO,KAAK,KAAA,EAAO;AAAA,MACvE,UAAA;AAAA,MACA,SAAS,IAAA,CAAK,OAAA;AAAA,MACd,UAAU,IAAA,CAAK;AAAA,KAChB,CAAA;AAED,IAAA,IAAI,SAAS,OAAA,EAAS;AACpB,MAAA,YAAA,CAAa,KAAA,CAAM;AAAA,QACjB,UAAU,QAAA,CAAS,QAAA;AAAA,QACnB,OAAO,QAAA,CAAS;AAAA,SACf,+BAA+B,CAAA;AAAA,IACpC,CAAA,MAAO;AACL,MAAA,YAAA,CAAa,IAAA,CAAK;AAAA,QAChB,UAAU,QAAA,CAAS,QAAA;AAAA,QACnB,OAAO,QAAA,CAAS;AAAA,SACf,eAAe,CAAA;AAAA,IACpB;AAEA,IAAA,OAAO;AAAA,MACL,SAAS,QAAA,CAAS,OAAA;AAAA,MAClB,OAAO,QAAA,CAAS,KAAA;AAAA,MAChB,UAAU,QAAA,CAAS,QAAA;AAAA,MACnB,SAAS,QAAA,CAAS,OAAA;AAAA,MAClB,OAAO,QAAA,CAAS,KAAA;AAAA,MAChB,OAAO,QAAA,CAAS;AAAA,KAClB;AAAA,EACF,SAAS,KAAA,EAAY;AACnB,IAAA,YAAA,CAAa,MAAM,EAAE,KAAA,EAAO,MAAM,OAAA,EAAS,aAAA,IAAiB,wBAAwB,CAAA;AACpF,IAAA,OAAO;AAAA,MACL,OAAA,EAAS,KAAA;AAAA,MACT,OAAO,IAAA,CAAK,KAAA;AAAA,MACZ,QAAA,EAAU,aAAA;AAAA,MACV,SAAS,EAAC;AAAA,MACV,KAAA,EAAO,CAAA;AAAA,MACP,KAAA,EAAO,MAAM,OAAA,IAAW;AAAA,KAC1B;AAAA,EACF;AACF;AAMA,eAAe,iBAAA,CACb,MACA,UAAA,EAC0B;AAE1B,EAAA,MAAM,SAAA,GAAY;AAAA,IAChB,EAAE,MAAM,QAAA,EAAU,GAAA,EAAK,QAAQ,GAAA,CAAI,cAAA,EAAgB,IAAI,gBAAA,EAAiB;AAAA,IACxE,EAAE,MAAM,OAAA,EAAS,GAAA,EAAK,QAAQ,GAAA,CAAI,aAAA,EAAe,IAAI,eAAA,EAAgB;AAAA,IACrE,EAAE,MAAM,QAAA,EAAU,GAAA,EAAK,QAAQ,GAAA,CAAI,cAAA,EAAgB,IAAI,gBAAA;AAAiB,GAC1E;AAEA,EAAA,KAAA,MAAW,YAAY,SAAA,EAAW;AAChC,IAAA,IAAI,SAAS,GAAA,EAAK;AAChB,MAAA,YAAA,CAAa,MAAM,EAAE,QAAA,EAAU,QAAA,CAAS,IAAA,IAAQ,qCAAqC,CAAA;AAErF,MAAA,IAAI;AACF,QAAA,MAAM,OAAA,GAAU,MAAM,QAAA,CAAS,EAAA,CAAG,KAAK,KAAA,EAAO,UAAA,EAAY,SAAS,GAAG,CAAA;AACtE,QAAA,OAAO;AAAA,UACL,OAAA,EAAS,IAAA;AAAA,UACT,OAAO,IAAA,CAAK,KAAA;AAAA,UACZ,UAAU,QAAA,CAAS,IAAA;AAAA,UACnB,OAAA;AAAA,UACA,OAAO,OAAA,CAAQ;AAAA,SACjB;AAAA,MACF,SAAS,KAAA,EAAY;AACnB,QAAA,YAAA,CAAa,IAAA,CAAK,EAAE,QAAA,EAAU,QAAA,CAAS,MAAM,KAAA,EAAO,KAAA,CAAM,OAAA,EAAQ,EAAG,8BAA8B,CAAA;AAAA,MAErG;AAAA,IACF;AAAA,EACF;AAGA,EAAA,OAAO;AAAA,IACL,OAAA,EAAS,KAAA;AAAA,IACT,OAAO,IAAA,CAAK,KAAA;AAAA,IACZ,QAAA,EAAU,MAAA;AAAA,IACV,SAAS,EAAC;AAAA,IACV,KAAA,EAAO,CAAA;AAAA,IACP,KAAA,EAAO;AAAA,GACT;AACF;;;AIxNA,WAAA,EAAA;AAEA,IAAM,eAAe,MAAA,CAAO,KAAA,CAAM,EAAE,SAAA,EAAW,aAAa,CAAA;AAQ5D,IAAM,oBAAA,GAAuB,CAAC,SAAA,EAAW,aAAA,EAAe,aAAa,aAAa,CAAA;AAKlF,IAAM,mBAAA,GAAsB,EAAA;AAwDrB,IAAM,SAAA,GAA0D;AAAA,EACrE,UAAA,EAAY;AAAA,IACV,IAAA,EAAM,UAAA;AAAA,IACN,QAAA,EAAU;AAAA,MACR,IAAA,EAAM,YAAA;AAAA,MACN,WAAA,EAAa,CAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,CAAA,CAAA;AAAA,MAyCb,UAAA,EAAY;AAAA,QACV,IAAA,EAAM,QAAA;AAAA,QACN,UAAA,EAAY;AAAA,UACV,GAAA,EAAK;AAAA,YACH,IAAA,EAAM,QAAA;AAAA,YACN,WAAA,EAAa;AAAA,WACf;AAAA,UACA,OAAA,EAAS;AAAA,YACP,IAAA,EAAM,QAAA;AAAA,YACN,WAAA,EAAa;AAAA,WACf;AAAA,UACA,WAAA,EAAa;AAAA,YACX,IAAA,EAAM,SAAA;AAAA,YACN,WAAA,EAAa;AAAA,WACf;AAAA,UACA,eAAA,EAAiB;AAAA,YACf,IAAA,EAAM,SAAA;AAAA,YACN,WAAA,EAAa;AAAA,WACf;AAAA,UACA,YAAA,EAAc;AAAA,YACZ,IAAA,EAAM,SAAA;AAAA,YACN,WAAA,EAAa;AAAA,WACf;AAAA,UACA,eAAA,EAAiB;AAAA,YACf,IAAA,EAAM,QAAA;AAAA,YACN,WAAA,EAAa;AAAA;AACf,SACF;AAAA,QACA,QAAA,EAAU,CAAC,KAAK;AAAA;AAClB,KACF;AAAA,IACA,QAAA,EAAU,IAAA;AAAA,IACV,OAAA,EAAS;AAAA,GACX;AAAA,EAEA,OAAA,EAAS,OAAO,IAAA,KAAkD;AAChE,IAAA,MAAM,SAAA,GAAY,KAAK,GAAA,EAAI;AAC3B,IAAA,MAAM,mBAA6B,EAAC;AAGpC,IAAA,IAAI;AACF,MAAA,IAAI,GAAA,CAAI,KAAK,GAAG,CAAA;AAAA,IAClB,CAAA,CAAA,MAAQ;AACN,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,KAAA;AAAA,QACT,KAAK,IAAA,CAAK,GAAA;AAAA,QACV,MAAA,EAAQ,MAAA;AAAA,QACR,KAAA,EAAO,EAAA;AAAA,QACP,OAAA,EAAS,EAAA;AAAA,QACT,UAAA,EAAY,IAAA,CAAK,GAAA,EAAI,GAAI,SAAA;AAAA,QACzB,kBAAkB,EAAC;AAAA,QACnB,KAAA,EAAO;AAAA,OACT;AAAA,IACF;AAKA,IAAA,MAAM,MAAA,GAAS,MAAM,SAAA,CAAU,IAAA,EAAM,WAAW,gBAAgB,CAAA;AAChE,IAAA,IAAI,MAAA,CAAO,OAAA,IAAA,CAAY,MAAA,CAAO,YAAA,IAAgB,MAAM,mBAAA,EAAqB;AACvE,MAAA,OAAO,MAAA;AAAA,IACT;AAGA,IAAA,MAAM,EAAA,GAAK,MAAM,KAAA,CAAM,IAAA,EAAM,WAAW,gBAAgB,CAAA;AACxD,IAAA,IAAI,EAAA,CAAG,OAAA,IAAA,CAAY,EAAA,CAAG,YAAA,IAAgB,MAAM,mBAAA,EAAqB;AAC/D,MAAA,OAAO,EAAA;AAAA,IACT;AAGA,IAAA,MAAM,SAAA,GAAY,4BAA4B,oBAAoB,CAAA;AAClE,IAAA,IAAI,SAAA,EAAW;AACb,MAAA,MAAM,MAAM,MAAM,MAAA,CAAO,UAAU,IAAA,EAAM,IAAA,EAAM,WAAW,gBAAgB,CAAA;AAC1E,MAAA,IAAI,GAAA,CAAI,SAAS,OAAO,GAAA;AAAA,IAC1B;AAGA,IAAA,IAAI,EAAA,CAAG,SAAS,OAAO,EAAA;AACvB,IAAA,IAAI,MAAA,CAAO,SAAS,OAAO,MAAA;AAE3B,IAAA,OAAO;AAAA,MACL,OAAA,EAAS,KAAA;AAAA,MACT,KAAK,IAAA,CAAK,GAAA;AAAA,MACV,MAAA,EAAQ,MAAA;AAAA,MACR,KAAA,EAAO,EAAA;AAAA,MACP,OAAA,EAAS,EAAA;AAAA,MACT,UAAA,EAAY,IAAA,CAAK,GAAA,EAAI,GAAI,SAAA;AAAA,MACzB,gBAAA;AAAA,MACA,KAAA,EAAO;AAAA,KACT;AAAA,EACF,CAAA;AAAA,EAEA,YAAA,EAAc,CAAC,IAAA,KAAwB,IAAA,CAAK;AAC9C,CAAA;AAIA,eAAe,SAAA,CACb,IAAA,EACA,SAAA,EACA,gBAAA,EAC0B;AAC1B,EAAA,gBAAA,CAAiB,KAAK,QAAQ,CAAA;AAC9B,EAAA,YAAA,CAAa,MAAM,EAAE,GAAA,EAAK,IAAA,CAAK,GAAA,IAAO,qBAAqB,CAAA;AAE3D,EAAA,IAAI;AACF,IAAA,MAAM,MAAA,GAAS,MAAM,QAAA,CAAS,OAAA,CAAQ;AAAA,MACpC,KAAK,IAAA,CAAK,GAAA;AAAA,MACV,OAAA,EAAS,KAAK,OAAA,IAAW;AAAA,KAC1B,CAAA;AAED,IAAA,OAAO;AAAA,MACL,SAAS,MAAA,CAAO,OAAA;AAAA,MAChB,KAAK,IAAA,CAAK,GAAA;AAAA,MACV,UAAU,IAAA,CAAK,GAAA;AAAA,MACf,MAAA,EAAQ,QAAA;AAAA,MACR,OAAO,MAAA,CAAO,KAAA;AAAA,MACd,SAAS,MAAA,CAAO,OAAA;AAAA;AAAA,MAEhB,QAAA,EAAU,IAAA,CAAK,eAAA,GAAkB,MAAA,CAAO,OAAA,GAAU,KAAA,CAAA;AAAA,MAClD,cAAc,MAAA,CAAO,YAAA;AAAA,MACrB,UAAA,EAAY,IAAA,CAAK,GAAA,EAAI,GAAI,SAAA;AAAA,MACzB,gBAAA;AAAA,MACA,OAAO,MAAA,CAAO;AAAA,KAChB;AAAA,EACF,SAAS,KAAA,EAAY;AACnB,IAAA,OAAO;AAAA,MACL,OAAA,EAAS,KAAA;AAAA,MACT,KAAK,IAAA,CAAK,GAAA;AAAA,MACV,MAAA,EAAQ,QAAA;AAAA,MACR,KAAA,EAAO,EAAA;AAAA,MACP,OAAA,EAAS,EAAA;AAAA,MACT,UAAA,EAAY,IAAA,CAAK,GAAA,EAAI,GAAI,SAAA;AAAA,MACzB,gBAAA;AAAA,MACA,OAAO,KAAA,CAAM;AAAA,KACf;AAAA,EACF;AACF;AAEA,eAAe,KAAA,CACb,IAAA,EACA,SAAA,EACA,gBAAA,EAC0B;AAC1B,EAAA,gBAAA,CAAiB,KAAK,IAAI,CAAA;AAC1B,EAAA,YAAA,CAAa,MAAM,EAAE,GAAA,EAAK,IAAA,CAAK,GAAA,IAAO,qBAAqB,CAAA;AAE3D,EAAA,IAAI;AACF,IAAA,MAAM,MAAA,GAAS,MAAM,UAAA,CAAW,OAAA,CAAQ;AAAA,MACtC,KAAK,IAAA,CAAK,GAAA;AAAA,MACV,OAAA,EAAS,KAAK,OAAA,IAAW,IAAA;AAAA,MACzB,iBAAiB,IAAA,CAAK;AAAA,KACvB,CAAA;AAED,IAAA,OAAO;AAAA,MACL,SAAS,MAAA,CAAO,OAAA;AAAA,MAChB,KAAK,IAAA,CAAK,GAAA;AAAA,MACV,UAAU,IAAA,CAAK,GAAA;AAAA,MACf,MAAA,EAAQ,IAAA;AAAA,MACR,OAAO,MAAA,CAAO,KAAA;AAAA,MACd,SAAS,MAAA,CAAO,OAAA;AAAA;AAAA,MAEhB,QAAA,EAAU,IAAA,CAAK,eAAA,GAAkB,MAAA,CAAO,OAAA,GAAU,KAAA,CAAA;AAAA,MAClD,YAAA,EAAc,MAAA,CAAO,OAAA,GAAU,EAAA,GAAK,CAAA;AAAA,MACpC,UAAA,EAAY,IAAA,CAAK,GAAA,EAAI,GAAI,SAAA;AAAA,MACzB,gBAAA;AAAA,MACA,OAAO,MAAA,CAAO;AAAA,KAChB;AAAA,EACF,SAAS,KAAA,EAAY;AACnB,IAAA,OAAO;AAAA,MACL,OAAA,EAAS,KAAA;AAAA,MACT,KAAK,IAAA,CAAK,GAAA;AAAA,MACV,MAAA,EAAQ,IAAA;AAAA,MACR,KAAA,EAAO,EAAA;AAAA,MACP,OAAA,EAAS,EAAA;AAAA,MACT,UAAA,EAAY,IAAA,CAAK,GAAA,EAAI,GAAI,SAAA;AAAA,MACzB,gBAAA;AAAA,MACA,OAAO,KAAA,CAAM;AAAA,KACf;AAAA,EACF;AACF;AAEA,eAAe,MAAA,CACb,aAAA,EACA,IAAA,EACA,SAAA,EACA,gBAAA,EAC0B;AAC1B,EAAA,gBAAA,CAAiB,IAAA,CAAK,CAAA,IAAA,EAAO,aAAa,CAAA,CAAE,CAAA;AAC5C,EAAA,YAAA,CAAa,MAAM,EAAE,GAAA,EAAK,KAAK,GAAA,EAAK,aAAA,IAAiB,qBAAqB,CAAA;AAE1E,EAAA,IAAI;AACF,IAAA,MAAM,WAAW,cAAA,CAAe,MAAA,CAAO,EAAE,SAAA,EAAW,eAAe,CAAA;AAEnE,IAAA,MAAM,OAAA,GAAyB;AAAA,MAC7B,SAAS,IAAA,CAAK,OAAA;AAAA,MACd,iBAAiB,IAAA,CAAK,eAAA;AAAA,MACtB,aAAa,IAAA,CAAK,WAAA;AAAA,MAClB,iBAAiB,IAAA,CAAK,eAAA;AAAA,MACtB,cAAc,IAAA,CAAK;AAAA,KACrB;AAEA,IAAA,MAAM,SAAyB,MAAM,QAAA,CAAS,MAAA,CAAO,IAAA,CAAK,KAAK,OAAO,CAAA;AAEtE,IAAA,OAAO;AAAA,MACL,SAAS,MAAA,CAAO,OAAA;AAAA,MAChB,KAAK,IAAA,CAAK,GAAA;AAAA,MACV,UAAU,MAAA,CAAO,QAAA;AAAA,MACjB,QAAQ,MAAA,CAAO,QAAA;AAAA,MACf,KAAA,EAAO,MAAA,CAAO,MAAA,EAAQ,KAAA,IAAS,EAAA;AAAA,MAC/B,OAAA,EAAS,MAAA,CAAO,MAAA,EAAQ,OAAA,IAAW,EAAA;AAAA,MACnC,IAAA,EAAM,OAAO,MAAA,EAAQ,IAAA;AAAA,MACrB,QAAA,EAAU,OAAO,MAAA,EAAQ,QAAA;AAAA,MACzB,QAAA,EAAU,OAAO,MAAA,EAAQ,QAAA;AAAA,MACzB,KAAA,EAAO,OAAO,MAAA,EAAQ,KAAA;AAAA,MACtB,YAAA,EAAc,MAAA,CAAO,OAAA,GAAU,EAAA,GAAK,CAAA;AAAA,MACpC,UAAA,EAAY,IAAA,CAAK,GAAA,EAAI,GAAI,SAAA;AAAA,MACzB,gBAAA;AAAA,MACA,OAAO,MAAA,CAAO;AAAA,KAChB;AAAA,EACF,SAAS,KAAA,EAAY;AACnB,IAAA,OAAO;AAAA,MACL,OAAA,EAAS,KAAA;AAAA,MACT,KAAK,IAAA,CAAK,GAAA;AAAA,MACV,MAAA,EAAQ,KAAA;AAAA,MACR,KAAA,EAAO,EAAA;AAAA,MACP,OAAA,EAAS,EAAA;AAAA,MACT,UAAA,EAAY,IAAA,CAAK,GAAA,EAAI,GAAI,SAAA;AAAA,MACzB,gBAAA;AAAA,MACA,OAAO,KAAA,CAAM;AAAA,KACf;AAAA,EACF;AACF;;;ACvWA,cAAA,EAAA;AAoBA,SAAS,mBAAA,GAA8B;AACrC,EAAA,MAAM,UAAA,GAAa,UAAU,OAAA,EAAQ;AACrC,EAAA,MAAM,aAAA,GAAgB,UAAA,CAAW,MAAA,GAAS,CAAA,GACtC,UAAA,CACG,GAAA,CAAI,CAAA,CAAA,KAAK,CAAA,WAAA,EAAS,CAAA,CAAE,IAAI,CAAA,GAAA,EAAM,CAAA,CAAE,WAAW;AAAA,KAAA,EAAU,CAAA,CAAE,MAAA,CAAO,WAAA,IAAe,gBAAgB;AAAA,eAAA,EAAoB,EAAE,OAAO,CAAA,CAAE,CAAA,CAC5H,IAAA,CAAK,MAAM,CAAA,GACd,+EAAA;AAEJ,EAAA,OAAO,CAAA;;AAAA;;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA,EAmBP,aAAa;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,CAAA,CAAA;AA6Cf;AAMO,SAAS,2BAAA,GAA4E;AAC1F,EAAA,OAAO;AAAA,IACL,UAAA,EAAY;AAAA,MACV,IAAA,EAAM,UAAA;AAAA,MACN,QAAA,EAAU;AAAA,QACR,IAAA,EAAM,oBAAA;AAAA,QACN,aAAa,mBAAA,EAAoB;AAAA,QACjC,UAAA,EAAY;AAAA,UACV,IAAA,EAAM,QAAA;AAAA,UACN,UAAA,EAAY;AAAA,YACV,IAAA,EAAM;AAAA,cACJ,IAAA,EAAM,QAAA;AAAA,cACN,WAAA,EACE;AAAA,aACJ;AAAA,YACA,KAAA,EAAO;AAAA,cACL,WAAA,EAAa;AAAA,aACf;AAAA,YACA,OAAA,EAAS;AAAA,cACP,IAAA,EAAM,QAAA;AAAA,cACN,WAAA,EAAa;AAAA;AACf,WACF;AAAA,UACA,QAAA,EAAU,CAAC,MAAM;AAAA;AACnB,OACF;AAAA,MACA,QAAA,EAAU,IAAA;AAAA,MACV,OAAA,EAAS;AAAA;AAAA,KACX;AAAA,IAEA,OAAA,EAAS,OAAO,IAAA,KAAkD;AAChE,MAAA,MAAM,OAAiB,EAAC;AACxB,MAAA,MAAM,SAAA,GAAY,KAAK,GAAA,EAAI;AAE3B,MAAA,IAAI;AAEF,QAAA,MAAM,UAAU,IAAA,CAAK,GAAA,CAAI,IAAA,CAAK,OAAA,IAAW,KAAO,GAAK,CAAA;AAGrD,QAAA,MAAM,MAAA,GAAS,MAAM,WAAA,CAAY,IAAA,CAAK,MAAM,IAAA,CAAK,KAAA,EAAO,SAAS,IAAI,CAAA;AAErE,QAAA,OAAO;AAAA,UACL,OAAA,EAAS,IAAA;AAAA,UACT,MAAA;AAAA,UACA,IAAA;AAAA,UACA,aAAA,EAAe,IAAA,CAAK,GAAA,EAAI,GAAI;AAAA,SAC9B;AAAA,MACF,SAAS,KAAA,EAAO;AACd,QAAA,OAAO;AAAA,UACL,OAAA,EAAS,KAAA;AAAA,UACT,MAAA,EAAQ,IAAA;AAAA,UACR,IAAA;AAAA,UACA,OAAQ,KAAA,CAAgB,OAAA;AAAA,UACxB,aAAA,EAAe,IAAA,CAAK,GAAA,EAAI,GAAI;AAAA,SAC9B;AAAA,MACF;AAAA,IACF;AAAA,GACF;AACF;AAOO,IAAM,oBAAkE,2BAAA,EAA4B;AAK3G,eAAe,WAAA,CACb,IAAA,EACA,KAAA,EACA,OAAA,EACA,IAAA,EACc;AAEd,EAAA,MAAM,OAAA,GAAe;AAAA;AAAA,IAEnB,KAAA,EAAO,SAAS,EAAC;AAAA,IACjB,MAAA,EAAQ,IAAA;AAAA;AAAA,IAGR,OAAA,EAAS;AAAA,MACP,GAAA,EAAK,CAAA,GAAI,IAAA,KAAgB,IAAA,CAAK,KAAK,IAAA,CAAK,GAAA,CAAI,CAAC,CAAA,KAAM,OAAO,CAAC,CAAC,CAAA,CAAE,IAAA,CAAK,GAAG,CAAC,CAAA;AAAA,MACvE,OAAO,CAAA,GAAI,IAAA,KAAgB,IAAA,CAAK,IAAA,CAAK,YAAY,IAAA,CAAK,GAAA,CAAI,CAAC,CAAA,KAAM,OAAO,CAAC,CAAC,CAAA,CAAE,IAAA,CAAK,GAAG,CAAC,CAAA;AAAA,MACrF,MAAM,CAAA,GAAI,IAAA,KAAgB,IAAA,CAAK,IAAA,CAAK,WAAW,IAAA,CAAK,GAAA,CAAI,CAAC,CAAA,KAAM,OAAO,CAAC,CAAC,CAAA,CAAE,IAAA,CAAK,GAAG,CAAC;AAAA,KACrF;AAAA;AAAA,IAGA,kBAAA;AAAA;AAAA,IAGA,OAAO,UAAA,CAAW,KAAA;AAAA;AAAA,IAGlB,UAAA,EAAY;AAAA,MACV,IAAA,EAAM,MAAM,SAAA,CAAU,IAAA,EAAK;AAAA,MAC3B,GAAA,EAAK,CAAC,IAAA,KAAiB;AACrB,QAAA,IAAI;AACF,UAAA,MAAM,SAAA,GAAY,SAAA,CAAU,GAAA,CAAI,IAAI,CAAA;AACpC,UAAA,OAAO;AAAA,YACL,aAAa,SAAA,CAAU,WAAA;AAAA,YACvB,WAAA,EAAa,SAAA,CAAU,MAAA,CAAO,WAAA,IAAe,EAAA;AAAA,YAC7C,SAAS,SAAA,CAAU;AAAA,WACrB;AAAA,QACF,CAAA,CAAA,MAAQ;AACN,UAAA,OAAO,IAAA;AAAA,QACT;AAAA,MACF;AAAA,KACF;AAAA;AAAA,IAGA,MAAA;AAAA,IACA,IAAA;AAAA,IACA,IAAA;AAAA,IACA,IAAA;AAAA,IACA,UAAA;AAAA,IACA,WAAA;AAAA,IACA,YAAA;AAAA,IACA,aAAA;AAAA,IACA,OAAA;AAAA;AAAA,IAGA,KAAA;AAAA,IACA,MAAA;AAAA,IACA,MAAA;AAAA,IACA,MAAA;AAAA,IACA;AAAA,GACF;AAGA,EAAA,MAAM,OAAA,GAAa,iBAAc,OAAO,CAAA;AAGxC,EAAA,MAAM,cAAc,IAAA,CAAK,IAAA,GAAO,UAAA,CAAW,QAAQ,IAC/C,IAAA,GACA;AAAA;AAAA,MAAA,EAEE,IAAI;AAAA;AAAA;AAAA,EAAA,CAAA;AAMV,EAAA,MAAM,MAAA,GAAS,IAAO,EAAA,CAAA,MAAA,CAAO,WAAW,CAAA;AACxC,EAAA,MAAM,aAAA,GAAgB,MAAA,CAAO,YAAA,CAAa,OAAA,EAAS;AAAA,IACjD,OAAA;AAAA,IACA,aAAA,EAAe;AAAA,GAChB,CAAA;AAGD,EAAA,MAAM,SAAS,MAAM,aAAA;AAGrB,EAAA,OAAO,MAAA,KAAW,MAAA,GAAY,MAAA,GAAS,OAAA,CAAQ,MAAA;AACjD;;;ACnNO,IAAM,YAAA,GAAoC;AAAA,EAC/C;AAAA,IACE,IAAA,EAAM,oBAAA;AAAA,IACN,UAAA,EAAY,mBAAA;AAAA,IACZ,WAAA,EAAa,oBAAA;AAAA,IACb,QAAA,EAAU,MAAA;AAAA,IACV,WAAA,EAAa,sGAAA;AAAA,IACb,IAAA,EAAM,iBAAA;AAAA,IACN,aAAA,EAAe;AAAA,GACjB;AAAA,EACA;AAAA,IACE,IAAA,EAAM,WAAA;AAAA,IACN,UAAA,EAAY,UAAA;AAAA,IACZ,WAAA,EAAa,WAAA;AAAA,IACb,QAAA,EAAU,YAAA;AAAA,IACV,WAAA,EAAa,6CAAA;AAAA,IACb,IAAA,EAAM,QAAA;AAAA,IACN,aAAA,EAAe;AAAA,GACjB;AAAA,EACA;AAAA,IACE,IAAA,EAAM,MAAA;AAAA,IACN,UAAA,EAAY,MAAA;AAAA,IACZ,WAAA,EAAa,MAAA;AAAA,IACb,QAAA,EAAU,YAAA;AAAA,IACV,WAAA,EAAa,oEAAA;AAAA,IACb,IAAA,EAAMe,KAAAA;AAAA,IACN,aAAA,EAAe;AAAA,GACjB;AAAA,EACA;AAAA,IACE,IAAA,EAAM,MAAA;AAAA,IACN,UAAA,EAAY,MAAA;AAAA,IACZ,WAAA,EAAa,MAAA;AAAA,IACb,QAAA,EAAU,YAAA;AAAA,IACV,WAAA,EAAa,0DAAA;AAAA,IACb,IAAA,EAAM,IAAA;AAAA,IACN,aAAA,EAAe;AAAA,GACjB;AAAA,EACA;AAAA,IACE,IAAA,EAAM,gBAAA;AAAA,IACN,UAAA,EAAY,eAAA;AAAA,IACZ,WAAA,EAAa,gBAAA;AAAA,IACb,QAAA,EAAU,YAAA;AAAA,IACV,WAAA,EAAa,2DAAA;AAAA,IACb,IAAA,EAAM,aAAA;AAAA,IACN,aAAA,EAAe;AAAA,GACjB;AAAA,EACA;AAAA,IACE,IAAA,EAAM,WAAA;AAAA,IACN,UAAA,EAAY,UAAA;AAAA,IACZ,WAAA,EAAa,WAAA;AAAA,IACb,QAAA,EAAU,YAAA;AAAA,IACV,WAAA,EAAa,mDAAA;AAAA,IACb,IAAA,EAAMmC,SAAAA;AAAA,IACN,aAAA,EAAe;AAAA,GACjB;AAAA,EACA;AAAA,IACE,IAAA,EAAM,YAAA;AAAA,IACN,UAAA,EAAY,WAAA;AAAA,IACZ,WAAA,EAAa,YAAA;AAAA,IACb,QAAA,EAAU,YAAA;AAAA,IACV,WAAA,EAAa,kDAAA;AAAA,IACb,IAAA,EAAMC,UAAAA;AAAA,IACN,aAAA,EAAe;AAAA,GACjB;AAAA,EACA;AAAA,IACE,IAAA,EAAM,iBAAA;AAAA,IACN,UAAA,EAAY,iBAAA;AAAA,IACZ,WAAA,EAAa,iBAAA;AAAA,IACb,QAAA,EAAU,MAAA;AAAA,IACV,WAAA,EAAa,gFAAA;AAAA,IACb,IAAA,EAAM,eAAA;AAAA,IACN,aAAA,EAAe;AAAA,GACjB;AAAA,EACA;AAAA,IACE,IAAA,EAAM,MAAA;AAAA,IACN,UAAA,EAAY,MAAA;AAAA,IACZ,WAAA,EAAa,MAAA;AAAA,IACb,QAAA,EAAU,OAAA;AAAA,IACV,WAAA,EAAa,+CAAA;AAAA,IACb,IAAA,EAAM,IAAA;AAAA,IACN,aAAA,EAAe;AAAA,GACjB;AAAA,EACA;AAAA,IACE,IAAA,EAAM,WAAA;AAAA,IACN,UAAA,EAAY,UAAA;AAAA,IACZ,WAAA,EAAa,WAAA;AAAA,IACb,QAAA,EAAU,KAAA;AAAA,IACV,WAAA,EAAa,qDAAA;AAAA,IACb,IAAA,EAAM,QAAA;AAAA,IACN,aAAA,EAAe;AAAA,GACjB;AAAA,EACA;AAAA,IACE,IAAA,EAAM,cAAA;AAAA,IACN,UAAA,EAAY,YAAA;AAAA,IACZ,WAAA,EAAa,cAAA;AAAA,IACb,QAAA,EAAU,KAAA;AAAA,IACV,WAAA,EAAa,mGAAA;AAAA,IACb,IAAA,EAAM,UAAA;AAAA,IACN,aAAA,EAAe;AAAA,GACjB;AAAA,EACA;AAAA,IACE,IAAA,EAAM,YAAA;AAAA,IACN,UAAA,EAAY,WAAA;AAAA,IACZ,WAAA,EAAa,YAAA;AAAA,IACb,QAAA,EAAU,KAAA;AAAA,IACV,WAAA,EAAa,4EAAA;AAAA,IACb,IAAA,EAAM,SAAA;AAAA,IACN,aAAA,EAAe,IAAA;AAAA,IACf,iBAAA,EAAmB,IAAA;AAAA,IACnB,qBAAA,EAAuB,CAAC,SAAS;AAAA,GACnC;AAAA,EACA;AAAA,IACE,IAAA,EAAM,YAAA;AAAA,IACN,UAAA,EAAY,WAAA;AAAA,IACZ,WAAA,EAAa,YAAA;AAAA,IACb,QAAA,EAAU,KAAA;AAAA,IACV,WAAA,EAAa,wDAAA;AAAA,IACb,IAAA,EAAM,SAAA;AAAA,IACN,aAAA,EAAe,IAAA;AAAA,IACf,iBAAA,EAAmB,IAAA;AAAA,IACnB,qBAAA,EAAuB,CAAC,QAAA,EAAS,cAAA,EAAe,UAAS,oBAAoB;AAAA;AAEjF;AAGO,SAAS,kBAAA,GAAqC;AACnD,EAAA,OAAO,YAAA,CAAa,GAAA,CAAI,CAAC,KAAA,KAAU,MAAM,IAAI,CAAA;AAC/C;AAGO,SAAS,eAAA,GAAuC;AACrD,EAAA,OAAO,CAAC,GAAG,YAAY,CAAA;AACzB;AAGO,SAAS,mBAAmB,QAAA,EAA6C;AAC9E,EAAA,OAAO,aAAa,MAAA,CAAO,CAAC,KAAA,KAAU,KAAA,CAAM,aAAa,QAAQ,CAAA;AACnE;AAGO,SAAS,cAAc,IAAA,EAA6C;AACzE,EAAA,OAAO,aAAa,IAAA,CAAK,CAAC,KAAA,KAAU,KAAA,CAAM,SAAS,IAAI,CAAA;AACzD;AAGO,SAAS,0BAAA,GAAkD;AAChE,EAAA,OAAO,YAAA,CAAa,MAAA,CAAO,CAAC,KAAA,KAAU,MAAM,iBAAiB,CAAA;AAC/D;AAGO,SAAS,iBAAA,GAAoC;AAClD,EAAA,OAAO,CAAC,GAAG,IAAI,GAAA,CAAI,YAAA,CAAa,GAAA,CAAI,CAAC,KAAA,KAAU,KAAA,CAAM,QAAQ,CAAC,CAAC,CAAA;AACjE;;;AtBxDO,IAAM,cAAA,GAAiB;AAAA,EAC5BD,SAAAA;AAAA,EACAC,UAAAA;AAAA,EACA,QAAA;AAAA,EACApC,KAAAA;AAAA,EACA,IAAA;AAAA,EACA,aAAA;AAAA,EACA;AACF;;;AuB5IO,IAAM,sBAAN,MAA0B;AAAA,EACvB,KAAA,GAAsB,IAAA;AAAA,EACtB,sBAAmC,EAAC;AAAA,EACpC,aAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAMR,WAAA,CAAY,gBAAwB,QAAA,EAAU;AAC5C,IAAA,IAAA,CAAK,aAAA,GAAgB,aAAA;AAAA,EACvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,MAAM,IAAI,YAAA,EAAgE;AAExE,IAAA,IAAA,CAAK,KAAA,GAAQ,MAAM,MAAA,CAAO;AAAA,MACxB,WAAW,IAAA,CAAK,aAAA;AAAA,MAChB,KAAA,EAAO,KAAK,eAAA,EAAgB;AAAA,MAC5B,YAAA,EAAc,KAAK,qBAAA,EAAsB;AAAA,MACzC,WAAA,EAAa,GAAA;AAAA;AAAA,MACb,aAAA,EAAe;AAAA,KAChB,CAAA;AAED,IAAA,MAAM,OAAA,GAAU,IAAI,cAAA,EAAe;AAGnC,IAAA,MAAM,eAAe,YAAA,IAAgB,uCAAA;AACrC,IAAA,OAAA,CAAQ,eAAe,YAAY,CAAA;AAGnC,IAAA,IAAA,CAAK,mBAAA,CAAoB,IAAA,CAAK,GAAG,OAAA,CAAQ,OAAO,CAAA;AAGhD,IAAA,MAAM,WAAW,MAAM,IAAA,CAAK,KAAA,CAAM,GAAA,CAAI,KAAK,mBAAmB,CAAA;AAG9D,IAAA,IAAA,CAAK,mBAAA,CAAoB,IAAA,CAAK,GAAG,QAAA,CAAS,MAAA,CAAO,MAAA;AAAA,MAC/C,CAAC,IAAA,KACC,IAAA,CAAK,IAAA,KAAS,SAAA,IAAa,KAAK,IAAA,KAAS;AAAA,KAC5C,CAAA;AAED,IAAA,MAAM,YAAA,GAAe,SAAS,WAAA,IAAe,EAAA;AAG7C,IAAA,IAAI,YAAA,CAAa,QAAA,CAAS,oBAAoB,CAAA,EAAG;AAC/C,MAAA,OAAO,IAAA,CAAK,cAAc,YAAY,CAAA;AAAA,IACxC;AAGA,IAAA,OAAO,YAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,MAAM,SAAS,WAAA,EAA8D;AAC3E,IAAA,IAAI,CAAC,KAAK,KAAA,EAAO;AACf,MAAA,MAAM,IAAI,MAAM,0CAA0C,CAAA;AAAA,IAC5D;AAEA,IAAA,MAAM,OAAA,GAAU,IAAI,cAAA,EAAe;AACnC,IAAA,OAAA,CAAQ,eAAe,WAAW,CAAA;AAGlC,IAAA,IAAA,CAAK,mBAAA,CAAoB,IAAA,CAAK,GAAG,OAAA,CAAQ,OAAO,CAAA;AAGhD,IAAA,MAAM,WAAW,MAAM,IAAA,CAAK,KAAA,CAAM,GAAA,CAAI,KAAK,mBAAmB,CAAA;AAG9D,IAAA,IAAA,CAAK,mBAAA,CAAoB,IAAA,CAAK,GAAG,QAAA,CAAS,MAAA,CAAO,MAAA;AAAA,MAC/C,CAAC,IAAA,KACC,IAAA,CAAK,IAAA,KAAS,SAAA,IAAa,KAAK,IAAA,KAAS;AAAA,KAC5C,CAAA;AAED,IAAA,MAAM,YAAA,GAAe,SAAS,WAAA,IAAe,EAAA;AAG7C,IAAA,IAAI,YAAA,CAAa,QAAA,CAAS,oBAAoB,CAAA,EAAG;AAC/C,MAAA,OAAO,IAAA,CAAK,cAAc,YAAY,CAAA;AAAA,IACxC;AAGA,IAAA,OAAO,YAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKQ,qBAAA,GAAgC;AACtC,IAAA,OAAO,CAAA;;AAAA;;AAAA;;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;;AAAA,iIAAA,CAAA;AAAA,EA8ET;AAAA;AAAA;AAAA;AAAA,EAKQ,cAAc,YAAA,EAA6C;AAEjE,IAAA,MAAM,WAAA,GAAc,YAAA,CAAa,KAAA,CAAM,oDAAoD,CAAA;AAE3F,IAAA,IAAI,CAAC,WAAA,EAAa;AAChB,MAAA,MAAM,IAAI,MAAM,uEAAuE,CAAA;AAAA,IACzF;AAEA,IAAA,IAAI;AACF,MAAA,MAAM,UAAA,GAAa,WAAA,CAAY,CAAC,CAAA,CAAG,IAAA,EAAK;AACxC,MAAA,MAAM,MAAA,GAAS,IAAA,CAAK,KAAA,CAAM,UAAU,CAAA;AAEpC,MAAA,OAAO,MAAA;AAAA,IACT,SAAS,KAAA,EAAO;AACd,MAAA,MAAM,IAAI,KAAA,CAAM,CAAA,oCAAA,EAAwC,KAAA,CAAgB,OAAO,CAAA,CAAE,CAAA;AAAA,IACnF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,eAAA,GAA0B;AAEhC,IAAA,OAAO,SAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,KAAA,GAAc;AACZ,IAAA,IAAA,CAAK,sBAAsB,EAAC;AAC5B,IAAA,IAAA,CAAK,KAAA,GAAQ,IAAA;AAAA,EACf;AACF;AClNO,IAAM,WAAA,GAAN,cAA0BE,YAAAA,CAAoC;AAAA,EAC3D,KAAA;AAAA,EACA,oBAAyF,EAAC;AAAA,EAC1F,YAAA,GAAe,KAAA;AAAA,EAEvB,WAAA,CAAY,cAAyB,aAAA,EAAe;AAClD,IAAA,KAAA,EAAM;AACN,IAAA,IAAA,CAAK,KAAA,GAAQ;AAAA,MACX,IAAA,EAAM,WAAA;AAAA,MACN,SAAA,sBAAe,IAAA,EAAK;AAAA,MACpB,MAAA,EAAQ;AAAA,KACV;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,IAAI,WAAA,GAAuB;AACzB,IAAA,OAAO,IAAA,CAAK,YAAA;AAAA,EACd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,OAAA,GAAgB;AACd,IAAA,IAAI,KAAK,YAAA,EAAc;AACrB,MAAA;AAAA,IACF;AAEA,IAAA,IAAA,CAAK,YAAA,GAAe,IAAA;AACpB,IAAA,IAAA,CAAK,oBAAoB,EAAC;AAC1B,IAAA,IAAA,CAAK,kBAAA,EAAmB;AAAA,EAC1B;AAAA;AAAA;AAAA;AAAA,EAKA,OAAA,GAAqB;AACnB,IAAA,OAAO,KAAK,KAAA,CAAM,IAAA;AAAA,EACpB;AAAA;AAAA;AAAA;AAAA,EAKA,QAAA,GAAsB;AACpB,IAAA,OAAO,EAAE,GAAG,IAAA,CAAK,KAAA,EAAM;AAAA,EACzB;AAAA;AAAA;AAAA;AAAA,EAKA,cAAc,EAAA,EAAwB;AACpC,IAAA,MAAM,IAAA,GAAO,KAAK,KAAA,CAAM,IAAA;AAGxB,IAAA,MAAM,gBAAA,GAAmD;AAAA,MACvD,aAAA,EAAe,CAAC,UAAA,EAAY,WAAW,CAAA;AAAA,MACvC,UAAA,EAAY,CAAC,aAAA,EAAe,WAAW,CAAA;AAAA,MACvC,WAAA,EAAa,CAAC,aAAA,EAAe,UAAU;AAAA,KACzC;AAEA,IAAA,OAAO,gBAAA,CAAiB,IAAI,CAAA,CAAE,QAAA,CAAS,EAAE,CAAA;AAAA,EAC3C;AAAA;AAAA;AAAA;AAAA,EAKA,UAAA,CAAW,IAAe,MAAA,EAAyB;AACjD,IAAA,MAAM,IAAA,GAAO,KAAK,KAAA,CAAM,IAAA;AAExB,IAAA,IAAI,CAAC,IAAA,CAAK,aAAA,CAAc,EAAE,CAAA,EAAG;AAC3B,MAAA,IAAA,CAAK,KAAK,yBAAA,EAA2B,EAAE,IAAA,EAAM,EAAA,EAAI,QAAQ,CAAA;AACzD,MAAA,OAAO,KAAA;AAAA,IACT;AAGA,IAAA,IAAA,CAAK,iBAAA,CAAkB,IAAA,CAAK,EAAE,IAAA,EAAM,EAAA,EAAI,oBAAI,IAAI,IAAA,EAAK,EAAG,MAAA,EAAQ,CAAA;AAGhE,IAAA,IAAA,CAAK,KAAA,GAAQ;AAAA,MACX,IAAA,EAAM,EAAA;AAAA,MACN,SAAA,sBAAe,IAAA,EAAK;AAAA,MACpB,MAAA;AAAA;AAAA,MAEA,WAAA,EAAa,EAAA,KAAO,UAAA,GAAa,IAAA,CAAK,MAAM,WAAA,GAAc,MAAA;AAAA,MAC1D,YAAA,EAAc,EAAA,KAAO,WAAA,GAAc,IAAA,GAAO,MAAA;AAAA,MAC1C,gBAAA,EAAkB,EAAA,KAAO,WAAA,GAAc,CAAA,GAAI;AAAA,KAC7C;AAEA,IAAA,IAAA,CAAK,KAAK,cAAA,EAAgB,EAAE,IAAA,EAAM,EAAA,EAAI,QAAQ,CAAA;AAC9C,IAAA,OAAO,IAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,aAAA,CAAc,SAAiB,cAAA,EAAyB;AACtD,IAAA,OAAO,IAAA,CAAK,UAAA,CAAW,UAAA,EAAY,MAAM,CAAA;AAAA,EAC3C;AAAA;AAAA;AAAA;AAAA,EAKA,cAAA,CAAe,KAAA,EAAa,MAAA,GAAiB,eAAA,EAA0B;AACrE,IAAA,IAAI,KAAK,KAAA,CAAM,IAAA,KAAS,cAAc,CAAC,IAAA,CAAK,MAAM,YAAA,EAAc;AAE9D,MAAA,IAAA,CAAK,MAAM,YAAA,GAAe,IAAA;AAAA,IAC5B;AAEA,IAAA,MAAM,OAAA,GAAU,IAAA,CAAK,UAAA,CAAW,WAAA,EAAa,MAAM,CAAA;AACnD,IAAA,IAAI,OAAA,EAAS;AACX,MAAA,IAAA,CAAK,MAAM,gBAAA,GAAmB,CAAA;AAAA,IAChC;AACA,IAAA,OAAO,OAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,mBAAA,CAAoB,SAAiB,WAAA,EAAsB;AACzD,IAAA,OAAO,IAAA,CAAK,UAAA,CAAW,aAAA,EAAe,MAAM,CAAA;AAAA,EAC9C;AAAA;AAAA;AAAA;AAAA,EAKA,eAAe,IAAA,EAAkB;AAC/B,IAAA,IAAA,CAAK,MAAM,WAAA,GAAc,IAAA;AACzB,IAAA,IAAA,CAAK,MAAM,YAAA,GAAe,KAAA;AAAA,EAC5B;AAAA;AAAA;AAAA;AAAA,EAKA,cAAA,GAAmC;AACjC,IAAA,OAAO,KAAK,KAAA,CAAM,WAAA;AAAA,EACpB;AAAA;AAAA;AAAA;AAAA,EAKA,WAAA,GAAuB;AACrB,IAAA,IAAI,KAAK,KAAA,CAAM,IAAA,KAAS,cAAc,CAAC,IAAA,CAAK,MAAM,WAAA,EAAa;AAC7D,MAAA,OAAO,KAAA;AAAA,IACT;AACA,IAAA,IAAA,CAAK,MAAM,YAAA,GAAe,IAAA;AAC1B,IAAA,OAAO,IAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,cAAA,GAA0B;AACxB,IAAA,OAAO,IAAA,CAAK,MAAM,YAAA,IAAgB,KAAA;AAAA,EACpC;AAAA;AAAA;AAAA;AAAA,EAKA,oBAAoB,KAAA,EAAqB;AACvC,IAAA,IAAI,IAAA,CAAK,KAAA,CAAM,IAAA,KAAS,WAAA,EAAa;AACnC,MAAA,IAAA,CAAK,MAAM,gBAAA,GAAmB,KAAA;AAAA,IAChC;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,mBAAA,GAA8B;AAC5B,IAAA,OAAO,IAAA,CAAK,MAAM,gBAAA,IAAoB,CAAA;AAAA,EACxC;AAAA;AAAA;AAAA;AAAA,EAKA,eAAe,MAAA,EAAsB;AACnC,IAAA,IAAI,IAAA,CAAK,KAAA,CAAM,IAAA,KAAS,WAAA,EAAa;AACnC,MAAA,IAAA,CAAK,KAAA,CAAM,QAAA,mBAAW,IAAI,IAAA,EAAK;AAC/B,MAAA,IAAA,CAAK,MAAM,WAAA,GAAc,MAAA;AAAA,IAC3B;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,eAAA,GAAwB;AACtB,IAAA,IAAI,IAAA,CAAK,KAAA,CAAM,IAAA,KAAS,WAAA,EAAa;AACnC,MAAA,IAAA,CAAK,MAAM,QAAA,GAAW,MAAA;AACtB,MAAA,IAAA,CAAK,MAAM,WAAA,GAAc,MAAA;AAAA,IAC3B;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,QAAA,GAAoB;AAClB,IAAA,OAAO,IAAA,CAAK,MAAM,QAAA,KAAa,MAAA;AAAA,EACjC;AAAA;AAAA;AAAA;AAAA,EAKA,cAAA,GAAqC;AACnC,IAAA,OAAO,KAAK,KAAA,CAAM,WAAA;AAAA,EACpB;AAAA;AAAA;AAAA;AAAA,EAKA,aAAA,CAAc,QAAwB,YAAA,EAAuC;AAC3E,IAAA,MAAM,WAAA,GAAc,KAAK,KAAA,CAAM,IAAA;AAE/B,IAAA,QAAQ,OAAO,IAAA;AAAM,MACnB,KAAK,SAAA;AAEH,QAAA,IAAI,gBAAgB,aAAA,EAAe;AACjC,UAAA,OAAO,UAAA;AAAA,QACT;AACA,QAAA;AAAA,MAEF,KAAK,UAAA;AAEH,QAAA,IAAI,WAAA,KAAgB,UAAA,IAAc,IAAA,CAAK,KAAA,CAAM,WAAA,EAAa;AACxD,UAAA,OAAO,WAAA;AAAA,QACT;AACA,QAAA;AAAA,MAEF,KAAK,WAAA;AAEH,QAAA,IAAI,gBAAgB,UAAA,EAAY;AAC9B,UAAA,OAAO,UAAA;AAAA,QACT;AACA,QAAA;AAAA,MAEF,KAAK,aAAA;AAEH,QAAA,IAAI,WAAA,KAAgB,WAAA,IAAe,WAAA,KAAgB,aAAA,EAAe;AAChE,UAAA,OAAO,UAAA;AAAA,QACT;AACA,QAAA;AAAA,MAEF,KAAK,WAAA;AAEH,QAAA,OAAO,aAAA;AAAA,MAET,KAAK,QAAA;AAAA,MACL,KAAK,UAAA;AAEH,QAAA,IAAI,gBAAgB,WAAA,EAAa;AAC/B,UAAA,OAAO,IAAA;AAAA,QACT;AACA,QAAA,OAAO,aAAA;AAAA,MAET,KAAK,cAAA;AAEH,QAAA,OAAO,IAAA;AAAA,MAET,KAAK,UAAA;AAEH,QAAA,OAAO,IAAA;AAAA;AAGX,IAAA,OAAO,IAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,UAAA,GAAkF;AAChF,IAAA,OAAO,CAAC,GAAG,IAAA,CAAK,iBAAiB,CAAA;AAAA,EACnC;AAAA;AAAA;AAAA;AAAA,EAKA,YAAA,GAAqB;AACnB,IAAA,IAAA,CAAK,oBAAoB,EAAC;AAAA,EAC5B;AAAA;AAAA;AAAA;AAAA,EAKA,oBAAA,GAA+B;AAC7B,IAAA,OAAO,KAAK,GAAA,EAAI,GAAI,IAAA,CAAK,KAAA,CAAM,UAAU,OAAA,EAAQ;AAAA,EACnD;AAAA;AAAA;AAAA;AAAA,EAKA,SAAA,GAOE;AACA,IAAA,OAAO;AAAA,MACL,IAAA,EAAM,KAAK,KAAA,CAAM,IAAA;AAAA,MACjB,SAAA,EAAW,IAAA,CAAK,KAAA,CAAM,SAAA,CAAU,WAAA,EAAY;AAAA,MAC5C,MAAA,EAAQ,KAAK,KAAA,CAAM,MAAA;AAAA,MACnB,WAAA,EAAa,KAAK,KAAA,CAAM,WAAA;AAAA,MACxB,YAAA,EAAc,KAAK,KAAA,CAAM,YAAA;AAAA,MACzB,gBAAA,EAAkB,KAAK,KAAA,CAAM;AAAA,KAC/B;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,QAAQ,IAAA,EAAkD;AACxD,IAAA,IAAA,CAAK,KAAA,GAAQ;AAAA,MACX,MAAM,IAAA,CAAK,IAAA;AAAA,MACX,SAAA,EAAW,IAAI,IAAA,CAAK,IAAA,CAAK,SAAS,CAAA;AAAA,MAClC,QAAQ,IAAA,CAAK,MAAA;AAAA,MACb,aAAa,IAAA,CAAK,WAAA;AAAA,MAClB,cAAc,IAAA,CAAK,YAAA;AAAA,MACnB,kBAAkB,IAAA,CAAK;AAAA,KACzB;AAAA,EACF;AACF;;;AC1UO,IAAM,iBAAA,GAAyE;AAAA,EACpF,UAAA,EAAY;AAAA,IACV,IAAA,EAAM,UAAA;AAAA,IACN,QAAA,EAAU;AAAA,MACR,IAAA,EAAM,iBAAA;AAAA,MACN,WAAA,EAAa,CAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,8BAAA,CAAA;AAAA,MAYb,UAAA,EAAY;AAAA,QACV,IAAA,EAAM,QAAA;AAAA,QACN,UAAA,EAAY;AAAA,UACV,IAAA,EAAM;AAAA,YACJ,IAAA,EAAM,QAAA;AAAA,YACN,WAAA,EAAa;AAAA,WACf;AAAA,UACA,SAAA,EAAW;AAAA,YACT,IAAA,EAAM,QAAA;AAAA,YACN,WAAA,EAAa;AAAA;AACf,SACF;AAAA,QACA,QAAA,EAAU,CAAC,MAAA,EAAQ,WAAW;AAAA;AAChC;AACF,GACF;AAAA,EACA,OAAA,EAAS,OAAO,IAAA,KAAS;AAEvB,IAAA,OAAO,EAAE,MAAA,EAAQ,kBAAA,EAAoB,IAAA,EAAM,KAAK,IAAA,EAAK;AAAA,EACvD;AACF,CAAA;AAKO,IAAM,cAAA,GAAmE;AAAA,EAC9E,UAAA,EAAY;AAAA,IACV,IAAA,EAAM,UAAA;AAAA,IACN,QAAA,EAAU;AAAA,MACR,IAAA,EAAM,cAAA;AAAA,MACN,WAAA,EAAa,CAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,4BAAA,CAAA;AAAA,MAOb,UAAA,EAAY;AAAA,QACV,IAAA,EAAM,QAAA;AAAA,QACN,UAAA,EAAY;AAAA,UACV,MAAA,EAAQ;AAAA,YACN,IAAA,EAAM,QAAA;AAAA,YACN,MAAM,CAAC,UAAA,EAAY,aAAA,EAAe,WAAA,EAAa,eAAe,SAAS,CAAA;AAAA,YACvE,WAAA,EAAa;AAAA,WACf;AAAA,UACA,QAAA,EAAU;AAAA,YACR,IAAA,EAAM,QAAA;AAAA,YACN,WAAA,EAAa;AAAA,WACf;AAAA,UACA,OAAA,EAAS;AAAA,YACP,IAAA,EAAM,QAAA;AAAA,YACN,WAAA,EAAa;AAAA,WACf;AAAA,UACA,WAAA,EAAa;AAAA,YACX,IAAA,EAAM,QAAA;AAAA,YACN,WAAA,EAAa;AAAA;AACf,SACF;AAAA,QACA,QAAA,EAAU,CAAC,QAAA,EAAU,SAAS;AAAA;AAChC;AACF,GACF;AAAA,EACA,OAAA,EAAS,OAAO,IAAA,KAAS;AAEvB,IAAA,OAAO,EAAE,MAAA,EAAQ,eAAA,EAAiB,MAAA,EAAQ,KAAK,MAAA,EAAO;AAAA,EACxD;AACF,CAAA;AAKO,IAAM,kBAAA,GAA8F;AAAA,EACzG,UAAA,EAAY;AAAA,IACV,IAAA,EAAM,UAAA;AAAA,IACN,QAAA,EAAU;AAAA,MACR,IAAA,EAAM,kBAAA;AAAA,MACN,WAAA,EAAa,qFAAA;AAAA,MACb,UAAA,EAAY;AAAA,QACV,IAAA,EAAM,QAAA;AAAA,QACN,YAAY,EAAC;AAAA,QACb,UAAU;AAAC;AACb;AACF,GACF;AAAA,EACA,SAAS,YAAY;AAEnB,IAAA,OAAO,EAAE,MAAA,EAAQ,mBAAA,EAAqB,QAAA,EAAU,IAAA,EAAK;AAAA,EACvD;AACF,CAAA;AAKO,IAAM,mBAAA,GAA6E;AAAA,EACxF,UAAA,EAAY;AAAA,IACV,IAAA,EAAM,UAAA;AAAA,IACN,QAAA,EAAU;AAAA,MACR,IAAA,EAAM,mBAAA;AAAA,MACN,WAAA,EAAa,+GAAA;AAAA,MACb,UAAA,EAAY;AAAA,QACV,IAAA,EAAM,QAAA;AAAA,QACN,UAAA,EAAY;AAAA,UACV,OAAA,EAAS;AAAA,YACP,IAAA,EAAM,QAAA;AAAA,YACN,WAAA,EAAa;AAAA;AACf,SACF;AAAA,QACA,UAAU;AAAC;AACb;AACF,GACF;AAAA,EACA,OAAA,EAAS,OAAO,IAAA,KAAS;AAEvB,IAAA,OAAO,EAAE,MAAA,EAAQ,oBAAA,EAAsB,OAAA,EAAS,MAAM,OAAA,EAAQ;AAAA,EAChE;AACF,CAAA;AAKO,SAAS,YAAA,GAA+B;AAC7C,EAAA,OAAO;AAAA,IACL,iBAAA;AAAA,IACA,cAAA;AAAA,IACA,kBAAA;AAAA,IACA;AAAA,GACF;AACF;AAKO,SAAS,WAAW,QAAA,EAA2B;AACpD,EAAA,OAAO,QAAA,CAAS,WAAW,GAAG,CAAA;AAChC;AAKO,IAAM,eAAA,GAAkB;AAAA,EAC7B,cAAA,EAAgB,iBAAA;AAAA,EAChB,WAAA,EAAa,cAAA;AAAA,EACb,eAAA,EAAiB,kBAAA;AAAA,EACjB,gBAAA,EAAkB;AACpB;;;ACnDO,IAAM,cAAA,GAAN,MAAM,eAAA,SAAuB,SAAA,CAAsD;AAAA;AAAA,EAEhF,KAAA;AAAA;AAAA,EACA,cAAA;AAAA;AAAA,EACA,WAAA;AAAA,EACA,aAAA;AAAA;AAAA;AAAA,EAIA,WAAA;AAAA,EACA,aAAA;AAAA;AAAA,EAGA,WAAA,GAA2B,IAAA;AAAA,EAC3B,mBAA2F,EAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASpG,OAAO,OAAO,MAAA,EAA8C;AAC1D,IAAA,OAAO,IAAI,gBAAe,MAAM,CAAA;AAAA,EAClC;AAAA;AAAA;AAAA;AAAA,EAKA,aAAa,MAAA,CACX,SAAA,EACA,MAAA,EACyB;AACzB,IAAA,MAAM,KAAA,GAAQ,IAAI,eAAA,CAAe;AAAA,MAC/B,GAAG,MAAA;AAAA,MACH,OAAA,EAAS;AAAA,QACP,GAAG,MAAA,CAAO,OAAA;AAAA,QACV,EAAA,EAAI;AAAA;AACN,KACD,CAAA;AAGD,IAAA,MAAM,MAAM,mBAAA,EAAoB;AAIhC,IAAA,MAAM,WAAA,GAAc,KAAA,CAAM,WAAA,CAAY,cAAA,EAAe;AACrD,IAAA,IAAI,WAAA,EAAa;AACf,MAAA,KAAA,CAAM,WAAA,GAAc,WAAA;AAAA,IACtB;AAEA,IAAA,OAAO,KAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAMQ,YAAY,MAAA,EAA8B;AAEhD,IAAA,KAAA,CAAM,QAAQ,gBAAgB,CAAA;AAG9B,IAAA,MAAM,YAAY,YAAA,EAAa;AAC/B,IAAA,KAAA,MAAW,QAAQ,SAAA,EAAW;AAC5B,MAAA,IAAA,CAAK,cAAc,KAAA,CAAM,QAAA,CAAS,MAAM,EAAE,SAAA,EAAW,SAAS,CAAA;AAAA,IAChE;AAGA,IAAA,IAAA,CAAK,aAAA,CAAc,YAAA,GAAe,IAAA,CAAK,iBAAA,CAAkB,OAAO,YAAY,CAAA;AAG5E,IAAA,MAAM,QAAA,GAAW,IAAA,CAAK,aAAA,CAAc,KAAA,CAAM,UAAA,EAAW;AACrD,IAAA,IAAA,CAAK,KAAA,GAAQ,MAAM,MAAA,CAAO;AAAA,MACxB,WAAW,MAAA,CAAO,SAAA;AAAA,MAClB,OAAO,MAAA,CAAO,KAAA;AAAA,MACd,KAAA,EAAO,QAAA;AAAA,MACP,YAAA,EAAc,IAAA,CAAK,iBAAA,CAAkB,MAAA,CAAO,YAAY,CAAA;AAAA,MACxD,aAAa,MAAA,CAAO,WAAA;AAAA,MACpB,aAAA,EAAe,OAAO,aAAA,IAAiB,EAAA;AAAA,MACvC,aAAa,MAAA,CAAO,WAAA;AAAA,MACpB,SAAS,IAAA,CAAK;AAAA;AAAA,KACf,CAAA;AAGD,IAAA,IAAA,CAAK,WAAA,GAAc,IAAI,WAAA,CAAY,aAAa,CAAA;AAChD,IAAA,IAAA,CAAK,WAAA,CAAY,EAAA,CAAG,cAAA,EAAgB,CAAC,IAAA,KAAS;AAC5C,MAAA,IAAA,CAAK,IAAA,CAAK,gBAAgB,IAAI,CAAA;AAAA,IAChC,CAAC,CAAA;AAMD,IAAA,MAAM,eAAA,GAAkB,MAAA,CAAO,QAAA,EAAU,OAAA,KAAY,KAAA;AACrD,IAAA,IAAI,eAAA,EAAiB;AACnB,MAAA,IAAA,CAAK,aAAA,GAAgB,cAAc,MAAA,CAAO;AAAA,QACxC,WAAW,MAAA,CAAO,SAAA;AAAA,QAClB,KAAA,EAAO,MAAA,CAAO,QAAA,EAAU,KAAA,IAAS,MAAA,CAAO,KAAA;AAAA,QACxC,cAAA,EAAgB,IAAA,CAAK,aAAA,CAAc,KAAA,CAAM,YAAW,CAAE,MAAA,CAAO,CAAA,CAAA,KAAK,CAAC,UAAA,CAAW,CAAA,CAAE,UAAA,CAAW,QAAA,CAAS,IAAI,CAAC;AAAA,OAC1G,CAAA;AAAA,IACH;AAGA,IAAA,IAAA,CAAK,cAAA,GAAiB,KAAK,oBAAA,EAAqB;AAGhD,IAAA,IAAA,CAAK,WAAA,GAAc,IAAI,UAAA,EAAW;AAClC,IAAA,IAAA,CAAK,aAAA,CAAc,cAAA,CAAe,IAAA,CAAK,WAAW,CAAA;AAGlD,IAAA,IAAI,IAAA,CAAK,cAAc,MAAA,EAAQ;AAC7B,MAAA,IAAA,CAAK,aAAA,GAAgB,IAAI,YAAA,CAAa,IAAA,CAAK,cAAc,MAAM,CAAA;AAC/D,MAAA,IAAA,CAAK,aAAA,CAAc,cAAA,CAAe,IAAA,CAAK,aAAa,CAAA;AAAA,IACtD;AAGA,IAAA,IAAA,CAAK,iBAAA,CAAkB,OAAO,OAAO,CAAA;AAAA,EACvC;AAAA;AAAA;AAAA;AAAA,EAMU,YAAA,GAA2D;AACnE,IAAA,OAAO,iBAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUA,MAAM,eAAA,GAA6F;AACjG,IAAA,MAAM,KAAA,GAAQ,MAAM,KAAA,CAAM,eAAA,EAAgB;AAC1C,IAAA,KAAA,CAAM,UAAA,GAAa,KAAA,CAAM,UAAA,IAAc,EAAC;AACxC,IAAA,KAAA,CAAM,UAAA,CAAW,WAAA,GAAc,IAAA,CAAK,WAAA,CAAY,SAAA,EAAU;AAC1D,IAAA,OAAO,KAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,oBAAoB,KAAA,EAAwF;AAChH,IAAA,MAAM,KAAA,CAAM,oBAAoB,KAAK,CAAA;AACrC,IAAA,IAAI,KAAA,CAAM,YAAY,WAAA,EAAa;AACjC,MAAA,IAAA,CAAK,WAAA,CAAY,OAAA,CAAQ,KAAA,CAAM,UAAA,CAAW,WAAmD,CAAA;AAAA,IAC/F;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,MAAM,KAAK,KAAA,EAA2C;AACpD,IAAA,IAAI,KAAK,YAAA,EAAc;AACrB,MAAA,MAAM,IAAI,MAAM,0BAA0B,CAAA;AAAA,IAC5C;AAGA,IAAA,MAAM,MAAA,GAAS,MAAM,IAAA,CAAK,aAAA,CAAc,KAAK,CAAA;AAG7C,IAAA,IAAI,QAAA;AAEJ,IAAA,QAAQ,IAAA,CAAK,WAAA,CAAY,OAAA,EAAQ;AAAG,MAClC,KAAK,aAAA;AACH,QAAA,QAAA,GAAW,MAAM,IAAA,CAAK,iBAAA,CAAkB,KAAA,EAAO,MAAM,CAAA;AACrD,QAAA;AAAA,MACF,KAAK,UAAA;AACH,QAAA,QAAA,GAAW,MAAM,IAAA,CAAK,cAAA,CAAe,KAAA,EAAO,MAAM,CAAA;AAClD,QAAA;AAAA,MACF,KAAK,WAAA;AACH,QAAA,QAAA,GAAW,MAAM,IAAA,CAAK,eAAA,CAAgB,KAAA,EAAO,MAAM,CAAA;AACnD,QAAA;AAAA,MACF;AACE,QAAA,MAAM,IAAI,KAAA,CAAM,CAAA,cAAA,EAAiB,KAAK,WAAA,CAAY,OAAA,EAAS,CAAA,CAAE,CAAA;AAAA;AAIjE,IAAA,IAAA,CAAK,iBAAiB,IAAA,CAAK;AAAA,MACzB,KAAA;AAAA,MACA,QAAA;AAAA,MACA,SAAA,sBAAe,IAAA;AAAK,KACrB,CAAA;AAGD,IAAA,IAAI,KAAK,OAAA,CAAQ,OAAA,EAAS,QAAA,IAAY,IAAA,CAAK,YAAW,EAAG;AACvD,MAAA,MAAM,IAAA,CAAK,WAAA,EAAY,CAAE,KAAA,CAAM,MAAM;AAAA,MAErC,CAAC,CAAA;AAAA,IACH;AAEA,IAAA,OAAO,QAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,OAAO,OAAO,KAAA,EAAsD;AAClE,IAAA,IAAI,KAAK,YAAA,EAAc;AACrB,MAAA,MAAM,IAAI,MAAM,0BAA0B,CAAA;AAAA,IAC5C;AAGA,IAAA,MAAM,MAAA,GAAS,MAAM,IAAA,CAAK,aAAA,CAAc,KAAK,CAAA;AAG7C,IAAA,MAAM,kBAAkB,IAAA,CAAK,WAAA,CAAY,cAAc,MAAA,EAAQ,IAAA,CAAK,eAAe,MAAS,CAAA;AAC5F,IAAA,IAAI,eAAA,IAAmB,eAAA,KAAoB,IAAA,CAAK,WAAA,CAAY,SAAQ,EAAG;AACrE,MAAA,MAAM,IAAA,GAAO,IAAA,CAAK,WAAA,CAAY,OAAA,EAAQ;AACtC,MAAA,IAAA,CAAK,WAAA,CAAY,UAAA,CAAW,eAAA,EAAiB,MAAA,CAAO,IAAI,CAAA;AACxD,MAAA,MAAM,EAAE,MAAM,cAAA,EAAgB,IAAA,EAAM,IAAI,eAAA,EAAiB,MAAA,EAAQ,OAAO,IAAA,EAAK;AAAA,IAC/E;AAGA,IAAA,MAAM,IAAA,GAAO,IAAA,CAAK,WAAA,CAAY,OAAA,EAAQ;AAEtC,IAAA,IAAI,SAAS,aAAA,EAAe;AAC1B,MAAA,OAAO,IAAA,CAAK,iBAAA,CAAkB,KAAA,EAAO,MAAM,CAAA;AAAA,IAC7C,CAAA,MAAA,IAAW,SAAS,UAAA,EAAY;AAC9B,MAAA,OAAO,IAAA,CAAK,cAAA,CAAe,KAAA,EAAO,MAAM,CAAA;AAAA,IAC1C,CAAA,MAAA,IAAW,SAAS,WAAA,EAAa;AAC/B,MAAA,OAAO,IAAA,CAAK,gBAAgB,MAAM,CAAA;AAAA,IACpC;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAMA,MAAc,iBAAA,CAAkB,KAAA,EAAe,MAAA,EAAoD;AAEjG,IAAA,MAAM,IAAA,CAAK,wBAAA,CAAyB,MAAA,EAAQ,KAAK,CAAA;AAGjD,IAAA,MAAM,UAAA,GAAa,IAAA,CAAK,sBAAA,CAAuB,MAAM,CAAA;AAErD,IAAA,IAAI,UAAA,EAAY;AACd,MAAA,IAAA,CAAK,WAAA,CAAY,cAAc,uBAAuB,CAAA;AACtD,MAAA,OAAO,IAAA,CAAK,cAAA,CAAe,KAAA,EAAO,MAAM,CAAA;AAAA,IAC1C;AAGA,IAAA,MAAM,eAAA,GAAkB,MAAM,IAAA,CAAK,gBAAA,CAAiB,KAAK,CAAA;AAGzD,IAAA,MAAM,QAAA,GAAW,MAAM,IAAA,CAAK,KAAA,CAAM,IAAI,eAAe,CAAA;AAGrD,IAAA,MAAM,gBAAA,GAAmB,SAAS,MAAA,CAAO,IAAA;AAAA,MACvC,CAAC,IAAA,KAAc,IAAA,CAAK,SAAS,UAAA,IAAc,IAAA,CAAK,SAAS,eAAA,CAAgB;AAAA,KAC3E;AAEA,IAAA,IAAI,gBAAA,EAAkB;AACpB,MAAA,IAAA,CAAK,WAAA,CAAY,cAAc,iBAAiB,CAAA;AAChD,MAAA,MAAM,WAAY,gBAAA,CAAyB,KAAA;AAC3C,MAAA,MAAM,IAAA,GAAO,OAAO,QAAA,KAAa,QAAA,GAAW,IAAA,CAAK,MAAM,QAAA,IAAY,IAAI,CAAA,GAAK,QAAA,IAAY,EAAC;AACzF,MAAA,OAAO,IAAA,CAAK,UAAA,CAAW,IAAA,CAAK,IAAA,EAAM,KAAK,SAAS,CAAA;AAAA,IAClD;AAGA,IAAA,MAAM,YAAA,GAAe,SAAS,WAAA,IAAe,EAAA;AAC7C,IAAA,MAAM,IAAA,CAAK,wBAAA,CAAyB,WAAA,EAAa,YAAY,CAAA;AAE7D,IAAA,OAAO;AAAA,MACL,IAAA,EAAM,YAAA;AAAA,MACN,IAAA,EAAM,aAAA;AAAA,MACN,KAAA,EAAO,SAAS,KAAA,GAAQ;AAAA,QACtB,WAAA,EAAa,SAAS,KAAA,CAAM,YAAA;AAAA,QAC5B,YAAA,EAAc,SAAS,KAAA,CAAM,aAAA;AAAA,QAC7B,WAAA,EAAa,SAAS,KAAA,CAAM;AAAA,OAC9B,GAAI;AAAA,KACN;AAAA,EACF;AAAA,EAEA,MAAc,cAAA,CAAe,KAAA,EAAe,MAAA,EAAoD;AAE9F,IAAA,IAAI,OAAO,IAAA,KAAS,UAAA,IAAc,IAAA,CAAK,WAAA,CAAY,gBAAe,EAAG;AACnE,MAAA,OAAO,IAAA,CAAK,WAAA,CAAY,MAAA,CAAO,QAAQ,CAAA;AAAA,IACzC;AAGA,IAAA,IAAI,MAAA,CAAO,SAAS,WAAA,EAAa;AAC/B,MAAA,OAAO,IAAA,CAAK,mBAAA,CAAoB,KAAA,EAAO,MAAM,CAAA;AAAA,IAC/C;AAEA,IAAA,IAAI,MAAA,CAAO,IAAA,KAAS,aAAA,IAAiB,MAAA,CAAO,YAAA,EAAc;AACxD,MAAA,OAAO,IAAA,CAAK,UAAA,CAAW,MAAA,CAAO,YAAY,CAAA;AAAA,IAC5C;AAGA,IAAA,IAAI,CAAC,IAAA,CAAK,WAAA,CAAY,cAAA,EAAe,EAAG;AACtC,MAAA,OAAO,IAAA,CAAK,WAAW,KAAK,CAAA;AAAA,IAC9B,CAAA,MAAO;AAEL,MAAA,OAAO,IAAA,CAAK,WAAW,KAAK,CAAA;AAAA,IAC9B;AAAA,EACF;AAAA,EAEA,MAAc,eAAA,CAAgB,KAAA,EAAe,MAAA,EAAoD;AAE/F,IAAA,IAAI,MAAA,CAAO,SAAS,WAAA,EAAa;AAC/B,MAAA,IAAA,CAAK,WAAA,CAAY,eAAe,gBAAgB,CAAA;AAChD,MAAA,OAAO;AAAA,QACL,IAAA,EAAM,8CAAA;AAAA,QACN,IAAA,EAAM,WAAA;AAAA,QACN,YAAA,EAAc,KAAK,eAAA,EAAgB;AAAA,QACnC,eAAA,EAAiB,IAAA;AAAA,QACjB,cAAA,EAAgB;AAAA,OAClB;AAAA,IACF;AAGA,IAAA,IAAI,MAAA,CAAO,SAAS,cAAA,EAAgB;AAClC,MAAA,OAAO,KAAK,cAAA,EAAe;AAAA,IAC7B;AAGA,IAAA,IAAI,MAAA,CAAO,IAAA,KAAS,aAAA,IAAiB,MAAA,CAAO,YAAA,EAAc;AAExD,MAAA,IAAA,CAAK,WAAA,CAAY,eAAe,mBAAmB,CAAA;AACnD,MAAA,MAAM,YAAA,GAAe,MAAM,IAAA,CAAK,UAAA,CAAW,OAAO,YAAY,CAAA;AAC9D,MAAA,IAAA,CAAK,YAAY,eAAA,EAAgB;AACjC,MAAA,OAAO,YAAA;AAAA,IACT;AAGA,IAAA,IAAI,MAAA,CAAO,SAAS,UAAA,EAAY;AAE9B,MAAA,IAAI,IAAA,CAAK,cAAc,MAAA,EAAQ;AAC7B,QAAA,MAAM,IAAA,CAAK,cAAc,MAAA,CAAO,KAAA;AAAA,UAC9B,CAAA,cAAA,EAAiB,IAAA,CAAK,GAAA,EAAK,CAAA,CAAA;AAAA,UAC3B,gCAAA;AAAA,UACA,KAAA;AAAA,UACA,EAAE,OAAO,YAAA;AAAa,SACxB;AAAA,MACF;AACA,MAAA,OAAO;AAAA,QACL,IAAA,EAAM,8CAAA;AAAA,QACN,IAAA,EAAM,WAAA;AAAA,QACN,YAAA,EAAc,KAAK,eAAA;AAAgB,OACrC;AAAA,IACF;AAGA,IAAA,IAAI,IAAA,CAAK,WAAA,CAAY,QAAA,EAAS,EAAG;AAC/B,MAAA,IAAA,CAAK,YAAY,eAAA,EAAgB;AAEjC,MAAA,OAAO,KAAK,iBAAA,EAAkB;AAAA,IAChC;AAGA,IAAA,MAAM,QAAA,GAAW,MAAM,IAAA,CAAK,KAAA,CAAM,IAAI,KAAK,CAAA;AAC3C,IAAA,OAAO;AAAA,MACL,IAAA,EAAM,SAAS,WAAA,IAAe,EAAA;AAAA,MAC9B,IAAA,EAAM,WAAA;AAAA,MACN,YAAA,EAAc,KAAK,eAAA;AAAgB,KACrC;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAMA,OAAe,iBAAA,CAAkB,KAAA,EAAe,MAAA,EAA+D;AAE7G,IAAA,MAAM,IAAA,CAAK,wBAAA,CAAyB,MAAA,EAAQ,KAAK,CAAA;AAGjD,IAAA,IAAI,IAAA,CAAK,sBAAA,CAAuB,MAAM,CAAA,EAAG;AACvC,MAAA,MAAM,IAAA,GAAO,IAAA,CAAK,WAAA,CAAY,OAAA,EAAQ;AACtC,MAAA,IAAA,CAAK,WAAA,CAAY,cAAc,uBAAuB,CAAA;AACtD,MAAA,MAAM,EAAE,IAAA,EAAM,cAAA,EAAgB,MAAM,EAAA,EAAI,UAAA,EAAY,QAAQ,uBAAA,EAAwB;AACpF,MAAA,OAAO,IAAA,CAAK,cAAA,CAAe,KAAA,EAAO,MAAM,CAAA;AACxC,MAAA;AAAA,IACF;AAGA,IAAA,MAAM,eAAA,GAAkB,MAAM,IAAA,CAAK,gBAAA,CAAiB,KAAK,CAAA;AAGzD,IAAA,IAAI,QAAA,GAAW,EAAA;AACf,IAAA,IAAI,gBAAA,GAAgE,IAAA;AACpE,IAAA,IAAI,eAAA,GAAkB,EAAA;AAEtB,IAAA,WAAA,MAAiB,KAAA,IAAS,IAAA,CAAK,KAAA,CAAM,MAAA,CAAO,eAAe,CAAA,EAAG;AAC5D,MAAA,IAAI,MAAM,IAAA,KAAA,4BAAA,0BAA4C;AACpD,QAAA,MAAM,KAAA,GAAS,MAAc,KAAA,IAAS,EAAA;AACtC,QAAA,QAAA,IAAY,KAAA;AACZ,QAAA,MAAM,EAAE,IAAA,EAAM,YAAA,EAAc,KAAA,EAAM;AAAA,MACpC,CAAA,MAAA,IAAW,MAAM,IAAA,KAAA,+BAAA,6BAA+C;AAC9D,QAAA,eAAA,GAAmB,MAAc,SAAA,IAAa,SAAA;AAC9C,QAAA,MAAM,IAAA,GAAQ,MAAc,SAAA,IAAa,IAAA;AACzC,QAAA,MAAM,EAAE,IAAA,EAAM,YAAA,EAAc,IAAA,EAAM,iBAAiB,IAAA,EAAK;AAGxD,QAAA,IAAI,eAAA,KAAoB,eAAA,CAAgB,cAAA,IAAkB,IAAA,EAAM;AAC9D,UAAA,gBAAA,GAAmB,OAAO,IAAA,KAAS,QAAA,GAAW,IAAA,CAAK,KAAA,CAAM,IAAI,CAAA,GAAI,IAAA;AAAA,QACnE;AAAA,MACF,CAAA,MAAA,IAAW,MAAM,IAAA,KAAA,8BAAA,4BAA8C;AAC7D,QAAA,MAAM,EAAE,IAAA,EAAM,eAAA,EAAiB,IAAA,EAAO,KAAA,CAAc,SAAA,IAAa,SAAA,EAAW,MAAA,EAAS,KAAA,CAAc,MAAA,EAAQ,UAAA,EAAa,KAAA,CAAc,qBAAqB,CAAA,EAAE;AAAA,MAC/J;AAAA,IACF;AAGA,IAAA,IAAI,gBAAA,EAAkB;AACpB,MAAA,IAAA,CAAK,WAAA,CAAY,cAAc,iBAAiB,CAAA;AAChD,MAAA,MAAM,EAAE,MAAM,cAAA,EAAgB,IAAA,EAAM,eAAe,EAAA,EAAI,UAAA,EAAY,QAAQ,iBAAA,EAAkB;AAG7F,MAAA,MAAM,IAAA,GAAO,MAAM,IAAA,CAAK,kBAAA,CAAmB,iBAAiB,IAAI,CAAA;AAChE,MAAA,IAAA,CAAK,WAAA,CAAY,eAAe,IAAI,CAAA;AACpC,MAAA,IAAA,CAAK,WAAA,GAAc,IAAA;AAEnB,MAAA,MAAM,EAAE,IAAA,EAAM,cAAA,EAAgB,IAAA,EAAK;AAEnC,MAAA,IAAI,IAAA,CAAK,OAAA,CAAQ,QAAA,EAAU,eAAA,KAAoB,KAAA,EAAO;AACpD,QAAA,MAAM,EAAE,IAAA,EAAM,wBAAA,EAA0B,IAAA,EAAK;AAC7C,QAAA,MAAM,EAAE,IAAA,EAAM,gBAAA,EAAkB,IAAA,EAAK;AAErC,QAAA,MAAM,OAAA,GAAU,IAAA,CAAK,iBAAA,CAAkB,IAAI,CAAA;AAC3C,QAAA,MAAM,IAAA,CAAK,wBAAA,CAAyB,WAAA,EAAa,OAAO,CAAA;AAGxD,QAAA,MAAM,EAAE,IAAA,EAAM,YAAA,EAAc,KAAA,EAAO,SAAS,OAAA,EAAQ;AACpD,QAAA,MAAM,EAAE,IAAA,EAAM,WAAA,EAAa,IAAA,EAAM,QAAA,GAAW,SAAS,OAAA,EAAQ;AAAA,MAC/D;AACA,MAAA;AAAA,IACF;AAGA,IAAA,MAAM,IAAA,CAAK,wBAAA,CAAyB,WAAA,EAAa,QAAQ,CAAA;AAEzD,IAAA,MAAM,EAAE,IAAA,EAAM,WAAA,EAAa,IAAA,EAAM,QAAA,EAAS;AAAA,EAC5C;AAAA,EAEA,OAAe,cAAA,CAAe,KAAA,EAAe,MAAA,EAA+D;AAE1G,IAAA,IAAI,MAAA,CAAO,SAAS,UAAA,EAAY;AAC9B,MAAA,MAAM,IAAA,CAAK,wBAAA,CAAyB,MAAA,EAAQ,KAAK,CAAA;AAAA,IACnD;AAEA,IAAA,IAAI,OAAO,IAAA,KAAS,UAAA,IAAc,IAAA,CAAK,WAAA,CAAY,gBAAe,EAAG;AACnE,MAAA,MAAM2C,KAAAA,GAAO,IAAA,CAAK,WAAA,CAAY,cAAA,EAAe;AAC7C,MAAA,IAAA,CAAK,YAAY,WAAA,EAAY;AAC7B,MAAA,MAAM,EAAE,IAAA,EAAM,eAAA,EAAiB,IAAA,EAAAA,KAAAA,EAAK;AAGpC,MAAA,MAAM,KAAK,wBAAA,CAAyB,WAAA,EAAa,wCAAwCA,KAAAA,CAAK,KAAA,CAAM,MAAM,CAAA,OAAA,CAAS,CAAA;AAGnH,MAAA,IAAA,CAAK,WAAA,CAAY,cAAA,CAAeA,KAAAA,EAAM,eAAe,CAAA;AACrD,MAAA,MAAM,EAAE,MAAM,cAAA,EAAgB,IAAA,EAAM,YAAY,EAAA,EAAI,WAAA,EAAa,QAAQ,eAAA,EAAgB;AAEzF,MAAA,OAAO,KAAK,eAAA,EAAgB;AAC5B,MAAA;AAAA,IACF;AAGA,IAAA,MAAM,EAAE,IAAA,EAAM,gBAAA,EAAkB,IAAA,EAAM,KAAA,EAAM;AAE5C,IAAA,MAAM,IAAA,GAAO,MAAM,IAAA,CAAK,kBAAA,CAAmB,KAAK,CAAA;AAChD,IAAA,IAAA,CAAK,WAAA,CAAY,eAAe,IAAI,CAAA;AACpC,IAAA,IAAA,CAAK,WAAA,GAAc,IAAA;AAEnB,IAAA,MAAM,EAAE,IAAA,EAAM,cAAA,EAAgB,IAAA,EAAK;AAEnC,IAAA,IAAI,IAAA,CAAK,OAAA,CAAQ,QAAA,EAAU,eAAA,KAAoB,KAAA,EAAO;AACpD,MAAA,MAAM,EAAE,IAAA,EAAM,wBAAA,EAA0B,IAAA,EAAK;AAC7C,MAAA,MAAM,EAAE,IAAA,EAAM,gBAAA,EAAkB,IAAA,EAAK;AAErC,MAAA,MAAM,OAAA,GAAU,IAAA,CAAK,iBAAA,CAAkB,IAAI,CAAA;AAG3C,MAAA,MAAM,IAAA,CAAK,wBAAA,CAAyB,WAAA,EAAa,OAAO,CAAA;AAExD,MAAA,MAAM,EAAE,IAAA,EAAM,YAAA,EAAc,KAAA,EAAO,OAAA,EAAQ;AAC3C,MAAA,MAAM,EAAE,IAAA,EAAM,WAAA,EAAa,IAAA,EAAM,OAAA,EAAQ;AAAA,IAC3C;AAAA,EACF;AAAA,EAEA,OAAe,gBAAgB,MAAA,EAA+D;AAC5F,IAAA,IAAI,MAAA,CAAO,SAAS,cAAA,EAAgB;AAClC,MAAA,MAAM,QAAA,GAAW,KAAK,eAAA,EAAgB;AACtC,MAAA,MAAM,IAAA,GAAO,IAAA,CAAK,cAAA,CAAe,QAAQ,CAAA;AACzC,MAAA,MAAM,EAAE,IAAA,EAAM,YAAA,EAAc,KAAA,EAAO,IAAA,EAAK;AACxC,MAAA,MAAM,EAAE,IAAA,EAAM,WAAA,EAAa,IAAA,EAAK;AAChC,MAAA;AAAA,IACF;AAEA,IAAA,OAAO,KAAK,eAAA,EAAgB;AAAA,EAC9B;AAAA,EAEA,OAAe,eAAA,GAAyD;AACtE,IAAA,IAAI,CAAC,KAAK,WAAA,EAAa;AACrB,MAAA,MAAM,EAAE,IAAA,EAAM,OAAA,EAAS,KAAA,EAAO,oBAAA,EAAsB,aAAa,KAAA,EAAM;AACvE,MAAA;AAAA,IACF;AAGA,IAAA,IAAI,CAAC,KAAK,cAAA,EAAgB;AACxB,MAAA,IAAA,CAAK,cAAA,GAAiB,KAAK,oBAAA,EAAqB;AAAA,IAClD;AAEA,IAAA,MAAM,KAAA,GAAQ,KAAK,WAAA,CAAY,KAAA;AAC/B,IAAA,IAAI,cAAA,GAAiB,CAAA;AACrB,IAAA,IAAI,WAAA,GAAc,CAAA;AAElB,IAAA,KAAA,IAAS,CAAA,GAAI,CAAA,EAAG,CAAA,GAAI,KAAA,CAAM,QAAQ,CAAA,EAAA,EAAK;AACrC,MAAA,MAAM,IAAA,GAAO,MAAM,CAAC,CAAA;AACpB,MAAA,IAAI,CAAC,IAAA,EAAM;AAGX,MAAA,IAAI,IAAA,CAAK,WAAA,CAAY,QAAA,EAAS,EAAG;AAC/B,QAAA,MAAM,EAAE,MAAM,kBAAA,EAAoB,MAAA,EAAQ,KAAK,WAAA,CAAY,cAAA,MAAoB,SAAA,EAAU;AACzF,QAAA;AAAA,MACF;AAGA,MAAA,IAAI,IAAA,CAAK,WAAW,WAAA,IAAe,IAAA,CAAK,WAAW,QAAA,IAAY,IAAA,CAAK,WAAW,SAAA,EAAW;AACxF,QAAA,IAAI,IAAA,CAAK,WAAW,WAAA,EAAa,cAAA,EAAA;AACjC,QAAA,IAAI,IAAA,CAAK,WAAW,QAAA,EAAU,WAAA,EAAA;AAC9B,QAAA;AAAA,MACF;AAGA,MAAA,IAAA,CAAK,MAAA,GAAS,aAAA;AACd,MAAA,IAAA,CAAK,SAAA,GAAY,KAAK,GAAA,EAAI;AAC1B,MAAA,IAAA,CAAK,QAAA,GAAA,CAAY,IAAA,CAAK,QAAA,IAAY,CAAA,IAAK,CAAA;AACvC,MAAA,IAAA,CAAK,WAAA,CAAY,oBAAoB,CAAC,CAAA;AAEtC,MAAA,MAAM,EAAE,IAAA,EAAM,cAAA,EAAgB,IAAA,EAAK;AAEnC,MAAA,IAAI;AAEF,QAAA,MAAM,MAAA,GAAS,IAAA,CAAK,0BAAA,CAA2B,IAAA,EAAM,CAAC,CAAA;AACtD,QAAA,IAAI,cAAA,GAAiB,EAAA;AAGrB,QAAA,WAAA,MAAiB,KAAA,IAAS,IAAA,CAAK,cAAA,CAAe,MAAA,CAAO,MAAM,CAAA,EAAG;AAC5D,UAAA,IAAI,MAAM,IAAA,KAAA,4BAAA,0BAA4C;AACpD,YAAA,MAAM,KAAA,GAAS,MAAc,KAAA,IAAS,EAAA;AACtC,YAAA,cAAA,IAAkB,KAAA;AAClB,YAAA,MAAM,EAAE,IAAA,EAAM,eAAA,EAAiB,IAAA,EAAM,QAAQ,KAAA,EAAM;AAAA,UACrD,CAAA,MAAA,IAAW,MAAM,IAAA,KAAA,+BAAA,6BAA+C;AAC9D,YAAA,MAAM,EAAE,IAAA,EAAM,YAAA,EAAc,IAAA,EAAO,KAAA,CAAc,aAAa,SAAA,EAAW,IAAA,EAAO,KAAA,CAAc,SAAA,IAAa,IAAA,EAAK;AAAA,UAClH,CAAA,MAAA,IAAW,MAAM,IAAA,KAAA,8BAAA,4BAA8C;AAC7D,YAAA,MAAM,EAAE,IAAA,EAAM,eAAA,EAAiB,IAAA,EAAO,KAAA,CAAc,SAAA,IAAa,SAAA,EAAW,MAAA,EAAS,KAAA,CAAc,MAAA,EAAQ,UAAA,EAAa,KAAA,CAAc,qBAAqB,CAAA,EAAE;AAAA,UAC/J;AAAA,QACF;AAGA,QAAA,IAAA,CAAK,MAAA,GAAS,WAAA;AACd,QAAA,IAAA,CAAK,WAAA,GAAc,KAAK,GAAA,EAAI;AAC5B,QAAA,IAAA,CAAK,MAAA,GAAS,EAAE,OAAA,EAAS,IAAA,EAAM,QAAQ,cAAA,EAAe;AACtD,QAAA,cAAA,EAAA;AAGA,QAAA,MAAM,KAAK,wBAAA,CAAyB,WAAA,EAAa,mBAAmB,IAAA,CAAK,IAAI,MAAM,cAAA,CAAe,SAAA,CAAU,CAAA,EAAG,GAAG,CAAC,CAAA,EAAG,cAAA,CAAe,SAAS,GAAA,GAAM,KAAA,GAAQ,EAAE,CAAA,CAAE,CAAA;AAEhK,QAAA,MAAM,EAAE,IAAA,EAAM,gBAAA,EAAkB,IAAA,EAAM,QAAQ,cAAA,EAAe;AAAA,MAE/D,SAAS,KAAA,EAAO;AACd,QAAA,IAAA,CAAK,MAAA,GAAS,QAAA;AACd,QAAA,MAAM,WAAW,KAAA,YAAiB,KAAA,GAAQ,KAAA,CAAM,OAAA,GAAU,OAAO,KAAK,CAAA;AACtE,QAAA,IAAA,CAAK,MAAA,GAAS,EAAE,OAAA,EAAS,KAAA,EAAO,OAAO,QAAA,EAAS;AAChD,QAAA,WAAA,EAAA;AAGA,QAAA,MAAM,IAAA,CAAK,yBAAyB,WAAA,EAAa,CAAA,MAAA,EAAS,KAAK,IAAI,CAAA,UAAA,EAAa,QAAQ,CAAA,CAAE,CAAA;AAE1F,QAAA,MAAM,EAAE,IAAA,EAAM,aAAA,EAAe,IAAA,EAAM,OAAO,QAAA,EAAS;AAAA,MACrD;AAAA,IACF;AAGA,IAAA,MAAM,MAAA,GAA0B;AAAA,MAC9B,MAAA,EAAQ,WAAA,KAAgB,CAAA,GAAI,WAAA,GAAc,QAAA;AAAA,MAC1C,cAAA;AAAA,MACA,YAAY,KAAA,CAAM,MAAA;AAAA,MAClB,WAAA;AAAA,MACA,cAAc,KAAA,CAAM,MAAA,CAAO,OAAK,CAAA,CAAE,MAAA,KAAW,SAAS,CAAA,CAAE;AAAA,KAC1D;AAGA,IAAA,MAAM,aAAA,GAAgB,IAAA,CAAK,wBAAA,CAAyB,KAAK,CAAA;AAGzD,IAAA,MAAM,EAAE,IAAA,EAAM,YAAA,EAAc,KAAA,EAAO,OAAO,aAAA,EAAc;AACxD,IAAA,MAAM,EAAE,IAAA,EAAM,WAAA,EAAa,IAAA,EAAM,aAAA,EAAc;AAG/C,IAAA,MAAM,IAAA,CAAK,wBAAA,CAAyB,WAAA,EAAa,aAAa,CAAA;AAE9D,IAAA,MAAM,EAAE,IAAA,EAAM,gBAAA,EAAkB,MAAA,EAAO;AAGvC,IAAA,IAAA,CAAK,WAAA,CAAY,oBAAoB,qBAAqB,CAAA;AAC1D,IAAA,MAAM,EAAE,MAAM,cAAA,EAAgB,IAAA,EAAM,aAAa,EAAA,EAAI,aAAA,EAAe,QAAQ,qBAAA,EAAsB;AAElG,IAAA,IAAA,CAAK,IAAA,CAAK,qBAAA,EAAuB,EAAE,MAAA,EAAQ,CAAA;AAAA,EAC7C;AAAA;AAAA;AAAA;AAAA;AAAA,EAMQ,yBAAyB,KAAA,EAAuB;AAEtD,IAAA,MAAM,cAAA,GAAiB,MAAM,MAAA,CAAO,CAAA,CAAA,KAAK,EAAE,MAAA,KAAW,WAAA,IAAe,CAAA,CAAE,MAAA,EAAQ,MAAM,CAAA;AAErF,IAAA,IAAI,cAAA,CAAe,SAAS,CAAA,EAAG;AAE7B,MAAA,MAAM,QAAA,GAAW,cAAA,CAAe,cAAA,CAAe,MAAA,GAAS,CAAC,CAAA;AACzD,MAAA,IAAI,QAAA,IAAY,QAAA,CAAS,MAAA,EAAQ,MAAA,EAAQ;AAEvC,QAAA,MAAM,MAAA,GAAS,SAAS,MAAA,CAAO,MAAA;AAC/B,QAAA,OAAO,OAAO,WAAW,QAAA,GAAW,MAAA,GAAS,KAAK,SAAA,CAAU,MAAA,EAAQ,MAAM,CAAC,CAAA;AAAA,MAC7E;AAAA,IACF;AAGA,IAAA,MAAM,cAAc,KAAA,CAAM,MAAA,CAAO,CAAA,CAAA,KAAK,CAAA,CAAE,WAAW,QAAQ,CAAA;AAC3D,IAAA,IAAI,WAAA,CAAY,SAAS,CAAA,EAAG;AAC1B,MAAA,MAAM,MAAA,GAAS,WAAA,CAAY,GAAA,CAAI,CAAA,CAAA,KAAK,KAAK,CAAA,CAAE,IAAI,CAAA,EAAA,EAAK,CAAA,CAAE,QAAQ,KAAA,IAAS,eAAe,CAAA,CAAE,CAAA,CAAE,KAAK,IAAI,CAAA;AACnG,MAAA,OAAO,CAAA;AAAA,EAAuC,MAAM,CAAA,CAAA;AAAA,IACtD;AAGA,IAAA,OAAO,uDAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAMA,MAAc,UAAA,CAAW,IAAA,EAAc,UAAA,EAAiD;AACtF,IAAA,MAAM,IAAA,GAAO,MAAM,IAAA,CAAK,kBAAA,CAAmB,IAAI,CAAA;AAE/C,IAAA,IAAA,CAAK,WAAA,CAAY,eAAe,IAAI,CAAA;AACpC,IAAA,IAAA,CAAK,WAAA,GAAc,IAAA;AAEnB,IAAA,IAAA,CAAK,IAAA,CAAK,cAAA,EAAgB,EAAE,IAAA,EAAM,CAAA;AAElC,IAAA,MAAM,OAAA,GAAU,IAAA,CAAK,iBAAA,CAAkB,IAAI,CAAA;AAC3C,IAAA,MAAM,eAAA,GAAkB,IAAA,CAAK,OAAA,CAAQ,QAAA,EAAU,eAAA,KAAoB,KAAA;AAEnE,IAAA,OAAO;AAAA,MACL,IAAA,EAAM,OAAA;AAAA,MACN,IAAA,EAAM,UAAA;AAAA,MACN,IAAA;AAAA,MACA,UAAA,EAAY,kBAAkB,kBAAA,GAAqB,UAAA;AAAA,MACnD,eAAA,EAAiB,eAAA;AAAA,MACjB,cAAA,EAAgB,kBAAkB,cAAA,GAAiB;AAAA,KACrD;AAAA,EACF;AAAA,EAEA,MAAc,mBAAmB,IAAA,EAA6B;AAC5D,IAAA,IAAI,KAAK,aAAA,EAAe;AACtB,MAAA,MAAM,SAAS,MAAM,IAAA,CAAK,cAAc,YAAA,CAAa,EAAE,MAAM,CAAA;AAC7D,MAAA,OAAO,WAAW,EAAE,IAAA,EAAM,OAAO,MAAA,CAAO,IAAA,CAAK,OAAsB,CAAA;AAAA,IACrE;AAGA,IAAA,OAAO,UAAA,CAAW;AAAA,MAChB,IAAA;AAAA,MACA,OAAO,CAAC,EAAE,MAAM,SAAA,EAAW,WAAA,EAAa,MAAM;AAAA,KAC/C,CAAA;AAAA,EACH;AAAA,EAEA,MAAc,YAAY,SAAA,EAAgD;AACxE,IAAA,MAAM,IAAA,GAAO,IAAA,CAAK,WAAA,CAAY,cAAA,EAAe;AAC7C,IAAA,IAAI,CAAC,IAAA,EAAM;AACT,MAAA,OAAO;AAAA,QACL,IAAA,EAAM,qBAAA;AAAA,QACN,IAAA,EAAM,IAAA,CAAK,WAAA,CAAY,OAAA;AAAQ,OACjC;AAAA,IACF;AAEA,IAAA,IAAA,CAAK,YAAY,WAAA,EAAY;AAC7B,IAAA,IAAA,CAAK,WAAA,CAAY,cAAA,CAAe,IAAA,EAAM,eAAe,CAAA;AACrD,IAAA,IAAA,CAAK,WAAA,GAAc,IAAA;AAEnB,IAAA,IAAA,CAAK,IAAA,CAAK,eAAA,EAAiB,EAAE,IAAA,EAAM,CAAA;AAGnC,IAAA,OAAO,KAAK,iBAAA,EAAkB;AAAA,EAChC;AAAA,EAEA,MAAc,mBAAA,CAAoB,MAAA,EAAgB,MAAA,EAAoD;AACpG,IAAA,IAAI,OAAO,QAAA,EAAU;AACnB,MAAA,OAAO,IAAA,CAAK,UAAA,CAAW,MAAA,CAAO,QAAQ,CAAA;AAAA,IACxC;AAEA,IAAA,OAAO;AAAA,MACL,IAAA,EAAM,+EAAA;AAAA,MACN,IAAA,EAAM,UAAA;AAAA,MACN,IAAA,EAAM,IAAA,CAAK,WAAA,CAAY,cAAA,EAAe;AAAA,MACtC,eAAA,EAAiB,IAAA;AAAA,MACjB,cAAA,EAAgB;AAAA,KAClB;AAAA,EACF;AAAA,EAEA,MAAc,WAAW,QAAA,EAA8C;AACrE,IAAA,MAAM,WAAA,GAAc,IAAA,CAAK,WAAA,CAAY,cAAA,EAAe;AACpD,IAAA,IAAI,CAAC,WAAA,IAAe,CAAC,IAAA,CAAK,aAAA,EAAe;AACvC,MAAA,OAAO,IAAA,CAAK,WAAW,QAAQ,CAAA;AAAA,IACjC;AAEA,IAAA,MAAM,UAAU,MAAM,IAAA,CAAK,aAAA,CAAc,UAAA,CAAW,aAAa,QAAQ,CAAA;AACzE,IAAA,IAAA,CAAK,WAAA,CAAY,cAAA,CAAe,OAAA,CAAQ,IAAI,CAAA;AAC5C,IAAA,IAAA,CAAK,cAAc,OAAA,CAAQ,IAAA;AAE3B,IAAA,IAAA,CAAK,IAAA,CAAK,iBAAiB,EAAE,IAAA,EAAM,QAAQ,IAAA,EAAM,OAAA,EAAS,EAAC,EAAG,CAAA;AAE9D,IAAA,OAAO;AAAA,MACL,IAAA,EAAM,IAAA,CAAK,iBAAA,CAAkB,OAAA,CAAQ,IAAI,CAAA;AAAA,MACzC,IAAA,EAAM,UAAA;AAAA,MACN,MAAM,OAAA,CAAQ,IAAA;AAAA,MACd,UAAA,EAAY,kBAAA;AAAA,MACZ,eAAA,EAAiB,IAAA;AAAA,MACjB,cAAA,EAAgB;AAAA,KAClB;AAAA,EACF;AAAA,EAEA,MAAc,WAAW,YAAA,EAA0E;AACjG,IAAA,IAAI,CAAC,YAAA,IAAgB,CAAC,IAAA,CAAK,WAAA,EAAa;AACtC,MAAA,OAAO;AAAA,QACL,IAAA,EAAM,2BAAA;AAAA,QACN,IAAA,EAAM,IAAA,CAAK,WAAA,CAAY,OAAA;AAAQ,OACjC;AAAA,IACF;AAEA,IAAA,MAAM,UAAwB,EAAC;AAE/B,IAAA,QAAQ,aAAa,MAAA;AAAQ,MAC3B,KAAK,UAAA,EAAY;AACf,QAAA,MAAM,UAAU,UAAA,CAAW;AAAA,UACzB,MAAM,CAAA,KAAA,EAAQ,IAAA,CAAK,WAAA,CAAY,KAAA,CAAM,SAAS,CAAC,CAAA,CAAA;AAAA,UAC/C,WAAA,EAAa,aAAa,OAAA,IAAW;AAAA,SACtC,CAAA;AACD,QAAA,IAAA,CAAK,WAAA,CAAY,KAAA,CAAM,IAAA,CAAK,OAAO,CAAA;AACnC,QAAA,OAAA,CAAQ,IAAA,CAAK,EAAE,IAAA,EAAM,YAAA,EAAc,MAAA,EAAQ,OAAA,CAAQ,EAAA,EAAI,QAAA,EAAU,OAAA,CAAQ,IAAA,EAAM,OAAA,EAAS,YAAA,CAAa,SAAS,CAAA;AAC9G,QAAA;AAAA,MACF;AAAA,MAEA,KAAK,aAAA,EAAe;AAClB,QAAA,MAAM,GAAA,GAAM,KAAK,WAAA,CAAY,KAAA,CAAM,UAAU,CAAA,CAAA,KAAK,CAAA,CAAE,IAAA,KAAS,YAAA,CAAa,QAAQ,CAAA;AAClF,QAAA,IAAI,OAAO,CAAA,EAAG;AACZ,UAAA,IAAA,CAAK,WAAA,CAAY,KAAA,CAAM,MAAA,CAAO,GAAA,EAAK,CAAC,CAAA;AACpC,UAAA,OAAA,CAAQ,KAAK,EAAE,IAAA,EAAM,gBAAgB,QAAA,EAAU,YAAA,CAAa,UAAU,CAAA;AAAA,QACxE;AACA,QAAA;AAAA,MACF;AAAA,MAEA,KAAK,WAAA,EAAa;AAChB,QAAA,MAAM,IAAA,GAAO,KAAK,WAAA,CAAY,KAAA,CAAM,KAAK,CAAA,CAAA,KAAK,CAAA,CAAE,IAAA,KAAS,YAAA,CAAa,QAAQ,CAAA;AAC9E,QAAA,IAAI,IAAA,EAAM;AACR,UAAA,IAAA,CAAK,MAAA,GAAS,SAAA;AACd,UAAA,OAAA,CAAQ,IAAA,CAAK,EAAE,IAAA,EAAM,cAAA,EAAgB,MAAA,EAAQ,IAAA,CAAK,EAAA,EAAI,QAAA,EAAU,IAAA,CAAK,IAAA,EAAM,OAAA,EAAS,mBAAA,EAAqB,CAAA;AAAA,QAC3G;AACA,QAAA;AAAA,MACF;AAAA,MAEA,KAAK,aAAA,EAAe;AAClB,QAAA,MAAM,IAAA,GAAO,KAAK,WAAA,CAAY,KAAA,CAAM,KAAK,CAAA,CAAA,KAAK,CAAA,CAAE,IAAA,KAAS,YAAA,CAAa,QAAQ,CAAA;AAC9E,QAAA,IAAI,IAAA,IAAQ,aAAa,OAAA,EAAS;AAChC,UAAA,IAAA,CAAK,cAAc,YAAA,CAAa,OAAA;AAChC,UAAA,OAAA,CAAQ,IAAA,CAAK,EAAE,IAAA,EAAM,cAAA,EAAgB,MAAA,EAAQ,IAAA,CAAK,EAAA,EAAI,QAAA,EAAU,IAAA,CAAK,IAAA,EAAM,OAAA,EAAS,YAAA,CAAa,SAAS,CAAA;AAAA,QAC5G;AACA,QAAA;AAAA,MACF;AAAA;AAGF,IAAA,IAAA,CAAK,WAAA,CAAY,aAAA,GAAgB,IAAA,CAAK,GAAA,EAAI;AAE1C,IAAA,IAAA,CAAK,KAAK,eAAA,EAAiB,EAAE,MAAM,IAAA,CAAK,WAAA,EAAa,SAAS,CAAA;AAE9D,IAAA,OAAO;AAAA,MACL,IAAA,EAAM,CAAA,cAAA,EAAiB,OAAA,CAAQ,GAAA,CAAI,CAAA,CAAA,KAAK,CAAA,CAAE,OAAA,IAAW,CAAA,CAAE,IAAI,CAAA,CAAE,IAAA,CAAK,IAAI,CAAC,CAAA,CAAA;AAAA,MACvE,IAAA,EAAM,IAAA,CAAK,WAAA,CAAY,OAAA,EAAQ;AAAA,MAC/B,MAAM,IAAA,CAAK;AAAA,KACb;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAMA,MAAc,iBAAA,GAAgD;AAC5D,IAAA,IAAI,CAAC,KAAK,WAAA,EAAa;AACrB,MAAA,OAAO;AAAA,QACL,IAAA,EAAM,qBAAA;AAAA,QACN,IAAA,EAAM;AAAA,OACR;AAAA,IACF;AAEA,IAAA,MAAM,KAAA,GAAQ,KAAK,WAAA,CAAY,KAAA;AAC/B,IAAA,MAAM,YAAA,GAAe,MAAM,MAAA,CAAO,CAAA,CAAA,KAAK,EAAE,MAAA,KAAW,SAAA,IAAa,CAAA,CAAE,MAAA,KAAW,aAAa,CAAA;AAE3F,IAAA,IAAI,YAAA,CAAa,WAAW,CAAA,EAAG;AAC7B,MAAA,IAAA,CAAK,WAAA,CAAY,oBAAoB,qBAAqB,CAAA;AAC1D,MAAA,OAAO;AAAA,QACL,IAAA,EAAM,sBAAA;AAAA,QACN,IAAA,EAAM,aAAA;AAAA,QACN,YAAA,EAAc,KAAK,eAAA;AAAgB,OACrC;AAAA,IACF;AAGA,IAAA,MAAM,QAAA,GAAW,aAAa,CAAC,CAAA;AAC/B,IAAA,IAAI,CAAC,QAAA,EAAU;AACb,MAAA,MAAM,IAAI,MAAM,uBAAuB,CAAA;AAAA,IACzC;AAEA,IAAA,QAAA,CAAS,MAAA,GAAS,aAAA;AAClB,IAAA,QAAA,CAAS,SAAA,GAAY,KAAK,GAAA,EAAI;AAC9B,IAAA,QAAA,CAAS,QAAA,GAAA,CAAY,QAAA,CAAS,QAAA,IAAY,CAAA,IAAK,CAAA;AAE/C,IAAA,IAAA,CAAK,IAAA,CAAK,cAAA,EAAgB,EAAE,IAAA,EAAM,UAAU,CAAA;AAE5C,IAAA,IAAI;AACF,MAAA,MAAM,MAAA,GAAS,IAAA,CAAK,eAAA,CAAgB,QAAQ,CAAA;AAC5C,MAAA,MAAM,QAAA,GAAW,MAAM,IAAA,CAAK,KAAA,CAAM,IAAI,MAAM,CAAA;AAE5C,MAAA,QAAA,CAAS,MAAA,GAAS,WAAA;AAClB,MAAA,QAAA,CAAS,WAAA,GAAc,KAAK,GAAA,EAAI;AAChC,MAAA,QAAA,CAAS,SAAS,EAAE,OAAA,EAAS,IAAA,EAAM,MAAA,EAAQ,SAAS,WAAA,EAAY;AAEhE,MAAA,IAAA,CAAK,IAAA,CAAK,kBAAkB,EAAE,IAAA,EAAM,UAAU,MAAA,EAAQ,QAAA,CAAS,aAAa,CAAA;AAG5E,MAAA,MAAM,YAAY,KAAA,CAAM,MAAA,CAAO,CAAA,CAAA,KAAK,CAAA,CAAE,WAAW,SAAS,CAAA;AAC1D,MAAA,IAAI,SAAA,CAAU,SAAS,CAAA,EAAG;AACxB,QAAA,OAAO;AAAA,UACL,IAAA,EAAM,CAAA,WAAA,EAAc,QAAA,CAAS,IAAI;;AAAA,0BAAA,CAAA;AAAA,UACjC,IAAA,EAAM,WAAA;AAAA,UACN,YAAA,EAAc,KAAK,eAAA;AAAgB,SACrC;AAAA,MACF,CAAA,MAAO;AACL,QAAA,IAAA,CAAK,WAAA,CAAY,oBAAoB,qBAAqB,CAAA;AAC1D,QAAA,OAAO;AAAA,UACL,IAAA,EAAM,CAAA;;AAAA;AAAA,EAA+C,SAAS,WAAW,CAAA,CAAA;AAAA,UACzE,IAAA,EAAM,aAAA;AAAA,UACN,YAAA,EAAc,KAAK,eAAA;AAAgB,SACrC;AAAA,MACF;AAAA,IACF,SAAS,KAAA,EAAO;AACd,MAAA,QAAA,CAAS,MAAA,GAAS,QAAA;AAClB,MAAA,MAAM,WAAW,KAAA,YAAiB,KAAA,GAAQ,KAAA,CAAM,OAAA,GAAU,OAAO,KAAK,CAAA;AACtE,MAAA,QAAA,CAAS,MAAA,GAAS,EAAE,OAAA,EAAS,KAAA,EAAO,OAAO,QAAA,EAAS;AAEpD,MAAA,IAAA,CAAK,KAAK,aAAA,EAAe,EAAE,MAAM,QAAA,EAAU,KAAA,EAAO,UAAU,CAAA;AAE5D,MAAA,OAAO;AAAA,QACL,IAAA,EAAM,gBAAgB,QAAQ,CAAA,CAAA;AAAA,QAC9B,IAAA,EAAM,WAAA;AAAA,QACN,YAAA,EAAc,KAAK,eAAA;AAAgB,OACrC;AAAA,IACF;AAAA,EACF;AAAA,EAEQ,cAAA,GAAoC;AAC1C,IAAA,MAAM,QAAA,GAAW,KAAK,eAAA,EAAgB;AACtC,IAAA,OAAO;AAAA,MACL,IAAA,EAAM,IAAA,CAAK,cAAA,CAAe,QAAQ,CAAA;AAAA,MAClC,IAAA,EAAM,IAAA,CAAK,WAAA,CAAY,OAAA,EAAQ;AAAA,MAC/B,YAAA,EAAc;AAAA,KAChB;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAMA,MAAc,cAAc,KAAA,EAAwC;AAClE,IAAA,MAAM,UAAA,GAAa,KAAA,CAAM,WAAA,EAAY,CAAE,IAAA,EAAK;AAG5C,IAAA,IAAI,IAAA,CAAK,UAAA,CAAW,UAAU,CAAA,EAAG;AAC/B,MAAA,OAAO,EAAE,IAAA,EAAM,UAAA,EAAY,UAAA,EAAY,GAAA,EAAI;AAAA,IAC7C;AAEA,IAAA,IAAI,IAAA,CAAK,WAAA,CAAY,UAAU,CAAA,EAAG;AAChC,MAAA,OAAO,EAAE,IAAA,EAAM,WAAA,EAAa,UAAA,EAAY,GAAA,EAAK,UAAU,KAAA,EAAM;AAAA,IAC/D;AAEA,IAAA,IAAI,IAAA,CAAK,aAAA,CAAc,UAAU,CAAA,EAAG;AAClC,MAAA,OAAO,EAAE,IAAA,EAAM,cAAA,EAAgB,UAAA,EAAY,GAAA,EAAI;AAAA,IACjD;AAEA,IAAA,IAAI,IAAA,CAAK,WAAA,CAAY,UAAU,CAAA,EAAG;AAChC,MAAA,OAAO,EAAE,IAAA,EAAM,WAAA,EAAa,UAAA,EAAY,GAAA,EAAI;AAAA,IAC9C;AAEA,IAAA,IAAI,IAAA,CAAK,kBAAA,CAAmB,UAAU,CAAA,EAAG;AACvC,MAAA,OAAO;AAAA,QACL,IAAA,EAAM,aAAA;AAAA,QACN,UAAA,EAAY,GAAA;AAAA,QACZ,YAAA,EAAc,IAAA,CAAK,qBAAA,CAAsB,KAAK;AAAA,OAChD;AAAA,IACF;AAGA,IAAA,MAAM,UAAA,GAAa,IAAA,CAAK,kBAAA,CAAmB,KAAK,CAAA;AAChD,IAAA,IAAI,UAAA,KAAe,MAAA,IAAU,UAAA,KAAe,QAAA,EAAU;AACpD,MAAA,OAAO;AAAA,QACL,IAAA,EAAM,SAAA;AAAA,QACN,UAAA,EAAY,GAAA;AAAA,QACZ,UAAA;AAAA,QACA,cAAA,EAAgB,IAAA,CAAK,aAAA,CAAc,KAAK;AAAA,OAC1C;AAAA,IACF;AAEA,IAAA,OAAO,EAAE,IAAA,EAAM,QAAA,EAAU,UAAA,EAAY,GAAA,EAAI;AAAA,EAC3C;AAAA,EAEQ,WAAW,KAAA,EAAwB;AACzC,IAAA,MAAM,gBAAA,GAAmB;AAAA,MACvB,oGAAA;AAAA,MACA,6CAAA;AAAA,MACA;AAAA,KACF;AACA,IAAA,OAAO,iBAAiB,IAAA,CAAK,CAAA,CAAA,KAAK,CAAA,CAAE,IAAA,CAAK,KAAK,CAAC,CAAA;AAAA,EACjD;AAAA,EAEQ,YAAY,KAAA,EAAwB;AAC1C,IAAA,MAAM,iBAAA,GAAoB;AAAA,MACxB,gDAAA;AAAA,MACA,+CAAA;AAAA,MACA;AAAA,KACF;AACA,IAAA,OAAO,kBAAkB,IAAA,CAAK,CAAA,CAAA,KAAK,CAAA,CAAE,IAAA,CAAK,KAAK,CAAC,CAAA;AAAA,EAClD;AAAA,EAEQ,cAAc,KAAA,EAAwB;AAC5C,IAAA,MAAM,cAAA,GAAiB;AAAA,MACrB,2EAAA;AAAA,MACA,wDAAA;AAAA,MACA;AAAA,KACF;AACA,IAAA,OAAO,eAAe,IAAA,CAAK,CAAA,CAAA,KAAK,CAAA,CAAE,IAAA,CAAK,KAAK,CAAC,CAAA;AAAA,EAC/C;AAAA,EAEQ,YAAY,KAAA,EAAwB;AAC1C,IAAA,MAAM,iBAAA,GAAoB;AAAA,MACxB,sCAAA;AAAA,MACA;AAAA,KACF;AACA,IAAA,OAAO,kBAAkB,IAAA,CAAK,CAAA,CAAA,KAAK,CAAA,CAAE,IAAA,CAAK,KAAK,CAAC,CAAA;AAAA,EAClD;AAAA,EAEQ,mBAAmB,KAAA,EAAwB;AACjD,IAAA,MAAM,WAAA,GAAc;AAAA,MAClB,oDAAA;AAAA,MACA,+CAAA;AAAA,MACA,qDAAA;AAAA,MACA;AAAA,KACF;AACA,IAAA,OAAO,YAAY,IAAA,CAAK,CAAA,CAAA,KAAK,CAAA,CAAE,IAAA,CAAK,KAAK,CAAC,CAAA;AAAA,EAC5C;AAAA,EAEQ,sBAAsB,KAAA,EAA+C;AAC3E,IAAA,MAAM,UAAA,GAAa,MAAM,WAAA,EAAY;AAErC,IAAA,IAAI,2BAAA,CAA4B,IAAA,CAAK,UAAU,CAAA,EAAG;AAChD,MAAA,OAAO,EAAE,MAAA,EAAQ,UAAA,EAAY,OAAA,EAAS,KAAA,EAAM;AAAA,IAC9C;AACA,IAAA,IAAI,mBAAA,CAAoB,IAAA,CAAK,UAAU,CAAA,EAAG;AACxC,MAAA,OAAO,EAAE,MAAA,EAAQ,WAAA,EAAa,OAAA,EAAS,KAAA,EAAM;AAAA,IAC/C;AACA,IAAA,IAAI,0BAAA,CAA2B,IAAA,CAAK,UAAU,CAAA,EAAG;AAC/C,MAAA,OAAO,EAAE,MAAA,EAAQ,SAAA,EAAW,OAAA,EAAS,KAAA,EAAM;AAAA,IAC7C;AACA,IAAA,OAAO,EAAE,MAAA,EAAQ,aAAA,EAAe,OAAA,EAAS,KAAA,EAAM;AAAA,EACjD;AAAA;AAAA;AAAA;AAAA;AAAA,EAMQ,oBAAoB,KAAA,EAAwB;AAClD,IAAA,MAAM,UAAA,GAAa,MAAM,WAAA,EAAY;AAGrC,IAAA,MAAM,kBAAA,GAAqB;AAAA;AAAA,MAEzB,sFAAA;AAAA,MACA,8BAAA;AAAA,MACA,+BAAA;AAAA,MACA,8BAAA;AAAA,MACA,gCAAA;AAAA,MACA,+BAAA;AAAA,MACA,uCAAA;AAAA;AAAA,MAEA,+EAAA;AAAA,MACA,oCAAA;AAAA;AAAA,MAEA,sCAAA;AAAA,MACA,iDAAA;AAAA;AAAA,MAEA;AAAA,KACF;AAGA,IAAA,IAAI,mBAAmB,IAAA,CAAK,CAAA,CAAA,KAAK,EAAE,IAAA,CAAK,UAAU,CAAC,CAAA,EAAG;AACpD,MAAA,OAAO,IAAA;AAAA,IACT;AAKA,IAAA,MAAM,oBAAA,GAAuB,2IAAA;AAC7B,IAAA,IAAI,oBAAA,CAAqB,IAAA,CAAK,UAAU,CAAA,EAAG;AACzC,MAAA,OAAO,IAAA;AAAA,IACT;AAEA,IAAA,OAAO,KAAA;AAAA,EACT;AAAA,EAEQ,mBAAmB,KAAA,EAA0C;AAEnE,IAAA,IAAI,IAAA,CAAK,mBAAA,CAAoB,KAAK,CAAA,EAAG;AACnC,MAAA,OAAO,KAAA;AAAA,IACT;AAEA,IAAA,MAAM,KAAA,GAAQ,KAAA,CAAM,KAAA,CAAM,KAAK,CAAA,CAAE,MAAA;AACjC,IAAA,MAAM,UAAA,GAAa,MAAM,WAAA,EAAY;AAGrC,IAAA,MAAM,WAAA,GAAc;AAAA,MAAC,QAAA;AAAA,MAAU,MAAA;AAAA,MAAQ,QAAA;AAAA,MAAU,OAAA;AAAA,MAAS,OAAA;AAAA,MAAS,MAAA;AAAA,MAAQ,OAAA;AAAA,MACtD,QAAA;AAAA,MAAU,QAAA;AAAA,MAAU,OAAA;AAAA,MAAS,QAAA;AAAA,MAAU,UAAA;AAAA,MAAY,QAAA;AAAA,MACnD,SAAA;AAAA,MAAW,QAAA;AAAA,MAAU,WAAA;AAAA,MAAa,OAAA;AAAA,MAAS,SAAA;AAAA,MAAW,UAAA;AAAA,MACtD,SAAA;AAAA,MAAW,SAAA;AAAA,MAAW,OAAA;AAAA,MAAS,OAAA;AAAA,MAAS,SAAA;AAAA,MAAW;AAAA,KAAW;AACnF,IAAA,MAAM,UAAA,GAAa,WAAA,CAAY,MAAA,CAAO,CAAA,CAAA,KAAK,IAAI,MAAA,CAAO,CAAA,GAAA,EAAM,CAAC,CAAA,GAAA,CAAA,EAAO,GAAG,CAAA,CAAE,IAAA,CAAK,UAAU,CAAC,CAAA;AACzF,IAAA,MAAM,0BAAA,GAA6B,WAAW,MAAA,IAAU,CAAA;AAGxD,IAAA,MAAM,kBAAA,GAAqB,gGAAA,CAAiG,IAAA,CAAK,UAAU,CAAA;AAG3I,IAAA,MAAM,qBAAA,GAAwB,mEAAA,CAAoE,IAAA,CAAK,UAAU,CAAA;AAGjH,IAAA,IAAI,KAAA,GAAQ,EAAA,IAAO,0BAAA,IAA8B,qBAAA,EAAwB;AACvE,MAAA,OAAO,MAAA;AAAA,IACT;AAGA,IAAA,IAAI,0BAAA,IAA+B,kBAAA,IAAsB,KAAA,GAAQ,EAAA,EAAK;AACpE,MAAA,OAAO,QAAA;AAAA,IACT;AAGA,IAAA,OAAO,KAAA;AAAA,EACT;AAAA,EAEQ,cAAc,KAAA,EAAuB;AAC3C,IAAA,MAAM,YAAY,KAAA,CAAM,KAAA,CAAM,WAAW,CAAA,IAAK,EAAC,EAAG,MAAA;AAClD,IAAA,MAAM,aAAa,KAAA,CAAM,KAAA,CAAM,YAAY,CAAA,IAAK,EAAC,EAAG,MAAA;AACpD,IAAA,OAAO,IAAA,CAAK,GAAA,CAAI,CAAA,EAAG,QAAA,GAAW,YAAY,CAAC,CAAA;AAAA,EAC7C;AAAA,EAEQ,uBAAuB,MAAA,EAAiC;AAC9D,IAAA,IAAI,IAAA,CAAK,QAAQ,QAAA,EAAU,OAAA,KAAY,SAAS,IAAA,CAAK,OAAA,CAAQ,QAAA,EAAU,UAAA,KAAe,KAAA,EAAO;AAC3F,MAAA,OAAO,OAAO,IAAA,KAAS,SAAA,KAAc,OAAO,UAAA,KAAe,MAAA,IAAU,OAAO,UAAA,KAAe,QAAA,CAAA;AAAA,IAC7F;AACA,IAAA,OAAO,KAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAWQ,oBAAA,GAA8B;AAEpC,IAAA,MAAM,SAAA,GAAY,IAAA,CAAK,aAAA,CAAc,KAAA,CAAM,YAAW,CAAE,MAAA,CAAO,CAAA,CAAA,KAAK,CAAC,UAAA,CAAW,CAAA,CAAE,UAAA,CAAW,QAAA,CAAS,IAAI,CAAC,CAAA;AAE3G,IAAA,OAAO,MAAM,MAAA,CAAO;AAAA,MAClB,SAAA,EAAW,KAAK,OAAA,CAAQ,SAAA;AAAA,MACxB,KAAA,EAAO,KAAK,OAAA,CAAQ,KAAA;AAAA,MACpB,KAAA,EAAO,SAAA;AAAA,MACP,YAAA,EAAc,KAAK,0BAAA,EAA2B;AAAA,MAC9C,WAAA,EAAa,KAAK,OAAA,CAAQ,WAAA;AAAA,MAC1B,aAAA,EAAe,IAAA,CAAK,OAAA,CAAQ,aAAA,IAAiB,EAAA;AAAA,MAC7C,WAAA,EAAa,KAAK,OAAA,CAAQ,WAAA;AAAA,MAC1B,SAAS,IAAA,CAAK;AAAA;AAAA,KACf,CAAA;AAAA,EACH;AAAA;AAAA;AAAA;AAAA,EAKQ,0BAAA,GAAqC;AAC3C,IAAA,OAAO,CAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA,EAQT,IAAA,CAAK,OAAA,CAAQ,YAAA,IAAgB,EAAE,CAAA,CAAA;AAAA,EAC/B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,MAAc,wBAAA,CAAyB,IAAA,EAA4B,OAAA,EAAgC;AAEjG,IAAA,MAAM,IAAA,CAAK,aAAA,CAAc,UAAA,CAAW,IAAA,EAAM,OAAO,CAAA;AAAA,EACnD;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,MAAc,iBAAiB,YAAA,EAAuC;AAEpE,IAAA,IAAI,KAAK,WAAA,EAAa;AACpB,MAAA,IAAA,CAAK,WAAA,CAAY,OAAA,CAAQ,IAAA,CAAK,WAAW,CAAA;AAAA,IAC3C;AAGA,IAAA,IAAA,CAAK,aAAA,CAAc,gBAAgB,YAAY,CAAA;AAC/C,IAAA,MAAM,QAAA,GAAW,MAAM,IAAA,CAAK,aAAA,CAAc,OAAA,EAAQ;AAGlD,IAAA,MAAM,QAAkB,EAAC;AACzB,IAAA,KAAA,MAAW,SAAA,IAAa,SAAS,UAAA,EAAY;AAC3C,MAAA,IAAI,UAAU,OAAA,EAAS;AACrB,QAAA,MAAM,OAAA,GAAU,OAAO,SAAA,CAAU,OAAA,KAAY,QAAA,GACzC,SAAA,CAAU,OAAA,GACV,IAAA,CAAK,SAAA,CAAU,SAAA,CAAU,OAAA,EAAS,IAAA,EAAM,CAAC,CAAA;AAC7C,QAAA,KAAA,CAAM,KAAK,OAAO,CAAA;AAAA,MACpB;AAAA,IACF;AAEA,IAAA,OAAO,KAAA,CAAM,KAAK,MAAM,CAAA;AAAA,EAC1B;AAAA;AAAA;AAAA;AAAA,EAMQ,kBAAkB,gBAAA,EAAmC;AAC3D,IAAA,MAAM,gBAAA,GAAmB,CAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA,gEAAA,CAAA;AAkBzB,IAAA,OAAO,gBAAA,GACH,GAAG,gBAAgB;;AAAA;AAAA,EAAiC,gBAAgB,CAAA,CAAA,GACpE,gBAAA;AAAA,EACN;AAAA,EAEQ,gBAAgB,IAAA,EAAoB;AAC1C,IAAA,IAAI,MAAA,GAAS,CAAA;;AAAA,MAAA,EAAwC,KAAK,IAAI;AAAA,aAAA,EAAkB,KAAK,WAAW,CAAA,CAAA;AAEhG,IAAA,IAAI,KAAK,cAAA,EAAgB;AACvB,MAAA,MAAA,IAAU;AAAA,iBAAA,EAAsB,KAAK,cAAc,CAAA,CAAA;AAAA,IACrD;AAEA,IAAA,OAAO,MAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKQ,0BAAA,CAA2B,MAAY,SAAA,EAA2B;AACxE,IAAA,MAAM,QAAkB,EAAC;AAGzB,IAAA,IAAI,KAAK,WAAA,EAAa;AACpB,MAAA,KAAA,CAAM,IAAA,CAAK,CAAA;AAAA,EAAoB,IAAA,CAAK,YAAY,IAAI;AAAA,CAAI,CAAA;AAGxD,MAAA,MAAM,cAAA,GAAiB,IAAA,CAAK,WAAA,CAAY,KAAA,CAAM,KAAA,CAAM,CAAA,EAAG,SAAS,CAAA,CAAE,MAAA,CAAO,CAAA,CAAA,KAAK,CAAA,CAAE,MAAA,KAAW,WAAW,CAAA;AACtG,MAAA,IAAI,cAAA,CAAe,SAAS,CAAA,EAAG;AAC7B,QAAA,KAAA,CAAM,KAAK,CAAA,6BAAA,CAA+B,CAAA;AAC1C,QAAA,KAAA,MAAW,aAAa,cAAA,EAAgB;AACtC,UAAA,MAAM,MAAA,GAAS,SAAA,CAAU,MAAA,EAAQ,MAAA,GAC5B,OAAO,UAAU,MAAA,CAAO,MAAA,KAAW,QAAA,GAClC,SAAA,CAAU,MAAA,CAAO,MAAA,CAAO,UAAU,CAAA,EAAG,GAAG,CAAA,GACxC,IAAA,CAAK,SAAA,CAAU,SAAA,CAAU,MAAA,CAAO,MAAM,CAAA,CAAE,SAAA,CAAU,CAAA,EAAG,GAAG,CAAA,GAC1D,oBAAA;AACJ,UAAA,KAAA,CAAM,KAAK,CAAA,IAAA,EAAO,SAAA,CAAU,IAAI,CAAA,IAAA,EAAO,UAAU,WAAW;AAAA,UAAA,EAAe,MAAM,CAAA,CAAE,CAAA;AAAA,QACrF;AACA,QAAA,KAAA,CAAM,KAAK,EAAE,CAAA;AAAA,MACf;AAAA,IACF;AAGA,IAAA,KAAA,CAAM,IAAA,CAAK,CAAA,iBAAA,EAAoB,SAAA,GAAY,CAAC,CAAA,CAAA,EAAI,KAAK,WAAA,EAAa,KAAA,CAAM,MAAA,IAAU,CAAC,CAAA,CAAA,CAAG,CAAA;AACtF,IAAA,KAAA,CAAM,IAAA,CAAK,CAAA,UAAA,EAAa,IAAA,CAAK,IAAI,CAAA,CAAE,CAAA;AACnC,IAAA,KAAA,CAAM,IAAA,CAAK,CAAA,iBAAA,EAAoB,IAAA,CAAK,WAAW,CAAA,CAAE,CAAA;AACjD,IAAA,IAAI,KAAK,cAAA,EAAgB;AACvB,MAAA,KAAA,CAAM,IAAA,CAAK,CAAA,qBAAA,EAAwB,IAAA,CAAK,cAAc,CAAA,CAAE,CAAA;AAAA,IAC1D;AACA,IAAA,KAAA,CAAM,KAAK,EAAE,CAAA;AACb,IAAA,KAAA,CAAM,KAAK,0FAA0F,CAAA;AAErG,IAAA,OAAO,KAAA,CAAM,KAAK,IAAI,CAAA;AAAA,EACxB;AAAA,EAEQ,kBAAkB,IAAA,EAAoB;AAC5C,IAAA,IAAI,OAAA,GAAU,CAAA,wBAAA,EAA2B,IAAA,CAAK,IAAI;;AAAA,CAAA;AAClD,IAAA,OAAA,IAAW,CAAA,OAAA,EAAU,IAAA,CAAK,KAAA,CAAM,MAAM,CAAA;AAAA,CAAA;AAEtC,IAAA,IAAA,CAAK,KAAA,CAAM,OAAA,CAAQ,CAAC,IAAA,EAAM,CAAA,KAAM;AAC9B,MAAA,MAAM,IAAA,GAAO,IAAA,CAAK,SAAA,EAAW,MAAA,GAAS,CAAA,cAAA,EAAiB,KAAK,SAAA,CAAU,IAAA,CAAK,IAAI,CAAC,CAAA,CAAA,CAAA,GAAM,EAAA;AACtF,MAAA,OAAA,IAAW,CAAA,EAAG,CAAA,GAAI,CAAC,CAAA,EAAA,EAAK,IAAA,CAAK,IAAI,CAAA,EAAA,EAAK,IAAA,CAAK,WAAW,CAAA,EAAG,IAAI;AAAA,CAAA;AAAA,IAC/D,CAAC,CAAA;AAED,IAAA,OAAA,IAAW,gDAAA;AACX,IAAA,OAAO,OAAA;AAAA,EACT;AAAA,EAEQ,eAAe,QAAA,EAAgC;AACrD,IAAA,IAAI,OAAO,CAAA,UAAA,EAAa,QAAA,CAAS,SAAS,CAAA,CAAA,EAAI,SAAS,KAAK,CAAA,gBAAA,CAAA;AAE5D,IAAA,IAAI,QAAA,CAAS,SAAS,CAAA,EAAG;AACvB,MAAA,IAAA,IAAQ,CAAA,EAAA,EAAK,SAAS,MAAM,CAAA,QAAA,CAAA;AAAA,IAC9B;AACA,IAAA,IAAI,QAAA,CAAS,UAAU,CAAA,EAAG;AACxB,MAAA,IAAA,IAAQ,CAAA,EAAA,EAAK,SAAS,OAAO,CAAA,SAAA,CAAA;AAAA,IAC/B;AAEA,IAAA,IAAI,SAAS,OAAA,EAAS;AACpB,MAAA,IAAA,IAAQ;;AAAA,sBAAA,EAA6B,QAAA,CAAS,QAAQ,IAAI,CAAA,CAAA;AAAA,IAC5D;AAEA,IAAA,OAAO,IAAA;AAAA,EACT;AAAA,EAEQ,eAAA,GAAgC;AACtC,IAAA,IAAI,CAAC,KAAK,WAAA,EAAa;AACrB,MAAA,OAAO,EAAE,WAAW,CAAA,EAAG,KAAA,EAAO,GAAG,MAAA,EAAQ,CAAA,EAAG,SAAS,CAAA,EAAE;AAAA,IACzD;AAEA,IAAA,MAAM,KAAA,GAAQ,KAAK,WAAA,CAAY,KAAA;AAC/B,IAAA,MAAM,UAAA,GAAa,IAAA,CAAK,WAAA,CAAY,mBAAA,EAAoB;AAExD,IAAA,OAAO;AAAA,MACL,WAAW,KAAA,CAAM,MAAA,CAAO,OAAK,CAAA,CAAE,MAAA,KAAW,WAAW,CAAA,CAAE,MAAA;AAAA,MACvD,OAAO,KAAA,CAAM,MAAA;AAAA,MACb,OAAA,EAAS,MAAM,UAAU,CAAA;AAAA,MACzB,QAAQ,KAAA,CAAM,MAAA,CAAO,OAAK,CAAA,CAAE,MAAA,KAAW,QAAQ,CAAA,CAAE,MAAA;AAAA,MACjD,SAAS,KAAA,CAAM,MAAA,CAAO,OAAK,CAAA,CAAE,MAAA,KAAW,SAAS,CAAA,CAAE;AAAA,KACrD;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAMA,OAAA,GAAqB;AACnB,IAAA,OAAO,IAAA,CAAK,YAAY,OAAA,EAAQ;AAAA,EAClC;AAAA,EAEA,OAAA,GAAuB;AACrB,IAAA,OAAO,IAAA,CAAK,WAAA;AAAA,EACd;AAAA,EAEA,WAAA,GAAmC;AACjC,IAAA,IAAI,KAAK,WAAA,CAAY,OAAA,OAAc,WAAA,IAAe,CAAC,KAAK,WAAA,EAAa;AACnE,MAAA,OAAO,IAAA;AAAA,IACT;AACA,IAAA,OAAO,KAAK,eAAA,EAAgB;AAAA,EAC9B;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,IAAI,WAAA,GAAc;AAChB,IAAA,OAAO,KAAK,aAAA,CAAc,KAAA;AAAA,EAC5B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAYA,UAAA,GAAsB;AACpB,IAAA,OAAO,IAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAMA,gBAAgB,KAAA,EAAsB;AACpC,IAAA,IAAI,IAAA,CAAK,QAAQ,QAAA,EAAU;AACzB,MAAA,IAAA,CAAK,OAAA,CAAQ,QAAA,CAAS,eAAA,GAAkB,CAAC,KAAA;AAAA,IAC3C;AAAA,EACF;AAAA,EAEA,mBAAmB,KAAA,EAAsB;AACvC,IAAA,IAAI,IAAA,CAAK,QAAQ,QAAA,EAAU;AACzB,MAAA,IAAA,CAAK,OAAA,CAAQ,SAAS,OAAA,GAAU,KAAA;AAAA,IAClC;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAMQ,SAAA,GAAY,KAAA;AAAA,EAEpB,KAAA,GAAc;AACZ,IAAA,IAAA,CAAK,SAAA,GAAY,IAAA;AACjB,IAAA,IAAI,IAAA,CAAK,WAAA,CAAY,OAAA,EAAQ,KAAM,WAAA,EAAa;AAC9C,MAAA,IAAA,CAAK,WAAA,CAAY,eAAe,cAAc,CAAA;AAAA,IAChD;AAAA,EACF;AAAA,EAEA,MAAA,GAAe;AACb,IAAA,IAAA,CAAK,SAAA,GAAY,KAAA;AACjB,IAAA,IAAI,IAAA,CAAK,WAAA,CAAY,QAAA,EAAS,EAAG;AAC/B,MAAA,IAAA,CAAK,YAAY,eAAA,EAAgB;AAAA,IACnC;AAAA,EACF;AAAA,EAEA,MAAA,GAAe;AACb,IAAA,IAAI,KAAK,WAAA,EAAa;AACpB,MAAA,IAAA,CAAK,YAAY,MAAA,GAAS,WAAA;AAAA,IAC5B;AACA,IAAA,IAAA,CAAK,WAAA,CAAY,oBAAoB,WAAW,CAAA;AAAA,EAClD;AAAA,EAEA,SAAA,GAAqB;AACnB,IAAA,OAAO,KAAK,WAAA,CAAY,OAAA,OAAc,WAAA,IAAe,CAAC,KAAK,QAAA,EAAS;AAAA,EACtE;AAAA,EAEA,QAAA,GAAoB;AAClB,IAAA,OAAO,IAAA,CAAK,SAAA,IAAa,IAAA,CAAK,WAAA,CAAY,QAAA,EAAS;AAAA,EACrD;AAAA;AAAA;AAAA;AAAA,EAMA,OAAA,GAAgB;AACd,IAAA,IAAI,KAAK,YAAA,EAAc;AAEvB,IAAA,IAAA,CAAK,OAAA,CAAQ,MAAM,gCAAgC,CAAA;AAGnD,IAAA,KAAA,MAAW,QAAA,IAAY,KAAK,iBAAA,EAAmB;AAC7C,MAAA,IAAI;AACF,QAAA,QAAA,EAAS;AAAA,MACX,SAAS,KAAA,EAAO;AACd,QAAA,IAAA,CAAK,QAAQ,KAAA,CAAM,EAAE,OAAQ,KAAA,CAAgB,OAAA,IAAW,wBAAwB,CAAA;AAAA,MAClF;AAAA,IACF;AACA,IAAA,IAAA,CAAK,oBAAoB,EAAC;AAG1B,IAAA,IAAA,CAAK,MAAM,OAAA,EAAQ;AACnB,IAAA,IAAI,KAAK,cAAA,EAAgB;AACvB,MAAA,IAAA,CAAK,eAAe,OAAA,EAAQ;AAAA,IAC9B;AACA,IAAA,IAAA,CAAK,YAAY,OAAA,EAAQ;AAKzB,IAAA,IAAA,CAAK,WAAA,EAAY;AAEjB,IAAA,IAAA,CAAK,OAAA,CAAQ,MAAM,0BAA0B,CAAA;AAAA,EAC/C;AACF","file":"index.js","sourcesContent":["/**\n * Encryption utilities for OAuth tokens\n * Uses AES-256-GCM for secure token storage\n */\n\nimport * as crypto from 'crypto';\n\nconst ALGORITHM = 'aes-256-gcm';\nconst IV_LENGTH = 16;\nconst SALT_LENGTH = 64;\nconst TAG_LENGTH = 16;\nconst KEY_LENGTH = 32;\n\n/**\n * Encrypt data using AES-256-GCM with PBKDF2 key derivation\n *\n * @param text - Plaintext to encrypt\n * @param password - Encryption key/password\n * @returns Base64-encoded encrypted data\n */\nexport function encrypt(text: string, password: string): string {\n  // Generate random salt\n  const salt = crypto.randomBytes(SALT_LENGTH);\n\n  // Derive key from password using PBKDF2\n  const key = crypto.pbkdf2Sync(password, salt, 100000, KEY_LENGTH, 'sha512');\n\n  // Generate random IV\n  const iv = crypto.randomBytes(IV_LENGTH);\n\n  // Create cipher\n  const cipher = crypto.createCipheriv(ALGORITHM, key, iv);\n\n  // Encrypt\n  let encrypted = cipher.update(text, 'utf8', 'hex');\n  encrypted += cipher.final('hex');\n\n  // Get authentication tag\n  const tag = cipher.getAuthTag();\n\n  // Combine: salt + iv + tag + encrypted\n  const result = Buffer.concat([salt, iv, tag, Buffer.from(encrypted, 'hex')]);\n\n  // Return as base64\n  return result.toString('base64');\n}\n\n/**\n * Decrypt data using AES-256-GCM\n *\n * @param encryptedData - Base64-encoded encrypted data\n * @param password - Encryption key/password\n * @returns Decrypted plaintext\n */\nexport function decrypt(encryptedData: string, password: string): string {\n  const buffer = Buffer.from(encryptedData, 'base64');\n\n  // Extract components\n  const salt = buffer.subarray(0, SALT_LENGTH);\n  const iv = buffer.subarray(SALT_LENGTH, SALT_LENGTH + IV_LENGTH);\n  const tag = buffer.subarray(SALT_LENGTH + IV_LENGTH, SALT_LENGTH + IV_LENGTH + TAG_LENGTH);\n  const encrypted = buffer.subarray(SALT_LENGTH + IV_LENGTH + TAG_LENGTH);\n\n  // Derive key from password\n  const key = crypto.pbkdf2Sync(password, salt, 100000, KEY_LENGTH, 'sha512');\n\n  // Create decipher\n  const decipher = crypto.createDecipheriv(ALGORITHM, key, iv);\n  decipher.setAuthTag(tag);\n\n  // Decrypt\n  let decrypted = decipher.update(encrypted);\n  decrypted = Buffer.concat([decrypted, decipher.final()]);\n\n  return decrypted.toString('utf8');\n}\n\n/**\n * Get encryption key from environment or generate temporary one\n *\n * For production, always set OAUTH_ENCRYPTION_KEY environment variable!\n */\nexport function getEncryptionKey(): string {\n  // Use environment variable if available (RECOMMENDED)\n  if (process.env.OAUTH_ENCRYPTION_KEY) {\n    return process.env.OAUTH_ENCRYPTION_KEY;\n  }\n\n  // For in-memory storage: use process-specific key (not persistent across restarts)\n  // This is acceptable for MemoryStorage but NOT for FileStorage or DatabaseStorage!\n  if (!(global as any).__oauthEncryptionKey) {\n    (global as any).__oauthEncryptionKey = crypto.randomBytes(32).toString('hex');\n\n    console.warn(\n      'WARNING: Using auto-generated encryption key. Tokens will not persist across restarts. ' +\n        'Set OAUTH_ENCRYPTION_KEY environment variable for production!'\n    );\n  }\n\n  return (global as any).__oauthEncryptionKey;\n}\n\n/**\n * Generate a secure random encryption key\n * Use this to generate OAUTH_ENCRYPTION_KEY for your .env file\n */\nexport function generateEncryptionKey(): string {\n  return crypto.randomBytes(32).toString('hex');\n}\n","/**\n * In-memory token storage (default)\n * Tokens are encrypted in memory using AES-256-GCM\n */\n\nimport { ITokenStorage, StoredToken } from '../../domain/ITokenStorage.js';\nimport { encrypt, decrypt, getEncryptionKey } from '../../utils/encryption.js';\n\nexport class MemoryStorage implements ITokenStorage {\n  private tokens: Map<string, string> = new Map(); // Stores encrypted tokens\n\n  async storeToken(key: string, token: StoredToken): Promise<void> {\n    const encryptionKey = getEncryptionKey();\n    const plaintext = JSON.stringify(token);\n    const encrypted = encrypt(plaintext, encryptionKey);\n\n    this.tokens.set(key, encrypted);\n  }\n\n  async getToken(key: string): Promise<StoredToken | null> {\n    const encrypted = this.tokens.get(key);\n    if (!encrypted) {\n      return null;\n    }\n\n    try {\n      const encryptionKey = getEncryptionKey();\n      const decrypted = decrypt(encrypted, encryptionKey);\n      return JSON.parse(decrypted) as StoredToken;\n    } catch (error) {\n      console.error('Failed to decrypt token from memory:', error);\n      // Remove corrupted token\n      this.tokens.delete(key);\n      return null;\n    }\n  }\n\n  async deleteToken(key: string): Promise<void> {\n    this.tokens.delete(key);\n  }\n\n  async hasToken(key: string): Promise<boolean> {\n    return this.tokens.has(key);\n  }\n\n  /**\n   * Clear all tokens (useful for testing)\n   */\n  clearAll(): void {\n    this.tokens.clear();\n  }\n\n  /**\n   * Get number of stored tokens\n   */\n  size(): number {\n    return this.tokens.size;\n  }\n}\n","/**\n * Token Store (Domain Layer)\n * Manages token lifecycle using pluggable storage backend\n */\n\nimport { ITokenStorage, StoredToken } from './ITokenStorage.js';\nimport { MemoryStorage } from '../infrastructure/storage/MemoryStorage.js';\n\nexport class TokenStore {\n  private storage: ITokenStorage;\n  private baseStorageKey: string;\n\n  constructor(storageKey: string = 'default', storage?: ITokenStorage) {\n    this.baseStorageKey = storageKey;\n    // Default to in-memory storage (encrypted)\n    this.storage = storage || new MemoryStorage();\n  }\n\n  /**\n   * Get user-scoped storage key\n   * For multi-user support, keys are scoped per user: \"provider:userId\"\n   * For single-user (backward compatible), userId is omitted or \"default\"\n   *\n   * @param userId - User identifier (optional, defaults to single-user mode)\n   * @returns Storage key scoped to user\n   */\n  private getScopedKey(userId?: string): string {\n    if (!userId || userId === 'default') {\n      // Single-user mode (backward compatible)\n      return this.baseStorageKey;\n    }\n    // Multi-user mode: scope by userId\n    return `${this.baseStorageKey}:${userId}`;\n  }\n\n  /**\n   * Store token (encrypted by storage layer)\n   * @param tokenResponse - Token response from OAuth provider\n   * @param userId - Optional user identifier for multi-user support\n   */\n  async storeToken(tokenResponse: any, userId?: string): Promise<void> {\n    // Validate required fields\n    if (!tokenResponse.access_token) {\n      throw new Error('OAuth response missing required access_token field');\n    }\n\n    if (typeof tokenResponse.access_token !== 'string') {\n      throw new Error('access_token must be a string');\n    }\n\n    if (tokenResponse.expires_in !== undefined && tokenResponse.expires_in < 0) {\n      throw new Error('expires_in must be positive');\n    }\n\n    const token: StoredToken = {\n      access_token: tokenResponse.access_token,\n      refresh_token: tokenResponse.refresh_token,\n      expires_in: tokenResponse.expires_in || 3600,\n      token_type: tokenResponse.token_type || 'Bearer',\n      scope: tokenResponse.scope,\n      obtained_at: Date.now(),\n    };\n\n    const key = this.getScopedKey(userId);\n    await this.storage.storeToken(key, token);\n  }\n\n  /**\n   * Get access token\n   * @param userId - Optional user identifier for multi-user support\n   */\n  async getAccessToken(userId?: string): Promise<string> {\n    const key = this.getScopedKey(userId);\n    const token = await this.storage.getToken(key);\n    if (!token) {\n      throw new Error(`No token stored for ${userId ? `user: ${userId}` : 'default user'}`);\n    }\n    return token.access_token;\n  }\n\n  /**\n   * Get refresh token\n   * @param userId - Optional user identifier for multi-user support\n   */\n  async getRefreshToken(userId?: string): Promise<string> {\n    const key = this.getScopedKey(userId);\n    const token = await this.storage.getToken(key);\n    if (!token?.refresh_token) {\n      throw new Error(`No refresh token available for ${userId ? `user: ${userId}` : 'default user'}`);\n    }\n    return token.refresh_token;\n  }\n\n  /**\n   * Check if has refresh token\n   * @param userId - Optional user identifier for multi-user support\n   */\n  async hasRefreshToken(userId?: string): Promise<boolean> {\n    const key = this.getScopedKey(userId);\n    const token = await this.storage.getToken(key);\n    return !!token?.refresh_token;\n  }\n\n  /**\n   * Check if token is valid (not expired)\n   *\n   * @param bufferSeconds - Refresh this many seconds before expiry (default: 300 = 5 min)\n   * @param userId - Optional user identifier for multi-user support\n   */\n  async isValid(bufferSeconds: number = 300, userId?: string): Promise<boolean> {\n    const key = this.getScopedKey(userId);\n    const token = await this.storage.getToken(key);\n    if (!token) {\n      return false;\n    }\n\n    const expiresAt = token.obtained_at + token.expires_in * 1000;\n    const bufferMs = bufferSeconds * 1000;\n\n    return Date.now() < expiresAt - bufferMs;\n  }\n\n  /**\n   * Clear stored token\n   * @param userId - Optional user identifier for multi-user support\n   */\n  async clear(userId?: string): Promise<void> {\n    const key = this.getScopedKey(userId);\n    await this.storage.deleteToken(key);\n  }\n\n  /**\n   * Get full token info\n   * @param userId - Optional user identifier for multi-user support\n   */\n  async getTokenInfo(userId?: string): Promise<StoredToken | null> {\n    const key = this.getScopedKey(userId);\n    return this.storage.getToken(key);\n  }\n}\n","/**\n * PKCE (Proof Key for Code Exchange) utilities\n * RFC 7636 - https://tools.ietf.org/html/rfc7636\n */\n\nimport * as crypto from 'crypto';\n\nexport interface PKCEPair {\n  codeVerifier: string;\n  codeChallenge: string;\n}\n\n/**\n * Generate PKCE code verifier and challenge pair\n *\n * code_challenge = BASE64URL(SHA256(code_verifier))\n */\nexport function generatePKCE(): PKCEPair {\n  // Generate random code verifier (43-128 characters as per RFC)\n  const codeVerifier = base64URLEncode(crypto.randomBytes(32));\n\n  // Create code challenge = BASE64URL(SHA256(code_verifier))\n  const hash = crypto.createHash('sha256').update(codeVerifier).digest();\n  const codeChallenge = base64URLEncode(hash);\n\n  return {\n    codeVerifier,\n    codeChallenge,\n  };\n}\n\n/**\n * Base64 URL encode (RFC 4648 Section 5)\n * Used for PKCE code_verifier and code_challenge\n */\nfunction base64URLEncode(buffer: Buffer): string {\n  return buffer\n    .toString('base64')\n    .replace(/\\+/g, '-') // Replace + with -\n    .replace(/\\//g, '_') // Replace / with _\n    .replace(/=/g, ''); // Remove padding\n}\n\n/**\n * Generate random state for CSRF protection\n */\nexport function generateState(): string {\n  return crypto.randomBytes(16).toString('hex');\n}\n","/**\n * OAuth 2.0 Authorization Code Flow with PKCE (RFC 7636)\n * User authentication for web and mobile apps\n */\n\nimport { TokenStore } from '../domain/TokenStore.js';\nimport { generatePKCE, generateState } from '../utils/pkce.js';\nimport type { OAuthConfig } from '../types.js';\n\nexport class AuthCodePKCEFlow {\n  private tokenStore: TokenStore;\n  // Store PKCE data per user with timestamps for cleanup\n  private codeVerifiers: Map<string, { verifier: string; timestamp: number }> = new Map();\n  private states: Map<string, { state: string; timestamp: number }> = new Map();\n  // Store refresh locks per user to prevent concurrent refresh\n  private refreshLocks: Map<string, Promise<string>> = new Map();\n  // PKCE data TTL: 15 minutes (auth flows should complete within this time)\n  private readonly PKCE_TTL = 15 * 60 * 1000;\n\n  constructor(private config: OAuthConfig) {\n    const storageKey = config.storageKey || `auth_code:${config.clientId}`;\n    this.tokenStore = new TokenStore(storageKey, config.storage);\n  }\n\n  /**\n   * Generate authorization URL for user to visit\n   * Opens browser or redirects user to this URL\n   *\n   * @param userId - User identifier for multi-user support (optional)\n   */\n  async getAuthorizationUrl(userId?: string): Promise<string> {\n    if (!this.config.authorizationUrl) {\n      throw new Error('authorizationUrl is required for authorization_code flow');\n    }\n\n    if (!this.config.redirectUri) {\n      throw new Error('redirectUri is required for authorization_code flow');\n    }\n\n    // Clean up expired PKCE data before creating new flow\n    this.cleanupExpiredPKCE();\n\n    const userKey = userId || 'default';\n\n    // Generate PKCE pair\n    const { codeVerifier, codeChallenge } = generatePKCE();\n    this.codeVerifiers.set(userKey, { verifier: codeVerifier, timestamp: Date.now() });\n\n    // Generate state for CSRF protection\n    const state = generateState();\n    this.states.set(userKey, { state, timestamp: Date.now() });\n\n    // Build authorization URL\n    const params = new URLSearchParams({\n      response_type: 'code',\n      client_id: this.config.clientId,\n      redirect_uri: this.config.redirectUri,\n      state,\n    });\n\n    // Add scope if provided\n    if (this.config.scope) {\n      params.append('scope', this.config.scope);\n    }\n\n    // Add PKCE parameters (if enabled, default true)\n    if (this.config.usePKCE !== false) {\n      params.append('code_challenge', codeChallenge);\n      params.append('code_challenge_method', 'S256');\n    }\n\n    // Add user_id as state metadata (encode in state for retrieval in callback)\n    // The state will be: `{random_state}::{userId}`\n    const stateWithUser = userId ? `${state}::${userId}` : state;\n    params.set('state', stateWithUser);\n\n    return `${this.config.authorizationUrl}?${params.toString()}`;\n  }\n\n  /**\n   * Exchange authorization code for access token\n   *\n   * @param code - Authorization code from callback\n   * @param state - State parameter from callback (for CSRF verification, may include userId)\n   * @param userId - User identifier (optional, can be extracted from state)\n   */\n  async exchangeCode(code: string, state: string, userId?: string): Promise<void> {\n    // Extract userId from state if embedded\n    let actualState = state;\n    let actualUserId = userId;\n\n    if (state.includes('::')) {\n      const parts = state.split('::');\n      actualState = parts[0]!;\n      actualUserId = parts[1];\n    }\n\n    const userKey = actualUserId || 'default';\n\n    // Verify state to prevent CSRF attacks\n    const stateData = this.states.get(userKey);\n    if (!stateData) {\n      throw new Error(`No PKCE state found for user ${actualUserId}. Authorization flow may have expired (15 min TTL).`);\n    }\n\n    const expectedState = stateData.state;\n    if (actualState !== expectedState) {\n      throw new Error(`State mismatch for user ${actualUserId} - possible CSRF attack. Expected: ${expectedState}, Got: ${actualState}`);\n    }\n\n    if (!this.config.redirectUri) {\n      throw new Error('redirectUri is required');\n    }\n\n    // Build token request\n    const params = new URLSearchParams({\n      grant_type: 'authorization_code',\n      code,\n      redirect_uri: this.config.redirectUri,\n      client_id: this.config.clientId,\n    });\n\n    // Add client secret if provided (confidential clients)\n    if (this.config.clientSecret) {\n      params.append('client_secret', this.config.clientSecret);\n    }\n\n    // Add code_verifier if PKCE was used\n    const verifierData = this.codeVerifiers.get(userKey);\n    if (this.config.usePKCE !== false && verifierData) {\n      params.append('code_verifier', verifierData.verifier);\n    }\n\n    const response = await fetch(this.config.tokenUrl, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n      },\n      body: params,\n    });\n\n    if (!response.ok) {\n      const error = await response.text();\n      throw new Error(`Token exchange failed: ${response.status} ${response.statusText} - ${error}`);\n    }\n\n    const data: any = await response.json();\n\n    // Store token (encrypted) with user scoping\n    await this.tokenStore.storeToken(data, actualUserId);\n\n    // Clear PKCE data (one-time use)\n    this.codeVerifiers.delete(userKey);\n    this.states.delete(userKey);\n  }\n\n  /**\n   * Get valid token (auto-refreshes if needed)\n   * @param userId - User identifier for multi-user support\n   */\n  async getToken(userId?: string): Promise<string> {\n    const key = userId || 'default';\n\n    // If already refreshing for this user, wait for the existing refresh\n    if (this.refreshLocks.has(key)) {\n      return this.refreshLocks.get(key)!;\n    }\n\n    // Return cached token if valid\n    if (await this.tokenStore.isValid(this.config.refreshBeforeExpiry, userId)) {\n      return this.tokenStore.getAccessToken(userId);\n    }\n\n    // Try to refresh if we have a refresh token\n    if (await this.tokenStore.hasRefreshToken(userId)) {\n      // Start refresh and lock it\n      const refreshPromise = this.refreshToken(userId);\n      this.refreshLocks.set(key, refreshPromise);\n\n      try {\n        return await refreshPromise;\n      } finally {\n        // Always clean up lock, even on error\n        this.refreshLocks.delete(key);\n      }\n    }\n\n    // No valid token and can't refresh\n    throw new Error(`No valid token available for ${userId ? `user: ${userId}` : 'default user'}. User needs to authorize (call startAuthFlow).`);\n  }\n\n  /**\n   * Refresh access token using refresh token\n   * @param userId - User identifier for multi-user support\n   */\n  async refreshToken(userId?: string): Promise<string> {\n    const refreshToken = await this.tokenStore.getRefreshToken(userId);\n\n    const params = new URLSearchParams({\n      grant_type: 'refresh_token',\n      refresh_token: refreshToken,\n      client_id: this.config.clientId,\n    });\n\n    // Add client secret if provided\n    if (this.config.clientSecret) {\n      params.append('client_secret', this.config.clientSecret);\n    }\n\n    const response = await fetch(this.config.tokenUrl, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n      },\n      body: params,\n    });\n\n    if (!response.ok) {\n      const error = await response.text();\n      throw new Error(`Token refresh failed: ${response.status} ${response.statusText} - ${error}`);\n    }\n\n    const data: any = await response.json();\n\n    // Store new token with user scoping\n    await this.tokenStore.storeToken(data, userId);\n\n    return data.access_token;\n  }\n\n  /**\n   * Check if token is valid\n   * @param userId - User identifier for multi-user support\n   */\n  async isTokenValid(userId?: string): Promise<boolean> {\n    return this.tokenStore.isValid(this.config.refreshBeforeExpiry, userId);\n  }\n\n  /**\n   * Revoke token (if supported by provider)\n   * @param revocationUrl - Optional revocation endpoint\n   * @param userId - User identifier for multi-user support\n   */\n  async revokeToken(revocationUrl?: string, userId?: string): Promise<void> {\n    if (!revocationUrl) {\n      // Just clear from storage\n      await this.tokenStore.clear(userId);\n      return;\n    }\n\n    try {\n      const token = await this.tokenStore.getAccessToken(userId);\n\n      await fetch(revocationUrl, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/x-www-form-urlencoded',\n        },\n        body: new URLSearchParams({\n          token,\n          client_id: this.config.clientId,\n        }),\n      });\n    } finally {\n      // Always clear from storage\n      await this.tokenStore.clear(userId);\n    }\n  }\n\n  /**\n   * Clean up expired PKCE data to prevent memory leaks\n   * Removes verifiers and states older than PKCE_TTL (15 minutes)\n   */\n  private cleanupExpiredPKCE(): void {\n    const now = Date.now();\n\n    // Clean up expired code verifiers\n    for (const [key, data] of this.codeVerifiers) {\n      if (now - data.timestamp > this.PKCE_TTL) {\n        this.codeVerifiers.delete(key);\n        this.states.delete(key);\n      }\n    }\n  }\n}\n","/**\n * OAuth 2.0 Client Credentials Flow\n * Machine-to-machine authentication\n */\n\nimport { TokenStore } from '../domain/TokenStore.js';\nimport type { OAuthConfig } from '../types.js';\n\nexport class ClientCredentialsFlow {\n  private tokenStore: TokenStore;\n\n  constructor(private config: OAuthConfig) {\n    const storageKey = config.storageKey || `client_credentials:${config.clientId}`;\n    this.tokenStore = new TokenStore(storageKey, config.storage);\n  }\n\n  /**\n   * Get token using client credentials\n   */\n  async getToken(): Promise<string> {\n    // Return cached token if valid\n    if (await this.tokenStore.isValid(this.config.refreshBeforeExpiry)) {\n      return this.tokenStore.getAccessToken();\n    }\n\n    // Request new token\n    return this.requestToken();\n  }\n\n  /**\n   * Request a new token from the authorization server\n   */\n  private async requestToken(): Promise<string> {\n    // Create Basic Auth header\n    const auth = Buffer.from(`${this.config.clientId}:${this.config.clientSecret}`).toString(\n      'base64'\n    );\n\n    const params = new URLSearchParams({\n      grant_type: 'client_credentials',\n    });\n\n    // Add scope if provided\n    if (this.config.scope) {\n      params.append('scope', this.config.scope);\n    }\n\n    const response = await fetch(this.config.tokenUrl, {\n      method: 'POST',\n      headers: {\n        Authorization: `Basic ${auth}`,\n        'Content-Type': 'application/x-www-form-urlencoded',\n      },\n      body: params,\n    });\n\n    if (!response.ok) {\n      const error = await response.text();\n      throw new Error(`Token request failed: ${response.status} ${response.statusText} - ${error}`);\n    }\n\n    const data: any = await response.json();\n\n    // Store token (encrypted)\n    await this.tokenStore.storeToken(data);\n\n    return data.access_token;\n  }\n\n  /**\n   * Refresh token (client credentials don't use refresh tokens)\n   * Just requests a new token\n   */\n  async refreshToken(): Promise<string> {\n    await this.tokenStore.clear();\n    return this.requestToken();\n  }\n\n  /**\n   * Check if token is valid\n   */\n  async isTokenValid(): Promise<boolean> {\n    return this.tokenStore.isValid(this.config.refreshBeforeExpiry);\n  }\n}\n","/**\n * OAuth 2.0 JWT Bearer Flow (RFC 7523)\n * Service account authentication using private key signing\n */\n\nimport { SignJWT, importPKCS8 } from 'jose';\nimport * as fs from 'fs';\nimport { TokenStore } from '../domain/TokenStore.js';\nimport type { OAuthConfig } from '../types.js';\n\nexport class JWTBearerFlow {\n  private tokenStore: TokenStore;\n  private privateKey: string;\n\n  constructor(private config: OAuthConfig) {\n    const storageKey = config.storageKey || `jwt_bearer:${config.clientId}`;\n    this.tokenStore = new TokenStore(storageKey, config.storage);\n\n    // Load private key\n    if (config.privateKey) {\n      this.privateKey = config.privateKey;\n    } else if (config.privateKeyPath) {\n      try {\n        this.privateKey = fs.readFileSync(config.privateKeyPath, 'utf8');\n      } catch (error) {\n        throw new Error(`Failed to read private key from ${config.privateKeyPath}: ${(error as Error).message}`);\n      }\n    } else {\n      throw new Error('JWT Bearer flow requires privateKey or privateKeyPath');\n    }\n  }\n\n  /**\n   * Generate signed JWT assertion\n   */\n  private async generateJWT(): Promise<string> {\n    const now = Math.floor(Date.now() / 1000);\n    const alg = this.config.tokenSigningAlg || 'RS256';\n\n    // Parse private key\n    const key = await importPKCS8(this.privateKey, alg);\n\n    // Create JWT\n    const jwt = await new SignJWT({\n      scope: this.config.scope || '',\n    })\n      .setProtectedHeader({ alg })\n      .setIssuer(this.config.clientId)\n      .setSubject(this.config.clientId)\n      .setAudience(this.config.audience || this.config.tokenUrl)\n      .setIssuedAt(now)\n      .setExpirationTime(now + 3600) // 1 hour\n      .sign(key);\n\n    return jwt;\n  }\n\n  /**\n   * Get token using JWT Bearer assertion\n   */\n  async getToken(): Promise<string> {\n    // Return cached token if valid\n    if (await this.tokenStore.isValid(this.config.refreshBeforeExpiry)) {\n      return this.tokenStore.getAccessToken();\n    }\n\n    // Request new token\n    return this.requestToken();\n  }\n\n  /**\n   * Request token using JWT assertion\n   */\n  private async requestToken(): Promise<string> {\n    // Generate JWT assertion\n    const assertion = await this.generateJWT();\n\n    // Exchange JWT for access token\n    const params = new URLSearchParams({\n      grant_type: 'urn:ietf:params:oauth:grant-type:jwt-bearer',\n      assertion,\n    });\n\n    const response = await fetch(this.config.tokenUrl, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n      },\n      body: params,\n    });\n\n    if (!response.ok) {\n      const error = await response.text();\n      throw new Error(`JWT Bearer token request failed: ${response.status} ${response.statusText} - ${error}`);\n    }\n\n    const data: any = await response.json();\n\n    // Store token (encrypted)\n    await this.tokenStore.storeToken(data);\n\n    return data.access_token;\n  }\n\n  /**\n   * Refresh token (generate new JWT and request new token)\n   */\n  async refreshToken(): Promise<string> {\n    await this.tokenStore.clear();\n    return this.requestToken();\n  }\n\n  /**\n   * Check if token is valid\n   */\n  async isTokenValid(): Promise<boolean> {\n    return this.tokenStore.isValid(this.config.refreshBeforeExpiry);\n  }\n}\n","/**\n * Static Token Flow - For APIs that use static API keys\n * Examples: OpenAI, Anthropic, many SaaS APIs\n */\n\nimport type { OAuthConfig } from '../types.js';\n\nexport class StaticTokenFlow {\n  private token: string;\n\n  constructor(config: OAuthConfig) {\n    if (!config.staticToken) {\n      throw new Error('Static token flow requires staticToken in config');\n    }\n\n    this.token = config.staticToken;\n  }\n\n  /**\n   * Get token (always returns the static token)\n   */\n  async getToken(): Promise<string> {\n    return this.token;\n  }\n\n  /**\n   * Refresh token (no-op for static tokens)\n   */\n  async refreshToken(): Promise<string> {\n    return this.token;\n  }\n\n  /**\n   * Token is always valid for static tokens\n   */\n  async isTokenValid(): Promise<boolean> {\n    return true;\n  }\n\n  /**\n   * Update the static token\n   */\n  updateToken(newToken: string): void {\n    this.token = newToken;\n  }\n}\n","/**\n * OAuth Manager - Main entry point for OAuth 2.0 authentication\n * Supports multiple flows: Authorization Code (with PKCE), Client Credentials, JWT Bearer, Static Token\n */\n\nimport { AuthCodePKCEFlow } from './flows/AuthCodePKCE.js';\nimport { ClientCredentialsFlow } from './flows/ClientCredentials.js';\nimport { JWTBearerFlow } from './flows/JWTBearer.js';\nimport { StaticTokenFlow } from './flows/StaticToken.js';\nimport type { OAuthConfig } from './types.js';\n\nexport class OAuthManager {\n  private flow: AuthCodePKCEFlow | ClientCredentialsFlow | JWTBearerFlow | StaticTokenFlow;\n\n  constructor(config: OAuthConfig) {\n    // Validate configuration\n    this.validateConfig(config);\n\n    // Create appropriate flow implementation\n    switch (config.flow) {\n      case 'authorization_code':\n        this.flow = new AuthCodePKCEFlow(config);\n        break;\n\n      case 'client_credentials':\n        this.flow = new ClientCredentialsFlow(config);\n        break;\n\n      case 'jwt_bearer':\n        this.flow = new JWTBearerFlow(config);\n        break;\n\n      case 'static_token':\n        this.flow = new StaticTokenFlow(config);\n        break;\n\n      default:\n        throw new Error(`Unknown OAuth flow: ${(config as any).flow}`);\n    }\n  }\n\n  /**\n   * Get valid access token\n   * Automatically refreshes if expired\n   *\n   * @param userId - User identifier for multi-user support (optional)\n   */\n  async getToken(userId?: string): Promise<string> {\n    return this.flow.getToken(userId);\n  }\n\n  /**\n   * Force refresh the token\n   *\n   * @param userId - User identifier for multi-user support (optional)\n   */\n  async refreshToken(userId?: string): Promise<string> {\n    return this.flow.refreshToken(userId);\n  }\n\n  /**\n   * Check if current token is valid\n   *\n   * @param userId - User identifier for multi-user support (optional)\n   */\n  async isTokenValid(userId?: string): Promise<boolean> {\n    return this.flow.isTokenValid(userId);\n  }\n\n  // ==================== Authorization Code Flow Methods ====================\n\n  /**\n   * Start authorization flow (Authorization Code only)\n   * Returns URL for user to visit\n   *\n   * @param userId - User identifier for multi-user support (optional)\n   * @returns Authorization URL for the user to visit\n   */\n  async startAuthFlow(userId?: string): Promise<string> {\n    if (!(this.flow instanceof AuthCodePKCEFlow)) {\n      throw new Error('startAuthFlow() is only available for authorization_code flow');\n    }\n\n    return this.flow.getAuthorizationUrl(userId);\n  }\n\n  /**\n   * Handle OAuth callback (Authorization Code only)\n   * Call this with the callback URL after user authorizes\n   *\n   * @param callbackUrl - Full callback URL with code and state parameters\n   * @param userId - Optional user identifier (can be extracted from state if embedded)\n   */\n  async handleCallback(callbackUrl: string, userId?: string): Promise<void> {\n    if (!(this.flow instanceof AuthCodePKCEFlow)) {\n      throw new Error('handleCallback() is only available for authorization_code flow');\n    }\n\n    const url = new URL(callbackUrl);\n    const code = url.searchParams.get('code');\n    const state = url.searchParams.get('state');\n\n    if (!code) {\n      throw new Error('Missing authorization code in callback URL');\n    }\n\n    if (!state) {\n      throw new Error('Missing state parameter in callback URL');\n    }\n\n    await this.flow.exchangeCode(code, state, userId);\n  }\n\n  /**\n   * Revoke token (if supported by provider)\n   *\n   * @param revocationUrl - Optional revocation endpoint URL\n   * @param userId - User identifier for multi-user support (optional)\n   */\n  async revokeToken(revocationUrl?: string, userId?: string): Promise<void> {\n    if (this.flow instanceof AuthCodePKCEFlow) {\n      await this.flow.revokeToken(revocationUrl, userId);\n    } else {\n      throw new Error('Token revocation not implemented for this flow');\n    }\n  }\n\n  // ==================== Validation ====================\n\n  private validateConfig(config: OAuthConfig): void {\n    // Required fields\n    if (!config.flow) {\n      throw new Error('OAuth flow is required (authorization_code, client_credentials, jwt_bearer, or static_token)');\n    }\n\n    // tokenUrl and clientId not required for static_token\n    if (config.flow !== 'static_token') {\n      if (!config.tokenUrl) {\n        throw new Error('tokenUrl is required');\n      }\n\n      if (!config.clientId) {\n        throw new Error('clientId is required');\n      }\n    }\n\n    // Flow-specific validation\n    switch (config.flow) {\n      case 'authorization_code':\n        if (!config.authorizationUrl) {\n          throw new Error('authorizationUrl is required for authorization_code flow');\n        }\n        if (!config.redirectUri) {\n          throw new Error('redirectUri is required for authorization_code flow');\n        }\n        break;\n\n      case 'client_credentials':\n        if (!config.clientSecret) {\n          throw new Error('clientSecret is required for client_credentials flow');\n        }\n        break;\n\n      case 'jwt_bearer':\n        if (!config.privateKey && !config.privateKeyPath) {\n          throw new Error(\n            'privateKey or privateKeyPath is required for jwt_bearer flow'\n          );\n        }\n        break;\n\n      case 'static_token':\n        if (!config.staticToken) {\n          throw new Error('staticToken is required for static_token flow');\n        }\n        break;\n    }\n\n    // Warn if using FileStorage without encryption key\n    if (config.storage && !process.env.OAUTH_ENCRYPTION_KEY) {\n      console.warn(\n        'WARNING: Using persistent storage without OAUTH_ENCRYPTION_KEY environment variable. ' +\n          'Tokens will be encrypted with auto-generated key that changes on restart!'\n      );\n    }\n  }\n}\n","/**\n * Generic Circuit Breaker implementation\n *\n * Prevents cascading failures by failing fast when a system is down.\n * Works for any async operation (LLM calls, tool execution, etc.)\n */\n\nimport { EventEmitter } from 'eventemitter3';\n\n/**\n * Circuit breaker states\n */\nexport type CircuitState = 'closed' | 'open' | 'half-open';\n\n/**\n * Failure record for window tracking\n */\ninterface FailureRecord {\n  timestamp: number;\n  error: string;\n}\n\n/**\n * Circuit breaker configuration\n */\nexport interface CircuitBreakerConfig {\n  /** Number of failures before opening circuit */\n  failureThreshold: number;\n\n  /** Number of successes to close from half-open */\n  successThreshold: number;\n\n  /** Time to wait in open state before trying half-open (ms) */\n  resetTimeoutMs: number;\n\n  /** Time window for counting failures (ms) */\n  windowMs: number;\n\n  /** Classify errors - return true if error should count as failure */\n  isRetryable?: (error: Error) => boolean;\n}\n\n/**\n * Circuit breaker metrics\n */\nexport interface CircuitBreakerMetrics {\n  name: string;\n  state: CircuitState;\n\n  // Counters\n  totalRequests: number;\n  successCount: number;\n  failureCount: number;\n  rejectedCount: number; // Rejected by open circuit\n\n  // Current window\n  recentFailures: number;\n  consecutiveSuccesses: number;\n\n  // Timestamps\n  lastFailureTime?: number;\n  lastSuccessTime?: number;\n  lastStateChange: number;\n  nextRetryTime?: number;\n\n  // Rates\n  failureRate: number;\n  successRate: number;\n}\n\n/**\n * Circuit breaker events\n */\nexport interface CircuitBreakerEvents {\n  opened: { name: string; failureCount: number; lastError: string; nextRetryTime: number };\n  'half-open': { name: string; timestamp: number };\n  closed: { name: string; successCount: number; timestamp: number };\n}\n\n/**\n * Default configuration\n */\nexport const DEFAULT_CIRCUIT_BREAKER_CONFIG: CircuitBreakerConfig = {\n  failureThreshold: 5,\n  successThreshold: 2,\n  resetTimeoutMs: 30000, // 30 seconds\n  windowMs: 60000, // 1 minute\n  isRetryable: () => true, // All errors count by default\n};\n\n/**\n * Circuit breaker error - thrown when circuit is open\n */\nexport class CircuitOpenError extends Error {\n  constructor(\n    public readonly breakerName: string,\n    public readonly nextRetryTime: number,\n    public readonly failureCount: number,\n    public readonly lastError: string\n  ) {\n    const retryInSeconds = Math.ceil((nextRetryTime - Date.now()) / 1000);\n    super(\n      `Circuit breaker '${breakerName}' is OPEN. ` +\n      `Retry in ${retryInSeconds}s. ` +\n      `(${failureCount} recent failures, last: ${lastError})`\n    );\n    this.name = 'CircuitOpenError';\n  }\n}\n\n/**\n * Generic circuit breaker for any async operation\n */\nexport class CircuitBreaker<T = any> extends EventEmitter<CircuitBreakerEvents> {\n  private state: CircuitState = 'closed';\n  private config: CircuitBreakerConfig;\n\n  // Failure tracking\n  private failures: FailureRecord[] = [];\n  private lastError: string = '';\n\n  // Success tracking\n  private consecutiveSuccesses = 0;\n\n  // Timing\n  private openedAt?: number;\n  private lastStateChange: number;\n\n  // Metrics\n  private totalRequests = 0;\n  private successCount = 0;\n  private failureCount = 0;\n  private rejectedCount = 0;\n  private lastFailureTime?: number;\n  private lastSuccessTime?: number;\n\n  constructor(\n    public readonly name: string,\n    config: Partial<CircuitBreakerConfig> = {}\n  ) {\n    super();\n    this.config = { ...DEFAULT_CIRCUIT_BREAKER_CONFIG, ...config };\n    this.lastStateChange = Date.now();\n  }\n\n  /**\n   * Execute function with circuit breaker protection\n   */\n  async execute(fn: () => Promise<T>): Promise<T> {\n    this.totalRequests++;\n\n    // Check circuit state\n    const now = Date.now();\n\n    switch (this.state) {\n      case 'open':\n        // Check if timeout has expired\n        if (this.openedAt && now - this.openedAt >= this.config.resetTimeoutMs) {\n          // Transition to half-open\n          this.transitionTo('half-open');\n        } else {\n          // Still open, reject immediately\n          this.rejectedCount++;\n          const nextRetry = (this.openedAt || now) + this.config.resetTimeoutMs;\n          throw new CircuitOpenError(this.name, nextRetry, this.failures.length, this.lastError);\n        }\n        break;\n\n      case 'half-open':\n        // Allow one request through\n        break;\n\n      case 'closed':\n        // Normal operation\n        break;\n    }\n\n    // Execute the function\n    try {\n      const result = await fn();\n\n      // Success - record it\n      this.recordSuccess();\n\n      return result;\n    } catch (error) {\n      // Failure - record it\n      this.recordFailure(error as Error);\n\n      throw error;\n    }\n  }\n\n  /**\n   * Record successful execution\n   */\n  private recordSuccess(): void {\n    this.successCount++;\n    this.lastSuccessTime = Date.now();\n    this.consecutiveSuccesses++;\n\n    if (this.state === 'half-open') {\n      // Check if enough successes to close\n      if (this.consecutiveSuccesses >= this.config.successThreshold) {\n        this.transitionTo('closed');\n      }\n    } else if (this.state === 'closed') {\n      // Clean up old failures on success\n      this.pruneOldFailures();\n    }\n  }\n\n  /**\n   * Record failed execution\n   */\n  private recordFailure(error: Error): void {\n    // Check if error should count as failure\n    if (this.config.isRetryable && !this.config.isRetryable(error)) {\n      // Non-retryable error, don't count toward circuit breaker\n      return;\n    }\n\n    this.failureCount++;\n    this.lastFailureTime = Date.now();\n    this.lastError = error.message;\n\n    // Reset consecutive successes\n    this.consecutiveSuccesses = 0;\n\n    // Record failure\n    this.failures.push({\n      timestamp: Date.now(),\n      error: error.message,\n    });\n\n    // Prune old failures outside window\n    this.pruneOldFailures();\n\n    // Check if we should open the circuit\n    if (this.state === 'half-open') {\n      // Failure during half-open  back to open\n      this.transitionTo('open');\n    } else if (this.state === 'closed') {\n      // Check failure threshold\n      if (this.failures.length >= this.config.failureThreshold) {\n        this.transitionTo('open');\n      }\n    }\n  }\n\n  /**\n   * Transition to new state\n   */\n  private transitionTo(newState: CircuitState): void {\n    this.state = newState;\n    this.lastStateChange = Date.now();\n\n    switch (newState) {\n      case 'open':\n        this.openedAt = Date.now();\n        this.emit('opened', {\n          name: this.name,\n          failureCount: this.failures.length,\n          lastError: this.lastError,\n          nextRetryTime: this.openedAt + this.config.resetTimeoutMs,\n        });\n        break;\n\n      case 'half-open':\n        this.emit('half-open', {\n          name: this.name,\n          timestamp: Date.now(),\n        });\n        break;\n\n      case 'closed':\n        // Reset state\n        this.failures = [];\n        this.consecutiveSuccesses = 0;\n        this.openedAt = undefined;\n\n        this.emit('closed', {\n          name: this.name,\n          successCount: this.consecutiveSuccesses,\n          timestamp: Date.now(),\n        });\n        break;\n    }\n  }\n\n  /**\n   * Remove failures outside the time window\n   */\n  private pruneOldFailures(): void {\n    const now = Date.now();\n    const cutoff = now - this.config.windowMs;\n    this.failures = this.failures.filter((f) => f.timestamp > cutoff);\n  }\n\n  /**\n   * Get current state\n   */\n  getState(): CircuitState {\n    return this.state;\n  }\n\n  /**\n   * Get current metrics\n   */\n  getMetrics(): CircuitBreakerMetrics {\n    this.pruneOldFailures();\n\n    const total = this.successCount + this.failureCount;\n    const failureRate = total > 0 ? this.failureCount / total : 0;\n    const successRate = total > 0 ? this.successCount / total : 0;\n\n    return {\n      name: this.name,\n      state: this.state,\n      totalRequests: this.totalRequests,\n      successCount: this.successCount,\n      failureCount: this.failureCount,\n      rejectedCount: this.rejectedCount,\n      recentFailures: this.failures.length,\n      consecutiveSuccesses: this.consecutiveSuccesses,\n      lastFailureTime: this.lastFailureTime,\n      lastSuccessTime: this.lastSuccessTime,\n      lastStateChange: this.lastStateChange,\n      nextRetryTime: this.openedAt ? this.openedAt + this.config.resetTimeoutMs : undefined,\n      failureRate,\n      successRate,\n    };\n  }\n\n  /**\n   * Manually reset circuit breaker (force close)\n   */\n  reset(): void {\n    this.transitionTo('closed');\n    this.totalRequests = 0;\n    this.successCount = 0;\n    this.failureCount = 0;\n    this.rejectedCount = 0;\n    this.lastFailureTime = undefined;\n    this.lastSuccessTime = undefined;\n  }\n\n  /**\n   * Check if circuit is allowing requests\n   */\n  isOpen(): boolean {\n    if (this.state === 'open' && this.openedAt) {\n      const now = Date.now();\n      if (now - this.openedAt >= this.config.resetTimeoutMs) {\n        // Should transition to half-open\n        this.transitionTo('half-open');\n        return false;\n      }\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Get configuration\n   */\n  getConfig(): CircuitBreakerConfig {\n    return { ...this.config };\n  }\n}\n","/**\n * Backoff strategies for retry logic\n */\n\n/**\n * Backoff strategy type\n */\nexport type BackoffStrategyType = 'exponential' | 'linear' | 'constant';\n\n/**\n * Backoff configuration\n */\nexport interface BackoffConfig {\n  /** Strategy type */\n  strategy: BackoffStrategyType;\n\n  /** Initial delay in ms */\n  initialDelayMs: number;\n\n  /** Maximum delay in ms */\n  maxDelayMs: number;\n\n  /** Multiplier for exponential (default: 2) */\n  multiplier?: number;\n\n  /** Increment for linear (default: 1000ms) */\n  incrementMs?: number;\n\n  /** Add random jitter to prevent thundering herd */\n  jitter?: boolean;\n\n  /** Jitter factor (0-1, default: 0.1 = 10%) */\n  jitterFactor?: number;\n\n  /** Classify errors - return true if error should be retried */\n  isRetryable?: (error: Error) => boolean;\n}\n\n/**\n * Default backoff configuration\n */\nexport const DEFAULT_BACKOFF_CONFIG: BackoffConfig = {\n  strategy: 'exponential',\n  initialDelayMs: 1000, // 1 second\n  maxDelayMs: 30000, // 30 seconds\n  multiplier: 2,\n  jitter: true,\n  jitterFactor: 0.1,\n};\n\n/**\n * Calculate backoff delay for given attempt\n */\nexport function calculateBackoff(attempt: number, config: BackoffConfig = DEFAULT_BACKOFF_CONFIG): number {\n  let delay: number;\n\n  switch (config.strategy) {\n    case 'exponential':\n      delay = config.initialDelayMs * Math.pow(config.multiplier || 2, attempt - 1);\n      break;\n\n    case 'linear':\n      delay = config.initialDelayMs + (config.incrementMs || 1000) * (attempt - 1);\n      break;\n\n    case 'constant':\n      delay = config.initialDelayMs;\n      break;\n\n    default:\n      delay = config.initialDelayMs;\n  }\n\n  // Cap at max delay\n  delay = Math.min(delay, config.maxDelayMs);\n\n  // Add jitter if enabled\n  if (config.jitter) {\n    delay = addJitter(delay, config.jitterFactor || 0.1);\n  }\n\n  return Math.floor(delay);\n}\n\n/**\n * Add random jitter to a delay\n *\n * @param delay - Base delay in ms\n * @param factor - Jitter factor (0-1), default 0.1 = 10%\n * @returns delay with jitter applied\n */\nexport function addJitter(delay: number, factor: number = 0.1): number {\n  // Calculate jitter range\n  const jitterRange = delay * factor;\n\n  // Add random value in range [-jitterRange, +jitterRange]\n  const jitter = (Math.random() * 2 - 1) * jitterRange;\n\n  return delay + jitter;\n}\n\n/**\n * Wait for backoff delay\n */\nexport async function backoffWait(attempt: number, config: BackoffConfig = DEFAULT_BACKOFF_CONFIG): Promise<number> {\n  const delay = calculateBackoff(attempt, config);\n\n  await new Promise((resolve) => setTimeout(resolve, delay));\n\n  return delay;\n}\n\n/**\n * Backoff iterator - generates delays for each attempt\n */\nexport function* backoffSequence(\n  config: BackoffConfig = DEFAULT_BACKOFF_CONFIG,\n  maxAttempts?: number\n): Generator<number, void, unknown> {\n  let attempt = 1;\n\n  while (true) {\n    if (maxAttempts && attempt > maxAttempts) {\n      return;\n    }\n\n    yield calculateBackoff(attempt, config);\n    attempt++;\n  }\n}\n\n/**\n * Retry with backoff\n *\n * @param fn - Function to execute\n * @param config - Backoff configuration\n * @param maxAttempts - Max retry attempts (default: unlimited)\n * @returns Result of fn()\n */\nexport async function retryWithBackoff<T>(\n  fn: () => Promise<T>,\n  config: BackoffConfig = DEFAULT_BACKOFF_CONFIG,\n  maxAttempts?: number\n): Promise<T> {\n  let attempt = 0;\n  let lastError: Error;\n\n  while (true) {\n    attempt++;\n\n    try {\n      return await fn();\n    } catch (error) {\n      lastError = error as Error;\n\n      // Check if we should retry\n      if (config.isRetryable && !config.isRetryable(lastError)) {\n        // Non-retryable error, throw immediately\n        throw lastError;\n      }\n\n      // Check max attempts\n      if (maxAttempts && attempt >= maxAttempts) {\n        throw lastError;\n      }\n\n      // Wait before retrying\n      await backoffWait(attempt, config);\n    }\n  }\n}\n","/**\n * Structured logging infrastructure\n *\n * Provides framework-wide structured logging with context propagation.\n * Supports console output (default) with optional file output.\n *\n * Environment variables:\n * - LOG_LEVEL: trace|debug|info|warn|error|silent (default: info)\n * - LOG_FILE: Path to log file (optional, default: console output)\n * - LOG_PRETTY: true|false (default: true in development)\n */\n\nimport * as fs from 'fs';\nimport * as path from 'path';\n\n/**\n * Log level\n */\nexport type LogLevel = 'trace' | 'debug' | 'info' | 'warn' | 'error' | 'silent';\n\n/**\n * Log levels as numbers (for comparison)\n */\nconst LOG_LEVEL_VALUES: Record<LogLevel, number> = {\n  trace: 10,\n  debug: 20,\n  info: 30,\n  warn: 40,\n  error: 50,\n  silent: 100,\n};\n\n/**\n * Safe JSON stringify that handles circular references and problematic objects\n */\nfunction safeStringify(obj: unknown, indent?: number): string {\n  const seen = new WeakSet();\n\n  const replacer = (_key: string, value: unknown): unknown => {\n    // Handle null/undefined\n    if (value === null || value === undefined) {\n      return value;\n    }\n\n    // Handle primitive types\n    if (typeof value !== 'object') {\n      // Handle functions\n      if (typeof value === 'function') {\n        return '[Function]';\n      }\n      // Handle BigInt\n      if (typeof value === 'bigint') {\n        return value.toString();\n      }\n      return value;\n    }\n\n    // Handle special objects that shouldn't be serialized\n    const objValue = value as object;\n    const constructor = objValue.constructor?.name || '';\n\n    // Skip Node.js internal objects that cause circular reference issues\n    if (\n      constructor === 'Timeout' ||\n      constructor === 'TimersList' ||\n      constructor === 'Socket' ||\n      constructor === 'Server' ||\n      constructor === 'IncomingMessage' ||\n      constructor === 'ServerResponse' ||\n      constructor === 'WriteStream' ||\n      constructor === 'ReadStream' ||\n      constructor === 'EventEmitter'\n    ) {\n      return `[${constructor}]`;\n    }\n\n    // Handle circular references\n    if (seen.has(objValue)) {\n      return '[Circular]';\n    }\n\n    // Handle Error objects specially\n    if (objValue instanceof Error) {\n      return {\n        name: objValue.name,\n        message: objValue.message,\n        stack: objValue.stack,\n      };\n    }\n\n    // Handle Date\n    if (objValue instanceof Date) {\n      return objValue.toISOString();\n    }\n\n    // Handle Map\n    if (objValue instanceof Map) {\n      return Object.fromEntries(objValue);\n    }\n\n    // Handle Set\n    if (objValue instanceof Set) {\n      return Array.from(objValue);\n    }\n\n    // Handle Buffer\n    if (Buffer.isBuffer(objValue)) {\n      return `[Buffer(${objValue.length})]`;\n    }\n\n    // Add to seen set for circular reference detection\n    seen.add(objValue);\n\n    return value;\n  };\n\n  try {\n    return JSON.stringify(obj, replacer, indent);\n  } catch {\n    // Fallback if stringify still fails\n    return '[Unserializable]';\n  }\n}\n\n/**\n * Logger configuration\n */\nexport interface LoggerConfig {\n  /** Log level */\n  level?: LogLevel;\n\n  /** Pretty print for development */\n  pretty?: boolean;\n\n  /** Base context added to all logs */\n  context?: Record<string, any>;\n\n  /** Custom destination (default: console) */\n  destination?: 'console' | 'stdout' | 'stderr';\n\n  /** File path for file logging */\n  filePath?: string;\n}\n\n/**\n * Log entry\n */\nexport interface LogEntry {\n  level: LogLevel;\n  time: number;\n  msg: string;\n  [key: string]: any;\n}\n\n/**\n * Framework logger\n */\nexport class FrameworkLogger {\n  private config: LoggerConfig;\n  private context: Record<string, any>;\n  private levelValue: number;\n  private fileStream?: fs.WriteStream;\n\n  constructor(config: LoggerConfig = {}) {\n    this.config = {\n      level: (config.level || process.env.LOG_LEVEL || 'info') as LogLevel,\n      pretty: config.pretty ?? (process.env.LOG_PRETTY === 'true' || process.env.NODE_ENV === 'development'),\n      destination: config.destination || 'console',\n      context: config.context || {},\n      filePath: config.filePath || process.env.LOG_FILE,\n    };\n\n    this.context = this.config.context || {};\n    this.levelValue = LOG_LEVEL_VALUES[this.config.level || 'info'];\n\n    // Initialize file stream if file path is provided\n    if (this.config.filePath) {\n      this.initFileStream(this.config.filePath);\n    }\n  }\n\n  /**\n   * Initialize file stream for logging\n   */\n  private initFileStream(filePath: string): void {\n    try {\n      // Ensure directory exists\n      const dir = path.dirname(filePath);\n      if (!fs.existsSync(dir)) {\n        fs.mkdirSync(dir, { recursive: true });\n      }\n\n      // Create write stream with append mode\n      this.fileStream = fs.createWriteStream(filePath, {\n        flags: 'a', // append mode\n        encoding: 'utf8',\n      });\n\n      // Handle stream errors\n      this.fileStream.on('error', (err) => {\n        console.error(`[Logger] File stream error: ${err.message}`);\n        this.fileStream = undefined;\n      });\n    } catch (err) {\n      console.error(`[Logger] Failed to initialize log file: ${err instanceof Error ? err.message : err}`);\n    }\n  }\n\n  /**\n   * Create child logger with additional context\n   */\n  child(context: Record<string, any>): FrameworkLogger {\n    return new FrameworkLogger({\n      ...this.config,\n      context: { ...this.context, ...context },\n    });\n  }\n\n  /**\n   * Trace log\n   */\n  trace(obj: Record<string, any> | string, msg?: string): void {\n    this.log('trace', obj, msg);\n  }\n\n  /**\n   * Debug log\n   */\n  debug(obj: Record<string, any> | string, msg?: string): void {\n    this.log('debug', obj, msg);\n  }\n\n  /**\n   * Info log\n   */\n  info(obj: Record<string, any> | string, msg?: string): void {\n    this.log('info', obj, msg);\n  }\n\n  /**\n   * Warn log\n   */\n  warn(obj: Record<string, any> | string, msg?: string): void {\n    this.log('warn', obj, msg);\n  }\n\n  /**\n   * Error log\n   */\n  error(obj: Record<string, any> | string, msg?: string): void {\n    this.log('error', obj, msg);\n  }\n\n  /**\n   * Internal log method\n   */\n  private log(level: LogLevel, obj: Record<string, any> | string, msg?: string): void {\n    // Check if this level should be logged\n    if (LOG_LEVEL_VALUES[level] < this.levelValue) {\n      return;\n    }\n\n    // Parse arguments\n    let data: Record<string, any>;\n    let message: string;\n\n    if (typeof obj === 'string') {\n      message = obj;\n      data = {};\n    } else {\n      message = msg || '';\n      data = obj;\n    }\n\n    // Create log entry\n    const entry: LogEntry = {\n      level,\n      time: Date.now(),\n      ...this.context,\n      ...data,\n      msg: message,\n    };\n\n    // Output\n    this.output(entry);\n  }\n\n  /**\n   * Output log entry\n   */\n  private output(entry: LogEntry): void {\n    if (this.config.pretty) {\n      this.prettyPrint(entry);\n    } else {\n      this.jsonPrint(entry);\n    }\n  }\n\n  /**\n   * Pretty print for development\n   */\n  private prettyPrint(entry: LogEntry): void {\n    const levelColors: Record<LogLevel, string> = {\n      trace: '\\x1b[90m', // Gray\n      debug: '\\x1b[36m', // Cyan\n      info: '\\x1b[32m', // Green\n      warn: '\\x1b[33m', // Yellow\n      error: '\\x1b[31m', // Red\n      silent: '',\n    };\n\n    const reset = '\\x1b[0m';\n    const color = this.fileStream ? '' : levelColors[entry.level] || ''; // No colors in file\n\n    // Format time\n    const time = new Date(entry.time).toISOString().substring(11, 23);\n\n    // Format level\n    const levelStr = entry.level.toUpperCase().padEnd(5);\n\n    // Format context\n    const contextParts: string[] = [];\n    for (const [key, value] of Object.entries(entry)) {\n      if (key !== 'level' && key !== 'time' && key !== 'msg') {\n        contextParts.push(`${key}=${safeStringify(value)}`);\n      }\n    }\n    const context = contextParts.length > 0 ? ` ${contextParts.join(' ')}` : '';\n\n    // Output\n    const output = `${color}[${time}] ${levelStr}${reset} ${entry.msg}${context}`;\n\n    // Write to file if available\n    if (this.fileStream) {\n      // Strip ANSI color codes for file output\n      const cleanOutput = output.replace(/\\x1b\\[[0-9;]*m/g, '');\n      this.fileStream.write(cleanOutput + '\\n');\n      return;\n    }\n\n    // Console output\n    switch (entry.level) {\n      case 'error':\n      case 'warn':\n        console.error(output);\n        break;\n      default:\n        console.log(output);\n    }\n  }\n\n  /**\n   * JSON print for production\n   */\n  private jsonPrint(entry: LogEntry): void {\n    const json = safeStringify(entry);\n\n    // Write to file if available\n    if (this.fileStream) {\n      this.fileStream.write(json + '\\n');\n      return;\n    }\n\n    // Console output\n    switch (this.config.destination) {\n      case 'stderr':\n        console.error(json);\n        break;\n      default:\n        console.log(json);\n    }\n  }\n\n  /**\n   * Update configuration\n   */\n  updateConfig(config: Partial<LoggerConfig>): void {\n    this.config = { ...this.config, ...config };\n\n    if (config.level) {\n      this.levelValue = LOG_LEVEL_VALUES[config.level];\n    }\n\n    if (config.context) {\n      this.context = { ...this.context, ...config.context };\n    }\n\n    // Reinitialize file stream if file path changed\n    if (config.filePath !== undefined) {\n      this.closeFileStream();\n      if (config.filePath) {\n        this.initFileStream(config.filePath);\n      }\n    }\n  }\n\n  /**\n   * Close file stream\n   */\n  private closeFileStream(): void {\n    if (this.fileStream) {\n      this.fileStream.end();\n      this.fileStream = undefined;\n    }\n  }\n\n  /**\n   * Cleanup resources (call before process exit)\n   */\n  close(): void {\n    this.closeFileStream();\n  }\n\n  /**\n   * Get current log level\n   */\n  getLevel(): LogLevel {\n    return this.config.level || 'info';\n  }\n\n  /**\n   * Check if level is enabled\n   */\n  isLevelEnabled(level: LogLevel): boolean {\n    return LOG_LEVEL_VALUES[level] >= this.levelValue;\n  }\n}\n\n/**\n * Global logger singleton\n */\nexport const logger = new FrameworkLogger({\n  level: (process.env.LOG_LEVEL as LogLevel) || 'info',\n  pretty: process.env.LOG_PRETTY === 'true' || process.env.NODE_ENV === 'development',\n  filePath: process.env.LOG_FILE,\n});\n\n/**\n * Cleanup logger on process exit\n */\nprocess.on('exit', () => {\n  logger.close();\n});\n\nprocess.on('SIGINT', () => {\n  logger.close();\n  process.exit(0);\n});\n\nprocess.on('SIGTERM', () => {\n  logger.close();\n  process.exit(0);\n});\n","/**\n * Metrics collection infrastructure\n *\n * Pluggable metrics system with support for various backends.\n */\n\n/**\n * Metric tags\n */\nexport type MetricTags = Record<string, string | number | boolean>;\n\n/**\n * Metrics collector interface\n */\nexport interface MetricsCollector {\n  /**\n   * Increment a counter\n   */\n  increment(metric: string, value?: number, tags?: MetricTags): void;\n\n  /**\n   * Set a gauge value\n   */\n  gauge(metric: string, value: number, tags?: MetricTags): void;\n\n  /**\n   * Record a timing/duration\n   */\n  timing(metric: string, duration: number, tags?: MetricTags): void;\n\n  /**\n   * Record a histogram value\n   */\n  histogram(metric: string, value: number, tags?: MetricTags): void;\n}\n\n/**\n * No-op metrics collector (default - zero overhead)\n */\nexport class NoOpMetrics implements MetricsCollector {\n  increment(): void {}\n  gauge(): void {}\n  timing(): void {}\n  histogram(): void {}\n}\n\n/**\n * Console metrics collector (development/debugging)\n */\nexport class ConsoleMetrics implements MetricsCollector {\n  private prefix: string;\n\n  constructor(prefix: string = 'oneringai') {\n    this.prefix = prefix;\n  }\n\n  increment(metric: string, value: number = 1, tags?: MetricTags): void {\n    this.log('COUNTER', metric, value, tags);\n  }\n\n  gauge(metric: string, value: number, tags?: MetricTags): void {\n    this.log('GAUGE', metric, value, tags);\n  }\n\n  timing(metric: string, duration: number, tags?: MetricTags): void {\n    this.log('TIMING', metric, `${duration}ms`, tags);\n  }\n\n  histogram(metric: string, value: number, tags?: MetricTags): void {\n    this.log('HISTOGRAM', metric, value, tags);\n  }\n\n  private log(type: string, metric: string, value: any, tags?: MetricTags): void {\n    const fullMetric = `${this.prefix}.${metric}`;\n    const tagsStr = tags ? ` ${JSON.stringify(tags)}` : '';\n    console.log(`[METRIC:${type}] ${fullMetric}=${value}${tagsStr}`);\n  }\n}\n\n/**\n * In-memory metrics aggregator (testing/development)\n */\nexport class InMemoryMetrics implements MetricsCollector {\n  private counters = new Map<string, number>();\n  private gauges = new Map<string, number>();\n  private timings = new Map<string, number[]>();\n  private histograms = new Map<string, number[]>();\n\n  increment(metric: string, value: number = 1, tags?: MetricTags): void {\n    const key = this.makeKey(metric, tags);\n    this.counters.set(key, (this.counters.get(key) || 0) + value);\n  }\n\n  gauge(metric: string, value: number, tags?: MetricTags): void {\n    const key = this.makeKey(metric, tags);\n    this.gauges.set(key, value);\n  }\n\n  timing(metric: string, duration: number, tags?: MetricTags): void {\n    const key = this.makeKey(metric, tags);\n    const timings = this.timings.get(key) || [];\n    timings.push(duration);\n    this.timings.set(key, timings);\n  }\n\n  histogram(metric: string, value: number, tags?: MetricTags): void {\n    const key = this.makeKey(metric, tags);\n    const values = this.histograms.get(key) || [];\n    values.push(value);\n    this.histograms.set(key, values);\n  }\n\n  private makeKey(metric: string, tags?: MetricTags): string {\n    if (!tags) return metric;\n    const tagStr = Object.entries(tags)\n      .map(([k, v]) => `${k}:${v}`)\n      .sort()\n      .join(',');\n    return `${metric}{${tagStr}}`;\n  }\n\n  /**\n   * Get all metrics (for testing)\n   */\n  getMetrics(): {\n    counters: Map<string, number>;\n    gauges: Map<string, number>;\n    timings: Map<string, number[]>;\n    histograms: Map<string, number[]>;\n  } {\n    return {\n      counters: new Map(this.counters),\n      gauges: new Map(this.gauges),\n      timings: new Map(this.timings),\n      histograms: new Map(this.histograms),\n    };\n  }\n\n  /**\n   * Clear all metrics\n   */\n  clear(): void {\n    this.counters.clear();\n    this.gauges.clear();\n    this.timings.clear();\n    this.histograms.clear();\n  }\n\n  /**\n   * Get summary statistics for timings\n   */\n  getTimingStats(metric: string, tags?: MetricTags): {\n    count: number;\n    min: number;\n    max: number;\n    mean: number;\n    p50: number;\n    p95: number;\n    p99: number;\n  } | null {\n    const key = this.makeKey(metric, tags);\n    const timings = this.timings.get(key);\n\n    if (!timings || timings.length === 0) {\n      return null;\n    }\n\n    const sorted = [...timings].sort((a, b) => a - b);\n    const count = sorted.length;\n    const sum = sorted.reduce((a, b) => a + b, 0);\n\n    return {\n      count,\n      min: sorted[0] ?? 0,\n      max: sorted[count - 1] ?? 0,\n      mean: sum / count,\n      p50: sorted[Math.floor(count * 0.5)] ?? 0,\n      p95: sorted[Math.floor(count * 0.95)] ?? 0,\n      p99: sorted[Math.floor(count * 0.99)] ?? 0,\n    };\n  }\n}\n\n/**\n * Metrics collector type\n */\nexport type MetricsCollectorType = 'noop' | 'console' | 'inmemory';\n\n/**\n * Create metrics collector from type\n */\nexport function createMetricsCollector(type?: MetricsCollectorType, prefix?: string): MetricsCollector {\n  const collectorType = type || (process.env.METRICS_COLLECTOR as MetricsCollectorType) || 'noop';\n\n  switch (collectorType) {\n    case 'console':\n      return new ConsoleMetrics(prefix);\n    case 'inmemory':\n      return new InMemoryMetrics();\n    default:\n      return new NoOpMetrics();\n  }\n}\n\n/**\n * Global metrics singleton\n */\nexport const metrics: MetricsCollector = createMetricsCollector(\n  undefined,\n  process.env.METRICS_PREFIX || 'oneringai'\n);\n\n/**\n * Update global metrics collector\n */\nexport function setMetricsCollector(collector: MetricsCollector): void {\n  Object.assign(metrics, collector);\n}\n","/**\n * Connector - The single source of truth for authentication\n *\n * Manages authenticated connections to:\n * - AI providers (OpenAI, Anthropic, Google, etc.)\n * - External APIs (GitHub, Salesforce, etc.)\n *\n * Enterprise features:\n * - Request timeout with AbortController\n * - Circuit breaker for failing services\n * - Retry with exponential backoff\n * - Request/response logging\n */\n\nimport { ConnectorConfig, ConnectorAuth } from '../domain/entities/Connector.js';\nimport { Vendor } from './Vendor.js';\nimport { OAuthManager } from '../connectors/oauth/OAuthManager.js';\nimport { MemoryStorage } from '../connectors/oauth/infrastructure/storage/MemoryStorage.js';\nimport type { ITokenStorage } from '../connectors/oauth/domain/ITokenStorage.js';\nimport { CircuitBreaker } from '../infrastructure/resilience/CircuitBreaker.js';\nimport { calculateBackoff, BackoffConfig } from '../infrastructure/resilience/BackoffStrategy.js';\nimport { logger } from '../infrastructure/observability/Logger.js';\nimport { metrics } from '../infrastructure/observability/Metrics.js';\n\n/**\n * Default configuration values for resilience features\n */\nexport const DEFAULT_CONNECTOR_TIMEOUT = 30000; // 30 seconds\nexport const DEFAULT_MAX_RETRIES = 3;\nexport const DEFAULT_RETRYABLE_STATUSES = [429, 500, 502, 503, 504];\nexport const DEFAULT_BASE_DELAY_MS = 1000;\nexport const DEFAULT_MAX_DELAY_MS = 30000;\n\n/**\n * Fetch options with additional connector-specific settings\n */\nexport interface ConnectorFetchOptions extends RequestInit {\n  /** Override timeout for this request */\n  timeout?: number;\n  /** Skip retry for this request */\n  skipRetry?: boolean;\n  /** Skip circuit breaker for this request */\n  skipCircuitBreaker?: boolean;\n}\n\n/**\n * Connector class - represents a single authenticated connection\n */\nexport class Connector {\n  // ============ Static Registry ============\n\n  private static registry: Map<string, Connector> = new Map();\n  private static defaultStorage: ITokenStorage = new MemoryStorage();\n\n  /**\n   * Create and register a new connector\n   * @param config - Must include `name` field\n   */\n  static create(config: ConnectorConfig & { name: string }): Connector {\n    if (!config.name || config.name.trim().length === 0) {\n      throw new Error('Connector name is required');\n    }\n    if (Connector.registry.has(config.name)) {\n      throw new Error(`Connector '${config.name}' already exists. Use Connector.get() or choose a different name.`);\n    }\n    const connector = new Connector(config);\n    Connector.registry.set(config.name, connector);\n    return connector;\n  }\n\n  /**\n   * Get a connector by name\n   */\n  static get(name: string): Connector {\n    const connector = Connector.registry.get(name);\n    if (!connector) {\n      const available = Connector.list().join(', ') || 'none';\n      throw new Error(`Connector '${name}' not found. Available: ${available}`);\n    }\n    return connector;\n  }\n\n  /**\n   * Check if a connector exists\n   */\n  static has(name: string): boolean {\n    return Connector.registry.has(name);\n  }\n\n  /**\n   * List all registered connector names\n   */\n  static list(): string[] {\n    return Array.from(Connector.registry.keys());\n  }\n\n  /**\n   * Remove a connector\n   */\n  static remove(name: string): boolean {\n    const connector = Connector.registry.get(name);\n    if (connector) {\n      connector.dispose();\n    }\n    return Connector.registry.delete(name);\n  }\n\n  /**\n   * Clear all connectors (useful for testing)\n   */\n  static clear(): void {\n    for (const connector of Connector.registry.values()) {\n      connector.dispose();\n    }\n    Connector.registry.clear();\n  }\n\n  /**\n   * Set default token storage for OAuth connectors\n   */\n  static setDefaultStorage(storage: ITokenStorage): void {\n    Connector.defaultStorage = storage;\n  }\n\n  /**\n   * Get all registered connectors\n   */\n  static listAll(): Connector[] {\n    return Array.from(Connector.registry.values());\n  }\n\n  /**\n   * Get number of registered connectors\n   */\n  static size(): number {\n    return Connector.registry.size;\n  }\n\n  /**\n   * Get connector descriptions formatted for tool parameters\n   * Useful for generating dynamic tool descriptions\n   */\n  static getDescriptionsForTools(): string {\n    const connectors = Connector.listAll();\n\n    if (connectors.length === 0) {\n      return 'No connectors registered yet.';\n    }\n\n    return connectors\n      .map((c) => `  - \"${c.name}\": ${c.displayName} - ${c.config.description || 'No description'}`)\n      .join('\\n');\n  }\n\n  /**\n   * Get connector info (for tools and documentation)\n   */\n  static getInfo(): Record<string, { displayName: string; description: string; baseURL: string }> {\n    const info: Record<string, { displayName: string; description: string; baseURL: string }> = {};\n\n    for (const connector of Connector.registry.values()) {\n      info[connector.name] = {\n        displayName: connector.displayName,\n        description: connector.config.description || '',\n        baseURL: connector.baseURL,\n      };\n    }\n\n    return info;\n  }\n\n  // ============ Instance ============\n\n  readonly name: string;\n  readonly vendor?: Vendor;\n  readonly config: ConnectorConfig;\n\n  private oauthManager?: OAuthManager;\n  private circuitBreaker?: CircuitBreaker;\n  private disposed = false;\n\n  // Metrics\n  private requestCount = 0;\n  private successCount = 0;\n  private failureCount = 0;\n  private totalLatencyMs = 0;\n\n  private constructor(config: ConnectorConfig & { name: string }) {\n    this.name = config.name;\n    this.vendor = config.vendor;\n    this.config = config;\n\n    // Initialize OAuth manager for OAuth and JWT auth types\n    if (config.auth.type === 'oauth') {\n      this.initOAuthManager(config.auth);\n    } else if (config.auth.type === 'jwt') {\n      this.initJWTManager(config.auth);\n    }\n\n    // Initialize circuit breaker if enabled (default: true)\n    this.initCircuitBreaker();\n  }\n\n  /**\n   * Initialize circuit breaker with config or defaults\n   */\n  private initCircuitBreaker(): void {\n    const cbConfig = this.config.circuitBreaker;\n    const enabled = cbConfig?.enabled ?? true;\n\n    if (enabled) {\n      this.circuitBreaker = new CircuitBreaker(`connector:${this.name}`, {\n        failureThreshold: cbConfig?.failureThreshold ?? 5,\n        successThreshold: cbConfig?.successThreshold ?? 2,\n        resetTimeoutMs: cbConfig?.resetTimeoutMs ?? 30000,\n        windowMs: 60000, // 1 minute window\n        isRetryable: (error) => {\n          // Don't count client errors (4xx except 429) as circuit breaker failures\n          if (error.message.includes('HTTP 4') && !error.message.includes('HTTP 429')) {\n            return false;\n          }\n          return true;\n        },\n      });\n\n      // Log circuit breaker state changes\n      this.circuitBreaker.on('opened', ({ name, failureCount, lastError }) => {\n        logger.warn(`Circuit breaker opened for ${name}: ${failureCount} failures, last error: ${lastError}`);\n        metrics.increment('connector.circuit_breaker.opened', 1, { connector: this.name });\n      });\n\n      this.circuitBreaker.on('closed', ({ name }) => {\n        logger.info(`Circuit breaker closed for ${name}`);\n        metrics.increment('connector.circuit_breaker.closed', 1, { connector: this.name });\n      });\n    }\n  }\n\n  /**\n   * Human-readable display name\n   */\n  get displayName(): string {\n    return this.config.displayName || this.name;\n  }\n\n  /**\n   * API base URL for this connector\n   */\n  get baseURL(): string {\n    return this.config.baseURL || '';\n  }\n\n  /**\n   * Get the API key (for api_key auth type)\n   */\n  getApiKey(): string {\n    if (this.config.auth.type !== 'api_key') {\n      throw new Error(`Connector '${this.name}' does not use API key auth. Type: ${this.config.auth.type}`);\n    }\n    return this.config.auth.apiKey;\n  }\n\n  /**\n   * Get the current access token (for OAuth, JWT, or API key)\n   * Handles automatic refresh if needed\n   */\n  async getToken(userId?: string): Promise<string> {\n    if (this.config.auth.type === 'api_key') {\n      return this.config.auth.apiKey;\n    }\n\n    // OAuth and JWT both use OAuthManager\n    if (!this.oauthManager) {\n      throw new Error(`OAuth manager not initialized for connector '${this.name}'`);\n    }\n\n    return this.oauthManager.getToken(userId);\n  }\n\n  /**\n   * Start OAuth authorization flow\n   * Returns the URL to redirect the user to\n   */\n  async startAuth(userId?: string): Promise<string> {\n    if (!this.oauthManager) {\n      throw new Error(`Connector '${this.name}' is not an OAuth connector`);\n    }\n    return this.oauthManager.startAuthFlow(userId);\n  }\n\n  /**\n   * Handle OAuth callback\n   * Call this after user is redirected back from OAuth provider\n   */\n  async handleCallback(callbackUrl: string, userId?: string): Promise<void> {\n    if (!this.oauthManager) {\n      throw new Error(`Connector '${this.name}' is not an OAuth connector`);\n    }\n    await this.oauthManager.handleCallback(callbackUrl, userId);\n  }\n\n  /**\n   * Check if the connector has a valid token\n   */\n  async hasValidToken(userId?: string): Promise<boolean> {\n    try {\n      if (this.config.auth.type === 'api_key') {\n        return true; // API keys are always \"valid\" (we don't validate them)\n      }\n      if (this.oauthManager) {\n        const token = await this.oauthManager.getToken(userId);\n        return !!token;\n      }\n      return false;\n    } catch {\n      return false;\n    }\n  }\n\n  /**\n   * Get vendor-specific options from config\n   */\n  getOptions(): Record<string, unknown> {\n    return this.config.options ?? {};\n  }\n\n  /**\n   * Get the service type (explicit or undefined)\n   */\n  get serviceType(): string | undefined {\n    return this.config.serviceType;\n  }\n\n  /**\n   * Get connector metrics\n   */\n  getMetrics(): {\n    requestCount: number;\n    successCount: number;\n    failureCount: number;\n    avgLatencyMs: number;\n    circuitBreakerState?: string;\n  } {\n    return {\n      requestCount: this.requestCount,\n      successCount: this.successCount,\n      failureCount: this.failureCount,\n      avgLatencyMs: this.requestCount > 0 ? this.totalLatencyMs / this.requestCount : 0,\n      circuitBreakerState: this.circuitBreaker?.getState(),\n    };\n  }\n\n  /**\n   * Reset circuit breaker (force close)\n   */\n  resetCircuitBreaker(): void {\n    this.circuitBreaker?.reset();\n  }\n\n  /**\n   * Make an authenticated fetch request using this connector\n   * This is the foundation for all vendor-dependent tools\n   *\n   * Features:\n   * - Timeout with AbortController\n   * - Circuit breaker protection\n   * - Retry with exponential backoff\n   * - Request/response logging\n   *\n   * @param endpoint - API endpoint (relative to baseURL) or full URL\n   * @param options - Fetch options with connector-specific settings\n   * @param userId - Optional user ID for multi-user OAuth\n   * @returns Fetch Response\n   */\n  async fetch(\n    endpoint: string,\n    options?: ConnectorFetchOptions,\n    userId?: string\n  ): Promise<Response> {\n    // Check if disposed\n    if (this.disposed) {\n      throw new Error(`Connector '${this.name}' has been disposed`);\n    }\n\n    const startTime = Date.now();\n    this.requestCount++;\n\n    // Resolve URL\n    const url = endpoint.startsWith('http') ? endpoint : `${this.baseURL}${endpoint}`;\n\n    // Get timeout\n    const timeout = options?.timeout ?? this.config.timeout ?? DEFAULT_CONNECTOR_TIMEOUT;\n\n    // Log request if enabled\n    if (this.config.logging?.enabled) {\n      this.logRequest(url, options);\n    }\n\n    // Build the actual fetch function\n    const doFetch = async (): Promise<Response> => {\n      // Get token (may involve refresh)\n      const token = await this.getToken(userId);\n      const auth = this.config.auth;\n\n      // Build auth header\n      let headerName = 'Authorization';\n      let headerValue = `Bearer ${token}`;\n\n      if (auth.type === 'api_key') {\n        headerName = auth.headerName || 'Authorization';\n        const prefix = auth.headerPrefix ?? 'Bearer';\n        headerValue = prefix ? `${prefix} ${token}` : token;\n      }\n\n      // Create abort controller for timeout\n      const controller = new AbortController();\n      const timeoutId = setTimeout(() => controller.abort(), timeout);\n\n      try {\n        const response = await fetch(url, {\n          ...options,\n          signal: controller.signal,\n          headers: {\n            ...options?.headers,\n            [headerName]: headerValue,\n          },\n        });\n\n        return response;\n      } finally {\n        clearTimeout(timeoutId);\n      }\n    };\n\n    // Build retry wrapper\n    const doFetchWithRetry = async (): Promise<Response> => {\n      const retryConfig = this.config.retry;\n      const maxRetries = retryConfig?.maxRetries ?? DEFAULT_MAX_RETRIES;\n      const retryableStatuses = retryConfig?.retryableStatuses ?? DEFAULT_RETRYABLE_STATUSES;\n      const baseDelayMs = retryConfig?.baseDelayMs ?? DEFAULT_BASE_DELAY_MS;\n      const maxDelayMs = retryConfig?.maxDelayMs ?? DEFAULT_MAX_DELAY_MS;\n\n      const backoffConfig: BackoffConfig = {\n        strategy: 'exponential',\n        initialDelayMs: baseDelayMs,\n        maxDelayMs: maxDelayMs,\n        multiplier: 2,\n        jitter: true,\n        jitterFactor: 0.1,\n      };\n\n      let lastError: Error | undefined;\n      let lastResponse: Response | undefined;\n\n      for (let attempt = 1; attempt <= maxRetries + 1; attempt++) {\n        try {\n          const response = await doFetch();\n\n          // Check if we should retry based on status code\n          if (!response.ok && retryableStatuses.includes(response.status) && attempt <= maxRetries) {\n            lastResponse = response;\n            const delay = calculateBackoff(attempt, backoffConfig);\n\n            if (this.config.logging?.enabled) {\n              logger.debug(`Connector ${this.name}: Retry ${attempt}/${maxRetries} after ${delay}ms (status ${response.status})`);\n            }\n\n            await this.sleep(delay);\n            continue;\n          }\n\n          return response;\n        } catch (error) {\n          lastError = error as Error;\n\n          // Don't retry on abort (timeout)\n          if (lastError.name === 'AbortError') {\n            throw new Error(`Request timeout after ${timeout}ms: ${url}`);\n          }\n\n          // Retry on network errors\n          if (attempt <= maxRetries && !options?.skipRetry) {\n            const delay = calculateBackoff(attempt, backoffConfig);\n\n            if (this.config.logging?.enabled) {\n              logger.debug(`Connector ${this.name}: Retry ${attempt}/${maxRetries} after ${delay}ms (error: ${lastError.message})`);\n            }\n\n            await this.sleep(delay);\n            continue;\n          }\n\n          throw lastError;\n        }\n      }\n\n      // If we exhausted retries with a response, return it\n      if (lastResponse) {\n        return lastResponse;\n      }\n\n      // Otherwise throw the last error\n      throw lastError ?? new Error('Unknown error during fetch');\n    };\n\n    try {\n      let response: Response;\n\n      // Wrap with circuit breaker if enabled and not skipped\n      if (this.circuitBreaker && !options?.skipCircuitBreaker) {\n        response = await this.circuitBreaker.execute(doFetchWithRetry);\n      } else {\n        response = await doFetchWithRetry();\n      }\n\n      // Record success\n      const latency = Date.now() - startTime;\n      this.successCount++;\n      this.totalLatencyMs += latency;\n      metrics.timing('connector.latency', latency, { connector: this.name });\n      metrics.increment('connector.success', 1, { connector: this.name });\n\n      // Log response if enabled\n      if (this.config.logging?.enabled) {\n        this.logResponse(url, response, latency);\n      }\n\n      return response;\n    } catch (error) {\n      // Record failure\n      const latency = Date.now() - startTime;\n      this.failureCount++;\n      this.totalLatencyMs += latency;\n      metrics.increment('connector.failure', 1, { connector: this.name, error: (error as Error).name });\n\n      // Log error\n      if (this.config.logging?.enabled) {\n        logger.error(\n          { connector: this.name, url, latency, error: (error as Error).message },\n          `Connector ${this.name} fetch failed: ${(error as Error).message}`\n        );\n      }\n\n      throw error;\n    }\n  }\n\n  /**\n   * Make an authenticated fetch request and parse JSON response\n   * Throws on non-OK responses\n   *\n   * @param endpoint - API endpoint (relative to baseURL) or full URL\n   * @param options - Fetch options with connector-specific settings\n   * @param userId - Optional user ID for multi-user OAuth\n   * @returns Parsed JSON response\n   */\n  async fetchJSON<T = unknown>(\n    endpoint: string,\n    options?: ConnectorFetchOptions,\n    userId?: string\n  ): Promise<T> {\n    const response = await this.fetch(endpoint, options, userId);\n\n    // Try to parse response body\n    const text = await response.text();\n    let data: T;\n\n    try {\n      data = JSON.parse(text) as T;\n    } catch {\n      if (!response.ok) {\n        throw new Error(`HTTP ${response.status}: ${text}`);\n      }\n      throw new Error(`Invalid JSON response: ${text.slice(0, 100)}`);\n    }\n\n    if (!response.ok) {\n      // Include parsed error in message if available\n      const errorMsg = typeof data === 'object' && data !== null ? JSON.stringify(data) : text;\n      throw new Error(`HTTP ${response.status}: ${errorMsg}`);\n    }\n\n    return data;\n  }\n\n  // ============ Private Helpers ============\n\n  private sleep(ms: number): Promise<void> {\n    return new Promise((resolve) => setTimeout(resolve, ms));\n  }\n\n  private logRequest(url: string, options?: RequestInit): void {\n    const logData: Record<string, unknown> = {\n      connector: this.name,\n      method: options?.method ?? 'GET',\n      url,\n    };\n\n    if (this.config.logging?.logHeaders && options?.headers) {\n      // Redact sensitive headers\n      const headers = { ...options.headers } as Record<string, string>;\n      if (headers['Authorization']) {\n        headers['Authorization'] = '[REDACTED]';\n      }\n      if (headers['authorization']) {\n        headers['authorization'] = '[REDACTED]';\n      }\n      logData.headers = headers;\n    }\n\n    if (this.config.logging?.logBody && options?.body) {\n      logData.body = typeof options.body === 'string' ? options.body.slice(0, 1000) : '[non-string body]';\n    }\n\n    logger.debug(logData, `Connector ${this.name} request`);\n  }\n\n  private logResponse(url: string, response: Response, latency: number): void {\n    logger.debug(\n      { connector: this.name, url, status: response.status, latency },\n      `Connector ${this.name} response`\n    );\n  }\n\n  /**\n   * Dispose of resources\n   */\n  dispose(): void {\n    if (this.disposed) return;\n    this.disposed = true;\n    // Clean up resources\n    this.oauthManager = undefined;\n    this.circuitBreaker = undefined;\n  }\n\n  /**\n   * Check if connector is disposed\n   */\n  isDisposed(): boolean {\n    return this.disposed;\n  }\n\n  // ============ Private ============\n\n  private initOAuthManager(auth: ConnectorAuth & { type: 'oauth' }): void {\n    // Convert ConnectorAuth to OAuthConfig\n    const oauthConfig = {\n      flow: auth.flow as 'authorization_code' | 'client_credentials' | 'jwt_bearer',\n      clientId: auth.clientId,\n      clientSecret: auth.clientSecret,\n      tokenUrl: auth.tokenUrl,\n      authorizationUrl: auth.authorizationUrl,\n      redirectUri: auth.redirectUri,\n      scope: auth.scope,\n      usePKCE: auth.usePKCE,\n      privateKey: auth.privateKey,\n      privateKeyPath: auth.privateKeyPath,\n      audience: auth.audience,\n      refreshBeforeExpiry: auth.refreshBeforeExpiry,\n      storage: Connector.defaultStorage,\n      storageKey: auth.storageKey ?? this.name,\n    };\n\n    this.oauthManager = new OAuthManager(oauthConfig);\n  }\n\n  private initJWTManager(auth: ConnectorAuth & { type: 'jwt' }): void {\n    // JWT uses jwt_bearer flow via OAuthManager\n    this.oauthManager = new OAuthManager({\n      flow: 'jwt_bearer',\n      clientId: auth.clientId,\n      tokenUrl: auth.tokenUrl,\n      privateKey: auth.privateKey,\n      privateKeyPath: auth.privateKeyPath,\n      scope: auth.scope,\n      audience: auth.audience,\n      storage: Connector.defaultStorage,\n      storageKey: this.name,\n    });\n  }\n}\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nvar pathModule = require('path');\nvar isWindows = process.platform === 'win32';\nvar fs = require('fs');\n\n// JavaScript implementation of realpath, ported from node pre-v6\n\nvar DEBUG = process.env.NODE_DEBUG && /fs/.test(process.env.NODE_DEBUG);\n\nfunction rethrow() {\n  // Only enable in debug mode. A backtrace uses ~1000 bytes of heap space and\n  // is fairly slow to generate.\n  var callback;\n  if (DEBUG) {\n    var backtrace = new Error;\n    callback = debugCallback;\n  } else\n    callback = missingCallback;\n\n  return callback;\n\n  function debugCallback(err) {\n    if (err) {\n      backtrace.message = err.message;\n      err = backtrace;\n      missingCallback(err);\n    }\n  }\n\n  function missingCallback(err) {\n    if (err) {\n      if (process.throwDeprecation)\n        throw err;  // Forgot a callback but don't know where? Use NODE_DEBUG=fs\n      else if (!process.noDeprecation) {\n        var msg = 'fs: missing callback ' + (err.stack || err.message);\n        if (process.traceDeprecation)\n          console.trace(msg);\n        else\n          console.error(msg);\n      }\n    }\n  }\n}\n\nfunction maybeCallback(cb) {\n  return typeof cb === 'function' ? cb : rethrow();\n}\n\nvar normalize = pathModule.normalize;\n\n// Regexp that finds the next partion of a (partial) path\n// result is [base_with_slash, base], e.g. ['somedir/', 'somedir']\nif (isWindows) {\n  var nextPartRe = /(.*?)(?:[\\/\\\\]+|$)/g;\n} else {\n  var nextPartRe = /(.*?)(?:[\\/]+|$)/g;\n}\n\n// Regex to find the device root, including trailing slash. E.g. 'c:\\\\'.\nif (isWindows) {\n  var splitRootRe = /^(?:[a-zA-Z]:|[\\\\\\/]{2}[^\\\\\\/]+[\\\\\\/][^\\\\\\/]+)?[\\\\\\/]*/;\n} else {\n  var splitRootRe = /^[\\/]*/;\n}\n\nexports.realpathSync = function realpathSync(p, cache) {\n  // make p is absolute\n  p = pathModule.resolve(p);\n\n  if (cache && Object.prototype.hasOwnProperty.call(cache, p)) {\n    return cache[p];\n  }\n\n  var original = p,\n      seenLinks = {},\n      knownHard = {};\n\n  // current character position in p\n  var pos;\n  // the partial path so far, including a trailing slash if any\n  var current;\n  // the partial path without a trailing slash (except when pointing at a root)\n  var base;\n  // the partial path scanned in the previous round, with slash\n  var previous;\n\n  start();\n\n  function start() {\n    // Skip over roots\n    var m = splitRootRe.exec(p);\n    pos = m[0].length;\n    current = m[0];\n    base = m[0];\n    previous = '';\n\n    // On windows, check that the root exists. On unix there is no need.\n    if (isWindows && !knownHard[base]) {\n      fs.lstatSync(base);\n      knownHard[base] = true;\n    }\n  }\n\n  // walk down the path, swapping out linked pathparts for their real\n  // values\n  // NB: p.length changes.\n  while (pos < p.length) {\n    // find the next part\n    nextPartRe.lastIndex = pos;\n    var result = nextPartRe.exec(p);\n    previous = current;\n    current += result[0];\n    base = previous + result[1];\n    pos = nextPartRe.lastIndex;\n\n    // continue if not a symlink\n    if (knownHard[base] || (cache && cache[base] === base)) {\n      continue;\n    }\n\n    var resolvedLink;\n    if (cache && Object.prototype.hasOwnProperty.call(cache, base)) {\n      // some known symbolic link.  no need to stat again.\n      resolvedLink = cache[base];\n    } else {\n      var stat = fs.lstatSync(base);\n      if (!stat.isSymbolicLink()) {\n        knownHard[base] = true;\n        if (cache) cache[base] = base;\n        continue;\n      }\n\n      // read the link if it wasn't read before\n      // dev/ino always return 0 on windows, so skip the check.\n      var linkTarget = null;\n      if (!isWindows) {\n        var id = stat.dev.toString(32) + ':' + stat.ino.toString(32);\n        if (seenLinks.hasOwnProperty(id)) {\n          linkTarget = seenLinks[id];\n        }\n      }\n      if (linkTarget === null) {\n        fs.statSync(base);\n        linkTarget = fs.readlinkSync(base);\n      }\n      resolvedLink = pathModule.resolve(previous, linkTarget);\n      // track this, if given a cache.\n      if (cache) cache[base] = resolvedLink;\n      if (!isWindows) seenLinks[id] = linkTarget;\n    }\n\n    // resolve the link, then start over\n    p = pathModule.resolve(resolvedLink, p.slice(pos));\n    start();\n  }\n\n  if (cache) cache[original] = p;\n\n  return p;\n};\n\n\nexports.realpath = function realpath(p, cache, cb) {\n  if (typeof cb !== 'function') {\n    cb = maybeCallback(cache);\n    cache = null;\n  }\n\n  // make p is absolute\n  p = pathModule.resolve(p);\n\n  if (cache && Object.prototype.hasOwnProperty.call(cache, p)) {\n    return process.nextTick(cb.bind(null, null, cache[p]));\n  }\n\n  var original = p,\n      seenLinks = {},\n      knownHard = {};\n\n  // current character position in p\n  var pos;\n  // the partial path so far, including a trailing slash if any\n  var current;\n  // the partial path without a trailing slash (except when pointing at a root)\n  var base;\n  // the partial path scanned in the previous round, with slash\n  var previous;\n\n  start();\n\n  function start() {\n    // Skip over roots\n    var m = splitRootRe.exec(p);\n    pos = m[0].length;\n    current = m[0];\n    base = m[0];\n    previous = '';\n\n    // On windows, check that the root exists. On unix there is no need.\n    if (isWindows && !knownHard[base]) {\n      fs.lstat(base, function(err) {\n        if (err) return cb(err);\n        knownHard[base] = true;\n        LOOP();\n      });\n    } else {\n      process.nextTick(LOOP);\n    }\n  }\n\n  // walk down the path, swapping out linked pathparts for their real\n  // values\n  function LOOP() {\n    // stop if scanned past end of path\n    if (pos >= p.length) {\n      if (cache) cache[original] = p;\n      return cb(null, p);\n    }\n\n    // find the next part\n    nextPartRe.lastIndex = pos;\n    var result = nextPartRe.exec(p);\n    previous = current;\n    current += result[0];\n    base = previous + result[1];\n    pos = nextPartRe.lastIndex;\n\n    // continue if not a symlink\n    if (knownHard[base] || (cache && cache[base] === base)) {\n      return process.nextTick(LOOP);\n    }\n\n    if (cache && Object.prototype.hasOwnProperty.call(cache, base)) {\n      // known symbolic link.  no need to stat again.\n      return gotResolvedLink(cache[base]);\n    }\n\n    return fs.lstat(base, gotStat);\n  }\n\n  function gotStat(err, stat) {\n    if (err) return cb(err);\n\n    // if not a symlink, skip to the next path part\n    if (!stat.isSymbolicLink()) {\n      knownHard[base] = true;\n      if (cache) cache[base] = base;\n      return process.nextTick(LOOP);\n    }\n\n    // stat & read the link if not read before\n    // call gotTarget as soon as the link target is known\n    // dev/ino always return 0 on windows, so skip the check.\n    if (!isWindows) {\n      var id = stat.dev.toString(32) + ':' + stat.ino.toString(32);\n      if (seenLinks.hasOwnProperty(id)) {\n        return gotTarget(null, seenLinks[id], base);\n      }\n    }\n    fs.stat(base, function(err) {\n      if (err) return cb(err);\n\n      fs.readlink(base, function(err, target) {\n        if (!isWindows) seenLinks[id] = target;\n        gotTarget(err, target);\n      });\n    });\n  }\n\n  function gotTarget(err, target, base) {\n    if (err) return cb(err);\n\n    var resolvedLink = pathModule.resolve(previous, target);\n    if (cache) cache[base] = resolvedLink;\n    gotResolvedLink(resolvedLink);\n  }\n\n  function gotResolvedLink(resolvedLink) {\n    // resolve the link, then start over\n    p = pathModule.resolve(resolvedLink, p.slice(pos));\n    start();\n  }\n};\n","module.exports = realpath\nrealpath.realpath = realpath\nrealpath.sync = realpathSync\nrealpath.realpathSync = realpathSync\nrealpath.monkeypatch = monkeypatch\nrealpath.unmonkeypatch = unmonkeypatch\n\nvar fs = require('fs')\nvar origRealpath = fs.realpath\nvar origRealpathSync = fs.realpathSync\n\nvar version = process.version\nvar ok = /^v[0-5]\\./.test(version)\nvar old = require('./old.js')\n\nfunction newError (er) {\n  return er && er.syscall === 'realpath' && (\n    er.code === 'ELOOP' ||\n    er.code === 'ENOMEM' ||\n    er.code === 'ENAMETOOLONG'\n  )\n}\n\nfunction realpath (p, cache, cb) {\n  if (ok) {\n    return origRealpath(p, cache, cb)\n  }\n\n  if (typeof cache === 'function') {\n    cb = cache\n    cache = null\n  }\n  origRealpath(p, cache, function (er, result) {\n    if (newError(er)) {\n      old.realpath(p, cache, cb)\n    } else {\n      cb(er, result)\n    }\n  })\n}\n\nfunction realpathSync (p, cache) {\n  if (ok) {\n    return origRealpathSync(p, cache)\n  }\n\n  try {\n    return origRealpathSync(p, cache)\n  } catch (er) {\n    if (newError(er)) {\n      return old.realpathSync(p, cache)\n    } else {\n      throw er\n    }\n  }\n}\n\nfunction monkeypatch () {\n  fs.realpath = realpath\n  fs.realpathSync = realpathSync\n}\n\nfunction unmonkeypatch () {\n  fs.realpath = origRealpath\n  fs.realpathSync = origRealpathSync\n}\n","module.exports = function (xs, fn) {\n    var res = [];\n    for (var i = 0; i < xs.length; i++) {\n        var x = fn(xs[i], i);\n        if (isArray(x)) res.push.apply(res, x);\n        else res.push(x);\n    }\n    return res;\n};\n\nvar isArray = Array.isArray || function (xs) {\n    return Object.prototype.toString.call(xs) === '[object Array]';\n};\n","'use strict';\nmodule.exports = balanced;\nfunction balanced(a, b, str) {\n  if (a instanceof RegExp) a = maybeMatch(a, str);\n  if (b instanceof RegExp) b = maybeMatch(b, str);\n\n  var r = range(a, b, str);\n\n  return r && {\n    start: r[0],\n    end: r[1],\n    pre: str.slice(0, r[0]),\n    body: str.slice(r[0] + a.length, r[1]),\n    post: str.slice(r[1] + b.length)\n  };\n}\n\nfunction maybeMatch(reg, str) {\n  var m = str.match(reg);\n  return m ? m[0] : null;\n}\n\nbalanced.range = range;\nfunction range(a, b, str) {\n  var begs, beg, left, right, result;\n  var ai = str.indexOf(a);\n  var bi = str.indexOf(b, ai + 1);\n  var i = ai;\n\n  if (ai >= 0 && bi > 0) {\n    if(a===b) {\n      return [ai, bi];\n    }\n    begs = [];\n    left = str.length;\n\n    while (i >= 0 && !result) {\n      if (i == ai) {\n        begs.push(i);\n        ai = str.indexOf(a, i + 1);\n      } else if (begs.length == 1) {\n        result = [ begs.pop(), bi ];\n      } else {\n        beg = begs.pop();\n        if (beg < left) {\n          left = beg;\n          right = bi;\n        }\n\n        bi = str.indexOf(b, i + 1);\n      }\n\n      i = ai < bi && ai >= 0 ? ai : bi;\n    }\n\n    if (begs.length) {\n      result = [ left, right ];\n    }\n  }\n\n  return result;\n}\n","var concatMap = require('concat-map');\nvar balanced = require('balanced-match');\n\nmodule.exports = expandTop;\n\nvar escSlash = '\\0SLASH'+Math.random()+'\\0';\nvar escOpen = '\\0OPEN'+Math.random()+'\\0';\nvar escClose = '\\0CLOSE'+Math.random()+'\\0';\nvar escComma = '\\0COMMA'+Math.random()+'\\0';\nvar escPeriod = '\\0PERIOD'+Math.random()+'\\0';\n\nfunction numeric(str) {\n  return parseInt(str, 10) == str\n    ? parseInt(str, 10)\n    : str.charCodeAt(0);\n}\n\nfunction escapeBraces(str) {\n  return str.split('\\\\\\\\').join(escSlash)\n            .split('\\\\{').join(escOpen)\n            .split('\\\\}').join(escClose)\n            .split('\\\\,').join(escComma)\n            .split('\\\\.').join(escPeriod);\n}\n\nfunction unescapeBraces(str) {\n  return str.split(escSlash).join('\\\\')\n            .split(escOpen).join('{')\n            .split(escClose).join('}')\n            .split(escComma).join(',')\n            .split(escPeriod).join('.');\n}\n\n\n// Basically just str.split(\",\"), but handling cases\n// where we have nested braced sections, which should be\n// treated as individual members, like {a,{b,c},d}\nfunction parseCommaParts(str) {\n  if (!str)\n    return [''];\n\n  var parts = [];\n  var m = balanced('{', '}', str);\n\n  if (!m)\n    return str.split(',');\n\n  var pre = m.pre;\n  var body = m.body;\n  var post = m.post;\n  var p = pre.split(',');\n\n  p[p.length-1] += '{' + body + '}';\n  var postParts = parseCommaParts(post);\n  if (post.length) {\n    p[p.length-1] += postParts.shift();\n    p.push.apply(p, postParts);\n  }\n\n  parts.push.apply(parts, p);\n\n  return parts;\n}\n\nfunction expandTop(str) {\n  if (!str)\n    return [];\n\n  // I don't know why Bash 4.3 does this, but it does.\n  // Anything starting with {} will have the first two bytes preserved\n  // but *only* at the top level, so {},a}b will not expand to anything,\n  // but a{},b}c will be expanded to [a}c,abc].\n  // One could argue that this is a bug in Bash, but since the goal of\n  // this module is to match Bash's rules, we escape a leading {}\n  if (str.substr(0, 2) === '{}') {\n    str = '\\\\{\\\\}' + str.substr(2);\n  }\n\n  return expand(escapeBraces(str), true).map(unescapeBraces);\n}\n\nfunction identity(e) {\n  return e;\n}\n\nfunction embrace(str) {\n  return '{' + str + '}';\n}\nfunction isPadded(el) {\n  return /^-?0\\d/.test(el);\n}\n\nfunction lte(i, y) {\n  return i <= y;\n}\nfunction gte(i, y) {\n  return i >= y;\n}\n\nfunction expand(str, isTop) {\n  var expansions = [];\n\n  var m = balanced('{', '}', str);\n  if (!m || /\\$$/.test(m.pre)) return [str];\n\n  var isNumericSequence = /^-?\\d+\\.\\.-?\\d+(?:\\.\\.-?\\d+)?$/.test(m.body);\n  var isAlphaSequence = /^[a-zA-Z]\\.\\.[a-zA-Z](?:\\.\\.-?\\d+)?$/.test(m.body);\n  var isSequence = isNumericSequence || isAlphaSequence;\n  var isOptions = m.body.indexOf(',') >= 0;\n  if (!isSequence && !isOptions) {\n    // {a},b}\n    if (m.post.match(/,(?!,).*\\}/)) {\n      str = m.pre + '{' + m.body + escClose + m.post;\n      return expand(str);\n    }\n    return [str];\n  }\n\n  var n;\n  if (isSequence) {\n    n = m.body.split(/\\.\\./);\n  } else {\n    n = parseCommaParts(m.body);\n    if (n.length === 1) {\n      // x{{a,b}}y ==> x{a}y x{b}y\n      n = expand(n[0], false).map(embrace);\n      if (n.length === 1) {\n        var post = m.post.length\n          ? expand(m.post, false)\n          : [''];\n        return post.map(function(p) {\n          return m.pre + n[0] + p;\n        });\n      }\n    }\n  }\n\n  // at this point, n is the parts, and we know it's not a comma set\n  // with a single entry.\n\n  // no need to expand pre, since it is guaranteed to be free of brace-sets\n  var pre = m.pre;\n  var post = m.post.length\n    ? expand(m.post, false)\n    : [''];\n\n  var N;\n\n  if (isSequence) {\n    var x = numeric(n[0]);\n    var y = numeric(n[1]);\n    var width = Math.max(n[0].length, n[1].length)\n    var incr = n.length == 3\n      ? Math.abs(numeric(n[2]))\n      : 1;\n    var test = lte;\n    var reverse = y < x;\n    if (reverse) {\n      incr *= -1;\n      test = gte;\n    }\n    var pad = n.some(isPadded);\n\n    N = [];\n\n    for (var i = x; test(i, y); i += incr) {\n      var c;\n      if (isAlphaSequence) {\n        c = String.fromCharCode(i);\n        if (c === '\\\\')\n          c = '';\n      } else {\n        c = String(i);\n        if (pad) {\n          var need = width - c.length;\n          if (need > 0) {\n            var z = new Array(need + 1).join('0');\n            if (i < 0)\n              c = '-' + z + c.slice(1);\n            else\n              c = z + c;\n          }\n        }\n      }\n      N.push(c);\n    }\n  } else {\n    N = concatMap(n, function(el) { return expand(el, false) });\n  }\n\n  for (var j = 0; j < N.length; j++) {\n    for (var k = 0; k < post.length; k++) {\n      var expansion = pre + N[j] + post[k];\n      if (!isTop || isSequence || expansion)\n        expansions.push(expansion);\n    }\n  }\n\n  return expansions;\n}\n\n","module.exports = minimatch\nminimatch.Minimatch = Minimatch\n\nvar path = (function () { try { return require('path') } catch (e) {}}()) || {\n  sep: '/'\n}\nminimatch.sep = path.sep\n\nvar GLOBSTAR = minimatch.GLOBSTAR = Minimatch.GLOBSTAR = {}\nvar expand = require('brace-expansion')\n\nvar plTypes = {\n  '!': { open: '(?:(?!(?:', close: '))[^/]*?)'},\n  '?': { open: '(?:', close: ')?' },\n  '+': { open: '(?:', close: ')+' },\n  '*': { open: '(?:', close: ')*' },\n  '@': { open: '(?:', close: ')' }\n}\n\n// any single thing other than /\n// don't need to escape / when using new RegExp()\nvar qmark = '[^/]'\n\n// * => any number of characters\nvar star = qmark + '*?'\n\n// ** when dots are allowed.  Anything goes, except .. and .\n// not (^ or / followed by one or two dots followed by $ or /),\n// followed by anything, any number of times.\nvar twoStarDot = '(?:(?!(?:\\\\\\/|^)(?:\\\\.{1,2})($|\\\\\\/)).)*?'\n\n// not a ^ or / followed by a dot,\n// followed by anything, any number of times.\nvar twoStarNoDot = '(?:(?!(?:\\\\\\/|^)\\\\.).)*?'\n\n// characters that need to be escaped in RegExp.\nvar reSpecials = charSet('().*{}+?[]^$\\\\!')\n\n// \"abc\" -> { a:true, b:true, c:true }\nfunction charSet (s) {\n  return s.split('').reduce(function (set, c) {\n    set[c] = true\n    return set\n  }, {})\n}\n\n// normalizes slashes.\nvar slashSplit = /\\/+/\n\nminimatch.filter = filter\nfunction filter (pattern, options) {\n  options = options || {}\n  return function (p, i, list) {\n    return minimatch(p, pattern, options)\n  }\n}\n\nfunction ext (a, b) {\n  b = b || {}\n  var t = {}\n  Object.keys(a).forEach(function (k) {\n    t[k] = a[k]\n  })\n  Object.keys(b).forEach(function (k) {\n    t[k] = b[k]\n  })\n  return t\n}\n\nminimatch.defaults = function (def) {\n  if (!def || typeof def !== 'object' || !Object.keys(def).length) {\n    return minimatch\n  }\n\n  var orig = minimatch\n\n  var m = function minimatch (p, pattern, options) {\n    return orig(p, pattern, ext(def, options))\n  }\n\n  m.Minimatch = function Minimatch (pattern, options) {\n    return new orig.Minimatch(pattern, ext(def, options))\n  }\n  m.Minimatch.defaults = function defaults (options) {\n    return orig.defaults(ext(def, options)).Minimatch\n  }\n\n  m.filter = function filter (pattern, options) {\n    return orig.filter(pattern, ext(def, options))\n  }\n\n  m.defaults = function defaults (options) {\n    return orig.defaults(ext(def, options))\n  }\n\n  m.makeRe = function makeRe (pattern, options) {\n    return orig.makeRe(pattern, ext(def, options))\n  }\n\n  m.braceExpand = function braceExpand (pattern, options) {\n    return orig.braceExpand(pattern, ext(def, options))\n  }\n\n  m.match = function (list, pattern, options) {\n    return orig.match(list, pattern, ext(def, options))\n  }\n\n  return m\n}\n\nMinimatch.defaults = function (def) {\n  return minimatch.defaults(def).Minimatch\n}\n\nfunction minimatch (p, pattern, options) {\n  assertValidPattern(pattern)\n\n  if (!options) options = {}\n\n  // shortcut: comments match nothing.\n  if (!options.nocomment && pattern.charAt(0) === '#') {\n    return false\n  }\n\n  return new Minimatch(pattern, options).match(p)\n}\n\nfunction Minimatch (pattern, options) {\n  if (!(this instanceof Minimatch)) {\n    return new Minimatch(pattern, options)\n  }\n\n  assertValidPattern(pattern)\n\n  if (!options) options = {}\n\n  pattern = pattern.trim()\n\n  // windows support: need to use /, not \\\n  if (!options.allowWindowsEscape && path.sep !== '/') {\n    pattern = pattern.split(path.sep).join('/')\n  }\n\n  this.options = options\n  this.set = []\n  this.pattern = pattern\n  this.regexp = null\n  this.negate = false\n  this.comment = false\n  this.empty = false\n  this.partial = !!options.partial\n\n  // make the set of regexps etc.\n  this.make()\n}\n\nMinimatch.prototype.debug = function () {}\n\nMinimatch.prototype.make = make\nfunction make () {\n  var pattern = this.pattern\n  var options = this.options\n\n  // empty patterns and comments match nothing.\n  if (!options.nocomment && pattern.charAt(0) === '#') {\n    this.comment = true\n    return\n  }\n  if (!pattern) {\n    this.empty = true\n    return\n  }\n\n  // step 1: figure out negation, etc.\n  this.parseNegate()\n\n  // step 2: expand braces\n  var set = this.globSet = this.braceExpand()\n\n  if (options.debug) this.debug = function debug() { console.error.apply(console, arguments) }\n\n  this.debug(this.pattern, set)\n\n  // step 3: now we have a set, so turn each one into a series of path-portion\n  // matching patterns.\n  // These will be regexps, except in the case of \"**\", which is\n  // set to the GLOBSTAR object for globstar behavior,\n  // and will not contain any / characters\n  set = this.globParts = set.map(function (s) {\n    return s.split(slashSplit)\n  })\n\n  this.debug(this.pattern, set)\n\n  // glob --> regexps\n  set = set.map(function (s, si, set) {\n    return s.map(this.parse, this)\n  }, this)\n\n  this.debug(this.pattern, set)\n\n  // filter out everything that didn't compile properly.\n  set = set.filter(function (s) {\n    return s.indexOf(false) === -1\n  })\n\n  this.debug(this.pattern, set)\n\n  this.set = set\n}\n\nMinimatch.prototype.parseNegate = parseNegate\nfunction parseNegate () {\n  var pattern = this.pattern\n  var negate = false\n  var options = this.options\n  var negateOffset = 0\n\n  if (options.nonegate) return\n\n  for (var i = 0, l = pattern.length\n    ; i < l && pattern.charAt(i) === '!'\n    ; i++) {\n    negate = !negate\n    negateOffset++\n  }\n\n  if (negateOffset) this.pattern = pattern.substr(negateOffset)\n  this.negate = negate\n}\n\n// Brace expansion:\n// a{b,c}d -> abd acd\n// a{b,}c -> abc ac\n// a{0..3}d -> a0d a1d a2d a3d\n// a{b,c{d,e}f}g -> abg acdfg acefg\n// a{b,c}d{e,f}g -> abdeg acdeg abdeg abdfg\n//\n// Invalid sets are not expanded.\n// a{2..}b -> a{2..}b\n// a{b}c -> a{b}c\nminimatch.braceExpand = function (pattern, options) {\n  return braceExpand(pattern, options)\n}\n\nMinimatch.prototype.braceExpand = braceExpand\n\nfunction braceExpand (pattern, options) {\n  if (!options) {\n    if (this instanceof Minimatch) {\n      options = this.options\n    } else {\n      options = {}\n    }\n  }\n\n  pattern = typeof pattern === 'undefined'\n    ? this.pattern : pattern\n\n  assertValidPattern(pattern)\n\n  // Thanks to Yeting Li <https://github.com/yetingli> for\n  // improving this regexp to avoid a ReDOS vulnerability.\n  if (options.nobrace || !/\\{(?:(?!\\{).)*\\}/.test(pattern)) {\n    // shortcut. no need to expand.\n    return [pattern]\n  }\n\n  return expand(pattern)\n}\n\nvar MAX_PATTERN_LENGTH = 1024 * 64\nvar assertValidPattern = function (pattern) {\n  if (typeof pattern !== 'string') {\n    throw new TypeError('invalid pattern')\n  }\n\n  if (pattern.length > MAX_PATTERN_LENGTH) {\n    throw new TypeError('pattern is too long')\n  }\n}\n\n// parse a component of the expanded set.\n// At this point, no pattern may contain \"/\" in it\n// so we're going to return a 2d array, where each entry is the full\n// pattern, split on '/', and then turned into a regular expression.\n// A regexp is made at the end which joins each array with an\n// escaped /, and another full one which joins each regexp with |.\n//\n// Following the lead of Bash 4.1, note that \"**\" only has special meaning\n// when it is the *only* thing in a path portion.  Otherwise, any series\n// of * is equivalent to a single *.  Globstar behavior is enabled by\n// default, and can be disabled by setting options.noglobstar.\nMinimatch.prototype.parse = parse\nvar SUBPARSE = {}\nfunction parse (pattern, isSub) {\n  assertValidPattern(pattern)\n\n  var options = this.options\n\n  // shortcuts\n  if (pattern === '**') {\n    if (!options.noglobstar)\n      return GLOBSTAR\n    else\n      pattern = '*'\n  }\n  if (pattern === '') return ''\n\n  var re = ''\n  var hasMagic = !!options.nocase\n  var escaping = false\n  // ? => one single character\n  var patternListStack = []\n  var negativeLists = []\n  var stateChar\n  var inClass = false\n  var reClassStart = -1\n  var classStart = -1\n  // . and .. never match anything that doesn't start with .,\n  // even when options.dot is set.\n  var patternStart = pattern.charAt(0) === '.' ? '' // anything\n  // not (start or / followed by . or .. followed by / or end)\n  : options.dot ? '(?!(?:^|\\\\\\/)\\\\.{1,2}(?:$|\\\\\\/))'\n  : '(?!\\\\.)'\n  var self = this\n\n  function clearStateChar () {\n    if (stateChar) {\n      // we had some state-tracking character\n      // that wasn't consumed by this pass.\n      switch (stateChar) {\n        case '*':\n          re += star\n          hasMagic = true\n        break\n        case '?':\n          re += qmark\n          hasMagic = true\n        break\n        default:\n          re += '\\\\' + stateChar\n        break\n      }\n      self.debug('clearStateChar %j %j', stateChar, re)\n      stateChar = false\n    }\n  }\n\n  for (var i = 0, len = pattern.length, c\n    ; (i < len) && (c = pattern.charAt(i))\n    ; i++) {\n    this.debug('%s\\t%s %s %j', pattern, i, re, c)\n\n    // skip over any that are escaped.\n    if (escaping && reSpecials[c]) {\n      re += '\\\\' + c\n      escaping = false\n      continue\n    }\n\n    switch (c) {\n      /* istanbul ignore next */\n      case '/': {\n        // completely not allowed, even escaped.\n        // Should already be path-split by now.\n        return false\n      }\n\n      case '\\\\':\n        clearStateChar()\n        escaping = true\n      continue\n\n      // the various stateChar values\n      // for the \"extglob\" stuff.\n      case '?':\n      case '*':\n      case '+':\n      case '@':\n      case '!':\n        this.debug('%s\\t%s %s %j <-- stateChar', pattern, i, re, c)\n\n        // all of those are literals inside a class, except that\n        // the glob [!a] means [^a] in regexp\n        if (inClass) {\n          this.debug('  in class')\n          if (c === '!' && i === classStart + 1) c = '^'\n          re += c\n          continue\n        }\n\n        // if we already have a stateChar, then it means\n        // that there was something like ** or +? in there.\n        // Handle the stateChar, then proceed with this one.\n        self.debug('call clearStateChar %j', stateChar)\n        clearStateChar()\n        stateChar = c\n        // if extglob is disabled, then +(asdf|foo) isn't a thing.\n        // just clear the statechar *now*, rather than even diving into\n        // the patternList stuff.\n        if (options.noext) clearStateChar()\n      continue\n\n      case '(':\n        if (inClass) {\n          re += '('\n          continue\n        }\n\n        if (!stateChar) {\n          re += '\\\\('\n          continue\n        }\n\n        patternListStack.push({\n          type: stateChar,\n          start: i - 1,\n          reStart: re.length,\n          open: plTypes[stateChar].open,\n          close: plTypes[stateChar].close\n        })\n        // negation is (?:(?!js)[^/]*)\n        re += stateChar === '!' ? '(?:(?!(?:' : '(?:'\n        this.debug('plType %j %j', stateChar, re)\n        stateChar = false\n      continue\n\n      case ')':\n        if (inClass || !patternListStack.length) {\n          re += '\\\\)'\n          continue\n        }\n\n        clearStateChar()\n        hasMagic = true\n        var pl = patternListStack.pop()\n        // negation is (?:(?!js)[^/]*)\n        // The others are (?:<pattern>)<type>\n        re += pl.close\n        if (pl.type === '!') {\n          negativeLists.push(pl)\n        }\n        pl.reEnd = re.length\n      continue\n\n      case '|':\n        if (inClass || !patternListStack.length || escaping) {\n          re += '\\\\|'\n          escaping = false\n          continue\n        }\n\n        clearStateChar()\n        re += '|'\n      continue\n\n      // these are mostly the same in regexp and glob\n      case '[':\n        // swallow any state-tracking char before the [\n        clearStateChar()\n\n        if (inClass) {\n          re += '\\\\' + c\n          continue\n        }\n\n        inClass = true\n        classStart = i\n        reClassStart = re.length\n        re += c\n      continue\n\n      case ']':\n        //  a right bracket shall lose its special\n        //  meaning and represent itself in\n        //  a bracket expression if it occurs\n        //  first in the list.  -- POSIX.2 2.8.3.2\n        if (i === classStart + 1 || !inClass) {\n          re += '\\\\' + c\n          escaping = false\n          continue\n        }\n\n        // handle the case where we left a class open.\n        // \"[z-a]\" is valid, equivalent to \"\\[z-a\\]\"\n        // split where the last [ was, make sure we don't have\n        // an invalid re. if so, re-walk the contents of the\n        // would-be class to re-translate any characters that\n        // were passed through as-is\n        // TODO: It would probably be faster to determine this\n        // without a try/catch and a new RegExp, but it's tricky\n        // to do safely.  For now, this is safe and works.\n        var cs = pattern.substring(classStart + 1, i)\n        try {\n          RegExp('[' + cs + ']')\n        } catch (er) {\n          // not a valid class!\n          var sp = this.parse(cs, SUBPARSE)\n          re = re.substr(0, reClassStart) + '\\\\[' + sp[0] + '\\\\]'\n          hasMagic = hasMagic || sp[1]\n          inClass = false\n          continue\n        }\n\n        // finish up the class.\n        hasMagic = true\n        inClass = false\n        re += c\n      continue\n\n      default:\n        // swallow any state char that wasn't consumed\n        clearStateChar()\n\n        if (escaping) {\n          // no need\n          escaping = false\n        } else if (reSpecials[c]\n          && !(c === '^' && inClass)) {\n          re += '\\\\'\n        }\n\n        re += c\n\n    } // switch\n  } // for\n\n  // handle the case where we left a class open.\n  // \"[abc\" is valid, equivalent to \"\\[abc\"\n  if (inClass) {\n    // split where the last [ was, and escape it\n    // this is a huge pita.  We now have to re-walk\n    // the contents of the would-be class to re-translate\n    // any characters that were passed through as-is\n    cs = pattern.substr(classStart + 1)\n    sp = this.parse(cs, SUBPARSE)\n    re = re.substr(0, reClassStart) + '\\\\[' + sp[0]\n    hasMagic = hasMagic || sp[1]\n  }\n\n  // handle the case where we had a +( thing at the *end*\n  // of the pattern.\n  // each pattern list stack adds 3 chars, and we need to go through\n  // and escape any | chars that were passed through as-is for the regexp.\n  // Go through and escape them, taking care not to double-escape any\n  // | chars that were already escaped.\n  for (pl = patternListStack.pop(); pl; pl = patternListStack.pop()) {\n    var tail = re.slice(pl.reStart + pl.open.length)\n    this.debug('setting tail', re, pl)\n    // maybe some even number of \\, then maybe 1 \\, followed by a |\n    tail = tail.replace(/((?:\\\\{2}){0,64})(\\\\?)\\|/g, function (_, $1, $2) {\n      if (!$2) {\n        // the | isn't already escaped, so escape it.\n        $2 = '\\\\'\n      }\n\n      // need to escape all those slashes *again*, without escaping the\n      // one that we need for escaping the | character.  As it works out,\n      // escaping an even number of slashes can be done by simply repeating\n      // it exactly after itself.  That's why this trick works.\n      //\n      // I am sorry that you have to see this.\n      return $1 + $1 + $2 + '|'\n    })\n\n    this.debug('tail=%j\\n   %s', tail, tail, pl, re)\n    var t = pl.type === '*' ? star\n      : pl.type === '?' ? qmark\n      : '\\\\' + pl.type\n\n    hasMagic = true\n    re = re.slice(0, pl.reStart) + t + '\\\\(' + tail\n  }\n\n  // handle trailing things that only matter at the very end.\n  clearStateChar()\n  if (escaping) {\n    // trailing \\\\\n    re += '\\\\\\\\'\n  }\n\n  // only need to apply the nodot start if the re starts with\n  // something that could conceivably capture a dot\n  var addPatternStart = false\n  switch (re.charAt(0)) {\n    case '[': case '.': case '(': addPatternStart = true\n  }\n\n  // Hack to work around lack of negative lookbehind in JS\n  // A pattern like: *.!(x).!(y|z) needs to ensure that a name\n  // like 'a.xyz.yz' doesn't match.  So, the first negative\n  // lookahead, has to look ALL the way ahead, to the end of\n  // the pattern.\n  for (var n = negativeLists.length - 1; n > -1; n--) {\n    var nl = negativeLists[n]\n\n    var nlBefore = re.slice(0, nl.reStart)\n    var nlFirst = re.slice(nl.reStart, nl.reEnd - 8)\n    var nlLast = re.slice(nl.reEnd - 8, nl.reEnd)\n    var nlAfter = re.slice(nl.reEnd)\n\n    nlLast += nlAfter\n\n    // Handle nested stuff like *(*.js|!(*.json)), where open parens\n    // mean that we should *not* include the ) in the bit that is considered\n    // \"after\" the negated section.\n    var openParensBefore = nlBefore.split('(').length - 1\n    var cleanAfter = nlAfter\n    for (i = 0; i < openParensBefore; i++) {\n      cleanAfter = cleanAfter.replace(/\\)[+*?]?/, '')\n    }\n    nlAfter = cleanAfter\n\n    var dollar = ''\n    if (nlAfter === '' && isSub !== SUBPARSE) {\n      dollar = '$'\n    }\n    var newRe = nlBefore + nlFirst + nlAfter + dollar + nlLast\n    re = newRe\n  }\n\n  // if the re is not \"\" at this point, then we need to make sure\n  // it doesn't match against an empty path part.\n  // Otherwise a/* will match a/, which it should not.\n  if (re !== '' && hasMagic) {\n    re = '(?=.)' + re\n  }\n\n  if (addPatternStart) {\n    re = patternStart + re\n  }\n\n  // parsing just a piece of a larger pattern.\n  if (isSub === SUBPARSE) {\n    return [re, hasMagic]\n  }\n\n  // skip the regexp for non-magical patterns\n  // unescape anything in it, though, so that it'll be\n  // an exact match against a file etc.\n  if (!hasMagic) {\n    return globUnescape(pattern)\n  }\n\n  var flags = options.nocase ? 'i' : ''\n  try {\n    var regExp = new RegExp('^' + re + '$', flags)\n  } catch (er) /* istanbul ignore next - should be impossible */ {\n    // If it was an invalid regular expression, then it can't match\n    // anything.  This trick looks for a character after the end of\n    // the string, which is of course impossible, except in multi-line\n    // mode, but it's not a /m regex.\n    return new RegExp('$.')\n  }\n\n  regExp._glob = pattern\n  regExp._src = re\n\n  return regExp\n}\n\nminimatch.makeRe = function (pattern, options) {\n  return new Minimatch(pattern, options || {}).makeRe()\n}\n\nMinimatch.prototype.makeRe = makeRe\nfunction makeRe () {\n  if (this.regexp || this.regexp === false) return this.regexp\n\n  // at this point, this.set is a 2d array of partial\n  // pattern strings, or \"**\".\n  //\n  // It's better to use .match().  This function shouldn't\n  // be used, really, but it's pretty convenient sometimes,\n  // when you just want to work with a regex.\n  var set = this.set\n\n  if (!set.length) {\n    this.regexp = false\n    return this.regexp\n  }\n  var options = this.options\n\n  var twoStar = options.noglobstar ? star\n    : options.dot ? twoStarDot\n    : twoStarNoDot\n  var flags = options.nocase ? 'i' : ''\n\n  var re = set.map(function (pattern) {\n    return pattern.map(function (p) {\n      return (p === GLOBSTAR) ? twoStar\n      : (typeof p === 'string') ? regExpEscape(p)\n      : p._src\n    }).join('\\\\\\/')\n  }).join('|')\n\n  // must match entire pattern\n  // ending in a * or ** will make it less strict.\n  re = '^(?:' + re + ')$'\n\n  // can match anything, as long as it's not this.\n  if (this.negate) re = '^(?!' + re + ').*$'\n\n  try {\n    this.regexp = new RegExp(re, flags)\n  } catch (ex) /* istanbul ignore next - should be impossible */ {\n    this.regexp = false\n  }\n  return this.regexp\n}\n\nminimatch.match = function (list, pattern, options) {\n  options = options || {}\n  var mm = new Minimatch(pattern, options)\n  list = list.filter(function (f) {\n    return mm.match(f)\n  })\n  if (mm.options.nonull && !list.length) {\n    list.push(pattern)\n  }\n  return list\n}\n\nMinimatch.prototype.match = function match (f, partial) {\n  if (typeof partial === 'undefined') partial = this.partial\n  this.debug('match', f, this.pattern)\n  // short-circuit in the case of busted things.\n  // comments, etc.\n  if (this.comment) return false\n  if (this.empty) return f === ''\n\n  if (f === '/' && partial) return true\n\n  var options = this.options\n\n  // windows: need to use /, not \\\n  if (path.sep !== '/') {\n    f = f.split(path.sep).join('/')\n  }\n\n  // treat the test path as a set of pathparts.\n  f = f.split(slashSplit)\n  this.debug(this.pattern, 'split', f)\n\n  // just ONE of the pattern sets in this.set needs to match\n  // in order for it to be valid.  If negating, then just one\n  // match means that we have failed.\n  // Either way, return on the first hit.\n\n  var set = this.set\n  this.debug(this.pattern, 'set', set)\n\n  // Find the basename of the path by looking for the last non-empty segment\n  var filename\n  var i\n  for (i = f.length - 1; i >= 0; i--) {\n    filename = f[i]\n    if (filename) break\n  }\n\n  for (i = 0; i < set.length; i++) {\n    var pattern = set[i]\n    var file = f\n    if (options.matchBase && pattern.length === 1) {\n      file = [filename]\n    }\n    var hit = this.matchOne(file, pattern, partial)\n    if (hit) {\n      if (options.flipNegate) return true\n      return !this.negate\n    }\n  }\n\n  // didn't get any hits.  this is success if it's a negative\n  // pattern, failure otherwise.\n  if (options.flipNegate) return false\n  return this.negate\n}\n\n// set partial to true to test if, for example,\n// \"/a/b\" matches the start of \"/*/b/*/d\"\n// Partial means, if you run out of file before you run\n// out of pattern, then that's fine, as long as all\n// the parts match.\nMinimatch.prototype.matchOne = function (file, pattern, partial) {\n  var options = this.options\n\n  this.debug('matchOne',\n    { 'this': this, file: file, pattern: pattern })\n\n  this.debug('matchOne', file.length, pattern.length)\n\n  for (var fi = 0,\n      pi = 0,\n      fl = file.length,\n      pl = pattern.length\n      ; (fi < fl) && (pi < pl)\n      ; fi++, pi++) {\n    this.debug('matchOne loop')\n    var p = pattern[pi]\n    var f = file[fi]\n\n    this.debug(pattern, p, f)\n\n    // should be impossible.\n    // some invalid regexp stuff in the set.\n    /* istanbul ignore if */\n    if (p === false) return false\n\n    if (p === GLOBSTAR) {\n      this.debug('GLOBSTAR', [pattern, p, f])\n\n      // \"**\"\n      // a/**/b/**/c would match the following:\n      // a/b/x/y/z/c\n      // a/x/y/z/b/c\n      // a/b/x/b/x/c\n      // a/b/c\n      // To do this, take the rest of the pattern after\n      // the **, and see if it would match the file remainder.\n      // If so, return success.\n      // If not, the ** \"swallows\" a segment, and try again.\n      // This is recursively awful.\n      //\n      // a/**/b/**/c matching a/b/x/y/z/c\n      // - a matches a\n      // - doublestar\n      //   - matchOne(b/x/y/z/c, b/**/c)\n      //     - b matches b\n      //     - doublestar\n      //       - matchOne(x/y/z/c, c) -> no\n      //       - matchOne(y/z/c, c) -> no\n      //       - matchOne(z/c, c) -> no\n      //       - matchOne(c, c) yes, hit\n      var fr = fi\n      var pr = pi + 1\n      if (pr === pl) {\n        this.debug('** at the end')\n        // a ** at the end will just swallow the rest.\n        // We have found a match.\n        // however, it will not swallow /.x, unless\n        // options.dot is set.\n        // . and .. are *never* matched by **, for explosively\n        // exponential reasons.\n        for (; fi < fl; fi++) {\n          if (file[fi] === '.' || file[fi] === '..' ||\n            (!options.dot && file[fi].charAt(0) === '.')) return false\n        }\n        return true\n      }\n\n      // ok, let's see if we can swallow whatever we can.\n      while (fr < fl) {\n        var swallowee = file[fr]\n\n        this.debug('\\nglobstar while', file, fr, pattern, pr, swallowee)\n\n        // XXX remove this slice.  Just pass the start index.\n        if (this.matchOne(file.slice(fr), pattern.slice(pr), partial)) {\n          this.debug('globstar found match!', fr, fl, swallowee)\n          // found a match.\n          return true\n        } else {\n          // can't swallow \".\" or \"..\" ever.\n          // can only swallow \".foo\" when explicitly asked.\n          if (swallowee === '.' || swallowee === '..' ||\n            (!options.dot && swallowee.charAt(0) === '.')) {\n            this.debug('dot detected!', file, fr, pattern, pr)\n            break\n          }\n\n          // ** swallows a segment, and continue.\n          this.debug('globstar swallow a segment, and continue')\n          fr++\n        }\n      }\n\n      // no match was found.\n      // However, in partial mode, we can't say this is necessarily over.\n      // If there's more *pattern* left, then\n      /* istanbul ignore if */\n      if (partial) {\n        // ran out of file\n        this.debug('\\n>>> no match, partial?', file, fr, pattern, pr)\n        if (fr === fl) return true\n      }\n      return false\n    }\n\n    // something other than **\n    // non-magic patterns just have to match exactly\n    // patterns with magic have been turned into regexps.\n    var hit\n    if (typeof p === 'string') {\n      hit = f === p\n      this.debug('string match', p, f, hit)\n    } else {\n      hit = f.match(p)\n      this.debug('pattern match', p, f, hit)\n    }\n\n    if (!hit) return false\n  }\n\n  // Note: ending in / means that we'll get a final \"\"\n  // at the end of the pattern.  This can only match a\n  // corresponding \"\" at the end of the file.\n  // If the file ends in /, then it can only match a\n  // a pattern that ends in /, unless the pattern just\n  // doesn't have any more for it. But, a/b/ should *not*\n  // match \"a/b/*\", even though \"\" matches against the\n  // [^/]*? pattern, except in partial mode, where it might\n  // simply not be reached yet.\n  // However, a/b/ should still satisfy a/*\n\n  // now either we fell off the end of the pattern, or we're done.\n  if (fi === fl && pi === pl) {\n    // ran out of pattern and filename at the same time.\n    // an exact hit!\n    return true\n  } else if (fi === fl) {\n    // ran out of file, but still had pattern left.\n    // this is ok if we're doing the match as part of\n    // a glob fs traversal.\n    return partial\n  } else /* istanbul ignore else */ if (pi === pl) {\n    // ran out of pattern, still have file left.\n    // this is only acceptable if we're on the very last\n    // empty segment of a file with a trailing slash.\n    // a/* should match a/b/\n    return (fi === fl - 1) && (file[fi] === '')\n  }\n\n  // should be unreachable.\n  /* istanbul ignore next */\n  throw new Error('wtf?')\n}\n\n// replace stuff like \\* with *\nfunction globUnescape (s) {\n  return s.replace(/\\\\(.)/g, '$1')\n}\n\nfunction regExpEscape (s) {\n  return s.replace(/[-[\\]{}()*+?.,\\\\^$|#\\s]/g, '\\\\$&')\n}\n","if (typeof Object.create === 'function') {\n  // implementation from standard node.js 'util' module\n  module.exports = function inherits(ctor, superCtor) {\n    if (superCtor) {\n      ctor.super_ = superCtor\n      ctor.prototype = Object.create(superCtor.prototype, {\n        constructor: {\n          value: ctor,\n          enumerable: false,\n          writable: true,\n          configurable: true\n        }\n      })\n    }\n  };\n} else {\n  // old school shim for old browsers\n  module.exports = function inherits(ctor, superCtor) {\n    if (superCtor) {\n      ctor.super_ = superCtor\n      var TempCtor = function () {}\n      TempCtor.prototype = superCtor.prototype\n      ctor.prototype = new TempCtor()\n      ctor.prototype.constructor = ctor\n    }\n  }\n}\n","try {\n  var util = require('util');\n  /* istanbul ignore next */\n  if (typeof util.inherits !== 'function') throw '';\n  module.exports = util.inherits;\n} catch (e) {\n  /* istanbul ignore next */\n  module.exports = require('./inherits_browser.js');\n}\n","'use strict';\n\nfunction posix(path) {\n\treturn path.charAt(0) === '/';\n}\n\nfunction win32(path) {\n\t// https://github.com/nodejs/node/blob/b3fcc245fb25539909ef1d5eaa01dbf92e168633/lib/path.js#L56\n\tvar splitDeviceRe = /^([a-zA-Z]:|[\\\\\\/]{2}[^\\\\\\/]+[\\\\\\/]+[^\\\\\\/]+)?([\\\\\\/])?([\\s\\S]*?)$/;\n\tvar result = splitDeviceRe.exec(path);\n\tvar device = result[1] || '';\n\tvar isUnc = Boolean(device && device.charAt(1) !== ':');\n\n\t// UNC paths are always absolute\n\treturn Boolean(result[2] || isUnc);\n}\n\nmodule.exports = process.platform === 'win32' ? win32 : posix;\nmodule.exports.posix = posix;\nmodule.exports.win32 = win32;\n","exports.setopts = setopts\nexports.ownProp = ownProp\nexports.makeAbs = makeAbs\nexports.finish = finish\nexports.mark = mark\nexports.isIgnored = isIgnored\nexports.childrenIgnored = childrenIgnored\n\nfunction ownProp (obj, field) {\n  return Object.prototype.hasOwnProperty.call(obj, field)\n}\n\nvar fs = require(\"fs\")\nvar path = require(\"path\")\nvar minimatch = require(\"minimatch\")\nvar isAbsolute = require(\"path-is-absolute\")\nvar Minimatch = minimatch.Minimatch\n\nfunction alphasort (a, b) {\n  return a.localeCompare(b, 'en')\n}\n\nfunction setupIgnores (self, options) {\n  self.ignore = options.ignore || []\n\n  if (!Array.isArray(self.ignore))\n    self.ignore = [self.ignore]\n\n  if (self.ignore.length) {\n    self.ignore = self.ignore.map(ignoreMap)\n  }\n}\n\n// ignore patterns are always in dot:true mode.\nfunction ignoreMap (pattern) {\n  var gmatcher = null\n  if (pattern.slice(-3) === '/**') {\n    var gpattern = pattern.replace(/(\\/\\*\\*)+$/, '')\n    gmatcher = new Minimatch(gpattern, { dot: true })\n  }\n\n  return {\n    matcher: new Minimatch(pattern, { dot: true }),\n    gmatcher: gmatcher\n  }\n}\n\nfunction setopts (self, pattern, options) {\n  if (!options)\n    options = {}\n\n  // base-matching: just use globstar for that.\n  if (options.matchBase && -1 === pattern.indexOf(\"/\")) {\n    if (options.noglobstar) {\n      throw new Error(\"base matching requires globstar\")\n    }\n    pattern = \"**/\" + pattern\n  }\n\n  self.silent = !!options.silent\n  self.pattern = pattern\n  self.strict = options.strict !== false\n  self.realpath = !!options.realpath\n  self.realpathCache = options.realpathCache || Object.create(null)\n  self.follow = !!options.follow\n  self.dot = !!options.dot\n  self.mark = !!options.mark\n  self.nodir = !!options.nodir\n  if (self.nodir)\n    self.mark = true\n  self.sync = !!options.sync\n  self.nounique = !!options.nounique\n  self.nonull = !!options.nonull\n  self.nosort = !!options.nosort\n  self.nocase = !!options.nocase\n  self.stat = !!options.stat\n  self.noprocess = !!options.noprocess\n  self.absolute = !!options.absolute\n  self.fs = options.fs || fs\n\n  self.maxLength = options.maxLength || Infinity\n  self.cache = options.cache || Object.create(null)\n  self.statCache = options.statCache || Object.create(null)\n  self.symlinks = options.symlinks || Object.create(null)\n\n  setupIgnores(self, options)\n\n  self.changedCwd = false\n  var cwd = process.cwd()\n  if (!ownProp(options, \"cwd\"))\n    self.cwd = cwd\n  else {\n    self.cwd = path.resolve(options.cwd)\n    self.changedCwd = self.cwd !== cwd\n  }\n\n  self.root = options.root || path.resolve(self.cwd, \"/\")\n  self.root = path.resolve(self.root)\n  if (process.platform === \"win32\")\n    self.root = self.root.replace(/\\\\/g, \"/\")\n\n  // TODO: is an absolute `cwd` supposed to be resolved against `root`?\n  // e.g. { cwd: '/test', root: __dirname } === path.join(__dirname, '/test')\n  self.cwdAbs = isAbsolute(self.cwd) ? self.cwd : makeAbs(self, self.cwd)\n  if (process.platform === \"win32\")\n    self.cwdAbs = self.cwdAbs.replace(/\\\\/g, \"/\")\n  self.nomount = !!options.nomount\n\n  // disable comments and negation in Minimatch.\n  // Note that they are not supported in Glob itself anyway.\n  options.nonegate = true\n  options.nocomment = true\n  // always treat \\ in patterns as escapes, not path separators\n  options.allowWindowsEscape = false\n\n  self.minimatch = new Minimatch(pattern, options)\n  self.options = self.minimatch.options\n}\n\nfunction finish (self) {\n  var nou = self.nounique\n  var all = nou ? [] : Object.create(null)\n\n  for (var i = 0, l = self.matches.length; i < l; i ++) {\n    var matches = self.matches[i]\n    if (!matches || Object.keys(matches).length === 0) {\n      if (self.nonull) {\n        // do like the shell, and spit out the literal glob\n        var literal = self.minimatch.globSet[i]\n        if (nou)\n          all.push(literal)\n        else\n          all[literal] = true\n      }\n    } else {\n      // had matches\n      var m = Object.keys(matches)\n      if (nou)\n        all.push.apply(all, m)\n      else\n        m.forEach(function (m) {\n          all[m] = true\n        })\n    }\n  }\n\n  if (!nou)\n    all = Object.keys(all)\n\n  if (!self.nosort)\n    all = all.sort(alphasort)\n\n  // at *some* point we statted all of these\n  if (self.mark) {\n    for (var i = 0; i < all.length; i++) {\n      all[i] = self._mark(all[i])\n    }\n    if (self.nodir) {\n      all = all.filter(function (e) {\n        var notDir = !(/\\/$/.test(e))\n        var c = self.cache[e] || self.cache[makeAbs(self, e)]\n        if (notDir && c)\n          notDir = c !== 'DIR' && !Array.isArray(c)\n        return notDir\n      })\n    }\n  }\n\n  if (self.ignore.length)\n    all = all.filter(function(m) {\n      return !isIgnored(self, m)\n    })\n\n  self.found = all\n}\n\nfunction mark (self, p) {\n  var abs = makeAbs(self, p)\n  var c = self.cache[abs]\n  var m = p\n  if (c) {\n    var isDir = c === 'DIR' || Array.isArray(c)\n    var slash = p.slice(-1) === '/'\n\n    if (isDir && !slash)\n      m += '/'\n    else if (!isDir && slash)\n      m = m.slice(0, -1)\n\n    if (m !== p) {\n      var mabs = makeAbs(self, m)\n      self.statCache[mabs] = self.statCache[abs]\n      self.cache[mabs] = self.cache[abs]\n    }\n  }\n\n  return m\n}\n\n// lotta situps...\nfunction makeAbs (self, f) {\n  var abs = f\n  if (f.charAt(0) === '/') {\n    abs = path.join(self.root, f)\n  } else if (isAbsolute(f) || f === '') {\n    abs = f\n  } else if (self.changedCwd) {\n    abs = path.resolve(self.cwd, f)\n  } else {\n    abs = path.resolve(f)\n  }\n\n  if (process.platform === 'win32')\n    abs = abs.replace(/\\\\/g, '/')\n\n  return abs\n}\n\n\n// Return true, if pattern ends with globstar '**', for the accompanying parent directory.\n// Ex:- If node_modules/** is the pattern, add 'node_modules' to ignore list along with it's contents\nfunction isIgnored (self, path) {\n  if (!self.ignore.length)\n    return false\n\n  return self.ignore.some(function(item) {\n    return item.matcher.match(path) || !!(item.gmatcher && item.gmatcher.match(path))\n  })\n}\n\nfunction childrenIgnored (self, path) {\n  if (!self.ignore.length)\n    return false\n\n  return self.ignore.some(function(item) {\n    return !!(item.gmatcher && item.gmatcher.match(path))\n  })\n}\n","module.exports = globSync\nglobSync.GlobSync = GlobSync\n\nvar rp = require('fs.realpath')\nvar minimatch = require('minimatch')\nvar Minimatch = minimatch.Minimatch\nvar Glob = require('./glob.js').Glob\nvar util = require('util')\nvar path = require('path')\nvar assert = require('assert')\nvar isAbsolute = require('path-is-absolute')\nvar common = require('./common.js')\nvar setopts = common.setopts\nvar ownProp = common.ownProp\nvar childrenIgnored = common.childrenIgnored\nvar isIgnored = common.isIgnored\n\nfunction globSync (pattern, options) {\n  if (typeof options === 'function' || arguments.length === 3)\n    throw new TypeError('callback provided to sync glob\\n'+\n                        'See: https://github.com/isaacs/node-glob/issues/167')\n\n  return new GlobSync(pattern, options).found\n}\n\nfunction GlobSync (pattern, options) {\n  if (!pattern)\n    throw new Error('must provide pattern')\n\n  if (typeof options === 'function' || arguments.length === 3)\n    throw new TypeError('callback provided to sync glob\\n'+\n                        'See: https://github.com/isaacs/node-glob/issues/167')\n\n  if (!(this instanceof GlobSync))\n    return new GlobSync(pattern, options)\n\n  setopts(this, pattern, options)\n\n  if (this.noprocess)\n    return this\n\n  var n = this.minimatch.set.length\n  this.matches = new Array(n)\n  for (var i = 0; i < n; i ++) {\n    this._process(this.minimatch.set[i], i, false)\n  }\n  this._finish()\n}\n\nGlobSync.prototype._finish = function () {\n  assert.ok(this instanceof GlobSync)\n  if (this.realpath) {\n    var self = this\n    this.matches.forEach(function (matchset, index) {\n      var set = self.matches[index] = Object.create(null)\n      for (var p in matchset) {\n        try {\n          p = self._makeAbs(p)\n          var real = rp.realpathSync(p, self.realpathCache)\n          set[real] = true\n        } catch (er) {\n          if (er.syscall === 'stat')\n            set[self._makeAbs(p)] = true\n          else\n            throw er\n        }\n      }\n    })\n  }\n  common.finish(this)\n}\n\n\nGlobSync.prototype._process = function (pattern, index, inGlobStar) {\n  assert.ok(this instanceof GlobSync)\n\n  // Get the first [n] parts of pattern that are all strings.\n  var n = 0\n  while (typeof pattern[n] === 'string') {\n    n ++\n  }\n  // now n is the index of the first one that is *not* a string.\n\n  // See if there's anything else\n  var prefix\n  switch (n) {\n    // if not, then this is rather simple\n    case pattern.length:\n      this._processSimple(pattern.join('/'), index)\n      return\n\n    case 0:\n      // pattern *starts* with some non-trivial item.\n      // going to readdir(cwd), but not include the prefix in matches.\n      prefix = null\n      break\n\n    default:\n      // pattern has some string bits in the front.\n      // whatever it starts with, whether that's 'absolute' like /foo/bar,\n      // or 'relative' like '../baz'\n      prefix = pattern.slice(0, n).join('/')\n      break\n  }\n\n  var remain = pattern.slice(n)\n\n  // get the list of entries.\n  var read\n  if (prefix === null)\n    read = '.'\n  else if (isAbsolute(prefix) ||\n      isAbsolute(pattern.map(function (p) {\n        return typeof p === 'string' ? p : '[*]'\n      }).join('/'))) {\n    if (!prefix || !isAbsolute(prefix))\n      prefix = '/' + prefix\n    read = prefix\n  } else\n    read = prefix\n\n  var abs = this._makeAbs(read)\n\n  //if ignored, skip processing\n  if (childrenIgnored(this, read))\n    return\n\n  var isGlobStar = remain[0] === minimatch.GLOBSTAR\n  if (isGlobStar)\n    this._processGlobStar(prefix, read, abs, remain, index, inGlobStar)\n  else\n    this._processReaddir(prefix, read, abs, remain, index, inGlobStar)\n}\n\n\nGlobSync.prototype._processReaddir = function (prefix, read, abs, remain, index, inGlobStar) {\n  var entries = this._readdir(abs, inGlobStar)\n\n  // if the abs isn't a dir, then nothing can match!\n  if (!entries)\n    return\n\n  // It will only match dot entries if it starts with a dot, or if\n  // dot is set.  Stuff like @(.foo|.bar) isn't allowed.\n  var pn = remain[0]\n  var negate = !!this.minimatch.negate\n  var rawGlob = pn._glob\n  var dotOk = this.dot || rawGlob.charAt(0) === '.'\n\n  var matchedEntries = []\n  for (var i = 0; i < entries.length; i++) {\n    var e = entries[i]\n    if (e.charAt(0) !== '.' || dotOk) {\n      var m\n      if (negate && !prefix) {\n        m = !e.match(pn)\n      } else {\n        m = e.match(pn)\n      }\n      if (m)\n        matchedEntries.push(e)\n    }\n  }\n\n  var len = matchedEntries.length\n  // If there are no matched entries, then nothing matches.\n  if (len === 0)\n    return\n\n  // if this is the last remaining pattern bit, then no need for\n  // an additional stat *unless* the user has specified mark or\n  // stat explicitly.  We know they exist, since readdir returned\n  // them.\n\n  if (remain.length === 1 && !this.mark && !this.stat) {\n    if (!this.matches[index])\n      this.matches[index] = Object.create(null)\n\n    for (var i = 0; i < len; i ++) {\n      var e = matchedEntries[i]\n      if (prefix) {\n        if (prefix.slice(-1) !== '/')\n          e = prefix + '/' + e\n        else\n          e = prefix + e\n      }\n\n      if (e.charAt(0) === '/' && !this.nomount) {\n        e = path.join(this.root, e)\n      }\n      this._emitMatch(index, e)\n    }\n    // This was the last one, and no stats were needed\n    return\n  }\n\n  // now test all matched entries as stand-ins for that part\n  // of the pattern.\n  remain.shift()\n  for (var i = 0; i < len; i ++) {\n    var e = matchedEntries[i]\n    var newPattern\n    if (prefix)\n      newPattern = [prefix, e]\n    else\n      newPattern = [e]\n    this._process(newPattern.concat(remain), index, inGlobStar)\n  }\n}\n\n\nGlobSync.prototype._emitMatch = function (index, e) {\n  if (isIgnored(this, e))\n    return\n\n  var abs = this._makeAbs(e)\n\n  if (this.mark)\n    e = this._mark(e)\n\n  if (this.absolute) {\n    e = abs\n  }\n\n  if (this.matches[index][e])\n    return\n\n  if (this.nodir) {\n    var c = this.cache[abs]\n    if (c === 'DIR' || Array.isArray(c))\n      return\n  }\n\n  this.matches[index][e] = true\n\n  if (this.stat)\n    this._stat(e)\n}\n\n\nGlobSync.prototype._readdirInGlobStar = function (abs) {\n  // follow all symlinked directories forever\n  // just proceed as if this is a non-globstar situation\n  if (this.follow)\n    return this._readdir(abs, false)\n\n  var entries\n  var lstat\n  var stat\n  try {\n    lstat = this.fs.lstatSync(abs)\n  } catch (er) {\n    if (er.code === 'ENOENT') {\n      // lstat failed, doesn't exist\n      return null\n    }\n  }\n\n  var isSym = lstat && lstat.isSymbolicLink()\n  this.symlinks[abs] = isSym\n\n  // If it's not a symlink or a dir, then it's definitely a regular file.\n  // don't bother doing a readdir in that case.\n  if (!isSym && lstat && !lstat.isDirectory())\n    this.cache[abs] = 'FILE'\n  else\n    entries = this._readdir(abs, false)\n\n  return entries\n}\n\nGlobSync.prototype._readdir = function (abs, inGlobStar) {\n  var entries\n\n  if (inGlobStar && !ownProp(this.symlinks, abs))\n    return this._readdirInGlobStar(abs)\n\n  if (ownProp(this.cache, abs)) {\n    var c = this.cache[abs]\n    if (!c || c === 'FILE')\n      return null\n\n    if (Array.isArray(c))\n      return c\n  }\n\n  try {\n    return this._readdirEntries(abs, this.fs.readdirSync(abs))\n  } catch (er) {\n    this._readdirError(abs, er)\n    return null\n  }\n}\n\nGlobSync.prototype._readdirEntries = function (abs, entries) {\n  // if we haven't asked to stat everything, then just\n  // assume that everything in there exists, so we can avoid\n  // having to stat it a second time.\n  if (!this.mark && !this.stat) {\n    for (var i = 0; i < entries.length; i ++) {\n      var e = entries[i]\n      if (abs === '/')\n        e = abs + e\n      else\n        e = abs + '/' + e\n      this.cache[e] = true\n    }\n  }\n\n  this.cache[abs] = entries\n\n  // mark and cache dir-ness\n  return entries\n}\n\nGlobSync.prototype._readdirError = function (f, er) {\n  // handle errors, and cache the information\n  switch (er.code) {\n    case 'ENOTSUP': // https://github.com/isaacs/node-glob/issues/205\n    case 'ENOTDIR': // totally normal. means it *does* exist.\n      var abs = this._makeAbs(f)\n      this.cache[abs] = 'FILE'\n      if (abs === this.cwdAbs) {\n        var error = new Error(er.code + ' invalid cwd ' + this.cwd)\n        error.path = this.cwd\n        error.code = er.code\n        throw error\n      }\n      break\n\n    case 'ENOENT': // not terribly unusual\n    case 'ELOOP':\n    case 'ENAMETOOLONG':\n    case 'UNKNOWN':\n      this.cache[this._makeAbs(f)] = false\n      break\n\n    default: // some unusual error.  Treat as failure.\n      this.cache[this._makeAbs(f)] = false\n      if (this.strict)\n        throw er\n      if (!this.silent)\n        console.error('glob error', er)\n      break\n  }\n}\n\nGlobSync.prototype._processGlobStar = function (prefix, read, abs, remain, index, inGlobStar) {\n\n  var entries = this._readdir(abs, inGlobStar)\n\n  // no entries means not a dir, so it can never have matches\n  // foo.txt/** doesn't match foo.txt\n  if (!entries)\n    return\n\n  // test without the globstar, and with every child both below\n  // and replacing the globstar.\n  var remainWithoutGlobStar = remain.slice(1)\n  var gspref = prefix ? [ prefix ] : []\n  var noGlobStar = gspref.concat(remainWithoutGlobStar)\n\n  // the noGlobStar pattern exits the inGlobStar state\n  this._process(noGlobStar, index, false)\n\n  var len = entries.length\n  var isSym = this.symlinks[abs]\n\n  // If it's a symlink, and we're in a globstar, then stop\n  if (isSym && inGlobStar)\n    return\n\n  for (var i = 0; i < len; i++) {\n    var e = entries[i]\n    if (e.charAt(0) === '.' && !this.dot)\n      continue\n\n    // these two cases enter the inGlobStar state\n    var instead = gspref.concat(entries[i], remainWithoutGlobStar)\n    this._process(instead, index, true)\n\n    var below = gspref.concat(entries[i], remain)\n    this._process(below, index, true)\n  }\n}\n\nGlobSync.prototype._processSimple = function (prefix, index) {\n  // XXX review this.  Shouldn't it be doing the mounting etc\n  // before doing stat?  kinda weird?\n  var exists = this._stat(prefix)\n\n  if (!this.matches[index])\n    this.matches[index] = Object.create(null)\n\n  // If it doesn't exist, then just mark the lack of results\n  if (!exists)\n    return\n\n  if (prefix && isAbsolute(prefix) && !this.nomount) {\n    var trail = /[\\/\\\\]$/.test(prefix)\n    if (prefix.charAt(0) === '/') {\n      prefix = path.join(this.root, prefix)\n    } else {\n      prefix = path.resolve(this.root, prefix)\n      if (trail)\n        prefix += '/'\n    }\n  }\n\n  if (process.platform === 'win32')\n    prefix = prefix.replace(/\\\\/g, '/')\n\n  // Mark this as a match\n  this._emitMatch(index, prefix)\n}\n\n// Returns either 'DIR', 'FILE', or false\nGlobSync.prototype._stat = function (f) {\n  var abs = this._makeAbs(f)\n  var needDir = f.slice(-1) === '/'\n\n  if (f.length > this.maxLength)\n    return false\n\n  if (!this.stat && ownProp(this.cache, abs)) {\n    var c = this.cache[abs]\n\n    if (Array.isArray(c))\n      c = 'DIR'\n\n    // It exists, but maybe not how we need it\n    if (!needDir || c === 'DIR')\n      return c\n\n    if (needDir && c === 'FILE')\n      return false\n\n    // otherwise we have to stat, because maybe c=true\n    // if we know it exists, but not what it is.\n  }\n\n  var exists\n  var stat = this.statCache[abs]\n  if (!stat) {\n    var lstat\n    try {\n      lstat = this.fs.lstatSync(abs)\n    } catch (er) {\n      if (er && (er.code === 'ENOENT' || er.code === 'ENOTDIR')) {\n        this.statCache[abs] = false\n        return false\n      }\n    }\n\n    if (lstat && lstat.isSymbolicLink()) {\n      try {\n        stat = this.fs.statSync(abs)\n      } catch (er) {\n        stat = lstat\n      }\n    } else {\n      stat = lstat\n    }\n  }\n\n  this.statCache[abs] = stat\n\n  var c = true\n  if (stat)\n    c = stat.isDirectory() ? 'DIR' : 'FILE'\n\n  this.cache[abs] = this.cache[abs] || c\n\n  if (needDir && c === 'FILE')\n    return false\n\n  return c\n}\n\nGlobSync.prototype._mark = function (p) {\n  return common.mark(this, p)\n}\n\nGlobSync.prototype._makeAbs = function (f) {\n  return common.makeAbs(this, f)\n}\n","// Returns a wrapper function that returns a wrapped callback\n// The wrapper function should do some stuff, and return a\n// presumably different callback function.\n// This makes sure that own properties are retained, so that\n// decorations and such are not lost along the way.\nmodule.exports = wrappy\nfunction wrappy (fn, cb) {\n  if (fn && cb) return wrappy(fn)(cb)\n\n  if (typeof fn !== 'function')\n    throw new TypeError('need wrapper function')\n\n  Object.keys(fn).forEach(function (k) {\n    wrapper[k] = fn[k]\n  })\n\n  return wrapper\n\n  function wrapper() {\n    var args = new Array(arguments.length)\n    for (var i = 0; i < args.length; i++) {\n      args[i] = arguments[i]\n    }\n    var ret = fn.apply(this, args)\n    var cb = args[args.length-1]\n    if (typeof ret === 'function' && ret !== cb) {\n      Object.keys(cb).forEach(function (k) {\n        ret[k] = cb[k]\n      })\n    }\n    return ret\n  }\n}\n","var wrappy = require('wrappy')\nmodule.exports = wrappy(once)\nmodule.exports.strict = wrappy(onceStrict)\n\nonce.proto = once(function () {\n  Object.defineProperty(Function.prototype, 'once', {\n    value: function () {\n      return once(this)\n    },\n    configurable: true\n  })\n\n  Object.defineProperty(Function.prototype, 'onceStrict', {\n    value: function () {\n      return onceStrict(this)\n    },\n    configurable: true\n  })\n})\n\nfunction once (fn) {\n  var f = function () {\n    if (f.called) return f.value\n    f.called = true\n    return f.value = fn.apply(this, arguments)\n  }\n  f.called = false\n  return f\n}\n\nfunction onceStrict (fn) {\n  var f = function () {\n    if (f.called)\n      throw new Error(f.onceError)\n    f.called = true\n    return f.value = fn.apply(this, arguments)\n  }\n  var name = fn.name || 'Function wrapped with `once`'\n  f.onceError = name + \" shouldn't be called more than once\"\n  f.called = false\n  return f\n}\n","var wrappy = require('wrappy')\nvar reqs = Object.create(null)\nvar once = require('once')\n\nmodule.exports = wrappy(inflight)\n\nfunction inflight (key, cb) {\n  if (reqs[key]) {\n    reqs[key].push(cb)\n    return null\n  } else {\n    reqs[key] = [cb]\n    return makeres(key)\n  }\n}\n\nfunction makeres (key) {\n  return once(function RES () {\n    var cbs = reqs[key]\n    var len = cbs.length\n    var args = slice(arguments)\n\n    // XXX It's somewhat ambiguous whether a new callback added in this\n    // pass should be queued for later execution if something in the\n    // list of callbacks throws, or if it should just be discarded.\n    // However, it's such an edge case that it hardly matters, and either\n    // choice is likely as surprising as the other.\n    // As it happens, we do go ahead and schedule it for later execution.\n    try {\n      for (var i = 0; i < len; i++) {\n        cbs[i].apply(null, args)\n      }\n    } finally {\n      if (cbs.length > len) {\n        // added more in the interim.\n        // de-zalgo, just in case, but don't call again.\n        cbs.splice(0, len)\n        process.nextTick(function () {\n          RES.apply(null, args)\n        })\n      } else {\n        delete reqs[key]\n      }\n    }\n  })\n}\n\nfunction slice (args) {\n  var length = args.length\n  var array = []\n\n  for (var i = 0; i < length; i++) array[i] = args[i]\n  return array\n}\n","// Approach:\n//\n// 1. Get the minimatch set\n// 2. For each pattern in the set, PROCESS(pattern, false)\n// 3. Store matches per-set, then uniq them\n//\n// PROCESS(pattern, inGlobStar)\n// Get the first [n] items from pattern that are all strings\n// Join these together.  This is PREFIX.\n//   If there is no more remaining, then stat(PREFIX) and\n//   add to matches if it succeeds.  END.\n//\n// If inGlobStar and PREFIX is symlink and points to dir\n//   set ENTRIES = []\n// else readdir(PREFIX) as ENTRIES\n//   If fail, END\n//\n// with ENTRIES\n//   If pattern[n] is GLOBSTAR\n//     // handle the case where the globstar match is empty\n//     // by pruning it out, and testing the resulting pattern\n//     PROCESS(pattern[0..n] + pattern[n+1 .. $], false)\n//     // handle other cases.\n//     for ENTRY in ENTRIES (not dotfiles)\n//       // attach globstar + tail onto the entry\n//       // Mark that this entry is a globstar match\n//       PROCESS(pattern[0..n] + ENTRY + pattern[n .. $], true)\n//\n//   else // not globstar\n//     for ENTRY in ENTRIES (not dotfiles, unless pattern[n] is dot)\n//       Test ENTRY against pattern[n]\n//       If fails, continue\n//       If passes, PROCESS(pattern[0..n] + item + pattern[n+1 .. $])\n//\n// Caveat:\n//   Cache all stats and readdirs results to minimize syscall.  Since all\n//   we ever care about is existence and directory-ness, we can just keep\n//   `true` for files, and [children,...] for directories, or `false` for\n//   things that don't exist.\n\nmodule.exports = glob\n\nvar rp = require('fs.realpath')\nvar minimatch = require('minimatch')\nvar Minimatch = minimatch.Minimatch\nvar inherits = require('inherits')\nvar EE = require('events').EventEmitter\nvar path = require('path')\nvar assert = require('assert')\nvar isAbsolute = require('path-is-absolute')\nvar globSync = require('./sync.js')\nvar common = require('./common.js')\nvar setopts = common.setopts\nvar ownProp = common.ownProp\nvar inflight = require('inflight')\nvar util = require('util')\nvar childrenIgnored = common.childrenIgnored\nvar isIgnored = common.isIgnored\n\nvar once = require('once')\n\nfunction glob (pattern, options, cb) {\n  if (typeof options === 'function') cb = options, options = {}\n  if (!options) options = {}\n\n  if (options.sync) {\n    if (cb)\n      throw new TypeError('callback provided to sync glob')\n    return globSync(pattern, options)\n  }\n\n  return new Glob(pattern, options, cb)\n}\n\nglob.sync = globSync\nvar GlobSync = glob.GlobSync = globSync.GlobSync\n\n// old api surface\nglob.glob = glob\n\nfunction extend (origin, add) {\n  if (add === null || typeof add !== 'object') {\n    return origin\n  }\n\n  var keys = Object.keys(add)\n  var i = keys.length\n  while (i--) {\n    origin[keys[i]] = add[keys[i]]\n  }\n  return origin\n}\n\nglob.hasMagic = function (pattern, options_) {\n  var options = extend({}, options_)\n  options.noprocess = true\n\n  var g = new Glob(pattern, options)\n  var set = g.minimatch.set\n\n  if (!pattern)\n    return false\n\n  if (set.length > 1)\n    return true\n\n  for (var j = 0; j < set[0].length; j++) {\n    if (typeof set[0][j] !== 'string')\n      return true\n  }\n\n  return false\n}\n\nglob.Glob = Glob\ninherits(Glob, EE)\nfunction Glob (pattern, options, cb) {\n  if (typeof options === 'function') {\n    cb = options\n    options = null\n  }\n\n  if (options && options.sync) {\n    if (cb)\n      throw new TypeError('callback provided to sync glob')\n    return new GlobSync(pattern, options)\n  }\n\n  if (!(this instanceof Glob))\n    return new Glob(pattern, options, cb)\n\n  setopts(this, pattern, options)\n  this._didRealPath = false\n\n  // process each pattern in the minimatch set\n  var n = this.minimatch.set.length\n\n  // The matches are stored as {<filename>: true,...} so that\n  // duplicates are automagically pruned.\n  // Later, we do an Object.keys() on these.\n  // Keep them as a list so we can fill in when nonull is set.\n  this.matches = new Array(n)\n\n  if (typeof cb === 'function') {\n    cb = once(cb)\n    this.on('error', cb)\n    this.on('end', function (matches) {\n      cb(null, matches)\n    })\n  }\n\n  var self = this\n  this._processing = 0\n\n  this._emitQueue = []\n  this._processQueue = []\n  this.paused = false\n\n  if (this.noprocess)\n    return this\n\n  if (n === 0)\n    return done()\n\n  var sync = true\n  for (var i = 0; i < n; i ++) {\n    this._process(this.minimatch.set[i], i, false, done)\n  }\n  sync = false\n\n  function done () {\n    --self._processing\n    if (self._processing <= 0) {\n      if (sync) {\n        process.nextTick(function () {\n          self._finish()\n        })\n      } else {\n        self._finish()\n      }\n    }\n  }\n}\n\nGlob.prototype._finish = function () {\n  assert(this instanceof Glob)\n  if (this.aborted)\n    return\n\n  if (this.realpath && !this._didRealpath)\n    return this._realpath()\n\n  common.finish(this)\n  this.emit('end', this.found)\n}\n\nGlob.prototype._realpath = function () {\n  if (this._didRealpath)\n    return\n\n  this._didRealpath = true\n\n  var n = this.matches.length\n  if (n === 0)\n    return this._finish()\n\n  var self = this\n  for (var i = 0; i < this.matches.length; i++)\n    this._realpathSet(i, next)\n\n  function next () {\n    if (--n === 0)\n      self._finish()\n  }\n}\n\nGlob.prototype._realpathSet = function (index, cb) {\n  var matchset = this.matches[index]\n  if (!matchset)\n    return cb()\n\n  var found = Object.keys(matchset)\n  var self = this\n  var n = found.length\n\n  if (n === 0)\n    return cb()\n\n  var set = this.matches[index] = Object.create(null)\n  found.forEach(function (p, i) {\n    // If there's a problem with the stat, then it means that\n    // one or more of the links in the realpath couldn't be\n    // resolved.  just return the abs value in that case.\n    p = self._makeAbs(p)\n    rp.realpath(p, self.realpathCache, function (er, real) {\n      if (!er)\n        set[real] = true\n      else if (er.syscall === 'stat')\n        set[p] = true\n      else\n        self.emit('error', er) // srsly wtf right here\n\n      if (--n === 0) {\n        self.matches[index] = set\n        cb()\n      }\n    })\n  })\n}\n\nGlob.prototype._mark = function (p) {\n  return common.mark(this, p)\n}\n\nGlob.prototype._makeAbs = function (f) {\n  return common.makeAbs(this, f)\n}\n\nGlob.prototype.abort = function () {\n  this.aborted = true\n  this.emit('abort')\n}\n\nGlob.prototype.pause = function () {\n  if (!this.paused) {\n    this.paused = true\n    this.emit('pause')\n  }\n}\n\nGlob.prototype.resume = function () {\n  if (this.paused) {\n    this.emit('resume')\n    this.paused = false\n    if (this._emitQueue.length) {\n      var eq = this._emitQueue.slice(0)\n      this._emitQueue.length = 0\n      for (var i = 0; i < eq.length; i ++) {\n        var e = eq[i]\n        this._emitMatch(e[0], e[1])\n      }\n    }\n    if (this._processQueue.length) {\n      var pq = this._processQueue.slice(0)\n      this._processQueue.length = 0\n      for (var i = 0; i < pq.length; i ++) {\n        var p = pq[i]\n        this._processing--\n        this._process(p[0], p[1], p[2], p[3])\n      }\n    }\n  }\n}\n\nGlob.prototype._process = function (pattern, index, inGlobStar, cb) {\n  assert(this instanceof Glob)\n  assert(typeof cb === 'function')\n\n  if (this.aborted)\n    return\n\n  this._processing++\n  if (this.paused) {\n    this._processQueue.push([pattern, index, inGlobStar, cb])\n    return\n  }\n\n  //console.error('PROCESS %d', this._processing, pattern)\n\n  // Get the first [n] parts of pattern that are all strings.\n  var n = 0\n  while (typeof pattern[n] === 'string') {\n    n ++\n  }\n  // now n is the index of the first one that is *not* a string.\n\n  // see if there's anything else\n  var prefix\n  switch (n) {\n    // if not, then this is rather simple\n    case pattern.length:\n      this._processSimple(pattern.join('/'), index, cb)\n      return\n\n    case 0:\n      // pattern *starts* with some non-trivial item.\n      // going to readdir(cwd), but not include the prefix in matches.\n      prefix = null\n      break\n\n    default:\n      // pattern has some string bits in the front.\n      // whatever it starts with, whether that's 'absolute' like /foo/bar,\n      // or 'relative' like '../baz'\n      prefix = pattern.slice(0, n).join('/')\n      break\n  }\n\n  var remain = pattern.slice(n)\n\n  // get the list of entries.\n  var read\n  if (prefix === null)\n    read = '.'\n  else if (isAbsolute(prefix) ||\n      isAbsolute(pattern.map(function (p) {\n        return typeof p === 'string' ? p : '[*]'\n      }).join('/'))) {\n    if (!prefix || !isAbsolute(prefix))\n      prefix = '/' + prefix\n    read = prefix\n  } else\n    read = prefix\n\n  var abs = this._makeAbs(read)\n\n  //if ignored, skip _processing\n  if (childrenIgnored(this, read))\n    return cb()\n\n  var isGlobStar = remain[0] === minimatch.GLOBSTAR\n  if (isGlobStar)\n    this._processGlobStar(prefix, read, abs, remain, index, inGlobStar, cb)\n  else\n    this._processReaddir(prefix, read, abs, remain, index, inGlobStar, cb)\n}\n\nGlob.prototype._processReaddir = function (prefix, read, abs, remain, index, inGlobStar, cb) {\n  var self = this\n  this._readdir(abs, inGlobStar, function (er, entries) {\n    return self._processReaddir2(prefix, read, abs, remain, index, inGlobStar, entries, cb)\n  })\n}\n\nGlob.prototype._processReaddir2 = function (prefix, read, abs, remain, index, inGlobStar, entries, cb) {\n\n  // if the abs isn't a dir, then nothing can match!\n  if (!entries)\n    return cb()\n\n  // It will only match dot entries if it starts with a dot, or if\n  // dot is set.  Stuff like @(.foo|.bar) isn't allowed.\n  var pn = remain[0]\n  var negate = !!this.minimatch.negate\n  var rawGlob = pn._glob\n  var dotOk = this.dot || rawGlob.charAt(0) === '.'\n\n  var matchedEntries = []\n  for (var i = 0; i < entries.length; i++) {\n    var e = entries[i]\n    if (e.charAt(0) !== '.' || dotOk) {\n      var m\n      if (negate && !prefix) {\n        m = !e.match(pn)\n      } else {\n        m = e.match(pn)\n      }\n      if (m)\n        matchedEntries.push(e)\n    }\n  }\n\n  //console.error('prd2', prefix, entries, remain[0]._glob, matchedEntries)\n\n  var len = matchedEntries.length\n  // If there are no matched entries, then nothing matches.\n  if (len === 0)\n    return cb()\n\n  // if this is the last remaining pattern bit, then no need for\n  // an additional stat *unless* the user has specified mark or\n  // stat explicitly.  We know they exist, since readdir returned\n  // them.\n\n  if (remain.length === 1 && !this.mark && !this.stat) {\n    if (!this.matches[index])\n      this.matches[index] = Object.create(null)\n\n    for (var i = 0; i < len; i ++) {\n      var e = matchedEntries[i]\n      if (prefix) {\n        if (prefix !== '/')\n          e = prefix + '/' + e\n        else\n          e = prefix + e\n      }\n\n      if (e.charAt(0) === '/' && !this.nomount) {\n        e = path.join(this.root, e)\n      }\n      this._emitMatch(index, e)\n    }\n    // This was the last one, and no stats were needed\n    return cb()\n  }\n\n  // now test all matched entries as stand-ins for that part\n  // of the pattern.\n  remain.shift()\n  for (var i = 0; i < len; i ++) {\n    var e = matchedEntries[i]\n    var newPattern\n    if (prefix) {\n      if (prefix !== '/')\n        e = prefix + '/' + e\n      else\n        e = prefix + e\n    }\n    this._process([e].concat(remain), index, inGlobStar, cb)\n  }\n  cb()\n}\n\nGlob.prototype._emitMatch = function (index, e) {\n  if (this.aborted)\n    return\n\n  if (isIgnored(this, e))\n    return\n\n  if (this.paused) {\n    this._emitQueue.push([index, e])\n    return\n  }\n\n  var abs = isAbsolute(e) ? e : this._makeAbs(e)\n\n  if (this.mark)\n    e = this._mark(e)\n\n  if (this.absolute)\n    e = abs\n\n  if (this.matches[index][e])\n    return\n\n  if (this.nodir) {\n    var c = this.cache[abs]\n    if (c === 'DIR' || Array.isArray(c))\n      return\n  }\n\n  this.matches[index][e] = true\n\n  var st = this.statCache[abs]\n  if (st)\n    this.emit('stat', e, st)\n\n  this.emit('match', e)\n}\n\nGlob.prototype._readdirInGlobStar = function (abs, cb) {\n  if (this.aborted)\n    return\n\n  // follow all symlinked directories forever\n  // just proceed as if this is a non-globstar situation\n  if (this.follow)\n    return this._readdir(abs, false, cb)\n\n  var lstatkey = 'lstat\\0' + abs\n  var self = this\n  var lstatcb = inflight(lstatkey, lstatcb_)\n\n  if (lstatcb)\n    self.fs.lstat(abs, lstatcb)\n\n  function lstatcb_ (er, lstat) {\n    if (er && er.code === 'ENOENT')\n      return cb()\n\n    var isSym = lstat && lstat.isSymbolicLink()\n    self.symlinks[abs] = isSym\n\n    // If it's not a symlink or a dir, then it's definitely a regular file.\n    // don't bother doing a readdir in that case.\n    if (!isSym && lstat && !lstat.isDirectory()) {\n      self.cache[abs] = 'FILE'\n      cb()\n    } else\n      self._readdir(abs, false, cb)\n  }\n}\n\nGlob.prototype._readdir = function (abs, inGlobStar, cb) {\n  if (this.aborted)\n    return\n\n  cb = inflight('readdir\\0'+abs+'\\0'+inGlobStar, cb)\n  if (!cb)\n    return\n\n  //console.error('RD %j %j', +inGlobStar, abs)\n  if (inGlobStar && !ownProp(this.symlinks, abs))\n    return this._readdirInGlobStar(abs, cb)\n\n  if (ownProp(this.cache, abs)) {\n    var c = this.cache[abs]\n    if (!c || c === 'FILE')\n      return cb()\n\n    if (Array.isArray(c))\n      return cb(null, c)\n  }\n\n  var self = this\n  self.fs.readdir(abs, readdirCb(this, abs, cb))\n}\n\nfunction readdirCb (self, abs, cb) {\n  return function (er, entries) {\n    if (er)\n      self._readdirError(abs, er, cb)\n    else\n      self._readdirEntries(abs, entries, cb)\n  }\n}\n\nGlob.prototype._readdirEntries = function (abs, entries, cb) {\n  if (this.aborted)\n    return\n\n  // if we haven't asked to stat everything, then just\n  // assume that everything in there exists, so we can avoid\n  // having to stat it a second time.\n  if (!this.mark && !this.stat) {\n    for (var i = 0; i < entries.length; i ++) {\n      var e = entries[i]\n      if (abs === '/')\n        e = abs + e\n      else\n        e = abs + '/' + e\n      this.cache[e] = true\n    }\n  }\n\n  this.cache[abs] = entries\n  return cb(null, entries)\n}\n\nGlob.prototype._readdirError = function (f, er, cb) {\n  if (this.aborted)\n    return\n\n  // handle errors, and cache the information\n  switch (er.code) {\n    case 'ENOTSUP': // https://github.com/isaacs/node-glob/issues/205\n    case 'ENOTDIR': // totally normal. means it *does* exist.\n      var abs = this._makeAbs(f)\n      this.cache[abs] = 'FILE'\n      if (abs === this.cwdAbs) {\n        var error = new Error(er.code + ' invalid cwd ' + this.cwd)\n        error.path = this.cwd\n        error.code = er.code\n        this.emit('error', error)\n        this.abort()\n      }\n      break\n\n    case 'ENOENT': // not terribly unusual\n    case 'ELOOP':\n    case 'ENAMETOOLONG':\n    case 'UNKNOWN':\n      this.cache[this._makeAbs(f)] = false\n      break\n\n    default: // some unusual error.  Treat as failure.\n      this.cache[this._makeAbs(f)] = false\n      if (this.strict) {\n        this.emit('error', er)\n        // If the error is handled, then we abort\n        // if not, we threw out of here\n        this.abort()\n      }\n      if (!this.silent)\n        console.error('glob error', er)\n      break\n  }\n\n  return cb()\n}\n\nGlob.prototype._processGlobStar = function (prefix, read, abs, remain, index, inGlobStar, cb) {\n  var self = this\n  this._readdir(abs, inGlobStar, function (er, entries) {\n    self._processGlobStar2(prefix, read, abs, remain, index, inGlobStar, entries, cb)\n  })\n}\n\n\nGlob.prototype._processGlobStar2 = function (prefix, read, abs, remain, index, inGlobStar, entries, cb) {\n  //console.error('pgs2', prefix, remain[0], entries)\n\n  // no entries means not a dir, so it can never have matches\n  // foo.txt/** doesn't match foo.txt\n  if (!entries)\n    return cb()\n\n  // test without the globstar, and with every child both below\n  // and replacing the globstar.\n  var remainWithoutGlobStar = remain.slice(1)\n  var gspref = prefix ? [ prefix ] : []\n  var noGlobStar = gspref.concat(remainWithoutGlobStar)\n\n  // the noGlobStar pattern exits the inGlobStar state\n  this._process(noGlobStar, index, false, cb)\n\n  var isSym = this.symlinks[abs]\n  var len = entries.length\n\n  // If it's a symlink, and we're in a globstar, then stop\n  if (isSym && inGlobStar)\n    return cb()\n\n  for (var i = 0; i < len; i++) {\n    var e = entries[i]\n    if (e.charAt(0) === '.' && !this.dot)\n      continue\n\n    // these two cases enter the inGlobStar state\n    var instead = gspref.concat(entries[i], remainWithoutGlobStar)\n    this._process(instead, index, true, cb)\n\n    var below = gspref.concat(entries[i], remain)\n    this._process(below, index, true, cb)\n  }\n\n  cb()\n}\n\nGlob.prototype._processSimple = function (prefix, index, cb) {\n  // XXX review this.  Shouldn't it be doing the mounting etc\n  // before doing stat?  kinda weird?\n  var self = this\n  this._stat(prefix, function (er, exists) {\n    self._processSimple2(prefix, index, er, exists, cb)\n  })\n}\nGlob.prototype._processSimple2 = function (prefix, index, er, exists, cb) {\n\n  //console.error('ps2', prefix, exists)\n\n  if (!this.matches[index])\n    this.matches[index] = Object.create(null)\n\n  // If it doesn't exist, then just mark the lack of results\n  if (!exists)\n    return cb()\n\n  if (prefix && isAbsolute(prefix) && !this.nomount) {\n    var trail = /[\\/\\\\]$/.test(prefix)\n    if (prefix.charAt(0) === '/') {\n      prefix = path.join(this.root, prefix)\n    } else {\n      prefix = path.resolve(this.root, prefix)\n      if (trail)\n        prefix += '/'\n    }\n  }\n\n  if (process.platform === 'win32')\n    prefix = prefix.replace(/\\\\/g, '/')\n\n  // Mark this as a match\n  this._emitMatch(index, prefix)\n  cb()\n}\n\n// Returns either 'DIR', 'FILE', or false\nGlob.prototype._stat = function (f, cb) {\n  var abs = this._makeAbs(f)\n  var needDir = f.slice(-1) === '/'\n\n  if (f.length > this.maxLength)\n    return cb()\n\n  if (!this.stat && ownProp(this.cache, abs)) {\n    var c = this.cache[abs]\n\n    if (Array.isArray(c))\n      c = 'DIR'\n\n    // It exists, but maybe not how we need it\n    if (!needDir || c === 'DIR')\n      return cb(null, c)\n\n    if (needDir && c === 'FILE')\n      return cb()\n\n    // otherwise we have to stat, because maybe c=true\n    // if we know it exists, but not what it is.\n  }\n\n  var exists\n  var stat = this.statCache[abs]\n  if (stat !== undefined) {\n    if (stat === false)\n      return cb(null, stat)\n    else {\n      var type = stat.isDirectory() ? 'DIR' : 'FILE'\n      if (needDir && type === 'FILE')\n        return cb()\n      else\n        return cb(null, type, stat)\n    }\n  }\n\n  var self = this\n  var statcb = inflight('stat\\0' + abs, lstatcb_)\n  if (statcb)\n    self.fs.lstat(abs, statcb)\n\n  function lstatcb_ (er, lstat) {\n    if (lstat && lstat.isSymbolicLink()) {\n      // If it's a symlink, then treat it as the target, unless\n      // the target does not exist, then treat it as a file.\n      return self.fs.stat(abs, function (er, stat) {\n        if (er)\n          self._stat2(f, abs, null, lstat, cb)\n        else\n          self._stat2(f, abs, er, stat, cb)\n      })\n    } else {\n      self._stat2(f, abs, er, lstat, cb)\n    }\n  }\n}\n\nGlob.prototype._stat2 = function (f, abs, er, stat, cb) {\n  if (er && (er.code === 'ENOENT' || er.code === 'ENOTDIR')) {\n    this.statCache[abs] = false\n    return cb()\n  }\n\n  var needDir = f.slice(-1) === '/'\n  this.statCache[abs] = stat\n\n  if (abs.slice(-1) === '/' && stat && !stat.isDirectory())\n    return cb(null, false, stat)\n\n  var c = true\n  if (stat)\n    c = stat.isDirectory() ? 'DIR' : 'FILE'\n  this.cache[abs] = this.cache[abs] || c\n\n  if (needDir && c === 'FILE')\n    return cb()\n\n  return cb(null, c, stat)\n}\n","/**\n * Core module - main public API\n *\n * This is the primary entry point for the library.\n *\n * @example\n * ```typescript\n * import { Connector, Agent, Vendor } from '@oneringai/agents';\n *\n * // Create a connector\n * Connector.create({\n *   name: 'openai',\n *   vendor: Vendor.OpenAI,\n *   auth: { type: 'api_key', apiKey: process.env.OPENAI_API_KEY! }\n * });\n *\n * // Create an agent\n * const agent = Agent.create({\n *   connector: 'openai',\n *   model: 'gpt-4'\n * });\n *\n * // Run the agent\n * const response = await agent.run('Hello!');\n * ```\n */\n\nexport { Connector } from './Connector.js';\nexport { Agent } from './Agent.js';\nexport type { AgentConfig, AgentSessionConfig } from './Agent.js';\n\n// ============================================================================\n// AgentContext - Unified \"Swiss Army Knife\" for all context management\n// ============================================================================\nexport { AgentContext, DEFAULT_FEATURES } from './AgentContext.js';\nexport type {\n  AgentContextConfig,\n  AgentContextFeatures,\n  AgentContextEvents,\n  AgentContextMetrics,\n  HistoryMessage,\n  ToolCallRecord,\n  SerializedAgentContextState,\n} from './AgentContext.js';\n\n// Feature-aware tool factory\nexport { getAgentContextTools, getBasicIntrospectionTools, getMemoryTools } from './AgentContextTools.js';\n\n// Feature Instructions (runtime usage instructions for enabled features)\nexport {\n  buildFeatureInstructions,\n  INTROSPECTION_INSTRUCTIONS,\n  WORKING_MEMORY_INSTRUCTIONS,\n  IN_CONTEXT_MEMORY_INSTRUCTIONS,\n  PERSISTENT_INSTRUCTIONS_INSTRUCTIONS,\n  getAllInstructions,\n} from './context/FeatureInstructions.js';\n\n// IdempotencyCache - Tool result caching (moved from taskAgent to core)\nexport { IdempotencyCache, DEFAULT_IDEMPOTENCY_CONFIG } from './IdempotencyCache.js';\nexport type { IdempotencyCacheConfig, CacheStats } from './IdempotencyCache.js';\n\n// Lifecycle hooks and direct call types (from BaseAgent)\nexport type {\n  AgentLifecycleHooks,\n  ToolExecutionHookContext,\n  ToolExecutionResult,\n  DirectCallOptions,\n} from './BaseAgent.js';\nexport { Vendor, VENDORS, isVendor } from './Vendor.js';\nexport { createProvider, createProviderAsync } from './createProvider.js';\n\n// Centralized constants\nexport {\n  TASK_DEFAULTS,\n  CONTEXT_DEFAULTS,\n  PROACTIVE_STRATEGY_DEFAULTS,\n  AGGRESSIVE_STRATEGY_DEFAULTS,\n  LAZY_STRATEGY_DEFAULTS,\n  ADAPTIVE_STRATEGY_DEFAULTS,\n  ROLLING_WINDOW_DEFAULTS,\n  MEMORY_DEFAULTS,\n  SESSION_DEFAULTS,\n  AGENT_DEFAULTS,\n  CIRCUIT_BREAKER_DEFAULTS,\n  HISTORY_DEFAULTS,\n  TOKEN_ESTIMATION,\n} from './constants.js';\n\n// Global configuration\nexport { Config } from './Config.js';\nexport type { OneRingAIConfig, MCPConfiguration } from '../domain/entities/MCPConfig.js';\n\n// MCP (Model Context Protocol)\nexport * from './mcp/index.js';\n\n// Audio capabilities\nexport { TextToSpeech } from './TextToSpeech.js';\nexport type { TextToSpeechConfig } from './TextToSpeech.js';\nexport { SpeechToText } from './SpeechToText.js';\nexport type { SpeechToTextConfig } from './SpeechToText.js';\n\n// Image capabilities\nexport { createImageProvider } from './createImageProvider.js';\n\n// Tool management (unified - handles registration, execution, and circuit breakers)\nexport { ToolManager } from './ToolManager.js';\nexport type {\n  ToolOptions,\n  ToolCondition,\n  ToolSelectionContext,\n  ToolRegistration,\n  ToolMetadata,\n  ToolManagerStats,\n  SerializedToolState,\n  ToolManagerEvent,\n} from './ToolManager.js';\n// Note: CircuitBreakerConfig, CircuitState are re-exported from ToolManager but\n// canonically exported from infrastructure/resilience/index.js\n\n// Tool permission management\nexport { ToolPermissionManager } from './permissions/ToolPermissionManager.js';\nexport type {\n  PermissionScope,\n  RiskLevel,\n  ToolPermissionConfig,\n  ApprovalCacheEntry,\n  SerializedApprovalState,\n  SerializedApprovalEntry,\n  PermissionCheckResult,\n  ApprovalDecision,\n  AgentPermissionsConfig,\n  PermissionCheckContext,\n  PermissionManagerEvent,\n} from './permissions/types.js';\nexport { APPROVAL_STATE_VERSION, DEFAULT_PERMISSION_CONFIG } from './permissions/types.js';\n\n// Error Handling\nexport { ErrorHandler, globalErrorHandler } from './ErrorHandler.js';\nexport type {\n  ErrorContext,\n  ErrorHandlerConfig,\n  ErrorHandlerEvents,\n} from './ErrorHandler.js';\n","/**\n * BaseAgent - Abstract base class for all agent types\n *\n * Provides shared functionality for:\n * - Connector resolution\n * - Tool manager initialization\n * - Permission manager initialization\n * - Session management (via AgentContext)\n * - Lifecycle/cleanup\n *\n * This is an INTERNAL class - not exported in the public API.\n * Use Agent, TaskAgent, or UniversalAgent instead.\n */\n\nimport { EventEmitter } from 'eventemitter3';\nimport { Connector } from './Connector.js';\nimport { ToolManager } from './ToolManager.js';\nimport { ToolPermissionManager } from './permissions/ToolPermissionManager.js';\nimport type { AgentPermissionsConfig } from './permissions/types.js';\nimport type { ToolFunction } from '../domain/entities/Tool.js';\nimport { logger, FrameworkLogger } from '../infrastructure/observability/Logger.js';\nimport { AgentContext } from './AgentContext.js';\nimport type { AgentContextConfig } from './AgentContext.js';\nimport { createProvider } from './createProvider.js';\nimport type { ITextProvider } from '../domain/interfaces/ITextProvider.js';\nimport type { LLMResponse } from '../domain/entities/Response.js';\nimport type { InputItem } from '../domain/entities/Message.js';\nimport type { StreamEvent } from '../domain/entities/StreamEvent.js';\nimport type { IContextStorage, ContextSessionMetadata } from '../domain/interfaces/IContextStorage.js';\n\n/**\n * Options for tool registration\n */\nexport interface ToolRegistrationOptions {\n  /** Namespace for the tool (e.g., 'user', '_meta', 'mcp:fs') */\n  namespace?: string;\n  /** Whether the tool is enabled by default */\n  enabled?: boolean;\n}\n\n/**\n * Session configuration using AgentContext persistence\n */\nexport interface BaseSessionConfig {\n  /** Storage backend for context sessions */\n  storage: IContextStorage;\n  /** Resume existing session by ID */\n  id?: string;\n  /** Auto-save session after each interaction */\n  autoSave?: boolean;\n  /** Auto-save interval in milliseconds */\n  autoSaveIntervalMs?: number;\n}\n\n/**\n * Tool execution context passed to lifecycle hooks\n */\nexport interface ToolExecutionHookContext {\n  /** Name of the tool being executed */\n  toolName: string;\n  /** Arguments passed to the tool */\n  args: Record<string, unknown>;\n  /** Agent ID */\n  agentId: string;\n  /** Task ID (if running in TaskAgent) */\n  taskId?: string;\n}\n\n/**\n * Tool execution result passed to afterToolExecution hook\n */\nexport interface ToolExecutionResult {\n  /** Name of the tool that was executed */\n  toolName: string;\n  /** Result returned by the tool */\n  result: unknown;\n  /** Execution duration in milliseconds */\n  durationMs: number;\n  /** Whether the execution was successful */\n  success: boolean;\n  /** Error if execution failed */\n  error?: Error;\n}\n\n/**\n * Context passed to beforeCompaction hook\n */\nexport interface BeforeCompactionContext {\n  /** Agent identifier */\n  agentId: string;\n  /** Current context budget info */\n  currentBudget: {\n    total: number;\n    used: number;\n    available: number;\n    utilizationPercent: number;\n    status: 'ok' | 'warning' | 'critical';\n  };\n  /** Compaction strategy being used */\n  strategy: string;\n  /** Current context components (read-only) */\n  components: ReadonlyArray<{\n    name: string;\n    priority: number;\n    compactable: boolean;\n  }>;\n  /** Estimated tokens to be freed */\n  estimatedTokensToFree: number;\n}\n\n/**\n * Agent lifecycle hooks for customization.\n * These hooks allow external code to observe and modify agent behavior\n * at key points in the execution lifecycle.\n */\nexport interface AgentLifecycleHooks {\n  /**\n   * Called before a tool is executed.\n   * Can be used for logging, validation, or rate limiting.\n   * Throw an error to prevent tool execution.\n   *\n   * @param context - Tool execution context\n   * @returns Promise that resolves when hook completes\n   */\n  beforeToolExecution?: (context: ToolExecutionHookContext) => Promise<void>;\n\n  /**\n   * Called after a tool execution completes (success or failure).\n   * Can be used for logging, metrics, or cleanup.\n   *\n   * @param result - Tool execution result\n   * @returns Promise that resolves when hook completes\n   */\n  afterToolExecution?: (result: ToolExecutionResult) => Promise<void>;\n\n  /**\n   * Called before context is prepared for LLM call.\n   * Can be used to inject additional context or modify components.\n   *\n   * @param agentId - Agent identifier\n   * @returns Promise that resolves when hook completes\n   */\n  beforeContextPrepare?: (agentId: string) => Promise<void>;\n\n  /**\n   * Called before context compaction occurs.\n   * Use this hook to save important data to working memory before it's compacted.\n   * This is your last chance to preserve critical information from tool outputs\n   * or conversation history that would otherwise be lost.\n   *\n   * @param context - Compaction context with budget info and components\n   * @returns Promise that resolves when hook completes\n   */\n  beforeCompaction?: (context: BeforeCompactionContext) => Promise<void>;\n\n  /**\n   * Called after context compaction occurs.\n   * Can be used for logging or monitoring context management.\n   *\n   * @param log - Compaction log messages\n   * @param tokensFreed - Number of tokens freed\n   * @returns Promise that resolves when hook completes\n   */\n  afterCompaction?: (log: string[], tokensFreed: number) => Promise<void>;\n\n  /**\n   * Called when agent encounters an error.\n   * Can be used for custom error handling or recovery logic.\n   *\n   * @param error - The error that occurred\n   * @param context - Additional context about where the error occurred\n   * @returns Promise that resolves when hook completes\n   */\n  onError?: (error: Error, context: { phase: string; agentId: string }) => Promise<void>;\n}\n\n/**\n * Base configuration shared by all agent types\n */\nexport interface BaseAgentConfig {\n  /** Connector name or instance */\n  connector: string | Connector;\n\n  /** Model identifier */\n  model: string;\n\n  /** Agent name (optional, auto-generated if not provided) */\n  name?: string;\n\n  /** Tools available to the agent */\n  tools?: ToolFunction[];\n\n  /** Provide a pre-configured ToolManager (advanced) */\n  toolManager?: ToolManager;\n\n  /** Session configuration (uses AgentContext persistence) */\n  session?: BaseSessionConfig;\n\n  /** Permission configuration */\n  permissions?: AgentPermissionsConfig;\n\n  /** Lifecycle hooks for customization */\n  lifecycleHooks?: AgentLifecycleHooks;\n\n  /**\n   * Optional AgentContext configuration.\n   * If provided as AgentContext instance, it will be used directly.\n   * If provided as config object, a new AgentContext will be created.\n   * If not provided, a default AgentContext will be created.\n   */\n  context?: AgentContext | AgentContextConfig;\n}\n\n/**\n * Base events emitted by all agent types.\n * Agent subclasses typically extend their own event interfaces.\n */\nexport interface BaseAgentEvents {\n  'session:saved': { sessionId: string };\n  'session:loaded': { sessionId: string };\n  destroyed: void;\n}\n\n/**\n * Options for direct LLM calls (bypassing AgentContext).\n */\nexport interface DirectCallOptions {\n  /** System instructions (optional) */\n  instructions?: string;\n\n  /** Include registered tools in the call. Default: false */\n  includeTools?: boolean;\n\n  /** Temperature for generation */\n  temperature?: number;\n\n  /** Maximum output tokens */\n  maxOutputTokens?: number;\n\n  /** Response format (text, json_object, json_schema) */\n  responseFormat?: {\n    type: 'text' | 'json_object' | 'json_schema';\n    json_schema?: unknown;\n  };\n\n  /** Vendor-specific options */\n  vendorOptions?: Record<string, unknown>;\n}\n\n/**\n * Abstract base class for all agent types.\n *\n * @internal This class is not exported in the public API.\n *\n * Note: TEvents is not constrained to BaseAgentEvents to allow subclasses\n * to define their own event interfaces (e.g., AgenticLoopEvents for Agent).\n */\nexport abstract class BaseAgent<\n  TConfig extends BaseAgentConfig = BaseAgentConfig,\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  TEvents extends Record<string, any> = BaseAgentEvents,\n> extends EventEmitter<TEvents> {\n  // ===== Core Properties =====\n  readonly name: string;\n  readonly connector: Connector;\n  readonly model: string;\n\n  // ===== Protected State =====\n  protected _config: TConfig;\n  protected _agentContext: AgentContext;  // SINGLE SOURCE OF TRUTH for tools and sessions\n  protected _permissionManager: ToolPermissionManager;\n  protected _isDestroyed = false;\n  protected _cleanupCallbacks: Array<() => void | Promise<void>> = [];\n  protected _logger: FrameworkLogger;\n  protected _lifecycleHooks: AgentLifecycleHooks;\n\n  // Session state\n  protected _sessionConfig: BaseSessionConfig | null = null;\n  protected _autoSaveInterval: ReturnType<typeof setInterval> | null = null;\n  protected _pendingSessionLoad: Promise<boolean> | null = null;\n\n  // Lazy-initialized provider for direct calls\n  private _directProvider: ITextProvider | null = null;\n\n  // ===== Constructor =====\n\n  constructor(config: TConfig, loggerComponent: string) {\n    super();\n    this._config = config;\n\n    // Resolve connector\n    this.connector = this.resolveConnector(config.connector);\n\n    // Set name\n    this.name = config.name ?? `${this.getAgentType()}-${Date.now()}`;\n    this.model = config.model;\n\n    // Create logger\n    this._logger = logger.child({\n      component: loggerComponent,\n      agentName: this.name,\n      model: this.model,\n      connector: this.connector.name,\n    });\n\n    // Initialize AgentContext FIRST (single source of truth for tools and sessions)\n    this._agentContext = this.initializeAgentContext(config);\n\n    // Register tools with AgentContext if provided\n    if (config.tools) {\n      for (const tool of config.tools) {\n        this._agentContext.tools.register(tool);\n      }\n    }\n\n    // Initialize permission manager (uses tools from AgentContext)\n    this._permissionManager = this.initializePermissionManager(config.permissions, config.tools);\n\n    // Initialize lifecycle hooks\n    this._lifecycleHooks = config.lifecycleHooks ?? {};\n  }\n\n  // ===== Abstract Methods =====\n\n  /**\n   * Get the agent type identifier\n   */\n  protected abstract getAgentType(): 'agent' | 'task-agent' | 'universal-agent';\n\n  // ===== Protected Initialization Helpers =====\n\n  /**\n   * Resolve connector from string name or instance\n   */\n  protected resolveConnector(ref: string | Connector): Connector {\n    if (typeof ref === 'string') {\n      return Connector.get(ref);\n    }\n    return ref;\n  }\n\n  /**\n   * Initialize AgentContext (single source of truth for tools and sessions).\n   * If AgentContext is provided, use it directly.\n   * Otherwise, create a new one with the provided configuration.\n   */\n  protected initializeAgentContext(config: TConfig): AgentContext {\n    // If AgentContext instance is provided, use it directly\n    if (config.context instanceof AgentContext) {\n      return config.context;\n    }\n\n    // Create new AgentContext with merged config\n    // NOTE: Don't pass tools here - they're registered separately after creation\n    // to allow subclasses to wrap or modify tools before registration\n    const contextConfig: AgentContextConfig = {\n      model: config.model,\n      agentId: config.name,\n      // Include storage if session config is provided\n      storage: config.session?.storage,\n      // Subclasses can add systemPrompt via their config\n      ...(typeof config.context === 'object' && config.context !== null ? config.context : {}),\n    };\n\n    return AgentContext.create(contextConfig);\n  }\n\n  /**\n   * Initialize permission manager\n   */\n  protected initializePermissionManager(\n    config?: AgentPermissionsConfig,\n    tools?: ToolFunction[]\n  ): ToolPermissionManager {\n    const manager = new ToolPermissionManager(config);\n\n    // Register tool permission configs\n    if (tools) {\n      for (const tool of tools) {\n        if (tool.permission) {\n          manager.setToolConfig(tool.definition.function.name, tool.permission);\n        }\n      }\n    }\n\n    return manager;\n  }\n\n  /**\n   * Initialize session management (call from subclass constructor after other setup)\n   * Now uses AgentContext.save()/load() for persistence.\n   */\n  protected initializeSession(sessionConfig?: BaseSessionConfig): void {\n    if (!sessionConfig) {\n      return;\n    }\n\n    this._sessionConfig = sessionConfig;\n\n    if (sessionConfig.id) {\n      // Resume existing session (async)\n      this._pendingSessionLoad = this.loadSession(sessionConfig.id);\n    }\n\n    // Setup auto-save if configured\n    if (sessionConfig.autoSave) {\n      const interval = sessionConfig.autoSaveIntervalMs ?? 30000;\n      this._autoSaveInterval = setInterval(async () => {\n        try {\n          if (this._agentContext.sessionId) {\n            await this._agentContext.save();\n            this._logger.debug({ sessionId: this._agentContext.sessionId }, 'Auto-saved session');\n          }\n        } catch (error) {\n          this._logger.error({ error: (error as Error).message }, 'Auto-save failed');\n        }\n      }, interval);\n    }\n  }\n\n  /**\n   * Ensure any pending session load is complete\n   */\n  protected async ensureSessionLoaded(): Promise<void> {\n    if (this._pendingSessionLoad) {\n      await this._pendingSessionLoad;\n      this._pendingSessionLoad = null;\n    }\n  }\n\n  // ===== Public Session API =====\n\n  /**\n   * Get the current session ID (if session is enabled)\n   * Delegates to AgentContext.\n   */\n  getSessionId(): string | null {\n    return this._agentContext.sessionId;\n  }\n\n  /**\n   * Check if this agent has session support enabled\n   */\n  hasSession(): boolean {\n    return this._agentContext.storage !== null;\n  }\n\n  /**\n   * Save the current session to storage.\n   * Uses getContextState() to get state, allowing subclasses to inject agent-level state.\n   *\n   * @param sessionId - Optional session ID (uses current or generates new)\n   * @param metadata - Optional session metadata\n   * @throws Error if storage is not configured\n   */\n  async saveSession(sessionId?: string, metadata?: ContextSessionMetadata): Promise<void> {\n    await this.ensureSessionLoaded();\n    // Get state via overridable method (allows agents to inject agentState)\n    const state = await this.getContextState();\n    await this._agentContext.save(sessionId, metadata, state);\n    this._logger.debug({ sessionId: this._agentContext.sessionId }, 'Session saved');\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    (this.emit as any)('session:saved', { sessionId: this._agentContext.sessionId });\n  }\n\n  /**\n   * Load a session from storage.\n   * Uses restoreContextState() to restore state, allowing subclasses to restore agent-level state.\n   *\n   * @param sessionId - Session ID to load\n   * @returns true if session was found and loaded, false if not found\n   * @throws Error if storage is not configured\n   */\n  async loadSession(sessionId: string): Promise<boolean> {\n    // Load raw state (doesn't restore yet)\n    const result = await this._agentContext.loadRaw(sessionId);\n    if (!result) {\n      this._logger.warn({ sessionId }, 'Session not found');\n      return false;\n    }\n    // Restore via overridable method (allows agents to restore agentState)\n    await this.restoreContextState(result.state);\n    this._logger.info({ sessionId }, 'Session loaded');\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    (this.emit as any)('session:loaded', { sessionId });\n    return true;\n  }\n\n  /**\n   * Check if a session exists in storage.\n   * Delegates to AgentContext.sessionExists().\n   */\n  async sessionExists(sessionId: string): Promise<boolean> {\n    return this._agentContext.sessionExists(sessionId);\n  }\n\n  /**\n   * Delete a session from storage.\n   * Delegates to AgentContext.deleteSession().\n   */\n  async deleteSession(sessionId?: string): Promise<void> {\n    await this._agentContext.deleteSession(sessionId);\n    this._logger.debug({ sessionId }, 'Session deleted');\n  }\n\n  /**\n   * Get context state for session persistence.\n   * Override in subclasses to include agent-specific state in agentState field.\n   */\n  async getContextState(): Promise<import('./AgentContext.js').SerializedAgentContextState> {\n    return this._agentContext.getState();\n  }\n\n  /**\n   * Restore context from saved state.\n   * Override in subclasses to restore agent-specific state from agentState field.\n   */\n  async restoreContextState(state: import('./AgentContext.js').SerializedAgentContextState): Promise<void> {\n    await this._agentContext.restoreState(state);\n  }\n\n  // ===== Public Permission API =====\n\n  /**\n   * Advanced tool management. Returns ToolManager for fine-grained control.\n   * This is delegated to AgentContext.tools (single source of truth).\n   */\n  get tools(): ToolManager {\n    return this._agentContext.tools;\n  }\n\n  /**\n   * Get the AgentContext (unified context management).\n   * This is the primary way to access tools, memory, cache, permissions, and history.\n   */\n  get context(): AgentContext {\n    return this._agentContext;\n  }\n\n  /**\n   * Permission management. Returns ToolPermissionManager for approval control.\n   */\n  get permissions(): ToolPermissionManager {\n    return this._permissionManager;\n  }\n\n  // ===== Tool Management =====\n\n  /**\n   * Add a tool to the agent.\n   * Tools are registered with AgentContext (single source of truth).\n   */\n  addTool(tool: ToolFunction): void {\n    this._agentContext.tools.register(tool);\n\n    // Sync permission config if tool has one\n    if (tool.permission) {\n      this._permissionManager.setToolConfig(tool.definition.function.name, tool.permission);\n    }\n  }\n\n  /**\n   * Remove a tool from the agent.\n   * Tools are unregistered from AgentContext (single source of truth).\n   */\n  removeTool(toolName: string): void {\n    this._agentContext.tools.unregister(toolName);\n  }\n\n  /**\n   * List registered tools (returns enabled tool names)\n   */\n  listTools(): string[] {\n    return this._agentContext.tools.listEnabled();\n  }\n\n  /**\n   * Replace all tools with a new array\n   */\n  setTools(tools: ToolFunction[]): void {\n    this._agentContext.tools.clear();\n    for (const tool of tools) {\n      this._agentContext.tools.register(tool);\n      if (tool.permission) {\n        this._permissionManager.setToolConfig(tool.definition.function.name, tool.permission);\n      }\n    }\n  }\n\n  /**\n   * Get enabled tool definitions (for passing to LLM).\n   * This is a helper that extracts definitions from enabled tools.\n   */\n  protected getEnabledToolDefinitions(): import('../domain/entities/Tool.js').FunctionToolDefinition[] {\n    return this._agentContext.tools.getEnabled().map((t) => t.definition);\n  }\n\n  // ===== Direct LLM Access (Bypasses AgentContext) =====\n\n  /**\n   * Get or create the provider for direct calls.\n   * Lazily initialized to avoid creating provider if not used.\n   */\n  private getDirectProvider(): ITextProvider {\n    if (!this._directProvider) {\n      this._directProvider = createProvider(this.connector);\n    }\n    return this._directProvider;\n  }\n\n  /**\n   * Make a direct LLM call bypassing all context management.\n   *\n   * This method:\n   * - Does NOT track messages in history\n   * - Does NOT use AgentContext features (memory, cache, etc.)\n   * - Does NOT prepare context or run compaction\n   * - Does NOT go through the agentic loop (no tool execution)\n   *\n   * Use this for simple, stateless interactions where you want raw LLM access\n   * without the overhead of context management.\n   *\n   * @param input - Text string or array of InputItems (supports multimodal: text + images)\n   * @param options - Optional configuration for the call\n   * @returns Raw LLM response\n   *\n   * @example\n   * ```typescript\n   * // Simple text call\n   * const response = await agent.runDirect('What is 2 + 2?');\n   * console.log(response.output_text);\n   *\n   * // With options\n   * const response = await agent.runDirect('Summarize this', {\n   *   instructions: 'Be concise',\n   *   temperature: 0.5,\n   * });\n   *\n   * // Multimodal (text + image)\n   * const response = await agent.runDirect([\n   *   { type: 'message', role: 'user', content: [\n   *     { type: 'input_text', text: 'What is in this image?' },\n   *     { type: 'input_image', image_url: 'https://...' }\n   *   ]}\n   * ]);\n   *\n   * // With tools (single call, no loop)\n   * const response = await agent.runDirect('Get the weather', {\n   *   includeTools: true,\n   * });\n   * // Note: If the LLM returns a tool call, you must handle it yourself\n   * ```\n   */\n  async runDirect(\n    input: string | InputItem[],\n    options: DirectCallOptions = {}\n  ): Promise<LLMResponse> {\n    if (this._isDestroyed) {\n      throw new Error('Agent has been destroyed');\n    }\n\n    const provider = this.getDirectProvider();\n\n    const generateOptions = {\n      model: this.model,\n      input,\n      instructions: options.instructions,\n      tools: options.includeTools ? this.getEnabledToolDefinitions() : undefined,\n      temperature: options.temperature,\n      max_output_tokens: options.maxOutputTokens,\n      response_format: options.responseFormat,\n      vendorOptions: options.vendorOptions,\n    };\n\n    this._logger.debug({ inputType: typeof input }, 'runDirect called');\n\n    try {\n      const response = await provider.generate(generateOptions);\n      this._logger.debug({ outputLength: response.output_text?.length }, 'runDirect completed');\n      return response;\n    } catch (error) {\n      this._logger.error({ error: (error as Error).message }, 'runDirect failed');\n      throw error;\n    }\n  }\n\n  /**\n   * Stream a direct LLM call bypassing all context management.\n   *\n   * Same as runDirect but returns a stream of events instead of waiting\n   * for the complete response. Useful for real-time output display.\n   *\n   * @param input - Text string or array of InputItems (supports multimodal)\n   * @param options - Optional configuration for the call\n   * @returns Async iterator of stream events\n   *\n   * @example\n   * ```typescript\n   * for await (const event of agent.streamDirect('Tell me a story')) {\n   *   if (event.type === 'output_text_delta') {\n   *     process.stdout.write(event.delta);\n   *   }\n   * }\n   * ```\n   */\n  async *streamDirect(\n    input: string | InputItem[],\n    options: DirectCallOptions = {}\n  ): AsyncIterableIterator<StreamEvent> {\n    if (this._isDestroyed) {\n      throw new Error('Agent has been destroyed');\n    }\n\n    const provider = this.getDirectProvider();\n\n    const generateOptions = {\n      model: this.model,\n      input,\n      instructions: options.instructions,\n      tools: options.includeTools ? this.getEnabledToolDefinitions() : undefined,\n      temperature: options.temperature,\n      max_output_tokens: options.maxOutputTokens,\n      response_format: options.responseFormat,\n      vendorOptions: options.vendorOptions,\n    };\n\n    this._logger.debug({ inputType: typeof input }, 'streamDirect called');\n\n    try {\n      yield* provider.streamGenerate(generateOptions);\n      this._logger.debug('streamDirect completed');\n    } catch (error) {\n      this._logger.error({ error: (error as Error).message }, 'streamDirect failed');\n      throw error;\n    }\n  }\n\n  // ===== Lifecycle Hooks =====\n\n  /**\n   * Get the current lifecycle hooks configuration\n   */\n  get lifecycleHooks(): AgentLifecycleHooks {\n    return this._lifecycleHooks;\n  }\n\n  /**\n   * Set or update lifecycle hooks at runtime\n   */\n  setLifecycleHooks(hooks: Partial<AgentLifecycleHooks>): void {\n    this._lifecycleHooks = { ...this._lifecycleHooks, ...hooks };\n  }\n\n  /**\n   * Invoke beforeToolExecution hook if defined.\n   * Call this before executing a tool.\n   *\n   * @throws Error if hook throws (prevents tool execution)\n   */\n  protected async invokeBeforeToolExecution(context: ToolExecutionHookContext): Promise<void> {\n    if (this._lifecycleHooks.beforeToolExecution) {\n      try {\n        await this._lifecycleHooks.beforeToolExecution(context);\n      } catch (error) {\n        this._logger.error(\n          { error: (error as Error).message, toolName: context.toolName },\n          'beforeToolExecution hook failed'\n        );\n        throw error; // Re-throw to prevent tool execution\n      }\n    }\n  }\n\n  /**\n   * Invoke afterToolExecution hook if defined.\n   * Call this after tool execution completes (success or failure).\n   */\n  protected async invokeAfterToolExecution(result: ToolExecutionResult): Promise<void> {\n    if (this._lifecycleHooks.afterToolExecution) {\n      try {\n        await this._lifecycleHooks.afterToolExecution(result);\n      } catch (error) {\n        this._logger.error(\n          { error: (error as Error).message, toolName: result.toolName },\n          'afterToolExecution hook failed'\n        );\n        // Don't re-throw - hook failure shouldn't affect main flow after execution\n      }\n    }\n  }\n\n  /**\n   * Invoke beforeContextPrepare hook if defined.\n   * Call this before preparing context for LLM.\n   */\n  protected async invokeBeforeContextPrepare(): Promise<void> {\n    if (this._lifecycleHooks.beforeContextPrepare) {\n      try {\n        await this._lifecycleHooks.beforeContextPrepare(this.name);\n      } catch (error) {\n        this._logger.error(\n          { error: (error as Error).message },\n          'beforeContextPrepare hook failed'\n        );\n        // Don't re-throw - allow context preparation to continue\n      }\n    }\n  }\n\n  /**\n   * Invoke beforeCompaction hook if defined.\n   * Call this before context compaction occurs.\n   * Gives the agent a chance to save important data to memory.\n   */\n  protected async invokeBeforeCompaction(context: BeforeCompactionContext): Promise<void> {\n    if (this._lifecycleHooks.beforeCompaction) {\n      try {\n        await this._lifecycleHooks.beforeCompaction(context);\n      } catch (error) {\n        this._logger.error(\n          {\n            error: (error as Error).message,\n            strategy: context.strategy,\n            estimatedTokensToFree: context.estimatedTokensToFree,\n          },\n          'beforeCompaction hook failed'\n        );\n        // Don't re-throw - allow compaction to continue\n      }\n    }\n  }\n\n  /**\n   * Invoke afterCompaction hook if defined.\n   * Call this after context compaction occurs.\n   */\n  protected async invokeAfterCompaction(log: string[], tokensFreed: number): Promise<void> {\n    if (this._lifecycleHooks.afterCompaction) {\n      try {\n        await this._lifecycleHooks.afterCompaction(log, tokensFreed);\n      } catch (error) {\n        this._logger.error(\n          { error: (error as Error).message, tokensFreed },\n          'afterCompaction hook failed'\n        );\n        // Don't re-throw - allow execution to continue\n      }\n    }\n  }\n\n  /**\n   * Invoke onError hook if defined.\n   * Call this when the agent encounters an error.\n   */\n  protected async invokeOnError(error: Error, phase: string): Promise<void> {\n    if (this._lifecycleHooks.onError) {\n      try {\n        await this._lifecycleHooks.onError(error, { phase, agentId: this.name });\n      } catch (hookError) {\n        this._logger.error(\n          { error: (hookError as Error).message, originalError: error.message, phase },\n          'onError hook failed'\n        );\n        // Don't re-throw - hook failure shouldn't mask original error\n      }\n    }\n  }\n\n  // ===== Lifecycle =====\n\n  get isDestroyed(): boolean {\n    return this._isDestroyed;\n  }\n\n  /**\n   * Register a cleanup callback\n   */\n  onCleanup(callback: () => void | Promise<void>): void {\n    this._cleanupCallbacks.push(callback);\n  }\n\n  /**\n   * Base cleanup for session and listeners.\n   * Subclasses should call super.baseDestroy() in their destroy() method.\n   */\n  protected baseDestroy(): void {\n    if (this._isDestroyed) {\n      return;\n    }\n    this._isDestroyed = true;\n\n    this._logger.debug('Agent destroy started');\n\n    // Stop auto-save interval\n    if (this._autoSaveInterval) {\n      clearInterval(this._autoSaveInterval);\n      this._autoSaveInterval = null;\n    }\n\n    // Cleanup AgentContext (handles tools, memory, cache, plugins)\n    this._agentContext.destroy();\n\n    // Cleanup permission manager listeners\n    this._permissionManager.removeAllListeners();\n\n    // Remove all event listeners\n    this.removeAllListeners();\n\n    // Emit destroyed event (before removing listeners)\n    // Note: This won't be received since we removed listeners above\n    // but subclasses can emit before calling baseDestroy if needed\n  }\n\n  /**\n   * Run cleanup callbacks\n   */\n  protected async runCleanupCallbacks(): Promise<void> {\n    for (const callback of this._cleanupCallbacks) {\n      try {\n        await callback();\n      } catch (error) {\n        this._logger.error({ error: (error as Error).message }, 'Cleanup callback error');\n      }\n    }\n    this._cleanupCallbacks = [];\n  }\n}\n","/**\n * Tool Permission Types\n *\n * Defines permission scopes, risk levels, and approval state for tool execution control.\n *\n * Works with ALL agent types:\n * - Agent (basic)\n * - TaskAgent (task-based)\n * - UniversalAgent (mode-fluid)\n */\n\nimport type { ToolCall } from '../../domain/entities/Tool.js';\n\n// ============================================================================\n// Permission Scopes\n// ============================================================================\n\n/**\n * Permission scope defines when approval is required for a tool\n *\n * - `once` - Require approval for each tool call (most restrictive)\n * - `session` - Approve once, valid for entire session\n * - `always` - Auto-approve (allowlisted, no prompts)\n * - `never` - Always blocked (blocklisted, tool cannot execute)\n */\nexport type PermissionScope = 'once' | 'session' | 'always' | 'never';\n\n/**\n * Risk level classification for tools\n *\n * Used to help users understand the potential impact of approving a tool.\n * Can be used by UI to show different approval dialogs.\n */\nexport type RiskLevel = 'low' | 'medium' | 'high' | 'critical';\n\n// ============================================================================\n// Tool Permission Configuration\n// ============================================================================\n\n/**\n * Permission configuration for a tool\n *\n * Can be set on the tool definition or overridden at registration time.\n */\nexport interface ToolPermissionConfig {\n  /**\n   * When approval is required.\n   * @default 'once'\n   */\n  scope?: PermissionScope;\n\n  /**\n   * Risk classification for the tool.\n   * @default 'low'\n   */\n  riskLevel?: RiskLevel;\n\n  /**\n   * Custom message shown in approval UI.\n   * Should explain what the tool does and any potential risks.\n   */\n  approvalMessage?: string;\n\n  /**\n   * Argument names that should be highlighted in approval UI.\n   * E.g., ['path', 'url'] for file/network operations.\n   */\n  sensitiveArgs?: string[];\n\n  /**\n   * Optional expiration time for session approvals (milliseconds).\n   * If set, session approvals expire after this duration.\n   */\n  sessionTTLMs?: number;\n}\n\n// ============================================================================\n// Permission Check Context (passed to approval hooks)\n// ============================================================================\n\n/**\n * Context passed to approval callbacks/hooks\n */\nexport interface PermissionCheckContext {\n  /** The tool call being checked */\n  toolCall: ToolCall;\n\n  /** Parsed arguments (for display/inspection) */\n  parsedArgs: Record<string, unknown>;\n\n  /** The tool's permission config */\n  config: ToolPermissionConfig;\n\n  /** Current execution context ID */\n  executionId: string;\n\n  /** Current iteration (if in agentic loop) */\n  iteration: number;\n\n  /** Agent type (for context-specific handling) */\n  agentType: 'agent' | 'task-agent' | 'universal-agent';\n\n  /** Optional task name (for TaskAgent/UniversalAgent) */\n  taskName?: string;\n}\n\n// ============================================================================\n// Approval State (Runtime)\n// ============================================================================\n\n/**\n * Entry in the approval cache representing an approved tool\n */\nexport interface ApprovalCacheEntry {\n  /** Name of the approved tool */\n  toolName: string;\n\n  /** The scope that was approved */\n  scope: PermissionScope;\n\n  /** When the approval was granted */\n  approvedAt: Date;\n\n  /** Optional identifier of who approved (for audit) */\n  approvedBy?: string;\n\n  /** When this approval expires (for session/TTL approvals) */\n  expiresAt?: Date;\n\n  /** Arguments hash if approval was for specific arguments */\n  argsHash?: string;\n}\n\n/**\n * Serialized approval state for session persistence\n */\nexport interface SerializedApprovalState {\n  /** Version for future migrations */\n  version: number;\n\n  /** Map of tool name to approval entry */\n  approvals: Record<string, SerializedApprovalEntry>;\n\n  /** Tools that are always blocked (persisted blocklist) */\n  blocklist: string[];\n\n  /** Tools that are always allowed (persisted allowlist) */\n  allowlist: string[];\n}\n\n/**\n * Serialized version of ApprovalCacheEntry (with ISO date strings)\n */\nexport interface SerializedApprovalEntry {\n  toolName: string;\n  scope: PermissionScope;\n  approvedAt: string; // ISO date string\n  approvedBy?: string;\n  expiresAt?: string; // ISO date string\n  argsHash?: string;\n}\n\n// ============================================================================\n// Permission Check Results\n// ============================================================================\n\n/**\n * Result of checking if a tool needs approval\n */\nexport interface PermissionCheckResult {\n  /** Whether the tool can execute without prompting */\n  allowed: boolean;\n\n  /** Whether approval is needed (user should be prompted) */\n  needsApproval: boolean;\n\n  /** Whether the tool is blocked (cannot execute at all) */\n  blocked: boolean;\n\n  /** Reason for the decision */\n  reason: string;\n\n  /** The tool's permission config (for UI display) */\n  config?: ToolPermissionConfig;\n}\n\n/**\n * Result from approval UI/hook\n */\nexport interface ApprovalDecision {\n  /** Whether the tool was approved */\n  approved: boolean;\n\n  /** Scope of the approval (may differ from requested) */\n  scope?: PermissionScope;\n\n  /** Reason for denial (if not approved) */\n  reason?: string;\n\n  /** Optional identifier of who approved */\n  approvedBy?: string;\n\n  /** Whether to remember this decision for future calls */\n  remember?: boolean;\n}\n\n// ============================================================================\n// Agent Configuration (works with ALL agent types)\n// ============================================================================\n\n/**\n * Permission configuration for any agent type.\n *\n * Used in:\n * - Agent.create({ permissions: {...} })\n * - TaskAgent.create({ permissions: {...} })\n * - UniversalAgent.create({ permissions: {...} })\n */\nexport interface AgentPermissionsConfig {\n  /**\n   * Default permission scope for tools without explicit config.\n   * @default 'once'\n   */\n  defaultScope?: PermissionScope;\n\n  /**\n   * Default risk level for tools without explicit config.\n   * @default 'low'\n   */\n  defaultRiskLevel?: RiskLevel;\n\n  /**\n   * Tools that are always allowed (never prompt).\n   * Array of tool names.\n   */\n  allowlist?: string[];\n\n  /**\n   * Tools that are always blocked (cannot execute).\n   * Array of tool names.\n   */\n  blocklist?: string[];\n\n  /**\n   * Per-tool permission overrides.\n   * Keys are tool names, values are permission configs.\n   */\n  tools?: Record<string, ToolPermissionConfig>;\n\n  /**\n   * Callback invoked when a tool needs approval.\n   * Return an ApprovalDecision to approve/deny.\n   *\n   * If not provided, the existing `approve:tool` hook system is used.\n   * This callback runs BEFORE hooks, providing a first-pass check.\n   */\n  onApprovalRequired?: (context: PermissionCheckContext) => Promise<ApprovalDecision>;\n\n  /**\n   * Whether to inherit permission state from parent session.\n   * Only applies when resuming from a session.\n   * @default true\n   */\n  inheritFromSession?: boolean;\n}\n\n// ============================================================================\n// Events\n// ============================================================================\n\n/**\n * Events emitted by ToolPermissionManager\n */\nexport type PermissionManagerEvent =\n  | 'tool:approved'\n  | 'tool:denied'\n  | 'tool:blocked'\n  | 'tool:revoked'\n  | 'allowlist:added'\n  | 'allowlist:removed'\n  | 'blocklist:added'\n  | 'blocklist:removed'\n  | 'session:cleared';\n\n// ============================================================================\n// Constants\n// ============================================================================\n\n/**\n * Current version of serialized approval state\n */\nexport const APPROVAL_STATE_VERSION = 1;\n\n/**\n * Default permission config applied when no config is specified\n */\nexport const DEFAULT_PERMISSION_CONFIG: Required<Pick<ToolPermissionConfig, 'scope' | 'riskLevel'>> = {\n  scope: 'once',\n  riskLevel: 'low',\n};\n\n/**\n * Default allowlist - tools that never require user confirmation.\n *\n * These tools are safe to execute without user approval:\n * - Read-only operations (filesystem reads, searches)\n * - Internal state management (memory tools)\n * - Introspection tools (context/cache stats)\n * - Meta-tools for agent coordination\n *\n * All other tools (write operations, shell commands, external requests)\n * require explicit user approval by default.\n */\nexport const DEFAULT_ALLOWLIST: readonly string[] = [\n  // Filesystem read-only tools\n  'read_file',\n  'glob',\n  'grep',\n  'list_directory',\n\n  // Memory management (internal state - safe)\n  'memory_store',\n  'memory_retrieve',\n  'memory_delete',\n  'memory_list',\n\n  // Context introspection (read-only)\n  'context_inspect',\n  'context_breakdown',\n  'cache_stats',\n  'memory_stats',\n\n  // Meta-tools (internal coordination)\n  '_start_planning',\n  '_modify_plan',\n  '_report_progress',\n  '_request_approval', // CRITICAL: Must be allowlisted to avoid circular dependency!\n] as const;\n\n/**\n * Type for default allowlisted tools\n */\nexport type DefaultAllowlistedTool = (typeof DEFAULT_ALLOWLIST)[number];\n","/**\n * ToolPermissionManager - Core class for managing tool permissions\n *\n * Features:\n * - Approval caching (once, session, always, never scopes)\n * - Allowlist/blocklist management\n * - Session state persistence\n * - Event emission for audit trails\n *\n * Works with ALL agent types:\n * - Agent (basic)\n * - TaskAgent (task-based)\n * - UniversalAgent (mode-fluid)\n */\n\nimport { EventEmitter } from 'eventemitter3';\nimport type {\n  PermissionScope,\n  RiskLevel,\n  ToolPermissionConfig,\n  ApprovalCacheEntry,\n  SerializedApprovalState,\n  SerializedApprovalEntry,\n  PermissionCheckResult,\n  ApprovalDecision,\n  AgentPermissionsConfig,\n  PermissionCheckContext,\n} from './types.js';\nimport {\n  APPROVAL_STATE_VERSION,\n  DEFAULT_PERMISSION_CONFIG,\n  DEFAULT_ALLOWLIST,\n} from './types.js';\nimport type { ToolCall } from '../../domain/entities/Tool.js';\n\n// ============================================================================\n// Event Types\n// ============================================================================\n\nexport interface PermissionManagerEvents {\n  'tool:approved': { toolName: string; scope: PermissionScope; approvedBy?: string };\n  'tool:denied': { toolName: string; reason: string };\n  'tool:blocked': { toolName: string; reason: string };\n  'tool:revoked': { toolName: string };\n  'allowlist:added': { toolName: string };\n  'allowlist:removed': { toolName: string };\n  'blocklist:added': { toolName: string };\n  'blocklist:removed': { toolName: string };\n  'session:cleared': {};\n}\n\n// ============================================================================\n// ToolPermissionManager Class\n// ============================================================================\n\nexport class ToolPermissionManager extends EventEmitter {\n  // Approval cache (session-level)\n  private approvalCache: Map<string, ApprovalCacheEntry> = new Map();\n\n  // Allow/block lists\n  private allowlist: Set<string> = new Set();\n  private blocklist: Set<string> = new Set();\n\n  // Per-tool configurations\n  private toolConfigs: Map<string, ToolPermissionConfig> = new Map();\n\n  // Defaults\n  private defaultScope: PermissionScope;\n  private defaultRiskLevel: RiskLevel;\n\n  // Optional approval callback\n  private onApprovalRequired?: (context: PermissionCheckContext) => Promise<ApprovalDecision>;\n\n  constructor(config?: AgentPermissionsConfig) {\n    super();\n\n    this.defaultScope = config?.defaultScope ?? DEFAULT_PERMISSION_CONFIG.scope;\n    this.defaultRiskLevel = config?.defaultRiskLevel ?? DEFAULT_PERMISSION_CONFIG.riskLevel;\n\n    // Initialize allowlist with defaults first\n    // This ensures safe tools (read-only, introspection, meta-tools) are always allowed\n    for (const toolName of DEFAULT_ALLOWLIST) {\n      this.allowlist.add(toolName);\n    }\n\n    // Add user-provided allowlist (merges with defaults)\n    if (config?.allowlist) {\n      for (const toolName of config.allowlist) {\n        this.allowlist.add(toolName);\n      }\n    }\n\n    // Initialize blocklist\n    if (config?.blocklist) {\n      for (const toolName of config.blocklist) {\n        this.blocklist.add(toolName);\n      }\n    }\n\n    // Initialize per-tool configs\n    if (config?.tools) {\n      for (const [toolName, toolConfig] of Object.entries(config.tools)) {\n        this.toolConfigs.set(toolName, toolConfig);\n      }\n    }\n\n    // Store approval callback\n    this.onApprovalRequired = config?.onApprovalRequired;\n  }\n\n  // ==========================================================================\n  // Core Permission Checking\n  // ==========================================================================\n\n  /**\n   * Check if a tool needs approval before execution\n   *\n   * @param toolName - Name of the tool\n   * @param _args - Optional arguments (for args-specific approval, reserved for future use)\n   * @returns PermissionCheckResult with allowed/needsApproval/blocked status\n   */\n  checkPermission(toolName: string, _args?: Record<string, unknown>): PermissionCheckResult {\n    const config = this.getEffectiveConfig(toolName);\n\n    // Check blocklist first (highest priority)\n    if (this.blocklist.has(toolName)) {\n      return {\n        allowed: false,\n        needsApproval: false,\n        blocked: true,\n        reason: 'Tool is blocklisted',\n        config,\n      };\n    }\n\n    // Check allowlist (always allowed)\n    if (this.allowlist.has(toolName)) {\n      return {\n        allowed: true,\n        needsApproval: false,\n        blocked: false,\n        reason: 'Tool is allowlisted',\n        config,\n      };\n    }\n\n    // Check scope\n    const scope = config.scope ?? this.defaultScope;\n\n    switch (scope) {\n      case 'always':\n        return {\n          allowed: true,\n          needsApproval: false,\n          blocked: false,\n          reason: 'Tool scope is \"always\"',\n          config,\n        };\n\n      case 'never':\n        return {\n          allowed: false,\n          needsApproval: false,\n          blocked: true,\n          reason: 'Tool scope is \"never\"',\n          config,\n        };\n\n      case 'session':\n        // Check if already approved this session\n        if (this.isApprovedForSession(toolName)) {\n          return {\n            allowed: true,\n            needsApproval: false,\n            blocked: false,\n            reason: 'Tool approved for session',\n            config,\n          };\n        }\n        return {\n          allowed: false,\n          needsApproval: true,\n          blocked: false,\n          reason: 'Session approval required',\n          config,\n        };\n\n      case 'once':\n      default:\n        // Always require approval\n        return {\n          allowed: false,\n          needsApproval: true,\n          blocked: false,\n          reason: 'Per-call approval required',\n          config,\n        };\n    }\n  }\n\n  /**\n   * Check if a tool call needs approval (uses ToolCall object)\n   */\n  needsApproval(toolCall: ToolCall): boolean {\n    const result = this.checkPermission(toolCall.function.name);\n    return result.needsApproval;\n  }\n\n  /**\n   * Check if a tool is blocked\n   */\n  isBlocked(toolName: string): boolean {\n    return this.checkPermission(toolName).blocked;\n  }\n\n  /**\n   * Check if a tool is approved (either allowlisted or session-approved)\n   */\n  isApproved(toolName: string): boolean {\n    return this.checkPermission(toolName).allowed;\n  }\n\n  // ==========================================================================\n  // Approval Management\n  // ==========================================================================\n\n  /**\n   * Approve a tool (record approval)\n   *\n   * @param toolName - Name of the tool\n   * @param decision - Approval decision with scope\n   */\n  approve(toolName: string, decision?: Partial<ApprovalDecision>): void {\n    const scope = decision?.scope ?? 'session';\n    const config = this.getEffectiveConfig(toolName);\n\n    // Calculate expiration\n    let expiresAt: Date | undefined;\n    if (scope === 'session' && config.sessionTTLMs) {\n      expiresAt = new Date(Date.now() + config.sessionTTLMs);\n    }\n\n    const entry: ApprovalCacheEntry = {\n      toolName,\n      scope,\n      approvedAt: new Date(),\n      approvedBy: decision?.approvedBy,\n      expiresAt,\n    };\n\n    this.approvalCache.set(toolName, entry);\n\n    this.emit('tool:approved', {\n      toolName,\n      scope,\n      approvedBy: decision?.approvedBy,\n    });\n  }\n\n  /**\n   * Approve a tool for the entire session\n   */\n  approveForSession(toolName: string, approvedBy?: string): void {\n    this.approve(toolName, { scope: 'session', approvedBy });\n  }\n\n  /**\n   * Revoke a tool's approval\n   */\n  revoke(toolName: string): void {\n    if (this.approvalCache.has(toolName)) {\n      this.approvalCache.delete(toolName);\n      this.emit('tool:revoked', { toolName });\n    }\n  }\n\n  /**\n   * Deny a tool execution (for audit trail)\n   */\n  deny(toolName: string, reason: string): void {\n    this.emit('tool:denied', { toolName, reason });\n  }\n\n  /**\n   * Check if a tool has been approved for the current session\n   */\n  isApprovedForSession(toolName: string): boolean {\n    const entry = this.approvalCache.get(toolName);\n    if (!entry) return false;\n\n    // Check expiration\n    if (entry.expiresAt && entry.expiresAt < new Date()) {\n      this.approvalCache.delete(toolName);\n      return false;\n    }\n\n    return entry.scope === 'session' || entry.scope === 'always';\n  }\n\n  // ==========================================================================\n  // Allowlist / Blocklist Management\n  // ==========================================================================\n\n  /**\n   * Add a tool to the allowlist (always allowed)\n   */\n  allowlistAdd(toolName: string): void {\n    // Remove from blocklist if present\n    this.blocklist.delete(toolName);\n\n    this.allowlist.add(toolName);\n    this.emit('allowlist:added', { toolName });\n  }\n\n  /**\n   * Remove a tool from the allowlist\n   */\n  allowlistRemove(toolName: string): void {\n    if (this.allowlist.delete(toolName)) {\n      this.emit('allowlist:removed', { toolName });\n    }\n  }\n\n  /**\n   * Check if a tool is in the allowlist\n   */\n  isAllowlisted(toolName: string): boolean {\n    return this.allowlist.has(toolName);\n  }\n\n  /**\n   * Get all allowlisted tools\n   */\n  getAllowlist(): string[] {\n    return Array.from(this.allowlist);\n  }\n\n  /**\n   * Add a tool to the blocklist (always blocked)\n   */\n  blocklistAdd(toolName: string): void {\n    // Remove from allowlist if present\n    this.allowlist.delete(toolName);\n\n    this.blocklist.add(toolName);\n    this.emit('blocklist:added', { toolName });\n  }\n\n  /**\n   * Remove a tool from the blocklist\n   */\n  blocklistRemove(toolName: string): void {\n    if (this.blocklist.delete(toolName)) {\n      this.emit('blocklist:removed', { toolName });\n    }\n  }\n\n  /**\n   * Check if a tool is in the blocklist\n   */\n  isBlocklisted(toolName: string): boolean {\n    return this.blocklist.has(toolName);\n  }\n\n  /**\n   * Get all blocklisted tools\n   */\n  getBlocklist(): string[] {\n    return Array.from(this.blocklist);\n  }\n\n  // ==========================================================================\n  // Tool Configuration\n  // ==========================================================================\n\n  /**\n   * Set permission config for a specific tool\n   */\n  setToolConfig(toolName: string, config: ToolPermissionConfig): void {\n    this.toolConfigs.set(toolName, config);\n  }\n\n  /**\n   * Get permission config for a specific tool\n   */\n  getToolConfig(toolName: string): ToolPermissionConfig | undefined {\n    return this.toolConfigs.get(toolName);\n  }\n\n  /**\n   * Get effective config (tool-specific or defaults)\n   */\n  getEffectiveConfig(toolName: string): ToolPermissionConfig {\n    const toolConfig = this.toolConfigs.get(toolName);\n    return {\n      scope: toolConfig?.scope ?? this.defaultScope,\n      riskLevel: toolConfig?.riskLevel ?? this.defaultRiskLevel,\n      approvalMessage: toolConfig?.approvalMessage,\n      sensitiveArgs: toolConfig?.sensitiveArgs,\n      sessionTTLMs: toolConfig?.sessionTTLMs,\n    };\n  }\n\n  // ==========================================================================\n  // Approval Request Handler\n  // ==========================================================================\n\n  /**\n   * Request approval for a tool call\n   *\n   * If an onApprovalRequired callback is set, it will be called.\n   * Otherwise, this auto-approves for backward compatibility.\n   *\n   * NOTE: If you want to require explicit approval, you MUST either:\n   * 1. Set onApprovalRequired callback in AgentPermissionsConfig\n   * 2. Register an 'approve:tool' hook in the AgenticLoop\n   * 3. Add tools to the blocklist if they should never run\n   *\n   * This auto-approval behavior preserves backward compatibility with\n   * existing code that doesn't use the permission system.\n   */\n  async requestApproval(context: PermissionCheckContext): Promise<ApprovalDecision> {\n    if (this.onApprovalRequired) {\n      const decision = await this.onApprovalRequired(context);\n\n      // Record the decision\n      if (decision.approved) {\n        this.approve(context.toolCall.function.name, decision);\n      } else {\n        this.deny(context.toolCall.function.name, decision.reason ?? 'User denied');\n      }\n\n      return decision;\n    }\n\n    // No callback - auto-approve for backward compatibility\n    // This preserves the pre-permission-system behavior where all tools\n    // were automatically allowed to execute. Users who want to require\n    // explicit approval must set onApprovalRequired or use approve:tool hooks.\n    return {\n      approved: true,\n      reason: 'Auto-approved (no approval handler configured)',\n    };\n  }\n\n  // ==========================================================================\n  // Query Methods\n  // ==========================================================================\n\n  /**\n   * Get all tools that have session approvals\n   */\n  getApprovedTools(): string[] {\n    const approved: string[] = [];\n\n    for (const [toolName, entry] of this.approvalCache) {\n      // Skip expired\n      if (entry.expiresAt && entry.expiresAt < new Date()) {\n        continue;\n      }\n      approved.push(toolName);\n    }\n\n    return approved;\n  }\n\n  /**\n   * Get the approval entry for a tool\n   */\n  getApprovalEntry(toolName: string): ApprovalCacheEntry | undefined {\n    const entry = this.approvalCache.get(toolName);\n    if (!entry) return undefined;\n\n    // Check expiration\n    if (entry.expiresAt && entry.expiresAt < new Date()) {\n      this.approvalCache.delete(toolName);\n      return undefined;\n    }\n\n    return entry;\n  }\n\n  // ==========================================================================\n  // Session Management\n  // ==========================================================================\n\n  /**\n   * Clear all session approvals\n   */\n  clearSession(): void {\n    this.approvalCache.clear();\n    this.emit('session:cleared', {});\n  }\n\n  // ==========================================================================\n  // Persistence (for Session integration)\n  // ==========================================================================\n\n  /**\n   * Serialize approval state for persistence\n   */\n  getState(): SerializedApprovalState {\n    const approvals: Record<string, SerializedApprovalEntry> = {};\n\n    for (const [toolName, entry] of this.approvalCache) {\n      // Skip expired entries\n      if (entry.expiresAt && entry.expiresAt < new Date()) {\n        continue;\n      }\n\n      approvals[toolName] = {\n        toolName: entry.toolName,\n        scope: entry.scope,\n        approvedAt: entry.approvedAt.toISOString(),\n        approvedBy: entry.approvedBy,\n        expiresAt: entry.expiresAt?.toISOString(),\n        argsHash: entry.argsHash,\n      };\n    }\n\n    return {\n      version: APPROVAL_STATE_VERSION,\n      approvals,\n      blocklist: Array.from(this.blocklist),\n      allowlist: Array.from(this.allowlist),\n    };\n  }\n\n  /**\n   * Load approval state from persistence\n   */\n  loadState(state: SerializedApprovalState): void {\n    // Clear current state\n    this.approvalCache.clear();\n\n    // Validate version\n    if (state.version !== APPROVAL_STATE_VERSION) {\n      // Future: handle migrations\n      console.warn(`ToolPermissionManager: Unknown state version ${state.version}, ignoring`);\n      return;\n    }\n\n    // Restore approvals\n    for (const [toolName, entry] of Object.entries(state.approvals)) {\n      const approvedAt = new Date(entry.approvedAt);\n      const expiresAt = entry.expiresAt ? new Date(entry.expiresAt) : undefined;\n\n      // Skip expired entries\n      if (expiresAt && expiresAt < new Date()) {\n        continue;\n      }\n\n      this.approvalCache.set(toolName, {\n        toolName: entry.toolName,\n        scope: entry.scope,\n        approvedAt,\n        approvedBy: entry.approvedBy,\n        expiresAt,\n        argsHash: entry.argsHash,\n      });\n    }\n\n    // Restore lists (merge with constructor-provided lists)\n    for (const toolName of state.blocklist) {\n      this.blocklist.add(toolName);\n    }\n\n    for (const toolName of state.allowlist) {\n      // Remove from blocklist if present (allowlist takes precedence in loaded state)\n      this.blocklist.delete(toolName);\n      this.allowlist.add(toolName);\n    }\n  }\n\n  // ==========================================================================\n  // Utility Methods\n  // ==========================================================================\n\n  /**\n   * Get defaults\n   */\n  getDefaults(): { scope: PermissionScope; riskLevel: RiskLevel } {\n    return {\n      scope: this.defaultScope,\n      riskLevel: this.defaultRiskLevel,\n    };\n  }\n\n  /**\n   * Set defaults\n   */\n  setDefaults(defaults: { scope?: PermissionScope; riskLevel?: RiskLevel }): void {\n    if (defaults.scope) this.defaultScope = defaults.scope;\n    if (defaults.riskLevel) this.defaultRiskLevel = defaults.riskLevel;\n  }\n\n  /**\n   * Get summary statistics\n   */\n  getStats(): {\n    approvedCount: number;\n    allowlistedCount: number;\n    blocklistedCount: number;\n    configuredCount: number;\n  } {\n    return {\n      approvedCount: this.getApprovedTools().length,\n      allowlistedCount: this.allowlist.size,\n      blocklistedCount: this.blocklist.size,\n      configuredCount: this.toolConfigs.size,\n    };\n  }\n\n  /**\n   * Reset to initial state\n   */\n  reset(): void {\n    this.approvalCache.clear();\n    this.allowlist.clear();\n    this.blocklist.clear();\n    this.toolConfigs.clear();\n    this.defaultScope = DEFAULT_PERMISSION_CONFIG.scope;\n    this.defaultRiskLevel = DEFAULT_PERMISSION_CONFIG.riskLevel;\n  }\n}\n","/**\n * ToolManager - Unified tool management and execution for agents\n *\n * Provides advanced tool management capabilities:\n * - Enable/disable tools at runtime without removing them\n * - Namespace grouping for organizing related tools\n * - Priority-based selection\n * - Context-aware tool selection\n * - Usage statistics\n * - Circuit breaker protection for tool execution\n * - Implements IToolExecutor for use with AgenticLoop\n * - Implements IDisposable for proper lifecycle management\n *\n * This is the single source of truth for tool management (replaces ToolRegistry).\n */\n\nimport { EventEmitter } from 'eventemitter3';\nimport type { Tool, ToolFunction, ToolPermissionConfig } from '../domain/entities/Tool.js';\nimport type { IToolExecutor } from '../domain/interfaces/IToolExecutor.js';\nimport type { IDisposable } from '../domain/interfaces/IDisposable.js';\nimport type { ToolContext } from '../domain/interfaces/IToolContext.js';\nimport { CircuitBreaker } from '../infrastructure/resilience/CircuitBreaker.js';\nimport type { CircuitState, CircuitBreakerConfig } from '../infrastructure/resilience/CircuitBreaker.js';\nimport { ToolNotFoundError, ToolExecutionError } from '../domain/errors/AIErrors.js';\nimport { logger, FrameworkLogger } from '../infrastructure/observability/Logger.js';\nimport { metrics } from '../infrastructure/observability/Metrics.js';\n\n// Re-export CircuitState for convenience\nexport type { CircuitState, CircuitBreakerConfig } from '../infrastructure/resilience/CircuitBreaker.js';\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport interface ToolOptions {\n  /** Whether the tool is enabled. Default: true */\n  enabled?: boolean;\n  /** Namespace for grouping related tools. Default: 'default' */\n  namespace?: string;\n  /** Priority for selection ordering. Higher = preferred. Default: 0 */\n  priority?: number;\n  /** Conditions for auto-enable/disable */\n  conditions?: ToolCondition[];\n  /** Permission configuration override. If not set, uses tool's config or defaults. */\n  permission?: ToolPermissionConfig;\n}\n\nexport interface ToolCondition {\n  type: 'mode' | 'context' | 'custom';\n  predicate: (context: ToolSelectionContext) => boolean;\n}\n\nexport interface ToolSelectionContext {\n  /** Current user input or task description */\n  input?: string;\n  /** Current agent mode (for UniversalAgent) */\n  mode?: string;\n  /** Current task name (for TaskAgent) */\n  currentTask?: string;\n  /** Recently used tools (to avoid repetition) */\n  recentTools?: string[];\n  /** Token budget for tool definitions */\n  tokenBudget?: number;\n  /** Custom context data */\n  custom?: Record<string, unknown>;\n}\n\nexport interface ToolRegistration {\n  tool: ToolFunction;\n  enabled: boolean;\n  namespace: string;\n  priority: number;\n  conditions: ToolCondition[];\n  metadata: ToolMetadata;\n  /** Effective permission config (merged from tool.permission and options.permission) */\n  permission?: ToolPermissionConfig;\n  /** Circuit breaker configuration for this tool (uses shared CircuitBreakerConfig from resilience) */\n  circuitBreakerConfig?: Partial<CircuitBreakerConfig>;\n}\n\nexport interface ToolMetadata {\n  registeredAt: Date;\n  usageCount: number;\n  lastUsed?: Date;\n  totalExecutionMs: number;\n  avgExecutionMs: number;\n  successCount: number;\n  failureCount: number;\n}\n\nexport interface ToolManagerStats {\n  totalTools: number;\n  enabledTools: number;\n  disabledTools: number;\n  namespaces: string[];\n  toolsByNamespace: Record<string, number>;\n  mostUsed: Array<{ name: string; count: number }>;\n  totalExecutions: number;\n}\n\nexport interface SerializedToolState {\n  enabled: Record<string, boolean>;\n  namespaces: Record<string, string>;\n  priorities: Record<string, number>;\n  /** Permission configs by tool name */\n  permissions?: Record<string, ToolPermissionConfig>;\n}\n\nexport type ToolManagerEvent =\n  | 'tool:registered'\n  | 'tool:unregistered'\n  | 'tool:enabled'\n  | 'tool:disabled'\n  | 'tool:executed'\n  | 'namespace:enabled'\n  | 'namespace:disabled';\n\n// ============================================================================\n// ToolManager Class\n// ============================================================================\n\nexport class ToolManager extends EventEmitter implements IToolExecutor, IDisposable {\n  private registry: Map<string, ToolRegistration> = new Map();\n  private namespaceIndex: Map<string, Set<string>> = new Map();\n  private circuitBreakers: Map<string, CircuitBreaker> = new Map();\n  private toolLogger: FrameworkLogger;\n  private _isDestroyed = false;\n\n  /** Optional tool context for execution (set by agent before runs) */\n  private _toolContext: ToolContext | undefined;\n\n  /**\n   * Parent AgentContext reference for auto-building ToolContext\n   * This ensures tools always have access to agentContext, memory, cache, etc.\n   * even when execute() is called directly (e.g., by AgenticLoop)\n   */\n  private _parentContext: import('./AgentContext.js').AgentContext | null = null;\n\n  constructor() {\n    super();\n    // Initialize default namespace\n    this.namespaceIndex.set('default', new Set());\n    this.toolLogger = logger.child({ component: 'ToolManager' });\n  }\n\n  /**\n   * Returns true if destroy() has been called.\n   */\n  get isDestroyed(): boolean {\n    return this._isDestroyed;\n  }\n\n  /**\n   * Releases all resources held by this ToolManager.\n   * Cleans up circuit breaker listeners and removes all event listeners.\n   * Safe to call multiple times (idempotent).\n   */\n  destroy(): void {\n    if (this._isDestroyed) {\n      return;\n    }\n\n    this._isDestroyed = true;\n\n    // Clean up circuit breakers and their event listeners\n    for (const breaker of this.circuitBreakers.values()) {\n      breaker.removeAllListeners();\n    }\n    this.circuitBreakers.clear();\n\n    // Clear registry and namespaces\n    this.registry.clear();\n    this.namespaceIndex.clear();\n\n    // Remove all event listeners from this ToolManager\n    this.removeAllListeners();\n  }\n\n  /**\n   * Set tool context for execution (called by agent before runs)\n   */\n  setToolContext(context: ToolContext | undefined): void {\n    this._toolContext = context;\n  }\n\n  /**\n   * Get current tool context\n   */\n  getToolContext(): ToolContext | undefined {\n    return this._toolContext;\n  }\n\n  /**\n   * Set parent AgentContext for automatic context building\n   * Called by AgentContext after construction to enable auto-context in execute()\n   *\n   * This is the KEY to making tools work correctly:\n   * - When AgenticLoop calls ToolManager.execute() directly, we auto-build context\n   * - When AgentContext.executeTool() is used, it sets explicit _toolContext\n   *\n   * @param context - The parent AgentContext that owns this ToolManager\n   */\n  setParentContext(context: import('./AgentContext.js').AgentContext | null): void {\n    this._parentContext = context;\n  }\n\n  /**\n   * Get current parent context\n   */\n  getParentContext(): import('./AgentContext.js').AgentContext | null {\n    return this._parentContext;\n  }\n\n  /**\n   * Build ToolContext from parent AgentContext\n   * Used when execute() is called directly without explicit context\n   * @private\n   */\n  private _buildContextFromParent(): ToolContext | undefined {\n    if (!this._parentContext) {\n      return undefined;\n    }\n\n    const ctx = this._parentContext;\n    return {\n      agentId: ctx.agentId,\n      memory: ctx.memory?.getAccess(),\n      agentContext: ctx,\n      idempotencyCache: ctx.cache ?? undefined,\n      inContextMemory: ctx.inContextMemory ?? undefined,\n      persistentInstructions: ctx.persistentInstructions ?? undefined,\n    };\n  }\n\n  // ==========================================================================\n  // Registration\n  // ==========================================================================\n\n  /**\n   * Register a tool with optional configuration\n   */\n  register(tool: ToolFunction, options: ToolOptions = {}): void {\n    const name = this.getToolName(tool);\n\n    if (this.registry.has(name)) {\n      // Update existing registration\n      const existing = this.registry.get(name)!;\n      existing.tool = tool;\n      if (options.enabled !== undefined) existing.enabled = options.enabled;\n      if (options.namespace !== undefined) {\n        this.moveToNamespace(name, existing.namespace, options.namespace);\n        existing.namespace = options.namespace;\n      }\n      if (options.priority !== undefined) existing.priority = options.priority;\n      if (options.conditions !== undefined) existing.conditions = options.conditions;\n      if (options.permission !== undefined) existing.permission = options.permission;\n      return;\n    }\n\n    const namespace = options.namespace ?? 'default';\n\n    // Merge permission config: options.permission > tool.permission > undefined\n    const effectivePermission = options.permission ?? tool.permission;\n\n    const registration: ToolRegistration = {\n      tool,\n      enabled: options.enabled ?? true,\n      namespace,\n      priority: options.priority ?? 0,\n      conditions: options.conditions ?? [],\n      metadata: {\n        registeredAt: new Date(),\n        usageCount: 0,\n        totalExecutionMs: 0,\n        avgExecutionMs: 0,\n        successCount: 0,\n        failureCount: 0,\n      },\n      permission: effectivePermission,\n    };\n\n    this.registry.set(name, registration);\n    this.addToNamespace(name, namespace);\n\n    this.emit('tool:registered', { name, namespace, enabled: registration.enabled });\n  }\n\n  /**\n   * Register multiple tools at once\n   */\n  registerMany(tools: ToolFunction[], options: Omit<ToolOptions, 'conditions'> = {}): void {\n    for (const tool of tools) {\n      this.register(tool, options);\n    }\n  }\n\n  /**\n   * Unregister a tool by name\n   */\n  unregister(name: string): boolean {\n    const registration = this.registry.get(name);\n    if (!registration) return false;\n\n    this.removeFromNamespace(name, registration.namespace);\n    this.registry.delete(name);\n\n    // Clean up circuit breaker and its listeners\n    const breaker = this.circuitBreakers.get(name);\n    if (breaker) {\n      breaker.removeAllListeners();\n      this.circuitBreakers.delete(name);\n    }\n\n    this.emit('tool:unregistered', { name });\n    return true;\n  }\n\n  /**\n   * Clear all tools and their circuit breakers.\n   * Does NOT remove event listeners from this ToolManager (use destroy() for full cleanup).\n   */\n  clear(): void {\n    this.registry.clear();\n    this.namespaceIndex.clear();\n    this.namespaceIndex.set('default', new Set());\n\n    // Clean up circuit breaker listeners before clearing\n    for (const breaker of this.circuitBreakers.values()) {\n      breaker.removeAllListeners();\n    }\n    this.circuitBreakers.clear();\n  }\n\n  // ==========================================================================\n  // Enable/Disable\n  // ==========================================================================\n\n  /**\n   * Enable a tool by name\n   */\n  enable(name: string): boolean {\n    const registration = this.registry.get(name);\n    if (!registration) return false;\n\n    if (!registration.enabled) {\n      registration.enabled = true;\n      this.emit('tool:enabled', { name });\n    }\n    return true;\n  }\n\n  /**\n   * Disable a tool by name (keeps it registered but inactive)\n   */\n  disable(name: string): boolean {\n    const registration = this.registry.get(name);\n    if (!registration) return false;\n\n    if (registration.enabled) {\n      registration.enabled = false;\n      this.emit('tool:disabled', { name });\n    }\n    return true;\n  }\n\n  /**\n   * Toggle a tool's enabled state\n   */\n  toggle(name: string): boolean {\n    const registration = this.registry.get(name);\n    if (!registration) return false;\n\n    registration.enabled = !registration.enabled;\n    this.emit(registration.enabled ? 'tool:enabled' : 'tool:disabled', { name });\n    return registration.enabled;\n  }\n\n  /**\n   * Check if a tool is enabled\n   */\n  isEnabled(name: string): boolean {\n    const registration = this.registry.get(name);\n    return registration?.enabled ?? false;\n  }\n\n  /**\n   * Set enabled state for multiple tools\n   */\n  setEnabled(names: string[], enabled: boolean): void {\n    for (const name of names) {\n      if (enabled) {\n        this.enable(name);\n      } else {\n        this.disable(name);\n      }\n    }\n  }\n\n  // ==========================================================================\n  // Namespaces\n  // ==========================================================================\n\n  /**\n   * Set the namespace for a tool\n   */\n  setNamespace(toolName: string, namespace: string): boolean {\n    const registration = this.registry.get(toolName);\n    if (!registration) return false;\n\n    const oldNamespace = registration.namespace;\n    if (oldNamespace === namespace) return true;\n\n    this.moveToNamespace(toolName, oldNamespace, namespace);\n    registration.namespace = namespace;\n    return true;\n  }\n\n  /**\n   * Enable all tools in a namespace\n   */\n  enableNamespace(namespace: string): void {\n    const tools = this.namespaceIndex.get(namespace);\n    if (!tools) return;\n\n    for (const name of tools) {\n      this.enable(name);\n    }\n    this.emit('namespace:enabled', { namespace });\n  }\n\n  /**\n   * Disable all tools in a namespace\n   */\n  disableNamespace(namespace: string): void {\n    const tools = this.namespaceIndex.get(namespace);\n    if (!tools) return;\n\n    for (const name of tools) {\n      this.disable(name);\n    }\n    this.emit('namespace:disabled', { namespace });\n  }\n\n  /**\n   * Get all namespace names\n   */\n  getNamespaces(): string[] {\n    return Array.from(this.namespaceIndex.keys());\n  }\n\n  /**\n   * Create a namespace with tools\n   */\n  createNamespace(namespace: string, tools: ToolFunction[], options: Omit<ToolOptions, 'namespace'> = {}): void {\n    for (const tool of tools) {\n      this.register(tool, { ...options, namespace });\n    }\n  }\n\n  // ==========================================================================\n  // Priority\n  // ==========================================================================\n\n  /**\n   * Set priority for a tool\n   */\n  setPriority(name: string, priority: number): boolean {\n    const registration = this.registry.get(name);\n    if (!registration) return false;\n\n    registration.priority = priority;\n    return true;\n  }\n\n  /**\n   * Get priority for a tool\n   */\n  getPriority(name: string): number | undefined {\n    return this.registry.get(name)?.priority;\n  }\n\n  /**\n   * Get permission config for a tool\n   */\n  getPermission(name: string): ToolPermissionConfig | undefined {\n    return this.registry.get(name)?.permission;\n  }\n\n  /**\n   * Set permission config for a tool\n   */\n  setPermission(name: string, permission: ToolPermissionConfig): boolean {\n    const registration = this.registry.get(name);\n    if (!registration) return false;\n\n    registration.permission = permission;\n    return true;\n  }\n\n  // ==========================================================================\n  // Query\n  // ==========================================================================\n\n  /**\n   * Get a tool by name\n   */\n  get(name: string): ToolFunction | undefined {\n    return this.registry.get(name)?.tool;\n  }\n\n  /**\n   * Check if a tool exists\n   */\n  has(name: string): boolean {\n    return this.registry.has(name);\n  }\n\n  /**\n   * Get all enabled tools (sorted by priority)\n   */\n  getEnabled(): ToolFunction[] {\n    return this.getSortedByPriority()\n      .filter((reg) => reg.enabled)\n      .map((reg) => reg.tool);\n  }\n\n  /**\n   * Get all tools (enabled and disabled)\n   */\n  getAll(): ToolFunction[] {\n    return Array.from(this.registry.values()).map((reg) => reg.tool);\n  }\n\n  /**\n   * Get tools by namespace\n   */\n  getByNamespace(namespace: string): ToolFunction[] {\n    const toolNames = this.namespaceIndex.get(namespace);\n    if (!toolNames) return [];\n\n    return Array.from(toolNames)\n      .map((name) => this.registry.get(name)!)\n      .filter((reg) => reg.enabled)\n      .sort((a, b) => b.priority - a.priority)\n      .map((reg) => reg.tool);\n  }\n\n  /**\n   * Get tool registration info\n   */\n  getRegistration(name: string): ToolRegistration | undefined {\n    return this.registry.get(name);\n  }\n\n  /**\n   * List all tool names\n   */\n  list(): string[] {\n    return Array.from(this.registry.keys());\n  }\n\n  /**\n   * List enabled tool names\n   */\n  listEnabled(): string[] {\n    return Array.from(this.registry.entries())\n      .filter(([_, reg]) => reg.enabled)\n      .map(([name]) => name);\n  }\n\n  /**\n   * Get count of registered tools\n   */\n  get size(): number {\n    return this.registry.size;\n  }\n\n  // ==========================================================================\n  // Selection\n  // ==========================================================================\n\n  /**\n   * Select tools based on context (uses conditions and smart filtering)\n   */\n  selectForContext(context: ToolSelectionContext): ToolFunction[] {\n    const sorted = this.getSortedByPriority();\n    const selected: ToolFunction[] = [];\n\n    for (const reg of sorted) {\n      // Skip disabled tools\n      if (!reg.enabled) continue;\n\n      // Check conditions\n      if (reg.conditions.length > 0) {\n        const allConditionsMet = reg.conditions.every((cond) => cond.predicate(context));\n        if (!allConditionsMet) continue;\n      }\n\n      // Skip recently used if avoiding repetition\n      if (context.recentTools?.includes(this.getToolName(reg.tool))) {\n        continue;\n      }\n\n      selected.push(reg.tool);\n    }\n\n    // Apply token budget if specified\n    if (context.tokenBudget !== undefined) {\n      return this.filterByTokenBudget(selected, context.tokenBudget);\n    }\n\n    return selected;\n  }\n\n  /**\n   * Select tools by matching capability description\n   */\n  selectByCapability(description: string): ToolFunction[] {\n    const lowerDesc = description.toLowerCase();\n    const keywords = lowerDesc.split(/\\s+/);\n\n    return this.getEnabled().filter((tool) => {\n      const toolDesc = (tool.definition.function.description ?? '').toLowerCase();\n      const toolName = tool.definition.function.name.toLowerCase();\n\n      // Match if any keyword appears in tool name or description\n      return keywords.some((kw) => toolDesc.includes(kw) || toolName.includes(kw));\n    });\n  }\n\n  /**\n   * Filter tools to fit within a token budget\n   */\n  selectWithinBudget(budget: number): ToolFunction[] {\n    return this.filterByTokenBudget(this.getEnabled(), budget);\n  }\n\n  // ==========================================================================\n  // Execution Tracking\n  // ==========================================================================\n\n  /**\n   * Record tool execution (called by agent/loop)\n   */\n  recordExecution(\n    name: string,\n    executionMs: number,\n    success: boolean\n  ): void {\n    const registration = this.registry.get(name);\n    if (!registration) return;\n\n    const meta = registration.metadata;\n    meta.usageCount++;\n    meta.lastUsed = new Date();\n    meta.totalExecutionMs += executionMs;\n    meta.avgExecutionMs = meta.totalExecutionMs / meta.usageCount;\n\n    if (success) {\n      meta.successCount++;\n    } else {\n      meta.failureCount++;\n    }\n\n    this.emit('tool:executed', {\n      name,\n      executionMs,\n      success,\n      totalUsage: meta.usageCount,\n    });\n  }\n\n  /**\n   * Summarize tool result for logging (handles various result types)\n   */\n  private summarizeResult(result: unknown): Record<string, unknown> {\n    if (result === null || result === undefined) {\n      return { type: 'null' };\n    }\n\n    if (typeof result !== 'object') {\n      return { type: typeof result, value: String(result).slice(0, 100) };\n    }\n\n    const obj = result as Record<string, unknown>;\n\n    // Handle common result patterns\n    if ('success' in obj) {\n      const summary: Record<string, unknown> = {\n        success: obj.success,\n      };\n      if ('error' in obj) summary.error = obj.error;\n      if ('count' in obj) summary.count = obj.count;\n      if ('results' in obj && Array.isArray(obj.results)) {\n        summary.resultCount = obj.results.length;\n      }\n      if ('provider' in obj) summary.provider = obj.provider;\n      return summary;\n    }\n\n    // Handle array results\n    if (Array.isArray(result)) {\n      return { type: 'array', length: result.length };\n    }\n\n    // Generic object summary\n    const keys = Object.keys(obj);\n    return {\n      type: 'object',\n      keys: keys.slice(0, 10),\n      keyCount: keys.length,\n    };\n  }\n\n  // ==========================================================================\n  // Statistics\n  // ==========================================================================\n\n  /**\n   * Get comprehensive statistics\n   */\n  getStats(): ToolManagerStats {\n    const registrations = Array.from(this.registry.values());\n    const enabledCount = registrations.filter((r) => r.enabled).length;\n\n    const toolsByNamespace: Record<string, number> = {};\n    for (const [ns, tools] of this.namespaceIndex) {\n      toolsByNamespace[ns] = tools.size;\n    }\n\n    const mostUsed = registrations\n      .filter((r) => r.metadata.usageCount > 0)\n      .sort((a, b) => b.metadata.usageCount - a.metadata.usageCount)\n      .slice(0, 10)\n      .map((r) => ({\n        name: this.getToolName(r.tool),\n        count: r.metadata.usageCount,\n      }));\n\n    const totalExecutions = registrations.reduce((sum, r) => sum + r.metadata.usageCount, 0);\n\n    return {\n      totalTools: this.registry.size,\n      enabledTools: enabledCount,\n      disabledTools: this.registry.size - enabledCount,\n      namespaces: this.getNamespaces(),\n      toolsByNamespace,\n      mostUsed,\n      totalExecutions,\n    };\n  }\n\n  // ==========================================================================\n  // Execution (IToolExecutor implementation)\n  // ==========================================================================\n\n  /**\n   * Execute a tool function with circuit breaker protection\n   * Implements IToolExecutor interface\n   */\n  async execute(toolName: string, args: any): Promise<any> {\n    const registration = this.registry.get(toolName);\n    if (!registration) {\n      throw new ToolNotFoundError(toolName);\n    }\n\n    // Check if tool is enabled\n    if (!registration.enabled) {\n      throw new ToolExecutionError(toolName, 'Tool is disabled');\n    }\n\n    // Get or create circuit breaker for this tool\n    const breaker = this.getOrCreateCircuitBreaker(toolName, registration);\n\n    this.toolLogger.debug({ toolName, args }, 'Tool execution started');\n\n    const startTime = Date.now();\n    metrics.increment('tool.executed', 1, { tool: toolName });\n\n    // Resolve tool context: use explicit context if set, otherwise auto-build from parent\n    // This ensures tools always have access to agentContext, memory, cache, etc.\n    const effectiveContext = this._toolContext ?? this._buildContextFromParent();\n\n    try {\n      // Execute with circuit breaker protection\n      const result = await breaker.execute(async () => {\n        return await registration.tool.execute(args, effectiveContext);\n      });\n\n      const duration = Date.now() - startTime;\n\n      // Update metadata\n      this.recordExecution(toolName, duration, true);\n\n      // Log result summary (truncated for large results)\n      const resultSummary = this.summarizeResult(result);\n      this.toolLogger.debug({\n        toolName,\n        duration,\n        resultSummary,\n      }, 'Tool execution completed');\n\n      metrics.timing('tool.duration', duration, { tool: toolName });\n      metrics.increment('tool.success', 1, { tool: toolName });\n\n      return result;\n    } catch (error) {\n      const duration = Date.now() - startTime;\n\n      // Update metadata\n      this.recordExecution(toolName, duration, false);\n\n      this.toolLogger.error({\n        toolName,\n        error: (error as Error).message,\n        duration,\n      }, 'Tool execution failed');\n\n      metrics.increment('tool.failed', 1, {\n        tool: toolName,\n        error: (error as Error).name,\n      });\n\n      throw new ToolExecutionError(\n        toolName,\n        (error as Error).message,\n        error as Error\n      );\n    }\n  }\n\n  /**\n   * Check if tool is available (IToolExecutor interface)\n   */\n  hasToolFunction(toolName: string): boolean {\n    return this.registry.has(toolName);\n  }\n\n  /**\n   * Get tool definition (IToolExecutor interface)\n   */\n  getToolDefinition(toolName: string): Tool | undefined {\n    const registration = this.registry.get(toolName);\n    return registration?.tool.definition;\n  }\n\n  /**\n   * Register a tool (IToolExecutor interface - delegates to register())\n   */\n  registerTool(tool: ToolFunction): void {\n    this.register(tool);\n  }\n\n  /**\n   * Unregister a tool (IToolExecutor interface - delegates to unregister())\n   */\n  unregisterTool(toolName: string): void {\n    this.unregister(toolName);\n  }\n\n  /**\n   * List all registered tool names (IToolExecutor interface - delegates to list())\n   */\n  listTools(): string[] {\n    return this.list();\n  }\n\n  // ==========================================================================\n  // Circuit Breaker Management\n  // ==========================================================================\n\n  /**\n   * Get or create circuit breaker for a tool\n   */\n  private getOrCreateCircuitBreaker(toolName: string, registration: ToolRegistration): CircuitBreaker {\n    let breaker = this.circuitBreakers.get(toolName);\n\n    if (!breaker) {\n      // Use tool's config or defaults\n      const config = registration.circuitBreakerConfig || {\n        failureThreshold: 3,\n        successThreshold: 2,\n        resetTimeoutMs: 60000, // 1 minute\n        windowMs: 300000, // 5 minutes\n      };\n\n      breaker = new CircuitBreaker(`tool:${toolName}`, config);\n\n      // Forward circuit breaker events to logger and metrics\n      breaker.on('opened', (data) => {\n        this.toolLogger.warn(data, `Circuit breaker opened for tool: ${toolName}`);\n        metrics.increment('circuit_breaker.opened', 1, {\n          breaker: data.name,\n          tool: toolName,\n        });\n      });\n\n      breaker.on('closed', (data) => {\n        this.toolLogger.info(data, `Circuit breaker closed for tool: ${toolName}`);\n        metrics.increment('circuit_breaker.closed', 1, {\n          breaker: data.name,\n          tool: toolName,\n        });\n      });\n\n      this.circuitBreakers.set(toolName, breaker);\n    }\n\n    return breaker;\n  }\n\n  /**\n   * Get circuit breaker states for all tools\n   */\n  getCircuitBreakerStates(): Map<string, CircuitState> {\n    const states = new Map<string, CircuitState>();\n    for (const [toolName, breaker] of this.circuitBreakers.entries()) {\n      states.set(toolName, breaker.getState());\n    }\n    return states;\n  }\n\n  /**\n   * Get circuit breaker metrics for a specific tool\n   */\n  getToolCircuitBreakerMetrics(toolName: string) {\n    const breaker = this.circuitBreakers.get(toolName);\n    return breaker?.getMetrics();\n  }\n\n  /**\n   * Manually reset a tool's circuit breaker\n   */\n  resetToolCircuitBreaker(toolName: string): void {\n    const breaker = this.circuitBreakers.get(toolName);\n    if (breaker) {\n      breaker.reset();\n      this.toolLogger.info({ toolName }, 'Tool circuit breaker manually reset');\n    }\n  }\n\n  /**\n   * Configure circuit breaker for a tool\n   */\n  setCircuitBreakerConfig(toolName: string, config: CircuitBreakerConfig): boolean {\n    const registration = this.registry.get(toolName);\n    if (!registration) return false;\n\n    registration.circuitBreakerConfig = config;\n\n    // If breaker already exists, clean up listeners and remove it\n    const existingBreaker = this.circuitBreakers.get(toolName);\n    if (existingBreaker) {\n      existingBreaker.removeAllListeners();\n      this.circuitBreakers.delete(toolName);\n      // Will be recreated on next execution with new config\n    }\n\n    return true;\n  }\n\n  // ==========================================================================\n  // Persistence\n  // ==========================================================================\n\n  /**\n   * Get serializable state (for session persistence)\n   */\n  getState(): SerializedToolState {\n    const enabled: Record<string, boolean> = {};\n    const namespaces: Record<string, string> = {};\n    const priorities: Record<string, number> = {};\n    const permissions: Record<string, ToolPermissionConfig> = {};\n\n    for (const [name, reg] of this.registry) {\n      enabled[name] = reg.enabled;\n      namespaces[name] = reg.namespace;\n      priorities[name] = reg.priority;\n      if (reg.permission) {\n        permissions[name] = reg.permission;\n      }\n    }\n\n    return { enabled, namespaces, priorities, permissions };\n  }\n\n  /**\n   * Load state (restores enabled/disabled, namespaces, priorities, permissions)\n   * Note: Tools must be re-registered separately (they contain functions)\n   */\n  loadState(state: SerializedToolState): void {\n    for (const [name, isEnabled] of Object.entries(state.enabled)) {\n      const reg = this.registry.get(name);\n      if (reg) {\n        reg.enabled = isEnabled;\n      }\n    }\n\n    for (const [name, namespace] of Object.entries(state.namespaces)) {\n      this.setNamespace(name, namespace);\n    }\n\n    for (const [name, priority] of Object.entries(state.priorities)) {\n      this.setPriority(name, priority);\n    }\n\n    // Restore permissions if present\n    if (state.permissions) {\n      for (const [name, permission] of Object.entries(state.permissions)) {\n        this.setPermission(name, permission);\n      }\n    }\n  }\n\n  // ==========================================================================\n  // Private Helpers\n  // ==========================================================================\n\n  private getToolName(tool: ToolFunction): string {\n    return tool.definition.function.name;\n  }\n\n  private getSortedByPriority(): ToolRegistration[] {\n    return Array.from(this.registry.values()).sort((a, b) => b.priority - a.priority);\n  }\n\n  private addToNamespace(toolName: string, namespace: string): void {\n    if (!this.namespaceIndex.has(namespace)) {\n      this.namespaceIndex.set(namespace, new Set());\n    }\n    this.namespaceIndex.get(namespace)!.add(toolName);\n  }\n\n  private removeFromNamespace(toolName: string, namespace: string): void {\n    this.namespaceIndex.get(namespace)?.delete(toolName);\n  }\n\n  private moveToNamespace(toolName: string, oldNamespace: string, newNamespace: string): void {\n    this.removeFromNamespace(toolName, oldNamespace);\n    this.addToNamespace(toolName, newNamespace);\n  }\n\n  private filterByTokenBudget(tools: ToolFunction[], budget: number): ToolFunction[] {\n    const result: ToolFunction[] = [];\n    let usedTokens = 0;\n\n    for (const tool of tools) {\n      const toolTokens = this.estimateToolTokens(tool);\n      if (usedTokens + toolTokens <= budget) {\n        result.push(tool);\n        usedTokens += toolTokens;\n      }\n    }\n\n    return result;\n  }\n\n  private estimateToolTokens(tool: ToolFunction): number {\n    // Rough estimation: ~4 chars per token\n    const def = tool.definition.function;\n    const nameTokens = Math.ceil((def.name?.length ?? 0) / 4);\n    const descTokens = Math.ceil((def.description?.length ?? 0) / 4);\n    const paramTokens = def.parameters ? Math.ceil(JSON.stringify(def.parameters).length / 4) : 0;\n\n    return nameTokens + descTokens + paramTokens + 20; // +20 for structure overhead\n  }\n}\n","/**\n * Custom error classes for the AI library\n */\n\nexport class AIError extends Error {\n  constructor(\n    message: string,\n    public readonly code: string,\n    public readonly statusCode?: number,\n    public readonly originalError?: Error\n  ) {\n    super(message);\n    this.name = 'AIError';\n    Object.setPrototypeOf(this, AIError.prototype);\n  }\n}\n\nexport class ProviderNotFoundError extends AIError {\n  constructor(providerName: string) {\n    super(\n      `Provider '${providerName}' not found. Did you configure it in OneRingAI constructor?`,\n      'PROVIDER_NOT_FOUND',\n      404\n    );\n    this.name = 'ProviderNotFoundError';\n    Object.setPrototypeOf(this, ProviderNotFoundError.prototype);\n  }\n}\n\nexport class ProviderAuthError extends AIError {\n  constructor(providerName: string, message: string = 'Authentication failed') {\n    super(\n      `${providerName}: ${message}`,\n      'PROVIDER_AUTH_ERROR',\n      401\n    );\n    this.name = 'ProviderAuthError';\n    Object.setPrototypeOf(this, ProviderAuthError.prototype);\n  }\n}\n\nexport class ProviderRateLimitError extends AIError {\n  constructor(\n    providerName: string,\n    public readonly retryAfter?: number\n  ) {\n    super(\n      `${providerName}: Rate limit exceeded${retryAfter ? `. Retry after ${retryAfter}ms` : ''}`,\n      'PROVIDER_RATE_LIMIT',\n      429\n    );\n    this.name = 'ProviderRateLimitError';\n    Object.setPrototypeOf(this, ProviderRateLimitError.prototype);\n  }\n}\n\nexport class ProviderContextLengthError extends AIError {\n  constructor(\n    providerName: string,\n    public readonly maxTokens: number,\n    public readonly requestedTokens?: number\n  ) {\n    super(\n      `${providerName}: Context length exceeded. Max: ${maxTokens}${requestedTokens ? `, Requested: ${requestedTokens}` : ''}`,\n      'PROVIDER_CONTEXT_LENGTH_EXCEEDED',\n      413\n    );\n    this.name = 'ProviderContextLengthError';\n    Object.setPrototypeOf(this, ProviderContextLengthError.prototype);\n  }\n}\n\nexport class ToolExecutionError extends AIError {\n  constructor(\n    toolName: string,\n    message: string,\n    public readonly originalError?: Error\n  ) {\n    super(\n      `Tool '${toolName}' execution failed: ${message}`,\n      'TOOL_EXECUTION_ERROR',\n      500,\n      originalError\n    );\n    this.name = 'ToolExecutionError';\n    Object.setPrototypeOf(this, ToolExecutionError.prototype);\n  }\n}\n\nexport class ToolTimeoutError extends AIError {\n  constructor(\n    toolName: string,\n    public readonly timeoutMs: number\n  ) {\n    super(\n      `Tool '${toolName}' execution timed out after ${timeoutMs}ms`,\n      'TOOL_TIMEOUT',\n      408\n    );\n    this.name = 'ToolTimeoutError';\n    Object.setPrototypeOf(this, ToolTimeoutError.prototype);\n  }\n}\n\nexport class ToolNotFoundError extends AIError {\n  constructor(toolName: string) {\n    super(\n      `Tool '${toolName}' not found. Did you register it with the agent?`,\n      'TOOL_NOT_FOUND',\n      404\n    );\n    this.name = 'ToolNotFoundError';\n    Object.setPrototypeOf(this, ToolNotFoundError.prototype);\n  }\n}\n\nexport class ModelNotSupportedError extends AIError {\n  constructor(providerName: string, model: string, capability: string) {\n    super(\n      `Model '${model}' from ${providerName} does not support ${capability}`,\n      'MODEL_NOT_SUPPORTED',\n      400\n    );\n    this.name = 'ModelNotSupportedError';\n    Object.setPrototypeOf(this, ModelNotSupportedError.prototype);\n  }\n}\n\nexport class InvalidConfigError extends AIError {\n  constructor(message: string) {\n    super(message, 'INVALID_CONFIG', 400);\n    this.name = 'InvalidConfigError';\n    Object.setPrototypeOf(this, InvalidConfigError.prototype);\n  }\n}\n\nexport class InvalidToolArgumentsError extends AIError {\n  constructor(\n    toolName: string,\n    public readonly rawArguments: string,\n    public readonly parseError?: Error\n  ) {\n    super(\n      `Invalid arguments for tool '${toolName}': ${parseError?.message || 'Failed to parse JSON'}`,\n      'INVALID_TOOL_ARGUMENTS',\n      400,\n      parseError\n    );\n    this.name = 'InvalidToolArgumentsError';\n    Object.setPrototypeOf(this, InvalidToolArgumentsError.prototype);\n  }\n}\n\nexport class ProviderError extends AIError {\n  constructor(\n    public readonly providerName: string,\n    message: string,\n    statusCode?: number,\n    originalError?: Error\n  ) {\n    super(\n      `${providerName}: ${message}`,\n      'PROVIDER_ERROR',\n      statusCode,\n      originalError\n    );\n    this.name = 'ProviderError';\n    Object.setPrototypeOf(this, ProviderError.prototype);\n  }\n}\n\n// ============ TaskAgent Errors ============\n\n/**\n * Error thrown when a dependency cycle is detected in a plan\n */\nexport class DependencyCycleError extends AIError {\n  constructor(\n    /** Task IDs forming the cycle (e.g., ['A', 'B', 'C', 'A']) */\n    public readonly cycle: string[],\n    /** Plan ID where the cycle was detected */\n    public readonly planId?: string\n  ) {\n    super(\n      `Dependency cycle detected: ${cycle.join(' -> ')}`,\n      'DEPENDENCY_CYCLE',\n      400\n    );\n    this.name = 'DependencyCycleError';\n    Object.setPrototypeOf(this, DependencyCycleError.prototype);\n  }\n}\n\n/**\n * Error thrown when a task execution times out\n */\nexport class TaskTimeoutError extends AIError {\n  constructor(\n    public readonly taskId: string,\n    public readonly taskName: string,\n    public readonly timeoutMs: number\n  ) {\n    super(\n      `Task '${taskName}' (${taskId}) timed out after ${timeoutMs}ms`,\n      'TASK_TIMEOUT',\n      408\n    );\n    this.name = 'TaskTimeoutError';\n    Object.setPrototypeOf(this, TaskTimeoutError.prototype);\n  }\n}\n\n/**\n * Error thrown when task completion validation fails\n */\nexport class TaskValidationError extends AIError {\n  constructor(\n    public readonly taskId: string,\n    public readonly taskName: string,\n    public readonly reason: string\n  ) {\n    super(\n      `Task '${taskName}' (${taskId}) validation failed: ${reason}`,\n      'TASK_VALIDATION_ERROR',\n      422\n    );\n    this.name = 'TaskValidationError';\n    Object.setPrototypeOf(this, TaskValidationError.prototype);\n  }\n}\n\n/**\n * Task failure info for parallel execution\n */\nexport interface TaskFailure {\n  taskId: string;\n  taskName: string;\n  error: Error;\n}\n\n/**\n * Error thrown when multiple tasks fail in parallel execution (fail-all mode)\n */\nexport class ParallelTasksError extends AIError {\n  constructor(\n    /** Array of task failures */\n    public readonly failures: TaskFailure[]\n  ) {\n    const names = failures.map((f) => f.taskName).join(', ');\n    super(\n      `Multiple tasks failed in parallel execution: ${names}`,\n      'PARALLEL_TASKS_ERROR',\n      500\n    );\n    this.name = 'ParallelTasksError';\n    Object.setPrototypeOf(this, ParallelTasksError.prototype);\n  }\n\n  /**\n   * Get all failure errors\n   */\n  getErrors(): Error[] {\n    return this.failures.map((f) => f.error);\n  }\n\n  /**\n   * Get failed task IDs\n   */\n  getFailedTaskIds(): string[] {\n    return this.failures.map((f) => f.taskId);\n  }\n}\n","/**\n * IdempotencyCache - caches tool call results for deduplication\n *\n * General-purpose cache for tool results. Used by AgentContext to avoid\n * duplicate tool calls with the same arguments.\n *\n * Features:\n * - Cache based on tool name + args hash\n * - Custom key generation per tool (via tool.idempotency.keyFn)\n * - TTL-based expiration\n * - Max entries eviction (LRU)\n *\n * Implements IDisposable for proper lifecycle management.\n */\n\nimport { ToolFunction } from '../domain/entities/Tool.js';\nimport type { IDisposable } from '../domain/interfaces/IDisposable.js';\n\n/**\n * Cache configuration\n */\nexport interface IdempotencyCacheConfig {\n  /** Default TTL for cached entries */\n  defaultTtlMs: number;\n\n  /** Max entries before eviction */\n  maxEntries: number;\n}\n\n/**\n * Cache statistics\n */\nexport interface CacheStats {\n  entries: number;\n  hits: number;\n  misses: number;\n  hitRate: number;\n}\n\n/**\n * Default configuration\n */\nexport const DEFAULT_IDEMPOTENCY_CONFIG: IdempotencyCacheConfig = {\n  defaultTtlMs: 3600000, // 1 hour\n  maxEntries: 1000,\n};\n\n/**\n * IdempotencyCache handles tool call result caching.\n *\n * Features:\n * - Cache based on tool name + args\n * - Custom key generation per tool\n * - TTL-based expiration\n * - Max entries eviction\n *\n * Implements IDisposable for proper resource cleanup.\n * Call destroy() when done to clear the background cleanup interval.\n */\nexport class IdempotencyCache implements IDisposable {\n  private config: IdempotencyCacheConfig;\n  private cache = new Map<string, { value: unknown; expiresAt: number }>();\n  private hits = 0;\n  private misses = 0;\n  private cleanupInterval?: NodeJS.Timeout;\n  private _isDestroyed = false;\n\n  constructor(config: IdempotencyCacheConfig = DEFAULT_IDEMPOTENCY_CONFIG) {\n    this.config = config;\n\n    // Start background cleanup (every 5 minutes)\n    this.cleanupInterval = setInterval(() => {\n      this.pruneExpired();\n    }, 300000);\n  }\n\n  /**\n   * Returns true if destroy() has been called.\n   * Operations on a destroyed cache are no-ops.\n   */\n  get isDestroyed(): boolean {\n    return this._isDestroyed;\n  }\n\n  /**\n   * Releases all resources held by this cache.\n   * Clears the background cleanup interval and all cached entries.\n   * Safe to call multiple times (idempotent).\n   */\n  destroy(): void {\n    if (this._isDestroyed) {\n      return;\n    }\n\n    this._isDestroyed = true;\n\n    if (this.cleanupInterval) {\n      clearInterval(this.cleanupInterval);\n      this.cleanupInterval = undefined;\n    }\n\n    this.cache.clear();\n    this.hits = 0;\n    this.misses = 0;\n  }\n\n  /**\n   * Check if a tool's results should be cached.\n   * Prefers 'cacheable' field, falls back to inverted 'safe' for backward compatibility.\n   *\n   * Logic:\n   * - If 'cacheable' is defined, use it directly\n   * - If only 'safe' is defined, cache when safe=false (backward compat)\n   * - If neither defined, don't cache\n   */\n  private shouldCache(tool: ToolFunction): boolean {\n    const idempotency = tool.idempotency;\n    if (!idempotency) return false;\n\n    // Prefer 'cacheable' if defined\n    if (idempotency.cacheable !== undefined) {\n      return idempotency.cacheable;\n    }\n\n    // Fall back to deprecated 'safe' (cache when safe=false)\n    if (idempotency.safe !== undefined) {\n      return !idempotency.safe;\n    }\n\n    return false;\n  }\n\n  /**\n   * Get cached result for tool call\n   */\n  async get(tool: ToolFunction, args: Record<string, unknown>): Promise<unknown> {\n    // No-op if destroyed\n    if (this._isDestroyed) {\n      return undefined;\n    }\n\n    // Don't cache if tool doesn't need caching\n    if (!this.shouldCache(tool)) {\n      this.misses++;\n      return undefined;\n    }\n\n    const key = this.generateKey(tool, args);\n    const cached = this.cache.get(key);\n\n    if (!cached) {\n      this.misses++;\n      return undefined;\n    }\n\n    // Check if expired\n    if (Date.now() > cached.expiresAt) {\n      this.cache.delete(key);\n      this.misses++;\n      return undefined;\n    }\n\n    this.hits++;\n    return cached.value;\n  }\n\n  /**\n   * Cache result for tool call\n   */\n  async set(tool: ToolFunction, args: Record<string, unknown>, result: unknown): Promise<void> {\n    // No-op if destroyed\n    if (this._isDestroyed) {\n      return;\n    }\n\n    // Don't cache if tool doesn't need caching\n    if (!this.shouldCache(tool)) {\n      return;\n    }\n\n    const key = this.generateKey(tool, args);\n    const ttl = tool.idempotency?.ttlMs ?? this.config.defaultTtlMs;\n    const expiresAt = Date.now() + ttl;\n\n    this.cache.set(key, { value: result, expiresAt });\n\n    // Evict oldest if over max entries\n    if (this.cache.size > this.config.maxEntries) {\n      const firstKey = this.cache.keys().next().value;\n      if (firstKey) {\n        this.cache.delete(firstKey);\n      }\n    }\n  }\n\n  /**\n   * Check if tool call is cached\n   */\n  async has(tool: ToolFunction, args: Record<string, unknown>): Promise<boolean> {\n    // No-op if destroyed\n    if (this._isDestroyed) {\n      return false;\n    }\n\n    // Don't check cache if tool doesn't need caching\n    if (!this.shouldCache(tool)) {\n      return false;\n    }\n\n    const key = this.generateKey(tool, args);\n    const cached = this.cache.get(key);\n\n    if (!cached) {\n      return false;\n    }\n\n    // Check if expired\n    if (Date.now() > cached.expiresAt) {\n      this.cache.delete(key);\n      return false;\n    }\n\n    return true;\n  }\n\n  /**\n   * Invalidate cached result\n   */\n  async invalidate(tool: ToolFunction, args: Record<string, unknown>): Promise<void> {\n    if (!tool.idempotency) {\n      return;\n    }\n\n    const key = this.generateKey(tool, args);\n    this.cache.delete(key);\n  }\n\n  /**\n   * Invalidate all cached results for a tool\n   */\n  async invalidateTool(tool: ToolFunction): Promise<void> {\n    const toolName = tool.definition.function.name;\n\n    // Find all keys for this tool\n    const keysToDelete: string[] = [];\n    for (const key of this.cache.keys()) {\n      if (key.startsWith(`${toolName}:`)) {\n        keysToDelete.push(key);\n      }\n    }\n\n    for (const key of keysToDelete) {\n      this.cache.delete(key);\n    }\n  }\n\n  /**\n   * Prune expired entries from cache\n   */\n  pruneExpired(): number {\n    // No-op if destroyed\n    if (this._isDestroyed) {\n      return 0;\n    }\n\n    const now = Date.now();\n    const toDelete: string[] = [];\n\n    for (const [key, entry] of this.cache.entries()) {\n      if (now > entry.expiresAt) {\n        toDelete.push(key);\n      }\n    }\n\n    toDelete.forEach(key => this.cache.delete(key));\n    return toDelete.length;\n  }\n\n  /**\n   * Clear all cached results and stop background cleanup.\n   * @deprecated Use destroy() instead for explicit lifecycle management.\n   *             This method is kept for backward compatibility.\n   */\n  async clear(): Promise<void> {\n    this.destroy();\n  }\n\n  /**\n   * Get cache statistics\n   */\n  getStats(): CacheStats {\n    const total = this.hits + this.misses;\n    const hitRate = total > 0 ? this.hits / total : 0;\n\n    return {\n      entries: this.cache.size,\n      hits: this.hits,\n      misses: this.misses,\n      hitRate,\n    };\n  }\n\n  /**\n   * Generate cache key for tool + args\n   */\n  generateKey(tool: ToolFunction, args: Record<string, unknown>): string {\n    const toolName = tool.definition.function.name;\n\n    // Use custom key function if provided\n    if (tool.idempotency?.keyFn) {\n      return `${toolName}:${tool.idempotency.keyFn(args)}`;\n    }\n\n    // Default: hash of sorted args\n    const sortedArgs = Object.keys(args)\n      .sort()\n      .reduce((obj, key) => {\n        obj[key] = args[key];\n        return obj;\n      }, {} as Record<string, unknown>);\n\n    const argsHash = this.hashObject(sortedArgs);\n    return `${toolName}:${argsHash}`;\n  }\n\n  /**\n   * Simple hash function for objects\n   */\n  private hashObject(obj: unknown): string {\n    const str = JSON.stringify(obj);\n    let hash = 0;\n    for (let i = 0; i < str.length; i++) {\n      const char = str.charCodeAt(i);\n      hash = (hash << 5) - hash + char;\n      hash = hash & hash; // Convert to 32bit integer\n    }\n    return hash.toString(36);\n  }\n}\n","/**\n * Memory entities for WorkingMemory\n *\n * This module provides a GENERIC memory system that works across all agent types:\n * - Basic Agent: Simple session/persistent scoping with static priority\n * - TaskAgent: Task-aware scoping with dynamic priority based on task states\n * - UniversalAgent: Mode-aware, switches strategy based on current mode\n *\n * The key abstraction is PriorityCalculator - a pluggable strategy that\n * determines entry priority for eviction decisions.\n */\n\n// ============================================================================\n// SCOPE TYPES (Generic + Task-Aware)\n// ============================================================================\n\n/**\n * Simple scope for basic agents - just a lifecycle label\n */\nexport type SimpleScope = 'session' | 'persistent';\n\n/**\n * Task-aware scope for TaskAgent/UniversalAgent\n */\nexport type TaskAwareScope =\n  | { type: 'task'; taskIds: string[] }   // Needed for specific task(s)\n  | { type: 'plan' }                       // Needed throughout plan execution\n  | { type: 'persistent' };                // Keep even after plan completes\n\n/**\n * Union type - memory system accepts both\n */\nexport type MemoryScope = SimpleScope | TaskAwareScope;\n\n/**\n * Type guard: is this a task-aware scope?\n */\nexport function isTaskAwareScope(scope: MemoryScope): scope is TaskAwareScope {\n  return typeof scope === 'object' && scope !== null && 'type' in scope;\n}\n\n/**\n * Type guard: is this a simple scope?\n */\nexport function isSimpleScope(scope: MemoryScope): scope is SimpleScope {\n  return scope === 'session' || scope === 'persistent';\n}\n\n/**\n * Compare two scopes for equality\n * Handles both simple scopes (string comparison) and task-aware scopes (deep comparison)\n */\nexport function scopeEquals(a: MemoryScope, b: MemoryScope): boolean {\n  // Simple scope comparison\n  if (isSimpleScope(a) && isSimpleScope(b)) {\n    return a === b;\n  }\n\n  // Task-aware scope comparison\n  if (isTaskAwareScope(a) && isTaskAwareScope(b)) {\n    if (a.type !== b.type) return false;\n\n    // For task scope, compare taskIds arrays\n    if (a.type === 'task' && b.type === 'task') {\n      if (a.taskIds.length !== b.taskIds.length) return false;\n      const sortedA = [...a.taskIds].sort();\n      const sortedB = [...b.taskIds].sort();\n      return sortedA.every((id, i) => id === sortedB[i]);\n    }\n\n    // For plan/persistent scope, type match is enough\n    return true;\n  }\n\n  // Mixed types are never equal\n  return false;\n}\n\n/**\n * Check if a scope matches a filter scope\n * More flexible than scopeEquals - supports partial matching for task scopes\n */\nexport function scopeMatches(entryScope: MemoryScope, filterScope: MemoryScope): boolean {\n  // Exact match first\n  if (scopeEquals(entryScope, filterScope)) return true;\n\n  // Simple scopes must match exactly\n  if (isSimpleScope(filterScope)) return false;\n\n  // For task-aware filter, check if entry scope matches the type\n  if (isTaskAwareScope(entryScope) && isTaskAwareScope(filterScope)) {\n    return entryScope.type === filterScope.type;\n  }\n\n  return false;\n}\n\n// ============================================================================\n// PRIORITY SYSTEM\n// ============================================================================\n\n/**\n * Priority determines eviction order (lower priority evicted first)\n *\n * - critical: Never evicted (pinned, or actively in use)\n * - high: Important data, evicted only when necessary\n * - normal: Default priority\n * - low: Candidate for eviction (stale data, completed task data)\n */\nexport type MemoryPriority = 'critical' | 'high' | 'normal' | 'low';\n\n/**\n * Priority values for comparison (higher = more important, less likely to evict)\n */\nexport const MEMORY_PRIORITY_VALUES: Record<MemoryPriority, number> = {\n  critical: 4,\n  high: 3,\n  normal: 2,\n  low: 1,\n};\n\n// ============================================================================\n// MEMORY TIER SYSTEM (Hierarchical Memory)\n// ============================================================================\n\n/**\n * Memory tier for hierarchical data management\n *\n * The tier system provides a structured approach to managing research/analysis data:\n * - raw: Original data, low priority, first to be evicted\n * - summary: Processed summaries, normal priority\n * - findings: Final conclusions/insights, high priority, kept longest\n *\n * Workflow: raw  summary  findings (data gets more refined, priority increases)\n */\nexport type MemoryTier = 'raw' | 'summary' | 'findings';\n\n/**\n * Default priorities for each tier\n */\nexport const TIER_PRIORITIES: Record<MemoryTier, MemoryPriority> = {\n  raw: 'low',\n  summary: 'normal',\n  findings: 'high',\n};\n\n/**\n * Key prefixes for tiered data (used by helper methods)\n */\nexport const TIER_KEY_PREFIXES: Record<MemoryTier, string> = {\n  raw: 'raw.',\n  summary: 'summary.',\n  findings: 'findings.',\n};\n\n/**\n * Hierarchy metadata for tracking data relationships\n */\nexport interface HierarchyMetadata {\n  /** Memory tier (raw, summary, or findings) */\n  tier: MemoryTier;\n  /** Keys this entry was derived from (e.g., findings derived from summaries) */\n  derivedFrom?: string[];\n  /** Keys derived from this entry (e.g., summaries derived from raw data) */\n  derivedTo?: string[];\n}\n\n/**\n * Check if a key has a tier prefix\n */\nexport function getTierFromKey(key: string): MemoryTier | undefined {\n  if (key.startsWith(TIER_KEY_PREFIXES.raw)) return 'raw';\n  if (key.startsWith(TIER_KEY_PREFIXES.summary)) return 'summary';\n  if (key.startsWith(TIER_KEY_PREFIXES.findings)) return 'findings';\n  return undefined;\n}\n\n/**\n * Strip tier prefix from key\n */\nexport function stripTierPrefix(key: string): string {\n  const tier = getTierFromKey(key);\n  if (!tier) return key;\n  return key.substring(TIER_KEY_PREFIXES[tier].length);\n}\n\n/**\n * Add tier prefix to key (if not already present)\n */\nexport function addTierPrefix(key: string, tier: MemoryTier): string {\n  const existingTier = getTierFromKey(key);\n  if (existingTier) {\n    // Already has a tier prefix - replace it\n    const baseKey = stripTierPrefix(key);\n    return TIER_KEY_PREFIXES[tier] + baseKey;\n  }\n  return TIER_KEY_PREFIXES[tier] + key;\n}\n\n// ============================================================================\n// PRIORITY CALCULATOR (Strategy Pattern)\n// ============================================================================\n\n/**\n * Context passed to priority calculator - varies by agent type\n */\nexport interface PriorityContext {\n  /** For TaskAgent: map of taskId  current status */\n  taskStates?: Map<string, TaskStatusForMemory>;\n  /** For UniversalAgent: current mode */\n  mode?: 'interactive' | 'planning' | 'executing';\n  /** Custom context for extensions */\n  [key: string]: unknown;\n}\n\n/**\n * Task status values for priority calculation\n */\nexport type TaskStatusForMemory = 'pending' | 'in_progress' | 'completed' | 'failed' | 'skipped' | 'cancelled';\n\n/**\n * Terminal statuses - task will not progress further\n */\nexport const TERMINAL_MEMORY_STATUSES: TaskStatusForMemory[] = ['completed', 'failed', 'skipped', 'cancelled'];\n\n/**\n * Check if a task status is terminal (task will not progress further)\n */\nexport function isTerminalMemoryStatus(status: TaskStatusForMemory): boolean {\n  return TERMINAL_MEMORY_STATUSES.includes(status);\n}\n\n/**\n * Priority calculator function type.\n * Given an entry and optional context, returns the effective priority.\n */\nexport type PriorityCalculator = (\n  entry: MemoryEntry,\n  context?: PriorityContext\n) => MemoryPriority;\n\n/**\n * Default: Static priority calculator\n * Returns the priority stored in the entry (or 'normal' if not set)\n */\nexport const staticPriorityCalculator: PriorityCalculator = (entry) => {\n  if (entry.pinned) return 'critical';\n  return entry.basePriority;\n};\n\n/**\n * Task-aware priority calculator\n * Computes priority dynamically based on task states\n */\nexport const taskAwarePriorityCalculator: PriorityCalculator = (entry, context) => {\n  // Pinned entries are always critical\n  if (entry.pinned) return 'critical';\n\n  const scope = entry.scope;\n\n  // Simple scope: use static priority\n  if (isSimpleScope(scope)) {\n    if (scope === 'persistent') return 'high';\n    return entry.basePriority; // 'session' uses base priority\n  }\n\n  // Task-aware scope: compute from task states\n  const taskStates = context?.taskStates;\n  if (!taskStates) {\n    // No task context provided, fall back to base priority\n    return entry.basePriority;\n  }\n\n  // Persistent scope = high priority\n  if (scope.type === 'persistent') return 'high';\n\n  // Plan scope = normal priority\n  if (scope.type === 'plan') return 'normal';\n\n  // Task scope = depends on task states\n  const taskIds = scope.taskIds;\n  if (taskIds.length === 0) {\n    // Empty taskIds array means no tasks need this data - treat as low priority\n    // This is a valid but unusual case, typically a mistake\n    return 'low';\n  }\n\n  let hasActiveTask = false;\n  let hasPendingTask = false;\n  let allTerminal = true;\n\n  for (const taskId of taskIds) {\n    const status = taskStates.get(taskId);\n    if (!status) continue;\n\n    if (status === 'in_progress') {\n      hasActiveTask = true;\n      allTerminal = false;\n    } else if (status === 'pending') {\n      hasPendingTask = true;\n      allTerminal = false;\n    }\n  }\n\n  if (hasActiveTask) return 'critical';\n  if (hasPendingTask) return 'high';\n  if (allTerminal) return 'low';\n\n  return 'normal';\n};\n\n// ============================================================================\n// STALE ENTRY DETECTION\n// ============================================================================\n\n/**\n * Reason why an entry became stale\n */\nexport type StaleReason =\n  | 'task_completed'      // All dependent tasks completed\n  | 'task_failed'         // Dependent task failed\n  | 'unused'              // Not accessed for a long time\n  | 'scope_cleared';      // Scope (e.g., session) was cleared\n\n/**\n * Information about a stale entry for LLM notification\n */\nexport interface StaleEntryInfo {\n  key: string;\n  description: string;\n  reason: StaleReason;\n  previousPriority: MemoryPriority;\n  newPriority: MemoryPriority;\n  taskIds?: string[];     // Which tasks completed (if task_completed)\n}\n\n/**\n * Detect entries that became stale after task completion\n */\nexport function detectStaleEntries(\n  entries: MemoryEntry[],\n  completedTaskId: string,\n  taskStates: Map<string, TaskStatusForMemory>\n): StaleEntryInfo[] {\n  const stale: StaleEntryInfo[] = [];\n\n  for (const entry of entries) {\n    if (entry.pinned) continue; // Pinned entries never stale\n\n    const scope = entry.scope;\n    if (!isTaskAwareScope(scope) || scope.type !== 'task') continue;\n\n    // Check if this entry was scoped to the completed task\n    if (!scope.taskIds.includes(completedTaskId)) continue;\n\n    // Check if ALL tasks for this entry are now terminal\n    const allTerminal = scope.taskIds.every((taskId) => {\n      const status = taskStates.get(taskId);\n      return status ? isTerminalMemoryStatus(status) : false;\n    });\n\n    if (allTerminal) {\n      stale.push({\n        key: entry.key,\n        description: entry.description,\n        reason: 'task_completed',\n        previousPriority: entry.basePriority,\n        newPriority: 'low',\n        taskIds: scope.taskIds,\n      });\n    }\n  }\n\n  return stale;\n}\n\n/**\n * Single memory entry stored in working memory\n */\nexport interface MemoryEntry {\n  key: string;                    // Namespaced key: \"user.profile\"\n  description: string;            // Short description for index (max 150 chars)\n  value: unknown;                 // The actual data\n  sizeBytes: number;              // Computed size for tracking\n  scope: MemoryScope;             // Lifecycle scope (simple or task-aware)\n  basePriority: MemoryPriority;   // Base priority (actual priority may be computed dynamically)\n  pinned: boolean;                // If true, never evicted\n  createdAt: number;              // Unix timestamp\n  lastAccessedAt: number;\n  accessCount: number;\n}\n\n/**\n * Index entry (lightweight, always in context)\n */\nexport interface MemoryIndexEntry {\n  key: string;\n  description: string;\n  size: string;                   // Human readable: \"4.2KB\"\n  scope: MemoryScope;\n  effectivePriority: MemoryPriority;  // Computed priority for display\n  pinned: boolean;\n}\n\n/**\n * Full memory index with metadata\n */\nexport interface MemoryIndex {\n  entries: MemoryIndexEntry[];\n  totalSizeBytes: number;\n  totalSizeHuman: string;         // \"42KB\"\n  limitBytes: number;\n  limitHuman: string;             // \"1MB\"\n  utilizationPercent: number;\n}\n\n/**\n * Configuration for working memory\n */\nexport interface WorkingMemoryConfig {\n  /** Max memory size in bytes. If not set, calculated from model context */\n  maxSizeBytes?: number;\n\n  /** Max description length */\n  descriptionMaxLength: number;\n\n  /** Percentage at which to warn agent */\n  softLimitPercent: number;\n\n  /** Percentage of model context to allocate to memory */\n  contextAllocationPercent: number;\n}\n\n/**\n * Input for creating a memory entry\n */\nexport interface MemoryEntryInput {\n  key: string;\n  description: string;\n  value: unknown;\n  /** Scope - defaults to 'session' for basic agents */\n  scope?: MemoryScope;\n  /** Base priority - may be overridden by dynamic calculation */\n  priority?: MemoryPriority;\n  /** If true, entry is never evicted */\n  pinned?: boolean;\n}\n\n/**\n * Shorthand for task-scoped entry\n */\nexport interface TaskScopedEntryInput extends Omit<MemoryEntryInput, 'scope'> {\n  /** Task IDs that need this data */\n  neededForTasks: string[];\n}\n\n/**\n * Create a task-scoped memory entry input\n */\nexport function forTasks(\n  key: string,\n  description: string,\n  value: unknown,\n  taskIds: string[],\n  options?: { priority?: MemoryPriority; pinned?: boolean }\n): MemoryEntryInput {\n  return {\n    key,\n    description,\n    value,\n    scope: { type: 'task', taskIds },\n    priority: options?.priority,\n    pinned: options?.pinned,\n  };\n}\n\n/**\n * Create a plan-scoped memory entry input\n */\nexport function forPlan(\n  key: string,\n  description: string,\n  value: unknown,\n  options?: { priority?: MemoryPriority; pinned?: boolean }\n): MemoryEntryInput {\n  return {\n    key,\n    description,\n    value,\n    scope: { type: 'plan' },\n    priority: options?.priority,\n    pinned: options?.pinned,\n  };\n}\n\n/**\n * Default configuration values\n */\nexport const DEFAULT_MEMORY_CONFIG: WorkingMemoryConfig = {\n  maxSizeBytes: 25 * 1024 * 1024, // 25MB default\n  descriptionMaxLength: 150,\n  softLimitPercent: 80,\n  contextAllocationPercent: 20,\n};\n\n/**\n * Validate memory key format\n * Valid: \"simple\", \"user.profile\", \"order.items.123\"\n * Invalid: \"\", \".invalid\", \"invalid.\", \"with spaces\"\n */\nexport function validateMemoryKey(key: string): void {\n  if (!key || key.length === 0) {\n    throw new Error('Memory key cannot be empty');\n  }\n\n  // Check for invalid patterns\n  if (key.startsWith('.') || key.endsWith('.') || key.includes('..')) {\n    throw new Error('Invalid memory key format: keys cannot start/end with dots or contain consecutive dots');\n  }\n\n  // Check for invalid characters (only alphanumeric, dots, dashes, underscores)\n  if (!/^[a-zA-Z0-9._-]+$/.test(key)) {\n    throw new Error('Invalid memory key format: only alphanumeric, dots, dashes, and underscores allowed');\n  }\n}\n\n/**\n * Calculate the size of a value in bytes (JSON serialization)\n * Uses Buffer.byteLength for accurate UTF-8 byte count\n */\nexport function calculateEntrySize(value: unknown): number {\n  if (value === undefined) {\n    return 0;\n  }\n\n  const serialized = JSON.stringify(value);\n  // Use Buffer.byteLength for accurate UTF-8 byte count\n  // This handles multi-byte characters correctly (e.g., ''.length = 2, but byte length = 6)\n  if (typeof Buffer !== 'undefined') {\n    return Buffer.byteLength(serialized, 'utf8');\n  }\n  // Fallback for environments without Buffer (browser)\n  return new Blob([serialized]).size;\n}\n\n/**\n * Create a memory entry with defaults and validation\n */\nexport function createMemoryEntry(\n  input: MemoryEntryInput,\n  config: WorkingMemoryConfig = DEFAULT_MEMORY_CONFIG\n): MemoryEntry {\n  // Validate key\n  validateMemoryKey(input.key);\n\n  // Validate description length\n  if (input.description.length > config.descriptionMaxLength) {\n    throw new Error(`Description exceeds maximum length of ${config.descriptionMaxLength} characters`);\n  }\n\n  // Validate task-aware scope\n  if (input.scope && isTaskAwareScope(input.scope) && input.scope.type === 'task') {\n    if (input.scope.taskIds.length === 0) {\n      // This is valid but unusual - typically indicates a mistake\n      // We allow it but the entry will have low priority\n      console.warn(`Memory entry \"${input.key}\" has empty taskIds array - will have low priority`);\n    }\n  }\n\n  const now = Date.now();\n  const sizeBytes = calculateEntrySize(input.value);\n\n  // If pinned, automatically set priority to critical\n  const pinned = input.pinned ?? false;\n  const priority = pinned ? 'critical' : (input.priority ?? 'normal');\n\n  return {\n    key: input.key,\n    description: input.description,\n    value: input.value,\n    sizeBytes,\n    scope: input.scope ?? 'session',\n    basePriority: priority,\n    pinned,\n    createdAt: now,\n    lastAccessedAt: now,\n    accessCount: 0,\n  };\n}\n\n/**\n * Format bytes to human-readable string\n */\nexport function formatSizeHuman(bytes: number): string {\n  if (bytes === 0) return '0B';\n  if (bytes < 1024) return `${bytes}B`;\n\n  const kb = bytes / 1024;\n  if (bytes < 1024 * 1024) {\n    // Show 1 decimal place, but remove .0\n    return `${kb.toFixed(1).replace(/\\.0$/, '')}KB`;\n  }\n\n  const mb = bytes / (1024 * 1024);\n  if (bytes < 1024 * 1024 * 1024) {\n    return `${mb.toFixed(1).replace(/\\.0$/, '')}MB`;\n  }\n\n  const gb = bytes / (1024 * 1024 * 1024);\n  return `${gb.toFixed(1).replace(/\\.0$/, '')}GB`;\n}\n\n/**\n * Format scope for display\n */\nfunction formatScope(scope: MemoryScope): string {\n  if (isSimpleScope(scope)) {\n    return scope;\n  }\n  // Task-aware scope\n  if (scope.type === 'task') {\n    return `task:${scope.taskIds.join(',')}`;\n  }\n  return scope.type;\n}\n\n/**\n * Format entry flags for display\n */\nfunction formatEntryFlags(entry: MemoryIndexEntry): string {\n  const flags: string[] = [];\n\n  if (entry.pinned) {\n    flags.push('pinned');\n  } else if (entry.effectivePriority !== 'normal') {\n    flags.push(entry.effectivePriority);\n  }\n\n  flags.push(formatScope(entry.scope));\n\n  return flags.join(', ');\n}\n\n/**\n * Format memory index for context injection\n */\nexport function formatMemoryIndex(index: MemoryIndex): string {\n  const lines: string[] = [];\n\n  // Format utilization percent without unnecessary decimals\n  const utilPercent = Number.isInteger(index.utilizationPercent)\n    ? index.utilizationPercent.toString()\n    : index.utilizationPercent.toFixed(1).replace(/\\.0$/, '');\n\n  lines.push(`## Working Memory (${index.totalSizeHuman} / ${index.limitHuman} - ${utilPercent}%)`);\n  lines.push('');\n\n  if (index.entries.length === 0) {\n    lines.push('Memory is empty.');\n  } else {\n    // Group by priority first, then scope\n    const pinned = index.entries.filter((e) => e.pinned);\n    const critical = index.entries.filter((e) => !e.pinned && e.effectivePriority === 'critical');\n    const high = index.entries.filter((e) => !e.pinned && e.effectivePriority === 'high');\n    const normal = index.entries.filter((e) => !e.pinned && e.effectivePriority === 'normal');\n    const low = index.entries.filter((e) => !e.pinned && e.effectivePriority === 'low');\n\n    if (pinned.length > 0) {\n      lines.push('**Pinned (never evicted):**');\n      for (const entry of pinned) {\n        lines.push(`- \\`${entry.key}\\` (${entry.size}): ${entry.description} [${formatEntryFlags(entry)}]`);\n      }\n      lines.push('');\n    }\n\n    if (critical.length > 0) {\n      lines.push('**Critical priority:**');\n      for (const entry of critical) {\n        lines.push(`- \\`${entry.key}\\` (${entry.size}): ${entry.description} [${formatEntryFlags(entry)}]`);\n      }\n      lines.push('');\n    }\n\n    if (high.length > 0) {\n      lines.push('**High priority:**');\n      for (const entry of high) {\n        lines.push(`- \\`${entry.key}\\` (${entry.size}): ${entry.description} [${formatEntryFlags(entry)}]`);\n      }\n      lines.push('');\n    }\n\n    if (normal.length > 0) {\n      lines.push('**Normal priority:**');\n      for (const entry of normal) {\n        lines.push(`- \\`${entry.key}\\` (${entry.size}): ${entry.description} [${formatEntryFlags(entry)}]`);\n      }\n      lines.push('');\n    }\n\n    if (low.length > 0) {\n      lines.push('**Low priority (evicted first):**');\n      for (const entry of low) {\n        lines.push(`- \\`${entry.key}\\` (${entry.size}): ${entry.description} [${formatEntryFlags(entry)}]`);\n      }\n      lines.push('');\n    }\n\n    // Add warning if utilization is high\n    if (index.utilizationPercent > 80) {\n      lines.push('Warning: Memory utilization is high. Consider deleting unused entries.');\n      lines.push('');\n    }\n  }\n\n  lines.push('Use `memory_retrieve(\"key\")` to load full content.');\n  lines.push('Use `memory_persist(\"key\")` to keep data after task completion.');\n\n  return lines.join('\\n');\n}\n","/**\n * WorkingMemory class - manages indexed working memory for TaskAgent\n *\n * This is a GENERIC implementation that works across all agent types:\n * - Basic Agent: Uses staticPriorityCalculator with simple scopes\n * - TaskAgent: Uses taskAwarePriorityCalculator with task-aware scopes\n * - UniversalAgent: Can switch calculators based on mode\n *\n * The PriorityCalculator strategy pattern allows different agents to have\n * different eviction behaviors without changing the core WorkingMemory logic.\n */\n\nimport { EventEmitter } from 'eventemitter3';\nimport { IMemoryStorage } from '../../domain/interfaces/IMemoryStorage.js';\nimport { WorkingMemoryAccess } from '../../domain/interfaces/IToolContext.js';\nimport { IDisposable } from '../../domain/interfaces/IDisposable.js';\nimport type {\n  MemoryIndex,\n  MemoryScope,\n  MemoryPriority,\n  MemoryEntry,\n  MemoryEntryInput,\n  WorkingMemoryConfig,\n  PriorityCalculator,\n  PriorityContext,\n  StaleEntryInfo,\n  TaskStatusForMemory,\n} from '../../domain/entities/Memory.js';\nimport {\n  DEFAULT_MEMORY_CONFIG,\n  staticPriorityCalculator,\n  MEMORY_PRIORITY_VALUES,\n  isSimpleScope,\n  isTaskAwareScope,\n  detectStaleEntries,\n  createMemoryEntry,\n  formatSizeHuman,\n  formatMemoryIndex,\n  isTerminalMemoryStatus,\n  TIER_PRIORITIES,\n  TIER_KEY_PREFIXES,\n  getTierFromKey,\n  addTierPrefix,\n} from '../../domain/entities/Memory.js';\nimport type { MemoryTier, HierarchyMetadata } from '../../domain/entities/Memory.js';\n\n/**\n * Serialized memory state for persistence\n */\nexport interface SerializedMemory {\n  /** Memory format version */\n  version: number;\n  /** Serialized memory entries */\n  entries: SerializedMemoryEntry[];\n}\n\n/**\n * Serialized memory entry\n */\nexport interface SerializedMemoryEntry {\n  key: string;\n  description: string;\n  value: unknown;\n  scope: MemoryScope;\n  sizeBytes: number;\n  basePriority?: MemoryPriority;\n  pinned?: boolean;\n}\n\n/**\n * Eviction strategy type\n */\nexport type EvictionStrategy = 'lru' | 'size';\n\n/**\n * Entry with computed effective priority\n */\ninterface EntryWithPriority {\n  entry: MemoryEntry;\n  effectivePriority: MemoryPriority;\n}\n\nexport interface WorkingMemoryEvents {\n  stored: { key: string; description: string; scope: MemoryScope };\n  retrieved: { key: string };\n  deleted: { key: string };\n  evicted: { keys: string[]; reason: 'lru' | 'size' | 'task_completed' };\n  limit_warning: { utilizationPercent: number };\n  stale_entries: { entries: StaleEntryInfo[] };\n}\n\n/**\n * WorkingMemory manages the agent's indexed working memory.\n *\n * Features:\n * - Store/retrieve with descriptions for index\n * - Scoped memory (simple or task-aware)\n * - Priority-based eviction (respects pinned, priority, then LRU)\n * - Pluggable priority calculation via PriorityCalculator strategy\n * - Task completion detection and stale entry notification\n * - Event emission for monitoring\n */\nexport class WorkingMemory extends EventEmitter<WorkingMemoryEvents> implements IDisposable {\n  private storage: IMemoryStorage;\n  private config: WorkingMemoryConfig;\n  private priorityCalculator: PriorityCalculator;\n  private priorityContext: PriorityContext;\n  private _isDestroyed = false;\n\n  /**\n   * Create a WorkingMemory instance\n   *\n   * @param storage - Storage backend for memory entries\n   * @param config - Memory configuration (limits, etc.)\n   * @param priorityCalculator - Strategy for computing effective priority (default: static)\n   */\n  constructor(\n    storage: IMemoryStorage,\n    config: WorkingMemoryConfig = DEFAULT_MEMORY_CONFIG,\n    priorityCalculator: PriorityCalculator = staticPriorityCalculator\n  ) {\n    super();\n    this.storage = storage;\n    this.config = config;\n    this.priorityCalculator = priorityCalculator;\n    this.priorityContext = {};\n  }\n\n  /**\n   * Set the priority calculator (for switching strategies at runtime)\n   */\n  setPriorityCalculator(calculator: PriorityCalculator): void {\n    this.priorityCalculator = calculator;\n  }\n\n  /**\n   * Update priority context (e.g., task states for TaskAgent)\n   */\n  setPriorityContext(context: PriorityContext): void {\n    this.priorityContext = context;\n  }\n\n  /**\n   * Get the current priority context\n   */\n  getPriorityContext(): PriorityContext {\n    return this.priorityContext;\n  }\n\n  /**\n   * Compute effective priority for an entry using the current calculator\n   */\n  private computeEffectivePriority(entry: MemoryEntry): MemoryPriority {\n    return this.priorityCalculator(entry, this.priorityContext);\n  }\n\n  /**\n   * Get all entries with their computed effective priorities\n   * This is a performance optimization to avoid repeated getAll() + map() calls\n   */\n  private async getEntriesWithPriority(): Promise<EntryWithPriority[]> {\n    const entries = await this.storage.getAll();\n    return entries.map((entry) => ({\n      entry,\n      effectivePriority: this.computeEffectivePriority(entry),\n    }));\n  }\n\n  /**\n   * Get evictable entries sorted by eviction priority\n   * Filters out pinned and critical entries, sorts by priority then by strategy\n   */\n  private getEvictableEntries(\n    entriesWithPriority: EntryWithPriority[],\n    strategy: EvictionStrategy\n  ): EntryWithPriority[] {\n    return entriesWithPriority\n      .filter(({ entry, effectivePriority }) => {\n        // Never evict pinned\n        if (entry.pinned) return false;\n        // Never evict critical priority\n        if (effectivePriority === 'critical') return false;\n        return true;\n      })\n      .sort((a, b) => {\n        // Sort by priority first (lowest priority = evicted first)\n        const priorityDiff =\n          MEMORY_PRIORITY_VALUES[a.effectivePriority] -\n          MEMORY_PRIORITY_VALUES[b.effectivePriority];\n        if (priorityDiff !== 0) return priorityDiff;\n\n        // Then by strategy\n        if (strategy === 'lru') {\n          return a.entry.lastAccessedAt - b.entry.lastAccessedAt;\n        } else {\n          // size: largest first\n          return b.entry.sizeBytes - a.entry.sizeBytes;\n        }\n      });\n  }\n\n  /**\n   * Store a value in working memory\n   *\n   * @param key - Unique key for the entry\n   * @param description - Short description for the index (max 150 chars)\n   * @param value - The data to store\n   * @param options - Optional scope, priority, and pinned settings\n   */\n  async store(\n    key: string,\n    description: string,\n    value: unknown,\n    options?: {\n      scope?: MemoryScope;\n      priority?: MemoryPriority;\n      pinned?: boolean;\n    }\n  ): Promise<void> {\n    const input: MemoryEntryInput = {\n      key,\n      description,\n      value,\n      scope: options?.scope ?? 'session',\n      priority: options?.priority,\n      pinned: options?.pinned,\n    };\n\n    // Validate and create entry\n    const entry = createMemoryEntry(input, this.config);\n\n    // Check size limit\n    const currentSize = await this.storage.getTotalSize();\n    const existing = await this.storage.get(key);\n    const existingSize = existing?.sizeBytes ?? 0;\n    const newTotalSize = currentSize - existingSize + entry.sizeBytes;\n\n    const limit = this.getLimit();\n\n    if (newTotalSize > limit) {\n      throw new Error(`Memory limit exceeded: ${newTotalSize} bytes > ${limit} bytes`);\n    }\n\n    // Check soft limit warning\n    const utilization = (newTotalSize / limit) * 100;\n    if (utilization > this.config.softLimitPercent) {\n      this.emit('limit_warning', { utilizationPercent: utilization });\n    }\n\n    // Store entry\n    await this.storage.set(key, entry);\n\n    this.emit('stored', { key, description, scope: entry.scope });\n  }\n\n  /**\n   * Store a value scoped to specific tasks\n   * Convenience method for task-aware memory\n   */\n  async storeForTasks(\n    key: string,\n    description: string,\n    value: unknown,\n    taskIds: string[],\n    options?: { priority?: MemoryPriority; pinned?: boolean }\n  ): Promise<void> {\n    await this.store(key, description, value, {\n      scope: { type: 'task', taskIds },\n      priority: options?.priority,\n      pinned: options?.pinned,\n    });\n  }\n\n  /**\n   * Store a value scoped to the entire plan\n   * Convenience method for plan-scoped memory\n   */\n  async storeForPlan(\n    key: string,\n    description: string,\n    value: unknown,\n    options?: { priority?: MemoryPriority; pinned?: boolean }\n  ): Promise<void> {\n    await this.store(key, description, value, {\n      scope: { type: 'plan' },\n      priority: options?.priority,\n      pinned: options?.pinned,\n    });\n  }\n\n  /**\n   * Retrieve a value from working memory\n   *\n   * Note: Access stats update is not strictly atomic. Under very high concurrency,\n   * accessCount may be slightly inaccurate. This is acceptable for memory management\n   * purposes where exact counts are not critical.\n   */\n  async retrieve(key: string): Promise<unknown> {\n    const entry = await this.storage.get(key);\n    if (!entry) {\n      return undefined;\n    }\n\n    // Capture value before async operations to reduce race window\n    const value = entry.value;\n\n    // Update access stats - do this in background to not block retrieval\n    // Re-fetch to minimize race condition window\n    const freshEntry = await this.storage.get(key);\n    if (freshEntry) {\n      freshEntry.lastAccessedAt = Date.now();\n      freshEntry.accessCount += 1;\n      await this.storage.set(key, freshEntry);\n    }\n\n    this.emit('retrieved', { key });\n\n    return value;\n  }\n\n  /**\n   * Retrieve multiple values\n   */\n  async retrieveMany(keys: string[]): Promise<Record<string, unknown>> {\n    const result: Record<string, unknown> = {};\n\n    for (const key of keys) {\n      const value = await this.retrieve(key);\n      if (value !== undefined) {\n        result[key] = value;\n      }\n    }\n\n    return result;\n  }\n\n  /**\n   * Delete a value from working memory\n   */\n  async delete(key: string): Promise<void> {\n    await this.storage.delete(key);\n    this.emit('deleted', { key });\n  }\n\n  /**\n   * Check if key exists\n   */\n  async has(key: string): Promise<boolean> {\n    return this.storage.has(key);\n  }\n\n  /**\n   * Promote an entry to persistent scope\n   * Works with both simple and task-aware scopes\n   */\n  async persist(key: string): Promise<void> {\n    const entry = await this.storage.get(key);\n    if (!entry) {\n      throw new Error(`Key \"${key}\" not found in memory`);\n    }\n\n    // Check if already persistent\n    const isPersistent = isSimpleScope(entry.scope)\n      ? entry.scope === 'persistent'\n      : isTaskAwareScope(entry.scope) && entry.scope.type === 'persistent';\n\n    if (!isPersistent) {\n      entry.scope = { type: 'persistent' };\n      await this.storage.set(key, entry);\n    }\n  }\n\n  /**\n   * Pin an entry (never evicted)\n   */\n  async pin(key: string): Promise<void> {\n    const entry = await this.storage.get(key);\n    if (!entry) {\n      throw new Error(`Key \"${key}\" not found in memory`);\n    }\n\n    if (!entry.pinned) {\n      entry.pinned = true;\n      entry.basePriority = 'critical';\n      await this.storage.set(key, entry);\n    }\n  }\n\n  /**\n   * Unpin an entry\n   */\n  async unpin(key: string, newPriority: MemoryPriority = 'normal'): Promise<void> {\n    const entry = await this.storage.get(key);\n    if (!entry) {\n      throw new Error(`Key \"${key}\" not found in memory`);\n    }\n\n    if (entry.pinned) {\n      entry.pinned = false;\n      entry.basePriority = newPriority;\n      await this.storage.set(key, entry);\n    }\n  }\n\n  /**\n   * Set the base priority of an entry\n   */\n  async setPriority(key: string, priority: MemoryPriority): Promise<void> {\n    const entry = await this.storage.get(key);\n    if (!entry) {\n      throw new Error(`Key \"${key}\" not found in memory`);\n    }\n\n    entry.basePriority = priority;\n    await this.storage.set(key, entry);\n  }\n\n  /**\n   * Update the scope of an entry without re-storing the value\n   */\n  async updateScope(key: string, scope: MemoryScope): Promise<void> {\n    const entry = await this.storage.get(key);\n    if (!entry) {\n      throw new Error(`Key \"${key}\" not found in memory`);\n    }\n\n    entry.scope = scope;\n    await this.storage.set(key, entry);\n  }\n\n  /**\n   * Add task IDs to an existing task-scoped entry\n   * If entry is not task-scoped, converts it to task-scoped\n   */\n  async addTasksToScope(key: string, taskIds: string[]): Promise<void> {\n    const entry = await this.storage.get(key);\n    if (!entry) {\n      throw new Error(`Key \"${key}\" not found in memory`);\n    }\n\n    if (isTaskAwareScope(entry.scope) && entry.scope.type === 'task') {\n      // Merge task IDs, removing duplicates\n      const existingIds = new Set(entry.scope.taskIds);\n      for (const id of taskIds) {\n        existingIds.add(id);\n      }\n      entry.scope = { type: 'task', taskIds: Array.from(existingIds) };\n    } else {\n      // Convert to task-scoped\n      entry.scope = { type: 'task', taskIds };\n    }\n\n    await this.storage.set(key, entry);\n  }\n\n  /**\n   * Clear all entries of a specific scope\n   */\n  async clearScope(scope: MemoryScope): Promise<void> {\n    await this.storage.clearScope(scope);\n  }\n\n  /**\n   * Clear all entries\n   */\n  async clear(): Promise<void> {\n    await this.storage.clear();\n  }\n\n  /**\n   * Get memory index with computed effective priorities\n   */\n  async getIndex(): Promise<MemoryIndex> {\n    const entriesWithPriority = await this.getEntriesWithPriority();\n    const totalSizeBytes = await this.storage.getTotalSize();\n    const limitBytes = this.getLimit();\n\n    // Sort by: pinned first, then by priority (critical > high > normal > low), then by LRU\n    const sortedEntries = [...entriesWithPriority].sort((a, b) => {\n      // Pinned first\n      if (a.entry.pinned && !b.entry.pinned) return -1;\n      if (!a.entry.pinned && b.entry.pinned) return 1;\n\n      // Then by effective priority (higher priority first)\n      const priorityDiff =\n        MEMORY_PRIORITY_VALUES[b.effectivePriority] -\n        MEMORY_PRIORITY_VALUES[a.effectivePriority];\n      if (priorityDiff !== 0) return priorityDiff;\n\n      // Then by last access time (most recent first)\n      return b.entry.lastAccessedAt - a.entry.lastAccessedAt;\n    });\n\n    const indexEntries = sortedEntries.map(({ entry, effectivePriority }) => ({\n      key: entry.key,\n      description: entry.description,\n      size: formatSizeHuman(entry.sizeBytes),\n      scope: entry.scope,\n      effectivePriority,\n      pinned: entry.pinned,\n    }));\n\n    return {\n      entries: indexEntries,\n      totalSizeBytes,\n      totalSizeHuman: formatSizeHuman(totalSizeBytes),\n      limitBytes,\n      limitHuman: formatSizeHuman(limitBytes),\n      utilizationPercent: (totalSizeBytes / limitBytes) * 100,\n    };\n  }\n\n  /**\n   * Format index for context injection\n   */\n  async formatIndex(): Promise<string> {\n    const index = await this.getIndex();\n    return formatMemoryIndex(index);\n  }\n\n  /**\n   * Evict entries using specified strategy\n   *\n   * Eviction order:\n   * 1. Never evict pinned entries\n   * 2. Evict low priority first, then normal, then high (never critical)\n   * 3. Within same priority, use strategy (LRU or largest size)\n   *\n   * @param count - Number of entries to evict\n   * @param strategy - Eviction strategy ('lru' or 'size')\n   * @returns Keys of evicted entries\n   */\n  async evict(count: number, strategy: EvictionStrategy = 'lru'): Promise<string[]> {\n    const entriesWithPriority = await this.getEntriesWithPriority();\n    const evictable = this.getEvictableEntries(entriesWithPriority, strategy);\n\n    const toEvict = evictable.slice(0, count);\n    const evictedKeys: string[] = [];\n\n    for (const { entry } of toEvict) {\n      await this.storage.delete(entry.key);\n      evictedKeys.push(entry.key);\n    }\n\n    if (evictedKeys.length > 0) {\n      this.emit('evicted', { keys: evictedKeys, reason: strategy });\n    }\n\n    return evictedKeys;\n  }\n\n  /**\n   * Evict entries using priority-aware LRU algorithm\n   * @deprecated Use evict(count, 'lru') instead\n   */\n  async evictLRU(count: number): Promise<string[]> {\n    return this.evict(count, 'lru');\n  }\n\n  /**\n   * Evict largest entries first (priority-aware)\n   * @deprecated Use evict(count, 'size') instead\n   */\n  async evictBySize(count: number): Promise<string[]> {\n    return this.evict(count, 'size');\n  }\n\n  /**\n   * Handle task completion - detect and notify about stale entries\n   *\n   * Call this when a task completes to:\n   * 1. Update priority context with new task state\n   * 2. Detect entries that became stale\n   * 3. Emit event to notify LLM about stale entries\n   *\n   * @param taskId - The completed task ID\n   * @param taskStates - Current task states map\n   * @returns Information about stale entries\n   */\n  async onTaskComplete(\n    taskId: string,\n    taskStates: Map<string, TaskStatusForMemory>\n  ): Promise<StaleEntryInfo[]> {\n    // Update priority context\n    this.priorityContext.taskStates = taskStates;\n\n    // Get all entries\n    const entries = await this.storage.getAll();\n\n    // Detect stale entries\n    const staleEntries = detectStaleEntries(entries, taskId, taskStates);\n\n    // Emit event if there are stale entries\n    if (staleEntries.length > 0) {\n      this.emit('stale_entries', { entries: staleEntries });\n    }\n\n    return staleEntries;\n  }\n\n  /**\n   * Evict entries for completed tasks\n   *\n   * Removes entries that were scoped only to completed tasks.\n   * Use after onTaskComplete() if you want automatic cleanup.\n   *\n   * @param taskStates - Current task states map\n   * @returns Keys of evicted entries\n   */\n  async evictCompletedTaskEntries(\n    taskStates: Map<string, TaskStatusForMemory>\n  ): Promise<string[]> {\n    const entries = await this.storage.getAll();\n    const evictedKeys: string[] = [];\n\n    for (const entry of entries) {\n      // Skip pinned\n      if (entry.pinned) continue;\n\n      // Only check task-scoped entries\n      if (!isTaskAwareScope(entry.scope) || entry.scope.type !== 'task') continue;\n\n      // Check if ALL tasks for this entry are terminal\n      const allTerminal = entry.scope.taskIds.every((taskId) => {\n        const status = taskStates.get(taskId);\n        return status ? isTerminalMemoryStatus(status) : false;\n      });\n\n      if (allTerminal) {\n        await this.storage.delete(entry.key);\n        evictedKeys.push(entry.key);\n      }\n    }\n\n    if (evictedKeys.length > 0) {\n      this.emit('evicted', { keys: evictedKeys, reason: 'task_completed' });\n    }\n\n    return evictedKeys;\n  }\n\n  /**\n   * Get limited memory access for tools\n   *\n   * This provides a simplified interface for tools to interact with memory\n   * without exposing the full WorkingMemory API.\n   */\n  getAccess(): WorkingMemoryAccess {\n    return {\n      get: async (key: string) => this.retrieve(key),\n      set: async (key: string, description: string, value: unknown, options?: {\n        scope?: MemoryScope;\n        priority?: MemoryPriority;\n        pinned?: boolean;\n      }) => this.store(key, description, value, options),\n      delete: async (key: string) => this.delete(key),\n      has: async (key: string) => this.has(key),\n      list: async () => {\n        const index = await this.getIndex();\n        return index.entries.map((e) => ({\n          key: e.key,\n          description: e.description,\n          effectivePriority: e.effectivePriority,\n          pinned: e.pinned,\n        }));\n      },\n    };\n  }\n\n  // ============================================================================\n  // HIERARCHICAL MEMORY HELPERS\n  // ============================================================================\n\n  /**\n   * Store raw data (low priority, first to be evicted)\n   *\n   * Use this for original/unprocessed data that should be summarized.\n   * Raw data is automatically evicted first when memory pressure is high.\n   *\n   * @param key - Key without tier prefix (prefix is added automatically)\n   * @param description - Brief description for the index\n   * @param value - The raw data to store\n   * @param options - Optional scope and task IDs\n   */\n  async storeRaw(\n    key: string,\n    description: string,\n    value: unknown,\n    options?: { taskIds?: string[]; scope?: MemoryScope }\n  ): Promise<void> {\n    const fullKey = addTierPrefix(key, 'raw');\n    const scope = options?.taskIds\n      ? { type: 'task' as const, taskIds: options.taskIds }\n      : options?.scope ?? 'session';\n\n    await this.store(fullKey, description, value, {\n      scope,\n      priority: TIER_PRIORITIES.raw,\n    });\n  }\n\n  /**\n   * Store a summary derived from raw data (normal priority)\n   *\n   * Use this for processed/summarized data that extracts key information.\n   * Links back to source data for cleanup tracking.\n   *\n   * @param key - Key without tier prefix (prefix is added automatically)\n   * @param description - Brief description for the index\n   * @param value - The summary data\n   * @param derivedFrom - Key(s) this summary was derived from\n   * @param options - Optional scope and task IDs\n   */\n  async storeSummary(\n    key: string,\n    description: string,\n    value: unknown,\n    derivedFrom: string | string[],\n    options?: { taskIds?: string[]; scope?: MemoryScope }\n  ): Promise<void> {\n    const fullKey = addTierPrefix(key, 'summary');\n    const sourceKeys = Array.isArray(derivedFrom) ? derivedFrom : [derivedFrom];\n    const scope = options?.taskIds\n      ? { type: 'task' as const, taskIds: options.taskIds }\n      : options?.scope ?? { type: 'plan' as const };\n\n    await this.store(fullKey, description, value, {\n      scope,\n      priority: TIER_PRIORITIES.summary,\n    });\n\n    // Update source entries with derivedTo reference (best effort)\n    for (const sourceKey of sourceKeys) {\n      try {\n        const sourceEntry = await this.storage.get(sourceKey);\n        if (sourceEntry) {\n          const metadata = (sourceEntry.value as Record<string, unknown>)?.metadata as HierarchyMetadata | undefined;\n          const existingDerivedTo = metadata?.derivedTo ?? [];\n          if (!existingDerivedTo.includes(fullKey)) {\n            // We can't easily update metadata without re-storing the value\n            // This is a limitation - we track derivedFrom on the child instead\n          }\n        }\n      } catch {\n        // Ignore errors updating source - it may have been evicted\n      }\n    }\n  }\n\n  /**\n   * Store final findings (high priority, kept longest)\n   *\n   * Use this for conclusions, insights, or final results that should be preserved.\n   * These are the last to be evicted and typically span the entire plan.\n   *\n   * @param key - Key without tier prefix (prefix is added automatically)\n   * @param description - Brief description for the index\n   * @param value - The findings data\n   * @param derivedFrom - Optional key(s) these findings were derived from\n   * @param options - Optional scope, task IDs, and pinned flag\n   */\n  async storeFindings(\n    key: string,\n    description: string,\n    value: unknown,\n    _derivedFrom?: string | string[],\n    options?: { taskIds?: string[]; scope?: MemoryScope; pinned?: boolean }\n  ): Promise<void> {\n    const fullKey = addTierPrefix(key, 'findings');\n    const scope = options?.scope ?? { type: 'plan' as const };\n\n    // Note: _derivedFrom is available for future metadata tracking if needed\n    await this.store(fullKey, description, value, {\n      scope,\n      priority: TIER_PRIORITIES.findings,\n      pinned: options?.pinned,\n    });\n  }\n\n  /**\n   * Clean up raw data after summary/findings are created\n   *\n   * Call this after creating summaries to free up memory used by raw data.\n   * Only deletes entries in the 'raw' tier.\n   *\n   * @param derivedFromKeys - Keys to delete (typically from derivedFrom metadata)\n   * @returns Number of entries deleted\n   */\n  async cleanupRawData(derivedFromKeys: string[]): Promise<number> {\n    let deletedCount = 0;\n\n    for (const key of derivedFromKeys) {\n      // Only delete if it's actually a raw tier entry\n      const tier = getTierFromKey(key);\n      if (tier === 'raw') {\n        const exists = await this.has(key);\n        if (exists) {\n          await this.delete(key);\n          deletedCount++;\n        }\n      }\n    }\n\n    return deletedCount;\n  }\n\n  /**\n   * Get all entries by tier\n   *\n   * @param tier - The tier to filter by\n   * @returns Array of entries in that tier\n   */\n  async getByTier(tier: MemoryTier): Promise<MemoryEntry[]> {\n    const entries = await this.storage.getAll();\n    const prefix = TIER_KEY_PREFIXES[tier];\n    return entries.filter((e) => e.key.startsWith(prefix));\n  }\n\n  /**\n   * Promote an entry to a higher tier\n   *\n   * Changes the key prefix and updates priority.\n   * Use this when raw data becomes more valuable (e.g., frequently accessed).\n   *\n   * @param key - Current key (with tier prefix)\n   * @param toTier - Target tier to promote to\n   * @returns New key with updated prefix\n   */\n  async promote(key: string, toTier: MemoryTier): Promise<string> {\n    const currentTier = getTierFromKey(key);\n    if (currentTier === toTier) {\n      return key; // Already in target tier\n    }\n\n    const entry = await this.storage.get(key);\n    if (!entry) {\n      throw new Error(`Key \"${key}\" not found in memory`);\n    }\n\n    // Create new entry with new tier\n    const newKey = addTierPrefix(key, toTier);\n    const newPriority = TIER_PRIORITIES[toTier];\n\n    // Store with new key and priority\n    await this.store(newKey, entry.description, entry.value, {\n      scope: entry.scope,\n      priority: newPriority,\n      pinned: entry.pinned,\n    });\n\n    // Delete old entry\n    await this.delete(key);\n\n    return newKey;\n  }\n\n  /**\n   * Get tier statistics\n   *\n   * @returns Count and size by tier\n   */\n  async getTierStats(): Promise<Record<MemoryTier, { count: number; sizeBytes: number }>> {\n    const entries = await this.storage.getAll();\n    const stats: Record<MemoryTier, { count: number; sizeBytes: number }> = {\n      raw: { count: 0, sizeBytes: 0 },\n      summary: { count: 0, sizeBytes: 0 },\n      findings: { count: 0, sizeBytes: 0 },\n    };\n\n    for (const entry of entries) {\n      const tier = getTierFromKey(entry.key);\n      if (tier) {\n        stats[tier].count++;\n        stats[tier].sizeBytes += entry.sizeBytes;\n      }\n    }\n\n    return stats;\n  }\n\n  /**\n   * Get statistics about memory usage\n   */\n  async getStats(): Promise<{\n    totalEntries: number;\n    totalSizeBytes: number;\n    utilizationPercent: number;\n    byPriority: Record<MemoryPriority, number>;\n    pinnedCount: number;\n  }> {\n    const entriesWithPriority = await this.getEntriesWithPriority();\n    const totalSizeBytes = await this.storage.getTotalSize();\n    const limit = this.getLimit();\n\n    const byPriority: Record<MemoryPriority, number> = {\n      critical: 0,\n      high: 0,\n      normal: 0,\n      low: 0,\n    };\n\n    let pinnedCount = 0;\n\n    for (const { entry, effectivePriority } of entriesWithPriority) {\n      byPriority[effectivePriority]++;\n      if (entry.pinned) pinnedCount++;\n    }\n\n    return {\n      totalEntries: entriesWithPriority.length,\n      totalSizeBytes,\n      utilizationPercent: (totalSizeBytes / limit) * 100,\n      byPriority,\n      pinnedCount,\n    };\n  }\n\n  /**\n   * Get the configured memory limit\n   */\n  getLimit(): number {\n    return this.config.maxSizeBytes ?? 25 * 1024 * 1024; // Default 25MB\n  }\n\n  /**\n   * Check if the WorkingMemory instance has been destroyed\n   */\n  get isDestroyed(): boolean {\n    return this._isDestroyed;\n  }\n\n  /**\n   * Destroy the WorkingMemory instance\n   * Removes all event listeners and clears internal state\n   */\n  destroy(): void {\n    if (this._isDestroyed) return;\n    this._isDestroyed = true;\n    this.removeAllListeners();\n    this.priorityContext = {};\n  }\n\n  // ============================================================================\n  // Serialization (for session persistence)\n  // ============================================================================\n\n  /**\n   * Serialize all memory entries for persistence\n   *\n   * Returns a serializable representation of all memory entries\n   * that can be saved to storage and restored later.\n   *\n   * @returns Serialized memory state\n   */\n  async serialize(): Promise<SerializedMemory> {\n    const entries = await this.storage.getAll();\n\n    const serializedEntries: SerializedMemoryEntry[] = entries.map((entry) => ({\n      key: entry.key,\n      description: entry.description,\n      value: entry.value,\n      scope: entry.scope,\n      sizeBytes: entry.sizeBytes,\n      basePriority: entry.basePriority,\n      pinned: entry.pinned,\n      // Note: createdAt, lastAccessedAt, accessCount are not persisted\n      // They will be reset on restore (entries start fresh)\n    }));\n\n    return {\n      version: 1,\n      entries: serializedEntries,\n    };\n  }\n\n  /**\n   * Restore memory entries from serialized state\n   *\n   * Clears existing memory and repopulates from the serialized state.\n   * Timestamps are reset to current time.\n   *\n   * @param state - Previously serialized memory state\n   */\n  async restore(state: SerializedMemory): Promise<void> {\n    // Validate version\n    if (state.version !== 1) {\n      throw new Error(`Unsupported memory serialization version: ${state.version}`);\n    }\n\n    // Clear existing entries\n    await this.storage.clear();\n\n    // Restore each entry\n    const now = Date.now();\n    for (const entry of state.entries) {\n      const fullEntry: MemoryEntry = {\n        key: entry.key,\n        description: entry.description,\n        value: entry.value,\n        scope: entry.scope,\n        sizeBytes: entry.sizeBytes,\n        basePriority: entry.basePriority ?? 'normal',\n        pinned: entry.pinned ?? false,\n        createdAt: now,\n        lastAccessedAt: now,\n        accessCount: 0,\n      };\n\n      await this.storage.set(entry.key, fullEntry);\n    }\n  }\n}\n\nexport type { WorkingMemoryConfig, PriorityCalculator, PriorityContext, StaleEntryInfo, MemoryTier, HierarchyMetadata };\nexport {\n  DEFAULT_MEMORY_CONFIG,\n  staticPriorityCalculator,\n  MEMORY_PRIORITY_VALUES,\n  TIER_PRIORITIES,\n  TIER_KEY_PREFIXES,\n  getTierFromKey,\n  addTierPrefix,\n};\n","/**\n * In-memory storage implementations (default, non-persistent)\n */\n\nimport { MemoryEntry, MemoryScope, scopeMatches } from '../../domain/entities/Memory.js';\nimport { Plan, Task, PlanStatus } from '../../domain/entities/Task.js';\nimport { AgentState, AgentStatus } from '../../domain/entities/AgentState.js';\nimport { IMemoryStorage } from '../../domain/interfaces/IMemoryStorage.js';\nimport { IPlanStorage } from '../../domain/interfaces/IPlanStorage.js';\nimport { IAgentStateStorage } from '../../domain/interfaces/IAgentStateStorage.js';\n\n/**\n * In-memory implementation of IMemoryStorage\n */\nexport class InMemoryStorage implements IMemoryStorage {\n  private store = new Map<string, MemoryEntry>();\n\n  async get(key: string): Promise<MemoryEntry | undefined> {\n    return this.store.get(key);\n  }\n\n  async set(key: string, entry: MemoryEntry): Promise<void> {\n    this.store.set(key, entry);\n  }\n\n  async delete(key: string): Promise<void> {\n    this.store.delete(key);\n  }\n\n  async has(key: string): Promise<boolean> {\n    return this.store.has(key);\n  }\n\n  async getAll(): Promise<MemoryEntry[]> {\n    return Array.from(this.store.values());\n  }\n\n  async getByScope(scope: MemoryScope): Promise<MemoryEntry[]> {\n    return Array.from(this.store.values()).filter((entry) => scopeMatches(entry.scope, scope));\n  }\n\n  async clearScope(scope: MemoryScope): Promise<void> {\n    const toDelete: string[] = [];\n    for (const [key, entry] of this.store.entries()) {\n      if (scopeMatches(entry.scope, scope)) {\n        toDelete.push(key);\n      }\n    }\n    for (const key of toDelete) {\n      this.store.delete(key);\n    }\n  }\n\n  async clear(): Promise<void> {\n    this.store.clear();\n  }\n\n  async getTotalSize(): Promise<number> {\n    let total = 0;\n    for (const entry of this.store.values()) {\n      total += entry.sizeBytes;\n    }\n    return total;\n  }\n}\n\n/**\n * In-memory implementation of IPlanStorage\n */\nexport class InMemoryPlanStorage implements IPlanStorage {\n  private plans = new Map<string, Plan>();\n\n  async savePlan(plan: Plan): Promise<void> {\n    // Deep clone to avoid mutations\n    this.plans.set(plan.id, JSON.parse(JSON.stringify(plan)));\n  }\n\n  async getPlan(planId: string): Promise<Plan | undefined> {\n    const plan = this.plans.get(planId);\n    return plan ? JSON.parse(JSON.stringify(plan)) : undefined;\n  }\n\n  async updateTask(planId: string, task: Task): Promise<void> {\n    const plan = this.plans.get(planId);\n    if (!plan) {\n      throw new Error(`Plan ${planId} not found`);\n    }\n\n    const taskIndex = plan.tasks.findIndex((t) => t.id === task.id);\n    if (taskIndex === -1) {\n      throw new Error(`Task ${task.id} not found in plan ${planId}`);\n    }\n\n    plan.tasks[taskIndex] = JSON.parse(JSON.stringify(task));\n  }\n\n  async addTask(planId: string, task: Task): Promise<void> {\n    const plan = this.plans.get(planId);\n    if (!plan) {\n      throw new Error(`Plan ${planId} not found`);\n    }\n\n    plan.tasks.push(JSON.parse(JSON.stringify(task)));\n  }\n\n  async deletePlan(planId: string): Promise<void> {\n    this.plans.delete(planId);\n  }\n\n  async listPlans(filter?: { status?: PlanStatus[] }): Promise<Plan[]> {\n    const allPlans = Array.from(this.plans.values());\n\n    if (!filter || !filter.status) {\n      return allPlans.map((p) => JSON.parse(JSON.stringify(p)));\n    }\n\n    return allPlans\n      .filter((plan) => filter.status!.includes(plan.status))\n      .map((p) => JSON.parse(JSON.stringify(p)));\n  }\n\n  async findByWebhookId(webhookId: string): Promise<{ plan: Plan; task: Task } | undefined> {\n    for (const plan of this.plans.values()) {\n      for (const task of plan.tasks) {\n        if (task.externalDependency?.webhookId === webhookId) {\n          return {\n            plan: JSON.parse(JSON.stringify(plan)),\n            task: JSON.parse(JSON.stringify(task)),\n          };\n        }\n      }\n    }\n    return undefined;\n  }\n}\n\n/**\n * In-memory implementation of IAgentStateStorage\n */\nexport class InMemoryAgentStateStorage implements IAgentStateStorage {\n  private agents = new Map<string, AgentState>();\n\n  async save(state: AgentState): Promise<void> {\n    // Deep clone to avoid mutations\n    this.agents.set(state.id, JSON.parse(JSON.stringify(state)));\n  }\n\n  async load(agentId: string): Promise<AgentState | undefined> {\n    const state = this.agents.get(agentId);\n    return state ? JSON.parse(JSON.stringify(state)) : undefined;\n  }\n\n  async delete(agentId: string): Promise<void> {\n    this.agents.delete(agentId);\n  }\n\n  async list(filter?: { status?: AgentStatus[] }): Promise<AgentState[]> {\n    const allStates = Array.from(this.agents.values());\n\n    if (!filter || !filter.status) {\n      return allStates.map((s) => JSON.parse(JSON.stringify(s)));\n    }\n\n    return allStates\n      .filter((state) => filter.status!.includes(state.status))\n      .map((s) => JSON.parse(JSON.stringify(s)));\n  }\n\n  async patch(agentId: string, updates: Partial<AgentState>): Promise<void> {\n    const state = this.agents.get(agentId);\n    if (!state) {\n      throw new Error(`Agent ${agentId} not found`);\n    }\n\n    Object.assign(state, updates);\n  }\n}\n\n/**\n * Unified agent storage interface\n */\nexport interface IAgentStorage {\n  memory: IMemoryStorage;\n  plan: IPlanStorage;\n  agent: IAgentStateStorage;\n}\n\n/**\n * Create agent storage with defaults\n */\nexport function createAgentStorage(options: {\n  memory?: IMemoryStorage;\n  plan?: IPlanStorage;\n  agent?: IAgentStateStorage;\n} = {}): IAgentStorage {\n  return {\n    memory: options.memory ?? new InMemoryStorage(),\n    plan: options.plan ?? new InMemoryPlanStorage(),\n    agent: options.agent ?? new InMemoryAgentStateStorage(),\n  };\n}\n\n// Re-export for convenience\nexport { InMemoryStorage as InMemoryMemoryStorage };\nexport type { IAgentStorage as InMemoryAgentStorage };\n","/**\n * Message entity based on OpenAI Responses API format\n */\n\nimport { Content } from './Content.js';\n\nexport enum MessageRole {\n  USER = 'user',\n  ASSISTANT = 'assistant',\n  DEVELOPER = 'developer', // Responses API uses \"developer\" instead of \"system\"\n}\n\nexport interface Message {\n  type: 'message';\n  id?: string;\n  role: MessageRole;\n  content: Content[]; // Always an array in Responses API\n}\n\nexport interface CompactionItem {\n  type: 'compaction';\n  id: string;\n  encrypted_content: string;\n}\n\nexport interface ReasoningItem {\n  type: 'reasoning';\n  id: string;\n  effort?: 'low' | 'medium' | 'high';\n  summary?: string;\n  encrypted_content?: string; // For o-series models\n}\n\nexport type InputItem = Message | CompactionItem;\nexport type OutputItem = Message | CompactionItem | ReasoningItem;\n","/**\n * Content types based on OpenAI Responses API format\n */\n\nexport enum ContentType {\n  INPUT_TEXT = 'input_text',\n  INPUT_IMAGE_URL = 'input_image_url',\n  INPUT_FILE = 'input_file',\n  OUTPUT_TEXT = 'output_text',\n  TOOL_USE = 'tool_use',\n  TOOL_RESULT = 'tool_result',\n}\n\nexport interface BaseContent {\n  type: ContentType;\n}\n\nexport interface InputTextContent extends BaseContent {\n  type: ContentType.INPUT_TEXT;\n  text: string;\n}\n\nexport interface InputImageContent extends BaseContent {\n  type: ContentType.INPUT_IMAGE_URL;\n  image_url: {\n    url: string; // HTTP URL or data URI\n    detail?: 'auto' | 'low' | 'high';\n  };\n}\n\nexport interface InputFileContent extends BaseContent {\n  type: ContentType.INPUT_FILE;\n  file_id: string;\n}\n\nexport interface OutputTextContent extends BaseContent {\n  type: ContentType.OUTPUT_TEXT;\n  text: string;\n  annotations?: any[];\n}\n\nexport interface ToolUseContent extends BaseContent {\n  type: ContentType.TOOL_USE;\n  id: string;\n  name: string;\n  arguments: string; // JSON string\n}\n\nexport interface ToolResultContent extends BaseContent {\n  type: ContentType.TOOL_RESULT;\n  tool_use_id: string;\n  content: string | any;\n  error?: string;\n}\n\nexport type Content =\n  | InputTextContent\n  | InputImageContent\n  | InputFileContent\n  | OutputTextContent\n  | ToolUseContent\n  | ToolResultContent;\n","/**\n * Core types for context management system\n */\n\n/**\n * Context component that can be compacted\n */\nexport interface IContextComponent {\n  /** Unique name for this component */\n  name: string;\n\n  /** The actual content (string or structured data) */\n  content: string | unknown;\n\n  /** Priority for compaction (higher = compact first) */\n  priority: number;\n\n  /** Whether this component can be compacted */\n  compactable: boolean;\n\n  /** Additional metadata for compaction strategies */\n  metadata?: Record<string, unknown>;\n}\n\n/**\n * Context budget information\n */\nexport interface ContextBudget {\n  /** Total available tokens */\n  total: number;\n\n  /** Reserved tokens for response */\n  reserved: number;\n\n  /** Currently used tokens */\n  used: number;\n\n  /** Available tokens remaining */\n  available: number;\n\n  /** Utilization percentage (used / (total - reserved)) */\n  utilizationPercent: number;\n\n  /** Budget status */\n  status: 'ok' | 'warning' | 'critical';\n\n  /** Token breakdown by component */\n  breakdown: Record<string, number>;\n}\n\n/**\n * Context preparation result\n */\nexport interface PreparedContext {\n  /** Prepared components */\n  components: IContextComponent[];\n\n  /** Current budget */\n  budget: ContextBudget;\n\n  /** Whether compaction occurred */\n  compacted: boolean;\n\n  /** Compaction log if compacted */\n  compactionLog?: string[];\n}\n\n/**\n * Context manager configuration\n */\nexport interface ContextManagerConfig {\n  /** Maximum context tokens for the model */\n  maxContextTokens: number;\n\n  /** Threshold to trigger compaction (0.0 - 1.0) */\n  compactionThreshold: number;\n\n  /** Hard limit - must compact before this (0.0 - 1.0) */\n  hardLimit: number;\n\n  /** Reserve space for response (0.0 - 1.0) */\n  responseReserve: number;\n\n  /** Token estimator to use */\n  estimator: 'approximate' | 'tiktoken' | ITokenEstimator;\n\n  /** Enable automatic compaction */\n  autoCompact: boolean;\n\n  /** Strategy to use */\n  strategy?: 'proactive' | 'aggressive' | 'lazy' | 'rolling-window' | 'adaptive' | IContextStrategy;\n\n  /** Strategy-specific options */\n  strategyOptions?: Record<string, unknown>;\n}\n\n/**\n * Default configuration\n */\nexport const DEFAULT_CONTEXT_CONFIG: ContextManagerConfig = {\n  maxContextTokens: 128000,\n  compactionThreshold: 0.75,\n  hardLimit: 0.9,\n  responseReserve: 0.15,\n  estimator: 'approximate',\n  autoCompact: true,\n  strategy: 'proactive',\n  strategyOptions: {},\n};\n\n// Note: IContextProvider interface deleted - was designed for ContextManager class\n// AgentContext is now THE ONLY context manager and provides components directly\n\n/**\n * Content type for more accurate token estimation\n * Named differently from TokenContentType in Content.ts to avoid conflicts\n */\nexport type TokenContentType = 'code' | 'prose' | 'mixed';\n\n/**\n * Abstract interface for token estimation\n */\nexport interface ITokenEstimator {\n  /**\n   * Estimate token count for text\n   *\n   * @param text - The text to estimate\n   * @param contentType - Type of content for more accurate estimation:\n   *   - 'code': Code is typically denser (~3 chars/token)\n   *   - 'prose': Natural language text (~4 chars/token)\n   *   - 'mixed': Mix of code and prose (~3.5 chars/token)\n   */\n  estimateTokens(text: string, contentType?: TokenContentType): number;\n\n  /**\n   * Estimate tokens for structured data\n   */\n  estimateDataTokens(data: unknown, contentType?: TokenContentType): number;\n}\n\n/**\n * Hook context for beforeCompaction callback\n */\nexport interface CompactionHookContext {\n  /** Agent identifier (if available) */\n  agentId?: string;\n  /** Current context budget info */\n  currentBudget: ContextBudget;\n  /** Compaction strategy being used */\n  strategy: string;\n  /** Current context components (read-only summaries) */\n  components: ReadonlyArray<{\n    name: string;\n    priority: number;\n    compactable: boolean;\n  }>;\n  /** Estimated tokens to be freed */\n  estimatedTokensToFree: number;\n}\n\n/**\n * Hooks for context management events\n */\nexport interface ContextManagerHooks {\n  /**\n   * Called before compaction occurs.\n   * Use this to save important data before it gets compacted.\n   * This is the last chance to preserve critical information.\n   */\n  beforeCompaction?: (context: CompactionHookContext) => Promise<void>;\n}\n\n/**\n * Abstract interface for compaction strategies\n */\nexport interface IContextCompactor {\n  /** Compactor name */\n  readonly name: string;\n\n  /** Priority order (lower = run first) */\n  readonly priority: number;\n\n  /**\n   * Check if this compactor can handle the component\n   */\n  canCompact(component: IContextComponent): boolean;\n\n  /**\n   * Compact the component to target size\n   */\n  compact(component: IContextComponent, targetTokens: number): Promise<IContextComponent>;\n\n  /**\n   * Estimate savings from compaction\n   */\n  estimateSavings(component: IContextComponent): number;\n}\n\n/**\n * Context management strategy - defines the overall approach to managing context\n */\nexport interface IContextStrategy {\n  /** Strategy name */\n  readonly name: string;\n\n  /**\n   * Decide if compaction is needed based on current budget\n   */\n  shouldCompact(budget: ContextBudget, config: ContextManagerConfig): boolean;\n\n  /**\n   * Execute compaction using available compactors\n   */\n  compact(\n    components: IContextComponent[],\n    budget: ContextBudget,\n    compactors: IContextCompactor[],\n    estimator: ITokenEstimator\n  ): Promise<{\n    components: IContextComponent[];\n    log: string[];\n    tokensFreed: number;\n  }>;\n\n  /**\n   * Optional: Prepare components before budget calculation\n   * Use this for strategies that pre-process context (e.g., rolling window)\n   */\n  prepareComponents?(components: IContextComponent[]): Promise<IContextComponent[]>;\n\n  /**\n   * Optional: Post-process after compaction\n   * Use this for strategies that need cleanup or optimization\n   */\n  postProcess?(\n    components: IContextComponent[],\n    budget: ContextBudget\n  ): Promise<IContextComponent[]>;\n\n  /**\n   * Optional: Get strategy-specific metrics\n   */\n  getMetrics?(): Record<string, unknown>;\n}\n","/**\n * Context Utilities - Shared functions for context management\n *\n * Extracted to avoid duplication across ContextManager and all strategies.\n */\n\nimport type { IContextComponent, ITokenEstimator } from '../types.js';\n\n/**\n * Estimate tokens for a context component.\n * Handles both string content and structured data.\n *\n * @param component - The context component to estimate\n * @param estimator - Token estimator to use\n * @returns Estimated token count\n */\nexport function estimateComponentTokens(\n  component: IContextComponent,\n  estimator: ITokenEstimator\n): number {\n  if (typeof component.content === 'string') {\n    return estimator.estimateTokens(component.content);\n  }\n  return estimator.estimateDataTokens(component.content);\n}\n\n/**\n * Sort components by priority for compaction.\n * Higher priority components are compacted first.\n * Only returns compactable components.\n *\n * @param components - Array of context components\n * @returns Sorted array of compactable components (highest priority first)\n */\nexport function sortCompactableByPriority(\n  components: IContextComponent[]\n): IContextComponent[] {\n  return components\n    .filter((c) => c.compactable)\n    .sort((a, b) => b.priority - a.priority);\n}\n\n/**\n * Find a compactor that can handle the given component.\n *\n * @param component - The component to compact\n * @param compactors - Available compactors (should be sorted by priority)\n * @returns The first matching compactor, or undefined if none found\n */\nexport function findCompactorForComponent(\n  component: IContextComponent,\n  compactors: import('../types.js').IContextCompactor[]\n): import('../types.js').IContextCompactor | undefined {\n  return compactors.find((c) => c.canCompact(component));\n}\n\n/**\n * Calculate utilization ratio for a budget.\n *\n * @param used - Tokens used\n * @param reserved - Tokens reserved\n * @param total - Total tokens available\n * @returns Utilization ratio (0-1)\n */\nexport function calculateUtilizationRatio(\n  used: number,\n  reserved: number,\n  total: number\n): number {\n  return (used + reserved) / total;\n}\n\n/**\n * Result of a compaction operation\n */\nexport interface CompactionResult {\n  /** Updated components after compaction */\n  components: IContextComponent[];\n  /** Log of compaction actions taken */\n  log: string[];\n  /** Total tokens freed */\n  tokensFreed: number;\n}\n\n/**\n * Options for the core compaction loop\n */\nexport interface CompactionLoopOptions {\n  /** Components to compact */\n  components: IContextComponent[];\n  /** Target number of tokens to free */\n  tokensToFree: number;\n  /** Available compactors */\n  compactors: import('../types.js').IContextCompactor[];\n  /** Token estimator */\n  estimator: ITokenEstimator;\n  /** Calculate target size for a component given its current size and round number */\n  calculateTargetSize: (beforeSize: number, round: number) => number;\n  /** Maximum rounds of compaction (default: 1) */\n  maxRounds?: number;\n  /** Log prefix for messages (e.g., 'Proactive', 'Aggressive') */\n  logPrefix?: string;\n}\n\n/**\n * Execute the core compaction loop.\n * This is the shared logic used by all compaction strategies.\n *\n * @param options - Compaction options\n * @returns Compaction result with updated components, log, and tokens freed\n */\nexport async function executeCompactionLoop(\n  options: CompactionLoopOptions\n): Promise<CompactionResult> {\n  const {\n    components,\n    tokensToFree,\n    compactors,\n    estimator,\n    calculateTargetSize,\n    maxRounds = 1,\n    logPrefix = '',\n  } = options;\n\n  const log: string[] = [];\n  let current = [...components];\n  let freedTokens = 0;\n  let round = 0;\n\n  // Get compactable components sorted by priority\n  const sortedComponents = sortCompactableByPriority(current);\n\n  while (freedTokens < tokensToFree && round < maxRounds) {\n    round++;\n    let roundFreed = 0;\n\n    for (const component of sortedComponents) {\n      if (freedTokens >= tokensToFree) break;\n\n      // Find compactor for this component\n      const compactor = findCompactorForComponent(component, compactors);\n      if (!compactor) continue;\n\n      // Estimate current size\n      const beforeSize = estimateComponentTokens(component, estimator);\n\n      // Calculate target size using strategy-specific logic\n      const targetSize = calculateTargetSize(beforeSize, round);\n\n      // Skip if target would be larger than current (nothing to compact)\n      if (targetSize >= beforeSize) continue;\n\n      // Compact the component\n      const compacted = await compactor.compact(component, targetSize);\n\n      // Update component in the array\n      const index = current.findIndex((c) => c.name === component.name);\n      if (index !== -1) {\n        current[index] = compacted;\n      }\n\n      // Track savings\n      const afterSize = estimateComponentTokens(compacted, estimator);\n      const saved = beforeSize - afterSize;\n      freedTokens += saved;\n      roundFreed += saved;\n\n      // Build log message\n      const prefix = logPrefix ? `${logPrefix}: ` : '';\n      const roundInfo = maxRounds > 1 ? `Round ${round}: ` : '';\n      log.push(\n        `${prefix}${roundInfo}${compactor.name} compacted \"${component.name}\" by ${saved} tokens`\n      );\n    }\n\n    // If we didn't free anything this round, stop\n    if (roundFreed === 0) break;\n  }\n\n  return { components: current, log, tokensFreed: freedTokens };\n}\n","/**\n * BaseCompactionStrategy - Abstract base class for compaction strategies\n *\n * Provides shared implementation of the compaction loop via template method pattern.\n * Concrete strategies only need to implement:\n * - shouldCompact() - when to trigger compaction\n * - calculateTargetSize() - how aggressively to compact each component\n * - getTargetUtilization() - what utilization to aim for after compaction\n */\n\nimport type {\n  IContextStrategy,\n  IContextComponent,\n  ContextBudget,\n  ContextManagerConfig,\n  IContextCompactor,\n  ITokenEstimator,\n} from '../types.js';\nimport { executeCompactionLoop, type CompactionResult } from '../utils/ContextUtils.js';\n\n/**\n * Base metrics tracked by all strategies.\n * Includes index signature to satisfy IContextStrategy.getMetrics() return type.\n */\nexport interface BaseStrategyMetrics extends Record<string, unknown> {\n  compactionCount: number;\n  totalTokensFreed: number;\n  avgTokensFreedPerCompaction: number;\n}\n\n/**\n * Abstract base class for compaction strategies.\n *\n * Uses template method pattern - subclasses implement abstract methods\n * while base class provides the common compaction loop.\n */\nexport abstract class BaseCompactionStrategy implements IContextStrategy {\n  abstract readonly name: string;\n\n  protected metrics: BaseStrategyMetrics = {\n    compactionCount: 0,\n    totalTokensFreed: 0,\n    avgTokensFreedPerCompaction: 0,\n  };\n\n  /**\n   * Determine if compaction should be triggered.\n   * Each strategy has different thresholds.\n   */\n  abstract shouldCompact(budget: ContextBudget, config: ContextManagerConfig): boolean;\n\n  /**\n   * Calculate target size for a component during compaction.\n   *\n   * @param beforeSize - Current token count of the component\n   * @param round - Current compaction round (1-based)\n   * @returns Target token count after compaction\n   */\n  abstract calculateTargetSize(beforeSize: number, round: number): number;\n\n  /**\n   * Get the target utilization ratio after compaction (0-1).\n   * Used to calculate how many tokens need to be freed.\n   */\n  abstract getTargetUtilization(): number;\n\n  /**\n   * Get the maximum number of compaction rounds.\n   * Override in subclasses for multi-round strategies.\n   */\n  protected getMaxRounds(): number {\n    return 1;\n  }\n\n  /**\n   * Get the log prefix for compaction messages.\n   * Override to customize logging.\n   */\n  protected getLogPrefix(): string {\n    return this.name.charAt(0).toUpperCase() + this.name.slice(1);\n  }\n\n  /**\n   * Compact components to fit within budget.\n   * Uses the shared compaction loop with strategy-specific target calculation.\n   */\n  async compact(\n    components: IContextComponent[],\n    budget: ContextBudget,\n    compactors: IContextCompactor[],\n    estimator: ITokenEstimator\n  ): Promise<CompactionResult> {\n    // Calculate how many tokens we need to free\n    const targetUsage = Math.floor(budget.total * this.getTargetUtilization());\n    const tokensToFree = budget.used - targetUsage;\n\n    // Execute the shared compaction loop\n    const result = await executeCompactionLoop({\n      components,\n      tokensToFree,\n      compactors,\n      estimator,\n      calculateTargetSize: this.calculateTargetSize.bind(this),\n      maxRounds: this.getMaxRounds(),\n      logPrefix: this.getLogPrefix(),\n    });\n\n    // Update metrics\n    this.updateMetrics(result.tokensFreed);\n\n    return result;\n  }\n\n  /**\n   * Update internal metrics after compaction\n   */\n  protected updateMetrics(tokensFreed: number): void {\n    this.metrics.compactionCount++;\n    this.metrics.totalTokensFreed += tokensFreed;\n    this.metrics.avgTokensFreedPerCompaction =\n      this.metrics.totalTokensFreed / this.metrics.compactionCount;\n  }\n\n  /**\n   * Get strategy metrics\n   */\n  getMetrics(): BaseStrategyMetrics {\n    return { ...this.metrics };\n  }\n\n  /**\n   * Reset metrics (useful for testing)\n   */\n  resetMetrics(): void {\n    this.metrics = {\n      compactionCount: 0,\n      totalTokensFreed: 0,\n      avgTokensFreedPerCompaction: 0,\n    };\n  }\n}\n","/**\n * Core Constants - Centralized configuration defaults\n *\n * This file provides a single source of truth for all default values\n * used throughout the framework. Import from here instead of hardcoding.\n */\n\n// ============ Task Execution Defaults ============\n\n/**\n * Default task execution settings\n */\nexport const TASK_DEFAULTS = {\n  /** Default timeout for task execution in milliseconds (5 minutes) */\n  TIMEOUT_MS: 300_000,\n\n  /** Maximum retry attempts for failed tasks */\n  MAX_RETRIES: 3,\n\n  /** Default delay between retries in milliseconds */\n  RETRY_DELAY_MS: 1_000,\n\n  /** Maximum consecutive errors before stopping */\n  MAX_CONSECUTIVE_ERRORS: 3,\n} as const;\n\n// ============ Context Management Defaults ============\n\n/**\n * Default context management settings\n */\nexport const CONTEXT_DEFAULTS = {\n  /** Default maximum context tokens (128K) */\n  MAX_TOKENS: 128_000,\n\n  /** Reserve percentage for response generation (15%) */\n  RESPONSE_RESERVE: 0.15,\n\n  /** Threshold to trigger compaction warning (75%) */\n  COMPACTION_THRESHOLD: 0.75,\n\n  /** Hard limit before forced compaction (90%) */\n  HARD_LIMIT: 0.90,\n} as const;\n\n// ============ Strategy Defaults ============\n\n/**\n * Proactive strategy configuration\n */\nexport const PROACTIVE_STRATEGY_DEFAULTS = {\n  /** Target utilization after compaction */\n  TARGET_UTILIZATION: 0.65,\n\n  /** Base reduction factor for round 1 */\n  BASE_REDUCTION_FACTOR: 0.50,\n\n  /** Reduction step per round (more aggressive each round) */\n  REDUCTION_STEP: 0.15,\n\n  /** Maximum compaction rounds */\n  MAX_ROUNDS: 3,\n} as const;\n\n/**\n * Aggressive strategy configuration\n */\nexport const AGGRESSIVE_STRATEGY_DEFAULTS = {\n  /** Threshold to trigger compaction */\n  THRESHOLD: 0.60,\n\n  /** Target utilization after compaction */\n  TARGET_UTILIZATION: 0.50,\n\n  /** Reduction factor (keep 30% of original) */\n  REDUCTION_FACTOR: 0.30,\n} as const;\n\n/**\n * Lazy strategy configuration\n */\nexport const LAZY_STRATEGY_DEFAULTS = {\n  /** Target utilization after compaction */\n  TARGET_UTILIZATION: 0.85,\n\n  /** Reduction factor (keep 70% of original) */\n  REDUCTION_FACTOR: 0.70,\n} as const;\n\n/**\n * Adaptive strategy configuration\n */\nexport const ADAPTIVE_STRATEGY_DEFAULTS = {\n  /** Number of compactions to learn from */\n  LEARNING_WINDOW: 10,\n\n  /** Compactions per minute threshold to switch to aggressive */\n  SWITCH_THRESHOLD: 5,\n\n  /** Low utilization threshold to switch to lazy */\n  LOW_UTILIZATION_THRESHOLD: 70,\n\n  /** Low frequency threshold to switch to lazy */\n  LOW_FREQUENCY_THRESHOLD: 0.5,\n} as const;\n\n/**\n * Rolling window strategy configuration\n */\nexport const ROLLING_WINDOW_DEFAULTS = {\n  /** Default maximum messages to keep */\n  MAX_MESSAGES: 20,\n} as const;\n\n// ============ Memory Defaults ============\n\n/**\n * Working memory configuration\n */\nexport const MEMORY_DEFAULTS = {\n  /** Default maximum memory size in bytes (25MB) */\n  MAX_SIZE_BYTES: 25 * 1024 * 1024,\n\n  /** Soft limit percentage to trigger warnings */\n  SOFT_LIMIT_PERCENT: 80,\n\n  /** Default eviction count when memory is full */\n  DEFAULT_EVICTION_COUNT: 5,\n} as const;\n\n// ============ Session Defaults ============\n\n/**\n * Session management configuration\n */\nexport const SESSION_DEFAULTS = {\n  /** Default auto-save interval in milliseconds (30 seconds) */\n  AUTO_SAVE_INTERVAL_MS: 30_000,\n\n  /** Maximum session age before cleanup (24 hours) */\n  MAX_SESSION_AGE_MS: 86_400_000,\n} as const;\n\n// ============ Agent Defaults ============\n\n/**\n * Agent execution configuration\n */\nexport const AGENT_DEFAULTS = {\n  /** Default maximum iterations for agentic loop */\n  MAX_ITERATIONS: 10,\n\n  /** Default temperature for LLM calls */\n  DEFAULT_TEMPERATURE: 0.7,\n} as const;\n\n// ============ Circuit Breaker Defaults ============\n\n/**\n * Circuit breaker configuration\n */\nexport const CIRCUIT_BREAKER_DEFAULTS = {\n  /** Failures before opening circuit */\n  FAILURE_THRESHOLD: 5,\n\n  /** Successes in half-open before closing */\n  SUCCESS_THRESHOLD: 2,\n\n  /** Time before trying half-open (1 minute) */\n  RESET_TIMEOUT_MS: 60_000,\n\n  /** Window for tracking failures (5 minutes) */\n  WINDOW_MS: 300_000,\n} as const;\n\n// ============ History Defaults ============\n\n/**\n * Conversation history configuration\n */\nexport const HISTORY_DEFAULTS = {\n  /** Maximum messages to keep in history */\n  MAX_MESSAGES: 50,\n\n  /** Preserve this many recent messages during compaction */\n  PRESERVE_RECENT_COUNT: 10,\n\n  /** Default compaction strategy */\n  COMPACTION_STRATEGY: 'sliding-window' as const,\n} as const;\n\n// ============ Token Estimation ============\n\n/**\n * Token estimation ratios (characters per token)\n */\nexport const TOKEN_ESTIMATION = {\n  /** Characters per token for code */\n  CODE_CHARS_PER_TOKEN: 3,\n\n  /** Characters per token for prose */\n  PROSE_CHARS_PER_TOKEN: 4,\n\n  /** Characters per token for mixed content */\n  MIXED_CHARS_PER_TOKEN: 3.5,\n\n  /** Default characters per token */\n  DEFAULT_CHARS_PER_TOKEN: 4,\n} as const;\n","/**\n * Proactive Compaction Strategy\n *\n * - Monitors context budget continuously\n * - Compacts proactively when reaching warning/critical threshold\n * - Uses multi-round compaction with increasing aggressiveness\n * - Follows priority-based compaction order\n *\n * Good for: General purpose, balanced approach\n */\n\nimport type { ContextBudget, ContextManagerConfig } from '../types.js';\nimport { BaseCompactionStrategy } from './BaseCompactionStrategy.js';\nimport { PROACTIVE_STRATEGY_DEFAULTS } from '../../constants.js';\n\n/**\n * Options for ProactiveCompactionStrategy\n */\nexport interface ProactiveStrategyOptions {\n  /** Target utilization after compaction (default: 0.65) */\n  targetUtilization?: number;\n  /** Base reduction factor for round 1 (default: 0.50) */\n  baseReductionFactor?: number;\n  /** Reduction step per round (default: 0.15) */\n  reductionStep?: number;\n  /** Maximum compaction rounds (default: 3) */\n  maxRounds?: number;\n}\n\n/**\n * Default options for proactive strategy (from centralized constants)\n */\nconst DEFAULT_OPTIONS: Required<ProactiveStrategyOptions> = {\n  targetUtilization: PROACTIVE_STRATEGY_DEFAULTS.TARGET_UTILIZATION,\n  baseReductionFactor: PROACTIVE_STRATEGY_DEFAULTS.BASE_REDUCTION_FACTOR,\n  reductionStep: PROACTIVE_STRATEGY_DEFAULTS.REDUCTION_STEP,\n  maxRounds: PROACTIVE_STRATEGY_DEFAULTS.MAX_ROUNDS,\n};\n\nexport class ProactiveCompactionStrategy extends BaseCompactionStrategy {\n  readonly name = 'proactive';\n  private options: Required<ProactiveStrategyOptions>;\n\n  constructor(options: ProactiveStrategyOptions = {}) {\n    super();\n    this.options = { ...DEFAULT_OPTIONS, ...options };\n  }\n\n  shouldCompact(budget: ContextBudget, _config: ContextManagerConfig): boolean {\n    // Compact when we hit warning or critical\n    return budget.status === 'warning' || budget.status === 'critical';\n  }\n\n  calculateTargetSize(beforeSize: number, round: number): number {\n    // More aggressive in later rounds: 50%, 35%, 20%\n    const reductionFactor =\n      this.options.baseReductionFactor - (round - 1) * this.options.reductionStep;\n    return Math.floor(beforeSize * Math.max(reductionFactor, 0.1)); // Never below 10%\n  }\n\n  getTargetUtilization(): number {\n    return this.options.targetUtilization;\n  }\n\n  protected getMaxRounds(): number {\n    return this.options.maxRounds;\n  }\n\n  protected getLogPrefix(): string {\n    return 'Proactive';\n  }\n}\n","/**\n * Aggressive Compaction Strategy\n *\n * - Compacts earlier (60% threshold instead of 75%)\n * - Targets lower usage (50% instead of 65%)\n * - More aggressive per-component reduction (30%)\n * - Single-round compaction\n *\n * Good for: Long-running agents, constrained context windows\n */\n\nimport type { ContextBudget, ContextManagerConfig } from '../types.js';\nimport { BaseCompactionStrategy } from './BaseCompactionStrategy.js';\nimport { AGGRESSIVE_STRATEGY_DEFAULTS } from '../../constants.js';\n\n/**\n * Options for AggressiveCompactionStrategy\n */\nexport interface AggressiveStrategyOptions {\n  /** Threshold to trigger compaction (default: 0.60) */\n  threshold?: number;\n  /** Target utilization after compaction (default: 0.50) */\n  targetUtilization?: number;\n  /** Reduction factor - target this fraction of original size (default: 0.30) */\n  reductionFactor?: number;\n}\n\n/**\n * Default options for aggressive strategy (from centralized constants)\n */\nconst DEFAULT_OPTIONS: Required<AggressiveStrategyOptions> = {\n  threshold: AGGRESSIVE_STRATEGY_DEFAULTS.THRESHOLD,\n  targetUtilization: AGGRESSIVE_STRATEGY_DEFAULTS.TARGET_UTILIZATION,\n  reductionFactor: AGGRESSIVE_STRATEGY_DEFAULTS.REDUCTION_FACTOR,\n};\n\nexport class AggressiveCompactionStrategy extends BaseCompactionStrategy {\n  readonly name = 'aggressive';\n  private options: Required<AggressiveStrategyOptions>;\n\n  constructor(options: AggressiveStrategyOptions = {}) {\n    super();\n    this.options = { ...DEFAULT_OPTIONS, ...options };\n  }\n\n  shouldCompact(budget: ContextBudget, _config: ContextManagerConfig): boolean {\n    const utilizationRatio = (budget.used + budget.reserved) / budget.total;\n    return utilizationRatio >= this.options.threshold;\n  }\n\n  calculateTargetSize(beforeSize: number, _round: number): number {\n    // Aggressive: target 30% of original size\n    return Math.floor(beforeSize * this.options.reductionFactor);\n  }\n\n  getTargetUtilization(): number {\n    return this.options.targetUtilization;\n  }\n\n  protected getLogPrefix(): string {\n    return 'Aggressive';\n  }\n}\n","/**\n * Lazy Compaction Strategy\n *\n * - Only compacts when absolutely necessary (critical status)\n * - Minimal compaction (just enough to fit, targets 85%)\n * - Preserves as much context as possible (70% reduction factor)\n * - Single-round compaction\n *\n * Good for: High-context models, short conversations, when context preservation is critical\n */\n\nimport type { ContextBudget, ContextManagerConfig } from '../types.js';\nimport { BaseCompactionStrategy } from './BaseCompactionStrategy.js';\nimport { LAZY_STRATEGY_DEFAULTS } from '../../constants.js';\n\n/**\n * Options for LazyCompactionStrategy\n */\nexport interface LazyStrategyOptions {\n  /** Target utilization after compaction (default: 0.85) */\n  targetUtilization?: number;\n  /** Reduction factor - target this fraction of original size (default: 0.70) */\n  reductionFactor?: number;\n}\n\n/**\n * Default options for lazy strategy (from centralized constants)\n */\nconst DEFAULT_OPTIONS: Required<LazyStrategyOptions> = {\n  targetUtilization: LAZY_STRATEGY_DEFAULTS.TARGET_UTILIZATION,\n  reductionFactor: LAZY_STRATEGY_DEFAULTS.REDUCTION_FACTOR,\n};\n\nexport class LazyCompactionStrategy extends BaseCompactionStrategy {\n  readonly name = 'lazy';\n  private options: Required<LazyStrategyOptions>;\n\n  constructor(options: LazyStrategyOptions = {}) {\n    super();\n    this.options = { ...DEFAULT_OPTIONS, ...options };\n  }\n\n  shouldCompact(budget: ContextBudget, _config: ContextManagerConfig): boolean {\n    // Only compact when critical\n    return budget.status === 'critical';\n  }\n\n  calculateTargetSize(beforeSize: number, _round: number): number {\n    // Minimal reduction: 70% of original\n    return Math.floor(beforeSize * this.options.reductionFactor);\n  }\n\n  getTargetUtilization(): number {\n    return this.options.targetUtilization;\n  }\n\n  protected getLogPrefix(): string {\n    return 'Lazy';\n  }\n}\n","/**\n * Rolling Window Strategy\n *\n * - Maintains fixed-size window of recent context\n * - No compaction needed - just drops old items\n * - Very fast and predictable\n * - Good for: Real-time agents, streaming conversations\n */\n\nimport type {\n  IContextStrategy,\n  IContextComponent,\n  ContextBudget,\n  ContextManagerConfig,\n} from '../types.js';\nimport { ROLLING_WINDOW_DEFAULTS } from '../../constants.js';\n\nexport interface RollingWindowOptions {\n  /** Maximum number of messages to keep */\n  maxMessages?: number;\n  /** Maximum tokens per component */\n  maxTokensPerComponent?: number;\n}\n\nexport class RollingWindowStrategy implements IContextStrategy {\n  readonly name = 'rolling-window';\n\n  constructor(private options: RollingWindowOptions = {}) {}\n\n  shouldCompact(_budget: ContextBudget, _config: ContextManagerConfig): boolean {\n    // Never compact - we handle it in prepareComponents\n    return false;\n  }\n\n  async prepareComponents(components: IContextComponent[]): Promise<IContextComponent[]> {\n    return components.map((component) => {\n      // Apply rolling window to array components (e.g., conversation history)\n      if (Array.isArray(component.content)) {\n        const maxMessages = this.options.maxMessages ?? ROLLING_WINDOW_DEFAULTS.MAX_MESSAGES;\n        if (component.content.length > maxMessages) {\n          return {\n            ...component,\n            content: component.content.slice(-maxMessages),\n            metadata: {\n              ...component.metadata,\n              windowed: true,\n              originalLength: component.content.length,\n              keptLength: maxMessages,\n            },\n          };\n        }\n      }\n\n      return component;\n    });\n  }\n\n  async compact(): Promise<{ components: IContextComponent[]; log: string[]; tokensFreed: number }> {\n    // Should never be called since shouldCompact returns false\n    return { components: [], log: [], tokensFreed: 0 };\n  }\n}\n","/**\n * Adaptive Strategy\n *\n * - Learns from usage patterns\n * - Adjusts thresholds based on observed behavior\n * - Switches between strategies dynamically\n * - Good for: Production systems, varied workloads\n */\n\nimport type {\n  IContextStrategy,\n  IContextComponent,\n  ContextBudget,\n  ContextManagerConfig,\n  IContextCompactor,\n  ITokenEstimator,\n} from '../types.js';\nimport { ProactiveCompactionStrategy } from './ProactiveStrategy.js';\nimport { AggressiveCompactionStrategy } from './AggressiveStrategy.js';\nimport { LazyCompactionStrategy } from './LazyStrategy.js';\nimport { ADAPTIVE_STRATEGY_DEFAULTS } from '../../constants.js';\n\nexport interface AdaptiveStrategyOptions {\n  /** Number of compactions to learn from (default: 10) */\n  learningWindow?: number;\n  /** Compactions per minute threshold to switch to aggressive (default: 5) */\n  switchThreshold?: number;\n}\n\nexport class AdaptiveStrategy implements IContextStrategy {\n  readonly name = 'adaptive';\n\n  private currentStrategy: IContextStrategy;\n  private metrics = {\n    avgUtilization: 0,\n    compactionFrequency: 0,\n    lastCompactions: [] as number[],\n  };\n\n  constructor(private options: AdaptiveStrategyOptions = {}) {\n    // Start with proactive\n    this.currentStrategy = new ProactiveCompactionStrategy();\n  }\n\n  shouldCompact(budget: ContextBudget, config: ContextManagerConfig): boolean {\n    // Update metrics\n    this.updateMetrics(budget);\n\n    // Decide if we should switch strategies\n    this.maybeAdapt();\n\n    // Delegate to current strategy\n    return this.currentStrategy.shouldCompact(budget, config);\n  }\n\n  async compact(\n    components: IContextComponent[],\n    budget: ContextBudget,\n    compactors: IContextCompactor[],\n    estimator: ITokenEstimator\n  ): Promise<{ components: IContextComponent[]; log: string[]; tokensFreed: number }> {\n    const result = await this.currentStrategy.compact(components, budget, compactors, estimator);\n\n    // Track compaction\n    this.metrics.lastCompactions.push(Date.now());\n    const window = this.options.learningWindow ?? ADAPTIVE_STRATEGY_DEFAULTS.LEARNING_WINDOW;\n    if (this.metrics.lastCompactions.length > window) {\n      this.metrics.lastCompactions.shift();\n    }\n\n    return {\n      ...result,\n      log: [`[Adaptive: using ${this.currentStrategy.name}]`, ...result.log],\n    };\n  }\n\n  private updateMetrics(budget: ContextBudget): void {\n    // Track average utilization using exponential moving average\n    const alpha = 0.1; // EMA factor\n    this.metrics.avgUtilization =\n      alpha * budget.utilizationPercent + (1 - alpha) * this.metrics.avgUtilization;\n  }\n\n  private maybeAdapt(): void {\n    const now = Date.now();\n\n    // Calculate compaction frequency (compactions per minute)\n    if (this.metrics.lastCompactions.length >= 2) {\n      const firstCompaction = this.metrics.lastCompactions[0];\n      if (firstCompaction !== undefined) {\n        const timeSpan = now - firstCompaction;\n        this.metrics.compactionFrequency =\n          (this.metrics.lastCompactions.length / timeSpan) * 60000; // per minute\n      }\n    }\n\n    // Adapt based on patterns\n    const threshold = this.options.switchThreshold ?? ADAPTIVE_STRATEGY_DEFAULTS.SWITCH_THRESHOLD;\n\n    if (this.metrics.compactionFrequency > threshold) {\n      // Too frequent - switch to aggressive\n      if (this.currentStrategy.name !== 'aggressive') {\n        this.currentStrategy = new AggressiveCompactionStrategy();\n      }\n    } else if (\n      this.metrics.compactionFrequency < ADAPTIVE_STRATEGY_DEFAULTS.LOW_FREQUENCY_THRESHOLD &&\n      this.metrics.avgUtilization < ADAPTIVE_STRATEGY_DEFAULTS.LOW_UTILIZATION_THRESHOLD\n    ) {\n      // Rare compactions and low utilization - switch to lazy\n      if (this.currentStrategy.name !== 'lazy') {\n        this.currentStrategy = new LazyCompactionStrategy();\n      }\n    } else {\n      // Normal - use proactive\n      if (this.currentStrategy.name !== 'proactive') {\n        this.currentStrategy = new ProactiveCompactionStrategy();\n      }\n    }\n  }\n\n  getMetrics() {\n    return {\n      ...this.metrics,\n      currentStrategy: this.currentStrategy.name,\n    };\n  }\n}\n","/**\n * Context management strategies\n */\n\nimport type { IContextStrategy } from '../types.js';\nimport { ProactiveCompactionStrategy, type ProactiveStrategyOptions } from './ProactiveStrategy.js';\nimport { AggressiveCompactionStrategy, type AggressiveStrategyOptions } from './AggressiveStrategy.js';\nimport { LazyCompactionStrategy, type LazyStrategyOptions } from './LazyStrategy.js';\nimport { RollingWindowStrategy, type RollingWindowOptions } from './RollingWindowStrategy.js';\nimport { AdaptiveStrategy, type AdaptiveStrategyOptions } from './AdaptiveStrategy.js';\n\n/**\n * Union type of all strategy options\n */\nexport type StrategyOptions =\n  | ProactiveStrategyOptions\n  | AggressiveStrategyOptions\n  | LazyStrategyOptions\n  | RollingWindowOptions\n  | AdaptiveStrategyOptions;\n\n/**\n * Strategy factory - creates a strategy by name with options\n *\n * @param name - Strategy name\n * @param options - Strategy-specific options\n * @returns Configured strategy instance\n */\nexport function createStrategy(\n  name: string,\n  options: Record<string, unknown> = {}\n): IContextStrategy {\n  switch (name) {\n    case 'proactive':\n      return new ProactiveCompactionStrategy(options as ProactiveStrategyOptions);\n    case 'aggressive':\n      return new AggressiveCompactionStrategy(options as AggressiveStrategyOptions);\n    case 'lazy':\n      return new LazyCompactionStrategy(options as LazyStrategyOptions);\n    case 'rolling-window':\n      return new RollingWindowStrategy(options as RollingWindowOptions);\n    case 'adaptive':\n      return new AdaptiveStrategy(options as AdaptiveStrategyOptions);\n    default:\n      throw new Error(`Unknown context strategy: ${name}`);\n  }\n}\n\n// Export base class\nexport { BaseCompactionStrategy, type BaseStrategyMetrics } from './BaseCompactionStrategy.js';\n\n// Export strategy classes\nexport { ProactiveCompactionStrategy } from './ProactiveStrategy.js';\nexport { AggressiveCompactionStrategy } from './AggressiveStrategy.js';\nexport { LazyCompactionStrategy } from './LazyStrategy.js';\nexport { RollingWindowStrategy } from './RollingWindowStrategy.js';\nexport { AdaptiveStrategy } from './AdaptiveStrategy.js';\n\n// Export strategy option types\nexport type { ProactiveStrategyOptions } from './ProactiveStrategy.js';\nexport type { AggressiveStrategyOptions } from './AggressiveStrategy.js';\nexport type { LazyStrategyOptions } from './LazyStrategy.js';\nexport type { RollingWindowOptions } from './RollingWindowStrategy.js';\nexport type { AdaptiveStrategyOptions } from './AdaptiveStrategy.js';\n","/**\n * Supported AI Vendors\n *\n * Use this enum instead of string literals for type safety.\n * These map to specific provider implementations.\n */\nexport const Vendor = {\n  OpenAI: 'openai',\n  Anthropic: 'anthropic',\n  Google: 'google',\n  GoogleVertex: 'google-vertex',\n  Groq: 'groq',\n  Together: 'together',\n  Perplexity: 'perplexity',\n  Grok: 'grok',\n  DeepSeek: 'deepseek',\n  Mistral: 'mistral',\n  Ollama: 'ollama',\n  Custom: 'custom', // OpenAI-compatible endpoint\n} as const;\n\nexport type Vendor = (typeof Vendor)[keyof typeof Vendor];\n\n/**\n * All vendor values as array (useful for validation)\n */\nexport const VENDORS = Object.values(Vendor);\n\n/**\n * Check if a string is a valid vendor\n */\nexport function isVendor(value: string): value is Vendor {\n  return VENDORS.includes(value as Vendor);\n}\n","import { Vendor } from '../../core/Vendor.js';\nimport type { Vendor as VendorType } from '../../core/Vendor.js';\n\n/**\n * Complete description of an LLM model including capabilities, pricing, and features\n */\nexport interface ILLMDescription {\n  /** Model identifier (e.g., \"gpt-5.2-instant\") */\n  name: string;\n\n  /** Vendor/provider (Vendor.OpenAI, Vendor.Anthropic, etc.) */\n  provider: string;\n\n  /** Optional description of the model */\n  description?: string;\n\n  /** Whether the model is currently available for use */\n  isActive: boolean;\n\n  /** Release date (YYYY-MM-DD format) */\n  releaseDate?: string;\n\n  /** Knowledge cutoff date */\n  knowledgeCutoff?: string;\n\n  /** Model capabilities and pricing */\n  features: {\n    /** Supports extended reasoning/thinking */\n    reasoning?: boolean;\n\n    /** Supports streaming responses */\n    streaming: boolean;\n\n    /** Supports structured output (JSON mode) */\n    structuredOutput?: boolean;\n\n    /** Supports function/tool calling */\n    functionCalling?: boolean;\n\n    /** Supports fine-tuning */\n    fineTuning?: boolean;\n\n    /** Supports predicted outputs */\n    predictedOutputs?: boolean;\n\n    /** Supports realtime API */\n    realtime?: boolean;\n\n    /** Supports image input (vision) */\n    vision?: boolean;\n\n    /** Supports audio input/output */\n    audio?: boolean;\n\n    /** Supports video input */\n    video?: boolean;\n\n    /** Supports extended thinking (Claude-specific) */\n    extendedThinking?: boolean;\n\n    /** Supports batch API */\n    batchAPI?: boolean;\n\n    /** Supports prompt caching */\n    promptCaching?: boolean;\n\n    /** Parameter support - indicates which sampling parameters are supported */\n    parameters?: {\n      /** Supports temperature parameter */\n      temperature?: boolean;\n      /** Supports top_p parameter */\n      topP?: boolean;\n      /** Supports frequency_penalty parameter */\n      frequencyPenalty?: boolean;\n      /** Supports presence_penalty parameter */\n      presencePenalty?: boolean;\n    };\n\n    /** Input specifications */\n    input: {\n      /** Maximum input context window (in tokens) */\n      tokens: number;\n\n      /** Supports text input */\n      text: boolean;\n\n      /** Supports image input */\n      image?: boolean;\n\n      /** Supports audio input */\n      audio?: boolean;\n\n      /** Supports video input */\n      video?: boolean;\n\n      /** Cost per million tokens (input) */\n      cpm: number;\n\n      /** Cost per million cached tokens (if prompt caching supported) */\n      cpmCached?: number;\n    };\n\n    /** Output specifications */\n    output: {\n      /** Maximum output tokens */\n      tokens: number;\n\n      /** Supports text output */\n      text: boolean;\n\n      /** Supports image output */\n      image?: boolean;\n\n      /** Supports audio output */\n      audio?: boolean;\n\n      /** Cost per million tokens (output) */\n      cpm: number;\n    };\n  };\n}\n\n/**\n * Model name constants organized by vendor\n * Updated: January 2026 - Contains only verified, currently available models\n */\nexport const LLM_MODELS = {\n  [Vendor.OpenAI]: {\n    // GPT-5.2 Series (Current Flagship)\n    GPT_5_2: 'gpt-5.2',\n    GPT_5_2_PRO: 'gpt-5.2-pro',\n    // GPT-5 Series\n    GPT_5: 'gpt-5',\n    GPT_5_MINI: 'gpt-5-mini',\n    GPT_5_NANO: 'gpt-5-nano',\n    // GPT-4.1 Series\n    GPT_4_1: 'gpt-4.1',\n    GPT_4_1_MINI: 'gpt-4.1-mini',\n    GPT_4_1_NANO: 'gpt-4.1-nano',\n    // GPT-4o Series (Legacy, Audio Capable)\n    GPT_4O: 'gpt-4o',\n    GPT_4O_MINI: 'gpt-4o-mini',\n    // Reasoning Models (o-series)\n    O3_MINI: 'o3-mini',\n    O1: 'o1',\n  },\n  [Vendor.Anthropic]: {\n    // Claude 4.5 Series (Current)\n    CLAUDE_OPUS_4_5: 'claude-opus-4-5-20251101',\n    CLAUDE_SONNET_4_5: 'claude-sonnet-4-5-20250929',\n    CLAUDE_HAIKU_4_5: 'claude-haiku-4-5-20251001',\n    // Claude 4.x Legacy\n    CLAUDE_OPUS_4_1: 'claude-opus-4-1-20250805',\n    CLAUDE_SONNET_4: 'claude-sonnet-4-20250514',\n    CLAUDE_SONNET_3_7: 'claude-3-7-sonnet-20250219',\n    // Claude 3.x Legacy\n    CLAUDE_HAIKU_3: 'claude-3-haiku-20240307',\n  },\n  [Vendor.Google]: {\n    // Gemini 3 Series (Preview)\n    GEMINI_3_FLASH_PREVIEW: 'gemini-3-flash-preview',\n    GEMINI_3_PRO_PREVIEW: 'gemini-3-pro-preview',\n    GEMINI_3_PRO_IMAGE_PREVIEW: 'gemini-3-pro-image-preview',\n    // Gemini 2.5 Series (Production)\n    GEMINI_2_5_PRO: 'gemini-2.5-pro',\n    GEMINI_2_5_FLASH: 'gemini-2.5-flash',\n    GEMINI_2_5_FLASH_LITE: 'gemini-2.5-flash-lite',\n    GEMINI_2_5_FLASH_IMAGE: 'gemini-2.5-flash-image',\n  },\n} as const;\n\n/**\n * Complete model registry with all model metadata\n * Updated: January 2026 - Verified from official vendor documentation\n */\nexport const MODEL_REGISTRY: Record<string, ILLMDescription> = {\n  // ============================================================================\n  // OpenAI Models (Verified from platform.openai.com)\n  // ============================================================================\n\n  // GPT-5.2 Series (Current Flagship)\n  'gpt-5.2': {\n    name: 'gpt-5.2',\n    provider: Vendor.OpenAI,\n    description: 'Flagship model for coding and agentic tasks. Reasoning.effort: none, low, medium, high, xhigh',\n    isActive: true,\n    releaseDate: '2025-12-01',\n    knowledgeCutoff: '2025-08-31',\n    features: {\n      reasoning: true,\n      streaming: true,\n      structuredOutput: true,\n      functionCalling: true,\n      fineTuning: false,\n      predictedOutputs: false,\n      realtime: false,\n      vision: true,\n      audio: false,\n      video: false,\n      batchAPI: true,\n      promptCaching: true,\n      parameters: {\n        temperature: false,\n        topP: false,\n        frequencyPenalty: false,\n        presencePenalty: false,\n      },\n      input: {\n        tokens: 400000,\n        text: true,\n        image: true,\n        cpm: 1.75,\n      },\n      output: {\n        tokens: 128000,\n        text: true,\n        cpm: 14,\n      },\n    },\n  },\n\n  'gpt-5.2-pro': {\n    name: 'gpt-5.2-pro',\n    provider: Vendor.OpenAI,\n    description: 'GPT-5.2 pro produces smarter and more precise responses. Reasoning.effort: medium, high, xhigh',\n    isActive: true,\n    releaseDate: '2025-12-01',\n    knowledgeCutoff: '2025-08-31',\n    features: {\n      reasoning: true,\n      streaming: true,\n      structuredOutput: true,\n      functionCalling: true,\n      fineTuning: false,\n      predictedOutputs: false,\n      realtime: false,\n      vision: true,\n      audio: false,\n      video: false,\n      batchAPI: true,\n      promptCaching: true,\n      parameters: {\n        temperature: false,\n        topP: false,\n        frequencyPenalty: false,\n        presencePenalty: false,\n      },\n      input: {\n        tokens: 400000,\n        text: true,\n        image: true,\n        cpm: 21,\n      },\n      output: {\n        tokens: 128000,\n        text: true,\n        cpm: 168,\n      },\n    },\n  },\n\n  // GPT-5 Series\n  'gpt-5': {\n    name: 'gpt-5',\n    provider: Vendor.OpenAI,\n    description: 'Previous intelligent reasoning model for coding and agentic tasks. Reasoning.effort: minimal, low, medium, high',\n    isActive: true,\n    releaseDate: '2025-08-01',\n    knowledgeCutoff: '2024-09-30',\n    features: {\n      reasoning: true,\n      streaming: true,\n      structuredOutput: true,\n      functionCalling: true,\n      fineTuning: false,\n      predictedOutputs: false,\n      realtime: false,\n      vision: true,\n      audio: false,\n      video: false,\n      batchAPI: true,\n      promptCaching: true,\n      parameters: {\n        temperature: false,\n        topP: false,\n        frequencyPenalty: false,\n        presencePenalty: false,\n      },\n      input: {\n        tokens: 400000,\n        text: true,\n        image: true,\n        cpm: 1.25,\n      },\n      output: {\n        tokens: 128000,\n        text: true,\n        cpm: 10,\n      },\n    },\n  },\n\n  'gpt-5-mini': {\n    name: 'gpt-5-mini',\n    provider: Vendor.OpenAI,\n    description: 'Faster, cost-efficient version of GPT-5 for well-defined tasks and precise prompts',\n    isActive: true,\n    releaseDate: '2025-08-01',\n    knowledgeCutoff: '2024-05-31',\n    features: {\n      reasoning: true,\n      streaming: true,\n      structuredOutput: true,\n      functionCalling: true,\n      fineTuning: false,\n      predictedOutputs: false,\n      realtime: false,\n      vision: true,\n      audio: false,\n      video: false,\n      batchAPI: true,\n      promptCaching: true,\n      parameters: {\n        temperature: false,\n        topP: false,\n        frequencyPenalty: false,\n        presencePenalty: false,\n      },\n      input: {\n        tokens: 400000,\n        text: true,\n        image: true,\n        cpm: 0.25,\n      },\n      output: {\n        tokens: 128000,\n        text: true,\n        cpm: 2,\n      },\n    },\n  },\n\n  'gpt-5-nano': {\n    name: 'gpt-5-nano',\n    provider: Vendor.OpenAI,\n    description: 'Fastest, most cost-efficient GPT-5. Great for summarization and classification tasks',\n    isActive: true,\n    releaseDate: '2025-08-01',\n    knowledgeCutoff: '2024-05-31',\n    features: {\n      reasoning: true,\n      streaming: true,\n      structuredOutput: true,\n      functionCalling: true,\n      fineTuning: false,\n      predictedOutputs: false,\n      realtime: false,\n      vision: true,\n      audio: false,\n      video: false,\n      batchAPI: true,\n      promptCaching: true,\n      parameters: {\n        temperature: false,\n        topP: false,\n        frequencyPenalty: false,\n        presencePenalty: false,\n      },\n      input: {\n        tokens: 400000,\n        text: true,\n        image: true,\n        cpm: 0.05,\n      },\n      output: {\n        tokens: 128000,\n        text: true,\n        cpm: 0.4,\n      },\n    },\n  },\n\n  // GPT-4.1 Series\n  'gpt-4.1': {\n    name: 'gpt-4.1',\n    provider: Vendor.OpenAI,\n    description: 'GPT-4.1 specialized for coding with 1M token context window',\n    isActive: true,\n    releaseDate: '2025-04-14',\n    knowledgeCutoff: '2025-04-01',\n    features: {\n      reasoning: false,\n      streaming: true,\n      structuredOutput: true,\n      functionCalling: true,\n      fineTuning: false,\n      predictedOutputs: false,\n      realtime: false,\n      vision: true,\n      audio: false,\n      video: false,\n      batchAPI: true,\n      promptCaching: true,\n      input: {\n        tokens: 1000000,\n        text: true,\n        image: true,\n        cpm: 2,\n      },\n      output: {\n        tokens: 32768,\n        text: true,\n        cpm: 8,\n      },\n    },\n  },\n\n  'gpt-4.1-mini': {\n    name: 'gpt-4.1-mini',\n    provider: Vendor.OpenAI,\n    description: 'Efficient GPT-4.1 model, beats GPT-4o in many benchmarks at 83% lower cost',\n    isActive: true,\n    releaseDate: '2025-04-14',\n    knowledgeCutoff: '2025-04-01',\n    features: {\n      reasoning: false,\n      streaming: true,\n      structuredOutput: true,\n      functionCalling: true,\n      fineTuning: false,\n      predictedOutputs: false,\n      realtime: false,\n      vision: true,\n      audio: false,\n      video: false,\n      batchAPI: true,\n      promptCaching: true,\n      input: {\n        tokens: 1000000,\n        text: true,\n        image: true,\n        cpm: 0.4,\n      },\n      output: {\n        tokens: 16384,\n        text: true,\n        cpm: 1.6,\n      },\n    },\n  },\n\n  'gpt-4.1-nano': {\n    name: 'gpt-4.1-nano',\n    provider: Vendor.OpenAI,\n    description: 'Fastest and cheapest model with 1M context. 80.1% MMLU, ideal for classification/autocompletion',\n    isActive: true,\n    releaseDate: '2025-04-14',\n    knowledgeCutoff: '2025-04-01',\n    features: {\n      reasoning: false,\n      streaming: true,\n      structuredOutput: true,\n      functionCalling: true,\n      fineTuning: false,\n      predictedOutputs: false,\n      realtime: false,\n      vision: true,\n      audio: false,\n      video: false,\n      batchAPI: true,\n      promptCaching: true,\n      input: {\n        tokens: 1000000,\n        text: true,\n        image: true,\n        cpm: 0.1,\n      },\n      output: {\n        tokens: 16384,\n        text: true,\n        cpm: 0.4,\n      },\n    },\n  },\n\n  // GPT-4o Series (Legacy, Audio Capable)\n  'gpt-4o': {\n    name: 'gpt-4o',\n    provider: Vendor.OpenAI,\n    description: 'Versatile omni model with audio support. Legacy but still available',\n    isActive: true,\n    releaseDate: '2024-05-13',\n    knowledgeCutoff: '2024-04-01',\n    features: {\n      reasoning: false,\n      streaming: true,\n      structuredOutput: true,\n      functionCalling: true,\n      fineTuning: false,\n      predictedOutputs: true,\n      realtime: true,\n      vision: true,\n      audio: true,\n      video: false,\n      batchAPI: true,\n      promptCaching: true,\n      input: {\n        tokens: 128000,\n        text: true,\n        image: true,\n        audio: true,\n        cpm: 2.5,\n      },\n      output: {\n        tokens: 16384,\n        text: true,\n        audio: true,\n        cpm: 10,\n      },\n    },\n  },\n\n  'gpt-4o-mini': {\n    name: 'gpt-4o-mini',\n    provider: Vendor.OpenAI,\n    description: 'Fast, affordable omni model with audio support',\n    isActive: true,\n    releaseDate: '2024-07-18',\n    knowledgeCutoff: '2024-04-01',\n    features: {\n      reasoning: false,\n      streaming: true,\n      structuredOutput: true,\n      functionCalling: true,\n      fineTuning: true,\n      predictedOutputs: false,\n      realtime: true,\n      vision: true,\n      audio: true,\n      video: false,\n      batchAPI: true,\n      promptCaching: true,\n      input: {\n        tokens: 128000,\n        text: true,\n        image: true,\n        audio: true,\n        cpm: 0.15,\n      },\n      output: {\n        tokens: 16384,\n        text: true,\n        audio: true,\n        cpm: 0.6,\n      },\n    },\n  },\n\n  // Reasoning Models (o-series)\n  'o3-mini': {\n    name: 'o3-mini',\n    provider: Vendor.OpenAI,\n    description: 'Fast reasoning model tailored for coding, math, and science',\n    isActive: true,\n    releaseDate: '2025-01-31',\n    knowledgeCutoff: '2024-10-01',\n    features: {\n      reasoning: true,\n      streaming: true,\n      structuredOutput: true,\n      functionCalling: true,\n      fineTuning: false,\n      predictedOutputs: false,\n      realtime: false,\n      vision: true,\n      audio: false,\n      video: false,\n      batchAPI: true,\n      promptCaching: false,\n      parameters: {\n        temperature: false,\n        topP: false,\n        frequencyPenalty: false,\n        presencePenalty: false,\n      },\n      input: {\n        tokens: 200000,\n        text: true,\n        image: true,\n        cpm: 1.1,\n      },\n      output: {\n        tokens: 100000,\n        text: true,\n        cpm: 4.4,\n      },\n    },\n  },\n\n  'o1': {\n    name: 'o1',\n    provider: Vendor.OpenAI,\n    description: 'Advanced reasoning model for complex problems',\n    isActive: true,\n    releaseDate: '2024-12-17',\n    knowledgeCutoff: '2024-10-01',\n    features: {\n      reasoning: true,\n      streaming: true,\n      structuredOutput: true,\n      functionCalling: true,\n      fineTuning: false,\n      predictedOutputs: false,\n      realtime: false,\n      vision: true,\n      audio: false,\n      video: false,\n      batchAPI: true,\n      promptCaching: false,\n      parameters: {\n        temperature: false,\n        topP: false,\n        frequencyPenalty: false,\n        presencePenalty: false,\n      },\n      input: {\n        tokens: 200000,\n        text: true,\n        image: true,\n        cpm: 15,\n      },\n      output: {\n        tokens: 100000,\n        text: true,\n        cpm: 60,\n      },\n    },\n  },\n\n  // ============================================================================\n  // Anthropic Models (Verified from platform.claude.com)\n  // ============================================================================\n\n  // Claude 4.5 Series (Current)\n  'claude-opus-4-5-20251101': {\n    name: 'claude-opus-4-5-20251101',\n    provider: Vendor.Anthropic,\n    description: 'Premium model combining maximum intelligence with practical performance',\n    isActive: true,\n    releaseDate: '2025-11-01',\n    knowledgeCutoff: '2025-05-01',\n    features: {\n      reasoning: false,\n      streaming: true,\n      structuredOutput: true,\n      functionCalling: true,\n      fineTuning: false,\n      predictedOutputs: false,\n      realtime: false,\n      vision: true,\n      audio: false,\n      video: false,\n      extendedThinking: true,\n      batchAPI: true,\n      promptCaching: true,\n      input: {\n        tokens: 200000,\n        text: true,\n        image: true,\n        cpm: 5,\n        cpmCached: 0.5,\n      },\n      output: {\n        tokens: 64000,\n        text: true,\n        cpm: 25,\n      },\n    },\n  },\n\n  'claude-sonnet-4-5-20250929': {\n    name: 'claude-sonnet-4-5-20250929',\n    provider: Vendor.Anthropic,\n    description: 'Smart model for complex agents and coding. Best balance of intelligence, speed, cost',\n    isActive: true,\n    releaseDate: '2025-09-29',\n    knowledgeCutoff: '2025-01-01',\n    features: {\n      reasoning: false,\n      streaming: true,\n      structuredOutput: true,\n      functionCalling: true,\n      fineTuning: false,\n      predictedOutputs: false,\n      realtime: false,\n      vision: true,\n      audio: false,\n      video: false,\n      extendedThinking: true,\n      batchAPI: true,\n      promptCaching: true,\n      input: {\n        tokens: 200000,\n        text: true,\n        image: true,\n        cpm: 3,\n        cpmCached: 0.3,\n      },\n      output: {\n        tokens: 64000,\n        text: true,\n        cpm: 15,\n      },\n    },\n  },\n\n  'claude-haiku-4-5-20251001': {\n    name: 'claude-haiku-4-5-20251001',\n    provider: Vendor.Anthropic,\n    description: 'Fastest model with near-frontier intelligence. Matches Sonnet 4 on coding',\n    isActive: true,\n    releaseDate: '2025-10-01',\n    knowledgeCutoff: '2025-02-01',\n    features: {\n      reasoning: false,\n      streaming: true,\n      structuredOutput: true,\n      functionCalling: true,\n      fineTuning: false,\n      predictedOutputs: false,\n      realtime: false,\n      vision: true,\n      audio: false,\n      video: false,\n      extendedThinking: true,\n      batchAPI: true,\n      promptCaching: true,\n      input: {\n        tokens: 200000,\n        text: true,\n        image: true,\n        cpm: 1,\n        cpmCached: 0.1,\n      },\n      output: {\n        tokens: 64000,\n        text: true,\n        cpm: 5,\n      },\n    },\n  },\n\n  // Claude 4.x Legacy\n  'claude-opus-4-1-20250805': {\n    name: 'claude-opus-4-1-20250805',\n    provider: Vendor.Anthropic,\n    description: 'Legacy Opus 4.1 focused on agentic tasks, real-world coding, and reasoning',\n    isActive: true,\n    releaseDate: '2025-08-05',\n    knowledgeCutoff: '2025-01-01',\n    features: {\n      reasoning: false,\n      streaming: true,\n      structuredOutput: true,\n      functionCalling: true,\n      fineTuning: false,\n      predictedOutputs: false,\n      realtime: false,\n      vision: true,\n      audio: false,\n      video: false,\n      extendedThinking: true,\n      batchAPI: true,\n      promptCaching: true,\n      input: {\n        tokens: 200000,\n        text: true,\n        image: true,\n        cpm: 15,\n        cpmCached: 1.5,\n      },\n      output: {\n        tokens: 32000,\n        text: true,\n        cpm: 75,\n      },\n    },\n  },\n\n  'claude-sonnet-4-20250514': {\n    name: 'claude-sonnet-4-20250514',\n    provider: Vendor.Anthropic,\n    description: 'Legacy Sonnet 4. Default for most users, supports 1M context beta',\n    isActive: true,\n    releaseDate: '2025-05-14',\n    knowledgeCutoff: '2025-01-01',\n    features: {\n      reasoning: false,\n      streaming: true,\n      structuredOutput: true,\n      functionCalling: true,\n      fineTuning: false,\n      predictedOutputs: false,\n      realtime: false,\n      vision: true,\n      audio: false,\n      video: false,\n      extendedThinking: true,\n      batchAPI: true,\n      promptCaching: true,\n      input: {\n        tokens: 200000, // 1M with beta header\n        text: true,\n        image: true,\n        cpm: 3,\n        cpmCached: 0.3,\n      },\n      output: {\n        tokens: 64000,\n        text: true,\n        cpm: 15,\n      },\n    },\n  },\n\n  'claude-3-7-sonnet-20250219': {\n    name: 'claude-3-7-sonnet-20250219',\n    provider: Vendor.Anthropic,\n    description: 'Claude 3.7 Sonnet with extended thinking, supports 128K output beta',\n    isActive: true,\n    releaseDate: '2025-02-19',\n    knowledgeCutoff: '2024-10-01',\n    features: {\n      reasoning: false,\n      streaming: true,\n      structuredOutput: true,\n      functionCalling: true,\n      fineTuning: false,\n      predictedOutputs: false,\n      realtime: false,\n      vision: true,\n      audio: false,\n      video: false,\n      extendedThinking: true,\n      batchAPI: true,\n      promptCaching: true,\n      input: {\n        tokens: 200000,\n        text: true,\n        image: true,\n        cpm: 3,\n        cpmCached: 0.3,\n      },\n      output: {\n        tokens: 64000, // 128K with beta header\n        text: true,\n        cpm: 15,\n      },\n    },\n  },\n\n  // Claude 3.x Legacy\n  'claude-3-haiku-20240307': {\n    name: 'claude-3-haiku-20240307',\n    provider: Vendor.Anthropic,\n    description: 'Fast legacy model. Recommend migrating to Haiku 4.5',\n    isActive: true,\n    releaseDate: '2024-03-07',\n    knowledgeCutoff: '2023-08-01',\n    features: {\n      reasoning: false,\n      streaming: true,\n      structuredOutput: true,\n      functionCalling: true,\n      fineTuning: false,\n      predictedOutputs: false,\n      realtime: false,\n      vision: true,\n      audio: false,\n      video: false,\n      extendedThinking: false,\n      batchAPI: true,\n      promptCaching: true,\n      input: {\n        tokens: 200000,\n        text: true,\n        image: true,\n        cpm: 0.25,\n        cpmCached: 0.03,\n      },\n      output: {\n        tokens: 4096,\n        text: true,\n        cpm: 1.25,\n      },\n    },\n  },\n\n  // ============================================================================\n  // Google Models (Verified from ai.google.dev)\n  // ============================================================================\n\n  // Gemini 3 Series (Preview)\n  'gemini-3-flash-preview': {\n    name: 'gemini-3-flash-preview',\n    provider: Vendor.Google,\n    description: 'Pro-grade reasoning with Flash-level latency and efficiency',\n    isActive: true,\n    releaseDate: '2025-11-18',\n    knowledgeCutoff: '2025-08-01',\n    features: {\n      reasoning: true,\n      streaming: true,\n      structuredOutput: true,\n      functionCalling: true,\n      fineTuning: false,\n      predictedOutputs: false,\n      realtime: false,\n      vision: true,\n      audio: true,\n      video: true,\n      batchAPI: true,\n      promptCaching: true,\n      input: {\n        tokens: 1000000,\n        text: true,\n        image: true,\n        audio: true,\n        video: true,\n        cpm: 0.15,\n      },\n      output: {\n        tokens: 65536,\n        text: true,\n        cpm: 0.6,\n      },\n    },\n  },\n\n  'gemini-3-pro-preview': {\n    name: 'gemini-3-pro-preview',\n    provider: Vendor.Google,\n    description: 'Most advanced reasoning Gemini model for complex tasks',\n    isActive: true,\n    releaseDate: '2025-11-18',\n    knowledgeCutoff: '2025-08-01',\n    features: {\n      reasoning: true,\n      streaming: true,\n      structuredOutput: true,\n      functionCalling: true,\n      fineTuning: false,\n      predictedOutputs: false,\n      realtime: false,\n      vision: true,\n      audio: true,\n      video: true,\n      batchAPI: true,\n      promptCaching: true,\n      input: {\n        tokens: 1000000,\n        text: true,\n        image: true,\n        audio: true,\n        video: true,\n        cpm: 1.25,\n      },\n      output: {\n        tokens: 65536,\n        text: true,\n        cpm: 10,\n      },\n    },\n  },\n\n  'gemini-3-pro-image-preview': {\n    name: 'gemini-3-pro-image-preview',\n    provider: Vendor.Google,\n    description: 'Highest quality image generation model',\n    isActive: true,\n    releaseDate: '2025-11-18',\n    knowledgeCutoff: '2025-08-01',\n    features: {\n      reasoning: true,\n      streaming: true,\n      structuredOutput: false,\n      functionCalling: false,\n      fineTuning: false,\n      predictedOutputs: false,\n      realtime: false,\n      vision: true,\n      audio: false,\n      video: false,\n      batchAPI: true,\n      promptCaching: true,\n      input: {\n        tokens: 1000000,\n        text: true,\n        image: true,\n        cpm: 1.25,\n      },\n      output: {\n        tokens: 65536,\n        text: true,\n        image: true,\n        cpm: 10,\n      },\n    },\n  },\n\n  // Gemini 2.5 Series (Production)\n  'gemini-2.5-pro': {\n    name: 'gemini-2.5-pro',\n    provider: Vendor.Google,\n    description: 'Advanced multimodal model built for deep reasoning and agents',\n    isActive: true,\n    releaseDate: '2025-03-01',\n    knowledgeCutoff: '2025-01-01',\n    features: {\n      reasoning: true,\n      streaming: true,\n      structuredOutput: true,\n      functionCalling: true,\n      fineTuning: false,\n      predictedOutputs: false,\n      realtime: false,\n      vision: true,\n      audio: true,\n      video: true,\n      batchAPI: true,\n      promptCaching: true,\n      input: {\n        tokens: 1000000,\n        text: true,\n        image: true,\n        audio: true,\n        video: true,\n        cpm: 1.25,\n      },\n      output: {\n        tokens: 65536,\n        text: true,\n        cpm: 10,\n      },\n    },\n  },\n\n  'gemini-2.5-flash': {\n    name: 'gemini-2.5-flash',\n    provider: Vendor.Google,\n    description: 'Fast, cost-effective model with excellent reasoning',\n    isActive: true,\n    releaseDate: '2025-06-17',\n    knowledgeCutoff: '2025-01-01',\n    features: {\n      reasoning: true,\n      streaming: true,\n      structuredOutput: true,\n      functionCalling: true,\n      fineTuning: false,\n      predictedOutputs: false,\n      realtime: false,\n      vision: true,\n      audio: true,\n      video: true,\n      batchAPI: true,\n      promptCaching: true,\n      input: {\n        tokens: 1000000,\n        text: true,\n        image: true,\n        audio: true,\n        video: true,\n        cpm: 0.15,\n      },\n      output: {\n        tokens: 65536,\n        text: true,\n        cpm: 0.6,\n      },\n    },\n  },\n\n  'gemini-2.5-flash-lite': {\n    name: 'gemini-2.5-flash-lite',\n    provider: Vendor.Google,\n    description: 'Lowest latency for high-volume tasks, summarization, classification',\n    isActive: true,\n    releaseDate: '2025-06-17',\n    knowledgeCutoff: '2025-01-01',\n    features: {\n      reasoning: true,\n      streaming: true,\n      structuredOutput: true,\n      functionCalling: true,\n      fineTuning: false,\n      predictedOutputs: false,\n      realtime: false,\n      vision: true,\n      audio: true,\n      video: true,\n      batchAPI: true,\n      promptCaching: true,\n      input: {\n        tokens: 1000000,\n        text: true,\n        image: true,\n        audio: true,\n        video: true,\n        cpm: 0.075,\n      },\n      output: {\n        tokens: 65536,\n        text: true,\n        cpm: 0.3,\n      },\n    },\n  },\n\n  'gemini-2.5-flash-image': {\n    name: 'gemini-2.5-flash-image',\n    provider: Vendor.Google,\n    description: 'Image generation and editing model',\n    isActive: true,\n    releaseDate: '2025-09-01',\n    knowledgeCutoff: '2025-01-01',\n    features: {\n      reasoning: true,\n      streaming: true,\n      structuredOutput: false,\n      functionCalling: false,\n      fineTuning: false,\n      predictedOutputs: false,\n      realtime: false,\n      vision: true,\n      audio: false,\n      video: false,\n      batchAPI: true,\n      promptCaching: true,\n      input: {\n        tokens: 1000000,\n        text: true,\n        image: true,\n        cpm: 0.15,\n      },\n      output: {\n        tokens: 65536,\n        text: true,\n        image: true,\n        cpm: 0.6,\n      },\n    },\n  },\n};\n\n/**\n * Get model information by name\n * @param modelName The model identifier\n * @returns Model description or undefined if not found\n */\nexport function getModelInfo(modelName: string): ILLMDescription | undefined {\n  return MODEL_REGISTRY[modelName];\n}\n\n/**\n * Get all models for a specific vendor\n * @param vendor The vendor to filter by\n * @returns Array of model descriptions for the vendor\n */\nexport function getModelsByVendor(vendor: VendorType): ILLMDescription[] {\n  return Object.values(MODEL_REGISTRY).filter((model) => model.provider === vendor);\n}\n\n/**\n * Get all currently active models\n * @returns Array of active model descriptions\n */\nexport function getActiveModels(): ILLMDescription[] {\n  return Object.values(MODEL_REGISTRY).filter((model) => model.isActive);\n}\n\n/**\n * Calculate the cost for a given model and token usage\n * @param model Model name\n * @param inputTokens Number of input tokens\n * @param outputTokens Number of output tokens\n * @param options Optional calculation options\n * @returns Total cost in dollars, or null if model not found\n */\nexport function calculateCost(\n  model: string,\n  inputTokens: number,\n  outputTokens: number,\n  options?: { useCachedInput?: boolean }\n): number | null {\n  const modelInfo = getModelInfo(model);\n  if (!modelInfo) {\n    return null;\n  }\n\n  const inputCPM = options?.useCachedInput && modelInfo.features.input.cpmCached !== undefined\n    ? modelInfo.features.input.cpmCached\n    : modelInfo.features.input.cpm;\n\n  const outputCPM = modelInfo.features.output.cpm;\n\n  const inputCost = (inputTokens / 1_000_000) * inputCPM;\n  const outputCost = (outputTokens / 1_000_000) * outputCPM;\n\n  return inputCost + outputCost;\n}\n","/**\n * IContextPlugin - Interface for context plugins\n *\n * Plugins extend AgentContext with custom context components.\n * Built-in plugins: PlanPlugin, MemoryPlugin, ToolOutputPlugin\n * Users can create custom plugins for domain-specific context.\n */\n\nimport type { IContextComponent, ITokenEstimator, ContextBudget } from '../types.js';\n\n/**\n * Context plugin interface\n *\n * Plugins add custom components to the context (e.g., Plan, Memory, Tool Outputs).\n * Each plugin is responsible for:\n * - Providing its context component\n * - Handling compaction when space is needed\n * - Serializing/restoring state for sessions\n */\nexport interface IContextPlugin {\n  /**\n   * Unique name for this plugin (used as component name)\n   * Should be lowercase with underscores (e.g., 'plan', 'memory_index', 'tool_outputs')\n   */\n  readonly name: string;\n\n  /**\n   * Compaction priority (higher number = compact first)\n   * - 0: Never compact (system_prompt, instructions, current_input)\n   * - 1-3: Critical (plan, core instructions)\n   * - 4-7: Important (conversation history)\n   * - 8-10: Expendable (memory index, tool outputs)\n   */\n  readonly priority: number;\n\n  /**\n   * Whether this plugin's content can be compacted\n   * If false, the component will never be reduced\n   */\n  readonly compactable: boolean;\n\n  /**\n   * Get this plugin's context component\n   * Return null if plugin has no content for this turn\n   *\n   * @returns The component to include in context, or null if none\n   */\n  getComponent(): Promise<IContextComponent | null>;\n\n  /**\n   * Called when this plugin's content needs compaction\n   * Plugin is responsible for reducing its size to fit within budget\n   *\n   * @param targetTokens - Target token count to reduce to (approximate)\n   * @param estimator - Token estimator to use for calculations\n   * @returns Number of tokens actually freed\n   */\n  compact?(targetTokens: number, estimator: ITokenEstimator): Promise<number>;\n\n  /**\n   * Called after context is prepared (opportunity for cleanup/logging)\n   * Can be used to track context usage metrics\n   *\n   * @param budget - The final context budget after preparation\n   */\n  onPrepared?(budget: ContextBudget): Promise<void>;\n\n  /**\n   * Called when the context manager is being destroyed/cleaned up\n   * Use for releasing resources\n   */\n  destroy?(): void;\n\n  /**\n   * Get state for session serialization\n   * Return undefined if plugin has no state to persist\n   */\n  getState?(): unknown;\n\n  /**\n   * Restore from serialized state\n   * Called when resuming a session\n   *\n   * @param state - Previously serialized state from getState()\n   */\n  restoreState?(state: unknown): void;\n}\n\n/**\n * Base class for context plugins with common functionality\n * Plugins can extend this or implement IContextPlugin directly\n */\nexport abstract class BaseContextPlugin implements IContextPlugin {\n  abstract readonly name: string;\n  abstract readonly priority: number;\n  abstract readonly compactable: boolean;\n\n  abstract getComponent(): Promise<IContextComponent | null>;\n\n  // Default implementations - override as needed\n  async compact(_targetTokens: number, _estimator: ITokenEstimator): Promise<number> {\n    return 0; // No compaction by default\n  }\n\n  async onPrepared(_budget: ContextBudget): Promise<void> {\n    // No-op by default\n  }\n\n  destroy(): void {\n    // No-op by default\n  }\n\n  getState(): unknown {\n    return undefined;\n  }\n\n  restoreState(_state: unknown): void {\n    // No-op by default\n  }\n}\n","/**\n * InContextMemoryPlugin - In-context memory for frequently-accessed state\n *\n * Unlike WorkingMemory (which stores data externally with an index in context),\n * InContextMemory stores key-value pairs DIRECTLY in the LLM context.\n * This is for small, frequently-updated state that the LLM needs instant access to.\n *\n * Key Difference:\n * - WorkingMemory: External storage + index in context  requires memory_retrieve()\n * - InContextMemory: Full values in context  instant access, no retrieval needed\n */\n\nimport { BaseContextPlugin } from './IContextPlugin.js';\nimport type { IContextComponent, ITokenEstimator } from '../types.js';\n\n/**\n * Priority levels for in-context memory entries\n */\nexport type InContextPriority = 'low' | 'normal' | 'high' | 'critical';\n\n/**\n * An entry stored in InContextMemory\n */\nexport interface InContextEntry {\n  /** Unique key for this entry */\n  key: string;\n  /** Human-readable description */\n  description: string;\n  /** The actual value (any JSON-serializable data) */\n  value: unknown;\n  /** When this entry was last updated */\n  updatedAt: number;\n  /** Eviction priority (low entries are evicted first) */\n  priority: InContextPriority;\n}\n\n/**\n * Configuration for InContextMemoryPlugin\n */\nexport interface InContextMemoryConfig {\n  /** Maximum number of entries (default: 20) */\n  maxEntries?: number;\n  /** Maximum total tokens for all entries (default: 4000) */\n  maxTotalTokens?: number;\n  /** Default priority for new entries (default: 'normal') */\n  defaultPriority?: InContextPriority;\n  /** Whether to show timestamps in output (default: false) */\n  showTimestamps?: boolean;\n  /** Header text for the context section (default: '## Live Context') */\n  headerText?: string;\n}\n\n/**\n * Serialized state for session persistence\n */\nexport interface SerializedInContextMemoryState {\n  entries: InContextEntry[];\n  config: InContextMemoryConfig;\n}\n\n/**\n * Priority values for sorting (lower = evict first)\n */\nconst PRIORITY_VALUES: Record<InContextPriority, number> = {\n  low: 1,\n  normal: 2,\n  high: 3,\n  critical: 4,\n};\n\n/**\n * Default configuration values\n */\nconst DEFAULT_CONFIG: Required<InContextMemoryConfig> = {\n  maxEntries: 20,\n  maxTotalTokens: 4000,\n  defaultPriority: 'normal',\n  showTimestamps: false,\n  headerText: '## Live Context',\n};\n\n/**\n * InContextMemoryPlugin - Stores key-value pairs directly in LLM context\n *\n * Use this for:\n * - Current state/status that changes frequently\n * - User preferences during a session\n * - Small accumulated results\n * - Counters, flags, or control variables\n *\n * Do NOT use this for:\n * - Large data (use WorkingMemory instead)\n * - Data that doesn't need instant access\n * - Rarely accessed reference data\n */\nexport class InContextMemoryPlugin extends BaseContextPlugin {\n  readonly name = 'in_context_memory';\n  readonly priority = 5; // Medium priority for compaction\n  readonly compactable = true;\n\n  private entries: Map<string, InContextEntry> = new Map();\n  private config: Required<InContextMemoryConfig>;\n  private destroyed = false;\n\n  /**\n   * Create an InContextMemoryPlugin\n   *\n   * @param config - Configuration options\n   */\n  constructor(config: InContextMemoryConfig = {}) {\n    super();\n    this.config = { ...DEFAULT_CONFIG, ...config };\n  }\n\n  /**\n   * Check if plugin is destroyed\n   */\n  get isDestroyed(): boolean {\n    return this.destroyed;\n  }\n\n  // ============ Entry Management ============\n\n  /**\n   * Store or update a key-value pair\n   *\n   * @param key - Unique key for this entry\n   * @param description - Human-readable description (shown in context)\n   * @param value - The value to store (any JSON-serializable data)\n   * @param priority - Eviction priority (default from config)\n   */\n  set(key: string, description: string, value: unknown, priority?: InContextPriority): void {\n    this.assertNotDestroyed();\n\n    const entry: InContextEntry = {\n      key,\n      description,\n      value,\n      updatedAt: Date.now(),\n      priority: priority ?? this.config.defaultPriority,\n    };\n\n    this.entries.set(key, entry);\n\n    // Enforce max entries limit (evict if necessary)\n    this.enforceMaxEntries();\n  }\n\n  /**\n   * Get a value by key\n   *\n   * @param key - The key to retrieve\n   * @returns The value, or undefined if not found\n   */\n  get(key: string): unknown | undefined {\n    this.assertNotDestroyed();\n    return this.entries.get(key)?.value;\n  }\n\n  /**\n   * Check if a key exists\n   *\n   * @param key - The key to check\n   */\n  has(key: string): boolean {\n    this.assertNotDestroyed();\n    return this.entries.has(key);\n  }\n\n  /**\n   * Delete an entry by key\n   *\n   * @param key - The key to delete\n   * @returns true if the key existed and was deleted\n   */\n  delete(key: string): boolean {\n    this.assertNotDestroyed();\n    return this.entries.delete(key);\n  }\n\n  /**\n   * List all entries with metadata\n   *\n   * @returns Array of entry metadata (without full values)\n   */\n  list(): Array<{ key: string; description: string; priority: InContextPriority; updatedAt: number }> {\n    this.assertNotDestroyed();\n    return Array.from(this.entries.values()).map((e) => ({\n      key: e.key,\n      description: e.description,\n      priority: e.priority,\n      updatedAt: e.updatedAt,\n    }));\n  }\n\n  /**\n   * Clear all entries\n   */\n  clear(): void {\n    this.assertNotDestroyed();\n    this.entries.clear();\n  }\n\n  /**\n   * Get the number of entries\n   */\n  get size(): number {\n    return this.entries.size;\n  }\n\n  // ============ IContextPlugin Implementation ============\n\n  /**\n   * Get the context component for this plugin\n   */\n  async getComponent(): Promise<IContextComponent | null> {\n    this.assertNotDestroyed();\n\n    if (this.entries.size === 0) {\n      return null;\n    }\n\n    const content = this.formatContent();\n\n    return {\n      name: this.name,\n      content,\n      priority: this.priority,\n      compactable: this.compactable,\n      metadata: {\n        entryCount: this.entries.size,\n      },\n    };\n  }\n\n  /**\n   * Compact by evicting low-priority entries\n   *\n   * Eviction order: low  normal  high (critical is never auto-evicted)\n   * Within same priority, oldest entries are evicted first\n   *\n   * @param targetTokens - Target token count to reduce to\n   * @param estimator - Token estimator\n   * @returns Number of tokens freed\n   */\n  override async compact(targetTokens: number, estimator: ITokenEstimator): Promise<number> {\n    this.assertNotDestroyed();\n\n    const beforeContent = this.formatContent();\n    const beforeTokens = estimator.estimateTokens(beforeContent);\n\n    if (beforeTokens <= targetTokens) {\n      return 0; // Already under target\n    }\n\n    // Sort entries by eviction priority (lowest first, then oldest)\n    const sortedEntries = this.getSortedEntriesForEviction();\n\n    // Evict entries until we're under target\n    for (const entry of sortedEntries) {\n      // Never auto-evict critical entries\n      if (entry.priority === 'critical') {\n        break;\n      }\n\n      this.entries.delete(entry.key);\n\n      const currentContent = this.formatContent();\n      const currentTokens = estimator.estimateTokens(currentContent);\n\n      if (currentTokens <= targetTokens) {\n        break;\n      }\n    }\n\n    const afterContent = this.formatContent();\n    const afterTokens = estimator.estimateTokens(afterContent);\n\n    return Math.max(0, beforeTokens - afterTokens);\n  }\n\n  /**\n   * Get serialized state for session persistence\n   */\n  override getState(): SerializedInContextMemoryState {\n    return {\n      entries: Array.from(this.entries.values()),\n      config: this.config,\n    };\n  }\n\n  /**\n   * Restore state from serialization\n   *\n   * @param state - Previously serialized state\n   */\n  override restoreState(state: unknown): void {\n    this.assertNotDestroyed();\n\n    if (!state || typeof state !== 'object') {\n      return;\n    }\n\n    const typedState = state as SerializedInContextMemoryState;\n\n    if (typedState.entries && Array.isArray(typedState.entries)) {\n      this.entries.clear();\n      for (const entry of typedState.entries) {\n        if (entry.key && typeof entry.key === 'string') {\n          this.entries.set(entry.key, entry);\n        }\n      }\n    }\n\n    if (typedState.config && typeof typedState.config === 'object') {\n      this.config = { ...DEFAULT_CONFIG, ...typedState.config };\n    }\n  }\n\n  /**\n   * Clean up resources\n   */\n  override destroy(): void {\n    this.entries.clear();\n    this.destroyed = true;\n  }\n\n  // ============ Private Methods ============\n\n  /**\n   * Format entries as markdown for context\n   */\n  private formatContent(): string {\n    if (this.entries.size === 0) {\n      return '';\n    }\n\n    const lines: string[] = [\n      this.config.headerText,\n      'Data below is always current. Use directly - no retrieval needed.',\n      '',\n    ];\n\n    for (const entry of this.entries.values()) {\n      lines.push(`### ${entry.key}`);\n      lines.push(entry.description);\n\n      // Format value as JSON code block\n      const valueStr = typeof entry.value === 'string'\n        ? entry.value\n        : JSON.stringify(entry.value, null, 2);\n\n      lines.push('```json');\n      lines.push(valueStr);\n      lines.push('```');\n\n      if (this.config.showTimestamps) {\n        const date = new Date(entry.updatedAt);\n        lines.push(`_Updated: ${date.toISOString()}_`);\n      }\n\n      lines.push('');\n    }\n\n    return lines.join('\\n');\n  }\n\n  /**\n   * Get entries sorted by eviction priority (lowest priority first, then oldest)\n   */\n  private getSortedEntriesForEviction(): InContextEntry[] {\n    return Array.from(this.entries.values()).sort((a, b) => {\n      // First by priority (lower value = evict first)\n      const priorityDiff = PRIORITY_VALUES[a.priority] - PRIORITY_VALUES[b.priority];\n      if (priorityDiff !== 0) {\n        return priorityDiff;\n      }\n      // Then by age (older first)\n      return a.updatedAt - b.updatedAt;\n    });\n  }\n\n  /**\n   * Enforce max entries limit by evicting lowest-priority entries\n   */\n  private enforceMaxEntries(): void {\n    if (this.entries.size <= this.config.maxEntries) {\n      return;\n    }\n\n    const sorted = this.getSortedEntriesForEviction();\n\n    while (this.entries.size > this.config.maxEntries && sorted.length > 0) {\n      const toEvict = sorted.shift()!;\n\n      // Don't evict critical entries even for max limit\n      if (toEvict.priority === 'critical') {\n        break;\n      }\n\n      this.entries.delete(toEvict.key);\n    }\n  }\n\n  /**\n   * Assert that the plugin hasn't been destroyed\n   */\n  private assertNotDestroyed(): void {\n    if (this.destroyed) {\n      throw new Error('InContextMemoryPlugin has been destroyed');\n    }\n  }\n}\n","/**\n * InContextMemory Tools - Tools for LLM to manipulate in-context memory\n *\n * Consolidated tools (Phase 1):\n * - context_set: Store/update key-value pairs\n * - context_delete: Remove entries\n * - context_list: List all entries with metadata\n *\n * Note: context_get was removed since InContextMemory values are already\n * visible directly in the context - no retrieval tool needed.\n */\n\nimport type { ToolFunction, FunctionToolDefinition } from '../../../domain/entities/Tool.js';\nimport type { ToolContext } from '../../../domain/interfaces/IToolContext.js';\nimport { ToolExecutionError } from '../../../domain/errors/AIErrors.js';\nimport { InContextMemoryPlugin, type InContextMemoryConfig, type InContextPriority } from './InContextMemoryPlugin.js';\nimport type { AgentContext } from '../../AgentContext.js';\n\n// ============ Tool Definitions ============\n\n/**\n * Tool definition for context_set\n */\nexport const contextSetDefinition: FunctionToolDefinition = {\n  type: 'function',\n  function: {\n    name: 'context_set',\n    description: `Store or update a key-value pair in the live context.\nThe value will appear directly in the context and can be read without retrieval calls.\n\nUse for:\n- Current state/status that changes during execution\n- User preferences or settings\n- Counters, flags, or control variables\n- Small accumulated results\n\nPriority levels (for eviction when space is needed):\n- \"low\": Evicted first. Temporary or easily recreated data.\n- \"normal\": Default. Standard importance.\n- \"high\": Keep longer. Important state.\n- \"critical\": Never auto-evicted. Only removed via context_delete.`,\n    parameters: {\n      type: 'object',\n      properties: {\n        key: {\n          type: 'string',\n          description: 'Unique key for this entry (e.g., \"current_state\", \"user_prefs\")',\n        },\n        description: {\n          type: 'string',\n          description: 'Brief description of what this data represents (shown in context)',\n        },\n        value: {\n          description: 'The value to store (any JSON-serializable data)',\n        },\n        priority: {\n          type: 'string',\n          enum: ['low', 'normal', 'high', 'critical'],\n          description: 'Eviction priority. Default: \"normal\"',\n        },\n      },\n      required: ['key', 'description', 'value'],\n    },\n  },\n};\n\n/**\n * Tool definition for context_delete\n */\nexport const contextDeleteDefinition: FunctionToolDefinition = {\n  type: 'function',\n  function: {\n    name: 'context_delete',\n    description: `Delete an entry from the live context to free space.\n\nUse this to:\n- Remove entries that are no longer needed\n- Free space when approaching limits\n- Clean up after a task completes`,\n    parameters: {\n      type: 'object',\n      properties: {\n        key: {\n          type: 'string',\n          description: 'The key to delete',\n        },\n      },\n      required: ['key'],\n    },\n  },\n};\n\n/**\n * Tool definition for context_list\n */\nexport const contextListDefinition: FunctionToolDefinition = {\n  type: 'function',\n  function: {\n    name: 'context_list',\n    description: `List all keys stored in the live context with their metadata.\n\nReturns key, description, priority, and last update time for each entry.\nUse to see what's stored and identify entries to clean up.`,\n    parameters: {\n      type: 'object',\n      properties: {},\n      required: [],\n    },\n  },\n};\n\n// ============ Tool Factory ============\n\n/**\n * Create all in-context memory tools\n *\n * @returns Array of tool functions\n */\nexport function createInContextMemoryTools(): ToolFunction[] {\n  return [\n    // context_set\n    {\n      definition: contextSetDefinition,\n      execute: async (args: Record<string, unknown>, context?: ToolContext) => {\n        const plugin = getPluginFromContext(context, 'context_set');\n\n        const key = args.key as string;\n        const description = args.description as string;\n        const value = args.value;\n        const priority = args.priority as InContextPriority | undefined;\n\n        plugin.set(key, description, value, priority);\n\n        return {\n          success: true,\n          key,\n          priority: priority ?? 'normal',\n          message: `Stored \"${key}\" in live context`,\n        };\n      },\n      idempotency: { cacheable: false },\n      output: { expectedSize: 'small' },\n      permission: {\n        scope: 'always', // Auto-approve context operations\n        riskLevel: 'low',\n      },\n      describeCall: (args) => args.key as string,\n    },\n\n    // context_delete\n    {\n      definition: contextDeleteDefinition,\n      execute: async (args: Record<string, unknown>, context?: ToolContext) => {\n        const plugin = getPluginFromContext(context, 'context_delete');\n\n        const key = args.key as string;\n        const existed = plugin.delete(key);\n\n        return {\n          success: true,\n          key,\n          existed,\n          message: existed ? `Deleted \"${key}\" from live context` : `Key \"${key}\" did not exist`,\n        };\n      },\n      idempotency: { cacheable: false },\n      output: { expectedSize: 'small' },\n      permission: {\n        scope: 'always',\n        riskLevel: 'low',\n      },\n      describeCall: (args) => args.key as string,\n    },\n\n    // context_list\n    {\n      definition: contextListDefinition,\n      execute: async (_args: Record<string, unknown>, context?: ToolContext) => {\n        const plugin = getPluginFromContext(context, 'context_list');\n\n        const entries = plugin.list();\n\n        return {\n          entries: entries.map((e) => ({\n            key: e.key,\n            description: e.description,\n            priority: e.priority,\n            updatedAt: new Date(e.updatedAt).toISOString(),\n          })),\n          count: entries.length,\n        };\n      },\n      idempotency: { cacheable: true, ttlMs: 500 },\n      output: { expectedSize: 'small' },\n      permission: {\n        scope: 'always',\n        riskLevel: 'low',\n      },\n      describeCall: () => 'all',\n    },\n  ];\n}\n\n// ============ Factory Functions ============\n\n/**\n * Create an InContextMemory plugin with its tools\n *\n * @param config - Optional configuration\n * @returns Object containing the plugin and its tools\n *\n * @example\n * ```typescript\n * const { plugin, tools } = createInContextMemory({ maxEntries: 15 });\n * ctx.registerPlugin(plugin);\n * for (const tool of tools) {\n *   ctx.tools.register(tool);\n * }\n * ```\n */\nexport function createInContextMemory(config?: InContextMemoryConfig): {\n  plugin: InContextMemoryPlugin;\n  tools: ToolFunction[];\n} {\n  const plugin = new InContextMemoryPlugin(config);\n  const tools = createInContextMemoryTools();\n\n  return { plugin, tools };\n}\n\n/**\n * Set up InContextMemory on an AgentContext\n *\n * Registers both the plugin and its tools on the context.\n *\n * @param agentContext - The AgentContext to set up\n * @param config - Optional configuration\n * @returns The created plugin (for direct access)\n *\n * @example\n * ```typescript\n * const ctx = AgentContext.create({ model: 'gpt-4' });\n * const plugin = setupInContextMemory(ctx, { maxEntries: 10 });\n *\n * // Plugin is accessible through ctx.inContextMemory\n * plugin.set('state', 'Current processing state', { step: 1 });\n * ```\n */\nexport function setupInContextMemory(\n  agentContext: AgentContext,\n  config?: InContextMemoryConfig\n): InContextMemoryPlugin {\n  const { plugin, tools } = createInContextMemory(config);\n\n  // Register plugin with context manager\n  agentContext.registerPlugin(plugin);\n\n  // Register tools with tool manager\n  for (const tool of tools) {\n    agentContext.tools.register(tool);\n  }\n\n  // Store reference on context for tool access\n  (agentContext as AgentContext & { inContextMemory?: InContextMemoryPlugin }).inContextMemory = plugin;\n\n  return plugin;\n}\n\n// ============ Helper Functions ============\n\n/**\n * Get the InContextMemoryPlugin from tool context\n */\nfunction getPluginFromContext(context: ToolContext | undefined, toolName: string): InContextMemoryPlugin {\n  if (!context) {\n    throw new ToolExecutionError(\n      toolName,\n      'InContextMemory tools require a tool context'\n    );\n  }\n\n  // Access plugin through the extended context\n  const plugin = (context as ToolContext & { inContextMemory?: InContextMemoryPlugin }).inContextMemory;\n\n  if (!plugin) {\n    throw new ToolExecutionError(\n      toolName,\n      'InContextMemory plugin not found. Use setupInContextMemory() to initialize.'\n    );\n  }\n\n  return plugin;\n}\n","/**\n * FilePersistentInstructionsStorage - File-based storage for persistent instructions\n *\n * Stores custom agent instructions as markdown files on disk.\n * Path: ~/.oneringai/agents/<agentId>/custom_instructions.md\n * Windows: %APPDATA%/oneringai/agents/<agentId>/custom_instructions.md\n *\n * Features:\n * - Cross-platform path handling\n * - Safe agent ID sanitization\n * - Atomic file operations\n * - Automatic directory creation\n */\n\nimport { promises as fs } from 'fs';\nimport { join } from 'path';\nimport { homedir } from 'os';\nimport type { IPersistentInstructionsStorage } from '../../domain/interfaces/IPersistentInstructionsStorage.js';\n\n/**\n * Configuration for FilePersistentInstructionsStorage\n */\nexport interface FilePersistentInstructionsStorageConfig {\n  /** Agent ID (used to create unique storage path) */\n  agentId: string;\n  /** Override the base directory (default: ~/.oneringai/agents) */\n  baseDirectory?: string;\n  /** Override the filename (default: custom_instructions.md) */\n  filename?: string;\n}\n\n/**\n * Get the default base directory for persistent instructions\n * Uses ~/.oneringai/agents on Unix-like systems\n * Uses %APPDATA%/oneringai/agents on Windows\n */\nfunction getDefaultBaseDirectory(): string {\n  const platform = process.platform;\n\n  if (platform === 'win32') {\n    // Windows: Use APPDATA if available, otherwise fall back to home\n    const appData = process.env.APPDATA || process.env.LOCALAPPDATA;\n    if (appData) {\n      return join(appData, 'oneringai', 'agents');\n    }\n  }\n\n  // Unix-like (Linux, macOS) and fallback: Use home directory\n  return join(homedir(), '.oneringai', 'agents');\n}\n\n/**\n * Sanitize agent ID for use as a directory name\n * Removes or replaces characters that are not safe for filenames\n */\nfunction sanitizeAgentId(agentId: string): string {\n  // Replace any character that isn't alphanumeric, dash, or underscore\n  // Also collapse multiple consecutive safe characters into one\n  return agentId\n    .replace(/[^a-zA-Z0-9_-]/g, '_')  // Replace unsafe chars with underscore\n    .replace(/_+/g, '_')               // Collapse multiple underscores\n    .replace(/^_|_$/g, '')             // Remove leading/trailing underscores\n    .toLowerCase()                      // Normalize to lowercase\n    || 'default';                       // Fallback if empty\n}\n\n/**\n * File-based storage for persistent agent instructions\n */\nexport class FilePersistentInstructionsStorage implements IPersistentInstructionsStorage {\n  private readonly directory: string;\n  private readonly filePath: string;\n  private readonly agentId: string;\n\n  constructor(config: FilePersistentInstructionsStorageConfig) {\n    this.agentId = config.agentId;\n    const sanitizedId = sanitizeAgentId(config.agentId);\n    const baseDir = config.baseDirectory ?? getDefaultBaseDirectory();\n    const filename = config.filename ?? 'custom_instructions.md';\n\n    this.directory = join(baseDir, sanitizedId);\n    this.filePath = join(this.directory, filename);\n  }\n\n  /**\n   * Load instructions from file\n   */\n  async load(): Promise<string | null> {\n    try {\n      const content = await fs.readFile(this.filePath, 'utf-8');\n      return content.trim() || null;\n    } catch (error: unknown) {\n      if (error instanceof Error && 'code' in error && (error as NodeJS.ErrnoException).code === 'ENOENT') {\n        return null;\n      }\n      throw error;\n    }\n  }\n\n  /**\n   * Save instructions to file\n   * Creates directory if it doesn't exist\n   */\n  async save(content: string): Promise<void> {\n    // Ensure directory exists\n    await this.ensureDirectory();\n\n    // Write atomically: write to temp file, then rename\n    const tempPath = `${this.filePath}.tmp`;\n    try {\n      await fs.writeFile(tempPath, content, 'utf-8');\n      await fs.rename(tempPath, this.filePath);\n    } catch (error) {\n      // Clean up temp file if rename failed\n      try {\n        await fs.unlink(tempPath);\n      } catch {\n        // Ignore cleanup errors\n      }\n      throw error;\n    }\n  }\n\n  /**\n   * Delete instructions file\n   */\n  async delete(): Promise<void> {\n    try {\n      await fs.unlink(this.filePath);\n    } catch (error: unknown) {\n      if (error instanceof Error && 'code' in error && (error as NodeJS.ErrnoException).code !== 'ENOENT') {\n        throw error;\n      }\n      // Ignore if file doesn't exist\n    }\n  }\n\n  /**\n   * Check if instructions file exists\n   */\n  async exists(): Promise<boolean> {\n    try {\n      await fs.access(this.filePath);\n      return true;\n    } catch {\n      return false;\n    }\n  }\n\n  /**\n   * Get the file path (for display/debugging)\n   */\n  getPath(): string {\n    return this.filePath;\n  }\n\n  /**\n   * Get the agent ID\n   */\n  getAgentId(): string {\n    return this.agentId;\n  }\n\n  /**\n   * Ensure the directory exists\n   */\n  private async ensureDirectory(): Promise<void> {\n    try {\n      await fs.mkdir(this.directory, { recursive: true });\n    } catch (error: unknown) {\n      if (error instanceof Error && 'code' in error && (error as NodeJS.ErrnoException).code !== 'EEXIST') {\n        throw error;\n      }\n    }\n  }\n}\n","/**\n * PersistentInstructionsPlugin - Store agent-level custom instructions in files\n *\n * Unlike InContextMemory (volatile key-value pairs), this plugin stores\n * INSTRUCTIONS that persist across sessions in files on disk.\n *\n * Use cases:\n * - Agent personality/behavior customization\n * - User-specific preferences\n * - Accumulated knowledge/rules\n * - Custom tool usage guidelines\n *\n * Storage: ~/.oneringai/agents/<agentId>/custom_instructions.md\n *\n * Key Behaviors:\n * - Loaded automatically when feature is enabled\n * - Never compacted (priority 0)\n * - Session serialization tracks dirty state\n */\n\nimport { BaseContextPlugin } from './IContextPlugin.js';\nimport type { IContextComponent, ITokenEstimator } from '../types.js';\nimport type { IPersistentInstructionsStorage } from '../../../domain/interfaces/IPersistentInstructionsStorage.js';\nimport { FilePersistentInstructionsStorage } from '../../../infrastructure/storage/FilePersistentInstructionsStorage.js';\n\n/**\n * Configuration for PersistentInstructionsPlugin\n */\nexport interface PersistentInstructionsConfig {\n  /** Agent ID - used to determine storage path */\n  agentId: string;\n  /** Custom storage implementation (default: FilePersistentInstructionsStorage) */\n  storage?: IPersistentInstructionsStorage;\n  /** Maximum instructions length in characters (default: 50000) */\n  maxLength?: number;\n}\n\n/**\n * Serialized state for session persistence\n */\nexport interface SerializedPersistentInstructionsState {\n  content: string | null;\n  dirty: boolean;\n  agentId: string;\n}\n\n/**\n * Default configuration values\n */\nconst DEFAULT_CONFIG = {\n  maxLength: 50000,\n};\n\n/**\n * Build the context explanation that appears before the instructions\n */\nfunction buildContextExplanation(path: string): string {\n  return `## Custom Instructions\n\nThese are your persistent instructions that apply across all sessions.\nThey are stored on disk and automatically loaded when you start.\n\n**To modify:** Use \\`instructions_set\\` (replace all), \\`instructions_append\\` (add section), or \\`instructions_clear\\` (remove all).\n**Storage path:** ${path}\n\n---\n`;\n}\n\n/**\n * PersistentInstructionsPlugin - Persists custom instructions across sessions\n *\n * This plugin manages custom instructions that:\n * - Are stored on disk (survive process restarts)\n * - Can be modified by the LLM during execution\n * - Are never compacted (always included in context)\n * - Support append operations for incremental updates\n */\nexport class PersistentInstructionsPlugin extends BaseContextPlugin {\n  readonly name = 'persistent_instructions';\n  readonly priority = 0; // Never compact\n  readonly compactable = false;\n\n  private _content: string | null = null;\n  private _dirty = false;\n  private _initialized = false;\n  private _destroyed = false;\n\n  private readonly storage: IPersistentInstructionsStorage;\n  private readonly maxLength: number;\n  private readonly agentId: string;\n\n  /**\n   * Create a PersistentInstructionsPlugin\n   *\n   * @param config - Configuration options (agentId is required)\n   */\n  constructor(config: PersistentInstructionsConfig) {\n    super();\n    this.agentId = config.agentId;\n    this.maxLength = config.maxLength ?? DEFAULT_CONFIG.maxLength;\n\n    // Use provided storage or create default file storage\n    this.storage = config.storage ?? new FilePersistentInstructionsStorage({\n      agentId: config.agentId,\n    });\n  }\n\n  /**\n   * Check if plugin is destroyed\n   */\n  get isDestroyed(): boolean {\n    return this._destroyed;\n  }\n\n  /**\n   * Check if plugin has been initialized (loaded from disk)\n   */\n  get isInitialized(): boolean {\n    return this._initialized;\n  }\n\n  /**\n   * Check if content has been modified since last save\n   */\n  get isDirty(): boolean {\n    return this._dirty;\n  }\n\n  // ============ Initialization ============\n\n  /**\n   * Initialize by loading instructions from storage\n   * Called lazily on first getComponent() call\n   */\n  async initialize(): Promise<void> {\n    if (this._initialized || this._destroyed) {\n      return;\n    }\n\n    try {\n      this._content = await this.storage.load();\n      this._initialized = true;\n      this._dirty = false;\n    } catch (error) {\n      // Log but don't fail - treat as no instructions\n      console.warn(`Failed to load persistent instructions for agent '${this.agentId}':`, error);\n      this._content = null;\n      this._initialized = true;\n    }\n  }\n\n  // ============ Content Management ============\n\n  /**\n   * Set the entire instructions content (replaces existing)\n   *\n   * @param content - New instructions content\n   * @returns true if set successfully, false if content exceeds max length\n   */\n  async set(content: string): Promise<boolean> {\n    this.assertNotDestroyed();\n\n    if (content.length > this.maxLength) {\n      return false;\n    }\n\n    this._content = content.trim() || null;\n    this._dirty = true;\n\n    // Save to disk\n    if (this._content) {\n      await this.storage.save(this._content);\n    } else {\n      await this.storage.delete();\n    }\n\n    this._dirty = false;\n    return true;\n  }\n\n  /**\n   * Append a section to existing instructions\n   *\n   * @param section - Section to append (will add newlines before)\n   * @returns true if appended successfully, false if would exceed max length\n   */\n  async append(section: string): Promise<boolean> {\n    this.assertNotDestroyed();\n\n    const trimmedSection = section.trim();\n    if (!trimmedSection) {\n      return true; // Nothing to append\n    }\n\n    const currentContent = this._content || '';\n    const newContent = currentContent\n      ? `${currentContent}\\n\\n${trimmedSection}`\n      : trimmedSection;\n\n    if (newContent.length > this.maxLength) {\n      return false;\n    }\n\n    this._content = newContent;\n    this._dirty = true;\n\n    // Save to disk\n    await this.storage.save(this._content);\n    this._dirty = false;\n\n    return true;\n  }\n\n  /**\n   * Get current instructions content\n   *\n   * @returns Instructions content, or null if none\n   */\n  get(): string | null {\n    this.assertNotDestroyed();\n    return this._content;\n  }\n\n  /**\n   * Check if instructions exist\n   */\n  has(): boolean {\n    this.assertNotDestroyed();\n    return this._content !== null && this._content.length > 0;\n  }\n\n  /**\n   * Clear all instructions\n   */\n  async clear(): Promise<void> {\n    this.assertNotDestroyed();\n\n    this._content = null;\n    this._dirty = true;\n\n    await this.storage.delete();\n    this._dirty = false;\n  }\n\n  /**\n   * Get storage path (for display/debugging)\n   */\n  getPath(): string {\n    return this.storage.getPath();\n  }\n\n  /**\n   * Get agent ID\n   */\n  getAgentId(): string {\n    return this.agentId;\n  }\n\n  /**\n   * Get current content length\n   */\n  getLength(): number {\n    return this._content?.length ?? 0;\n  }\n\n  /**\n   * Get maximum allowed content length\n   */\n  getMaxLength(): number {\n    return this.maxLength;\n  }\n\n  // ============ IContextPlugin Implementation ============\n\n  /**\n   * Get the context component for this plugin\n   * Performs lazy initialization on first call\n   */\n  async getComponent(): Promise<IContextComponent | null> {\n    this.assertNotDestroyed();\n\n    // Lazy initialization\n    if (!this._initialized) {\n      await this.initialize();\n    }\n\n    if (!this._content) {\n      return null;\n    }\n\n    // Build full content with explanation header\n    const explanation = buildContextExplanation(this.storage.getPath());\n    const content = `${explanation}\\n${this._content}`;\n\n    return {\n      name: this.name,\n      content,\n      priority: this.priority,\n      compactable: this.compactable,\n      metadata: {\n        agentId: this.agentId,\n        length: this._content.length,\n        path: this.storage.getPath(),\n      },\n    };\n  }\n\n  /**\n   * Compact - not applicable (compactable is false)\n   */\n  override async compact(_targetTokens: number, _estimator: ITokenEstimator): Promise<number> {\n    // Never compact instructions - they are critical\n    return 0;\n  }\n\n  /**\n   * Get serialized state for session persistence\n   */\n  override getState(): SerializedPersistentInstructionsState {\n    return {\n      content: this._content,\n      dirty: this._dirty,\n      agentId: this.agentId,\n    };\n  }\n\n  /**\n   * Restore state from serialization\n   * Note: This restores in-memory state, not disk state\n   */\n  override restoreState(state: unknown): void {\n    this.assertNotDestroyed();\n\n    if (!state || typeof state !== 'object') {\n      return;\n    }\n\n    const typedState = state as SerializedPersistentInstructionsState;\n\n    if ('content' in typedState) {\n      this._content = typedState.content;\n    }\n    if ('dirty' in typedState) {\n      this._dirty = typedState.dirty;\n    }\n\n    // Mark as initialized since we're restoring from session\n    this._initialized = true;\n  }\n\n  /**\n   * Clean up resources\n   */\n  override destroy(): void {\n    this._content = null;\n    this._initialized = false;\n    this._destroyed = true;\n  }\n\n  // ============ Private Methods ============\n\n  /**\n   * Assert that the plugin hasn't been destroyed\n   */\n  private assertNotDestroyed(): void {\n    if (this._destroyed) {\n      throw new Error('PersistentInstructionsPlugin has been destroyed');\n    }\n  }\n}\n","/**\n * PersistentInstructions Tools - Tools for LLM to manipulate persistent instructions\n *\n * These tools allow the LLM to manage custom instructions that persist\n * across sessions and are stored on disk.\n *\n * Tools:\n * - instructions_set: Replace all instructions\n * - instructions_append: Add a section\n * - instructions_get: Read current instructions\n * - instructions_clear: Remove all (requires confirm: true)\n */\n\nimport type { ToolFunction, FunctionToolDefinition } from '../../../domain/entities/Tool.js';\nimport type { ToolContext } from '../../../domain/interfaces/IToolContext.js';\nimport { ToolExecutionError } from '../../../domain/errors/AIErrors.js';\nimport { PersistentInstructionsPlugin, type PersistentInstructionsConfig } from './PersistentInstructionsPlugin.js';\nimport type { AgentContext } from '../../AgentContext.js';\n\n// ============ Tool Definitions ============\n\n/**\n * Tool definition for instructions_set\n */\nexport const instructionsSetDefinition: FunctionToolDefinition = {\n  type: 'function',\n  function: {\n    name: 'instructions_set',\n    description: `Set or replace all custom instructions for this agent.\n\nCustom instructions persist across sessions and are stored on disk.\nUse this to define:\n- Agent personality/behavior\n- User preferences\n- Custom rules and guidelines\n- Tool usage patterns\n\nThe instructions will be loaded automatically in future sessions.\nIMPORTANT: This replaces ALL existing instructions.`,\n    parameters: {\n      type: 'object',\n      properties: {\n        content: {\n          type: 'string',\n          description: 'The full instructions content (markdown supported)',\n        },\n      },\n      required: ['content'],\n    },\n  },\n};\n\n/**\n * Tool definition for instructions_append\n */\nexport const instructionsAppendDefinition: FunctionToolDefinition = {\n  type: 'function',\n  function: {\n    name: 'instructions_append',\n    description: `Append a new section to existing custom instructions.\n\nUse this to incrementally add:\n- New rules based on user feedback\n- Learned preferences\n- Additional guidelines\n\nThe section will be added with appropriate spacing.`,\n    parameters: {\n      type: 'object',\n      properties: {\n        section: {\n          type: 'string',\n          description: 'The section to append (will add newlines before)',\n        },\n      },\n      required: ['section'],\n    },\n  },\n};\n\n/**\n * Tool definition for instructions_get\n */\nexport const instructionsGetDefinition: FunctionToolDefinition = {\n  type: 'function',\n  function: {\n    name: 'instructions_get',\n    description: `Get current custom instructions.\n\nReturns the full instructions content and metadata.\nInstructions are also shown in context, so this is mainly for:\n- Verification before modifications\n- Getting programmatic access\n- Debugging`,\n    parameters: {\n      type: 'object',\n      properties: {},\n      required: [],\n    },\n  },\n};\n\n/**\n * Tool definition for instructions_clear\n */\nexport const instructionsClearDefinition: FunctionToolDefinition = {\n  type: 'function',\n  function: {\n    name: 'instructions_clear',\n    description: `Clear all custom instructions (DESTRUCTIVE).\n\nThis permanently removes all custom instructions from disk.\nRequires explicit confirmation.`,\n    parameters: {\n      type: 'object',\n      properties: {\n        confirm: {\n          type: 'boolean',\n          description: 'Must be true to confirm deletion',\n        },\n      },\n      required: ['confirm'],\n    },\n  },\n};\n\n// ============ Tool Factory ============\n\n/**\n * Create all persistent instructions tools\n *\n * @returns Array of tool functions\n */\nexport function createPersistentInstructionsTools(): ToolFunction[] {\n  return [\n    // instructions_set\n    {\n      definition: instructionsSetDefinition,\n      execute: async (args: Record<string, unknown>, context?: ToolContext) => {\n        const plugin = getPluginFromContext(context, 'instructions_set');\n\n        const content = args.content as string;\n\n        if (!content || content.trim().length === 0) {\n          return {\n            error: 'Content cannot be empty. Use instructions_clear to remove instructions.',\n          };\n        }\n\n        const success = await plugin.set(content);\n\n        if (!success) {\n          return {\n            error: `Instructions too long. Maximum ${plugin.getMaxLength()} characters, got ${content.length}.`,\n          };\n        }\n\n        return {\n          success: true,\n          message: 'Instructions saved successfully',\n          path: plugin.getPath(),\n          length: plugin.getLength(),\n        };\n      },\n      idempotency: { cacheable: false },\n      output: { expectedSize: 'small' },\n      permission: {\n        scope: 'always', // Auto-approve - instructions management is safe\n        riskLevel: 'low',\n      },\n      describeCall: () => 'set',\n    },\n\n    // instructions_append\n    {\n      definition: instructionsAppendDefinition,\n      execute: async (args: Record<string, unknown>, context?: ToolContext) => {\n        const plugin = getPluginFromContext(context, 'instructions_append');\n\n        const section = args.section as string;\n\n        if (!section || section.trim().length === 0) {\n          return {\n            error: 'Section cannot be empty',\n          };\n        }\n\n        const success = await plugin.append(section);\n\n        if (!success) {\n          return {\n            error: `Would exceed maximum length of ${plugin.getMaxLength()} characters. Current: ${plugin.getLength()}, Adding: ${section.length}.`,\n          };\n        }\n\n        return {\n          success: true,\n          message: 'Section appended successfully',\n          newLength: plugin.getLength(),\n        };\n      },\n      idempotency: { cacheable: false },\n      output: { expectedSize: 'small' },\n      permission: {\n        scope: 'always',\n        riskLevel: 'low',\n      },\n      describeCall: () => 'append',\n    },\n\n    // instructions_get\n    {\n      definition: instructionsGetDefinition,\n      execute: async (_args: Record<string, unknown>, context?: ToolContext) => {\n        const plugin = getPluginFromContext(context, 'instructions_get');\n\n        const content = plugin.get();\n\n        if (!content) {\n          return {\n            exists: false,\n            message: 'No custom instructions set',\n            path: plugin.getPath(),\n          };\n        }\n\n        return {\n          exists: true,\n          content,\n          length: content.length,\n          maxLength: plugin.getMaxLength(),\n          path: plugin.getPath(),\n        };\n      },\n      idempotency: { cacheable: true, ttlMs: 1000 },\n      output: { expectedSize: 'variable' },\n      permission: {\n        scope: 'always',\n        riskLevel: 'low',\n      },\n      describeCall: () => 'read',\n    },\n\n    // instructions_clear\n    {\n      definition: instructionsClearDefinition,\n      execute: async (args: Record<string, unknown>, context?: ToolContext) => {\n        const plugin = getPluginFromContext(context, 'instructions_clear');\n\n        const confirm = args.confirm as boolean;\n\n        if (confirm !== true) {\n          return {\n            error: 'Must set confirm: true to clear instructions',\n          };\n        }\n\n        const hadContent = plugin.has();\n        await plugin.clear();\n\n        return {\n          success: true,\n          message: hadContent\n            ? 'Instructions cleared successfully'\n            : 'No instructions to clear',\n          path: plugin.getPath(),\n        };\n      },\n      idempotency: { cacheable: false },\n      output: { expectedSize: 'small' },\n      permission: {\n        scope: 'always',\n        riskLevel: 'low',\n      },\n      describeCall: () => 'clear',\n    },\n  ];\n}\n\n// ============ Factory Functions ============\n\n/**\n * Create a PersistentInstructionsPlugin with its tools\n *\n * @param config - Configuration (agentId is required)\n * @returns Object containing the plugin and its tools\n *\n * @example\n * ```typescript\n * const { plugin, tools } = createPersistentInstructions({ agentId: 'my-agent' });\n * ctx.registerPlugin(plugin);\n * for (const tool of tools) {\n *   ctx.tools.register(tool);\n * }\n * ```\n */\nexport function createPersistentInstructions(config: PersistentInstructionsConfig): {\n  plugin: PersistentInstructionsPlugin;\n  tools: ToolFunction[];\n} {\n  const plugin = new PersistentInstructionsPlugin(config);\n  const tools = createPersistentInstructionsTools();\n\n  return { plugin, tools };\n}\n\n/**\n * Set up PersistentInstructions on an AgentContext\n *\n * Registers both the plugin and its tools on the context.\n *\n * @param agentContext - The AgentContext to set up\n * @param config - Configuration (agentId is required)\n * @returns The created plugin (for direct access)\n *\n * @example\n * ```typescript\n * const ctx = AgentContext.create({ model: 'gpt-4' });\n * const plugin = setupPersistentInstructions(ctx, { agentId: 'my-agent' });\n *\n * // Instructions are loaded automatically on first context prepare\n * // Plugin is accessible through ctx.persistentInstructions\n * ```\n */\nexport function setupPersistentInstructions(\n  agentContext: AgentContext,\n  config: PersistentInstructionsConfig\n): PersistentInstructionsPlugin {\n  const { plugin, tools } = createPersistentInstructions(config);\n\n  // Register plugin with context manager\n  agentContext.registerPlugin(plugin);\n\n  // Register tools with tool manager\n  for (const tool of tools) {\n    agentContext.tools.register(tool);\n  }\n\n  // Store reference on context for tool access\n  (agentContext as AgentContext & { persistentInstructions?: PersistentInstructionsPlugin }).persistentInstructions = plugin;\n\n  return plugin;\n}\n\n// ============ Helper Functions ============\n\n/**\n * Get the PersistentInstructionsPlugin from tool context\n */\nfunction getPluginFromContext(context: ToolContext | undefined, toolName: string): PersistentInstructionsPlugin {\n  if (!context) {\n    throw new ToolExecutionError(\n      toolName,\n      'PersistentInstructions tools require a tool context'\n    );\n  }\n\n  // Access plugin through the extended context\n  const plugin = (context as ToolContext & { persistentInstructions?: PersistentInstructionsPlugin }).persistentInstructions;\n\n  if (!plugin) {\n    throw new ToolExecutionError(\n      toolName,\n      'PersistentInstructions plugin not found. Enable features.persistentInstructions or use setupPersistentInstructions().'\n    );\n  }\n\n  return plugin;\n}\n","/**\n * Memory tools - built-in tools for memory manipulation\n *\n * These tools provide LLM access to the WorkingMemory system,\n * including support for hierarchical memory tiers (raw  summary  findings).\n */\n\nimport { ToolFunction, FunctionToolDefinition } from '../../domain/entities/Tool.js';\nimport { ToolContext } from '../../domain/interfaces/IToolContext.js';\nimport { ToolExecutionError } from '../../domain/errors/AIErrors.js';\nimport {\n  TIER_PRIORITIES,\n  addTierPrefix,\n  getTierFromKey,\n} from '../../domain/entities/Memory.js';\nimport type { MemoryTier, MemoryScope, MemoryPriority } from '../../domain/entities/Memory.js';\n\n/**\n * Tool definition for memory_store\n */\nexport const memoryStoreDefinition: FunctionToolDefinition = {\n  type: 'function',\n  function: {\n    name: 'memory_store',\n    description: `Store data in working memory for later use. Use this to save important information from tool outputs.\n\nTIER SYSTEM (for research/analysis tasks):\n- \"raw\": Low priority, evicted first. Use for unprocessed data you'll summarize later.\n- \"summary\": Normal priority. Use for processed summaries of raw data.\n- \"findings\": High priority, kept longest. Use for final conclusions and insights.\n\nThe tier automatically sets priority and adds a key prefix (e.g., \"findings.topic\" for tier=\"findings\").`,\n    parameters: {\n      type: 'object',\n      properties: {\n        key: {\n          type: 'string',\n          description: 'Namespaced key (e.g., \"user.profile\", \"search.ai_news\"). If using tier, prefix is added automatically.',\n        },\n        description: {\n          type: 'string',\n          description: 'Brief description of what this data contains (max 150 chars)',\n        },\n        value: {\n          description: 'The data to store (can be any JSON value)',\n        },\n        tier: {\n          type: 'string',\n          enum: ['raw', 'summary', 'findings'],\n          description: 'Optional: Memory tier. \"raw\" (low priority, evict first), \"summary\" (normal), \"findings\" (high priority, keep longest). Automatically sets key prefix and priority.',\n        },\n        derivedFrom: {\n          type: 'array',\n          items: { type: 'string' },\n          description: 'Optional: Keys this data was derived from (for tracking data lineage, useful with tiers)',\n        },\n        neededForTasks: {\n          type: 'array',\n          items: { type: 'string' },\n          description: 'Optional: Task IDs that need this data. Data will be auto-cleaned when all tasks complete.',\n        },\n        scope: {\n          type: 'string',\n          enum: ['session', 'plan', 'persistent'],\n          description: 'Optional: Lifecycle scope. \"session\" (default), \"plan\" (kept for entire plan), or \"persistent\" (never auto-cleaned)',\n        },\n        priority: {\n          type: 'string',\n          enum: ['low', 'normal', 'high', 'critical'],\n          description: 'Optional: Override eviction priority. Ignored if tier is set (tier determines priority).',\n        },\n        pinned: {\n          type: 'boolean',\n          description: 'Optional: If true, this data will never be evicted.',\n        },\n      },\n      required: ['key', 'description', 'value'],\n    },\n  },\n};\n\n/**\n * Tool definition for memory_retrieve\n */\nexport const memoryRetrieveDefinition: FunctionToolDefinition = {\n  type: 'function',\n  function: {\n    name: 'memory_retrieve',\n    description:\n      'Retrieve full data from working memory by key. Use when you need the complete data, not just the description.',\n    parameters: {\n      type: 'object',\n      properties: {\n        key: {\n          type: 'string',\n          description: 'The key to retrieve (include tier prefix if applicable, e.g., \"findings.topic\")',\n        },\n      },\n      required: ['key'],\n    },\n  },\n};\n\n/**\n * Tool definition for memory_delete\n */\nexport const memoryDeleteDefinition: FunctionToolDefinition = {\n  type: 'function',\n  function: {\n    name: 'memory_delete',\n    description: 'Delete data from working memory to free up space.',\n    parameters: {\n      type: 'object',\n      properties: {\n        key: {\n          type: 'string',\n          description: 'The key to delete',\n        },\n      },\n      required: ['key'],\n    },\n  },\n};\n\n/**\n * Tool definition for memory_query (consolidated from memory_list + memory_retrieve_batch)\n */\nexport const memoryQueryDefinition: FunctionToolDefinition = {\n  type: 'function',\n  function: {\n    name: 'memory_query',\n    description: `Query working memory. List entries, search by pattern, or retrieve values.\n\nExamples:\n- memory_query()  list all keys\n- memory_query({ pattern: \"findings.*\" })  list matching keys\n- memory_query({ pattern: \"findings.*\", includeValues: true })  retrieve values\n- memory_query({ includeStats: true })  include memory statistics`,\n    parameters: {\n      type: 'object',\n      properties: {\n        pattern: {\n          type: 'string',\n          description: 'Glob pattern to match keys (e.g., \"raw.*\", \"findings.*\", \"*\"). Default: \"*\" (all)',\n        },\n        tier: {\n          type: 'string',\n          enum: ['raw', 'summary', 'findings', 'data'],\n          description: 'Filter by tier (overrides pattern)',\n        },\n        scope: {\n          type: 'string',\n          enum: ['session', 'persistent'],\n          description: 'Filter by scope',\n        },\n        includeValues: {\n          type: 'boolean',\n          description: 'Include actual values (default: false = list keys only)',\n        },\n        includeMetadata: {\n          type: 'boolean',\n          description: 'Include metadata (priority, tier, pinned) for each entry',\n        },\n        includeStats: {\n          type: 'boolean',\n          description: 'Include memory statistics (entry count, size, utilization)',\n        },\n      },\n      required: [],\n    },\n  },\n};\n\n/**\n * Tool definition for memory_cleanup_raw\n */\nexport const memoryCleanupRawDefinition: FunctionToolDefinition = {\n  type: 'function',\n  function: {\n    name: 'memory_cleanup_raw',\n    description: 'Clean up raw tier data after creating summaries/findings. Only deletes entries with \"raw.\" prefix.',\n    parameters: {\n      type: 'object',\n      properties: {\n        keys: {\n          type: 'array',\n          items: { type: 'string' },\n          description: 'Keys to delete (only raw tier entries will be deleted)',\n        },\n      },\n      required: ['keys'],\n    },\n  },\n};\n\n/**\n * Match a key against a glob-like pattern\n * Supports * as wildcard (matches any characters)\n */\nfunction matchPattern(key: string, pattern: string): boolean {\n  // Convert glob pattern to regex\n  const regexPattern = pattern\n    .replace(/[.+?^${}()|[\\]\\\\]/g, '\\\\$&') // Escape special regex chars except *\n    .replace(/\\*/g, '.*'); // Convert * to .*\n  const regex = new RegExp(`^${regexPattern}$`);\n  return regex.test(key);\n}\n\n// ============================================================================\n// Individual Tool Creators\n// ============================================================================\n\n/**\n * Create memory_store tool\n */\nexport function createMemoryStoreTool(): ToolFunction {\n  return {\n    definition: memoryStoreDefinition,\n    execute: async (args: Record<string, unknown>, context?: ToolContext) => {\n      if (!context || !context.memory) {\n        throw new ToolExecutionError('memory_store', 'Memory tools require TaskAgent context');\n      }\n\n      try {\n        let key = args.key as string;\n        const tier = args.tier as MemoryTier | undefined;\n        const derivedFrom = args.derivedFrom as string[] | undefined;\n\n        // If tier is specified, add prefix and use tier priority\n        if (tier) {\n          key = addTierPrefix(key, tier);\n        }\n\n        // Build scope from arguments\n        let scope: MemoryScope | undefined;\n        if (args.neededForTasks && Array.isArray(args.neededForTasks) && args.neededForTasks.length > 0) {\n          scope = { type: 'task', taskIds: args.neededForTasks as string[] };\n        } else if (args.scope === 'plan') {\n          scope = { type: 'plan' };\n        } else if (args.scope === 'persistent') {\n          scope = { type: 'persistent' };\n        } else if (tier === 'findings') {\n          // Findings default to plan scope\n          scope = { type: 'plan' };\n        } else {\n          scope = 'session';\n        }\n\n        // Priority: tier priority > explicit priority > default\n        let priority: MemoryPriority | undefined = args.priority as MemoryPriority | undefined;\n        if (tier) {\n          priority = TIER_PRIORITIES[tier];\n        }\n\n        await context.memory.set(\n          key,\n          args.description as string,\n          args.value,\n          {\n            scope,\n            priority,\n            pinned: args.pinned as boolean | undefined,\n          }\n        );\n\n        return {\n          success: true,\n          key,\n          tier: tier ?? getTierFromKey(key) ?? 'none',\n          scope: typeof scope === 'string' ? scope : scope.type,\n          priority: priority ?? 'normal',\n          derivedFrom: derivedFrom ?? [],\n        };\n      } catch (error) {\n        return { error: error instanceof Error ? error.message : String(error) };\n      }\n    },\n    idempotency: { safe: true },\n    output: { expectedSize: 'small' },\n    describeCall: (args) => {\n      const tier = args.tier as string | undefined;\n      const key = args.key as string;\n      return tier ? `${tier}:${key}` : key;\n    },\n  };\n}\n\n/**\n * Create memory_retrieve tool\n */\nexport function createMemoryRetrieveTool(): ToolFunction {\n  return {\n    definition: memoryRetrieveDefinition,\n    execute: async (args: Record<string, unknown>, context?: ToolContext) => {\n      if (!context || !context.memory) {\n        throw new ToolExecutionError('memory_retrieve', 'Memory tools require TaskAgent context');\n      }\n\n      const value = await context.memory.get(args.key as string);\n      if (value === undefined) {\n        return { error: `Key \"${args.key}\" not found in memory` };\n      }\n      return value;\n    },\n    idempotency: { safe: true },\n    output: { expectedSize: 'variable' },\n    describeCall: (args) => args.key as string,\n  };\n}\n\n/**\n * Create memory_delete tool\n */\nexport function createMemoryDeleteTool(): ToolFunction {\n  return {\n    definition: memoryDeleteDefinition,\n    execute: async (args: Record<string, unknown>, context?: ToolContext) => {\n      if (!context || !context.memory) {\n        throw new ToolExecutionError('memory_delete', 'Memory tools require TaskAgent context');\n      }\n\n      await context.memory.delete(args.key as string);\n      return { success: true, deleted: args.key };\n    },\n    idempotency: { safe: true },\n    output: { expectedSize: 'small' },\n    describeCall: (args) => args.key as string,\n  };\n}\n\n/**\n * Create memory_query tool (consolidated from memory_list + memory_retrieve_batch)\n */\nexport function createMemoryQueryTool(): ToolFunction {\n  return {\n    definition: memoryQueryDefinition,\n    execute: async (args: Record<string, unknown>, context?: ToolContext) => {\n      if (!context || !context.memory) {\n        throw new ToolExecutionError('memory_query', 'Memory tools require TaskAgent context');\n      }\n\n      const pattern = args.pattern as string | undefined;\n      const tier = args.tier as MemoryTier | undefined;\n      const includeValues = args.includeValues as boolean | undefined;\n      const includeMetadata = args.includeMetadata as boolean | undefined;\n      const includeStats = args.includeStats as boolean | undefined;\n\n      // Get all entries to filter\n      let entries = await context.memory.list();\n\n      // Apply filters\n      if (tier) {\n        // Tier filter overrides pattern\n        const prefix = `${tier}.`;\n        entries = entries.filter((e) => e.key.startsWith(prefix));\n      } else if (pattern && pattern !== '*') {\n        // Pattern filter\n        entries = entries.filter((e) => matchPattern(e.key, pattern));\n      }\n\n      // Build base result\n      const result: Record<string, unknown> = {\n        count: entries.length,\n        filter: tier ? `tier:${tier}` : pattern ? `pattern:${pattern}` : 'all',\n      };\n\n      // Build entries list\n      if (includeValues) {\n        // Include full values (like old memory_retrieve_batch)\n        const entriesWithValues: Record<string, unknown> = {};\n        const metadata: Record<string, { tier: string; priority: string; pinned: boolean; description: string }> = {};\n\n        for (const entry of entries) {\n          const value = await context.memory.get(entry.key);\n          if (value !== undefined) {\n            entriesWithValues[entry.key] = value;\n\n            if (includeMetadata) {\n              metadata[entry.key] = {\n                tier: getTierFromKey(entry.key) ?? 'none',\n                priority: entry.effectivePriority ?? 'normal',\n                pinned: entry.pinned ?? false,\n                description: entry.description,\n              };\n            }\n          }\n        }\n\n        result.entries = entriesWithValues;\n        if (includeMetadata) {\n          result.metadata = metadata;\n        }\n      } else {\n        // List mode (like old memory_list)\n        result.entries = entries.map((e) => {\n          const entryInfo: Record<string, unknown> = {\n            key: e.key,\n            description: e.description,\n          };\n\n          if (includeMetadata) {\n            entryInfo.priority = e.effectivePriority ?? 'normal';\n            entryInfo.tier = getTierFromKey(e.key) ?? 'none';\n            entryInfo.pinned = e.pinned ?? false;\n          }\n\n          return entryInfo;\n        });\n      }\n\n      // Include stats if requested\n      if (includeStats) {\n        const allEntries = await context.memory.list();\n        const byTier: Record<string, number> = {};\n\n        for (const entry of allEntries) {\n          const entryTier = getTierFromKey(entry.key) ?? 'other';\n          byTier[entryTier] = (byTier[entryTier] || 0) + 1;\n        }\n\n        result.stats = {\n          totalEntries: allEntries.length,\n          byTier,\n        };\n      }\n\n      return result;\n    },\n    idempotency: { safe: true },\n    output: { expectedSize: 'variable' },\n    describeCall: (args) => {\n      const pattern = args.pattern as string | undefined;\n      const tier = args.tier as string | undefined;\n      const includeValues = args.includeValues as boolean | undefined;\n      if (tier) return `tier:${tier}${includeValues ? '+values' : ''}`;\n      if (pattern) return `pattern:${pattern}${includeValues ? '+values' : ''}`;\n      return includeValues ? 'all+values' : 'all';\n    },\n  };\n}\n\n/**\n * Create memory_cleanup_raw tool\n */\nexport function createMemoryCleanupRawTool(): ToolFunction {\n  return {\n    definition: memoryCleanupRawDefinition,\n    execute: async (args: Record<string, unknown>, context?: ToolContext) => {\n      if (!context || !context.memory) {\n        throw new ToolExecutionError('memory_cleanup_raw', 'Memory tools require TaskAgent context');\n      }\n\n      const keys = args.keys as string[];\n      let deletedCount = 0;\n      const skipped: string[] = [];\n\n      for (const key of keys) {\n        const tier = getTierFromKey(key);\n        if (tier === 'raw') {\n          const exists = await context.memory.has(key);\n          if (exists) {\n            await context.memory.delete(key);\n            deletedCount++;\n          }\n        } else {\n          skipped.push(key);\n        }\n      }\n\n      return {\n        success: true,\n        deleted: deletedCount,\n        skipped: skipped.length > 0 ? skipped : undefined,\n        skippedReason: skipped.length > 0 ? 'Not raw tier entries' : undefined,\n      };\n    },\n    idempotency: { safe: true },\n    output: { expectedSize: 'small' },\n    describeCall: (args) => `${(args.keys as string[]).length} keys`,\n  };\n}\n\n// ============================================================================\n// Convenience Functions\n// ============================================================================\n\n/**\n * Create all memory tools (convenience function for backward compatibility)\n *\n * Consolidated tools (Phase 1):\n * - memory_store: Store data in working memory\n * - memory_retrieve: Retrieve single entry by key\n * - memory_delete: Delete entry by key\n * - memory_query: Query/list/batch retrieve (merged memory_list + memory_retrieve_batch)\n * - memory_cleanup_raw: Clean up raw tier data\n */\nexport function createMemoryTools(): ToolFunction[] {\n  return [\n    createMemoryStoreTool(),\n    createMemoryRetrieveTool(),\n    createMemoryDeleteTool(),\n    createMemoryQueryTool(),\n    createMemoryCleanupRawTool(),\n  ];\n}\n","/**\n * Context inspection tools for TaskAgent\n *\n * Consolidated tool (Phase 1):\n * - context_stats: Unified context introspection with configurable sections\n *\n * Legacy tools preserved for backward compatibility but not actively registered:\n * - context_inspect  context_stats({ sections: [\"budget\"] })\n * - context_breakdown  context_stats({ sections: [\"breakdown\"] })\n * - cache_stats  context_stats({ sections: [\"cache\"] })\n * - memory_stats  context_stats({ sections: [\"memory\"] })\n */\n\nimport { ToolFunction, FunctionToolDefinition } from '../../domain/entities/Tool.js';\nimport type { ToolContext } from '../../domain/interfaces/IToolContext.js';\nimport { getTierFromKey } from '../../domain/entities/Memory.js';\n\n// ============================================================================\n// Consolidated Tool Definition\n// ============================================================================\n\n/**\n * Tool definition for context_stats (consolidated introspection)\n */\nexport const contextStatsDefinition: FunctionToolDefinition = {\n  type: 'function',\n  function: {\n    name: 'context_stats',\n    description: `Get comprehensive context statistics and health metrics.\n\nExamples:\n- context_stats()  budget summary (used/total/remaining tokens)\n- context_stats({ sections: [\"breakdown\"] })  token breakdown by component\n- context_stats({ sections: [\"memory\"] })  memory stats (entries, tiers)\n- context_stats({ sections: [\"cache\"] })  cache stats (hits, misses)\n- context_stats({ sections: [\"all\"] })  everything`,\n    parameters: {\n      type: 'object',\n      properties: {\n        sections: {\n          type: 'array',\n          items: {\n            type: 'string',\n            enum: ['budget', 'breakdown', 'memory', 'cache', 'all'],\n          },\n          description: 'Sections to include. Default: [\"budget\"]',\n        },\n      },\n      required: [],\n    },\n  },\n};\n\n// ============================================================================\n// Consolidated Tool Creator\n// ============================================================================\n\n/**\n * Create context_stats tool (consolidated introspection)\n * Always available - gracefully handles disabled features\n */\nexport function createContextStatsTool(): ToolFunction {\n  return {\n    definition: contextStatsDefinition,\n    execute: async (args: Record<string, unknown>, context?: ToolContext) => {\n      const agentCtx = context?.agentContext;\n      if (!agentCtx) {\n        return {\n          error: 'AgentContext not available',\n          message: 'Tool context missing agentContext',\n        };\n      }\n\n      const requestedSections = (args.sections as string[] | undefined) ?? ['budget'];\n      const sections = new Set(\n        requestedSections.includes('all')\n          ? ['budget', 'breakdown', 'memory', 'cache']\n          : requestedSections\n      );\n\n      const result: Record<string, unknown> = {};\n\n      // Budget section (always available)\n      if (sections.has('budget')) {\n        const budget = agentCtx.getLastBudget();\n        if (!budget) {\n          result.budget = {\n            status: 'no_budget_data',\n            message: 'No context budget calculated yet. Run prepare() first.',\n          };\n        } else {\n          result.budget = {\n            total_tokens: budget.total,\n            reserved_tokens: budget.reserved,\n            used_tokens: budget.used,\n            available_tokens: budget.available,\n            utilization_percent: Math.round(budget.utilizationPercent * 10) / 10,\n            status: budget.status,\n            warning:\n              budget.status === 'warning'\n                ? 'Context approaching limit - automatic compaction may trigger'\n                : budget.status === 'critical'\n                  ? 'Context at critical level - compaction will trigger'\n                  : null,\n          };\n        }\n      }\n\n      // Breakdown section (always available)\n      if (sections.has('breakdown')) {\n        const budget = agentCtx.getLastBudget();\n        if (!budget) {\n          result.breakdown = {\n            status: 'no_budget_data',\n            message: 'No context budget calculated yet. Run prepare() first.',\n          };\n        } else {\n          const components = Object.entries(budget.breakdown).map(([name, tokens]) => ({\n            name,\n            tokens,\n            percent: budget.used > 0 ? Math.round((tokens / budget.used) * 1000) / 10 : 0,\n          }));\n\n          result.breakdown = {\n            total_used: budget.used,\n            by_component: budget.breakdown,\n            components,\n          };\n        }\n      }\n\n      // Memory section (requires memory feature)\n      if (sections.has('memory')) {\n        if (!context?.memory) {\n          result.memory = {\n            status: 'feature_disabled',\n            message: 'Memory feature is not enabled.',\n          };\n        } else {\n          const entries = await context.memory.list();\n\n          // Count by tier\n          const byTier: Record<string, number> = {};\n          for (const entry of entries) {\n            const tier = getTierFromKey(entry.key) ?? 'other';\n            byTier[tier] = (byTier[tier] || 0) + 1;\n          }\n\n          result.memory = {\n            total_entries: entries.length,\n            by_tier: byTier,\n            entries: entries.map((e) => ({\n              key: e.key,\n              description: e.description,\n              priority: e.effectivePriority ?? 'normal',\n            })),\n          };\n        }\n      }\n\n      // Cache section (requires memory feature - cache is part of memory)\n      if (sections.has('cache')) {\n        if (!context?.idempotencyCache) {\n          result.cache = {\n            status: 'feature_disabled',\n            message: 'Cache is not enabled (requires memory feature).',\n          };\n        } else {\n          const stats = context.idempotencyCache.getStats();\n          result.cache = {\n            entries: stats.entries,\n            hits: stats.hits,\n            misses: stats.misses,\n            hit_rate_percent: Math.round(stats.hitRate * 100),\n            effectiveness:\n              stats.hitRate > 0.5\n                ? 'high'\n                : stats.hitRate > 0.2\n                  ? 'medium'\n                  : stats.hitRate > 0\n                    ? 'low'\n                    : 'none',\n          };\n        }\n      }\n\n      return result;\n    },\n    idempotency: { safe: true },\n    output: { expectedSize: 'small' },\n    describeCall: (args) => {\n      const sections = args.sections as string[] | undefined;\n      if (!sections || sections.length === 0) return 'budget';\n      if (sections.includes('all')) return 'all';\n      return sections.join('+');\n    },\n  };\n}\n\n// ============================================================================\n// Legacy Tool Creators (preserved for backward compatibility)\n// These are no longer actively registered but kept for any direct imports\n// ============================================================================\n\n/**\n * @deprecated Use createContextStatsTool() instead\n * context_inspect tool - Get context budget and utilization\n */\nexport function createContextInspectTool(): ToolFunction {\n  return {\n    definition: {\n      type: 'function',\n      function: {\n        name: 'context_inspect',\n        description: 'Get detailed breakdown of current context budget and utilization. Shows total tokens, used tokens, available tokens, utilization percentage, and status (ok/warning/critical).',\n        parameters: {\n          type: 'object',\n          properties: {},\n          required: [],\n        },\n      },\n    },\n    execute: async (_args: unknown, context?: ToolContext) => {\n      const agentCtx = context?.agentContext;\n      if (!agentCtx) {\n        return {\n          error: 'AgentContext not available',\n          message: 'Tool context missing agentContext',\n        };\n      }\n\n      const budget = agentCtx.getLastBudget();\n\n      if (!budget) {\n        return {\n          status: 'no_budget_data',\n          message: 'No context budget calculated yet. Run prepare() first.',\n        };\n      }\n\n      return {\n        total_tokens: budget.total,\n        reserved_tokens: budget.reserved,\n        used_tokens: budget.used,\n        available_tokens: budget.available,\n        utilization_percent: Math.round(budget.utilizationPercent * 10) / 10,\n        status: budget.status,\n        warning:\n          budget.status === 'warning'\n            ? 'Context approaching limit - automatic compaction may trigger'\n            : budget.status === 'critical'\n              ? 'Context at critical level - compaction will trigger'\n              : null,\n      };\n    },\n    idempotency: {\n      safe: true,\n    },\n  };\n}\n\n/**\n * @deprecated Use createContextStatsTool() instead\n * context_breakdown tool - Get detailed token breakdown by component\n */\nexport function createContextBreakdownTool(): ToolFunction {\n  return {\n    definition: {\n      type: 'function',\n      function: {\n        name: 'context_breakdown',\n        description: 'Get detailed token breakdown by component (system prompt, instructions, memory index, conversation history, current input). Useful for understanding what is consuming context space.',\n        parameters: {\n          type: 'object',\n          properties: {},\n          required: [],\n        },\n      },\n    },\n    execute: async (_args: unknown, context?: ToolContext) => {\n      const agentCtx = context?.agentContext;\n      if (!agentCtx) {\n        return {\n          error: 'AgentContext not available',\n          message: 'Tool context missing agentContext',\n        };\n      }\n\n      const budget = agentCtx.getLastBudget();\n\n      if (!budget) {\n        return {\n          status: 'no_budget_data',\n          message: 'No context budget calculated yet. Run prepare() first.',\n        };\n      }\n\n      const components = Object.entries(budget.breakdown).map(([name, tokens]) => ({\n        name,\n        tokens,\n        percent: budget.used > 0 ? Math.round((tokens / budget.used) * 1000) / 10 : 0,\n      }));\n\n      return {\n        total_used: budget.used,\n        breakdown: budget.breakdown,\n        components,\n      };\n    },\n    idempotency: {\n      safe: true,\n    },\n  };\n}\n\n/**\n * @deprecated Use createContextStatsTool() instead\n * cache_stats tool - Get idempotency cache statistics\n */\nexport function createCacheStatsTool(): ToolFunction {\n  return {\n    definition: {\n      type: 'function',\n      function: {\n        name: 'cache_stats',\n        description: 'Get statistics about the tool call idempotency cache.',\n        parameters: {\n          type: 'object',\n          properties: {},\n          required: [],\n        },\n      },\n    },\n    execute: async (_args: unknown, context?: ToolContext) => {\n      if (!context?.idempotencyCache) {\n        return {\n          error: 'Idempotency cache not available',\n          message: 'This tool is only available within TaskAgent execution',\n        };\n      }\n\n      const stats = context.idempotencyCache.getStats();\n\n      return {\n        entries: stats.entries,\n        hits: stats.hits,\n        misses: stats.misses,\n        hit_rate: Math.round(stats.hitRate * 1000) / 10,\n        hit_rate_percent: `${Math.round(stats.hitRate * 100)}%`,\n        effectiveness:\n          stats.hitRate > 0.5\n            ? 'high'\n            : stats.hitRate > 0.2\n              ? 'medium'\n              : stats.hitRate > 0\n                ? 'low'\n                : 'none',\n      };\n    },\n    idempotency: {\n      safe: true,\n    },\n  };\n}\n\n/**\n * @deprecated Use createContextStatsTool() instead\n * memory_stats tool - Get working memory statistics\n */\nexport function createMemoryStatsTool(): ToolFunction {\n  return {\n    definition: {\n      type: 'function',\n      function: {\n        name: 'memory_stats',\n        description: 'Get detailed working memory utilization statistics.',\n        parameters: {\n          type: 'object',\n          properties: {},\n          required: [],\n        },\n      },\n    },\n    execute: async (_args: unknown, context?: ToolContext) => {\n      if (!context?.memory) {\n        return {\n          error: 'Working memory not available',\n          message: 'This tool is only available within TaskAgent execution',\n        };\n      }\n\n      const index = await context.memory.list();\n\n      return {\n        entry_count: index.length,\n        entries_by_scope: {\n          total: index.length,\n        },\n        entries: index.map((entry) => ({\n          key: entry.key,\n          description: entry.description,\n        })),\n      };\n    },\n    idempotency: {\n      safe: true,\n    },\n  };\n}\n\n// ============================================================================\n// Convenience Functions\n// ============================================================================\n\n/**\n * Create all context inspection tools (backward compatibility)\n *\n * Consolidated tools (Phase 1):\n * - context_stats: Unified context introspection with configurable sections\n *\n * Note: For feature-aware tool registration, AgentContext._registerFeatureTools()\n * now registers context_stats directly.\n */\nexport function createContextTools(): ToolFunction[] {\n  return [\n    createContextStatsTool(),\n  ];\n}\n","/**\n * FeatureInstructions - Runtime usage instructions for enabled AgentContext features\n *\n * These instructions are injected into the LLM context to provide guidance on\n * efficient, autonomous use of memory, context, and other features.\n *\n * Token budget (~1,450 tokens total when all features enabled):\n * - Introspection (always): ~300 tokens\n * - Working Memory: ~500 tokens\n * - In-Context Memory: ~350 tokens\n * - Persistent Instructions: ~300 tokens\n */\n\nimport type { IContextComponent } from './types.js';\nimport type { AgentContextFeatures } from '../AgentContext.js';\n\n// ============================================================================\n// Instruction Constants\n// ============================================================================\n\n/**\n * Introspection instructions (always included)\n * ~300 tokens\n */\nexport const INTROSPECTION_INSTRUCTIONS = `## Context Budget Management\n\n### Monitoring\nCheck budget with \\`context_stats()\\`:\n- \\`remaining_percent\\` > 50%: Comfortable\n- \\`remaining_percent\\` 20-50%: Consider cleanup\n- \\`remaining_percent\\` < 20%: Aggressive cleanup needed\n\n### When to Check\n- After storing large outputs\n- Before intensive multi-step operations\n- Periodically during long conversations\n\n### Response to Low Budget\n1. Summarize raw memory entries\n2. Delete consumed in-context entries\n3. Run \\`memory_cleanup_raw()\\` if applicable`;\n\n/**\n * Working Memory instructions\n * ~500 tokens\n */\nexport const WORKING_MEMORY_INSTRUCTIONS = `## Working Memory Usage\n\n### Decision Matrix\n| Data Type | Storage | Why |\n|-----------|---------|-----|\n| Large outputs (>2KB) | memory_store | Keeps context lean |\n| Intermediate results | memory_store (tier: raw) | Can summarize later |\n| Final findings | memory_store (tier: findings) | Persists across cleanup |\n| Fast-changing state | context_set | Immediate visibility |\n| User preferences | instructions_append | Cross-session persistence |\n\n### Naming Conventions\n- \\`raw.<source>.<id>\\` - Raw data (e.g., \\`raw.web.page1\\`)\n- \\`summary.<topic>\\` - Summarized content\n- \\`findings.<category>\\` - Final insights\n- \\`data.<type>\\` - Reference data\n\n### Workflow\n1. Store raw data: \\`memory_store({ key: \"raw.web.page1\", value: \"...\", tier: \"raw\" })\\`\n2. Process and summarize\n3. Store summary: \\`memory_store({ key: \"summary.research\", value: \"...\", tier: \"summary\" })\\`\n4. Cleanup raw: \\`memory_cleanup_raw()\\` (removes tier=raw entries)\n5. Keep findings: \\`memory_store({ key: \"findings.conclusion\", value: \"...\", tier: \"findings\" })\\`\n\n### Query Patterns\n- List all: \\`memory_query()\\`\n- List by tier: \\`memory_query({ tier: \"findings\" })\\`\n- Search pattern: \\`memory_query({ pattern: \"raw.*\" })\\`\n- Retrieve values: \\`memory_query({ pattern: \"findings.*\", includeValues: true })\\`\n- With stats: \\`memory_query({ includeStats: true })\\``;\n\n/**\n * In-Context Memory instructions\n * ~350 tokens\n */\nexport const IN_CONTEXT_MEMORY_INSTRUCTIONS = `## In-Context Memory Usage\n\nValues stored here are **immediately visible** in your context - no retrieval needed.\n\n### When to Use\n- Current state/status that changes during execution\n- Flags, counters, progress indicators\n- Small accumulated results (<500 tokens each)\n\n### When NOT to Use\n- Large data (use Working Memory instead)\n- Rarely accessed reference data\n\n### Naming Conventions\n- \\`state.<name>\\` - Current state\n- \\`progress.<task>\\` - Progress tracking\n- \\`flags.<name>\\` - Boolean flags\n- \\`prefs.<name>\\` - Session preferences\n\n### Priority Levels\n- \\`low\\` - Evicted first when space needed\n- \\`normal\\` - Default\n- \\`high\\` - Evicted only if necessary\n- \\`critical\\` - Never auto-evicted\n\n### Best Practices\n- Keep values small (<500 tokens)\n- Delete entries when no longer needed: \\`context_delete({ key: \"state.temp\" })\\`\n- Use appropriate priority based on importance`;\n\n/**\n * Persistent Instructions instructions\n * ~300 tokens\n */\nexport const PERSISTENT_INSTRUCTIONS_INSTRUCTIONS = `## Persistent Instructions Usage\n\nPersistent instructions survive across sessions. Use for stable user preferences and workflows.\n\n### When to Use\n- User preferences (coding style, communication preferences)\n- Project-specific guidelines\n- Workflow templates\n\n### When NOT to Use\n- Secrets or credentials (security risk)\n- Session-specific temporary data\n- Frequently changing information\n\n### Best Practices\n- Prefer \\`instructions_append\\` over \\`instructions_set\\` (preserves existing content)\n- Use markdown headers for organization\n- Keep concise - these consume context every session\n- Review periodically with \\`instructions_get\\``;\n\n// ============================================================================\n// Builder Function\n// ============================================================================\n\n/**\n * Build feature instructions component based on enabled features\n *\n * @param features - Resolved feature configuration (all required)\n * @returns Context component with feature instructions, or null if nothing to include\n *\n * @example\n * ```typescript\n * const features = { memory: true, inContextMemory: true, history: true, permissions: true, persistentInstructions: false };\n * const component = buildFeatureInstructions(features);\n * if (component) {\n *   components.push(component);\n * }\n * ```\n */\nexport function buildFeatureInstructions(\n  features: Required<AgentContextFeatures>\n): IContextComponent | null {\n  const sections: string[] = [];\n\n  // Always include introspection (context_stats is always available)\n  sections.push(INTROSPECTION_INSTRUCTIONS);\n\n  // Working Memory (if enabled)\n  if (features.memory) {\n    sections.push(WORKING_MEMORY_INSTRUCTIONS);\n  }\n\n  // In-Context Memory (if enabled)\n  if (features.inContextMemory) {\n    sections.push(IN_CONTEXT_MEMORY_INSTRUCTIONS);\n  }\n\n  // Persistent Instructions (if enabled)\n  if (features.persistentInstructions) {\n    sections.push(PERSISTENT_INSTRUCTIONS_INSTRUCTIONS);\n  }\n\n  // If only introspection is included (minimal features), still return it\n  // as it provides valuable guidance for context management\n  if (sections.length === 0) {\n    return null;\n  }\n\n  const content = sections.join('\\n\\n');\n\n  return {\n    name: 'feature_instructions',\n    content,\n    priority: 1, // High priority - keep in context\n    compactable: true, // Can be compacted if absolutely necessary\n    metadata: {\n      featureCount: sections.length,\n      memoryEnabled: features.memory,\n      inContextMemoryEnabled: features.inContextMemory,\n      persistentInstructionsEnabled: features.persistentInstructions,\n    },\n  };\n}\n\n/**\n * Get all instruction constants (for testing or direct access)\n */\nexport function getAllInstructions(): Record<string, string> {\n  return {\n    introspection: INTROSPECTION_INSTRUCTIONS,\n    workingMemory: WORKING_MEMORY_INSTRUCTIONS,\n    inContextMemory: IN_CONTEXT_MEMORY_INSTRUCTIONS,\n    persistentInstructions: PERSISTENT_INSTRUCTIONS_INSTRUCTIONS,\n  };\n}\n","/**\n * AgentContext - The \"Swiss Army Knife\" for Agent State Management\n *\n * Unified facade that composes all context-related managers:\n * - History: Conversation tracking (built-in)\n * - Tools: Tool management via ToolManager (composed)\n * - Memory: Working memory via WorkingMemory (composed)\n * - Cache: Tool result caching via IdempotencyCache (composed)\n * - Permissions: Tool permissions via ToolPermissionManager (composed)\n *\n * Design Principles:\n * - DRY: Reuses existing managers, doesn't duplicate\n * - Simple API: One import, one object\n * - Maximum Power: Full access to sub-managers when needed\n * - Coordinated: prepare(), save(), load() handle everything\n *\n * Usage:\n * ```typescript\n * const ctx = AgentContext.create({\n *   model: 'gpt-4',\n *   tools: [readFile, writeFile],\n * });\n *\n * ctx.addMessage('user', 'Hello');\n * await ctx.tools.execute('read_file', { path: './file.txt' });\n * ctx.memory.store('key', 'description', value);\n * const prepared = await ctx.prepare();\n * await ctx.save();\n * ```\n */\n\nimport { EventEmitter } from 'eventemitter3';\nimport { ToolManager } from './ToolManager.js';\nimport type { ToolFunction, ToolResult } from '../domain/entities/Tool.js';\nimport type { ToolContext } from '../domain/interfaces/IToolContext.js';\nimport type { SerializedToolState } from './ToolManager.js';\nimport { ToolPermissionManager } from './permissions/ToolPermissionManager.js';\nimport type { AgentPermissionsConfig, SerializedApprovalState } from './permissions/types.js';\nimport type { SerializedMemory } from '../capabilities/taskAgent/WorkingMemory.js';\nimport type { IContextStorage, ContextSessionMetadata } from '../domain/interfaces/IContextStorage.js';\nimport { IdempotencyCache, DEFAULT_IDEMPOTENCY_CONFIG } from './IdempotencyCache.js';\nimport type { IdempotencyCacheConfig, CacheStats } from './IdempotencyCache.js';\nimport { WorkingMemory } from '../capabilities/taskAgent/WorkingMemory.js';\nimport type { WorkingMemoryConfig } from '../domain/entities/Memory.js';\nimport { DEFAULT_MEMORY_CONFIG } from '../domain/entities/Memory.js';\nimport { InMemoryStorage } from '../infrastructure/storage/InMemoryStorage.js';\nimport type { IMemoryStorage } from '../domain/interfaces/IMemoryStorage.js';\n// NEW: Message types for conversation storage\nimport type { InputItem, OutputItem, Message } from '../domain/entities/Message.js';\nimport { MessageRole } from '../domain/entities/Message.js';\nimport type { Content } from '../domain/entities/Content.js';\nimport { ContentType } from '../domain/entities/Content.js';\nimport type {\n  IContextComponent,\n  ITokenEstimator,\n  IContextStrategy,\n  ContextBudget,\n  PreparedContext,\n  TokenContentType,\n} from './context/types.js';\nimport { DEFAULT_CONTEXT_CONFIG } from './context/types.js';\nimport { createStrategy as createStrategyFactory } from './context/strategies/index.js';\nimport { estimateComponentTokens } from './context/utils/ContextUtils.js';\nimport type { IContextPlugin } from './context/plugins/IContextPlugin.js';\nimport { getModelInfo } from '../domain/entities/Model.js';\nimport { PlanPlugin } from './context/plugins/PlanPlugin.js';\nimport { createInContextMemory } from './context/plugins/inContextMemoryTools.js';\nimport type { InContextMemoryPlugin, InContextMemoryConfig as InContextMemoryPluginConfig } from './context/plugins/InContextMemoryPlugin.js';\nimport { createPersistentInstructions } from './context/plugins/persistentInstructionsTools.js';\nimport type { PersistentInstructionsPlugin, PersistentInstructionsConfig as PersistentInstructionsPluginConfig } from './context/plugins/PersistentInstructionsPlugin.js';\n\n// Memory & Context introspection tool creators\n// These are registered automatically based on enabled features for ALL agent types\nimport {\n  createMemoryStoreTool,\n  createMemoryRetrieveTool,\n  createMemoryDeleteTool,\n  createMemoryQueryTool,\n  createMemoryCleanupRawTool,\n} from '../capabilities/taskAgent/memoryTools.js';\nimport {\n  createContextStatsTool,\n} from '../capabilities/taskAgent/contextTools.js';\nimport { buildFeatureInstructions } from './context/FeatureInstructions.js';\n\n// ============================================================================\n// Task Types & Priority Profiles\n// ============================================================================\n\n/**\n * Task type determines compaction priorities and system prompt additions\n */\nexport type TaskType = 'research' | 'coding' | 'analysis' | 'general';\n\n/**\n * Priority profiles for different task types\n * Lower number = keep longer (compact last), Higher number = compact first\n *\n * Research: Preserve tool outputs (search/scrape results) longest\n * Coding: Preserve conversation history (context) longest\n * Analysis: Balanced, preserve analysis results\n * General: Default balanced approach\n */\nexport const PRIORITY_PROFILES: Record<TaskType, Record<string, number>> = {\n  research: {\n    memory_index: 3,           // Keep longest (summaries!)\n    tool_outputs: 5,           // Keep long (research data!)\n    conversation_history: 10,  // Compact first (old chat less critical)\n  },\n  coding: {\n    memory_index: 5,\n    conversation_history: 8,   // Keep more context\n    tool_outputs: 10,          // Compact first (output less critical once seen)\n  },\n  analysis: {\n    memory_index: 4,\n    tool_outputs: 6,           // Analysis results important\n    conversation_history: 7,\n  },\n  general: {\n    memory_index: 8,\n    conversation_history: 6,   // Balanced\n    tool_outputs: 10,\n  },\n};\n\n/**\n * Task-type-specific system prompt additions\n */\nexport const TASK_TYPE_PROMPTS: Record<TaskType, string> = {\n  research: `## Research Protocol\n\nYou are conducting research. Follow this workflow to preserve findings:\n\n### 1. SEARCH PHASE\n- Execute searches to find relevant sources\n- After EACH search, immediately store key findings in memory\n\n### 2. READ PHASE\nFor each promising result:\n- Read/scrape the content\n- Extract key points (2-3 sentences per source)\n- Store IMMEDIATELY in memory - do NOT keep full articles in conversation\n\n### 3. SYNTHESIZE PHASE\nBefore writing final report:\n- Use memory_list() to see all stored findings\n- Retrieve relevant findings with memory_retrieve(key)\n- Cross-reference and consolidate\n\n### 4. CONTEXT MANAGEMENT\n- Your context may be compacted automatically\n- Always store important findings in memory IMMEDIATELY\n- Stored data survives compaction; conversation history may not`,\n\n  coding: `## Coding Protocol\n\nYou are implementing code changes. Guidelines:\n- Read relevant files before making changes\n- Implement incrementally\n- Store key design decisions in memory if they'll be needed later\n- Code file contents are large - summarize structure after reading`,\n\n  analysis: `## Analysis Protocol\n\nYou are performing analysis. Guidelines:\n- Store intermediate results in memory\n- Summarize data immediately after loading (raw data is large)\n- Keep only essential context for current analysis step`,\n\n  general: `## Task Execution\n\nGuidelines:\n- Store important information in memory for later reference\n- Monitor your context usage with context_inspect()`,\n};\n\n// ============================================================================\n// Feature Configuration\n// ============================================================================\n\n/**\n * AgentContext feature configuration - controls which features are enabled\n *\n * Each feature can be enabled/disabled independently. When a feature is disabled:\n * - Its components are not created (saves memory)\n * - Its tools are not registered (cleaner LLM tool list)\n * - Related context preparation is skipped\n */\nexport interface AgentContextFeatures {\n  /**\n   * Enable WorkingMemory + IdempotencyCache\n   * When enabled: memory storage, tool result caching, memory_* tools, cache_stats tool\n   * When disabled: no memory/cache, tools not registered\n   * @default true\n   */\n  memory?: boolean;\n\n  /**\n   * Enable InContextMemoryPlugin for in-context key-value storage\n   * When enabled: context_set/get/delete/list tools\n   * @default false (opt-in)\n   */\n  inContextMemory?: boolean;\n\n  /**\n   * Enable conversation history tracking\n   * When disabled: addMessage() is no-op, history not in context\n   * @default true\n   */\n  history?: boolean;\n\n  /**\n   * Enable ToolPermissionManager for approval workflow\n   * When disabled: all tools auto-approved\n   * @default true\n   */\n  permissions?: boolean;\n\n  /**\n   * Enable PersistentInstructionsPlugin for disk-persisted custom instructions\n   * When enabled: instructions_set/get/append/clear tools\n   * Requires agentId in config\n   * @default false (opt-in)\n   */\n  persistentInstructions?: boolean;\n}\n\n/**\n * Default feature configuration\n *\n * - memory: true (includes WorkingMemory + IdempotencyCache)\n * - inContextMemory: false (opt-in)\n * - history: true\n * - permissions: true\n */\nexport const DEFAULT_FEATURES: Required<AgentContextFeatures> = {\n  memory: true,\n  inContextMemory: false,\n  history: true,\n  permissions: true,\n  persistentInstructions: false,\n};\n\n// ============================================================================\n// Types\n// ============================================================================\n\n/**\n * History message\n * @deprecated Use InputItem from Message.ts instead. Kept for backward compatibility.\n */\nexport interface HistoryMessage {\n  id: string;\n  role: 'user' | 'assistant' | 'system' | 'tool';\n  content: string;\n  timestamp: number;\n  metadata?: Record<string, unknown>;\n}\n\n/**\n * Message metadata for conversation tracking\n */\nexport interface MessageMetadata {\n  timestamp: number;\n  tokenCount: number;\n  iteration?: number;\n  /** Original legacy role (for backward compatibility with 'tool' role) */\n  legacyRole?: 'user' | 'assistant' | 'system' | 'tool';\n}\n\n/**\n * Prepared conversation result from prepareConversation()\n */\nexport interface PreparedConversation {\n  /** InputItem[] ready for LLM */\n  input: InputItem[];\n  /** Current budget */\n  budget: ContextBudget;\n  /** Whether compaction occurred */\n  compacted: boolean;\n  /** Compaction log if compacted */\n  compactionLog: string[];\n}\n\n/**\n * Options for prepareConversation()\n */\nexport interface PrepareConversationOptions {\n  /** Override instructions for this call only */\n  instructionOverride?: string;\n}\n\n/**\n * Tool call record (stored in history)\n */\nexport interface ToolCallRecord {\n  id: string;\n  name: string;\n  args: Record<string, unknown>;\n  result?: unknown;\n  error?: string;\n  durationMs?: number;\n  cached?: boolean;\n  timestamp: number;\n}\n\n/**\n * AgentContext configuration\n */\nexport interface AgentContextConfig {\n  /** Model name (used for token limits) */\n  model?: string;\n\n  /** Max context tokens (overrides model default) */\n  maxContextTokens?: number;\n\n  /** System prompt */\n  systemPrompt?: string;\n\n  /** Instructions */\n  instructions?: string;\n\n  /** Tools to register */\n  tools?: ToolFunction[];\n\n  /**\n   * Feature configuration - enable/disable AgentContext features independently\n   * Each feature controls component creation and tool registration\n   */\n  features?: AgentContextFeatures;\n\n  /** Tool permissions configuration */\n  permissions?: AgentPermissionsConfig;\n\n  /** Memory configuration */\n  memory?: Partial<WorkingMemoryConfig> & {\n    /** Custom storage backend (default: InMemoryStorage) */\n    storage?: IMemoryStorage;\n  };\n\n  /** Cache configuration */\n  cache?: Partial<IdempotencyCacheConfig> & {\n    /** Enable caching (default: true) */\n    enabled?: boolean;\n  };\n\n  /** InContextMemory configuration (only used if features.inContextMemory is true) */\n  inContextMemory?: InContextMemoryPluginConfig;\n\n  /**\n   * PersistentInstructions configuration (only used if features.persistentInstructions is true)\n   * If not provided, agentId will be auto-generated\n   */\n  persistentInstructions?: Omit<PersistentInstructionsPluginConfig, 'agentId'> & {\n    /** Override the agent ID (default: auto-generated or from agent name) */\n    agentId?: string;\n  };\n\n  /**\n   * Agent ID - used for persistent storage paths and identification\n   * If not provided, will be auto-generated\n   */\n  agentId?: string;\n\n  /** History configuration */\n  history?: {\n    /** Max messages before compaction */\n    maxMessages?: number;\n    /** Messages to preserve during compaction */\n    preserveRecent?: number;\n  };\n\n  /** Compaction strategy */\n  strategy?: 'proactive' | 'aggressive' | 'lazy' | 'rolling-window' | 'adaptive';\n\n  /** Response token reserve (0.0 - 1.0) */\n  responseReserve?: number;\n\n  /** Enable auto-compaction */\n  autoCompact?: boolean;\n\n  /** Task type for priority profiles (default: auto-detect from plan) */\n  taskType?: TaskType;\n\n  /** Auto-detect task type from plan (default: true) */\n  autoDetectTaskType?: boolean;\n\n  // ===== Session Persistence =====\n\n  /**\n   * Storage backend for session persistence.\n   * If provided, enables save()/load() methods.\n   */\n  storage?: IContextStorage;\n\n  /**\n   * Session ID to load on creation.\n   * If provided with storage, the session will be automatically loaded.\n   */\n  sessionId?: string;\n\n  /**\n   * Session metadata (used when saving new sessions).\n   */\n  sessionMetadata?: ContextSessionMetadata;\n}\n\n/**\n * Default configuration\n */\nconst DEFAULT_AGENT_CONTEXT_CONFIG: Required<Omit<AgentContextConfig, 'tools' | 'permissions' | 'memory' | 'cache' | 'taskType' | 'autoDetectTaskType' | 'features' | 'inContextMemory' | 'persistentInstructions' | 'agentId' | 'storage' | 'sessionId' | 'sessionMetadata'>> & {\n  history: Required<NonNullable<AgentContextConfig['history']>>;\n} = {\n  model: 'gpt-4',\n  maxContextTokens: 128000,\n  systemPrompt: '',\n  instructions: '',\n  history: {\n    maxMessages: 100,\n    preserveRecent: 20,\n  },\n  strategy: 'proactive',\n  responseReserve: 0.15,\n  autoCompact: true,\n};\n\n/**\n * Serialized state for session persistence\n * Version 2: Stores conversation as InputItem[] instead of HistoryMessage[]\n */\nexport interface SerializedAgentContextState {\n  version: number;  // 1 = legacy HistoryMessage[], 2 = InputItem[]\n  core: {\n    systemPrompt: string;\n    instructions: string;\n    /** @deprecated Use conversation instead (v2) */\n    history?: HistoryMessage[];\n    /** NEW in v2: Full conversation as InputItem[] */\n    conversation?: InputItem[];\n    /** NEW in v2: Message metadata */\n    messageMetadata?: Record<string, MessageMetadata>;\n    toolCalls: ToolCallRecord[];\n  };\n  tools: SerializedToolState;\n  /** Full WorkingMemory state (if memory feature enabled) */\n  memory?: SerializedMemory;\n  permissions: SerializedApprovalState;\n  plugins: Record<string, unknown>;\n  /**\n   * Agent-specific state (not context state).\n   * This is for agent-level data like ModeManager state that doesn't belong in plugins.\n   * Populated by agent subclasses via getContextState() override.\n   */\n  agentState?: Record<string, unknown>;\n  config: {\n    model: string;\n    maxContextTokens: number;\n    strategy: string;\n    features?: AgentContextFeatures;\n  };\n}\n\n/**\n * Context metrics\n */\nexport interface AgentContextMetrics {\n  historyMessageCount: number;\n  toolCallCount: number;\n  cacheStats: CacheStats;\n  memoryStats: {\n    totalEntries: number;\n    totalSizeBytes: number;\n    utilizationPercent: number;\n  };\n  pluginCount: number;\n  utilizationPercent: number;\n}\n\n// ============================================================================\n// Events\n// ============================================================================\n\nexport interface AgentContextEvents {\n  // History events\n  'message:added': { message: HistoryMessage };\n  'history:cleared': { reason?: string };\n  'history:compacted': { removedCount: number };\n\n  // Tool events\n  'tool:registered': { name: string };\n  'tool:executed': { record: ToolCallRecord };\n  'tool:cached': { name: string; args: Record<string, unknown> };\n\n  // Context events\n  'context:preparing': { componentCount: number };\n  'context:prepared': { budget: ContextBudget; compacted: boolean };\n  'compacted': { log: string[]; tokensFreed: number };\n\n  // Budget events\n  'budget:warning': { budget: ContextBudget };\n  'budget:critical': { budget: ContextBudget };\n\n  // Plugin events\n  'plugin:registered': { name: string };\n  'plugin:unregistered': { name: string };\n}\n\n// ============================================================================\n// AgentContext Implementation\n// ============================================================================\n\nexport class AgentContext extends EventEmitter<AgentContextEvents> {\n  // ===== Composed Managers (conditionally created based on features) =====\n  private readonly _tools: ToolManager;\n  private readonly _memory: WorkingMemory | null;\n  private readonly _cache: IdempotencyCache | null;\n  private readonly _permissions: ToolPermissionManager | null;\n  private _inContextMemory: InContextMemoryPlugin | null = null;\n  private _persistentInstructions: PersistentInstructionsPlugin | null = null;\n  private readonly _agentId: string;\n\n  // ===== Feature Configuration =====\n  private readonly _features: Required<AgentContextFeatures>;\n\n  // ===== Built-in State =====\n  private _systemPrompt: string;\n  private _instructions: string;\n  private _toolCalls: ToolCallRecord[] = [];\n  private _currentInput: string = '';\n  private _historyEnabled: boolean;\n\n  // ===== Conversation State (NEW - THE source of truth) =====\n  /** Conversation stored as InputItem[] - THE source of truth */\n  private _conversation: InputItem[] = [];\n  /** Metadata for each message (keyed by message ID) */\n  private _messageMetadata: Map<string, MessageMetadata> = new Map();\n  /** Messages at or after this index cannot be compacted (current iteration protection) */\n  private _protectedFromIndex: number = 0;\n\n  // ===== Plugins =====\n  private _plugins: Map<string, IContextPlugin> = new Map();\n\n  // ===== Configuration =====\n  private _config: typeof DEFAULT_AGENT_CONTEXT_CONFIG;\n  private _maxContextTokens: number;\n  private _strategy: IContextStrategy;\n  private _estimator: ITokenEstimator;\n  private _cacheEnabled: boolean;\n\n  // ===== Metrics =====\n  private _compactionCount = 0;\n  private _totalTokensFreed = 0;\n  private _lastBudget: ContextBudget | null = null;\n\n  // ===== Task Type =====\n  private _explicitTaskType?: TaskType;\n  private _autoDetectedTaskType?: TaskType;\n  private _autoDetectTaskType: boolean = true;\n\n  // ===== Session Persistence =====\n  private _storage: IContextStorage | null = null;\n  private _sessionId: string | null = null;\n  private _sessionMetadata: ContextSessionMetadata = {};\n\n  // ============================================================================\n  // Constructor & Factory\n  // ============================================================================\n\n  private constructor(config: AgentContextConfig = {}) {\n    super();\n\n    // Resolve features - merge user features with defaults\n    this._features = { ...DEFAULT_FEATURES, ...config.features };\n\n    // Handle legacy cache.enabled flag (maps to features.memory)\n    if (config.cache?.enabled === false) {\n      this._features.memory = false;\n    }\n\n    // Merge config with defaults\n    this._config = {\n      ...DEFAULT_AGENT_CONTEXT_CONFIG,\n      ...config,\n      history: { ...DEFAULT_AGENT_CONTEXT_CONFIG.history, ...config.history },\n    };\n\n    this._systemPrompt = config.systemPrompt ?? '';\n    this._instructions = config.instructions ?? '';\n\n    // Generate or use provided agent ID\n    this._agentId = config.agentId\n      ?? config.persistentInstructions?.agentId\n      ?? `agent-${Date.now()}-${Math.random().toString(36).substring(2, 7)}`;\n\n    // History feature\n    this._historyEnabled = this._features.history;\n\n    // Determine max tokens from model or config\n    this._maxContextTokens = config.maxContextTokens\n      ?? getModelInfo(config.model ?? 'gpt-4')?.features.input.tokens\n      ?? 128000;\n\n    // Create strategy and estimator\n    this._strategy = createStrategyFactory(this._config.strategy, {});\n    this._estimator = this.createEstimator();\n\n    // ===== Compose existing managers (conditionally based on features) =====\n\n    // ToolManager - always created\n    this._tools = new ToolManager();\n\n    // IMPORTANT: Set parent context so ToolManager can auto-build ToolContext\n    // This ensures tools have access to agentContext, memory, cache, etc.\n    // even when ToolManager.execute() is called directly (e.g., by AgenticLoop)\n    this._tools.setParentContext(this);\n\n    if (config.tools) {\n      for (const tool of config.tools) {\n        this._tools.register(tool);\n      }\n    }\n\n    // ToolPermissionManager - conditional\n    if (this._features.permissions) {\n      this._permissions = new ToolPermissionManager(config.permissions);\n    } else {\n      this._permissions = null;\n    }\n\n    // Memory feature includes WorkingMemory + IdempotencyCache (they work together)\n    if (this._features.memory) {\n      // WorkingMemory\n      const memoryStorage = config.memory?.storage ?? new InMemoryStorage();\n      const memoryConfig: WorkingMemoryConfig = {\n        ...DEFAULT_MEMORY_CONFIG,\n        ...config.memory,\n      };\n      this._memory = new WorkingMemory(memoryStorage, memoryConfig);\n\n      // IdempotencyCache\n      this._cacheEnabled = true;\n      const cacheConfig: IdempotencyCacheConfig = {\n        ...DEFAULT_IDEMPOTENCY_CONFIG,\n        ...config.cache,\n      };\n      this._cache = new IdempotencyCache(cacheConfig);\n    } else {\n      this._memory = null;\n      this._cache = null;\n      this._cacheEnabled = false;\n    }\n\n    // InContextMemory - opt-in feature\n    if (this._features.inContextMemory) {\n      const { plugin, tools } = createInContextMemory(config.inContextMemory);\n      this._inContextMemory = plugin;\n      this.registerPlugin(plugin);\n      for (const tool of tools) {\n        this._tools.register(tool);\n      }\n    }\n\n    // PersistentInstructions - opt-in feature\n    // Note: Plugin initialization is lazy (loads from disk on first getComponent call)\n    if (this._features.persistentInstructions) {\n      const { plugin, tools } = createPersistentInstructions({\n        agentId: this._agentId,\n        ...config.persistentInstructions,\n      });\n      this._persistentInstructions = plugin;\n      this.registerPlugin(plugin);\n      for (const tool of tools) {\n        this._tools.register(tool);\n      }\n    }\n\n    // Register feature-aware tools (memory, cache, introspection)\n    // This ensures ALL agent types have consistent tool availability\n    this._registerFeatureTools();\n\n    // Task type configuration\n    this._explicitTaskType = config.taskType;\n    this._autoDetectTaskType = config.autoDetectTaskType !== false;\n\n    // Session persistence configuration\n    this._storage = config.storage ?? null;\n    this._sessionMetadata = config.sessionMetadata ?? {};\n    this._sessionId = config.sessionId ?? null;\n  }\n\n  /**\n   * Create a new AgentContext\n   */\n  static create(config: AgentContextConfig = {}): AgentContext {\n    return new AgentContext(config);\n  }\n\n  // ============================================================================\n  // Public Accessors (expose composed managers for direct access)\n  // ============================================================================\n\n  /** Tool manager - register, enable/disable, execute tools */\n  get tools(): ToolManager {\n    return this._tools;\n  }\n\n  /** Working memory - store/retrieve agent state (null if memory feature disabled) */\n  get memory(): WorkingMemory | null {\n    return this._memory;\n  }\n\n  /** Tool result cache - automatic deduplication (null if memory feature disabled) */\n  get cache(): IdempotencyCache | null {\n    return this._cache;\n  }\n\n  /** Tool permissions - approval workflow (null if permissions feature disabled) */\n  get permissions(): ToolPermissionManager | null {\n    return this._permissions;\n  }\n\n  /** InContextMemory plugin (null if inContextMemory feature disabled) */\n  get inContextMemory(): InContextMemoryPlugin | null {\n    return this._inContextMemory;\n  }\n\n  /** PersistentInstructions plugin (null if persistentInstructions feature disabled) */\n  get persistentInstructions(): PersistentInstructionsPlugin | null {\n    return this._persistentInstructions;\n  }\n\n  /** Agent ID (auto-generated or from config) */\n  get agentId(): string {\n    return this._agentId;\n  }\n\n  /** Current session ID (null if no session loaded/saved) */\n  get sessionId(): string | null {\n    return this._sessionId;\n  }\n\n  /** Storage backend for session persistence (null if not configured) */\n  get storage(): IContextStorage | null {\n    return this._storage;\n  }\n\n  // ============================================================================\n  // Feature Configuration\n  // ============================================================================\n\n  /**\n   * Get the resolved feature configuration\n   */\n  get features(): Readonly<Required<AgentContextFeatures>> {\n    return this._features;\n  }\n\n  /**\n   * Check if a specific feature is enabled\n   */\n  isFeatureEnabled(feature: keyof AgentContextFeatures): boolean {\n    return this._features[feature];\n  }\n\n  /**\n   * Get memory, throwing if disabled\n   * Use when memory is required for an operation\n   */\n  requireMemory(): WorkingMemory {\n    if (!this._memory) {\n      throw new Error('WorkingMemory is not available. Enable the \"memory\" feature in AgentContextConfig.');\n    }\n    return this._memory;\n  }\n\n  /**\n   * Get cache, throwing if disabled\n   * Use when cache is required for an operation\n   */\n  requireCache(): IdempotencyCache {\n    if (!this._cache) {\n      throw new Error('IdempotencyCache is not available. Enable the \"memory\" feature in AgentContextConfig.');\n    }\n    return this._cache;\n  }\n\n  /**\n   * Get permissions, throwing if disabled\n   * Use when permissions is required for an operation\n   */\n  requirePermissions(): ToolPermissionManager {\n    if (!this._permissions) {\n      throw new Error('ToolPermissionManager is not available. Enable the \"permissions\" feature in AgentContextConfig.');\n    }\n    return this._permissions;\n  }\n\n  // ============================================================================\n  // Core Context (Built-in)\n  // ============================================================================\n\n  /** Get/set system prompt */\n  get systemPrompt(): string {\n    return this._systemPrompt;\n  }\n\n  set systemPrompt(value: string) {\n    this._systemPrompt = value;\n  }\n\n  /** Get/set instructions */\n  get instructions(): string {\n    return this._instructions;\n  }\n\n  set instructions(value: string) {\n    this._instructions = value;\n  }\n\n  /** Set current input for this turn */\n  setCurrentInput(input: string): void {\n    this._currentInput = input;\n  }\n\n  /** Get current input */\n  getCurrentInput(): string {\n    return this._currentInput;\n  }\n\n  // ============================================================================\n  // Conversation Management (NEW - Primary API)\n  // ============================================================================\n\n  /**\n   * Add user message to conversation.\n   *\n   * @param content - String or Content[] for the message\n   * @returns Message ID\n   */\n  addUserMessage(content: string | Content[]): string {\n    const id = this.generateId();\n    const contentArray: Content[] = typeof content === 'string'\n      ? [{ type: ContentType.INPUT_TEXT, text: content }]\n      : content;\n\n    const message: Message = {\n      type: 'message',\n      id,\n      role: MessageRole.USER,\n      content: contentArray,\n    };\n\n    this._conversation.push(message);\n    this._messageMetadata.set(id, {\n      timestamp: Date.now(),\n      tokenCount: this.estimateMessageTokens(message),\n    });\n\n    // Update current input for task type detection\n    const textContent = this.extractTextFromContent(contentArray);\n    if (textContent) {\n      this.setCurrentInput(textContent);\n    }\n\n    this.emit('message:added', { message: this.convertToHistoryMessage(message) });\n    return id;\n  }\n\n  /**\n   * Add raw InputItem[] to conversation (for complex inputs with images, files, etc.)\n   *\n   * @param items - InputItem[] to add\n   */\n  addInputItems(items: InputItem[]): void {\n    for (const item of items) {\n      if (item.type === 'message') {\n        const id = item.id || this.generateId();\n        const messageWithId: Message = { ...item, id };\n        this._conversation.push(messageWithId);\n        this._messageMetadata.set(id, {\n          timestamp: Date.now(),\n          tokenCount: this.estimateMessageTokens(messageWithId),\n        });\n        this.emit('message:added', { message: this.convertToHistoryMessage(messageWithId) });\n      }\n    }\n  }\n\n  /**\n   * Add assistant response to conversation (including tool calls).\n   *\n   * @param output - OutputItem[] from LLM response\n   * @returns Array of message IDs added\n   */\n  addAssistantResponse(output: OutputItem[]): string[] {\n    const ids: string[] = [];\n\n    for (const item of output) {\n      if (item.type === 'message' && item.role === MessageRole.ASSISTANT) {\n        const id = item.id || this.generateId();\n        const messageWithId: Message = { ...item, id } as Message;\n        this._conversation.push(messageWithId as InputItem);\n        this._messageMetadata.set(id, {\n          timestamp: Date.now(),\n          tokenCount: this.estimateMessageTokens(messageWithId),\n        });\n        ids.push(id);\n        this.emit('message:added', { message: this.convertToHistoryMessage(messageWithId) });\n      }\n    }\n\n    return ids;\n  }\n\n  /**\n   * Add tool results to conversation.\n   *\n   * @param results - ToolResult[] from tool execution\n   * @returns Message ID of the tool results message\n   */\n  addToolResults(results: ToolResult[]): string {\n    const id = this.generateId();\n\n    const message: Message = {\n      type: 'message',\n      id,\n      role: MessageRole.USER,  // Tool results go as user message per API spec\n      content: results.map(r => ({\n        type: ContentType.TOOL_RESULT as const,\n        tool_use_id: r.tool_use_id,\n        content: typeof r.content === 'string' ? r.content : JSON.stringify(r.content),\n        error: r.error,\n      })),\n    };\n\n    this._conversation.push(message);\n    this._messageMetadata.set(id, {\n      timestamp: Date.now(),\n      tokenCount: this.estimateMessageTokens(message),\n    });\n\n    // Also record in tool calls for analytics\n    for (const r of results) {\n      this._toolCalls.push({\n        id: r.tool_use_id,\n        name: (r as any).tool_name || 'unknown',\n        args: {},\n        result: r.content,\n        error: r.error,\n        timestamp: Date.now(),\n      });\n    }\n\n    this.emit('message:added', { message: this.convertToHistoryMessage(message) });\n    return id;\n  }\n\n  /**\n   * Mark current position as protected from compaction.\n   * Messages at or after this index cannot be compacted.\n   * Called at the start of each iteration by AgenticLoop.\n   */\n  protectFromCompaction(): void {\n    this._protectedFromIndex = this._conversation.length;\n  }\n\n  /**\n   * Get conversation (read-only).\n   */\n  getConversation(): ReadonlyArray<InputItem> {\n    return this._conversation;\n  }\n\n  /**\n   * Get conversation length.\n   */\n  getConversationLength(): number {\n    return this._conversation.length;\n  }\n\n  /**\n   * Clear conversation.\n   */\n  clearConversation(reason?: string): void {\n    this._conversation = [];\n    this._messageMetadata.clear();\n    this._protectedFromIndex = 0;\n    this.emit('history:cleared', { reason });\n  }\n\n  /**\n   * Prepare conversation for LLM call.\n   *\n   * THE method that handles everything:\n   * 1. Marks current position as protected\n   * 2. Calculates token usage\n   * 3. Compacts if needed (respecting protection & tool pairs)\n   * 4. Builds final InputItem[] for LLM\n   *\n   * Called by AgenticLoop before EVERY LLM call.\n   */\n  async prepareConversation(options?: PrepareConversationOptions): Promise<PreparedConversation> {\n    // 1. Protect current messages from compaction\n    this.protectFromCompaction();\n\n    // 2. Calculate current budget\n    const conversationTokens = this.estimateConversationTokens();\n    const systemTokens = await this.estimateSystemTokens();\n    const totalUsed = conversationTokens + systemTokens;\n\n    let budget = this.calculateBudgetFromTokens(totalUsed);\n    this._lastBudget = budget;\n\n    // 3. Emit warnings\n    if (budget.status === 'warning') {\n      this.emit('budget:warning', { budget });\n    } else if (budget.status === 'critical') {\n      this.emit('budget:critical', { budget });\n    }\n\n    // 4. Check if compaction needed\n    const needsCompaction = this._config.autoCompact &&\n      this._strategy.shouldCompact(budget, {\n        ...DEFAULT_CONTEXT_CONFIG,\n        maxContextTokens: this._maxContextTokens,\n        responseReserve: this._config.responseReserve,\n      });\n\n    let compactionLog: string[] = [];\n    if (needsCompaction) {\n      compactionLog = await this.compactConversation(budget);\n      // Recalculate\n      const newTokens = this.estimateConversationTokens() + systemTokens;\n      budget = this.calculateBudgetFromTokens(newTokens);\n      this._lastBudget = budget;\n    }\n\n    // 5. Build final input\n    const input = await this.buildLLMInput(options?.instructionOverride);\n\n    this.emit('context:prepared', { budget, compacted: needsCompaction });\n\n    return {\n      input,\n      budget,\n      compacted: needsCompaction,\n      compactionLog,\n    };\n  }\n\n  // ============================================================================\n  // Task Type Management\n  // ============================================================================\n\n  /**\n   * Set explicit task type (overrides auto-detection)\n   */\n  setTaskType(type: TaskType): void {\n    this._explicitTaskType = type;\n  }\n\n  /**\n   * Clear explicit task type (re-enables auto-detection)\n   */\n  clearTaskType(): void {\n    this._explicitTaskType = undefined;\n    this._autoDetectedTaskType = undefined;\n  }\n\n  /**\n   * Get current task type\n   * Priority: explicit > auto-detected > 'general'\n   */\n  getTaskType(): TaskType {\n    if (this._explicitTaskType) {\n      return this._explicitTaskType;\n    }\n    if (this._autoDetectTaskType) {\n      this._autoDetectedTaskType = this.detectTaskTypeFromPlan();\n      return this._autoDetectedTaskType ?? 'general';\n    }\n    return 'general';\n  }\n\n  /**\n   * Get task-type-specific system prompt addition\n   */\n  getTaskTypePrompt(): string {\n    return TASK_TYPE_PROMPTS[this.getTaskType()];\n  }\n\n  /**\n   * Register feature-aware tools based on enabled features.\n   * Called once during construction to ensure ALL agent types have consistent tools.\n   *\n   * This is the SINGLE source of truth for context-related tool registration.\n   * All agent types (Agent, TaskAgent, UniversalAgent) automatically get these tools.\n   *\n   * Consolidated tools (Phase 1):\n   * - Always: context_stats (unified introspection - gracefully handles disabled features)\n   * - When memory feature enabled: memory_store, memory_retrieve, memory_delete, memory_query, memory_cleanup_raw\n   * - InContextMemory (context_set, context_delete, context_list) & PersistentInstructions tools\n   *   are registered separately in the constructor when those features are enabled.\n   */\n  private _registerFeatureTools(): void {\n    // Always available: consolidated introspection tool\n    // This helps the agent understand its own context state\n    // It gracefully handles disabled features (returns \"feature_disabled\" for memory/cache sections)\n    this._tools.register(createContextStatsTool());\n\n    // Memory feature includes memory tools\n    if (this._features.memory) {\n      // Memory manipulation tools (consolidated)\n      this._tools.register(createMemoryStoreTool());\n      this._tools.register(createMemoryRetrieveTool());\n      this._tools.register(createMemoryDeleteTool());\n      this._tools.register(createMemoryQueryTool());\n      this._tools.register(createMemoryCleanupRawTool());\n    }\n  }\n\n  /**\n   * Auto-detect task type from plan (if PlanPlugin is registered)\n   * Uses keyword matching - NO LLM calls\n   */\n  private detectTaskTypeFromPlan(): TaskType | undefined {\n    const planPlugin = this.getPlugin<PlanPlugin>('plan');\n    const plan = planPlugin?.getPlan();\n    if (!plan) return undefined;\n\n    // Combine goal + task descriptions\n    const text = `${plan.goal} ${plan.tasks.map(t => `${t.name} ${t.description}`).join(' ')}`.toLowerCase();\n\n    // Research keywords\n    if (/\\b(research|search|find|investigate|discover|explore|gather|look\\s*up|scrape|web\\s*search|crawl|collect\\s*data|survey|study)\\b/.test(text)) {\n      return 'research';\n    }\n\n    // Coding keywords\n    if (/\\b(code|implement|develop|program|function|class|refactor|debug|fix\\s*bug|write\\s*code|api|endpoint|module|component|typescript|javascript|python)\\b/.test(text)) {\n      return 'coding';\n    }\n\n    // Analysis keywords\n    if (/\\b(analyze|analysis|calculate|compute|evaluate|assess|compare|statistics|metrics|measure|data|report|chart|graph)\\b/.test(text)) {\n      return 'analysis';\n    }\n\n    return 'general';\n  }\n\n  // ============================================================================\n  // History Management (Built-in)\n  // ============================================================================\n\n  /**\n   * Add a message to history with automatic capacity management.\n   *\n   * This async version checks if adding the message would exceed context budget\n   * and triggers compaction BEFORE adding if needed. Use this for large content\n   * like tool outputs.\n   *\n   * @param role - Message role (user, assistant, system, tool)\n   * @param content - Message content\n   * @param metadata - Optional metadata\n   * @returns The added message, or null if history feature is disabled\n   *\n   * @deprecated Use addUserMessage() or addAssistantResponse() instead\n   *\n   * @example\n   * ```typescript\n   * // For large tool outputs, capacity is checked automatically\n   * await ctx.addMessage('tool', largeWebFetchResult);\n   *\n   * // For small messages, same API but less overhead\n   * await ctx.addMessage('user', 'Hello');\n   * ```\n   */\n  async addMessage(\n    role: 'user' | 'assistant' | 'system' | 'tool',\n    content: string,\n    metadata?: Record<string, unknown>\n  ): Promise<HistoryMessage | null> {\n    // Return null if history is disabled\n    if (!this._historyEnabled) {\n      return null;\n    }\n\n    // Estimate tokens for new content\n    const estimatedTokens = this._estimator.estimateTokens(content);\n\n    // Only check capacity for larger messages (>1000 tokens) to avoid overhead\n    // for small messages like user inputs\n    if (estimatedTokens > 1000) {\n      const hasCapacity = await this.ensureCapacity(estimatedTokens);\n      if (!hasCapacity) {\n        // Emit warning but still add (best effort)\n        this.emit('budget:critical', { budget: this._lastBudget! });\n      }\n    }\n\n    // Convert to new conversation format and add\n    const msgRole = role === 'user' ? MessageRole.USER\n      : role === 'assistant' ? MessageRole.ASSISTANT\n      : role === 'system' ? MessageRole.DEVELOPER\n      : MessageRole.USER;\n\n    const id = this.generateId();\n    const message: Message = {\n      type: 'message',\n      id,\n      role: msgRole,\n      content: [{ type: ContentType.INPUT_TEXT, text: content }],\n    };\n\n    this._conversation.push(message);\n    this._messageMetadata.set(id, {\n      timestamp: Date.now(),\n      tokenCount: estimatedTokens,\n      legacyRole: role,  // Preserve original role for backward compat\n    });\n\n    // Return legacy format\n    const historyMessage: HistoryMessage = {\n      id,\n      role,\n      content,\n      timestamp: Date.now(),\n      metadata,\n    };\n\n    this.emit('message:added', { message: historyMessage });\n    return historyMessage;\n  }\n\n  /**\n   * Add a message to history synchronously (without capacity checking).\n   *\n   * Use this when you need synchronous behavior or for small messages where\n   * capacity checking overhead is not worth it. For large content (tool outputs,\n   * fetched documents), prefer the async `addMessage()` instead.\n   *\n   * @param role - Message role (user, assistant, system, tool)\n   * @param content - Message content\n   * @param metadata - Optional metadata\n   * @returns The added message, or null if history feature is disabled\n   *\n   * @deprecated Use addUserMessage() or addAssistantResponse() instead\n   */\n  addMessageSync(\n    role: 'user' | 'assistant' | 'system' | 'tool',\n    content: string,\n    metadata?: Record<string, unknown>\n  ): HistoryMessage | null {\n    // Return null if history is disabled\n    if (!this._historyEnabled) {\n      return null;\n    }\n\n    // Convert to new conversation format\n    const msgRole = role === 'user' ? MessageRole.USER\n      : role === 'assistant' ? MessageRole.ASSISTANT\n      : role === 'system' ? MessageRole.DEVELOPER\n      : MessageRole.USER;\n\n    const id = this.generateId();\n    const message: Message = {\n      type: 'message',\n      id,\n      role: msgRole,\n      content: [{ type: ContentType.INPUT_TEXT, text: content }],\n    };\n\n    this._conversation.push(message);\n    this._messageMetadata.set(id, {\n      timestamp: Date.now(),\n      tokenCount: this._estimator.estimateTokens(content),\n      legacyRole: role,  // Preserve original role for backward compat\n    });\n\n    // Return legacy format\n    const historyMessage: HistoryMessage = {\n      id,\n      role,\n      content,\n      timestamp: Date.now(),\n      metadata,\n    };\n\n    this.emit('message:added', { message: historyMessage });\n    return historyMessage;\n  }\n\n  /**\n   * Add a tool result to context with automatic capacity management.\n   *\n   * This is a convenience method for adding tool outputs. It:\n   * - Stringifies non-string results\n   * - Checks capacity and triggers compaction if needed\n   * - Adds as a 'tool' role message\n   *\n   * Use this for large tool outputs like web_fetch results, file contents, etc.\n   *\n   * @param result - The tool result (will be stringified for token estimation)\n   * @param metadata - Optional metadata (e.g., tool name, duration)\n   * @returns The added message, or null if history feature is disabled\n   *\n   * @deprecated Use addToolResults() with ToolResult[] instead\n   *\n   * @example\n   * ```typescript\n   * // Add large web fetch result\n   * const html = await webFetch('https://example.com');\n   * await ctx.addToolResult(html, { tool: 'web_fetch', url: 'https://example.com' });\n   *\n   * // Add structured data\n   * await ctx.addToolResult({ items: [...], count: 100 }, { tool: 'search' });\n   * ```\n   */\n  async addToolResult(\n    result: unknown,\n    metadata?: Record<string, unknown>\n  ): Promise<HistoryMessage | null> {\n    // Return null if history is disabled\n    if (!this._historyEnabled) {\n      return null;\n    }\n\n    // Convert result to string for history\n    const content = typeof result === 'string'\n      ? result\n      : JSON.stringify(result, null, 2);\n\n    // Use async addMessage which handles capacity checking\n    return this.addMessage('tool', content, metadata);\n  }\n\n  /**\n   * Get all history messages (computed from conversation)\n   * @deprecated Use getConversation() instead\n   */\n  getHistory(): HistoryMessage[] {\n    return this._conversation.map(item => this.convertToHistoryMessage(item));\n  }\n\n  /**\n   * Get recent N messages (computed from conversation)\n   * @deprecated Use getConversation() instead\n   */\n  getRecentHistory(count: number): HistoryMessage[] {\n    const recentItems = this._conversation.slice(-count);\n    return recentItems.map(item => this.convertToHistoryMessage(item));\n  }\n\n  /**\n   * Get message count\n   * @deprecated Use getConversationLength() instead\n   */\n  getMessageCount(): number {\n    return this._conversation.length;\n  }\n\n  /**\n   * Clear history\n   * @deprecated Use clearConversation() instead\n   */\n  clearHistory(reason?: string): void {\n    this.clearConversation(reason);\n  }\n\n  /**\n   * Get all tool call records\n   */\n  getToolCalls(): ToolCallRecord[] {\n    return [...this._toolCalls];\n  }\n\n  // ============================================================================\n  // Tool Execution (with caching integration)\n  // ============================================================================\n\n  /**\n   * Execute a tool with automatic caching\n   *\n   * This is the recommended way to execute tools - it integrates:\n   * - Permission checking\n   * - Result caching (if tool is cacheable and memory feature enabled)\n   * - History recording\n   * - Metrics tracking\n   */\n  async executeTool(\n    toolName: string,\n    args: Record<string, unknown>,\n    context?: Partial<ToolContext>\n  ): Promise<unknown> {\n    const tool = this._tools.get(toolName);\n    if (!tool) {\n      throw new Error(`Tool '${toolName}' not found`);\n    }\n\n    const startTime = Date.now();\n    let result: unknown;\n    let error: string | undefined;\n    let cached = false;\n\n    try {\n      // Check cache first (if enabled and cache available)\n      if (this._cacheEnabled && this._cache) {\n        const cachedResult = await this._cache.get(tool, args);\n        if (cachedResult !== undefined) {\n          cached = true;\n          result = cachedResult;\n          this.emit('tool:cached', { name: toolName, args });\n        }\n      }\n\n      // Execute if not cached\n      if (!cached) {\n        // Set tool context on manager before execution\n        const fullContext: ToolContext = {\n          agentId: context?.agentId ?? this._agentId,\n          taskId: context?.taskId,\n          memory: this._memory?.getAccess(),  // May be undefined if memory disabled\n          agentContext: this,  // THE source of truth for context management\n          idempotencyCache: this._cache ?? undefined,  // May be undefined if memory disabled\n          inContextMemory: this._inContextMemory ?? undefined,  // May be undefined if inContextMemory disabled\n          persistentInstructions: this._persistentInstructions ?? undefined,  // May be undefined if persistentInstructions disabled\n          signal: context?.signal,\n        };\n        this._tools.setToolContext(fullContext);\n\n        // Execute via ToolManager (context is already set)\n        result = await this._tools.execute(toolName, args);\n\n        // Cache result (if enabled, cache available, and tool is cacheable)\n        if (this._cacheEnabled && this._cache) {\n          await this._cache.set(tool, args, result);\n        }\n      }\n    } catch (err) {\n      error = err instanceof Error ? err.message : String(err);\n      throw err;\n    } finally {\n      // Record tool call\n      const record: ToolCallRecord = {\n        id: this.generateId(),\n        name: toolName,\n        args,\n        result: error ? undefined : result,\n        error,\n        durationMs: Date.now() - startTime,\n        cached,\n        timestamp: Date.now(),\n      };\n\n      this._toolCalls.push(record);\n      this.emit('tool:executed', { record });\n    }\n\n    return result;\n  }\n\n  // ============================================================================\n  // Plugin System\n  // ============================================================================\n\n  /**\n   * Register a context plugin\n   */\n  registerPlugin(plugin: IContextPlugin): void {\n    if (this._plugins.has(plugin.name)) {\n      throw new Error(`Plugin '${plugin.name}' is already registered`);\n    }\n    this._plugins.set(plugin.name, plugin);\n    this.emit('plugin:registered', { name: plugin.name });\n  }\n\n  /**\n   * Unregister a plugin\n   */\n  unregisterPlugin(name: string): boolean {\n    const plugin = this._plugins.get(name);\n    if (plugin) {\n      plugin.destroy?.();\n      this._plugins.delete(name);\n      this.emit('plugin:unregistered', { name });\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Get a plugin by name\n   */\n  getPlugin<T extends IContextPlugin>(name: string): T | undefined {\n    return this._plugins.get(name) as T | undefined;\n  }\n\n  /**\n   * List all registered plugins\n   */\n  listPlugins(): string[] {\n    return Array.from(this._plugins.keys());\n  }\n\n  // ============================================================================\n  // Context Preparation (Unified)\n  // ============================================================================\n\n  /**\n   * Prepare context for LLM call\n   *\n   * Assembles all components:\n   * - System prompt, instructions\n   * - Conversation history\n   * - Memory index\n   * - Plugin components\n   * - Current input\n   *\n   * Handles compaction automatically if budget is exceeded.\n   */\n  async prepare(): Promise<PreparedContext> {\n    const components = await this.buildComponents();\n    this.emit('context:preparing', { componentCount: components.length });\n\n    let budget = this.calculateBudget(components);\n    this._lastBudget = budget;\n\n    // Emit warnings\n    if (budget.status === 'warning') {\n      this.emit('budget:warning', { budget });\n    } else if (budget.status === 'critical') {\n      this.emit('budget:critical', { budget });\n    }\n\n    // Compact if needed\n    const needsCompaction = this._config.autoCompact &&\n      this._strategy.shouldCompact(budget, {\n        ...DEFAULT_CONTEXT_CONFIG,\n        maxContextTokens: this._maxContextTokens,\n        responseReserve: this._config.responseReserve,\n      });\n\n    if (needsCompaction) {\n      const result = await this.doCompaction(components, budget);\n      this.emit('context:prepared', { budget: result.budget, compacted: true });\n      return result;\n    }\n\n    this.emit('context:prepared', { budget, compacted: false });\n    return { components, budget, compacted: false };\n  }\n\n  /**\n   * Get current budget without full preparation\n   */\n  async getBudget(): Promise<ContextBudget> {\n    const components = await this.buildComponents();\n    return this.calculateBudget(components);\n  }\n\n  /**\n   * Force compaction\n   */\n  async compact(): Promise<PreparedContext> {\n    const components = await this.buildComponents();\n    const budget = this.calculateBudget(components);\n    return this.doCompaction(components, budget);\n  }\n\n  // ============================================================================\n  // Configuration\n  // ============================================================================\n\n  /**\n   * Set compaction strategy\n   */\n  setStrategy(strategy: 'proactive' | 'aggressive' | 'lazy' | 'rolling-window' | 'adaptive'): void {\n    this._strategy = createStrategyFactory(strategy, {});\n  }\n\n  /**\n   * Get max context tokens\n   */\n  getMaxContextTokens(): number {\n    return this._maxContextTokens;\n  }\n\n  /**\n   * Set max context tokens\n   */\n  setMaxContextTokens(tokens: number): void {\n    this._maxContextTokens = tokens;\n  }\n\n  /**\n   * Enable/disable caching\n   */\n  setCacheEnabled(enabled: boolean): void {\n    this._cacheEnabled = enabled;\n  }\n\n  /**\n   * Check if caching is enabled\n   */\n  isCacheEnabled(): boolean {\n    return this._cacheEnabled;\n  }\n\n  // ============================================================================\n  // Introspection\n  // ============================================================================\n\n  /**\n   * Estimate tokens for content\n   */\n  estimateTokens(content: string, type?: TokenContentType): number {\n    return this._estimator.estimateTokens(content, type);\n  }\n\n  /**\n   * Get utilization percentage\n   */\n  getUtilization(): number {\n    return this._lastBudget?.utilizationPercent ?? 0;\n  }\n\n  /**\n   * Get last calculated budget\n   */\n  getLastBudget(): ContextBudget | null {\n    return this._lastBudget;\n  }\n\n  // ============================================================================\n  // Auto-Compaction Guard\n  // ============================================================================\n\n  /**\n   * Ensure there's enough capacity for new content.\n   * If adding the estimated tokens would exceed budget, triggers compaction first.\n   *\n   * This method enables proactive compaction BEFORE content is added, preventing\n   * context overflow. It uses the configured strategy to determine when to compact.\n   *\n   * @param estimatedTokens - Estimated tokens of content to be added\n   * @returns true if capacity is available (after potential compaction), false if cannot make room\n   *\n   * @example\n   * ```typescript\n   * const tokens = ctx.estimateTokens(largeToolOutput);\n   * const hasRoom = await ctx.ensureCapacity(tokens);\n   * if (hasRoom) {\n   *   await ctx.addMessage('tool', largeToolOutput);\n   * } else {\n   *   // Handle overflow - truncate or summarize\n   * }\n   * ```\n   */\n  async ensureCapacity(estimatedTokens: number): Promise<boolean> {\n    // Quick check: calculate current budget\n    const components = await this.buildComponents();\n    const budget = this.calculateBudget(components);\n\n    // Calculate what utilization would be after adding new content\n    const projectedUsed = budget.used + estimatedTokens;\n    const availableForContent = budget.total - budget.reserved;\n    const projectedUtilization = projectedUsed / availableForContent;\n\n    // Build projected budget for strategy check\n    const projectedBudget: ContextBudget = {\n      ...budget,\n      used: projectedUsed,\n      available: budget.available - estimatedTokens,\n      utilizationPercent: projectedUtilization * 100,\n      status: projectedUtilization >= 0.9 ? 'critical' : projectedUtilization >= 0.75 ? 'warning' : 'ok',\n    };\n\n    // Check against strategy threshold (proactive = 0.75, aggressive = 0.6, etc.)\n    const needsCompaction = this._strategy.shouldCompact(projectedBudget, {\n      ...DEFAULT_CONTEXT_CONFIG,\n      maxContextTokens: this._maxContextTokens,\n      responseReserve: this._config.responseReserve,\n    });\n\n    if (!needsCompaction) {\n      return true; // Plenty of room\n    }\n\n    // Trigger compaction\n    this.emit('budget:warning', { budget });\n    await this.doCompaction(components, budget);\n\n    // Re-check after compaction\n    const newComponents = await this.buildComponents();\n    const newBudget = this.calculateBudget(newComponents);\n    this._lastBudget = newBudget;\n\n    // Return true if we now have room\n    return (newBudget.available >= estimatedTokens);\n  }\n\n  /**\n   * Get comprehensive metrics\n   */\n  async getMetrics(): Promise<AgentContextMetrics> {\n    // Get memory stats if memory feature is enabled\n    let memoryStats: { totalEntries: number; totalSizeBytes: number; utilizationPercent: number };\n    if (this._memory) {\n      const stats = await this._memory.getStats();\n      memoryStats = {\n        totalEntries: stats.totalEntries,\n        totalSizeBytes: stats.totalSizeBytes,\n        utilizationPercent: stats.utilizationPercent,\n      };\n    } else {\n      memoryStats = {\n        totalEntries: 0,\n        totalSizeBytes: 0,\n        utilizationPercent: 0,\n      };\n    }\n\n    // Get cache stats if memory feature is enabled\n    const cacheStats = this._cache?.getStats() ?? {\n      entries: 0,\n      hits: 0,\n      misses: 0,\n      hitRate: 0,\n    };\n\n    return {\n      historyMessageCount: this._conversation.length,\n      toolCallCount: this._toolCalls.length,\n      cacheStats,\n      memoryStats,\n      pluginCount: this._plugins.size,\n      utilizationPercent: this._lastBudget?.utilizationPercent ?? 0,\n    };\n  }\n\n  // ============================================================================\n  // Session Persistence (Unified)\n  // ============================================================================\n\n  /**\n   * Get state for session persistence\n   *\n   * Serializes ALL state:\n   * - History and tool calls\n   * - Tool enable/disable state\n   * - Memory entries (if enabled)\n   * - Permission state (if enabled)\n   * - Plugin state\n   * - Feature configuration\n   */\n  async getState(): Promise<SerializedAgentContextState> {\n    const pluginStates: Record<string, unknown> = {};\n    for (const [name, plugin] of this._plugins) {\n      const state = plugin.getState?.();\n      if (state !== undefined) {\n        pluginStates[name] = state;\n      }\n    }\n\n    // Serialize full memory state if memory is enabled\n    let memory: SerializedMemory | undefined;\n    if (this._memory) {\n      memory = await this._memory.serialize();\n    }\n\n    // Get permission state if permissions are enabled\n    const permissionState = this._permissions?.getState() ?? {\n      version: 1,\n      approvals: {},\n      blocklist: [],\n      allowlist: [],\n    };\n\n    // Convert messageMetadata Map to object for serialization\n    const metadataObj: Record<string, MessageMetadata> = {};\n    for (const [key, value] of this._messageMetadata) {\n      metadataObj[key] = value;\n    }\n\n    return {\n      version: 2,  // v2 format with conversation\n      core: {\n        systemPrompt: this._systemPrompt,\n        instructions: this._instructions,\n        // v2: Store conversation as InputItem[]\n        conversation: this._conversation,\n        messageMetadata: metadataObj,\n        // v1 backward compat: Also include history for older consumers\n        history: this._conversation.map(item => this.convertToHistoryMessage(item)),\n        toolCalls: this._toolCalls,\n      },\n      tools: this._tools.getState(),\n      memory,\n      permissions: permissionState,\n      plugins: pluginStates,\n      config: {\n        model: this._config.model,\n        maxContextTokens: this._maxContextTokens,\n        strategy: this._strategy.name,\n      },\n    };\n  }\n\n  /**\n   * Restore from saved state\n   *\n   * Restores ALL state from a previous session.\n   * Handles both v1 (HistoryMessage[]) and v2 (InputItem[]) formats.\n   */\n  async restoreState(state: SerializedAgentContextState): Promise<void> {\n    // Core state\n    this._systemPrompt = state.core.systemPrompt || '';\n    this._instructions = state.core.instructions || '';\n    this._toolCalls = state.core.toolCalls || [];\n\n    // Restore conversation based on version\n    if (state.version >= 2 && state.core.conversation) {\n      // v2 format: restore InputItem[] directly\n      this._conversation = state.core.conversation;\n      // Restore metadata\n      this._messageMetadata.clear();\n      if (state.core.messageMetadata) {\n        for (const [key, value] of Object.entries(state.core.messageMetadata)) {\n          this._messageMetadata.set(key, value as MessageMetadata);\n        }\n      }\n    } else if (state.core.history) {\n      // v1 format: convert HistoryMessage[] to InputItem[]\n      this._conversation = [];\n      this._messageMetadata.clear();\n      for (const msg of state.core.history) {\n        const role = msg.role === 'user' ? MessageRole.USER\n          : msg.role === 'assistant' ? MessageRole.ASSISTANT\n          : msg.role === 'system' ? MessageRole.DEVELOPER\n          : MessageRole.USER;\n\n        const inputItem: Message = {\n          type: 'message',\n          id: msg.id,\n          role,\n          content: [{ type: ContentType.INPUT_TEXT, text: msg.content }],\n        };\n        this._conversation.push(inputItem);\n        this._messageMetadata.set(msg.id, {\n          timestamp: msg.timestamp,\n          tokenCount: this._estimator.estimateTokens(msg.content),\n        });\n      }\n    } else {\n      this._conversation = [];\n      this._messageMetadata.clear();\n    }\n\n    this._protectedFromIndex = 0;  // Reset protection on restore\n\n    // Config\n    if (state.config.maxContextTokens) {\n      this._maxContextTokens = state.config.maxContextTokens;\n    }\n    if (state.config.strategy) {\n      this._strategy = createStrategyFactory(state.config.strategy, {});\n    }\n\n    // Tool state\n    if (state.tools) {\n      this._tools.loadState(state.tools);\n    }\n\n    // Restore memory entries (if memory feature enabled and state contains memory)\n    if (state.memory && this._memory) {\n      await this._memory.restore(state.memory);\n    }\n\n    // Permission state (only if permissions feature is enabled)\n    if (state.permissions && this._permissions) {\n      this._permissions.loadState(state.permissions);\n    }\n\n    // Plugin states\n    for (const [name, pluginState] of Object.entries(state.plugins)) {\n      const plugin = this._plugins.get(name);\n      if (plugin?.restoreState) {\n        plugin.restoreState(pluginState);\n      }\n    }\n  }\n\n  /**\n   * Save the current context state to storage.\n   *\n   * @param sessionId - Session ID to save as. If not provided, uses the current sessionId.\n   * @param metadata - Optional metadata to merge with existing session metadata.\n   * @throws Error if no storage is configured or no sessionId is available.\n   *\n   * @example\n   * ```typescript\n   * // Save to a new session\n   * await ctx.save('my-session-001', { title: 'Research on AI' });\n   *\n   * // Save to current session (must have been loaded or saved before)\n   * await ctx.save();\n   * ```\n   */\n  async save(\n    sessionId?: string,\n    metadata?: ContextSessionMetadata,\n    stateOverride?: SerializedAgentContextState\n  ): Promise<void> {\n    if (!this._storage) {\n      throw new Error('No storage configured. Provide storage in AgentContextConfig to enable session persistence.');\n    }\n\n    const targetSessionId = sessionId ?? this._sessionId;\n    if (!targetSessionId) {\n      throw new Error('No sessionId provided and no current session. Provide a sessionId or load a session first.');\n    }\n\n    // Use provided state or get current state\n    const state = stateOverride ?? await this.getState();\n\n    // Merge metadata\n    const finalMetadata: ContextSessionMetadata = {\n      ...this._sessionMetadata,\n      ...metadata,\n    };\n\n    // Save to storage\n    await this._storage.save(targetSessionId, state, finalMetadata);\n\n    // Update internal state\n    this._sessionId = targetSessionId;\n    this._sessionMetadata = finalMetadata;\n  }\n\n  /**\n   * Load a session from storage and restore its state.\n   *\n   * @param sessionId - Session ID to load.\n   * @returns true if the session was found and loaded, false if not found.\n   * @throws Error if no storage is configured.\n   *\n   * @example\n   * ```typescript\n   * const loaded = await ctx.load('my-session-001');\n   * if (loaded) {\n   *   console.log('Session restored!');\n   * } else {\n   *   console.log('Session not found, starting fresh.');\n   * }\n   * ```\n   */\n  async load(sessionId: string): Promise<boolean> {\n    const result = await this.loadRaw(sessionId);\n    if (!result) {\n      return false;\n    }\n    await this.restoreState(result.state);\n    return true;\n  }\n\n  /**\n   * Load session state from storage without restoring it.\n   * Useful for agents that need to process state before restoring (e.g., to restore agentState).\n   *\n   * @param sessionId - Session ID to load.\n   * @returns The stored state and metadata, or null if not found.\n   */\n  async loadRaw(sessionId: string): Promise<{ state: SerializedAgentContextState; metadata: ContextSessionMetadata } | null> {\n    if (!this._storage) {\n      throw new Error('No storage configured. Provide storage in AgentContextConfig to enable session persistence.');\n    }\n\n    // Load from storage\n    const stored = await this._storage.load(sessionId);\n    if (!stored) {\n      return null;\n    }\n\n    // Update internal session tracking (but don't restore state yet)\n    this._sessionId = sessionId;\n    this._sessionMetadata = stored.metadata;\n\n    return { state: stored.state, metadata: stored.metadata };\n  }\n\n  /**\n   * Check if a session exists in storage.\n   *\n   * @param sessionId - Session ID to check.\n   * @returns true if the session exists.\n   * @throws Error if no storage is configured.\n   */\n  async sessionExists(sessionId: string): Promise<boolean> {\n    if (!this._storage) {\n      throw new Error('No storage configured. Provide storage in AgentContextConfig to enable session persistence.');\n    }\n    return this._storage.exists(sessionId);\n  }\n\n  /**\n   * Delete a session from storage.\n   *\n   * @param sessionId - Session ID to delete. If not provided, deletes the current session.\n   * @throws Error if no storage is configured or no sessionId is available.\n   */\n  async deleteSession(sessionId?: string): Promise<void> {\n    if (!this._storage) {\n      throw new Error('No storage configured. Provide storage in AgentContextConfig to enable session persistence.');\n    }\n\n    const targetSessionId = sessionId ?? this._sessionId;\n    if (!targetSessionId) {\n      throw new Error('No sessionId provided and no current session.');\n    }\n\n    await this._storage.delete(targetSessionId);\n\n    // Clear current session if we deleted it\n    if (targetSessionId === this._sessionId) {\n      this._sessionId = null;\n      this._sessionMetadata = {};\n    }\n  }\n\n  // ============================================================================\n  // Cleanup\n  // ============================================================================\n\n  /**\n   * Destroy the context and release resources\n   */\n  destroy(): void {\n    // Destroy plugins\n    for (const plugin of this._plugins.values()) {\n      plugin.destroy?.();\n    }\n    this._plugins.clear();\n\n    // Destroy cache if it exists (clears interval and entries)\n    this._cache?.destroy();\n\n    // Destroy tool manager (cleans up circuit breaker listeners)\n    this._tools.destroy();\n\n    // Clear state\n    this._conversation = [];\n    this._messageMetadata.clear();\n    this._protectedFromIndex = 0;\n    this._toolCalls = [];\n\n    this.removeAllListeners();\n  }\n\n  // ============================================================================\n  // Private Methods\n  // ============================================================================\n\n  /**\n   * Build all context components\n   * Uses task-type-aware priority profiles for compaction ordering\n   * Conditionally includes components based on enabled features\n   */\n  private async buildComponents(): Promise<IContextComponent[]> {\n    const components: IContextComponent[] = [];\n\n    // Get task type and priority profile\n    const taskType = this.getTaskType();\n    const priorityProfile = PRIORITY_PROFILES[taskType];\n\n    // Build task-type-specific system prompt based on enabled features\n    const taskTypePrompt = this.buildTaskTypePromptForFeatures(taskType);\n\n    // System prompt + task type prompt (never compact)\n    const fullSystemPrompt = this._systemPrompt\n      ? `${this._systemPrompt}\\n\\n${taskTypePrompt}`\n      : taskTypePrompt;\n    if (fullSystemPrompt) {\n      components.push({\n        name: 'system_prompt',\n        content: fullSystemPrompt,\n        priority: 0,\n        compactable: false,\n      });\n    }\n\n    // Instructions (never compact)\n    if (this._instructions) {\n      components.push({\n        name: 'instructions',\n        content: this._instructions,\n        priority: 0,\n        compactable: false,\n      });\n    }\n\n    // Feature instructions (compactable but high priority)\n    // Provides runtime guidance for using enabled features efficiently\n    const featureInstructions = buildFeatureInstructions(this._features);\n    if (featureInstructions) {\n      components.push(featureInstructions);\n    }\n\n    // Conversation (compactable, priority from profile) - only if history enabled\n    if (this._features.history && this._conversation.length > 0) {\n      components.push({\n        name: 'conversation_history',\n        content: this.formatConversationForContext(),\n        priority: priorityProfile.conversation_history ?? 6,\n        compactable: true,\n        metadata: {\n          messageCount: this._conversation.length,\n          strategy: taskType === 'research' ? 'summarize' : 'truncate',\n        },\n      });\n    }\n\n    // Memory index (compactable, priority from profile) - only if memory enabled\n    if (this._features.memory && this._memory) {\n      const memoryIndex = await this._memory.formatIndex();\n      // Check if memory is truly empty (formatMemoryIndex returns \"Memory is empty.\" when no entries)\n      const isEmpty = !memoryIndex || memoryIndex.trim().length === 0 || memoryIndex.includes('Memory is empty.');\n      if (!isEmpty) {\n        components.push({\n          name: 'memory_index',\n          content: memoryIndex,\n          priority: priorityProfile.memory_index ?? 8,\n          compactable: true,\n          metadata: {\n            strategy: 'evict',\n          },\n        });\n      }\n    }\n\n    // Plugin components with priority override\n    for (const plugin of this._plugins.values()) {\n      try {\n        const component = await plugin.getComponent();\n        if (component) {\n          // Apply task-type priority override if defined in profile\n          const overridePriority = priorityProfile[component.name];\n          if (overridePriority !== undefined) {\n            component.priority = overridePriority;\n          }\n          components.push(component);\n        }\n      } catch (error) {\n        console.warn(`Plugin '${plugin.name}' failed to get component:`, error);\n      }\n    }\n\n    // Current input (never compact)\n    if (this._currentInput) {\n      components.push({\n        name: 'current_input',\n        content: this._currentInput,\n        priority: 0,\n        compactable: false,\n      });\n    }\n\n    return components;\n  }\n\n  /**\n   * Build task-type prompt adjusted for enabled features\n   */\n  private buildTaskTypePromptForFeatures(taskType: TaskType): string {\n    const basePrompt = TASK_TYPE_PROMPTS[taskType];\n\n    // If memory is disabled, modify the prompts to remove memory-related instructions\n    if (!this._features.memory) {\n      // Return simplified prompts without memory references\n      if (taskType === 'research') {\n        return `## Research Protocol\n\nYou are conducting research. Follow this workflow:\n\n### 1. SEARCH PHASE\n- Execute searches to find relevant sources\n\n### 2. READ PHASE\nFor each promising result:\n- Read/scrape the content\n- Extract key points (2-3 sentences per source)\n\n### 3. SYNTHESIZE PHASE\n- Cross-reference and consolidate findings\n- Write the final report`;\n      } else if (taskType === 'coding') {\n        return `## Coding Protocol\n\nYou are implementing code changes. Guidelines:\n- Read relevant files before making changes\n- Implement incrementally\n- Code file contents are large - summarize structure after reading`;\n      } else if (taskType === 'analysis') {\n        return `## Analysis Protocol\n\nYou are performing analysis. Guidelines:\n- Summarize data immediately after loading (raw data is large)\n- Keep only essential context for current analysis step`;\n      } else {\n        return `## Task Execution\n\nGuidelines:\n- Focus on completing the task efficiently`;\n      }\n    }\n\n    return basePrompt;\n  }\n\n  /**\n   * Calculate budget\n   */\n  private calculateBudget(components: IContextComponent[]): ContextBudget {\n    const breakdown: Record<string, number> = {};\n    let used = 0;\n\n    for (const component of components) {\n      const tokens = estimateComponentTokens(component, this._estimator);\n      breakdown[component.name] = tokens;\n      used += tokens;\n    }\n\n    const total = this._maxContextTokens;\n    const reserved = Math.floor(total * this._config.responseReserve);\n    const available = total - reserved - used;\n    const utilizationRatio = (used + reserved) / total;\n    const utilizationPercent = (used / (total - reserved)) * 100;\n\n    let status: 'ok' | 'warning' | 'critical';\n    if (utilizationRatio >= 0.9) {\n      status = 'critical';\n    } else if (utilizationRatio >= 0.75) {\n      status = 'warning';\n    } else {\n      status = 'ok';\n    }\n\n    return {\n      total,\n      reserved,\n      used,\n      available,\n      utilizationPercent,\n      status,\n      breakdown,\n    };\n  }\n\n  /**\n   * Perform compaction\n   */\n  private async doCompaction(\n    components: IContextComponent[],\n    budget: ContextBudget\n  ): Promise<PreparedContext> {\n    const log: string[] = [];\n    let tokensFreed = 0;\n    let currentBudget = budget;\n\n    // Sort compactable by priority (highest first)\n    const compactable = components\n      .filter(c => c.compactable)\n      .sort((a, b) => b.priority - a.priority);\n\n    for (const component of compactable) {\n      if (currentBudget.status === 'ok') break;\n\n      let freed = 0;\n\n      if (component.name === 'conversation_history') {\n        freed = this.compactHistory();\n        if (freed > 0) log.push(`Compacted history: freed ~${freed} tokens`);\n      } else if (component.name === 'memory_index') {\n        freed = await this.compactMemory();\n        if (freed > 0) log.push(`Compacted memory: freed ~${freed} tokens`);\n      } else {\n        const plugin = this._plugins.get(component.name);\n        if (plugin?.compact) {\n          freed = await plugin.compact(currentBudget.available, this._estimator);\n          if (freed > 0) log.push(`Compacted ${component.name}: freed ~${freed} tokens`);\n        }\n      }\n\n      tokensFreed += freed;\n\n      // Recalculate\n      const newComponents = await this.buildComponents();\n      currentBudget = this.calculateBudget(newComponents);\n    }\n\n    this._compactionCount++;\n    this._totalTokensFreed += tokensFreed;\n\n    const finalComponents = await this.buildComponents();\n    const finalBudget = this.calculateBudget(finalComponents);\n\n    this.emit('compacted', { log, tokensFreed });\n\n    return {\n      components: finalComponents,\n      budget: finalBudget,\n      compacted: true,\n      compactionLog: log,\n    };\n  }\n\n  /**\n   * Compact history (legacy - calls new compactConversation)\n   */\n  private compactHistory(): number {\n    const preserve = this._config.history.preserveRecent;\n    const before = this._conversation.length;\n\n    if (before <= preserve) return 0;\n\n    // Simple approach: remove oldest messages respecting preserve count\n    // The full compaction with tool pair safety is in compactConversation()\n    const toRemove = before - preserve;\n    const removed: InputItem[] = [];\n    let tokensFreed = 0;\n\n    for (let i = 0; i < toRemove && i < this._protectedFromIndex; i++) {\n      const item = this._conversation[i];\n      if (!item) continue;\n      const id = (item as any).id;\n      const metadata = id ? this._messageMetadata.get(id) : null;\n      tokensFreed += metadata?.tokenCount || this.estimateMessageTokens(item);\n      removed.push(item);\n      if (id) {\n        this._messageMetadata.delete(id);\n      }\n    }\n\n    if (removed.length > 0) {\n      this._conversation = this._conversation.slice(removed.length);\n      this._protectedFromIndex = Math.max(0, this._protectedFromIndex - removed.length);\n      this.emit('history:compacted', { removedCount: removed.length });\n    }\n\n    return tokensFreed;\n  }\n\n  /**\n   * Compact memory\n   */\n  private async compactMemory(): Promise<number> {\n    // Return 0 if memory is disabled\n    if (!this._memory) {\n      return 0;\n    }\n\n    const beforeIndex = await this._memory.formatIndex();\n    const beforeTokens = this._estimator.estimateTokens(beforeIndex);\n\n    await this._memory.evict(3, 'lru');\n\n    const afterIndex = await this._memory.formatIndex();\n    const afterTokens = this._estimator.estimateTokens(afterIndex);\n\n    return Math.max(0, beforeTokens - afterTokens);\n  }\n\n  /**\n   * Create token estimator\n   */\n  private createEstimator(): ITokenEstimator {\n    return {\n      estimateTokens: (text: string, contentType?: TokenContentType) => {\n        if (!text || text.length === 0) return 0;\n        const ratio = contentType === 'code' ? 3 : contentType === 'prose' ? 4 : 3.5;\n        return Math.ceil(text.length / ratio);\n      },\n      estimateDataTokens: (data: unknown, contentType?: TokenContentType) => {\n        const serialized = JSON.stringify(data);\n        const ratio = contentType === 'code' ? 3 : contentType === 'prose' ? 4 : 3.5;\n        return Math.ceil(serialized.length / ratio);\n      },\n    };\n  }\n\n  /**\n   * Generate unique ID\n   */\n  private generateId(): string {\n    return `${Date.now()}_${Math.random().toString(36).substring(2, 9)}`;\n  }\n\n  // ============================================================================\n  // Helper Methods for Conversation Management (NEW)\n  // ============================================================================\n\n  /**\n   * Extract text content from Content array\n   */\n  private extractTextFromContent(content: Content[]): string {\n    const texts: string[] = [];\n    for (const c of content) {\n      if (c.type === ContentType.INPUT_TEXT || c.type === ContentType.OUTPUT_TEXT) {\n        texts.push((c as any).text || '');\n      } else if (c.type === ContentType.TOOL_RESULT) {\n        texts.push((c as any).content || '');\n      }\n    }\n    return texts.join(' ');\n  }\n\n  /**\n   * Convert InputItem to HistoryMessage (backward compatibility)\n   */\n  private convertToHistoryMessage(item: InputItem): HistoryMessage {\n    let content = '';\n    let role: 'user' | 'assistant' | 'system' | 'tool' = 'user';\n\n    const metadata = this._messageMetadata.get((item as any).id);\n\n    // Use legacy role from metadata if available (preserves 'tool' role)\n    if (metadata?.legacyRole) {\n      role = metadata.legacyRole;\n    } else if (item.type === 'message') {\n      const msg = item as Message;\n      role = msg.role === MessageRole.USER ? 'user'\n        : msg.role === MessageRole.ASSISTANT ? 'assistant'\n        : msg.role === MessageRole.DEVELOPER ? 'system'\n        : 'user';\n    }\n\n    if (item.type === 'message') {\n      const msg = item as Message;\n      content = this.extractTextFromContent(msg.content);\n    }\n\n    return {\n      id: (item as any).id || this.generateId(),\n      role,\n      content,\n      timestamp: metadata?.timestamp || Date.now(),\n    };\n  }\n\n  /**\n   * Estimate tokens for a single InputItem\n   */\n  private estimateMessageTokens(item: InputItem): number {\n    if (item.type === 'message') {\n      const msg = item as Message;\n      let total = 4; // Message overhead\n      for (const c of msg.content) {\n        if (c.type === ContentType.INPUT_TEXT || c.type === ContentType.OUTPUT_TEXT) {\n          total += this._estimator.estimateTokens((c as any).text || '');\n        } else if (c.type === ContentType.TOOL_USE) {\n          total += this._estimator.estimateTokens((c as any).name || '');\n          total += this._estimator.estimateDataTokens((c as any).input || {});\n        } else if (c.type === ContentType.TOOL_RESULT) {\n          total += this._estimator.estimateTokens((c as any).content || '');\n        } else if (c.type === ContentType.INPUT_IMAGE_URL) {\n          // Images are typically 85-170 tokens per tile\n          total += 200;\n        }\n      }\n      return total;\n    }\n    return 50; // Default for unknown types\n  }\n\n  /**\n   * Estimate total tokens for conversation\n   */\n  private estimateConversationTokens(): number {\n    let total = 0;\n    for (const item of this._conversation) {\n      const id = (item as any).id;\n      const metadata = id ? this._messageMetadata.get(id) : null;\n      if (metadata?.tokenCount) {\n        total += metadata.tokenCount;\n      } else {\n        total += this.estimateMessageTokens(item);\n      }\n    }\n    return total;\n  }\n\n  /**\n   * Estimate system tokens (prompts, instructions, plugins)\n   */\n  private async estimateSystemTokens(): Promise<number> {\n    let total = 0;\n\n    // System prompt\n    if (this._systemPrompt) {\n      total += this._estimator.estimateTokens(this._systemPrompt);\n    }\n\n    // Instructions\n    if (this._instructions) {\n      total += this._estimator.estimateTokens(this._instructions);\n    }\n\n    // Task type prompt\n    const taskTypePrompt = this.getTaskTypePrompt();\n    if (taskTypePrompt) {\n      total += this._estimator.estimateTokens(taskTypePrompt);\n    }\n\n    // Feature instructions\n    const featureInstructions = buildFeatureInstructions(this._features);\n    if (featureInstructions?.content && typeof featureInstructions.content === 'string') {\n      total += this._estimator.estimateTokens(featureInstructions.content);\n    }\n\n    // Memory index\n    if (this._features.memory && this._memory) {\n      const memoryIndex = await this._memory.formatIndex();\n      if (memoryIndex && !memoryIndex.includes('Memory is empty.')) {\n        total += this._estimator.estimateTokens(memoryIndex);\n      }\n    }\n\n    // Plugin components\n    for (const plugin of this._plugins.values()) {\n      try {\n        const component = await plugin.getComponent();\n        if (component?.content && typeof component.content === 'string') {\n          total += this._estimator.estimateTokens(component.content);\n        }\n      } catch {\n        // Ignore plugin errors\n      }\n    }\n\n    return total;\n  }\n\n  /**\n   * Calculate budget from token usage\n   */\n  private calculateBudgetFromTokens(used: number): ContextBudget {\n    const total = this._maxContextTokens;\n    const reserved = Math.floor(total * this._config.responseReserve);\n    const available = total - reserved - used;\n    const utilizationRatio = (used + reserved) / total;\n    const utilizationPercent = (used / (total - reserved)) * 100;\n\n    let status: 'ok' | 'warning' | 'critical';\n    if (utilizationRatio >= 0.9) {\n      status = 'critical';\n    } else if (utilizationRatio >= 0.75) {\n      status = 'warning';\n    } else {\n      status = 'ok';\n    }\n\n    return {\n      total,\n      reserved,\n      used,\n      available,\n      utilizationPercent,\n      status,\n      breakdown: {\n        conversation: this.estimateConversationTokens(),\n        system: used - this.estimateConversationTokens(),\n      },\n    };\n  }\n\n  /**\n   * Find tool_use/tool_result pairs in conversation\n   * Returns Map<tool_use_id, message_index>\n   */\n  private findToolPairs(): Map<string, { useIndex: number; resultIndex: number | null }> {\n    const pairs = new Map<string, { useIndex: number; resultIndex: number | null }>();\n\n    for (let i = 0; i < this._conversation.length; i++) {\n      const item = this._conversation[i];\n      if (!item) continue;\n      if (item.type === 'message') {\n        const msg = item as Message;\n        for (const content of msg.content) {\n          if (content.type === ContentType.TOOL_USE) {\n            const toolUseId = (content as any).id;\n            if (toolUseId) {\n              pairs.set(toolUseId, { useIndex: i, resultIndex: null });\n            }\n          } else if (content.type === ContentType.TOOL_RESULT) {\n            const toolUseId = (content as any).tool_use_id;\n            const pair = pairs.get(toolUseId);\n            if (pair) {\n              pair.resultIndex = i;\n            }\n          }\n        }\n      }\n    }\n\n    return pairs;\n  }\n\n  /**\n   * Compact conversation respecting tool pairs and protected messages\n   */\n  private async compactConversation(_budget: ContextBudget): Promise<string[]> {\n    const log: string[] = [];\n    const toolPairs = this.findToolPairs();\n\n    // Cannot compact protected messages\n    const compactableEnd = this._protectedFromIndex;\n    if (compactableEnd <= 0) {\n      log.push('No compactable messages (all protected)');\n      return log;\n    }\n\n    // Identify safe compaction boundaries (don't split tool pairs)\n    const safeIndices: number[] = [];\n    for (let i = 0; i < compactableEnd; i++) {\n      let isSafe = true;\n\n      // Check if removing this would orphan a tool pair\n      for (const [, pair] of toolPairs) {\n        // If this message contains a tool_use whose result is after protection\n        if (pair.useIndex === i && pair.resultIndex !== null && pair.resultIndex >= compactableEnd) {\n          isSafe = false;\n          break;\n        }\n        // If this message contains a tool_result whose call is after protection\n        if (pair.resultIndex === i && pair.useIndex >= compactableEnd) {\n          isSafe = false;\n          break;\n        }\n      }\n\n      if (isSafe) {\n        safeIndices.push(i);\n      }\n    }\n\n    if (safeIndices.length === 0) {\n      log.push('No safe messages to compact (all involved in tool pairs)');\n      return log;\n    }\n\n    // Remove oldest safe messages (up to half of compactable, or until budget is OK)\n    const targetRemoval = Math.min(\n      Math.floor(safeIndices.length / 2),\n      safeIndices.length\n    );\n\n    const toRemove = new Set(safeIndices.slice(0, targetRemoval));\n    let tokensFreed = 0;\n\n    // Build new conversation excluding removed messages\n    const newConversation: InputItem[] = [];\n    for (let i = 0; i < this._conversation.length; i++) {\n      const item = this._conversation[i];\n      if (!item) continue;\n      if (toRemove.has(i)) {\n        const id = (item as any).id;\n        const metadata = id ? this._messageMetadata.get(id) : null;\n        tokensFreed += metadata?.tokenCount || this.estimateMessageTokens(item);\n        if (id) {\n          this._messageMetadata.delete(id);\n        }\n      } else {\n        newConversation.push(item);\n      }\n    }\n\n    this._conversation = newConversation;\n\n    // Adjust protected index\n    let removedBeforeProtected = 0;\n    for (const idx of toRemove) {\n      if (idx < this._protectedFromIndex) {\n        removedBeforeProtected++;\n      }\n    }\n    this._protectedFromIndex -= removedBeforeProtected;\n\n    log.push(`Removed ${toRemove.size} messages, freed ~${tokensFreed} tokens`);\n\n    this._compactionCount++;\n    this._totalTokensFreed += tokensFreed;\n    this.emit('history:compacted', { removedCount: toRemove.size });\n\n    return log;\n  }\n\n  /**\n   * Build final InputItem[] for LLM call\n   */\n  private async buildLLMInput(instructionOverride?: string): Promise<InputItem[]> {\n    const input: InputItem[] = [];\n\n    // Build system content\n    const systemParts: string[] = [];\n\n    // System prompt\n    if (this._systemPrompt) {\n      systemParts.push(this._systemPrompt);\n    }\n\n    // Task type prompt\n    const taskTypePrompt = this.buildTaskTypePromptForFeatures(this.getTaskType());\n    if (taskTypePrompt) {\n      systemParts.push(taskTypePrompt);\n    }\n\n    // Instructions (can be overridden)\n    const instructions = instructionOverride ?? this._instructions;\n    if (instructions) {\n      systemParts.push(instructions);\n    }\n\n    // Feature instructions\n    const featureInstructions = buildFeatureInstructions(this._features);\n    if (featureInstructions?.content && typeof featureInstructions.content === 'string') {\n      systemParts.push(featureInstructions.content);\n    }\n\n    // Memory index\n    if (this._features.memory && this._memory) {\n      const memoryIndex = await this._memory.formatIndex();\n      if (memoryIndex && !memoryIndex.includes('Memory is empty.')) {\n        systemParts.push(`## Working Memory\\n${memoryIndex}`);\n      }\n    }\n\n    // Plugin components\n    for (const plugin of this._plugins.values()) {\n      try {\n        const component = await plugin.getComponent();\n        if (component?.content && typeof component.content === 'string') {\n          systemParts.push(component.content);\n        }\n      } catch {\n        // Ignore plugin errors\n      }\n    }\n\n    // Add system message if we have content\n    if (systemParts.length > 0) {\n      input.push({\n        type: 'message',\n        role: MessageRole.DEVELOPER,\n        content: [{ type: ContentType.INPUT_TEXT, text: systemParts.join('\\n\\n') }],\n      } as Message);\n    }\n\n    // Add conversation\n    input.push(...this._conversation);\n\n    return input;\n  }\n\n  /**\n   * Format conversation for context (backward compat for buildComponents)\n   */\n  private formatConversationForContext(): string {\n    const lines: string[] = [];\n\n    for (const item of this._conversation) {\n      if (item.type === 'message') {\n        const msg = item as Message;\n        const roleLabel = msg.role === MessageRole.USER ? 'User'\n          : msg.role === MessageRole.ASSISTANT ? 'Assistant'\n          : msg.role === MessageRole.DEVELOPER ? 'System'\n          : 'Message';\n\n        const textContent = this.extractTextFromContent(msg.content);\n        if (textContent) {\n          lines.push(`${roleLabel}: ${textContent}`);\n        }\n\n        // Also show tool uses/results\n        for (const c of msg.content) {\n          if (c.type === ContentType.TOOL_USE) {\n            const toolUse = c as any;\n            lines.push(`${roleLabel}: [Called tool: ${toolUse.name}]`);\n          } else if (c.type === ContentType.TOOL_RESULT) {\n            const toolResult = c as any;\n            const preview = (toolResult.content || '').slice(0, 200);\n            lines.push(`${roleLabel}: [Tool result: ${preview}${toolResult.content?.length > 200 ? '...' : ''}]`);\n          }\n        }\n      }\n    }\n\n    return lines.join('\\n\\n');\n  }\n}\n","/**\n * Base provider class with common functionality\n */\n\nimport { IProvider, ProviderCapabilities } from '../../../domain/interfaces/IProvider.js';\nimport { ProviderConfig } from '../../../domain/types/ProviderConfig.js';\nimport { InvalidConfigError } from '../../../domain/errors/AIErrors.js';\n\nexport abstract class BaseProvider implements IProvider {\n  abstract readonly name: string;\n  abstract readonly capabilities: ProviderCapabilities;\n\n  constructor(protected config: ProviderConfig) {}\n\n  /**\n   * Validate provider configuration\n   * Returns validation result with details\n   */\n  async validateConfig(): Promise<boolean> {\n    const validation = this.validateApiKey();\n    return validation.isValid;\n  }\n\n  /**\n   * Validate API key format and presence\n   * Can be overridden by providers with specific key formats\n   */\n  protected validateApiKey(): { isValid: boolean; warning?: string } {\n    const apiKey = this.config.apiKey;\n\n    // Check for presence\n    if (!apiKey || apiKey.trim().length === 0) {\n      return { isValid: false };\n    }\n\n    // Check for common placeholder values\n    const placeholders = [\n      'your-api-key',\n      'YOUR_API_KEY',\n      'sk-xxx',\n      'api-key-here',\n      'REPLACE_ME',\n      '<your-key>',\n    ];\n\n    if (placeholders.some((p) => apiKey.includes(p))) {\n      return {\n        isValid: false,\n        warning: `API key appears to be a placeholder value`,\n      };\n    }\n\n    // Provider-specific format validation (can be overridden)\n    return this.validateProviderSpecificKeyFormat(apiKey);\n  }\n\n  /**\n   * Override this method in provider implementations for specific key format validation\n   */\n  protected validateProviderSpecificKeyFormat(_apiKey: string): { isValid: boolean; warning?: string } {\n    // Default: accept any non-empty key\n    // Override in subclasses for provider-specific validation\n    return { isValid: true };\n  }\n\n  /**\n   * Validate config and throw if invalid\n   */\n  protected assertValidConfig(): void {\n    const validation = this.validateApiKey();\n    if (!validation.isValid) {\n      throw new InvalidConfigError(\n        `Invalid API key for provider '${this.name}'${validation.warning ? `: ${validation.warning}` : ''}`\n      );\n    }\n  }\n\n  /**\n   * Get API key from config\n   */\n  protected getApiKey(): string {\n    return this.config.apiKey;\n  }\n\n  /**\n   * Get base URL if configured\n   */\n  protected getBaseURL(): string | undefined {\n    return this.config.baseURL;\n  }\n\n  /**\n   * Get timeout configuration\n   */\n  protected getTimeout(): number {\n    return this.config.timeout || 60000; // 60s default\n  }\n\n  /**\n   * Get max retries configuration\n   */\n  protected getMaxRetries(): number {\n    return this.config.maxRetries || 3;\n  }\n}\n","/**\n * Base text provider with common text generation functionality\n */\n\nimport { BaseProvider } from './BaseProvider.js';\nimport { ITextProvider, ModelCapabilities, TextGenerateOptions } from '../../../domain/interfaces/ITextProvider.js';\nimport { LLMResponse } from '../../../domain/entities/Response.js';\nimport { StreamEvent } from '../../../domain/entities/StreamEvent.js';\nimport { CircuitBreaker, DEFAULT_CIRCUIT_BREAKER_CONFIG } from '../../resilience/CircuitBreaker.js';\nimport { logger, FrameworkLogger } from '../../observability/Logger.js';\nimport { metrics } from '../../observability/Metrics.js';\n\nexport abstract class BaseTextProvider extends BaseProvider implements ITextProvider {\n  protected circuitBreaker?: CircuitBreaker;\n  protected logger: FrameworkLogger;\n  private _isObservabilityInitialized = false;\n\n  constructor(config: any) {\n    super(config);\n\n    // Initialize with default logger (will be updated with provider name on first use)\n    this.logger = logger.child({\n      component: 'Provider',\n      provider: 'unknown',\n    });\n\n    // Circuit breaker created lazily on first use\n  }\n\n  /**\n   * Auto-initialize observability on first use (lazy initialization)\n   * This is called automatically by executeWithCircuitBreaker()\n   * @internal\n   */\n  private ensureObservabilityInitialized(): void {\n    if (this._isObservabilityInitialized) {\n      return;\n    }\n\n    const providerName = this.name || 'unknown';\n\n    // Create circuit breaker with provider name\n    const cbConfig = (this.config as any).circuitBreaker || DEFAULT_CIRCUIT_BREAKER_CONFIG;\n    this.circuitBreaker = new CircuitBreaker(\n      `provider:${providerName}`,\n      cbConfig\n    );\n\n    // Update logger with provider name\n    this.logger = logger.child({\n      component: 'Provider',\n      provider: providerName,\n    });\n\n    // Forward circuit breaker events to metrics\n    this.circuitBreaker.on('opened', (data) => {\n      this.logger.warn(data, 'Circuit breaker opened');\n      metrics.increment('circuit_breaker.opened', 1, {\n        breaker: data.name,\n        provider: providerName,\n      });\n    });\n\n    this.circuitBreaker.on('closed', (data) => {\n      this.logger.info(data, 'Circuit breaker closed');\n      metrics.increment('circuit_breaker.closed', 1, {\n        breaker: data.name,\n        provider: providerName,\n      });\n    });\n\n    this._isObservabilityInitialized = true;\n  }\n\n  /**\n   * DEPRECATED: No longer needed, kept for backward compatibility\n   * Observability is now auto-initialized on first use\n   * @deprecated Initialization happens automatically\n   */\n  protected initializeObservability(_providerName: string): void {\n    // Force initialization now (for providers that still call this)\n    this.ensureObservabilityInitialized();\n  }\n\n  abstract generate(options: TextGenerateOptions): Promise<LLMResponse>;\n  abstract streamGenerate(options: TextGenerateOptions): AsyncIterableIterator<StreamEvent>;\n  abstract getModelCapabilities(model: string): ModelCapabilities;\n\n  /**\n   * Execute with circuit breaker protection (helper for subclasses)\n   */\n  protected async executeWithCircuitBreaker<TResult>(\n    operation: () => Promise<TResult>,\n    model?: string\n  ): Promise<TResult> {\n    // Auto-initialize observability on first use\n    this.ensureObservabilityInitialized();\n\n    const startTime = Date.now();\n    const operationName = 'llm.generate';\n\n    this.logger.debug({\n      operation: operationName,\n      model,\n    }, 'LLM call started');\n\n    metrics.increment('provider.llm.request', 1, {\n      provider: this.name,\n      model: model || 'unknown',\n    });\n\n    try {\n      // Execute with circuit breaker (should always be initialized after ensureObservabilityInitialized)\n      if (!this.circuitBreaker) {\n        // Fallback: execute without circuit breaker (should never happen)\n        return await operation();\n      }\n\n      const result = await this.circuitBreaker.execute(operation);\n\n      const duration = Date.now() - startTime;\n\n      this.logger.info({\n        operation: operationName,\n        model,\n        duration,\n      }, 'LLM call completed');\n\n      metrics.timing('provider.llm.latency', duration, {\n        provider: this.name,\n        model: model || 'unknown',\n      });\n\n      metrics.increment('provider.llm.response', 1, {\n        provider: this.name,\n        model: model || 'unknown',\n        status: 'success',\n      });\n\n      return result;\n    } catch (error) {\n      const duration = Date.now() - startTime;\n\n      this.logger.error({\n        operation: operationName,\n        model,\n        error: (error as Error).message,\n        duration,\n      }, 'LLM call failed');\n\n      metrics.increment('provider.llm.error', 1, {\n        provider: this.name,\n        model: model || 'unknown',\n        error: (error as Error).name,\n      });\n\n      throw error;\n    }\n  }\n\n  /**\n   * Get circuit breaker metrics\n   */\n  getCircuitBreakerMetrics() {\n    if (!this.circuitBreaker) {\n      // Not yet initialized (no calls made yet)\n      return null;\n    }\n    return this.circuitBreaker.getMetrics();\n  }\n\n  /**\n   * Normalize input to string (helper for providers that don't support complex input)\n   */\n  protected normalizeInputToString(input: string | any[]): string {\n    if (typeof input === 'string') {\n      return input;\n    }\n\n    // Extract text from InputItem array\n    const textParts: string[] = [];\n    for (const item of input) {\n      if (item.type === 'message') {\n        for (const content of item.content) {\n          if (content.type === 'input_text') {\n            textParts.push(content.text);\n          } else if (content.type === 'output_text') {\n            textParts.push(content.text);\n          }\n        }\n      }\n    }\n\n    return textParts.join('\\n');\n  }\n\n  /**\n   * List available models (optional)\n   */\n  async listModels?(): Promise<string[]>;\n\n  /**\n   * Clean up provider resources (circuit breaker listeners, etc.)\n   * Should be called when the provider is no longer needed.\n   */\n  destroy(): void {\n    if (this.circuitBreaker) {\n      this.circuitBreaker.removeAllListeners();\n      this.circuitBreaker = undefined;\n    }\n    this._isObservabilityInitialized = false;\n  }\n}\n","/**\n * OpenAI Responses API Converter\n *\n * Converts between our internal format and OpenAI's Responses API format.\n * The Responses API is the successor to Chat Completions API and is required\n * for GPT-5.2 Pro, GPT-5.2 Codex, and other advanced models.\n *\n * Key differences from Chat Completions:\n * - Uses `input` (Items array) instead of `messages`\n * - Uses `instructions` (top-level) instead of system message\n * - Tool definitions are internally-tagged (no nested `function` object)\n * - Responses contain Items array with different types\n */\n\nimport { InputItem, MessageRole } from '../../../domain/entities/Message.js';\nimport { LLMResponse } from '../../../domain/entities/Response.js';\nimport { Tool } from '../../../domain/entities/Tool.js';\nimport * as ResponsesAPI from 'openai/resources/responses/responses.js';\n\ntype ResponsesAPIInputItem = ResponsesAPI.ResponseInputItem;\ntype ResponsesAPIResponse = ResponsesAPI.Response;\n\nexport class OpenAIResponsesConverter {\n  /**\n   * Convert our input format to Responses API format\n   */\n  convertInput(\n    input: string | InputItem[],\n    instructions?: string\n  ): { input: string | ResponsesAPIInputItem[]; instructions?: string } {\n    // Simple string input\n    if (typeof input === 'string') {\n      return {\n        input,\n        instructions,\n      };\n    }\n\n    // Convert InputItem[] to Responses API Items\n    const items: ResponsesAPIInputItem[] = [];\n\n    for (const item of input) {\n      if (item.type === 'message') {\n        // Convert message item\n        const messageContent: any[] = [];\n\n        for (const content of item.content) {\n          switch (content.type) {\n            case 'input_text':\n              messageContent.push({\n                type: 'input_text',\n                text: content.text,\n              });\n              break;\n\n            case 'input_image_url':\n              messageContent.push({\n                type: 'input_image',\n                image_url: content.image_url.url,\n                ...(content.image_url.detail && { detail: content.image_url.detail }),\n              });\n              break;\n\n            case 'output_text':\n              messageContent.push({\n                type: 'output_text',\n                text: content.text,\n              });\n              break;\n\n            case 'tool_use':\n              // Tool use becomes a separate function_call item\n              items.push({\n                type: 'function_call',\n                call_id: content.id,\n                name: content.name,\n                arguments: content.arguments,\n              } as ResponsesAPI.ResponseFunctionToolCall);\n              break;\n\n            case 'tool_result':\n              // Tool result becomes a function_call_output item\n              const output = typeof content.content === 'string'\n                ? content.content\n                : JSON.stringify(content.content);\n              items.push({\n                type: 'function_call_output',\n                call_id: content.tool_use_id,\n                output,\n              } as any); // function_call_output is in ResponseInputItem namespace\n              break;\n          }\n        }\n\n        // Only add message if it has content (tool_use/tool_result don't go in message)\n        if (messageContent.length > 0) {\n          items.push({\n            type: 'message',\n            role: item.role,\n            content: messageContent,\n            id: item.id,\n            status: 'completed' as const,\n          } as ResponsesAPI.ResponseInputItem.Message);\n        }\n      } else if (item.type === 'compaction') {\n        // Pass through compaction items\n        items.push({\n          type: 'compaction',\n          id: item.id,\n          encrypted_content: item.encrypted_content,\n        } as ResponsesAPI.ResponseCompactionItemParam);\n      }\n    }\n\n    return {\n      input: items,\n      instructions,\n    };\n  }\n\n  /**\n   * Convert Responses API response to our LLMResponse format\n   */\n  convertResponse(response: ResponsesAPIResponse): LLMResponse {\n    const content: any[] = [];\n    let outputText = '';\n    let messageId: string | undefined;\n\n    // Process all output items\n    for (const item of response.output || []) {\n      if (item.type === 'message') {\n        // Extract message content\n        const messageItem = item as ResponsesAPI.ResponseOutputMessage;\n\n        // Extract message ID (first message item wins)\n        if (!messageId && messageItem.id) {\n          messageId = messageItem.id;\n        }\n\n        for (const contentItem of messageItem.content || []) {\n          if (contentItem.type === 'output_text') {\n            const textContent = contentItem as ResponsesAPI.ResponseOutputText;\n            content.push({\n              type: 'output_text',\n              text: textContent.text,\n              annotations: textContent.annotations || [],\n            });\n            outputText += textContent.text;\n          }\n        }\n      } else if (item.type === 'function_call') {\n        // Convert function_call to tool_use\n        const functionCall = item as ResponsesAPI.ResponseFunctionToolCall;\n        content.push({\n          type: 'tool_use',\n          id: functionCall.call_id,\n          name: functionCall.name,\n          arguments: functionCall.arguments,\n        });\n      } else if (item.type === 'reasoning') {\n        // Add reasoning item to output (GPT-5 models)\n        const reasoning = item as ResponsesAPI.ResponseReasoningItem;\n        // Store reasoning summary in output for visibility\n        if (reasoning.summary) {\n          content.push({\n            type: 'reasoning',\n            summary: reasoning.summary,\n            // effort field may not exist in all versions\n            ...(('effort' in reasoning) && { effort: (reasoning as any).effort }),\n          });\n        }\n      }\n    }\n\n    // Use output_text helper from SDK\n    if (!outputText) {\n      outputText = response.output_text || '';\n    }\n\n    // IMPORTANT: Use the actual message ID from output items, not the response ID\n    // Response IDs start with \"resp_\" but OpenAI expects message IDs starting with \"msg_\"\n    // when we send them back in subsequent requests\n    const finalMessageId = messageId || response.id;\n\n    return {\n      id: response.id,\n      object: 'response',\n      created_at: response.created_at,\n      status: response.status || 'completed',\n      model: response.model,\n      output: [\n        {\n          type: 'message',\n          id: finalMessageId,\n          role: MessageRole.ASSISTANT,\n          content,\n        },\n      ],\n      output_text: outputText,\n      usage: {\n        input_tokens: response.usage?.input_tokens || 0,\n        output_tokens: response.usage?.output_tokens || 0,\n        total_tokens: response.usage?.total_tokens || 0,\n      },\n    };\n  }\n\n  /**\n   * Convert our tool definitions to Responses API format\n   *\n   * Key difference: Responses API uses internally-tagged format\n   * (no nested `function` object) and strict mode requires proper schemas\n   */\n  convertTools(tools: Tool[]): ResponsesAPI.Tool[] {\n    return tools.map((tool) => {\n      if (tool.type === 'function') {\n        // Remove the nested `function` wrapper\n        const funcDef = tool.function;\n\n        // IMPORTANT: Only enable strict mode if explicitly requested (backward compatible)\n        // Strict mode requires all object schemas to have \"additionalProperties\": false\n        // Default to false for backward compatibility with existing tools\n        const useStrict = funcDef.strict === true;\n\n        return {\n          type: 'function',\n          name: funcDef.name,\n          description: funcDef.description || '',\n          parameters: funcDef.parameters || null,\n          strict: useStrict,\n        } as ResponsesAPI.FunctionTool;\n      }\n\n      // Built-in tools (web_search, file_search, etc.)\n      return tool as ResponsesAPI.Tool;\n    });\n  }\n\n  /**\n   * Convert tool_choice option to Responses API format\n   */\n  convertToolChoice(\n    toolChoice?: 'auto' | 'required' | { type: 'function'; function: { name: string } }\n  ): ResponsesAPI.ResponseCreateParams['tool_choice'] {\n    if (!toolChoice || toolChoice === 'auto') {\n      return 'auto';\n    }\n\n    if (toolChoice === 'required') {\n      return 'required';\n    }\n\n    // Specific function\n    return {\n      type: 'function',\n      name: toolChoice.function.name,\n    } as ResponsesAPI.ToolChoiceFunction;\n  }\n\n  /**\n   * Convert response_format option to Responses API format (modalities)\n   */\n  convertResponseFormat(\n    responseFormat?: {\n      type: 'text' | 'json_object' | 'json_schema';\n      json_schema?: any;\n    }\n  ): ResponsesAPI.ResponseTextConfig | undefined {\n    if (!responseFormat) {\n      return undefined;\n    }\n\n    if (responseFormat.type === 'json_schema' && responseFormat.json_schema) {\n      return {\n        type: 'text',\n        text: {\n          type: 'json_schema',\n          name: responseFormat.json_schema.name || 'response',\n          schema: responseFormat.json_schema.schema || responseFormat.json_schema,\n          description: responseFormat.json_schema.description,\n          strict: responseFormat.json_schema.strict !== false,\n        },\n      } as ResponsesAPI.ResponseTextConfig;\n    }\n\n    if (responseFormat.type === 'json_object') {\n      return {\n        type: 'text',\n        text: {\n          type: 'json_object',\n        },\n      } as ResponsesAPI.ResponseTextConfig;\n    }\n\n    return {\n      type: 'text',\n      text: {\n        type: 'text',\n      },\n    } as ResponsesAPI.ResponseTextConfig;\n  }\n}\n","/**\n * Streaming event types for real-time LLM responses\n * Based on OpenAI Responses API event format as the internal standard\n */\n\nimport { TokenUsage } from './Response.js';\n\n/**\n * Stream event type enum\n */\nexport enum StreamEventType {\n  RESPONSE_CREATED = 'response.created',\n  RESPONSE_IN_PROGRESS = 'response.in_progress',\n  OUTPUT_TEXT_DELTA = 'response.output_text.delta',\n  OUTPUT_TEXT_DONE = 'response.output_text.done',\n  TOOL_CALL_START = 'response.tool_call.start',\n  TOOL_CALL_ARGUMENTS_DELTA = 'response.tool_call_arguments.delta',\n  TOOL_CALL_ARGUMENTS_DONE = 'response.tool_call_arguments.done',\n  TOOL_EXECUTION_START = 'response.tool_execution.start',\n  TOOL_EXECUTION_DONE = 'response.tool_execution.done',\n  ITERATION_COMPLETE = 'response.iteration.complete',\n  RESPONSE_COMPLETE = 'response.complete',\n  ERROR = 'response.error',\n}\n\n/**\n * Base interface for all stream events\n */\ninterface BaseStreamEvent {\n  type: StreamEventType;\n  response_id: string;\n}\n\n/**\n * Response created - first event in stream\n */\nexport interface ResponseCreatedEvent extends BaseStreamEvent {\n  type: StreamEventType.RESPONSE_CREATED;\n  model: string;\n  created_at: number;\n}\n\n/**\n * Response in progress\n */\nexport interface ResponseInProgressEvent extends BaseStreamEvent {\n  type: StreamEventType.RESPONSE_IN_PROGRESS;\n}\n\n/**\n * Text delta - incremental text output\n */\nexport interface OutputTextDeltaEvent extends BaseStreamEvent {\n  type: StreamEventType.OUTPUT_TEXT_DELTA;\n  item_id: string;\n  output_index: number;\n  content_index: number;\n  delta: string;\n  sequence_number: number;\n}\n\n/**\n * Text output complete for this item\n */\nexport interface OutputTextDoneEvent extends BaseStreamEvent {\n  type: StreamEventType.OUTPUT_TEXT_DONE;\n  item_id: string;\n  output_index: number;\n  text: string; // Complete accumulated text\n}\n\n/**\n * Tool call detected and starting\n */\nexport interface ToolCallStartEvent extends BaseStreamEvent {\n  type: StreamEventType.TOOL_CALL_START;\n  item_id: string;\n  tool_call_id: string;\n  tool_name: string;\n}\n\n/**\n * Tool call arguments delta - incremental JSON\n */\nexport interface ToolCallArgumentsDeltaEvent extends BaseStreamEvent {\n  type: StreamEventType.TOOL_CALL_ARGUMENTS_DELTA;\n  item_id: string;\n  tool_call_id: string;\n  tool_name: string;\n  delta: string; // JSON chunk\n  sequence_number: number;\n}\n\n/**\n * Tool call arguments complete\n */\nexport interface ToolCallArgumentsDoneEvent extends BaseStreamEvent {\n  type: StreamEventType.TOOL_CALL_ARGUMENTS_DONE;\n  tool_call_id: string;\n  tool_name: string;\n  arguments: string; // Complete JSON string\n  incomplete?: boolean; // True if truncated by max_tokens\n}\n\n/**\n * Tool execution starting\n */\nexport interface ToolExecutionStartEvent extends BaseStreamEvent {\n  type: StreamEventType.TOOL_EXECUTION_START;\n  tool_call_id: string;\n  tool_name: string;\n  arguments: any; // Parsed arguments\n}\n\n/**\n * Tool execution complete\n */\nexport interface ToolExecutionDoneEvent extends BaseStreamEvent {\n  type: StreamEventType.TOOL_EXECUTION_DONE;\n  tool_call_id: string;\n  tool_name: string;\n  result: any;\n  execution_time_ms: number;\n  error?: string; // If tool failed\n}\n\n/**\n * Iteration complete - end of agentic loop iteration\n */\nexport interface IterationCompleteEvent extends BaseStreamEvent {\n  type: StreamEventType.ITERATION_COMPLETE;\n  iteration: number;\n  tool_calls_count: number;\n  has_more_iterations: boolean;\n}\n\n/**\n * Response complete - final event\n */\nexport interface ResponseCompleteEvent extends BaseStreamEvent {\n  type: StreamEventType.RESPONSE_COMPLETE;\n  status: 'completed' | 'incomplete' | 'failed';\n  usage: TokenUsage;\n  iterations: number;\n  duration_ms?: number;\n}\n\n/**\n * Error event\n */\nexport interface ErrorEvent extends BaseStreamEvent {\n  type: StreamEventType.ERROR;\n  error: {\n    type: string;\n    message: string;\n    code?: string;\n  };\n  recoverable: boolean;\n}\n\n/**\n * Union type of all stream events\n * Discriminated by 'type' field for type narrowing\n */\nexport type StreamEvent =\n  | ResponseCreatedEvent\n  | ResponseInProgressEvent\n  | OutputTextDeltaEvent\n  | OutputTextDoneEvent\n  | ToolCallStartEvent\n  | ToolCallArgumentsDeltaEvent\n  | ToolCallArgumentsDoneEvent\n  | ToolExecutionStartEvent\n  | ToolExecutionDoneEvent\n  | IterationCompleteEvent\n  | ResponseCompleteEvent\n  | ErrorEvent;\n\n/**\n * Type guard to check if event is a specific type\n */\nexport function isStreamEvent<T extends StreamEvent>(\n  event: StreamEvent,\n  type: StreamEventType\n): event is T {\n  return event.type === type;\n}\n\n/**\n * Type guards for specific events\n */\nexport function isOutputTextDelta(event: StreamEvent): event is OutputTextDeltaEvent {\n  return event.type === StreamEventType.OUTPUT_TEXT_DELTA;\n}\n\nexport function isToolCallStart(event: StreamEvent): event is ToolCallStartEvent {\n  return event.type === StreamEventType.TOOL_CALL_START;\n}\n\nexport function isToolCallArgumentsDelta(\n  event: StreamEvent\n): event is ToolCallArgumentsDeltaEvent {\n  return event.type === StreamEventType.TOOL_CALL_ARGUMENTS_DELTA;\n}\n\nexport function isToolCallArgumentsDone(\n  event: StreamEvent\n): event is ToolCallArgumentsDoneEvent {\n  return event.type === StreamEventType.TOOL_CALL_ARGUMENTS_DONE;\n}\n\nexport function isResponseComplete(event: StreamEvent): event is ResponseCompleteEvent {\n  return event.type === StreamEventType.RESPONSE_COMPLETE;\n}\n\nexport function isErrorEvent(event: StreamEvent): event is ErrorEvent {\n  return event.type === StreamEventType.ERROR;\n}\n","/**\n * OpenAI Responses API Streaming Converter\n *\n * Converts streaming events from OpenAI's Responses API to our internal StreamEvent format.\n *\n * Responses API streaming events:\n * - response.created\n * - response.output_item.added\n * - response.output_item.content.added\n * - response.output_item.content.delta (text/arguments)\n * - response.output_item.done\n * - response.done\n */\n\nimport * as ResponsesAPI from 'openai/resources/responses/responses.js';\nimport { StreamEvent, StreamEventType } from '../../../domain/entities/StreamEvent.js';\n\ntype ResponseStreamEvent = ResponsesAPI.ResponseStreamEvent;\n\nexport class OpenAIResponsesStreamConverter {\n  /**\n   * Convert Responses API stream to our StreamEvent format\n   */\n  async *convertStream(\n    stream: AsyncIterable<ResponseStreamEvent>\n  ): AsyncIterableIterator<StreamEvent> {\n    let responseId = '';\n    let sequenceNumber = 0;\n\n    // Track active items and tool calls\n    const activeItems = new Map<string, { type: string; toolCallId?: string; toolName?: string }>();\n    const toolCallBuffers = new Map<string, { id: string; name: string; args: string }>();\n\n    for await (const event of stream) {\n      // Debug logging\n      if (process.env.DEBUG_OPENAI) {\n        console.error('[DEBUG] Responses API event:', event.type);\n      }\n\n      switch (event.type) {\n        case 'response.created': {\n          responseId = event.response.id;\n          yield {\n            type: StreamEventType.RESPONSE_CREATED,\n            response_id: responseId,\n            model: event.response.model,\n            created_at: event.response.created_at,\n          };\n          break;\n        }\n\n        case 'response.output_item.added': {\n          const addedEvent = event as ResponsesAPI.ResponseOutputItemAddedEvent;\n          const item = addedEvent.item;\n          activeItems.set(addedEvent.output_index.toString(), {\n            type: item.type,\n          });\n\n          // If it's a function call, track it\n          if (item.type === 'function_call') {\n            const functionCall = item as ResponsesAPI.ResponseFunctionToolCall;\n            const toolCallId = functionCall.call_id;\n            const toolName = functionCall.name;\n\n            activeItems.set(addedEvent.output_index.toString(), {\n              type: 'function_call',\n              toolCallId,\n              toolName,\n            });\n\n            toolCallBuffers.set(toolCallId, {\n              id: toolCallId,\n              name: toolName,\n              args: '',\n            });\n\n            yield {\n              type: StreamEventType.TOOL_CALL_START,\n              response_id: responseId,\n              item_id: `item_${addedEvent.output_index}`,\n              tool_call_id: toolCallId,\n              tool_name: toolName,\n            };\n          }\n          break;\n        }\n\n        case 'response.output_text.delta': {\n          const textEvent = event as ResponsesAPI.ResponseTextDeltaEvent;\n          yield {\n            type: StreamEventType.OUTPUT_TEXT_DELTA,\n            response_id: responseId,\n            item_id: textEvent.item_id,\n            output_index: textEvent.output_index,\n            content_index: textEvent.content_index,\n            delta: textEvent.delta || '',\n            sequence_number: sequenceNumber++,\n          };\n          break;\n        }\n\n        case 'response.function_call_arguments.delta': {\n          const argsEvent = event as ResponsesAPI.ResponseFunctionCallArgumentsDeltaEvent;\n          const itemInfo = activeItems.get(argsEvent.output_index.toString());\n\n          if (itemInfo?.toolCallId) {\n            const buffer = toolCallBuffers.get(itemInfo.toolCallId);\n            if (buffer) {\n              buffer.args += argsEvent.delta || '';\n\n              yield {\n                type: StreamEventType.TOOL_CALL_ARGUMENTS_DELTA,\n                response_id: responseId,\n                item_id: argsEvent.item_id,\n                tool_call_id: buffer.id,\n                tool_name: buffer.name,\n                delta: argsEvent.delta || '',\n                sequence_number: sequenceNumber++,\n              };\n            }\n          }\n          break;\n        }\n\n        case 'response.output_item.done': {\n          const doneEvent = event as ResponsesAPI.ResponseOutputItemDoneEvent;\n          const item = doneEvent.item;\n\n          // If function call is done, emit arguments complete\n          if (item.type === 'function_call') {\n            const functionCall = item as ResponsesAPI.ResponseFunctionToolCall;\n            const buffer = toolCallBuffers.get(functionCall.call_id);\n\n            if (buffer) {\n              yield {\n                type: StreamEventType.TOOL_CALL_ARGUMENTS_DONE,\n                response_id: responseId,\n                tool_call_id: buffer.id,\n                tool_name: buffer.name,\n                arguments: buffer.args || functionCall.arguments,\n              };\n            }\n          }\n          break;\n        }\n\n        case 'response.completed': {\n          const completedEvent = event as ResponsesAPI.ResponseCompletedEvent;\n          const response = completedEvent.response;\n\n          // Map ResponseStatus to our status type\n          let status: 'completed' | 'failed' | 'incomplete' = 'completed';\n          if (response.status === 'failed') {\n            status = 'failed';\n          } else if (response.status === 'incomplete') {\n            status = 'incomplete';\n          }\n\n          yield {\n            type: StreamEventType.RESPONSE_COMPLETE,\n            response_id: responseId,\n            status,\n            usage: {\n              input_tokens: response.usage?.input_tokens || 0,\n              output_tokens: response.usage?.output_tokens || 0,\n              total_tokens: response.usage?.total_tokens || 0,\n            },\n            iterations: 1,\n          };\n          break;\n        }\n\n        // Handle other event types if needed\n        default:\n          if (process.env.DEBUG_OPENAI) {\n            console.error('[DEBUG] Unhandled Responses API event type:', (event as any).type);\n          }\n      }\n    }\n  }\n}\n","/**\n * OpenAI text provider using Responses API\n */\n\nimport OpenAI from 'openai';\nimport { BaseTextProvider } from '../base/BaseTextProvider.js';\nimport { TextGenerateOptions, ModelCapabilities } from '../../../domain/interfaces/ITextProvider.js';\nimport { LLMResponse } from '../../../domain/entities/Response.js';\nimport { ProviderCapabilities } from '../../../domain/interfaces/IProvider.js';\nimport { OpenAIConfig } from '../../../domain/types/ProviderConfig.js';\nimport {\n  ProviderAuthError,\n  ProviderRateLimitError,\n  ProviderContextLengthError,\n} from '../../../domain/errors/AIErrors.js';\nimport { StreamEvent } from '../../../domain/entities/StreamEvent.js';\nimport { OpenAIResponsesConverter } from './OpenAIResponsesConverter.js';\nimport { OpenAIResponsesStreamConverter } from './OpenAIResponsesStreamConverter.js';\nimport * as ResponsesAPI from 'openai/resources/responses/responses.js';\nimport { getModelInfo } from '../../../domain/entities/Model.js';\n\nexport class OpenAITextProvider extends BaseTextProvider {\n  readonly name: string = 'openai';\n  readonly capabilities: ProviderCapabilities = {\n    text: true,\n    images: true,\n    videos: false,\n    audio: true,\n  };\n\n  private client: OpenAI;\n  private converter: OpenAIResponsesConverter;\n  private streamConverter: OpenAIResponsesStreamConverter;\n\n  constructor(config: OpenAIConfig) {\n    super(config);\n\n    this.client = new OpenAI({\n      apiKey: this.getApiKey(),\n      baseURL: this.getBaseURL(),\n      organization: config.organization,\n      timeout: this.getTimeout(),\n      maxRetries: this.getMaxRetries(),\n    });\n\n    this.converter = new OpenAIResponsesConverter();\n    this.streamConverter = new OpenAIResponsesStreamConverter();\n  }\n\n  /**\n   * Check if a parameter is supported by the model\n   */\n  private supportsParameter(model: string, parameter: 'temperature' | 'topP' | 'frequencyPenalty' | 'presencePenalty'): boolean {\n    const modelInfo = getModelInfo(model);\n    if (!modelInfo?.features.parameters) {\n      // If no parameter info, assume supported (backward compatibility)\n      return true;\n    }\n    return modelInfo.features.parameters[parameter] !== false;\n  }\n\n  /**\n   * Generate response using OpenAI Responses API\n   */\n  async generate(options: TextGenerateOptions): Promise<LLMResponse> {\n    // Execute with circuit breaker protection and observability\n    return this.executeWithCircuitBreaker(async () => {\n      try {\n        // Convert to Responses API format\n        const { input, instructions } = this.converter.convertInput(\n          options.input,\n          options.instructions\n        );\n\n        // Build request parameters\n        const params: any = {\n          model: options.model,\n          input,\n          ...(instructions && { instructions }),\n          ...(options.tools && options.tools.length > 0 && {\n            tools: this.converter.convertTools(options.tools),\n          }),\n          ...(options.tool_choice && {\n            tool_choice: this.converter.convertToolChoice(options.tool_choice),\n          }),\n          ...(options.temperature !== undefined &&\n              this.supportsParameter(options.model, 'temperature') &&\n              { temperature: options.temperature }),\n          ...(options.max_output_tokens && { max_output_tokens: options.max_output_tokens }),\n          ...(options.response_format && {\n            text: this.converter.convertResponseFormat(options.response_format),\n          }),\n          ...(options.parallel_tool_calls !== undefined && {\n            parallel_tool_calls: options.parallel_tool_calls,\n          }),\n          ...(options.previous_response_id && {\n            previous_response_id: options.previous_response_id,\n          }),\n          ...(options.metadata && { metadata: options.metadata }),\n        };\n\n        // Call Responses API\n        const response = await this.client.responses.create(params);\n\n        // Convert response to our format\n        return this.converter.convertResponse(response);\n      } catch (error: any) {\n        this.handleError(error);\n        throw error; // TypeScript needs this\n      }\n    }, options.model);\n  }\n\n  /**\n   * Stream response using OpenAI Responses API\n   */\n  async *streamGenerate(options: TextGenerateOptions): AsyncIterableIterator<StreamEvent> {\n    try {\n      // Convert to Responses API format\n      const { input, instructions } = this.converter.convertInput(\n        options.input,\n        options.instructions\n      );\n\n      // Build request parameters\n      const params: any = {\n        model: options.model,\n        input,\n        ...(instructions && { instructions }),\n        ...(options.tools && options.tools.length > 0 && {\n          tools: this.converter.convertTools(options.tools),\n        }),\n        ...(options.tool_choice && {\n          tool_choice: this.converter.convertToolChoice(options.tool_choice),\n        }),\n        ...(options.temperature !== undefined &&\n            this.supportsParameter(options.model, 'temperature') &&\n            { temperature: options.temperature }),\n        ...(options.max_output_tokens && { max_output_tokens: options.max_output_tokens }),\n        ...(options.response_format && {\n          text: this.converter.convertResponseFormat(options.response_format),\n        }),\n        ...(options.parallel_tool_calls !== undefined && {\n          parallel_tool_calls: options.parallel_tool_calls,\n        }),\n        ...(options.previous_response_id && {\n          previous_response_id: options.previous_response_id,\n        }),\n        ...(options.metadata && { metadata: options.metadata }),\n        stream: true,\n      };\n\n      // Call Responses API with streaming\n      const stream = await this.client.responses.create(params) as any;\n\n      // Convert stream events using the stream converter\n      yield* this.streamConverter.convertStream(stream as AsyncIterable<ResponsesAPI.ResponseStreamEvent>);\n    } catch (error: any) {\n      this.handleError(error);\n      throw error;\n    }\n  }\n\n  /**\n   * Get model capabilities\n   */\n  getModelCapabilities(model: string): ModelCapabilities {\n    // GPT-4 models\n    if (model.startsWith('gpt-4')) {\n      return {\n        supportsTools: true,\n        supportsVision: model.includes('vision') || !model.includes('0613'),\n        supportsJSON: true,\n        supportsJSONSchema: true,\n        maxTokens: model.includes('turbo') ? 128000 : 8192,\n        maxOutputTokens: 16384,\n      };\n    }\n\n    // GPT-3.5\n    if (model.startsWith('gpt-3.5')) {\n      return {\n        supportsTools: true,\n        supportsVision: false,\n        supportsJSON: true,\n        supportsJSONSchema: false,\n        maxTokens: 16385,\n        maxOutputTokens: 4096,\n      };\n    }\n\n    // o-series (reasoning models)\n    if (model.startsWith('o1') || model.startsWith('o3')) {\n      return {\n        supportsTools: false,\n        supportsVision: true,\n        supportsJSON: false,\n        supportsJSONSchema: false,\n        maxTokens: 200000,\n        maxOutputTokens: 100000,\n      };\n    }\n\n    // Default\n    return {\n      supportsTools: false,\n      supportsVision: false,\n      supportsJSON: false,\n      supportsJSONSchema: false,\n      maxTokens: 4096,\n      maxOutputTokens: 4096,\n    };\n  }\n\n\n  /**\n   * Handle OpenAI-specific errors\n   */\n  private handleError(error: any): never {\n    if (error.status === 401) {\n      throw new ProviderAuthError('openai', 'Invalid API key');\n    }\n\n    if (error.status === 429) {\n      const retryAfter = error.headers?.['retry-after'];\n      throw new ProviderRateLimitError(\n        'openai',\n        retryAfter ? parseInt(retryAfter) * 1000 : undefined\n      );\n    }\n\n    if (error.code === 'context_length_exceeded' || error.status === 413) {\n      throw new ProviderContextLengthError('openai', 128000);\n    }\n\n    // Re-throw other errors\n    throw error;\n  }\n}\n","/**\n * Shared Response Builder Utilities\n *\n * DRY principle: Response building logic shared across all providers.\n * Each provider has different raw response formats, but the final\n * LLMResponse structure is the same.\n */\n\nimport { randomUUID } from 'crypto';\nimport { LLMResponse } from '../../../domain/entities/Response.js';\nimport { OutputItem, MessageRole } from '../../../domain/entities/Message.js';\nimport { Content, ContentType } from '../../../domain/entities/Content.js';\n\n/**\n * Response status type (matches LLMResponse.status)\n */\nexport type ResponseStatus = 'completed' | 'failed' | 'in_progress' | 'cancelled' | 'queued' | 'incomplete';\n\n/**\n * Usage statistics for a response\n */\nexport interface UsageStats {\n  inputTokens: number;\n  outputTokens: number;\n  totalTokens?: number;\n}\n\n/**\n * Options for building an LLMResponse\n */\nexport interface ResponseBuilderOptions {\n  /** Provider name for ID prefix (e.g., 'anthropic', 'google') */\n  provider: string;\n  /** Raw response ID from the provider (optional) */\n  rawId?: string;\n  /** Model name/version */\n  model: string;\n  /** Response status */\n  status: ResponseStatus;\n  /** Content array for the assistant message */\n  content: Content[];\n  /** Usage statistics */\n  usage: UsageStats;\n  /** Optional message ID (separate from response ID) */\n  messageId?: string;\n  /** Timestamp (defaults to now) */\n  createdAt?: number;\n}\n\n/**\n * Build a standardized LLMResponse object\n *\n * All providers should use this to ensure consistent response format.\n *\n * @param options - Response building options\n * @returns Standardized LLMResponse\n */\nexport function buildLLMResponse(options: ResponseBuilderOptions): LLMResponse {\n  const {\n    provider,\n    rawId,\n    model,\n    status,\n    content,\n    usage,\n    messageId,\n    createdAt = Math.floor(Date.now() / 1000),\n  } = options;\n\n  // Generate IDs\n  const responseId = rawId ? `resp_${provider}_${rawId}` : `resp_${provider}_${randomUUID()}`;\n  const msgId = messageId || `msg_${provider}_${randomUUID()}`;\n\n  // Build output array with assistant message\n  const output: OutputItem[] = [\n    {\n      type: 'message',\n      id: msgId,\n      role: MessageRole.ASSISTANT,\n      content,\n    },\n  ];\n\n  // Extract text from content\n  const outputText = extractTextFromContent(content);\n\n  return {\n    id: responseId,\n    object: 'response',\n    created_at: createdAt,\n    status,\n    model,\n    output,\n    output_text: outputText,\n    usage: {\n      input_tokens: usage.inputTokens,\n      output_tokens: usage.outputTokens,\n      total_tokens: usage.totalTokens ?? (usage.inputTokens + usage.outputTokens),\n    },\n  };\n}\n\n/**\n * Extract text content from a Content array\n *\n * @param content - Content array to extract text from\n * @returns Concatenated text content\n */\nexport function extractTextFromContent(content: Content[]): string {\n  return content\n    .filter((c): c is Content & { type: typeof ContentType.OUTPUT_TEXT } =>\n      c.type === ContentType.OUTPUT_TEXT\n    )\n    .map((c) => c.text)\n    .join('\\n');\n}\n\n/**\n * Create a text content item\n *\n * @param text - The text content\n * @returns Content object\n */\nexport function createTextContent(text: string): Content {\n  return {\n    type: ContentType.OUTPUT_TEXT,\n    text,\n    annotations: [],\n  };\n}\n\n/**\n * Create a tool_use content item\n *\n * @param id - Tool call ID\n * @param name - Tool/function name\n * @param args - Arguments as JSON string or object\n * @returns Content object\n */\nexport function createToolUseContent(\n  id: string,\n  name: string,\n  args: string | Record<string, unknown>\n): Content {\n  return {\n    type: ContentType.TOOL_USE,\n    id,\n    name,\n    arguments: typeof args === 'string' ? args : JSON.stringify(args),\n  };\n}\n\n/**\n * Mapping functions for provider-specific status to our ResponseStatus\n */\n\n/**\n * Map OpenAI status to ResponseStatus\n */\nexport function mapOpenAIStatus(status?: string): ResponseStatus {\n  switch (status) {\n    case 'completed':\n      return 'completed';\n    case 'incomplete':\n      return 'incomplete';\n    case 'cancelled':\n    case 'failed':\n      return 'failed';\n    default:\n      return 'completed';\n  }\n}\n\n/**\n * Map Anthropic stop_reason to ResponseStatus\n */\nexport function mapAnthropicStatus(stopReason: string | null): ResponseStatus {\n  switch (stopReason) {\n    case 'end_turn':\n    case 'tool_use':\n    case 'stop_sequence':\n      return 'completed';\n    case 'max_tokens':\n      return 'incomplete';\n    default:\n      return 'incomplete';\n  }\n}\n\n/**\n * Map Google finish_reason to ResponseStatus\n */\nexport function mapGoogleStatus(finishReason?: string): ResponseStatus {\n  switch (finishReason) {\n    case 'STOP':\n      return 'completed';\n    case 'MAX_TOKENS':\n      return 'incomplete';\n    case 'SAFETY':\n    case 'RECITATION':\n      return 'failed';\n    case 'OTHER':\n    default:\n      return 'incomplete';\n  }\n}\n\n/**\n * Generate a tool call ID with optional provider prefix\n *\n * @param provider - Provider name for prefix\n * @returns Generated tool call ID\n */\nexport function generateToolCallId(provider?: string): string {\n  const uuid = randomUUID();\n  return provider ? `${provider}_${uuid}` : uuid;\n}\n","/**\n * Shared Tool Conversion Utilities\n *\n * DRY principle: Tool conversion logic shared across all providers\n * Each provider has slightly different tool formats, but the extraction\n * and basic conversion is the same.\n */\n\nimport { FunctionToolDefinition, Tool } from '../../../domain/entities/Tool.js';\n\n/**\n * Standardized tool format before provider-specific transformation\n */\nexport interface ProviderToolFormat {\n  name: string;\n  description: string;\n  parameters: Record<string, any>;\n}\n\n/**\n * Extract function tools from mixed tool array\n * Filters out built-in tools (web_search, code_interpreter, etc.)\n *\n * @param tools - Mixed array of tool definitions\n * @returns Only function tools\n */\nexport function extractFunctionTools(\n  tools: Tool[]\n): FunctionToolDefinition[] {\n  return tools.filter((t): t is FunctionToolDefinition => t.type === 'function');\n}\n\n/**\n * Convert tools to standard format (before provider transformation)\n * Extracts common properties: name, description, parameters\n *\n * @param tools - Array of tool definitions\n * @returns Standardized tool format\n */\nexport function convertToolsToStandardFormat(\n  tools: Tool[]\n): ProviderToolFormat[] {\n  return extractFunctionTools(tools).map((tool) => ({\n    name: tool.function.name,\n    description: tool.function.description || '',\n    parameters: tool.function.parameters || { type: 'object', properties: {} },\n  }));\n}\n\n/**\n * Transform for Anthropic API (uses input_schema)\n *\n * @param tool - Standardized tool format\n * @returns Anthropic-specific tool format\n */\nexport function transformForAnthropic(tool: ProviderToolFormat) {\n  return {\n    name: tool.name,\n    description: tool.description,\n    input_schema: tool.parameters,\n  };\n}\n\n/**\n * Transform for Google Gemini API (uses parameters)\n *\n * @param tool - Standardized tool format\n * @returns Google-specific tool format\n */\nexport function transformForGoogle(tool: ProviderToolFormat) {\n  return {\n    name: tool.name,\n    description: tool.description,\n    parameters: tool.parameters,\n  };\n}\n\n/**\n * Transform for OpenAI API (uses function definition)\n *\n * @param tool - Standardized tool format\n * @returns OpenAI-specific tool format\n */\nexport function transformForOpenAI(tool: ProviderToolFormat) {\n  return {\n    type: 'function' as const,\n    function: {\n      name: tool.name,\n      description: tool.description,\n      parameters: tool.parameters,\n    },\n  };\n}\n","/**\n * Base Converter - Abstract base class for provider-specific message conversion\n *\n * DRY principle: Provides common patterns for all provider converters:\n * - Input normalization (string | InputItem[]  provider format)\n * - Content type conversion (ContentType  provider content blocks)\n * - Tool schema conversion (Tool[]  provider tool format)\n * - Response extraction (provider response  LLMResponse)\n * - Error mapping (provider error  standard error)\n * - Resource cleanup lifecycle\n *\n * Provider-specific converters extend this and implement abstract methods.\n */\n\nimport { TextGenerateOptions } from '../../../domain/interfaces/ITextProvider.js';\nimport { LLMResponse } from '../../../domain/entities/Response.js';\nimport { InputItem, MessageRole } from '../../../domain/entities/Message.js';\nimport { Content, ContentType } from '../../../domain/entities/Content.js';\nimport { Tool } from '../../../domain/entities/Tool.js';\nimport { InvalidToolArgumentsError } from '../../../domain/errors/AIErrors.js';\nimport {\n  buildLLMResponse,\n  createTextContent,\n  createToolUseContent,\n  ResponseStatus,\n  UsageStats,\n} from '../shared/ResponseBuilder.js';\nimport { convertToolsToStandardFormat, ProviderToolFormat } from '../shared/ToolConversionUtils.js';\n\n/**\n * Image data parsed from a data URI\n */\nexport interface ParsedImageData {\n  mediaType: string;\n  data: string;\n  format: string;\n}\n\n/**\n * Provider-specific request format (abstract, defined by subclass)\n * Using Record<string, unknown> would be too restrictive -\n * providers have their own typed request formats\n */\n// eslint-disable-next-line @typescript-eslint/no-empty-object-type\nexport interface ProviderRequest {}\n\n/**\n * Provider-specific response format (abstract, defined by subclass)\n */\n// eslint-disable-next-line @typescript-eslint/no-empty-object-type\nexport interface ProviderResponse {}\n\n/**\n * Abstract base converter for all LLM providers.\n *\n * Subclasses implement provider-specific conversion logic while inheriting\n * common patterns for input normalization, tool conversion, and response building.\n *\n * @template TRequest - Provider-specific request type\n * @template TResponse - Provider-specific response type\n */\nexport abstract class BaseConverter<\n  TRequest extends ProviderRequest = ProviderRequest,\n  TResponse extends ProviderResponse = ProviderResponse,\n> {\n  // ==========================================================================\n  // Abstract Methods (must be implemented by subclasses)\n  // ==========================================================================\n\n  /**\n   * Get the provider name (used for error messages and IDs)\n   */\n  abstract readonly providerName: string;\n\n  /**\n   * Convert our TextGenerateOptions to provider-specific request format\n   */\n  abstract convertRequest(options: TextGenerateOptions): TRequest | Promise<TRequest>;\n\n  /**\n   * Convert provider response to our LLMResponse format\n   */\n  abstract convertResponse(response: TResponse): LLMResponse;\n\n  /**\n   * Transform a standardized tool to provider-specific format\n   */\n  protected abstract transformTool(tool: ProviderToolFormat): unknown;\n\n  /**\n   * Convert provider-specific content blocks to our Content[]\n   */\n  protected abstract convertProviderContent(blocks: unknown[]): Content[];\n\n  /**\n   * Map provider status to our ResponseStatus\n   */\n  protected abstract mapProviderStatus(status: unknown): ResponseStatus;\n\n  // ==========================================================================\n  // Protected Helper Methods (shared by all providers)\n  // ==========================================================================\n\n  /**\n   * Convert InputItem array to provider messages\n   * @param input - String or InputItem array\n   * @returns Normalized input ready for provider conversion\n   */\n  protected normalizeInput(input: string | InputItem[]): InputItem[] {\n    if (typeof input === 'string') {\n      return [\n        {\n          type: 'message',\n          role: MessageRole.USER,\n          content: [{ type: ContentType.INPUT_TEXT, text: input }],\n        },\n      ];\n    }\n    return input;\n  }\n\n  /**\n   * Map our role to provider-specific role\n   * Override in subclass if provider uses different role names\n   */\n  protected mapRole(role: MessageRole): string {\n    // Most providers don't have 'developer' role - map to 'user'\n    if (role === MessageRole.DEVELOPER) {\n      return 'user';\n    }\n    return role;\n  }\n\n  /**\n   * Convert our Tool[] to provider-specific tool format\n   */\n  protected convertTools(tools?: Tool[]): unknown[] | undefined {\n    if (!tools || tools.length === 0) {\n      return undefined;\n    }\n\n    const standardTools = convertToolsToStandardFormat(tools);\n    return standardTools.map((tool) => this.transformTool(tool));\n  }\n\n  /**\n   * Parse tool arguments from JSON string\n   * Throws InvalidToolArgumentsError on parse failure\n   */\n  protected parseToolArguments(name: string, argsString: string): unknown {\n    try {\n      return JSON.parse(argsString);\n    } catch (parseError) {\n      throw new InvalidToolArgumentsError(\n        name,\n        argsString,\n        parseError instanceof Error ? parseError : new Error(String(parseError))\n      );\n    }\n  }\n\n  /**\n   * Parse a data URI into components\n   * @returns Parsed image data or null if not a data URI\n   */\n  protected parseDataUri(url: string): ParsedImageData | null {\n    const matches = url.match(/^data:image\\/(\\w+);base64,(.+)$/);\n    if (!matches || matches.length < 3) {\n      return null;\n    }\n\n    const format = matches[1]!;\n    const data = matches[2]!;\n\n    return {\n      format,\n      mediaType: `image/${format}`,\n      data,\n    };\n  }\n\n  /**\n   * Check if URL is a data URI\n   */\n  protected isDataUri(url: string): boolean {\n    return url.startsWith('data:');\n  }\n\n  /**\n   * Build standardized LLMResponse using shared utility\n   */\n  protected buildResponse(options: {\n    rawId?: string;\n    model: string;\n    status: ResponseStatus;\n    content: Content[];\n    usage: UsageStats;\n    messageId?: string;\n  }): LLMResponse {\n    return buildLLMResponse({\n      provider: this.providerName,\n      ...options,\n    });\n  }\n\n  /**\n   * Create a text content block\n   */\n  protected createText(text: string): Content {\n    return createTextContent(text);\n  }\n\n  /**\n   * Create a tool_use content block\n   */\n  protected createToolUse(id: string, name: string, args: string | Record<string, unknown>): Content {\n    return createToolUseContent(id, name, args);\n  }\n\n  /**\n   * Extract text from Content array\n   */\n  protected extractText(content: Content[]): string {\n    return content\n      .filter((c) => c.type === ContentType.OUTPUT_TEXT)\n      .map((c) => (c as { text: string }).text)\n      .join('\\n');\n  }\n\n  /**\n   * Handle content conversion for common content types\n   * Can be used as a starting point in subclass convertContent methods\n   */\n  protected handleCommonContent(\n    content: Content,\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    _handlers: {\n      onText?: (text: string) => void;\n      onImage?: (url: string, parsed: ParsedImageData | null) => void;\n      onToolUse?: (id: string, name: string, args: unknown) => void;\n      onToolResult?: (\n        toolUseId: string,\n        result: string | unknown,\n        isError: boolean,\n        errorMessage?: string\n      ) => void;\n    }\n  ): boolean {\n    const handlers = _handlers;\n\n    switch (content.type) {\n      case ContentType.INPUT_TEXT:\n      case ContentType.OUTPUT_TEXT:\n        handlers.onText?.((content as { text: string }).text);\n        return true;\n\n      case ContentType.INPUT_IMAGE_URL: {\n        const imgContent = content as { image_url: { url: string } };\n        const parsed = this.parseDataUri(imgContent.image_url.url);\n        handlers.onImage?.(imgContent.image_url.url, parsed);\n        return true;\n      }\n\n      case ContentType.TOOL_USE: {\n        const toolContent = content as { id: string; name: string; arguments: string };\n        const parsedArgs = this.parseToolArguments(toolContent.name, toolContent.arguments);\n        handlers.onToolUse?.(toolContent.id, toolContent.name, parsedArgs);\n        return true;\n      }\n\n      case ContentType.TOOL_RESULT: {\n        const resultContent = content as {\n          tool_use_id: string;\n          content: string | unknown;\n          error?: string;\n        };\n        const isError = !!resultContent.error;\n        handlers.onToolResult?.(\n          resultContent.tool_use_id,\n          resultContent.content,\n          isError,\n          resultContent.error\n        );\n        return true;\n      }\n\n      default:\n        return false;\n    }\n  }\n\n  // ==========================================================================\n  // Resource Cleanup (required lifecycle method)\n  // ==========================================================================\n\n  /**\n   * Clean up any internal state/caches\n   * Should be called after each request/response cycle to prevent memory leaks\n   *\n   * Default implementation does nothing - override if subclass maintains state\n   */\n  clear(): void {\n    // Default: no state to clear\n    // Subclasses override if they maintain Maps, caches, etc.\n  }\n\n  /**\n   * Alias for clear() - reset converter state\n   */\n  reset(): void {\n    this.clear();\n  }\n}\n\n/**\n * Type guard for checking if converter has async request conversion\n */\nexport function hasAsyncConvert(\n  _converter: BaseConverter\n): _converter is BaseConverter & { convertRequest: (options: TextGenerateOptions) => Promise<ProviderRequest> } {\n  // All converters may be async (convertRequest can return Promise)\n  return true;\n}\n","/**\n * Anthropic Converter - Converts between our Responses API format and Anthropic Messages API\n *\n * Extends BaseConverter for common patterns:\n * - Input normalization\n * - Tool conversion\n * - Response building\n * - Resource cleanup\n */\n\nimport Anthropic from '@anthropic-ai/sdk';\nimport { BaseConverter } from '../base/BaseConverter.js';\nimport { TextGenerateOptions } from '../../../domain/interfaces/ITextProvider.js';\nimport { LLMResponse } from '../../../domain/entities/Response.js';\nimport { InputItem } from '../../../domain/entities/Message.js';\nimport { Content, ContentType } from '../../../domain/entities/Content.js';\nimport { Tool } from '../../../domain/entities/Tool.js';\nimport { convertToolsToStandardFormat, transformForAnthropic, ProviderToolFormat } from '../shared/ToolConversionUtils.js';\nimport { mapAnthropicStatus, ResponseStatus } from '../shared/ResponseBuilder.js';\n\nexport class AnthropicConverter extends BaseConverter<Anthropic.MessageCreateParams, Anthropic.Message> {\n  readonly providerName = 'anthropic';\n\n  /**\n   * Convert our format -> Anthropic Messages API format\n   */\n  convertRequest(options: TextGenerateOptions): Anthropic.MessageCreateParams {\n    const messages = this.convertMessages(options.input);\n    const tools = this.convertAnthropicTools(options.tools);\n\n    const params: Anthropic.MessageCreateParams = {\n      model: options.model,\n      max_tokens: options.max_output_tokens || 4096,\n      messages,\n    };\n\n    // Add system instruction if provided\n    if (options.instructions) {\n      params.system = options.instructions;\n    }\n\n    // Add tools if provided\n    if (tools && tools.length > 0) {\n      params.tools = tools;\n    }\n\n    // Add temperature if provided\n    if (options.temperature !== undefined) {\n      params.temperature = options.temperature;\n    }\n\n    return params;\n  }\n\n  /**\n   * Convert Anthropic response -> our LLMResponse format\n   */\n  convertResponse(response: Anthropic.Message): LLMResponse {\n    return this.buildResponse({\n      rawId: response.id,\n      model: response.model,\n      status: this.mapProviderStatus(response.stop_reason),\n      content: this.convertProviderContent(response.content),\n      messageId: response.id,\n      usage: {\n        inputTokens: response.usage.input_tokens,\n        outputTokens: response.usage.output_tokens,\n      },\n    });\n  }\n\n  // ==========================================================================\n  // BaseConverter Abstract Method Implementations\n  // ==========================================================================\n\n  /**\n   * Transform standardized tool to Anthropic format\n   */\n  protected transformTool(tool: ProviderToolFormat): Anthropic.Tool {\n    return {\n      ...transformForAnthropic(tool),\n      input_schema: {\n        type: 'object',\n        ...tool.parameters,\n      } as Anthropic.Tool.InputSchema,\n    };\n  }\n\n  /**\n   * Convert Anthropic content blocks to our Content[]\n   */\n  protected convertProviderContent(blocks: unknown[]): Content[] {\n    const content: Content[] = [];\n\n    for (const block of blocks as Anthropic.ContentBlock[]) {\n      if (block.type === 'text') {\n        content.push(this.createText(block.text));\n      } else if (block.type === 'tool_use') {\n        content.push(this.createToolUse(block.id, block.name, block.input as Record<string, unknown>));\n      }\n    }\n\n    return content;\n  }\n\n  /**\n   * Map Anthropic stop_reason to ResponseStatus\n   */\n  protected mapProviderStatus(status: unknown): ResponseStatus {\n    return mapAnthropicStatus(status as string | null);\n  }\n\n  // ==========================================================================\n  // Anthropic-Specific Conversion Methods\n  // ==========================================================================\n\n  /**\n   * Convert our InputItem[] -> Anthropic messages\n   */\n  private convertMessages(input: string | InputItem[]): Anthropic.MessageParam[] {\n    if (typeof input === 'string') {\n      return [{ role: 'user', content: input }];\n    }\n\n    const messages: Anthropic.MessageParam[] = [];\n\n    for (const item of input) {\n      if (item.type === 'message') {\n        // Map roles: 'developer' -> 'user' (Anthropic doesn't have developer role)\n        const role = this.mapRole(item.role);\n\n        // Convert content\n        const content = this.convertContent(item.content);\n\n        messages.push({\n          role: role as 'user' | 'assistant',\n          content,\n        });\n      }\n    }\n\n    return messages;\n  }\n\n  /**\n   * Convert our Content[] -> Anthropic content blocks\n   */\n  private convertContent(content: Content[]): Anthropic.MessageParam['content'] {\n    const blocks: Array<Anthropic.TextBlockParam | Anthropic.ImageBlockParam | Anthropic.ToolUseBlockParam | Anthropic.ToolResultBlockParam> = [];\n\n    for (const c of content) {\n      switch (c.type) {\n        case ContentType.INPUT_TEXT:\n        case ContentType.OUTPUT_TEXT:\n          blocks.push({\n            type: 'text',\n            text: (c as { text: string }).text,\n          });\n          break;\n\n        case ContentType.INPUT_IMAGE_URL: {\n          const imgContent = c as { image_url: { url: string } };\n          const block = this.convertImageToAnthropicBlock(imgContent.image_url.url);\n          if (block) {\n            blocks.push(block);\n          }\n          break;\n        }\n\n        case ContentType.TOOL_RESULT: {\n          const resultContent = c as {\n            tool_use_id: string;\n            content: string | unknown;\n            error?: string;\n          };\n          blocks.push(this.convertToolResultToAnthropicBlock(resultContent));\n          break;\n        }\n\n        case ContentType.TOOL_USE: {\n          const toolContent = c as { id: string; name: string; arguments: string };\n          const parsedInput = this.parseToolArguments(toolContent.name, toolContent.arguments);\n          blocks.push({\n            type: 'tool_use',\n            id: toolContent.id,\n            name: toolContent.name,\n            input: parsedInput as Record<string, unknown>,\n          });\n          break;\n        }\n      }\n    }\n\n    // If only one text block, return as string\n    if (blocks.length === 1 && blocks[0]?.type === 'text') {\n      return (blocks[0] as Anthropic.TextBlockParam).text;\n    }\n\n    return blocks;\n  }\n\n  /**\n   * Convert image URL to Anthropic image block\n   */\n  private convertImageToAnthropicBlock(url: string): Anthropic.ImageBlockParam | null {\n    const parsed = this.parseDataUri(url);\n\n    if (parsed) {\n      // Base64 data URI\n      return {\n        type: 'image',\n        source: {\n          type: 'base64',\n          media_type: parsed.mediaType as Anthropic.ImageBlockParam['source']['media_type'],\n          data: parsed.data,\n        },\n      };\n    } else {\n      // URL (Claude 3.5+ supports this)\n      // Note: Anthropic SDK types may not include 'url' source type yet\n      return {\n        type: 'image',\n        source: {\n          type: 'url',\n          url,\n        },\n      } as unknown as Anthropic.ImageBlockParam;\n    }\n  }\n\n  /**\n   * Convert tool result to Anthropic block\n   * Anthropic requires non-empty content when is_error is true\n   */\n  private convertToolResultToAnthropicBlock(resultContent: {\n    tool_use_id: string;\n    content: string | unknown;\n    error?: string;\n  }): Anthropic.ToolResultBlockParam {\n    const isError = !!resultContent.error;\n    let toolResultContent: string;\n\n    if (typeof resultContent.content === 'string') {\n      // For error cases with empty content, use the error message\n      toolResultContent = resultContent.content || (isError ? resultContent.error! : '');\n    } else {\n      toolResultContent = JSON.stringify(resultContent.content);\n    }\n\n    // Anthropic API rejects empty content when is_error is true\n    if (isError && !toolResultContent) {\n      toolResultContent = resultContent.error || 'Tool execution failed';\n    }\n\n    return {\n      type: 'tool_result',\n      tool_use_id: resultContent.tool_use_id,\n      content: toolResultContent,\n      is_error: isError,\n    };\n  }\n\n  /**\n   * Convert our Tool[] -> Anthropic tools\n   * Uses shared conversion utilities (DRY)\n   */\n  private convertAnthropicTools(tools?: Tool[]): Anthropic.Tool[] | undefined {\n    if (!tools || tools.length === 0) {\n      return undefined;\n    }\n\n    const standardTools = convertToolsToStandardFormat(tools);\n    return standardTools.map((tool) => this.transformTool(tool));\n  }\n}\n","/**\n * Base Stream Converter - Abstract base class for streaming event conversion\n *\n * DRY principle: Provides common patterns for all stream converters:\n * - State management (response ID, sequence numbers)\n * - Tool call buffering (incremental argument accumulation)\n * - Usage tracking (input/output tokens)\n * - Lifecycle management (clear/reset)\n *\n * Provider-specific stream converters extend this and implement abstract methods.\n */\n\nimport { StreamEvent, StreamEventType } from '../../../domain/entities/StreamEvent.js';\n\n/**\n * Buffer for accumulating tool call arguments during streaming\n */\nexport interface ToolCallBuffer {\n  id: string;\n  name: string;\n  args: string;\n}\n\n/**\n * Usage statistics tracked during streaming\n */\nexport interface StreamUsage {\n  inputTokens: number;\n  outputTokens: number;\n}\n\n/**\n * Abstract base class for streaming event converters.\n *\n * Manages common state and provides helper methods for emitting events.\n *\n * @template TEvent - Provider-specific stream event type\n */\nexport abstract class BaseStreamConverter<TEvent = unknown> {\n  // ==========================================================================\n  // Protected State (shared across all stream converters)\n  // ==========================================================================\n\n  /** Current response ID */\n  protected responseId: string = '';\n\n  /** Model name */\n  protected model: string = '';\n\n  /** Event sequence number for ordering */\n  protected sequenceNumber: number = 0;\n\n  /** Usage statistics */\n  protected usage: StreamUsage = { inputTokens: 0, outputTokens: 0 };\n\n  /** Buffers for accumulating tool call arguments */\n  protected toolCallBuffers: Map<string, ToolCallBuffer> = new Map();\n\n  // ==========================================================================\n  // Abstract Methods (must be implemented by subclasses)\n  // ==========================================================================\n\n  /**\n   * Get the provider name (used for ID generation)\n   */\n  abstract readonly providerName: string;\n\n  /**\n   * Convert a single provider event to our StreamEvent(s)\n   * May return empty array if event should be ignored\n   */\n  protected abstract convertEvent(event: TEvent): StreamEvent[];\n\n  // ==========================================================================\n  // Public API\n  // ==========================================================================\n\n  /**\n   * Convert provider stream to our StreamEvent format\n   *\n   * @param stream - Provider-specific async stream\n   * @param model - Model name (may not be available in all events)\n   */\n  async *convertStream(\n    stream: AsyncIterable<TEvent>,\n    model?: string\n  ): AsyncIterableIterator<StreamEvent> {\n    // Initialize/reset state for new stream\n    this.reset();\n    if (model) {\n      this.model = model;\n    }\n\n    try {\n      for await (const event of stream) {\n        const converted = this.convertEvent(event);\n        for (const evt of converted) {\n          yield evt;\n        }\n      }\n    } finally {\n      // Note: Don't clear state here - response may need final events\n      // Caller should call clear() when done processing\n    }\n  }\n\n  /**\n   * Clear all internal state\n   * Should be called after stream is fully processed\n   */\n  clear(): void {\n    this.responseId = '';\n    this.model = '';\n    this.sequenceNumber = 0;\n    this.usage = { inputTokens: 0, outputTokens: 0 };\n    this.toolCallBuffers.clear();\n  }\n\n  /**\n   * Reset converter state for a new stream\n   * Alias for clear()\n   */\n  reset(): void {\n    this.clear();\n  }\n\n  // ==========================================================================\n  // Protected Helper Methods\n  // ==========================================================================\n\n  /**\n   * Generate a response ID with provider prefix\n   */\n  protected generateResponseId(): string {\n    const uuid = crypto.randomUUID();\n    return `resp_${this.providerName}_${uuid}`;\n  }\n\n  /**\n   * Get next sequence number (auto-increments)\n   */\n  protected nextSequence(): number {\n    return this.sequenceNumber++;\n  }\n\n  /**\n   * Create RESPONSE_CREATED event\n   */\n  protected emitResponseCreated(responseId?: string): StreamEvent {\n    if (responseId) {\n      this.responseId = responseId;\n    } else if (!this.responseId) {\n      this.responseId = this.generateResponseId();\n    }\n\n    return {\n      type: StreamEventType.RESPONSE_CREATED,\n      response_id: this.responseId,\n      model: this.model,\n      created_at: Date.now(),\n    };\n  }\n\n  /**\n   * Create OUTPUT_TEXT_DELTA event\n   */\n  protected emitTextDelta(\n    delta: string,\n    options?: { itemId?: string; outputIndex?: number; contentIndex?: number }\n  ): StreamEvent {\n    return {\n      type: StreamEventType.OUTPUT_TEXT_DELTA,\n      response_id: this.responseId,\n      item_id: options?.itemId || `msg_${this.responseId}`,\n      output_index: options?.outputIndex ?? 0,\n      content_index: options?.contentIndex ?? 0,\n      delta,\n      sequence_number: this.nextSequence(),\n    };\n  }\n\n  /**\n   * Create TOOL_CALL_START event\n   */\n  protected emitToolCallStart(toolCallId: string, toolName: string, itemId?: string): StreamEvent {\n    // Initialize buffer for this tool call\n    this.toolCallBuffers.set(toolCallId, {\n      id: toolCallId,\n      name: toolName,\n      args: '',\n    });\n\n    return {\n      type: StreamEventType.TOOL_CALL_START,\n      response_id: this.responseId,\n      item_id: itemId || `msg_${this.responseId}`,\n      tool_call_id: toolCallId,\n      tool_name: toolName,\n    };\n  }\n\n  /**\n   * Create TOOL_CALL_ARGUMENTS_DELTA event and accumulate args\n   */\n  protected emitToolCallArgsDelta(\n    toolCallId: string,\n    delta: string,\n    toolName?: string\n  ): StreamEvent {\n    // Accumulate arguments\n    const buffer = this.toolCallBuffers.get(toolCallId);\n    if (buffer) {\n      buffer.args += delta;\n    }\n\n    return {\n      type: StreamEventType.TOOL_CALL_ARGUMENTS_DELTA,\n      response_id: this.responseId,\n      item_id: `msg_${this.responseId}`,\n      tool_call_id: toolCallId,\n      tool_name: toolName || buffer?.name || '',\n      delta,\n      sequence_number: this.nextSequence(),\n    };\n  }\n\n  /**\n   * Create TOOL_CALL_ARGUMENTS_DONE event with accumulated args\n   */\n  protected emitToolCallArgsDone(toolCallId: string, toolName?: string): StreamEvent {\n    const buffer = this.toolCallBuffers.get(toolCallId);\n    const args = buffer?.args || '{}';\n    const name = toolName || buffer?.name || '';\n\n    return {\n      type: StreamEventType.TOOL_CALL_ARGUMENTS_DONE,\n      response_id: this.responseId,\n      tool_call_id: toolCallId,\n      tool_name: name,\n      arguments: args,\n    };\n  }\n\n  /**\n   * Create RESPONSE_COMPLETE event\n   */\n  protected emitResponseComplete(status: 'completed' | 'failed' | 'incomplete' = 'completed'): StreamEvent {\n    return {\n      type: StreamEventType.RESPONSE_COMPLETE,\n      response_id: this.responseId,\n      status,\n      usage: {\n        input_tokens: this.usage.inputTokens,\n        output_tokens: this.usage.outputTokens,\n        total_tokens: this.usage.inputTokens + this.usage.outputTokens,\n      },\n      iterations: 1,\n    };\n  }\n\n  /**\n   * Update usage statistics\n   */\n  protected updateUsage(inputTokens?: number, outputTokens?: number): void {\n    if (inputTokens !== undefined) {\n      this.usage.inputTokens = inputTokens;\n    }\n    if (outputTokens !== undefined) {\n      this.usage.outputTokens = outputTokens;\n    }\n  }\n\n  /**\n   * Get accumulated arguments for a tool call\n   */\n  protected getAccumulatedArgs(toolCallId: string): string {\n    return this.toolCallBuffers.get(toolCallId)?.args || '{}';\n  }\n\n  /**\n   * Check if we have buffered data for a tool call\n   */\n  protected hasToolCallBuffer(toolCallId: string): boolean {\n    return this.toolCallBuffers.has(toolCallId);\n  }\n}\n","/**\n * Anthropic Stream Converter - Converts Anthropic SSE events to our unified StreamEvent format\n *\n * Extends BaseStreamConverter for common patterns:\n * - State management (response ID, sequence numbers)\n * - Tool call buffering\n * - Usage tracking\n * - Resource cleanup\n */\n\nimport Anthropic from '@anthropic-ai/sdk';\nimport { StreamEvent } from '../../../domain/entities/StreamEvent.js';\nimport { BaseStreamConverter } from '../base/BaseStreamConverter.js';\n\n/**\n * Block info tracked during streaming\n */\ninterface ContentBlockInfo {\n  type: string;\n  id?: string;\n  name?: string;\n}\n\n/**\n * Converts Anthropic streaming events to our unified StreamEvent format\n */\nexport class AnthropicStreamConverter extends BaseStreamConverter<Anthropic.MessageStreamEvent> {\n  readonly providerName = 'anthropic';\n\n  /** Map of content block index to block info */\n  private contentBlockIndex: Map<number, ContentBlockInfo> = new Map();\n\n  /**\n   * Convert a single Anthropic event to our StreamEvent(s)\n   */\n  protected convertEvent(event: Anthropic.MessageStreamEvent): StreamEvent[] {\n    const eventType = event.type;\n\n    switch (eventType) {\n      case 'message_start':\n        return this.handleMessageStart(event as Anthropic.MessageStartEvent);\n\n      case 'content_block_start':\n        return this.handleContentBlockStart(event as Anthropic.ContentBlockStartEvent);\n\n      case 'content_block_delta':\n        return this.handleContentBlockDelta(event as Anthropic.ContentBlockDeltaEvent);\n\n      case 'content_block_stop':\n        return this.handleContentBlockStop(event as Anthropic.ContentBlockStopEvent);\n\n      case 'message_delta':\n        return this.handleMessageDelta(event as Anthropic.MessageDeltaEvent);\n\n      case 'message_stop':\n        return this.handleMessageStop();\n\n      default:\n        // Handle ping and other event types\n        return [];\n    }\n  }\n\n  /**\n   * Clear all internal state\n   */\n  override clear(): void {\n    super.clear();\n    this.contentBlockIndex.clear();\n  }\n\n  // ==========================================================================\n  // Anthropic-Specific Event Handlers\n  // ==========================================================================\n\n  /**\n   * Handle message_start event\n   */\n  private handleMessageStart(event: Anthropic.MessageStartEvent): StreamEvent[] {\n    this.responseId = event.message.id;\n\n    // Capture input_tokens from message_start (only place it's available)\n    if (event.message.usage) {\n      this.updateUsage(event.message.usage.input_tokens, undefined);\n    }\n\n    return [this.emitResponseCreated(this.responseId)];\n  }\n\n  /**\n   * Handle content_block_start event\n   */\n  private handleContentBlockStart(event: Anthropic.ContentBlockStartEvent): StreamEvent[] {\n    const index = event.index;\n    const block = event.content_block;\n\n    // Track block type\n    if (block.type === 'text') {\n      this.contentBlockIndex.set(index, { type: 'text' });\n      return []; // No event needed, text will come in deltas\n    } else if (block.type === 'tool_use') {\n      this.contentBlockIndex.set(index, {\n        type: 'tool_use',\n        id: block.id,\n        name: block.name,\n      });\n\n      return [this.emitToolCallStart(block.id, block.name, `msg_${this.responseId}`)];\n    }\n\n    return [];\n  }\n\n  /**\n   * Handle content_block_delta event\n   */\n  private handleContentBlockDelta(event: Anthropic.ContentBlockDeltaEvent): StreamEvent[] {\n    const index = event.index;\n    const delta = event.delta;\n    const blockInfo = this.contentBlockIndex.get(index);\n\n    if (!blockInfo) return [];\n\n    if (delta.type === 'text_delta') {\n      return [\n        this.emitTextDelta(delta.text, {\n          itemId: `msg_${this.responseId}`,\n          contentIndex: index,\n        }),\n      ];\n    } else if (delta.type === 'input_json_delta') {\n      const toolCallId = blockInfo.id || '';\n      return [this.emitToolCallArgsDelta(toolCallId, delta.partial_json, blockInfo.name)];\n    }\n\n    return [];\n  }\n\n  /**\n   * Handle content_block_stop event\n   */\n  private handleContentBlockStop(event: Anthropic.ContentBlockStopEvent): StreamEvent[] {\n    const index = event.index;\n    const blockInfo = this.contentBlockIndex.get(index);\n\n    if (!blockInfo) return [];\n\n    // If this was a tool use block, emit arguments done\n    if (blockInfo.type === 'tool_use') {\n      return [this.emitToolCallArgsDone(blockInfo.id || '', blockInfo.name)];\n    }\n\n    return [];\n  }\n\n  /**\n   * Handle message_delta event (usage info, stop_reason)\n   */\n  private handleMessageDelta(event: Anthropic.MessageDeltaEvent): StreamEvent[] {\n    // Extract usage info (Anthropic sends output_tokens in message_delta)\n    // Note: input_tokens is only available in message_start, not in delta\n    if (event.usage) {\n      this.updateUsage(undefined, event.usage.output_tokens);\n    }\n\n    // No events to emit - we'll include usage in message_stop\n    return [];\n  }\n\n  /**\n   * Handle message_stop event (final event)\n   */\n  private handleMessageStop(): StreamEvent[] {\n    return [this.emitResponseComplete('completed')];\n  }\n}\n","/**\n * Anthropic (Claude) text provider\n */\n\nimport Anthropic from '@anthropic-ai/sdk';\nimport { BaseTextProvider } from '../base/BaseTextProvider.js';\nimport { TextGenerateOptions, ModelCapabilities } from '../../../domain/interfaces/ITextProvider.js';\nimport { LLMResponse } from '../../../domain/entities/Response.js';\nimport { ProviderCapabilities } from '../../../domain/interfaces/IProvider.js';\nimport { AnthropicConfig } from '../../../domain/types/ProviderConfig.js';\nimport {\n  ProviderAuthError,\n  ProviderRateLimitError,\n  ProviderContextLengthError,\n} from '../../../domain/errors/AIErrors.js';\nimport { AnthropicConverter } from './AnthropicConverter.js';\nimport { AnthropicStreamConverter } from './AnthropicStreamConverter.js';\nimport { StreamEvent } from '../../../domain/entities/StreamEvent.js';\n\nexport class AnthropicTextProvider extends BaseTextProvider {\n  readonly name = 'anthropic';\n  readonly capabilities: ProviderCapabilities = {\n    text: true,\n    images: true, // Claude 3+ supports vision\n    videos: false,\n    audio: false,\n  };\n\n  private client: Anthropic;\n  private converter: AnthropicConverter;\n  private streamConverter: AnthropicStreamConverter;\n\n  constructor(config: AnthropicConfig) {\n    super(config);\n\n    this.client = new Anthropic({\n      apiKey: this.getApiKey(),\n      baseURL: this.getBaseURL(),\n      maxRetries: this.getMaxRetries(),\n    });\n    this.converter = new AnthropicConverter();\n    this.streamConverter = new AnthropicStreamConverter();\n  }\n\n  /**\n   * Generate response using Anthropic Messages API\n   */\n  async generate(options: TextGenerateOptions): Promise<LLMResponse> {\n    return this.executeWithCircuitBreaker(async () => {\n      try {\n        // Convert our format  Anthropic Messages API format\n        const anthropicRequest = this.converter.convertRequest(options);\n\n        // Call Anthropic API (not stream)\n        const anthropicResponse = await this.client.messages.create({\n          ...anthropicRequest,\n          stream: false,\n        });\n\n        // Convert Anthropic response  our format\n        return this.converter.convertResponse(anthropicResponse);\n      } catch (error: any) {\n        this.handleError(error);\n        throw error; // TypeScript needs this\n      }\n    }, options.model);\n  }\n\n  /**\n   * Stream response using Anthropic Messages API\n   */\n  async *streamGenerate(options: TextGenerateOptions): AsyncIterableIterator<StreamEvent> {\n    try {\n      // Convert our format  Anthropic Messages API format\n      const anthropicRequest = this.converter.convertRequest(options);\n\n      // Create stream\n      const stream = await this.client.messages.create({\n        ...anthropicRequest,\n        stream: true,\n      });\n\n      // Reset stream converter for reuse\n      this.streamConverter.reset();\n\n      // Convert Anthropic events  our StreamEvent format\n      yield* this.streamConverter.convertStream(stream, options.model);\n    } catch (error: any) {\n      this.handleError(error);\n      throw error;\n    } finally {\n      // ALWAYS clear stream converter to prevent memory leaks\n      // Use finally block to ensure cleanup even on exception\n      this.streamConverter.clear();\n    }\n  }\n\n  /**\n   * Get model capabilities\n   */\n  getModelCapabilities(model: string): ModelCapabilities {\n    // Claude 4.5 and Claude 4 (Sonnet, Opus, Haiku)\n    if (model.includes('claude-sonnet-4') || model.includes('claude-opus-4') || model.includes('claude-haiku-4')) {\n      return {\n        supportsTools: true,\n        supportsVision: true,\n        supportsJSON: true,\n        supportsJSONSchema: false, // Use prompt engineering\n        maxTokens: 200000,\n        maxOutputTokens: 8192,\n      };\n    }\n\n    // Claude 3.5 Sonnet\n    if (model.includes('claude-3-5-sonnet') || model.includes('claude-3-7-sonnet')) {\n      return {\n        supportsTools: true,\n        supportsVision: true,\n        supportsJSON: true,\n        supportsJSONSchema: false,\n        maxTokens: 200000,\n        maxOutputTokens: 8192,\n      };\n    }\n\n    // Claude 3 Opus\n    if (model.includes('claude-3-opus')) {\n      return {\n        supportsTools: true,\n        supportsVision: true,\n        supportsJSON: true,\n        supportsJSONSchema: false,\n        maxTokens: 200000,\n        maxOutputTokens: 4096,\n      };\n    }\n\n    // Claude 3 Sonnet\n    if (model.includes('claude-3-sonnet')) {\n      return {\n        supportsTools: true,\n        supportsVision: true,\n        supportsJSON: true,\n        supportsJSONSchema: false,\n        maxTokens: 200000,\n        maxOutputTokens: 4096,\n      };\n    }\n\n    // Claude 3 Haiku\n    if (model.includes('claude-3-haiku')) {\n      return {\n        supportsTools: true,\n        supportsVision: true,\n        supportsJSON: true,\n        supportsJSONSchema: false,\n        maxTokens: 200000,\n        maxOutputTokens: 4096,\n      };\n    }\n\n\n    // Default for unknown models\n    return {\n      supportsTools: true,\n      supportsVision: true,\n      supportsJSON: true,\n      supportsJSONSchema: false,\n      maxTokens: 200000,\n      maxOutputTokens: 4096,\n    };\n  }\n\n  /**\n   * Handle Anthropic-specific errors\n   */\n  private handleError(error: any): never {\n    if (error.status === 401) {\n      throw new ProviderAuthError('anthropic', 'Invalid API key');\n    }\n\n    if (error.status === 429) {\n      const retryAfter = error.headers?.['retry-after'];\n      throw new ProviderRateLimitError(\n        'anthropic',\n        retryAfter ? parseInt(retryAfter) * 1000 : undefined\n      );\n    }\n\n    if (\n      error.type === 'invalid_request_error' &&\n      (error.message?.includes('prompt is too long') ||\n        error.message?.includes('maximum context length'))\n    ) {\n      throw new ProviderContextLengthError('anthropic', 200000);\n    }\n\n    // Re-throw other errors\n    throw error;\n  }\n}\n","/**\n * Image utilities for processing images\n */\n\nexport interface ImageData {\n  mimeType: string;\n  base64Data: string;\n  size: number;\n}\n\nexport interface FetchImageOptions {\n  /** Timeout in milliseconds (default: 30000) */\n  timeoutMs?: number;\n  /** Maximum image size in bytes (default: 10MB) */\n  maxSizeBytes?: number;\n}\n\nconst DEFAULT_TIMEOUT_MS = 30000; // 30 seconds\nconst DEFAULT_MAX_SIZE_BYTES = 10 * 1024 * 1024; // 10MB\n\n/**\n * Fetch an image from URL and convert to base64\n * Used by providers that require base64 (like Google)\n */\nexport async function fetchImageAsBase64(\n  url: string,\n  options?: FetchImageOptions\n): Promise<ImageData> {\n  const { timeoutMs = DEFAULT_TIMEOUT_MS, maxSizeBytes = DEFAULT_MAX_SIZE_BYTES } = options || {};\n\n  // Check if it's already a data URI\n  if (url.startsWith('data:image/')) {\n    const matches = url.match(/^data:(image\\/\\w+);base64,(.+)$/);\n    if (matches) {\n      const base64Data = matches[2] || '';\n      const size = calculateBase64Size(base64Data);\n\n      // Check size limit for data URIs too\n      if (size > maxSizeBytes) {\n        throw new Error(`Image size (${formatBytes(size)}) exceeds maximum allowed (${formatBytes(maxSizeBytes)})`);\n      }\n\n      return {\n        mimeType: matches[1] || 'image/png',\n        base64Data,\n        size,\n      };\n    }\n  }\n\n  // Fetch from URL with timeout and size limit\n  const controller = new AbortController();\n  const timeoutId = setTimeout(() => controller.abort(), timeoutMs);\n\n  try {\n    const response = await fetch(url, {\n      signal: controller.signal,\n    });\n\n    if (!response.ok) {\n      throw new Error(`Failed to fetch image: ${response.status} ${response.statusText}`);\n    }\n\n    // Check content-length header before downloading\n    const contentLength = response.headers.get('content-length');\n    if (contentLength) {\n      const size = parseInt(contentLength, 10);\n      if (size > maxSizeBytes) {\n        throw new Error(\n          `Image size (${formatBytes(size)}) exceeds maximum allowed (${formatBytes(maxSizeBytes)})`\n        );\n      }\n    }\n\n    // Stream the response with size limit\n    const reader = response.body?.getReader();\n    if (!reader) {\n      throw new Error('Failed to get response body reader');\n    }\n\n    const chunks: Uint8Array[] = [];\n    let totalSize = 0;\n\n    while (true) {\n      const { done, value } = await reader.read();\n      if (done) break;\n\n      totalSize += value.length;\n      if (totalSize > maxSizeBytes) {\n        reader.cancel();\n        throw new Error(\n          `Image size exceeds maximum allowed (${formatBytes(maxSizeBytes)})`\n        );\n      }\n      chunks.push(value);\n    }\n\n    // Combine chunks into a single buffer\n    const buffer = Buffer.concat(chunks.map((chunk) => Buffer.from(chunk)));\n    const base64Data = buffer.toString('base64');\n\n    // Detect MIME type from content-type header or buffer magic numbers\n    let mimeType = response.headers.get('content-type') || 'image/png';\n\n    // Validate it's an image\n    if (!mimeType.startsWith('image/')) {\n      // Try to detect from magic numbers\n      mimeType = detectImageFormatFromBuffer(buffer);\n    }\n\n    return {\n      mimeType,\n      base64Data,\n      size: buffer.length,\n    };\n  } catch (error: any) {\n    if (error.name === 'AbortError') {\n      throw new Error(`Image fetch timed out after ${timeoutMs}ms`);\n    }\n    throw new Error(`Failed to fetch image from URL: ${error.message}`);\n  } finally {\n    clearTimeout(timeoutId);\n  }\n}\n\n/**\n * Detect image format from buffer magic numbers\n */\nfunction detectImageFormatFromBuffer(buffer: Buffer): string {\n  const magic = buffer.slice(0, 4).toString('hex');\n\n  if (magic.startsWith('89504e47')) return 'image/png';\n  if (magic.startsWith('ffd8ff')) return 'image/jpeg';\n  if (magic.startsWith('47494638')) return 'image/gif';\n  if (magic.startsWith('52494646')) return 'image/webp';\n\n  throw new Error('URL does not point to a valid image');\n}\n\n/**\n * Detect image format from base64 data\n */\nexport function detectImageFormat(base64Data: string): string {\n  const buffer = Buffer.from(base64Data, 'base64');\n  const magic = buffer.slice(0, 4).toString('hex');\n\n  if (magic.startsWith('89504e47')) return 'image/png';\n  if (magic.startsWith('ffd8ff')) return 'image/jpeg';\n  if (magic.startsWith('47494638')) return 'image/gif';\n  if (magic.startsWith('52494646')) return 'image/webp';\n\n  return 'image/png'; // Default\n}\n\n/**\n * Calculate accurate size from base64 data (in bytes)\n * Accounts for padding characters\n */\nexport function calculateBase64Size(base64Data: string): number {\n  // Remove data URI prefix if present\n  const data = base64Data.includes(',') ? base64Data.split(',')[1] : base64Data;\n\n  if (!data || data.length === 0) return 0;\n\n  // Count padding characters\n  let padding = 0;\n  if (data.endsWith('==')) padding = 2;\n  else if (data.endsWith('=')) padding = 1;\n\n  // Accurate calculation: (length * 3 / 4) - padding\n  return Math.floor((data.length * 3) / 4) - padding;\n}\n\n/**\n * Format bytes into human-readable string\n */\nfunction formatBytes(bytes: number): string {\n  if (bytes < 1024) return `${bytes} bytes`;\n  if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`;\n  return `${(bytes / (1024 * 1024)).toFixed(1)} MB`;\n}\n","/**\n * Google Gemini converter - Converts between our Responses API format and Google Gemini API\n * Works with both @google/genai SDK (for Gemini API and Vertex AI)\n */\n\n// Import types - the new SDK may have different type names\nimport type {\n  Content as GeminiContent,\n  Part,\n  FunctionDeclaration,\n} from '@google/genai';\nimport { TextGenerateOptions } from '../../../domain/interfaces/ITextProvider.js';\nimport { LLMResponse } from '../../../domain/entities/Response.js';\nimport { InputItem, MessageRole } from '../../../domain/entities/Message.js';\nimport { convertToolsToStandardFormat } from '../shared/ToolConversionUtils.js';\nimport { Content, ContentType } from '../../../domain/entities/Content.js';\nimport { Tool } from '../../../domain/entities/Tool.js';\nimport { fetchImageAsBase64 } from '../../../utils/imageUtils.js';\nimport { InvalidToolArgumentsError } from '../../../domain/errors/AIErrors.js';\nimport {\n  buildLLMResponse,\n  createTextContent,\n  createToolUseContent,\n  mapGoogleStatus,\n  generateToolCallId,\n} from '../shared/ResponseBuilder.js';\n\nexport class GoogleConverter {\n  // Track tool call ID  tool name mapping for tool results\n  private toolCallMapping: Map<string, string> = new Map();\n  // Track tool call ID  thought signature for Gemini 3+\n  private thoughtSignatures: Map<string, string> = new Map();\n\n  /**\n   * Convert our format  Google Gemini format\n   */\n  async convertRequest(options: TextGenerateOptions): Promise<any> {\n    // Debug input messages\n    if (process.env.DEBUG_GOOGLE && Array.isArray(options.input)) {\n      console.error('[DEBUG] Input messages:', JSON.stringify(options.input.map((msg: any) => ({\n        type: msg.type,\n        role: msg.role,\n        contentTypes: msg.content?.map((c: any) => c.type),\n      })), null, 2));\n    }\n\n    const contents = await this.convertMessages(options.input);\n    const tools = this.convertTools(options.tools);\n\n    // Debug: Check final contents\n    if (process.env.DEBUG_GOOGLE) {\n      console.error('[DEBUG] Final contents array length:', contents.length);\n    }\n\n    const request: any = {\n      contents,\n    };\n\n    // Add system instruction if provided\n    if (options.instructions) {\n      request.systemInstruction = { parts: [{ text: options.instructions }] };\n    }\n\n    // Add tools if provided\n    if (tools && tools.length > 0) {\n      request.tools = [{ functionDeclarations: tools }];\n\n      // Add tool config to encourage tool use\n      request.toolConfig = {\n        functionCallingConfig: {\n          mode: options.tool_choice === 'required' ? 'ANY' : 'AUTO',\n        },\n      };\n    }\n\n    // Add generation config\n    request.generationConfig = {\n      temperature: options.temperature,\n      maxOutputTokens: options.max_output_tokens,\n    };\n\n    // Add thinking config for Gemini 3+ reasoning models\n    if (options.vendorOptions?.thinkingLevel) {\n      request.generationConfig.thinkingConfig = {\n        thinkingLevel: options.vendorOptions.thinkingLevel,\n      };\n    }\n\n    // Disable Google's code execution if we have function tools\n    // (prevents model from generating code instead of calling tools)\n    if (tools && tools.length > 0) {\n      request.generationConfig.allowCodeExecution = false;\n    }\n\n    // Handle JSON output\n    if (options.response_format) {\n      if (options.response_format.type === 'json_object') {\n        request.generationConfig.responseMimeType = 'application/json';\n      } else if (options.response_format.type === 'json_schema') {\n        request.generationConfig.responseMimeType = 'application/json';\n        // Google doesn't support full JSON schema - would need to add to system instruction\n      }\n    }\n\n    return request;\n  }\n\n  /**\n   * Convert our InputItem[]  Google contents\n   */\n  private async convertMessages(input: string | InputItem[]): Promise<GeminiContent[]> {\n    if (typeof input === 'string') {\n      return [\n        {\n          role: 'user',\n          parts: [{ text: input }],\n        },\n      ];\n    }\n\n    const contents: GeminiContent[] = [];\n\n    for (const item of input) {\n      if (item.type === 'message') {\n        // Map roles\n        const role = item.role === MessageRole.USER || item.role === MessageRole.DEVELOPER ? 'user' : 'model';\n\n        // Convert content to parts\n        const parts = await this.convertContentToParts(item.content);\n\n        // Debug logging\n        if (process.env.DEBUG_GOOGLE) {\n          console.error(`[DEBUG] Converting message - role: ${item.role}  ${role}, parts: ${parts.length}`,\n            parts.map((p: any) => Object.keys(p)));\n        }\n\n        if (parts.length > 0) {\n          contents.push({\n            role,\n            parts,\n          });\n        }\n      }\n    }\n\n    return contents;\n  }\n\n  /**\n   * Convert our Content[]  Google parts\n   */\n  private async convertContentToParts(content: Content[]): Promise<Part[]> {\n    const parts: Part[] = [];\n\n    for (const c of content) {\n      switch (c.type) {\n        case ContentType.INPUT_TEXT:\n        case ContentType.OUTPUT_TEXT:\n          parts.push({ text: c.text });\n          break;\n\n        case ContentType.INPUT_IMAGE_URL:\n          // Google requires inline data (base64), not URLs\n          try {\n            const imageData = await fetchImageAsBase64(c.image_url.url);\n            parts.push({\n              inlineData: {\n                mimeType: imageData.mimeType,\n                data: imageData.base64Data,\n              },\n            });\n          } catch (error: any) {\n            // If image fetch fails, skip it and add error as text\n            console.error(`Failed to fetch image: ${error.message}`);\n            parts.push({\n              text: `[Error: Could not load image from ${c.image_url.url}]`,\n            });\n          }\n          break;\n\n        case ContentType.TOOL_USE:\n          // Store tool call ID  name mapping for later use\n          this.toolCallMapping.set(c.id, c.name);\n\n          // Safe JSON parse with error handling\n          let parsedArgs: unknown;\n          try {\n            parsedArgs = JSON.parse(c.arguments);\n          } catch (parseError) {\n            throw new InvalidToolArgumentsError(\n              c.name,\n              c.arguments,\n              parseError instanceof Error ? parseError : new Error(String(parseError))\n            );\n          }\n\n          // Google uses functionCall\n          const functionCallPart: any = {\n            functionCall: {\n              name: c.name,\n              args: parsedArgs,\n            },\n          };\n\n          // Add thought signature if we have one (required for Gemini 3+)\n          const signature = this.thoughtSignatures.get(c.id);\n\n          if (process.env.DEBUG_GOOGLE) {\n            console.error(`[DEBUG] Looking up signature for tool ID: ${c.id}`);\n            console.error(`[DEBUG] Found signature:`, signature ? 'YES' : 'NO');\n            console.error(`[DEBUG] Available signatures:`, Array.from(this.thoughtSignatures.keys()));\n          }\n\n          if (signature) {\n            functionCallPart.thoughtSignature = signature;\n          }\n\n          parts.push(functionCallPart);\n          break;\n\n        case ContentType.TOOL_RESULT:\n          // Google uses functionResponse - look up the actual function name\n          const functionName = this.toolCallMapping.get(c.tool_use_id) || this.extractToolName(c.tool_use_id);\n\n          parts.push({\n            functionResponse: {\n              name: functionName, // Use actual function name from mapping\n              response: {\n                result: typeof c.content === 'string' ? c.content : c.content,\n              },\n            },\n          });\n          break;\n      }\n    }\n\n    return parts;\n  }\n\n  /**\n   * Convert our Tool[]  Google function declarations\n   */\n  private convertTools(tools?: Tool[]): FunctionDeclaration[] | undefined {\n    if (!tools || tools.length === 0) {\n      return undefined;\n    }\n\n    // Use shared conversion utilities (DRY)\n    const standardTools = convertToolsToStandardFormat(tools);\n    return standardTools.map((tool) => ({\n      name: tool.name,\n      description: tool.description,\n      parameters: this.convertParametersSchema(tool.parameters),\n    }));\n  }\n\n  /**\n   * Convert JSON Schema parameters to Google's format\n   */\n  private convertParametersSchema(schema: any): any {\n    if (!schema) return undefined;\n\n    const converted: any = {\n      type: 'OBJECT', // Google uses uppercase 'OBJECT'\n      properties: {},\n    };\n\n    // Convert property types to uppercase\n    if (schema.properties) {\n      for (const [key, value] of Object.entries(schema.properties)) {\n        const prop = value as any;\n        converted.properties[key] = {\n          type: prop.type?.toUpperCase() || 'STRING',\n          description: prop.description,\n        };\n\n        // Handle enums\n        if (prop.enum) {\n          converted.properties[key].enum = prop.enum;\n        }\n\n        // Handle nested objects/arrays\n        if (prop.type === 'object' && prop.properties) {\n          converted.properties[key] = this.convertParametersSchema(prop);\n        }\n        if (prop.type === 'array' && prop.items) {\n          converted.properties[key].items = this.convertParametersSchema(prop.items);\n        }\n      }\n    }\n\n    // Add required fields\n    if (schema.required) {\n      converted.required = schema.required;\n    }\n\n    return converted;\n  }\n\n  /**\n   * Convert Google response  our LLMResponse format\n   */\n  convertResponse(response: any): LLMResponse {\n    const candidate = response.candidates?.[0];\n    const geminiContent = candidate?.content;\n\n    // Convert Google parts to our content\n    const content = this.convertGeminiPartsToContent(geminiContent?.parts || []);\n\n    // Debug output\n    if (process.env.DEBUG_GOOGLE) {\n      console.error('[DEBUG] Content array:', JSON.stringify(content, null, 2));\n      console.error('[DEBUG] Raw parts:', JSON.stringify(geminiContent?.parts, null, 2));\n    }\n\n    return buildLLMResponse({\n      provider: 'google',\n      model: response.modelVersion || 'gemini',\n      status: mapGoogleStatus(candidate?.finishReason),\n      content,\n      messageId: response.id,\n      usage: {\n        inputTokens: response.usageMetadata?.promptTokenCount || 0,\n        outputTokens: response.usageMetadata?.candidatesTokenCount || 0,\n        totalTokens: response.usageMetadata?.totalTokenCount || 0,\n      },\n    });\n  }\n\n  /**\n   * Convert Google parts  our Content[]\n   */\n  private convertGeminiPartsToContent(parts: Part[]): Content[] {\n    const content: Content[] = [];\n\n    for (const part of parts) {\n      if ('text' in part && part.text) {\n        content.push(createTextContent(part.text));\n      } else if ('functionCall' in part && part.functionCall) {\n        const toolId = generateToolCallId('google');\n        const functionName = part.functionCall.name || '';\n\n        // Store thought signature if present (required for Gemini 3+)\n        if ('thoughtSignature' in part && part.thoughtSignature) {\n          const sig = part.thoughtSignature as string;\n          this.thoughtSignatures.set(toolId, sig);\n\n          if (process.env.DEBUG_GOOGLE) {\n            console.error(`[DEBUG] Captured thought signature for tool ID: ${toolId}`);\n            console.error(`[DEBUG] Signature length:`, sig.length);\n          }\n        } else if (process.env.DEBUG_GOOGLE) {\n          console.error(`[DEBUG] NO thought signature in part for ${functionName}`);\n          console.error(`[DEBUG] Part keys:`, Object.keys(part));\n        }\n\n        content.push(createToolUseContent(toolId, functionName, part.functionCall.args || {}));\n      }\n    }\n\n    return content;\n  }\n\n  /**\n   * Extract tool name from tool_use_id using tracked mapping\n   */\n  private extractToolName(toolUseId: string): string {\n    const name = this.toolCallMapping.get(toolUseId);\n    if (name) {\n      return name;\n    }\n    // Fallback - log warning and return placeholder\n    console.warn(`[GoogleConverter] Tool name not found for ID: ${toolUseId}`);\n    return 'unknown_tool';\n  }\n\n  /**\n   * Clear all internal mappings\n   * Should be called after each request/response cycle to prevent memory leaks\n   */\n  clearMappings(): void {\n    this.toolCallMapping.clear();\n    this.thoughtSignatures.clear();\n  }\n\n  /**\n   * Reset converter state for a new request\n   * Alias for clearMappings()\n   */\n  reset(): void {\n    this.clearMappings();\n  }\n}\n","/**\n * Google Gemini stream converter - converts Google streaming responses to our unified StreamEvent format\n */\n\nimport { randomUUID } from 'crypto';\nimport { GenerateContentResponse } from '@google/genai';\nimport { StreamEvent, StreamEventType } from '../../../domain/entities/StreamEvent.js';\n\n/**\n * Converts Google Gemini streaming responses to our unified StreamEvent format\n */\nexport class GoogleStreamConverter {\n  private responseId: string = '';\n  private model: string = '';\n  private sequenceNumber: number = 0;\n  private isFirst: boolean = true;\n  private toolCallBuffers: Map<string, { name: string; args: string }> = new Map();\n\n  /**\n   * Convert Google stream to our StreamEvent format\n   */\n  async *convertStream(\n    googleStream: AsyncIterable<GenerateContentResponse>,\n    model: string\n  ): AsyncIterableIterator<StreamEvent> {\n    this.model = model;\n    this.sequenceNumber = 0;\n    this.isFirst = true;\n    this.toolCallBuffers.clear();\n\n    let lastUsage: { input_tokens: number; output_tokens: number; total_tokens: number } = {\n      input_tokens: 0,\n      output_tokens: 0,\n      total_tokens: 0,\n    };\n\n    for await (const chunk of googleStream) {\n      if (this.isFirst) {\n        this.responseId = this.generateResponseId();\n        yield {\n          type: StreamEventType.RESPONSE_CREATED,\n          response_id: this.responseId,\n          model: this.model,\n          created_at: Date.now(),\n        };\n        this.isFirst = false;\n      }\n\n      // Extract usage from chunk (Google includes it in every chunk)\n      const usage = this.extractUsage(chunk);\n      if (usage) {\n        lastUsage = usage;\n      }\n\n      const events = this.convertChunk(chunk);\n      for (const event of events) {\n        yield event;\n      }\n    }\n\n    // Emit completion for any pending tool calls\n    if (this.toolCallBuffers.size > 0) {\n      for (const [toolCallId, buffer] of this.toolCallBuffers) {\n        yield {\n          type: StreamEventType.TOOL_CALL_ARGUMENTS_DONE,\n          response_id: this.responseId,\n          tool_call_id: toolCallId,\n          tool_name: buffer.name,\n          arguments: buffer.args,\n        };\n      }\n    }\n\n    // Final completion event with actual usage\n    yield {\n      type: StreamEventType.RESPONSE_COMPLETE,\n      response_id: this.responseId,\n      status: 'completed',\n      usage: lastUsage,\n      iterations: 1,\n    };\n  }\n\n  /**\n   * Extract usage from Google chunk\n   */\n  private extractUsage(chunk: GenerateContentResponse): { input_tokens: number; output_tokens: number; total_tokens: number } | null {\n    const usage = chunk.usageMetadata;\n    if (!usage) return null;\n\n    return {\n      input_tokens: usage.promptTokenCount || 0,\n      output_tokens: usage.candidatesTokenCount || 0,\n      total_tokens: usage.totalTokenCount || 0,\n    };\n  }\n\n  /**\n   * Convert single Google chunk to our event(s)\n   */\n  private convertChunk(chunk: GenerateContentResponse): StreamEvent[] {\n    const events: StreamEvent[] = [];\n\n    const candidate = chunk.candidates?.[0];\n    if (!candidate?.content?.parts) return events;\n\n    for (const part of candidate.content.parts) {\n      if (part.text) {\n        // Text delta\n        events.push({\n          type: StreamEventType.OUTPUT_TEXT_DELTA,\n          response_id: this.responseId,\n          item_id: `msg_${this.responseId}`,\n          output_index: 0,\n          content_index: 0,\n          delta: part.text,\n          sequence_number: this.sequenceNumber++,\n        });\n      } else if (part.functionCall) {\n        // Function call (tool use)\n        const functionCall = part.functionCall;\n        const toolName = functionCall.name || 'unknown';\n        const toolCallId = `call_${this.responseId}_${toolName}`;\n\n        // Check if this is a new tool call\n        if (!this.toolCallBuffers.has(toolCallId)) {\n          this.toolCallBuffers.set(toolCallId, {\n            name: toolName,\n            args: '',\n          });\n\n          events.push({\n            type: StreamEventType.TOOL_CALL_START,\n            response_id: this.responseId,\n            item_id: `msg_${this.responseId}`,\n            tool_call_id: toolCallId,\n            tool_name: toolName,\n          });\n        }\n\n        // Convert args object to JSON string\n        if (functionCall.args) {\n          const argsJson = JSON.stringify(functionCall.args);\n          const buffer = this.toolCallBuffers.get(toolCallId)!;\n\n          // Check if this is new content (Google sends complete args each time)\n          if (argsJson !== buffer.args) {\n            const delta = argsJson.slice(buffer.args.length);\n            buffer.args = argsJson;\n\n            if (delta) {\n              events.push({\n                type: StreamEventType.TOOL_CALL_ARGUMENTS_DELTA,\n                response_id: this.responseId,\n                item_id: `msg_${this.responseId}`,\n                tool_call_id: toolCallId,\n                tool_name: toolName,\n                delta,\n                sequence_number: this.sequenceNumber++,\n              });\n            }\n          }\n        }\n      }\n    }\n\n    return events;\n  }\n\n  /**\n   * Generate unique response ID using cryptographically secure UUID\n   */\n  private generateResponseId(): string {\n    return `resp_google_${randomUUID()}`;\n  }\n\n  /**\n   * Clear all internal state\n   * Should be called after each stream completes to prevent memory leaks\n   */\n  clear(): void {\n    this.responseId = '';\n    this.model = '';\n    this.sequenceNumber = 0;\n    this.isFirst = true;\n    this.toolCallBuffers.clear();\n  }\n\n  /**\n   * Reset converter state for a new stream\n   * Alias for clear()\n   */\n  reset(): void {\n    this.clear();\n  }\n}\n","/**\n * Google Gemini text provider (using new unified SDK)\n */\n\nimport { GoogleGenAI } from '@google/genai';\nimport { BaseTextProvider } from '../base/BaseTextProvider.js';\nimport { TextGenerateOptions, ModelCapabilities } from '../../../domain/interfaces/ITextProvider.js';\nimport { LLMResponse } from '../../../domain/entities/Response.js';\nimport { ProviderCapabilities } from '../../../domain/interfaces/IProvider.js';\nimport { GoogleConfig } from '../../../domain/types/ProviderConfig.js';\nimport {\n  ProviderAuthError,\n  ProviderRateLimitError,\n  ProviderContextLengthError,\n} from '../../../domain/errors/AIErrors.js';\nimport { GoogleConverter } from './GoogleConverter.js';\nimport { GoogleStreamConverter } from './GoogleStreamConverter.js';\nimport { StreamEvent } from '../../../domain/entities/StreamEvent.js';\n\nexport class GoogleTextProvider extends BaseTextProvider {\n  readonly name = 'google';\n  readonly capabilities: ProviderCapabilities = {\n    text: true,\n    images: true, // Gemini supports vision\n    videos: false,\n    audio: false,\n  };\n\n  private client: GoogleGenAI;\n  private converter: GoogleConverter;\n  private streamConverter: GoogleStreamConverter;\n\n  constructor(config: GoogleConfig) {\n    super(config);\n\n    // New SDK uses object config\n    this.client = new GoogleGenAI({\n      apiKey: this.getApiKey(),\n    });\n    this.converter = new GoogleConverter();\n    this.streamConverter = new GoogleStreamConverter();\n  }\n\n  /**\n   * Generate response using Google Gemini API\n   */\n  async generate(options: TextGenerateOptions): Promise<LLMResponse> {\n    return this.executeWithCircuitBreaker(async () => {\n      try {\n        // Convert our format  Google format\n        const googleRequest = await this.converter.convertRequest(options);\n\n        // Debug logging\n        if (process.env.DEBUG_GOOGLE) {\n          console.error('[DEBUG] Google Request:', JSON.stringify({\n            model: options.model,\n            tools: googleRequest.tools,\n            toolConfig: googleRequest.toolConfig,\n            generationConfig: googleRequest.generationConfig,\n            contents: googleRequest.contents?.slice(0, 1), // First message only\n          }, null, 2));\n        }\n\n        // Call Google API using new SDK structure\n        // Note: contents goes at top level, generation config properties go directly in config\n        const result = await this.client.models.generateContent({\n          model: options.model,\n          contents: googleRequest.contents,\n          config: {\n            systemInstruction: googleRequest.systemInstruction,\n            tools: googleRequest.tools,\n            toolConfig: googleRequest.toolConfig,\n            ...googleRequest.generationConfig,\n          },\n        });\n\n        // Debug logging for response\n        if (process.env.DEBUG_GOOGLE) {\n          console.error('[DEBUG] Google Response:', JSON.stringify({\n            candidates: result.candidates?.map((c: any) => ({\n              finishReason: c.finishReason,\n              content: c.content,\n            })),\n            usageMetadata: result.usageMetadata,\n          }, null, 2));\n        }\n\n        // Convert Google response  our format\n        const response = this.converter.convertResponse(result);\n\n        return response;\n      } catch (error: any) {\n        this.handleError(error);\n        throw error; // TypeScript needs this\n      } finally {\n        // ALWAYS clear converter mappings to prevent memory leaks\n        // Use finally block to ensure cleanup even on exception\n        this.converter.clearMappings();\n      }\n    }, options.model);\n  }\n\n  /**\n   * Stream response using Google Gemini API\n   */\n  async *streamGenerate(options: TextGenerateOptions): AsyncIterableIterator<StreamEvent> {\n    try {\n      // Convert our format  Google format\n      const googleRequest = await this.converter.convertRequest(options);\n\n      // Create stream using new SDK\n      // Note: contents goes at top level, generation config properties go directly in config\n      const stream = await this.client.models.generateContentStream({\n        model: options.model,\n        contents: googleRequest.contents,\n        config: {\n          systemInstruction: googleRequest.systemInstruction,\n          tools: googleRequest.tools,\n          toolConfig: googleRequest.toolConfig,\n          ...googleRequest.generationConfig,\n        },\n      });\n\n      // Reset stream converter for reuse\n      this.streamConverter.reset();\n\n      // Convert Google stream  our StreamEvent format\n      yield* this.streamConverter.convertStream(stream, options.model);\n    } catch (error: any) {\n      this.handleError(error);\n      throw error;\n    } finally {\n      // ALWAYS clear converters to prevent memory leaks\n      // Use finally block to ensure cleanup even on exception\n      this.converter.clearMappings();\n      this.streamConverter.clear();\n    }\n  }\n\n  /**\n   * Get model capabilities\n   */\n  getModelCapabilities(model: string): ModelCapabilities {\n    // All modern Gemini models (3.x, 2.5, 2.0, 1.5) have similar capabilities\n    if (\n      model.includes('gemini-3') ||\n      model.includes('gemini-2.5') ||\n      model.includes('gemini-2.0') ||\n      model.includes('gemini-1.5') ||\n      model.includes('gemini-pro') ||\n      model.includes('gemini-flash')\n    ) {\n      return {\n        supportsTools: true,\n        supportsVision: true,\n        supportsJSON: true,\n        supportsJSONSchema: false,\n        maxTokens: 1048576, // 1M tokens\n        maxOutputTokens: 8192,\n      };\n    }\n\n    // Default for unknown models\n    return {\n      supportsTools: true,\n      supportsVision: true,\n      supportsJSON: true,\n      supportsJSONSchema: false,\n      maxTokens: 1048576,\n      maxOutputTokens: 8192,\n    };\n  }\n\n  /**\n   * Handle Google-specific errors\n   */\n  private handleError(error: any): never {\n    const errorMessage = error.message || '';\n\n    if (error.status === 401 || errorMessage.includes('API key not valid')) {\n      throw new ProviderAuthError('google', 'Invalid API key');\n    }\n\n    if (error.status === 429 || errorMessage.includes('Resource exhausted')) {\n      throw new ProviderRateLimitError('google');\n    }\n\n    if (errorMessage.includes('context length') || errorMessage.includes('too long')) {\n      throw new ProviderContextLengthError('google', 1048576);\n    }\n\n    // Re-throw other errors\n    throw error;\n  }\n}\n","/**\n * Google Vertex AI text provider (enterprise features)\n * Uses the same unified @google/genai SDK as GoogleTextProvider\n */\n\nimport { GoogleGenAI } from '@google/genai';\nimport { BaseTextProvider } from '../base/BaseTextProvider.js';\nimport { TextGenerateOptions, ModelCapabilities } from '../../../domain/interfaces/ITextProvider.js';\nimport { LLMResponse } from '../../../domain/entities/Response.js';\nimport { ProviderCapabilities } from '../../../domain/interfaces/IProvider.js';\nimport { VertexAIConfig } from '../../../domain/types/ProviderConfig.js';\nimport {\n  ProviderAuthError,\n  ProviderRateLimitError,\n  ProviderContextLengthError,\n  InvalidConfigError,\n} from '../../../domain/errors/AIErrors.js';\nimport { GoogleConverter } from '../google/GoogleConverter.js';\nimport { GoogleStreamConverter } from '../google/GoogleStreamConverter.js';\nimport { StreamEvent } from '../../../domain/entities/StreamEvent.js';\n\nexport class VertexAITextProvider extends BaseTextProvider {\n  readonly name = 'vertex-ai';\n  readonly capabilities: ProviderCapabilities = {\n    text: true,\n    images: true,\n    videos: true, // Vertex AI supports video input\n    audio: true, // Vertex AI supports audio input\n  };\n\n  private client: GoogleGenAI;\n  private converter: GoogleConverter;\n  protected override config: VertexAIConfig;\n\n  constructor(config: VertexAIConfig) {\n    super(config);\n    this.config = config;\n\n    // Validate required config\n    if (!config.projectId) {\n      throw new InvalidConfigError('Vertex AI requires projectId');\n    }\n    if (!config.location) {\n      throw new InvalidConfigError('Vertex AI requires location (e.g., \"us-central1\")');\n    }\n\n    // Configure environment for Vertex AI\n    process.env.GOOGLE_GENAI_USE_VERTEXAI = 'True';\n    process.env.GOOGLE_CLOUD_PROJECT = config.projectId;\n    process.env.GOOGLE_CLOUD_LOCATION = config.location;\n\n    // If credentials provided, set them\n    if (config.credentials) {\n      // Note: The SDK will use credentials from the environment or ADC\n      // Service account JSON can be passed via GOOGLE_APPLICATION_CREDENTIALS env var\n    }\n\n    // Initialize client for Vertex AI\n    this.client = new GoogleGenAI({\n      // No API key for Vertex AI - uses Application Default Credentials\n    });\n\n    // Reuse Google converter - same API format!\n    this.converter = new GoogleConverter();\n  }\n\n  /**\n   * Generate response using Vertex AI\n   */\n  async generate(options: TextGenerateOptions): Promise<LLMResponse> {\n    try {\n      // Convert our format  Google format (same as regular Gemini API)\n      const googleRequest = await this.converter.convertRequest(options);\n\n      // Call Vertex AI using new SDK structure\n      // Note: contents goes at top level, generation config properties go directly in config\n      const result = await this.client.models.generateContent({\n        model: options.model,\n        contents: googleRequest.contents,\n        config: {\n          systemInstruction: googleRequest.systemInstruction,\n          tools: googleRequest.tools,\n          toolConfig: googleRequest.toolConfig,\n          ...googleRequest.generationConfig,\n        },\n      });\n\n      // Convert response  our format (same as regular Gemini API)\n      return this.converter.convertResponse(result);\n    } catch (error: any) {\n      this.handleError(error);\n      throw error; // TypeScript needs this\n    }\n  }\n\n  /**\n   * Stream response using Vertex AI\n   */\n  async *streamGenerate(options: TextGenerateOptions): AsyncIterableIterator<StreamEvent> {\n    try {\n      // Convert our format  Google format\n      const googleRequest = await this.converter.convertRequest(options);\n\n      // Create stream using new SDK\n      // Note: contents goes at top level, generation config properties go directly in config\n      const stream = await this.client.models.generateContentStream({\n        model: options.model,\n        contents: googleRequest.contents,\n        config: {\n          systemInstruction: googleRequest.systemInstruction,\n          tools: googleRequest.tools,\n          toolConfig: googleRequest.toolConfig,\n          ...googleRequest.generationConfig,\n        },\n      });\n\n      // Convert Google stream  our StreamEvent format\n      const streamConverter = new GoogleStreamConverter();\n      yield* streamConverter.convertStream(stream, options.model);\n    } catch (error: any) {\n      this.handleError(error);\n      throw error;\n    }\n  }\n\n  /**\n   * Get model capabilities\n   */\n  getModelCapabilities(model: string): ModelCapabilities {\n    // Same models as regular Gemini, but enterprise features\n    if (\n      model.includes('gemini-3') ||\n      model.includes('gemini-2.5') ||\n      model.includes('gemini-2.0') ||\n      model.includes('gemini-1.5') ||\n      model.includes('gemini-pro') ||\n      model.includes('gemini-flash')\n    ) {\n      return {\n        supportsTools: true,\n        supportsVision: true,\n        supportsJSON: true,\n        supportsJSONSchema: false,\n        maxTokens: 1048576, // 1M tokens\n        maxOutputTokens: 8192,\n      };\n    }\n\n    // Default\n    return {\n      supportsTools: true,\n      supportsVision: true,\n      supportsJSON: true,\n      supportsJSONSchema: false,\n      maxTokens: 1048576,\n      maxOutputTokens: 8192,\n    };\n  }\n\n  /**\n   * Handle Vertex AI-specific errors\n   */\n  private handleError(error: any): never {\n    const errorMessage = error.message || '';\n\n    // Authentication errors\n    if (\n      error.status === 401 ||\n      error.status === 403 ||\n      errorMessage.includes('not authenticated') ||\n      errorMessage.includes('permission denied')\n    ) {\n      throw new ProviderAuthError(\n        'vertex-ai',\n        'Authentication failed. Make sure you have set up Application Default Credentials or provided service account credentials.'\n      );\n    }\n\n    if (error.status === 429 || errorMessage.includes('Resource exhausted')) {\n      throw new ProviderRateLimitError('vertex-ai');\n    }\n\n    if (errorMessage.includes('context length') || errorMessage.includes('too long')) {\n      throw new ProviderContextLengthError('vertex-ai', 1048576);\n    }\n\n    // Re-throw other errors\n    throw error;\n  }\n}\n","/**\n * Generic OpenAI-compatible provider\n * Works with any service that implements the OpenAI Chat Completions API\n * Examples: Together AI, Groq, Perplexity, Grok (xAI), local models, etc.\n */\n\nimport { OpenAITextProvider } from '../openai/OpenAITextProvider.js';\nimport { ModelCapabilities } from '../../../domain/interfaces/ITextProvider.js';\nimport { ProviderCapabilities } from '../../../domain/interfaces/IProvider.js';\n\nexport interface GenericOpenAIConfig {\n  apiKey: string;\n  baseURL: string; // Required - the API endpoint\n  organization?: string;\n  timeout?: number;\n  maxRetries?: number;\n  defaultModel?: string;\n}\n\nexport class GenericOpenAIProvider extends OpenAITextProvider {\n  readonly name: string;\n  readonly capabilities: ProviderCapabilities;\n\n  constructor(\n    name: string,\n    config: GenericOpenAIConfig,\n    capabilities?: Partial<ProviderCapabilities>\n  ) {\n    super(config as any);\n    this.name = name;\n\n    // Set capabilities\n    if (capabilities) {\n      this.capabilities = {\n        text: capabilities.text ?? true,\n        images: capabilities.images ?? false,\n        videos: capabilities.videos ?? false,\n        audio: capabilities.audio ?? false,\n      };\n    } else {\n      // Default generic capabilities\n      this.capabilities = {\n        text: true,\n        images: false, // Conservative default\n        videos: false,\n        audio: false,\n      };\n    }\n  }\n\n  /**\n   * Override model capabilities for generic providers\n   * Can be customized per provider\n   */\n  getModelCapabilities(model: string): ModelCapabilities {\n    // Check for vision in model name (heuristic)\n    const hasVision =\n      model.toLowerCase().includes('vision') ||\n      model.toLowerCase().includes('llava') ||\n      model.toLowerCase().includes('llama-3.2-90b'); // Llama 3.2 90B has vision\n\n    // Check for large context models\n    const isLargeContext =\n      model.includes('128k') ||\n      model.includes('200k') ||\n      model.toLowerCase().includes('longtext');\n\n    return {\n      supportsTools: true, // Most OpenAI-compatible APIs support tools\n      supportsVision: hasVision,\n      supportsJSON: true, // Most support JSON mode\n      supportsJSONSchema: false, // Conservative - not all support schema\n      maxTokens: isLargeContext ? 128000 : 32000, // Conservative default\n      maxOutputTokens: 4096, // Common default\n    };\n  }\n}\n","/**\n * Provider Factory - creates the right provider from a Connector\n *\n * This is the bridge between Connectors and provider implementations.\n * It extracts credentials from the connector and instantiates the appropriate SDK.\n */\n\nimport { Connector } from './Connector.js';\nimport { Vendor } from './Vendor.js';\nimport { ITextProvider } from '../domain/interfaces/ITextProvider.js';\nimport { ProviderConfig } from '../domain/types/ProviderConfig.js';\n\n// Import providers\nimport { OpenAITextProvider } from '../infrastructure/providers/openai/OpenAITextProvider.js';\nimport { AnthropicTextProvider } from '../infrastructure/providers/anthropic/AnthropicTextProvider.js';\nimport { GoogleTextProvider } from '../infrastructure/providers/google/GoogleTextProvider.js';\nimport { VertexAITextProvider } from '../infrastructure/providers/vertex/VertexAITextProvider.js';\nimport { GenericOpenAIProvider } from '../infrastructure/providers/generic/GenericOpenAIProvider.js';\n\n/**\n * Create a text provider from a connector\n */\nexport function createProvider(connector: Connector): ITextProvider {\n  // Allow injecting a provider directly for testing\n  const injectedProvider = connector.getOptions().provider;\n  if (injectedProvider && typeof (injectedProvider as any).generate === 'function') {\n    return injectedProvider as ITextProvider;\n  }\n\n  const vendor = connector.vendor;\n\n  if (!vendor) {\n    throw new Error(\n      `Connector '${connector.name}' has no vendor specified. ` +\n        `Set vendor to create an AI provider.`\n    );\n  }\n\n  // Extract config from connector\n  const config = extractProviderConfig(connector);\n\n  switch (vendor) {\n    case Vendor.OpenAI:\n      return new OpenAITextProvider({\n        ...config,\n        organization: connector.getOptions().organization as string | undefined,\n        project: connector.getOptions().project as string | undefined,\n      });\n\n    case Vendor.Anthropic:\n      return new AnthropicTextProvider({\n        ...config,\n        anthropicVersion: connector.getOptions().anthropicVersion as string | undefined,\n      });\n\n    case Vendor.Google:\n      return new GoogleTextProvider(config);\n\n    case Vendor.GoogleVertex:\n      return new VertexAITextProvider({\n        ...config,\n        projectId: connector.getOptions().projectId as string || '',\n        location: connector.getOptions().location as string || 'us-central1',\n      });\n\n    // OpenAI-compatible providers (use connector.name for unique identification)\n    case Vendor.Groq:\n      return new GenericOpenAIProvider(connector.name, {\n        ...config,\n        baseURL: config.baseURL || 'https://api.groq.com/openai/v1',\n      });\n\n    case Vendor.Together:\n      return new GenericOpenAIProvider(connector.name, {\n        ...config,\n        baseURL: config.baseURL || 'https://api.together.xyz/v1',\n      });\n\n    case Vendor.Perplexity:\n      return new GenericOpenAIProvider(connector.name, {\n        ...config,\n        baseURL: config.baseURL || 'https://api.perplexity.ai',\n      });\n\n    case Vendor.Grok:\n      return new GenericOpenAIProvider(connector.name, {\n        ...config,\n        baseURL: config.baseURL || 'https://api.x.ai/v1',\n      });\n\n    case Vendor.DeepSeek:\n      return new GenericOpenAIProvider(connector.name, {\n        ...config,\n        baseURL: config.baseURL || 'https://api.deepseek.com/v1',\n      });\n\n    case Vendor.Mistral:\n      return new GenericOpenAIProvider(connector.name, {\n        ...config,\n        baseURL: config.baseURL || 'https://api.mistral.ai/v1',\n      });\n\n    case Vendor.Ollama:\n      return new GenericOpenAIProvider(connector.name, {\n        ...config,\n        baseURL: config.baseURL || 'http://localhost:11434/v1',\n      });\n\n    case Vendor.Custom:\n      if (!config.baseURL) {\n        throw new Error(\n          `Connector '${connector.name}' with Custom vendor requires baseURL`\n        );\n      }\n      return new GenericOpenAIProvider(connector.name, {\n        ...config,\n        baseURL: config.baseURL,\n      });\n\n    default:\n      throw new Error(`Unknown vendor: ${vendor}`);\n  }\n}\n\n/**\n * Extract ProviderConfig from a Connector\n */\nfunction extractProviderConfig(connector: Connector): ProviderConfig {\n  const auth = connector.config.auth;\n\n  // Get API key based on auth type\n  let apiKey: string;\n\n  if (auth.type === 'api_key') {\n    apiKey = auth.apiKey;\n  } else if (auth.type === 'none') {\n    // For testing/mock providers\n    apiKey = 'mock-key';\n  } else if (auth.type === 'oauth') {\n    // For OAuth, we'd need to get the token asynchronously\n    // For now, throw an error - OAuth providers need special handling\n    throw new Error(\n      `Connector '${connector.name}' uses OAuth. ` +\n        `Call connector.getToken() to get the access token first.`\n    );\n  } else if (auth.type === 'jwt') {\n    throw new Error(\n      `Connector '${connector.name}' uses JWT auth. ` +\n        `JWT auth for AI providers is not yet supported.`\n    );\n  } else {\n    throw new Error(`Unknown auth type for connector '${connector.name}'`);\n  }\n\n  return {\n    apiKey,\n    baseURL: connector.config.baseURL,\n    timeout: connector.getOptions().timeout as number | undefined,\n    maxRetries: connector.getOptions().maxRetries as number | undefined,\n  };\n}\n\n/**\n * Create a text provider from a Connector with async token support\n * Use this for OAuth connectors\n */\nexport async function createProviderAsync(\n  connector: Connector,\n  userId?: string\n): Promise<ITextProvider> {\n  const auth = connector.config.auth;\n\n  // For API key auth, use sync version\n  if (auth.type === 'api_key') {\n    return createProvider(connector);\n  }\n\n  // For OAuth, get the token first\n  const token = await connector.getToken(userId);\n\n  // Create a temporary config with the token as API key\n  // (Most providers accept Bearer tokens the same way as API keys)\n  const tempConnector = {\n    ...connector,\n    config: {\n      ...connector.config,\n      auth: {\n        type: 'api_key' as const,\n        apiKey: token,\n      },\n    },\n  } as Connector;\n\n  return createProvider(tempConnector);\n}\n","/**\n * Tool entities with blocking/non-blocking execution support\n */\n\n// Import the canonical ToolContext from IToolContext.ts (single source of truth)\nimport type { ToolContext } from '../interfaces/IToolContext.js';\n\n// Re-export for backward compatibility\nexport type { ToolContext };\n\nexport interface JSONSchema {\n  type: string;\n  properties?: Record<string, any>;\n  required?: string[];\n  [key: string]: any;\n}\n\nexport interface FunctionToolDefinition {\n  type: 'function';\n  function: {\n    name: string;\n    description?: string;\n    parameters?: JSONSchema;\n    strict?: boolean; // Enforce schema strictly\n  };\n  blocking?: boolean; // Default: true (wait for result before continuing)\n  timeout?: number; // Timeout in ms (default: 30000)\n}\n\nexport interface BuiltInTool {\n  type: 'web_search' | 'file_search' | 'computer_use' | 'code_interpreter';\n  blocking?: boolean;\n}\n\nexport type Tool = FunctionToolDefinition | BuiltInTool;\n\nexport enum ToolCallState {\n  PENDING = 'pending', // Tool call identified, not yet executed\n  EXECUTING = 'executing', // Currently executing\n  COMPLETED = 'completed', // Successfully completed\n  FAILED = 'failed', // Execution failed\n  TIMEOUT = 'timeout', // Execution timed out\n}\n\nexport interface ToolCall {\n  id: string;\n  type: 'function';\n  function: {\n    name: string;\n    arguments: string; // JSON string\n  };\n  blocking: boolean; // Copied from tool definition\n  state: ToolCallState;\n  startTime?: Date;\n  endTime?: Date;\n  error?: string;\n}\n\nexport interface ToolResult {\n  tool_use_id: string;\n  content: any;\n  error?: string;\n  executionTime?: number; // ms\n  state: ToolCallState;\n}\n\n/**\n * Tool execution context - tracks all tool calls in a generation\n */\nexport interface ToolExecutionContext {\n  executionId: string; // Unique ID for this LLM generation\n  toolCalls: Map<string, ToolCall>; // tool_use_id  ToolCall\n  pendingNonBlocking: Set<string>; // IDs of pending non-blocking calls\n  completedResults: Map<string, ToolResult>; // tool_use_id  ToolResult\n}\n\n// ToolContext is imported from IToolContext.ts and re-exported above\n// This eliminates the duplicate definition and ensures type consistency\n\n/**\n * Output handling hints for context management\n */\nexport interface ToolOutputHints {\n  expectedSize?: 'small' | 'medium' | 'large' | 'variable';\n  summarize?: (output: unknown) => string;\n}\n\n/**\n * Idempotency configuration for tool caching\n */\nexport interface ToolIdempotency {\n  /**\n   * @deprecated Use 'cacheable' instead. Will be removed in a future version.\n   * If true, tool is naturally idempotent (e.g., read-only) and doesn't need caching.\n   * If false, tool results should be cached based on arguments.\n   */\n  safe?: boolean;\n\n  /**\n   * If true, tool results can be cached based on arguments.\n   * Use this for tools that return deterministic results for the same inputs.\n   * Takes precedence over the deprecated 'safe' field.\n   * @default false\n   */\n  cacheable?: boolean;\n\n  keyFn?: (args: Record<string, unknown>) => string;\n  ttlMs?: number;\n}\n\n/**\n * Permission configuration for a tool\n *\n * Controls when approval is required for tool execution.\n * Used by the ToolPermissionManager.\n */\nexport interface ToolPermissionConfig {\n  /**\n   * When approval is required.\n   * - 'once' - Require approval for each call\n   * - 'session' - Approve once per session\n   * - 'always' - Auto-approve (no prompts)\n   * - 'never' - Always blocked\n   * @default 'once'\n   */\n  scope?: 'once' | 'session' | 'always' | 'never';\n\n  /**\n   * Risk level classification.\n   * @default 'low'\n   */\n  riskLevel?: 'low' | 'medium' | 'high' | 'critical';\n\n  /**\n   * Custom message shown in approval UI.\n   */\n  approvalMessage?: string;\n\n  /**\n   * Argument names that should be highlighted as sensitive.\n   */\n  sensitiveArgs?: string[];\n\n  /**\n   * TTL for session approvals (milliseconds).\n   */\n  sessionTTLMs?: number;\n}\n\n/**\n * User-provided tool function\n */\nexport interface ToolFunction<TArgs = any, TResult = any> {\n  definition: FunctionToolDefinition;\n  execute: (args: TArgs, context?: ToolContext) => Promise<TResult>;\n\n  // Extended fields for TaskAgent (optional, backward compatible)\n  idempotency?: ToolIdempotency;\n  output?: ToolOutputHints;\n\n  // Permission configuration (optional, backward compatible)\n  /** Permission settings for this tool. If not set, defaults are used. */\n  permission?: ToolPermissionConfig;\n\n  /**\n   * Returns a human-readable description of a tool call.\n   * Used for logging, UI display, and debugging.\n   *\n   * @param args - The arguments passed to the tool\n   * @returns A concise description (e.g., \"reading /path/to/file.ts\")\n   *\n   * If not implemented, use `defaultDescribeCall()` as a fallback.\n   *\n   * @example\n   * // For read_file tool:\n   * describeCall: (args) => args.file_path\n   *\n   * @example\n   * // For bash tool:\n   * describeCall: (args) => args.command.length > 50\n   *   ? args.command.slice(0, 47) + '...'\n   *   : args.command\n   */\n  describeCall?: (args: TArgs) => string;\n}\n\n/**\n * Default implementation for describeCall.\n * Shows the first meaningful argument value.\n *\n * @param args - Tool arguments object\n * @param maxLength - Maximum length before truncation (default: 60)\n * @returns Human-readable description\n *\n * @example\n * defaultDescribeCall({ file_path: '/path/to/file.ts' })\n * // Returns: '/path/to/file.ts'\n *\n * @example\n * defaultDescribeCall({ query: 'search term', limit: 10 })\n * // Returns: 'search term'\n */\nexport function defaultDescribeCall(\n  args: Record<string, unknown>,\n  maxLength = 60\n): string {\n  if (!args || typeof args !== 'object') {\n    return '';\n  }\n\n  // Priority order for common argument names\n  const priorityKeys = [\n    'file_path', 'path', 'command', 'query', 'pattern', 'url',\n    'key', 'name', 'message', 'content', 'expression', 'prompt',\n  ];\n\n  // Try priority keys first\n  for (const key of priorityKeys) {\n    if (key in args && args[key] != null) {\n      const value = args[key];\n      const str = typeof value === 'string' ? value : JSON.stringify(value);\n      return str.length > maxLength ? str.slice(0, maxLength - 3) + '...' : str;\n    }\n  }\n\n  // Fall back to first string argument\n  for (const [, value] of Object.entries(args)) {\n    if (typeof value === 'string' && value.length > 0) {\n      return value.length > maxLength ? value.slice(0, maxLength - 3) + '...' : value;\n    }\n  }\n\n  // Fall back to first argument of any type\n  const firstEntry = Object.entries(args)[0];\n  if (firstEntry) {\n    const [key, value] = firstEntry;\n    const str = typeof value === 'string' ? value : JSON.stringify(value);\n    if (str.length > maxLength) {\n      return `${key}=${str.slice(0, maxLength - key.length - 4)}...`;\n    }\n    return `${key}=${str}`;\n  }\n\n  return '';\n}\n\n/**\n * Get a human-readable description of a tool call.\n * Uses the tool's describeCall method if available, otherwise falls back to default.\n *\n * @param tool - The tool function\n * @param args - The arguments passed to the tool\n * @returns Human-readable description\n */\nexport function getToolCallDescription<TArgs>(\n  tool: ToolFunction<TArgs>,\n  args: TArgs\n): string {\n  if (tool.describeCall) {\n    try {\n      return tool.describeCall(args);\n    } catch {\n      // Fall through to default\n    }\n  }\n  return defaultDescribeCall(args as Record<string, unknown>);\n}\n","/**\n * Execution context - tracks state, metrics, and history for agent execution\n * Includes memory safety (circular buffers) and resource limits\n */\n\nimport { AgentResponse } from '../../domain/entities/Response.js';\nimport { TextGenerateOptions } from '../../domain/interfaces/ITextProvider.js';\nimport { ToolCall, ToolResult, ToolCallState } from '../../domain/entities/Tool.js';\n\nexport type HistoryMode = 'none' | 'summary' | 'full';\n\nexport interface ExecutionContextConfig {\n  maxHistorySize?: number; // Max iterations to store (default: 10)\n  historyMode?: HistoryMode; // What to store (default: 'summary')\n  maxAuditTrailSize?: number; // Max audit entries (default: 1000)\n}\n\nexport interface IterationRecord {\n  iteration: number;\n  request: TextGenerateOptions;\n  response: AgentResponse;\n  toolCalls: ToolCall[];\n  toolResults: ToolResult[];\n  startTime: Date;\n  endTime: Date;\n}\n\nexport interface IterationSummary {\n  iteration: number;\n  tokens: number;\n  toolCount: number;\n  duration: number;\n  timestamp: Date;\n}\n\nexport interface ExecutionMetrics {\n  // Timing\n  totalDuration: number;\n  llmDuration: number;\n  toolDuration: number;\n  hookDuration: number;\n\n  // Counts\n  iterationCount: number;\n  toolCallCount: number;\n  toolSuccessCount: number;\n  toolFailureCount: number;\n  toolTimeoutCount: number;\n\n  // Tokens\n  inputTokens: number;\n  outputTokens: number;\n  totalTokens: number;\n\n  // Errors\n  errors: Array<{ type: string; message: string; timestamp: Date }>;\n}\n\nexport interface AuditEntry {\n  timestamp: Date;\n  type:\n    | 'hook_executed'\n    | 'tool_modified'\n    | 'tool_skipped'\n    | 'execution_paused'\n    | 'execution_resumed'\n    | 'tool_approved'\n    | 'tool_rejected'\n    | 'tool_blocked'\n    | 'tool_permission_approved';\n  hookName?: string;\n  toolName?: string;\n  details: any;\n}\n\nexport class ExecutionContext {\n  // Execution metadata\n  readonly executionId: string;\n  readonly startTime: Date;\n  iteration: number = 0;\n\n  // Tool tracking\n  readonly toolCalls: Map<string, ToolCall> = new Map();\n  readonly toolResults: Map<string, ToolResult> = new Map();\n\n  // Control state\n  paused: boolean = false;\n  pauseReason?: string;\n  cancelled: boolean = false;\n  cancelReason?: string;\n\n  // User data (for hooks to share state)\n  readonly metadata: Map<string, any> = new Map();\n\n  // History storage (memory-safe)\n  private readonly config: ExecutionContextConfig;\n  private readonly iterations: IterationRecord[] = [];\n  private readonly iterationSummaries: IterationSummary[] = [];\n\n  // Metrics\n  readonly metrics: ExecutionMetrics = {\n    totalDuration: 0,\n    llmDuration: 0,\n    toolDuration: 0,\n    hookDuration: 0,\n    iterationCount: 0,\n    toolCallCount: 0,\n    toolSuccessCount: 0,\n    toolFailureCount: 0,\n    toolTimeoutCount: 0,\n    inputTokens: 0,\n    outputTokens: 0,\n    totalTokens: 0,\n    errors: [],\n  };\n\n  // Audit trail\n  private readonly auditTrail: AuditEntry[] = [];\n\n  constructor(\n    executionId: string,\n    config: ExecutionContextConfig = {}\n  ) {\n    this.executionId = executionId;\n    this.startTime = new Date();\n    this.config = {\n      maxHistorySize: config.maxHistorySize || 10,\n      historyMode: config.historyMode || 'summary',\n      maxAuditTrailSize: config.maxAuditTrailSize || 1000,\n    };\n  }\n\n  /**\n   * Add iteration to history (memory-safe)\n   */\n  addIteration(record: IterationRecord): void {\n    switch (this.config.historyMode) {\n      case 'none':\n        // Don't store anything\n        break;\n\n      case 'summary':\n        // Store lightweight summary only\n        this.iterationSummaries.push({\n          iteration: record.iteration,\n          tokens: record.response.usage.total_tokens,\n          toolCount: record.toolCalls.length,\n          duration: record.endTime.getTime() - record.startTime.getTime(),\n          timestamp: record.startTime,\n        });\n\n        // Keep circular buffer\n        if (this.iterationSummaries.length > this.config.maxHistorySize!) {\n          this.iterationSummaries.shift();\n        }\n        break;\n\n      case 'full':\n        // Store full iteration data\n        this.iterations.push(record);\n\n        // Keep circular buffer\n        if (this.iterations.length > this.config.maxHistorySize!) {\n          this.iterations.shift();\n        }\n        break;\n    }\n  }\n\n  /**\n   * Get iteration history\n   */\n  getHistory(): IterationRecord[] | IterationSummary[] {\n    return this.config.historyMode === 'full' ? this.iterations : this.iterationSummaries;\n  }\n\n  /**\n   * Add audit entry\n   */\n  audit(type: AuditEntry['type'], details: any, hookName?: string, toolName?: string): void {\n    this.auditTrail.push({\n      timestamp: new Date(),\n      type,\n      hookName,\n      toolName,\n      details,\n    });\n\n    // Keep circular buffer\n    if (this.auditTrail.length > this.config.maxAuditTrailSize!) {\n      this.auditTrail.shift();\n    }\n  }\n\n  /**\n   * Get audit trail\n   */\n  getAuditTrail(): readonly AuditEntry[] {\n    return this.auditTrail;\n  }\n\n  /**\n   * Update metrics\n   */\n  updateMetrics(update: Partial<ExecutionMetrics>): void {\n    Object.assign(this.metrics, update);\n  }\n\n  /**\n   * Add tool call to tracking\n   */\n  addToolCall(toolCall: ToolCall): void {\n    this.toolCalls.set(toolCall.id, toolCall);\n    this.metrics.toolCallCount++;\n  }\n\n  /**\n   * Add tool result to tracking\n   */\n  addToolResult(result: ToolResult): void {\n    this.toolResults.set(result.tool_use_id, result);\n\n    // Update metrics\n    if (result.state === ToolCallState.COMPLETED) {\n      this.metrics.toolSuccessCount++;\n    } else if (result.state === ToolCallState.FAILED) {\n      this.metrics.toolFailureCount++;\n    } else if (result.state === ToolCallState.TIMEOUT) {\n      this.metrics.toolTimeoutCount++;\n    }\n  }\n\n  /**\n   * Check resource limits\n   */\n  checkLimits(limits?: {\n    maxExecutionTime?: number;\n    maxToolCalls?: number;\n    maxContextSize?: number;\n  }): void {\n    if (!limits) return;\n\n    // Check execution time\n    if (limits.maxExecutionTime) {\n      const elapsed = Date.now() - this.startTime.getTime();\n      if (elapsed > limits.maxExecutionTime) {\n        throw new Error(\n          `Execution time limit exceeded: ${elapsed}ms > ${limits.maxExecutionTime}ms`\n        );\n      }\n    }\n\n    // Check tool call count\n    if (limits.maxToolCalls && this.toolCalls.size > limits.maxToolCalls) {\n      throw new Error(\n        `Tool call limit exceeded: ${this.toolCalls.size} > ${limits.maxToolCalls}`\n      );\n    }\n\n    // Check context size\n    if (limits.maxContextSize) {\n      const size = this.estimateSize();\n      if (size > limits.maxContextSize) {\n        throw new Error(\n          `Context size limit exceeded: ${size} bytes > ${limits.maxContextSize} bytes`\n        );\n      }\n    }\n  }\n\n  /**\n   * Estimate memory usage (rough approximation)\n   */\n  private estimateSize(): number {\n    try {\n      const data = {\n        toolCalls: Array.from(this.toolCalls.values()),\n        toolResults: Array.from(this.toolResults.values()),\n        iterations: this.config.historyMode === 'full' ? this.iterations : this.iterationSummaries,\n        auditTrail: this.auditTrail,\n      };\n      return JSON.stringify(data).length;\n    } catch {\n      return 0; // Error estimating, return 0\n    }\n  }\n\n  /**\n   * Cleanup resources and release memory\n   * Clears all internal arrays and maps to allow garbage collection\n   */\n  cleanup(): void {\n    // Store execution summary before clearing\n    const summary = {\n      executionId: this.executionId,\n      totalIterations: this.iteration,\n      totalToolCalls: this.metrics.toolCallCount,\n      totalDuration: Date.now() - this.startTime.getTime(),\n      success: !this.cancelled && this.metrics.errors.length === 0,\n    };\n\n    // Clear all maps\n    this.toolCalls.clear();\n    this.toolResults.clear();\n    this.metadata.clear();\n\n    // Clear all arrays (modify length to allow GC of items)\n    this.iterations.length = 0;\n    this.iterationSummaries.length = 0;\n    this.auditTrail.length = 0;\n    this.metrics.errors.length = 0;\n\n    // Store summary after clearing (for final access if needed)\n    this.metadata.set('execution_summary', summary);\n  }\n\n  /**\n   * Get execution summary\n   */\n  getSummary() {\n    return {\n      executionId: this.executionId,\n      startTime: this.startTime,\n      currentIteration: this.iteration,\n      paused: this.paused,\n      cancelled: this.cancelled,\n      metrics: { ...this.metrics },\n      totalDuration: Date.now() - this.startTime.getTime(),\n    };\n  }\n}\n","/**\n * Hook manager - handles hook registration and execution\n * Includes error isolation, timeouts, and optional parallel execution\n */\n\nimport { EventEmitter } from 'eventemitter3';\nimport {\n  Hook,\n  HookConfig,\n  HookName,\n  HookSignatures,\n} from './types/HookTypes.js';\n\nexport class HookManager {\n  private hooks: Map<HookName, Hook<any, any>[]> = new Map();\n  private timeout: number;\n  private parallel: boolean;\n  // Per-hook error tracking: hookKey -> consecutive error count\n  private hookErrorCounts: Map<string, number> = new Map();\n  // Disabled hooks that exceeded error threshold\n  private disabledHooks: Set<string> = new Set();\n  private maxConsecutiveErrors: number = 3;\n  private emitter: EventEmitter;\n\n  constructor(\n    config: HookConfig = {},\n    emitter: EventEmitter,\n    errorHandling?: { maxConsecutiveErrors?: number }\n  ) {\n    this.timeout = config.hookTimeout || 5000; // 5 second default\n    this.parallel = config.parallelHooks || false;\n    this.emitter = emitter;\n    this.maxConsecutiveErrors = errorHandling?.maxConsecutiveErrors || 3;\n\n    // Register hooks from config\n    this.registerFromConfig(config);\n  }\n\n  /**\n   * Register hooks from configuration\n   */\n  private registerFromConfig(config: HookConfig): void {\n    const hookNames: HookName[] = [\n      'before:execution',\n      'after:execution',\n      'before:llm',\n      'after:llm',\n      'before:tool',\n      'after:tool',\n      'approve:tool',\n      'pause:check',\n    ];\n\n    for (const name of hookNames) {\n      const hook = config[name];\n      if (hook) {\n        this.register(name, hook);\n      }\n    }\n  }\n\n  /**\n   * Register a hook\n   */\n  register(name: HookName, hook: Hook<any, any>): void {\n    // Validate hook is a function\n    if (typeof hook !== 'function') {\n      throw new Error(`Hook must be a function, got: ${typeof hook}`);\n    }\n\n    // Get or create hooks array\n    if (!this.hooks.has(name)) {\n      this.hooks.set(name, []);\n    }\n\n    const existing = this.hooks.get(name)!;\n\n    // Limit number of hooks per name\n    if (existing.length >= 10) {\n      throw new Error(`Too many hooks for ${name} (max: 10)`);\n    }\n\n    existing.push(hook);\n  }\n\n  /**\n   * Execute hooks for a given name\n   */\n  async executeHooks<K extends HookName>(\n    name: K,\n    context: HookSignatures[K]['context'],\n    defaultResult: HookSignatures[K]['result']\n  ): Promise<HookSignatures[K]['result']> {\n    const hooks = this.hooks.get(name);\n\n    if (!hooks || hooks.length === 0) {\n      return defaultResult;\n    }\n\n    // Parallel execution (for independent hooks)\n    if (this.parallel && hooks.length > 1) {\n      return this.executeHooksParallel(hooks, context, defaultResult);\n    }\n\n    // Sequential execution (default)\n    return this.executeHooksSequential(hooks, context, defaultResult);\n  }\n\n  /**\n   * Execute hooks sequentially\n   */\n  private async executeHooksSequential<T>(\n    hooks: Hook<any, any>[],\n    context: any,\n    defaultResult: T\n  ): Promise<T> {\n    let result = defaultResult;\n\n    for (let i = 0; i < hooks.length; i++) {\n      const hook = hooks[i]!;\n      const hookKey = this.getHookKey(hook, i);\n      const hookResult = await this.executeHookSafely(hook, context, hookKey);\n\n      // Skip failed hooks\n      if (hookResult === null) {\n        continue;\n      }\n\n      // Merge hook result\n      result = { ...result, ...hookResult };\n\n      // Check for early exit\n      if ((hookResult as any).skip === true) {\n        break;\n      }\n    }\n\n    return result;\n  }\n\n  /**\n   * Execute hooks in parallel\n   */\n  private async executeHooksParallel<T>(\n    hooks: Hook<any, any>[],\n    context: any,\n    defaultResult: T\n  ): Promise<T> {\n    // Execute all hooks concurrently with unique keys\n    const results = await Promise.all(\n      hooks.map((hook, i) => {\n        const hookKey = this.getHookKey(hook, i);\n        return this.executeHookSafely(hook, context, hookKey);\n      })\n    );\n\n    // Filter out failures and merge results\n    const validResults = results.filter((r) => r !== null);\n\n    return validResults.reduce(\n      (acc, hookResult) => ({ ...acc, ...hookResult }),\n      defaultResult\n    );\n  }\n\n  /**\n   * Generate unique key for a hook\n   */\n  private getHookKey(hook: Hook<any, any>, index: number): string {\n    return `${hook.name || 'anonymous'}_${index}`;\n  }\n\n  /**\n   * Execute single hook with error isolation and timeout (with per-hook error tracking)\n   */\n  private async executeHookSafely<T>(\n    hook: Hook<any, any>,\n    context: any,\n    hookKey?: string\n  ): Promise<T | null> {\n    const key = hookKey || hook.name || 'anonymous';\n\n    // Skip disabled hooks\n    if (this.disabledHooks.has(key)) {\n      return null;\n    }\n\n    const startTime = Date.now();\n\n    try {\n      // Execute with timeout\n      const result = await Promise.race([\n        hook(context),\n        new Promise<never>((_, reject) =>\n          setTimeout(() => reject(new Error('Hook timeout')), this.timeout)\n        ),\n      ]);\n\n      // Reset error counter for this hook on success\n      this.hookErrorCounts.delete(key);\n\n      // Track timing\n      const duration = Date.now() - startTime;\n      if (context.context?.updateMetrics) {\n        context.context.updateMetrics({\n          hookDuration: (context.context.metrics.hookDuration || 0) + duration,\n        });\n      }\n\n      return result as T;\n    } catch (error) {\n      // Increment error counter for this specific hook\n      const errorCount = (this.hookErrorCounts.get(key) || 0) + 1;\n      this.hookErrorCounts.set(key, errorCount);\n\n      // Emit error event\n      this.emitter.emit('hook:error', {\n        executionId: context.executionId,\n        hookName: hook.name || 'anonymous',\n        error: error as Error,\n        consecutiveErrors: errorCount,\n        timestamp: new Date(),\n      });\n\n      // Check consecutive error threshold for this hook\n      if (errorCount >= this.maxConsecutiveErrors) {\n        // Disable this specific hook, not all hooks\n        this.disabledHooks.add(key);\n        console.warn(\n          `Hook \"${key}\" disabled after ${errorCount} consecutive failures. Last error: ${(error as Error).message}`\n        );\n      } else {\n        // Log warning but continue (degraded mode)\n        console.warn(\n          `Hook execution failed (${key}): ${(error as Error).message} (${errorCount}/${this.maxConsecutiveErrors} errors)`\n        );\n      }\n\n      return null; // Hook failed, skip its result\n    }\n  }\n\n  /**\n   * Check if there are any hooks registered\n   */\n  hasHooks(name: HookName): boolean {\n    const hooks = this.hooks.get(name);\n    return !!hooks && hooks.length > 0;\n  }\n\n  /**\n   * Get hook count\n   */\n  getHookCount(name?: HookName): number {\n    if (name) {\n      return this.hooks.get(name)?.length || 0;\n    }\n    // Total across all hooks\n    return Array.from(this.hooks.values()).reduce((sum, arr) => sum + arr.length, 0);\n  }\n\n  /**\n   * Clear all hooks and reset error tracking\n   */\n  clear(): void {\n    this.hooks.clear();\n    this.hookErrorCounts.clear();\n    this.disabledHooks.clear();\n  }\n\n  /**\n   * Re-enable a disabled hook\n   */\n  enableHook(hookKey: string): void {\n    this.disabledHooks.delete(hookKey);\n    this.hookErrorCounts.delete(hookKey);\n  }\n\n  /**\n   * Get list of disabled hooks\n   */\n  getDisabledHooks(): string[] {\n    return Array.from(this.disabledHooks);\n  }\n}\n","/**\n * StreamState - Accumulates streaming events to reconstruct complete response\n */\n\nimport { TokenUsage } from './Response.js';\nimport { ToolCall } from './Tool.js';\n\n/**\n * Buffer for accumulating tool call arguments\n */\nexport interface ToolCallBuffer {\n  toolName: string;\n  argumentChunks: string[];\n  isComplete: boolean;\n  startTime: Date;\n}\n\n/**\n * StreamState tracks all accumulated data during streaming\n */\nexport class StreamState {\n  // Core identifiers\n  public responseId: string;\n  public model: string;\n  public createdAt: number;\n\n  // Text accumulation: item_id -> text chunks\n  private textBuffers: Map<string, string[]>;\n\n  // Tool call accumulation: tool_call_id -> buffer\n  private toolCallBuffers: Map<string, ToolCallBuffer>;\n\n  // Completed tool calls\n  private completedToolCalls: ToolCall[];\n\n  // Tool execution results\n  private toolResults: Map<string, any>;\n\n  // Metadata\n  public currentIteration: number;\n  public usage: TokenUsage;\n  public status: 'in_progress' | 'completed' | 'incomplete' | 'failed';\n  public startTime: Date;\n  public endTime?: Date;\n\n  // Statistics\n  public totalChunks: number;\n  public totalTextDeltas: number;\n  public totalToolCalls: number;\n\n  constructor(responseId: string, model: string, createdAt?: number) {\n    this.responseId = responseId;\n    this.model = model;\n    this.createdAt = createdAt || Date.now();\n\n    this.textBuffers = new Map();\n    this.toolCallBuffers = new Map();\n    this.completedToolCalls = [];\n    this.toolResults = new Map();\n\n    this.currentIteration = 0;\n    this.usage = {\n      input_tokens: 0,\n      output_tokens: 0,\n      total_tokens: 0,\n    };\n    this.status = 'in_progress';\n    this.startTime = new Date();\n\n    this.totalChunks = 0;\n    this.totalTextDeltas = 0;\n    this.totalToolCalls = 0;\n  }\n\n  /**\n   * Accumulate text delta for a specific item\n   */\n  accumulateTextDelta(itemId: string, delta: string): void {\n    if (!this.textBuffers.has(itemId)) {\n      this.textBuffers.set(itemId, []);\n    }\n    this.textBuffers.get(itemId)!.push(delta);\n    this.totalTextDeltas++;\n    this.totalChunks++;\n  }\n\n  /**\n   * Get complete accumulated text for an item\n   */\n  getCompleteText(itemId: string): string {\n    const chunks = this.textBuffers.get(itemId);\n    return chunks ? chunks.join('') : '';\n  }\n\n  /**\n   * Get all accumulated text (all items concatenated)\n   */\n  getAllText(): string {\n    const allText: string[] = [];\n    for (const chunks of this.textBuffers.values()) {\n      allText.push(chunks.join(''));\n    }\n    return allText.join('');\n  }\n\n  /**\n   * Start accumulating tool call arguments\n   */\n  startToolCall(toolCallId: string, toolName: string): void {\n    this.toolCallBuffers.set(toolCallId, {\n      toolName,\n      argumentChunks: [],\n      isComplete: false,\n      startTime: new Date(),\n    });\n  }\n\n  /**\n   * Accumulate tool argument delta\n   */\n  accumulateToolArguments(toolCallId: string, delta: string): void {\n    const buffer = this.toolCallBuffers.get(toolCallId);\n    if (!buffer) {\n      throw new Error(`Tool call buffer not found for id: ${toolCallId}`);\n    }\n    buffer.argumentChunks.push(delta);\n    this.totalChunks++;\n  }\n\n  /**\n   * Mark tool call arguments as complete\n   */\n  completeToolCall(toolCallId: string): void {\n    const buffer = this.toolCallBuffers.get(toolCallId);\n    if (!buffer) {\n      throw new Error(`Tool call buffer not found for id: ${toolCallId}`);\n    }\n    buffer.isComplete = true;\n    this.totalToolCalls++;\n  }\n\n  /**\n   * Get complete tool arguments (joined chunks)\n   */\n  getCompleteToolArguments(toolCallId: string): string {\n    const buffer = this.toolCallBuffers.get(toolCallId);\n    if (!buffer) {\n      throw new Error(`Tool call buffer not found for id: ${toolCallId}`);\n    }\n    return buffer.argumentChunks.join('');\n  }\n\n  /**\n   * Check if tool call is complete\n   */\n  isToolCallComplete(toolCallId: string): boolean {\n    const buffer = this.toolCallBuffers.get(toolCallId);\n    return buffer ? buffer.isComplete : false;\n  }\n\n  /**\n   * Get tool name for a tool call\n   */\n  getToolName(toolCallId: string): string | undefined {\n    return this.toolCallBuffers.get(toolCallId)?.toolName;\n  }\n\n  /**\n   * Add completed tool call\n   */\n  addCompletedToolCall(toolCall: ToolCall): void {\n    this.completedToolCalls.push(toolCall);\n  }\n\n  /**\n   * Get all completed tool calls\n   */\n  getCompletedToolCalls(): ToolCall[] {\n    return [...this.completedToolCalls];\n  }\n\n  /**\n   * Store tool execution result\n   */\n  setToolResult(toolCallId: string, result: any): void {\n    this.toolResults.set(toolCallId, result);\n  }\n\n  /**\n   * Get tool execution result\n   */\n  getToolResult(toolCallId: string): any {\n    return this.toolResults.get(toolCallId);\n  }\n\n  /**\n   * Update token usage (replaces values, doesn't accumulate)\n   */\n  updateUsage(usage: Partial<TokenUsage>): void {\n    if (usage.input_tokens !== undefined) {\n      this.usage.input_tokens = usage.input_tokens;\n    }\n    if (usage.output_tokens !== undefined) {\n      this.usage.output_tokens = usage.output_tokens;\n    }\n    if (usage.total_tokens !== undefined) {\n      this.usage.total_tokens = usage.total_tokens;\n    } else {\n      // Calculate total if not provided\n      this.usage.total_tokens = this.usage.input_tokens + this.usage.output_tokens;\n    }\n  }\n\n  /**\n   * Accumulate token usage (adds to existing values)\n   */\n  accumulateUsage(usage: Partial<TokenUsage>): void {\n    if (usage.input_tokens !== undefined) {\n      this.usage.input_tokens += usage.input_tokens;\n    }\n    if (usage.output_tokens !== undefined) {\n      this.usage.output_tokens += usage.output_tokens;\n    }\n    if (usage.total_tokens !== undefined) {\n      this.usage.total_tokens += usage.total_tokens;\n    } else {\n      // Recalculate total\n      this.usage.total_tokens = this.usage.input_tokens + this.usage.output_tokens;\n    }\n  }\n\n  /**\n   * Mark stream as complete\n   */\n  markComplete(status: 'completed' | 'incomplete' | 'failed' = 'completed'): void {\n    this.status = status;\n    this.endTime = new Date();\n  }\n\n  /**\n   * Get duration in milliseconds\n   */\n  getDuration(): number {\n    const end = this.endTime || new Date();\n    return end.getTime() - this.startTime.getTime();\n  }\n\n  /**\n   * Increment iteration counter\n   */\n  incrementIteration(): void {\n    this.currentIteration++;\n  }\n\n  /**\n   * Get summary statistics\n   */\n  getStatistics() {\n    return {\n      responseId: this.responseId,\n      model: this.model,\n      status: this.status,\n      iterations: this.currentIteration,\n      totalChunks: this.totalChunks,\n      totalTextDeltas: this.totalTextDeltas,\n      totalToolCalls: this.totalToolCalls,\n      textItemsCount: this.textBuffers.size,\n      toolCallBuffersCount: this.toolCallBuffers.size,\n      completedToolCallsCount: this.completedToolCalls.length,\n      durationMs: this.getDuration(),\n      usage: { ...this.usage },\n    };\n  }\n\n  /**\n   * Check if stream has any accumulated text\n   */\n  hasText(): boolean {\n    return this.textBuffers.size > 0;\n  }\n\n  /**\n   * Check if stream has any tool calls\n   */\n  hasToolCalls(): boolean {\n    return this.toolCallBuffers.size > 0;\n  }\n\n  /**\n   * Clear all buffers (for memory management)\n   */\n  clear(): void {\n    this.textBuffers.clear();\n    this.toolCallBuffers.clear();\n    this.completedToolCalls = [];\n    this.toolResults.clear();\n  }\n\n  /**\n   * Create a snapshot for checkpointing (error recovery)\n   */\n  createSnapshot() {\n    return {\n      responseId: this.responseId,\n      model: this.model,\n      createdAt: this.createdAt,\n      textBuffers: new Map(this.textBuffers),\n      toolCallBuffers: new Map(this.toolCallBuffers),\n      completedToolCalls: [...this.completedToolCalls],\n      toolResults: new Map(this.toolResults),\n      currentIteration: this.currentIteration,\n      usage: { ...this.usage },\n      status: this.status,\n      startTime: this.startTime,\n      endTime: this.endTime,\n    };\n  }\n}\n","/**\n * Agentic loop - handles tool calling and multi-turn conversations\n * Now with events, hooks, pause/resume, and enterprise features\n */\n\nimport { randomUUID } from 'crypto';\nimport { EventEmitter } from 'eventemitter3';\nimport { ITextProvider, TextGenerateOptions } from '../../domain/interfaces/ITextProvider.js';\nimport { IToolExecutor } from '../../domain/interfaces/IToolExecutor.js';\nimport { AgentResponse } from '../../domain/entities/Response.js';\nimport { InputItem, MessageRole, OutputItem } from '../../domain/entities/Message.js';\nimport { Tool, ToolCall, ToolCallState, ToolResult } from '../../domain/entities/Tool.js';\nimport { ContentType, ToolResultContent } from '../../domain/entities/Content.js';\nimport { ToolTimeoutError } from '../../domain/errors/AIErrors.js';\nimport { ExecutionContext, HistoryMode } from './ExecutionContext.js';\nimport { HookManager } from './HookManager.js';\nimport { HookConfig } from './types/HookTypes.js';\nimport { AgenticLoopEvents } from './types/EventTypes.js';\nimport { StreamEvent, StreamEventType, isToolCallArgumentsDone } from '../../domain/entities/StreamEvent.js';\nimport { StreamState } from '../../domain/entities/StreamState.js';\nimport type { ToolPermissionManager } from '../../core/permissions/ToolPermissionManager.js';\nimport type { PermissionCheckContext } from '../../core/permissions/types.js';\nimport type { AgentContext } from '../../core/AgentContext.js';\n\nexport interface AgenticLoopConfig {\n  model: string;\n  input: string | InputItem[];\n  instructions?: string;\n  tools: Tool[];\n  temperature?: number;\n  maxIterations: number;\n  /** Vendor-specific options (e.g., Google's thinkingLevel) */\n  vendorOptions?: Record<string, any>;\n\n  // NEW: Enterprise configuration\n  hooks?: HookConfig;\n  historyMode?: HistoryMode;\n  limits?: {\n    maxExecutionTime?: number;\n    maxToolCalls?: number;\n    maxContextSize?: number;\n    /** Maximum input messages to keep (prevents unbounded growth). Default: 50 */\n    maxInputMessages?: number;\n  };\n  errorHandling?: {\n    hookFailureMode?: 'fail' | 'warn' | 'ignore';\n    /**\n     * Tool failure handling mode:\n     * - 'fail': Stop execution on first tool failure (throw error)\n     * - 'continue': Execute all tools even if some fail, return all results including errors\n     * @default 'continue'\n     */\n    toolFailureMode?: 'fail' | 'continue';\n    maxConsecutiveErrors?: number;\n  };\n\n  /**\n   * Tool execution timeout in milliseconds\n   * @default 30000 (30 seconds)\n   */\n  toolTimeout?: number;\n\n  /**\n   * Permission manager for tool approval/blocking.\n   * If provided, permission checks run BEFORE approve:tool hooks.\n   */\n  permissionManager?: ToolPermissionManager;\n\n  /**\n   * Agent type for permission context (used by TaskAgent/UniversalAgent).\n   * @default 'agent'\n   */\n  agentType?: 'agent' | 'task-agent' | 'universal-agent';\n\n  /**\n   * Current task name (used for TaskAgent/UniversalAgent context).\n   */\n  taskName?: string;\n\n  /**\n   * AgentContext for unified context management.\n   * When provided, AgenticLoop delegates ALL context management to AgentContext:\n   * - Uses prepareConversation() before each LLM call\n   * - Uses addAssistantResponse() and addToolResults() after each iteration\n   * - Skips internal sliding window (AgentContext handles compaction)\n   */\n  agentContext?: AgentContext;\n}\n\nexport class AgenticLoop extends EventEmitter<AgenticLoopEvents> {\n  private hookManager: HookManager;\n  private context: ExecutionContext | null = null;\n\n  // Pause/resume state\n  private paused: boolean = false;\n  private pausePromise: Promise<void> | null = null;\n  private resumeCallback: (() => void) | null = null;\n  private cancelled: boolean = false;\n  // Mutex to prevent race conditions in pause/resume\n  private pauseResumeMutex: Promise<void> = Promise.resolve();\n\n  constructor(\n    private provider: ITextProvider,\n    private toolExecutor: IToolExecutor,\n    hookConfig?: HookConfig,\n    errorHandling?: { maxConsecutiveErrors?: number }\n  ) {\n    super();\n    this.hookManager = new HookManager(\n      hookConfig || {},\n      this,\n      errorHandling\n    );\n  }\n\n  /**\n   * Execute agentic loop with tool calling\n   */\n  async execute(config: AgenticLoopConfig): Promise<AgentResponse> {\n    // Generate execution ID\n    const executionId = `exec_${randomUUID()}`;\n\n    // Create execution context\n    this.context = new ExecutionContext(executionId, {\n      maxHistorySize: 10,\n      historyMode: config.historyMode || 'summary',\n      maxAuditTrailSize: 1000,\n    });\n\n    // Reset state\n    this.paused = false;\n    this.cancelled = false;\n\n    // Determine if we're using AgentContext for context management\n    const useAgentContext = !!config.agentContext;\n    const agentContext = config.agentContext;\n\n    // If using AgentContext, add initial user message\n    if (useAgentContext && agentContext) {\n      if (typeof config.input === 'string') {\n        agentContext.addUserMessage(config.input);\n      } else if (Array.isArray(config.input)) {\n        agentContext.addInputItems(config.input);\n      }\n    }\n\n    // Emit execution start\n    this.emit('execution:start', {\n      executionId,\n      config,\n      timestamp: new Date(),\n    });\n\n    // Execute before:execution hook\n    await this.hookManager.executeHooks('before:execution', {\n      executionId,\n      config,\n      timestamp: new Date(),\n    }, undefined as any);\n\n    // Internal input tracking (only used when AgentContext is not provided)\n    let currentInput = config.input;\n    let iteration = 0;\n    let finalResponse: AgentResponse;\n\n    try {\n      while (iteration < config.maxIterations) {\n        // Check pause\n        await this.checkPause();\n\n        // Check if cancelled\n        if (this.cancelled) {\n          throw new Error('Execution cancelled');\n        }\n\n        // Check resource limits\n        this.context.checkLimits(config.limits);\n\n        // Check pause hook\n        const pauseCheck = await this.hookManager.executeHooks('pause:check', {\n          executionId,\n          iteration,\n          context: this.context,\n          timestamp: new Date(),\n        }, { shouldPause: false });\n\n        if (pauseCheck.shouldPause) {\n          this.pause(pauseCheck.reason || 'Hook requested pause');\n          await this.checkPause();\n        }\n\n        // Update iteration\n        this.context.iteration = iteration;\n\n        // Emit iteration start\n        this.emit('iteration:start', {\n          executionId,\n          iteration,\n          timestamp: new Date(),\n        });\n\n        const iterationStartTime = Date.now();\n\n        // Get input for LLM call\n        let llmInput: string | InputItem[];\n        if (useAgentContext && agentContext) {\n          // Use AgentContext for context management\n          const prepared = await agentContext.prepareConversation({\n            instructionOverride: config.instructions,\n          });\n          llmInput = prepared.input;\n        } else {\n          // Use internal context management\n          llmInput = currentInput;\n        }\n\n        // Generate LLM response\n        const response = await this.generateWithHooks(config, llmInput, iteration, executionId);\n\n        // Extract tool calls\n        const toolCalls = this.extractToolCalls(response.output, config.tools);\n\n        // Add assistant response to AgentContext\n        if (useAgentContext && agentContext) {\n          agentContext.addAssistantResponse(response.output);\n        }\n\n        // Emit tool detection\n        if (toolCalls.length > 0) {\n          this.emit('tool:detected', {\n            executionId,\n            iteration,\n            toolCalls,\n            timestamp: new Date(),\n          });\n        }\n\n        // If no tool calls, we're done\n        if (toolCalls.length === 0) {\n          // Emit iteration complete\n          this.emit('iteration:complete', {\n            executionId,\n            iteration,\n            response,\n            timestamp: new Date(),\n            duration: Date.now() - iterationStartTime,\n          });\n\n          finalResponse = response;\n          break;\n        }\n\n        // Execute tools with hooks\n        const toolResults = await this.executeToolsWithHooks(toolCalls, iteration, executionId, config);\n\n        // Add tool results to AgentContext\n        if (useAgentContext && agentContext) {\n          agentContext.addToolResults(toolResults);\n        }\n\n        // Store iteration record\n        this.context.addIteration({\n          iteration,\n          request: {\n            model: config.model,\n            input: useAgentContext ? llmInput : currentInput,\n            instructions: config.instructions,\n            tools: config.tools,\n            temperature: config.temperature,\n          },\n          response,\n          toolCalls,\n          toolResults,\n          startTime: new Date(iterationStartTime),\n          endTime: new Date(),\n        });\n\n        // Update metrics\n        this.context.updateMetrics({\n          iterationCount: iteration + 1,\n          inputTokens: this.context.metrics.inputTokens + (response.usage?.input_tokens || 0),\n          outputTokens: this.context.metrics.outputTokens + (response.usage?.output_tokens || 0),\n          totalTokens: this.context.metrics.totalTokens + (response.usage?.total_tokens || 0),\n        });\n\n        // Emit iteration complete\n        this.emit('iteration:complete', {\n          executionId,\n          iteration,\n          response,\n          timestamp: new Date(),\n          duration: Date.now() - iterationStartTime,\n        });\n\n        // Update input for next iteration (only if not using AgentContext)\n        if (!useAgentContext) {\n          // Build next input - append to existing context (preserve history)\n          const newMessages = this.buildNewMessages(response.output, toolResults);\n          currentInput = this.appendToContext(currentInput, newMessages);\n\n          // Apply sliding window to prevent unbounded input growth\n          const maxInputMessages = config.limits?.maxInputMessages ?? 50;\n          currentInput = this.applySlidingWindow(currentInput, maxInputMessages);\n        }\n\n        iteration++;\n      }\n\n      // Check if we exited normally or hit max iterations\n      if (iteration >= config.maxIterations) {\n        throw new Error(`Max iterations (${config.maxIterations}) reached without completion`);\n      }\n\n      // Calculate total duration\n      const totalDuration = Date.now() - this.context.startTime.getTime();\n      this.context.updateMetrics({ totalDuration });\n\n      // Execute after:execution hook\n      await this.hookManager.executeHooks('after:execution', {\n        executionId,\n        response: finalResponse!,\n        context: this.context,\n        timestamp: new Date(),\n        duration: totalDuration,\n      }, undefined as any);\n\n      // Emit execution complete\n      this.emit('execution:complete', {\n        executionId,\n        response: finalResponse!,\n        timestamp: new Date(),\n        duration: totalDuration,\n      });\n\n      return finalResponse!;\n    } catch (error) {\n      // Emit execution error\n      this.emit('execution:error', {\n        executionId,\n        error: error as Error,\n        timestamp: new Date(),\n      });\n\n      // Record error in metrics\n      this.context?.metrics.errors.push({\n        type: 'execution_error',\n        message: (error as Error).message,\n        timestamp: new Date(),\n      });\n\n      throw error;\n    } finally {\n      // Always cleanup resources\n      this.context?.cleanup();\n      this.hookManager.clear();\n    }\n  }\n\n  /**\n   * Execute agentic loop with streaming and tool calling\n   */\n  async *executeStreaming(config: AgenticLoopConfig): AsyncIterableIterator<StreamEvent> {\n    // Generate execution ID\n    const executionId = `exec_${randomUUID()}`;\n\n    // Create execution context\n    this.context = new ExecutionContext(executionId, {\n      maxHistorySize: 10,\n      historyMode: config.historyMode || 'summary',\n      maxAuditTrailSize: 1000,\n    });\n\n    // Reset state\n    this.paused = false;\n    this.cancelled = false;\n    this.pausePromise = null;\n    this.resumeCallback = null;\n\n    // Determine if we're using AgentContext for context management\n    const useAgentContext = !!config.agentContext;\n    const agentContext = config.agentContext;\n\n    // If using AgentContext, add initial user message\n    if (useAgentContext && agentContext) {\n      if (typeof config.input === 'string') {\n        agentContext.addUserMessage(config.input);\n      } else if (Array.isArray(config.input)) {\n        agentContext.addInputItems(config.input);\n      }\n    }\n\n    const startTime = Date.now();\n    let iteration = 0;\n    let currentInput: string | InputItem[] = config.input;\n\n    // Create a single StreamState for the entire execution (tracks usage across iterations)\n    const globalStreamState = new StreamState(executionId, config.model);\n\n    try {\n      // Emit execution start event\n      this.emit('execution:start', {\n        executionId,\n        model: config.model,\n        timestamp: new Date(),\n      });\n\n      // Execute before:execution hook\n      await this.hookManager.executeHooks('before:execution', {\n        executionId,\n        config,\n        timestamp: new Date(),\n      }, undefined as any);\n\n      // Main agentic loop\n      while (iteration < config.maxIterations) {\n        iteration++;\n\n        // Check pause state\n        await this.checkPause();\n\n        // Check if cancelled\n        if (this.cancelled) {\n          this.emit('execution:cancelled', { executionId, iteration, timestamp: new Date() });\n          break;\n        }\n\n        // Check resource limits\n        if (this.context) {\n          this.context.checkLimits(config.limits);\n        }\n\n        // Execute pause:check hook (allows dynamic pause decisions)\n        const pauseCheck = await this.hookManager.executeHooks('pause:check', {\n          executionId,\n          iteration,\n          context: this.context!,\n          timestamp: new Date(),\n        }, { shouldPause: false });\n\n        if (pauseCheck.shouldPause) {\n          this.pause();\n        }\n\n        // Emit iteration start\n        this.emit('iteration:start', {\n          executionId,\n          iteration,\n          timestamp: new Date(),\n        });\n\n        // Get input for LLM call\n        let llmInput: string | InputItem[];\n        if (useAgentContext && agentContext) {\n          // Use AgentContext for context management\n          const prepared = await agentContext.prepareConversation({\n            instructionOverride: config.instructions,\n          });\n          llmInput = prepared.input;\n        } else {\n          // Use internal context management\n          llmInput = currentInput;\n        }\n\n        // Stream LLM response and accumulate state (per-iteration state)\n        const iterationStreamState = new StreamState(executionId, config.model);\n        const toolCallsMap = new Map<string, { name: string; args: string }>();\n\n        // Stream from provider with hooks\n        yield* this.streamGenerateWithHooks(config, llmInput, iteration, executionId, iterationStreamState, toolCallsMap);\n\n        // Accumulate usage from this iteration into global state\n        globalStreamState.accumulateUsage(iterationStreamState.usage);\n\n        // Check if any tool calls were detected\n        const toolCalls: ToolCall[] = [];\n        for (const [toolCallId, buffer] of toolCallsMap) {\n          toolCalls.push({\n            id: toolCallId,\n            type: 'function',\n            function: {\n              name: buffer.name,\n              arguments: buffer.args,\n            },\n            blocking: true,\n            state: ToolCallState.PENDING,\n          });\n        }\n\n        // No tool calls? We're done\n        if (toolCalls.length === 0) {\n          // Yield iteration complete\n          yield {\n            type: StreamEventType.ITERATION_COMPLETE,\n            response_id: executionId,\n            iteration,\n            tool_calls_count: 0,\n            has_more_iterations: false,\n          };\n\n          // Final response complete with accumulated usage from all iterations\n          yield {\n            type: StreamEventType.RESPONSE_COMPLETE,\n            response_id: executionId,\n            status: 'completed',\n            usage: globalStreamState.usage,\n            iterations: iteration,\n            duration_ms: Date.now() - startTime,\n          };\n\n          break;\n        }\n\n        // Execute tools and yield execution events\n        const toolResults: ToolResult[] = [];\n\n        for (const toolCall of toolCalls) {\n          // Parse and validate arguments\n          let parsedArgs: any;\n          try {\n            parsedArgs = JSON.parse(toolCall.function.arguments);\n          } catch (error) {\n            // Invalid JSON - skip this tool\n            yield {\n              type: StreamEventType.TOOL_EXECUTION_DONE,\n              response_id: executionId,\n              tool_call_id: toolCall.id,\n              tool_name: toolCall.function.name,\n              result: null,\n              execution_time_ms: 0,\n              error: `Invalid tool arguments JSON: ${(error as Error).message}`,\n            };\n            continue;\n          }\n\n          // Emit tool execution start\n          yield {\n            type: StreamEventType.TOOL_EXECUTION_START,\n            response_id: executionId,\n            tool_call_id: toolCall.id,\n            tool_name: toolCall.function.name,\n            arguments: parsedArgs,\n          };\n\n          const toolStartTime = Date.now();\n\n          try {\n            // Execute tool with hooks\n            const result = await this.executeToolWithHooks(toolCall, iteration, executionId, config);\n            toolResults.push(result);\n\n            // Emit tool execution done\n            yield {\n              type: StreamEventType.TOOL_EXECUTION_DONE,\n              response_id: executionId,\n              tool_call_id: toolCall.id,\n              tool_name: toolCall.function.name,\n              result: result.content,\n              execution_time_ms: Date.now() - toolStartTime,\n            };\n          } catch (error) {\n            // Emit tool execution error\n            yield {\n              type: StreamEventType.TOOL_EXECUTION_DONE,\n              response_id: executionId,\n              tool_call_id: toolCall.id,\n              tool_name: toolCall.function.name,\n              result: null,\n              execution_time_ms: Date.now() - toolStartTime,\n              error: (error as Error).message,\n            };\n\n            // Check tool failure mode - unified with execute() behavior\n            const failureMode = config.errorHandling?.toolFailureMode || 'continue';\n            if (failureMode === 'fail') {\n              throw error; // Fail-fast mode: stop execution on first tool failure\n            }\n\n            // Continue mode (default): Add error result and continue with remaining tools\n            toolResults.push({\n              tool_use_id: toolCall.id,\n              content: '',\n              error: (error as Error).message,\n              state: ToolCallState.FAILED,\n            });\n          }\n        }\n\n        // Build next input with tool results (streaming constructs messages from StreamState)\n        const assistantMessage: InputItem = {\n          type: 'message',\n          role: MessageRole.ASSISTANT,\n          content: [\n            {\n              type: ContentType.OUTPUT_TEXT,\n              text: iterationStreamState.getAllText(),\n            },\n            ...toolCalls.map((tc) => ({\n              type: ContentType.TOOL_USE as const,\n              id: tc.id,\n              name: tc.function.name,\n              arguments: tc.function.arguments,\n            })),\n          ],\n        };\n\n        const toolResultsMessage: InputItem = {\n          type: 'message',\n          role: MessageRole.USER,\n          content: toolResults.map((tr) => ({\n            type: ContentType.TOOL_RESULT as const,\n            tool_use_id: tr.tool_use_id,\n            content: tr.content,\n            error: tr.error,\n          })),\n        };\n\n        // Update context for next iteration\n        if (useAgentContext && agentContext) {\n          // Add assistant response to AgentContext\n          agentContext.addInputItems([assistantMessage]);\n          // Add tool results to AgentContext\n          agentContext.addToolResults(toolResults);\n        } else {\n          // Use internal context management\n          const newMessages: InputItem[] = [assistantMessage, toolResultsMessage];\n          currentInput = this.appendToContext(currentInput, newMessages);\n\n          // Apply sliding window to prevent unbounded input growth\n          const maxInputMessages = config.limits?.maxInputMessages ?? 50;\n          currentInput = this.applySlidingWindow(currentInput, maxInputMessages);\n        }\n\n        // Yield iteration complete\n        yield {\n          type: StreamEventType.ITERATION_COMPLETE,\n          response_id: executionId,\n          iteration,\n          tool_calls_count: toolCalls.length,\n          has_more_iterations: true,\n        };\n\n        // Store iteration in context\n        if (this.context) {\n          globalStreamState.incrementIteration();\n        }\n\n        // Clear per-iteration resources to prevent memory accumulation\n        iterationStreamState.clear();\n        toolCallsMap.clear();\n      }\n\n      // If loop ended due to max iterations (not early break), emit final completion\n      if (iteration >= config.maxIterations) {\n        yield {\n          type: StreamEventType.RESPONSE_COMPLETE,\n          response_id: executionId,\n          status: 'incomplete', // Incomplete because we hit max iterations\n          usage: globalStreamState.usage,\n          iterations: iteration,\n          duration_ms: Date.now() - startTime,\n        };\n      }\n\n      // Execute after:execution hook\n      await this.hookManager.executeHooks('after:execution', {\n        executionId,\n        response: null as any, // We don't have a complete response in streaming\n        context: this.context,\n        timestamp: new Date(),\n        duration: Date.now() - startTime,\n      }, undefined as any);\n\n      // Emit execution complete\n      this.emit('execution:complete', {\n        executionId,\n        iterations: iteration,\n        duration: Date.now() - startTime,\n        timestamp: new Date(),\n      });\n    } catch (error) {\n      // Emit execution error\n      this.emit('execution:error', {\n        executionId,\n        error: error as Error,\n        timestamp: new Date(),\n      });\n\n      // Yield error event\n      yield {\n        type: StreamEventType.ERROR,\n        response_id: executionId,\n        error: {\n          type: 'execution_error',\n          message: (error as Error).message,\n        },\n        recoverable: false,\n      };\n\n      throw error;\n    } finally {\n      // Always cleanup resources\n      globalStreamState.clear();\n      this.context?.cleanup();\n      this.hookManager.clear();\n    }\n  }\n\n  /**\n   * Stream LLM response with hooks\n   * @private\n   */\n  private async *streamGenerateWithHooks(\n    config: AgenticLoopConfig,\n    input: string | InputItem[],\n    iteration: number,\n    executionId: string,\n    streamState: StreamState,\n    toolCallsMap: Map<string, { name: string; args: string }>\n  ): AsyncIterableIterator<StreamEvent> {\n    const llmStartTime = Date.now();\n\n    // Prepare options\n    let generateOptions: TextGenerateOptions = {\n      model: config.model,\n      input,\n      instructions: config.instructions,\n      tools: config.tools,\n      tool_choice: 'auto',\n      temperature: config.temperature,\n      vendorOptions: config.vendorOptions,\n    };\n\n    // Execute before:llm hook\n    await this.hookManager.executeHooks('before:llm', {\n      executionId,\n      iteration,\n      options: generateOptions,\n      context: this.context!,\n      timestamp: new Date(),\n    }, {});\n\n    // Emit LLM request event\n    this.emit('llm:request', {\n      executionId,\n      iteration,\n      model: config.model,\n      timestamp: new Date(),\n    });\n\n    try {\n      // Stream from provider\n      for await (const event of this.provider.streamGenerate(generateOptions)) {\n        // Update stream state based on event\n        if (event.type === StreamEventType.OUTPUT_TEXT_DELTA) {\n          streamState.accumulateTextDelta(event.item_id, event.delta);\n        } else if (event.type === StreamEventType.TOOL_CALL_START) {\n          streamState.startToolCall(event.tool_call_id, event.tool_name);\n          toolCallsMap.set(event.tool_call_id, { name: event.tool_name, args: '' });\n        } else if (event.type === StreamEventType.TOOL_CALL_ARGUMENTS_DELTA) {\n          streamState.accumulateToolArguments(event.tool_call_id, event.delta);\n          const buffer = toolCallsMap.get(event.tool_call_id);\n          if (buffer) {\n            buffer.args += event.delta;\n          }\n        } else if (isToolCallArgumentsDone(event)) {\n          streamState.completeToolCall(event.tool_call_id);\n          const buffer = toolCallsMap.get(event.tool_call_id);\n          if (buffer) {\n            buffer.args = event.arguments;\n          }\n        } else if (event.type === StreamEventType.RESPONSE_COMPLETE) {\n          streamState.updateUsage(event.usage);\n\n          if (process.env.DEBUG_STREAMING) {\n            console.error('[DEBUG] Captured usage from provider:', event.usage);\n            console.error('[DEBUG] StreamState usage after update:', streamState.usage);\n          }\n\n          // Don't yield provider's RESPONSE_COMPLETE - we'll emit our own at the end\n          continue;\n        }\n\n        // Yield event to caller (except RESPONSE_COMPLETE which we handle ourselves)\n        yield event;\n      }\n\n      // Update metrics\n      if (this.context) {\n        this.context.metrics.llmDuration += Date.now() - llmStartTime;\n        this.context.metrics.inputTokens += streamState.usage.input_tokens;\n        this.context.metrics.outputTokens += streamState.usage.output_tokens;\n        this.context.metrics.totalTokens += streamState.usage.total_tokens;\n      }\n\n      if (process.env.DEBUG_STREAMING) {\n        console.error('[DEBUG] Stream iteration complete, usage:', streamState.usage);\n      }\n\n      // Execute after:llm hook\n      await this.hookManager.executeHooks('after:llm', {\n        executionId,\n        iteration,\n        response: null as any, // Streaming doesn't have complete response yet\n        context: this.context!,\n        timestamp: new Date(),\n        duration: Date.now() - llmStartTime,\n      }, {});\n\n      // Emit LLM response event\n      this.emit('llm:response', {\n        executionId,\n        iteration,\n        timestamp: new Date(),\n      });\n    } catch (error) {\n      this.emit('llm:error', {\n        executionId,\n        iteration,\n        error: error as Error,\n        timestamp: new Date(),\n      });\n      throw error;\n    }\n  }\n\n  /**\n   * Check tool permission before execution\n   * Returns true if approved, throws if blocked/rejected\n   * @private\n   */\n  private async checkToolPermission(\n    toolCall: ToolCall,\n    iteration: number,\n    executionId: string,\n    config: AgenticLoopConfig\n  ): Promise<boolean> {\n    const permissionManager = config.permissionManager;\n    if (!permissionManager) {\n      // No permission manager - skip permission checks (backward compatible)\n      return true;\n    }\n\n    const toolName = toolCall.function.name;\n\n    // Check if blocked first\n    if (permissionManager.isBlocked(toolName)) {\n      this.context?.audit('tool_blocked', { reason: 'Tool is blocklisted' }, undefined, toolName);\n      throw new Error(`Tool \"${toolName}\" is blocked and cannot be executed`);\n    }\n\n    // Check if already approved (allowlisted or session-approved)\n    if (permissionManager.isApproved(toolName)) {\n      return true;\n    }\n\n    // Check if needs approval\n    const checkResult = permissionManager.checkPermission(toolName);\n    if (!checkResult.needsApproval) {\n      // Allowed without approval\n      return true;\n    }\n\n    // Parse arguments for context\n    let parsedArgs: Record<string, unknown> = {};\n    try {\n      parsedArgs = JSON.parse(toolCall.function.arguments);\n    } catch {\n      // Use empty args if parsing fails\n    }\n\n    // Build permission context\n    const context: PermissionCheckContext = {\n      toolCall,\n      parsedArgs,\n      config: checkResult.config || {},\n      executionId,\n      iteration,\n      agentType: config.agentType || 'agent',\n      taskName: config.taskName,\n    };\n\n    // Request approval via permission manager's callback\n    const decision = await permissionManager.requestApproval(context);\n\n    if (decision.approved) {\n      this.context?.audit('tool_permission_approved', {\n        scope: decision.scope,\n        approvedBy: decision.approvedBy,\n      }, undefined, toolName);\n      return true;\n    }\n\n    // Not approved - but might need external approval via hooks\n    // Return false to indicate hooks should be used\n    return false;\n  }\n\n  /**\n   * Execute single tool with hooks\n   * @private\n   */\n  private async executeToolWithHooks(\n    toolCall: ToolCall,\n    iteration: number,\n    executionId: string,\n    config: AgenticLoopConfig\n  ): Promise<ToolResult> {\n    const toolStartTime = Date.now();\n\n    toolCall.state = ToolCallState.EXECUTING;\n    toolCall.startTime = new Date();\n\n    // Execute before:tool hook\n    await this.hookManager.executeHooks('before:tool', {\n      executionId,\n      iteration,\n      toolCall,\n      context: this.context!,\n      timestamp: new Date(),\n    }, {});\n\n    // === NEW: Permission check (runs BEFORE approve:tool hooks) ===\n    // If permission manager exists and has an approval callback, use it first\n    const permissionApproved = await this.checkToolPermission(toolCall, iteration, executionId, config);\n\n    // Execute approve:tool hook if registered AND permission check didn't auto-approve\n    // (hooks provide additional approval logic beyond the permission system)\n    if (!permissionApproved || this.hookManager.hasHooks('approve:tool')) {\n      const approval = await this.hookManager.executeHooks('approve:tool', {\n        executionId,\n        iteration,\n        toolCall,\n        context: this.context!,\n        timestamp: new Date(),\n      }, { approved: permissionApproved }); // Default to permission result\n\n      if (!approval.approved) {\n        throw new Error(`Tool execution rejected: ${approval.reason || 'No reason provided'}`);\n      }\n    }\n\n    // Emit tool start\n    this.emit('tool:start', {\n      executionId,\n      iteration,\n      toolCall,\n      timestamp: new Date(),\n    });\n\n    try {\n      // Execute tool with timeout (configurable)\n      const args = JSON.parse(toolCall.function.arguments);\n      const result = await this.executeWithTimeout(\n        () => this.toolExecutor.execute(toolCall.function.name, args),\n        config.toolTimeout ?? 30000\n      );\n\n      // Create tool result\n      const toolResult: ToolResult = {\n        tool_use_id: toolCall.id,\n        content: result,\n        executionTime: Date.now() - toolStartTime,\n        state: ToolCallState.COMPLETED,\n      };\n\n      toolCall.state = ToolCallState.COMPLETED;\n      toolCall.endTime = new Date();\n\n      // Execute after:tool hook\n      await this.hookManager.executeHooks('after:tool', {\n        executionId,\n        iteration,\n        toolCall,\n        result: toolResult,\n        context: this.context!,\n        timestamp: new Date(),\n      }, {});\n\n      // Update metrics\n      if (this.context) {\n        this.context.metrics.toolCallCount++;\n        this.context.metrics.toolSuccessCount++;\n        this.context.metrics.toolDuration += toolResult.executionTime || 0;\n      }\n\n      // Emit tool complete\n      this.emit('tool:complete', {\n        executionId,\n        iteration,\n        toolCall,\n        result: toolResult,\n        timestamp: new Date(),\n      });\n\n      return toolResult;\n    } catch (error) {\n      toolCall.state = ToolCallState.FAILED;\n      toolCall.endTime = new Date();\n      toolCall.error = (error as Error).message;\n\n      // Update metrics\n      if (this.context) {\n        this.context.metrics.toolFailureCount++;\n      }\n\n      // Emit tool error\n      this.emit('tool:error', {\n        executionId,\n        iteration,\n        toolCall,\n        error: error as Error,\n        timestamp: new Date(),\n      });\n\n      throw error;\n    }\n  }\n\n  /**\n   * Generate LLM response with hooks\n   */\n  private async generateWithHooks(\n    config: AgenticLoopConfig,\n    input: string | InputItem[],\n    iteration: number,\n    executionId: string\n  ): Promise<AgentResponse> {\n    const llmStartTime = Date.now();\n\n    // Prepare options\n    let generateOptions: TextGenerateOptions = {\n      model: config.model,\n      input,\n      instructions: config.instructions,\n      tools: config.tools,\n      tool_choice: 'auto',\n      temperature: config.temperature,\n      vendorOptions: config.vendorOptions,\n    };\n\n    // Execute before:llm hook\n    const beforeLLM = await this.hookManager.executeHooks('before:llm', {\n      executionId,\n      iteration,\n      options: generateOptions,\n      context: this.context!,\n      timestamp: new Date(),\n    }, {});\n\n    // Apply modifications\n    if (beforeLLM.modified) {\n      generateOptions = { ...generateOptions, ...beforeLLM.modified };\n    }\n\n    // Skip if requested\n    if (beforeLLM.skip) {\n      throw new Error('LLM call skipped by hook');\n    }\n\n    // Emit LLM request\n    this.emit('llm:request', {\n      executionId,\n      iteration,\n      options: generateOptions,\n      timestamp: new Date(),\n    });\n\n    try {\n      // Call provider\n      const response = await this.provider.generate(generateOptions);\n\n      const llmDuration = Date.now() - llmStartTime;\n\n      // Update metrics\n      this.context?.updateMetrics({\n        llmDuration: (this.context.metrics.llmDuration || 0) + llmDuration,\n      });\n\n      // Emit LLM response\n      this.emit('llm:response', {\n        executionId,\n        iteration,\n        response,\n        timestamp: new Date(),\n        duration: llmDuration,\n      });\n\n      // Execute after:llm hook\n      await this.hookManager.executeHooks('after:llm', {\n        executionId,\n        iteration,\n        response,\n        context: this.context!,\n        timestamp: new Date(),\n        duration: llmDuration,\n      }, {});\n\n      return response;\n    } catch (error) {\n      // Emit LLM error\n      this.emit('llm:error', {\n        executionId,\n        iteration,\n        error: error as Error,\n        timestamp: new Date(),\n      });\n\n      throw error;\n    }\n  }\n\n  /**\n   * Execute tools with hooks\n   */\n  private async executeToolsWithHooks(\n    toolCalls: ToolCall[],\n    iteration: number,\n    executionId: string,\n    config: AgenticLoopConfig\n  ): Promise<ToolResult[]> {\n    const results: ToolResult[] = [];\n\n    for (const toolCall of toolCalls) {\n      // Add to context\n      this.context?.addToolCall(toolCall);\n\n      // Check pause before each tool\n      await this.checkPause();\n\n      // Execute before:tool hook\n      const beforeTool = await this.hookManager.executeHooks('before:tool', {\n        executionId,\n        iteration,\n        toolCall,\n        context: this.context!,\n        timestamp: new Date(),\n      }, {});\n\n      // Check if tool should be skipped\n      if (beforeTool.skip) {\n        this.context?.audit('tool_skipped', { toolCall }, undefined, toolCall.function.name);\n\n        const mockResult: ToolResult = {\n          tool_use_id: toolCall.id,\n          content: beforeTool.mockResult || '',\n          state: ToolCallState.COMPLETED,\n          executionTime: 0,\n        };\n\n        results.push(mockResult);\n        this.context?.addToolResult(mockResult);\n        continue;\n      }\n\n      // Apply modifications if any\n      if (beforeTool.modified) {\n        Object.assign(toolCall, beforeTool.modified);\n        this.context?.audit('tool_modified', { modifications: beforeTool.modified }, undefined, toolCall.function.name);\n      }\n\n      // === NEW: Permission check (runs BEFORE approve:tool hooks) ===\n      let permissionApproved = true;\n      try {\n        permissionApproved = await this.checkToolPermission(toolCall, iteration, executionId, config);\n      } catch (error) {\n        // Tool is blocked\n        this.context?.audit('tool_blocked', { reason: (error as Error).message }, undefined, toolCall.function.name);\n\n        const blockedResult: ToolResult = {\n          tool_use_id: toolCall.id,\n          content: '',\n          error: (error as Error).message,\n          state: ToolCallState.FAILED,\n        };\n\n        results.push(blockedResult);\n        this.context?.addToolResult(blockedResult);\n        continue;\n      }\n\n      // Execute approve:tool hook (if exists AND permission check didn't auto-approve)\n      if (!permissionApproved || this.hookManager.hasHooks('approve:tool')) {\n        const approval = await this.hookManager.executeHooks('approve:tool', {\n          executionId,\n          iteration,\n          toolCall,\n          context: this.context!,\n          timestamp: new Date(),\n        }, { approved: permissionApproved }); // Default to permission result\n\n        if (!approval.approved) {\n          this.context?.audit('tool_rejected', { reason: approval.reason }, undefined, toolCall.function.name);\n\n          const rejectedResult: ToolResult = {\n            tool_use_id: toolCall.id,\n            content: '',\n            error: `Tool rejected: ${approval.reason || 'Not approved'}`,\n            state: ToolCallState.FAILED,\n          };\n\n          results.push(rejectedResult);\n          this.context?.addToolResult(rejectedResult);\n          continue;\n        }\n\n        this.context?.audit('tool_approved', { reason: approval.reason }, undefined, toolCall.function.name);\n      }\n\n      // Execute tool\n      toolCall.state = ToolCallState.EXECUTING;\n      toolCall.startTime = new Date();\n\n      // Emit tool start\n      this.emit('tool:start', {\n        executionId,\n        iteration,\n        toolCall,\n        timestamp: new Date(),\n      });\n\n      const toolStartTime = Date.now();\n\n      try {\n        // Execute with timeout (configurable)\n        const timeout = config.toolTimeout ?? 30000;\n        const result = await this.executeWithTimeout(\n          () => this.toolExecutor.execute(\n            toolCall.function.name,\n            JSON.parse(toolCall.function.arguments)\n          ),\n          timeout\n        );\n\n        toolCall.state = ToolCallState.COMPLETED;\n        toolCall.endTime = new Date();\n\n        let toolResult: ToolResult = {\n          tool_use_id: toolCall.id,\n          content: result,\n          state: ToolCallState.COMPLETED,\n          executionTime: Date.now() - toolStartTime,\n        };\n\n        // Execute after:tool hook\n        const afterTool = await this.hookManager.executeHooks('after:tool', {\n          executionId,\n          iteration,\n          toolCall,\n          result: toolResult,\n          context: this.context!,\n          timestamp: new Date(),\n        }, {});\n\n        // Apply result modifications\n        if (afterTool.modified) {\n          toolResult = { ...toolResult, ...afterTool.modified };\n        }\n\n        results.push(toolResult);\n        this.context?.addToolResult(toolResult);\n\n        // Update metrics\n        this.context?.updateMetrics({\n          toolDuration: (this.context.metrics.toolDuration || 0) + toolResult.executionTime!,\n        });\n\n        // Emit tool complete\n        this.emit('tool:complete', {\n          executionId,\n          iteration,\n          toolCall,\n          result: toolResult,\n          timestamp: new Date(),\n        });\n      } catch (error) {\n        toolCall.state = ToolCallState.FAILED;\n        toolCall.endTime = new Date();\n        toolCall.error = (error as Error).message;\n\n        const toolResult: ToolResult = {\n          tool_use_id: toolCall.id,\n          content: '',\n          error: (error as Error).message,\n          state: ToolCallState.FAILED,\n        };\n\n        results.push(toolResult);\n        this.context?.addToolResult(toolResult);\n\n        // Record error\n        this.context?.metrics.errors.push({\n          type: 'tool_error',\n          message: (error as Error).message,\n          timestamp: new Date(),\n        });\n\n        // Emit tool error or timeout\n        if (error instanceof ToolTimeoutError) {\n          this.emit('tool:timeout', {\n            executionId,\n            iteration,\n            toolCall,\n            timeout: config.toolTimeout ?? 30000,\n            timestamp: new Date(),\n          });\n        } else {\n          this.emit('tool:error', {\n            executionId,\n            iteration,\n            toolCall,\n            error: error as Error,\n            timestamp: new Date(),\n          });\n        }\n\n        // Check tool failure mode\n        const failureMode = config.errorHandling?.toolFailureMode || 'continue';\n        if (failureMode === 'fail') {\n          // Fail-fast mode: stop execution on first tool failure\n          throw error;\n        }\n\n        // Continue mode (default): Continue executing remaining tools\n        // Error already added to results above\n      }\n    }\n\n    return results;\n  }\n\n  /**\n   * Extract tool calls from response output\n   */\n  private extractToolCalls(output: OutputItem[], toolDefinitions: Tool[]): ToolCall[] {\n    const toolCalls: ToolCall[] = [];\n\n    // Create tool map for quick lookup\n    const toolMap = new Map<string, Tool>();\n    for (const tool of toolDefinitions) {\n      if (tool.type === 'function') {\n        toolMap.set(tool.function.name, tool);\n      }\n    }\n\n    // Extract tool calls from output\n    for (const item of output) {\n      if (item.type === 'message' && item.role === MessageRole.ASSISTANT) {\n        for (const content of item.content) {\n          if (content.type === ContentType.TOOL_USE) {\n            const toolDef = toolMap.get(content.name);\n            const isBlocking = toolDef?.blocking !== false;\n\n            const toolCall: ToolCall = {\n              id: content.id,\n              type: 'function',\n              function: {\n                name: content.name,\n                arguments: content.arguments,\n              },\n              blocking: isBlocking,\n              state: ToolCallState.PENDING,\n            };\n\n            toolCalls.push(toolCall);\n          }\n        }\n      }\n    }\n\n    return toolCalls;\n  }\n\n  /**\n   * Execute function with timeout\n   */\n  private async executeWithTimeout<T>(fn: () => Promise<T>, timeoutMs: number): Promise<T> {\n    return new Promise((resolve, reject) => {\n      const timer = setTimeout(() => {\n        reject(new ToolTimeoutError('tool', timeoutMs));\n      }, timeoutMs);\n\n      fn()\n        .then((result) => {\n          clearTimeout(timer);\n          resolve(result);\n        })\n        .catch((error) => {\n          clearTimeout(timer);\n          reject(error);\n        });\n    });\n  }\n\n  // ============ Shared Helper Methods ============\n  // These methods provide unified logic for both execute() and executeStreaming()\n\n  /**\n   * Build new messages from tool results (assistant response + tool results)\n   */\n  private buildNewMessages(\n    previousOutput: OutputItem[],\n    toolResults: ToolResult[]\n  ): InputItem[] {\n    const messages: InputItem[] = [];\n\n    // Add assistant's previous response as input\n    for (const item of previousOutput) {\n      if (item.type === 'message') {\n        messages.push(item);\n      }\n    }\n\n    // Add tool results as user message\n    const toolResultContents: ToolResultContent[] = toolResults.map((result) => ({\n      type: ContentType.TOOL_RESULT,\n      tool_use_id: result.tool_use_id,\n      content: result.content,\n      error: result.error,\n    }));\n\n    if (toolResultContents.length > 0) {\n      messages.push({\n        type: 'message',\n        role: MessageRole.USER,\n        content: toolResultContents,\n      });\n    }\n\n    return messages;\n  }\n\n  /**\n   * Append new messages to current context, preserving history\n   * Unified logic for both execute() and executeStreaming()\n   */\n  private appendToContext(\n    currentInput: string | InputItem[],\n    newMessages: InputItem[]\n  ): InputItem[] {\n    if (Array.isArray(currentInput)) {\n      return [...currentInput, ...newMessages];\n    }\n\n    // First iteration - convert string input to array format\n    return [\n      {\n        type: 'message' as const,\n        role: MessageRole.USER,\n        content: [{ type: ContentType.INPUT_TEXT, text: currentInput }],\n      },\n      ...newMessages,\n    ];\n  }\n\n  /**\n   * Apply sliding window to prevent unbounded input growth\n   * Preserves system/developer message at the start if present\n   * IMPORTANT: Ensures tool_use and tool_result pairs are never broken\n   */\n  private applySlidingWindow(\n    input: InputItem[],\n    maxMessages: number = 50\n  ): InputItem[] {\n    if (input.length <= maxMessages) {\n      return input;\n    }\n\n    // Check if first message is a developer/system message\n    const firstMessage = input[0];\n    const isSystemMessage = firstMessage?.type === 'message' &&\n      firstMessage.role === MessageRole.DEVELOPER;\n\n    // Calculate how many messages we can keep (excluding system message if present)\n    const maxToKeep = isSystemMessage ? maxMessages - 1 : maxMessages;\n\n    // Find a safe cut point that doesn't break tool call/result pairs\n    const safeCutIndex = this.findSafeToolBoundary(input, input.length - maxToKeep);\n\n    // Slice from safe cut point to end\n    const recentMessages = input.slice(safeCutIndex);\n\n    if (isSystemMessage) {\n      return [firstMessage, ...recentMessages];\n    }\n\n    return recentMessages;\n  }\n\n  /**\n   * Find a safe index to cut the message array without breaking tool call/result pairs\n   * A safe boundary is one where all tool_use IDs have matching tool_result IDs\n   */\n  private findSafeToolBoundary(input: InputItem[], targetIndex: number): number {\n    // Ensure we don't go below 0 or above the array length\n    let cutIndex = Math.max(0, Math.min(targetIndex, input.length - 1));\n\n    // Start from targetIndex and search forward for a safe boundary\n    // A safe boundary is where we don't have orphaned tool calls or results\n    while (cutIndex < input.length - 1) {\n      if (this.isToolBoundarySafe(input, cutIndex)) {\n        return cutIndex;\n      }\n      cutIndex++;\n    }\n\n    // If no safe boundary found going forward, try going backward\n    cutIndex = Math.max(0, targetIndex);\n    while (cutIndex > 0) {\n      if (this.isToolBoundarySafe(input, cutIndex)) {\n        return cutIndex;\n      }\n      cutIndex--;\n    }\n\n    // Fallback: return original target (may cause issues but better than infinite loop)\n    return Math.max(0, targetIndex);\n  }\n\n  /**\n   * Check if cutting at this index would leave tool calls/results balanced\n   * Returns true if all tool_use IDs in the slice have matching tool_result IDs\n   */\n  private isToolBoundarySafe(input: InputItem[], startIndex: number): boolean {\n    const slicedMessages = input.slice(startIndex);\n\n    // Collect all tool_use IDs and tool_result IDs in the slice\n    const toolUseIds = new Set<string>();\n    const toolResultIds = new Set<string>();\n\n    for (const item of slicedMessages) {\n      if (item.type !== 'message') continue;\n\n      for (const content of item.content) {\n        if (content.type === ContentType.TOOL_USE) {\n          toolUseIds.add(content.id);\n        } else if (content.type === ContentType.TOOL_RESULT) {\n          toolResultIds.add(content.tool_use_id);\n        }\n      }\n    }\n\n    // Check 1: Every tool_result must have a matching tool_use\n    // (tool_result without tool_use = API error)\n    for (const resultId of toolResultIds) {\n      if (!toolUseIds.has(resultId)) {\n        return false;\n      }\n    }\n\n    // Check 2: Every tool_use should have a matching tool_result\n    // (tool_use without tool_result = incomplete, but less critical for some APIs)\n    // However, for safety, we enforce this too\n    for (const useId of toolUseIds) {\n      if (!toolResultIds.has(useId)) {\n        // Exception: the LAST assistant message may have tool_use without result yet\n        // This is only safe if it's the very last message (current iteration)\n        const lastMessage = slicedMessages[slicedMessages.length - 1];\n        const isLastMessageWithThisToolUse =\n          lastMessage?.type === 'message' &&\n          lastMessage.role === MessageRole.ASSISTANT &&\n          lastMessage.content.some(\n            (c: any) => c.type === ContentType.TOOL_USE && c.id === useId\n          );\n\n        if (!isLastMessageWithThisToolUse) {\n          return false;\n        }\n      }\n    }\n\n    return true;\n  }\n\n\n  /**\n   * Pause execution (thread-safe with mutex)\n   */\n  pause(reason?: string): void {\n    // Chain onto the mutex to ensure serialized access\n    this.pauseResumeMutex = this.pauseResumeMutex.then(() => {\n      this._doPause(reason);\n    });\n  }\n\n  /**\n   * Internal pause implementation\n   */\n  private _doPause(reason?: string): void {\n    if (this.paused) return;\n\n    this.paused = true;\n    this.pausePromise = new Promise((resolve) => {\n      this.resumeCallback = resolve;\n    });\n\n    if (this.context) {\n      this.context.paused = true;\n      this.context.pauseReason = reason;\n      this.context.audit('execution_paused', { reason });\n    }\n\n    this.emit('execution:paused', {\n      executionId: this.context?.executionId || 'unknown',\n      reason: reason || 'Manual pause',\n      timestamp: new Date(),\n    });\n  }\n\n  /**\n   * Resume execution (thread-safe with mutex)\n   */\n  resume(): void {\n    // Chain onto the mutex to ensure serialized access\n    this.pauseResumeMutex = this.pauseResumeMutex.then(() => {\n      this._doResume();\n    });\n  }\n\n  /**\n   * Internal resume implementation\n   */\n  private _doResume(): void {\n    if (!this.paused) return;\n\n    this.paused = false;\n\n    if (this.context) {\n      this.context.paused = false;\n      this.context.pauseReason = undefined;\n      this.context.audit('execution_resumed', {});\n    }\n\n    if (this.resumeCallback) {\n      this.resumeCallback();\n      this.resumeCallback = null;\n    }\n\n    this.pausePromise = null;\n\n    this.emit('execution:resumed', {\n      executionId: this.context?.executionId || 'unknown',\n      timestamp: new Date(),\n    });\n  }\n\n  /**\n   * Cancel execution\n   */\n  cancel(reason?: string): void {\n    this.cancelled = true;\n\n    if (this.context) {\n      this.context.cancelled = true;\n      this.context.cancelReason = reason;\n    }\n\n    // Resume if paused (to allow cancellation to proceed)\n    // Use internal method directly to bypass mutex for immediate cancellation\n    if (this.paused) {\n      this._doResume();\n    }\n\n    this.emit('execution:cancelled', {\n      executionId: this.context?.executionId || 'unknown',\n      reason: reason || 'Manual cancellation',\n      timestamp: new Date(),\n    });\n  }\n\n  /**\n   * Check if paused and wait\n   */\n  private async checkPause(): Promise<void> {\n    if (this.paused && this.pausePromise) {\n      await this.pausePromise;\n    }\n  }\n\n  /**\n   * Get current execution context\n   */\n  getContext(): ExecutionContext | null {\n    return this.context;\n  }\n\n  /**\n   * Check if currently executing\n   */\n  isRunning(): boolean {\n    return this.context !== null && !this.cancelled;\n  }\n\n  /**\n   * Check if paused\n   */\n  isPaused(): boolean {\n    return this.paused;\n  }\n\n  /**\n   * Check if cancelled\n   */\n  isCancelled(): boolean {\n    return this.cancelled;\n  }\n}\n","/**\n * Interface for objects that manage resources and need explicit cleanup.\n *\n * Implementing classes should release all resources (event listeners, timers,\n * connections, etc.) when destroy() is called. After destruction, the instance\n * should not be used.\n */\n\nexport interface IDisposable {\n  /**\n   * Releases all resources held by this instance.\n   *\n   * After calling destroy():\n   * - All event listeners should be removed\n   * - All timers/intervals should be cleared\n   * - All internal state should be cleaned up\n   * - The instance should not be reused\n   *\n   * Multiple calls to destroy() should be safe (idempotent).\n   */\n  destroy(): void;\n\n  /**\n   * Returns true if destroy() has been called.\n   * Methods should check this before performing operations.\n   */\n  readonly isDestroyed: boolean;\n}\n\n/**\n * Async version of IDisposable for resources requiring async cleanup.\n */\nexport interface IAsyncDisposable {\n  /**\n   * Asynchronously releases all resources held by this instance.\n   */\n  destroy(): Promise<void>;\n\n  /**\n   * Returns true if destroy() has been called.\n   */\n  readonly isDestroyed: boolean;\n}\n\n/**\n * Helper to check if an object is destroyed and throw if so.\n * @param obj - The disposable object to check\n * @param operation - Name of the operation being attempted\n */\nexport function assertNotDestroyed(obj: IDisposable | IAsyncDisposable, operation: string): void {\n  if (obj.isDestroyed) {\n    throw new Error(`Cannot ${operation}: instance has been destroyed`);\n  }\n}\n","/**\n * Agent - AI assistant bound to a Connector\n *\n * This is the main public API for creating and using agents.\n * Extends BaseAgent for shared functionality.\n */\n\nimport { BaseAgent, BaseAgentConfig, BaseSessionConfig } from './BaseAgent.js';\nimport { createProvider } from './createProvider.js';\nimport { AgenticLoop, AgenticLoopConfig } from '../capabilities/agents/AgenticLoop.js';\nimport { ExecutionContext, HistoryMode } from '../capabilities/agents/ExecutionContext.js';\nimport { InputItem } from '../domain/entities/Message.js';\nimport { AgentResponse } from '../domain/entities/Response.js';\nimport { StreamEvent } from '../domain/entities/StreamEvent.js';\nimport { HookConfig } from '../capabilities/agents/types/HookTypes.js';\nimport { AgenticLoopEvents } from '../capabilities/agents/types/EventTypes.js';\nimport { IDisposable, assertNotDestroyed } from '../domain/interfaces/IDisposable.js';\nimport { ITextProvider } from '../domain/interfaces/ITextProvider.js';\nimport type { IContextStorage } from '../domain/interfaces/IContextStorage.js';\nimport { metrics } from '../infrastructure/observability/Metrics.js';\nimport { AgentContext } from './AgentContext.js';\nimport type { AgentContextConfig, SerializedAgentContextState } from './AgentContext.js';\nimport type {\n  IAgentDefinitionStorage,\n  StoredAgentDefinition,\n  AgentDefinitionMetadata,\n} from '../domain/interfaces/IAgentDefinitionStorage.js';\n\n/**\n * Session configuration for Agent (same as BaseSessionConfig)\n */\nexport type AgentSessionConfig = BaseSessionConfig;\n\n/**\n * Agent configuration - extends BaseAgentConfig with Agent-specific options\n */\nexport interface AgentConfig extends BaseAgentConfig {\n  /** System instructions for the agent */\n  instructions?: string;\n\n  /** Temperature for generation */\n  temperature?: number;\n\n  /** Maximum iterations for tool calling loop */\n  maxIterations?: number;\n\n  /** Vendor-specific options (e.g., Google's thinkingLevel: 'low' | 'high') */\n  vendorOptions?: Record<string, any>;\n\n  /**\n   * Optional unified context management.\n   * When provided (as AgentContext instance or config), Agent will:\n   * - Track conversation history\n   * - Cache tool results (if enabled)\n   * - Provide unified memory access\n   * - Support session persistence via context\n   *\n   * Pass an AgentContext instance or AgentContextConfig to enable.\n   */\n  context?: AgentContext | AgentContextConfig;\n\n  // Enterprise features\n  hooks?: HookConfig;\n  historyMode?: HistoryMode;\n  limits?: {\n    maxExecutionTime?: number;\n    maxToolCalls?: number;\n    maxContextSize?: number;\n    maxInputMessages?: number;\n  };\n  errorHandling?: {\n    hookFailureMode?: 'fail' | 'warn' | 'ignore';\n    toolFailureMode?: 'fail' | 'continue';\n    maxConsecutiveErrors?: number;\n  };\n}\n\n/**\n * Agent class - represents an AI assistant with tool calling capabilities\n *\n * Extends BaseAgent to inherit:\n * - Connector resolution\n * - Tool manager initialization\n * - Permission manager initialization\n * - Session management\n * - Lifecycle/cleanup\n */\nexport class Agent extends BaseAgent<AgentConfig, AgenticLoopEvents> implements IDisposable {\n  // ===== Agent-specific State =====\n  private provider: ITextProvider;\n  private agenticLoop: AgenticLoop;\n  private boundListeners: Map<keyof AgenticLoopEvents, (...args: any[]) => void> = new Map();\n\n  // ===== Static Factory =====\n\n  /**\n   * Create a new agent\n   *\n   * @example\n   * ```typescript\n   * const agent = Agent.create({\n   *   connector: 'openai',  // or Connector instance\n   *   model: 'gpt-4',\n   *   instructions: 'You are a helpful assistant',\n   *   tools: [myTool]\n   * });\n   * ```\n   */\n  static create(config: AgentConfig): Agent {\n    return new Agent(config);\n  }\n\n  /**\n   * Resume an agent from a saved session\n   *\n   * @example\n   * ```typescript\n   * const agent = await Agent.resume('session-123', {\n   *   connector: 'openai',\n   *   model: 'gpt-4',\n   *   session: { storage: myStorage }\n   * });\n   * ```\n   */\n  static async resume(\n    sessionId: string,\n    config: Omit<AgentConfig, 'session'> & { session: { storage: IContextStorage } }\n  ): Promise<Agent> {\n    const agent = new Agent({\n      ...config,\n      session: {\n        ...config.session,\n        id: sessionId,\n      },\n    });\n\n    // Wait for session to load\n    await agent.ensureSessionLoaded();\n\n    return agent;\n  }\n\n  /**\n   * Create an agent from a stored definition\n   *\n   * Loads agent configuration from storage and creates a new Agent instance.\n   * The connector must be registered at runtime before calling this method.\n   *\n   * @param agentId - Agent identifier to load\n   * @param storage - Storage backend to load from\n   * @param overrides - Optional config overrides\n   * @returns Agent instance, or null if not found\n   *\n   * @example\n   * ```typescript\n   * // First, register the connector\n   * Connector.create({\n   *   name: 'openai',\n   *   vendor: Vendor.OpenAI,\n   *   auth: { type: 'api_key', apiKey: process.env.OPENAI_API_KEY }\n   * });\n   *\n   * // Then load the agent from storage\n   * const storage = new FileAgentDefinitionStorage();\n   * const agent = await Agent.fromStorage('my-assistant', storage);\n   *\n   * if (agent) {\n   *   const response = await agent.run('Hello!');\n   * }\n   * ```\n   */\n  static async fromStorage(\n    agentId: string,\n    storage: IAgentDefinitionStorage,\n    overrides?: Partial<AgentConfig>\n  ): Promise<Agent | null> {\n    const definition = await storage.load(agentId);\n    if (!definition) {\n      return null;\n    }\n\n    // Build config from definition\n    const config: AgentConfig = {\n      connector: definition.connector.name,\n      model: definition.connector.model,\n      instructions: definition.systemPrompt,\n      context: {\n        agentId: definition.agentId,\n        systemPrompt: definition.systemPrompt,\n        instructions: definition.instructions,\n        features: definition.features,\n      },\n      ...definition.typeConfig,\n      ...overrides,\n    };\n\n    return new Agent(config);\n  }\n\n  // ===== Constructor =====\n\n  private constructor(config: AgentConfig) {\n    super(config, 'Agent');\n\n    this._logger.debug({ config }, 'Agent created');\n    metrics.increment('agent.created', 1, {\n      model: this.model,\n      connector: this.connector.name,\n    });\n\n    // Create provider from connector\n    this.provider = createProvider(this.connector);\n\n    // Set system prompt on inherited AgentContext if instructions provided\n    if (config.instructions) {\n      this._agentContext.systemPrompt = config.instructions;\n    }\n    this._logger.debug('Using inherited AgentContext from BaseAgent');\n\n    // Sync tool permission configs from ToolManager (via AgentContext) to PermissionManager\n    this._agentContext.tools.on('tool:registered', ({ name }) => {\n      const permission = this._agentContext.tools.getPermission(name);\n      if (permission) {\n        this._permissionManager.setToolConfig(name, permission);\n      }\n    });\n\n    // Create agentic loop - ToolManager implements IToolExecutor\n    // Use AgentContext.tools as the single source of truth\n    this.agenticLoop = new AgenticLoop(\n      this.provider,\n      this._agentContext.tools,\n      config.hooks,\n      config.errorHandling\n    );\n\n    // Forward events from AgenticLoop\n    this.setupEventForwarding();\n\n    // Initialize session (from BaseAgent)\n    this.initializeSession(config.session);\n  }\n\n  // ===== Abstract Method Implementations =====\n\n  protected getAgentType(): 'agent' | 'task-agent' | 'universal-agent' {\n    return 'agent';\n  }\n\n  // ===== Context Access =====\n\n  // Note: `context` getter is inherited from BaseAgent (returns _agentContext)\n\n  /**\n   * Check if context management is enabled.\n   * Always returns true since AgentContext is always created by BaseAgent.\n   */\n  hasContext(): boolean {\n    return true;\n  }\n\n  /**\n   * Get context state for session persistence.\n   */\n  async getContextState(): Promise<SerializedAgentContextState> {\n    return this._agentContext.getState();\n  }\n\n  /**\n   * Restore context from saved state.\n   */\n  async restoreContextState(state: SerializedAgentContextState): Promise<void> {\n    await this._agentContext.restoreState(state);\n  }\n\n  // ===== Main API =====\n\n  /**\n   * Run the agent with input\n   */\n  async run(input: string | InputItem[]): Promise<AgentResponse> {\n    assertNotDestroyed(this, 'run agent');\n\n    // Ensure any pending session load is complete\n    await this.ensureSessionLoaded();\n\n    const inputPreview = typeof input === 'string'\n      ? input.substring(0, 100)\n      : `${input.length} messages`;\n\n    this._logger.info({\n      inputPreview,\n      toolCount: this._config.tools?.length || 0,\n    }, 'Agent run started');\n\n    metrics.increment('agent.run.started', 1, {\n      model: this.model,\n      connector: this.connector.name,\n    });\n\n    const startTime = Date.now();\n\n    // Set current input for task type detection\n    const userContent = typeof input === 'string'\n      ? input\n      : input.map(i => JSON.stringify(i)).join('\\n');\n    this._agentContext.setCurrentInput(userContent);\n\n    try {\n      // Get enabled tool definitions (respects enable/disable)\n      const tools = this.getEnabledToolDefinitions();\n\n      const loopConfig: AgenticLoopConfig = {\n        model: this.model,\n        input,\n        instructions: this._config.instructions,\n        tools,\n        temperature: this._config.temperature,\n        maxIterations: this._config.maxIterations || 10,\n        vendorOptions: this._config.vendorOptions,\n        hooks: this._config.hooks,\n        historyMode: this._config.historyMode,\n        limits: this._config.limits,\n        errorHandling: this._config.errorHandling,\n        permissionManager: this._permissionManager,\n        agentType: 'agent',\n        // Pass AgentContext for unified context management\n        // AgenticLoop will use prepareConversation() and add messages automatically\n        agentContext: this._agentContext,\n      };\n\n      const response = await this.agenticLoop.execute(loopConfig);\n\n      const duration = Date.now() - startTime;\n\n      // Note: Assistant response is already tracked by AgenticLoop via agentContext\n\n      this._logger.info({ duration }, 'Agent run completed');\n\n      metrics.timing('agent.run.duration', duration, {\n        model: this.model,\n        connector: this.connector.name,\n      });\n\n      metrics.increment('agent.run.completed', 1, {\n        model: this.model,\n        connector: this.connector.name,\n        status: 'success',\n      });\n\n      return response;\n    } catch (error) {\n      const duration = Date.now() - startTime;\n\n      this._logger.error({\n        error: (error as Error).message,\n        duration,\n      }, 'Agent run failed');\n\n      metrics.increment('agent.run.completed', 1, {\n        model: this.model,\n        connector: this.connector.name,\n        status: 'error',\n      });\n\n      throw error;\n    }\n  }\n\n  /**\n   * Stream response from the agent\n   */\n  async *stream(input: string | InputItem[]): AsyncIterableIterator<StreamEvent> {\n    assertNotDestroyed(this, 'stream from agent');\n\n    // Ensure any pending session load is complete\n    await this.ensureSessionLoaded();\n\n    const inputPreview = typeof input === 'string'\n      ? input.substring(0, 100)\n      : `${input.length} messages`;\n\n    this._logger.info({\n      inputPreview,\n      toolCount: this._config.tools?.length || 0,\n    }, 'Agent stream started');\n\n    metrics.increment('agent.stream.started', 1, {\n      model: this.model,\n      connector: this.connector.name,\n    });\n\n    const startTime = Date.now();\n\n    // Set current input for task type detection\n    const userContent = typeof input === 'string'\n      ? input\n      : input.map(i => JSON.stringify(i)).join('\\n');\n    this._agentContext.setCurrentInput(userContent);\n\n    try {\n      // Get enabled tool definitions (respects enable/disable)\n      const tools = this.getEnabledToolDefinitions();\n\n      const loopConfig: AgenticLoopConfig = {\n        model: this.model,\n        input,\n        instructions: this._config.instructions,\n        tools,\n        temperature: this._config.temperature,\n        maxIterations: this._config.maxIterations || 10,\n        vendorOptions: this._config.vendorOptions,\n        hooks: this._config.hooks,\n        historyMode: this._config.historyMode,\n        limits: this._config.limits,\n        errorHandling: this._config.errorHandling,\n        permissionManager: this._permissionManager,\n        agentType: 'agent',\n        // Pass AgentContext for unified context management\n        // AgenticLoop will use prepareConversation() and add messages automatically\n        agentContext: this._agentContext,\n      };\n\n      for await (const event of this.agenticLoop.executeStreaming(loopConfig)) {\n        yield event;\n      }\n\n      // Note: Messages are already tracked by AgenticLoop via agentContext\n\n      const duration = Date.now() - startTime;\n\n      this._logger.info({ duration }, 'Agent stream completed');\n\n      metrics.timing('agent.stream.duration', duration, {\n        model: this.model,\n        connector: this.connector.name,\n      });\n\n      metrics.increment('agent.stream.completed', 1, {\n        model: this.model,\n        connector: this.connector.name,\n        status: 'success',\n      });\n    } catch (error) {\n      const duration = Date.now() - startTime;\n\n      this._logger.error({\n        error: (error as Error).message,\n        duration,\n      }, 'Agent stream failed');\n\n      metrics.increment('agent.stream.completed', 1, {\n        model: this.model,\n        connector: this.connector.name,\n        status: 'error',\n      });\n\n      throw error;\n    }\n  }\n\n  // ===== Tool Management =====\n  // Note: addTool, removeTool, listTools, setTools are inherited from BaseAgent\n\n  // ===== Permission Convenience Methods =====\n\n  /**\n   * Approve a tool for the current session.\n   */\n  approveToolForSession(toolName: string): void {\n    this._permissionManager.approveForSession(toolName);\n  }\n\n  /**\n   * Revoke a tool's session approval.\n   */\n  revokeToolApproval(toolName: string): void {\n    this._permissionManager.revoke(toolName);\n  }\n\n  /**\n   * Get list of tools that have been approved for this session.\n   */\n  getApprovedTools(): string[] {\n    return this._permissionManager.getApprovedTools();\n  }\n\n  /**\n   * Check if a tool needs approval before execution.\n   */\n  toolNeedsApproval(toolName: string): boolean {\n    return this._permissionManager.checkPermission(toolName).needsApproval;\n  }\n\n  /**\n   * Check if a tool is blocked (cannot execute at all).\n   */\n  toolIsBlocked(toolName: string): boolean {\n    return this._permissionManager.isBlocked(toolName);\n  }\n\n  /**\n   * Add a tool to the allowlist (always allowed, no approval needed).\n   */\n  allowlistTool(toolName: string): void {\n    this._permissionManager.allowlistAdd(toolName);\n  }\n\n  /**\n   * Add a tool to the blocklist (always blocked, cannot execute).\n   */\n  blocklistTool(toolName: string): void {\n    this._permissionManager.blocklistAdd(toolName);\n  }\n\n  // ===== Configuration Methods =====\n\n  /**\n   * Change the model\n   */\n  setModel(model: string): void {\n    (this as { model: string }).model = model;\n    this._config.model = model;\n  }\n\n  /**\n   * Get current temperature\n   */\n  getTemperature(): number | undefined {\n    return this._config.temperature;\n  }\n\n  /**\n   * Change the temperature\n   */\n  setTemperature(temperature: number): void {\n    this._config.temperature = temperature;\n  }\n\n  // ===== Definition Persistence =====\n\n  /**\n   * Save the agent's configuration to storage for later instantiation.\n   *\n   * This saves the agent's configuration (model, system prompt, features, etc.)\n   * to persistent storage. The agent can later be recreated using Agent.fromStorage().\n   *\n   * @param storage - Storage backend to save to\n   * @param metadata - Optional metadata to attach\n   *\n   * @example\n   * ```typescript\n   * const agent = Agent.create({\n   *   connector: 'openai',\n   *   model: 'gpt-4',\n   *   instructions: 'You are a helpful assistant',\n   *   context: { agentId: 'my-assistant' }\n   * });\n   *\n   * // Save definition for later use\n   * const storage = new FileAgentDefinitionStorage();\n   * await agent.saveDefinition(storage, {\n   *   description: 'My helpful assistant',\n   *   tags: ['personal', 'general']\n   * });\n   *\n   * // Later, recreate the agent\n   * const restoredAgent = await Agent.fromStorage('my-assistant', storage);\n   * ```\n   */\n  async saveDefinition(\n    storage: IAgentDefinitionStorage,\n    metadata?: AgentDefinitionMetadata\n  ): Promise<void> {\n    const now = new Date().toISOString();\n\n    const definition: StoredAgentDefinition = {\n      version: 1,\n      agentId: this._agentContext.agentId,\n      name: metadata?.description ? this._agentContext.agentId : this._agentContext.agentId,\n      agentType: 'agent',\n      createdAt: now,\n      updatedAt: now,\n      connector: {\n        name: this.connector.name,\n        model: this.model,\n      },\n      systemPrompt: this._agentContext.systemPrompt,\n      instructions: this._config.instructions,\n      features: this._agentContext.features,\n      metadata,\n      typeConfig: {\n        temperature: this._config.temperature,\n        maxIterations: this._config.maxIterations,\n        vendorOptions: this._config.vendorOptions,\n      },\n    };\n\n    await storage.save(definition);\n  }\n\n  // ===== Control Methods =====\n\n  pause(reason?: string): void {\n    this.agenticLoop.pause(reason);\n  }\n\n  resume(): void {\n    this.agenticLoop.resume();\n  }\n\n  cancel(reason?: string): void {\n    this.agenticLoop.cancel(reason);\n  }\n\n  // ===== Introspection =====\n\n  getContext(): ExecutionContext | null {\n    return this.agenticLoop.getContext();\n  }\n\n  getMetrics() {\n    return this.agenticLoop.getContext()?.metrics || null;\n  }\n\n  getSummary() {\n    return this.agenticLoop.getContext()?.getSummary() || null;\n  }\n\n  getAuditTrail() {\n    return this.agenticLoop.getContext()?.getAuditTrail() || [];\n  }\n\n  /**\n   * Get circuit breaker metrics for LLM provider\n   */\n  getProviderCircuitBreakerMetrics() {\n    if ('getCircuitBreakerMetrics' in this.provider) {\n      return (this.provider as any).getCircuitBreakerMetrics();\n    }\n    return null;\n  }\n\n  /**\n   * Get circuit breaker states for all tools\n   */\n  getToolCircuitBreakerStates() {\n    return this._agentContext.tools.getCircuitBreakerStates();\n  }\n\n  /**\n   * Get circuit breaker metrics for a specific tool\n   */\n  getToolCircuitBreakerMetrics(toolName: string) {\n    return this._agentContext.tools.getToolCircuitBreakerMetrics(toolName);\n  }\n\n  /**\n   * Manually reset a tool's circuit breaker\n   */\n  resetToolCircuitBreaker(toolName: string): void {\n    this._agentContext.tools.resetToolCircuitBreaker(toolName);\n    this._logger.info({ toolName }, 'Tool circuit breaker reset by user');\n  }\n\n  isRunning(): boolean {\n    return this.agenticLoop.isRunning();\n  }\n\n  isPaused(): boolean {\n    return this.agenticLoop.isPaused();\n  }\n\n  isCancelled(): boolean {\n    return this.agenticLoop.isCancelled();\n  }\n\n  // ===== Cleanup =====\n\n  destroy(): void {\n    if (this._isDestroyed) {\n      return;\n    }\n\n    this._logger.debug('Agent destroy started');\n\n    // Cancel any ongoing execution\n    try {\n      this.agenticLoop.cancel('Agent destroyed');\n    } catch {\n      // Ignore errors during cancel\n    }\n\n    // Remove event listeners from AgenticLoop\n    for (const [eventName, handler] of this.boundListeners) {\n      this.agenticLoop.off(eventName, handler);\n    }\n    this.boundListeners.clear();\n\n    // Note: AgentContext cleanup is handled by baseDestroy() in BaseAgent\n\n    // Run cleanup callbacks\n    for (const callback of this._cleanupCallbacks) {\n      try {\n        callback();\n      } catch (error) {\n        this._logger.error({ error: (error as Error).message }, 'Cleanup callback error');\n      }\n    }\n    this._cleanupCallbacks = [];\n\n    // Call base destroy (handles session, tool manager, permission manager cleanup)\n    this.baseDestroy();\n\n    metrics.increment('agent.destroyed', 1, {\n      model: this.model,\n      connector: this.connector.name,\n    });\n\n    this._logger.debug('Agent destroyed');\n  }\n\n  // ===== Private =====\n\n  private setupEventForwarding(): void {\n    const eventNames: Array<keyof AgenticLoopEvents> = [\n      'execution:start',\n      'execution:complete',\n      'execution:error',\n      'execution:paused',\n      'execution:resumed',\n      'execution:cancelled',\n      'iteration:start',\n      'iteration:complete',\n      'llm:request',\n      'llm:response',\n      'llm:error',\n      'tool:detected',\n      'tool:start',\n      'tool:complete',\n      'tool:error',\n      'tool:timeout',\n      'hook:error',\n    ];\n\n    const registered: Array<[keyof AgenticLoopEvents, (...args: any[]) => void]> = [];\n\n    try {\n      for (const eventName of eventNames) {\n        const handler = (data: any) => {\n          if (!this._isDestroyed) {\n            this.emit(eventName, data);\n          }\n        };\n        this.agenticLoop.on(eventName, handler);\n        registered.push([eventName, handler]);\n        this.boundListeners.set(eventName, handler);\n      }\n    } catch (error) {\n      // Cleanup any registered listeners on failure\n      for (const [eventName, handler] of registered) {\n        this.agenticLoop.off(eventName, handler);\n      }\n      throw error;\n    }\n  }\n}\n","/**\n * AgentContextTools - Feature-aware tool factory for AgentContext\n *\n * @deprecated Since v0.3.0 - Tools are now auto-registered by AgentContext constructor.\n * All agent types (Agent, TaskAgent, UniversalAgent) automatically get feature-aware\n * tools based on enabled features. Manual registration is no longer needed.\n *\n * This file is kept for backwards compatibility only. If you were calling\n * getAgentContextTools() manually, you can safely remove that code.\n *\n * Consolidated tools (Phase 1):\n * - Always: context_stats (unified introspection)\n * - memory: memory_store, memory_retrieve, memory_delete, memory_query, memory_cleanup_raw\n * - inContextMemory: context_set, context_delete, context_list\n * - persistentInstructions: instructions_set, instructions_append, instructions_get, instructions_clear\n */\n\nimport type { ToolFunction } from '../domain/entities/Tool.js';\nimport type { AgentContext } from './AgentContext.js';\n\n// Import individual tool creators (consolidated)\nimport {\n  createMemoryStoreTool,\n  createMemoryRetrieveTool,\n  createMemoryDeleteTool,\n  createMemoryQueryTool,\n  createMemoryCleanupRawTool,\n} from '../capabilities/taskAgent/memoryTools.js';\n\nimport {\n  createContextStatsTool,\n} from '../capabilities/taskAgent/contextTools.js';\n\n/**\n * Get tools based on enabled features in AgentContext\n *\n * @deprecated Tools are now auto-registered by AgentContext constructor.\n * You no longer need to call this function manually. All agent types\n * automatically get the correct tools based on enabled features.\n *\n * @param context - The AgentContext to get tools for\n * @returns Array of tools based on enabled features\n */\nexport function getAgentContextTools(context: AgentContext): ToolFunction[] {\n  const tools: ToolFunction[] = [];\n\n  // Always available (consolidated introspection)\n  tools.push(createContextStatsTool());\n\n  // Memory feature includes consolidated memory tools\n  if (context.isFeatureEnabled('memory')) {\n    tools.push(createMemoryStoreTool());\n    tools.push(createMemoryRetrieveTool());\n    tools.push(createMemoryDeleteTool());\n    tools.push(createMemoryQueryTool());\n    tools.push(createMemoryCleanupRawTool());\n  }\n\n  // Note: InContextMemory tools (context_set, context_delete, context_list)\n  // and PersistentInstructions tools are handled directly in AgentContext constructor\n\n  return tools;\n}\n\n/**\n * Get only the basic introspection tools (always available)\n */\nexport function getBasicIntrospectionTools(): ToolFunction[] {\n  return [createContextStatsTool()];\n}\n\n/**\n * Get only memory-related tools (requires memory feature)\n */\nexport function getMemoryTools(): ToolFunction[] {\n  return [\n    createMemoryStoreTool(),\n    createMemoryRetrieveTool(),\n    createMemoryDeleteTool(),\n    createMemoryQueryTool(),\n    createMemoryCleanupRawTool(),\n  ];\n}\n","/**\n * Configuration Loader\n *\n * Loads and parses oneringai.config.json with environment variable interpolation.\n */\n\nimport { promises as fs } from 'fs';\nimport { resolve, join } from 'path';\nimport { homedir } from 'os';\nimport type { OneRingAIConfig } from '../../domain/entities/MCPConfig.js';\n\n/**\n * Configuration loader class\n */\nexport class ConfigLoader {\n  private static DEFAULT_PATHS = [\n    './oneringai.config.json',\n    join(homedir(), '.oneringai', 'config.json'),\n  ];\n\n  /**\n   * Load configuration from file\n   */\n  static async load(path?: string): Promise<OneRingAIConfig> {\n    const configPath = path ? resolve(path) : await this.findConfig();\n\n    if (!configPath) {\n      throw new Error('Configuration file not found. Searched: ' + this.DEFAULT_PATHS.join(', '));\n    }\n\n    try {\n      const content = await fs.readFile(configPath, 'utf-8');\n      let config: OneRingAIConfig = JSON.parse(content);\n\n      // Interpolate environment variables\n      config = this.interpolateEnvVars(config);\n\n      // Validate configuration\n      this.validate(config);\n\n      return config;\n    } catch (error) {\n      if (error instanceof SyntaxError) {\n        throw new Error(`Invalid JSON in configuration file '${configPath}': ${error.message}`);\n      }\n      throw error;\n    }\n  }\n\n  /**\n   * Load configuration synchronously\n   */\n  static loadSync(path?: string): OneRingAIConfig {\n    const configPath = path ? resolve(path) : this.findConfigSync();\n\n    if (!configPath) {\n      throw new Error('Configuration file not found. Searched: ' + this.DEFAULT_PATHS.join(', '));\n    }\n\n    try {\n      const fs = require('fs');\n      const content = fs.readFileSync(configPath, 'utf-8');\n      let config: OneRingAIConfig = JSON.parse(content);\n\n      // Interpolate environment variables\n      config = this.interpolateEnvVars(config);\n\n      // Validate configuration\n      this.validate(config);\n\n      return config;\n    } catch (error) {\n      if (error instanceof SyntaxError) {\n        throw new Error(`Invalid JSON in configuration file '${configPath}': ${error.message}`);\n      }\n      throw error;\n    }\n  }\n\n  /**\n   * Find configuration file in default paths\n   */\n  private static async findConfig(): Promise<string | null> {\n    for (const path of this.DEFAULT_PATHS) {\n      try {\n        await fs.access(resolve(path));\n        return resolve(path);\n      } catch {\n        // Continue searching\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Find configuration file synchronously\n   */\n  private static findConfigSync(): string | null {\n    const fs = require('fs');\n    for (const path of this.DEFAULT_PATHS) {\n      try {\n        fs.accessSync(resolve(path));\n        return resolve(path);\n      } catch {\n        // Continue searching\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Interpolate environment variables in configuration\n   * Replaces ${ENV_VAR} with process.env.ENV_VAR\n   */\n  private static interpolateEnvVars(config: OneRingAIConfig): OneRingAIConfig {\n    const jsonString = JSON.stringify(config);\n    const interpolated = jsonString.replace(/\\$\\{([^}]+)\\}/g, (match, envVar) => {\n      const value = process.env[envVar];\n      if (value === undefined) {\n        // Don't fail on missing env vars, just keep the placeholder\n        console.warn(`Warning: Environment variable '${envVar}' is not set`);\n        return match;\n      }\n      return value;\n    });\n\n    return JSON.parse(interpolated);\n  }\n\n  /**\n   * Basic validation of configuration structure\n   */\n  private static validate(config: OneRingAIConfig): void {\n    if (typeof config !== 'object' || config === null) {\n      throw new Error('Configuration must be an object');\n    }\n\n    // Validate MCP section if present\n    if (config.mcp) {\n      if (!Array.isArray(config.mcp.servers)) {\n        throw new Error('MCP configuration must have a \"servers\" array');\n      }\n\n      for (const server of config.mcp.servers) {\n        if (!server.name) {\n          throw new Error('Each MCP server must have a \"name\" field');\n        }\n        if (!server.transport) {\n          throw new Error(`MCP server '${server.name}' must have a \"transport\" field`);\n        }\n        if (!server.transportConfig) {\n          throw new Error(`MCP server '${server.name}' must have a \"transportConfig\" field`);\n        }\n      }\n    }\n  }\n}\n","/**\n * MCP Error Classes\n *\n * Error hierarchy for MCP-related failures.\n */\n\n/**\n * Base error for all MCP-related errors\n */\nexport class MCPError extends Error {\n  constructor(\n    message: string,\n    public readonly serverName?: string,\n    public readonly cause?: Error\n  ) {\n    super(message);\n    this.name = 'MCPError';\n    if (cause) {\n      this.stack = `${this.stack}\\nCaused by: ${cause.stack}`;\n    }\n  }\n}\n\n/**\n * Connection-related errors (failed to connect, disconnected unexpectedly)\n */\nexport class MCPConnectionError extends MCPError {\n  constructor(message: string, serverName?: string, cause?: Error) {\n    super(message, serverName, cause);\n    this.name = 'MCPConnectionError';\n  }\n}\n\n/**\n * Timeout errors (request timeout, connection timeout)\n */\nexport class MCPTimeoutError extends MCPError {\n  constructor(\n    message: string,\n    public readonly timeoutMs: number,\n    serverName?: string,\n    cause?: Error\n  ) {\n    super(message, serverName, cause);\n    this.name = 'MCPTimeoutError';\n  }\n}\n\n/**\n * Protocol-level errors (invalid message, unsupported capability)\n */\nexport class MCPProtocolError extends MCPError {\n  constructor(message: string, serverName?: string, cause?: Error) {\n    super(message, serverName, cause);\n    this.name = 'MCPProtocolError';\n  }\n}\n\n/**\n * Tool execution errors (tool not found, tool execution failed)\n */\nexport class MCPToolError extends MCPError {\n  constructor(\n    message: string,\n    public readonly toolName: string,\n    serverName?: string,\n    cause?: Error\n  ) {\n    super(message, serverName, cause);\n    this.name = 'MCPToolError';\n  }\n}\n\n/**\n * Resource-related errors (resource not found, subscription failed)\n */\nexport class MCPResourceError extends MCPError {\n  constructor(\n    message: string,\n    public readonly resourceUri: string,\n    serverName?: string,\n    cause?: Error\n  ) {\n    super(message, serverName, cause);\n    this.name = 'MCPResourceError';\n  }\n}\n","/**\n * MCP Configuration Types\n *\n * Defines configuration structures for MCP servers and global library configuration.\n */\n\n/**\n * Transport type for MCP communication\n */\nexport type MCPTransportType = 'stdio' | 'http' | 'https';\n\n/**\n * Stdio transport configuration\n */\nexport interface StdioTransportConfig {\n  /** Command to execute (e.g., 'npx', 'node') */\n  command: string;\n  /** Command arguments */\n  args?: string[];\n  /** Environment variables */\n  env?: Record<string, string>;\n  /** Working directory for the process */\n  cwd?: string;\n}\n\n/**\n * HTTP/HTTPS transport configuration (StreamableHTTP)\n */\nexport interface HTTPTransportConfig {\n  /** HTTP(S) endpoint URL */\n  url: string;\n  /** Authentication token (supports ${ENV_VAR} interpolation) */\n  token?: string;\n  /** Additional HTTP headers */\n  headers?: Record<string, string>;\n  /** Request timeout in milliseconds */\n  timeoutMs?: number;\n  /** Session ID for reconnection */\n  sessionId?: string;\n  /** Reconnection options */\n  reconnection?: {\n    /** Max reconnection delay in ms (default: 30000) */\n    maxReconnectionDelay?: number;\n    /** Initial reconnection delay in ms (default: 1000) */\n    initialReconnectionDelay?: number;\n    /** Reconnection delay growth factor (default: 1.5) */\n    reconnectionDelayGrowFactor?: number;\n    /** Max retry attempts (default: 2) */\n    maxRetries?: number;\n  };\n}\n\n/**\n * Transport configuration union type\n */\nexport type TransportConfig = StdioTransportConfig | HTTPTransportConfig;\n\n/**\n * MCP server configuration\n */\nexport interface MCPServerConfig {\n  /** Unique identifier for the server */\n  name: string;\n  /** Human-readable display name */\n  displayName?: string;\n  /** Server description */\n  description?: string;\n  /** Transport type */\n  transport: MCPTransportType;\n  /** Transport-specific configuration */\n  transportConfig: TransportConfig;\n  /** Auto-connect on startup (default: false) */\n  autoConnect?: boolean;\n  /** Auto-reconnect on failure (default: true) */\n  autoReconnect?: boolean;\n  /** Reconnect interval in milliseconds (default: 5000) */\n  reconnectIntervalMs?: number;\n  /** Maximum reconnect attempts (default: 10) */\n  maxReconnectAttempts?: number;\n  /** Request timeout in milliseconds (default: 30000) */\n  requestTimeoutMs?: number;\n  /** Health check interval in milliseconds (default: 60000) */\n  healthCheckIntervalMs?: number;\n  /** Tool namespace prefix (default: 'mcp:{name}') */\n  toolNamespace?: string;\n  /** Permission configuration for tools from this server */\n  permissions?: {\n    /** Default permission scope */\n    defaultScope?: 'once' | 'session' | 'always' | 'never';\n    /** Default risk level */\n    defaultRiskLevel?: 'low' | 'medium' | 'high' | 'critical';\n  };\n}\n\n/**\n * MCP global configuration\n */\nexport interface MCPConfiguration {\n  /** List of MCP servers */\n  servers: MCPServerConfig[];\n  /** Default settings for all servers */\n  defaults?: {\n    /** Default auto-connect (default: false) */\n    autoConnect?: boolean;\n    /** Default auto-reconnect (default: true) */\n    autoReconnect?: boolean;\n    /** Default reconnect interval in milliseconds (default: 5000) */\n    reconnectIntervalMs?: number;\n    /** Default maximum reconnect attempts (default: 10) */\n    maxReconnectAttempts?: number;\n    /** Default request timeout in milliseconds (default: 30000) */\n    requestTimeoutMs?: number;\n    /** Default health check interval in milliseconds (default: 60000) */\n    healthCheckIntervalMs?: number;\n  };\n}\n\n/**\n * Global library configuration\n */\nexport interface OneRingAIConfig {\n  /** Configuration schema version */\n  version?: string;\n  /** MCP configuration */\n  mcp?: MCPConfiguration;\n  /** Tools configuration */\n  tools?: {\n    /** Permission defaults for all tools */\n    permissions?: {\n      defaultScope?: 'once' | 'session' | 'always' | 'never';\n      defaultRiskLevel?: 'low' | 'medium' | 'high' | 'critical';\n    };\n  };\n  /** Session configuration */\n  session?: {\n    /** Storage type ('memory' or 'file') */\n    storage?: 'memory' | 'file';\n    /** Storage-specific options */\n    storageOptions?: Record<string, unknown>;\n    /** Auto-save enabled (default: false) */\n    autoSave?: boolean;\n    /** Auto-save interval in milliseconds (default: 30000) */\n    autoSaveIntervalMs?: number;\n  };\n  /** Context management configuration */\n  context?: {\n    /** Maximum context tokens (default: 128000) */\n    maxContextTokens?: number;\n    /** Context strategy ('proactive' | 'aggressive' | 'lazy' | 'rolling-window' | 'adaptive') */\n    strategy?: string;\n    /** Strategy-specific options */\n    strategyOptions?: Record<string, unknown>;\n  };\n}\n\n/**\n * Apply defaults to server config\n */\nexport function applyServerDefaults(\n  config: MCPServerConfig,\n  defaults?: MCPConfiguration['defaults']\n): Required<Omit<MCPServerConfig, 'displayName' | 'description' | 'permissions' | 'toolNamespace'>> & {\n  displayName?: string;\n  description?: string;\n  permissions?: MCPServerConfig['permissions'];\n  toolNamespace: string;\n} {\n  return {\n    name: config.name,\n    displayName: config.displayName,\n    description: config.description,\n    transport: config.transport,\n    transportConfig: config.transportConfig,\n    autoConnect: config.autoConnect ?? defaults?.autoConnect ?? false,\n    autoReconnect: config.autoReconnect ?? defaults?.autoReconnect ?? true,\n    reconnectIntervalMs: config.reconnectIntervalMs ?? defaults?.reconnectIntervalMs ?? 5000,\n    maxReconnectAttempts: config.maxReconnectAttempts ?? defaults?.maxReconnectAttempts ?? 10,\n    requestTimeoutMs: config.requestTimeoutMs ?? defaults?.requestTimeoutMs ?? 30000,\n    healthCheckIntervalMs: config.healthCheckIntervalMs ?? defaults?.healthCheckIntervalMs ?? 60000,\n    toolNamespace: config.toolNamespace ?? `mcp:${config.name}`,\n    permissions: config.permissions,\n  };\n}\n","/**\n * MCP Tool Adapter\n *\n * Converts MCP tools to ToolFunction interface for use with ToolManager.\n */\n\nimport type { ToolFunction } from '../../../domain/entities/Tool.js';\nimport type { MCPTool, MCPToolResult } from '../../../domain/entities/MCPTypes.js';\nimport type { IMCPClient } from '../../../domain/interfaces/IMCPClient.js';\nimport { MCPToolError } from '../../../domain/errors/MCPError.js';\n\n/**\n * Convert an MCP tool to a ToolFunction\n */\nexport function createMCPToolAdapter(\n  tool: MCPTool,\n  client: IMCPClient,\n  namespace: string\n): ToolFunction {\n  const fullName = `${namespace}:${tool.name}`;\n\n  return {\n    definition: {\n      type: 'function',\n      function: {\n        name: fullName,\n        description: tool.description || `MCP tool '${tool.name}' from server '${client.name}'`,\n        parameters: tool.inputSchema,\n      },\n    },\n\n    async execute(args: Record<string, unknown>): Promise<MCPToolResult | string> {\n      try {\n        const result = await client.callTool(tool.name, args);\n\n        // If the result is a simple text response, return just the text\n        if (result.content?.length === 1 && result.content[0]?.type === 'text') {\n          return result.content[0].text ?? '';\n        }\n\n        // Otherwise return the full result for complex responses\n        return result;\n      } catch (error) {\n        if (error instanceof MCPToolError) {\n          throw error;\n        }\n        throw new MCPToolError(\n          `Failed to execute MCP tool '${tool.name}'`,\n          tool.name,\n          client.name,\n          error as Error\n        );\n      }\n    },\n\n    describeCall(args: Record<string, unknown>): string {\n      // Try common argument names for human-readable description\n      const commonKeys = [\n        'file_path',\n        'path',\n        'uri',\n        'url',\n        'query',\n        'message',\n        'name',\n        'id',\n        'key',\n      ];\n\n      for (const key of commonKeys) {\n        if (key in args && typeof args[key] === 'string') {\n          return args[key] as string;\n        }\n      }\n\n      // Fallback to first string value\n      for (const value of Object.values(args)) {\n        if (typeof value === 'string' && value.length > 0) {\n          return value.length > 60 ? `${value.substring(0, 60)}...` : value;\n        }\n      }\n\n      // Final fallback\n      return tool.name;\n    },\n  };\n}\n\n/**\n * Convert all tools from an MCP client to ToolFunctions\n */\nexport function createMCPToolAdapters(\n  tools: MCPTool[],\n  client: IMCPClient,\n  namespace: string\n): ToolFunction[] {\n  return tools.map((tool) => createMCPToolAdapter(tool, client, namespace));\n}\n","/**\n * MCP Client Implementation\n *\n * Wrapper around @modelcontextprotocol/sdk Client with lifecycle management,\n * auto-reconnect, and integration with ToolManager.\n */\n\nimport { EventEmitter } from 'eventemitter3';\nimport { Client } from '@modelcontextprotocol/sdk/client/index.js';\nimport { StdioClientTransport } from '@modelcontextprotocol/sdk/client/stdio.js';\nimport { StreamableHTTPClientTransport } from '@modelcontextprotocol/sdk/client/streamableHttp.js';\nimport {\n  ListToolsResultSchema,\n  CallToolResultSchema,\n  ListResourcesResultSchema,\n  ReadResourceResultSchema,\n  ListPromptsResultSchema,\n  GetPromptResultSchema,\n} from '@modelcontextprotocol/sdk/types.js';\nimport type { Transport } from '@modelcontextprotocol/sdk/shared/transport.js';\nimport type { IMCPClient, MCPClientConnectionState } from '../../domain/interfaces/IMCPClient.js';\nimport type {\n  MCPTool,\n  MCPToolResult,\n  MCPResource,\n  MCPResourceContent,\n  MCPPrompt,\n  MCPPromptResult,\n  MCPServerCapabilities,\n  MCPClientState,\n} from '../../domain/entities/MCPTypes.js';\nimport type {\n  MCPServerConfig,\n  MCPConfiguration,\n  StdioTransportConfig,\n  HTTPTransportConfig,\n} from '../../domain/entities/MCPConfig.js';\nimport type { ToolManager } from '../ToolManager.js';\nimport {\n  MCPError,\n  MCPConnectionError,\n  MCPToolError,\n} from '../../domain/errors/MCPError.js';\nimport { applyServerDefaults } from '../../domain/entities/MCPConfig.js';\nimport { createMCPToolAdapters } from '../../infrastructure/mcp/adapters/MCPToolAdapter.js';\nimport { IDisposable } from '../../domain/interfaces/IDisposable.js';\n\n/**\n * MCP Client class\n */\nexport class MCPClient extends EventEmitter implements IMCPClient, IDisposable {\n  public readonly name: string;\n  private readonly config: ReturnType<typeof applyServerDefaults>;\n  private client: Client | null = null;\n  private transport: Transport | null = null;\n  private _state: MCPClientConnectionState = 'disconnected';\n  private _capabilities?: MCPServerCapabilities;\n  private _tools: MCPTool[] = [];\n  private reconnectAttempts = 0;\n  private reconnectTimer?: NodeJS.Timeout;\n  private healthCheckTimer?: NodeJS.Timeout;\n  private subscribedResources = new Set<string>();\n  private registeredToolNames = new Set<string>();\n  private _isDestroyed = false;\n\n  constructor(config: MCPServerConfig, defaults?: MCPConfiguration['defaults']) {\n    super();\n    this.name = config.name;\n    this.config = applyServerDefaults(config, defaults);\n  }\n\n  // Getters\n\n  get state(): MCPClientConnectionState {\n    return this._state;\n  }\n\n  get capabilities(): MCPServerCapabilities | undefined {\n    return this._capabilities;\n  }\n\n  get tools(): MCPTool[] {\n    return this._tools;\n  }\n\n  // Lifecycle methods\n\n  async connect(): Promise<void> {\n    if (this._state === 'connected' || this._state === 'connecting') {\n      return;\n    }\n\n    this._state = 'connecting';\n    this.emit('connecting');\n\n    try {\n      // Create transport based on config\n      this.transport = this.createTransport();\n\n      // Create SDK client\n      this.client = new Client(\n        {\n          name: '@oneringai/agents',\n          version: '0.2.0',\n        },\n        {\n          capabilities: {\n            // Request all capabilities (empty object means we support all)\n          },\n        }\n      );\n\n      // Connect\n      await this.client.connect(this.transport);\n\n      // Get server capabilities - the SDK exposes this after connection\n      // The actual capabilities are negotiated during connection\n      this._capabilities = {} as MCPServerCapabilities;\n\n      // Mark as connected before refreshing tools (so ensureConnected() doesn't throw)\n      this._state = 'connected';\n      this.reconnectAttempts = 0;\n\n      // List available tools\n      await this.refreshTools();\n\n      this.emit('connected');\n\n      // Start health check\n      this.startHealthCheck();\n    } catch (error) {\n      // Clean up partially created resources\n      this.stopHealthCheck(); // In case error occurred after startHealthCheck()\n\n      if (this.client) {\n        try {\n          await this.client.close();\n        } catch {\n          // Ignore close errors during cleanup\n        }\n        this.client = null;\n      }\n      this.transport = null;\n      this._tools = [];\n      this._capabilities = undefined;\n\n      this._state = 'failed';\n      const mcpError = new MCPConnectionError(\n        `Failed to connect to MCP server '${this.name}'`,\n        this.name,\n        error as Error\n      );\n      this.emit('failed', mcpError);\n      this.emit('error', mcpError);\n\n      // Auto-reconnect if enabled\n      if (this.config.autoReconnect) {\n        this.scheduleReconnect();\n      } else {\n        throw mcpError;\n      }\n    }\n  }\n\n  async disconnect(): Promise<void> {\n    this.stopHealthCheck();\n    this.stopReconnect();\n\n    if (this.client && this.transport) {\n      try {\n        await this.client.close();\n      } catch (error) {\n        // Ignore close errors\n      }\n    }\n\n    this.client = null;\n    this.transport = null;\n    this._state = 'disconnected';\n    this._tools = [];\n    this.emit('disconnected');\n  }\n\n  async reconnect(): Promise<void> {\n    await this.disconnect();\n    await this.connect();\n  }\n\n  isConnected(): boolean {\n    return this._state === 'connected';\n  }\n\n  async ping(): Promise<boolean> {\n    if (!this.client || !this.isConnected()) {\n      return false;\n    }\n\n    try {\n      await this.client.ping();\n      return true;\n    } catch (error) {\n      return false;\n    }\n  }\n\n  // Tool methods\n\n  async listTools(): Promise<MCPTool[]> {\n    this.ensureConnected();\n\n    try {\n      const response = await this.client!.request({ method: 'tools/list' }, ListToolsResultSchema);\n\n      this._tools = response.tools.map((tool) => ({\n        name: tool.name,\n        description: tool.description,\n        inputSchema: tool.inputSchema as MCPTool['inputSchema'],\n      }));\n\n      return this._tools;\n    } catch (error) {\n      throw new MCPError(`Failed to list tools from server '${this.name}'`, this.name, error as Error);\n    }\n  }\n\n  async callTool(name: string, args: Record<string, unknown>): Promise<MCPToolResult> {\n    this.ensureConnected();\n\n    this.emit('tool:called', name, args);\n\n    try {\n      const response = await this.client!.request(\n        {\n          method: 'tools/call',\n          params: {\n            name,\n            arguments: args,\n          },\n        },\n        CallToolResultSchema\n      );\n\n      const result: MCPToolResult = {\n        content: response.content.map((item) => ({\n          type: item.type as 'text' | 'image' | 'resource',\n          text: 'text' in item ? item.text : undefined,\n          data: 'data' in item ? item.data : undefined,\n          mimeType: 'mimeType' in item ? item.mimeType : undefined,\n          uri: 'uri' in item ? item.uri : undefined,\n        })),\n        isError: response.isError,\n      };\n\n      this.emit('tool:result', name, result);\n\n      if (result.isError) {\n        const errorText = result.content.find((c) => c.type === 'text')?.text || 'Unknown error';\n        throw new MCPToolError(errorText, name, this.name);\n      }\n\n      return result;\n    } catch (error) {\n      if (error instanceof MCPToolError) {\n        throw error;\n      }\n      throw new MCPToolError(\n        `Failed to call tool '${name}' on server '${this.name}'`,\n        name,\n        this.name,\n        error as Error\n      );\n    }\n  }\n\n  registerTools(toolManager: ToolManager): void {\n    if (this._tools.length === 0) {\n      return;\n    }\n\n    // Convert MCP tools to ToolFunctions\n    const toolFunctions = createMCPToolAdapters(this._tools, this, this.config.toolNamespace);\n\n    // Register each tool with the ToolManager\n    for (const toolFn of toolFunctions) {\n      const toolName = toolFn.definition.function.name;\n\n      toolManager.register(toolFn, {\n        namespace: this.config.toolNamespace,\n        enabled: true,\n        permission: this.config.permissions\n          ? {\n              scope: this.config.permissions.defaultScope,\n              riskLevel: this.config.permissions.defaultRiskLevel,\n            }\n          : undefined,\n      });\n\n      this.registeredToolNames.add(toolName);\n    }\n  }\n\n  unregisterTools(toolManager: ToolManager): void {\n    for (const toolName of this.registeredToolNames) {\n      toolManager.unregister(toolName);\n    }\n    this.registeredToolNames.clear();\n  }\n\n  // Resource methods\n\n  async listResources(): Promise<MCPResource[]> {\n    this.ensureConnected();\n\n    try {\n      const response = await this.client!.request({ method: 'resources/list' }, ListResourcesResultSchema);\n\n      return response.resources.map((resource) => ({\n        uri: resource.uri,\n        name: resource.name,\n        description: resource.description,\n        mimeType: resource.mimeType,\n      }));\n    } catch (error) {\n      throw new MCPError(\n        `Failed to list resources from server '${this.name}'`,\n        this.name,\n        error as Error\n      );\n    }\n  }\n\n  async readResource(uri: string): Promise<MCPResourceContent> {\n    this.ensureConnected();\n\n    try {\n      const response = await this.client!.request(\n        {\n          method: 'resources/read',\n          params: { uri },\n        },\n        ReadResourceResultSchema\n      );\n\n      const content = response.contents?.[0];\n      if (!content) {\n        throw new MCPError(`No content returned for resource '${uri}'`, this.name);\n      }\n\n      return {\n        uri: content.uri,\n        mimeType: content.mimeType,\n        text: 'text' in content ? content.text : undefined,\n        blob: 'blob' in content ? content.blob : undefined,\n      };\n    } catch (error) {\n      throw new MCPError(\n        `Failed to read resource '${uri}' from server '${this.name}'`,\n        this.name,\n        error as Error\n      );\n    }\n  }\n\n  async subscribeResource(uri: string): Promise<void> {\n    this.ensureConnected();\n\n    if (!this._capabilities?.resources?.subscribe) {\n      throw new MCPError(`Server '${this.name}' does not support resource subscriptions`, this.name);\n    }\n\n    try {\n      // Subscribe method typically doesn't return structured data\n      await this.client!.request(\n        {\n          method: 'resources/subscribe',\n          params: { uri },\n        },\n        {} as any // No specific schema for subscription acknowledgment\n      );\n\n      this.subscribedResources.add(uri);\n    } catch (error) {\n      throw new MCPError(\n        `Failed to subscribe to resource '${uri}' on server '${this.name}'`,\n        this.name,\n        error as Error\n      );\n    }\n  }\n\n  async unsubscribeResource(uri: string): Promise<void> {\n    this.ensureConnected();\n\n    try {\n      // Unsubscribe method typically doesn't return structured data\n      await this.client!.request(\n        {\n          method: 'resources/unsubscribe',\n          params: { uri },\n        },\n        {} as any // No specific schema for unsubscribe acknowledgment\n      );\n\n      this.subscribedResources.delete(uri);\n    } catch (error) {\n      throw new MCPError(\n        `Failed to unsubscribe from resource '${uri}' on server '${this.name}'`,\n        this.name,\n        error as Error\n      );\n    }\n  }\n\n  // Prompt methods\n\n  async listPrompts(): Promise<MCPPrompt[]> {\n    this.ensureConnected();\n\n    try {\n      const response = await this.client!.request({ method: 'prompts/list' }, ListPromptsResultSchema);\n\n      return response.prompts.map((prompt) => ({\n        name: prompt.name,\n        description: prompt.description,\n        arguments: prompt.arguments,\n      }));\n    } catch (error) {\n      throw new MCPError(`Failed to list prompts from server '${this.name}'`, this.name, error as Error);\n    }\n  }\n\n  async getPrompt(name: string, args?: Record<string, unknown>): Promise<MCPPromptResult> {\n    this.ensureConnected();\n\n    try {\n      const response = await this.client!.request(\n        {\n          method: 'prompts/get',\n          params: {\n            name,\n            arguments: args,\n          },\n        },\n        GetPromptResultSchema\n      );\n\n      return {\n        description: response.description,\n        messages: response.messages.map((msg) => ({\n          role: msg.role as 'user' | 'assistant',\n          content: {\n            type: msg.content.type as 'text' | 'image' | 'resource',\n            text: 'text' in msg.content ? msg.content.text : undefined,\n            data: 'data' in msg.content ? msg.content.data : undefined,\n            mimeType: 'mimeType' in msg.content ? msg.content.mimeType : undefined,\n            uri: 'uri' in msg.content ? msg.content.uri : undefined,\n          },\n        })),\n      };\n    } catch (error) {\n      throw new MCPError(\n        `Failed to get prompt '${name}' from server '${this.name}'`,\n        this.name,\n        error as Error\n      );\n    }\n  }\n\n  // State management\n\n  getState(): MCPClientState {\n    return {\n      name: this.name,\n      state: this._state,\n      capabilities: this._capabilities,\n      subscribedResources: Array.from(this.subscribedResources),\n      lastConnectedAt: this._state === 'connected' ? Date.now() : undefined,\n      connectionAttempts: this.reconnectAttempts,\n    };\n  }\n\n  loadState(state: MCPClientState): void {\n    this.subscribedResources = new Set(state.subscribedResources);\n    this.reconnectAttempts = state.connectionAttempts;\n  }\n\n  /**\n   * Check if the MCPClient instance has been destroyed\n   */\n  get isDestroyed(): boolean {\n    return this._isDestroyed;\n  }\n\n  destroy(): void {\n    if (this._isDestroyed) return;\n    this._isDestroyed = true;\n    this.stopHealthCheck();\n    this.stopReconnect();\n    if (this.client) {\n      this.client.close().catch(() => {});\n      this.client = null;\n    }\n    this.transport = null;\n    this._tools = [];\n    this._capabilities = undefined;\n    this._state = 'disconnected';\n    this.subscribedResources.clear();\n    this.registeredToolNames.clear();\n    this.removeAllListeners();\n  }\n\n  // Private helper methods\n\n  private createTransport(): Transport {\n    const { transport, transportConfig } = this.config;\n\n    if (transport === 'stdio') {\n      const stdioConfig = transportConfig as StdioTransportConfig;\n      return new StdioClientTransport({\n        command: stdioConfig.command,\n        args: stdioConfig.args,\n        env: stdioConfig.env as Record<string, string> | undefined,\n      });\n    }\n\n    if (transport === 'http' || transport === 'https') {\n      const httpConfig = transportConfig as HTTPTransportConfig;\n\n      // Build headers\n      const headers: Record<string, string> = { ...httpConfig.headers };\n      if (httpConfig.token) {\n        headers['Authorization'] = `Bearer ${httpConfig.token}`;\n      }\n\n      return new StreamableHTTPClientTransport(new URL(httpConfig.url), {\n        sessionId: httpConfig.sessionId,\n        requestInit: {\n          headers,\n          ...(httpConfig.timeoutMs && { signal: AbortSignal.timeout(httpConfig.timeoutMs) }),\n        },\n        reconnectionOptions: httpConfig.reconnection\n          ? {\n              maxReconnectionDelay: httpConfig.reconnection.maxReconnectionDelay ?? 30000,\n              initialReconnectionDelay: httpConfig.reconnection.initialReconnectionDelay ?? 1000,\n              reconnectionDelayGrowFactor: httpConfig.reconnection.reconnectionDelayGrowFactor ?? 1.5,\n              maxRetries: httpConfig.reconnection.maxRetries ?? 2,\n            }\n          : undefined,\n      });\n    }\n\n    throw new MCPError(`Transport '${transport}' not supported`, this.name);\n  }\n\n  private ensureConnected(): void {\n    if (!this.client || !this.isConnected()) {\n      throw new MCPConnectionError(`MCP server '${this.name}' is not connected`, this.name);\n    }\n  }\n\n  private async refreshTools(): Promise<void> {\n    try {\n      await this.listTools();\n    } catch (error) {\n      // Log but don't fail\n      this.emit('error', error);\n    }\n  }\n\n  private startHealthCheck(): void {\n    if (this.config.healthCheckIntervalMs <= 0) {\n      return;\n    }\n\n    this.healthCheckTimer = setInterval(async () => {\n      const alive = await this.ping();\n      if (!alive && this._state === 'connected') {\n        this.emit('error', new MCPConnectionError(`Health check failed for server '${this.name}'`, this.name));\n        if (this.config.autoReconnect) {\n          await this.reconnect();\n        }\n      }\n    }, this.config.healthCheckIntervalMs);\n  }\n\n  private stopHealthCheck(): void {\n    if (this.healthCheckTimer) {\n      clearInterval(this.healthCheckTimer);\n      this.healthCheckTimer = undefined;\n    }\n  }\n\n  private scheduleReconnect(): void {\n    if (this.reconnectAttempts >= this.config.maxReconnectAttempts) {\n      this.emit('error', new MCPConnectionError(`Max reconnect attempts reached for server '${this.name}'`, this.name));\n      return;\n    }\n\n    this.reconnectAttempts++;\n    this._state = 'reconnecting';\n    this.emit('reconnecting', this.reconnectAttempts);\n\n    // Exponential backoff: 5s, 10s, 20s, 40s, ...\n    const delay = this.config.reconnectIntervalMs * Math.pow(2, this.reconnectAttempts - 1);\n\n    this.reconnectTimer = setTimeout(async () => {\n      try {\n        await this.connect();\n      } catch (error) {\n        // connect() will handle retry\n      }\n    }, delay);\n  }\n\n  private stopReconnect(): void {\n    if (this.reconnectTimer) {\n      clearTimeout(this.reconnectTimer);\n      this.reconnectTimer = undefined;\n    }\n  }\n}\n","/**\n * MCP Registry\n *\n * Static registry for managing MCP client connections.\n * Follows the same pattern as Connector registry.\n */\n\nimport { MCPClient } from './MCPClient.js';\nimport type { IMCPClient } from '../../domain/interfaces/IMCPClient.js';\nimport type { MCPServerConfig, MCPConfiguration, OneRingAIConfig } from '../../domain/entities/MCPConfig.js';\nimport { MCPError } from '../../domain/errors/MCPError.js';\nimport { promises as fs } from 'fs';\nimport { resolve } from 'path';\n\n/**\n * MCP Registry - static registry for MCP clients\n */\nexport class MCPRegistry {\n  private static clients = new Map<string, IMCPClient>();\n\n  /**\n   * Create and register an MCP client\n   */\n  static create(config: MCPServerConfig, defaults?: MCPConfiguration['defaults']): IMCPClient {\n    if (this.clients.has(config.name)) {\n      throw new MCPError(`MCP server '${config.name}' is already registered`);\n    }\n\n    const client = new MCPClient(config, defaults);\n    this.clients.set(config.name, client);\n\n    return client;\n  }\n\n  /**\n   * Get a registered MCP client\n   */\n  static get(name: string): IMCPClient {\n    const client = this.clients.get(name);\n    if (!client) {\n      throw new MCPError(`MCP server '${name}' not found in registry`);\n    }\n    return client;\n  }\n\n  /**\n   * Check if an MCP client is registered\n   */\n  static has(name: string): boolean {\n    return this.clients.has(name);\n  }\n\n  /**\n   * List all registered MCP client names\n   */\n  static list(): string[] {\n    return Array.from(this.clients.keys());\n  }\n\n  /**\n   * Get info about a registered MCP client\n   */\n  static getInfo(name: string): {\n    name: string;\n    state: string;\n    connected: boolean;\n    toolCount: number;\n  } {\n    const client = this.get(name);\n    return {\n      name: client.name,\n      state: client.state,\n      connected: client.isConnected(),\n      toolCount: client.tools.length,\n    };\n  }\n\n  /**\n   * Get info about all registered MCP clients\n   */\n  static getAllInfo(): Array<{\n    name: string;\n    state: string;\n    connected: boolean;\n    toolCount: number;\n  }> {\n    return Array.from(this.clients.keys()).map((name) => this.getInfo(name));\n  }\n\n  /**\n   * Create multiple clients from MCP configuration\n   */\n  static createFromConfig(config: MCPConfiguration): IMCPClient[] {\n    const clients: IMCPClient[] = [];\n\n    for (const serverConfig of config.servers) {\n      const client = this.create(serverConfig, config.defaults);\n      clients.push(client);\n    }\n\n    return clients;\n  }\n\n  /**\n   * Load MCP configuration from file and create clients\n   */\n  static async loadFromConfigFile(path: string): Promise<IMCPClient[]> {\n    try {\n      const configPath = resolve(path);\n      const content = await fs.readFile(configPath, 'utf-8');\n      const config: OneRingAIConfig = JSON.parse(content);\n\n      if (!config.mcp) {\n        throw new MCPError('Configuration file does not contain MCP section');\n      }\n\n      // Apply environment variable interpolation\n      const interpolatedConfig = this.interpolateEnvVars(config.mcp);\n\n      return this.createFromConfig(interpolatedConfig);\n    } catch (error) {\n      if (error instanceof MCPError) {\n        throw error;\n      }\n      throw new MCPError(`Failed to load MCP configuration from '${path}'`, undefined, error as Error);\n    }\n  }\n\n  /**\n   * Connect all servers with autoConnect enabled\n   */\n  static async connectAll(): Promise<void> {\n    const connectPromises: Promise<void>[] = [];\n\n    for (const client of this.clients.values()) {\n      if (!client.isConnected()) {\n        connectPromises.push(client.connect());\n      }\n    }\n\n    await Promise.all(connectPromises);\n  }\n\n  /**\n   * Disconnect all servers\n   */\n  static async disconnectAll(): Promise<void> {\n    const disconnectPromises: Promise<void>[] = [];\n\n    for (const client of this.clients.values()) {\n      if (client.isConnected()) {\n        disconnectPromises.push(client.disconnect());\n      }\n    }\n\n    await Promise.all(disconnectPromises);\n  }\n\n  /**\n   * Destroy all clients and clear registry\n   */\n  static destroyAll(): void {\n    for (const client of this.clients.values()) {\n      client.destroy();\n    }\n    this.clients.clear();\n  }\n\n  /**\n   * Clear the registry (for testing)\n   */\n  static clear(): void {\n    this.destroyAll();\n  }\n\n  /**\n   * Interpolate environment variables in configuration\n   * Replaces ${ENV_VAR} with process.env.ENV_VAR\n   */\n  private static interpolateEnvVars(config: MCPConfiguration): MCPConfiguration {\n    const jsonString = JSON.stringify(config);\n    const interpolated = jsonString.replace(/\\$\\{([^}]+)\\}/g, (_match, envVar) => {\n      const value = process.env[envVar];\n      if (value === undefined) {\n        throw new MCPError(`Environment variable '${envVar}' is not set`);\n      }\n      return value;\n    });\n\n    return JSON.parse(interpolated);\n  }\n}\n","/**\n * TextToSpeech capability class\n * Provides high-level API for text-to-speech synthesis\n */\n\nimport { Connector } from './Connector.js';\nimport { createTTSProvider } from './createAudioProvider.js';\nimport type { ITextToSpeechProvider, TTSOptions, TTSResponse } from '../domain/interfaces/IAudioProvider.js';\nimport type { AudioFormat } from '../domain/types/SharedTypes.js';\nimport { getTTSModelInfo, getTTSModelsByVendor, type ITTSModelDescription, type IVoiceInfo } from '../domain/entities/TTSModel.js';\nimport * as fs from 'fs/promises';\n\n/**\n * Configuration for TextToSpeech capability\n */\nexport interface TextToSpeechConfig {\n  /** Connector name or instance */\n  connector: string | Connector;\n\n  /** Default model to use */\n  model?: string;\n\n  /** Default voice to use */\n  voice?: string;\n\n  /** Default audio format */\n  format?: AudioFormat;\n\n  /** Default speed (0.25 to 4.0) */\n  speed?: number;\n}\n\n/**\n * TextToSpeech capability class\n * Provides text-to-speech synthesis with model introspection\n *\n * @example\n * ```typescript\n * const tts = TextToSpeech.create({\n *   connector: 'openai',\n *   model: 'tts-1-hd',\n *   voice: 'nova',\n * });\n *\n * const audio = await tts.synthesize('Hello, world!');\n * await tts.toFile('Hello', './output.mp3');\n * ```\n */\nexport class TextToSpeech {\n  private provider: ITextToSpeechProvider;\n  private config: TextToSpeechConfig;\n\n  /**\n   * Create a new TextToSpeech instance\n   */\n  static create(config: TextToSpeechConfig): TextToSpeech {\n    return new TextToSpeech(config);\n  }\n\n  private constructor(config: TextToSpeechConfig) {\n    const connector = typeof config.connector === 'string'\n      ? Connector.get(config.connector)\n      : config.connector;\n\n    this.provider = createTTSProvider(connector);\n    this.config = config;\n  }\n\n  // ======================== Synthesis Methods ========================\n\n  /**\n   * Synthesize speech from text\n   *\n   * @param text - Text to synthesize\n   * @param options - Optional synthesis parameters\n   * @returns Audio data and metadata\n   */\n  async synthesize(\n    text: string,\n    options?: Partial<Omit<TTSOptions, 'model' | 'input'>>\n  ): Promise<TTSResponse> {\n    const fullOptions: TTSOptions = {\n      model: this.config.model ?? this.getDefaultModel(),\n      input: text,\n      voice: options?.voice ?? this.config.voice ?? this.getDefaultVoice(),\n      format: options?.format ?? this.config.format,\n      speed: options?.speed ?? this.config.speed,\n      vendorOptions: options?.vendorOptions,\n    };\n\n    return this.provider.synthesize(fullOptions);\n  }\n\n  /**\n   * Synthesize speech and save to file\n   *\n   * @param text - Text to synthesize\n   * @param filePath - Output file path\n   * @param options - Optional synthesis parameters\n   */\n  async toFile(\n    text: string,\n    filePath: string,\n    options?: Partial<Omit<TTSOptions, 'model' | 'input'>>\n  ): Promise<void> {\n    const response = await this.synthesize(text, options);\n    await fs.writeFile(filePath, response.audio);\n  }\n\n  // ======================== Introspection Methods ========================\n\n  /**\n   * Get model information for current or specified model\n   */\n  getModelInfo(model?: string): ITTSModelDescription {\n    const targetModel = model ?? this.config.model ?? this.getDefaultModel();\n    const info = getTTSModelInfo(targetModel);\n\n    if (!info) {\n      throw new Error(`Unknown TTS model: ${targetModel}`);\n    }\n\n    return info;\n  }\n\n  /**\n   * Get model capabilities\n   */\n  getModelCapabilities(model?: string) {\n    return this.getModelInfo(model).capabilities;\n  }\n\n  /**\n   * List all available voices for current model\n   * For dynamic voice providers (e.g., ElevenLabs), fetches from API\n   * For static providers (e.g., OpenAI), returns from registry\n   */\n  async listVoices(model?: string): Promise<IVoiceInfo[]> {\n    // Try to fetch from provider API first\n    if (this.provider.listVoices) {\n      return this.provider.listVoices();\n    }\n\n    // Fall back to static list from registry\n    const caps = this.getModelCapabilities(model);\n    return caps.voices;\n  }\n\n  /**\n   * List all available models for this provider's vendor\n   */\n  listAvailableModels(): ITTSModelDescription[] {\n    const vendor = this.provider.vendor;\n    if (!vendor) {\n      return [];\n    }\n    return getTTSModelsByVendor(vendor as any);\n  }\n\n  /**\n   * Check if a specific feature is supported by the model\n   */\n  supportsFeature(\n    feature: keyof ITTSModelDescription['capabilities']['features'],\n    model?: string\n  ): boolean {\n    const caps = this.getModelCapabilities(model);\n    return Boolean(caps.features[feature]);\n  }\n\n  /**\n   * Get supported audio formats for the model\n   */\n  getSupportedFormats(model?: string): readonly AudioFormat[] | AudioFormat[] {\n    return this.getModelCapabilities(model).formats;\n  }\n\n  /**\n   * Get supported languages for the model\n   */\n  getSupportedLanguages(model?: string): readonly string[] | string[] {\n    return this.getModelCapabilities(model).languages;\n  }\n\n  /**\n   * Check if speed control is supported\n   */\n  supportsSpeedControl(model?: string): boolean {\n    return this.getModelCapabilities(model).speed.supported;\n  }\n\n  // ======================== Configuration Methods ========================\n\n  /**\n   * Update default model\n   */\n  setModel(model: string): void {\n    this.config.model = model;\n  }\n\n  /**\n   * Update default voice\n   */\n  setVoice(voice: string): void {\n    this.config.voice = voice;\n  }\n\n  /**\n   * Update default format\n   */\n  setFormat(format: AudioFormat): void {\n    this.config.format = format;\n  }\n\n  /**\n   * Update default speed\n   */\n  setSpeed(speed: number): void {\n    this.config.speed = speed;\n  }\n\n  // ======================== Private Methods ========================\n\n  /**\n   * Get default model (first active model for vendor)\n   */\n  private getDefaultModel(): string {\n    const models = this.listAvailableModels();\n    const firstModel = models[0];\n    if (!firstModel) {\n      throw new Error('No TTS models available for this provider');\n    }\n    return firstModel.name;\n  }\n\n  /**\n   * Get default voice (first or default-marked voice)\n   */\n  private getDefaultVoice(): string {\n    const caps = this.getModelInfo().capabilities;\n    const defaultVoice = caps.voices.find((v) => v.isDefault);\n    return defaultVoice?.id ?? caps.voices[0]?.id ?? 'alloy';\n  }\n}\n","/**\n * Base media provider with common functionality for Image, Audio, and Video providers\n * Provides circuit breaker, logging, and metrics similar to BaseTextProvider\n */\n\nimport { BaseProvider } from './BaseProvider.js';\nimport type { IProvider } from '../../../domain/interfaces/IProvider.js';\nimport { CircuitBreaker, DEFAULT_CIRCUIT_BREAKER_CONFIG } from '../../resilience/CircuitBreaker.js';\nimport { logger, FrameworkLogger } from '../../observability/Logger.js';\nimport { metrics } from '../../observability/Metrics.js';\n\n/**\n * Base class for all media providers (Image, Audio, Video)\n * Follows the same patterns as BaseTextProvider for consistency\n */\nexport abstract class BaseMediaProvider extends BaseProvider implements IProvider {\n  protected circuitBreaker?: CircuitBreaker;\n  protected logger: FrameworkLogger;\n  private _isObservabilityInitialized = false;\n\n  constructor(config: any) {\n    super(config);\n\n    // Initialize with default logger (will be updated with provider name on first use)\n    this.logger = logger.child({\n      component: 'MediaProvider',\n      provider: 'unknown',\n    });\n\n    // Circuit breaker created lazily on first use\n  }\n\n  /**\n   * Auto-initialize observability on first use (lazy initialization)\n   * This is called automatically by executeWithCircuitBreaker()\n   * @internal\n   */\n  private ensureObservabilityInitialized(): void {\n    if (this._isObservabilityInitialized) {\n      return;\n    }\n\n    const providerName = this.name || 'unknown';\n\n    // Create circuit breaker with provider name\n    const cbConfig = (this.config as any).circuitBreaker || DEFAULT_CIRCUIT_BREAKER_CONFIG;\n    this.circuitBreaker = new CircuitBreaker(\n      `media-provider:${providerName}`,\n      cbConfig\n    );\n\n    // Update logger with provider name\n    this.logger = logger.child({\n      component: 'MediaProvider',\n      provider: providerName,\n    });\n\n    // Forward circuit breaker events to metrics\n    this.circuitBreaker.on('opened', (data) => {\n      this.logger.warn(data, 'Circuit breaker opened');\n      metrics.increment('circuit_breaker.opened', 1, {\n        breaker: data.name,\n        provider: providerName,\n      });\n    });\n\n    this.circuitBreaker.on('closed', (data) => {\n      this.logger.info(data, 'Circuit breaker closed');\n      metrics.increment('circuit_breaker.closed', 1, {\n        breaker: data.name,\n        provider: providerName,\n      });\n    });\n\n    this._isObservabilityInitialized = true;\n  }\n\n  /**\n   * Execute operation with circuit breaker protection\n   * Automatically records metrics and handles errors\n   *\n   * @param operation - The async operation to execute\n   * @param operationName - Name of the operation for metrics (e.g., 'image.generate', 'audio.synthesize')\n   * @param metadata - Additional metadata to log/record\n   */\n  protected async executeWithCircuitBreaker<TResult>(\n    operation: () => Promise<TResult>,\n    operationName: string,\n    metadata?: Record<string, unknown>\n  ): Promise<TResult> {\n    // Auto-initialize observability on first use\n    this.ensureObservabilityInitialized();\n\n    const startTime = Date.now();\n    const metricLabels = {\n      provider: this.name,\n      operation: operationName,\n      ...metadata,\n    };\n\n    try {\n      // Execute through circuit breaker\n      const result = await this.circuitBreaker!.execute(operation);\n\n      // Record success metrics\n      const duration = Date.now() - startTime;\n      metrics.histogram(`${operationName}.duration`, duration, metricLabels);\n      metrics.increment(`${operationName}.success`, 1, metricLabels);\n\n      this.logger.debug(\n        { operation: operationName, duration, ...metadata },\n        'Operation completed successfully'\n      );\n\n      return result;\n    } catch (error) {\n      // Record error metrics\n      const duration = Date.now() - startTime;\n      metrics.increment(`${operationName}.error`, 1, {\n        ...metricLabels,\n        error: error instanceof Error ? error.name : 'unknown',\n      });\n\n      this.logger.error(\n        {\n          operation: operationName,\n          duration,\n          error: error instanceof Error ? error.message : String(error),\n          ...metadata,\n        },\n        'Operation failed'\n      );\n\n      throw error;\n    }\n  }\n\n  /**\n   * Log operation start with context\n   * Useful for logging before async operations\n   */\n  protected logOperationStart(operation: string, context: Record<string, unknown>): void {\n    this.ensureObservabilityInitialized();\n    this.logger.info({ operation, ...context }, `${operation} started`);\n  }\n\n  /**\n   * Log operation completion with context\n   */\n  protected logOperationComplete(operation: string, context: Record<string, unknown>): void {\n    this.ensureObservabilityInitialized();\n    this.logger.info({ operation, ...context }, `${operation} completed`);\n  }\n}\n","/**\n * Shared voice definitions and language constants\n * Eliminates duplication across TTS model registries\n */\n\n/**\n * Voice information structure\n * Used consistently across all TTS providers\n */\nexport interface IVoiceInfo {\n  id: string;\n  name: string;\n  language: string;\n  gender: 'male' | 'female' | 'neutral';\n  style?: string;\n  previewUrl?: string;\n  isDefault?: boolean;\n  accent?: string;\n  age?: 'child' | 'young' | 'adult' | 'senior';\n}\n\n// =============================================================================\n// Voice Definitions\n// =============================================================================\n\n/**\n * OpenAI TTS voices (shared across tts-1, tts-1-hd, gpt-4o-mini-tts)\n * Source: https://platform.openai.com/docs/guides/text-to-speech\n * Note: 'multi' language means the voice supports multiple languages\n * Last verified: 2026-01-24\n */\nexport const OPENAI_VOICES: IVoiceInfo[] = [\n  { id: 'alloy', name: 'Alloy', language: 'multi', gender: 'neutral', isDefault: true },\n  { id: 'ash', name: 'Ash', language: 'multi', gender: 'male' },\n  { id: 'ballad', name: 'Ballad', language: 'multi', gender: 'male' },\n  { id: 'coral', name: 'Coral', language: 'multi', gender: 'female' },\n  { id: 'echo', name: 'Echo', language: 'multi', gender: 'male' },\n  { id: 'fable', name: 'Fable', language: 'multi', gender: 'neutral', accent: 'british' },\n  { id: 'nova', name: 'Nova', language: 'multi', gender: 'female' },\n  { id: 'onyx', name: 'Onyx', language: 'multi', gender: 'male' },\n  { id: 'sage', name: 'Sage', language: 'multi', gender: 'female' },\n  { id: 'shimmer', name: 'Shimmer', language: 'multi', gender: 'female' },\n  { id: 'verse', name: 'Verse', language: 'multi', gender: 'neutral' },\n  { id: 'marin', name: 'Marin', language: 'multi', gender: 'female' },\n  { id: 'cedar', name: 'Cedar', language: 'multi', gender: 'male' },\n];\n\n/**\n * Google Gemini TTS voices (30 total)\n * Source: https://ai.google.dev/gemini-api/docs/speech-generation\n * Last verified: 2026-01-25\n */\nexport const GEMINI_VOICES: IVoiceInfo[] = [\n  // Default voice\n  { id: 'Kore', name: 'Kore', language: 'multi', gender: 'female', isDefault: true },\n  // Primary voices\n  { id: 'Puck', name: 'Puck', language: 'multi', gender: 'neutral' },\n  { id: 'Charon', name: 'Charon', language: 'multi', gender: 'male' },\n  { id: 'Fenrir', name: 'Fenrir', language: 'multi', gender: 'male' },\n  { id: 'Zephyr', name: 'Zephyr', language: 'multi', gender: 'neutral' },\n  { id: 'Leda', name: 'Leda', language: 'multi', gender: 'female' },\n  { id: 'Orus', name: 'Orus', language: 'multi', gender: 'male' },\n  { id: 'Aoede', name: 'Aoede', language: 'multi', gender: 'female' },\n  // Extended voices (celestial/astronomical naming)\n  { id: 'Callirrhoe', name: 'Callirrhoe', language: 'multi', gender: 'female' },\n  { id: 'Autonoe', name: 'Autonoe', language: 'multi', gender: 'female' },\n  { id: 'Enceladus', name: 'Enceladus', language: 'multi', gender: 'male' },\n  { id: 'Iapetus', name: 'Iapetus', language: 'multi', gender: 'male' },\n  { id: 'Umbriel', name: 'Umbriel', language: 'multi', gender: 'neutral' },\n  { id: 'Algieba', name: 'Algieba', language: 'multi', gender: 'male' },\n  { id: 'Despina', name: 'Despina', language: 'multi', gender: 'female' },\n  { id: 'Erinome', name: 'Erinome', language: 'multi', gender: 'female' },\n  { id: 'Algenib', name: 'Algenib', language: 'multi', gender: 'male' },\n  { id: 'Rasalgethi', name: 'Rasalgethi', language: 'multi', gender: 'male' },\n  { id: 'Laomedeia', name: 'Laomedeia', language: 'multi', gender: 'female' },\n  { id: 'Achernar', name: 'Achernar', language: 'multi', gender: 'male' },\n  { id: 'Alnilam', name: 'Alnilam', language: 'multi', gender: 'male' },\n  { id: 'Schedar', name: 'Schedar', language: 'multi', gender: 'female' },\n  { id: 'Gacrux', name: 'Gacrux', language: 'multi', gender: 'male' },\n  { id: 'Pulcherrima', name: 'Pulcherrima', language: 'multi', gender: 'female' },\n  { id: 'Achird', name: 'Achird', language: 'multi', gender: 'male' },\n  { id: 'Zubenelgenubi', name: 'Zubenelgenubi', language: 'multi', gender: 'male' },\n  { id: 'Vindemiatrix', name: 'Vindemiatrix', language: 'multi', gender: 'female' },\n  { id: 'Sadachbia', name: 'Sadachbia', language: 'multi', gender: 'male' },\n  { id: 'Sadaltager', name: 'Sadaltager', language: 'multi', gender: 'male' },\n  { id: 'Sulafat', name: 'Sulafat', language: 'multi', gender: 'female' },\n];\n\n/**\n * Google Gemini TTS supported languages (24)\n * Source: https://ai.google.dev/gemini-api/docs/speech-generation\n */\nexport const GEMINI_TTS_LANGUAGES = [\n  'ar-EG',  // Arabic (Egyptian)\n  'bn',     // Bengali\n  'de-DE',  // German (Germany)\n  'en-US',  // English (US)\n  'en-IN',  // English (India)\n  'es',     // Spanish\n  'fr-FR',  // French (France)\n  'hi',     // Hindi\n  'id',     // Indonesian\n  'it',     // Italian\n  'ja',     // Japanese\n  'ko',     // Korean\n  'mr',     // Marathi\n  'nl',     // Dutch\n  'pl',     // Polish\n  'pt-BR',  // Portuguese (Brazil)\n  'ro',     // Romanian\n  'ru',     // Russian\n  'ta',     // Tamil\n  'te',     // Telugu\n  'th',     // Thai\n  'tr',     // Turkish\n  'uk',     // Ukrainian\n  'vi',     // Vietnamese\n] as const;\n\n// =============================================================================\n// Language Constants\n// =============================================================================\n\n/**\n * Common language codes (ISO-639-1) supported by multiple vendors\n * Centralized to avoid duplication in model registries\n */\nexport const COMMON_LANGUAGES = {\n  /**\n   * Languages supported by OpenAI TTS models (50+)\n   * Source: https://platform.openai.com/docs/guides/text-to-speech\n   */\n  OPENAI_TTS: [\n    'en', 'es', 'fr', 'de', 'it', 'pt', 'pl', 'ru', 'ja', 'ko', 'zh', 'ar', 'hi',\n    'nl', 'sv', 'tr', 'af', 'hy', 'az', 'be', 'bs', 'bg', 'ca', 'hr', 'cs', 'da',\n    'et', 'fi', 'gl', 'el', 'he', 'hu', 'is', 'id', 'lv', 'lt', 'mk', 'ms', 'mi',\n    'ne', 'no', 'fa', 'ro', 'sr', 'sk', 'sl', 'sw', 'tl', 'ta', 'th', 'uk', 'ur',\n    'vi', 'cy',\n  ] as const,\n\n  /**\n   * Core languages supported by most vendors\n   */\n  CORE: ['en', 'es', 'fr', 'de', 'it', 'pt', 'ja', 'ko', 'zh', 'ru', 'ar', 'hi'] as const,\n\n  /**\n   * ElevenLabs supported languages\n   * Source: https://elevenlabs.io/docs\n   */\n  ELEVENLABS: [\n    'en', 'es', 'fr', 'de', 'it', 'pt', 'pl', 'ru', 'ja', 'ko', 'zh', 'ar', 'hi',\n    'nl', 'sv', 'tr', 'cs', 'da', 'fi', 'el', 'he', 'hu', 'id', 'ms', 'no', 'ro',\n    'sk', 'th', 'uk', 'vi',\n  ] as const,\n\n  /**\n   * AssemblyAI Universal model languages\n   * Source: https://www.assemblyai.com/docs\n   */\n  ASSEMBLYAI: [\n    'en', 'es', 'fr', 'de', 'it', 'pt', 'nl', 'ja', 'ko', 'zh',\n    'ru', 'ar', 'hi', 'pl', 'tr', 'uk', 'vi',\n  ] as const,\n} as const;\n\n// =============================================================================\n// Audio Format Constants\n// =============================================================================\n\n/**\n * Common audio formats by use case\n */\nexport const AUDIO_FORMATS = {\n  /**\n   * OpenAI TTS output formats\n   * Source: https://platform.openai.com/docs/guides/text-to-speech\n   */\n  OPENAI_TTS: ['mp3', 'opus', 'aac', 'flac', 'wav', 'pcm'] as const,\n\n  /**\n   * ElevenLabs output formats\n   */\n  ELEVENLABS: ['mp3', 'pcm', 'ogg', 'wav'] as const,\n\n  /**\n   * Google TTS output formats\n   */\n  GOOGLE_TTS: ['mp3', 'wav', 'ogg'] as const,\n\n  /**\n   * Common STT input formats (widely supported)\n   */\n  STT_INPUT: ['mp3', 'mp4', 'mpeg', 'mpga', 'm4a', 'wav', 'webm', 'flac', 'ogg'] as const,\n} as const;\n","/**\n * OpenAI Text-to-Speech provider\n * Supports: tts-1, tts-1-hd, gpt-4o-mini-tts\n */\n\nimport OpenAI from 'openai';\nimport { BaseMediaProvider } from '../base/BaseMediaProvider.js';\nimport type { ITextToSpeechProvider, TTSOptions, TTSResponse } from '../../../domain/interfaces/IAudioProvider.js';\nimport type { ProviderCapabilities } from '../../../domain/interfaces/IProvider.js';\nimport type { OpenAIMediaConfig } from '../../../domain/types/ProviderConfig.js';\nimport type { IVoiceInfo } from '../../../domain/entities/SharedVoices.js';\nimport { OPENAI_VOICES } from '../../../domain/entities/SharedVoices.js';\nimport {\n  ProviderAuthError,\n  ProviderRateLimitError,\n  ProviderError,\n} from '../../../domain/errors/AIErrors.js';\n\nexport class OpenAITTSProvider extends BaseMediaProvider implements ITextToSpeechProvider {\n  readonly name: string = 'openai-tts';\n  readonly vendor = 'openai' as const;\n  readonly capabilities: ProviderCapabilities = {\n    text: false,\n    images: false,\n    videos: false,\n    audio: true,\n    features: {\n      textToSpeech: true,\n    },\n  };\n\n  private client: OpenAI;\n\n  constructor(config: OpenAIMediaConfig) {\n    super({ apiKey: config.auth.apiKey, ...config });\n\n    this.client = new OpenAI({\n      apiKey: config.auth.apiKey,\n      baseURL: config.baseURL,\n      organization: config.organization,\n      timeout: config.timeout ?? 60000,\n      maxRetries: config.maxRetries ?? 2,\n    });\n  }\n\n  /**\n   * Synthesize speech from text\n   */\n  async synthesize(options: TTSOptions): Promise<TTSResponse> {\n    return this.executeWithCircuitBreaker(\n      async () => {\n        try {\n          // Map semantic format to OpenAI format\n          const format = this.mapFormat(options.format);\n\n          // Build request parameters\n          const requestParams: OpenAI.Audio.SpeechCreateParams = {\n            model: options.model,\n            input: options.input,\n            voice: options.voice as OpenAI.Audio.SpeechCreateParams['voice'],\n            response_format: format,\n            speed: options.speed,\n          };\n\n          // Add instruction steering if available (gpt-4o-mini-tts)\n          if (options.vendorOptions?.instructions) {\n            (requestParams as any).instructions = options.vendorOptions.instructions;\n          }\n\n          this.logOperationStart('tts.synthesize', {\n            model: options.model,\n            voice: options.voice,\n            inputLength: options.input.length,\n          });\n\n          const response = await this.client.audio.speech.create(requestParams);\n\n          // Convert response to Buffer\n          const arrayBuffer = await response.arrayBuffer();\n          const audio = Buffer.from(arrayBuffer);\n\n          this.logOperationComplete('tts.synthesize', {\n            model: options.model,\n            audioSize: audio.length,\n          });\n\n          return {\n            audio,\n            format: options.format || 'mp3',\n            charactersUsed: options.input.length,\n          };\n        } catch (error: any) {\n          this.handleError(error);\n          throw error; // TypeScript needs this\n        }\n      },\n      'tts.synthesize',\n      { model: options.model, voice: options.voice }\n    );\n  }\n\n  /**\n   * List available voices (returns static list for OpenAI)\n   */\n  async listVoices(): Promise<IVoiceInfo[]> {\n    return OPENAI_VOICES;\n  }\n\n  /**\n   * Map semantic audio format to OpenAI format\n   */\n  private mapFormat(\n    format?: string\n  ): OpenAI.Audio.SpeechCreateParams['response_format'] {\n    switch (format) {\n      case 'mp3':\n        return 'mp3';\n      case 'opus':\n        return 'opus';\n      case 'aac':\n        return 'aac';\n      case 'flac':\n        return 'flac';\n      case 'wav':\n        return 'wav';\n      case 'pcm':\n        return 'pcm';\n      default:\n        return 'mp3';\n    }\n  }\n\n  /**\n   * Handle OpenAI API errors\n   */\n  private handleError(error: any): never {\n    if (error instanceof OpenAI.APIError) {\n      const status = error.status;\n      const message = error.message || 'Unknown OpenAI API error';\n\n      if (status === 401) {\n        throw new ProviderAuthError('openai', 'Invalid API key');\n      }\n\n      if (status === 429) {\n        throw new ProviderRateLimitError('openai');\n      }\n\n      if (status === 400) {\n        throw new ProviderError('openai', `Bad request: ${message}`);\n      }\n\n      throw new ProviderError('openai', message);\n    }\n\n    throw error;\n  }\n}\n","/**\n * OpenAI Speech-to-Text provider\n * Supports: whisper-1, gpt-4o-transcribe, gpt-4o-transcribe-diarize\n */\n\nimport OpenAI from 'openai';\nimport { BaseMediaProvider } from '../base/BaseMediaProvider.js';\nimport type { ISpeechToTextProvider, STTOptions, STTResponse, STTOutputFormat } from '../../../domain/interfaces/IAudioProvider.js';\nimport type { ProviderCapabilities } from '../../../domain/interfaces/IProvider.js';\nimport type { OpenAIMediaConfig } from '../../../domain/types/ProviderConfig.js';\nimport {\n  ProviderAuthError,\n  ProviderRateLimitError,\n  ProviderError,\n} from '../../../domain/errors/AIErrors.js';\nimport * as fs from 'fs';\n\nexport class OpenAISTTProvider extends BaseMediaProvider implements ISpeechToTextProvider {\n  readonly name: string = 'openai-stt';\n  readonly vendor = 'openai' as const;\n  readonly capabilities: ProviderCapabilities = {\n    text: false,\n    images: false,\n    videos: false,\n    audio: true,\n    features: {\n      speechToText: true,\n    },\n  };\n\n  private client: OpenAI;\n\n  constructor(config: OpenAIMediaConfig) {\n    super({ apiKey: config.auth.apiKey, ...config });\n\n    this.client = new OpenAI({\n      apiKey: config.auth.apiKey,\n      baseURL: config.baseURL,\n      organization: config.organization,\n      timeout: config.timeout ?? 120000, // 2 minutes for audio processing\n      maxRetries: config.maxRetries ?? 2,\n    });\n  }\n\n  /**\n   * Transcribe audio to text\n   */\n  async transcribe(options: STTOptions): Promise<STTResponse> {\n    return this.executeWithCircuitBreaker(\n      async () => {\n        try {\n          this.logOperationStart('stt.transcribe', {\n            model: options.model,\n            language: options.language,\n            format: options.outputFormat,\n          });\n\n          // Prepare audio file\n          const audioFile = await this.prepareAudioFile(options.audio);\n\n          // Build request parameters\n          const requestParams: Partial<OpenAI.Audio.TranscriptionCreateParams> = {\n            model: options.model,\n            file: audioFile,\n            language: options.language,\n            prompt: options.prompt,\n            temperature: options.temperature,\n          };\n\n          // Map output format\n          if (options.outputFormat) {\n            requestParams.response_format = this.mapOutputFormat(options.outputFormat);\n          } else if (options.includeTimestamps) {\n            requestParams.response_format = 'verbose_json';\n          }\n\n          // Add timestamp granularity if needed\n          if (options.includeTimestamps && options.timestampGranularity) {\n            requestParams.timestamp_granularities = [options.timestampGranularity];\n          }\n\n          // Add diarization options if using diarize model\n          if (options.model.includes('diarize') && options.vendorOptions?.max_speakers) {\n            (requestParams as any).max_speakers = options.vendorOptions.max_speakers;\n          }\n\n          const response: any = await this.client.audio.transcriptions.create(\n            requestParams as any\n          );\n\n          this.logOperationComplete('stt.transcribe', {\n            model: options.model,\n            textLength: typeof response === 'string' ? response.length : response.text?.length || 0,\n          });\n\n          return this.convertResponse(response);\n        } catch (error: any) {\n          this.handleError(error);\n          throw error; // TypeScript needs this\n        }\n      },\n      'stt.transcribe',\n      { model: options.model }\n    );\n  }\n\n  /**\n   * Translate audio to English text\n   */\n  async translate(options: STTOptions): Promise<STTResponse> {\n    return this.executeWithCircuitBreaker(\n      async () => {\n        try {\n          this.logOperationStart('stt.translate', {\n            model: options.model,\n          });\n\n          const audioFile = await this.prepareAudioFile(options.audio);\n\n          const requestParams: Partial<OpenAI.Audio.TranslationCreateParams> = {\n            model: options.model,\n            file: audioFile,\n            prompt: options.prompt,\n            temperature: options.temperature,\n          };\n\n          if (options.outputFormat) {\n            // Translation API has more restricted response_format options\n            requestParams.response_format = this.mapOutputFormat(options.outputFormat) as\n              | 'text'\n              | 'json'\n              | 'srt'\n              | 'vtt'\n              | 'verbose_json';\n          }\n\n          const response: any = await this.client.audio.translations.create(\n            requestParams as any\n          );\n\n          this.logOperationComplete('stt.translate', {\n            model: options.model,\n            textLength: typeof response === 'string' ? response.length : response.text?.length || 0,\n          });\n\n          return this.convertResponse(response);\n        } catch (error: any) {\n          this.handleError(error);\n          throw error;\n        }\n      },\n      'stt.translate',\n      { model: options.model }\n    );\n  }\n\n  /**\n   * Prepare audio file for API request\n   * Handles both Buffer and file path inputs\n   */\n  private async prepareAudioFile(audio: Buffer | string): Promise<any> {\n    if (Buffer.isBuffer(audio)) {\n      // Convert Buffer to File-like object that OpenAI SDK expects\n      const blob = new Blob([audio]);\n      return new File([blob], 'audio.wav', { type: 'audio/wav' });\n    } else if (typeof audio === 'string') {\n      // File path - create ReadStream\n      return fs.createReadStream(audio);\n    } else {\n      throw new Error('Invalid audio input: must be Buffer or file path');\n    }\n  }\n\n  /**\n   * Map semantic output format to OpenAI format\n   */\n  private mapOutputFormat(format: STTOutputFormat): OpenAI.Audio.AudioResponseFormat {\n    switch (format) {\n      case 'json':\n        return 'json';\n      case 'text':\n        return 'text';\n      case 'srt':\n        return 'srt';\n      case 'vtt':\n        return 'vtt';\n      case 'verbose_json':\n        return 'verbose_json';\n      default:\n        return 'json';\n    }\n  }\n\n  /**\n   * Convert OpenAI response to our standard format\n   */\n  private convertResponse(response: OpenAI.Audio.Transcription | string): STTResponse {\n    // Handle simple string response\n    if (typeof response === 'string') {\n      return { text: response };\n    }\n\n    // Cast to access extended properties\n    const extResponse = response as any;\n\n    // Handle JSON response\n    const result: STTResponse = {\n      text: response.text,\n      language: extResponse.language,\n      durationSeconds: extResponse.duration,\n    };\n\n    // Add word timestamps if available\n    if ((response as any).words) {\n      result.words = (response as any).words.map((w: any) => ({\n        word: w.word,\n        start: w.start,\n        end: w.end,\n      }));\n    }\n\n    // Add segment timestamps if available\n    if ((response as any).segments) {\n      result.segments = (response as any).segments.map((s: any) => ({\n        id: s.id,\n        text: s.text,\n        start: s.start,\n        end: s.end,\n        tokens: s.tokens,\n      }));\n    }\n\n    return result;\n  }\n\n  /**\n   * Handle OpenAI API errors\n   */\n  private handleError(error: any): never {\n    if (error instanceof OpenAI.APIError) {\n      const status = error.status;\n      const message = error.message || 'Unknown OpenAI API error';\n\n      if (status === 401) {\n        throw new ProviderAuthError('openai', 'Invalid API key');\n      }\n\n      if (status === 429) {\n        throw new ProviderRateLimitError('openai');\n      }\n\n      if (status === 400) {\n        throw new ProviderError('openai', `Bad request: ${message}`);\n      }\n\n      if (status === 413) {\n        throw new ProviderError('openai', 'Audio file too large (max 25MB)');\n      }\n\n      throw new ProviderError('openai', message);\n    }\n\n    throw error;\n  }\n}\n","/**\n * Google Gemini Text-to-Speech provider\n * Supports: gemini-2.5-flash-preview-tts, gemini-2.5-pro-preview-tts\n */\n\nimport { GoogleGenAI } from '@google/genai';\nimport { BaseMediaProvider } from '../base/BaseMediaProvider.js';\nimport type { ITextToSpeechProvider, TTSOptions, TTSResponse } from '../../../domain/interfaces/IAudioProvider.js';\nimport type { ProviderCapabilities } from '../../../domain/interfaces/IProvider.js';\nimport type { GoogleConfig } from '../../../domain/types/ProviderConfig.js';\nimport type { IVoiceInfo } from '../../../domain/entities/SharedVoices.js';\nimport { GEMINI_VOICES } from '../../../domain/entities/SharedVoices.js';\nimport {\n  ProviderAuthError,\n  ProviderRateLimitError,\n  ProviderError,\n} from '../../../domain/errors/AIErrors.js';\n\nexport class GoogleTTSProvider extends BaseMediaProvider implements ITextToSpeechProvider {\n  readonly name: string = 'google-tts';\n  readonly vendor = 'google' as const;\n  readonly capabilities: ProviderCapabilities = {\n    text: false,\n    images: false,\n    videos: false,\n    audio: true,\n    features: {\n      textToSpeech: true,\n    },\n  };\n\n  private client: GoogleGenAI;\n\n  constructor(config: GoogleConfig) {\n    super(config);\n\n    this.client = new GoogleGenAI({\n      apiKey: config.apiKey,\n    });\n  }\n\n  /**\n   * Synthesize speech from text using Gemini TTS\n   */\n  async synthesize(options: TTSOptions): Promise<TTSResponse> {\n    return this.executeWithCircuitBreaker(\n      async () => {\n        try {\n          this.logOperationStart('tts.synthesize', {\n            model: options.model,\n            voice: options.voice,\n            inputLength: options.input.length,\n          });\n\n          // Build the request with speech config\n          const result = await this.client.models.generateContent({\n            model: options.model,\n            contents: [\n              {\n                parts: [{ text: options.input }],\n              },\n            ],\n            config: {\n              responseModalities: ['AUDIO'],\n              speechConfig: {\n                voiceConfig: {\n                  prebuiltVoiceConfig: {\n                    voiceName: options.voice || 'Kore',\n                  },\n                },\n              },\n            },\n          });\n\n          // Extract audio data from response\n          const audioData = this.extractAudioData(result);\n\n          if (!audioData) {\n            throw new ProviderError('google', 'No audio data in response');\n          }\n\n          this.logOperationComplete('tts.synthesize', {\n            model: options.model,\n            audioSize: audioData.length,\n          });\n\n          return {\n            audio: audioData,\n            format: 'wav', // Gemini outputs PCM 24kHz 16-bit, we convert to WAV\n            charactersUsed: options.input.length,\n          };\n        } catch (error: any) {\n          this.handleError(error);\n          throw error; // TypeScript needs this\n        }\n      },\n      'tts.synthesize',\n      { model: options.model, voice: options.voice }\n    );\n  }\n\n  /**\n   * List available voices (returns static list for Google)\n   */\n  async listVoices(): Promise<IVoiceInfo[]> {\n    return GEMINI_VOICES;\n  }\n\n  /**\n   * Extract audio data from Gemini response\n   * Gemini returns raw PCM data (24kHz, 16-bit, mono), we wrap it in WAV format\n   */\n  private extractAudioData(result: any): Buffer | null {\n    const candidates = result.candidates;\n    if (!candidates || candidates.length === 0) {\n      return null;\n    }\n\n    const content = candidates[0]?.content;\n    if (!content?.parts || content.parts.length === 0) {\n      return null;\n    }\n\n    // Find the audio part\n    for (const part of content.parts) {\n      if (part.inlineData?.data) {\n        // Decode base64 audio data\n        const rawPcm = Buffer.from(part.inlineData.data, 'base64');\n\n        // Wrap PCM in WAV format\n        return this.pcmToWav(rawPcm, 24000, 1, 16);\n      }\n    }\n\n    return null;\n  }\n\n  /**\n   * Convert raw PCM data to WAV format\n   * @param pcmData - Raw PCM data buffer\n   * @param sampleRate - Sample rate in Hz (default 24000 for Gemini)\n   * @param channels - Number of channels (default 1 for mono)\n   * @param bitsPerSample - Bits per sample (default 16)\n   */\n  private pcmToWav(\n    pcmData: Buffer,\n    sampleRate: number = 24000,\n    channels: number = 1,\n    bitsPerSample: number = 16\n  ): Buffer {\n    const byteRate = (sampleRate * channels * bitsPerSample) / 8;\n    const blockAlign = (channels * bitsPerSample) / 8;\n    const dataSize = pcmData.length;\n    const headerSize = 44;\n    const fileSize = headerSize + dataSize;\n\n    const header = Buffer.alloc(headerSize);\n\n    // RIFF header\n    header.write('RIFF', 0);\n    header.writeUInt32LE(fileSize - 8, 4); // File size - 8\n    header.write('WAVE', 8);\n\n    // fmt sub-chunk\n    header.write('fmt ', 12);\n    header.writeUInt32LE(16, 16); // Sub-chunk size (16 for PCM)\n    header.writeUInt16LE(1, 20); // Audio format (1 = PCM)\n    header.writeUInt16LE(channels, 22); // Number of channels\n    header.writeUInt32LE(sampleRate, 24); // Sample rate\n    header.writeUInt32LE(byteRate, 28); // Byte rate\n    header.writeUInt16LE(blockAlign, 32); // Block align\n    header.writeUInt16LE(bitsPerSample, 34); // Bits per sample\n\n    // data sub-chunk\n    header.write('data', 36);\n    header.writeUInt32LE(dataSize, 40); // Data size\n\n    return Buffer.concat([header, pcmData]);\n  }\n\n  /**\n   * Handle Google API errors\n   */\n  private handleError(error: any): never {\n    const message = error.message || 'Unknown Google API error';\n    const status = error.status || error.code;\n\n    if (status === 401 || message.includes('API key not valid')) {\n      throw new ProviderAuthError('google', 'Invalid API key');\n    }\n\n    if (status === 429 || message.includes('Resource exhausted')) {\n      throw new ProviderRateLimitError('google', message);\n    }\n\n    if (status === 400) {\n      throw new ProviderError('google', `Bad request: ${message}`);\n    }\n\n    throw new ProviderError('google', message);\n  }\n}\n","/**\n * Factory functions for creating audio providers (TTS and STT)\n */\n\nimport { Connector } from './Connector.js';\nimport type { ITextToSpeechProvider } from '../domain/interfaces/IAudioProvider.js';\nimport type { ISpeechToTextProvider } from '../domain/interfaces/IAudioProvider.js';\nimport { Vendor } from './Vendor.js';\nimport { OpenAITTSProvider } from '../infrastructure/providers/openai/OpenAITTSProvider.js';\nimport { OpenAISTTProvider } from '../infrastructure/providers/openai/OpenAISTTProvider.js';\nimport { GoogleTTSProvider } from '../infrastructure/providers/google/GoogleTTSProvider.js';\nimport type { OpenAIMediaConfig, GoogleConfig } from '../domain/types/ProviderConfig.js';\n\n/**\n * Create a Text-to-Speech provider from a connector\n */\nexport function createTTSProvider(connector: Connector): ITextToSpeechProvider {\n  const vendor = connector.vendor;\n\n  switch (vendor) {\n    case Vendor.OpenAI:\n      return new OpenAITTSProvider(extractOpenAIConfig(connector));\n\n    case Vendor.Google:\n      return new GoogleTTSProvider(extractGoogleConfig(connector));\n\n    default:\n      throw new Error(\n        `No TTS provider available for vendor: ${vendor}. ` +\n        `Supported vendors: ${Vendor.OpenAI}, ${Vendor.Google}`\n      );\n  }\n}\n\n/**\n * Create a Speech-to-Text provider from a connector\n */\nexport function createSTTProvider(connector: Connector): ISpeechToTextProvider {\n  const vendor = connector.vendor;\n\n  switch (vendor) {\n    case Vendor.OpenAI:\n      return new OpenAISTTProvider(extractOpenAIConfig(connector));\n\n    case Vendor.Groq:\n      // TODO: Implement GroqSTTProvider (Whisper on Groq)\n      throw new Error(`Groq STT provider not yet implemented`);\n\n    case Vendor.Google:\n      // TODO: Implement GoogleSTTProvider\n      throw new Error(`Google STT provider not yet implemented`);\n\n    default:\n      throw new Error(\n        `No STT provider available for vendor: ${vendor}. ` +\n        `Supported vendors: ${Vendor.OpenAI}, ${Vendor.Groq}`\n      );\n  }\n}\n\n/**\n * Extract OpenAI configuration from connector\n */\nfunction extractOpenAIConfig(connector: Connector): OpenAIMediaConfig {\n  const auth = connector.config.auth;\n\n  if (auth.type !== 'api_key') {\n    throw new Error('OpenAI requires API key authentication');\n  }\n\n  const options = connector.getOptions();\n\n  return {\n    auth: {\n      type: 'api_key',\n      apiKey: auth.apiKey,\n    },\n    baseURL: connector.baseURL,\n    organization: options.organization as string | undefined,\n    timeout: options.timeout as number | undefined,\n    maxRetries: options.maxRetries as number | undefined,\n  };\n}\n\n/**\n * Extract Google configuration from connector\n */\nfunction extractGoogleConfig(connector: Connector): GoogleConfig {\n  const auth = connector.config.auth;\n\n  if (auth.type !== 'api_key') {\n    throw new Error('Google requires API key authentication');\n  }\n\n  return {\n    apiKey: auth.apiKey,\n  };\n}\n","/**\n * Generic utilities for model registries\n * Eliminates code duplication across Image, TTS, STT, and Video registries\n */\n\nimport type { Vendor as VendorType } from '../../core/Vendor.js';\nimport type { IBaseModelDescription } from '../types/SharedTypes.js';\n\n/**\n * Creates standard helper functions for any model registry\n * This eliminates the need to write the same helper functions for each registry\n *\n * @example\n * ```typescript\n * const helpers = createRegistryHelpers(IMAGE_MODEL_REGISTRY);\n * export const getImageModelInfo = helpers.getInfo;\n * export const getImageModelsByVendor = helpers.getByVendor;\n * export const getActiveImageModels = helpers.getActive;\n * ```\n */\nexport function createRegistryHelpers<T extends IBaseModelDescription>(\n  registry: Record<string, T>\n) {\n  return {\n    /**\n     * Get model information by name\n     */\n    getInfo: (modelName: string): T | undefined => {\n      return registry[modelName];\n    },\n\n    /**\n     * Get all active models for a specific vendor\n     */\n    getByVendor: (vendor: VendorType): T[] => {\n      return Object.values(registry).filter(\n        (model) => model.provider === vendor && model.isActive\n      );\n    },\n\n    /**\n     * Get all currently active models (across all vendors)\n     */\n    getActive: (): T[] => {\n      return Object.values(registry).filter((model) => model.isActive);\n    },\n\n    /**\n     * Get all models (including inactive/deprecated)\n     */\n    getAll: (): T[] => {\n      return Object.values(registry);\n    },\n\n    /**\n     * Check if model exists in registry\n     */\n    has: (modelName: string): boolean => {\n      return modelName in registry;\n    },\n  };\n}\n\n/**\n * Creates feature-based filter for registries with capabilities\n * Used to find models that support specific features\n *\n * @example\n * ```typescript\n * const filter = createCapabilityFilter(IMAGE_MODEL_REGISTRY);\n * const modelsWithInpainting = filter.withFeature('inputModes').filter(\n *   m => m.capabilities.inputModes.inpainting\n * );\n * ```\n */\nexport function createCapabilityFilter<\n  T extends IBaseModelDescription & { capabilities: Record<string, unknown> }\n>(registry: Record<string, T>) {\n  return {\n    /**\n     * Get models that have a specific capability feature\n     * @param feature - The capability feature to filter by\n     * @param value - Optional specific value to match (if undefined, just checks truthy)\n     */\n    withFeature: <K extends keyof T['capabilities']>(\n      feature: K,\n      value?: T['capabilities'][K]\n    ): T[] => {\n      return Object.values(registry).filter((model) => {\n        if (!model.isActive) return false;\n\n        const capValue = (model.capabilities as Record<string, unknown>)[feature as string];\n\n        // If specific value provided, match exactly\n        if (value !== undefined) {\n          return capValue === value;\n        }\n\n        // Otherwise check if feature exists and is truthy\n        return Array.isArray(capValue) ? capValue.length > 0 : Boolean(capValue);\n      });\n    },\n  };\n}\n","/**\n * Text-to-Speech model registry with comprehensive metadata\n */\n\nimport { Vendor } from '../../core/Vendor.js';\nimport type { IBaseModelDescription, AudioFormat, VendorOptionSchema } from '../types/SharedTypes.js';\nimport { createRegistryHelpers } from './RegistryUtils.js';\nimport { OPENAI_VOICES, GEMINI_VOICES, GEMINI_TTS_LANGUAGES, COMMON_LANGUAGES, AUDIO_FORMATS, type IVoiceInfo } from './SharedVoices.js';\n\n// Re-export IVoiceInfo for public API\nexport type { IVoiceInfo } from './SharedVoices.js';\n\n// =============================================================================\n// Types\n// =============================================================================\n\n/**\n * TTS model capabilities\n */\nexport interface TTSModelCapabilities {\n  /** Available voices (empty array means fetch dynamically via API) */\n  voices: IVoiceInfo[];\n\n  /** Supported output formats */\n  formats: readonly AudioFormat[] | AudioFormat[];\n\n  /** Supported languages (ISO-639-1 codes) */\n  languages: readonly string[] | string[];\n\n  /** Speed control support */\n  speed: {\n    supported: boolean;\n    min?: number;\n    max?: number;\n    default?: number;\n  };\n\n  /** Feature support flags */\n  features: {\n    /** Real-time streaming support */\n    streaming: boolean;\n    /** SSML markup support */\n    ssml: boolean;\n    /** Emotion/style control */\n    emotions: boolean;\n    /** Custom voice cloning */\n    voiceCloning: boolean;\n    /** Word-level timestamps */\n    wordTimestamps: boolean;\n    /** Instruction steering (prompt-based style control) */\n    instructionSteering?: boolean;\n  };\n\n  /** Model limits */\n  limits: {\n    /** Maximum input length in characters */\n    maxInputLength: number;\n    /** Rate limit (requests per minute) */\n    maxRequestsPerMinute?: number;\n  };\n\n  /** Vendor-specific options schema */\n  vendorOptions?: Record<string, VendorOptionSchema>;\n}\n\n/**\n * TTS model pricing\n */\nexport interface TTSModelPricing {\n  /** Cost per 1,000 characters */\n  per1kCharacters: number;\n  currency: 'USD';\n}\n\n/**\n * Complete TTS model description\n */\nexport interface ITTSModelDescription extends IBaseModelDescription {\n  capabilities: TTSModelCapabilities;\n  pricing?: TTSModelPricing;\n}\n\n// =============================================================================\n// Model Constants\n// =============================================================================\n\nexport const TTS_MODELS = {\n  [Vendor.OpenAI]: {\n    /** NEW: Instruction-steerable TTS with emotional control */\n    GPT_4O_MINI_TTS: 'gpt-4o-mini-tts',\n    /** Fast, low-latency TTS */\n    TTS_1: 'tts-1',\n    /** High-definition TTS */\n    TTS_1_HD: 'tts-1-hd',\n  },\n  [Vendor.Google]: {\n    /** Gemini 2.5 Flash TTS (optimized for low latency) */\n    GEMINI_2_5_FLASH_TTS: 'gemini-2.5-flash-preview-tts',\n    /** Gemini 2.5 Pro TTS (optimized for quality) */\n    GEMINI_2_5_PRO_TTS: 'gemini-2.5-pro-preview-tts',\n  },\n} as const;\n\n// =============================================================================\n// Shared Capability Presets (DRY)\n// =============================================================================\n\n/**\n * Base OpenAI TTS capabilities (shared across models)\n */\nconst OPENAI_TTS_BASE: Omit<TTSModelCapabilities, 'features' | 'limits'> = {\n  voices: OPENAI_VOICES,\n  formats: AUDIO_FORMATS.OPENAI_TTS,\n  languages: COMMON_LANGUAGES.OPENAI_TTS,\n  speed: { supported: true, min: 0.25, max: 4.0, default: 1.0 },\n};\n\n// =============================================================================\n// Registry\n// =============================================================================\n\n/**\n * Complete TTS model registry\n * Last full audit: January 2026\n */\nexport const TTS_MODEL_REGISTRY: Record<string, ITTSModelDescription> = {\n  // ======================== OpenAI ========================\n\n  'gpt-4o-mini-tts': {\n    name: 'gpt-4o-mini-tts',\n    displayName: 'GPT-4o Mini TTS',\n    provider: Vendor.OpenAI,\n    description: 'Instruction-steerable TTS with emotional control via prompts',\n    isActive: true,\n    releaseDate: '2025-03-01',\n    sources: {\n      documentation: 'https://platform.openai.com/docs/guides/text-to-speech',\n      pricing: 'https://openai.com/pricing',\n      lastVerified: '2026-01-24',\n    },\n    capabilities: {\n      ...OPENAI_TTS_BASE,\n      features: {\n        streaming: false, // Not implementing streaming in v1\n        ssml: false,\n        emotions: true, // Via instruction steering\n        voiceCloning: true,\n        wordTimestamps: false,\n        instructionSteering: true,\n      },\n      limits: { maxInputLength: 2000 },\n      vendorOptions: {\n        instructions: {\n          type: 'string',\n          description: 'Natural language instructions for voice style (e.g., \"speak like a calm meditation guide\")',\n        },\n      },\n    },\n    pricing: { per1kCharacters: 0.015, currency: 'USD' },\n  },\n\n  'tts-1': {\n    name: 'tts-1',\n    displayName: 'TTS-1',\n    provider: Vendor.OpenAI,\n    description: 'Fast, low-latency text-to-speech optimized for real-time use',\n    isActive: true,\n    releaseDate: '2023-11-06',\n    sources: {\n      documentation: 'https://platform.openai.com/docs/guides/text-to-speech',\n      pricing: 'https://openai.com/pricing',\n      lastVerified: '2026-01-24',\n    },\n    capabilities: {\n      ...OPENAI_TTS_BASE,\n      features: {\n        streaming: false, // Not implementing streaming in v1\n        ssml: false,\n        emotions: false,\n        voiceCloning: false,\n        wordTimestamps: false,\n      },\n      limits: { maxInputLength: 4096 },\n    },\n    pricing: { per1kCharacters: 0.015, currency: 'USD' },\n  },\n\n  'tts-1-hd': {\n    name: 'tts-1-hd',\n    displayName: 'TTS-1 HD',\n    provider: Vendor.OpenAI,\n    description: 'High-definition text-to-speech with improved audio quality',\n    isActive: true,\n    releaseDate: '2023-11-06',\n    sources: {\n      documentation: 'https://platform.openai.com/docs/guides/text-to-speech',\n      pricing: 'https://openai.com/pricing',\n      lastVerified: '2026-01-24',\n    },\n    capabilities: {\n      ...OPENAI_TTS_BASE,\n      features: {\n        streaming: false, // Not implementing streaming in v1\n        ssml: false,\n        emotions: false,\n        voiceCloning: false,\n        wordTimestamps: false,\n      },\n      limits: { maxInputLength: 4096 },\n    },\n    pricing: { per1kCharacters: 0.030, currency: 'USD' },\n  },\n\n  // ======================== Google ========================\n\n  'gemini-2.5-flash-preview-tts': {\n    name: 'gemini-2.5-flash-preview-tts',\n    displayName: 'Gemini 2.5 Flash TTS',\n    provider: Vendor.Google,\n    description: 'Google Gemini 2.5 Flash TTS - optimized for low latency',\n    isActive: true,\n    releaseDate: '2025-01-01',\n    sources: {\n      documentation: 'https://ai.google.dev/gemini-api/docs/speech-generation',\n      pricing: 'https://ai.google.dev/pricing',\n      lastVerified: '2026-01-25',\n    },\n    capabilities: {\n      voices: GEMINI_VOICES,\n      formats: ['wav'] as const, // PCM output, 24kHz 16-bit mono\n      languages: [...GEMINI_TTS_LANGUAGES],\n      speed: { supported: false }, // Speed not directly configurable\n      features: {\n        streaming: false, // Not implementing streaming in v1\n        ssml: false,\n        emotions: true, // Supports affective dialogue\n        voiceCloning: false,\n        wordTimestamps: false,\n      },\n      limits: { maxInputLength: 32000 }, // 32k tokens\n    },\n  },\n\n  'gemini-2.5-pro-preview-tts': {\n    name: 'gemini-2.5-pro-preview-tts',\n    displayName: 'Gemini 2.5 Pro TTS',\n    provider: Vendor.Google,\n    description: 'Google Gemini 2.5 Pro TTS - optimized for quality',\n    isActive: true,\n    releaseDate: '2025-01-01',\n    sources: {\n      documentation: 'https://ai.google.dev/gemini-api/docs/speech-generation',\n      pricing: 'https://ai.google.dev/pricing',\n      lastVerified: '2026-01-25',\n    },\n    capabilities: {\n      voices: GEMINI_VOICES,\n      formats: ['wav'] as const, // PCM output, 24kHz 16-bit mono\n      languages: [...GEMINI_TTS_LANGUAGES],\n      speed: { supported: false }, // Speed not directly configurable\n      features: {\n        streaming: false, // Not implementing streaming in v1\n        ssml: false,\n        emotions: true, // Supports affective dialogue\n        voiceCloning: false,\n        wordTimestamps: false,\n      },\n      limits: { maxInputLength: 32000 }, // 32k tokens\n    },\n  },\n};\n\n// =============================================================================\n// Helper Functions (using shared utilities)\n// =============================================================================\n\nconst helpers = createRegistryHelpers(TTS_MODEL_REGISTRY);\n\nexport const getTTSModelInfo = helpers.getInfo;\nexport const getTTSModelsByVendor = helpers.getByVendor;\nexport const getActiveTTSModels = helpers.getActive;\n\n/**\n * Get TTS models that support a specific feature\n */\nexport function getTTSModelsWithFeature(\n  feature: keyof ITTSModelDescription['capabilities']['features']\n): ITTSModelDescription[] {\n  return Object.values(TTS_MODEL_REGISTRY).filter(\n    (model) => model.isActive && model.capabilities.features[feature]\n  );\n}\n\n/**\n * Calculate estimated cost for TTS\n */\nexport function calculateTTSCost(modelName: string, characterCount: number): number | null {\n  const model = getTTSModelInfo(modelName);\n  if (!model?.pricing) return null;\n  return (characterCount / 1000) * model.pricing.per1kCharacters;\n}\n","/**\n * SpeechToText capability class\n * Provides high-level API for speech-to-text transcription\n */\n\nimport { Connector } from './Connector.js';\nimport { createSTTProvider } from './createAudioProvider.js';\nimport type { ISpeechToTextProvider, STTOptions, STTResponse } from '../domain/interfaces/IAudioProvider.js';\nimport { getSTTModelInfo, getSTTModelsByVendor, type ISTTModelDescription } from '../domain/entities/STTModel.js';\nimport * as fs from 'fs/promises';\n\n/**\n * Configuration for SpeechToText capability\n */\nexport interface SpeechToTextConfig {\n  /** Connector name or instance */\n  connector: string | Connector;\n\n  /** Default model to use */\n  model?: string;\n\n  /** Default language (ISO-639-1 code) */\n  language?: string;\n\n  /** Default temperature for sampling */\n  temperature?: number;\n}\n\n/**\n * SpeechToText capability class\n * Provides speech-to-text transcription with model introspection\n *\n * @example\n * ```typescript\n * const stt = SpeechToText.create({\n *   connector: 'openai',\n *   model: 'whisper-1',\n * });\n *\n * const result = await stt.transcribe(audioBuffer);\n * console.log(result.text);\n *\n * const detailed = await stt.transcribeWithTimestamps(audioBuffer, 'word');\n * console.log(detailed.words);\n * ```\n */\nexport class SpeechToText {\n  private provider: ISpeechToTextProvider;\n  private config: SpeechToTextConfig;\n\n  /**\n   * Create a new SpeechToText instance\n   */\n  static create(config: SpeechToTextConfig): SpeechToText {\n    return new SpeechToText(config);\n  }\n\n  private constructor(config: SpeechToTextConfig) {\n    const connector = typeof config.connector === 'string'\n      ? Connector.get(config.connector)\n      : config.connector;\n\n    this.provider = createSTTProvider(connector);\n    this.config = config;\n  }\n\n  // ======================== Transcription Methods ========================\n\n  /**\n   * Transcribe audio to text\n   *\n   * @param audio - Audio data as Buffer or file path\n   * @param options - Optional transcription parameters\n   * @returns Transcription result with text and metadata\n   */\n  async transcribe(\n    audio: Buffer | string,\n    options?: Partial<Omit<STTOptions, 'model' | 'audio'>>\n  ): Promise<STTResponse> {\n    const fullOptions: STTOptions = {\n      model: this.config.model ?? this.getDefaultModel(),\n      audio,\n      language: options?.language ?? this.config.language,\n      outputFormat: options?.outputFormat,\n      includeTimestamps: options?.includeTimestamps,\n      timestampGranularity: options?.timestampGranularity,\n      prompt: options?.prompt,\n      temperature: options?.temperature ?? this.config.temperature,\n      vendorOptions: options?.vendorOptions,\n    };\n\n    return this.provider.transcribe(fullOptions);\n  }\n\n  /**\n   * Transcribe audio file by path\n   *\n   * @param filePath - Path to audio file\n   * @param options - Optional transcription parameters\n   */\n  async transcribeFile(\n    filePath: string,\n    options?: Partial<Omit<STTOptions, 'model' | 'audio'>>\n  ): Promise<STTResponse> {\n    const audio = await fs.readFile(filePath);\n    return this.transcribe(audio, options);\n  }\n\n  /**\n   * Transcribe audio with word or segment timestamps\n   *\n   * @param audio - Audio data as Buffer or file path\n   * @param granularity - Timestamp granularity ('word' or 'segment')\n   * @param options - Optional transcription parameters\n   */\n  async transcribeWithTimestamps(\n    audio: Buffer | string,\n    granularity: 'word' | 'segment' = 'segment',\n    options?: Partial<Omit<STTOptions, 'model' | 'audio' | 'includeTimestamps' | 'timestampGranularity'>>\n  ): Promise<STTResponse> {\n    return this.transcribe(audio, {\n      ...options,\n      outputFormat: 'verbose_json',\n      includeTimestamps: true,\n      timestampGranularity: granularity,\n    });\n  }\n\n  /**\n   * Translate audio to English text\n   * Note: Only supported by some models (e.g., Whisper)\n   *\n   * @param audio - Audio data as Buffer or file path\n   * @param options - Optional transcription parameters\n   */\n  async translate(\n    audio: Buffer | string,\n    options?: Partial<Omit<STTOptions, 'model' | 'audio'>>\n  ): Promise<STTResponse> {\n    if (!this.provider.translate) {\n      throw new Error('Translation not supported by this provider');\n    }\n\n    const fullOptions: STTOptions = {\n      model: this.config.model ?? this.getDefaultModel(),\n      audio,\n      outputFormat: options?.outputFormat,\n      prompt: options?.prompt,\n      temperature: options?.temperature ?? this.config.temperature,\n      vendorOptions: options?.vendorOptions,\n    };\n\n    return this.provider.translate(fullOptions);\n  }\n\n  // ======================== Introspection Methods ========================\n\n  /**\n   * Get model information for current or specified model\n   */\n  getModelInfo(model?: string): ISTTModelDescription {\n    const targetModel = model ?? this.config.model ?? this.getDefaultModel();\n    const info = getSTTModelInfo(targetModel);\n\n    if (!info) {\n      throw new Error(`Unknown STT model: ${targetModel}`);\n    }\n\n    return info;\n  }\n\n  /**\n   * Get model capabilities\n   */\n  getModelCapabilities(model?: string) {\n    return this.getModelInfo(model).capabilities;\n  }\n\n  /**\n   * List all available models for this provider's vendor\n   */\n  listAvailableModels(): ISTTModelDescription[] {\n    const vendor = this.provider.vendor;\n    if (!vendor) {\n      return [];\n    }\n    return getSTTModelsByVendor(vendor as any);\n  }\n\n  /**\n   * Check if a specific feature is supported by the model\n   */\n  supportsFeature(\n    feature: keyof ISTTModelDescription['capabilities']['features'],\n    model?: string\n  ): boolean {\n    const caps = this.getModelCapabilities(model);\n    return Boolean(caps.features[feature]);\n  }\n\n  /**\n   * Get supported input audio formats\n   */\n  getSupportedInputFormats(model?: string): readonly string[] | string[] {\n    return this.getModelCapabilities(model).inputFormats;\n  }\n\n  /**\n   * Get supported output formats\n   */\n  getSupportedOutputFormats(model?: string): readonly string[] {\n    return this.getModelCapabilities(model).outputFormats;\n  }\n\n  /**\n   * Get supported languages (empty array = auto-detect all)\n   */\n  getSupportedLanguages(model?: string): readonly string[] {\n    return this.getModelCapabilities(model).languages;\n  }\n\n  /**\n   * Check if timestamps are supported\n   */\n  supportsTimestamps(model?: string): boolean {\n    return this.getModelCapabilities(model).timestamps.supported;\n  }\n\n  /**\n   * Check if translation is supported\n   */\n  supportsTranslation(model?: string): boolean {\n    return this.supportsFeature('translation', model);\n  }\n\n  /**\n   * Check if speaker diarization is supported\n   */\n  supportsDiarization(model?: string): boolean {\n    return this.supportsFeature('diarization', model);\n  }\n\n  /**\n   * Get timestamp granularities supported\n   */\n  getTimestampGranularities(model?: string): ('word' | 'segment')[] | undefined {\n    return this.getModelCapabilities(model).timestamps.granularities;\n  }\n\n  // ======================== Configuration Methods ========================\n\n  /**\n   * Update default model\n   */\n  setModel(model: string): void {\n    this.config.model = model;\n  }\n\n  /**\n   * Update default language\n   */\n  setLanguage(language: string): void {\n    this.config.language = language;\n  }\n\n  /**\n   * Update default temperature\n   */\n  setTemperature(temperature: number): void {\n    this.config.temperature = temperature;\n  }\n\n  // ======================== Private Methods ========================\n\n  /**\n   * Get default model (first active model for vendor)\n   */\n  private getDefaultModel(): string {\n    const models = this.listAvailableModels();\n    const firstModel = models[0];\n    if (!firstModel) {\n      throw new Error('No STT models available for this provider');\n    }\n    return firstModel.name;\n  }\n}\n","/**\n * Speech-to-Text model registry with comprehensive metadata\n */\n\nimport { Vendor } from '../../core/Vendor.js';\nimport type { IBaseModelDescription, VendorOptionSchema } from '../types/SharedTypes.js';\nimport { createRegistryHelpers } from './RegistryUtils.js';\nimport { AUDIO_FORMATS } from './SharedVoices.js';\n\n// =============================================================================\n// Types\n// =============================================================================\n\n/**\n * STT output format types\n */\nexport type STTOutputFormat = 'json' | 'text' | 'srt' | 'vtt' | 'verbose_json';\n\n/**\n * STT model capabilities\n */\nexport interface STTModelCapabilities {\n  /** Supported input audio formats */\n  inputFormats: readonly string[] | string[];\n\n  /** Supported output formats */\n  outputFormats: STTOutputFormat[];\n\n  /** Supported languages (empty = auto-detect all) */\n  languages: string[];\n\n  /** Timestamp support */\n  timestamps: {\n    supported: boolean;\n    granularities?: ('word' | 'segment')[];\n  };\n\n  /** Feature support flags */\n  features: {\n    /** Translation to English */\n    translation: boolean;\n    /** Speaker identification */\n    diarization: boolean;\n    /** Real-time streaming (not implemented in v1) */\n    streaming: boolean;\n    /** Automatic punctuation */\n    punctuation: boolean;\n    /** Profanity filtering */\n    profanityFilter: boolean;\n  };\n\n  /** Model limits */\n  limits: {\n    /** Maximum file size in MB */\n    maxFileSizeMB: number;\n    /** Maximum duration in seconds */\n    maxDurationSeconds?: number;\n  };\n\n  /** Vendor-specific options schema */\n  vendorOptions?: Record<string, VendorOptionSchema>;\n}\n\n/**\n * STT model pricing\n */\nexport interface STTModelPricing {\n  /** Cost per minute of audio */\n  perMinute: number;\n  currency: 'USD';\n}\n\n/**\n * Complete STT model description\n */\nexport interface ISTTModelDescription extends IBaseModelDescription {\n  capabilities: STTModelCapabilities;\n  pricing?: STTModelPricing;\n}\n\n// =============================================================================\n// Model Constants\n// =============================================================================\n\nexport const STT_MODELS = {\n  [Vendor.OpenAI]: {\n    /** NEW: GPT-4o based transcription */\n    GPT_4O_TRANSCRIBE: 'gpt-4o-transcribe',\n    /** NEW: GPT-4o with speaker diarization */\n    GPT_4O_TRANSCRIBE_DIARIZE: 'gpt-4o-transcribe-diarize',\n    /** Classic Whisper */\n    WHISPER_1: 'whisper-1',\n  },\n  [Vendor.Groq]: {\n    /** Ultra-fast Whisper on Groq LPUs */\n    WHISPER_LARGE_V3: 'whisper-large-v3',\n    /** Faster English-only variant */\n    DISTIL_WHISPER: 'distil-whisper-large-v3-en',\n  },\n} as const;\n\n// =============================================================================\n// Shared Capability Presets (DRY)\n// =============================================================================\n\n/**\n * Base Whisper capabilities (shared across OpenAI/Groq models)\n */\nconst WHISPER_BASE_CAPABILITIES: Omit<STTModelCapabilities, 'features' | 'limits'> = {\n  inputFormats: AUDIO_FORMATS.STT_INPUT,\n  outputFormats: ['json', 'text', 'srt', 'vtt', 'verbose_json'],\n  languages: [], // Auto-detect, 50+ languages\n  timestamps: { supported: true, granularities: ['word', 'segment'] },\n};\n\n// =============================================================================\n// Registry\n// =============================================================================\n\n/**\n * Complete STT model registry\n * Last full audit: January 2026\n */\nexport const STT_MODEL_REGISTRY: Record<string, ISTTModelDescription> = {\n  // ======================== OpenAI ========================\n\n  'gpt-4o-transcribe': {\n    name: 'gpt-4o-transcribe',\n    displayName: 'GPT-4o Transcribe',\n    provider: Vendor.OpenAI,\n    description: 'GPT-4o based transcription with superior accuracy and context understanding',\n    isActive: true,\n    releaseDate: '2025-04-01',\n    sources: {\n      documentation: 'https://platform.openai.com/docs/guides/speech-to-text',\n      pricing: 'https://openai.com/pricing',\n      lastVerified: '2026-01-24',\n    },\n    capabilities: {\n      ...WHISPER_BASE_CAPABILITIES,\n      features: {\n        translation: true,\n        diarization: false,\n        streaming: false, // Not implementing streaming in v1\n        punctuation: true,\n        profanityFilter: false,\n      },\n      limits: { maxFileSizeMB: 25, maxDurationSeconds: 7200 },\n    },\n    pricing: { perMinute: 0.006, currency: 'USD' },\n  },\n\n  'gpt-4o-transcribe-diarize': {\n    name: 'gpt-4o-transcribe-diarize',\n    displayName: 'GPT-4o Transcribe + Diarization',\n    provider: Vendor.OpenAI,\n    description: 'GPT-4o transcription with speaker identification',\n    isActive: true,\n    releaseDate: '2025-04-01',\n    sources: {\n      documentation: 'https://platform.openai.com/docs/guides/speech-to-text',\n      pricing: 'https://openai.com/pricing',\n      lastVerified: '2026-01-24',\n    },\n    capabilities: {\n      ...WHISPER_BASE_CAPABILITIES,\n      outputFormats: ['json', 'verbose_json'],\n      features: {\n        translation: true,\n        diarization: true, // Built-in speaker identification\n        streaming: false,\n        punctuation: true,\n        profanityFilter: false,\n      },\n      limits: { maxFileSizeMB: 25, maxDurationSeconds: 7200 },\n      vendorOptions: {\n        max_speakers: {\n          type: 'number',\n          description: 'Maximum number of speakers to detect',\n          min: 2,\n          max: 10,\n          default: 4,\n        },\n      },\n    },\n    pricing: { perMinute: 0.012, currency: 'USD' }, // 2x for diarization\n  },\n\n  'whisper-1': {\n    name: 'whisper-1',\n    displayName: 'Whisper',\n    provider: Vendor.OpenAI,\n    description: \"OpenAI's general-purpose speech recognition model\",\n    isActive: true,\n    releaseDate: '2023-03-01',\n    sources: {\n      documentation: 'https://platform.openai.com/docs/guides/speech-to-text',\n      pricing: 'https://openai.com/pricing',\n      lastVerified: '2026-01-24',\n    },\n    capabilities: {\n      ...WHISPER_BASE_CAPABILITIES,\n      inputFormats: ['mp3', 'mp4', 'mpeg', 'mpga', 'm4a', 'wav', 'webm'],\n      features: {\n        translation: true,\n        diarization: false,\n        streaming: false,\n        punctuation: true,\n        profanityFilter: false,\n      },\n      limits: { maxFileSizeMB: 25 },\n    },\n    pricing: { perMinute: 0.006, currency: 'USD' },\n  },\n\n  // ======================== Groq ========================\n\n  'whisper-large-v3': {\n    name: 'whisper-large-v3',\n    displayName: 'Whisper Large v3 (Groq)',\n    provider: Vendor.Groq,\n    description: 'Ultra-fast Whisper on Groq LPUs - 12x cheaper than OpenAI',\n    isActive: true,\n    releaseDate: '2024-04-01',\n    sources: {\n      documentation: 'https://console.groq.com/docs/speech-text',\n      pricing: 'https://groq.com/pricing/',\n      lastVerified: '2026-01-24',\n    },\n    capabilities: {\n      ...WHISPER_BASE_CAPABILITIES,\n      timestamps: { supported: true, granularities: ['segment'] },\n      outputFormats: ['json', 'text', 'verbose_json'],\n      features: {\n        translation: true,\n        diarization: false,\n        streaming: false,\n        punctuation: true,\n        profanityFilter: false,\n      },\n      limits: { maxFileSizeMB: 25 },\n    },\n    pricing: { perMinute: 0.0005, currency: 'USD' }, // 12x cheaper!\n  },\n\n  'distil-whisper-large-v3-en': {\n    name: 'distil-whisper-large-v3-en',\n    displayName: 'Distil Whisper (Groq)',\n    provider: Vendor.Groq,\n    description: 'Faster English-only Whisper variant on Groq',\n    isActive: true,\n    releaseDate: '2024-04-01',\n    sources: {\n      documentation: 'https://console.groq.com/docs/speech-text',\n      pricing: 'https://groq.com/pricing/',\n      lastVerified: '2026-01-24',\n    },\n    capabilities: {\n      inputFormats: AUDIO_FORMATS.STT_INPUT,\n      outputFormats: ['json', 'text', 'verbose_json'],\n      languages: ['en'], // English only\n      timestamps: { supported: true, granularities: ['segment'] },\n      features: {\n        translation: false,\n        diarization: false,\n        streaming: false,\n        punctuation: true,\n        profanityFilter: false,\n      },\n      limits: { maxFileSizeMB: 25 },\n    },\n    pricing: { perMinute: 0.00033, currency: 'USD' },\n  },\n};\n\n// =============================================================================\n// Helper Functions (using shared utilities)\n// =============================================================================\n\nconst helpers = createRegistryHelpers(STT_MODEL_REGISTRY);\n\nexport const getSTTModelInfo = helpers.getInfo;\nexport const getSTTModelsByVendor = helpers.getByVendor;\nexport const getActiveSTTModels = helpers.getActive;\n\n/**\n * Get STT models that support a specific feature\n */\nexport function getSTTModelsWithFeature(\n  feature: keyof ISTTModelDescription['capabilities']['features']\n): ISTTModelDescription[] {\n  return Object.values(STT_MODEL_REGISTRY).filter(\n    (model) => model.isActive && model.capabilities.features[feature]\n  );\n}\n\n/**\n * Calculate estimated cost for STT\n */\nexport function calculateSTTCost(modelName: string, durationSeconds: number): number | null {\n  const model = getSTTModelInfo(modelName);\n  if (!model?.pricing) return null;\n  return (durationSeconds / 60) * model.pricing.perMinute;\n}\n","/**\n * OpenAI Image Generation provider\n * Supports: gpt-image-1, dall-e-3, dall-e-2\n */\n\nimport OpenAI from 'openai';\nimport * as fs from 'fs';\nimport { BaseMediaProvider } from '../base/BaseMediaProvider.js';\nimport type {\n  IImageProvider,\n  ImageGenerateOptions,\n  ImageEditOptions,\n  ImageVariationOptions,\n  ImageResponse,\n} from '../../../domain/interfaces/IImageProvider.js';\nimport type { ProviderCapabilities } from '../../../domain/interfaces/IProvider.js';\nimport type { OpenAIMediaConfig } from '../../../domain/types/ProviderConfig.js';\nimport {\n  ProviderAuthError,\n  ProviderRateLimitError,\n  ProviderError,\n} from '../../../domain/errors/AIErrors.js';\n\nexport class OpenAIImageProvider extends BaseMediaProvider implements IImageProvider {\n  readonly name: string = 'openai-image';\n  readonly vendor = 'openai' as const;\n  readonly capabilities: ProviderCapabilities = {\n    text: false,\n    images: true,\n    videos: false,\n    audio: false,\n    features: {\n      imageGeneration: true,\n      imageEditing: true,\n    },\n  };\n\n  private client: OpenAI;\n\n  constructor(config: OpenAIMediaConfig) {\n    super({ apiKey: config.auth.apiKey, ...config });\n\n    this.client = new OpenAI({\n      apiKey: config.auth.apiKey,\n      baseURL: config.baseURL,\n      organization: config.organization,\n      timeout: config.timeout,\n      maxRetries: config.maxRetries,\n    });\n  }\n\n  /**\n   * Generate images from a text prompt\n   */\n  async generateImage(options: ImageGenerateOptions): Promise<ImageResponse> {\n    return this.executeWithCircuitBreaker(\n      async () => {\n        try {\n          this.logOperationStart('image.generate', {\n            model: options.model,\n            size: options.size,\n            quality: options.quality,\n            n: options.n,\n          });\n\n          // gpt-image-1 doesn't support response_format parameter\n          const isGptImage = options.model === 'gpt-image-1';\n\n          const params: any = {\n            model: options.model,\n            prompt: options.prompt,\n            size: options.size as any,\n            quality: options.quality,\n            style: options.style,\n            n: options.n || 1,\n          };\n\n          // Only add response_format for models that support it\n          if (!isGptImage) {\n            params.response_format = options.response_format || 'b64_json';\n          }\n\n          const response = await this.client.images.generate(params);\n\n          const data = response.data || [];\n\n          this.logOperationComplete('image.generate', {\n            model: options.model,\n            imagesGenerated: data.length,\n          });\n\n          return {\n            created: response.created,\n            data: data.map((img) => ({\n              url: img.url,\n              b64_json: img.b64_json,\n              revised_prompt: img.revised_prompt,\n            })),\n          };\n        } catch (error: any) {\n          this.handleError(error);\n          throw error; // TypeScript needs this\n        }\n      },\n      'image.generate',\n      { model: options.model }\n    );\n  }\n\n  /**\n   * Edit an existing image with a prompt\n   * Supported by: gpt-image-1, dall-e-2\n   */\n  async editImage(options: ImageEditOptions): Promise<ImageResponse> {\n    return this.executeWithCircuitBreaker(\n      async () => {\n        try {\n          this.logOperationStart('image.edit', {\n            model: options.model,\n            size: options.size,\n            n: options.n,\n          });\n\n          // Prepare the image - handle both Buffer and file path\n          const image = this.prepareImageInput(options.image);\n          const mask = options.mask ? this.prepareImageInput(options.mask) : undefined;\n\n          // gpt-image-1 doesn't support response_format parameter\n          const isGptImage = options.model === 'gpt-image-1';\n\n          const params: any = {\n            model: options.model,\n            image,\n            prompt: options.prompt,\n            mask,\n            size: options.size as any,\n            n: options.n || 1,\n          };\n\n          // Only add response_format for models that support it\n          if (!isGptImage) {\n            params.response_format = options.response_format || 'b64_json';\n          }\n\n          const response = await this.client.images.edit(params);\n\n          const data = response.data || [];\n\n          this.logOperationComplete('image.edit', {\n            model: options.model,\n            imagesGenerated: data.length,\n          });\n\n          return {\n            created: response.created,\n            data: data.map((img) => ({\n              url: img.url,\n              b64_json: img.b64_json,\n              revised_prompt: img.revised_prompt,\n            })),\n          };\n        } catch (error: any) {\n          this.handleError(error);\n          throw error;\n        }\n      },\n      'image.edit',\n      { model: options.model }\n    );\n  }\n\n  /**\n   * Create variations of an existing image\n   * Supported by: dall-e-2 only\n   */\n  async createVariation(options: ImageVariationOptions): Promise<ImageResponse> {\n    return this.executeWithCircuitBreaker(\n      async () => {\n        try {\n          this.logOperationStart('image.variation', {\n            model: options.model,\n            size: options.size,\n            n: options.n,\n          });\n\n          // Prepare the image\n          const image = this.prepareImageInput(options.image);\n\n          const response = await this.client.images.createVariation({\n            model: options.model,\n            image,\n            size: options.size as any,\n            n: options.n || 1,\n            response_format: options.response_format || 'b64_json',\n          });\n\n          const data = response.data || [];\n\n          this.logOperationComplete('image.variation', {\n            model: options.model,\n            imagesGenerated: data.length,\n          });\n\n          return {\n            created: response.created,\n            data: data.map((img) => ({\n              url: img.url,\n              b64_json: img.b64_json,\n              revised_prompt: img.revised_prompt,\n            })),\n          };\n        } catch (error: any) {\n          this.handleError(error);\n          throw error;\n        }\n      },\n      'image.variation',\n      { model: options.model }\n    );\n  }\n\n  /**\n   * List available image models\n   */\n  async listModels(): Promise<string[]> {\n    return ['gpt-image-1', 'dall-e-3', 'dall-e-2'];\n  }\n\n  /**\n   * Prepare image input (Buffer or file path) for OpenAI API\n   */\n  private prepareImageInput(image: Buffer | string): any {\n    if (Buffer.isBuffer(image)) {\n      // OpenAI accepts File objects, we create a blob-like structure\n      return new File([image], 'image.png', { type: 'image/png' });\n    }\n\n    // It's a file path - create a readable stream\n    return fs.createReadStream(image);\n  }\n\n  /**\n   * Handle OpenAI API errors\n   */\n  private handleError(error: any): never {\n    const message = error.message || 'Unknown OpenAI API error';\n    const status = error.status;\n\n    if (status === 401) {\n      throw new ProviderAuthError('openai', 'Invalid API key');\n    }\n\n    if (status === 429) {\n      throw new ProviderRateLimitError('openai', message);\n    }\n\n    if (status === 400) {\n      // Check for specific image-related errors\n      if (message.includes('safety system')) {\n        throw new ProviderError('openai', `Content policy violation: ${message}`);\n      }\n      throw new ProviderError('openai', `Bad request: ${message}`);\n    }\n\n    throw new ProviderError('openai', message);\n  }\n}\n","/**\n * Google Imagen Image Generation provider\n * Supports: imagen-3.0-generate-002, imagen-3.0-fast-generate-001, imagen-3.0-capability-001\n */\n\nimport { GoogleGenAI } from '@google/genai';\nimport { BaseMediaProvider } from '../base/BaseMediaProvider.js';\nimport type {\n  IImageProvider,\n  ImageGenerateOptions,\n  ImageEditOptions,\n  ImageResponse,\n} from '../../../domain/interfaces/IImageProvider.js';\nimport type { ProviderCapabilities } from '../../../domain/interfaces/IProvider.js';\nimport type { GoogleConfig } from '../../../domain/types/ProviderConfig.js';\nimport {\n  ProviderAuthError,\n  ProviderRateLimitError,\n  ProviderError,\n} from '../../../domain/errors/AIErrors.js';\n\n/**\n * Extended options for Google image generation\n */\nexport interface GoogleImageGenerateOptions extends ImageGenerateOptions {\n  /** Negative prompt - what to avoid */\n  negativePrompt?: string;\n  /** Aspect ratio (1:1, 3:4, 4:3, 9:16, 16:9) */\n  aspectRatio?: '1:1' | '3:4' | '4:3' | '9:16' | '16:9';\n  /** Random seed for reproducible generation */\n  seed?: number;\n  /** Output MIME type */\n  outputMimeType?: 'image/png' | 'image/jpeg';\n  /** Include safety filter reason in response */\n  includeRaiReason?: boolean;\n}\n\nexport class GoogleImageProvider extends BaseMediaProvider implements IImageProvider {\n  readonly name: string = 'google-image';\n  readonly vendor = 'google' as const;\n  readonly capabilities: ProviderCapabilities = {\n    text: false,\n    images: true,\n    videos: false,\n    audio: false,\n    features: {\n      imageGeneration: true,\n      imageEditing: true,\n    },\n  };\n\n  private client: GoogleGenAI;\n\n  constructor(config: GoogleConfig) {\n    super(config);\n\n    this.client = new GoogleGenAI({\n      apiKey: config.apiKey,\n    });\n  }\n\n  /**\n   * Generate images from a text prompt using Google Imagen\n   */\n  async generateImage(options: ImageGenerateOptions): Promise<ImageResponse> {\n    return this.executeWithCircuitBreaker(\n      async () => {\n        try {\n          this.logOperationStart('image.generate', {\n            model: options.model,\n            n: options.n,\n          });\n\n          const googleOptions = options as GoogleImageGenerateOptions;\n\n          const response = await this.client.models.generateImages({\n            model: options.model,\n            prompt: options.prompt,\n            config: {\n              numberOfImages: options.n || 1,\n              negativePrompt: googleOptions.negativePrompt,\n              aspectRatio: googleOptions.aspectRatio,\n              seed: googleOptions.seed,\n              outputMimeType: googleOptions.outputMimeType,\n              includeRaiReason: googleOptions.includeRaiReason,\n            },\n          });\n\n          const images = response.generatedImages || [];\n\n          this.logOperationComplete('image.generate', {\n            model: options.model,\n            imagesGenerated: images.length,\n          });\n\n          return {\n            created: Math.floor(Date.now() / 1000),\n            data: images.map((img: any) => ({\n              b64_json: img.image?.imageBytes,\n              // Google doesn't provide URLs, only base64\n            })),\n          };\n        } catch (error: any) {\n          this.handleError(error);\n          throw error;\n        }\n      },\n      'image.generate',\n      { model: options.model }\n    );\n  }\n\n  /**\n   * Edit an existing image using Imagen capability model\n   * Uses imagen-3.0-capability-001\n   */\n  async editImage(options: ImageEditOptions): Promise<ImageResponse> {\n    return this.executeWithCircuitBreaker(\n      async () => {\n        try {\n          this.logOperationStart('image.edit', {\n            model: options.model,\n            n: options.n,\n          });\n\n          // Prepare the reference image\n          const referenceImage = await this.prepareReferenceImage(options.image);\n\n          const response = await this.client.models.editImage({\n            model: options.model || 'imagen-3.0-capability-001',\n            prompt: options.prompt,\n            referenceImages: [referenceImage],\n            config: {\n              numberOfImages: options.n || 1,\n            },\n          });\n\n          const images = response.generatedImages || [];\n\n          this.logOperationComplete('image.edit', {\n            model: options.model,\n            imagesGenerated: images.length,\n          });\n\n          return {\n            created: Math.floor(Date.now() / 1000),\n            data: images.map((img: any) => ({\n              b64_json: img.image?.imageBytes,\n            })),\n          };\n        } catch (error: any) {\n          this.handleError(error);\n          throw error;\n        }\n      },\n      'image.edit',\n      { model: options.model }\n    );\n  }\n\n  /**\n   * List available image models\n   */\n  async listModels(): Promise<string[]> {\n    return [\n      'imagen-4.0-generate-001',\n      'imagen-4.0-ultra-generate-001',\n      'imagen-4.0-fast-generate-001',\n    ];\n  }\n\n  /**\n   * Prepare a reference image for Google's editImage API\n   */\n  private async prepareReferenceImage(image: Buffer | string): Promise<any> {\n    let imageBytes: string;\n\n    if (Buffer.isBuffer(image)) {\n      imageBytes = image.toString('base64');\n    } else {\n      // It's a file path - read and convert\n      const fs = await import('fs');\n      const buffer = fs.readFileSync(image);\n      imageBytes = buffer.toString('base64');\n    }\n\n    // Return a subject reference image structure\n    return {\n      referenceImage: {\n        image: {\n          imageBytes,\n        },\n      },\n      referenceType: 'REFERENCE_TYPE_SUBJECT',\n    };\n  }\n\n  /**\n   * Handle Google API errors\n   */\n  private handleError(error: any): never {\n    const message = error.message || 'Unknown Google API error';\n    const status = error.status || error.code;\n\n    if (status === 401 || message.includes('API key not valid')) {\n      throw new ProviderAuthError('google', 'Invalid API key');\n    }\n\n    if (status === 429 || message.includes('Resource exhausted')) {\n      throw new ProviderRateLimitError('google', message);\n    }\n\n    if (status === 400) {\n      // Check for safety-related errors\n      if (\n        message.includes('SAFETY') ||\n        message.includes('blocked') ||\n        message.includes('Responsible AI')\n      ) {\n        throw new ProviderError('google', `Content policy violation: ${message}`);\n      }\n      throw new ProviderError('google', `Bad request: ${message}`);\n    }\n\n    throw new ProviderError('google', message);\n  }\n}\n","/**\n * Factory functions for creating image providers\n */\n\nimport { Connector } from './Connector.js';\nimport type { IImageProvider } from '../domain/interfaces/IImageProvider.js';\nimport { Vendor } from './Vendor.js';\nimport { OpenAIImageProvider } from '../infrastructure/providers/openai/OpenAIImageProvider.js';\nimport { GoogleImageProvider } from '../infrastructure/providers/google/GoogleImageProvider.js';\nimport type { OpenAIMediaConfig, GoogleConfig } from '../domain/types/ProviderConfig.js';\n\n/**\n * Create an Image Generation provider from a connector\n */\nexport function createImageProvider(connector: Connector): IImageProvider {\n  const vendor = connector.vendor;\n\n  switch (vendor) {\n    case Vendor.OpenAI:\n      return new OpenAIImageProvider(extractOpenAIConfig(connector));\n\n    case Vendor.Google:\n      return new GoogleImageProvider(extractGoogleConfig(connector));\n\n    default:\n      throw new Error(\n        `No Image provider available for vendor: ${vendor}. ` +\n        `Supported vendors: ${Vendor.OpenAI}, ${Vendor.Google}`\n      );\n  }\n}\n\n/**\n * Extract OpenAI configuration from connector\n */\nfunction extractOpenAIConfig(connector: Connector): OpenAIMediaConfig {\n  const auth = connector.config.auth;\n\n  if (auth.type !== 'api_key') {\n    throw new Error('OpenAI requires API key authentication');\n  }\n\n  const options = connector.getOptions();\n\n  return {\n    auth: {\n      type: 'api_key',\n      apiKey: auth.apiKey,\n    },\n    baseURL: connector.baseURL,\n    organization: options.organization as string | undefined,\n    timeout: options.timeout as number | undefined,\n    maxRetries: options.maxRetries as number | undefined,\n  };\n}\n\n/**\n * Extract Google configuration from connector\n */\nfunction extractGoogleConfig(connector: Connector): GoogleConfig {\n  const auth = connector.config.auth;\n\n  if (auth.type !== 'api_key') {\n    throw new Error('Google requires API key authentication');\n  }\n\n  return {\n    apiKey: auth.apiKey,\n  };\n}\n","/**\n * ErrorHandler - Centralized error handling for agents\n *\n * Provides consistent error handling, logging, and retry logic across all agent types.\n * This is an opt-in utility that agents can use for standardized error management.\n */\n\nimport { EventEmitter } from 'eventemitter3';\nimport { logger, FrameworkLogger } from '../infrastructure/observability/Logger.js';\nimport { metrics } from '../infrastructure/observability/Metrics.js';\n\n/**\n * Context information for error handling\n */\nexport interface ErrorContext {\n  /** Type of agent */\n  agentType: 'agent' | 'task-agent' | 'universal-agent';\n\n  /** Optional agent identifier */\n  agentId?: string;\n\n  /** Operation that failed */\n  operation: string;\n\n  /** Input that caused the error (optional, for debugging) */\n  input?: unknown;\n\n  /** Additional metadata */\n  metadata?: Record<string, unknown>;\n}\n\n/**\n * Configuration for ErrorHandler\n */\nexport interface ErrorHandlerConfig {\n  /** Log errors to console/logger. Default: true */\n  logErrors?: boolean;\n\n  /** Include stack traces in logs. Default: true in development, false in production */\n  includeStackTrace?: boolean;\n\n  /** Custom error transformer */\n  transformError?: (error: Error, context: ErrorContext) => Error;\n\n  /** Error codes/messages that should be retried */\n  retryablePatterns?: string[];\n\n  /** Maximum retry attempts. Default: 3 */\n  maxRetries?: number;\n\n  /** Base delay for exponential backoff in ms. Default: 100 */\n  baseRetryDelayMs?: number;\n\n  /** Maximum retry delay in ms. Default: 5000 */\n  maxRetryDelayMs?: number;\n}\n\n/**\n * Events emitted by ErrorHandler\n */\nexport interface ErrorHandlerEvents {\n  /** Emitted when an error is handled */\n  error: { error: Error; context: ErrorContext; recoverable: boolean };\n\n  /** Emitted when retrying after an error */\n  'error:retrying': { error: Error; context: ErrorContext; attempt: number; delayMs: number };\n\n  /** Emitted when an error is fatal (no recovery possible) */\n  'error:fatal': { error: Error; context: ErrorContext };\n}\n\n/**\n * Default retryable error patterns\n */\nconst DEFAULT_RETRYABLE_PATTERNS = [\n  'ECONNRESET',\n  'ECONNREFUSED',\n  'ETIMEDOUT',\n  'ENOTFOUND',\n  'EAI_AGAIN',\n  'rate limit',\n  'Rate limit',\n  '429',\n  '500',\n  '502',\n  '503',\n  '504',\n  'timeout',\n  'Timeout',\n];\n\n/**\n * Centralized error handling for all agent types.\n *\n * Features:\n * - Consistent error logging with context\n * - Automatic retry with exponential backoff\n * - Error classification (recoverable vs fatal)\n * - Metrics collection\n * - Event emission for monitoring\n *\n * @example\n * ```typescript\n * const errorHandler = new ErrorHandler({\n *   maxRetries: 3,\n *   logErrors: true,\n * });\n *\n * // Handle an error\n * errorHandler.handle(error, {\n *   agentType: 'agent',\n *   operation: 'run',\n * });\n *\n * // Execute with retry\n * const result = await errorHandler.executeWithRetry(\n *   () => riskyOperation(),\n *   { agentType: 'agent', operation: 'riskyOperation' }\n * );\n * ```\n */\nexport class ErrorHandler extends EventEmitter<ErrorHandlerEvents> {\n  private config: Required<ErrorHandlerConfig>;\n  private logger: FrameworkLogger;\n\n  constructor(config: ErrorHandlerConfig = {}) {\n    super();\n\n    const isProduction = process.env.NODE_ENV === 'production';\n\n    this.config = {\n      logErrors: config.logErrors ?? true,\n      includeStackTrace: config.includeStackTrace ?? !isProduction,\n      transformError: config.transformError ?? ((e) => e),\n      retryablePatterns: config.retryablePatterns ?? DEFAULT_RETRYABLE_PATTERNS,\n      maxRetries: config.maxRetries ?? 3,\n      baseRetryDelayMs: config.baseRetryDelayMs ?? 100,\n      maxRetryDelayMs: config.maxRetryDelayMs ?? 5000,\n    };\n\n    this.logger = logger.child({ component: 'ErrorHandler' });\n  }\n\n  /**\n   * Handle an error with context.\n   * Logs the error, emits events, and records metrics.\n   *\n   * @param error - The error to handle\n   * @param context - Context information about where/how the error occurred\n   */\n  handle(error: Error, context: ErrorContext): void {\n    const transformed = this.config.transformError(error, context);\n    const recoverable = this.isRecoverable(transformed);\n\n    // Log the error\n    if (this.config.logErrors) {\n      this.logError(transformed, context, recoverable);\n    }\n\n    // Record metrics\n    this.recordMetrics(transformed, context, recoverable);\n\n    // Emit events\n    this.emit('error', { error: transformed, context, recoverable });\n\n    if (!recoverable) {\n      this.emit('error:fatal', { error: transformed, context });\n    }\n  }\n\n  /**\n   * Execute a function with automatic retry on retryable errors.\n   *\n   * @param fn - The function to execute\n   * @param context - Context for error handling\n   * @returns The result of the function\n   * @throws The last error if all retries are exhausted\n   */\n  async executeWithRetry<T>(\n    fn: () => Promise<T>,\n    context: ErrorContext\n  ): Promise<T> {\n    let lastError: Error | undefined;\n\n    for (let attempt = 1; attempt <= this.config.maxRetries; attempt++) {\n      try {\n        return await fn();\n      } catch (error) {\n        lastError = error as Error;\n\n        // Check if we should retry\n        const isLastAttempt = attempt === this.config.maxRetries;\n        const shouldRetry = !isLastAttempt && this.isRetryable(lastError);\n\n        if (!shouldRetry) {\n          this.handle(lastError, context);\n          throw lastError;\n        }\n\n        // Calculate delay with exponential backoff and jitter\n        const delay = this.calculateRetryDelay(attempt);\n\n        // Emit retrying event\n        this.emit('error:retrying', {\n          error: lastError,\n          context,\n          attempt,\n          delayMs: delay,\n        });\n\n        // Log retry\n        if (this.config.logErrors) {\n          this.logger.warn(\n            {\n              error: lastError.message,\n              attempt,\n              maxAttempts: this.config.maxRetries,\n              delayMs: delay,\n              ...this.contextToLogFields(context),\n            },\n            `Retrying after error (attempt ${attempt}/${this.config.maxRetries})`\n          );\n        }\n\n        // Wait before retrying\n        await this.delay(delay);\n      }\n    }\n\n    // Should never reach here, but TypeScript needs this\n    throw lastError;\n  }\n\n  /**\n   * Wrap a function with error handling (no retry).\n   * Useful for wrapping methods that already have their own retry logic.\n   *\n   * @param fn - The function to wrap\n   * @param contextFactory - Factory to create context from function arguments\n   * @returns A wrapped function with error handling\n   */\n  wrap<TArgs extends unknown[], TResult>(\n    fn: (...args: TArgs) => Promise<TResult>,\n    contextFactory: (...args: TArgs) => ErrorContext\n  ): (...args: TArgs) => Promise<TResult> {\n    return async (...args: TArgs): Promise<TResult> => {\n      try {\n        return await fn(...args);\n      } catch (error) {\n        this.handle(error as Error, contextFactory(...args));\n        throw error;\n      }\n    };\n  }\n\n  /**\n   * Check if an error is recoverable (can be retried or handled gracefully).\n   */\n  isRecoverable(error: Error): boolean {\n    // Network errors are often recoverable\n    if (this.isRetryable(error)) {\n      return true;\n    }\n\n    // Check for specific recoverable error types\n    const recoverableTypes = [\n      'RateLimitError',\n      'TimeoutError',\n      'NetworkError',\n      'ConnectionError',\n    ];\n\n    return recoverableTypes.some(\n      (type) => error.name === type || error.constructor.name === type\n    );\n  }\n\n  /**\n   * Check if an error should be retried.\n   */\n  isRetryable(error: Error): boolean {\n    const errorString = `${error.name} ${error.message}`;\n    return this.config.retryablePatterns.some((pattern) =>\n      errorString.includes(pattern)\n    );\n  }\n\n  /**\n   * Add a retryable pattern.\n   */\n  addRetryablePattern(pattern: string): void {\n    if (!this.config.retryablePatterns.includes(pattern)) {\n      this.config.retryablePatterns.push(pattern);\n    }\n  }\n\n  /**\n   * Remove a retryable pattern.\n   */\n  removeRetryablePattern(pattern: string): void {\n    const index = this.config.retryablePatterns.indexOf(pattern);\n    if (index !== -1) {\n      this.config.retryablePatterns.splice(index, 1);\n    }\n  }\n\n  /**\n   * Get current configuration (read-only).\n   */\n  getConfig(): Readonly<Required<ErrorHandlerConfig>> {\n    return { ...this.config };\n  }\n\n  // ===== Private Helpers =====\n\n  private logError(error: Error, context: ErrorContext, recoverable: boolean): void {\n    const level = recoverable ? 'warn' : 'error';\n    const logData = {\n      error: error.message,\n      errorName: error.name,\n      recoverable,\n      ...this.contextToLogFields(context),\n    };\n\n    if (this.config.includeStackTrace && error.stack) {\n      (logData as any).stack = error.stack;\n    }\n\n    this.logger[level](logData, `Error in ${context.operation}`);\n  }\n\n  private contextToLogFields(context: ErrorContext): Record<string, unknown> {\n    return {\n      agentType: context.agentType,\n      agentId: context.agentId,\n      operation: context.operation,\n      ...(context.metadata || {}),\n    };\n  }\n\n  private recordMetrics(error: Error, context: ErrorContext, recoverable: boolean): void {\n    metrics.increment('error.handled', 1, {\n      agentType: context.agentType,\n      operation: context.operation,\n      errorType: error.name,\n      recoverable: String(recoverable),\n    });\n  }\n\n  private calculateRetryDelay(attempt: number): number {\n    // Exponential backoff: base * 2^(attempt-1)\n    const exponentialDelay = this.config.baseRetryDelayMs * Math.pow(2, attempt - 1);\n\n    // Add jitter (20%)\n    const jitter = exponentialDelay * (0.8 + Math.random() * 0.4);\n\n    // Cap at max delay\n    return Math.min(jitter, this.config.maxRetryDelayMs);\n  }\n\n  private delay(ms: number): Promise<void> {\n    return new Promise((resolve) => setTimeout(resolve, ms));\n  }\n}\n\n/**\n * Global error handler instance.\n * Can be used as a singleton for consistent error handling across the application.\n */\nexport const globalErrorHandler = new ErrorHandler();\n\nexport default ErrorHandler;\n","/**\n * ImageGeneration - High-level image generation capability\n *\n * Provides a unified interface for generating images across multiple vendors.\n *\n * @example\n * ```typescript\n * import { ImageGeneration, Connector, Vendor } from '@oneringai/agents';\n *\n * Connector.create({\n *   name: 'openai',\n *   vendor: Vendor.OpenAI,\n *   auth: { type: 'api_key', apiKey: process.env.OPENAI_API_KEY! },\n * });\n *\n * const imageGen = ImageGeneration.create({ connector: 'openai' });\n *\n * const result = await imageGen.generate({\n *   prompt: 'A futuristic city at sunset',\n *   model: 'dall-e-3',\n *   size: '1024x1024',\n *   quality: 'hd',\n * });\n *\n * // Get base64 data\n * console.log(result.data[0].b64_json);\n * ```\n */\n\nimport { Connector } from '../../core/Connector.js';\nimport { createImageProvider } from '../../core/createImageProvider.js';\nimport type {\n  IImageProvider,\n  ImageGenerateOptions,\n  ImageEditOptions,\n  ImageVariationOptions,\n  ImageResponse,\n} from '../../domain/interfaces/IImageProvider.js';\nimport { IMAGE_MODELS, getImageModelInfo } from '../../domain/entities/ImageModel.js';\nimport { Vendor } from '../../core/Vendor.js';\n\n/**\n * Options for creating an ImageGeneration instance\n */\nexport interface ImageGenerationCreateOptions {\n  /** Connector name or instance */\n  connector: string | Connector;\n}\n\n/**\n * Simplified options for quick generation\n */\nexport interface SimpleGenerateOptions {\n  /** Text prompt describing the image */\n  prompt: string;\n  /** Model to use (defaults to vendor's best model) */\n  model?: string;\n  /** Image size */\n  size?: string;\n  /** Quality setting */\n  quality?: 'standard' | 'hd';\n  /** Style setting (DALL-E 3 only) */\n  style?: 'vivid' | 'natural';\n  /** Number of images to generate */\n  n?: number;\n  /** Response format */\n  response_format?: 'url' | 'b64_json';\n}\n\n/**\n * ImageGeneration capability class\n */\nexport class ImageGeneration {\n  private provider: IImageProvider;\n  private connector: Connector;\n  private defaultModel: string;\n\n  private constructor(connector: Connector) {\n    this.connector = connector;\n    this.provider = createImageProvider(connector);\n    this.defaultModel = this.getDefaultModel();\n  }\n\n  /**\n   * Create an ImageGeneration instance\n   */\n  static create(options: ImageGenerationCreateOptions): ImageGeneration {\n    const connector =\n      typeof options.connector === 'string'\n        ? Connector.get(options.connector)\n        : options.connector;\n\n    if (!connector) {\n      throw new Error(`Connector not found: ${options.connector}`);\n    }\n\n    return new ImageGeneration(connector);\n  }\n\n  /**\n   * Generate images from a text prompt\n   */\n  async generate(options: SimpleGenerateOptions): Promise<ImageResponse> {\n    const fullOptions: ImageGenerateOptions = {\n      model: options.model || this.defaultModel,\n      prompt: options.prompt,\n      size: options.size,\n      quality: options.quality,\n      style: options.style,\n      n: options.n,\n      response_format: options.response_format || 'b64_json',\n    };\n\n    return this.provider.generateImage(fullOptions);\n  }\n\n  /**\n   * Edit an existing image\n   * Note: Not all models/vendors support this\n   */\n  async edit(options: ImageEditOptions): Promise<ImageResponse> {\n    if (!this.provider.editImage) {\n      throw new Error(`Image editing not supported by ${this.provider.name}`);\n    }\n\n    const fullOptions: ImageEditOptions = {\n      ...options,\n      model: options.model || this.getEditModel(),\n    };\n\n    return this.provider.editImage(fullOptions);\n  }\n\n  /**\n   * Create variations of an existing image\n   * Note: Only DALL-E 2 supports this\n   */\n  async createVariation(options: ImageVariationOptions): Promise<ImageResponse> {\n    if (!this.provider.createVariation) {\n      throw new Error(`Image variations not supported by ${this.provider.name}`);\n    }\n\n    const fullOptions: ImageVariationOptions = {\n      ...options,\n      model: options.model || 'dall-e-2', // Only DALL-E 2 supports variations\n    };\n\n    return this.provider.createVariation(fullOptions);\n  }\n\n  /**\n   * List available models for this provider\n   */\n  async listModels(): Promise<string[]> {\n    if (this.provider.listModels) {\n      return this.provider.listModels();\n    }\n\n    // Fallback to registry\n    const vendor = this.connector.vendor;\n    if (vendor && IMAGE_MODELS[vendor as keyof typeof IMAGE_MODELS]) {\n      return Object.values(IMAGE_MODELS[vendor as keyof typeof IMAGE_MODELS]);\n    }\n\n    return [];\n  }\n\n  /**\n   * Get information about a specific model\n   */\n  getModelInfo(modelName: string) {\n    return getImageModelInfo(modelName);\n  }\n\n  /**\n   * Get the underlying provider\n   */\n  getProvider(): IImageProvider {\n    return this.provider;\n  }\n\n  /**\n   * Get the current connector\n   */\n  getConnector(): Connector {\n    return this.connector;\n  }\n\n  /**\n   * Get the default model for this vendor\n   */\n  private getDefaultModel(): string {\n    const vendor = this.connector.vendor;\n\n    switch (vendor) {\n      case Vendor.OpenAI:\n        return IMAGE_MODELS[Vendor.OpenAI].DALL_E_3;\n      case Vendor.Google:\n        return IMAGE_MODELS[Vendor.Google].IMAGEN_4_GENERATE;\n      default:\n        throw new Error(`No default image model for vendor: ${vendor}`);\n    }\n  }\n\n  /**\n   * Get the default edit model for this vendor\n   */\n  private getEditModel(): string {\n    const vendor = this.connector.vendor;\n\n    switch (vendor) {\n      case Vendor.OpenAI:\n        return IMAGE_MODELS[Vendor.OpenAI].GPT_IMAGE_1;\n      case Vendor.Google:\n        // Imagen 4 doesn't have a separate editing model yet\n        return IMAGE_MODELS[Vendor.Google].IMAGEN_4_GENERATE;\n      default:\n        throw new Error(`No edit model for vendor: ${vendor}`);\n    }\n  }\n}\n","/**\n * Image generation model registry with comprehensive metadata\n */\n\nimport { Vendor } from '../../core/Vendor.js';\nimport type { IBaseModelDescription, VendorOptionSchema } from '../types/SharedTypes.js';\nimport { createRegistryHelpers } from './RegistryUtils.js';\n\n// =============================================================================\n// Types\n// =============================================================================\n\n/**\n * Supported image sizes by model\n */\nexport type ImageSize =\n  | '256x256'\n  | '512x512'\n  | '1024x1024'\n  | '1024x1536'\n  | '1536x1024'\n  | '1792x1024'\n  | '1024x1792'\n  | 'auto';\n\n/**\n * Supported aspect ratios (Google Imagen)\n */\nexport type AspectRatio = '1:1' | '3:4' | '4:3' | '9:16' | '16:9';\n\n/**\n * Image model capabilities\n */\nexport interface ImageModelCapabilities {\n  /** Supported image sizes */\n  sizes: readonly ImageSize[];\n\n  /** Supported aspect ratios (Google) */\n  aspectRatios?: readonly AspectRatio[];\n\n  /** Maximum number of images per request */\n  maxImagesPerRequest: number;\n\n  /** Supported output formats */\n  outputFormats: readonly string[];\n\n  /** Feature support flags */\n  features: {\n    /** Text-to-image generation */\n    generation: boolean;\n    /** Image editing/inpainting */\n    editing: boolean;\n    /** Image variations */\n    variations: boolean;\n    /** Style control */\n    styleControl: boolean;\n    /** Quality control (standard/hd) */\n    qualityControl: boolean;\n    /** Transparent backgrounds */\n    transparency: boolean;\n    /** Prompt revision/enhancement */\n    promptRevision: boolean;\n  };\n\n  /** Model limits */\n  limits: {\n    /** Maximum prompt length in characters */\n    maxPromptLength: number;\n    /** Rate limit (requests per minute) */\n    maxRequestsPerMinute?: number;\n  };\n\n  /** Vendor-specific options schema */\n  vendorOptions?: Record<string, VendorOptionSchema>;\n}\n\n/**\n * Image model pricing\n */\nexport interface ImageModelPricing {\n  /** Cost per image at standard quality */\n  perImageStandard?: number;\n  /** Cost per image at HD quality */\n  perImageHD?: number;\n  /** Cost per image (flat rate) */\n  perImage?: number;\n  currency: 'USD';\n}\n\n/**\n * Complete image model description\n */\nexport interface IImageModelDescription extends IBaseModelDescription {\n  capabilities: ImageModelCapabilities;\n  pricing?: ImageModelPricing;\n}\n\n// =============================================================================\n// Model Constants\n// =============================================================================\n\nexport const IMAGE_MODELS = {\n  [Vendor.OpenAI]: {\n    /** GPT-Image-1: Latest OpenAI image model with best quality */\n    GPT_IMAGE_1: 'gpt-image-1',\n    /** DALL-E 3: High quality image generation */\n    DALL_E_3: 'dall-e-3',\n    /** DALL-E 2: Fast, supports editing and variations */\n    DALL_E_2: 'dall-e-2',\n  },\n  [Vendor.Google]: {\n    /** Imagen 4.0: Latest Google image generation model */\n    IMAGEN_4_GENERATE: 'imagen-4.0-generate-001',\n    /** Imagen 4.0 Ultra: Highest quality */\n    IMAGEN_4_ULTRA: 'imagen-4.0-ultra-generate-001',\n    /** Imagen 4.0 Fast: Optimized for speed */\n    IMAGEN_4_FAST: 'imagen-4.0-fast-generate-001',\n  },\n} as const;\n\n// =============================================================================\n// Registry\n// =============================================================================\n\n/**\n * Complete image model registry\n * Last full audit: January 2026\n */\nexport const IMAGE_MODEL_REGISTRY: Record<string, IImageModelDescription> = {\n  // ======================== OpenAI ========================\n\n  'gpt-image-1': {\n    name: 'gpt-image-1',\n    displayName: 'GPT-Image-1',\n    provider: Vendor.OpenAI,\n    description: 'OpenAI latest image generation model with best quality and features',\n    isActive: true,\n    releaseDate: '2025-04-01',\n    sources: {\n      documentation: 'https://platform.openai.com/docs/guides/images',\n      pricing: 'https://openai.com/pricing',\n      lastVerified: '2026-01-25',\n    },\n    capabilities: {\n      sizes: ['1024x1024', '1024x1536', '1536x1024', 'auto'],\n      maxImagesPerRequest: 1,\n      outputFormats: ['png', 'webp', 'jpeg'],\n      features: {\n        generation: true,\n        editing: true,\n        variations: false,\n        styleControl: false,\n        qualityControl: true,\n        transparency: true,\n        promptRevision: false,\n      },\n      limits: { maxPromptLength: 32000 },\n      vendorOptions: {\n        background: {\n          type: 'string',\n          description: 'Background setting: transparent, opaque, or auto',\n        },\n        output_format: {\n          type: 'string',\n          description: 'Output format: png, webp, or jpeg',\n        },\n      },\n    },\n    pricing: {\n      perImageStandard: 0.011,\n      perImageHD: 0.042,\n      currency: 'USD',\n    },\n  },\n\n  'dall-e-3': {\n    name: 'dall-e-3',\n    displayName: 'DALL-E 3',\n    provider: Vendor.OpenAI,\n    description: 'High quality image generation with prompt revision',\n    isActive: true,\n    releaseDate: '2023-11-06',\n    sources: {\n      documentation: 'https://platform.openai.com/docs/guides/images',\n      pricing: 'https://openai.com/pricing',\n      lastVerified: '2026-01-25',\n    },\n    capabilities: {\n      sizes: ['1024x1024', '1024x1792', '1792x1024'],\n      maxImagesPerRequest: 1,\n      outputFormats: ['png', 'url'],\n      features: {\n        generation: true,\n        editing: false,\n        variations: false,\n        styleControl: true,\n        qualityControl: true,\n        transparency: false,\n        promptRevision: true,\n      },\n      limits: { maxPromptLength: 4000 },\n      vendorOptions: {\n        style: {\n          type: 'string',\n          description: 'Style: vivid (hyper-real) or natural (more natural)',\n        },\n      },\n    },\n    pricing: {\n      perImageStandard: 0.040,\n      perImageHD: 0.080,\n      currency: 'USD',\n    },\n  },\n\n  'dall-e-2': {\n    name: 'dall-e-2',\n    displayName: 'DALL-E 2',\n    provider: Vendor.OpenAI,\n    description: 'Fast image generation with editing and variation support',\n    isActive: true,\n    releaseDate: '2022-11-03',\n    sources: {\n      documentation: 'https://platform.openai.com/docs/guides/images',\n      pricing: 'https://openai.com/pricing',\n      lastVerified: '2026-01-25',\n    },\n    capabilities: {\n      sizes: ['256x256', '512x512', '1024x1024'],\n      maxImagesPerRequest: 10,\n      outputFormats: ['png', 'url'],\n      features: {\n        generation: true,\n        editing: true,\n        variations: true,\n        styleControl: false,\n        qualityControl: false,\n        transparency: false,\n        promptRevision: false,\n      },\n      limits: { maxPromptLength: 1000 },\n    },\n    pricing: {\n      perImage: 0.020,\n      currency: 'USD',\n    },\n  },\n\n  // ======================== Google ========================\n\n  'imagen-4.0-generate-001': {\n    name: 'imagen-4.0-generate-001',\n    displayName: 'Imagen 4.0 Generate',\n    provider: Vendor.Google,\n    description: 'Google Imagen 4.0 - standard quality image generation',\n    isActive: true,\n    releaseDate: '2025-06-01',\n    sources: {\n      documentation: 'https://ai.google.dev/gemini-api/docs/imagen',\n      pricing: 'https://ai.google.dev/pricing',\n      lastVerified: '2026-01-25',\n    },\n    capabilities: {\n      sizes: ['1024x1024'],\n      aspectRatios: ['1:1', '3:4', '4:3', '9:16', '16:9'],\n      maxImagesPerRequest: 4,\n      outputFormats: ['png', 'jpeg'],\n      features: {\n        generation: true,\n        editing: false,\n        variations: false,\n        styleControl: false,\n        qualityControl: false,\n        transparency: false,\n        promptRevision: false,\n      },\n      limits: { maxPromptLength: 480 },\n      vendorOptions: {\n        negativePrompt: {\n          type: 'string',\n          description: 'Description of what to avoid in the image',\n        },\n        seed: {\n          type: 'number',\n          description: 'Random seed for reproducible generation',\n        },\n        aspectRatio: {\n          type: 'string',\n          description: 'Aspect ratio: 1:1, 3:4, 4:3, 9:16, or 16:9',\n        },\n      },\n    },\n    pricing: {\n      perImage: 0.04,\n      currency: 'USD',\n    },\n  },\n\n  'imagen-4.0-ultra-generate-001': {\n    name: 'imagen-4.0-ultra-generate-001',\n    displayName: 'Imagen 4.0 Ultra',\n    provider: Vendor.Google,\n    description: 'Google Imagen 4.0 Ultra - highest quality image generation',\n    isActive: true,\n    releaseDate: '2025-06-01',\n    sources: {\n      documentation: 'https://ai.google.dev/gemini-api/docs/imagen',\n      pricing: 'https://ai.google.dev/pricing',\n      lastVerified: '2026-01-25',\n    },\n    capabilities: {\n      sizes: ['1024x1024'],\n      aspectRatios: ['1:1', '3:4', '4:3', '9:16', '16:9'],\n      maxImagesPerRequest: 4,\n      outputFormats: ['png', 'jpeg'],\n      features: {\n        generation: true,\n        editing: false,\n        variations: false,\n        styleControl: false,\n        qualityControl: true,\n        transparency: false,\n        promptRevision: false,\n      },\n      limits: { maxPromptLength: 480 },\n    },\n    pricing: {\n      perImage: 0.08,\n      currency: 'USD',\n    },\n  },\n\n  'imagen-4.0-fast-generate-001': {\n    name: 'imagen-4.0-fast-generate-001',\n    displayName: 'Imagen 4.0 Fast',\n    provider: Vendor.Google,\n    description: 'Google Imagen 4.0 Fast - optimized for speed',\n    isActive: true,\n    releaseDate: '2025-06-01',\n    sources: {\n      documentation: 'https://ai.google.dev/gemini-api/docs/imagen',\n      pricing: 'https://ai.google.dev/pricing',\n      lastVerified: '2026-01-25',\n    },\n    capabilities: {\n      sizes: ['1024x1024'],\n      aspectRatios: ['1:1', '3:4', '4:3', '9:16', '16:9'],\n      maxImagesPerRequest: 4,\n      outputFormats: ['png', 'jpeg'],\n      features: {\n        generation: true,\n        editing: false,\n        variations: false,\n        styleControl: false,\n        qualityControl: false,\n        transparency: false,\n        promptRevision: false,\n      },\n      limits: { maxPromptLength: 480 },\n    },\n    pricing: {\n      perImage: 0.02,\n      currency: 'USD',\n    },\n  },\n};\n\n// =============================================================================\n// Helper Functions (using shared utilities)\n// =============================================================================\n\nconst helpers = createRegistryHelpers(IMAGE_MODEL_REGISTRY);\n\nexport const getImageModelInfo = helpers.getInfo;\nexport const getImageModelsByVendor = helpers.getByVendor;\nexport const getActiveImageModels = helpers.getActive;\n\n/**\n * Get image models that support a specific feature\n */\nexport function getImageModelsWithFeature(\n  feature: keyof IImageModelDescription['capabilities']['features']\n): IImageModelDescription[] {\n  return Object.values(IMAGE_MODEL_REGISTRY).filter(\n    (model) => model.isActive && model.capabilities.features[feature]\n  );\n}\n\n/**\n * Calculate estimated cost for image generation\n */\nexport function calculateImageCost(\n  modelName: string,\n  imageCount: number,\n  quality: 'standard' | 'hd' = 'standard'\n): number | null {\n  const model = getImageModelInfo(modelName);\n  if (!model?.pricing) return null;\n\n  if (model.pricing.perImage) {\n    return imageCount * model.pricing.perImage;\n  }\n\n  const pricePerImage =\n    quality === 'hd' ? model.pricing.perImageHD : model.pricing.perImageStandard;\n\n  if (!pricePerImage) return null;\n  return imageCount * pricePerImage;\n}\n","/**\n * VideoGeneration - High-level video generation capability\n *\n * Provides a unified interface for generating videos across multiple vendors.\n * Supports text-to-video, image-to-video, and video extension.\n *\n * @example\n * ```typescript\n * import { VideoGeneration, Connector, Vendor } from '@oneringai/agents';\n *\n * Connector.create({\n *   name: 'openai',\n *   vendor: Vendor.OpenAI,\n *   auth: { type: 'api_key', apiKey: process.env.OPENAI_API_KEY! },\n * });\n *\n * const videoGen = VideoGeneration.create({ connector: 'openai' });\n *\n * // Start video generation\n * const job = await videoGen.generate({\n *   prompt: 'A cinematic shot of a sunrise over mountains',\n *   duration: 8,\n *   resolution: '1280x720',\n * });\n *\n * // Wait for completion\n * const result = await videoGen.waitForCompletion(job.jobId);\n *\n * // Download the video\n * const videoBuffer = await videoGen.download(job.jobId);\n * ```\n */\n\nimport { Connector } from '../../core/Connector.js';\nimport { createVideoProvider } from '../../core/createVideoProvider.js';\nimport type {\n  IVideoProvider,\n  VideoGenerateOptions,\n  VideoExtendOptions,\n  VideoResponse,\n} from '../../domain/interfaces/IVideoProvider.js';\nimport { VIDEO_MODELS, getVideoModelInfo } from '../../domain/entities/VideoModel.js';\nimport { Vendor } from '../../core/Vendor.js';\nimport { ProviderError } from '../../domain/errors/AIErrors.js';\n\n/**\n * Options for creating a VideoGeneration instance\n */\nexport interface VideoGenerationCreateOptions {\n  /** Connector name or instance */\n  connector: string | Connector;\n}\n\n/**\n * Simplified options for quick generation\n */\nexport interface SimpleVideoGenerateOptions {\n  /** Text prompt describing the video */\n  prompt: string;\n  /** Model to use (defaults to vendor's best model) */\n  model?: string;\n  /** Duration in seconds */\n  duration?: number;\n  /** Output resolution (e.g., '1280x720', '1920x1080') */\n  resolution?: string;\n  /** Aspect ratio (alternative to resolution) */\n  aspectRatio?: '16:9' | '9:16' | '1:1' | '4:3' | '3:4';\n  /** Reference image for image-to-video */\n  image?: Buffer | string;\n  /** Seed for reproducibility */\n  seed?: number;\n  /** Vendor-specific options */\n  vendorOptions?: Record<string, unknown>;\n}\n\n/**\n * VideoGeneration capability class\n */\nexport class VideoGeneration {\n  private provider: IVideoProvider;\n  private connector: Connector;\n  private defaultModel: string;\n\n  private constructor(connector: Connector) {\n    this.connector = connector;\n    this.provider = createVideoProvider(connector);\n    this.defaultModel = this.getDefaultModel();\n  }\n\n  /**\n   * Create a VideoGeneration instance\n   */\n  static create(options: VideoGenerationCreateOptions): VideoGeneration {\n    const connector =\n      typeof options.connector === 'string'\n        ? Connector.get(options.connector)\n        : options.connector;\n\n    if (!connector) {\n      throw new Error(`Connector not found: ${options.connector}`);\n    }\n\n    return new VideoGeneration(connector);\n  }\n\n  /**\n   * Generate a video from a text prompt\n   * Returns a job that can be polled for completion\n   */\n  async generate(options: SimpleVideoGenerateOptions): Promise<VideoResponse> {\n    const fullOptions: VideoGenerateOptions = {\n      model: options.model || this.defaultModel,\n      prompt: options.prompt,\n      duration: options.duration,\n      resolution: options.resolution,\n      aspectRatio: options.aspectRatio,\n      image: options.image,\n      seed: options.seed,\n      vendorOptions: options.vendorOptions,\n    };\n\n    return this.provider.generateVideo(fullOptions);\n  }\n\n  /**\n   * Get the status of a video generation job\n   */\n  async getStatus(jobId: string): Promise<VideoResponse> {\n    return this.provider.getVideoStatus(jobId);\n  }\n\n  /**\n   * Wait for a video generation job to complete\n   */\n  async waitForCompletion(jobId: string, timeoutMs: number = 600000): Promise<VideoResponse> {\n    const startTime = Date.now();\n    const pollInterval = 10000; // 10 seconds\n\n    while (Date.now() - startTime < timeoutMs) {\n      const status = await this.provider.getVideoStatus(jobId);\n\n      if (status.status === 'completed') {\n        return status;\n      }\n\n      if (status.status === 'failed') {\n        throw new ProviderError(\n          this.connector.vendor || 'unknown',\n          `Video generation failed: ${status.error || 'Unknown error'}`\n        );\n      }\n\n      // Wait before next poll\n      await new Promise((resolve) => setTimeout(resolve, pollInterval));\n    }\n\n    throw new ProviderError(\n      this.connector.vendor || 'unknown',\n      `Video generation timed out after ${timeoutMs}ms`\n    );\n  }\n\n  /**\n   * Download a completed video\n   */\n  async download(jobId: string): Promise<Buffer> {\n    if (!this.provider.downloadVideo) {\n      throw new Error(`Video download not supported by ${this.provider.name}`);\n    }\n\n    return this.provider.downloadVideo(jobId);\n  }\n\n  /**\n   * Generate and wait for completion in one call\n   */\n  async generateAndWait(\n    options: SimpleVideoGenerateOptions,\n    timeoutMs: number = 600000\n  ): Promise<VideoResponse> {\n    const job = await this.generate(options);\n    return this.waitForCompletion(job.jobId, timeoutMs);\n  }\n\n  /**\n   * Extend an existing video\n   * Note: Not all models/vendors support this\n   */\n  async extend(options: VideoExtendOptions): Promise<VideoResponse> {\n    if (!this.provider.extendVideo) {\n      throw new Error(`Video extension not supported by ${this.provider.name}`);\n    }\n\n    const fullOptions: VideoExtendOptions = {\n      ...options,\n      model: options.model || this.getExtendModel(),\n    };\n\n    return this.provider.extendVideo(fullOptions);\n  }\n\n  /**\n   * Cancel a pending video generation job\n   */\n  async cancel(jobId: string): Promise<boolean> {\n    if (!this.provider.cancelJob) {\n      throw new Error(`Job cancellation not supported by ${this.provider.name}`);\n    }\n\n    return this.provider.cancelJob(jobId);\n  }\n\n  /**\n   * List available models for this provider\n   */\n  async listModels(): Promise<string[]> {\n    if (this.provider.listModels) {\n      return this.provider.listModels();\n    }\n\n    // Fallback to registry\n    const vendor = this.connector.vendor;\n    if (vendor && VIDEO_MODELS[vendor as keyof typeof VIDEO_MODELS]) {\n      return Object.values(VIDEO_MODELS[vendor as keyof typeof VIDEO_MODELS]);\n    }\n\n    return [];\n  }\n\n  /**\n   * Get information about a specific model\n   */\n  getModelInfo(modelName: string) {\n    return getVideoModelInfo(modelName);\n  }\n\n  /**\n   * Get the underlying provider\n   */\n  getProvider(): IVideoProvider {\n    return this.provider;\n  }\n\n  /**\n   * Get the current connector\n   */\n  getConnector(): Connector {\n    return this.connector;\n  }\n\n  /**\n   * Get the default model for this vendor\n   */\n  private getDefaultModel(): string {\n    const vendor = this.connector.vendor;\n\n    switch (vendor) {\n      case Vendor.OpenAI:\n        return VIDEO_MODELS[Vendor.OpenAI].SORA_2;\n      case Vendor.Google:\n        return VIDEO_MODELS[Vendor.Google].VEO_3;\n      default:\n        throw new Error(`No default video model for vendor: ${vendor}`);\n    }\n  }\n\n  /**\n   * Get the model that supports video extension\n   */\n  private getExtendModel(): string {\n    const vendor = this.connector.vendor;\n\n    switch (vendor) {\n      case Vendor.OpenAI:\n        return VIDEO_MODELS[Vendor.OpenAI].SORA_2;\n      case Vendor.Google:\n        return VIDEO_MODELS[Vendor.Google].VEO_3_1;\n      default:\n        throw new Error(`No extend model for vendor: ${vendor}`);\n    }\n  }\n}\n","/**\n * OpenAI Sora Video Generation Provider\n * Supports: sora-2, sora-2-pro\n */\n\nimport OpenAI from 'openai';\nimport { BaseMediaProvider } from '../base/BaseMediaProvider.js';\nimport type {\n  IVideoProvider,\n  VideoGenerateOptions,\n  VideoExtendOptions,\n  VideoResponse,\n} from '../../../domain/interfaces/IVideoProvider.js';\nimport type { ProviderCapabilities } from '../../../domain/interfaces/IProvider.js';\nimport type { OpenAIMediaConfig } from '../../../domain/types/ProviderConfig.js';\nimport {\n  ProviderAuthError,\n  ProviderRateLimitError,\n  ProviderError,\n} from '../../../domain/errors/AIErrors.js';\n\nexport class OpenAISoraProvider extends BaseMediaProvider implements IVideoProvider {\n  readonly name: string = 'openai-video';\n  readonly vendor = 'openai' as const;\n  readonly capabilities: ProviderCapabilities = {\n    text: false,\n    images: false,\n    videos: true,\n    audio: false,\n    features: {\n      videoGeneration: true,\n      imageToVideo: true,\n      videoExtension: true,\n    },\n  };\n\n  private client: OpenAI;\n\n  constructor(config: OpenAIMediaConfig) {\n    super({ apiKey: config.auth.apiKey, ...config });\n\n    this.client = new OpenAI({\n      apiKey: config.auth.apiKey,\n      baseURL: config.baseURL,\n      organization: config.organization,\n      timeout: config.timeout,\n      maxRetries: config.maxRetries,\n    });\n  }\n\n  /**\n   * Generate a video from a text prompt\n   */\n  async generateVideo(options: VideoGenerateOptions): Promise<VideoResponse> {\n    return this.executeWithCircuitBreaker(\n      async () => {\n        try {\n          this.logOperationStart('video.generate', {\n            model: options.model,\n            duration: options.duration,\n            resolution: options.resolution,\n          });\n\n          const model = (options.model || 'sora-2') as\n            | 'sora-2'\n            | 'sora-2-pro'\n            | 'sora-2-2025-10-06'\n            | 'sora-2-pro-2025-10-06'\n            | 'sora-2-2025-12-08';\n\n          // Map duration to SDK's seconds parameter (string: '4', '8', '12')\n          const seconds = this.durationToSeconds(options.duration || 4);\n\n          // Build request parameters matching OpenAI SDK 6.x VideoCreateParams\n          const params: {\n            prompt: string;\n            model?: typeof model;\n            seconds?: '4' | '8' | '12';\n            size?: '720x1280' | '1280x720' | '1024x1792' | '1792x1024';\n            input_reference?: any;\n          } = {\n            prompt: options.prompt,\n            model,\n            seconds,\n          };\n\n          // Map resolution to SDK's size parameter\n          if (options.resolution) {\n            params.size = this.resolutionToSize(options.resolution);\n          } else if (options.aspectRatio) {\n            params.size = this.aspectRatioToSize(options.aspectRatio);\n          }\n\n          // Add image for image-to-video (input_reference)\n          if (options.image) {\n            params.input_reference = await this.prepareImageInput(options.image);\n          }\n\n          // Call the OpenAI Videos API\n          const response = await this.client.videos.create(params);\n\n          this.logOperationComplete('video.generate', {\n            model,\n            jobId: response.id,\n            status: response.status,\n          });\n\n          return this.mapResponse(response);\n        } catch (error: any) {\n          this.handleError(error);\n          throw error;\n        }\n      },\n      'video.generate',\n      { model: options.model }\n    );\n  }\n\n  /**\n   * Get the status of a video generation job\n   */\n  async getVideoStatus(jobId: string): Promise<VideoResponse> {\n    return this.executeWithCircuitBreaker(\n      async () => {\n        try {\n          this.logOperationStart('video.status', { jobId });\n\n          const response = await this.client.videos.retrieve(jobId);\n\n          this.logOperationComplete('video.status', {\n            jobId,\n            status: response.status,\n            progress: response.progress,\n          });\n\n          return this.mapResponse(response);\n        } catch (error: any) {\n          this.handleError(error);\n          throw error;\n        }\n      },\n      'video.status',\n      { jobId }\n    );\n  }\n\n  /**\n   * Download a completed video\n   */\n  async downloadVideo(jobId: string): Promise<Buffer> {\n    return this.executeWithCircuitBreaker(\n      async () => {\n        try {\n          this.logOperationStart('video.download', { jobId });\n\n          // First check status\n          const statusResponse = await this.getVideoStatus(jobId);\n          if (statusResponse.status !== 'completed') {\n            throw new ProviderError('openai', `Video not ready. Status: ${statusResponse.status}`);\n          }\n\n          // Use the SDK's downloadContent method\n          const response = await this.client.videos.downloadContent(jobId, { variant: 'video' });\n\n          // Convert Response to Buffer\n          const arrayBuffer = await response.arrayBuffer();\n          const buffer = Buffer.from(arrayBuffer);\n\n          this.logOperationComplete('video.download', {\n            jobId,\n            size: buffer.length,\n          });\n\n          return buffer;\n        } catch (error: any) {\n          if (error instanceof ProviderError) throw error;\n          this.handleError(error);\n          throw error;\n        }\n      },\n      'video.download',\n      { jobId }\n    );\n  }\n\n  /**\n   * Extend/remix an existing video\n   * Note: OpenAI SDK uses 'remix' instead of 'extend'\n   */\n  async extendVideo(options: VideoExtendOptions): Promise<VideoResponse> {\n    return this.executeWithCircuitBreaker(\n      async () => {\n        try {\n          this.logOperationStart('video.extend', {\n            model: options.model,\n            extendDuration: options.extendDuration,\n            direction: options.direction,\n          });\n\n          // Get the video ID - for remix, we need a video ID not buffer\n          let videoId: string;\n          if (typeof options.video === 'string' && !options.video.startsWith('http')) {\n            // Assume it's a video ID\n            videoId = options.video;\n          } else {\n            throw new ProviderError(\n              'openai',\n              'Video extension requires a video ID. Upload the video first or provide the job ID.'\n            );\n          }\n\n          // Use the remix endpoint with a prompt\n          const prompt = options.prompt || 'Extend this video seamlessly';\n          const response = await this.client.videos.remix(videoId, { prompt });\n\n          this.logOperationComplete('video.extend', {\n            jobId: response.id,\n            status: response.status,\n          });\n\n          return this.mapResponse(response);\n        } catch (error: any) {\n          if (error instanceof ProviderError) throw error;\n          this.handleError(error);\n          throw error;\n        }\n      },\n      'video.extend',\n      { model: options.model }\n    );\n  }\n\n  /**\n   * List available video models\n   */\n  async listModels(): Promise<string[]> {\n    return ['sora-2', 'sora-2-pro'];\n  }\n\n  /**\n   * Cancel/delete a pending job\n   */\n  async cancelJob(jobId: string): Promise<boolean> {\n    try {\n      const response = await this.client.videos.delete(jobId);\n      return response.deleted;\n    } catch {\n      return false;\n    }\n  }\n\n  /**\n   * Map OpenAI SDK Video response to our VideoResponse format\n   */\n  private mapResponse(response: OpenAI.Videos.Video): VideoResponse {\n    const result: VideoResponse = {\n      jobId: response.id,\n      status: this.mapStatus(response.status),\n      created: response.created_at,\n      progress: response.progress,\n    };\n\n    // Video completed - SDK doesn't have video URL directly,\n    // use downloadContent to get the actual video\n    if (response.status === 'completed') {\n      result.video = {\n        duration: this.secondsStringToNumber(response.seconds),\n        resolution: response.size,\n        format: 'mp4',\n      };\n    }\n\n    if (response.status === 'failed' && response.error) {\n      result.error = response.error.message || 'Video generation failed';\n    }\n\n    return result;\n  }\n\n  /**\n   * Map OpenAI status to our status type\n   */\n  private mapStatus(status: string): 'pending' | 'processing' | 'completed' | 'failed' {\n    switch (status) {\n      case 'queued':\n      case 'pending':\n        return 'pending';\n      case 'in_progress':\n      case 'processing':\n        return 'processing';\n      case 'completed':\n      case 'succeeded':\n        return 'completed';\n      case 'failed':\n      case 'cancelled':\n        return 'failed';\n      default:\n        return 'pending';\n    }\n  }\n\n  /**\n   * Convert duration number to SDK's seconds string format\n   */\n  private durationToSeconds(duration: number): '4' | '8' | '12' {\n    if (duration <= 4) return '4';\n    if (duration <= 8) return '8';\n    return '12';\n  }\n\n  /**\n   * Convert seconds string back to number\n   */\n  private secondsStringToNumber(seconds: string): number {\n    return parseInt(seconds, 10) || 4;\n  }\n\n  /**\n   * Map resolution string to SDK's size format\n   */\n  private resolutionToSize(resolution: string): '720x1280' | '1280x720' | '1024x1792' | '1792x1024' {\n    const validSizes = ['720x1280', '1280x720', '1024x1792', '1792x1024'] as const;\n    if (validSizes.includes(resolution as any)) {\n      return resolution as '720x1280' | '1280x720' | '1024x1792' | '1792x1024';\n    }\n    // Default to portrait\n    return '720x1280';\n  }\n\n  /**\n   * Map aspect ratio to SDK's size format\n   */\n  private aspectRatioToSize(aspectRatio: string): '720x1280' | '1280x720' | '1024x1792' | '1792x1024' {\n    const map: Record<string, '720x1280' | '1280x720' | '1024x1792' | '1792x1024'> = {\n      '16:9': '1280x720',\n      '9:16': '720x1280',\n      '9:16-tall': '1024x1792',\n      '16:9-tall': '1792x1024',\n    };\n    return map[aspectRatio] || '720x1280';\n  }\n\n  /**\n   * Prepare image input for API (input_reference)\n   */\n  private async prepareImageInput(image: Buffer | string): Promise<any> {\n    if (Buffer.isBuffer(image)) {\n      // Create a File-like object from buffer\n      return new File([image], 'input.png', { type: 'image/png' });\n    }\n\n    // If it's a file path, read it\n    if (!image.startsWith('http')) {\n      const fs = await import('fs');\n      const data = fs.readFileSync(image);\n      return new File([data], 'input.png', { type: 'image/png' });\n    }\n\n    // For URLs, fetch and convert to File\n    const response = await fetch(image);\n    const arrayBuffer = await response.arrayBuffer();\n    return new File([new Uint8Array(arrayBuffer)], 'input.png', { type: 'image/png' });\n  }\n\n  /**\n   * Handle OpenAI API errors\n   */\n  private handleError(error: any): never {\n    const message = error.message || 'Unknown OpenAI API error';\n    const status = error.status;\n\n    if (status === 401) {\n      throw new ProviderAuthError('openai', 'Invalid API key');\n    }\n\n    if (status === 429) {\n      throw new ProviderRateLimitError('openai', message);\n    }\n\n    if (status === 400) {\n      if (message.includes('safety') || message.includes('policy')) {\n        throw new ProviderError('openai', `Content policy violation: ${message}`);\n      }\n      throw new ProviderError('openai', `Bad request: ${message}`);\n    }\n\n    throw new ProviderError('openai', message);\n  }\n}\n","/**\n * Google Veo Video Generation Provider\n * Supports: veo-2.0, veo-3.0, veo-3.0-fast, veo-3.1\n */\n\nimport { GoogleGenAI } from '@google/genai';\nimport { BaseMediaProvider } from '../base/BaseMediaProvider.js';\nimport type {\n  IVideoProvider,\n  VideoGenerateOptions,\n  VideoExtendOptions,\n  VideoResponse,\n  VideoStatus,\n} from '../../../domain/interfaces/IVideoProvider.js';\nimport type { ProviderCapabilities } from '../../../domain/interfaces/IProvider.js';\nimport type { GoogleMediaConfig } from '../../../domain/types/ProviderConfig.js';\nimport {\n  ProviderAuthError,\n  ProviderRateLimitError,\n  ProviderError,\n} from '../../../domain/errors/AIErrors.js';\n\n/**\n * Google Veo-specific options\n */\nexport interface GoogleVeoOptions {\n  /** Negative prompt (what to avoid) */\n  negativePrompt?: string;\n  /** Last frame image for interpolation */\n  lastFrame?: Buffer | string;\n  /** Person generation mode */\n  personGeneration?: 'dont_allow' | 'allow_adult' | 'allow_all';\n  /** Safety filter level */\n  safetyFilterLevel?: 'block_low_and_above' | 'block_medium_and_above' | 'block_only_high';\n}\n\nexport class GoogleVeoProvider extends BaseMediaProvider implements IVideoProvider {\n  readonly name: string = 'google-video';\n  readonly vendor = 'google' as const;\n  readonly capabilities: ProviderCapabilities = {\n    text: false,\n    images: false,\n    videos: true,\n    audio: false,\n    features: {\n      videoGeneration: true,\n      imageToVideo: true,\n      videoExtension: true,\n    },\n  };\n\n  private client: GoogleGenAI;\n  private pendingOperations: Map<string, any> = new Map();\n\n  constructor(config: GoogleMediaConfig) {\n    super({ apiKey: config.auth.apiKey, ...config });\n\n    this.client = new GoogleGenAI({\n      apiKey: config.auth.apiKey,\n    });\n  }\n\n  /**\n   * Generate a video from a text prompt\n   */\n  async generateVideo(options: VideoGenerateOptions): Promise<VideoResponse> {\n    return this.executeWithCircuitBreaker(\n      async () => {\n        try {\n          this.logOperationStart('video.generate', {\n            model: options.model,\n            duration: options.duration,\n            resolution: options.resolution,\n          });\n\n          const model = options.model || 'veo-3.1-generate-preview';\n          const googleOptions = (options.vendorOptions || {}) as GoogleVeoOptions;\n\n          // Build config\n          const config: any = {};\n\n          // Aspect ratio\n          if (options.aspectRatio) {\n            config.aspectRatio = options.aspectRatio;\n          }\n\n          // Resolution\n          if (options.resolution) {\n            config.resolution = options.resolution;\n          }\n\n          // Duration - must be a number, not string\n          if (options.duration) {\n            config.durationSeconds = options.duration;\n          }\n\n          // Seed\n          if (options.seed !== undefined) {\n            config.seed = options.seed;\n          }\n\n          // Negative prompt\n          if (googleOptions.negativePrompt) {\n            config.negativePrompt = googleOptions.negativePrompt;\n          }\n\n          // Person generation setting\n          if (googleOptions.personGeneration) {\n            config.personGeneration = googleOptions.personGeneration;\n          }\n\n          // Safety filter level\n          if (googleOptions.safetyFilterLevel) {\n            config.safetyFilterLevel = googleOptions.safetyFilterLevel;\n          }\n\n          // Build request\n          const request: any = {\n            model,\n            prompt: options.prompt,\n            config,\n          };\n\n          // Add image for image-to-video\n          if (options.image) {\n            request.image = await this.prepareImageInput(options.image);\n          }\n\n          // Add last frame if specified\n          if (googleOptions.lastFrame) {\n            request.lastFrame = await this.prepareImageInput(googleOptions.lastFrame);\n          }\n\n          // Start video generation (returns an operation)\n          const operation = await (this.client.models as any).generateVideos(request);\n\n          // Store operation for polling\n          const jobId = this.extractJobId(operation);\n          this.pendingOperations.set(jobId, operation);\n\n          this.logOperationComplete('video.generate', {\n            model,\n            jobId,\n            status: 'pending',\n          });\n\n          return {\n            jobId,\n            status: 'pending',\n            created: Math.floor(Date.now() / 1000),\n          };\n        } catch (error: any) {\n          this.handleError(error);\n          throw error;\n        }\n      },\n      'video.generate',\n      { model: options.model }\n    );\n  }\n\n  /**\n   * Get the status of a video generation job\n   */\n  async getVideoStatus(jobId: string): Promise<VideoResponse> {\n    return this.executeWithCircuitBreaker(\n      async () => {\n        try {\n          this.logOperationStart('video.status', { jobId });\n\n          // Get stored operation\n          let operation = this.pendingOperations.get(jobId);\n\n          if (!operation) {\n            // Try to retrieve by operation name\n            try {\n              operation = await (this.client as any).operations.getVideosOperation({\n                operation: { name: jobId },\n              });\n            } catch {\n              throw new ProviderError('google', `Video job not found: ${jobId}`);\n            }\n          }\n\n          // Poll for status update\n          operation = await (this.client as any).operations.getVideosOperation({\n            operation,\n          });\n\n          // Update stored operation\n          this.pendingOperations.set(jobId, operation);\n\n          const response = this.mapResponse(jobId, operation);\n\n          this.logOperationComplete('video.status', {\n            jobId,\n            status: response.status,\n          });\n\n          // Clean up completed operations\n          if (response.status === 'completed' || response.status === 'failed') {\n            this.pendingOperations.delete(jobId);\n          }\n\n          return response;\n        } catch (error: any) {\n          if (error instanceof ProviderError) throw error;\n          this.handleError(error);\n          throw error;\n        }\n      },\n      'video.status',\n      { jobId }\n    );\n  }\n\n  /**\n   * Download a completed video\n   */\n  async downloadVideo(jobId: string): Promise<Buffer> {\n    return this.executeWithCircuitBreaker(\n      async () => {\n        try {\n          this.logOperationStart('video.download', { jobId });\n\n          // Get status to ensure completion\n          const status = await this.getVideoStatus(jobId);\n          if (status.status !== 'completed') {\n            throw new ProviderError('google', `Video not ready. Status: ${status.status}`);\n          }\n\n          // Get the operation\n          const operation = this.pendingOperations.get(jobId);\n          if (!operation?.response?.generatedVideos?.[0]?.video) {\n            throw new ProviderError('google', 'No video available for download');\n          }\n\n          // Download using the files API\n          const videoFile = operation.response.generatedVideos[0].video;\n          const downloadResponse = await (this.client.files as any).download({\n            file: videoFile,\n          });\n\n          let buffer: Buffer;\n          if (downloadResponse instanceof Buffer) {\n            buffer = downloadResponse;\n          } else if (downloadResponse.data) {\n            buffer = Buffer.from(downloadResponse.data);\n          } else {\n            throw new ProviderError('google', 'Unexpected download response format');\n          }\n\n          this.logOperationComplete('video.download', {\n            jobId,\n            size: buffer.length,\n          });\n\n          return buffer;\n        } catch (error: any) {\n          if (error instanceof ProviderError) throw error;\n          this.handleError(error);\n          throw error;\n        }\n      },\n      'video.download',\n      { jobId }\n    );\n  }\n\n  /**\n   * Extend an existing video (Veo 3.1 supports this)\n   */\n  async extendVideo(options: VideoExtendOptions): Promise<VideoResponse> {\n    return this.executeWithCircuitBreaker(\n      async () => {\n        try {\n          this.logOperationStart('video.extend', {\n            model: options.model,\n            extendDuration: options.extendDuration,\n          });\n\n          const model = options.model || 'veo-3.1-generate-preview';\n\n          // Video extension in Veo is done by providing the last frame\n          // of the existing video and generating a continuation\n          const request: any = {\n            model,\n            prompt: options.prompt || 'Continue the video seamlessly',\n            config: {\n              durationSeconds: String(options.extendDuration),\n            },\n          };\n\n          // Extract last frame from video or use video as input\n          if (Buffer.isBuffer(options.video)) {\n            // For buffer input, we'd need to extract the last frame\n            // This is a simplified implementation\n            request.image = {\n              imageBytes: options.video.toString('base64'),\n            };\n          } else {\n            request.video = { uri: options.video };\n          }\n\n          const operation = await (this.client.models as any).generateVideos(request);\n\n          const jobId = this.extractJobId(operation);\n          this.pendingOperations.set(jobId, operation);\n\n          this.logOperationComplete('video.extend', {\n            jobId,\n            status: 'pending',\n          });\n\n          return {\n            jobId,\n            status: 'pending',\n            created: Math.floor(Date.now() / 1000),\n          };\n        } catch (error: any) {\n          this.handleError(error);\n          throw error;\n        }\n      },\n      'video.extend',\n      { model: options.model }\n    );\n  }\n\n  /**\n   * List available video models\n   */\n  async listModels(): Promise<string[]> {\n    return [\n      'veo-2.0-generate-001',\n      'veo-3-generate-preview',\n      'veo-3.1-fast-generate-preview',\n      'veo-3.1-generate-preview',\n    ];\n  }\n\n  /**\n   * Wait for video completion with polling\n   */\n  async waitForCompletion(jobId: string, timeoutMs: number = 600000): Promise<VideoResponse> {\n    const startTime = Date.now();\n    const pollInterval = 10000; // 10 seconds\n\n    while (Date.now() - startTime < timeoutMs) {\n      const status = await this.getVideoStatus(jobId);\n\n      if (status.status === 'completed' || status.status === 'failed') {\n        return status;\n      }\n\n      // Wait before next poll\n      await new Promise((resolve) => setTimeout(resolve, pollInterval));\n    }\n\n    throw new ProviderError('google', `Video generation timed out after ${timeoutMs}ms`);\n  }\n\n  /**\n   * Extract job ID from operation\n   */\n  private extractJobId(operation: any): string {\n    if (operation.name) {\n      return operation.name;\n    }\n    // Generate a unique ID if not available\n    return `veo-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n  }\n\n  /**\n   * Prepare image input for API\n   */\n  private async prepareImageInput(image: Buffer | string): Promise<any> {\n    if (Buffer.isBuffer(image)) {\n      return {\n        imageBytes: image.toString('base64'),\n      };\n    }\n\n    // Check if it's a URL or file path\n    if (image.startsWith('http://') || image.startsWith('https://')) {\n      return { imageUri: image };\n    }\n\n    // Read from file path\n    const fs = await import('fs/promises');\n    const data = await fs.readFile(image);\n    return {\n      imageBytes: data.toString('base64'),\n    };\n  }\n\n  /**\n   * Map operation to VideoResponse\n   */\n  private mapResponse(jobId: string, operation: any): VideoResponse {\n    const result: VideoResponse = {\n      jobId,\n      status: this.mapStatus(operation),\n      created: Math.floor(Date.now() / 1000),\n    };\n\n    if (operation.done && operation.response?.generatedVideos?.[0]) {\n      const video = operation.response.generatedVideos[0];\n      result.video = {\n        duration: video.video?.duration,\n        format: 'mp4',\n      };\n\n      // URL may be available through the file reference\n      if (video.video?.uri) {\n        result.video.url = video.video.uri;\n      }\n    }\n\n    if (operation.error) {\n      result.error = operation.error.message || 'Video generation failed';\n      result.status = 'failed';\n    }\n\n    return result;\n  }\n\n  /**\n   * Map operation status to our status type\n   */\n  private mapStatus(operation: any): VideoStatus {\n    if (operation.error) {\n      return 'failed';\n    }\n    if (operation.done) {\n      return 'completed';\n    }\n    if (operation.metadata?.state === 'ACTIVE' || operation.metadata?.state === 'PROCESSING') {\n      return 'processing';\n    }\n    return 'pending';\n  }\n\n  /**\n   * Handle Google API errors\n   */\n  private handleError(error: any): never {\n    const message = error.message || 'Unknown Google API error';\n    const status = error.status || error.code;\n\n    if (status === 401 || status === 403 || message.includes('API key')) {\n      throw new ProviderAuthError('google', 'Invalid API key');\n    }\n\n    if (status === 429 || message.includes('quota') || message.includes('rate')) {\n      throw new ProviderRateLimitError('google', message);\n    }\n\n    if (status === 400) {\n      if (message.includes('safety') || message.includes('blocked')) {\n        throw new ProviderError('google', `Content policy violation: ${message}`);\n      }\n      throw new ProviderError('google', `Bad request: ${message}`);\n    }\n\n    throw new ProviderError('google', message);\n  }\n}\n","/**\n * Factory for creating video providers from connectors\n */\n\nimport { Connector } from './Connector.js';\nimport { Vendor } from './Vendor.js';\nimport type { IVideoProvider } from '../domain/interfaces/IVideoProvider.js';\nimport type { OpenAIMediaConfig, GoogleMediaConfig } from '../domain/types/ProviderConfig.js';\nimport { OpenAISoraProvider } from '../infrastructure/providers/openai/OpenAISoraProvider.js';\nimport { GoogleVeoProvider } from '../infrastructure/providers/google/GoogleVeoProvider.js';\n/**\n * Create a video provider from a connector\n */\nexport function createVideoProvider(connector: Connector): IVideoProvider {\n  const vendor = connector.vendor;\n\n  switch (vendor) {\n    case Vendor.OpenAI:\n      return new OpenAISoraProvider(extractOpenAIConfig(connector));\n\n    case Vendor.Google:\n      return new GoogleVeoProvider(extractGoogleConfig(connector));\n\n    default:\n      throw new Error(\n        `Video generation not supported for vendor: ${vendor}. ` +\n          `Supported vendors: ${Vendor.OpenAI}, ${Vendor.Google}`\n      );\n  }\n}\n\n/**\n * Extract OpenAI configuration from connector\n */\nfunction extractOpenAIConfig(connector: Connector): OpenAIMediaConfig {\n  const auth = connector.config.auth;\n\n  if (auth.type !== 'api_key') {\n    throw new Error('OpenAI requires API key authentication');\n  }\n\n  const options = connector.getOptions();\n\n  return {\n    auth: {\n      type: 'api_key',\n      apiKey: auth.apiKey,\n    },\n    baseURL: connector.baseURL,\n    organization: options.organization as string | undefined,\n    timeout: options.timeout as number | undefined,\n    maxRetries: options.maxRetries as number | undefined,\n  };\n}\n\n/**\n * Extract Google configuration from connector\n */\nfunction extractGoogleConfig(connector: Connector): GoogleMediaConfig {\n  const auth = connector.config.auth;\n\n  if (auth.type !== 'api_key') {\n    throw new Error('Google requires API key authentication');\n  }\n\n  const options = connector.getOptions();\n\n  return {\n    auth: {\n      type: 'api_key',\n      apiKey: auth.apiKey,\n    },\n    timeout: options.timeout as number | undefined,\n    maxRetries: options.maxRetries as number | undefined,\n  };\n}\n","/**\n * Video Model Registry\n *\n * Comprehensive registry of video generation models with capabilities and pricing.\n * Models are organized by vendor and include detailed capability information.\n */\n\nimport { Vendor } from '../../core/Vendor.js';\nimport type { ISourceLinks, IBaseModelDescription } from '../types/SharedTypes.js';\nimport { createRegistryHelpers } from './RegistryUtils.js';\n\n/**\n * Video model capabilities\n */\nexport interface VideoModelCapabilities {\n  /** Supported durations in seconds */\n  durations: number[];\n  /** Supported resolutions (e.g., '720x1280', '1080x1920') */\n  resolutions: string[];\n  /** Maximum frames per second */\n  maxFps: number;\n  /** Whether the model supports audio generation */\n  audio: boolean;\n  /** Whether the model supports image-to-video */\n  imageToVideo: boolean;\n  /** Whether the model supports video extension */\n  videoExtension: boolean;\n  /** Whether the model supports first/last frame specification */\n  frameControl: boolean;\n  /** Additional features */\n  features: {\n    /** Supports upscaling output */\n    upscaling: boolean;\n    /** Supports style/mood control */\n    styleControl: boolean;\n    /** Supports negative prompts */\n    negativePrompt: boolean;\n    /** Supports seed for reproducibility */\n    seed: boolean;\n  };\n}\n\n/**\n * Video model pricing\n */\nexport interface VideoModelPricing {\n  /** Cost per second of generated video */\n  perSecond: number;\n  /** Currency */\n  currency: string;\n}\n\n/**\n * Video model description\n */\nexport interface IVideoModelDescription extends IBaseModelDescription {\n  capabilities: VideoModelCapabilities;\n  pricing?: VideoModelPricing;\n}\n\n/**\n * Video model registry type\n */\ntype VideoModelRegistry = Record<string, IVideoModelDescription>;\n\n/**\n * Model constants organized by vendor\n */\nexport const VIDEO_MODELS = {\n  [Vendor.OpenAI]: {\n    SORA_2: 'sora-2',\n    SORA_2_PRO: 'sora-2-pro',\n  },\n  [Vendor.Google]: {\n    // Gemini API (ai.google.dev) model names - use with API key\n    VEO_2: 'veo-2.0-generate-001',\n    VEO_3: 'veo-3-generate-preview',\n    VEO_3_FAST: 'veo-3.1-fast-generate-preview',\n    VEO_3_1: 'veo-3.1-generate-preview',\n  },\n} as const;\n\n/**\n * Common sources for model information\n */\nconst OPENAI_SOURCES: ISourceLinks = {\n  documentation: 'https://platform.openai.com/docs/guides/video-generation',\n  apiReference: 'https://platform.openai.com/docs/api-reference/videos',\n  lastVerified: '2026-01-25',\n};\n\nconst GOOGLE_SOURCES: ISourceLinks = {\n  documentation: 'https://docs.cloud.google.com/vertex-ai/generative-ai/docs/video/overview',\n  apiReference: 'https://docs.cloud.google.com/vertex-ai/generative-ai/docs/model-reference/veo-video-generation',\n  lastVerified: '2026-01-25',\n};\n\n/**\n * Video Model Registry\n */\nexport const VIDEO_MODEL_REGISTRY: VideoModelRegistry = {\n  // ============================================================================\n  // OpenAI Sora Models\n  // ============================================================================\n\n  'sora-2': {\n    name: 'sora-2',\n    displayName: 'Sora 2',\n    provider: Vendor.OpenAI,\n    isActive: true,\n    sources: OPENAI_SOURCES,\n    capabilities: {\n      durations: [4, 8, 12],\n      resolutions: ['720x1280', '1280x720', '1024x1792', '1792x1024'],\n      maxFps: 30,\n      audio: true,\n      imageToVideo: true,\n      videoExtension: true,\n      frameControl: false,\n      features: {\n        upscaling: false,\n        styleControl: false,\n        negativePrompt: false,\n        seed: true,\n      },\n    },\n    pricing: {\n      perSecond: 0.15,\n      currency: 'USD',\n    },\n  },\n\n  'sora-2-pro': {\n    name: 'sora-2-pro',\n    displayName: 'Sora 2 Pro',\n    provider: Vendor.OpenAI,\n    isActive: true,\n    sources: OPENAI_SOURCES,\n    capabilities: {\n      durations: [4, 8, 12],\n      resolutions: ['720x1280', '1280x720', '1024x1792', '1792x1024', '1920x1080', '1080x1920'],\n      maxFps: 30,\n      audio: true,\n      imageToVideo: true,\n      videoExtension: true,\n      frameControl: true,\n      features: {\n        upscaling: true,\n        styleControl: true,\n        negativePrompt: false,\n        seed: true,\n      },\n    },\n    pricing: {\n      perSecond: 0.40,\n      currency: 'USD',\n    },\n  },\n\n  // ============================================================================\n  // Google Veo Models\n  // ============================================================================\n\n  'veo-2.0-generate-001': {\n    name: 'veo-2.0-generate-001',\n    displayName: 'Veo 2.0',\n    provider: Vendor.Google,\n    isActive: true,\n    sources: GOOGLE_SOURCES,\n    capabilities: {\n      durations: [5, 6, 7, 8],\n      resolutions: ['768x1408', '1408x768', '1024x1024'],\n      maxFps: 24,\n      audio: false,\n      imageToVideo: true,\n      videoExtension: false,\n      frameControl: true,\n      features: {\n        upscaling: false,\n        styleControl: false,\n        negativePrompt: true,\n        seed: true,\n      },\n    },\n    pricing: {\n      perSecond: 0.03,\n      currency: 'USD',\n    },\n  },\n\n  'veo-3-generate-preview': {\n    name: 'veo-3-generate-preview',\n    displayName: 'Veo 3.0',\n    provider: Vendor.Google,\n    isActive: true,\n    sources: GOOGLE_SOURCES,\n    capabilities: {\n      durations: [4, 6, 8],\n      resolutions: ['720p', '1080p', '768x1408', '1408x768'],\n      maxFps: 30,\n      audio: true,\n      imageToVideo: true,\n      videoExtension: true,\n      frameControl: true,\n      features: {\n        upscaling: true,\n        styleControl: true,\n        negativePrompt: true,\n        seed: true,\n      },\n    },\n    pricing: {\n      perSecond: 0.75,\n      currency: 'USD',\n    },\n  },\n\n  'veo-3.1-fast-generate-preview': {\n    name: 'veo-3.1-fast-generate-preview',\n    displayName: 'Veo 3.1 Fast',\n    provider: Vendor.Google,\n    isActive: true,\n    sources: GOOGLE_SOURCES,\n    capabilities: {\n      durations: [4, 6, 8],\n      resolutions: ['720p', '768x1408', '1408x768'],\n      maxFps: 24,\n      audio: true,\n      imageToVideo: true,\n      videoExtension: false,\n      frameControl: false,\n      features: {\n        upscaling: false,\n        styleControl: false,\n        negativePrompt: true,\n        seed: true,\n      },\n    },\n    pricing: {\n      perSecond: 0.75,\n      currency: 'USD',\n    },\n  },\n\n  'veo-3.1-generate-preview': {\n    name: 'veo-3.1-generate-preview',\n    displayName: 'Veo 3.1',\n    provider: Vendor.Google,\n    isActive: true,\n    sources: GOOGLE_SOURCES,\n    capabilities: {\n      durations: [4, 6, 8],\n      resolutions: ['720p', '1080p', '4k', '768x1408', '1408x768'],\n      maxFps: 30,\n      audio: true,\n      imageToVideo: true,\n      videoExtension: true,\n      frameControl: true,\n      features: {\n        upscaling: true,\n        styleControl: true,\n        negativePrompt: true,\n        seed: true,\n      },\n    },\n    pricing: {\n      perSecond: 0.75,\n      currency: 'USD',\n    },\n  },\n};\n\n// Create helper functions using the registry utility\nconst helpers = createRegistryHelpers<IVideoModelDescription>(VIDEO_MODEL_REGISTRY);\n\n/**\n * Get model information by name\n */\nexport const getVideoModelInfo = helpers.getInfo;\n\n/**\n * Get all models for a specific vendor\n */\nexport const getVideoModelsByVendor = helpers.getByVendor;\n\n/**\n * Get all currently active models\n */\nexport const getActiveVideoModels = helpers.getActive;\n\n/**\n * Get models with a specific feature\n */\nexport function getVideoModelsWithFeature(feature: keyof VideoModelCapabilities['features']): IVideoModelDescription[] {\n  return Object.values(VIDEO_MODEL_REGISTRY).filter(\n    (model) => model.isActive && model.capabilities.features[feature]\n  );\n}\n\n/**\n * Get models that support audio\n */\nexport function getVideoModelsWithAudio(): IVideoModelDescription[] {\n  return Object.values(VIDEO_MODEL_REGISTRY).filter((model) => model.isActive && model.capabilities.audio);\n}\n\n/**\n * Calculate video generation cost\n */\nexport function calculateVideoCost(modelName: string, durationSeconds: number): number | null {\n  const model = VIDEO_MODEL_REGISTRY[modelName];\n  if (!model || !model.pricing) {\n    return null;\n  }\n\n  return model.pricing.perSecond * durationSeconds;\n}\n","/**\n * SearchProvider - Unified search interface with connector support\n *\n * Provides a consistent API for web search across multiple vendors.\n * Uses Connector-First architecture for authentication.\n */\n\nimport { Connector } from '../../core/Connector.js';\nimport { SerperProvider } from './providers/SerperProvider.js';\nimport { BraveProvider } from './providers/BraveProvider.js';\nimport { TavilyProvider } from './providers/TavilyProvider.js';\nimport { RapidAPIProvider } from './providers/RapidAPIProvider.js';\n\n/**\n * Search result interface\n */\nexport interface SearchResult {\n  /** Page title */\n  title: string;\n  /** Direct URL to the page */\n  url: string;\n  /** Short description/excerpt */\n  snippet: string;\n  /** Search ranking position */\n  position: number;\n}\n\n/**\n * Search options\n */\nexport interface SearchOptions {\n  /** Number of results to return (default: 10, max provider-specific) */\n  numResults?: number;\n  /** Language code (e.g., 'en', 'fr') */\n  language?: string;\n  /** Country/region code (e.g., 'us', 'gb') */\n  country?: string;\n  /** Time range filter (e.g., 'day', 'week', 'month', 'year') */\n  timeRange?: string;\n  /** Vendor-specific options */\n  vendorOptions?: Record<string, any>;\n}\n\n/**\n * Search response\n */\nexport interface SearchResponse {\n  /** Whether the search succeeded */\n  success: boolean;\n  /** Search query */\n  query: string;\n  /** Provider name */\n  provider: string;\n  /** Search results */\n  results: SearchResult[];\n  /** Number of results */\n  count: number;\n  /** Error message if failed */\n  error?: string;\n}\n\n/**\n * Base SearchProvider interface\n */\nexport interface ISearchProvider {\n  /** Provider name */\n  readonly name: string;\n\n  /** Connector used for authentication */\n  readonly connector: Connector;\n\n  /**\n   * Search the web\n   * @param query - Search query string\n   * @param options - Search options\n   */\n  search(query: string, options?: SearchOptions): Promise<SearchResponse>;\n}\n\n/**\n * SearchProvider factory configuration\n */\nexport interface SearchProviderConfig {\n  /** Connector name or instance */\n  connector: string | Connector;\n}\n\n/**\n * SearchProvider factory\n */\nexport class SearchProvider {\n  /**\n   * Create a search provider from a connector\n   * @param config - Provider configuration\n   * @returns Search provider instance\n   */\n  static create(config: SearchProviderConfig): ISearchProvider {\n    // Get connector\n    const connector =\n      typeof config.connector === 'string'\n        ? Connector.get(config.connector)\n        : config.connector;\n\n    if (!connector) {\n      throw new Error(\n        `Connector not found: ${typeof config.connector === 'string' ? config.connector : 'unknown'}`\n      );\n    }\n\n    // Detect provider from serviceType or baseURL\n    const serviceType = connector.serviceType;\n\n    // Map service type to provider\n    switch (serviceType) {\n      case 'serper':\n        return new SerperProvider(connector);\n\n      case 'brave-search':\n        return new BraveProvider(connector);\n\n      case 'tavily':\n        return new TavilyProvider(connector);\n\n      case 'rapidapi-search':\n        return new RapidAPIProvider(connector);\n\n      default:\n        throw new Error(\n          `Unknown search service type: ${serviceType}. Supported: serper, brave-search, tavily, rapidapi-search`\n        );\n    }\n  }\n}\n","/**\n * Shared types for Connector-based capabilities\n *\n * This module provides common types and utilities that can be reused\n * across all capabilities that use the Connector-First architecture.\n */\n\nimport type { ConnectorFetchOptions } from '../../core/Connector.js';\nimport type { Connector } from '../../core/Connector.js';\n\n// ============ Base Provider Types ============\n\n/**\n * Base configuration for all capability providers\n */\nexport interface BaseProviderConfig {\n  /** Connector name or instance */\n  connector: string | Connector;\n}\n\n/**\n * Base response for all capability providers\n */\nexport interface BaseProviderResponse {\n  /** Whether the operation succeeded */\n  success: boolean;\n  /** Provider name */\n  provider: string;\n  /** Error message if failed */\n  error?: string;\n}\n\n/**\n * Base interface for all capability providers\n */\nexport interface ICapabilityProvider {\n  /** Provider name */\n  readonly name: string;\n  /** Connector used for authentication */\n  readonly connector: Connector;\n}\n\n// ============ Extended Fetch Options ============\n\n/**\n * Extended fetch options with JSON body and query params support\n * Usable by any capability that makes HTTP requests via Connector\n */\nexport interface ExtendedFetchOptions extends Omit<ConnectorFetchOptions, 'body'> {\n  /** JSON body (will be stringified automatically) */\n  body?: Record<string, any>;\n  /** Query parameters (will be appended to URL automatically) */\n  queryParams?: Record<string, string | number | boolean>;\n}\n\n// ============ Utilities ============\n\n/**\n * Build query string from params\n * @param params - Key-value pairs to convert to query string\n * @returns URL-encoded query string (without leading ?)\n */\nexport function buildQueryString(params: Record<string, string | number | boolean>): string {\n  const searchParams = new URLSearchParams();\n  for (const [key, value] of Object.entries(params)) {\n    if (value !== undefined && value !== null) {\n      searchParams.append(key, String(value));\n    }\n  }\n  return searchParams.toString();\n}\n\n/**\n * Convert ExtendedFetchOptions to standard ConnectorFetchOptions\n * Handles body stringification and query param building\n *\n * @param options - Extended options with body/queryParams\n * @returns Standard ConnectorFetchOptions ready for Connector.fetch()\n */\nexport function toConnectorOptions(options: ExtendedFetchOptions): ConnectorFetchOptions {\n  const { body, queryParams, ...rest } = options;\n\n  const connectorOptions: ConnectorFetchOptions = {\n    ...rest,\n  };\n\n  // Stringify body if present\n  if (body) {\n    connectorOptions.body = JSON.stringify(body);\n    // Ensure Content-Type is set\n    connectorOptions.headers = {\n      'Content-Type': 'application/json',\n      ...rest.headers,\n    };\n  }\n\n  return connectorOptions;\n}\n\n/**\n * Build endpoint URL with query parameters\n * @param endpoint - Base endpoint path\n * @param queryParams - Query parameters to append\n * @returns Endpoint with query string\n */\nexport function buildEndpointWithQuery(\n  endpoint: string,\n  queryParams?: Record<string, string | number | boolean>\n): string {\n  if (!queryParams || Object.keys(queryParams).length === 0) {\n    return endpoint;\n  }\n  const queryString = buildQueryString(queryParams);\n  const separator = endpoint.includes('?') ? '&' : '?';\n  return `${endpoint}${separator}${queryString}`;\n}\n\n// ============ Provider Factory Helper ============\n\n/**\n * Resolve connector from config (name or instance)\n * Shared logic for all provider factories\n *\n * @param connectorOrName - Connector name string or Connector instance\n * @returns Resolved Connector instance\n * @throws Error if connector not found\n */\nexport function resolveConnector(connectorOrName: string | Connector): Connector {\n  // Import dynamically to avoid circular deps\n  const { Connector: ConnectorClass } = require('../../core/Connector.js');\n\n  if (typeof connectorOrName === 'string') {\n    return ConnectorClass.get(connectorOrName);\n  }\n  return connectorOrName;\n}\n\n// ============ Service Type Auto-Detection ============\n\n/**\n * Find a connector by supported service types\n * Used by tools to auto-detect available external API connectors\n *\n * This is the GENERIC utility for all external API-dependent tools.\n * Tools define which service types they support, this function finds\n * the first available connector matching any of those types.\n *\n * @param serviceTypes - Array of supported service types in order of preference\n * @returns Connector if found, null otherwise\n *\n * @example\n * ```typescript\n * // In web_search tool\n * const SEARCH_SERVICE_TYPES = ['serper', 'brave-search', 'tavily', 'rapidapi-search'];\n * const connector = findConnectorByServiceTypes(SEARCH_SERVICE_TYPES);\n *\n * // In web_scrape tool\n * const SCRAPE_SERVICE_TYPES = ['zenrows', 'jina-reader', 'firecrawl', 'scrapingbee'];\n * const connector = findConnectorByServiceTypes(SCRAPE_SERVICE_TYPES);\n * ```\n */\nexport function findConnectorByServiceTypes(serviceTypes: string[]): Connector | null {\n  // Import dynamically to avoid circular deps\n  const { Connector: ConnectorClass } = require('../../core/Connector.js');\n\n  const allConnectors = ConnectorClass.list() as string[];\n\n  // Try each service type in order of preference\n  for (const serviceType of serviceTypes) {\n    for (const name of allConnectors) {\n      try {\n        const connector = ConnectorClass.get(name);\n        if (connector?.serviceType === serviceType) {\n          return connector;\n        }\n      } catch {\n        // Ignore errors, continue searching\n      }\n    }\n  }\n\n  return null;\n}\n\n/**\n * List all available connectors for given service types\n * Useful for tools that want to show what's available or support fallback chains\n *\n * @param serviceTypes - Array of supported service types\n * @returns Array of connector names that match any of the service types\n */\nexport function listConnectorsByServiceTypes(serviceTypes: string[]): string[] {\n  const { Connector: ConnectorClass } = require('../../core/Connector.js');\n\n  const allConnectors = ConnectorClass.list() as string[];\n  const matching: string[] = [];\n\n  for (const name of allConnectors) {\n    try {\n      const connector = ConnectorClass.get(name);\n      if (connector?.serviceType && serviceTypes.includes(connector.serviceType)) {\n        matching.push(name);\n      }\n    } catch {\n      // Ignore errors\n    }\n  }\n\n  return matching;\n}\n","/**\n * Serper.dev Search Provider\n * Google search results via Serper.dev API\n */\n\nimport type { Connector } from '../../../core/Connector.js';\nimport type {\n  ISearchProvider,\n  SearchResult,\n  SearchOptions,\n  SearchResponse,\n} from '../SearchProvider.js';\nimport { toConnectorOptions } from '../types.js';\n\nexport class SerperProvider implements ISearchProvider {\n  readonly name = 'serper';\n\n  constructor(readonly connector: Connector) {}\n\n  async search(query: string, options: SearchOptions = {}): Promise<SearchResponse> {\n    const numResults = Math.min(options.numResults || 10, 100);\n\n    try {\n      const fetchOptions = toConnectorOptions({\n        method: 'POST',\n        body: {\n          q: query,\n          num: numResults,\n          ...(options.country && { gl: options.country }),\n          ...(options.language && { hl: options.language }),\n          ...options.vendorOptions,\n        },\n      });\n\n      const response = await this.connector.fetchJSON<any>('/search', fetchOptions);\n\n      if (!response.organic || !Array.isArray(response.organic)) {\n        throw new Error('Invalid response from Serper API');\n      }\n\n      const results: SearchResult[] = response.organic\n        .slice(0, numResults)\n        .map((result: any, index: number) => ({\n          title: result.title || 'Untitled',\n          url: result.link || '',\n          snippet: result.snippet || '',\n          position: index + 1,\n        }));\n\n      return {\n        success: true,\n        query,\n        provider: this.name,\n        results,\n        count: results.length,\n      };\n    } catch (error: any) {\n      return {\n        success: false,\n        query,\n        provider: this.name,\n        results: [],\n        count: 0,\n        error: error.message || 'Unknown error',\n      };\n    }\n  }\n}\n","/**\n * Brave Search Provider\n * Independent search index (privacy-focused)\n */\n\nimport type { Connector } from '../../../core/Connector.js';\nimport type {\n  ISearchProvider,\n  SearchResult,\n  SearchOptions,\n  SearchResponse,\n} from '../SearchProvider.js';\nimport { buildQueryString } from '../types.js';\n\nexport class BraveProvider implements ISearchProvider {\n  readonly name = 'brave';\n\n  constructor(readonly connector: Connector) {}\n\n  async search(query: string, options: SearchOptions = {}): Promise<SearchResponse> {\n    const numResults = Math.min(options.numResults || 10, 20);\n\n    try {\n      const queryParams: Record<string, string | number | boolean> = {\n        q: query,\n        count: numResults,\n        ...(options.country && { country: options.country }),\n        ...(options.language && { search_lang: options.language }),\n        ...options.vendorOptions,\n      };\n\n      const queryString = buildQueryString(queryParams);\n      const response = await this.connector.fetchJSON<any>(`/web/search?${queryString}`, {\n        method: 'GET',\n      });\n\n      if (!response.web?.results || !Array.isArray(response.web.results)) {\n        throw new Error('Invalid response from Brave API');\n      }\n\n      const results: SearchResult[] = response.web.results\n        .slice(0, numResults)\n        .map((result: any, index: number) => ({\n          title: result.title || 'Untitled',\n          url: result.url || '',\n          snippet: result.description || '',\n          position: index + 1,\n        }));\n\n      return {\n        success: true,\n        query,\n        provider: this.name,\n        results,\n        count: results.length,\n      };\n    } catch (error: any) {\n      return {\n        success: false,\n        query,\n        provider: this.name,\n        results: [],\n        count: 0,\n        error: error.message || 'Unknown error',\n      };\n    }\n  }\n}\n","/**\n * Tavily AI Search Provider\n * AI-optimized search results with summaries\n */\n\nimport type { Connector } from '../../../core/Connector.js';\nimport type {\n  ISearchProvider,\n  SearchResult,\n  SearchOptions,\n  SearchResponse,\n} from '../SearchProvider.js';\nimport { toConnectorOptions } from '../types.js';\n\nexport class TavilyProvider implements ISearchProvider {\n  readonly name = 'tavily';\n\n  constructor(readonly connector: Connector) {}\n\n  async search(query: string, options: SearchOptions = {}): Promise<SearchResponse> {\n    const numResults = Math.min(options.numResults || 10, 20);\n\n    try {\n      // Tavily requires API key in body\n      const auth = this.connector.config.auth;\n      const apiKey = auth.type === 'api_key' ? auth.apiKey : '';\n\n      const fetchOptions = toConnectorOptions({\n        method: 'POST',\n        body: {\n          api_key: apiKey,\n          query,\n          max_results: numResults,\n          search_depth: options.vendorOptions?.search_depth || 'basic',\n          include_answer: options.vendorOptions?.include_answer || false,\n          include_raw_content: options.vendorOptions?.include_raw_content || false,\n          ...options.vendorOptions,\n        },\n      });\n\n      const response = await this.connector.fetchJSON<any>('/search', fetchOptions);\n\n      if (!response.results || !Array.isArray(response.results)) {\n        throw new Error('Invalid response from Tavily API');\n      }\n\n      const results: SearchResult[] = response.results\n        .slice(0, numResults)\n        .map((result: any, index: number) => ({\n          title: result.title || 'Untitled',\n          url: result.url || '',\n          snippet: result.content || '',\n          position: index + 1,\n        }));\n\n      return {\n        success: true,\n        query,\n        provider: this.name,\n        results,\n        count: results.length,\n      };\n    } catch (error: any) {\n      return {\n        success: false,\n        query,\n        provider: this.name,\n        results: [],\n        count: 0,\n        error: error.message || 'Unknown error',\n      };\n    }\n  }\n}\n","/**\n * RapidAPI Real-Time Web Search Provider\n * Real-time web search via RapidAPI\n */\n\nimport type { Connector } from '../../../core/Connector.js';\nimport type {\n  ISearchProvider,\n  SearchResult,\n  SearchOptions,\n  SearchResponse,\n} from '../SearchProvider.js';\nimport { buildQueryString } from '../types.js';\nimport { logger } from '../../../infrastructure/observability/Logger.js';\n\nconst rapidapiLogger = logger.child({ component: 'RapidAPIProvider' });\n\nexport class RapidAPIProvider implements ISearchProvider {\n  readonly name = 'rapidapi';\n\n  constructor(readonly connector: Connector) {}\n\n  async search(query: string, options: SearchOptions = {}): Promise<SearchResponse> {\n    const numResults = Math.min(options.numResults || 10, 100);\n    rapidapiLogger.debug({ query, numResults, options }, 'RapidAPI search started');\n\n    try {\n      // Build query params\n      const queryParams: Record<string, string | number | boolean> = {\n        q: query,\n        num: numResults,\n        start: 0,\n        fetch_ai_overviews: false,\n        deduplicate: false,\n        return_organic_result_video_thumbnail: false,\n        nfpr: 0,\n        ...(options.country && { gl: options.country }),\n        ...(options.language && { hl: options.language }),\n        ...options.vendorOptions,\n      };\n\n      // Extract host from connector's baseURL for X-RapidAPI-Host header\n      const baseURL = this.connector.baseURL;\n      const host = baseURL ? new URL(baseURL).host : 'real-time-web-search.p.rapidapi.com';\n      rapidapiLogger.debug({ baseURL, host }, 'Using RapidAPI host');\n\n      // Get API key from connector's auth config\n      let apiKey = '';\n      try {\n        apiKey = this.connector.getApiKey();\n        rapidapiLogger.debug({ hasApiKey: !!apiKey, keyLength: apiKey?.length }, 'Got API key');\n      } catch (e: any) {\n        rapidapiLogger.error({ error: e.message }, 'Failed to get API key');\n        throw new Error('RapidAPI provider requires API key authentication');\n      }\n\n      const queryString = buildQueryString(queryParams);\n      const requestUrl = `/search?${queryString}`;\n      rapidapiLogger.debug({ requestUrl, method: 'GET' }, 'Making RapidAPI request');\n\n      const response = await this.connector.fetchJSON<any>(requestUrl, {\n        method: 'GET',\n        headers: {\n          'X-RapidAPI-Key': apiKey,\n          'X-RapidAPI-Host': host,\n        },\n      });\n\n      rapidapiLogger.debug({\n        hasResponse: !!response,\n        hasData: !!response?.data,\n        dataKeys: response?.data ? Object.keys(response.data) : [],\n        hasOrganicResults: !!(response?.data?.organic_results || response?.data?.organic),\n        organicResultsCount: (response?.data?.organic_results || response?.data?.organic || []).length,\n      }, 'RapidAPI response received');\n\n      // RapidAPI returns data in different formats, handle all variations\n      const organicResults =\n        response.data?.organic_results ||\n        response.data?.organic ||\n        response.organic_results ||\n        response.organic ||\n        [];\n\n      if (!Array.isArray(organicResults)) {\n        rapidapiLogger.error({\n          responseType: typeof organicResults,\n          response: JSON.stringify(response).slice(0, 500),\n        }, 'Invalid response format - organic is not an array');\n        throw new Error('Invalid response from RapidAPI Search');\n      }\n\n      const results: SearchResult[] = organicResults\n        .slice(0, numResults)\n        .map((result: any, index: number) => ({\n          title: result.title || 'Untitled',\n          url: result.link || result.url || '',\n          snippet: result.snippet || result.description || '',\n          position: index + 1,\n        }));\n\n      rapidapiLogger.debug({\n        success: true,\n        resultCount: results.length,\n        firstTitle: results[0]?.title,\n      }, 'RapidAPI search completed successfully');\n\n      return {\n        success: true,\n        query,\n        provider: this.name,\n        results,\n        count: results.length,\n      };\n    } catch (error: any) {\n      rapidapiLogger.error({\n        error: error.message,\n        stack: error.stack,\n      }, 'RapidAPI search failed');\n      return {\n        success: false,\n        query,\n        provider: this.name,\n        results: [],\n        count: 0,\n        error: error.message || 'Unknown error',\n      };\n    }\n  }\n}\n","/**\n * ScrapeProvider - Unified web scraping interface with connector support\n *\n * Provides a consistent API for web scraping across multiple vendors.\n * Uses Connector-First architecture for authentication.\n *\n * This is the surface API - actual scraping is delegated to vendor-specific\n * providers based on the Connector's serviceType.\n *\n * DESIGN PATTERN:\n * - IScrapeProvider: Interface all providers implement\n * - ScrapeProvider.create(): Factory that returns the right provider\n * - ScrapeProvider.createWithFallback(): Factory with fallback chain\n *\n * FALLBACK STRATEGY:\n * The webScrape tool uses this provider with a fallback chain:\n * 1. Try native fetch (webFetch) - fastest, free\n * 2. Try JS rendering (webFetchJS) - handles SPAs\n * 3. Try external API provider - handles bot protection, etc.\n */\n\nimport { Connector } from '../../core/Connector.js';\nimport { resolveConnector, type BaseProviderResponse } from '../shared/index.js';\n\n// ============ Result Types ============\n\n/**\n * Scraped content result\n */\nexport interface ScrapeResult {\n  /** Page title */\n  title: string;\n  /** Extracted text content (cleaned) */\n  content: string;\n  /** Raw HTML (if available) */\n  html?: string;\n  /** Markdown version (if provider supports it) */\n  markdown?: string;\n  /** Metadata extracted from the page */\n  metadata?: {\n    description?: string;\n    author?: string;\n    publishedDate?: string;\n    siteName?: string;\n    favicon?: string;\n    ogImage?: string;\n    [key: string]: any;\n  };\n  /** Screenshot as base64 (if requested and supported) */\n  screenshot?: string;\n  /** Links found on the page */\n  links?: Array<{ url: string; text: string }>;\n}\n\n/**\n * Scrape options\n */\nexport interface ScrapeOptions {\n  /** Timeout in milliseconds (default: 30000) */\n  timeout?: number;\n  /** Whether to wait for JavaScript to render (if supported) */\n  waitForJS?: boolean;\n  /** CSS selector to wait for before scraping */\n  waitForSelector?: string;\n  /** Whether to include raw HTML in response */\n  includeHtml?: boolean;\n  /** Whether to convert to markdown (if supported) */\n  includeMarkdown?: boolean;\n  /** Whether to extract links */\n  includeLinks?: boolean;\n  /** Whether to take a screenshot (if supported) */\n  includeScreenshot?: boolean;\n  /** Custom headers to send */\n  headers?: Record<string, string>;\n  /** Vendor-specific options */\n  vendorOptions?: Record<string, any>;\n}\n\n/**\n * Scrape response\n */\nexport interface ScrapeResponse extends BaseProviderResponse {\n  /** The URL that was scraped */\n  url: string;\n  /** Final URL after redirects */\n  finalUrl?: string;\n  /** Scraped content */\n  result?: ScrapeResult;\n  /** HTTP status code */\n  statusCode?: number;\n  /** Time taken in milliseconds */\n  durationMs?: number;\n  /** Whether the content required JavaScript rendering */\n  requiredJS?: boolean;\n  /** Suggested fallback if this provider failed */\n  suggestedFallback?: string;\n}\n\n// ============ Provider Interface ============\n\n/**\n * Base ScrapeProvider interface\n * All scraping providers must implement this interface\n */\nexport interface IScrapeProvider {\n  /** Provider name (e.g., 'jina', 'firecrawl', 'scrapingbee') */\n  readonly name: string;\n\n  /** Connector used for authentication */\n  readonly connector: Connector;\n\n  /**\n   * Scrape a URL and extract content\n   * @param url - URL to scrape\n   * @param options - Scrape options\n   * @returns Scrape response with content or error\n   */\n  scrape(url: string, options?: ScrapeOptions): Promise<ScrapeResponse>;\n\n  /**\n   * Check if this provider supports a specific feature\n   * @param feature - Feature name\n   */\n  supportsFeature?(feature: ScrapeFeature): boolean;\n}\n\n/**\n * Features that scrape providers may support\n */\nexport type ScrapeFeature =\n  | 'javascript'      // Can render JavaScript\n  | 'markdown'        // Can convert to markdown\n  | 'screenshot'      // Can take screenshots\n  | 'links'           // Can extract links\n  | 'metadata'        // Can extract metadata\n  | 'proxy'           // Uses proxy rotation\n  | 'stealth'         // Has anti-bot detection bypass\n  | 'pdf'             // Can scrape PDFs\n  | 'dynamic';        // Can handle dynamic content\n\n// ============ Provider Registry ============\n\n/**\n * Provider constructor type\n */\ntype ProviderConstructor = new (connector: Connector) => IScrapeProvider;\n\n/**\n * Registry of service types to provider constructors\n * Providers register themselves here\n */\nconst providerRegistry = new Map<string, ProviderConstructor>();\n\n/**\n * Register a scrape provider for a service type\n * Called by provider implementations to register themselves\n *\n * @param serviceType - Service type (e.g., 'jina', 'firecrawl')\n * @param providerClass - Provider constructor\n */\nexport function registerScrapeProvider(\n  serviceType: string,\n  providerClass: ProviderConstructor\n): void {\n  providerRegistry.set(serviceType, providerClass);\n}\n\n/**\n * Get registered service types\n */\nexport function getRegisteredScrapeProviders(): string[] {\n  return Array.from(providerRegistry.keys());\n}\n\n// ============ Factory Configuration ============\n\n/**\n * ScrapeProvider factory configuration\n */\nexport interface ScrapeProviderConfig {\n  /** Connector name or instance */\n  connector: string | Connector;\n}\n\n/**\n * Fallback chain configuration\n */\nexport interface ScrapeProviderFallbackConfig {\n  /** Primary connector to try first */\n  primary: string | Connector;\n  /** Fallback connectors to try in order */\n  fallbacks?: Array<string | Connector>;\n  /** Whether to try native fetch before API providers */\n  tryNativeFirst?: boolean;\n}\n\n// ============ Factory Class ============\n\n/**\n * ScrapeProvider factory\n *\n * Creates the appropriate provider based on Connector's serviceType.\n * Use createWithFallback() for automatic fallback on failure.\n */\nexport class ScrapeProvider {\n  /**\n   * Create a scrape provider from a connector\n   *\n   * @param config - Provider configuration\n   * @returns Scrape provider instance\n   * @throws Error if connector not found or service type not supported\n   *\n   * @example\n   * ```typescript\n   * const scraper = ScrapeProvider.create({ connector: 'jina-main' });\n   * const result = await scraper.scrape('https://example.com');\n   * ```\n   */\n  static create(config: ScrapeProviderConfig): IScrapeProvider {\n    const connector = resolveConnector(config.connector);\n    const serviceType = connector.serviceType;\n\n    if (!serviceType) {\n      throw new Error(\n        `Connector '${connector.name}' has no serviceType. ` +\n        `Set serviceType when creating the connector.`\n      );\n    }\n\n    const ProviderClass = providerRegistry.get(serviceType);\n\n    if (!ProviderClass) {\n      const registered = getRegisteredScrapeProviders();\n      throw new Error(\n        `No scrape provider registered for service type '${serviceType}'. ` +\n        `Registered providers: ${registered.length > 0 ? registered.join(', ') : 'none'}. ` +\n        `Make sure to import the provider module.`\n      );\n    }\n\n    return new ProviderClass(connector);\n  }\n\n  /**\n   * Check if a service type has a registered provider\n   */\n  static hasProvider(serviceType: string): boolean {\n    return providerRegistry.has(serviceType);\n  }\n\n  /**\n   * List all registered provider service types\n   */\n  static listProviders(): string[] {\n    return getRegisteredScrapeProviders();\n  }\n\n  /**\n   * Create a scrape provider with fallback chain\n   *\n   * Returns a provider that will try each connector in order until one succeeds.\n   *\n   * @param config - Fallback configuration\n   * @returns Scrape provider with fallback support\n   *\n   * @example\n   * ```typescript\n   * const scraper = ScrapeProvider.createWithFallback({\n   *   primary: 'jina-main',\n   *   fallbacks: ['firecrawl-backup', 'scrapingbee'],\n   * });\n   * // Will try jina first, then firecrawl, then scrapingbee\n   * const result = await scraper.scrape('https://example.com');\n   * ```\n   */\n  static createWithFallback(config: ScrapeProviderFallbackConfig): IScrapeProvider {\n    const providers: IScrapeProvider[] = [];\n\n    // Add primary\n    providers.push(ScrapeProvider.create({ connector: config.primary }));\n\n    // Add fallbacks\n    if (config.fallbacks) {\n      for (const fallback of config.fallbacks) {\n        try {\n          providers.push(ScrapeProvider.create({ connector: fallback }));\n        } catch {\n          // Skip invalid connectors in fallback chain\n        }\n      }\n    }\n\n    return new FallbackScrapeProvider(providers);\n  }\n}\n\n// ============ Fallback Provider ============\n\n/**\n * Internal provider that implements fallback chain\n */\nclass FallbackScrapeProvider implements IScrapeProvider {\n  readonly name = 'fallback';\n  readonly connector: Connector;\n\n  constructor(private providers: IScrapeProvider[]) {\n    if (providers.length === 0) {\n      throw new Error('At least one provider required for fallback chain');\n    }\n    // Use first provider's connector as the \"main\" one\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    this.connector = providers[0]!.connector;\n  }\n\n  async scrape(url: string, options?: ScrapeOptions): Promise<ScrapeResponse> {\n    let lastError: string | undefined;\n    const attemptedProviders: string[] = [];\n\n    for (const provider of this.providers) {\n      attemptedProviders.push(provider.name);\n\n      try {\n        const result = await provider.scrape(url, options);\n\n        if (result.success) {\n          return {\n            ...result,\n            provider: `fallback(${provider.name})`,\n          };\n        }\n\n        lastError = result.error;\n      } catch (error: any) {\n        lastError = error.message;\n      }\n    }\n\n    return {\n      success: false,\n      url,\n      provider: 'fallback',\n      error: `All providers failed. Tried: ${attemptedProviders.join(' -> ')}. Last error: ${lastError}`,\n    };\n  }\n\n  supportsFeature(feature: ScrapeFeature): boolean {\n    // Returns true if ANY provider supports the feature\n    return this.providers.some(p => p.supportsFeature?.(feature));\n  }\n}\n","/**\n * ZenRows Scrape Provider\n *\n * Enterprise-grade web scraping with:\n * - JavaScript rendering\n * - Premium proxy rotation (residential IPs)\n * - Anti-bot bypass (pretends to be human)\n * - CAPTCHA solving\n * - Markdown conversion\n * - Screenshot capture\n *\n * @see https://docs.zenrows.com/universal-scraper-api/api-reference\n */\n\nimport type { Connector } from '../../../core/Connector.js';\nimport type {\n  IScrapeProvider,\n  ScrapeOptions,\n  ScrapeResponse,\n  ScrapeResult,\n  ScrapeFeature,\n} from '../ScrapeProvider.js';\nimport { registerScrapeProvider } from '../ScrapeProvider.js';\nimport { buildQueryString } from '../../shared/index.js';\n\n/**\n * ZenRows-specific options\n */\nexport interface ZenRowsOptions {\n  /** Enable JavaScript rendering (5x cost) */\n  jsRender?: boolean;\n  /** Use premium proxies / residential IPs (10x cost) */\n  premiumProxy?: boolean;\n  /** Wait time in ms before returning content (max 30000) */\n  wait?: number;\n  /** CSS selector to wait for before returning */\n  waitFor?: string;\n  /** Enable auto-parsing of structured data */\n  autoparse?: boolean;\n  /** CSS selectors to extract (JSON output) */\n  cssExtractor?: string;\n  /** Output format: 'html' or 'markdown' */\n  outputFormat?: 'html' | 'markdown';\n  /** Take a screenshot (returns base64) */\n  screenshot?: boolean;\n  /** Screenshot full page (vs viewport only) */\n  screenshotFullpage?: boolean;\n  /** Block specific resources: 'image', 'media', 'font', 'stylesheet' */\n  blockResources?: string;\n  /** Custom headers as JSON string */\n  customHeaders?: boolean;\n  /** Session ID for sticky sessions */\n  sessionId?: number;\n  /** Device type: 'desktop' or 'mobile' */\n  device?: 'desktop' | 'mobile';\n  /** Original status code passthrough */\n  originalStatus?: boolean;\n  /** Proxy country (e.g., 'us', 'gb') */\n  proxyCountry?: string;\n  /** JavaScript instructions to execute */\n  jsInstructions?: string;\n}\n\n/**\n * ZenRows API response headers\n */\ninterface ZenRowsHeaders {\n  'zr-final-url'?: string;\n  'zr-status'?: string;\n  'zr-cost'?: string;\n  'content-type'?: string;\n}\n\nexport class ZenRowsProvider implements IScrapeProvider {\n  readonly name = 'zenrows';\n\n  constructor(readonly connector: Connector) {}\n\n  /**\n   * Scrape a URL using ZenRows API\n   *\n   * By default, enables JS rendering and premium proxies for guaranteed results.\n   */\n  async scrape(url: string, options: ScrapeOptions = {}): Promise<ScrapeResponse> {\n    const startTime = Date.now();\n\n    try {\n      // Get API key from connector auth\n      const apiKey = this.getApiKey();\n\n      // Build ZenRows-specific options\n      const zenrowsOpts = options.vendorOptions as ZenRowsOptions | undefined;\n\n      // Build query parameters\n      const queryParams: Record<string, string | number | boolean> = {\n        url: url,\n        apikey: apiKey,\n        // Default to JS rendering and premium proxy for guaranteed results\n        js_render: zenrowsOpts?.jsRender ?? true,\n        premium_proxy: zenrowsOpts?.premiumProxy ?? true,\n      };\n\n      // Add optional parameters\n      if (options.waitForSelector || zenrowsOpts?.waitFor) {\n        queryParams.wait_for = options.waitForSelector || zenrowsOpts?.waitFor || '';\n      }\n\n      if (zenrowsOpts?.wait) {\n        queryParams.wait = zenrowsOpts.wait;\n      }\n\n      if (options.includeMarkdown || zenrowsOpts?.outputFormat === 'markdown') {\n        queryParams.response_type = 'markdown';\n      }\n\n      if (options.includeScreenshot || zenrowsOpts?.screenshot) {\n        queryParams.screenshot = true;\n        if (zenrowsOpts?.screenshotFullpage) {\n          queryParams.screenshot_fullpage = true;\n        }\n      }\n\n      if (zenrowsOpts?.autoparse) {\n        queryParams.autoparse = true;\n      }\n\n      if (zenrowsOpts?.cssExtractor) {\n        queryParams.css_extractor = zenrowsOpts.cssExtractor;\n      }\n\n      if (zenrowsOpts?.blockResources) {\n        queryParams.block_resources = zenrowsOpts.blockResources;\n      }\n\n      if (zenrowsOpts?.sessionId) {\n        queryParams.session_id = zenrowsOpts.sessionId;\n      }\n\n      if (zenrowsOpts?.device) {\n        queryParams.device = zenrowsOpts.device;\n      }\n\n      if (zenrowsOpts?.originalStatus) {\n        queryParams.original_status = true;\n      }\n\n      if (zenrowsOpts?.proxyCountry) {\n        queryParams.proxy_country = zenrowsOpts.proxyCountry;\n      }\n\n      if (zenrowsOpts?.jsInstructions) {\n        queryParams.js_instructions = zenrowsOpts.jsInstructions;\n      }\n\n      // Add custom headers if provided\n      if (options.headers && zenrowsOpts?.customHeaders !== false) {\n        queryParams.custom_headers = true;\n      }\n\n      // Build full URL with query params\n      const endpoint = `/?${buildQueryString(queryParams)}`;\n\n      // Make request\n      const response = await this.connector.fetch(endpoint, {\n        method: 'GET',\n        headers: options.headers,\n        timeout: options.timeout || 60000, // ZenRows can take longer with JS rendering\n      });\n\n      // Parse headers\n      const headers = Object.fromEntries(response.headers.entries()) as ZenRowsHeaders;\n      const finalUrl = headers['zr-final-url'] || url;\n      const statusCode = parseInt(headers['zr-status'] || '200', 10);\n\n      // Check for errors\n      if (!response.ok) {\n        const errorText = await response.text();\n        return {\n          success: false,\n          url,\n          provider: this.name,\n          error: `ZenRows API error (${response.status}): ${errorText}`,\n          statusCode: response.status,\n          durationMs: Date.now() - startTime,\n        };\n      }\n\n      // Parse response based on content type\n      const contentType = headers['content-type'] || '';\n      const isMarkdown = queryParams.response_type === 'markdown';\n      const isScreenshot = queryParams.screenshot;\n\n      let result: ScrapeResult;\n\n      if (isScreenshot && !isMarkdown) {\n        // Screenshot response is base64 encoded\n        const base64 = await response.text();\n        result = {\n          title: '',\n          content: '',\n          screenshot: base64,\n        };\n      } else {\n        const content = await response.text();\n\n        // Extract title from content if HTML\n        let title = '';\n        if (!isMarkdown && contentType.includes('text/html')) {\n          const titleMatch = content.match(/<title[^>]*>([^<]+)<\\/title>/i);\n          title = titleMatch?.[1]?.trim() ?? '';\n        } else if (isMarkdown) {\n          // Try to extract title from first heading\n          const headingMatch = content.match(/^#\\s+(.+)$/m);\n          title = headingMatch?.[1]?.trim() ?? '';\n        }\n\n        result = {\n          title,\n          content: isMarkdown ? content : this.extractText(content),\n          html: options.includeHtml && !isMarkdown ? content : undefined,\n          markdown: isMarkdown ? content : undefined,\n        };\n\n        // Extract links if requested\n        if (options.includeLinks && !isMarkdown) {\n          result.links = this.extractLinks(content, finalUrl);\n        }\n\n        // Extract metadata from HTML\n        if (!isMarkdown) {\n          result.metadata = this.extractMetadata(content);\n        }\n      }\n\n      return {\n        success: true,\n        url,\n        finalUrl,\n        provider: this.name,\n        result,\n        statusCode,\n        durationMs: Date.now() - startTime,\n        requiredJS: queryParams.js_render === true,\n      };\n    } catch (error: any) {\n      return {\n        success: false,\n        url,\n        provider: this.name,\n        error: error.message || 'Unknown error',\n        durationMs: Date.now() - startTime,\n      };\n    }\n  }\n\n  /**\n   * Check if this provider supports a feature\n   */\n  supportsFeature(feature: ScrapeFeature): boolean {\n    const supported: ScrapeFeature[] = [\n      'javascript',\n      'markdown',\n      'screenshot',\n      'links',\n      'metadata',\n      'proxy',\n      'stealth',\n      'dynamic',\n    ];\n    return supported.includes(feature);\n  }\n\n  /**\n   * Get API key from connector\n   */\n  private getApiKey(): string {\n    return this.connector.getApiKey();\n  }\n\n  /**\n   * Extract text content from HTML\n   */\n  private extractText(html: string): string {\n    // Remove script and style tags\n    let text = html.replace(/<script[^>]*>[\\s\\S]*?<\\/script>/gi, '');\n    text = text.replace(/<style[^>]*>[\\s\\S]*?<\\/style>/gi, '');\n\n    // Remove HTML tags\n    text = text.replace(/<[^>]+>/g, ' ');\n\n    // Decode HTML entities\n    text = text\n      .replace(/&nbsp;/g, ' ')\n      .replace(/&amp;/g, '&')\n      .replace(/&lt;/g, '<')\n      .replace(/&gt;/g, '>')\n      .replace(/&quot;/g, '\"')\n      .replace(/&#39;/g, \"'\");\n\n    // Normalize whitespace\n    text = text.replace(/\\s+/g, ' ').trim();\n\n    return text;\n  }\n\n  /**\n   * Extract links from HTML\n   */\n  private extractLinks(html: string, baseUrl: string): Array<{ url: string; text: string }> {\n    const links: Array<{ url: string; text: string }> = [];\n    const linkRegex = /<a[^>]+href=[\"']([^\"']+)[\"'][^>]*>([^<]*)<\\/a>/gi;\n    let match;\n\n    while ((match = linkRegex.exec(html)) !== null) {\n      try {\n        const href = match[1];\n        const text = match[2]?.trim() ?? '';\n\n        // Skip if href is missing\n        if (!href) continue;\n\n        // Resolve relative URLs\n        const absoluteUrl = new URL(href, baseUrl).href;\n\n        // Skip javascript: and mailto: links\n        if (!absoluteUrl.startsWith('javascript:') && !absoluteUrl.startsWith('mailto:')) {\n          links.push({ url: absoluteUrl, text: text || absoluteUrl });\n        }\n      } catch {\n        // Skip invalid URLs\n      }\n    }\n\n    return links;\n  }\n\n  /**\n   * Extract metadata from HTML\n   */\n  private extractMetadata(\n    html: string\n  ): ScrapeResult['metadata'] {\n    const metadata: ScrapeResult['metadata'] = {};\n\n    // Extract meta tags\n    const metaRegex = /<meta[^>]+(?:name|property)=[\"']([^\"']+)[\"'][^>]+content=[\"']([^\"']+)[\"']/gi;\n    let match;\n\n    while ((match = metaRegex.exec(html)) !== null) {\n      const name = match[1]?.toLowerCase();\n      const content = match[2];\n\n      // Skip if no name or content\n      if (!name || !content) continue;\n\n      if (name === 'description' || name === 'og:description') {\n        metadata.description = metadata.description || content;\n      } else if (name === 'author') {\n        metadata.author = content;\n      } else if (name === 'og:site_name') {\n        metadata.siteName = content;\n      } else if (name === 'og:image') {\n        metadata.ogImage = content;\n      } else if (name === 'article:published_time') {\n        metadata.publishedDate = content;\n      }\n    }\n\n    // Extract favicon\n    const faviconMatch = html.match(/<link[^>]+rel=[\"'](?:shortcut )?icon[\"'][^>]+href=[\"']([^\"']+)[\"']/i);\n    if (faviconMatch) {\n      metadata.favicon = faviconMatch[1];\n    }\n\n    return Object.keys(metadata).length > 0 ? metadata : undefined;\n  }\n}\n\n// Self-register when imported\nregisterScrapeProvider('zenrows', ZenRowsProvider);\n","/**\n * IContextStorage - Storage interface for AgentContext persistence\n *\n * Provides persistence operations for AgentContext sessions.\n * Implementations can use filesystem, database, cloud storage, etc.\n *\n * This follows Clean Architecture - the interface is in domain layer,\n * implementations are in infrastructure layer.\n */\n\nimport type { SerializedAgentContextState } from '../../core/AgentContext.js';\n\n/**\n * Session summary for listing (lightweight, no full state)\n */\nexport interface ContextSessionSummary {\n  /** Session identifier */\n  sessionId: string;\n\n  /** When the session was created */\n  createdAt: Date;\n\n  /** When the session was last saved */\n  lastSavedAt: Date;\n\n  /** Number of messages in history */\n  messageCount: number;\n\n  /** Number of memory entries */\n  memoryEntryCount: number;\n\n  /** Optional metadata */\n  metadata?: ContextSessionMetadata;\n}\n\n/**\n * Session metadata (stored with session)\n */\nexport interface ContextSessionMetadata {\n  /** Human-readable title */\n  title?: string;\n\n  /** Auto-generated or user-provided description */\n  description?: string;\n\n  /** Tags for filtering */\n  tags?: string[];\n\n  /** Custom key-value data */\n  [key: string]: unknown;\n}\n\n/**\n * Full session state wrapper (includes metadata)\n */\nexport interface StoredContextSession {\n  /** Format version for migration support */\n  version: number;\n\n  /** Session identifier */\n  sessionId: string;\n\n  /** When the session was created */\n  createdAt: string; // ISO string\n\n  /** When the session was last saved */\n  lastSavedAt: string; // ISO string\n\n  /** The serialized AgentContext state */\n  state: SerializedAgentContextState;\n\n  /** Session metadata */\n  metadata: ContextSessionMetadata;\n}\n\n/**\n * Current format version for stored sessions\n */\nexport const CONTEXT_SESSION_FORMAT_VERSION = 1;\n\n/**\n * Storage interface for AgentContext persistence\n *\n * Implementations:\n * - FileContextStorage: File-based storage at ~/.oneringai/agents/<agentId>/sessions/\n * - (Future) RedisContextStorage, PostgresContextStorage, S3ContextStorage, etc.\n */\nexport interface IContextStorage {\n  /**\n   * Save context state to a session\n   *\n   * @param sessionId - Unique session identifier\n   * @param state - Serialized AgentContext state\n   * @param metadata - Optional session metadata\n   */\n  save(\n    sessionId: string,\n    state: SerializedAgentContextState,\n    metadata?: ContextSessionMetadata\n  ): Promise<void>;\n\n  /**\n   * Load context state from a session\n   *\n   * @param sessionId - Session identifier to load\n   * @returns The stored session, or null if not found\n   */\n  load(sessionId: string): Promise<StoredContextSession | null>;\n\n  /**\n   * Delete a session\n   *\n   * @param sessionId - Session identifier to delete\n   */\n  delete(sessionId: string): Promise<void>;\n\n  /**\n   * Check if a session exists\n   *\n   * @param sessionId - Session identifier to check\n   */\n  exists(sessionId: string): Promise<boolean>;\n\n  /**\n   * List all sessions (summaries only, not full state)\n   *\n   * @param options - Optional filtering and pagination\n   * @returns Array of session summaries, sorted by lastSavedAt descending\n   */\n  list(options?: ContextStorageListOptions): Promise<ContextSessionSummary[]>;\n\n  /**\n   * Update session metadata without loading full state\n   *\n   * @param sessionId - Session identifier\n   * @param metadata - Metadata to merge (existing keys preserved unless overwritten)\n   */\n  updateMetadata?(\n    sessionId: string,\n    metadata: Partial<ContextSessionMetadata>\n  ): Promise<void>;\n\n  /**\n   * Get the storage path/location (for display/debugging)\n   */\n  getPath(): string;\n}\n\n/**\n * Options for listing sessions\n */\nexport interface ContextStorageListOptions {\n  /** Filter by tags (any match) */\n  tags?: string[];\n\n  /** Filter by creation date range */\n  createdAfter?: Date;\n  createdBefore?: Date;\n\n  /** Filter by last saved date range */\n  savedAfter?: Date;\n  savedBefore?: Date;\n\n  /** Maximum number of results */\n  limit?: number;\n\n  /** Offset for pagination */\n  offset?: number;\n}\n","/**\n * IAgentDefinitionStorage - Storage interface for Agent configuration persistence\n *\n * Provides persistence operations for agent definitions (configuration, model, system prompt, etc.).\n * This allows agents to be instantiated from stored configurations.\n *\n * This follows Clean Architecture - the interface is in domain layer,\n * implementations are in infrastructure layer.\n */\n\nimport type { AgentContextFeatures } from '../../core/AgentContext.js';\n\n/**\n * Agent type identifier\n */\nexport type StoredAgentType = 'agent' | 'task-agent' | 'universal-agent' | 'research-agent' | string;\n\n/**\n * Stored agent definition - everything needed to recreate an agent\n */\nexport interface StoredAgentDefinition {\n  /** Format version for migration support */\n  version: number;\n\n  /** Unique agent identifier */\n  agentId: string;\n\n  /** Human-readable agent name */\n  name: string;\n\n  /** Agent type */\n  agentType: StoredAgentType;\n\n  /** When the definition was created */\n  createdAt: string; // ISO string\n\n  /** When the definition was last updated */\n  updatedAt: string; // ISO string\n\n  /** Connector configuration */\n  connector: {\n    /** Connector name (must be registered at runtime) */\n    name: string;\n    /** Model to use */\n    model: string;\n  };\n\n  /** System prompt */\n  systemPrompt?: string;\n\n  /** Instructions */\n  instructions?: string;\n\n  /** Feature configuration */\n  features?: AgentContextFeatures;\n\n  /** Agent metadata */\n  metadata?: AgentDefinitionMetadata;\n\n  /** Agent-type-specific configuration */\n  typeConfig?: Record<string, unknown>;\n}\n\n/**\n * Agent definition metadata\n */\nexport interface AgentDefinitionMetadata {\n  /** Description of what this agent does */\n  description?: string;\n\n  /** Tags for categorization */\n  tags?: string[];\n\n  /** Author/creator */\n  author?: string;\n\n  /** Custom key-value data */\n  [key: string]: unknown;\n}\n\n/**\n * Agent definition summary for listing\n */\nexport interface AgentDefinitionSummary {\n  /** Agent identifier */\n  agentId: string;\n\n  /** Agent name */\n  name: string;\n\n  /** Agent type */\n  agentType: StoredAgentType;\n\n  /** Model being used */\n  model: string;\n\n  /** When created */\n  createdAt: Date;\n\n  /** When last updated */\n  updatedAt: Date;\n\n  /** Optional metadata */\n  metadata?: AgentDefinitionMetadata;\n}\n\n/**\n * Current format version for stored agent definitions\n */\nexport const AGENT_DEFINITION_FORMAT_VERSION = 1;\n\n/**\n * Storage interface for agent definitions\n *\n * Implementations:\n * - FileAgentDefinitionStorage: File-based storage at ~/.oneringai/agents/<agentId>/\n * - (Future) DatabaseAgentDefinitionStorage, etc.\n */\nexport interface IAgentDefinitionStorage {\n  /**\n   * Save an agent definition\n   *\n   * @param definition - The agent definition to save\n   */\n  save(definition: StoredAgentDefinition): Promise<void>;\n\n  /**\n   * Load an agent definition\n   *\n   * @param agentId - Agent identifier to load\n   * @returns The stored definition, or null if not found\n   */\n  load(agentId: string): Promise<StoredAgentDefinition | null>;\n\n  /**\n   * Delete an agent definition\n   *\n   * @param agentId - Agent identifier to delete\n   */\n  delete(agentId: string): Promise<void>;\n\n  /**\n   * Check if an agent definition exists\n   *\n   * @param agentId - Agent identifier to check\n   */\n  exists(agentId: string): Promise<boolean>;\n\n  /**\n   * List all agent definitions (summaries only)\n   *\n   * @param options - Optional filtering\n   * @returns Array of agent summaries, sorted by updatedAt descending\n   */\n  list(options?: AgentDefinitionListOptions): Promise<AgentDefinitionSummary[]>;\n\n  /**\n   * Update agent definition metadata without loading full definition\n   *\n   * @param agentId - Agent identifier\n   * @param metadata - Metadata to merge\n   */\n  updateMetadata?(\n    agentId: string,\n    metadata: Partial<AgentDefinitionMetadata>\n  ): Promise<void>;\n\n  /**\n   * Get the storage path/location (for display/debugging)\n   */\n  getPath(): string;\n}\n\n/**\n * Options for listing agent definitions\n */\nexport interface AgentDefinitionListOptions {\n  /** Filter by agent type */\n  agentType?: StoredAgentType;\n\n  /** Filter by tags (any match) */\n  tags?: string[];\n\n  /** Maximum number of results */\n  limit?: number;\n\n  /** Offset for pagination */\n  offset?: number;\n}\n","/**\n * TaskAgent - autonomous task-based agent\n *\n * Extends BaseAgent to inherit:\n * - Connector resolution\n * - Tool manager initialization\n * - Permission manager initialization\n * - Session management\n * - Lifecycle/cleanup\n *\n * Uses AgentContext with PlanPlugin and MemoryPlugin for unified\n * context management across all agent types.\n */\n\nimport { BaseAgent, BaseAgentConfig, BaseSessionConfig } from '../../core/BaseAgent.js';\nimport { Connector } from '../../core/Connector.js';\nimport { Agent } from '../../core/Agent.js';\nimport type { IContextStorage } from '../../domain/interfaces/IContextStorage.js';\nimport { ToolFunction } from '../../domain/entities/Tool.js';\nimport { Plan, PlanInput, Task, TaskInput, TaskValidationResult, createPlan, createTask, detectDependencyCycle } from '../../domain/entities/Task.js';\nimport { DependencyCycleError } from '../../domain/errors/AIErrors.js';\nimport { AgentState, AgentStatus, createAgentState, updateAgentStatus } from '../../domain/entities/AgentState.js';\nimport type { WorkingMemoryConfig } from '../../domain/entities/Memory.js';\nimport { DEFAULT_MEMORY_CONFIG } from '../../domain/entities/Memory.js';\nimport { IAgentStorage, createAgentStorage } from '../../infrastructure/storage/InMemoryStorage.js';\nimport { WorkingMemory } from './WorkingMemory.js';\n// Unified AgentContext (inherited from BaseAgent, import only for type reference if needed)\nimport { PlanPlugin } from '../../core/context/plugins/PlanPlugin.js';\nimport { MemoryPlugin } from '../../core/context/plugins/MemoryPlugin.js';\n// NOTE: IdempotencyCache is accessed via this._agentContext.cache (single source of truth)\nimport { ExternalDependencyHandler } from './ExternalDependencyHandler.js';\nimport { PlanExecutor } from './PlanExecutor.js';\nimport { CheckpointManager, DEFAULT_CHECKPOINT_STRATEGY } from './CheckpointManager.js';\nimport { getModelInfo } from '../../domain/entities/Model.js';\nimport type { AgentPermissionsConfig } from '../../core/permissions/types.js';\nimport { CONTEXT_DEFAULTS } from '../../core/constants.js';\n\n// NOTE: TaskAgent now exposes AgentContext directly via the `context` getter.\n// TaskAgentContextAccess interface is deprecated - use AgentContext API instead.\n\n/**\n * TaskAgent hooks for customization\n */\nexport interface TaskAgentHooks {\n  /** Before agent starts executing */\n  onStart?: (agent: TaskAgent, plan: Plan) => Promise<void>;\n\n  /** Before each task starts */\n  beforeTask?: (task: Task, context: TaskContext) => Promise<void | 'skip'>;\n\n  /** After each task completes */\n  afterTask?: (task: Task, result: TaskResult) => Promise<void>;\n\n  /**\n   * Validate task completion with custom logic.\n   * Called after task execution to verify the task achieved its goal.\n   *\n   * Return values:\n   * - `TaskValidationResult`: Full validation result with score and details\n   * - `true`: Task is complete\n   * - `false`: Task failed validation (will use default error message)\n   * - `string`: Task failed validation with custom reason\n   *\n   * If not provided, the default LLM self-reflection validation is used\n   * (when task.validation is configured).\n   */\n  validateTask?: (\n    task: Task,\n    result: TaskResult,\n    memory: WorkingMemory\n  ) => Promise<TaskValidationResult | boolean | string>;\n\n  /** Before each LLM call */\n  beforeLLMCall?: (messages: any[], options: any) => Promise<any[]>;\n\n  /** After each LLM response */\n  afterLLMCall?: (response: any) => Promise<void>;\n\n  /** Before each tool execution */\n  beforeTool?: (tool: ToolFunction, args: unknown) => Promise<unknown>;\n\n  /** After tool execution */\n  afterTool?: (tool: ToolFunction, args: unknown, result: unknown) => Promise<unknown>;\n\n  /** On any error */\n  onError?: (error: Error, context: ErrorContext) => Promise<'retry' | 'fail' | 'skip'>;\n\n  /** On agent completion */\n  onComplete?: (result: PlanResult) => Promise<void>;\n}\n\n/**\n * Task execution context\n */\nexport interface TaskContext {\n  taskId: string;\n  taskName: string;\n  attempt: number;\n}\n\n/**\n * Task result\n */\nexport interface TaskResult {\n  success: boolean;\n  output?: unknown;\n  error?: string;\n}\n\n/**\n * Error context\n */\nexport interface ErrorContext {\n  task?: Task;\n  error: Error;\n  phase: 'tool' | 'llm' | 'execution';\n}\n\n/**\n * Plan result\n */\nexport interface PlanResult {\n  status: 'completed' | 'failed' | 'cancelled';\n  output?: unknown;\n  error?: string;\n  metrics: {\n    totalTasks: number;\n    completedTasks: number;\n    failedTasks: number;\n    skippedTasks: number;\n  };\n}\n\n/**\n * Agent handle returned from start()\n */\nexport interface AgentHandle {\n  agentId: string;\n  planId: string;\n\n  /** Wait for completion */\n  wait(): Promise<PlanResult>;\n\n  /** Get current status */\n  status(): AgentStatus;\n}\n\n/**\n * Plan updates specification\n */\nexport interface PlanUpdates {\n  addTasks?: TaskInput[];\n  updateTasks?: Array<{ id: string } & Partial<Task>>;\n  removeTasks?: string[];\n}\n\n/**\n * Options for plan update validation\n */\nexport interface PlanUpdateOptions {\n  /**\n   * Allow removing tasks that are currently in_progress.\n   * @default false\n   */\n  allowRemoveActiveTasks?: boolean;\n\n  /**\n   * Validate that no dependency cycles exist after the update.\n   * @default true\n   */\n  validateCycles?: boolean;\n}\n\n/**\n * Session configuration for TaskAgent - extends BaseSessionConfig\n */\nexport interface TaskAgentSessionConfig extends BaseSessionConfig {\n  // TaskAgent-specific session options can be added here\n}\n\n/**\n * TaskAgent configuration - extends BaseAgentConfig\n */\nexport interface TaskAgentConfig extends BaseAgentConfig {\n  /** System instructions for the agent */\n  instructions?: string;\n\n  /** Temperature for generation */\n  temperature?: number;\n\n  /** Maximum iterations for tool calling loop */\n  maxIterations?: number;\n\n  /** Storage for persistence (agent state, checkpoints) */\n  storage?: IAgentStorage;\n\n  /** Memory configuration */\n  memoryConfig?: WorkingMemoryConfig;\n\n  /** Hooks for customization */\n  hooks?: TaskAgentHooks;\n\n  /** Session configuration - extends base type */\n  session?: TaskAgentSessionConfig;\n\n  /** Permission configuration for tool execution approval */\n  permissions?: AgentPermissionsConfig;\n}\n\n/**\n * TaskAgent events - extends BaseAgentEvents\n */\nexport interface TaskAgentEvents {\n  'task:start': { task: Task };\n  'task:complete': { task: Task; result: TaskResult };\n  'task:failed': { task: Task; error: Error };\n  'task:validation_failed': { task: Task; validation: TaskValidationResult };\n  'task:waiting': { task: Task; dependency: any };\n  'plan:updated': { plan: Plan };\n  'agent:suspended': { reason: string };\n  'agent:resumed': Record<string, never>;\n  'agent:completed': { result: PlanResult };\n  'memory:stored': { key: string; description: string };\n  'memory:limit_warning': { utilization: number };\n  // Inherited from BaseAgentEvents\n  'session:saved': { sessionId: string };\n  'session:loaded': { sessionId: string };\n  destroyed: void;\n}\n\n/**\n * TaskAgent - autonomous task-based agent.\n *\n * Extends BaseAgent to inherit connector resolution, tool management,\n * permission management, session management, and lifecycle.\n *\n * Features:\n * - Plan-driven execution\n * - Working memory with indexed access\n * - External dependency handling (webhooks, polling, manual)\n * - Suspend/resume capability\n * - State persistence for long-running agents\n */\nexport class TaskAgent extends BaseAgent<TaskAgentConfig, TaskAgentEvents> {\n  readonly id: string;\n  protected state: AgentState;\n  protected agentStorage: IAgentStorage;\n  // NOTE: Memory is accessed via this._agentContext.memory (single source of truth)\n  // The 'memory' getter below provides convenient access\n  protected hooks?: TaskAgentHooks;\n  protected executionPromise?: Promise<PlanResult>;\n\n  // Internal components\n  protected agent?: Agent;\n  // Note: _agentContext is inherited from BaseAgent (single source of truth)\n  // Cache is accessed via this._agentContext.cache (single source of truth)\n  protected _planPlugin?: PlanPlugin;\n  protected _memoryPlugin?: MemoryPlugin;\n  protected externalHandler?: ExternalDependencyHandler;\n  protected planExecutor?: PlanExecutor;\n  protected checkpointManager?: CheckpointManager;\n  protected _allTools: ToolFunction[] = [];\n\n  // Event listener cleanup tracking\n  private eventCleanupFunctions: Array<() => void> = [];\n\n  // ===== Static Factory =====\n\n  /**\n   * Create a new TaskAgent\n   */\n  static create(config: TaskAgentConfig): TaskAgent {\n    // Resolve connector (use Connector.get directly since we're in static method)\n    const connector =\n      typeof config.connector === 'string' ? Connector.get(config.connector) : config.connector;\n\n    if (!connector) {\n      throw new Error(`Connector \"${config.connector}\" not found`);\n    }\n\n    // Create agent storage\n    const agentStorage = config.storage ?? createAgentStorage({});\n\n    // NOTE: WorkingMemory is created by AgentContext (single source of truth)\n    // We pass memory config via the context config below\n    const memoryConfig = config.memoryConfig ?? DEFAULT_MEMORY_CONFIG;\n\n    // Generate agent ID\n    const id = `task-agent-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n\n    // Create empty initial plan (will be set on start)\n    const emptyPlan = createPlan({ goal: '', tasks: [] });\n\n    const agentStateConfig = {\n      connectorName: typeof config.connector === 'string' ? config.connector : connector.name,\n      model: config.model,\n      temperature: config.temperature,\n      maxIterations: config.maxIterations,\n      toolNames: (config.tools ?? []).map((t) => t.definition.function.name),\n    };\n\n    const state = createAgentState(id, agentStateConfig, emptyPlan);\n\n    // Create TaskAgent - memory config is passed to AgentContext via config.context\n    const taskAgentConfig: TaskAgentConfig = {\n      ...config,\n      // Pass memory config to AgentContext\n      context: {\n        ...(typeof config.context === 'object' && config.context !== null && !(config.context instanceof Object.getPrototypeOf(config.context)?.constructor) ? config.context : {}),\n        memory: {\n          storage: agentStorage.memory,\n          ...memoryConfig,\n        },\n      },\n    };\n\n    const taskAgent = new TaskAgent(id, state, agentStorage, taskAgentConfig, config.hooks);\n\n    // Initialize components\n    taskAgent.initializeComponents(taskAgentConfig);\n\n    return taskAgent;\n  }\n\n  /**\n   * Resume an existing agent from storage\n   */\n  static async resume(\n    agentId: string,\n    options: { storage: IAgentStorage; tools?: ToolFunction[]; hooks?: TaskAgentHooks; session?: { storage: IContextStorage } }\n  ): Promise<TaskAgent> {\n    const state = await options.storage.agent.load(agentId);\n    if (!state) {\n      throw new Error(`Agent ${agentId} not found in storage`);\n    }\n\n    // Validate tool names match saved state\n    const stateToolNames = new Set(state.config.toolNames ?? []);\n    const currentToolNames = new Set(\n      (options.tools ?? []).map((t) => t.definition.function.name)\n    );\n\n    const missing = [...stateToolNames].filter((n) => !currentToolNames.has(n));\n    const added = [...currentToolNames].filter((n) => !stateToolNames.has(n));\n\n    if (missing.length > 0) {\n      console.warn(\n        `[TaskAgent.resume] Warning: Missing tools from saved state: ${missing.join(', ')}. ` +\n          `Tasks requiring these tools may fail.`\n      );\n    }\n\n    if (added.length > 0) {\n      console.info(\n        `[TaskAgent.resume] Info: New tools not in saved state: ${added.join(', ')}`\n      );\n    }\n\n    // Recreate config from state - memory config is passed to AgentContext\n    const config: TaskAgentConfig = {\n      connector: state.config.connectorName,\n      model: state.config.model,\n      tools: options.tools ?? [],\n      temperature: state.config.temperature,\n      maxIterations: state.config.maxIterations,\n      storage: options.storage,\n      hooks: options.hooks,\n      session: options.session,\n      // Pass memory config to AgentContext (single source of truth)\n      context: {\n        memory: {\n          storage: options.storage.memory,\n          ...DEFAULT_MEMORY_CONFIG,\n        },\n      },\n    };\n\n    const taskAgent = new TaskAgent(agentId, state, options.storage, config, options.hooks);\n\n    // Initialize components\n    taskAgent.initializeComponents(config);\n\n    return taskAgent;\n  }\n\n  // ===== Constructor =====\n\n  protected constructor(\n    id: string,\n    state: AgentState,\n    agentStorage: IAgentStorage,\n    config: TaskAgentConfig,\n    hooks?: TaskAgentHooks\n  ) {\n    // Call BaseAgent constructor - it handles connector resolution,\n    // tool manager init, permission manager init, and AgentContext creation (including memory)\n    super(config, 'TaskAgent');\n\n    this.id = id;\n    this.state = state;\n    this.agentStorage = agentStorage;\n    this.hooks = hooks;\n\n    // Forward memory events to agent (with cleanup tracking)\n    // Memory is accessed via this._agentContext.memory (single source of truth)\n    // Only set up event handlers if memory feature is enabled\n    const memory = this._agentContext.memory;\n    if (memory) {\n      const storedHandler = (data: { key: string; description: string }) =>\n        this.emit('memory:stored', data);\n      const limitWarningHandler = (data: { utilizationPercent: number }) =>\n        this.emit('memory:limit_warning', { utilization: data.utilizationPercent });\n\n      memory.on('stored', storedHandler);\n      memory.on('limit_warning', limitWarningHandler);\n\n      // Track cleanup functions\n      this.eventCleanupFunctions.push(() => memory.off('stored', storedHandler));\n      this.eventCleanupFunctions.push(() => memory.off('limit_warning', limitWarningHandler));\n    }\n\n    // Initialize session (from BaseAgent)\n    this.initializeSession(config.session);\n  }\n\n  // ===== Abstract Method Implementations =====\n\n  protected getAgentType(): 'agent' | 'task-agent' | 'universal-agent' {\n    return 'task-agent';\n  }\n\n  // ===== Component Initialization =====\n\n  /**\n   * Wrap a tool with idempotency cache and enhanced context.\n   * Uses inherited _agentContext from BaseAgent.\n   */\n  private wrapToolWithCache(tool: ToolFunction): ToolFunction {\n    return {\n      ...tool,\n      execute: async (args: any, context?: any) => {\n        // Enhance context with TaskAgent-specific properties\n        // Use inherited _agentContext from BaseAgent\n        // Memory is accessed via this._agentContext.memory (single source of truth)\n        const enhancedContext = {\n          ...context,\n          memory: this._agentContext.memory?.getAccess(),    // Add memory access for memory tools (may be undefined if disabled)\n          agentContext: this._agentContext,   // Inherited from BaseAgent\n          idempotencyCache: this._agentContext.cache ?? undefined,  // May be undefined if memory disabled\n          agentId: this.id,\n        };\n\n        if (!this._agentContext.cache) {\n          return tool.execute(args, enhancedContext);\n        }\n\n        // Check cache first\n        const cached = await this._agentContext.cache.get(tool, args);\n        if (cached !== undefined) {\n          return cached;\n        }\n\n        // Execute tool with enhanced context\n        const result = await tool.execute(args, enhancedContext);\n\n        // Cache result\n        await this._agentContext.cache.set(tool, args, result);\n\n        return result;\n      }\n    };\n  }\n\n  /**\n   * Initialize internal components\n   */\n  private initializeComponents(config: TaskAgentConfig): void {\n    // User tools are already registered by BaseAgent constructor\n    // Feature-aware tools (memory, cache, introspection) are auto-registered by AgentContext\n    // This ensures consistent tool availability across ALL agent types\n    this._allTools = [...(config.tools ?? [])];\n\n    // NOTE: IdempotencyCache is accessed via this._agentContext.cache (single source of truth)\n    // If memory feature is disabled, cache will be null\n\n    // Get enabled tools from inherited AgentContext and wrap with cache\n    const enabledTools = this._agentContext.tools.getEnabled();\n    const cachedTools = enabledTools.map((tool) => this.wrapToolWithCache(tool));\n\n    // Create base Agent for LLM calls (shares the inherited AgentContext)\n    this.agent = Agent.create({\n      connector: config.connector,\n      model: config.model,\n      tools: cachedTools,\n      instructions: config.instructions,\n      temperature: config.temperature,\n      maxIterations: config.maxIterations ?? 10,\n      permissions: config.permissions,\n      context: this._agentContext,  // Share inherited AgentContext\n    });\n\n    // Calculate context limit from model and update inherited AgentContext\n    const modelInfo = getModelInfo(config.model);\n    const contextTokens = modelInfo?.features.input.tokens ?? CONTEXT_DEFAULTS.MAX_TOKENS;\n    this._agentContext.setMaxContextTokens(contextTokens);\n\n    // Set system prompt on inherited AgentContext\n    if (config.instructions) {\n      this._agentContext.systemPrompt = config.instructions;\n    }\n\n    // Create plugins for the inherited AgentContext\n    // NOTE: Memory is accessed via this._agentContext.memory (single source of truth)\n    this._planPlugin = new PlanPlugin();\n    this._agentContext.registerPlugin(this._planPlugin);\n\n    // Only create MemoryPlugin if memory feature is enabled\n    if (this._agentContext.memory) {\n      this._memoryPlugin = new MemoryPlugin(this._agentContext.memory);\n      this._agentContext.registerPlugin(this._memoryPlugin);\n    }\n\n    // Set initial plan in plugin\n    this._planPlugin.setPlan(this.state.plan);\n\n    // Create external dependency handler\n    this.externalHandler = new ExternalDependencyHandler(this._allTools);\n\n    // Create checkpoint manager\n    this.checkpointManager = new CheckpointManager(this.agentStorage, DEFAULT_CHECKPOINT_STRATEGY);\n\n    // Create plan executor with inherited AgentContext\n    // NOTE: PlanExecutor gets memory and cache from AgentContext (single source of truth)\n    this.planExecutor = new PlanExecutor(\n      this.agent,\n      this._agentContext,\n      this._planPlugin,\n      this.externalHandler,\n      this.checkpointManager,\n      this.hooks,\n      {\n        maxIterations: config.maxIterations ?? 100,\n      }\n    );\n\n    // Forward events from plan executor to task agent (with cleanup tracking)\n    this.setupPlanExecutorEvents();\n  }\n\n  /**\n   * Setup event forwarding from PlanExecutor\n   */\n  private setupPlanExecutorEvents(): void {\n    if (!this.planExecutor) return;\n\n    const taskStartHandler = (data: { task: Task }) => this.emit('task:start', data);\n    const taskCompleteHandler = (data: { task: Task; result: unknown }) => {\n      this.emit('task:complete', { task: data.task, result: { success: true, output: data.result } });\n      // Call afterTask hook\n      if (this.hooks?.afterTask) {\n        this.hooks.afterTask(data.task, { success: true, output: data.result });\n      }\n    };\n    const taskFailedHandler = (data: { task: Task; error: Error }) => this.emit('task:failed', data);\n    const taskSkippedHandler = (data: { task: Task; reason: string }) =>\n      this.emit('task:failed', { task: data.task, error: new Error(data.reason) });\n    const taskWaitingExternalHandler = (data: { task: Task }) =>\n      this.emit('task:waiting', { task: data.task, dependency: data.task.externalDependency });\n    const taskValidationFailedHandler = (data: { task: Task; validation: TaskValidationResult }) =>\n      this.emit('task:validation_failed', data);\n\n    this.planExecutor.on('task:start', taskStartHandler);\n    this.planExecutor.on('task:complete', taskCompleteHandler);\n    this.planExecutor.on('task:failed', taskFailedHandler);\n    this.planExecutor.on('task:skipped', taskSkippedHandler);\n    this.planExecutor.on('task:waiting_external', taskWaitingExternalHandler);\n    this.planExecutor.on('task:validation_failed', taskValidationFailedHandler);\n    this.planExecutor.on('task:validation_uncertain', taskValidationFailedHandler);\n\n    // Track cleanup functions\n    this.eventCleanupFunctions.push(() => this.planExecutor?.off('task:start', taskStartHandler));\n    this.eventCleanupFunctions.push(() => this.planExecutor?.off('task:complete', taskCompleteHandler));\n    this.eventCleanupFunctions.push(() => this.planExecutor?.off('task:failed', taskFailedHandler));\n    this.eventCleanupFunctions.push(() => this.planExecutor?.off('task:skipped', taskSkippedHandler));\n    this.eventCleanupFunctions.push(() => this.planExecutor?.off('task:waiting_external', taskWaitingExternalHandler));\n    this.eventCleanupFunctions.push(() => this.planExecutor?.off('task:validation_failed', taskValidationFailedHandler));\n    this.eventCleanupFunctions.push(() => this.planExecutor?.off('task:validation_uncertain', taskValidationFailedHandler));\n  }\n\n  // ===== Public API =====\n\n  // ===== Unified Context Access =====\n\n  // Note: `context` getter is inherited from BaseAgent (returns _agentContext)\n  // The inherited getter returns the AgentContext which is always available after BaseAgent constructor\n\n  /**\n   * Check if context is available (components initialized).\n   * Always true since AgentContext is created by BaseAgent constructor.\n   */\n  hasContext(): boolean {\n    return true;\n  }\n\n  /**\n   * Start executing a plan\n   */\n  async start(planInput: PlanInput): Promise<AgentHandle> {\n    // Create plan\n    const plan = createPlan(planInput);\n    this.state.plan = plan;\n    this.state = updateAgentStatus(this.state, 'running');\n\n    // Call onStart hook\n    if (this.hooks?.onStart) {\n      await this.hooks.onStart(this, plan);\n    }\n\n    // Start execution and store promise\n    this.executionPromise = this.executePlan()\n      .then(async (result) => {\n        // Call onComplete hook after execution finishes\n        if (this.hooks?.onComplete) {\n          await this.hooks.onComplete(result);\n        }\n        return result;\n      })\n      .catch(async (error) => {\n        // Call onError hook on failure\n        if (this.hooks?.onError) {\n          await this.hooks.onError(error, { error, phase: 'execution' });\n        }\n        throw error;\n      });\n\n    // For sync-like behavior in tests, await completion\n    await this.executionPromise.catch(() => {\n      // Swallow error here, it will be re-thrown when wait() is called\n    });\n\n    // Return handle\n    return {\n      agentId: this.id,\n      planId: plan.id,\n      wait: async () => {\n        if (!this.executionPromise) {\n          throw new Error('No execution in progress');\n        }\n        return this.executionPromise;\n      },\n      status: () => this.state.status,\n    };\n  }\n\n  /**\n   * Pause execution\n   */\n  async pause(): Promise<void> {\n    this.state = updateAgentStatus(this.state, 'suspended');\n    this.state.plan.status = 'suspended';\n\n    this.emit('agent:suspended', { reason: 'manual_pause' });\n  }\n\n  /**\n   * Resume execution after pause\n   * Note: Named resumeExecution to avoid conflict with BaseAgent if any\n   */\n  async resume(): Promise<void> {\n    this.state = updateAgentStatus(this.state, 'running');\n    this.state.plan.status = 'running';\n\n    this.emit('agent:resumed', {});\n\n    // Continue execution\n    await this.executePlan();\n  }\n\n  /**\n   * Cancel execution\n   */\n  async cancel(): Promise<void> {\n    this.state = updateAgentStatus(this.state, 'cancelled');\n    this.state.plan.status = 'cancelled';\n  }\n\n  /**\n   * Trigger external dependency completion\n   */\n  async triggerExternal(webhookId: string, data: unknown): Promise<void> {\n    const plan = this.state.plan;\n    if (!plan) {\n      throw new Error('No plan running');\n    }\n\n    // Find task with this webhook\n    const task = plan.tasks.find((t) => t.externalDependency?.webhookId === webhookId);\n\n    if (!task || !task.externalDependency) {\n      throw new Error(`Task waiting on webhook ${webhookId} not found`);\n    }\n\n    // Mark as received\n    task.externalDependency.state = 'received';\n    task.externalDependency.receivedData = data;\n    task.externalDependency.receivedAt = Date.now();\n\n    // Resume execution\n    await this.resume();\n  }\n\n  /**\n   * Manually complete a task\n   */\n  async completeTaskManually(taskId: string, result: unknown): Promise<void> {\n    const plan = this.state.plan;\n    if (!plan) {\n      throw new Error('No plan running');\n    }\n\n    const task = plan.tasks.find((t) => t.id === taskId);\n    if (!task || !task.externalDependency) {\n      throw new Error(`Task ${taskId} not found or not waiting on manual input`);\n    }\n\n    // Mark as received\n    task.externalDependency.state = 'received';\n    task.externalDependency.receivedData = result;\n    task.externalDependency.receivedAt = Date.now();\n  }\n\n  /**\n   * Update the plan with validation\n   *\n   * @param updates - The updates to apply to the plan\n   * @param options - Validation options\n   * @throws Error if validation fails\n   */\n  async updatePlan(updates: PlanUpdates, options?: PlanUpdateOptions): Promise<void> {\n    const plan = this.state.plan;\n    if (!plan) {\n      throw new Error('No plan running');\n    }\n\n    if (!plan.allowDynamicTasks && (updates.addTasks || updates.removeTasks)) {\n      throw new Error('Dynamic tasks are disabled for this plan');\n    }\n\n    const opts = {\n      allowRemoveActiveTasks: options?.allowRemoveActiveTasks ?? false,\n      validateCycles: options?.validateCycles ?? true,\n    };\n\n    // Validate: don't remove in_progress tasks unless explicitly allowed\n    if (!opts.allowRemoveActiveTasks && updates.removeTasks && updates.removeTasks.length > 0) {\n      const activeTasks = plan.tasks.filter(\n        (t) => t.status === 'in_progress' && updates.removeTasks!.includes(t.id)\n      );\n      if (activeTasks.length > 0) {\n        const names = activeTasks.map((t) => t.name).join(', ');\n        throw new Error(`Cannot remove active tasks: ${names}. Set allowRemoveActiveTasks: true to override.`);\n      }\n    }\n\n    // Add tasks\n    if (updates.addTasks) {\n      for (const taskInput of updates.addTasks) {\n        const task = createTask(taskInput);\n        plan.tasks.push(task);\n      }\n    }\n\n    // Update tasks\n    if (updates.updateTasks) {\n      for (const update of updates.updateTasks) {\n        const task = plan.tasks.find((t) => t.id === update.id);\n        if (task) {\n          Object.assign(task, update);\n        }\n      }\n    }\n\n    // Remove tasks\n    if (updates.removeTasks) {\n      plan.tasks = plan.tasks.filter((t) => !updates.removeTasks!.includes(t.id));\n    }\n\n    // Validate: check for cycles after update\n    if (opts.validateCycles) {\n      const cycle = detectDependencyCycle(plan.tasks);\n      if (cycle) {\n        // Convert task IDs to names for better error message\n        const cycleNames = cycle.map((taskId) => {\n          const task = plan.tasks.find((t) => t.id === taskId);\n          return task ? task.name : taskId;\n        });\n        throw new DependencyCycleError(cycleNames, plan.id);\n      }\n    }\n\n    plan.lastUpdatedAt = Date.now();\n\n    this.emit('plan:updated', { plan });\n  }\n\n  // ===== State Introspection =====\n\n  /**\n   * Get current agent state\n   */\n  getState(): AgentState {\n    return this.state;\n  }\n\n  /**\n   * Get current plan\n   */\n  getPlan(): Plan {\n    if (!this.state.plan || !this.state.plan.goal) {\n      throw new Error('No plan started');\n    }\n    return this.state.plan;\n  }\n\n  /**\n   * Get working memory (from AgentContext - single source of truth)\n   * Returns null if memory feature is disabled\n   */\n  getMemory(): WorkingMemory | null {\n    return this._agentContext.memory;\n  }\n\n  /**\n   * Convenient getter for working memory (alias for _agentContext.memory)\n   * Returns null if memory feature is disabled\n   */\n  get memory(): WorkingMemory | null {\n    return this._agentContext.memory;\n  }\n\n  // ===== Plan Execution =====\n\n  /**\n   * Execute the plan (internal)\n   */\n  protected async executePlan(): Promise<PlanResult> {\n    const plan = this.state.plan;\n\n    if (!this.planExecutor) {\n      throw new Error('Plan executor not initialized');\n    }\n\n    try {\n      // Execute the plan\n      const execResult = await this.planExecutor.execute(plan, this.state);\n\n      // Update metrics from execution\n      if (execResult.metrics) {\n        this.state.metrics.totalLLMCalls += execResult.metrics.totalLLMCalls;\n        this.state.metrics.totalToolCalls += execResult.metrics.totalToolCalls;\n        this.state.metrics.totalTokensUsed += execResult.metrics.totalTokensUsed;\n        this.state.metrics.totalCost += execResult.metrics.totalCost;\n      }\n\n      // Update agent state\n      if (execResult.status === 'completed') {\n        this.state = updateAgentStatus(this.state, 'completed');\n        plan.status = 'completed';\n      } else if (execResult.status === 'failed') {\n        this.state = updateAgentStatus(this.state, 'failed');\n        plan.status = 'failed';\n      } else if (execResult.status === 'suspended') {\n        this.state = updateAgentStatus(this.state, 'suspended');\n        plan.status = 'suspended';\n      }\n\n      // Final checkpoint\n      await this.checkpointManager?.checkpoint(this.state, 'execution_complete');\n\n      const result: PlanResult = {\n        status: execResult.status === 'suspended' ? 'completed' : execResult.status,\n        metrics: {\n          totalTasks: plan.tasks.length,\n          completedTasks: execResult.completedTasks,\n          failedTasks: execResult.failedTasks,\n          skippedTasks: execResult.skippedTasks,\n        },\n      };\n\n      this.emit('agent:completed', { result });\n\n      return result;\n    } catch (error) {\n      // Handle execution error\n      const err = error instanceof Error ? error : new Error(String(error));\n\n      this.state = updateAgentStatus(this.state, 'failed');\n      plan.status = 'failed';\n\n      // Try to checkpoint the failure\n      try {\n        await this.checkpointManager?.checkpoint(this.state, 'execution_failed');\n      } catch {\n        // Ignore checkpoint errors during failure handling\n      }\n\n      const result: PlanResult = {\n        status: 'failed',\n        error: err.message,\n        metrics: {\n          totalTasks: plan.tasks.length,\n          completedTasks: plan.tasks.filter((t) => t.status === 'completed').length,\n          failedTasks: plan.tasks.filter((t) => t.status === 'failed').length,\n          skippedTasks: plan.tasks.filter((t) => t.status === 'skipped').length,\n        },\n      };\n\n      this.emit('agent:completed', { result });\n\n      throw err;\n    }\n  }\n\n  // ===== Cleanup =====\n\n  /**\n   * Cleanup resources\n   */\n  async destroy(): Promise<void> {\n    if (this._isDestroyed) {\n      return;\n    }\n\n    this._logger.debug('TaskAgent destroy started');\n\n    // Remove all event listeners first\n    this.eventCleanupFunctions.forEach((cleanup) => cleanup());\n    this.eventCleanupFunctions = [];\n\n    // Cleanup components\n    this.externalHandler?.cleanup();\n    await this.checkpointManager?.cleanup();\n    this.planExecutor?.destroy();\n    this.agent?.destroy();\n\n    // Run cleanup callbacks\n    await this.runCleanupCallbacks();\n\n    // Call base destroy (handles session, tool manager, permission manager cleanup)\n    this.baseDestroy();\n\n    this._logger.debug('TaskAgent destroyed');\n  }\n}\n","/**\n * Task and Plan entities for TaskAgent\n *\n * Defines the data structures for task-based autonomous agents.\n */\n\nimport { DependencyCycleError } from '../errors/AIErrors.js';\n\n/**\n * Task status lifecycle\n */\nexport type TaskStatus =\n  | 'pending'           // Not started\n  | 'blocked'           // Dependencies not met\n  | 'in_progress'       // Currently executing\n  | 'waiting_external'  // Waiting on external event\n  | 'completed'         // Successfully finished\n  | 'failed'            // Failed after max retries\n  | 'skipped'           // Skipped (condition not met)\n  | 'cancelled';        // Manually cancelled\n\n/**\n * Terminal statuses - task will not progress further\n */\nexport const TERMINAL_TASK_STATUSES: TaskStatus[] = ['completed', 'failed', 'skipped', 'cancelled'];\n\n/**\n * Check if a task status is terminal (task will not progress further)\n */\nexport function isTerminalStatus(status: TaskStatus): boolean {\n  return TERMINAL_TASK_STATUSES.includes(status);\n}\n\n/**\n * Plan status\n */\nexport type PlanStatus =\n  | 'pending'\n  | 'running'\n  | 'suspended'\n  | 'completed'\n  | 'failed'\n  | 'cancelled';\n\n/**\n * Condition operators for conditional task execution\n */\nexport type ConditionOperator =\n  | 'exists'\n  | 'not_exists'\n  | 'equals'\n  | 'contains'\n  | 'truthy'\n  | 'greater_than'\n  | 'less_than';\n\n/**\n * Task condition - evaluated before execution\n */\nexport interface TaskCondition {\n  memoryKey: string;\n  operator: ConditionOperator;\n  value?: unknown;\n  onFalse: 'skip' | 'fail' | 'wait';\n}\n\n/**\n * External dependency configuration\n */\nexport interface ExternalDependency {\n  type: 'webhook' | 'poll' | 'manual' | 'scheduled';\n\n  /** For webhook: unique ID to match incoming webhook */\n  webhookId?: string;\n\n  /** For poll: how to check if complete */\n  pollConfig?: {\n    toolName: string;\n    toolArgs: Record<string, unknown>;\n    intervalMs: number;\n    maxAttempts: number;\n  };\n\n  /** For scheduled: when to resume */\n  scheduledAt?: number;\n\n  /** For manual: description of what's needed */\n  manualDescription?: string;\n\n  /** Timeout for all types */\n  timeoutMs?: number;\n\n  /** Current state */\n  state: 'waiting' | 'received' | 'timeout';\n\n  /** Data received from external source */\n  receivedData?: unknown;\n  receivedAt?: number;\n}\n\n/**\n * Task execution settings\n */\nexport interface TaskExecution {\n  /** Can run in parallel with other parallel tasks */\n  parallel?: boolean;\n\n  /** Max concurrent if this spawns sub-work */\n  maxConcurrency?: number;\n\n  /** Priority (higher = executed first) */\n  priority?: number;\n\n  /**\n   * If true (default), re-check condition immediately before LLM call\n   * to protect against race conditions when parallel tasks modify memory.\n   * Set to false to skip re-check for performance if you know condition won't change.\n   */\n  raceProtection?: boolean;\n}\n\n/**\n * Task completion validation settings\n *\n * Used to verify that a task actually achieved its goal before marking it complete.\n * Supports multiple validation approaches:\n * - Programmatic checks (memory keys, hooks)\n * - LLM self-reflection with completeness scoring\n * - Natural language criteria evaluation\n */\nexport interface TaskValidation {\n  /**\n   * Natural language completion criteria.\n   * These are evaluated by LLM self-reflection to determine if the task is complete.\n   * Examples:\n   * - \"The response contains at least 3 specific examples\"\n   * - \"User's email has been validated and stored in memory\"\n   * - \"All requested data fields are present in the output\"\n   *\n   * This is the RECOMMENDED approach for flexible, intelligent validation.\n   */\n  completionCriteria?: string[];\n\n  /**\n   * Minimum completeness score (0-100) to consider task successful.\n   * LLM self-reflection returns a score; if below this threshold:\n   * - If requireUserApproval is set, ask user\n   * - Otherwise, follow the mode setting (strict = fail, warn = continue)\n   * Default: 80\n   */\n  minCompletionScore?: number;\n\n  /**\n   * When to require user approval:\n   * - 'never': Never ask user, use automated decision (default)\n   * - 'uncertain': Ask user when score is between minCompletionScore and minCompletionScore + 15\n   * - 'always': Always ask user to confirm task completion\n   */\n  requireUserApproval?: 'never' | 'uncertain' | 'always';\n\n  /**\n   * Memory keys that must exist after task completion.\n   * If the task should store data in memory, list the required keys here.\n   * This is a hard requirement checked BEFORE LLM reflection.\n   */\n  requiredMemoryKeys?: string[];\n\n  /**\n   * Custom validation function name (registered via validateTask hook).\n   * The hook will be called with this identifier to dispatch to the right validator.\n   * Runs AFTER LLM reflection, can override the result.\n   */\n  customValidator?: string;\n\n  /**\n   * Validation mode:\n   * - 'strict': Validation failure marks task as failed (default)\n   * - 'warn': Validation failure logs warning but task still completes\n   */\n  mode?: 'strict' | 'warn';\n\n  /**\n   * Skip LLM self-reflection validation.\n   * Set to true if you only want programmatic validation (memory keys, hooks).\n   * Default: false (reflection is enabled when completionCriteria is set)\n   */\n  skipReflection?: boolean;\n}\n\n/**\n * Result of task validation (returned by LLM reflection)\n */\nexport interface TaskValidationResult {\n  /** Whether the task is considered complete */\n  isComplete: boolean;\n\n  /** Completeness score from 0-100 */\n  completionScore: number;\n\n  /** LLM's explanation of why the task is/isn't complete */\n  explanation: string;\n\n  /** Per-criterion evaluation results */\n  criteriaResults?: Array<{\n    criterion: string;\n    met: boolean;\n    evidence?: string;\n  }>;\n\n  /** Whether user approval is needed */\n  requiresUserApproval: boolean;\n\n  /** Reason for requiring user approval */\n  approvalReason?: string;\n}\n\n/**\n * A single unit of work\n */\nexport interface Task {\n  id: string;\n  name: string;\n  description: string;\n  status: TaskStatus;\n\n  /** Tasks that must complete before this one (task IDs) */\n  dependsOn: string[];\n\n  /** External dependency (if waiting on external event) */\n  externalDependency?: ExternalDependency;\n\n  /** Condition for execution */\n  condition?: TaskCondition;\n\n  /** Execution settings */\n  execution?: TaskExecution;\n\n  /** Completion validation settings */\n  validation?: TaskValidation;\n\n  /** Optional expected output description */\n  expectedOutput?: string;\n\n  /** Result after completion */\n  result?: {\n    success: boolean;\n    output?: unknown;\n    error?: string;\n    /** Validation score (0-100) if validation was performed */\n    validationScore?: number;\n    /** Explanation of validation result */\n    validationExplanation?: string;\n  };\n\n  /** Timestamps */\n  createdAt: number;\n  startedAt?: number;\n  completedAt?: number;\n  lastUpdatedAt: number;\n\n  /** Retry tracking */\n  attempts: number;\n  maxAttempts: number;\n\n  /** Metadata for extensions */\n  metadata?: Record<string, unknown>;\n}\n\n/**\n * Input for creating a task\n */\nexport interface TaskInput {\n  id?: string;\n  name: string;\n  description: string;\n  dependsOn?: string[];           // Task names or IDs\n  externalDependency?: ExternalDependency;\n  condition?: TaskCondition;\n  execution?: TaskExecution;\n  validation?: TaskValidation;\n  expectedOutput?: string;\n  maxAttempts?: number;\n  metadata?: Record<string, unknown>;\n}\n\n/**\n * Plan concurrency settings\n */\nexport interface PlanConcurrency {\n  maxParallelTasks: number;\n  strategy: 'fifo' | 'priority' | 'shortest-first';\n\n  /**\n   * How to handle failures when executing tasks in parallel\n   * - 'fail-fast': Stop on first failure (Promise.all behavior) - DEFAULT\n   * - 'continue': Continue other tasks on failure, mark failed ones\n   * - 'fail-all': Wait for all to complete, then report all failures together\n   */\n  failureMode?: 'fail-fast' | 'continue' | 'fail-all';\n}\n\n/**\n * Execution plan - a goal with steps to achieve it\n */\nexport interface Plan {\n  id: string;\n  goal: string;\n  context?: string;\n\n  tasks: Task[];\n\n  /** Concurrency settings */\n  concurrency?: PlanConcurrency;\n\n  /** Can agent modify the plan? */\n  allowDynamicTasks: boolean;\n\n  /** Plan status */\n  status: PlanStatus;\n\n  /** Why is the plan suspended? */\n  suspendedReason?: {\n    type: 'waiting_external' | 'manual_pause' | 'error';\n    taskId?: string;\n    message?: string;\n  };\n\n  /** Timestamps */\n  createdAt: number;\n  startedAt?: number;\n  completedAt?: number;\n  lastUpdatedAt: number;\n\n  /** For resume: which task to continue from */\n  currentTaskId?: string;\n\n  /** Metadata */\n  metadata?: Record<string, unknown>;\n}\n\n/**\n * Input for creating a plan\n */\nexport interface PlanInput {\n  goal: string;\n  context?: string;\n  tasks: TaskInput[];\n  concurrency?: PlanConcurrency;\n  allowDynamicTasks?: boolean;\n  metadata?: Record<string, unknown>;\n  /** Skip dependency cycle detection (default: false) */\n  skipCycleCheck?: boolean;\n}\n\n/**\n * Memory access interface for condition evaluation\n */\nexport interface ConditionMemoryAccess {\n  get(key: string): Promise<unknown>;\n}\n\n// ============ Factory Functions ============\n\n/**\n * Create a task with defaults\n */\nexport function createTask(input: TaskInput): Task {\n  const now = Date.now();\n  const id = input.id ?? `task-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n\n  return {\n    id,\n    name: input.name,\n    description: input.description,\n    status: 'pending',\n    dependsOn: input.dependsOn ?? [],\n    externalDependency: input.externalDependency,\n    condition: input.condition,\n    execution: input.execution,\n    validation: input.validation,\n    expectedOutput: input.expectedOutput,\n    attempts: 0,\n    maxAttempts: input.maxAttempts ?? 3,\n    createdAt: now,\n    lastUpdatedAt: now,\n    metadata: input.metadata,\n  };\n}\n\n/**\n * Create a plan with tasks\n * @throws {DependencyCycleError} If circular dependencies detected (unless skipCycleCheck is true)\n */\nexport function createPlan(input: PlanInput): Plan {\n  const now = Date.now();\n  const id = `plan-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n\n  // Create tasks first\n  const tasks = input.tasks.map((taskInput) => createTask(taskInput));\n\n  // Build name to ID map\n  const nameToId = new Map<string, string>();\n  for (const task of tasks) {\n    nameToId.set(task.name, task.id);\n  }\n\n  // Resolve dependencies from names to IDs\n  for (let i = 0; i < tasks.length; i++) {\n    const taskInput = input.tasks[i]!;\n    const task = tasks[i]!;\n\n    if (taskInput.dependsOn && taskInput.dependsOn.length > 0) {\n      task.dependsOn = taskInput.dependsOn.map((dep) => {\n        // Check if it's already an ID (starts with 'task-')\n        if (dep.startsWith('task-')) {\n          return dep;\n        }\n\n        // Otherwise, it's a name - resolve it\n        const resolvedId = nameToId.get(dep);\n        if (!resolvedId) {\n          throw new Error(`Task dependency \"${dep}\" not found in plan`);\n        }\n        return resolvedId;\n      });\n    }\n  }\n\n  // Check for dependency cycles (unless explicitly skipped)\n  if (!input.skipCycleCheck) {\n    const cycle = detectDependencyCycle(tasks);\n    if (cycle) {\n      // Convert task IDs to names for better error message\n      const cycleNames = cycle.map((taskId) => {\n        const task = tasks.find((t) => t.id === taskId);\n        return task ? task.name : taskId;\n      });\n      throw new DependencyCycleError(cycleNames, id);\n    }\n  }\n\n  return {\n    id,\n    goal: input.goal,\n    context: input.context,\n    tasks,\n    concurrency: input.concurrency,\n    allowDynamicTasks: input.allowDynamicTasks ?? true,\n    status: 'pending',\n    createdAt: now,\n    lastUpdatedAt: now,\n    metadata: input.metadata,\n  };\n}\n\n// ============ Task Utilities ============\n\n/**\n * Check if a task can be executed (dependencies met, status is pending)\n */\nexport function canTaskExecute(task: Task, allTasks: Task[]): boolean {\n  // Must be pending\n  if (task.status !== 'pending') {\n    return false;\n  }\n\n  // Check if all dependencies are completed\n  if (task.dependsOn.length > 0) {\n    for (const depId of task.dependsOn) {\n      const depTask = allTasks.find((t) => t.id === depId);\n      if (!depTask || depTask.status !== 'completed') {\n        return false;\n      }\n    }\n  }\n\n  return true;\n}\n\n/**\n * Get the next tasks that can be executed\n */\nexport function getNextExecutableTasks(plan: Plan): Task[] {\n  const executable = plan.tasks.filter((task) => canTaskExecute(task, plan.tasks));\n\n  if (executable.length === 0) {\n    return [];\n  }\n\n  // If no concurrency config, return sequential (first one only)\n  if (!plan.concurrency) {\n    return [executable[0]!];\n  }\n\n  // Count currently running tasks\n  const runningCount = plan.tasks.filter((t) => t.status === 'in_progress').length;\n  const availableSlots = plan.concurrency.maxParallelTasks - runningCount;\n\n  if (availableSlots <= 0) {\n    return [];\n  }\n\n  // Filter for parallel-capable tasks\n  const parallelTasks = executable.filter((task) => task.execution?.parallel === true);\n\n  if (parallelTasks.length === 0) {\n    // No parallel tasks available, return first sequential task\n    return [executable[0]!];\n  }\n\n  // Sort by strategy\n  let sortedTasks = [...parallelTasks];\n  if (plan.concurrency.strategy === 'priority') {\n    sortedTasks.sort((a, b) => (b.execution?.priority ?? 0) - (a.execution?.priority ?? 0));\n  }\n  // 'fifo' and 'shortest-first' use default order (creation order)\n\n  // Return up to availableSlots tasks\n  return sortedTasks.slice(0, availableSlots);\n}\n\n/**\n * Evaluate a task condition against memory\n */\nexport async function evaluateCondition(\n  condition: TaskCondition,\n  memory: ConditionMemoryAccess\n): Promise<boolean> {\n  const value = await memory.get(condition.memoryKey);\n\n  switch (condition.operator) {\n    case 'exists':\n      return value !== undefined;\n\n    case 'not_exists':\n      return value === undefined;\n\n    case 'equals':\n      return value === condition.value;\n\n    case 'contains':\n      if (Array.isArray(value)) {\n        return value.includes(condition.value);\n      }\n      if (typeof value === 'string' && typeof condition.value === 'string') {\n        return value.includes(condition.value);\n      }\n      return false;\n\n    case 'truthy':\n      return !!value;\n\n    case 'greater_than':\n      if (typeof value === 'number' && typeof condition.value === 'number') {\n        return value > condition.value;\n      }\n      return false;\n\n    case 'less_than':\n      if (typeof value === 'number' && typeof condition.value === 'number') {\n        return value < condition.value;\n      }\n      return false;\n\n    default:\n      return false;\n  }\n}\n\n/**\n * Update task status and timestamps\n */\nexport function updateTaskStatus(task: Task, status: TaskStatus): Task {\n  const now = Date.now();\n  const updated: Task = {\n    ...task,\n    status,\n    lastUpdatedAt: now,\n  };\n\n  // Set startedAt when moving to in_progress (first time only)\n  // But always increment attempts when moving to in_progress\n  if (status === 'in_progress') {\n    if (!updated.startedAt) {\n      updated.startedAt = now;\n    }\n    updated.attempts += 1;\n  }\n\n  // Set completedAt when moving to completed or failed\n  if ((status === 'completed' || status === 'failed') && !updated.completedAt) {\n    updated.completedAt = now;\n  }\n\n  return updated;\n}\n\n/**\n * Check if a task is blocked by dependencies\n */\nexport function isTaskBlocked(task: Task, allTasks: Task[]): boolean {\n  if (task.dependsOn.length === 0) {\n    return false;\n  }\n\n  for (const depId of task.dependsOn) {\n    const depTask = allTasks.find((t) => t.id === depId);\n    if (!depTask) {\n      return true; // Dependency not found\n    }\n    if (depTask.status !== 'completed') {\n      return true; // Dependency not completed\n    }\n  }\n\n  return false;\n}\n\n/**\n * Get the dependency tasks for a task\n */\nexport function getTaskDependencies(task: Task, allTasks: Task[]): Task[] {\n  if (task.dependsOn.length === 0) {\n    return [];\n  }\n\n  return task.dependsOn\n    .map((depId) => allTasks.find((t) => t.id === depId))\n    .filter((t): t is Task => t !== undefined);\n}\n\n/**\n * Resolve task name dependencies to task IDs\n * Modifies taskInputs in place\n */\nexport function resolveDependencies(taskInputs: TaskInput[], tasks: Task[]): void {\n  // Build name to ID map\n  const nameToId = new Map<string, string>();\n  for (const task of tasks) {\n    nameToId.set(task.name, task.id);\n  }\n\n  // Resolve dependencies\n  for (const input of taskInputs) {\n    if (input.dependsOn && input.dependsOn.length > 0) {\n      input.dependsOn = input.dependsOn.map((dep) => {\n        // If it's already an ID, keep it\n        if (dep.startsWith('task-')) {\n          return dep;\n        }\n\n        // Otherwise, resolve name to ID\n        const resolvedId = nameToId.get(dep);\n        if (!resolvedId) {\n          throw new Error(`Task dependency \"${dep}\" not found`);\n        }\n        return resolvedId;\n      });\n    }\n  }\n}\n\n/**\n * Detect dependency cycles in tasks using depth-first search\n * @param tasks Array of tasks with resolved dependencies (IDs, not names)\n * @returns Array of task IDs forming the cycle (e.g., ['A', 'B', 'C', 'A']), or null if no cycle\n */\nexport function detectDependencyCycle(tasks: Task[]): string[] | null {\n  const visited = new Set<string>();\n  const recStack = new Set<string>();\n  const taskMap = new Map(tasks.map((t) => [t.id, t]));\n\n  /**\n   * DFS to detect back edges (cycles)\n   * @param taskId Current task being visited\n   * @param path Path from root to current node\n   * @returns Cycle path if found, null otherwise\n   */\n  function dfs(taskId: string, path: string[]): string[] | null {\n    // If taskId is in recursion stack, we found a cycle\n    if (recStack.has(taskId)) {\n      const cycleStart = path.indexOf(taskId);\n      return [...path.slice(cycleStart), taskId];\n    }\n\n    // If already fully visited, no cycle through this node\n    if (visited.has(taskId)) {\n      return null;\n    }\n\n    // Mark as being visited (in current DFS path)\n    visited.add(taskId);\n    recStack.add(taskId);\n\n    // Visit all dependencies (edges go from task to its dependencies)\n    const task = taskMap.get(taskId);\n    if (task) {\n      for (const depId of task.dependsOn) {\n        const cycle = dfs(depId, [...path, taskId]);\n        if (cycle) {\n          return cycle;\n        }\n      }\n    }\n\n    // Done with this node, remove from recursion stack\n    recStack.delete(taskId);\n    return null;\n  }\n\n  // Start DFS from each unvisited node\n  for (const task of tasks) {\n    if (!visited.has(task.id)) {\n      const cycle = dfs(task.id, []);\n      if (cycle) {\n        return cycle;\n      }\n    }\n  }\n\n  return null;\n}\n","/**\n * Agent state entities for TaskAgent\n *\n * Defines the full agent state needed for persistence and resume.\n */\n\nimport { Plan } from './Task.js';\n\n/**\n * Agent execution status\n */\nexport type AgentStatus =\n  | 'idle'         // Created but not started\n  | 'running'      // Actively executing\n  | 'suspended'    // Paused, can be resumed\n  | 'completed'    // Plan finished successfully\n  | 'failed'       // Plan failed\n  | 'cancelled';   // Manually cancelled\n\n/**\n * Agent configuration (needed for resume)\n */\nexport interface AgentConfig {\n  connectorName: string;\n  model: string;\n  temperature?: number;\n  maxIterations?: number;\n  toolNames: string[];            // Tool registry keys\n}\n\n/**\n * Conversation message in history\n */\nexport interface ConversationMessage {\n  role: 'user' | 'assistant' | 'system';\n  content: string;\n  timestamp: number;\n}\n\n/**\n * Agent execution metrics\n */\nexport interface AgentMetrics {\n  totalLLMCalls: number;\n  totalToolCalls: number;\n  totalTokensUsed: number;\n  totalCost: number;\n}\n\n/**\n * Full agent state - everything needed to resume\n */\nexport interface AgentState {\n  id: string;                     // Unique agent instance ID\n  status: AgentStatus;\n\n  /** Configuration */\n  config: AgentConfig;\n\n  /** Current plan */\n  plan: Plan;\n\n  /** Working memory reference */\n  memoryId: string;\n\n  /** Conversation history (for context continuity) */\n  conversationHistory: ConversationMessage[];\n\n  /** Timestamps */\n  createdAt: number;\n  startedAt?: number;\n  suspendedAt?: number;\n  completedAt?: number;\n  lastActivityAt: number;\n\n  /** Metrics */\n  metrics: AgentMetrics;\n}\n\n/**\n * Create initial agent state\n */\nexport function createAgentState(id: string, config: AgentConfig, plan: Plan): AgentState {\n  const now = Date.now();\n\n  return {\n    id,\n    status: 'idle',\n    config,\n    plan,\n    memoryId: `memory-${id}`,\n    conversationHistory: [],\n    createdAt: now,\n    lastActivityAt: now,\n    metrics: {\n      totalLLMCalls: 0,\n      totalToolCalls: 0,\n      totalTokensUsed: 0,\n      totalCost: 0,\n    },\n  };\n}\n\n/**\n * Update agent state status\n */\nexport function updateAgentStatus(state: AgentState, status: AgentStatus): AgentState {\n  const now = Date.now();\n\n  const updated: AgentState = {\n    ...state,\n    status,\n    lastActivityAt: now,\n  };\n\n  // Set timestamps based on status\n  if (status === 'running' && !updated.startedAt) {\n    updated.startedAt = now;\n  }\n\n  if (status === 'suspended' && !updated.suspendedAt) {\n    updated.suspendedAt = now;\n  }\n\n  if ((status === 'completed' || status === 'failed' || status === 'cancelled') && !updated.completedAt) {\n    updated.completedAt = now;\n  }\n\n  return updated;\n}\n","/**\n * PlanPlugin - Provides plan context for TaskAgent and UniversalAgent\n *\n * The plan is a critical component that should never be compacted.\n * It contains the goal and task list that guides agent execution.\n */\n\nimport { BaseContextPlugin } from './IContextPlugin.js';\nimport type { IContextComponent } from '../types.js';\nimport type { Plan, Task, TaskStatus } from '../../../domain/entities/Task.js';\n\n/**\n * Serialized plan state for session persistence\n */\nexport interface SerializedPlanPluginState {\n  plan: Plan | null;\n}\n\n/**\n * Plan plugin for context management\n *\n * Provides the execution plan as a context component.\n * Priority 1 (critical, never compacted).\n */\nexport class PlanPlugin extends BaseContextPlugin {\n  readonly name = 'plan';\n  readonly priority = 1; // Very low = keep (critical)\n  readonly compactable = false; // Never compact the plan\n\n  private plan: Plan | null = null;\n\n  /**\n   * Set the current plan\n   */\n  setPlan(plan: Plan): void {\n    this.plan = plan;\n  }\n\n  /**\n   * Get the current plan\n   */\n  getPlan(): Plan | null {\n    return this.plan;\n  }\n\n  /**\n   * Clear the plan\n   */\n  clearPlan(): void {\n    this.plan = null;\n  }\n\n  /**\n   * Update a task's status within the plan\n   */\n  updateTaskStatus(taskId: string, status: TaskStatus): void {\n    if (!this.plan) return;\n\n    const task = this.plan.tasks.find(t => t.id === taskId || t.name === taskId);\n    if (task) {\n      task.status = status;\n    }\n  }\n\n  /**\n   * Get a task by ID or name\n   */\n  getTask(taskId: string): Task | undefined {\n    if (!this.plan) return undefined;\n    return this.plan.tasks.find(t => t.id === taskId || t.name === taskId);\n  }\n\n  /**\n   * Check if all tasks are completed\n   */\n  isComplete(): boolean {\n    if (!this.plan) return true;\n    return this.plan.tasks.every(t => t.status === 'completed' || t.status === 'skipped');\n  }\n\n  /**\n   * Get component for context\n   */\n  async getComponent(): Promise<IContextComponent | null> {\n    if (!this.plan) return null;\n\n    return {\n      name: this.name,\n      content: this.formatPlan(this.plan),\n      priority: this.priority,\n      compactable: this.compactable,\n      metadata: {\n        taskCount: this.plan.tasks.length,\n        completedCount: this.plan.tasks.filter(t => t.status === 'completed').length,\n        goal: this.plan.goal,\n      },\n    };\n  }\n\n  /**\n   * Format plan for LLM context\n   */\n  private formatPlan(plan: Plan): string {\n    const lines: string[] = [\n      '## Current Plan',\n      '',\n      `**Goal**: ${plan.goal}`,\n      '',\n      '**Tasks**:',\n    ];\n\n    for (let i = 0; i < plan.tasks.length; i++) {\n      const task = plan.tasks[i];\n      if (!task) continue;\n\n      const status = task.status || 'pending';\n      const statusEmoji = this.getStatusEmoji(status);\n      const deps = task.dependsOn && task.dependsOn.length > 0\n        ? ` (depends on: ${task.dependsOn.join(', ')})`\n        : '';\n\n      lines.push(`${i + 1}. ${statusEmoji} [${status}] **${task.name}**: ${task.description}${deps}`);\n\n      // Include completion criteria if present\n      if (task.validation?.completionCriteria) {\n        lines.push(`   - Completion: ${task.validation.completionCriteria}`);\n      }\n    }\n\n    return lines.join('\\n');\n  }\n\n  /**\n   * Get emoji for task status\n   */\n  private getStatusEmoji(status: TaskStatus): string {\n    switch (status) {\n      case 'completed': return '[x]';\n      case 'in_progress': return '[~]';\n      case 'failed': return '[!]';\n      case 'skipped': return '[-]';\n      case 'blocked': return '[#]';\n      case 'pending':\n      default: return '[ ]';\n    }\n  }\n\n  // Session persistence\n  override getState(): SerializedPlanPluginState {\n    return { plan: this.plan };\n  }\n\n  override restoreState(state: unknown): void {\n    const s = state as SerializedPlanPluginState;\n    if (s?.plan) {\n      this.plan = s.plan;\n    }\n  }\n}\n","/**\n * MemoryPlugin - Provides working memory index for TaskAgent and UniversalAgent\n *\n * The memory index shows the LLM what data is stored in working memory.\n * This is compactable - when space is needed, entries can be evicted.\n */\n\nimport { BaseContextPlugin } from './IContextPlugin.js';\nimport type { IContextComponent, ITokenEstimator } from '../types.js';\nimport type { WorkingMemory } from '../../../capabilities/taskAgent/WorkingMemory.js';\n\n/**\n * Serialized memory plugin state\n * Note: The actual memory content is stored by WorkingMemory itself,\n * this plugin just holds a reference.\n */\nexport interface SerializedMemoryPluginState {\n  // Memory plugin doesn't have its own state - WorkingMemory handles persistence\n}\n\n/**\n * Memory plugin for context management\n *\n * Provides the working memory index as a context component.\n * When compaction is needed, it evicts least-important entries.\n */\nexport class MemoryPlugin extends BaseContextPlugin {\n  readonly name = 'memory_index';\n  readonly priority = 8; // Higher = more likely to compact\n  readonly compactable = true;\n\n  private memory: WorkingMemory;\n  private evictBatchSize: number;\n\n  /**\n   * Create a memory plugin\n   *\n   * @param memory - The WorkingMemory instance to wrap\n   * @param evictBatchSize - How many entries to evict per compaction round (default: 3)\n   */\n  constructor(memory: WorkingMemory, evictBatchSize: number = 3) {\n    super();\n    this.memory = memory;\n    this.evictBatchSize = evictBatchSize;\n  }\n\n  /**\n   * Get the underlying WorkingMemory\n   */\n  getMemory(): WorkingMemory {\n    return this.memory;\n  }\n\n  /**\n   * Get component for context\n   */\n  async getComponent(): Promise<IContextComponent | null> {\n    const index = await this.memory.formatIndex();\n\n    // Return null if memory is empty (formatMemoryIndex returns \"Memory is empty.\" when no entries)\n    if (!index || index.trim().length === 0 || index.includes('Memory is empty.')) {\n      return null;\n    }\n\n    const stats = await this.memory.getStats();\n\n    return {\n      name: this.name,\n      content: index,\n      priority: this.priority,\n      compactable: this.compactable,\n      metadata: {\n        entryCount: stats.totalEntries,\n        totalSizeBytes: stats.totalSizeBytes,\n        utilizationPercent: stats.utilizationPercent,\n      },\n    };\n  }\n\n  /**\n   * Compact by evicting least-important entries\n   */\n  override async compact(_targetTokens: number, estimator: ITokenEstimator): Promise<number> {\n    // Get current token count\n    const beforeIndex = await this.memory.formatIndex();\n    const beforeTokens = estimator.estimateTokens(beforeIndex);\n\n    // Evict entries using LRU strategy\n    const evictedKeys = await this.memory.evict(this.evictBatchSize, 'lru');\n\n    if (evictedKeys.length === 0) {\n      return 0; // Nothing to evict\n    }\n\n    // Calculate tokens freed\n    const afterIndex = await this.memory.formatIndex();\n    const afterTokens = estimator.estimateTokens(afterIndex);\n\n    return Math.max(0, beforeTokens - afterTokens);\n  }\n\n  /**\n   * Clean up\n   */\n  override destroy(): void {\n    // Memory cleanup is handled by WorkingMemory itself\n  }\n\n  // Memory state is managed by WorkingMemory, not this plugin\n  override getState(): SerializedMemoryPluginState {\n    return {};\n  }\n\n  override restoreState(_state: unknown): void {\n    // No-op - memory state is managed by WorkingMemory\n  }\n}\n","/**\n * ExternalDependencyHandler - handles external dependencies\n */\n\nimport { EventEmitter } from 'eventemitter3';\nimport { Task } from '../../domain/entities/Task.js';\nimport { ToolFunction } from '../../domain/entities/Tool.js';\nimport { calculateBackoff, BackoffConfig } from '../../infrastructure/resilience/BackoffStrategy.js';\n\nexport interface ExternalDependencyEvents {\n  'webhook:received': { webhookId: string; data: unknown };\n  'poll:success': { taskId: string; data: unknown };\n  'poll:timeout': { taskId: string };\n  'scheduled:triggered': { taskId: string };\n  'manual:completed': { taskId: string; data: unknown };\n}\n\n/**\n * Handles external task dependencies\n */\nexport class ExternalDependencyHandler extends EventEmitter<ExternalDependencyEvents> {\n  private activePolls = new Map<string, NodeJS.Timeout>();\n  private activeScheduled = new Map<string, NodeJS.Timeout>();\n  private cancelledPolls = new Set<string>(); // Track cancelled polls\n  private tools: Map<string, ToolFunction>;\n\n  constructor(tools: ToolFunction[] = []) {\n    super();\n    this.tools = new Map(tools.map((t) => [t.definition.function.name, t]));\n  }\n\n  /**\n   * Start handling a task's external dependency\n   */\n  async startWaiting(task: Task): Promise<void> {\n    if (!task.externalDependency) {\n      return;\n    }\n\n    const dep = task.externalDependency;\n\n    switch (dep.type) {\n      case 'webhook':\n        // Webhooks are passive - just wait for triggerWebhook() to be called\n        break;\n\n      case 'poll':\n        this.startPolling(task);\n        break;\n\n      case 'scheduled':\n        this.scheduleTask(task);\n        break;\n\n      case 'manual':\n        // Manual tasks wait for completeManually() to be called\n        break;\n    }\n  }\n\n  /**\n   * Stop waiting on a task's external dependency\n   */\n  stopWaiting(task: Task): void {\n    if (!task.externalDependency) {\n      return;\n    }\n\n    // Mark poll as cancelled (for async loop to check)\n    this.cancelledPolls.add(task.id);\n\n    // Clear any active polling timer (now using setTimeout with backoff)\n    const pollTimer = this.activePolls.get(task.id);\n    if (pollTimer) {\n      clearTimeout(pollTimer);\n      this.activePolls.delete(task.id);\n    }\n\n    const scheduleTimer = this.activeScheduled.get(task.id);\n    if (scheduleTimer) {\n      clearTimeout(scheduleTimer);\n      this.activeScheduled.delete(task.id);\n    }\n  }\n\n  /**\n   * Trigger a webhook\n   */\n  async triggerWebhook(webhookId: string, data: unknown): Promise<void> {\n    this.emit('webhook:received', { webhookId, data });\n  }\n\n  /**\n   * Complete a manual task\n   */\n  async completeManual(taskId: string, data: unknown): Promise<void> {\n    this.emit('manual:completed', { taskId, data });\n  }\n\n  /**\n   * Start polling for a task with exponential backoff\n   */\n  private startPolling(task: Task): void {\n    const dep = task.externalDependency!;\n    const pollConfig = dep.pollConfig!;\n\n    // Configure backoff: start at configured interval, cap at 4x initial\n    const backoffConfig: BackoffConfig = {\n      strategy: 'exponential',\n      initialDelayMs: pollConfig.intervalMs,\n      maxDelayMs: pollConfig.intervalMs * 4, // Cap at 4x initial interval\n      jitter: true,\n      jitterFactor: 0.1, // 10% jitter to prevent thundering herd\n    };\n\n    // Clear any previous cancellation flag\n    this.cancelledPolls.delete(task.id);\n\n    // Use async IIFE for the polling loop with backoff\n    (async () => {\n      let attempts = 0;\n\n      while (attempts < pollConfig.maxAttempts) {\n        // Check if cancelled before each attempt\n        if (this.cancelledPolls.has(task.id)) {\n          this.cancelledPolls.delete(task.id);\n          return;\n        }\n\n        attempts++;\n\n        try {\n          // Get the tool\n          const tool = this.tools.get(pollConfig.toolName);\n          if (!tool) {\n            console.error(`Poll tool ${pollConfig.toolName} not found`);\n            return;\n          }\n\n          // Execute the tool\n          const result = await tool.execute(pollConfig.toolArgs);\n\n          // Check if result indicates completion\n          // For simplicity, any truthy result means complete\n          if (result) {\n            this.emit('poll:success', { taskId: task.id, data: result });\n            return; // Success - exit loop\n          }\n        } catch (error) {\n          console.error(`Poll error for task ${task.id}:`, error);\n        }\n\n        // Check if more attempts remain\n        if (attempts >= pollConfig.maxAttempts) {\n          this.emit('poll:timeout', { taskId: task.id });\n          return;\n        }\n\n        // Wait with backoff before next attempt\n        const delay = calculateBackoff(attempts, backoffConfig);\n        await new Promise<void>((resolve) => {\n          const timer = setTimeout(resolve, delay);\n          // Store timer for cancellation\n          this.activePolls.set(task.id, timer);\n        });\n\n        // Check if cancelled after wait\n        if (this.cancelledPolls.has(task.id)) {\n          this.cancelledPolls.delete(task.id);\n          return;\n        }\n      }\n    })();\n  }\n\n  /**\n   * Schedule a task to trigger at a specific time\n   */\n  private scheduleTask(task: Task): void {\n    const dep = task.externalDependency!;\n    const scheduledAt = dep.scheduledAt!;\n\n    const delay = scheduledAt - Date.now();\n\n    if (delay <= 0) {\n      // Already past scheduled time, trigger immediately\n      this.emit('scheduled:triggered', { taskId: task.id });\n      return;\n    }\n\n    const timer = setTimeout(() => {\n      this.emit('scheduled:triggered', { taskId: task.id });\n      this.activeScheduled.delete(task.id);\n    }, delay);\n\n    this.activeScheduled.set(task.id, timer);\n  }\n\n  /**\n   * Cleanup all active dependencies\n   */\n  cleanup(): void {\n    // Mark all active polls as cancelled\n    for (const taskId of this.activePolls.keys()) {\n      this.cancelledPolls.add(taskId);\n    }\n\n    // Clear all polling timers (now using setTimeout with backoff)\n    for (const timer of this.activePolls.values()) {\n      clearTimeout(timer);\n    }\n    this.activePolls.clear();\n\n    // Clear scheduled timers\n    for (const timer of this.activeScheduled.values()) {\n      clearTimeout(timer);\n    }\n    this.activeScheduled.clear();\n  }\n\n  /**\n   * Update available tools\n   */\n  updateTools(tools: ToolFunction[]): void {\n    this.tools = new Map(tools.map((t) => [t.definition.function.name, t]));\n  }\n}\n","/**\n * Resilience infrastructure exports\n */\n\nexport { CircuitBreaker, CircuitOpenError } from './CircuitBreaker.js';\nexport type {\n  CircuitState,\n  CircuitBreakerConfig,\n  CircuitBreakerMetrics,\n  CircuitBreakerEvents,\n} from './CircuitBreaker.js';\nexport { DEFAULT_CIRCUIT_BREAKER_CONFIG } from './CircuitBreaker.js';\n\nexport {\n  calculateBackoff,\n  addJitter,\n  backoffWait,\n  backoffSequence,\n  retryWithBackoff,\n} from './BackoffStrategy.js';\nexport type { BackoffConfig, BackoffStrategyType } from './BackoffStrategy.js';\nexport { DEFAULT_BACKOFF_CONFIG } from './BackoffStrategy.js';\n\nexport { TokenBucketRateLimiter, RateLimitError } from './RateLimiter.js';\nexport type { RateLimiterConfig, RateLimiterMetrics } from './RateLimiter.js';\nexport { DEFAULT_RATE_LIMITER_CONFIG } from './RateLimiter.js';\n","/**\n * Token bucket rate limiter for LLM calls\n *\n * Implements a sliding window rate limiter to prevent hitting provider rate limits\n * during intensive plan execution.\n */\n\nimport { AIError } from '../../domain/errors/AIErrors.js';\n\n/**\n * Error thrown when rate limit is exceeded and onLimit is 'throw'\n */\nexport class RateLimitError extends AIError {\n  constructor(\n    public readonly retryAfterMs: number,\n    message?: string\n  ) {\n    super(message ?? `Rate limited. Retry after ${retryAfterMs}ms`, 'RATE_LIMIT_ERROR', 429);\n    this.name = 'RateLimitError';\n    Object.setPrototypeOf(this, RateLimitError.prototype);\n  }\n}\n\n/**\n * Configuration for the rate limiter\n */\nexport interface RateLimiterConfig {\n  /** Max requests allowed in window */\n  maxRequests: number;\n\n  /** Time window in ms (default: 60000 = 1 minute) */\n  windowMs?: number;\n\n  /** What to do when rate limited */\n  onLimit: 'wait' | 'throw';\n\n  /** Max wait time in ms (for 'wait' mode, default: 60000) */\n  maxWaitMs?: number;\n}\n\n/**\n * Default rate limiter configuration\n */\nexport const DEFAULT_RATE_LIMITER_CONFIG: Required<RateLimiterConfig> = {\n  maxRequests: 60,\n  windowMs: 60000,\n  onLimit: 'wait',\n  maxWaitMs: 60000,\n};\n\n/**\n * Rate limiter metrics\n */\nexport interface RateLimiterMetrics {\n  /** Total requests made */\n  totalRequests: number;\n  /** Total requests throttled */\n  throttledRequests: number;\n  /** Total wait time in ms */\n  totalWaitMs: number;\n  /** Average wait time in ms */\n  avgWaitMs: number;\n}\n\n/**\n * Token bucket rate limiter implementation\n *\n * Uses a sliding window approach where tokens are refilled completely\n * when the time window expires.\n */\nexport class TokenBucketRateLimiter {\n  private tokens: number;\n  private lastRefill: number;\n  private readonly config: Required<RateLimiterConfig>;\n  private waitQueue: Array<{\n    resolve: () => void;\n    reject: (e: Error) => void;\n    timeout?: ReturnType<typeof setTimeout>;\n  }> = [];\n\n  // Metrics\n  private totalRequests = 0;\n  private throttledRequests = 0;\n  private totalWaitMs = 0;\n\n  constructor(config: Partial<RateLimiterConfig> = {}) {\n    this.config = {\n      maxRequests: config.maxRequests ?? DEFAULT_RATE_LIMITER_CONFIG.maxRequests,\n      windowMs: config.windowMs ?? DEFAULT_RATE_LIMITER_CONFIG.windowMs,\n      onLimit: config.onLimit ?? DEFAULT_RATE_LIMITER_CONFIG.onLimit,\n      maxWaitMs: config.maxWaitMs ?? DEFAULT_RATE_LIMITER_CONFIG.maxWaitMs,\n    };\n    this.tokens = this.config.maxRequests;\n    this.lastRefill = Date.now();\n  }\n\n  /**\n   * Acquire a token (request permission to make an LLM call)\n   * @returns Promise that resolves when token is acquired\n   * @throws RateLimitError if onLimit='throw' and no tokens available\n   */\n  async acquire(): Promise<void> {\n    this.totalRequests++;\n    this.refill();\n\n    if (this.tokens > 0) {\n      this.tokens--;\n      return;\n    }\n\n    // No tokens available\n    this.throttledRequests++;\n    const waitTime = this.getWaitTime();\n\n    if (this.config.onLimit === 'throw') {\n      throw new RateLimitError(waitTime);\n    }\n\n    // Wait mode\n    if (waitTime > this.config.maxWaitMs) {\n      throw new RateLimitError(\n        waitTime,\n        `Wait time ${waitTime}ms exceeds max ${this.config.maxWaitMs}ms`\n      );\n    }\n\n    const startWait = Date.now();\n    await this.waitForToken(waitTime);\n    this.totalWaitMs += Date.now() - startWait;\n  }\n\n  /**\n   * Try to acquire without waiting\n   * @returns true if acquired, false if rate limited\n   */\n  tryAcquire(): boolean {\n    this.totalRequests++;\n    this.refill();\n    if (this.tokens > 0) {\n      this.tokens--;\n      return true;\n    }\n    this.throttledRequests++;\n    return false;\n  }\n\n  /**\n   * Get current available tokens\n   */\n  getAvailableTokens(): number {\n    this.refill();\n    return this.tokens;\n  }\n\n  /**\n   * Get time until next token is available\n   */\n  getWaitTime(): number {\n    this.refill();\n    if (this.tokens > 0) return 0;\n\n    const elapsed = Date.now() - this.lastRefill;\n    return Math.max(0, this.config.windowMs - elapsed);\n  }\n\n  /**\n   * Get rate limiter metrics\n   */\n  getMetrics(): RateLimiterMetrics {\n    return {\n      totalRequests: this.totalRequests,\n      throttledRequests: this.throttledRequests,\n      totalWaitMs: this.totalWaitMs,\n      avgWaitMs: this.throttledRequests > 0 ? this.totalWaitMs / this.throttledRequests : 0,\n    };\n  }\n\n  /**\n   * Reset the rate limiter state\n   */\n  reset(): void {\n    this.tokens = this.config.maxRequests;\n    this.lastRefill = Date.now();\n\n    // Clear all waiting requests\n    for (const waiter of this.waitQueue) {\n      if (waiter.timeout) {\n        clearTimeout(waiter.timeout);\n      }\n    }\n    this.waitQueue = [];\n  }\n\n  /**\n   * Reset metrics\n   */\n  resetMetrics(): void {\n    this.totalRequests = 0;\n    this.throttledRequests = 0;\n    this.totalWaitMs = 0;\n  }\n\n  /**\n   * Get the current configuration\n   */\n  getConfig(): Required<RateLimiterConfig> {\n    return { ...this.config };\n  }\n\n  /**\n   * Refill tokens if window has expired\n   */\n  private refill(): void {\n    const now = Date.now();\n    const elapsed = now - this.lastRefill;\n\n    if (elapsed >= this.config.windowMs) {\n      // Full refill\n      this.tokens = this.config.maxRequests;\n      this.lastRefill = now;\n\n      // Process waiting requests\n      this.processWaitQueue();\n    }\n  }\n\n  /**\n   * Wait for a token to become available\n   */\n  private async waitForToken(waitTime: number): Promise<void> {\n    return new Promise((resolve, reject) => {\n      const timeout = setTimeout(() => {\n        // Remove from queue\n        const index = this.waitQueue.findIndex((w) => w.timeout === timeout);\n        if (index !== -1) {\n          this.waitQueue.splice(index, 1);\n        }\n\n        // Try to acquire after wait\n        this.refill();\n        if (this.tokens > 0) {\n          this.tokens--;\n          resolve();\n        } else {\n          // Still no tokens, this shouldn't happen but handle gracefully\n          reject(new RateLimitError(this.getWaitTime(), 'Token still unavailable after wait'));\n        }\n      }, waitTime);\n\n      this.waitQueue.push({ resolve, reject, timeout });\n    });\n  }\n\n  /**\n   * Process waiting requests when tokens become available\n   */\n  private processWaitQueue(): void {\n    while (this.waitQueue.length > 0 && this.tokens > 0) {\n      const waiter = this.waitQueue.shift();\n      if (waiter) {\n        if (waiter.timeout) {\n          clearTimeout(waiter.timeout);\n        }\n        this.tokens--;\n        waiter.resolve();\n      }\n    }\n  }\n}\n","/**\n * JSON Extractor Utilities\n *\n * Extracts JSON from LLM responses that may contain markdown formatting,\n * code blocks, or other text mixed with JSON data.\n */\n\n/**\n * Result of JSON extraction attempt\n */\nexport interface JSONExtractionResult<T = unknown> {\n  /** Whether extraction was successful */\n  success: boolean;\n  /** Extracted and parsed data (if successful) */\n  data?: T;\n  /** Raw JSON string that was parsed (if found) */\n  rawJson?: string;\n  /** Error message (if failed) */\n  error?: string;\n  /** How the JSON was found */\n  method?: 'code_block' | 'inline' | 'raw';\n}\n\n/**\n * Extract JSON from a string that may contain markdown code blocks or other formatting.\n *\n * Tries multiple extraction strategies in order:\n * 1. JSON inside markdown code blocks (```json ... ``` or ``` ... ```)\n * 2. First complete JSON object/array found in text\n * 3. Raw string as JSON\n *\n * @param text - Text that may contain JSON\n * @returns Extraction result with parsed data or error\n *\n * @example\n * ```typescript\n * const response = `Here's the result:\n * \\`\\`\\`json\n * {\"score\": 85, \"valid\": true}\n * \\`\\`\\`\n * That's the answer.`;\n *\n * const result = extractJSON<{score: number, valid: boolean}>(response);\n * if (result.success) {\n *   console.log(result.data.score); // 85\n * }\n * ```\n */\nexport function extractJSON<T = unknown>(text: string): JSONExtractionResult<T> {\n  if (!text || typeof text !== 'string') {\n    return {\n      success: false,\n      error: 'Input is empty or not a string',\n    };\n  }\n\n  const trimmedText = text.trim();\n\n  // Strategy 1: Try to find JSON in markdown code blocks\n  const codeBlockResult = extractFromCodeBlock<T>(trimmedText);\n  if (codeBlockResult.success) {\n    return codeBlockResult;\n  }\n\n  // Strategy 2: Try to find inline JSON object or array\n  const inlineResult = extractInlineJSON<T>(trimmedText);\n  if (inlineResult.success) {\n    return inlineResult;\n  }\n\n  // Strategy 3: Try parsing the raw text as JSON\n  try {\n    const data = JSON.parse(trimmedText) as T;\n    return {\n      success: true,\n      data,\n      rawJson: trimmedText,\n      method: 'raw',\n    };\n  } catch (e) {\n    return {\n      success: false,\n      error: `Could not extract JSON from text: ${e instanceof Error ? e.message : String(e)}`,\n    };\n  }\n}\n\n/**\n * Extract JSON from markdown code blocks\n */\nfunction extractFromCodeBlock<T>(text: string): JSONExtractionResult<T> {\n  // Match ```json ... ``` or ``` ... ``` code blocks\n  const codeBlockRegex = /```(?:json)?\\s*([\\s\\S]*?)```/g;\n  let match: RegExpExecArray | null;\n\n  while ((match = codeBlockRegex.exec(text)) !== null) {\n    const content = match[1];\n    if (content) {\n      const trimmed = content.trim();\n      try {\n        const data = JSON.parse(trimmed) as T;\n        return {\n          success: true,\n          data,\n          rawJson: trimmed,\n          method: 'code_block',\n        };\n      } catch {\n        // This code block doesn't contain valid JSON, try next\n        continue;\n      }\n    }\n  }\n\n  return { success: false };\n}\n\n/**\n * Extract inline JSON object or array from text\n */\nfunction extractInlineJSON<T>(text: string): JSONExtractionResult<T> {\n  // Try to find a JSON object\n  const objectMatch = findJSONObject(text);\n  if (objectMatch) {\n    try {\n      const data = JSON.parse(objectMatch) as T;\n      return {\n        success: true,\n        data,\n        rawJson: objectMatch,\n        method: 'inline',\n      };\n    } catch {\n      // Not valid JSON despite matching braces\n    }\n  }\n\n  // Try to find a JSON array\n  const arrayMatch = findJSONArray(text);\n  if (arrayMatch) {\n    try {\n      const data = JSON.parse(arrayMatch) as T;\n      return {\n        success: true,\n        data,\n        rawJson: arrayMatch,\n        method: 'inline',\n      };\n    } catch {\n      // Not valid JSON despite matching brackets\n    }\n  }\n\n  return { success: false };\n}\n\n/**\n * Find the first complete JSON object in text by matching braces\n */\nfunction findJSONObject(text: string): string | null {\n  const startIndex = text.indexOf('{');\n  if (startIndex === -1) return null;\n\n  let depth = 0;\n  let inString = false;\n  let escaped = false;\n\n  for (let i = startIndex; i < text.length; i++) {\n    const char = text[i];\n\n    if (escaped) {\n      escaped = false;\n      continue;\n    }\n\n    if (char === '\\\\' && inString) {\n      escaped = true;\n      continue;\n    }\n\n    if (char === '\"') {\n      inString = !inString;\n      continue;\n    }\n\n    if (inString) continue;\n\n    if (char === '{') {\n      depth++;\n    } else if (char === '}') {\n      depth--;\n      if (depth === 0) {\n        return text.slice(startIndex, i + 1);\n      }\n    }\n  }\n\n  return null;\n}\n\n/**\n * Find the first complete JSON array in text by matching brackets\n */\nfunction findJSONArray(text: string): string | null {\n  const startIndex = text.indexOf('[');\n  if (startIndex === -1) return null;\n\n  let depth = 0;\n  let inString = false;\n  let escaped = false;\n\n  for (let i = startIndex; i < text.length; i++) {\n    const char = text[i];\n\n    if (escaped) {\n      escaped = false;\n      continue;\n    }\n\n    if (char === '\\\\' && inString) {\n      escaped = true;\n      continue;\n    }\n\n    if (char === '\"') {\n      inString = !inString;\n      continue;\n    }\n\n    if (inString) continue;\n\n    if (char === '[') {\n      depth++;\n    } else if (char === ']') {\n      depth--;\n      if (depth === 0) {\n        return text.slice(startIndex, i + 1);\n      }\n    }\n  }\n\n  return null;\n}\n\n/**\n * Safely extract a specific field from JSON embedded in text\n *\n * @param text - Text that may contain JSON\n * @param field - Field name to extract\n * @param defaultValue - Default value if extraction fails\n * @returns Extracted value or default\n *\n * @example\n * ```typescript\n * const score = extractJSONField<number>(llmResponse, 'completionScore', 50);\n * ```\n */\nexport function extractJSONField<T>(\n  text: string,\n  field: string,\n  defaultValue: T\n): T {\n  const result = extractJSON<Record<string, unknown>>(text);\n  if (result.success && result.data && field in result.data) {\n    return result.data[field] as T;\n  }\n  return defaultValue;\n}\n\n/**\n * Extract a number from text, trying JSON first, then regex patterns\n *\n * @param text - Text that may contain a number\n * @param patterns - Optional regex patterns to try (default: common score patterns)\n * @param defaultValue - Default value if extraction fails\n * @returns Extracted number or default\n *\n * @example\n * ```typescript\n * const score = extractNumber(llmResponse, [/(\\d{1,3})%?\\s*complete/i], 50);\n * ```\n */\nexport function extractNumber(\n  text: string,\n  patterns: RegExp[] = [\n    /(\\d{1,3})%?\\s*(?:complete|score|percent)/i,\n    /(?:score|completion|rating)[:\\s]+(\\d{1,3})/i,\n    /(\\d{1,3})\\s*(?:out of|\\/)\\s*100/i,\n  ],\n  defaultValue: number = 0\n): number {\n  // Try JSON extraction first\n  const jsonResult = extractJSON<Record<string, unknown>>(text);\n  if (jsonResult.success && jsonResult.data) {\n    // Look for common score field names\n    const scoreFields = ['score', 'completionScore', 'completion_score', 'rating', 'percent', 'value'];\n    for (const field of scoreFields) {\n      if (field in jsonResult.data && typeof jsonResult.data[field] === 'number') {\n        return jsonResult.data[field] as number;\n      }\n    }\n  }\n\n  // Try regex patterns\n  for (const pattern of patterns) {\n    const match = text.match(pattern);\n    if (match && match[1]) {\n      const num = parseInt(match[1], 10);\n      if (!isNaN(num)) {\n        return num;\n      }\n    }\n  }\n\n  return defaultValue;\n}\n","/**\n * PlanExecutor - executes plans with LLM integration\n *\n * Uses unified AgentContext for context management.\n */\n\nimport { EventEmitter } from 'eventemitter3';\nimport { Agent } from '../../core/Agent.js';\nimport { Plan, Task, TaskValidationResult, updateTaskStatus, evaluateCondition, getNextExecutableTasks } from '../../domain/entities/Task.js';\nimport type { StaleEntryInfo, TaskStatusForMemory } from '../../domain/entities/Memory.js';\nimport { AgentState } from '../../domain/entities/AgentState.js';\nimport { calculateCost } from '../../domain/entities/Model.js';\nimport { TaskTimeoutError, TaskValidationError, ParallelTasksError, TaskFailure } from '../../domain/errors/AIErrors.js';\nimport { TokenBucketRateLimiter } from '../../infrastructure/resilience/index.js';\nimport { WorkingMemory } from './WorkingMemory.js';\nimport { AgentContext } from '../../core/AgentContext.js';\nimport { PlanPlugin } from '../../core/context/plugins/PlanPlugin.js';\nimport { IdempotencyCache } from '../../core/IdempotencyCache.js';\nimport { ExternalDependencyHandler } from './ExternalDependencyHandler.js';\nimport { CheckpointManager } from './CheckpointManager.js';\nimport type { TaskAgentHooks, TaskContext, ErrorContext } from './TaskAgent.js';\nimport { extractJSON, extractNumber } from '../../utils/jsonExtractor.js';\nimport { TASK_DEFAULTS } from '../../core/constants.js';\nimport { IDisposable } from '../../domain/interfaces/IDisposable.js';\n\n/** Default task timeout (from centralized constants) */\nconst DEFAULT_TASK_TIMEOUT_MS = TASK_DEFAULTS.TIMEOUT_MS;\n\nexport interface PlanExecutorConfig {\n  maxIterations: number;\n  taskTimeout?: number;\n\n  /** Rate limiting configuration for LLM calls */\n  rateLimiter?: {\n    /** Max requests per minute (default: 60) */\n    maxRequestsPerMinute?: number;\n    /** What to do when rate limited: 'wait' or 'throw' (default: 'wait') */\n    onLimit?: 'wait' | 'throw';\n    /** Max wait time in ms (for 'wait' mode, default: 60000) */\n    maxWaitMs?: number;\n  };\n}\n\nexport interface PlanExecutorEvents {\n  'task:start': { task: Task };\n  'task:complete': { task: Task; result: any };\n  'task:failed': { task: Task; error: Error };\n  'task:skipped': { task: Task; reason: string };\n  'task:timeout': { task: Task; timeoutMs: number };\n  'task:validation_failed': { task: Task; validation: TaskValidationResult };\n  'task:validation_uncertain': { task: Task; validation: TaskValidationResult };\n  'task:waiting_external': { task: Task };\n  'memory:stale_entries': { entries: StaleEntryInfo[]; taskId: string };\n  'llm:call': { iteration: number };\n  'tool:call': { toolName: string; args: any };\n  'tool:result': { toolName: string; result: any };\n}\n\nexport interface PlanExecutionResult {\n  status: 'completed' | 'failed' | 'suspended';\n  completedTasks: number;\n  failedTasks: number;\n  skippedTasks: number;\n  error?: Error;\n  metrics: {\n    totalLLMCalls: number;\n    totalToolCalls: number;\n    totalTokensUsed: number;\n    totalCost: number;\n  };\n}\n\n/**\n * Executes a plan using LLM and tools\n *\n * NOTE: Memory and cache are accessed via agentContext (single source of truth)\n */\nexport class PlanExecutor extends EventEmitter<PlanExecutorEvents> implements IDisposable {\n  private agent: Agent;\n  private agentContext: AgentContext;\n  private planPlugin: PlanPlugin;\n  // NOTE: IdempotencyCache is accessed via agentContext.cache (single source of truth)\n  private externalHandler: ExternalDependencyHandler;\n  private checkpointManager: CheckpointManager;\n  private hooks: TaskAgentHooks | undefined;\n  private config: PlanExecutorConfig;\n  private abortController: AbortController;\n  private rateLimiter?: TokenBucketRateLimiter;\n  private _isDestroyed = false;\n\n  // Current execution metrics\n  private currentMetrics = {\n    totalLLMCalls: 0,\n    totalToolCalls: 0,\n    totalTokensUsed: 0,\n    totalCost: 0,\n  };\n\n  // Reference to current agent state (for checkpointing)\n  private currentState: AgentState | null = null;\n\n  constructor(\n    agent: Agent,\n    agentContext: AgentContext,\n    planPlugin: PlanPlugin,\n    externalHandler: ExternalDependencyHandler,\n    checkpointManager: CheckpointManager,\n    hooks: TaskAgentHooks | undefined,\n    config: PlanExecutorConfig\n  ) {\n    super();\n    this.agent = agent;\n    this.agentContext = agentContext;\n    this.planPlugin = planPlugin;\n    this.externalHandler = externalHandler;\n    this.checkpointManager = checkpointManager;\n    this.hooks = hooks;\n    this.config = config;\n    this.abortController = new AbortController();\n\n    // Initialize rate limiter if configured\n    if (config.rateLimiter) {\n      this.rateLimiter = new TokenBucketRateLimiter({\n        maxRequests: config.rateLimiter.maxRequestsPerMinute ?? 60,\n        windowMs: 60000, // 1 minute window\n        onLimit: config.rateLimiter.onLimit ?? 'wait',\n        maxWaitMs: config.rateLimiter.maxWaitMs ?? 60000,\n      });\n    }\n  }\n\n  /**\n   * Get memory from AgentContext (single source of truth)\n   * May be null if memory feature is disabled\n   */\n  private get memory(): WorkingMemory | null {\n    return this.agentContext.memory;\n  }\n\n  /**\n   * Get idempotency cache from AgentContext (single source of truth)\n   * May be null if memory feature is disabled\n   */\n  private get idempotencyCache(): IdempotencyCache | null {\n    return this.agentContext.cache;\n  }\n\n  /**\n   * Build a map of task states for memory priority calculation\n   */\n  private buildTaskStatesMap(plan: Plan): Map<string, TaskStatusForMemory> {\n    const taskStates = new Map<string, TaskStatusForMemory>();\n    for (const task of plan.tasks) {\n      // Map TaskStatus to TaskStatusForMemory (they're compatible for terminal states)\n      const status = task.status as TaskStatusForMemory;\n      if (['pending', 'in_progress', 'completed', 'failed', 'skipped', 'cancelled'].includes(status)) {\n        taskStates.set(task.id, status);\n      } else {\n        // Map other statuses to pending for memory priority purposes\n        taskStates.set(task.id, 'pending');\n      }\n    }\n    return taskStates;\n  }\n\n  /**\n   * Notify memory about task completion and detect stale entries\n   * No-op if memory feature is disabled\n   */\n  private async notifyMemoryOfTaskCompletion(plan: Plan, taskId: string): Promise<void> {\n    // Skip if memory feature is disabled\n    if (!this.memory) {\n      return;\n    }\n\n    const taskStates = this.buildTaskStatesMap(plan);\n    const staleEntries = await this.memory.onTaskComplete(taskId, taskStates);\n\n    if (staleEntries.length > 0) {\n      this.emit('memory:stale_entries', { entries: staleEntries, taskId });\n    }\n  }\n\n  /**\n   * Execute a plan\n   */\n  async execute(plan: Plan, state: AgentState): Promise<PlanExecutionResult> {\n    // Store state reference for checkpointing\n    this.currentState = state;\n\n    // Update checkpoint manager with current state\n    this.checkpointManager.setCurrentState(state);\n\n    // Reset metrics for this execution\n    this.currentMetrics = {\n      totalLLMCalls: 0,\n      totalToolCalls: 0,\n      totalTokensUsed: 0,\n      totalCost: 0,\n    };\n\n    let iteration = 0;\n\n    while (iteration < this.config.maxIterations) {\n      iteration++;\n\n      // Check if plan is complete\n      if (this.isPlanComplete(plan)) {\n        break;\n      }\n\n      // Check if plan is suspended (waiting on external)\n      if (this.isPlanSuspended(plan)) {\n        return {\n          status: 'suspended',\n          completedTasks: plan.tasks.filter((t) => t.status === 'completed').length,\n          failedTasks: plan.tasks.filter((t) => t.status === 'failed').length,\n          skippedTasks: plan.tasks.filter((t) => t.status === 'skipped').length,\n          metrics: this.currentMetrics,\n        };\n      }\n\n      // Get next executable tasks\n      const nextTasks = getNextExecutableTasks(plan);\n\n      if (nextTasks.length === 0) {\n        // No executable tasks - either waiting on dependencies or complete\n        break;\n      }\n\n      // Execute tasks (parallel if configured)\n      await this.executeParallelTasks(plan, nextTasks);\n    }\n\n    // Determine final status\n    const hasFailures = plan.tasks.some((t) => t.status === 'failed');\n    const allComplete = plan.tasks.every((t) =>\n      ['completed', 'skipped', 'failed'].includes(t.status)\n    );\n\n    return {\n      status: hasFailures ? 'failed' : allComplete ? 'completed' : 'suspended',\n      completedTasks: plan.tasks.filter((t) => t.status === 'completed').length,\n      failedTasks: plan.tasks.filter((t) => t.status === 'failed').length,\n      skippedTasks: plan.tasks.filter((t) => t.status === 'skipped').length,\n      metrics: this.currentMetrics,\n    };\n  }\n\n  /**\n   * Execute tasks in parallel with configurable failure handling\n   *\n   * Note on failure modes:\n   * - 'fail-fast' (default): Uses Promise.all - stops batch on first rejection (current behavior)\n   *   Individual task failures don't reject, they just set task.status = 'failed'\n   * - 'continue': Uses Promise.allSettled - all tasks run regardless of failures\n   * - 'fail-all': Uses Promise.allSettled, then throws ParallelTasksError if any failed\n   *\n   * @param plan - The plan being executed\n   * @param tasks - Tasks to execute in parallel\n   * @returns Result containing succeeded and failed tasks\n   */\n  private async executeParallelTasks(\n    plan: Plan,\n    tasks: Task[]\n  ): Promise<{ succeeded: Task[]; failed: TaskFailure[] }> {\n    const failureMode = plan.concurrency?.failureMode ?? 'fail-fast';\n    const succeeded: Task[] = [];\n    const failed: TaskFailure[] = [];\n\n    if (failureMode === 'fail-fast') {\n      // Original behavior - Promise.all executes in parallel\n      // Individual executeTask() calls handle errors internally (set task.status)\n      // Promise.all only rejects if executeTask throws (which it doesn't for normal failures)\n      await Promise.all(tasks.map((task) => this.executeTask(plan, task)));\n\n      // Categorize results\n      for (const task of tasks) {\n        if (task.status === 'completed') {\n          succeeded.push(task);\n        } else if (task.status === 'failed') {\n          const errorMsg = typeof task.result?.error === 'string' ? task.result.error : 'Task failed';\n          failed.push({\n            taskId: task.id,\n            taskName: task.name,\n            error: new Error(errorMsg),\n          });\n        }\n      }\n\n      return { succeeded, failed };\n    }\n\n    // Use Promise.allSettled for 'continue' and 'fail-all' modes\n    // Execute all tasks in parallel, don't stop on failures\n    await Promise.allSettled(\n      tasks.map(async (task) => {\n        await this.executeTask(plan, task);\n      })\n    );\n\n    // Categorize results based on task status\n    for (const task of tasks) {\n      if (task.status === 'completed') {\n        succeeded.push(task);\n      } else if (task.status === 'failed') {\n        const errorMsg = typeof task.result?.error === 'string' ? task.result.error : 'Task failed';\n        failed.push({\n          taskId: task.id,\n          taskName: task.name,\n          error: new Error(errorMsg),\n        });\n      }\n      // 'pending', 'skipped', 'in_progress' are not categorized as succeeded or failed\n    }\n\n    // For 'fail-all' mode, throw aggregate error if any failed\n    if (failureMode === 'fail-all' && failed.length > 0) {\n      throw new ParallelTasksError(failed);\n    }\n\n    // For 'continue' mode, we just return the results and continue execution\n    return { succeeded, failed };\n  }\n\n  /**\n   * Check if task condition is met\n   * @returns true if condition is met or no condition exists\n   */\n  private async checkCondition(task: Task): Promise<boolean> {\n    if (!task.condition) {\n      return true;\n    }\n    // If memory is disabled, condition values are always undefined\n    const getter = this.memory\n      ? (key: string) => this.memory!.retrieve(key)\n      : (_key: string) => Promise.resolve(undefined);\n    return evaluateCondition(task.condition, { get: getter });\n  }\n\n  /**\n   * Get the timeout for a task (per-task override or config default)\n   */\n  private getTaskTimeout(task: Task): number {\n    // Check for per-task override in metadata\n    const perTaskTimeout = task.metadata?.timeoutMs;\n    if (typeof perTaskTimeout === 'number' && perTaskTimeout > 0) {\n      return perTaskTimeout;\n    }\n    // Use config timeout or default\n    return this.config.taskTimeout ?? DEFAULT_TASK_TIMEOUT_MS;\n  }\n\n  /**\n   * Execute a single task with timeout support\n   */\n  private async executeTask(plan: Plan, task: Task): Promise<void> {\n    // Initial condition check (before timeout wrapper - fast check)\n    if (task.condition) {\n      const conditionMet = await this.checkCondition(task);\n\n      if (!conditionMet) {\n        if (task.condition.onFalse === 'skip') {\n          task.status = 'skipped';\n          this.emit('task:skipped', { task, reason: 'condition_not_met' });\n          return;\n        } else if (task.condition.onFalse === 'fail') {\n          task.status = 'failed';\n          task.result = { success: false, error: 'Condition not met' };\n          this.emit('task:failed', { task, error: new Error('Condition not met') });\n          return;\n        }\n        // 'wait' - skip for now, will retry later\n        return;\n      }\n    }\n\n    // Call beforeTask hook (before timeout wrapper - user control)\n    if (this.hooks?.beforeTask) {\n      const taskContext: TaskContext = {\n        taskId: task.id,\n        taskName: task.name,\n        attempt: task.attempts + 1,\n      };\n      const hookResult = await this.hooks.beforeTask(task, taskContext);\n      if (hookResult === 'skip') {\n        task.status = 'skipped';\n        this.emit('task:skipped', { task, reason: 'hook_skip' });\n        return;\n      }\n    }\n\n    // Mark task as in progress\n    const updatedTask = updateTaskStatus(task, 'in_progress');\n    Object.assign(task, updatedTask);\n    this.emit('task:start', { task });\n\n    // Get timeout for this task\n    const timeoutMs = this.getTaskTimeout(task);\n\n    try {\n      // Execute task with timeout\n      await this.executeTaskWithTimeout(plan, task, timeoutMs);\n    } catch (error) {\n      // Check if this is a timeout error\n      if (error instanceof TaskTimeoutError) {\n        this.emit('task:timeout', { task, timeoutMs });\n        // Timeout errors still go through error handling (may retry)\n      }\n\n      // Handle task failure\n      const err = error instanceof Error ? error : new Error(String(error));\n\n      // Call onError hook\n      let errorAction: 'retry' | 'fail' | 'skip' = 'retry';\n      if (this.hooks?.onError) {\n        const errorContext: ErrorContext = {\n          task,\n          error: err,\n          phase: 'execution',\n        };\n        errorAction = await this.hooks.onError(err, errorContext);\n      }\n\n      if (errorAction === 'skip') {\n        task.status = 'skipped';\n        this.emit('task:skipped', { task, reason: 'error_hook_skip' });\n        return;\n      } else if (errorAction === 'fail') {\n        // Force fail without retry\n        const failedTask = updateTaskStatus(task, 'failed');\n        failedTask.result = {\n          success: false,\n          error: err.message,\n        };\n        Object.assign(task, failedTask);\n        this.emit('task:failed', { task, error: err });\n        return;\n      }\n\n      // Check if we should retry (default behavior or 'retry' action)\n      if (task.attempts < task.maxAttempts) {\n        // Will retry on next iteration\n        const retryTask = updateTaskStatus(task, 'pending');\n        Object.assign(task, retryTask);\n      } else {\n        // Max attempts exceeded\n        const failedTask = updateTaskStatus(task, 'failed');\n        failedTask.result = {\n          success: false,\n          error: err.message,\n        };\n        Object.assign(task, failedTask);\n        this.emit('task:failed', { task, error: err });\n      }\n    }\n  }\n\n  /**\n   * Execute task core logic with timeout\n   */\n  private async executeTaskWithTimeout(plan: Plan, task: Task, timeoutMs: number): Promise<void> {\n    return new Promise<void>((resolve, reject) => {\n      // Setup timeout\n      const timeoutId = setTimeout(() => {\n        reject(new TaskTimeoutError(task.id, task.name, timeoutMs));\n      }, timeoutMs);\n\n      // Execute the task core logic\n      this.executeTaskCore(plan, task)\n        .then(() => {\n          clearTimeout(timeoutId);\n          resolve();\n        })\n        .catch((error) => {\n          clearTimeout(timeoutId);\n          reject(error);\n        });\n    });\n  }\n\n  /**\n   * Core task execution logic (called by executeTaskWithTimeout)\n   */\n  private async executeTaskCore(plan: Plan, task: Task): Promise<void> {\n    // Build task prompt\n    const taskPrompt = this.buildTaskPrompt(plan, task);\n\n    // Update context with current input and plan state\n    this.planPlugin.setPlan(plan);\n    this.agentContext.setCurrentInput(taskPrompt);\n\n    // Prepare context using unified AgentContext (handles compaction automatically)\n    await this.agentContext.prepare();\n\n    // Add task prompt to history (use sync for task prompts which are typically small)\n    this.agentContext.addMessageSync('user', taskPrompt);\n\n    this.emit('llm:call', { iteration: task.attempts });\n\n    // Call beforeLLMCall hook\n    let messages: any[] = [{ role: 'user', content: taskPrompt }];\n    if (this.hooks?.beforeLLMCall) {\n      messages = await this.hooks.beforeLLMCall(messages, {\n        model: this.agent.model,\n        temperature: 0.7, // Default temperature\n      });\n    }\n\n    // Re-check condition immediately before LLM call (race condition protection)\n    // This prevents stale condition evaluation when parallel tasks modify memory\n    const raceProtection = task.execution?.raceProtection !== false; // Default to true\n    if (task.condition && raceProtection) {\n      const stillMet = await this.checkCondition(task);\n      if (!stillMet) {\n        // Condition changed - skip task to avoid wasted LLM call\n        task.status = 'skipped';\n        this.emit('task:skipped', { task, reason: 'condition_changed' });\n        return;\n      }\n    }\n\n    // Apply rate limiting if configured (before LLM call to prevent overloading provider)\n    if (this.rateLimiter) {\n      await this.rateLimiter.acquire();\n    }\n\n    // Call LLM through the agent (tools already wrapped with cache in TaskAgent)\n    const response = await this.agent.run(taskPrompt);\n\n    // Track metrics from response\n    if (response.usage) {\n      this.currentMetrics.totalLLMCalls++;\n      this.currentMetrics.totalTokensUsed += response.usage.total_tokens || 0;\n\n      // Calculate cost if model info available\n      if (this.agent.model && response.usage.input_tokens && response.usage.output_tokens) {\n        const cost = calculateCost(this.agent.model, response.usage.input_tokens, response.usage.output_tokens);\n        if (cost !== null) {\n          this.currentMetrics.totalCost += cost;\n        }\n      }\n    }\n\n    // Track tool calls from Agent's execution metrics (more accurate than parsing response)\n    const agentMetrics = this.agent.getMetrics();\n    if (agentMetrics) {\n      this.currentMetrics.totalToolCalls += agentMetrics.toolCallCount;\n    }\n\n    // Call afterLLMCall hook\n    if (this.hooks?.afterLLMCall) {\n      await this.hooks.afterLLMCall(response);\n    }\n\n    // Checkpoint after LLM call\n    if (this.currentState) {\n      await this.checkpointManager.onLLMCall(this.currentState);\n    }\n\n    // Add response to history (use async for potentially large responses)\n    await this.agentContext.addMessage('assistant', response.output_text || '');\n\n    // Validate task completion (unless validation is disabled or not configured)\n    const validationResult = await this.validateTaskCompletion(task, response.output_text || '');\n\n    // Store validation result in task metadata\n    task.metadata = task.metadata || {};\n    task.metadata.validationResult = validationResult;\n\n    // Handle validation result\n    if (validationResult.requiresUserApproval) {\n      // Emit event for user decision - task stays in progress\n      this.emit('task:validation_uncertain', { task, validation: validationResult });\n\n      // If mode is 'strict', wait for user approval (task remains in_progress)\n      // The user can complete the task manually via completeTaskManually()\n      if (task.validation?.mode === 'strict') {\n        return; // Don't complete, wait for user input\n      }\n    }\n\n    if (!validationResult.isComplete) {\n      // Validation failed\n      if (task.validation?.mode === 'strict') {\n        // In strict mode, fail the task\n        this.emit('task:validation_failed', { task, validation: validationResult });\n        throw new TaskValidationError(\n          task.id,\n          task.name,\n          `Completion score ${validationResult.completionScore}% below threshold. ${validationResult.explanation}`\n        );\n      } else {\n        // In warn mode (default), log warning but complete the task\n        this.emit('task:validation_failed', { task, validation: validationResult });\n        // Continue to mark as complete with warning\n      }\n    }\n\n    // Mark task as complete\n    const completedTask = updateTaskStatus(task, 'completed');\n    completedTask.result = {\n      success: true,\n      output: response.output_text,\n      validationScore: validationResult.completionScore,\n      validationExplanation: validationResult.explanation,\n    };\n    Object.assign(task, completedTask);\n\n    this.emit('task:complete', { task, result: response });\n\n    // Notify memory of task completion to detect stale entries\n    await this.notifyMemoryOfTaskCompletion(plan, task.id);\n\n    // Call afterTask hook\n    if (this.hooks?.afterTask) {\n      await this.hooks.afterTask(task, {\n        success: true,\n        output: response.output_text,\n      });\n    }\n\n    // Check for external dependency\n    if (task.externalDependency) {\n      task.status = 'waiting_external';\n\n      // Checkpoint before external wait\n      if (this.currentState) {\n        await this.checkpointManager.checkpoint(this.currentState, 'before_external_wait');\n      }\n\n      await this.externalHandler.startWaiting(task);\n      this.emit('task:waiting_external', { task });\n    }\n  }\n\n  /**\n   * Build prompt for a specific task\n   */\n  private buildTaskPrompt(plan: Plan, task: Task): string {\n    const prompt: string[] = [];\n\n    prompt.push(`## Current Task: ${task.name}`);\n    prompt.push('');\n    prompt.push(`**Description:** ${task.description}`);\n\n    if (task.expectedOutput) {\n      prompt.push(`**Expected Output:** ${task.expectedOutput}`);\n    }\n\n    if (task.dependsOn.length > 0) {\n      const deps = plan.tasks\n        .filter((t) => task.dependsOn.includes(t.id))\n        .map((t) => t.name);\n      prompt.push(`**Dependencies Completed:** ${deps.join(', ')}`);\n    }\n\n    prompt.push('');\n    prompt.push('Please complete this task using the available tools.');\n\n    return prompt.join('\\n');\n  }\n\n  /**\n   * Validate task completion using LLM self-reflection or custom hook\n   *\n   * @param task - The task to validate\n   * @param output - The LLM response output\n   * @returns TaskValidationResult with completion score and details\n   */\n  private async validateTaskCompletion(\n    task: Task,\n    output: string\n  ): Promise<TaskValidationResult> {\n    // If task has no validation config and skipReflection is not explicitly false,\n    // default to successful completion (backward compatibility)\n    if (!task.validation || task.validation.skipReflection) {\n      return {\n        isComplete: true,\n        completionScore: 100,\n        explanation: 'No validation configured, task marked complete',\n        requiresUserApproval: false,\n      };\n    }\n\n    // First, check if a custom validateTask hook is provided\n    if (this.hooks?.validateTask && this.memory) {\n      const taskResult = { success: true, output };\n      const hookResult = await this.hooks.validateTask(task, taskResult, this.memory);\n\n      // Handle different return types from hook\n      if (typeof hookResult === 'boolean') {\n        return {\n          isComplete: hookResult,\n          completionScore: hookResult ? 100 : 0,\n          explanation: hookResult ? 'Validated by custom hook' : 'Rejected by custom hook',\n          requiresUserApproval: false,\n        };\n      } else if (typeof hookResult === 'string') {\n        return {\n          isComplete: false,\n          completionScore: 0,\n          explanation: hookResult,\n          requiresUserApproval: false,\n        };\n      } else {\n        // Full TaskValidationResult\n        return hookResult;\n      }\n    }\n\n    // Check required memory keys if specified\n    if (task.validation.requiredMemoryKeys && task.validation.requiredMemoryKeys.length > 0) {\n      const missingKeys: string[] = [];\n      for (const key of task.validation.requiredMemoryKeys) {\n        // If memory is disabled, treat all keys as missing\n        const value = this.memory ? await this.memory.retrieve(key) : undefined;\n        if (value === undefined) {\n          missingKeys.push(key);\n        }\n      }\n      if (missingKeys.length > 0) {\n        return {\n          isComplete: false,\n          completionScore: 0,\n          explanation: `Required memory keys not found: ${missingKeys.join(', ')}`,\n          requiresUserApproval: false,\n        };\n      }\n    }\n\n    // If no completion criteria, skip LLM validation\n    if (!task.validation.completionCriteria || task.validation.completionCriteria.length === 0) {\n      return {\n        isComplete: true,\n        completionScore: 100,\n        explanation: 'No completion criteria specified, task marked complete',\n        requiresUserApproval: false,\n      };\n    }\n\n    // Use LLM self-reflection to validate task completion\n    const validationPrompt = this.buildValidationPrompt(task, output);\n\n    // Call LLM for validation (separate call from task execution)\n    this.emit('llm:call', { iteration: task.attempts });\n    const validationResponse = await this.agent.run(validationPrompt);\n\n    // Track metrics\n    if (validationResponse.usage) {\n      this.currentMetrics.totalLLMCalls++;\n      this.currentMetrics.totalTokensUsed += validationResponse.usage.total_tokens || 0;\n\n      if (this.agent.model && validationResponse.usage.input_tokens && validationResponse.usage.output_tokens) {\n        const cost = calculateCost(\n          this.agent.model,\n          validationResponse.usage.input_tokens,\n          validationResponse.usage.output_tokens\n        );\n        if (cost !== null) {\n          this.currentMetrics.totalCost += cost;\n        }\n      }\n    }\n\n    // Track tool calls from validation (typically 0, but track for consistency)\n    const validationAgentMetrics = this.agent.getMetrics();\n    if (validationAgentMetrics) {\n      this.currentMetrics.totalToolCalls += validationAgentMetrics.toolCallCount;\n    }\n\n    // Parse validation response\n    return this.parseValidationResponse(\n      task,\n      validationResponse.output_text || ''\n    );\n  }\n\n  /**\n   * Build prompt for LLM self-reflection validation\n   */\n  private buildValidationPrompt(task: Task, output: string): string {\n    const criteria = task.validation?.completionCriteria || [];\n    const minScore = task.validation?.minCompletionScore ?? 80;\n\n    return `You are a task completion validator. Your job is to evaluate whether a task was completed successfully.\n\n## Task Information\n**Task Name:** ${task.name}\n**Task Description:** ${task.description}\n${task.expectedOutput ? `**Expected Output:** ${task.expectedOutput}` : ''}\n\n## Completion Criteria\nThe task is considered complete if it meets these criteria:\n${criteria.map((c, i) => `${i + 1}. ${c}`).join('\\n')}\n\n## Task Output\nThe following was the output from executing the task:\n---\n${output}\n---\n\n## Your Evaluation\nPlease evaluate the task completion and respond in the following JSON format:\n\\`\\`\\`json\n{\n  \"completionScore\": <number 0-100>,\n  \"isComplete\": <true if score >= ${minScore}>,\n  \"explanation\": \"<brief explanation of your evaluation>\",\n  \"criteriaResults\": [\n    {\n      \"criterion\": \"<criterion text>\",\n      \"met\": <true/false>,\n      \"evidence\": \"<brief evidence from output>\"\n    }\n  ]\n}\n\\`\\`\\`\n\nBe honest and thorough in your evaluation. A score of 100 means all criteria are fully met. A score below ${minScore} means the task needs more work.`;\n  }\n\n  /**\n   * Parse LLM validation response into TaskValidationResult\n   */\n  private parseValidationResponse(\n    task: Task,\n    responseText: string\n  ): TaskValidationResult {\n    const minScore = task.validation?.minCompletionScore ?? 80;\n    const requireApproval = task.validation?.requireUserApproval ?? 'never';\n\n    // Use extractJSON utility to handle markdown code blocks and inline JSON\n    interface ValidationResponse {\n      completionScore?: number;\n      isComplete?: boolean;\n      explanation?: string;\n      criteriaResults?: Array<{\n        criterion: string;\n        met: boolean;\n        evidence?: string;\n      }>;\n    }\n\n    const extractionResult = extractJSON<ValidationResponse>(responseText);\n\n    if (extractionResult.success && extractionResult.data) {\n      const parsed = extractionResult.data;\n\n      const completionScore = typeof parsed.completionScore === 'number'\n        ? Math.max(0, Math.min(100, parsed.completionScore))\n        : 0;\n\n      const isComplete = completionScore >= minScore;\n\n      // Determine if user approval is needed\n      let requiresUserApproval = false;\n      let approvalReason: string | undefined;\n\n      if (requireApproval === 'always') {\n        requiresUserApproval = true;\n        approvalReason = 'User approval required for all task completions';\n      } else if (requireApproval === 'uncertain') {\n        // Uncertain range: score is between 60% and minScore\n        const uncertainThreshold = Math.max(minScore - 20, 50);\n        if (completionScore >= uncertainThreshold && completionScore < minScore) {\n          requiresUserApproval = true;\n          approvalReason = `Completion score (${completionScore}%) is uncertain - below threshold but potentially acceptable`;\n        }\n      }\n\n      return {\n        isComplete,\n        completionScore,\n        explanation: parsed.explanation || 'No explanation provided',\n        criteriaResults: parsed.criteriaResults,\n        requiresUserApproval,\n        approvalReason,\n      };\n    }\n\n    // Failed to parse JSON - try to extract score from text using utility\n    const score = extractNumber(responseText, [\n      /(\\d{1,3})%?\\s*(?:complete|score)/i,\n      /(?:score|completion|rating)[:\\s]+(\\d{1,3})/i,\n    ], 50);\n\n    return {\n      isComplete: score >= minScore,\n      completionScore: score,\n      explanation: `Could not parse structured response. Estimated score: ${score}%`,\n      requiresUserApproval: requireApproval === 'always' || requireApproval === 'uncertain',\n      approvalReason: 'Could not parse validation response accurately',\n    };\n  }\n\n  /**\n   * Check if plan is complete\n   */\n  private isPlanComplete(plan: Plan): boolean {\n    return plan.tasks.every((t) => ['completed', 'skipped', 'failed'].includes(t.status));\n  }\n\n  /**\n   * Check if plan is suspended (waiting on external)\n   */\n  private isPlanSuspended(plan: Plan): boolean {\n    return plan.tasks.some((t) => t.status === 'waiting_external');\n  }\n\n  /**\n   * Cancel execution\n   */\n  cancel(): void {\n    this.abortController.abort();\n  }\n\n  /**\n   * Check if the PlanExecutor instance has been destroyed\n   */\n  get isDestroyed(): boolean {\n    return this._isDestroyed;\n  }\n\n  /**\n   * Cleanup resources (alias for destroy, kept for backward compatibility)\n   */\n  cleanup(): void {\n    this.destroy();\n  }\n\n  /**\n   * Destroy the PlanExecutor instance\n   * Removes all event listeners and clears internal state\n   */\n  destroy(): void {\n    if (this._isDestroyed) return;\n    this._isDestroyed = true;\n    this.abortController.abort();\n    this.removeAllListeners();\n  }\n\n  /**\n   * Get idempotency cache\n   * Returns null if memory feature is disabled\n   */\n  getIdempotencyCache(): IdempotencyCache | null {\n    return this.idempotencyCache;\n  }\n\n  /**\n   * Get rate limiter metrics (if rate limiting is enabled)\n   */\n  getRateLimiterMetrics(): { totalRequests: number; throttledRequests: number; totalWaitMs: number; avgWaitMs: number } | null {\n    if (!this.rateLimiter) {\n      return null;\n    }\n    return this.rateLimiter.getMetrics();\n  }\n\n  /**\n   * Reset rate limiter state (for testing or manual control)\n   */\n  resetRateLimiter(): void {\n    this.rateLimiter?.reset();\n  }\n}\n","/**\n * CheckpointManager - manages agent state checkpointing\n */\n\nimport { AgentState } from '../../domain/entities/AgentState.js';\nimport { IAgentStorage } from '../../infrastructure/storage/InMemoryStorage.js';\n\nexport interface CheckpointStrategy {\n  /** Checkpoint after every N tool calls */\n  afterToolCalls?: number;\n\n  /** Checkpoint after every N LLM calls */\n  afterLLMCalls?: number;\n\n  /** Checkpoint on time interval */\n  intervalMs?: number;\n\n  /** Always checkpoint before external wait */\n  beforeExternalWait: boolean;\n\n  /** Checkpoint mode */\n  mode: 'sync' | 'async';\n}\n\nexport const DEFAULT_CHECKPOINT_STRATEGY: CheckpointStrategy = {\n  afterToolCalls: 1,\n  afterLLMCalls: 1,\n  intervalMs: 30000, // 30 seconds\n  beforeExternalWait: true,\n  mode: 'async',\n};\n\n/**\n * Manages state checkpointing for persistence and recovery\n */\nexport class CheckpointManager {\n  private storage: IAgentStorage;\n  private strategy: CheckpointStrategy;\n  private toolCallsSinceCheckpoint = 0;\n  private llmCallsSinceCheckpoint = 0;\n  private intervalTimer?: NodeJS.Timeout;\n  private pendingCheckpoints = new Set<Promise<void>>();\n  private currentState: AgentState | null = null;\n\n  constructor(storage: IAgentStorage, strategy: CheckpointStrategy = DEFAULT_CHECKPOINT_STRATEGY) {\n    this.storage = storage;\n    this.strategy = strategy;\n\n    // Start interval timer if configured\n    if (this.strategy.intervalMs) {\n      this.intervalTimer = setInterval(() => {\n        this.checkIntervalCheckpoint();\n      }, this.strategy.intervalMs);\n    }\n  }\n\n  /**\n   * Set the current agent state (for interval checkpointing)\n   */\n  setCurrentState(state: AgentState): void {\n    this.currentState = state;\n  }\n\n  /**\n   * Record a tool call (may trigger checkpoint)\n   */\n  async onToolCall(state: AgentState): Promise<void> {\n    this.toolCallsSinceCheckpoint++;\n\n    if (this.strategy.afterToolCalls && this.toolCallsSinceCheckpoint >= this.strategy.afterToolCalls) {\n      await this.checkpoint(state, 'tool_calls');\n    }\n  }\n\n  /**\n   * Record an LLM call (may trigger checkpoint)\n   */\n  async onLLMCall(state: AgentState): Promise<void> {\n    this.llmCallsSinceCheckpoint++;\n\n    if (this.strategy.afterLLMCalls && this.llmCallsSinceCheckpoint >= this.strategy.afterLLMCalls) {\n      await this.checkpoint(state, 'llm_calls');\n    }\n  }\n\n  /**\n   * Force a checkpoint\n   */\n  async checkpoint(state: AgentState, reason: string): Promise<void> {\n    const checkpointPromise = this.doCheckpoint(state, reason);\n\n    if (this.strategy.mode === 'sync') {\n      await checkpointPromise;\n    } else {\n      // Async mode - don't block, but track the promise\n      this.pendingCheckpoints.add(checkpointPromise);\n      checkpointPromise.finally(() => {\n        this.pendingCheckpoints.delete(checkpointPromise);\n      });\n    }\n  }\n\n  /**\n   * Perform the actual checkpoint\n   */\n  private async doCheckpoint(state: AgentState, _reason: string): Promise<void> {\n    try {\n      // Save agent state\n      await this.storage.agent.save(state);\n\n      // Save plan\n      await this.storage.plan.savePlan(state.plan);\n\n      // Reset counters\n      this.toolCallsSinceCheckpoint = 0;\n      this.llmCallsSinceCheckpoint = 0;\n    } catch (error) {\n      console.error(`Checkpoint failed (${_reason}):`, error);\n      // Don't throw - checkpointing is best-effort\n    }\n  }\n\n  /**\n   * Check if interval-based checkpoint is needed\n   */\n  private checkIntervalCheckpoint(): void {\n    if (this.currentState) {\n      // Trigger interval checkpoint\n      this.checkpoint(this.currentState, 'interval');\n    }\n  }\n\n  /**\n   * Wait for all pending checkpoints to complete\n   */\n  async flush(): Promise<void> {\n    await Promise.all(Array.from(this.pendingCheckpoints));\n  }\n\n  /**\n   * Cleanup resources\n   */\n  async cleanup(): Promise<void> {\n    if (this.intervalTimer) {\n      clearInterval(this.intervalTimer);\n    }\n\n    // Wait for all pending checkpoints to complete\n    await this.flush();\n  }\n}\n","/**\n * PlanningAgent - AI-driven plan generation\n *\n * Separates planning phase from execution phase.\n * Analyzes goals and generates task graphs with dependencies.\n */\n\nimport { Agent } from '../../core/Agent.js';\nimport { Connector } from '../../core/Connector.js';\nimport { ToolFunction } from '../../domain/entities/Tool.js';\nimport { Plan, TaskInput, TaskValidation, createPlan } from '../../domain/entities/Task.js';\n\n/**\n * PlanningAgent configuration\n */\nexport interface PlanningAgentConfig {\n  /** Connector for LLM access */\n  connector: string | Connector;\n\n  /** Model to use for planning (can be different/cheaper than execution) */\n  model: string;\n\n  /** Max planning iterations */\n  maxPlanningIterations?: number;\n\n  /** Temperature for planning (lower = more deterministic) */\n  planningTemperature?: number;\n\n  /** Tools available for the plan (used to inform planning) */\n  availableTools?: ToolFunction[];\n}\n\n/**\n * Generated plan with metadata\n */\nexport interface GeneratedPlan {\n  plan: Plan;\n  reasoning: string;\n  estimated_duration?: string;\n  complexity?: 'low' | 'medium' | 'high';\n}\n\n/**\n * Planning system prompt\n */\nconst PLANNING_SYSTEM_PROMPT = `You are an AI planning agent. Your job is to analyze goals and break them down into structured, executable task plans.\n\n**Your Role:**\n1. Analyze the user's goal and context\n2. Break down the goal into logical, atomic tasks\n3. Identify dependencies between tasks\n4. Define completion criteria for each task (how we know the task is done)\n5. Structure tasks for optimal execution (parallel where possible)\n6. Use the planning tools to create the plan\n\n**Planning Principles:**\n- Each task should have a single, clear responsibility\n- Tasks should be atomic (can't be broken down further meaningfully)\n- Dependencies should be explicit (use dependsOn)\n- Parallel tasks should be marked as such (execution.parallel)\n- Task names should be descriptive snake_case (e.g., \"fetch_user_data\")\n- Descriptions should be clear and actionable\n\n**Completion Criteria Guidelines:**\nEach task should have clear, natural language completion criteria that describe how to verify the task is complete. These criteria should be:\n- Specific and measurable (e.g., \"response contains at least 5 items\")\n- Flexible, not rigid (avoid exact JSON schemas or exact string matches)\n- Focused on outcomes, not implementation (e.g., \"user data is stored in memory\" not \"memory_store was called\")\n\nExamples of good completion criteria:\n- \"The response contains weather data for the requested location\"\n- \"At least 3 relevant search results were found\"\n- \"The user's email address has been validated and stored\"\n- \"The file was created with content matching the user's request\"\n\nExamples of bad completion criteria (too rigid):\n- \"Response matches exact JSON format {temp: number, city: string}\"\n- \"Output contains exactly the string 'SUCCESS'\"\n- \"Function returned status code 200\"\n\n**Available Planning Tools:**\n- create_task: Add a task to the plan with completion criteria\n- finalize_plan: Complete the planning phase\n\nAlways start by analyzing the goal, then create tasks one by one, building dependencies as you go.`;\n\n/**\n * PlanningAgent class\n */\nexport class PlanningAgent {\n  private agent: Agent;\n  private config: PlanningAgentConfig;\n  private currentTasks: TaskInput[] = [];\n  private planningComplete = false;\n\n  private constructor(config: PlanningAgentConfig) {\n    this.config = config;\n\n    // Create planning tools bound to this instance\n    const planningTools = this.createBoundPlanningTools();\n\n    // Create base Agent with planning configuration\n    this.agent = Agent.create({\n      connector: config.connector,\n      model: config.model,\n      tools: planningTools,\n      instructions: PLANNING_SYSTEM_PROMPT,\n      temperature: config.planningTemperature ?? 0.3, // Lower temp for more structured output\n      maxIterations: config.maxPlanningIterations ?? 20,\n    });\n  }\n\n  /**\n   * Create a new PlanningAgent\n   */\n  static create(config: PlanningAgentConfig): PlanningAgent {\n    return new PlanningAgent(config);\n  }\n\n  /**\n   * Create planning tools bound to this PlanningAgent instance\n   */\n  private createBoundPlanningTools(): ToolFunction[] {\n    return [\n      {\n        definition: {\n          type: 'function',\n          function: {\n            name: 'create_task',\n            description: 'Create a new task in the plan with name, description, completion criteria, and optional dependencies',\n            parameters: {\n              type: 'object',\n              properties: {\n                name: {\n                  type: 'string',\n                  description: 'Task name in snake_case (e.g., \"fetch_user_data\")',\n                },\n                description: {\n                  type: 'string',\n                  description: 'Clear, actionable description of what this task does',\n                },\n                completion_criteria: {\n                  type: 'array',\n                  items: { type: 'string' },\n                  description: 'Array of natural language criteria to verify task completion (e.g., \"response contains weather data\", \"at least 3 results found\")',\n                },\n                depends_on: {\n                  type: 'array',\n                  items: { type: 'string' },\n                  description: 'Array of task names this task depends on (optional)',\n                },\n                parallel: {\n                  type: 'boolean',\n                  description: 'Whether this task can run in parallel with others (default: false)',\n                },\n                expected_output: {\n                  type: 'string',\n                  description: 'Description of expected output (optional)',\n                },\n                required_memory_keys: {\n                  type: 'array',\n                  items: { type: 'string' },\n                  description: 'Memory keys that must exist after task completion (optional)',\n                },\n                min_completion_score: {\n                  type: 'number',\n                  description: 'Minimum completion score (0-100) to consider task complete (default: 80)',\n                },\n              },\n              required: ['name', 'description'],\n            },\n          },\n        },\n        execute: async (args: Record<string, unknown>) => {\n          const name = args.name as string;\n          const description = args.description as string;\n          const completionCriteria = args.completion_criteria as string[] | undefined;\n          const dependsOn = args.depends_on as string[] | undefined;\n          const parallel = args.parallel as boolean | undefined;\n          const expectedOutput = args.expected_output as string | undefined;\n          const requiredMemoryKeys = args.required_memory_keys as string[] | undefined;\n          const minCompletionScore = args.min_completion_score as number | undefined;\n\n          // Build validation config if criteria provided\n          let validation: TaskValidation | undefined;\n          if (completionCriteria || requiredMemoryKeys || minCompletionScore) {\n            validation = {\n              completionCriteria,\n              requiredMemoryKeys,\n              minCompletionScore: minCompletionScore ?? 80,\n              requireUserApproval: 'uncertain', // Default: ask user in uncertain cases\n              mode: 'warn', // Default: warn but complete\n            };\n          }\n\n          // Actually add the task to the plan\n          this.addTask({\n            name,\n            description,\n            dependsOn,\n            execution: parallel ? { parallel: true } : undefined,\n            expectedOutput,\n            validation,\n          });\n\n          return {\n            success: true,\n            message: `Task '${name}' created${completionCriteria ? ` with ${completionCriteria.length} completion criteria` : ''}`,\n            taskCount: this.currentTasks.length,\n          };\n        },\n        idempotency: {\n          safe: false,\n        },\n      },\n      {\n        definition: {\n          type: 'function',\n          function: {\n            name: 'finalize_plan',\n            description: 'Mark the planning phase as complete. Call this when all tasks have been created and the plan is ready.',\n            parameters: {\n              type: 'object',\n              properties: {},\n            },\n          },\n        },\n        execute: async () => {\n          this.finalizePlanning();\n          return {\n            success: true,\n            message: 'Plan finalized and ready for execution',\n            totalTasks: this.currentTasks.length,\n          };\n        },\n        idempotency: {\n          safe: false,\n        },\n      },\n    ];\n  }\n\n  /**\n   * Generate a plan from a goal\n   */\n  async generatePlan(input: {\n    goal: string;\n    context?: string;\n    constraints?: string[];\n  }): Promise<GeneratedPlan> {\n    // Reset state\n    this.currentTasks = [];\n    this.planningComplete = false;\n\n    // Build planning prompt\n    const prompt = this.buildPlanningPrompt(input);\n\n    // Use the agent to generate the plan\n    const response = await this.agent.run(prompt);\n\n    // If planning wasn't finalized through tools, finalize manually\n    if (!this.planningComplete && this.currentTasks.length > 0) {\n      this.planningComplete = true;\n    }\n\n    // Create the plan\n    const plan = createPlan({\n      goal: input.goal,\n      context: input.context,\n      tasks: this.currentTasks,\n      allowDynamicTasks: false, // Plans are static by default\n    });\n\n    return {\n      plan,\n      reasoning: response.output_text || 'Plan generated',\n      complexity: this.estimateComplexity(this.currentTasks),\n    };\n  }\n\n  /**\n   * Validate and refine an existing plan\n   */\n  async refinePlan(plan: Plan, feedback: string): Promise<GeneratedPlan> {\n    // Load existing tasks\n    this.currentTasks = plan.tasks.map((task) => ({\n      name: task.name,\n      description: task.description,\n      dependsOn: task.dependsOn,\n      expectedOutput: task.expectedOutput,\n      condition: task.condition,\n      execution: task.execution,\n      externalDependency: task.externalDependency,\n      maxAttempts: task.maxAttempts,\n    }));\n\n    this.planningComplete = false;\n\n    // Build refinement prompt\n    const prompt = `I have an existing plan that needs refinement based on feedback.\n\n**Current Plan Goal:** ${plan.goal}\n**Current Plan Context:** ${plan.context || 'None'}\n\n**Current Tasks:**\n${this.currentTasks.map((t, i) => `${i + 1}. ${t.name}: ${t.description}${t.dependsOn?.length ? ` (depends on: ${t.dependsOn.join(', ')})` : ''}`).join('\\n')}\n\n**Feedback:** ${feedback}\n\nPlease refine the plan based on this feedback. You can:\n- Add new tasks\n- Modify existing task descriptions\n- Change dependencies\n- Remove unnecessary tasks\n- Adjust parallel execution\n\nUse the planning tools to make changes, then finalize when complete.`;\n\n    const response = await this.agent.run(prompt);\n\n    // Create refined plan\n    const refinedPlan = createPlan({\n      goal: plan.goal,\n      context: plan.context,\n      tasks: this.currentTasks,\n      allowDynamicTasks: false,\n    });\n\n    return {\n      plan: refinedPlan,\n      reasoning: response.output_text || 'Plan refined',\n      complexity: this.estimateComplexity(this.currentTasks),\n    };\n  }\n\n  /**\n   * Build planning prompt from input\n   */\n  private buildPlanningPrompt(input: {\n    goal: string;\n    context?: string;\n    constraints?: string[];\n  }): string {\n    const parts: string[] = [];\n\n    parts.push('Please create an execution plan for the following goal:\\n');\n    parts.push(`**Goal:** ${input.goal}\\n`);\n\n    if (input.context) {\n      parts.push(`**Context:** ${input.context}\\n`);\n    }\n\n    if (input.constraints && input.constraints.length > 0) {\n      parts.push('\\n**Constraints:**');\n      input.constraints.forEach((c) => parts.push(`- ${c}`));\n      parts.push('');\n    }\n\n    if (this.config.availableTools && this.config.availableTools.length > 0) {\n      parts.push('\\n**Available Tools for Execution:**');\n      this.config.availableTools.forEach((tool) => {\n        parts.push(`- ${tool.definition.function.name}: ${tool.definition.function.description}`);\n      });\n      parts.push('');\n    }\n\n    parts.push('\\nAnalyze this goal and create a structured plan with clear tasks and dependencies.');\n    parts.push('Use the planning tools to build the plan step by step.');\n\n    return parts.join('\\n');\n  }\n\n  /**\n   * Estimate plan complexity\n   */\n  private estimateComplexity(tasks: TaskInput[]): 'low' | 'medium' | 'high' {\n    const taskCount = tasks.length;\n    const hasDependencies = tasks.some((t) => t.dependsOn && t.dependsOn.length > 0);\n    const hasConditionals = tasks.some((t) => t.condition);\n    const hasExternalDeps = tasks.some((t) => t.externalDependency);\n\n    if (taskCount <= 3 && !hasDependencies && !hasConditionals && !hasExternalDeps) {\n      return 'low';\n    }\n\n    if (taskCount <= 10 && !hasConditionals && !hasExternalDeps) {\n      return 'medium';\n    }\n\n    return 'high';\n  }\n\n  /**\n   * Get current tasks (for tool access)\n   */\n  getCurrentTasks(): TaskInput[] {\n    return [...this.currentTasks];\n  }\n\n  /**\n   * Add task (called by planning tools)\n   */\n  addTask(task: TaskInput): void {\n    this.currentTasks.push(task);\n  }\n\n  /**\n   * Update task (called by planning tools)\n   */\n  updateTask(name: string, updates: Partial<TaskInput>): void {\n    const task = this.currentTasks.find((t) => t.name === name);\n    if (task) {\n      Object.assign(task, updates);\n    }\n  }\n\n  /**\n   * Remove task (called by planning tools)\n   */\n  removeTask(name: string): void {\n    const index = this.currentTasks.findIndex((t) => t.name === name);\n    if (index >= 0) {\n      this.currentTasks.splice(index, 1);\n    }\n  }\n\n  /**\n   * Mark planning as complete\n   */\n  finalizePlanning(): void {\n    this.planningComplete = true;\n  }\n}\n\n/**\n * Simple plan generation without tools (fallback)\n */\nexport async function generateSimplePlan(\n  goal: string,\n  context?: string\n): Promise<Plan> {\n  // Fallback: create a simple single-task plan\n  return createPlan({\n    goal,\n    context,\n    tasks: [\n      {\n        name: 'execute_goal',\n        description: `Execute the goal: ${goal}`,\n      },\n    ],\n    allowDynamicTasks: true, // Allow agent to modify plan\n  });\n}\n","/**\n * AutoSpillPlugin - Automatically spills large tool outputs to memory\n *\n * This plugin monitors tool outputs and automatically stores large results\n * in working memory's raw tier. This prevents context overflow while keeping\n * data available for later retrieval.\n *\n * Features:\n * - Configurable size threshold for auto-spill\n * - Tracks spilled entries with source metadata\n * - Provides cleanup methods (manual and auto on summarization)\n * - Integrates with WorkingMemory's hierarchical tier system\n */\n\nimport { EventEmitter } from 'eventemitter3';\nimport { BaseContextPlugin } from './IContextPlugin.js';\nimport type { IContextComponent, ITokenEstimator } from '../types.js';\nimport type { WorkingMemory } from '../../../capabilities/taskAgent/WorkingMemory.js';\nimport { addTierPrefix, getTierFromKey } from '../../../domain/entities/Memory.js';\n\n/**\n * Spilled entry metadata\n */\nexport interface SpilledEntry {\n  /** Memory key where the entry is stored */\n  key: string;\n  /** Tool that produced the output */\n  sourceTool: string;\n  /** Original size in bytes */\n  sizeBytes: number;\n  /** When the entry was spilled */\n  timestamp: number;\n  /** Whether this entry has been consumed (summarized) */\n  consumed: boolean;\n  /** Keys of summaries derived from this entry */\n  derivedSummaries: string[];\n}\n\n/**\n * Auto-spill configuration\n */\nexport interface AutoSpillConfig {\n  /** Minimum size (bytes) to trigger auto-spill. Default: 10KB */\n  sizeThreshold?: number;\n  /** Tools to auto-spill. If not provided, uses toolPatterns or spills all large outputs */\n  tools?: string[];\n  /** Regex patterns for tools to auto-spill (e.g., /^web_/ for all web tools) */\n  toolPatterns?: RegExp[];\n  /** Maximum entries to track (oldest are cleaned up). Default: 100 */\n  maxTrackedEntries?: number;\n  /** Auto-cleanup consumed entries after this many iterations. Default: 5 */\n  autoCleanupAfterIterations?: number;\n  /** Key prefix for spilled entries. Default: 'autospill' */\n  keyPrefix?: string;\n}\n\nconst DEFAULT_CONFIG: Required<AutoSpillConfig> = {\n  sizeThreshold: 10 * 1024, // 10KB\n  tools: [],\n  toolPatterns: [],\n  maxTrackedEntries: 100,\n  autoCleanupAfterIterations: 5,\n  keyPrefix: 'autospill',\n};\n\n/**\n * Serialized plugin state\n */\nexport interface SerializedAutoSpillState {\n  entries: SpilledEntry[];\n  iterationsSinceCleanup: number;\n}\n\n/**\n * Events emitted by AutoSpillPlugin\n */\nexport interface AutoSpillEvents {\n  spilled: { key: string; tool: string; sizeBytes: number };\n  consumed: { key: string; summaryKey: string };\n  cleaned: { keys: string[]; reason: 'manual' | 'auto' | 'consumed' };\n}\n\n/**\n * AutoSpillPlugin - Monitors tool outputs and auto-stores large ones in memory\n *\n * Usage:\n * ```typescript\n * const autoSpill = new AutoSpillPlugin(memory, {\n *   sizeThreshold: 10 * 1024, // 10KB\n *   tools: ['web_fetch', 'web_scrape'],\n * });\n * agentContext.registerPlugin(autoSpill);\n *\n * // Call this from afterToolExecution hook\n * autoSpill.onToolOutput('web_fetch', largeHtmlContent);\n *\n * // When agent creates summary, mark the raw data as consumed\n * autoSpill.markConsumed('autospill_web_fetch_123', 'summary.search1');\n *\n * // Cleanup consumed entries\n * await autoSpill.cleanupConsumed();\n * ```\n */\nexport class AutoSpillPlugin extends BaseContextPlugin {\n  readonly name = 'auto_spill_tracker';\n  readonly priority = 9; // High priority - compact before conversation but after tool outputs\n  readonly compactable = true;\n\n  private memory: WorkingMemory;\n  private config: Required<AutoSpillConfig>;\n  private entries: Map<string, SpilledEntry> = new Map();\n  private iterationsSinceCleanup = 0;\n  private entryCounter = 0;\n  private events = new EventEmitter<AutoSpillEvents>();\n\n  constructor(memory: WorkingMemory, config: AutoSpillConfig = {}) {\n    super();\n    this.memory = memory;\n    this.config = { ...DEFAULT_CONFIG, ...config };\n  }\n\n  /**\n   * Subscribe to events\n   */\n  on<K extends keyof AutoSpillEvents>(\n    event: K,\n    listener: (...args: any[]) => void\n  ): this {\n    this.events.on(event, listener as any);\n    return this;\n  }\n\n  /**\n   * Check if a tool should be auto-spilled\n   */\n  shouldSpill(toolName: string, outputSize: number): boolean {\n    // Check size threshold\n    if (outputSize < this.config.sizeThreshold) {\n      return false;\n    }\n\n    // If specific tools are configured, check if this tool is included\n    if (this.config.tools.length > 0) {\n      if (this.config.tools.includes(toolName)) {\n        return true;\n      }\n    }\n\n    // Check tool patterns\n    if (this.config.toolPatterns.length > 0) {\n      for (const pattern of this.config.toolPatterns) {\n        if (pattern.test(toolName)) {\n          return true;\n        }\n      }\n    }\n\n    // If no specific tools or patterns configured, spill all large outputs\n    if (this.config.tools.length === 0 && this.config.toolPatterns.length === 0) {\n      return true;\n    }\n\n    return false;\n  }\n\n  /**\n   * Called when a tool produces output\n   * Should be called from afterToolExecution hook\n   *\n   * @param toolName - Name of the tool\n   * @param output - Tool output\n   * @returns The memory key if spilled, undefined otherwise\n   */\n  async onToolOutput(toolName: string, output: unknown): Promise<string | undefined> {\n    // Calculate size\n    const outputStr = typeof output === 'string' ? output : JSON.stringify(output);\n    const sizeBytes = Buffer.byteLength(outputStr, 'utf8');\n\n    if (!this.shouldSpill(toolName, sizeBytes)) {\n      return undefined;\n    }\n\n    // Generate unique key\n    const key = `${this.config.keyPrefix}_${toolName}_${Date.now()}_${this.entryCounter++}`;\n    const fullKey = addTierPrefix(key, 'raw');\n\n    // Store in memory's raw tier\n    await this.memory.storeRaw(\n      key,\n      `Auto-spilled output from ${toolName} (${formatBytes(sizeBytes)})`,\n      output\n    );\n\n    // Track the entry\n    const entry: SpilledEntry = {\n      key: fullKey,\n      sourceTool: toolName,\n      sizeBytes,\n      timestamp: Date.now(),\n      consumed: false,\n      derivedSummaries: [],\n    };\n\n    this.entries.set(fullKey, entry);\n    this.events.emit('spilled', { key: fullKey, tool: toolName, sizeBytes });\n\n    // Prune old entries if we have too many\n    this.pruneOldEntries();\n\n    return fullKey;\n  }\n\n  /**\n   * Mark a spilled entry as consumed (summarized)\n   * Call this when the agent creates a summary from raw data\n   *\n   * @param rawKey - Key of the spilled raw entry\n   * @param summaryKey - Key of the summary created from it\n   */\n  markConsumed(rawKey: string, summaryKey: string): void {\n    const entry = this.entries.get(rawKey);\n    if (entry) {\n      entry.consumed = true;\n      entry.derivedSummaries.push(summaryKey);\n      this.events.emit('consumed', { key: rawKey, summaryKey });\n    }\n  }\n\n  /**\n   * Get all tracked spilled entries\n   */\n  getEntries(): SpilledEntry[] {\n    return Array.from(this.entries.values());\n  }\n\n  /**\n   * Get unconsumed entries (not yet summarized)\n   */\n  getUnconsumed(): SpilledEntry[] {\n    return this.getEntries().filter((e) => !e.consumed);\n  }\n\n  /**\n   * Get consumed entries (ready for cleanup)\n   */\n  getConsumed(): SpilledEntry[] {\n    return this.getEntries().filter((e) => e.consumed);\n  }\n\n  /**\n   * Cleanup consumed entries from memory\n   *\n   * @returns Keys that were deleted\n   */\n  async cleanupConsumed(): Promise<string[]> {\n    const consumed = this.getConsumed();\n    const deleted: string[] = [];\n\n    for (const entry of consumed) {\n      try {\n        // Only cleanup if it's still a raw tier entry\n        const tier = getTierFromKey(entry.key);\n        if (tier === 'raw') {\n          const exists = await this.memory.has(entry.key);\n          if (exists) {\n            await this.memory.delete(entry.key);\n            deleted.push(entry.key);\n          }\n        }\n        // Remove from tracking\n        this.entries.delete(entry.key);\n      } catch {\n        // Ignore errors - entry may have been evicted already\n      }\n    }\n\n    if (deleted.length > 0) {\n      this.events.emit('cleaned', { keys: deleted, reason: 'consumed' });\n    }\n\n    return deleted;\n  }\n\n  /**\n   * Cleanup specific entries\n   *\n   * @param keys - Keys to cleanup\n   * @returns Keys that were actually deleted\n   */\n  async cleanup(keys: string[]): Promise<string[]> {\n    const deleted: string[] = [];\n\n    for (const key of keys) {\n      try {\n        const tier = getTierFromKey(key);\n        if (tier === 'raw') {\n          const exists = await this.memory.has(key);\n          if (exists) {\n            await this.memory.delete(key);\n            deleted.push(key);\n          }\n        }\n        this.entries.delete(key);\n      } catch {\n        // Ignore errors\n      }\n    }\n\n    if (deleted.length > 0) {\n      this.events.emit('cleaned', { keys: deleted, reason: 'manual' });\n    }\n\n    return deleted;\n  }\n\n  /**\n   * Cleanup all tracked entries\n   */\n  async cleanupAll(): Promise<string[]> {\n    const keys = Array.from(this.entries.keys());\n    return this.cleanup(keys);\n  }\n\n  /**\n   * Called after each agent iteration\n   * Handles automatic cleanup if configured\n   */\n  async onIteration(): Promise<void> {\n    this.iterationsSinceCleanup++;\n\n    if (this.iterationsSinceCleanup >= this.config.autoCleanupAfterIterations) {\n      await this.cleanupConsumed();\n      this.iterationsSinceCleanup = 0;\n    }\n  }\n\n  /**\n   * Get spill info for a specific key\n   */\n  getSpillInfo(key: string): SpilledEntry | undefined {\n    return this.entries.get(key);\n  }\n\n  // ============================================================================\n  // IContextPlugin implementation\n  // ============================================================================\n\n  async getComponent(): Promise<IContextComponent | null> {\n    const unconsumed = this.getUnconsumed();\n    if (unconsumed.length === 0) {\n      return null;\n    }\n\n    // Provide info about spilled data to help the agent\n    const lines = [\n      '## Auto-Spilled Data',\n      '',\n      `The following tool outputs were auto-stored in memory (${unconsumed.length} entries):`,\n      '',\n    ];\n\n    for (const entry of unconsumed) {\n      lines.push(`- **${entry.key}**: from \\`${entry.sourceTool}\\` (${formatBytes(entry.sizeBytes)})`);\n    }\n\n    lines.push('');\n    lines.push('Use `memory_retrieve(key)` to access this data when needed.');\n    lines.push('After summarizing, use `memory_store(...)` with tier=\"summary\" or tier=\"findings\".');\n\n    return {\n      name: this.name,\n      content: lines.join('\\n'),\n      priority: this.priority,\n      compactable: this.compactable,\n      metadata: {\n        unconsumedCount: unconsumed.length,\n        consumedCount: this.getConsumed().length,\n        totalSizeBytes: unconsumed.reduce((sum, e) => sum + e.sizeBytes, 0),\n      },\n    };\n  }\n\n  async compact(_targetTokens: number, _estimator: ITokenEstimator): Promise<number> {\n    // Cleanup consumed entries to free memory\n    const deleted = await this.cleanupConsumed();\n    // Rough estimate: each entry info takes ~50 chars (~12 tokens)\n    return deleted.length * 12;\n  }\n\n  override getState(): SerializedAutoSpillState {\n    return {\n      entries: Array.from(this.entries.values()),\n      iterationsSinceCleanup: this.iterationsSinceCleanup,\n    };\n  }\n\n  override restoreState(state: unknown): void {\n    const s = state as SerializedAutoSpillState;\n    if (s?.entries && Array.isArray(s.entries)) {\n      this.entries.clear();\n      for (const entry of s.entries) {\n        this.entries.set(entry.key, entry);\n      }\n    }\n    if (typeof s?.iterationsSinceCleanup === 'number') {\n      this.iterationsSinceCleanup = s.iterationsSinceCleanup;\n    }\n  }\n\n  override destroy(): void {\n    this.events.removeAllListeners();\n    this.entries.clear();\n  }\n\n  // ============================================================================\n  // Private helpers\n  // ============================================================================\n\n  private pruneOldEntries(): void {\n    if (this.entries.size <= this.config.maxTrackedEntries) {\n      return;\n    }\n\n    // Sort by timestamp, remove oldest\n    const sorted = Array.from(this.entries.entries()).sort(\n      ([, a], [, b]) => a.timestamp - b.timestamp\n    );\n\n    const toRemove = sorted.slice(0, sorted.length - this.config.maxTrackedEntries);\n    for (const [key] of toRemove) {\n      this.entries.delete(key);\n    }\n  }\n}\n\n/**\n * Format bytes to human-readable string\n */\nfunction formatBytes(bytes: number): string {\n  if (bytes < 1024) return `${bytes} B`;\n  if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`;\n  return `${(bytes / (1024 * 1024)).toFixed(1)} MB`;\n}\n","/**\n * ResearchAgent - Generic research agent supporting any data sources\n *\n * Extends TaskAgent with research-specific capabilities:\n * - Multiple configurable sources (web, vector, file, API, etc.)\n * - Automatic memory management (spill large outputs, cleanup raw data)\n * - Research-specific tools for source interaction\n * - Built-in research protocol with search  process  synthesize phases\n *\n * Design principles:\n * - DRY: Reuses TaskAgent, AgentContext, WorkingMemory\n * - Generic: Works with any IResearchSource implementation\n * - LLM-driven: Agent decides how to use sources, not hardcoded flow\n */\n\nimport { TaskAgent, TaskAgentConfig, TaskAgentHooks } from '../taskAgent/TaskAgent.js';\nimport { ToolFunction, FunctionToolDefinition } from '../../domain/entities/Tool.js';\nimport { ToolContext } from '../../domain/interfaces/IToolContext.js';\nimport { ToolExecutionError } from '../../domain/errors/AIErrors.js';\nimport { AutoSpillPlugin, AutoSpillConfig } from '../../core/context/plugins/AutoSpillPlugin.js';\nimport { addTierPrefix } from '../../domain/entities/Memory.js';\nimport type {\n  IResearchSource,\n  SearchOptions,\n  FetchOptions,\n  ResearchPlan,\n  ResearchResult,\n  ResearchProgress,\n  ResearchFinding,\n} from './types.js';\n\n/**\n * Research-specific hooks\n */\nexport interface ResearchAgentHooks extends TaskAgentHooks {\n  /** Called when a source search completes */\n  onSearchComplete?: (source: string, query: string, resultCount: number) => Promise<void>;\n\n  /** Called when content is fetched */\n  onContentFetched?: (source: string, reference: string, sizeBytes: number) => Promise<void>;\n\n  /** Called when a finding is stored */\n  onFindingStored?: (key: string, finding: ResearchFinding) => Promise<void>;\n\n  /** Called on research progress updates */\n  onProgress?: (progress: ResearchProgress) => Promise<void>;\n}\n\n/**\n * ResearchAgent configuration\n */\nexport interface ResearchAgentConfig extends Omit<TaskAgentConfig, 'hooks'> {\n  /** Research sources to use */\n  sources: IResearchSource[];\n\n  /** Default search options for all sources */\n  defaultSearchOptions?: SearchOptions;\n\n  /** Default fetch options for all sources */\n  defaultFetchOptions?: FetchOptions;\n\n  /** Auto-spill configuration */\n  autoSpill?: AutoSpillConfig;\n\n  /** Research-specific hooks */\n  hooks?: ResearchAgentHooks;\n\n  /** Auto-summarize fetched content above this size (bytes). Default: 20KB */\n  autoSummarizeThreshold?: number;\n\n  /** Include research-specific tools. Default: true */\n  includeResearchTools?: boolean;\n}\n\n/**\n * ResearchAgent - extends TaskAgent with research capabilities\n */\nexport class ResearchAgent extends TaskAgent {\n  private sources: Map<string, IResearchSource> = new Map();\n  private autoSpillPlugin?: AutoSpillPlugin;\n  private researchHooks?: ResearchAgentHooks;\n  private defaultSearchOptions: SearchOptions = { maxResults: 10 };\n  private defaultFetchOptions: FetchOptions = { maxSize: 1024 * 1024 };\n  // Note: autoSummarizeThreshold is configured but not yet used - planned for future enhancement\n\n  // ===== Static Factory =====\n\n  /**\n   * Create a new ResearchAgent\n   */\n  static override create(config: ResearchAgentConfig): ResearchAgent {\n    // Create research-specific tools\n    const researchTools = config.includeResearchTools !== false\n      ? createResearchTools(config.sources)\n      : [];\n\n    // Merge tools\n    const allTools = [...(config.tools ?? []), ...researchTools];\n\n    // Build TaskAgent config with research task type\n    const taskAgentConfig: TaskAgentConfig = {\n      ...config,\n      tools: allTools,\n      hooks: config.hooks,\n      // Force research task type for optimal context management\n      context: {\n        ...(config.context ?? {}),\n        taskType: 'research',\n      },\n    };\n\n    // Create base TaskAgent\n    const baseAgent = TaskAgent.create(taskAgentConfig);\n\n    // Upgrade to ResearchAgent\n    const researchAgent = Object.setPrototypeOf(baseAgent, ResearchAgent.prototype) as ResearchAgent;\n\n    // Initialize research-specific state\n    researchAgent.initializeResearch(config);\n\n    return researchAgent;\n  }\n\n  /**\n   * Initialize research-specific components\n   */\n  private initializeResearch(config: ResearchAgentConfig): void {\n    // Initialize instance properties (needed because Object.setPrototypeOf doesn't run field initializers)\n    this.sources = new Map();\n    this.defaultSearchOptions = { maxResults: 10 };\n    this.defaultFetchOptions = { maxSize: 1024 * 1024 };\n\n    // Register sources\n    for (const source of config.sources) {\n      this.sources.set(source.name, source);\n    }\n\n    // Store config\n    this.researchHooks = config.hooks;\n    this.defaultSearchOptions = config.defaultSearchOptions ?? { maxResults: 10 };\n    this.defaultFetchOptions = config.defaultFetchOptions ?? { maxSize: 1024 * 1024 }; // 1MB\n    // Note: autoSummarizeThreshold from config is reserved for future auto-summarization feature\n\n    // Setup auto-spill plugin\n    const autoSpillConfig: AutoSpillConfig = {\n      sizeThreshold: 10 * 1024, // 10KB\n      toolPatterns: [/^research_fetch/, /^web_fetch/, /^web_scrape/],\n      ...config.autoSpill,\n    };\n\n    // Only set up auto-spill if memory feature is enabled\n    if (this._agentContext.memory) {\n      this.autoSpillPlugin = new AutoSpillPlugin(this._agentContext.memory, autoSpillConfig);\n      this._agentContext.registerPlugin(this.autoSpillPlugin);\n    }\n\n    // Wire up research hooks to auto-memory management\n    this.setupAutoMemoryManagement();\n  }\n\n  /**\n   * Setup automatic memory management\n   */\n  private setupAutoMemoryManagement(): void {\n    // Listen for tool executions to auto-spill large outputs\n    // This is handled by the AutoSpillPlugin via afterToolExecution hook\n  }\n\n  // ===== Public API =====\n\n  /**\n   * Get all registered sources\n   */\n  getSources(): IResearchSource[] {\n    return Array.from(this.sources.values());\n  }\n\n  /**\n   * Get a specific source by name\n   */\n  getSource(name: string): IResearchSource | undefined {\n    return this.sources.get(name);\n  }\n\n  /**\n   * Add a source at runtime\n   */\n  addSource(source: IResearchSource): void {\n    this.sources.set(source.name, source);\n  }\n\n  /**\n   * Remove a source\n   */\n  removeSource(name: string): boolean {\n    return this.sources.delete(name);\n  }\n\n  /**\n   * Search across all sources (or specified sources)\n   */\n  async searchSources(\n    query: string,\n    options?: SearchOptions & { sources?: string[] }\n  ): Promise<Map<string, Awaited<ReturnType<IResearchSource['search']>>>> {\n    const results = new Map<string, Awaited<ReturnType<IResearchSource['search']>>>();\n    const targetSources = options?.sources\n      ? options.sources.map((name) => this.sources.get(name)).filter(Boolean) as IResearchSource[]\n      : this.getSources();\n\n    const searchOptions = { ...this.defaultSearchOptions, ...options };\n\n    await Promise.all(\n      targetSources.map(async (source) => {\n        try {\n          const response = await source.search(query, searchOptions);\n          results.set(source.name, response);\n\n          // Emit hook\n          if (this.researchHooks?.onSearchComplete) {\n            await this.researchHooks.onSearchComplete(source.name, query, response.results.length);\n          }\n        } catch (error) {\n          results.set(source.name, {\n            success: false,\n            query,\n            results: [],\n            error: error instanceof Error ? error.message : String(error),\n          });\n        }\n      })\n    );\n\n    return results;\n  }\n\n  /**\n   * Fetch content from a specific source\n   */\n  async fetchFromSource(\n    sourceName: string,\n    reference: string,\n    options?: FetchOptions\n  ): Promise<ReturnType<IResearchSource['fetch']>> {\n    const source = this.sources.get(sourceName);\n    if (!source) {\n      return {\n        success: false,\n        reference,\n        content: null,\n        error: `Source \"${sourceName}\" not found`,\n      };\n    }\n\n    const fetchOptions = { ...this.defaultFetchOptions, ...options };\n\n    try {\n      const result = await source.fetch(reference, fetchOptions);\n\n      // Auto-spill large content\n      if (result.success && result.sizeBytes && result.sizeBytes > (this.autoSpillPlugin?.['config']?.sizeThreshold ?? 10240)) {\n        const spillKey = await this.autoSpillPlugin?.onToolOutput(`research_fetch_${sourceName}`, result.content);\n        if (spillKey) {\n          // Modify result to reference spilled data\n          (result as any).spilledKey = spillKey;\n        }\n      }\n\n      // Emit hook\n      if (this.researchHooks?.onContentFetched) {\n        await this.researchHooks.onContentFetched(sourceName, reference, result.sizeBytes ?? 0);\n      }\n\n      return result;\n    } catch (error) {\n      return {\n        success: false,\n        reference,\n        content: null,\n        error: error instanceof Error ? error.message : String(error),\n      };\n    }\n  }\n\n  /**\n   * Store a research finding in memory\n   * Requires memory feature to be enabled\n   */\n  async storeFinding(\n    key: string,\n    finding: ResearchFinding\n  ): Promise<void> {\n    const memory = this._agentContext.memory;\n    if (!memory) {\n      throw new Error('ResearchAgent.storeFinding requires memory feature to be enabled');\n    }\n\n    const fullKey = addTierPrefix(key, 'findings');\n\n    await memory.storeFindings(\n      key,\n      `${finding.source}: ${finding.summary.slice(0, 100)}...`,\n      finding\n    );\n\n    // Emit hook\n    if (this.researchHooks?.onFindingStored) {\n      await this.researchHooks.onFindingStored(fullKey, finding);\n    }\n  }\n\n  /**\n   * Get all stored findings\n   * Returns empty object if memory feature is disabled\n   */\n  async getFindings(): Promise<Record<string, ResearchFinding>> {\n    const memory = this._agentContext.memory;\n    if (!memory) {\n      return {};\n    }\n\n    const entries = await memory.getByTier('findings');\n    const findings: Record<string, ResearchFinding> = {};\n\n    for (const entry of entries) {\n      findings[entry.key] = entry.value as ResearchFinding;\n    }\n\n    return findings;\n  }\n\n  /**\n   * Cleanup raw data that has been processed\n   * Call this after creating summaries/findings from raw content\n   */\n  async cleanupProcessedRaw(rawKeys: string[]): Promise<number> {\n    // Mark as consumed in auto-spill\n    for (const key of rawKeys) {\n      this.autoSpillPlugin?.markConsumed(key, 'manual-cleanup');\n    }\n\n    // Cleanup via auto-spill plugin\n    const deleted = await this.autoSpillPlugin?.cleanup(rawKeys) ?? [];\n    return deleted.length;\n  }\n\n  /**\n   * Execute a research plan\n   * This is a high-level orchestration method that can be used\n   * for structured research, or the LLM can drive research via tools\n   */\n  async executeResearchPlan(plan: ResearchPlan): Promise<ResearchResult> {\n    const startTime = Date.now();\n    const metrics = {\n      searchDurationMs: 0,\n      processDurationMs: 0,\n      synthesizeDurationMs: 0,\n      totalDurationMs: 0,\n    };\n\n    let queriesExecuted = 0;\n    let resultsFound = 0;\n    let resultsProcessed = 0;\n\n    try {\n      // Phase 1: Search\n      const searchStart = Date.now();\n      const allResults: Array<{ source: string; query: string; results: any[] }> = [];\n\n      for (const querySpec of plan.queries) {\n        const searchResults = await this.searchSources(querySpec.query, {\n          maxResults: plan.maxResultsPerQuery,\n          sources: querySpec.sources ?? plan.sources,\n        });\n\n        queriesExecuted++;\n\n        for (const [source, response] of searchResults) {\n          if (response.success) {\n            allResults.push({\n              source,\n              query: querySpec.query,\n              results: response.results,\n            });\n            resultsFound += response.results.length;\n          }\n        }\n\n        // Emit progress\n        if (this.researchHooks?.onProgress) {\n          await this.researchHooks.onProgress({\n            phase: 'searching',\n            currentQuery: querySpec.query,\n            queriesCompleted: queriesExecuted,\n            totalQueries: plan.queries.length,\n            resultsProcessed: 0,\n            totalResults: resultsFound,\n            findingsGenerated: 0,\n          });\n        }\n      }\n\n      metrics.searchDurationMs = Date.now() - searchStart;\n\n      // Phase 2: Process (fetch and store)\n      const processStart = Date.now();\n      for (const resultSet of allResults) {\n        for (const result of resultSet.results) {\n          // Fetch content\n          const content = await this.fetchFromSource(resultSet.source, result.reference);\n          resultsProcessed++;\n\n          if (content.success) {\n            // Store in raw tier if memory is enabled\n            if (this._agentContext.memory) {\n              const rawKey = `${resultSet.source}_${result.id}`;\n              await this._agentContext.memory.storeRaw(\n                rawKey,\n                `Raw content from ${resultSet.source}: ${result.title}`,\n                content.content\n              );\n            }\n          }\n\n          // Emit progress\n          if (this.researchHooks?.onProgress) {\n            await this.researchHooks.onProgress({\n              phase: 'processing',\n              currentSource: resultSet.source,\n              queriesCompleted: queriesExecuted,\n              totalQueries: plan.queries.length,\n              resultsProcessed,\n              totalResults: resultsFound,\n              findingsGenerated: 0,\n            });\n          }\n\n          // Check if we've hit the limit\n          if (plan.maxTotalFindings && resultsProcessed >= plan.maxTotalFindings) {\n            break;\n          }\n        }\n      }\n\n      metrics.processDurationMs = Date.now() - processStart;\n\n      // Phase 3: Synthesize (let the LLM do this via the agentic loop)\n      // The agent will use memory_retrieve_batch to get all findings\n      // and create a synthesis\n\n      const findings = await this.getFindings();\n      const findingsCount = Object.keys(findings).length;\n\n      metrics.totalDurationMs = Date.now() - startTime;\n\n      return {\n        success: true,\n        goal: plan.goal,\n        queriesExecuted,\n        resultsFound,\n        resultsProcessed,\n        findingsCount,\n        metrics,\n      };\n    } catch (error) {\n      metrics.totalDurationMs = Date.now() - startTime;\n\n      return {\n        success: false,\n        goal: plan.goal,\n        queriesExecuted,\n        resultsFound,\n        resultsProcessed,\n        findingsCount: 0,\n        error: error instanceof Error ? error.message : String(error),\n        metrics,\n      };\n    }\n  }\n\n  /**\n   * Get auto-spill statistics\n   */\n  getAutoSpillStats(): {\n    totalSpilled: number;\n    consumed: number;\n    unconsumed: number;\n    totalSizeBytes: number;\n  } {\n    if (!this.autoSpillPlugin) {\n      return { totalSpilled: 0, consumed: 0, unconsumed: 0, totalSizeBytes: 0 };\n    }\n\n    const entries = this.autoSpillPlugin.getEntries();\n    const consumed = entries.filter((e) => e.consumed);\n    const unconsumed = entries.filter((e) => !e.consumed);\n\n    return {\n      totalSpilled: entries.length,\n      consumed: consumed.length,\n      unconsumed: unconsumed.length,\n      totalSizeBytes: entries.reduce((sum, e) => sum + e.sizeBytes, 0),\n    };\n  }\n\n  // ===== Override cleanup =====\n\n  override async destroy(): Promise<void> {\n    this.sources.clear();\n    await super.destroy();\n  }\n}\n\n// ============================================================================\n// Research Tools Factory\n// ============================================================================\n\n/**\n * Research tools context - extends ToolContext with research-specific access\n */\ninterface ResearchToolContext {\n  sourcesMap: Map<string, IResearchSource>;\n  defaultSearchOptions: SearchOptions;\n  defaultFetchOptions: FetchOptions;\n  autoSpillPlugin?: AutoSpillPlugin;\n}\n\n/**\n * Create research-specific tools for source interaction\n * These tools use closure over the sources and config rather than accessing agent from context\n */\nfunction createResearchTools(sources: IResearchSource[]): ToolFunction[] {\n  // Create a sources map for lookup\n  const sourcesMap = new Map<string, IResearchSource>();\n  for (const source of sources) {\n    sourcesMap.set(source.name, source);\n  }\n\n  const sourceNames = sources.map((s) => s.name);\n  const sourceDescriptions = sources.map((s) => `- ${s.name} (${s.type}): ${s.description}`).join('\\n');\n\n  return [\n    // research_search - Search across sources\n    {\n      definition: {\n        type: 'function',\n        function: {\n          name: 'research_search',\n          description: `Search for information across configured research sources.\n\nAvailable sources:\n${sourceDescriptions}\n\nReturns search results with references that can be fetched for full content.`,\n          parameters: {\n            type: 'object',\n            properties: {\n              query: {\n                type: 'string',\n                description: 'Search query',\n              },\n              sources: {\n                type: 'array',\n                items: { type: 'string', enum: sourceNames },\n                description: 'Specific sources to search (empty = all sources)',\n              },\n              maxResults: {\n                type: 'number',\n                description: 'Maximum results per source (default: 10)',\n              },\n            },\n            required: ['query'],\n          },\n        },\n      } as FunctionToolDefinition,\n      execute: async (args: Record<string, unknown>) => {\n        const query = args.query as string;\n        const requestedSources = args.sources as string[] | undefined;\n        const maxResults = (args.maxResults as number) ?? 10;\n\n        // Get target sources\n        const targetSources = requestedSources && requestedSources.length > 0\n          ? requestedSources.map((name) => sourcesMap.get(name)).filter(Boolean) as IResearchSource[]\n          : sources;\n\n        // Search all sources in parallel\n        const results = new Map<string, Awaited<ReturnType<IResearchSource['search']>>>();\n\n        await Promise.all(\n          targetSources.map(async (source) => {\n            try {\n              const response = await source.search(query, { maxResults });\n              results.set(source.name, response);\n            } catch (error) {\n              results.set(source.name, {\n                success: false,\n                query,\n                results: [],\n                error: error instanceof Error ? error.message : String(error),\n              });\n            }\n          })\n        );\n\n        // Format results\n        const formatted: Record<string, unknown> = {};\n        for (const [source, response] of results) {\n          formatted[source] = {\n            success: response.success,\n            count: response.results.length,\n            results: response.results.map((r) => ({\n              id: r.id,\n              title: r.title,\n              snippet: r.snippet,\n              reference: r.reference,\n              relevance: r.relevance,\n            })),\n            error: response.error,\n          };\n        }\n\n        return {\n          query,\n          sources: Object.keys(formatted),\n          results: formatted,\n          totalResults: Object.values(formatted).reduce((sum: number, r: any) => sum + r.count, 0),\n        };\n      },\n      idempotency: { safe: false },\n      output: { expectedSize: 'medium' },\n      describeCall: (args) => `\"${args.query}\" in ${(args.sources as string[])?.join(', ') || 'all sources'}`,\n    },\n\n    // research_fetch - Fetch full content\n    {\n      definition: {\n        type: 'function',\n        function: {\n          name: 'research_fetch',\n          description: `Fetch full content for a search result.\n\nUse the reference from research_search results.\nLarge content will be auto-stored in memory (raw tier) - use memory_retrieve to access.`,\n          parameters: {\n            type: 'object',\n            properties: {\n              source: {\n                type: 'string',\n                enum: sourceNames,\n                description: 'Source to fetch from',\n              },\n              reference: {\n                type: 'string',\n                description: 'Reference from search result (URL, path, ID, etc.)',\n              },\n            },\n            required: ['source', 'reference'],\n          },\n        },\n      } as FunctionToolDefinition,\n      execute: async (args: Record<string, unknown>) => {\n        const sourceName = args.source as string;\n        const reference = args.reference as string;\n\n        const source = sourcesMap.get(sourceName);\n        if (!source) {\n          return {\n            success: false,\n            reference,\n            error: `Source \"${sourceName}\" not found`,\n          };\n        }\n\n        try {\n          const result = await source.fetch(reference, { maxSize: 1024 * 1024 });\n\n          return {\n            success: result.success,\n            reference: result.reference,\n            contentType: result.contentType,\n            sizeBytes: result.sizeBytes,\n            content: result.success ? result.content : null,\n            error: result.error,\n          };\n        } catch (error) {\n          return {\n            success: false,\n            reference,\n            error: error instanceof Error ? error.message : String(error),\n          };\n        }\n      },\n      idempotency: { safe: false },\n      output: { expectedSize: 'large' },\n      describeCall: (args) => `${args.source}:${args.reference}`,\n    },\n\n    // research_store_finding - Store a research finding (uses standard memory tools)\n    {\n      definition: {\n        type: 'function',\n        function: {\n          name: 'research_store_finding',\n          description: `Store a research finding in memory (findings tier, high priority).\n\nUse this to save important insights discovered during research.\nFindings are preserved during context compaction.\n\nNote: This is a convenience wrapper around memory_store with tier=\"findings\".`,\n          parameters: {\n            type: 'object',\n            properties: {\n              key: {\n                type: 'string',\n                description: 'Unique key for this finding (e.g., \"ai_employment_impact\")',\n              },\n              source: {\n                type: 'string',\n                description: 'Source that provided this finding',\n              },\n              query: {\n                type: 'string',\n                description: 'Query that led to this finding',\n              },\n              summary: {\n                type: 'string',\n                description: 'Brief summary of the finding (1-2 sentences)',\n              },\n              details: {\n                type: 'string',\n                description: 'Additional details or supporting information',\n              },\n              references: {\n                type: 'array',\n                items: { type: 'string' },\n                description: 'References used (URLs, file paths, etc.)',\n              },\n              confidence: {\n                type: 'number',\n                description: 'Confidence level 0-1 (optional)',\n              },\n            },\n            required: ['key', 'source', 'query', 'summary', 'references'],\n          },\n        },\n      } as FunctionToolDefinition,\n      execute: async (args: Record<string, unknown>, context?: ToolContext) => {\n        if (!context?.memory) {\n          throw new ToolExecutionError('research_store_finding', 'Requires memory context (use with TaskAgent or ResearchAgent)');\n        }\n\n        const finding: ResearchFinding = {\n          source: args.source as string,\n          query: args.query as string,\n          summary: args.summary as string,\n          details: args.details as string | undefined,\n          references: args.references as string[],\n          confidence: args.confidence as number | undefined,\n          timestamp: Date.now(),\n        };\n\n        const fullKey = addTierPrefix(args.key as string, 'findings');\n        const description = `${finding.source}: ${finding.summary.slice(0, 100)}${finding.summary.length > 100 ? '...' : ''}`;\n\n        await context.memory.set(fullKey, description, finding, {\n          scope: { type: 'plan' },\n          priority: 'high',\n        });\n\n        return {\n          success: true,\n          key: fullKey,\n          finding,\n        };\n      },\n      idempotency: { safe: true },\n      output: { expectedSize: 'small' },\n      describeCall: (args) => args.key as string,\n    },\n\n    // research_list_sources - List available sources\n    {\n      definition: {\n        type: 'function',\n        function: {\n          name: 'research_list_sources',\n          description: 'List all available research sources and their capabilities.',\n          parameters: {\n            type: 'object',\n            properties: {},\n            required: [],\n          },\n        },\n      } as FunctionToolDefinition,\n      execute: async () => {\n        return {\n          count: sources.length,\n          sources: sources.map((s) => ({\n            name: s.name,\n            type: s.type,\n            description: s.description,\n            capabilities: s.getCapabilities?.() ?? {\n              canSearch: true,\n              canFetch: true,\n              hasRelevanceScores: false,\n            },\n          })),\n        };\n      },\n      idempotency: { safe: true },\n      output: { expectedSize: 'small' },\n      describeCall: () => 'sources',\n    },\n  ];\n}\n\nexport { createResearchTools };\nexport type { ResearchToolContext };\n","/**\n * WebSearchSource - Web search research source using SearchProvider\n *\n * Bridges the existing SearchProvider/webFetch infrastructure to IResearchSource.\n */\n\nimport { Connector } from '../../../core/Connector.js';\nimport { SearchProvider, ISearchProvider } from '../../search/SearchProvider.js';\nimport type {\n  IResearchSource,\n  SearchResponse,\n  FetchedContent,\n  SearchOptions,\n  FetchOptions,\n  SourceCapabilities,\n} from '../types.js';\n\n/**\n * Web search source configuration\n */\nexport interface WebSearchSourceConfig {\n  /** Source name (e.g., 'web-serper', 'web-brave') */\n  name: string;\n  /** Description */\n  description?: string;\n  /** Connector name or instance for search */\n  searchConnector: string | Connector;\n  /** Optional: Connector for fetching (if different from search) */\n  fetchConnector?: string | Connector;\n  /** Default country code */\n  defaultCountry?: string;\n  /** Default language */\n  defaultLanguage?: string;\n}\n\n/**\n * WebSearchSource - Uses SearchProvider for web search\n */\nexport class WebSearchSource implements IResearchSource {\n  readonly name: string;\n  readonly description: string;\n  readonly type = 'web' as const;\n\n  private searchProvider: ISearchProvider;\n  private defaultCountry?: string;\n  private defaultLanguage?: string;\n\n  constructor(config: WebSearchSourceConfig) {\n    this.name = config.name;\n    this.description = config.description ?? `Web search via ${config.name}`;\n    this.defaultCountry = config.defaultCountry;\n    this.defaultLanguage = config.defaultLanguage;\n\n    // Create search provider\n    this.searchProvider = SearchProvider.create({\n      connector: config.searchConnector,\n    });\n\n    // Note: fetchConnector is reserved for future authenticated fetch support\n  }\n\n  async search(query: string, options?: SearchOptions): Promise<SearchResponse> {\n    try {\n      const response = await this.searchProvider.search(query, {\n        numResults: options?.maxResults ?? 10,\n        language: this.defaultLanguage,\n        country: this.defaultCountry,\n        ...options?.sourceOptions,\n      });\n\n      return {\n        success: response.success,\n        query: response.query,\n        results: response.results.map((r, index) => ({\n          id: `${this.name}_${index}_${Date.now()}`,\n          title: r.title,\n          snippet: r.snippet,\n          reference: r.url,\n          relevance: 1 - (r.position / (response.results.length + 1)), // Convert position to relevance\n          metadata: { position: r.position },\n        })),\n        totalResults: response.count,\n        error: response.error,\n      };\n    } catch (error) {\n      return {\n        success: false,\n        query,\n        results: [],\n        error: error instanceof Error ? error.message : String(error),\n      };\n    }\n  }\n\n  async fetch(reference: string, options?: FetchOptions): Promise<FetchedContent> {\n    try {\n      // Use built-in fetch with optional connector\n      const controller = new AbortController();\n      const timeout = options?.timeoutMs ?? 30000;\n\n      const timeoutId = setTimeout(() => controller.abort(), timeout);\n\n      const headers: Record<string, string> = {\n        'User-Agent': 'Mozilla/5.0 (compatible; ResearchAgent/1.0)',\n        'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',\n      };\n\n      // Note: For authenticated fetch, configure a fetch connector with appropriate headers\n      // The connector auth is handled at request time by the connector's request method\n\n      const response = await fetch(reference, {\n        headers,\n        signal: controller.signal,\n      });\n\n      clearTimeout(timeoutId);\n\n      if (!response.ok) {\n        return {\n          success: false,\n          reference,\n          content: null,\n          error: `HTTP ${response.status}: ${response.statusText}`,\n        };\n      }\n\n      const contentType = response.headers.get('content-type') ?? 'text/html';\n      const buffer = await response.arrayBuffer();\n      const sizeBytes = buffer.byteLength;\n\n      // Check size limit\n      if (options?.maxSize && sizeBytes > options.maxSize) {\n        return {\n          success: false,\n          reference,\n          content: null,\n          error: `Content too large: ${sizeBytes} bytes (max: ${options.maxSize})`,\n          sizeBytes,\n        };\n      }\n\n      // Decode content\n      const decoder = new TextDecoder();\n      const content = decoder.decode(buffer);\n\n      return {\n        success: true,\n        reference,\n        content,\n        contentType,\n        sizeBytes,\n        metadata: {\n          statusCode: response.status,\n          headers: Object.fromEntries(response.headers.entries()),\n        },\n      };\n    } catch (error) {\n      return {\n        success: false,\n        reference,\n        content: null,\n        error: error instanceof Error ? error.message : String(error),\n      };\n    }\n  }\n\n  async isAvailable(): Promise<boolean> {\n    try {\n      // Try a simple search to check availability\n      const response = await this.search('test', { maxResults: 1 });\n      return response.success;\n    } catch {\n      return false;\n    }\n  }\n\n  getCapabilities(): SourceCapabilities {\n    return {\n      canSearch: true,\n      canFetch: true,\n      hasRelevanceScores: true,\n      maxResultsPerSearch: 100,\n      contentTypes: ['text/html', 'text/plain', 'application/json'],\n    };\n  }\n}\n\n/**\n * Create a web search source from a connector name\n */\nexport function createWebSearchSource(\n  connectorName: string,\n  options?: Partial<WebSearchSourceConfig>\n): WebSearchSource {\n  return new WebSearchSource({\n    name: options?.name ?? `web-${connectorName}`,\n    description: options?.description ?? `Web search via ${connectorName}`,\n    searchConnector: connectorName,\n    ...options,\n  });\n}\n","/**\n * FileSearchSource - File system research source\n *\n * Enables research across local or remote file systems using glob patterns and grep.\n */\n\nimport * as fs from 'fs/promises';\nimport * as path from 'path';\n// @ts-ignore - glob types may not be available in all environments\nimport { glob } from 'glob';\nimport type {\n  IResearchSource,\n  SourceResult,\n  SearchResponse,\n  FetchedContent,\n  SearchOptions,\n  FetchOptions,\n  SourceCapabilities,\n} from '../types.js';\n\n/**\n * File search source configuration\n */\nexport interface FileSearchSourceConfig {\n  /** Source name */\n  name: string;\n  /** Description */\n  description?: string;\n  /** Base directory for searches */\n  basePath: string;\n  /** File patterns to include (glob) */\n  includePatterns?: string[];\n  /** File patterns to exclude (glob) */\n  excludePatterns?: string[];\n  /** Maximum file size to read (bytes) */\n  maxFileSize?: number;\n  /** Search mode: 'filename' (match filenames), 'content' (grep-like), 'both' */\n  searchMode?: 'filename' | 'content' | 'both';\n}\n\n/**\n * FileSearchSource - Search and read files\n */\nexport class FileSearchSource implements IResearchSource {\n  readonly name: string;\n  readonly description: string;\n  readonly type = 'file' as const;\n\n  private basePath: string;\n  private includePatterns: string[];\n  private excludePatterns: string[];\n  private maxFileSize: number;\n  private searchMode: 'filename' | 'content' | 'both';\n\n  constructor(config: FileSearchSourceConfig) {\n    this.name = config.name;\n    this.description = config.description ?? `File search in ${config.basePath}`;\n    this.basePath = path.resolve(config.basePath);\n    this.includePatterns = config.includePatterns ?? ['**/*'];\n    this.excludePatterns = config.excludePatterns ?? ['**/node_modules/**', '**/.git/**'];\n    this.maxFileSize = config.maxFileSize ?? 1024 * 1024; // 1MB default\n    this.searchMode = config.searchMode ?? 'both';\n  }\n\n  async search(query: string, options?: SearchOptions): Promise<SearchResponse> {\n    try {\n      const results: SourceResult[] = [];\n      const maxResults = options?.maxResults ?? 20;\n\n      // Get all matching files\n      const files = await glob(this.includePatterns, {\n        cwd: this.basePath,\n        ignore: this.excludePatterns,\n        nodir: true,\n        absolute: true,\n      });\n\n      // Search through files\n      for (const filePath of files) {\n        if (results.length >= maxResults) break;\n\n        const relativePath = path.relative(this.basePath, filePath);\n        const filename = path.basename(filePath);\n\n        // Filename search\n        if (this.searchMode === 'filename' || this.searchMode === 'both') {\n          if (this.matchesQuery(filename, query)) {\n            results.push({\n              id: `file_${Buffer.from(relativePath).toString('base64').slice(0, 20)}`,\n              title: filename,\n              snippet: `File: ${relativePath}`,\n              reference: filePath,\n              relevance: this.calculateRelevance(filename, query),\n              metadata: { type: 'filename_match', relativePath },\n            });\n            continue; // Don't also content-search this file\n          }\n        }\n\n        // Content search\n        if (this.searchMode === 'content' || this.searchMode === 'both') {\n          try {\n            const stat = await fs.stat(filePath);\n            if (stat.size > this.maxFileSize) continue;\n\n            const content = await fs.readFile(filePath, 'utf-8');\n            const match = this.findContentMatch(content, query);\n\n            if (match) {\n              results.push({\n                id: `file_${Buffer.from(relativePath).toString('base64').slice(0, 20)}`,\n                title: filename,\n                snippet: match.snippet,\n                reference: filePath,\n                relevance: match.relevance,\n                metadata: {\n                  type: 'content_match',\n                  relativePath,\n                  lineNumber: match.lineNumber,\n                },\n              });\n            }\n          } catch {\n            // Skip files that can't be read\n          }\n        }\n      }\n\n      // Sort by relevance\n      results.sort((a, b) => (b.relevance ?? 0) - (a.relevance ?? 0));\n\n      return {\n        success: true,\n        query,\n        results: results.slice(0, maxResults),\n        totalResults: results.length,\n      };\n    } catch (error) {\n      return {\n        success: false,\n        query,\n        results: [],\n        error: error instanceof Error ? error.message : String(error),\n      };\n    }\n  }\n\n  async fetch(reference: string, options?: FetchOptions): Promise<FetchedContent> {\n    try {\n      // Validate path is within base path\n      const absolutePath = path.resolve(reference);\n      if (!absolutePath.startsWith(this.basePath)) {\n        return {\n          success: false,\n          reference,\n          content: null,\n          error: 'Path is outside allowed base directory',\n        };\n      }\n\n      const stat = await fs.stat(absolutePath);\n      const maxSize = options?.maxSize ?? this.maxFileSize;\n\n      if (stat.size > maxSize) {\n        return {\n          success: false,\n          reference,\n          content: null,\n          error: `File too large: ${stat.size} bytes (max: ${maxSize})`,\n          sizeBytes: stat.size,\n        };\n      }\n\n      const content = await fs.readFile(absolutePath, 'utf-8');\n      const ext = path.extname(absolutePath).toLowerCase();\n\n      return {\n        success: true,\n        reference,\n        content,\n        contentType: this.getContentType(ext),\n        sizeBytes: stat.size,\n        metadata: {\n          filename: path.basename(absolutePath),\n          extension: ext,\n          modifiedAt: stat.mtime.toISOString(),\n        },\n      };\n    } catch (error) {\n      return {\n        success: false,\n        reference,\n        content: null,\n        error: error instanceof Error ? error.message : String(error),\n      };\n    }\n  }\n\n  async isAvailable(): Promise<boolean> {\n    try {\n      await fs.access(this.basePath);\n      return true;\n    } catch {\n      return false;\n    }\n  }\n\n  getCapabilities(): SourceCapabilities {\n    return {\n      canSearch: true,\n      canFetch: true,\n      hasRelevanceScores: true,\n      maxResultsPerSearch: 1000,\n      contentTypes: ['text/plain', 'application/json', 'text/markdown', 'text/javascript'],\n    };\n  }\n\n  // ============================================================================\n  // Private helpers\n  // ============================================================================\n\n  private matchesQuery(text: string, query: string): boolean {\n    const lowerText = text.toLowerCase();\n    const lowerQuery = query.toLowerCase();\n\n    // Simple substring match\n    if (lowerText.includes(lowerQuery)) return true;\n\n    // Word-based match\n    const queryWords = lowerQuery.split(/\\s+/);\n    return queryWords.every((word) => lowerText.includes(word));\n  }\n\n  private calculateRelevance(text: string, query: string): number {\n    const lowerText = text.toLowerCase();\n    const lowerQuery = query.toLowerCase();\n\n    // Exact match\n    if (lowerText === lowerQuery) return 1.0;\n\n    // Starts with query\n    if (lowerText.startsWith(lowerQuery)) return 0.9;\n\n    // Contains query\n    if (lowerText.includes(lowerQuery)) return 0.7;\n\n    // Word match\n    const queryWords = lowerQuery.split(/\\s+/);\n    const matchedWords = queryWords.filter((w) => lowerText.includes(w));\n    return (matchedWords.length / queryWords.length) * 0.6;\n  }\n\n  private findContentMatch(\n    content: string,\n    query: string\n  ): { snippet: string; relevance: number; lineNumber: number } | null {\n    const lines = content.split('\\n');\n    const lowerQuery = query.toLowerCase();\n\n    for (let i = 0; i < lines.length; i++) {\n      const line = lines[i] ?? '';\n      const lowerLine = line.toLowerCase();\n\n      if (lowerLine.includes(lowerQuery)) {\n        // Get context (line before and after)\n        const start = Math.max(0, i - 1);\n        const end = Math.min(lines.length, i + 2);\n        const context = lines.slice(start, end).join('\\n');\n\n        return {\n          snippet: context.length > 200 ? context.slice(0, 200) + '...' : context,\n          relevance: 0.8,\n          lineNumber: i + 1,\n        };\n      }\n    }\n\n    return null;\n  }\n\n  private getContentType(ext: string): string {\n    const types: Record<string, string> = {\n      '.txt': 'text/plain',\n      '.md': 'text/markdown',\n      '.json': 'application/json',\n      '.js': 'text/javascript',\n      '.ts': 'text/typescript',\n      '.py': 'text/x-python',\n      '.html': 'text/html',\n      '.css': 'text/css',\n      '.xml': 'application/xml',\n      '.yaml': 'text/yaml',\n      '.yml': 'text/yaml',\n    };\n    return types[ext] ?? 'text/plain';\n  }\n}\n\n/**\n * Create a file search source\n */\nexport function createFileSearchSource(\n  basePath: string,\n  options?: Partial<FileSearchSourceConfig>\n): FileSearchSource {\n  return new FileSearchSource({\n    name: options?.name ?? `files-${path.basename(basePath)}`,\n    basePath,\n    ...options,\n  });\n}\n","/**\n * Truncate Compactor\n *\n * Truncates content to target size by:\n * - For strings: Cut to character limit\n * - For arrays: Keep most recent items\n */\n\nimport type { IContextCompactor, IContextComponent, ITokenEstimator } from '../../../core/context/types.js';\n\nexport class TruncateCompactor implements IContextCompactor {\n  readonly name = 'truncate';\n  readonly priority = 10;\n\n  constructor(private estimator: ITokenEstimator) {}\n\n  canCompact(component: IContextComponent): boolean {\n    return (\n      component.compactable &&\n      (component.metadata?.strategy === 'truncate' || component.metadata?.truncatable === true)\n    );\n  }\n\n  async compact(component: IContextComponent, targetTokens: number): Promise<IContextComponent> {\n    if (typeof component.content === 'string') {\n      return this.truncateString(component, targetTokens);\n    }\n\n    if (Array.isArray(component.content)) {\n      return this.truncateArray(component, targetTokens);\n    }\n\n    // Can't truncate other types\n    return component;\n  }\n\n  estimateSavings(component: IContextComponent): number {\n    const current = this.estimator.estimateDataTokens(component.content);\n    return Math.floor(current * 0.5); // Estimate 50% reduction\n  }\n\n  private truncateString(component: IContextComponent, targetTokens: number): IContextComponent {\n    const content = component.content as string;\n    const currentTokens = this.estimator.estimateTokens(content);\n\n    if (currentTokens <= targetTokens) {\n      return component;\n    }\n\n    // Calculate character limit\n    const targetChars = targetTokens * 4; // ~4 chars per token\n    const truncated = content.substring(0, targetChars) + '\\n[truncated...]';\n\n    return {\n      ...component,\n      content: truncated,\n      metadata: {\n        ...component.metadata,\n        truncated: true,\n        originalLength: content.length,\n        truncatedLength: truncated.length,\n      },\n    };\n  }\n\n  private truncateArray(component: IContextComponent, targetTokens: number): IContextComponent {\n    const content = component.content as unknown[];\n    let tokens = 0;\n    const kept: unknown[] = [];\n\n    // Keep most recent items that fit within target\n    for (let i = content.length - 1; i >= 0; i--) {\n      const item = content[i];\n      const itemTokens = this.estimator.estimateDataTokens(item);\n\n      if (tokens + itemTokens > targetTokens && kept.length > 0) {\n        break;\n      }\n\n      kept.unshift(item);\n      tokens += itemTokens;\n    }\n\n    const droppedLength = content.length - kept.length;\n\n    // Only mark as truncated if we actually dropped items\n    if (droppedLength === 0) {\n      return component;\n    }\n\n    return {\n      ...component,\n      content: kept,\n      metadata: {\n        ...component.metadata,\n        truncated: true,\n        originalLength: content.length,\n        keptLength: kept.length,\n        droppedLength,\n      },\n    };\n  }\n}\n","/**\n * Summarize Compactor\n *\n * Uses LLM to create intelligent summaries of context components before compaction.\n * This preserves the semantic meaning of content while reducing token count.\n *\n * Supports different summarization strategies based on content type:\n * - Conversation history: Preserves decisions, facts, and preferences\n * - Tool outputs (search/scrape): Preserves key findings, sources, and data\n */\n\nimport type {\n  IContextCompactor,\n  IContextComponent,\n  ITokenEstimator,\n} from '../../../core/context/types.js';\nimport type { ITextProvider } from '../../../domain/interfaces/ITextProvider.js';\n\n/**\n * Configuration for the SummarizeCompactor\n */\nexport interface SummarizeCompactorConfig {\n  /** Text provider for LLM-based summarization */\n  textProvider: ITextProvider;\n\n  /** Model to use for summarization (optional - uses provider default) */\n  model?: string;\n\n  /** Maximum tokens for the summary (default: 500) */\n  maxSummaryTokens?: number;\n\n  /** Preserve markdown structure like headings and lists (default: true) */\n  preserveStructure?: boolean;\n\n  /** Fall back to truncation if LLM summarization fails (default: true) */\n  fallbackToTruncate?: boolean;\n\n  /** Temperature for summarization (default: 0.3 for deterministic output) */\n  temperature?: number;\n}\n\n/**\n * Content type hint for selecting appropriate summarization prompt\n */\nexport type SummarizeContentType =\n  | 'conversation'\n  | 'tool_output'\n  | 'search_results'\n  | 'scrape_results'\n  | 'generic';\n\n/**\n * Summarization prompts for different content types\n */\nconst SUMMARIZATION_PROMPTS: Record<SummarizeContentType, string> = {\n  conversation: `Summarize this conversation history, preserving:\n- Key decisions made by the user or assistant\n- Important facts and data discovered\n- User preferences expressed\n- Unresolved questions or pending items\n- Any errors or issues encountered\n\nFocus on information that would be needed to continue the conversation coherently.\nBe concise but preserve critical context.`,\n\n  tool_output: `Summarize these tool outputs, preserving:\n- Key results and findings from each tool call\n- Important data values (numbers, dates, names, IDs)\n- Error messages or warnings\n- Status information\n- Dependencies or relationships between results\n\nPrioritize factual data over explanatory text.`,\n\n  search_results: `Summarize these search results, preserving:\n- Key findings relevant to the task\n- Source URLs and their main points (keep URLs intact)\n- Factual data (numbers, dates, names, statistics)\n- Contradictions or disagreements between sources\n- Credibility indicators (official sources, recent dates)\n\nFormat as a bulleted list organized by topic or source.`,\n\n  scrape_results: `Summarize this scraped web content, preserving:\n- Main topic and key points\n- Factual data (numbers, dates, names, prices, specifications)\n- Important quotes or statements\n- Source attribution (keep the URL)\n- Any structured data (tables, lists)\n\nDiscard navigation elements, ads, and boilerplate text.`,\n\n  generic: `Summarize this content, preserving:\n- Main points and key information\n- Important data and facts\n- Relationships and dependencies\n- Actionable items\n\nBe concise while retaining critical information.`,\n};\n\n/**\n * SummarizeCompactor - LLM-based context compaction\n *\n * Uses AI to intelligently summarize content, preserving semantic meaning\n * while significantly reducing token count.\n */\nexport class SummarizeCompactor implements IContextCompactor {\n  readonly name = 'summarize';\n  readonly priority = 5; // Run before truncate (10)\n\n  private config: Required<SummarizeCompactorConfig>;\n  private estimator: ITokenEstimator;\n\n  constructor(estimator: ITokenEstimator, config: SummarizeCompactorConfig) {\n    this.estimator = estimator;\n    this.config = {\n      textProvider: config.textProvider,\n      model: config.model ?? '',\n      maxSummaryTokens: config.maxSummaryTokens ?? 500,\n      preserveStructure: config.preserveStructure ?? true,\n      fallbackToTruncate: config.fallbackToTruncate ?? true,\n      temperature: config.temperature ?? 0.3,\n    };\n  }\n\n  /**\n   * Check if this compactor can handle the component\n   */\n  canCompact(component: IContextComponent): boolean {\n    return (\n      component.compactable && component.metadata?.strategy === 'summarize'\n    );\n  }\n\n  /**\n   * Compact the component by summarizing its content\n   */\n  async compact(\n    component: IContextComponent,\n    targetTokens: number\n  ): Promise<IContextComponent> {\n    // Stringify content for processing\n    const contentStr = this.stringifyContent(component.content);\n    const currentTokens = this.estimator.estimateTokens(contentStr);\n\n    // If already small enough, return unchanged\n    if (currentTokens <= targetTokens) {\n      return component;\n    }\n\n    // Determine content type from metadata or component name\n    const contentType = this.detectContentType(component);\n\n    try {\n      // Attempt LLM summarization\n      const summary = await this.summarize(contentStr, contentType, targetTokens);\n\n      // Verify we achieved meaningful reduction\n      const summaryTokens = this.estimator.estimateTokens(summary);\n      if (summaryTokens >= currentTokens * 0.9) {\n        // Less than 10% reduction - fallback to truncation if enabled\n        if (this.config.fallbackToTruncate) {\n          return this.truncateFallback(component, contentStr, targetTokens);\n        }\n      }\n\n      return {\n        ...component,\n        content: summary,\n        metadata: {\n          ...component.metadata,\n          summarized: true,\n          summarizedFrom: currentTokens,\n          summarizedTo: summaryTokens,\n          reductionPercent: Math.round(\n            ((currentTokens - summaryTokens) / currentTokens) * 100\n          ),\n          contentType,\n        },\n      };\n    } catch (error) {\n      // LLM failed - use fallback if configured\n      if (this.config.fallbackToTruncate) {\n        console.warn(\n          `SummarizeCompactor: LLM summarization failed for ${component.name}, falling back to truncation:`,\n          error instanceof Error ? error.message : String(error)\n        );\n        return this.truncateFallback(component, contentStr, targetTokens);\n      }\n\n      // Re-throw if no fallback\n      throw error;\n    }\n  }\n\n  /**\n   * Estimate how many tokens could be saved by summarization\n   */\n  estimateSavings(component: IContextComponent): number {\n    const current = this.estimator.estimateDataTokens(component.content);\n    // Summarization typically achieves 70-85% reduction\n    return Math.floor(current * 0.8);\n  }\n\n  /**\n   * Perform LLM-based summarization\n   */\n  private async summarize(\n    content: string,\n    contentType: SummarizeContentType,\n    targetTokens: number\n  ): Promise<string> {\n    const systemPrompt = SUMMARIZATION_PROMPTS[contentType];\n    const maxSummaryTokens = Math.min(targetTokens, this.config.maxSummaryTokens);\n\n    const structureInstructions = this.config.preserveStructure\n      ? '\\n\\nPreserve formatting structure (headings, bullet points, numbered lists) where appropriate.'\n      : '';\n\n    const prompt = `${systemPrompt}${structureInstructions}\n\nTarget summary length: approximately ${maxSummaryTokens} tokens (${maxSummaryTokens * 4} characters).\n\nContent to summarize:\n---\n${content}\n---\n\nProvide the summary:`;\n\n    const response = await this.config.textProvider.generate({\n      model: this.config.model || 'gpt-4o-mini', // Use a fast, cheap model for summarization\n      input: prompt,\n      temperature: this.config.temperature,\n      max_output_tokens: maxSummaryTokens + 100, // Allow some buffer\n    });\n\n    return response.output_text || content;\n  }\n\n  /**\n   * Fallback to simple truncation when LLM fails\n   */\n  private truncateFallback(\n    component: IContextComponent,\n    contentStr: string,\n    targetTokens: number\n  ): IContextComponent {\n    const targetChars = targetTokens * 4; // ~4 chars per token\n    const truncated =\n      contentStr.substring(0, targetChars) +\n      '\\n\\n[... content truncated due to context limits ...]';\n\n    return {\n      ...component,\n      content: truncated,\n      metadata: {\n        ...component.metadata,\n        truncated: true,\n        truncatedFrom: contentStr.length,\n        truncatedTo: truncated.length,\n        summarizationFailed: true,\n      },\n    };\n  }\n\n  /**\n   * Detect content type from component metadata or name\n   */\n  private detectContentType(component: IContextComponent): SummarizeContentType {\n    // Check metadata first\n    if (component.metadata?.contentType) {\n      return component.metadata.contentType as SummarizeContentType;\n    }\n\n    // Infer from component name\n    const name = component.name.toLowerCase();\n\n    if (\n      name.includes('conversation') ||\n      name.includes('history') ||\n      name.includes('messages')\n    ) {\n      return 'conversation';\n    }\n\n    if (name.includes('search')) {\n      return 'search_results';\n    }\n\n    if (name.includes('scrape') || name.includes('fetch')) {\n      return 'scrape_results';\n    }\n\n    if (name.includes('tool') || name.includes('output')) {\n      return 'tool_output';\n    }\n\n    return 'generic';\n  }\n\n  /**\n   * Convert content to string for processing\n   */\n  private stringifyContent(content: unknown): string {\n    if (typeof content === 'string') {\n      return content;\n    }\n\n    if (Array.isArray(content)) {\n      // Handle message arrays (conversation history)\n      return content\n        .map((item) => {\n          if (typeof item === 'string') return item;\n          if (item && typeof item === 'object') {\n            // Handle message objects with role/content\n            if ('role' in item && 'content' in item) {\n              return `[${item.role}]: ${item.content}`;\n            }\n            // Handle tool output objects\n            if ('tool' in item && 'output' in item) {\n              return `[${item.tool}]: ${JSON.stringify(item.output)}`;\n            }\n          }\n          return JSON.stringify(item);\n        })\n        .join('\\n\\n');\n    }\n\n    // Default to JSON serialization\n    return JSON.stringify(content, null, 2);\n  }\n}\n","/**\n * Memory Eviction Compactor\n *\n * Evicts LRU entries from memory index\n * Works with memory components that have eviction metadata\n */\n\nimport type { IContextCompactor, IContextComponent, ITokenEstimator } from '../../../core/context/types.js';\n\nexport class MemoryEvictionCompactor implements IContextCompactor {\n  readonly name = 'memory-eviction';\n  readonly priority = 8;\n\n  constructor(private estimator: ITokenEstimator) {}\n\n  canCompact(component: IContextComponent): boolean {\n    return (\n      component.compactable &&\n      (component.metadata?.strategy === 'evict' || component.name === 'memory_index')\n    );\n  }\n\n  async compact(component: IContextComponent, targetTokens: number): Promise<IContextComponent> {\n    // If memory component has eviction callback, use it\n    if (component.metadata?.evict && typeof component.metadata.evict === 'function') {\n      const currentTokens = this.estimator.estimateDataTokens(component.content);\n      const tokensToFree = Math.max(0, currentTokens - targetTokens);\n\n      // Estimate how many entries to evict\n      const avgEntrySize = component.metadata.avgEntrySize as number || 100;\n      const entriesToEvict = Math.ceil(tokensToFree / avgEntrySize);\n\n      if (entriesToEvict > 0) {\n        // Call eviction callback\n        await (component.metadata.evict as (count: number) => Promise<void>)(entriesToEvict);\n\n        // Get updated content\n        if (component.metadata.getUpdatedContent && typeof component.metadata.getUpdatedContent === 'function') {\n          const updatedContent = await (component.metadata.getUpdatedContent as () => Promise<unknown>)();\n\n          return {\n            ...component,\n            content: updatedContent,\n            metadata: {\n              ...component.metadata,\n              evicted: true,\n              evictedCount: entriesToEvict,\n            },\n          };\n        }\n      }\n    }\n\n    // If no eviction mechanism, just return unchanged\n    return component;\n  }\n\n  estimateSavings(component: IContextComponent): number {\n    // Estimate based on average entry size\n    const avgEntrySize = component.metadata?.avgEntrySize as number || 100;\n    return avgEntrySize * 2; // Conservative estimate: evict 2 entries\n  }\n}\n","/**\n * Approximate Token Estimator\n *\n * Uses content-type aware heuristics:\n * - Code: ~3 chars/token (more symbols, shorter words)\n * - Prose: ~4 chars/token (natural language)\n * - Mixed: ~3.5 chars/token\n *\n * Fast and good enough for most use cases.\n */\n\nimport type { ITokenEstimator, TokenContentType } from '../../../core/context/types.js';\n\nexport class ApproximateTokenEstimator implements ITokenEstimator {\n  /**\n   * Estimate tokens for text with content-type awareness\n   *\n   * @param text - The text to estimate tokens for\n   * @param contentType - Type of content:\n   *   - 'code': Code is typically denser (~3 chars/token)\n   *   - 'prose': Natural language text (~4 chars/token)\n   *   - 'mixed': Mix of code and prose (~3.5 chars/token)\n   */\n  estimateTokens(text: string, contentType: TokenContentType = 'mixed'): number {\n    if (!text || text.length === 0) {\n      return 0;\n    }\n\n    // Content-type aware estimation\n    const charsPerToken = contentType === 'code' ? 3 : contentType === 'prose' ? 4 : 3.5;\n    return Math.ceil(text.length / charsPerToken);\n  }\n\n  /**\n   * Estimate tokens for structured data (always uses 'mixed' estimation)\n   */\n  estimateDataTokens(data: unknown, contentType: TokenContentType = 'mixed'): number {\n    if (data === null || data === undefined) {\n      return 1;\n    }\n\n    // Serialize and estimate\n    try {\n      const serialized = JSON.stringify(data);\n      return this.estimateTokens(serialized, contentType);\n    } catch {\n      // If serialization fails, return a conservative estimate\n      return 100;\n    }\n  }\n}\n","/**\n * Token estimators\n */\n\nimport type { ITokenEstimator } from '../../../core/context/types.js';\nimport { ApproximateTokenEstimator } from './ApproximateEstimator.js';\n\n/**\n * Create token estimator from name\n */\nexport function createEstimator(name: string): ITokenEstimator {\n  switch (name) {\n    case 'approximate':\n      return new ApproximateTokenEstimator();\n    case 'tiktoken':\n      // TODO: Implement tiktoken-based estimator when needed\n      throw new Error('Tiktoken estimator not yet implemented. Use \"approximate\" for now.');\n    default:\n      throw new Error(`Unknown token estimator: ${name}`);\n  }\n}\n\nexport { ApproximateTokenEstimator };\n","/**\n * IHistoryManager - Interface for conversation history management\n *\n * Follows the same pattern as IMemoryStorage for pluggable implementations.\n * Users can implement this interface to use Redis, PostgreSQL, file storage, etc.\n */\n\nimport { EventEmitter } from 'eventemitter3';\n\n/**\n * A single message in conversation history\n */\nexport interface HistoryMessage {\n  id: string;\n  role: 'user' | 'assistant' | 'system';\n  content: string;\n  timestamp: number;\n  metadata?: Record<string, unknown>;\n}\n\n/**\n * Events emitted by IHistoryManager implementations\n */\nexport interface HistoryManagerEvents {\n  'message:added': { message: HistoryMessage };\n  'message:removed': { messageId: string };\n  'history:cleared': { reason?: string };\n  'history:compacted': { removedCount: number; strategy: string };\n  'history:restored': { messageCount: number };\n}\n\n/**\n * Configuration for history management\n */\nexport interface IHistoryManagerConfig {\n  /** Maximum messages to keep (for sliding window) */\n  maxMessages?: number;\n\n  /** Maximum tokens to keep (estimated) */\n  maxTokens?: number;\n\n  /** Compaction strategy when limits are reached */\n  compactionStrategy?: 'truncate' | 'summarize' | 'sliding-window';\n\n  /** Number of recent messages to always preserve */\n  preserveRecentCount?: number;\n}\n\n/**\n * Serialized history state for persistence\n */\nexport interface SerializedHistoryState {\n  version: number;\n  messages: HistoryMessage[];\n  summaries?: Array<{ content: string; coversCount: number; timestamp: number }>;\n  metadata?: Record<string, unknown>;\n}\n\n/**\n * Interface for history storage backends\n * Implement this to use custom storage (Redis, PostgreSQL, file, etc.)\n */\nexport interface IHistoryStorage {\n  /**\n   * Store a message\n   */\n  addMessage(message: HistoryMessage): Promise<void>;\n\n  /**\n   * Get all messages\n   */\n  getMessages(): Promise<HistoryMessage[]>;\n\n  /**\n   * Get recent N messages\n   */\n  getRecentMessages(count: number): Promise<HistoryMessage[]>;\n\n  /**\n   * Remove a message by ID\n   */\n  removeMessage(id: string): Promise<void>;\n\n  /**\n   * Remove messages older than timestamp\n   */\n  removeOlderThan(timestamp: number): Promise<number>;\n\n  /**\n   * Clear all messages\n   */\n  clear(): Promise<void>;\n\n  /**\n   * Get message count\n   */\n  getCount(): Promise<number>;\n\n  /**\n   * Get serialized state for session persistence\n   */\n  getState(): Promise<SerializedHistoryState>;\n\n  /**\n   * Restore from serialized state\n   */\n  restoreState(state: SerializedHistoryState): Promise<void>;\n}\n\n/**\n * Interface for history manager\n * Manages conversation history with compaction and persistence support\n */\nexport interface IHistoryManager extends EventEmitter<HistoryManagerEvents> {\n  /**\n   * Add a message to history\n   */\n  addMessage(role: 'user' | 'assistant' | 'system', content: string, metadata?: Record<string, unknown>): Promise<HistoryMessage>;\n\n  /**\n   * Get all messages (may include summaries as system messages)\n   */\n  getMessages(): Promise<HistoryMessage[]>;\n\n  /**\n   * Get recent messages only\n   */\n  getRecentMessages(count?: number): Promise<HistoryMessage[]>;\n\n  /**\n   * Get formatted history for LLM context\n   */\n  formatForContext(options?: { maxTokens?: number; includeMetadata?: boolean }): Promise<string>;\n\n  /**\n   * Compact history (apply compaction strategy)\n   */\n  compact(): Promise<void>;\n\n  /**\n   * Clear all history\n   */\n  clear(): Promise<void>;\n\n  /**\n   * Get message count\n   */\n  getMessageCount(): Promise<number>;\n\n  /**\n   * Get state for session persistence\n   */\n  getState(): Promise<SerializedHistoryState>;\n\n  /**\n   * Restore from saved state\n   */\n  restoreState(state: SerializedHistoryState): Promise<void>;\n\n  /**\n   * Get current configuration\n   */\n  getConfig(): IHistoryManagerConfig;\n}\n\n/**\n * Default configuration\n */\nexport const DEFAULT_HISTORY_MANAGER_CONFIG: Required<IHistoryManagerConfig> = {\n  maxMessages: 50,\n  maxTokens: 32000,\n  compactionStrategy: 'sliding-window',\n  preserveRecentCount: 10,\n};\n","/**\n * InMemoryHistoryStorage - In-memory implementation of IHistoryStorage\n *\n * Default storage backend for conversation history.\n * For production, users can implement IHistoryStorage with Redis, PostgreSQL, etc.\n */\n\nimport type {\n  IHistoryStorage,\n  HistoryMessage,\n  SerializedHistoryState,\n} from '../../domain/interfaces/IHistoryManager.js';\n\n/**\n * In-memory history storage implementation\n */\nexport class InMemoryHistoryStorage implements IHistoryStorage {\n  private messages: HistoryMessage[] = [];\n  private summaries: Array<{ content: string; coversCount: number; timestamp: number }> = [];\n\n  async addMessage(message: HistoryMessage): Promise<void> {\n    this.messages.push(message);\n  }\n\n  async getMessages(): Promise<HistoryMessage[]> {\n    return [...this.messages];\n  }\n\n  async getRecentMessages(count: number): Promise<HistoryMessage[]> {\n    return this.messages.slice(-count);\n  }\n\n  async removeMessage(id: string): Promise<void> {\n    const index = this.messages.findIndex(m => m.id === id);\n    if (index >= 0) {\n      this.messages.splice(index, 1);\n    }\n  }\n\n  async removeOlderThan(timestamp: number): Promise<number> {\n    const originalLength = this.messages.length;\n    this.messages = this.messages.filter(m => m.timestamp >= timestamp);\n    return originalLength - this.messages.length;\n  }\n\n  async clear(): Promise<void> {\n    this.messages = [];\n    this.summaries = [];\n  }\n\n  async getCount(): Promise<number> {\n    return this.messages.length;\n  }\n\n  async getState(): Promise<SerializedHistoryState> {\n    return {\n      version: 1,\n      messages: [...this.messages],\n      summaries: [...this.summaries],\n    };\n  }\n\n  async restoreState(state: SerializedHistoryState): Promise<void> {\n    this.messages = [...state.messages];\n    this.summaries = state.summaries ? [...state.summaries] : [];\n  }\n}\n","/**\n * FileContextStorage - File-based storage for AgentContext session persistence\n *\n * Stores context sessions as JSON files on disk.\n * Path: ~/.oneringai/agents/<agentId>/sessions/<sessionId>.json\n * Windows: %APPDATA%/oneringai/agents/<agentId>/sessions/<sessionId>.json\n *\n * Features:\n * - Cross-platform path handling\n * - Safe session ID sanitization\n * - Atomic file operations (write to temp, then rename)\n * - Automatic directory creation\n * - Index file for fast listing\n */\n\nimport { promises as fs } from 'fs';\nimport { join } from 'path';\nimport { homedir } from 'os';\nimport type {\n  IContextStorage,\n  StoredContextSession,\n  ContextSessionSummary,\n  ContextSessionMetadata,\n  ContextStorageListOptions,\n} from '../../domain/interfaces/IContextStorage.js';\nimport { CONTEXT_SESSION_FORMAT_VERSION } from '../../domain/interfaces/IContextStorage.js';\nimport type { SerializedAgentContextState } from '../../core/AgentContext.js';\n\n/**\n * Configuration for FileContextStorage\n */\nexport interface FileContextStorageConfig {\n  /** Agent ID (used to create unique storage path) */\n  agentId: string;\n  /** Override the base directory (default: ~/.oneringai/agents) */\n  baseDirectory?: string;\n  /** Pretty-print JSON (default: true for debugging, false in production) */\n  prettyPrint?: boolean;\n}\n\n/**\n * Index entry for fast listing\n */\ninterface SessionIndexEntry {\n  sessionId: string;\n  createdAt: string;\n  lastSavedAt: string;\n  messageCount: number;\n  memoryEntryCount: number;\n  metadata: ContextSessionMetadata;\n}\n\n/**\n * Index file structure\n */\ninterface SessionIndex {\n  version: number;\n  agentId: string;\n  sessions: SessionIndexEntry[];\n  lastUpdated: string;\n}\n\n/**\n * Get the default base directory for agent storage\n * Uses ~/.oneringai/agents on Unix-like systems\n * Uses %APPDATA%/oneringai/agents on Windows\n */\nfunction getDefaultBaseDirectory(): string {\n  const platform = process.platform;\n\n  if (platform === 'win32') {\n    // Windows: Use APPDATA if available, otherwise fall back to home\n    const appData = process.env.APPDATA || process.env.LOCALAPPDATA;\n    if (appData) {\n      return join(appData, 'oneringai', 'agents');\n    }\n  }\n\n  // Unix-like (Linux, macOS) and fallback: Use home directory\n  return join(homedir(), '.oneringai', 'agents');\n}\n\n/**\n * Sanitize ID for use as a directory/file name\n * Removes or replaces characters that are not safe for filenames\n */\nfunction sanitizeId(id: string): string {\n  return id\n    .replace(/[^a-zA-Z0-9_-]/g, '_')  // Replace unsafe chars with underscore\n    .replace(/_+/g, '_')               // Collapse multiple underscores\n    .replace(/^_|_$/g, '')             // Remove leading/trailing underscores\n    .toLowerCase()                      // Normalize to lowercase\n    || 'default';                       // Fallback if empty\n}\n\n/**\n * Current format version (imported from interface)\n */\nconst FORMAT_VERSION = CONTEXT_SESSION_FORMAT_VERSION;\n\n/**\n * File-based storage for AgentContext session persistence\n */\nexport class FileContextStorage implements IContextStorage {\n  private readonly agentId: string;\n  private readonly sessionsDirectory: string;\n  private readonly indexPath: string;\n  private readonly prettyPrint: boolean;\n  private index: SessionIndex | null = null;\n\n  constructor(config: FileContextStorageConfig) {\n    this.agentId = config.agentId;\n    const sanitizedAgentId = sanitizeId(config.agentId);\n    const baseDir = config.baseDirectory ?? getDefaultBaseDirectory();\n    this.prettyPrint = config.prettyPrint ?? true;\n\n    // Sessions are stored in: <baseDir>/<agentId>/sessions/\n    this.sessionsDirectory = join(baseDir, sanitizedAgentId, 'sessions');\n    this.indexPath = join(this.sessionsDirectory, '_index.json');\n  }\n\n  /**\n   * Save context state to a session file\n   */\n  async save(\n    sessionId: string,\n    state: SerializedAgentContextState,\n    metadata?: ContextSessionMetadata\n  ): Promise<void> {\n    await this.ensureDirectory();\n\n    const now = new Date().toISOString();\n    const sanitizedSessionId = sanitizeId(sessionId);\n    const filePath = this.getFilePath(sanitizedSessionId);\n\n    // Check if session exists to preserve createdAt\n    let createdAt = now;\n    const existing = await this.loadRaw(sanitizedSessionId);\n    if (existing) {\n      createdAt = existing.createdAt;\n    }\n\n    // Build stored session\n    const storedSession: StoredContextSession = {\n      version: FORMAT_VERSION,\n      sessionId,\n      createdAt,\n      lastSavedAt: now,\n      state,\n      metadata: metadata ?? {},\n    };\n\n    // Write atomically: write to temp file, then rename\n    const data = this.prettyPrint\n      ? JSON.stringify(storedSession, null, 2)\n      : JSON.stringify(storedSession);\n\n    const tempPath = `${filePath}.tmp`;\n    try {\n      await fs.writeFile(tempPath, data, 'utf-8');\n      await fs.rename(tempPath, filePath);\n    } catch (error) {\n      // Clean up temp file if rename failed\n      try {\n        await fs.unlink(tempPath);\n      } catch {\n        // Ignore cleanup errors\n      }\n      throw error;\n    }\n\n    // Update index\n    await this.updateIndex(storedSession);\n  }\n\n  /**\n   * Load context state from a session file\n   */\n  async load(sessionId: string): Promise<StoredContextSession | null> {\n    const sanitizedSessionId = sanitizeId(sessionId);\n    return this.loadRaw(sanitizedSessionId);\n  }\n\n  /**\n   * Delete a session\n   */\n  async delete(sessionId: string): Promise<void> {\n    const sanitizedSessionId = sanitizeId(sessionId);\n    const filePath = this.getFilePath(sanitizedSessionId);\n\n    try {\n      await fs.unlink(filePath);\n    } catch (error: unknown) {\n      if (error instanceof Error && 'code' in error && (error as NodeJS.ErrnoException).code !== 'ENOENT') {\n        throw error;\n      }\n      // Ignore if file doesn't exist\n    }\n\n    // Remove from index\n    await this.removeFromIndex(sessionId);\n  }\n\n  /**\n   * Check if a session exists\n   */\n  async exists(sessionId: string): Promise<boolean> {\n    const sanitizedSessionId = sanitizeId(sessionId);\n    const filePath = this.getFilePath(sanitizedSessionId);\n\n    try {\n      await fs.access(filePath);\n      return true;\n    } catch {\n      return false;\n    }\n  }\n\n  /**\n   * List all sessions (summaries only)\n   */\n  async list(options?: ContextStorageListOptions): Promise<ContextSessionSummary[]> {\n    const index = await this.loadIndex();\n    let entries = [...index.sessions];\n\n    // Apply filters\n    if (options?.tags && options.tags.length > 0) {\n      entries = entries.filter(e => {\n        const entryTags = e.metadata.tags ?? [];\n        return options.tags!.some(t => entryTags.includes(t));\n      });\n    }\n\n    if (options?.createdAfter) {\n      const after = options.createdAfter.getTime();\n      entries = entries.filter(e => new Date(e.createdAt).getTime() >= after);\n    }\n\n    if (options?.createdBefore) {\n      const before = options.createdBefore.getTime();\n      entries = entries.filter(e => new Date(e.createdAt).getTime() <= before);\n    }\n\n    if (options?.savedAfter) {\n      const after = options.savedAfter.getTime();\n      entries = entries.filter(e => new Date(e.lastSavedAt).getTime() >= after);\n    }\n\n    if (options?.savedBefore) {\n      const before = options.savedBefore.getTime();\n      entries = entries.filter(e => new Date(e.lastSavedAt).getTime() <= before);\n    }\n\n    // Sort by lastSavedAt descending (most recent first)\n    entries.sort((a, b) =>\n      new Date(b.lastSavedAt).getTime() - new Date(a.lastSavedAt).getTime()\n    );\n\n    // Apply pagination\n    if (options?.offset) {\n      entries = entries.slice(options.offset);\n    }\n    if (options?.limit) {\n      entries = entries.slice(0, options.limit);\n    }\n\n    // Convert to summaries\n    return entries.map(e => ({\n      sessionId: e.sessionId,\n      createdAt: new Date(e.createdAt),\n      lastSavedAt: new Date(e.lastSavedAt),\n      messageCount: e.messageCount,\n      memoryEntryCount: e.memoryEntryCount,\n      metadata: e.metadata,\n    }));\n  }\n\n  /**\n   * Update session metadata without loading full state\n   */\n  async updateMetadata(\n    sessionId: string,\n    metadata: Partial<ContextSessionMetadata>\n  ): Promise<void> {\n    const stored = await this.load(sessionId);\n    if (!stored) {\n      throw new Error(`Session '${sessionId}' not found`);\n    }\n\n    // Merge metadata\n    stored.metadata = { ...stored.metadata, ...metadata };\n    stored.lastSavedAt = new Date().toISOString();\n\n    // Save back\n    const sanitizedSessionId = sanitizeId(sessionId);\n    const filePath = this.getFilePath(sanitizedSessionId);\n    const data = this.prettyPrint\n      ? JSON.stringify(stored, null, 2)\n      : JSON.stringify(stored);\n\n    await fs.writeFile(filePath, data, 'utf-8');\n\n    // Update index\n    await this.updateIndex(stored);\n  }\n\n  /**\n   * Get the storage path (for display/debugging)\n   */\n  getPath(): string {\n    return this.sessionsDirectory;\n  }\n\n  /**\n   * Get the agent ID\n   */\n  getAgentId(): string {\n    return this.agentId;\n  }\n\n  /**\n   * Rebuild the index by scanning all session files\n   * Useful for recovery or migration\n   */\n  async rebuildIndex(): Promise<void> {\n    await this.ensureDirectory();\n\n    const files = await fs.readdir(this.sessionsDirectory);\n    const sessionFiles = files.filter(f => f.endsWith('.json') && !f.startsWith('_'));\n\n    const entries: SessionIndexEntry[] = [];\n\n    for (const file of sessionFiles) {\n      try {\n        const filePath = join(this.sessionsDirectory, file);\n        const data = await fs.readFile(filePath, 'utf-8');\n        const stored = JSON.parse(data) as StoredContextSession;\n        entries.push(this.storedToIndexEntry(stored));\n      } catch {\n        // Skip invalid files\n      }\n    }\n\n    this.index = {\n      version: 1,\n      agentId: this.agentId,\n      sessions: entries,\n      lastUpdated: new Date().toISOString(),\n    };\n\n    await this.saveIndex();\n  }\n\n  // ==========================================================================\n  // Private Helpers\n  // ==========================================================================\n\n  private getFilePath(sanitizedSessionId: string): string {\n    return join(this.sessionsDirectory, `${sanitizedSessionId}.json`);\n  }\n\n  private async ensureDirectory(): Promise<void> {\n    try {\n      await fs.mkdir(this.sessionsDirectory, { recursive: true });\n    } catch (error: unknown) {\n      if (error instanceof Error && 'code' in error && (error as NodeJS.ErrnoException).code !== 'EEXIST') {\n        throw error;\n      }\n    }\n  }\n\n  private async loadRaw(sanitizedSessionId: string): Promise<StoredContextSession | null> {\n    const filePath = this.getFilePath(sanitizedSessionId);\n\n    try {\n      const data = await fs.readFile(filePath, 'utf-8');\n      return JSON.parse(data) as StoredContextSession;\n    } catch (error: unknown) {\n      if (error instanceof Error && 'code' in error && (error as NodeJS.ErrnoException).code === 'ENOENT') {\n        return null;\n      }\n      // Handle corrupted JSON files gracefully\n      if (error instanceof SyntaxError) {\n        console.warn(`Corrupted session file: ${filePath}`);\n        return null;\n      }\n      throw error;\n    }\n  }\n\n  private async loadIndex(): Promise<SessionIndex> {\n    if (this.index) {\n      return this.index;\n    }\n\n    try {\n      const data = await fs.readFile(this.indexPath, 'utf-8');\n      this.index = JSON.parse(data) as SessionIndex;\n      return this.index;\n    } catch (error: unknown) {\n      if (error instanceof Error && 'code' in error && (error as NodeJS.ErrnoException).code === 'ENOENT') {\n        // No index yet, create empty one\n        this.index = {\n          version: 1,\n          agentId: this.agentId,\n          sessions: [],\n          lastUpdated: new Date().toISOString(),\n        };\n        return this.index;\n      }\n      throw error;\n    }\n  }\n\n  private async saveIndex(): Promise<void> {\n    if (!this.index) return;\n\n    await this.ensureDirectory();\n    this.index.lastUpdated = new Date().toISOString();\n    const data = this.prettyPrint\n      ? JSON.stringify(this.index, null, 2)\n      : JSON.stringify(this.index);\n\n    await fs.writeFile(this.indexPath, data, 'utf-8');\n  }\n\n  private async updateIndex(stored: StoredContextSession): Promise<void> {\n    const index = await this.loadIndex();\n    const entry = this.storedToIndexEntry(stored);\n\n    const existingIdx = index.sessions.findIndex(e => e.sessionId === stored.sessionId);\n    if (existingIdx >= 0) {\n      index.sessions[existingIdx] = entry;\n    } else {\n      index.sessions.push(entry);\n    }\n\n    await this.saveIndex();\n  }\n\n  private async removeFromIndex(sessionId: string): Promise<void> {\n    const index = await this.loadIndex();\n    index.sessions = index.sessions.filter(e => e.sessionId !== sessionId);\n    await this.saveIndex();\n  }\n\n  private storedToIndexEntry(stored: StoredContextSession): SessionIndexEntry {\n    return {\n      sessionId: stored.sessionId,\n      createdAt: stored.createdAt,\n      lastSavedAt: stored.lastSavedAt,\n      messageCount: stored.state.core?.history?.length ?? 0,\n      memoryEntryCount: stored.state.memory?.entries?.length ?? 0,\n      metadata: stored.metadata,\n    };\n  }\n}\n\n/**\n * Create a FileContextStorage for the given agent\n *\n * @param agentId - Agent ID\n * @param options - Optional configuration\n * @returns FileContextStorage instance\n *\n * @example\n * ```typescript\n * const storage = createFileContextStorage('my-agent');\n * const ctx = AgentContext.create({\n *   model: 'gpt-4',\n *   storage,\n * });\n *\n * // Save session\n * await ctx.save('session-001', { title: 'My Session' });\n *\n * // Load session\n * await ctx.load('session-001');\n * ```\n */\nexport function createFileContextStorage(\n  agentId: string,\n  options?: Omit<FileContextStorageConfig, 'agentId'>\n): FileContextStorage {\n  return new FileContextStorage({ agentId, ...options });\n}\n","/**\n * FileAgentDefinitionStorage - File-based storage for agent definitions\n *\n * Stores agent definitions as JSON files on disk.\n * Path: ~/.oneringai/agents/<agentId>/definition.json\n * Windows: %APPDATA%/oneringai/agents/<agentId>/definition.json\n *\n * Features:\n * - Cross-platform path handling\n * - Safe agent ID sanitization\n * - Atomic file operations\n * - Automatic directory creation\n * - Index file for fast listing\n */\n\nimport { promises as fs } from 'fs';\nimport { join } from 'path';\nimport { homedir } from 'os';\nimport type {\n  IAgentDefinitionStorage,\n  StoredAgentDefinition,\n  AgentDefinitionSummary,\n  AgentDefinitionMetadata,\n  AgentDefinitionListOptions,\n} from '../../domain/interfaces/IAgentDefinitionStorage.js';\nimport { AGENT_DEFINITION_FORMAT_VERSION } from '../../domain/interfaces/IAgentDefinitionStorage.js';\n\n/**\n * Configuration for FileAgentDefinitionStorage\n */\nexport interface FileAgentDefinitionStorageConfig {\n  /** Override the base directory (default: ~/.oneringai/agents) */\n  baseDirectory?: string;\n  /** Pretty-print JSON (default: true) */\n  prettyPrint?: boolean;\n}\n\n/**\n * Index entry for fast listing\n */\ninterface DefinitionIndexEntry {\n  agentId: string;\n  name: string;\n  agentType: string;\n  model: string;\n  createdAt: string;\n  updatedAt: string;\n  metadata?: AgentDefinitionMetadata;\n}\n\n/**\n * Index file structure\n */\ninterface DefinitionIndex {\n  version: number;\n  agents: DefinitionIndexEntry[];\n  lastUpdated: string;\n}\n\n/**\n * Get the default base directory for agent storage\n */\nfunction getDefaultBaseDirectory(): string {\n  const platform = process.platform;\n\n  if (platform === 'win32') {\n    const appData = process.env.APPDATA || process.env.LOCALAPPDATA;\n    if (appData) {\n      return join(appData, 'oneringai', 'agents');\n    }\n  }\n\n  return join(homedir(), '.oneringai', 'agents');\n}\n\n/**\n * Sanitize agent ID for use as a directory name\n */\nfunction sanitizeAgentId(agentId: string): string {\n  return agentId\n    .replace(/[^a-zA-Z0-9_-]/g, '_')\n    .replace(/_+/g, '_')\n    .replace(/^_|_$/g, '')\n    .toLowerCase()\n    || 'default';\n}\n\n/**\n * File-based storage for agent definitions\n */\nexport class FileAgentDefinitionStorage implements IAgentDefinitionStorage {\n  private readonly baseDirectory: string;\n  private readonly indexPath: string;\n  private readonly prettyPrint: boolean;\n  private index: DefinitionIndex | null = null;\n\n  constructor(config: FileAgentDefinitionStorageConfig = {}) {\n    this.baseDirectory = config.baseDirectory ?? getDefaultBaseDirectory();\n    this.prettyPrint = config.prettyPrint ?? true;\n    this.indexPath = join(this.baseDirectory, '_agents_index.json');\n  }\n\n  /**\n   * Save an agent definition\n   */\n  async save(definition: StoredAgentDefinition): Promise<void> {\n    const sanitizedId = sanitizeAgentId(definition.agentId);\n    const agentDir = join(this.baseDirectory, sanitizedId);\n    const filePath = join(agentDir, 'definition.json');\n\n    // Ensure directory exists\n    await this.ensureDirectory(agentDir);\n\n    // Update timestamps\n    const now = new Date().toISOString();\n    if (!definition.createdAt) {\n      // Check if existing definition exists to preserve createdAt\n      const existing = await this.loadRaw(sanitizedId);\n      definition.createdAt = existing?.createdAt ?? now;\n    }\n    definition.updatedAt = now;\n    definition.version = AGENT_DEFINITION_FORMAT_VERSION;\n\n    // Write atomically\n    const data = this.prettyPrint\n      ? JSON.stringify(definition, null, 2)\n      : JSON.stringify(definition);\n\n    const tempPath = `${filePath}.tmp`;\n    try {\n      await fs.writeFile(tempPath, data, 'utf-8');\n      await fs.rename(tempPath, filePath);\n    } catch (error) {\n      try {\n        await fs.unlink(tempPath);\n      } catch {\n        // Ignore cleanup errors\n      }\n      throw error;\n    }\n\n    // Update index\n    await this.updateIndex(definition);\n  }\n\n  /**\n   * Load an agent definition\n   */\n  async load(agentId: string): Promise<StoredAgentDefinition | null> {\n    const sanitizedId = sanitizeAgentId(agentId);\n    return this.loadRaw(sanitizedId);\n  }\n\n  /**\n   * Delete an agent definition\n   */\n  async delete(agentId: string): Promise<void> {\n    const sanitizedId = sanitizeAgentId(agentId);\n    const agentDir = join(this.baseDirectory, sanitizedId);\n    const filePath = join(agentDir, 'definition.json');\n\n    try {\n      await fs.unlink(filePath);\n    } catch (error: unknown) {\n      if (error instanceof Error && 'code' in error && (error as NodeJS.ErrnoException).code !== 'ENOENT') {\n        throw error;\n      }\n    }\n\n    // Remove from index\n    await this.removeFromIndex(agentId);\n  }\n\n  /**\n   * Check if an agent definition exists\n   */\n  async exists(agentId: string): Promise<boolean> {\n    const sanitizedId = sanitizeAgentId(agentId);\n    const filePath = join(this.baseDirectory, sanitizedId, 'definition.json');\n\n    try {\n      await fs.access(filePath);\n      return true;\n    } catch {\n      return false;\n    }\n  }\n\n  /**\n   * List all agent definitions\n   */\n  async list(options?: AgentDefinitionListOptions): Promise<AgentDefinitionSummary[]> {\n    const index = await this.loadIndex();\n    let entries = [...index.agents];\n\n    // Apply filters\n    if (options?.agentType) {\n      entries = entries.filter(e => e.agentType === options.agentType);\n    }\n\n    if (options?.tags && options.tags.length > 0) {\n      entries = entries.filter(e => {\n        const entryTags = e.metadata?.tags ?? [];\n        return options.tags!.some(t => entryTags.includes(t));\n      });\n    }\n\n    // Sort by updatedAt descending\n    entries.sort((a, b) =>\n      new Date(b.updatedAt).getTime() - new Date(a.updatedAt).getTime()\n    );\n\n    // Apply pagination\n    if (options?.offset) {\n      entries = entries.slice(options.offset);\n    }\n    if (options?.limit) {\n      entries = entries.slice(0, options.limit);\n    }\n\n    // Convert to summaries\n    return entries.map(e => ({\n      agentId: e.agentId,\n      name: e.name,\n      agentType: e.agentType,\n      model: e.model,\n      createdAt: new Date(e.createdAt),\n      updatedAt: new Date(e.updatedAt),\n      metadata: e.metadata,\n    }));\n  }\n\n  /**\n   * Update metadata without loading full definition\n   */\n  async updateMetadata(\n    agentId: string,\n    metadata: Partial<AgentDefinitionMetadata>\n  ): Promise<void> {\n    const definition = await this.load(agentId);\n    if (!definition) {\n      throw new Error(`Agent '${agentId}' not found`);\n    }\n\n    definition.metadata = { ...definition.metadata, ...metadata };\n    await this.save(definition);\n  }\n\n  /**\n   * Get storage path\n   */\n  getPath(): string {\n    return this.baseDirectory;\n  }\n\n  /**\n   * Rebuild the index by scanning all agent directories\n   */\n  async rebuildIndex(): Promise<void> {\n    await this.ensureDirectory(this.baseDirectory);\n\n    const entries = await fs.readdir(this.baseDirectory, { withFileTypes: true });\n    const agentDirs = entries.filter(e => e.isDirectory() && !e.name.startsWith('_'));\n\n    const indexEntries: DefinitionIndexEntry[] = [];\n\n    for (const dir of agentDirs) {\n      try {\n        const filePath = join(this.baseDirectory, dir.name, 'definition.json');\n        const data = await fs.readFile(filePath, 'utf-8');\n        const definition = JSON.parse(data) as StoredAgentDefinition;\n        indexEntries.push(this.definitionToIndexEntry(definition));\n      } catch {\n        // Skip invalid directories\n      }\n    }\n\n    this.index = {\n      version: 1,\n      agents: indexEntries,\n      lastUpdated: new Date().toISOString(),\n    };\n\n    await this.saveIndex();\n  }\n\n  // ==========================================================================\n  // Private Helpers\n  // ==========================================================================\n\n  private async ensureDirectory(dir: string): Promise<void> {\n    try {\n      await fs.mkdir(dir, { recursive: true });\n    } catch (error: unknown) {\n      if (error instanceof Error && 'code' in error && (error as NodeJS.ErrnoException).code !== 'EEXIST') {\n        throw error;\n      }\n    }\n  }\n\n  private async loadRaw(sanitizedId: string): Promise<StoredAgentDefinition | null> {\n    const filePath = join(this.baseDirectory, sanitizedId, 'definition.json');\n\n    try {\n      const data = await fs.readFile(filePath, 'utf-8');\n      return JSON.parse(data) as StoredAgentDefinition;\n    } catch (error: unknown) {\n      if (error instanceof Error && 'code' in error && (error as NodeJS.ErrnoException).code === 'ENOENT') {\n        return null;\n      }\n      if (error instanceof SyntaxError) {\n        console.warn(`Corrupted agent definition: ${filePath}`);\n        return null;\n      }\n      throw error;\n    }\n  }\n\n  private async loadIndex(): Promise<DefinitionIndex> {\n    if (this.index) {\n      return this.index;\n    }\n\n    try {\n      const data = await fs.readFile(this.indexPath, 'utf-8');\n      this.index = JSON.parse(data) as DefinitionIndex;\n      return this.index;\n    } catch (error: unknown) {\n      if (error instanceof Error && 'code' in error && (error as NodeJS.ErrnoException).code === 'ENOENT') {\n        this.index = {\n          version: 1,\n          agents: [],\n          lastUpdated: new Date().toISOString(),\n        };\n        return this.index;\n      }\n      throw error;\n    }\n  }\n\n  private async saveIndex(): Promise<void> {\n    if (!this.index) return;\n\n    await this.ensureDirectory(this.baseDirectory);\n    this.index.lastUpdated = new Date().toISOString();\n    const data = this.prettyPrint\n      ? JSON.stringify(this.index, null, 2)\n      : JSON.stringify(this.index);\n\n    await fs.writeFile(this.indexPath, data, 'utf-8');\n  }\n\n  private async updateIndex(definition: StoredAgentDefinition): Promise<void> {\n    const index = await this.loadIndex();\n    const entry = this.definitionToIndexEntry(definition);\n\n    const existingIdx = index.agents.findIndex(e => e.agentId === definition.agentId);\n    if (existingIdx >= 0) {\n      index.agents[existingIdx] = entry;\n    } else {\n      index.agents.push(entry);\n    }\n\n    await this.saveIndex();\n  }\n\n  private async removeFromIndex(agentId: string): Promise<void> {\n    const index = await this.loadIndex();\n    index.agents = index.agents.filter(e => e.agentId !== agentId);\n    await this.saveIndex();\n  }\n\n  private definitionToIndexEntry(definition: StoredAgentDefinition): DefinitionIndexEntry {\n    return {\n      agentId: definition.agentId,\n      name: definition.name,\n      agentType: definition.agentType,\n      model: definition.connector.model,\n      createdAt: definition.createdAt,\n      updatedAt: definition.updatedAt,\n      metadata: definition.metadata,\n    };\n  }\n}\n\n/**\n * Create a FileAgentDefinitionStorage with default configuration\n */\nexport function createFileAgentDefinitionStorage(\n  config?: FileAgentDefinitionStorageConfig\n): FileAgentDefinitionStorage {\n  return new FileAgentDefinitionStorage(config);\n}\n","/**\n * Stream helper utilities for consuming and processing streaming events\n */\n\nimport {\n  StreamEvent,\n  StreamEventType,\n  isOutputTextDelta,\n} from '../../domain/entities/StreamEvent.js';\nimport { StreamState } from '../../domain/entities/StreamState.js';\nimport { LLMResponse, OutputItem } from '../../domain/entities/Response.js';\nimport { MessageRole } from '../../domain/entities/Message.js';\nimport { ContentType } from '../../domain/entities/Content.js';\n\n/**\n * Helper class for consuming and processing streams\n */\nexport class StreamHelpers {\n  /**\n   * Collect complete response from stream\n   * Accumulates all events and reconstructs final LLMResponse\n   */\n  static async collectResponse(\n    stream: AsyncIterableIterator<StreamEvent>\n  ): Promise<LLMResponse> {\n    let state: StreamState | null = null;\n\n    for await (const event of stream) {\n      // Initialize state on first event\n      if (!state && event.type === StreamEventType.RESPONSE_CREATED) {\n        state = new StreamState(event.response_id, event.model, event.created_at);\n      }\n\n      if (!state) continue;\n\n      // Update state from events\n      this.updateStateFromEvent(state, event);\n    }\n\n    if (!state) {\n      throw new Error('No stream events received');\n    }\n\n    return this.reconstructLLMResponse(state);\n  }\n\n  /**\n   * Get only text deltas from stream (for simple text streaming)\n   * Filters out all other event types\n   */\n  static async *textOnly(\n    stream: AsyncIterableIterator<StreamEvent>\n  ): AsyncIterableIterator<string> {\n    for await (const event of stream) {\n      if (isOutputTextDelta(event)) {\n        yield event.delta;\n      }\n    }\n  }\n\n  /**\n   * Filter stream events by type\n   */\n  static async *filterByType<T extends StreamEvent>(\n    stream: AsyncIterableIterator<StreamEvent>,\n    eventType: StreamEventType\n  ): AsyncIterableIterator<T> {\n    for await (const event of stream) {\n      if (event.type === eventType) {\n        yield event as T;\n      }\n    }\n  }\n\n  /**\n   * Accumulate text from stream into a single string\n   */\n  static async accumulateText(\n    stream: AsyncIterableIterator<StreamEvent>\n  ): Promise<string> {\n    const chunks: string[] = [];\n\n    for await (const event of stream) {\n      if (isOutputTextDelta(event)) {\n        chunks.push(event.delta);\n      }\n    }\n\n    return chunks.join('');\n  }\n\n  /**\n   * Buffer stream events into batches\n   */\n  static async *bufferEvents(\n    stream: AsyncIterableIterator<StreamEvent>,\n    batchSize: number\n  ): AsyncIterableIterator<StreamEvent[]> {\n    let buffer: StreamEvent[] = [];\n\n    for await (const event of stream) {\n      buffer.push(event);\n\n      if (buffer.length >= batchSize) {\n        yield buffer;\n        buffer = [];\n      }\n    }\n\n    // Yield remaining events\n    if (buffer.length > 0) {\n      yield buffer;\n    }\n  }\n\n  /**\n   * Tap into stream without consuming it\n   * Useful for logging or side effects\n   */\n  static async *tap(\n    stream: AsyncIterableIterator<StreamEvent>,\n    callback: (event: StreamEvent) => void | Promise<void>\n  ): AsyncIterableIterator<StreamEvent> {\n    for await (const event of stream) {\n      await callback(event);\n      yield event;\n    }\n  }\n\n  /**\n   * Take first N events from stream\n   */\n  static async *take(\n    stream: AsyncIterableIterator<StreamEvent>,\n    count: number\n  ): AsyncIterableIterator<StreamEvent> {\n    let taken = 0;\n\n    for await (const event of stream) {\n      if (taken >= count) break;\n      yield event;\n      taken++;\n    }\n  }\n\n  /**\n   * Skip first N events from stream\n   */\n  static async *skip(\n    stream: AsyncIterableIterator<StreamEvent>,\n    count: number\n  ): AsyncIterableIterator<StreamEvent> {\n    let skipped = 0;\n\n    for await (const event of stream) {\n      if (skipped < count) {\n        skipped++;\n        continue;\n      }\n      yield event;\n    }\n  }\n\n  /**\n   * Update StreamState from event\n   * @private\n   */\n  private static updateStateFromEvent(state: StreamState, event: StreamEvent): void {\n    switch (event.type) {\n      case StreamEventType.OUTPUT_TEXT_DELTA:\n        state.accumulateTextDelta(event.item_id, event.delta);\n        break;\n\n      case StreamEventType.TOOL_CALL_START:\n        state.startToolCall(event.tool_call_id, event.tool_name);\n        break;\n\n      case StreamEventType.TOOL_CALL_ARGUMENTS_DELTA:\n        state.accumulateToolArguments(event.tool_call_id, event.delta);\n        break;\n\n      case StreamEventType.TOOL_CALL_ARGUMENTS_DONE:\n        state.completeToolCall(event.tool_call_id);\n        break;\n\n      case StreamEventType.TOOL_EXECUTION_DONE:\n        state.setToolResult(event.tool_call_id, event.result);\n        break;\n\n      case StreamEventType.ITERATION_COMPLETE:\n        state.incrementIteration();\n        break;\n\n      case StreamEventType.RESPONSE_COMPLETE:\n        // Debug: Log usage when received\n        if (process.env.DEBUG_STREAMING) {\n          console.error('[DEBUG] RESPONSE_COMPLETE event:', event.usage);\n        }\n        state.updateUsage(event.usage);\n        state.markComplete(event.status);\n        break;\n    }\n  }\n\n  /**\n   * Reconstruct LLMResponse from StreamState\n   * @private\n   */\n  private static reconstructLLMResponse(state: StreamState): LLMResponse {\n    const output: OutputItem[] = [];\n\n    // Add text messages\n    if (state.hasText()) {\n      const textContent = state.getAllText();\n      if (textContent) {\n        output.push({\n          type: 'message' as const,\n          role: MessageRole.ASSISTANT,\n          content: [\n            {\n              type: ContentType.OUTPUT_TEXT,\n              text: textContent,\n            },\n          ],\n        });\n      }\n    }\n\n    // Add tool calls to output\n    const toolCalls = state.getCompletedToolCalls();\n    if (toolCalls.length > 0) {\n      // Tool calls should be part of assistant message content\n      const toolUseContent = toolCalls.map((tc) => ({\n        type: ContentType.TOOL_USE as const,\n        id: tc.id,\n        name: tc.function.name,\n        arguments: tc.function.arguments,\n      }));\n\n      const firstOutput = output[0];\n      if (firstOutput && firstOutput.type === 'message') {\n        // Append to existing message\n        firstOutput.content.push(...toolUseContent);\n      } else {\n        // Create new message with tool calls\n        output.push({\n          type: 'message' as const,\n          role: MessageRole.ASSISTANT,\n          content: toolUseContent,\n        });\n      }\n    }\n\n    // Extract output text\n    const outputText = this.extractOutputText(output);\n\n    return {\n      id: state.responseId,\n      object: 'response',\n      created_at: state.createdAt,\n      status: state.status,\n      model: state.model,\n      output,\n      output_text: outputText,\n      usage: state.usage,\n    };\n  }\n\n  /**\n   * Extract text from output items\n   * @private\n   */\n  private static extractOutputText(output: OutputItem[]): string {\n    const texts: string[] = [];\n\n    for (const item of output) {\n      if (item.type === 'message') {\n        for (const content of item.content) {\n          if (content.type === ContentType.OUTPUT_TEXT) {\n            texts.push(content.text);\n          }\n        }\n      }\n    }\n\n    return texts.join(' ').trim();\n  }\n}\n","/**\n * Unified error mapper for all providers\n * Converts provider-specific errors to our standard error types\n */\n\nimport {\n  AIError,\n  ProviderAuthError,\n  ProviderRateLimitError,\n  ProviderContextLengthError,\n  ProviderError,\n} from '../../../domain/errors/AIErrors.js';\n\nexport interface ProviderErrorContext {\n  providerName: string;\n  maxContextTokens?: number;\n}\n\n/**\n * Maps provider-specific errors to our unified error types\n */\nexport class ProviderErrorMapper {\n  /**\n   * Map any provider error to our standard error types\n   */\n  static mapError(error: any, context: ProviderErrorContext): AIError {\n    const { providerName, maxContextTokens = 128000 } = context;\n\n    // Already our error type - return as-is\n    if (error instanceof AIError) {\n      return error;\n    }\n\n    // Extract error details\n    const status = error.status || error.statusCode || error.code;\n    const message = error.message || String(error);\n    const messageLower = message.toLowerCase();\n\n    // Auth errors (401, 403, or message indicators)\n    if (\n      status === 401 ||\n      status === 403 ||\n      messageLower.includes('api key') ||\n      messageLower.includes('api_key') ||\n      messageLower.includes('authentication') ||\n      messageLower.includes('unauthorized') ||\n      messageLower.includes('invalid key') ||\n      messageLower.includes('permission denied')\n    ) {\n      return new ProviderAuthError(providerName, message);\n    }\n\n    // Rate limit errors (429 or message indicators)\n    if (\n      status === 429 ||\n      messageLower.includes('rate limit') ||\n      messageLower.includes('rate_limit') ||\n      messageLower.includes('too many requests') ||\n      messageLower.includes('resource exhausted') ||\n      messageLower.includes('quota exceeded')\n    ) {\n      const retryAfter = this.extractRetryAfter(error);\n      return new ProviderRateLimitError(providerName, retryAfter);\n    }\n\n    // Context length errors (413 or message indicators)\n    if (\n      status === 413 ||\n      error.code === 'context_length_exceeded' ||\n      messageLower.includes('context length') ||\n      messageLower.includes('context_length') ||\n      messageLower.includes('token limit') ||\n      messageLower.includes('too long') ||\n      messageLower.includes('maximum context') ||\n      messageLower.includes('max_tokens') ||\n      messageLower.includes('prompt is too long')\n    ) {\n      return new ProviderContextLengthError(providerName, maxContextTokens);\n    }\n\n    // Generic provider error for everything else\n    return new ProviderError(providerName, message, status, error);\n  }\n\n  /**\n   * Extract retry-after value from error headers or body\n   */\n  private static extractRetryAfter(error: any): number | undefined {\n    // Check headers (common for HTTP responses)\n    const retryAfterHeader =\n      error.headers?.['retry-after'] ||\n      error.headers?.['Retry-After'] ||\n      error.headers?.get?.('retry-after');\n\n    if (retryAfterHeader) {\n      const seconds = parseInt(retryAfterHeader, 10);\n      if (!isNaN(seconds)) {\n        return seconds * 1000; // Convert to milliseconds\n      }\n    }\n\n    // Check error body for retry info\n    if (error.retryAfter) {\n      return typeof error.retryAfter === 'number'\n        ? error.retryAfter\n        : parseInt(error.retryAfter, 10) * 1000;\n    }\n\n    // Check for Google-style error details\n    if (error.errorDetails) {\n      for (const detail of error.errorDetails) {\n        if (detail.retryDelay) {\n          // Parse duration string like \"60s\"\n          const match = detail.retryDelay.match(/(\\d+)s/);\n          if (match) {\n            return parseInt(match[1], 10) * 1000;\n          }\n        }\n      }\n    }\n\n    return undefined;\n  }\n}\n","/**\n * Services - Single source of truth for external service definitions\n *\n * All service metadata is defined in one place (SERVICE_DEFINITIONS).\n * Other exports are derived from this to maintain DRY principles.\n */\n\n/**\n * Service category type\n */\nexport type ServiceCategory =\n  | 'communication'\n  | 'development'\n  | 'productivity'\n  | 'crm'\n  | 'payments'\n  | 'cloud'\n  | 'storage'\n  | 'email'\n  | 'monitoring'\n  | 'search'\n  | 'scrape'\n  | 'other';\n\n/**\n * Complete service definition - single source of truth\n */\nexport interface ServiceDefinition {\n  /** Unique identifier (e.g., 'slack', 'github') */\n  id: string;\n  /** Human-readable name (e.g., 'Slack', 'GitHub') */\n  name: string;\n  /** Service category */\n  category: ServiceCategory;\n  /** URL pattern for auto-detection from baseURL */\n  urlPattern: RegExp;\n  /** Default base URL for API calls */\n  baseURL: string;\n  /** Documentation URL */\n  docsURL?: string;\n  /** Common OAuth scopes */\n  commonScopes?: string[];\n}\n\n/**\n * Master list of all service definitions\n * This is the SINGLE SOURCE OF TRUTH - all other exports derive from this\n */\nexport const SERVICE_DEFINITIONS: readonly ServiceDefinition[] = [\n  // ============ Communication ============\n  {\n    id: 'slack',\n    name: 'Slack',\n    category: 'communication',\n    urlPattern: /slack\\.com/i,\n    baseURL: 'https://slack.com/api',\n    docsURL: 'https://api.slack.com/methods',\n    commonScopes: ['chat:write', 'channels:read', 'users:read'],\n  },\n  {\n    id: 'discord',\n    name: 'Discord',\n    category: 'communication',\n    urlPattern: /discord\\.com|discordapp\\.com/i,\n    baseURL: 'https://discord.com/api/v10',\n    docsURL: 'https://discord.com/developers/docs',\n    commonScopes: ['bot', 'messages.read'],\n  },\n  {\n    id: 'microsoft-teams',\n    name: 'Microsoft Teams',\n    category: 'communication',\n    urlPattern: /teams\\.microsoft\\.com|graph\\.microsoft\\.com.*teams/i,\n    baseURL: 'https://graph.microsoft.com/v1.0',\n    docsURL: 'https://learn.microsoft.com/en-us/graph/teams-concept-overview',\n    commonScopes: ['ChannelMessage.Send', 'Team.ReadBasic.All'],\n  },\n  {\n    id: 'telegram',\n    name: 'Telegram',\n    category: 'communication',\n    urlPattern: /api\\.telegram\\.org/i,\n    baseURL: 'https://api.telegram.org',\n    docsURL: 'https://core.telegram.org/bots/api',\n  },\n\n  // ============ Development & Project Management ============\n  {\n    id: 'github',\n    name: 'GitHub',\n    category: 'development',\n    urlPattern: /api\\.github\\.com/i,\n    baseURL: 'https://api.github.com',\n    docsURL: 'https://docs.github.com/en/rest',\n    commonScopes: ['repo', 'read:user', 'read:org'],\n  },\n  {\n    id: 'gitlab',\n    name: 'GitLab',\n    category: 'development',\n    urlPattern: /gitlab\\.com|gitlab\\./i,\n    baseURL: 'https://gitlab.com/api/v4',\n    docsURL: 'https://docs.gitlab.com/ee/api/',\n    commonScopes: ['api', 'read_user', 'read_repository'],\n  },\n  {\n    id: 'bitbucket',\n    name: 'Bitbucket',\n    category: 'development',\n    urlPattern: /api\\.bitbucket\\.org|bitbucket\\.org/i,\n    baseURL: 'https://api.bitbucket.org/2.0',\n    docsURL: 'https://developer.atlassian.com/cloud/bitbucket/rest/',\n    commonScopes: ['repository', 'pullrequest'],\n  },\n  {\n    id: 'jira',\n    name: 'Jira',\n    category: 'development',\n    urlPattern: /atlassian\\.net.*jira|jira\\./i,\n    baseURL: 'https://your-domain.atlassian.net/rest/api/3',\n    docsURL: 'https://developer.atlassian.com/cloud/jira/platform/rest/v3/',\n    commonScopes: ['read:jira-work', 'write:jira-work'],\n  },\n  {\n    id: 'linear',\n    name: 'Linear',\n    category: 'development',\n    urlPattern: /api\\.linear\\.app/i,\n    baseURL: 'https://api.linear.app/graphql',\n    docsURL: 'https://developers.linear.app/docs',\n    commonScopes: ['read', 'write'],\n  },\n  {\n    id: 'asana',\n    name: 'Asana',\n    category: 'development',\n    urlPattern: /api\\.asana\\.com/i,\n    baseURL: 'https://app.asana.com/api/1.0',\n    docsURL: 'https://developers.asana.com/docs',\n  },\n  {\n    id: 'trello',\n    name: 'Trello',\n    category: 'development',\n    urlPattern: /api\\.trello\\.com/i,\n    baseURL: 'https://api.trello.com/1',\n    docsURL: 'https://developer.atlassian.com/cloud/trello/rest/',\n    commonScopes: ['read', 'write'],\n  },\n\n  // ============ Productivity & Collaboration ============\n  {\n    id: 'notion',\n    name: 'Notion',\n    category: 'productivity',\n    urlPattern: /api\\.notion\\.com/i,\n    baseURL: 'https://api.notion.com/v1',\n    docsURL: 'https://developers.notion.com/reference',\n  },\n  {\n    id: 'airtable',\n    name: 'Airtable',\n    category: 'productivity',\n    urlPattern: /api\\.airtable\\.com/i,\n    baseURL: 'https://api.airtable.com/v0',\n    docsURL: 'https://airtable.com/developers/web/api',\n    commonScopes: ['data.records:read', 'data.records:write'],\n  },\n  {\n    id: 'google-workspace',\n    name: 'Google Workspace',\n    category: 'productivity',\n    urlPattern: /googleapis\\.com.*(drive|docs|sheets|calendar)/i,\n    baseURL: 'https://www.googleapis.com',\n    docsURL: 'https://developers.google.com/workspace',\n    commonScopes: [\n      'https://www.googleapis.com/auth/drive',\n      'https://www.googleapis.com/auth/calendar',\n    ],\n  },\n  {\n    id: 'microsoft-365',\n    name: 'Microsoft 365',\n    category: 'productivity',\n    urlPattern: /graph\\.microsoft\\.com/i,\n    baseURL: 'https://graph.microsoft.com/v1.0',\n    docsURL: 'https://learn.microsoft.com/en-us/graph/',\n    commonScopes: ['User.Read', 'Files.ReadWrite', 'Mail.Read'],\n  },\n  {\n    id: 'confluence',\n    name: 'Confluence',\n    category: 'productivity',\n    urlPattern: /atlassian\\.net.*wiki|confluence\\./i,\n    baseURL: 'https://your-domain.atlassian.net/wiki/rest/api',\n    docsURL: 'https://developer.atlassian.com/cloud/confluence/rest/',\n    commonScopes: ['read:confluence-content.all', 'write:confluence-content'],\n  },\n\n  // ============ CRM & Sales ============\n  {\n    id: 'salesforce',\n    name: 'Salesforce',\n    category: 'crm',\n    urlPattern: /salesforce\\.com|force\\.com/i,\n    baseURL: 'https://your-instance.salesforce.com/services/data/v58.0',\n    docsURL: 'https://developer.salesforce.com/docs/apis',\n    commonScopes: ['api', 'refresh_token'],\n  },\n  {\n    id: 'hubspot',\n    name: 'HubSpot',\n    category: 'crm',\n    urlPattern: /api\\.hubapi\\.com|api\\.hubspot\\.com/i,\n    baseURL: 'https://api.hubapi.com',\n    docsURL: 'https://developers.hubspot.com/docs/api',\n    commonScopes: ['crm.objects.contacts.read', 'crm.objects.contacts.write'],\n  },\n  {\n    id: 'pipedrive',\n    name: 'Pipedrive',\n    category: 'crm',\n    urlPattern: /api\\.pipedrive\\.com/i,\n    baseURL: 'https://api.pipedrive.com/v1',\n    docsURL: 'https://developers.pipedrive.com/docs/api/v1',\n  },\n\n  // ============ Payments & Finance ============\n  {\n    id: 'stripe',\n    name: 'Stripe',\n    category: 'payments',\n    urlPattern: /api\\.stripe\\.com/i,\n    baseURL: 'https://api.stripe.com/v1',\n    docsURL: 'https://stripe.com/docs/api',\n  },\n  {\n    id: 'paypal',\n    name: 'PayPal',\n    category: 'payments',\n    urlPattern: /api\\.paypal\\.com|api-m\\.paypal\\.com/i,\n    baseURL: 'https://api-m.paypal.com/v2',\n    docsURL: 'https://developer.paypal.com/docs/api/',\n  },\n\n  // ============ Cloud Providers ============\n  {\n    id: 'aws',\n    name: 'Amazon Web Services',\n    category: 'cloud',\n    urlPattern: /amazonaws\\.com/i,\n    baseURL: 'https://aws.amazon.com',\n    docsURL: 'https://docs.aws.amazon.com/',\n  },\n  {\n    id: 'gcp',\n    name: 'Google Cloud Platform',\n    category: 'cloud',\n    urlPattern: /googleapis\\.com/i,\n    baseURL: 'https://www.googleapis.com',\n    docsURL: 'https://cloud.google.com/apis/docs/',\n  },\n  {\n    id: 'azure',\n    name: 'Microsoft Azure',\n    category: 'cloud',\n    urlPattern: /azure\\.com|microsoft\\.com.*azure/i,\n    baseURL: 'https://management.azure.com',\n    docsURL: 'https://learn.microsoft.com/en-us/azure/',\n  },\n\n  // ============ Storage ============\n  {\n    id: 'dropbox',\n    name: 'Dropbox',\n    category: 'storage',\n    urlPattern: /api\\.dropboxapi\\.com|dropbox\\.com/i,\n    baseURL: 'https://api.dropboxapi.com/2',\n    docsURL: 'https://www.dropbox.com/developers/documentation',\n    commonScopes: ['files.content.read', 'files.content.write'],\n  },\n  {\n    id: 'box',\n    name: 'Box',\n    category: 'storage',\n    urlPattern: /api\\.box\\.com/i,\n    baseURL: 'https://api.box.com/2.0',\n    docsURL: 'https://developer.box.com/reference/',\n  },\n  {\n    id: 'google-drive',\n    name: 'Google Drive',\n    category: 'storage',\n    urlPattern: /googleapis\\.com.*drive/i,\n    baseURL: 'https://www.googleapis.com/drive/v3',\n    docsURL: 'https://developers.google.com/drive/api',\n    commonScopes: ['https://www.googleapis.com/auth/drive'],\n  },\n  {\n    id: 'onedrive',\n    name: 'OneDrive',\n    category: 'storage',\n    urlPattern: /graph\\.microsoft\\.com.*drive/i,\n    baseURL: 'https://graph.microsoft.com/v1.0/me/drive',\n    docsURL: 'https://learn.microsoft.com/en-us/onedrive/developer/',\n    commonScopes: ['Files.ReadWrite'],\n  },\n\n  // ============ Email ============\n  {\n    id: 'sendgrid',\n    name: 'SendGrid',\n    category: 'email',\n    urlPattern: /api\\.sendgrid\\.com/i,\n    baseURL: 'https://api.sendgrid.com/v3',\n    docsURL: 'https://docs.sendgrid.com/api-reference',\n  },\n  {\n    id: 'mailchimp',\n    name: 'Mailchimp',\n    category: 'email',\n    urlPattern: /api\\.mailchimp\\.com|mandrillapp\\.com/i,\n    baseURL: 'https://server.api.mailchimp.com/3.0',\n    docsURL: 'https://mailchimp.com/developer/marketing/api/',\n  },\n  {\n    id: 'postmark',\n    name: 'Postmark',\n    category: 'email',\n    urlPattern: /api\\.postmarkapp\\.com/i,\n    baseURL: 'https://api.postmarkapp.com',\n    docsURL: 'https://postmarkapp.com/developer',\n  },\n\n  // ============ Monitoring & Observability ============\n  {\n    id: 'datadog',\n    name: 'Datadog',\n    category: 'monitoring',\n    urlPattern: /api\\.datadoghq\\.com/i,\n    baseURL: 'https://api.datadoghq.com/api/v2',\n    docsURL: 'https://docs.datadoghq.com/api/',\n  },\n  {\n    id: 'pagerduty',\n    name: 'PagerDuty',\n    category: 'monitoring',\n    urlPattern: /api\\.pagerduty\\.com/i,\n    baseURL: 'https://api.pagerduty.com',\n    docsURL: 'https://developer.pagerduty.com/api-reference/',\n  },\n  {\n    id: 'sentry',\n    name: 'Sentry',\n    category: 'monitoring',\n    urlPattern: /sentry\\.io/i,\n    baseURL: 'https://sentry.io/api/0',\n    docsURL: 'https://docs.sentry.io/api/',\n  },\n\n  // ============ Search ============\n  {\n    id: 'serper',\n    name: 'Serper',\n    category: 'search',\n    urlPattern: /serper\\.dev/i,\n    baseURL: 'https://google.serper.dev',\n    docsURL: 'https://serper.dev/docs',\n  },\n  {\n    id: 'brave-search',\n    name: 'Brave Search',\n    category: 'search',\n    urlPattern: /api\\.search\\.brave\\.com/i,\n    baseURL: 'https://api.search.brave.com/res/v1',\n    docsURL: 'https://brave.com/search/api/',\n  },\n  {\n    id: 'tavily',\n    name: 'Tavily',\n    category: 'search',\n    urlPattern: /api\\.tavily\\.com/i,\n    baseURL: 'https://api.tavily.com',\n    docsURL: 'https://tavily.com/docs',\n  },\n  {\n    id: 'rapidapi-search',\n    name: 'RapidAPI Search',\n    category: 'search',\n    urlPattern: /real-time-web-search\\.p\\.rapidapi\\.com/i,\n    baseURL: 'https://real-time-web-search.p.rapidapi.com',\n    docsURL: 'https://rapidapi.com/letscrape-6bRBa3QguO5/api/real-time-web-search',\n  },\n\n  // ============ Scraping ============\n  {\n    id: 'zenrows',\n    name: 'ZenRows',\n    category: 'scrape',\n    urlPattern: /api\\.zenrows\\.com/i,\n    baseURL: 'https://api.zenrows.com/v1',\n    docsURL: 'https://docs.zenrows.com/universal-scraper-api/api-reference',\n  },\n\n  // ============ Other ============\n  {\n    id: 'twilio',\n    name: 'Twilio',\n    category: 'other',\n    urlPattern: /api\\.twilio\\.com/i,\n    baseURL: 'https://api.twilio.com/2010-04-01',\n    docsURL: 'https://www.twilio.com/docs/usage/api',\n  },\n  {\n    id: 'zendesk',\n    name: 'Zendesk',\n    category: 'other',\n    urlPattern: /zendesk\\.com/i,\n    baseURL: 'https://your-subdomain.zendesk.com/api/v2',\n    docsURL: 'https://developer.zendesk.com/api-reference/',\n    commonScopes: ['read', 'write'],\n  },\n  {\n    id: 'intercom',\n    name: 'Intercom',\n    category: 'other',\n    urlPattern: /api\\.intercom\\.io/i,\n    baseURL: 'https://api.intercom.io',\n    docsURL: 'https://developers.intercom.com/docs/',\n  },\n  {\n    id: 'shopify',\n    name: 'Shopify',\n    category: 'other',\n    urlPattern: /shopify\\.com.*admin/i,\n    baseURL: 'https://your-store.myshopify.com/admin/api/2024-01',\n    docsURL: 'https://shopify.dev/docs/api',\n    commonScopes: ['read_products', 'write_products', 'read_orders'],\n  },\n] as const;\n\n// ============ Derived Exports (all from SERVICE_DEFINITIONS) ============\n\n/**\n * Service type - union of all service IDs\n */\nexport type ServiceType = (typeof SERVICE_DEFINITIONS)[number]['id'];\n\n/**\n * Services constant object for easy access\n * Usage: Services.Slack, Services.GitHub, etc.\n */\nexport const Services = Object.fromEntries(\n  SERVICE_DEFINITIONS.map((def) => [\n    // Convert kebab-case to PascalCase for object key\n    def.id\n      .split('-')\n      .map((part) => part.charAt(0).toUpperCase() + part.slice(1))\n      .join(''),\n    def.id,\n  ])\n) as { [K in string]: ServiceType };\n\n/**\n * URL patterns for auto-detection (derived from SERVICE_DEFINITIONS)\n */\nexport const SERVICE_URL_PATTERNS: ReadonlyArray<{ service: string; pattern: RegExp }> =\n  SERVICE_DEFINITIONS.map((def) => ({\n    service: def.id,\n    pattern: def.urlPattern,\n  }));\n\n/**\n * Service info lookup (derived from SERVICE_DEFINITIONS)\n */\nexport interface ServiceInfo {\n  id: string;\n  name: string;\n  category: ServiceCategory;\n  baseURL: string;\n  docsURL?: string;\n  commonScopes?: string[];\n}\n\n/**\n * Service info map (derived from SERVICE_DEFINITIONS)\n */\nexport const SERVICE_INFO: Record<string, ServiceInfo> = Object.fromEntries(\n  SERVICE_DEFINITIONS.map((def) => [\n    def.id,\n    {\n      id: def.id,\n      name: def.name,\n      category: def.category,\n      baseURL: def.baseURL,\n      docsURL: def.docsURL,\n      commonScopes: def.commonScopes,\n    },\n  ])\n);\n\n// ============ Utility Functions ============\n\n// Pre-compiled pattern cache for faster detection\nlet compiledPatterns: Array<{ service: string; pattern: RegExp }> | null = null;\n\n/**\n * Get compiled patterns (lazy initialization)\n */\nfunction getCompiledPatterns(): Array<{ service: string; pattern: RegExp }> {\n  if (!compiledPatterns) {\n    compiledPatterns = SERVICE_DEFINITIONS.map((def) => ({\n      service: def.id,\n      pattern: def.urlPattern,\n    }));\n  }\n  return compiledPatterns;\n}\n\n/**\n * Detect service type from a URL\n * @param url - Base URL or full URL to check\n * @returns Service type string or undefined if not recognized\n */\nexport function detectServiceFromURL(url: string): string | undefined {\n  const patterns = getCompiledPatterns();\n\n  for (const { service, pattern } of patterns) {\n    if (pattern.test(url)) {\n      return service;\n    }\n  }\n\n  return undefined;\n}\n\n/**\n * Get service info by service type\n */\nexport function getServiceInfo(serviceType: string): ServiceInfo | undefined {\n  return SERVICE_INFO[serviceType];\n}\n\n/**\n * Get service definition by service type\n */\nexport function getServiceDefinition(serviceType: string): ServiceDefinition | undefined {\n  return SERVICE_DEFINITIONS.find((def) => def.id === serviceType);\n}\n\n/**\n * Get all services in a category\n */\nexport function getServicesByCategory(category: ServiceCategory): ServiceDefinition[] {\n  return SERVICE_DEFINITIONS.filter((def) => def.category === category);\n}\n\n/**\n * Get all service IDs\n */\nexport function getAllServiceIds(): string[] {\n  return SERVICE_DEFINITIONS.map((def) => def.id);\n}\n\n/**\n * Check if a service ID is known\n */\nexport function isKnownService(serviceId: string): boolean {\n  return SERVICE_DEFINITIONS.some((def) => def.id === serviceId);\n}\n","/**\n * @oneringai/agents - Unified AI agent library\n *\n * Connector-First Architecture: Simple, DRY, Powerful\n *\n * @example\n * ```typescript\n * import { Connector, Agent, Vendor } from '@oneringai/agents';\n *\n * // Create connector (can have multiple per vendor!)\n * Connector.create({\n *   name: 'openai-main',\n *   vendor: Vendor.OpenAI,\n *   auth: { type: 'api_key', apiKey: process.env.OPENAI_API_KEY! }\n * });\n *\n * // Create agent from connector\n * const agent = Agent.create({\n *   connector: 'openai-main',\n *   model: 'gpt-4',\n *   tools: [myTool]\n * });\n *\n * // Run the agent\n * const response = await agent.run('Hello!');\n * ```\n */\n\n// ============ Core API (Primary) ============\nexport { Connector, Agent, Vendor, VENDORS, isVendor, createProvider } from './core/index.js';\nexport type { AgentConfig, AgentSessionConfig } from './core/index.js';\n\n// AgentContext - Unified \"Swiss Army Knife\" for context management\nexport { AgentContext, DEFAULT_FEATURES } from './core/index.js';\nexport type {\n  AgentContextConfig,\n  AgentContextFeatures,\n  AgentContextEvents,\n  AgentContextMetrics,\n  HistoryMessage as AgentContextHistoryMessage,\n  ToolCallRecord,\n  SerializedAgentContextState,\n  DirectCallOptions,\n} from './core/index.js';\n\n// Feature-aware tool factory\nexport { getAgentContextTools, getBasicIntrospectionTools, getMemoryTools } from './core/index.js';\n\n// Feature Instructions (runtime usage instructions for enabled features)\nexport {\n  buildFeatureInstructions,\n  INTROSPECTION_INSTRUCTIONS,\n  WORKING_MEMORY_INSTRUCTIONS,\n  IN_CONTEXT_MEMORY_INSTRUCTIONS,\n  PERSISTENT_INSTRUCTIONS_INSTRUCTIONS,\n  getAllInstructions,\n} from './core/index.js';\n\n// Audio Capabilities\nexport { TextToSpeech, SpeechToText } from './core/index.js';\nexport type { TextToSpeechConfig, SpeechToTextConfig } from './core/index.js';\n\n// Image Capabilities\nexport { ImageGeneration } from './capabilities/images/index.js';\nexport type { ImageGenerationCreateOptions, SimpleGenerateOptions } from './capabilities/images/index.js';\nexport { createImageProvider } from './core/index.js';\n\n// Video Capabilities\nexport { VideoGeneration } from './capabilities/video/index.js';\nexport type {\n  VideoGenerationCreateOptions,\n  SimpleVideoGenerateOptions,\n} from './capabilities/video/index.js';\nexport { createVideoProvider } from './core/createVideoProvider.js';\n\n// Search Capabilities (NEW - Connector-based web search)\nexport { SearchProvider } from './capabilities/search/index.js';\nexport type {\n  ISearchProvider,\n  SearchResult,\n  SearchOptions,\n  SearchResponse,\n  SearchProviderConfig,\n} from './capabilities/search/index.js';\nexport { SerperProvider, BraveProvider, TavilyProvider, RapidAPIProvider } from './capabilities/search/index.js';\n\n// Scrape Capabilities (Connector-based web scraping)\nexport { ScrapeProvider, registerScrapeProvider, getRegisteredScrapeProviders } from './capabilities/scrape/index.js';\nexport type {\n  IScrapeProvider,\n  ScrapeResult,\n  ScrapeOptions,\n  ScrapeResponse,\n  ScrapeFeature,\n  ScrapeProviderConfig,\n  ScrapeProviderFallbackConfig,\n} from './capabilities/scrape/index.js';\n\n// Shared Capability Utilities\nexport {\n  buildQueryString,\n  toConnectorOptions,\n  buildEndpointWithQuery,\n  resolveConnector,\n  // Service type auto-detection (for external API-dependent tools)\n  findConnectorByServiceTypes,\n  listConnectorsByServiceTypes,\n  type BaseProviderConfig,\n  type BaseProviderResponse,\n  type ICapabilityProvider,\n  type ExtendedFetchOptions,\n} from './capabilities/shared/index.js';\n\n// Tool Management (Unified - handles registration, execution, and circuit breakers)\nexport { ToolManager } from './core/index.js';\nexport type {\n  ToolOptions,\n  ToolCondition,\n  ToolSelectionContext,\n  ToolRegistration,\n  ToolMetadata,\n  ToolManagerStats,\n  SerializedToolState,\n  ToolManagerEvent,\n} from './core/index.js';\n// Note: CircuitBreakerConfig, CircuitState are exported from infrastructure/resilience\n\n// Tool Permissions (NEW)\nexport { ToolPermissionManager } from './core/permissions/index.js';\nexport type {\n  PermissionScope,\n  RiskLevel,\n  ToolPermissionConfig,\n  ApprovalCacheEntry,\n  SerializedApprovalState,\n  SerializedApprovalEntry,\n  PermissionCheckResult,\n  ApprovalDecision,\n  AgentPermissionsConfig,\n  PermissionCheckContext,\n  PermissionManagerEvent,\n} from './core/permissions/index.js';\nexport { APPROVAL_STATE_VERSION, DEFAULT_PERMISSION_CONFIG, DEFAULT_ALLOWLIST } from './core/permissions/index.js';\nexport type { DefaultAllowlistedTool } from './core/permissions/index.js';\n\n// Context Storage (Session Persistence via AgentContext)\nexport type {\n  IContextStorage,\n  StoredContextSession,\n  ContextSessionSummary,\n  ContextSessionMetadata,\n  ContextStorageListOptions,\n} from './domain/interfaces/IContextStorage.js';\nexport { CONTEXT_SESSION_FORMAT_VERSION } from './domain/interfaces/IContextStorage.js';\n\n// Agent Definition Storage (Agent Configuration Persistence)\nexport type {\n  IAgentDefinitionStorage,\n  StoredAgentDefinition,\n  StoredAgentType,\n  AgentDefinitionMetadata,\n  AgentDefinitionSummary,\n  AgentDefinitionListOptions,\n} from './domain/interfaces/IAgentDefinitionStorage.js';\nexport { AGENT_DEFINITION_FORMAT_VERSION } from './domain/interfaces/IAgentDefinitionStorage.js';\n\n// ============ Error Handling ============\nexport { ErrorHandler, globalErrorHandler } from './core/index.js';\nexport type {\n  ErrorContext,\n  ErrorHandlerConfig,\n  ErrorHandlerEvents,\n} from './core/index.js';\n\n// ============ Task-Based Agents ============\nexport {\n  TaskAgent,\n  WorkingMemory,\n  IdempotencyCache,\n  ExternalDependencyHandler,\n  PlanExecutor,\n  CheckpointManager,\n  createMemoryTools,\n  createContextTools,\n  PlanningAgent,\n  generateSimplePlan,\n} from './capabilities/taskAgent/index.js';\nexport type {\n  TaskAgentConfig,\n  TaskAgentSessionConfig,\n  TaskAgentHooks,\n  AgentHandle,\n  PlanResult,\n  PlanUpdates,\n  PlanUpdateOptions,\n  TaskContext,\n  TaskResult,\n  ErrorContext as TaskAgentErrorContext,\n  WorkingMemoryEvents,\n  EvictionStrategy,\n  IdempotencyCacheConfig,\n  CacheStats,\n  ExternalDependencyEvents,\n  PlanExecutorConfig,\n  PlanExecutorEvents,\n  PlanExecutionResult,\n  CheckpointStrategy,\n  PlanningAgentConfig,\n  GeneratedPlan,\n} from './capabilities/taskAgent/index.js';\nexport { DEFAULT_IDEMPOTENCY_CONFIG, DEFAULT_CHECKPOINT_STRATEGY } from './capabilities/taskAgent/index.js';\n\n// ============ ResearchAgent (Generic Research Capabilities) ============\nexport {\n  ResearchAgent,\n  createResearchTools,\n  WebSearchSource,\n  createWebSearchSource,\n  FileSearchSource,\n  createFileSearchSource,\n} from './capabilities/researchAgent/index.js';\nexport type {\n  ResearchAgentConfig,\n  ResearchAgentHooks,\n  IResearchSource,\n  SourceResult,\n  SearchResponse as ResearchSearchResponse,\n  FetchedContent,\n  SearchOptions as ResearchSearchOptions,\n  FetchOptions as ResearchFetchOptions,\n  SourceCapabilities,\n  ResearchFinding,\n  ResearchPlan,\n  ResearchQuery,\n  ResearchResult,\n  ResearchProgress,\n  WebSearchSourceConfig,\n  FileSearchSourceConfig,\n} from './capabilities/researchAgent/index.js';\n\n// ============ Context Management (Universal) ============\n// Note: ContextManager class deleted - AgentContext is THE ONLY context manager\nexport type {\n  IContextComponent,\n  ContextBudget,\n  PreparedContext,\n  ContextManagerConfig,\n  ITokenEstimator,\n  IContextCompactor,\n  IContextStrategy,\n  TokenContentType,\n} from './core/context/types.js';\nexport { DEFAULT_CONTEXT_CONFIG } from './core/context/types.js';\n\n// Context Strategies\nexport {\n  ProactiveCompactionStrategy,\n  AggressiveCompactionStrategy,\n  LazyCompactionStrategy,\n  RollingWindowStrategy,\n  AdaptiveStrategy,\n  createStrategy,\n} from './core/context/strategies/index.js';\n\n// Context Infrastructure\nexport {\n  TruncateCompactor,\n  SummarizeCompactor,\n  MemoryEvictionCompactor,\n  ApproximateTokenEstimator,\n  createEstimator,\n} from './infrastructure/context/index.js';\n\n// ============ Conversation History Management ============\n// Note: ConversationHistoryManager class deleted - AgentContext manages history directly\nexport type {\n  IHistoryManager,\n  IHistoryStorage,\n  HistoryMessage,\n  IHistoryManagerConfig,\n  HistoryManagerEvents,\n  SerializedHistoryState,\n} from './core/history/index.js';\nexport { DEFAULT_HISTORY_MANAGER_CONFIG } from './core/history/index.js';\nexport { InMemoryHistoryStorage } from './infrastructure/storage/InMemoryHistoryStorage.js';\n\n// Task & Plan Entities\nexport type {\n  Task,\n  TaskInput,\n  TaskStatus,\n  TaskCondition,\n  TaskExecution,\n  TaskValidation,\n  TaskValidationResult,\n  ExternalDependency,\n  Plan,\n  PlanInput,\n  PlanStatus,\n  PlanConcurrency,\n} from './domain/entities/Task.js';\n\n// Task & Plan Utilities\nexport {\n  createTask,\n  createPlan,\n  detectDependencyCycle,\n  canTaskExecute,\n  getNextExecutableTasks,\n  evaluateCondition,\n  updateTaskStatus,\n  isTaskBlocked,\n  getTaskDependencies,\n  resolveDependencies,\n  isTerminalStatus,\n  TERMINAL_TASK_STATUSES,\n} from './domain/entities/Task.js';\n\n// Memory Entities\nexport type {\n  MemoryEntry,\n  MemoryEntryInput,\n  MemoryIndex,\n  MemoryIndexEntry,\n  MemoryScope,\n  MemoryPriority,\n  TaskAwareScope,\n  SimpleScope,\n  TaskStatusForMemory,\n  WorkingMemoryConfig,\n} from './domain/entities/Memory.js';\nexport {\n  DEFAULT_MEMORY_CONFIG,\n  forTasks,\n  forPlan,\n  scopeEquals,\n  scopeMatches,\n  isSimpleScope,\n  isTaskAwareScope,\n  isTerminalMemoryStatus,\n  calculateEntrySize,\n  MEMORY_PRIORITY_VALUES,\n} from './domain/entities/Memory.js';\n\n// Agent State\nexport type {\n  AgentState,\n  AgentStatus,\n  AgentConfig as TaskAgentStateConfig,\n  ConversationMessage,\n  AgentMetrics,\n} from './domain/entities/AgentState.js';\n\n// Storage Interfaces\nexport type { IMemoryStorage } from './domain/interfaces/IMemoryStorage.js';\nexport type { IPlanStorage } from './domain/interfaces/IPlanStorage.js';\nexport type { IAgentStateStorage } from './domain/interfaces/IAgentStateStorage.js';\nexport { createAgentStorage } from './infrastructure/storage/index.js';\nexport type { IAgentStorage } from './infrastructure/storage/InMemoryStorage.js';\nexport { InMemoryStorage, InMemoryPlanStorage, InMemoryAgentStateStorage } from './infrastructure/storage/index.js';\n\n// Context Storage Implementations (for AgentContext session persistence)\nexport { FileContextStorage, createFileContextStorage } from './infrastructure/storage/index.js';\nexport type { FileContextStorageConfig } from './infrastructure/storage/index.js';\n\n// Agent Definition Storage Implementations (for agent configuration persistence)\nexport { FileAgentDefinitionStorage, createFileAgentDefinitionStorage } from './infrastructure/storage/index.js';\nexport type { FileAgentDefinitionStorageConfig } from './infrastructure/storage/index.js';\n\n// Tool Context (ToolContext is the canonical interface for tool execution context)\nexport type { ToolContext, ToolContext as TaskToolContext, WorkingMemoryAccess } from './domain/interfaces/IToolContext.js';\n\n// ============ Domain Types ============\n\n// Content\nexport { ContentType } from './domain/entities/Content.js';\nexport type {\n  Content,\n  InputTextContent,\n  InputImageContent,\n  OutputTextContent,\n  ToolUseContent,\n  ToolResultContent,\n} from './domain/entities/Content.js';\n\n// Messages\nexport { MessageRole } from './domain/entities/Message.js';\nexport type {\n  Message,\n  InputItem,\n  OutputItem,\n  CompactionItem,\n  ReasoningItem,\n} from './domain/entities/Message.js';\n\n// Tools\nexport {\n  ToolCallState,\n  defaultDescribeCall,\n  getToolCallDescription,\n} from './domain/entities/Tool.js';\nexport type {\n  Tool,\n  FunctionToolDefinition,\n  BuiltInTool,\n  ToolFunction,\n  ToolCall,\n  ToolResult,\n  ToolExecutionContext,\n  JSONSchema,\n} from './domain/entities/Tool.js';\n\n// Response\nexport type { LLMResponse, AgentResponse } from './domain/entities/Response.js';\n\n// Connector types\nexport type {\n  ConnectorConfig,\n  ConnectorAuth,\n  OAuthConnectorAuth,\n  APIKeyConnectorAuth,\n  JWTConnectorAuth,\n} from './domain/entities/Connector.js';\n\n// Model Registry\nexport type { ILLMDescription } from './domain/entities/Model.js';\nexport {\n  LLM_MODELS,\n  MODEL_REGISTRY,\n  getModelInfo,\n  getModelsByVendor,\n  getActiveModels,\n  calculateCost,\n} from './domain/entities/Model.js';\n\n// Audio Model Registries\nexport type { ITTSModelDescription, TTSModelCapabilities } from './domain/entities/TTSModel.js';\nexport type { ISTTModelDescription, STTModelCapabilities } from './domain/entities/STTModel.js';\nexport type { IVoiceInfo } from './domain/entities/SharedVoices.js';\nexport {\n  TTS_MODELS,\n  TTS_MODEL_REGISTRY,\n  getTTSModelInfo,\n  getTTSModelsByVendor,\n  getActiveTTSModels,\n  getTTSModelsWithFeature,\n  calculateTTSCost,\n} from './domain/entities/TTSModel.js';\nexport {\n  STT_MODELS,\n  STT_MODEL_REGISTRY,\n  getSTTModelInfo,\n  getSTTModelsByVendor,\n  getActiveSTTModels,\n  getSTTModelsWithFeature,\n  calculateSTTCost,\n} from './domain/entities/STTModel.js';\n\n// Image Model Registry\nexport type { IImageModelDescription, ImageModelCapabilities, ImageModelPricing } from './domain/entities/ImageModel.js';\nexport {\n  IMAGE_MODELS,\n  IMAGE_MODEL_REGISTRY,\n  getImageModelInfo,\n  getImageModelsByVendor,\n  getActiveImageModels,\n  getImageModelsWithFeature,\n  calculateImageCost,\n} from './domain/entities/ImageModel.js';\n\n// Video Model Registry\nexport type { IVideoModelDescription, VideoModelCapabilities, VideoModelPricing } from './domain/entities/VideoModel.js';\nexport {\n  VIDEO_MODELS,\n  VIDEO_MODEL_REGISTRY,\n  getVideoModelInfo,\n  getVideoModelsByVendor,\n  getActiveVideoModels,\n  getVideoModelsWithFeature,\n  getVideoModelsWithAudio,\n  calculateVideoCost,\n} from './domain/entities/VideoModel.js';\n\n// ============ Streaming ============\nexport { StreamEventType } from './domain/entities/StreamEvent.js';\nexport type {\n  StreamEvent,\n  ResponseCreatedEvent,\n  ResponseInProgressEvent,\n  OutputTextDeltaEvent,\n  OutputTextDoneEvent,\n  ToolCallStartEvent,\n  ToolCallArgumentsDeltaEvent,\n  ToolCallArgumentsDoneEvent,\n  ToolExecutionStartEvent,\n  ToolExecutionDoneEvent,\n  IterationCompleteEvent,\n  ResponseCompleteEvent,\n  ErrorEvent,\n} from './domain/entities/StreamEvent.js';\nexport {\n  isStreamEvent,\n  isOutputTextDelta,\n  isToolCallStart,\n  isToolCallArgumentsDelta,\n  isToolCallArgumentsDone,\n  isResponseComplete,\n  isErrorEvent,\n} from './domain/entities/StreamEvent.js';\nexport { StreamState } from './domain/entities/StreamState.js';\nexport { StreamHelpers } from './capabilities/agents/StreamHelpers.js';\n\n// ============ Hooks & Events (Enterprise) ============\nexport { ExecutionContext, HookManager } from './capabilities/agents/index.js';\nexport type {\n  AgenticLoopEvents,\n  AgenticLoopEventName,\n  HookConfig,\n  HookName,\n  Hook,\n  ModifyingHook,\n  BeforeToolContext,\n  AfterToolContext,\n  ApproveToolContext,\n  ToolModification,\n  ApprovalResult,\n  HistoryMode,\n  ExecutionMetrics,\n  AuditEntry,\n} from './capabilities/agents/index.js';\n\n// ============ Errors ============\nexport {\n  AIError,\n  ProviderNotFoundError,\n  ProviderAuthError,\n  ProviderRateLimitError,\n  ProviderContextLengthError,\n  ToolExecutionError,\n  ToolTimeoutError,\n  ToolNotFoundError,\n  ModelNotSupportedError,\n  InvalidConfigError,\n  InvalidToolArgumentsError,\n  ProviderError,\n  // TaskAgent errors\n  DependencyCycleError,\n  TaskTimeoutError,\n  TaskValidationError,\n  ParallelTasksError,\n} from './domain/errors/AIErrors.js';\nexport type { TaskFailure } from './domain/errors/AIErrors.js';\n\n// ============ Interfaces (for extensibility) ============\nexport type { IProvider, ProviderCapabilities } from './domain/interfaces/IProvider.js';\nexport type { ITextProvider, TextGenerateOptions, ModelCapabilities } from './domain/interfaces/ITextProvider.js';\nexport type { IToolExecutor } from './domain/interfaces/IToolExecutor.js';\nexport type { IDisposable, IAsyncDisposable } from './domain/interfaces/IDisposable.js';\nexport { assertNotDestroyed } from './domain/interfaces/IDisposable.js';\n\n// Audio Interfaces\nexport type {\n  ITextToSpeechProvider,\n  ISpeechToTextProvider,\n  TTSOptions,\n  TTSResponse,\n  STTOptions,\n  STTResponse,\n  STTOutputFormat,\n  WordTimestamp,\n  SegmentTimestamp,\n} from './domain/interfaces/IAudioProvider.js';\n\n// Image Interfaces\nexport type {\n  IImageProvider,\n  ImageGenerateOptions,\n  ImageEditOptions,\n  ImageVariationOptions,\n  ImageResponse,\n} from './domain/interfaces/IImageProvider.js';\n\n// Video Interfaces\nexport type {\n  IVideoProvider,\n  VideoGenerateOptions,\n  VideoExtendOptions,\n  VideoResponse,\n  VideoJob,\n  VideoStatus,\n} from './domain/interfaces/IVideoProvider.js';\n\n// Base classes for custom providers\nexport { BaseProvider } from './infrastructure/providers/base/BaseProvider.js';\nexport { BaseTextProvider } from './infrastructure/providers/base/BaseTextProvider.js';\nexport { BaseMediaProvider } from './infrastructure/providers/base/BaseMediaProvider.js';\nexport { ProviderErrorMapper } from './infrastructure/providers/base/ProviderErrorMapper.js';\n\n// Shared types for multi-modal\nexport type {\n  AspectRatio,\n  QualityLevel,\n  AudioFormat,\n  OutputFormat,\n  ISourceLinks,\n  VendorOptionSchema,\n  IBaseModelDescription,\n} from './domain/types/SharedTypes.js';\n\n// ============ External Services & Connector Tools ============\n// Services constants for well-known external services\nexport {\n  Services,\n  SERVICE_DEFINITIONS,\n  SERVICE_URL_PATTERNS,\n  SERVICE_INFO,\n  detectServiceFromURL,\n  getServiceInfo,\n  getServiceDefinition,\n  getServicesByCategory,\n  getAllServiceIds,\n  isKnownService,\n} from './domain/entities/Services.js';\nexport type { ServiceType, ServiceInfo, ServiceDefinition, ServiceCategory } from './domain/entities/Services.js';\n\n// Connector resilience defaults\nexport {\n  DEFAULT_CONNECTOR_TIMEOUT,\n  DEFAULT_MAX_RETRIES,\n  DEFAULT_RETRYABLE_STATUSES,\n  DEFAULT_BASE_DELAY_MS,\n  DEFAULT_MAX_DELAY_MS,\n} from './core/Connector.js';\nexport type { ConnectorFetchOptions } from './core/Connector.js';\n\n// ConnectorTools framework for vendor-dependent tools\nexport {\n  ConnectorTools,\n} from './tools/connector/index.js';\nexport type {\n  ServiceToolFactory,\n  GenericAPIToolOptions,\n  GenericAPICallArgs,\n  GenericAPICallResult,\n} from './tools/connector/index.js';\n\n// ============ OAuth & Storage (for external APIs) ============\nexport { OAuthManager, MemoryStorage, FileStorage } from './connectors/index.js';\nexport { generateEncryptionKey, authenticatedFetch, createAuthenticatedFetch, generateWebAPITool } from './connectors/index.js';\nexport type { OAuthConfig, OAuthFlow, ITokenStorage, FileStorageConfig, StoredToken } from './connectors/index.js';\n\n// ConnectorConfig storage (persistent connector configs with encryption)\nexport {\n  ConnectorConfigStore,\n  MemoryConnectorStorage,\n  FileConnectorStorage,\n  CONNECTOR_CONFIG_VERSION,\n} from './connectors/index.js';\nexport type {\n  IConnectorConfigStorage,\n  StoredConnectorConfig,\n  FileConnectorStorageConfig,\n} from './connectors/index.js';\n\n// ============ Resilience & Observability (Phase 3) ============\nexport { CircuitBreaker, CircuitOpenError } from './infrastructure/resilience/index.js';\nexport type {\n  CircuitState,\n  CircuitBreakerConfig,\n  CircuitBreakerMetrics,\n  CircuitBreakerEvents,\n} from './infrastructure/resilience/index.js';\nexport { DEFAULT_CIRCUIT_BREAKER_CONFIG } from './infrastructure/resilience/index.js';\n\nexport {\n  calculateBackoff,\n  addJitter,\n  backoffWait,\n  backoffSequence,\n  retryWithBackoff,\n} from './infrastructure/resilience/index.js';\nexport type { BackoffConfig, BackoffStrategyType } from './infrastructure/resilience/index.js';\nexport { DEFAULT_BACKOFF_CONFIG } from './infrastructure/resilience/index.js';\n\nexport { TokenBucketRateLimiter, RateLimitError } from './infrastructure/resilience/index.js';\nexport type { RateLimiterConfig, RateLimiterMetrics } from './infrastructure/resilience/index.js';\nexport { DEFAULT_RATE_LIMITER_CONFIG } from './infrastructure/resilience/index.js';\n\nexport { FrameworkLogger, logger } from './infrastructure/observability/index.js';\nexport type { LogLevel, LoggerConfig, LogEntry } from './infrastructure/observability/index.js';\n\nexport {\n  NoOpMetrics,\n  ConsoleMetrics,\n  InMemoryMetrics,\n  createMetricsCollector,\n  metrics,\n  setMetricsCollector,\n} from './infrastructure/observability/index.js';\nexport type { MetricsCollector, MetricTags, MetricsCollectorType } from './infrastructure/observability/index.js';\n\n// ============ Utilities ============\nexport { MessageBuilder, createTextMessage, createMessageWithImages } from './utils/messageBuilder.js';\nexport { readClipboardImage, hasClipboardImage } from './utils/clipboardImage.js';\nexport type { ClipboardImageResult } from './utils/clipboardImage.js';\nexport { extractJSON, extractJSONField, extractNumber } from './utils/jsonExtractor.js';\nexport type { JSONExtractionResult } from './utils/jsonExtractor.js';\n\n// ============ Pre-built Tools ============\nexport * as tools from './tools/index.js';\nexport { createExecuteJavaScriptTool } from './tools/code/executeJavaScript.js';\n\n// Filesystem tools (factory functions and types)\nexport {\n  readFile,\n  writeFile,\n  editFile,\n  glob,\n  grep,\n  listDirectory,\n  createReadFileTool,\n  createWriteFileTool,\n  createEditFileTool,\n  createGlobTool,\n  createGrepTool,\n  createListDirectoryTool,\n  DEFAULT_FILESYSTEM_CONFIG,\n  validatePath,\n  isExcludedExtension,\n  developerTools,\n} from './tools/index.js';\n\nexport type {\n  FilesystemToolConfig,\n  ReadFileResult,\n  WriteFileResult,\n  EditFileResult,\n  GlobResult,\n  GrepResult,\n  GrepMatch,\n} from './tools/index.js';\n\n// Shell tools (factory functions and types)\nexport {\n  bash,\n  createBashTool,\n  getBackgroundOutput,\n  killBackgroundProcess,\n  DEFAULT_SHELL_CONFIG,\n  isBlockedCommand,\n} from './tools/index.js';\n\nexport type {\n  ShellToolConfig,\n  BashResult,\n} from './tools/index.js';\n\n// Tool Registry (auto-generated)\nexport {\n  toolRegistry,\n  getAllBuiltInTools,\n  getToolRegistry,\n  getToolsByCategory,\n  getToolByName,\n  getToolsRequiringConnector,\n  getToolCategories,\n} from './tools/index.js';\n\nexport type {\n  ToolCategory,\n  ToolRegistryEntry,\n} from './tools/index.js';\n\n// ============ Built-in Agents ============\nexport { ProviderConfigAgent } from './agents/index.js';\nexport type { ConnectorConfigResult } from './agents/index.js';\n\n// ============ UniversalAgent (NEW) ============\nexport { UniversalAgent, ModeManager } from './capabilities/universalAgent/index.js';\nexport type { UniversalAgentEvents, ModeManagerEvents } from './capabilities/universalAgent/index.js';\nexport {\n  getMetaTools,\n  isMetaTool,\n  META_TOOL_NAMES,\n} from './capabilities/universalAgent/index.js';\nexport type {\n  UniversalAgentConfig,\n  UniversalAgentSessionConfig,\n  UniversalAgentPlanningConfig,\n  UniversalResponse,\n  UniversalEvent,\n  AgentMode,\n  TaskProgress,\n  IntentAnalysis,\n  PlanChange,\n  ExecutionResult,\n  ToolCallResult as UniversalToolCallResult,\n  ModeState,\n} from './capabilities/universalAgent/index.js';\n\n// ============ MCP (Model Context Protocol) ============\nexport { MCPClient, MCPRegistry } from './core/mcp/index.js';\nexport type {\n  IMCPClient,\n  MCPClientConnectionState,\n  MCPTool,\n  MCPToolResult,\n  MCPResource,\n  MCPResourceContent,\n  MCPPrompt,\n  MCPPromptResult,\n  MCPServerCapabilities,\n  MCPClientState,\n  MCPServerConfig,\n  MCPConfiguration,\n  MCPTransportType,\n  StdioTransportConfig,\n  HTTPTransportConfig,\n  TransportConfig,\n} from './core/mcp/index.js';\nexport {\n  MCPError,\n  MCPConnectionError,\n  MCPTimeoutError,\n  MCPProtocolError,\n  MCPToolError,\n  MCPResourceError,\n} from './core/mcp/index.js';\n\n// ============ InContextMemory (Live Context Storage) ============\nexport {\n  InContextMemoryPlugin,\n  createInContextMemoryTools,\n  createInContextMemory,\n  setupInContextMemory,\n} from './core/context/plugins/index.js';\nexport type {\n  InContextEntry,\n  InContextPriority,\n  InContextMemoryConfig,\n  SerializedInContextMemoryState,\n} from './core/context/plugins/index.js';\n\n// ============ PersistentInstructions (Disk-Persisted Custom Instructions) ============\nexport {\n  PersistentInstructionsPlugin,\n  createPersistentInstructionsTools,\n  createPersistentInstructions,\n  setupPersistentInstructions,\n} from './core/context/plugins/index.js';\nexport type {\n  PersistentInstructionsConfig,\n  SerializedPersistentInstructionsState,\n} from './core/context/plugins/index.js';\n\n// PersistentInstructions Storage\nexport { FilePersistentInstructionsStorage } from './infrastructure/storage/index.js';\nexport type { FilePersistentInstructionsStorageConfig } from './infrastructure/storage/index.js';\nexport type { IPersistentInstructionsStorage } from './domain/interfaces/IPersistentInstructionsStorage.js';\n\n","/**\n * ConnectorTools - Generate tools from Connectors\n *\n * This is the main API for vendor-dependent tools.\n * Tools are thin wrappers around Connector.fetch() for specific operations.\n *\n * Enterprise features:\n * - Service detection caching\n * - Tool instance caching\n * - Security: prevents auth header override\n * - Safe JSON serialization\n */\n\nimport { Connector } from '../../core/Connector.js';\nimport { ToolFunction, ToolPermissionConfig } from '../../domain/entities/Tool.js';\nimport { detectServiceFromURL } from '../../domain/entities/Services.js';\n\n/**\n * Headers that are protected and cannot be overridden by tool arguments\n */\nconst PROTECTED_HEADERS = ['authorization', 'x-api-key', 'api-key', 'bearer'];\n\n/**\n * Safely stringify an object, handling circular references\n */\nfunction safeStringify(obj: unknown): string {\n  const seen = new WeakSet();\n  return JSON.stringify(obj, (_key, value) => {\n    if (typeof value === 'object' && value !== null) {\n      if (seen.has(value)) {\n        return '[Circular]';\n      }\n      seen.add(value);\n    }\n    return value;\n  });\n}\n\n/**\n * Filter out protected headers from user-provided headers\n */\nfunction filterProtectedHeaders(headers?: Record<string, string>): Record<string, string> {\n  if (!headers) return {};\n\n  const filtered: Record<string, string> = {};\n  for (const [key, value] of Object.entries(headers)) {\n    if (!PROTECTED_HEADERS.includes(key.toLowerCase())) {\n      filtered[key] = value;\n    }\n  }\n  return filtered;\n}\n\n/**\n * Factory function type for creating service-specific tools\n * Takes a Connector and returns an array of tools that use it\n */\nexport type ServiceToolFactory = (connector: Connector, userId?: string) => ToolFunction[];\n\n/**\n * Options for generating the generic API tool\n */\nexport interface GenericAPIToolOptions {\n  /** Override the tool name (default: `${connectorName}_api`) */\n  toolName?: string;\n  /** Override the description */\n  description?: string;\n  /** User ID for multi-user OAuth */\n  userId?: string;\n  /** Permission config for the tool */\n  permission?: ToolPermissionConfig;\n}\n\n/**\n * Arguments for the generic API call tool\n */\nexport interface GenericAPICallArgs {\n  method: 'GET' | 'POST' | 'PUT' | 'DELETE' | 'PATCH';\n  endpoint: string;\n  body?: Record<string, unknown>;\n  queryParams?: Record<string, string | number | boolean>;\n  headers?: Record<string, string>;\n}\n\n/**\n * Result from the generic API call tool\n */\nexport interface GenericAPICallResult {\n  success: boolean;\n  status?: number;\n  data?: unknown;\n  error?: string;\n}\n\n/**\n * ConnectorTools - Main API for vendor-dependent tools\n *\n * Usage:\n * ```typescript\n * // Get all tools for a connector\n * const tools = ConnectorTools.for('slack');\n *\n * // Get just the generic API tool\n * const apiTool = ConnectorTools.genericAPI('github');\n *\n * // Discover all available connector tools\n * const allTools = ConnectorTools.discoverAll();\n * ```\n */\nexport class ConnectorTools {\n  /** Registry of service-specific tool factories */\n  private static factories = new Map<string, ServiceToolFactory>();\n\n  /** Cache for detected service types (connector name -> service type) */\n  private static serviceTypeCache = new Map<string, string | undefined>();\n\n  /** Cache for generated tools (cacheKey -> tools) */\n  private static toolCache = new Map<string, ToolFunction[]>();\n\n  /** Maximum cache size to prevent memory issues */\n  private static readonly MAX_CACHE_SIZE = 100;\n\n  /**\n   * Clear all caches (useful for testing or when connectors change)\n   */\n  static clearCache(): void {\n    this.serviceTypeCache.clear();\n    this.toolCache.clear();\n  }\n\n  /**\n   * Invalidate cache for a specific connector\n   */\n  static invalidateCache(connectorName: string): void {\n    this.serviceTypeCache.delete(connectorName);\n    // Remove all tool cache entries for this connector\n    for (const key of this.toolCache.keys()) {\n      if (key.startsWith(`${connectorName}:`)) {\n        this.toolCache.delete(key);\n      }\n    }\n  }\n\n  /**\n   * Register a tool factory for a service type\n   *\n   * @param serviceType - Service identifier (e.g., 'slack', 'github')\n   * @param factory - Function that creates tools from a Connector\n   *\n   * @example\n   * ```typescript\n   * ConnectorTools.registerService('slack', (connector) => [\n   *   createSlackSendMessageTool(connector),\n   *   createSlackListChannelsTool(connector),\n   * ]);\n   * ```\n   */\n  static registerService(serviceType: string, factory: ServiceToolFactory): void {\n    this.factories.set(serviceType, factory);\n  }\n\n  /**\n   * Unregister a service tool factory\n   */\n  static unregisterService(serviceType: string): boolean {\n    return this.factories.delete(serviceType);\n  }\n\n  /**\n   * Get ALL tools for a connector (generic API + service-specific)\n   * This is the main entry point\n   *\n   * @param connectorOrName - Connector instance or name\n   * @param userId - Optional user ID for multi-user OAuth\n   * @returns Array of tools\n   *\n   * @example\n   * ```typescript\n   * const tools = ConnectorTools.for('slack');\n   * // Returns: [slack_api, slack_send_message, slack_list_channels, ...]\n   * ```\n   */\n  static for(connectorOrName: Connector | string, userId?: string): ToolFunction[] {\n    const connector = this.resolveConnector(connectorOrName);\n    const tools: ToolFunction[] = [];\n\n    // 1. Always include generic API tool if baseURL exists\n    if (connector.baseURL) {\n      tools.push(this.createGenericAPITool(connector, { userId }));\n    }\n\n    // 2. Add service-specific tools if factory exists\n    const serviceType = this.detectService(connector);\n    if (serviceType && this.factories.has(serviceType)) {\n      const factory = this.factories.get(serviceType)!;\n      tools.push(...factory(connector, userId));\n    }\n\n    return tools;\n  }\n\n  /**\n   * Get just the generic API tool for a connector\n   *\n   * @param connectorOrName - Connector instance or name\n   * @param options - Optional configuration\n   * @returns Generic API tool\n   *\n   * @example\n   * ```typescript\n   * const apiTool = ConnectorTools.genericAPI('github');\n   * ```\n   */\n  static genericAPI(\n    connectorOrName: Connector | string,\n    options?: GenericAPIToolOptions\n  ): ToolFunction<GenericAPICallArgs, GenericAPICallResult> {\n    const connector = this.resolveConnector(connectorOrName);\n    return this.createGenericAPITool(connector, options);\n  }\n\n  /**\n   * Get only service-specific tools (no generic API tool)\n   *\n   * @param connectorOrName - Connector instance or name\n   * @param userId - Optional user ID for multi-user OAuth\n   * @returns Service-specific tools only\n   */\n  static serviceTools(connectorOrName: Connector | string, userId?: string): ToolFunction[] {\n    const connector = this.resolveConnector(connectorOrName);\n    const serviceType = this.detectService(connector);\n\n    if (!serviceType || !this.factories.has(serviceType)) {\n      return [];\n    }\n\n    return this.factories.get(serviceType)!(connector, userId);\n  }\n\n  /**\n   * Discover tools for ALL registered connectors with external services\n   * Skips AI provider connectors (those with vendor but no serviceType)\n   *\n   * @param userId - Optional user ID for multi-user OAuth\n   * @returns Map of connector name to tools\n   *\n   * @example\n   * ```typescript\n   * const allTools = ConnectorTools.discoverAll();\n   * for (const [name, tools] of allTools) {\n   *   agent.tools.registerMany(tools, { namespace: name });\n   * }\n   * ```\n   */\n  static discoverAll(userId?: string): Map<string, ToolFunction[]> {\n    const result = new Map<string, ToolFunction[]>();\n\n    for (const connector of Connector.listAll()) {\n      // Include connectors that:\n      // 1. Have explicit serviceType, OR\n      // 2. Have baseURL but no vendor (external API, not AI provider)\n      const hasServiceType = !!connector.config.serviceType;\n      const isExternalAPI = connector.baseURL && !connector.vendor;\n\n      if (hasServiceType || isExternalAPI) {\n        const tools = this.for(connector, userId);\n        if (tools.length > 0) {\n          result.set(connector.name, tools);\n        }\n      }\n    }\n\n    return result;\n  }\n\n  /**\n   * Find a connector by service type\n   * Returns the first connector matching the service type\n   *\n   * @param serviceType - Service identifier\n   * @returns Connector or undefined\n   */\n  static findConnector(serviceType: string): Connector | undefined {\n    return Connector.listAll().find((c) => this.detectService(c) === serviceType);\n  }\n\n  /**\n   * Find all connectors for a service type\n   * Useful when you have multiple connectors for the same service\n   *\n   * @param serviceType - Service identifier\n   * @returns Array of matching connectors\n   */\n  static findConnectors(serviceType: string): Connector[] {\n    return Connector.listAll().filter((c) => this.detectService(c) === serviceType);\n  }\n\n  /**\n   * List services that have registered tool factories\n   */\n  static listSupportedServices(): string[] {\n    return Array.from(this.factories.keys());\n  }\n\n  /**\n   * Check if a service has dedicated tool factory\n   */\n  static hasServiceTools(serviceType: string): boolean {\n    return this.factories.has(serviceType);\n  }\n\n  /**\n   * Detect the service type for a connector\n   * Uses explicit serviceType if set, otherwise infers from baseURL\n   * Results are cached for performance\n   */\n  static detectService(connector: Connector): string | undefined {\n    // Check cache first\n    const cacheKey = connector.name;\n    if (this.serviceTypeCache.has(cacheKey)) {\n      return this.serviceTypeCache.get(cacheKey);\n    }\n\n    let result: string | undefined;\n\n    // 1. Explicit serviceType takes precedence\n    if (connector.config.serviceType) {\n      result = connector.config.serviceType;\n    }\n    // 2. Infer from baseURL patterns\n    else if (connector.baseURL) {\n      result = detectServiceFromURL(connector.baseURL);\n    }\n\n    // Cache the result (even if undefined)\n    this.maintainCacheSize(this.serviceTypeCache);\n    this.serviceTypeCache.set(cacheKey, result);\n\n    return result;\n  }\n\n  /**\n   * Maintain cache size to prevent memory leaks\n   */\n  private static maintainCacheSize<K, V>(cache: Map<K, V>): void {\n    if (cache.size >= this.MAX_CACHE_SIZE) {\n      // Remove oldest entries (first 10%)\n      const toRemove = Math.ceil(this.MAX_CACHE_SIZE * 0.1);\n      const keys = Array.from(cache.keys()).slice(0, toRemove);\n      for (const key of keys) {\n        cache.delete(key);\n      }\n    }\n  }\n\n  // ============ Private Methods ============\n\n  private static resolveConnector(connectorOrName: Connector | string): Connector {\n    return typeof connectorOrName === 'string' ? Connector.get(connectorOrName) : connectorOrName;\n  }\n\n  private static createGenericAPITool(\n    connector: Connector,\n    options?: GenericAPIToolOptions\n  ): ToolFunction<GenericAPICallArgs, GenericAPICallResult> {\n    const toolName = options?.toolName ?? `${connector.name}_api`;\n    const userId = options?.userId;\n\n    const description =\n      options?.description ??\n      `Make an authenticated API call to ${connector.displayName}.` +\n        (connector.baseURL ? ` Base URL: ${connector.baseURL}` : ' Provide full URL in endpoint.');\n\n    return {\n      definition: {\n        type: 'function',\n        function: {\n          name: toolName,\n          description,\n          parameters: {\n            type: 'object',\n            properties: {\n              method: {\n                type: 'string',\n                enum: ['GET', 'POST', 'PUT', 'DELETE', 'PATCH'],\n                description: 'HTTP method',\n              },\n              endpoint: {\n                type: 'string',\n                description: 'API endpoint (relative to base URL) or full URL',\n              },\n              body: {\n                type: 'object',\n                description: 'Request body (for POST/PUT/PATCH)',\n              },\n              queryParams: {\n                type: 'object',\n                description: 'URL query parameters',\n              },\n              headers: {\n                type: 'object',\n                description: 'Additional request headers',\n              },\n            },\n            required: ['method', 'endpoint'],\n          },\n        },\n      },\n\n      execute: async (args: GenericAPICallArgs): Promise<GenericAPICallResult> => {\n        let url = args.endpoint;\n\n        // Add query params if provided\n        if (args.queryParams && Object.keys(args.queryParams).length > 0) {\n          const params = new URLSearchParams();\n          for (const [key, value] of Object.entries(args.queryParams)) {\n            params.append(key, String(value));\n          }\n          url += (url.includes('?') ? '&' : '?') + params.toString();\n        }\n\n        // Filter out protected headers (security: prevent auth header override)\n        const safeHeaders = filterProtectedHeaders(args.headers);\n\n        // Safely stringify body (handles circular references)\n        let bodyStr: string | undefined;\n        if (args.body) {\n          try {\n            bodyStr = safeStringify(args.body);\n          } catch (e) {\n            return {\n              success: false,\n              error: `Failed to serialize request body: ${e instanceof Error ? e.message : String(e)}`,\n            };\n          }\n        }\n\n        try {\n          const response = await connector.fetch(\n            url,\n            {\n              method: args.method,\n              headers: {\n                'Content-Type': 'application/json',\n                ...safeHeaders,\n              },\n              body: bodyStr,\n            },\n            userId\n          );\n\n          // Try to parse as JSON\n          const text = await response.text();\n          let data: unknown;\n\n          try {\n            data = JSON.parse(text);\n          } catch {\n            data = text;\n          }\n\n          return {\n            success: response.ok,\n            status: response.status,\n            data: response.ok ? data : undefined,\n            error: response.ok ? undefined : typeof data === 'string' ? data : safeStringify(data),\n          };\n        } catch (error) {\n          return {\n            success: false,\n            error: error instanceof Error ? error.message : String(error),\n          };\n        }\n      },\n\n      describeCall: (args: GenericAPICallArgs) => `${args.method} ${args.endpoint}`,\n\n      permission: options?.permission ?? {\n        scope: 'session',\n        riskLevel: 'medium',\n        approvalMessage: `This will make an API call to ${connector.displayName}`,\n      },\n    };\n  }\n}\n","/**\n * OAuth 2.0 Authentication for Connectors\n */\n\nexport { OAuthManager } from './OAuthManager.js';\n\nexport type {\n  OAuthConfig,\n  OAuthFlow,\n  TokenResponse,\n  StoredToken,\n} from './types.js';\n","/**\n * Connectors - OAuth and authentication utilities\n *\n * Provides OAuth 2.0 infrastructure for authenticated API access.\n * Use Connector.create() from '@oneringai/agents' for connector registration.\n *\n * Supports:\n * - OAuth 2.0 (Authorization Code + PKCE, Client Credentials, JWT Bearer)\n * - API Keys\n * - JWT Bearer tokens\n */\n\n// OAuth manager\nexport {\n  OAuthManager,\n} from './oauth/index.js';\n\nexport type {\n  OAuthConfig,\n  OAuthFlow,\n  TokenResponse,\n  StoredToken,\n} from './oauth/types.js';\n\nexport type { ITokenStorage } from './oauth/domain/ITokenStorage.js';\n\n// Storage implementations\nexport { MemoryStorage } from './oauth/infrastructure/storage/MemoryStorage.js';\nexport { FileStorage } from './oauth/infrastructure/storage/FileStorage.js';\nexport type { FileStorageConfig } from './oauth/infrastructure/storage/FileStorage.js';\n\n// Utilities\nexport { authenticatedFetch, createAuthenticatedFetch } from './authenticatedFetch.js';\nexport { generateWebAPITool } from './toolGenerator.js';\n\n// OAuth utilities (for advanced users)\nexport { generatePKCE, generateState } from './oauth/utils/pkce.js';\nexport { encrypt, decrypt, generateEncryptionKey } from './oauth/utils/encryption.js';\n\n// ConnectorConfig storage (for persistent connector configs)\nexport {\n  ConnectorConfigStore,\n  MemoryConnectorStorage,\n  FileConnectorStorage,\n  CONNECTOR_CONFIG_VERSION,\n} from './storage/index.js';\nexport type {\n  IConnectorConfigStorage,\n  StoredConnectorConfig,\n  FileConnectorStorageConfig,\n} from './storage/index.js';\n","/**\n * File-based token storage\n * Tokens are encrypted and stored in individual files with restrictive permissions\n */\n\nimport * as fs from 'fs/promises';\nimport * as path from 'path';\nimport * as crypto from 'crypto';\nimport { ITokenStorage, StoredToken } from '../../domain/ITokenStorage.js';\nimport { encrypt, decrypt } from '../../utils/encryption.js';\n\nexport interface FileStorageConfig {\n  directory: string; // Directory to store token files\n  encryptionKey: string; // Encryption key (REQUIRED - do not use auto-generated key!)\n}\n\nexport class FileStorage implements ITokenStorage {\n  private directory: string;\n  private encryptionKey: string;\n\n  constructor(config: FileStorageConfig) {\n    if (!config.encryptionKey) {\n      throw new Error(\n        'FileStorage requires an encryption key. Set OAUTH_ENCRYPTION_KEY in environment or provide config.encryptionKey'\n      );\n    }\n\n    this.directory = config.directory;\n    this.encryptionKey = config.encryptionKey;\n\n    // Ensure directory exists (async, don't block constructor)\n    this.ensureDirectory().catch((error) => {\n      console.error('Failed to create token directory:', error);\n    });\n  }\n\n  private async ensureDirectory(): Promise<void> {\n    try {\n      await fs.mkdir(this.directory, { recursive: true });\n      // Set directory permissions (owner only)\n      await fs.chmod(this.directory, 0o700);\n    } catch (error) {\n      // Directory might already exist, that's okay\n    }\n  }\n\n  /**\n   * Get file path for a token key (hashed for security)\n   */\n  private getFilePath(key: string): string {\n    // Hash the key for filename (prevents exposing sensitive key names)\n    const hash = crypto.createHash('sha256').update(key).digest('hex');\n    return path.join(this.directory, `${hash}.token`);\n  }\n\n  async storeToken(key: string, token: StoredToken): Promise<void> {\n    await this.ensureDirectory();\n\n    const filePath = this.getFilePath(key);\n    const plaintext = JSON.stringify(token);\n    const encrypted = encrypt(plaintext, this.encryptionKey);\n\n    // Write encrypted token to file\n    await fs.writeFile(filePath, encrypted, 'utf8');\n\n    // Set restrictive permissions (owner read/write only)\n    await fs.chmod(filePath, 0o600);\n  }\n\n  async getToken(key: string): Promise<StoredToken | null> {\n    const filePath = this.getFilePath(key);\n\n    try {\n      const encrypted = await fs.readFile(filePath, 'utf8');\n      const decrypted = decrypt(encrypted, this.encryptionKey);\n      return JSON.parse(decrypted) as StoredToken;\n    } catch (error: any) {\n      if (error.code === 'ENOENT') {\n        // File doesn't exist\n        return null;\n      }\n\n      console.error('Failed to read/decrypt token file:', error);\n\n      // Remove corrupted file\n      try {\n        await fs.unlink(filePath);\n      } catch {\n        // Ignore unlink errors\n      }\n\n      return null;\n    }\n  }\n\n  async deleteToken(key: string): Promise<void> {\n    const filePath = this.getFilePath(key);\n\n    try {\n      await fs.unlink(filePath);\n    } catch (error: any) {\n      if (error.code !== 'ENOENT') {\n        throw error;\n      }\n      // File doesn't exist, that's okay\n    }\n  }\n\n  async hasToken(key: string): Promise<boolean> {\n    const filePath = this.getFilePath(key);\n\n    try {\n      await fs.access(filePath);\n      return true;\n    } catch {\n      return false;\n    }\n  }\n\n  /**\n   * List all token keys (for debugging)\n   */\n  async listTokens(): Promise<string[]> {\n    try {\n      const files = await fs.readdir(this.directory);\n      return files.filter((f) => f.endsWith('.token')).map((f) => f.replace('.token', ''));\n    } catch {\n      return [];\n    }\n  }\n\n  /**\n   * Clear all tokens\n   */\n  async clearAll(): Promise<void> {\n    try {\n      const files = await fs.readdir(this.directory);\n      const tokenFiles = files.filter((f) => f.endsWith('.token'));\n\n      await Promise.all(\n        tokenFiles.map((f) => fs.unlink(path.join(this.directory, f)).catch(() => {}))\n      );\n    } catch {\n      // Directory doesn't exist or can't read, that's okay\n    }\n  }\n}\n","/**\n * Authenticated Fetch - Drop-in replacement for fetch() with OAuth authentication\n */\n\nimport { Connector } from '../core/Connector.js';\n\n/**\n * Fetch with automatic OAuth authentication\n *\n * Same API as standard fetch(), but with additional authProvider and optional userId parameters.\n * The OAuth token is automatically retrieved and injected into the Authorization header.\n *\n * @param url - URL to fetch (string or URL object)\n * @param options - Standard fetch options\n * @param authProvider - Name of registered OAuth provider (e.g., 'microsoft', 'google')\n * @param userId - Optional user identifier for multi-user support (omit for single-user mode)\n * @returns Promise<Response> - Same as standard fetch\n *\n * @example Single-user mode:\n * ```typescript\n * const response = await authenticatedFetch(\n *   'https://graph.microsoft.com/v1.0/me',\n *   { method: 'GET' },\n *   'microsoft'\n * );\n * const data = await response.json();\n * ```\n *\n * @example Multi-user mode:\n * ```typescript\n * const response = await authenticatedFetch(\n *   'https://api.github.com/user/repos',\n *   { method: 'GET' },\n *   'github',\n *   'user123'  // Get token for specific user\n * );\n * const repos = await response.json();\n * ```\n */\nexport async function authenticatedFetch(\n  url: string | URL,\n  options: RequestInit | undefined,\n  authProvider: string,\n  userId?: string\n): Promise<Response> {\n  // Get connector from registry\n  const connector = Connector.get(authProvider);\n\n  // Get OAuth token for the user (automatically refreshed if needed)\n  const token = await connector.getToken(userId);\n\n  // Merge headers (don't mutate original options)\n  const authOptions: RequestInit = {\n    ...options,\n    headers: {\n      ...options?.headers,\n      Authorization: `Bearer ${token}`,\n    },\n  };\n\n  // Call standard fetch with authenticated headers\n  return fetch(url, authOptions);\n}\n\n/**\n * Create an authenticated fetch function bound to a specific provider and optionally a user\n *\n * Useful for creating reusable fetch functions for a specific API and/or user.\n *\n * @param authProvider - Name of registered OAuth provider\n * @param userId - Optional user identifier to bind to (omit for single-user mode)\n * @returns Fetch function bound to that provider (and user)\n *\n * @example Single-user mode:\n * ```typescript\n * const msftFetch = createAuthenticatedFetch('microsoft');\n *\n * // Use like normal fetch (auth automatic)\n * const me = await msftFetch('https://graph.microsoft.com/v1.0/me');\n * const emails = await msftFetch('https://graph.microsoft.com/v1.0/me/messages');\n * ```\n *\n * @example Multi-user mode (bound to specific user):\n * ```typescript\n * // Create fetch function for Alice\n * const aliceFetch = createAuthenticatedFetch('github', 'user123');\n *\n * // All calls automatically use Alice's token\n * const repos = await aliceFetch('https://api.github.com/user/repos');\n * const issues = await aliceFetch('https://api.github.com/user/issues');\n *\n * // Create fetch function for Bob (separate tokens!)\n * const bobFetch = createAuthenticatedFetch('github', 'user456');\n * const bobRepos = await bobFetch('https://api.github.com/user/repos');\n * ```\n *\n * @example Multi-user mode (userId per-call):\n * ```typescript\n * // Create fetch function NOT bound to a user\n * const githubFetch = createAuthenticatedFetch('github');\n *\n * // Specify userId at call time\n * const aliceRepos = await githubFetch(\n *   'https://api.github.com/user/repos',\n *   { userId: 'user123' }  // Pass as custom option\n * );\n * ```\n */\nexport function createAuthenticatedFetch(\n  authProvider: string,\n  userId?: string\n): (url: string | URL, options?: RequestInit) => Promise<Response> {\n  // Validate provider exists at creation time\n  Connector.get(authProvider);\n\n  return async (url: string | URL, options?: RequestInit) => {\n    return authenticatedFetch(url, options, authProvider, userId);\n  };\n}\n","/**\n * Tool Generator - Auto-generate tools for registered connectors\n */\n\nimport { ToolFunction } from '../domain/entities/Tool.js';\nimport { Connector } from '../core/Connector.js';\nimport { authenticatedFetch } from './authenticatedFetch.js';\n\ninterface APIRequestArgs {\n  authProvider: string;\n  url: string;\n  method?: 'GET' | 'POST' | 'PUT' | 'DELETE' | 'PATCH';\n  body?: any;\n  headers?: Record<string, string>;\n}\n\ninterface APIRequestResult {\n  success: boolean;\n  status: number;\n  statusText: string;\n  data: any;\n  error?: string;\n}\n\n/**\n * Generate a universal API request tool for all registered OAuth providers\n *\n * This tool allows the AI agent to make authenticated requests to any registered API.\n * The tool description is dynamically generated based on registered providers.\n *\n * @returns ToolFunction that can call any registered OAuth API\n */\nexport function generateWebAPITool(): ToolFunction<APIRequestArgs, APIRequestResult> {\n  return {\n    definition: {\n      type: 'function',\n      function: {\n        name: 'api_request',\n        description: `Make authenticated HTTP request to any registered OAuth API.\n\nThis tool automatically handles OAuth authentication for registered providers.\n\nREGISTERED PROVIDERS:\n${Connector.getDescriptionsForTools()}\n\nHOW TO USE:\n1. Choose the appropriate authProvider based on which API you need to access\n2. Provide the URL (full URL or path relative to provider's baseURL)\n3. Specify the HTTP method (GET, POST, etc.)\n4. For POST/PUT/PATCH, include the request body\n\nEXAMPLES:\nRead Microsoft emails:\n{\n  authProvider: \"microsoft\",\n  url: \"/v1.0/me/messages\",\n  method: \"GET\"\n}\n\nList GitHub repositories:\n{\n  authProvider: \"github\",\n  url: \"/user/repos\",\n  method: \"GET\"\n}\n\nCreate Salesforce account:\n{\n  authProvider: \"salesforce\",\n  url: \"/services/data/v57.0/sobjects/Account\",\n  method: \"POST\",\n  body: { Name: \"Acme Corp\", Industry: \"Technology\" }\n}`,\n\n        parameters: {\n          type: 'object',\n          properties: {\n            authProvider: {\n              type: 'string',\n              enum: Connector.list(),\n              description:\n                'Which connector to use for authentication. Choose based on the API you need to access.',\n            },\n            url: {\n              type: 'string',\n              description:\n                'URL to request. Can be full URL (https://...) or path relative to provider baseURL (e.g., \"/v1.0/me\")',\n            },\n            method: {\n              type: 'string',\n              enum: ['GET', 'POST', 'PUT', 'DELETE', 'PATCH'],\n              description: 'HTTP method (default: GET)',\n            },\n            body: {\n              description:\n                'Request body for POST/PUT/PATCH requests. Will be JSON-stringified automatically.',\n            },\n            headers: {\n              type: 'object',\n              description:\n                'Additional headers to include. Authorization header is added automatically.',\n            },\n          },\n          required: ['authProvider', 'url'],\n        },\n      },\n      blocking: true,\n      timeout: 30000,\n    },\n\n    execute: async (args: APIRequestArgs): Promise<APIRequestResult> => {\n      try {\n        // Get connector info\n        const connector = Connector.get(args.authProvider);\n\n        // Build full URL\n        const fullUrl = args.url.startsWith('http')\n          ? args.url\n          : `${connector.baseURL}${args.url}`;\n\n        // Prepare request options\n        const requestOptions: RequestInit = {\n          method: args.method || 'GET',\n          headers: {\n            'Content-Type': 'application/json',\n            ...args.headers,\n          },\n        };\n\n        // Add body for POST/PUT/PATCH\n        if (args.body && (args.method === 'POST' || args.method === 'PUT' || args.method === 'PATCH')) {\n          requestOptions.body = JSON.stringify(args.body);\n        }\n\n        // Make authenticated request\n        const response = await authenticatedFetch(fullUrl, requestOptions, args.authProvider);\n\n        // Get response data\n        const contentType = response.headers.get('content-type') || '';\n        let data: any;\n\n        if (contentType.includes('application/json')) {\n          data = await response.json();\n        } else {\n          data = await response.text();\n        }\n\n        return {\n          success: response.ok,\n          status: response.status,\n          statusText: response.statusText,\n          data,\n        };\n      } catch (error) {\n        return {\n          success: false,\n          status: 0,\n          statusText: 'Error',\n          data: null,\n          error: (error as Error).message,\n        };\n      }\n    },\n  };\n}\n","/**\n * ConnectorConfig Storage Interface (Clean Architecture - Domain Layer)\n *\n * Defines the contract for storing and retrieving ConnectorConfig objects.\n * Storage implementations do NOT handle encryption - that's done by ConnectorConfigStore.\n */\n\nimport type { ConnectorConfig } from '../entities/Connector.js';\n\n/**\n * Wrapper for stored connector configuration with metadata\n */\nexport interface StoredConnectorConfig {\n  /** The connector configuration (may contain encrypted fields) */\n  config: ConnectorConfig;\n\n  /** Timestamp when the config was first stored */\n  createdAt: number;\n\n  /** Timestamp when the config was last updated */\n  updatedAt: number;\n\n  /** Schema version for future migrations */\n  version: number;\n}\n\n/**\n * Storage interface for ConnectorConfig persistence\n *\n * Implementations should:\n * - Store data as-is (encryption is handled by ConnectorConfigStore)\n * - Use appropriate file permissions for file-based storage\n * - Hash names for filenames to prevent enumeration attacks\n */\nexport interface IConnectorConfigStorage {\n  /**\n   * Save a connector configuration\n   *\n   * @param name - Unique identifier for this connector\n   * @param stored - The stored config with metadata\n   */\n  save(name: string, stored: StoredConnectorConfig): Promise<void>;\n\n  /**\n   * Retrieve a connector configuration by name\n   *\n   * @param name - Unique identifier for the connector\n   * @returns The stored config or null if not found\n   */\n  get(name: string): Promise<StoredConnectorConfig | null>;\n\n  /**\n   * Delete a connector configuration\n   *\n   * @param name - Unique identifier for the connector\n   * @returns True if deleted, false if not found\n   */\n  delete(name: string): Promise<boolean>;\n\n  /**\n   * Check if a connector configuration exists\n   *\n   * @param name - Unique identifier for the connector\n   * @returns True if exists\n   */\n  has(name: string): Promise<boolean>;\n\n  /**\n   * List all connector names\n   *\n   * @returns Array of connector names\n   */\n  list(): Promise<string[]>;\n\n  /**\n   * Get all stored connector configurations\n   *\n   * @returns Array of all stored configs\n   */\n  listAll(): Promise<StoredConnectorConfig[]>;\n}\n\n/** Current schema version */\nexport const CONNECTOR_CONFIG_VERSION = 1;\n","/**\n * ConnectorConfigStore - Domain service for storing ConnectorConfig with encryption\n *\n * Handles encryption/decryption of sensitive fields uniformly,\n * regardless of which storage backend is used.\n */\n\nimport type { ConnectorConfig, ConnectorAuth } from '../../domain/entities/Connector.js';\nimport type {\n  IConnectorConfigStorage,\n  StoredConnectorConfig,\n} from '../../domain/interfaces/IConnectorConfigStorage.js';\nimport { CONNECTOR_CONFIG_VERSION } from '../../domain/interfaces/IConnectorConfigStorage.js';\nimport { encrypt, decrypt } from '../oauth/utils/encryption.js';\n\n/** Prefix for encrypted values */\nconst ENCRYPTED_PREFIX = '$ENC$:';\n\n/**\n * ConnectorConfigStore - manages connector configs with automatic encryption\n *\n * Usage:\n * ```typescript\n * const storage = new MemoryConnectorStorage();\n * const store = new ConnectorConfigStore(storage, process.env.ENCRYPTION_KEY!);\n *\n * await store.save('openai', { auth: { type: 'api_key', apiKey: 'sk-xxx' } });\n * const config = await store.get('openai'); // apiKey is decrypted\n * ```\n */\nexport class ConnectorConfigStore {\n  constructor(\n    private storage: IConnectorConfigStorage,\n    private encryptionKey: string\n  ) {\n    if (!encryptionKey || encryptionKey.length < 16) {\n      throw new Error(\n        'ConnectorConfigStore requires an encryption key of at least 16 characters'\n      );\n    }\n  }\n\n  /**\n   * Save a connector configuration (secrets are encrypted automatically)\n   *\n   * @param name - Unique identifier for this connector\n   * @param config - The connector configuration\n   */\n  async save(name: string, config: ConnectorConfig): Promise<void> {\n    if (!name || name.trim().length === 0) {\n      throw new Error('Connector name is required');\n    }\n\n    const existing = await this.storage.get(name);\n    const now = Date.now();\n\n    const encryptedConfig = this.encryptSecrets(config);\n\n    const stored: StoredConnectorConfig = {\n      config: { ...encryptedConfig, name },\n      createdAt: existing?.createdAt ?? now,\n      updatedAt: now,\n      version: CONNECTOR_CONFIG_VERSION,\n    };\n\n    await this.storage.save(name, stored);\n  }\n\n  /**\n   * Retrieve a connector configuration (secrets are decrypted automatically)\n   *\n   * @param name - Unique identifier for the connector\n   * @returns The decrypted config or null if not found\n   */\n  async get(name: string): Promise<ConnectorConfig | null> {\n    const stored = await this.storage.get(name);\n    if (!stored) {\n      return null;\n    }\n\n    return this.decryptSecrets(stored.config);\n  }\n\n  /**\n   * Delete a connector configuration\n   *\n   * @param name - Unique identifier for the connector\n   * @returns True if deleted, false if not found\n   */\n  async delete(name: string): Promise<boolean> {\n    return this.storage.delete(name);\n  }\n\n  /**\n   * Check if a connector configuration exists\n   *\n   * @param name - Unique identifier for the connector\n   * @returns True if exists\n   */\n  async has(name: string): Promise<boolean> {\n    return this.storage.has(name);\n  }\n\n  /**\n   * List all connector names\n   *\n   * @returns Array of connector names\n   */\n  async list(): Promise<string[]> {\n    return this.storage.list();\n  }\n\n  /**\n   * Get all connector configurations (secrets are decrypted automatically)\n   *\n   * @returns Array of decrypted configs\n   */\n  async listAll(): Promise<ConnectorConfig[]> {\n    const stored = await this.storage.listAll();\n    return stored.map((s) => this.decryptSecrets(s.config));\n  }\n\n  /**\n   * Get stored metadata for a connector\n   *\n   * @param name - Unique identifier for the connector\n   * @returns Metadata (createdAt, updatedAt, version) or null\n   */\n  async getMetadata(\n    name: string\n  ): Promise<{ createdAt: number; updatedAt: number; version: number } | null> {\n    const stored = await this.storage.get(name);\n    if (!stored) {\n      return null;\n    }\n    return {\n      createdAt: stored.createdAt,\n      updatedAt: stored.updatedAt,\n      version: stored.version,\n    };\n  }\n\n  // ============ Encryption Helpers ============\n\n  /**\n   * Encrypt sensitive fields in a ConnectorConfig\n   * Fields encrypted: apiKey, clientSecret, privateKey\n   */\n  private encryptSecrets(config: ConnectorConfig): ConnectorConfig {\n    const result = { ...config };\n\n    if (result.auth) {\n      result.auth = this.encryptAuthSecrets(result.auth);\n    }\n\n    return result;\n  }\n\n  /**\n   * Decrypt sensitive fields in a ConnectorConfig\n   */\n  private decryptSecrets(config: ConnectorConfig): ConnectorConfig {\n    const result = { ...config };\n\n    if (result.auth) {\n      result.auth = this.decryptAuthSecrets(result.auth);\n    }\n\n    return result;\n  }\n\n  /**\n   * Encrypt secrets in ConnectorAuth based on auth type\n   */\n  private encryptAuthSecrets(auth: ConnectorAuth): ConnectorAuth {\n    switch (auth.type) {\n      case 'api_key':\n        return {\n          ...auth,\n          apiKey: this.encryptValue(auth.apiKey),\n        };\n\n      case 'oauth':\n        return {\n          ...auth,\n          clientSecret: auth.clientSecret\n            ? this.encryptValue(auth.clientSecret)\n            : undefined,\n          privateKey: auth.privateKey\n            ? this.encryptValue(auth.privateKey)\n            : undefined,\n        };\n\n      case 'jwt':\n        return {\n          ...auth,\n          privateKey: this.encryptValue(auth.privateKey),\n        };\n\n      default:\n        return auth;\n    }\n  }\n\n  /**\n   * Decrypt secrets in ConnectorAuth based on auth type\n   */\n  private decryptAuthSecrets(auth: ConnectorAuth): ConnectorAuth {\n    switch (auth.type) {\n      case 'api_key':\n        return {\n          ...auth,\n          apiKey: this.decryptValue(auth.apiKey),\n        };\n\n      case 'oauth':\n        return {\n          ...auth,\n          clientSecret: auth.clientSecret\n            ? this.decryptValue(auth.clientSecret)\n            : undefined,\n          privateKey: auth.privateKey\n            ? this.decryptValue(auth.privateKey)\n            : undefined,\n        };\n\n      case 'jwt':\n        return {\n          ...auth,\n          privateKey: this.decryptValue(auth.privateKey),\n        };\n\n      default:\n        return auth;\n    }\n  }\n\n  /**\n   * Encrypt a single value if not already encrypted\n   */\n  private encryptValue(value: string): string {\n    if (this.isEncrypted(value)) {\n      return value; // Already encrypted\n    }\n    const encrypted = encrypt(value, this.encryptionKey);\n    return `${ENCRYPTED_PREFIX}${encrypted}`;\n  }\n\n  /**\n   * Decrypt a single value if encrypted\n   */\n  private decryptValue(value: string): string {\n    if (!this.isEncrypted(value)) {\n      return value; // Not encrypted (legacy or plaintext)\n    }\n    const encryptedData = value.slice(ENCRYPTED_PREFIX.length);\n    return decrypt(encryptedData, this.encryptionKey);\n  }\n\n  /**\n   * Check if a value is encrypted (has the $ENC$: prefix)\n   */\n  private isEncrypted(value: string): boolean {\n    return value.startsWith(ENCRYPTED_PREFIX);\n  }\n}\n","/**\n * In-memory storage for ConnectorConfig\n *\n * Simple Map-based storage. No encryption logic here -\n * encryption is handled by ConnectorConfigStore.\n *\n * Useful for:\n * - Testing\n * - Short-lived processes\n * - Development\n *\n * Note: Data is lost when process exits.\n */\n\nimport type {\n  IConnectorConfigStorage,\n  StoredConnectorConfig,\n} from '../../domain/interfaces/IConnectorConfigStorage.js';\n\nexport class MemoryConnectorStorage implements IConnectorConfigStorage {\n  private configs: Map<string, StoredConnectorConfig> = new Map();\n\n  async save(name: string, stored: StoredConnectorConfig): Promise<void> {\n    // Deep clone to prevent external mutation\n    this.configs.set(name, JSON.parse(JSON.stringify(stored)));\n  }\n\n  async get(name: string): Promise<StoredConnectorConfig | null> {\n    const stored = this.configs.get(name);\n    if (!stored) {\n      return null;\n    }\n    // Return a copy to prevent external mutation\n    return JSON.parse(JSON.stringify(stored));\n  }\n\n  async delete(name: string): Promise<boolean> {\n    return this.configs.delete(name);\n  }\n\n  async has(name: string): Promise<boolean> {\n    return this.configs.has(name);\n  }\n\n  async list(): Promise<string[]> {\n    return Array.from(this.configs.keys());\n  }\n\n  async listAll(): Promise<StoredConnectorConfig[]> {\n    // Return copies to prevent external mutation\n    return Array.from(this.configs.values()).map((stored) =>\n      JSON.parse(JSON.stringify(stored))\n    );\n  }\n\n  /**\n   * Clear all stored configs (useful for testing)\n   */\n  clear(): void {\n    this.configs.clear();\n  }\n\n  /**\n   * Get the number of stored configs\n   */\n  size(): number {\n    return this.configs.size;\n  }\n}\n","/**\n * File-based storage for ConnectorConfig\n *\n * Stores each connector config as a JSON file with restrictive permissions.\n * No encryption logic here - encryption is handled by ConnectorConfigStore.\n *\n * File structure:\n * - {directory}/{hash}.connector.json - individual connector files\n * - {directory}/_index.json - maps hashes to names for list()\n */\n\nimport * as fs from 'fs/promises';\nimport * as path from 'path';\nimport * as crypto from 'crypto';\nimport type {\n  IConnectorConfigStorage,\n  StoredConnectorConfig,\n} from '../../domain/interfaces/IConnectorConfigStorage.js';\n\nexport interface FileConnectorStorageConfig {\n  /** Directory to store connector files */\n  directory: string;\n}\n\ninterface IndexFile {\n  /** Maps hash -> name for reverse lookup */\n  connectors: Record<string, string>;\n}\n\nexport class FileConnectorStorage implements IConnectorConfigStorage {\n  private directory: string;\n  private indexPath: string;\n  private initialized = false;\n\n  constructor(config: FileConnectorStorageConfig) {\n    if (!config.directory) {\n      throw new Error('FileConnectorStorage requires a directory path');\n    }\n    this.directory = config.directory;\n    this.indexPath = path.join(this.directory, '_index.json');\n  }\n\n  async save(name: string, stored: StoredConnectorConfig): Promise<void> {\n    await this.ensureDirectory();\n\n    const filePath = this.getFilePath(name);\n    const json = JSON.stringify(stored, null, 2);\n\n    // Write config file\n    await fs.writeFile(filePath, json, 'utf8');\n    await fs.chmod(filePath, 0o600); // Owner read/write only\n\n    // Update index\n    await this.updateIndex(name, 'add');\n  }\n\n  async get(name: string): Promise<StoredConnectorConfig | null> {\n    const filePath = this.getFilePath(name);\n\n    try {\n      const json = await fs.readFile(filePath, 'utf8');\n      return JSON.parse(json) as StoredConnectorConfig;\n    } catch (error: unknown) {\n      const err = error as NodeJS.ErrnoException;\n      if (err.code === 'ENOENT') {\n        return null;\n      }\n      throw error;\n    }\n  }\n\n  async delete(name: string): Promise<boolean> {\n    const filePath = this.getFilePath(name);\n\n    try {\n      await fs.unlink(filePath);\n      await this.updateIndex(name, 'remove');\n      return true;\n    } catch (error: unknown) {\n      const err = error as NodeJS.ErrnoException;\n      if (err.code === 'ENOENT') {\n        return false;\n      }\n      throw error;\n    }\n  }\n\n  async has(name: string): Promise<boolean> {\n    const filePath = this.getFilePath(name);\n\n    try {\n      await fs.access(filePath);\n      return true;\n    } catch {\n      return false;\n    }\n  }\n\n  async list(): Promise<string[]> {\n    const index = await this.loadIndex();\n    return Object.values(index.connectors);\n  }\n\n  async listAll(): Promise<StoredConnectorConfig[]> {\n    const names = await this.list();\n    const results: StoredConnectorConfig[] = [];\n\n    for (const name of names) {\n      const stored = await this.get(name);\n      if (stored) {\n        results.push(stored);\n      }\n    }\n\n    return results;\n  }\n\n  /**\n   * Clear all stored configs (useful for testing)\n   */\n  async clear(): Promise<void> {\n    try {\n      const files = await fs.readdir(this.directory);\n      const connectorFiles = files.filter(\n        (f) => f.endsWith('.connector.json') || f === '_index.json'\n      );\n\n      await Promise.all(\n        connectorFiles.map((f) =>\n          fs.unlink(path.join(this.directory, f)).catch(() => {})\n        )\n      );\n    } catch {\n      // Directory doesn't exist, that's okay\n    }\n  }\n\n  // ============ Private Helpers ============\n\n  /**\n   * Get file path for a connector (hashed for security)\n   */\n  private getFilePath(name: string): string {\n    const hash = this.hashName(name);\n    return path.join(this.directory, `${hash}.connector.json`);\n  }\n\n  /**\n   * Hash connector name to prevent enumeration\n   */\n  private hashName(name: string): string {\n    return crypto.createHash('sha256').update(name).digest('hex').slice(0, 16);\n  }\n\n  /**\n   * Ensure storage directory exists with proper permissions\n   */\n  private async ensureDirectory(): Promise<void> {\n    if (this.initialized) return;\n\n    try {\n      await fs.mkdir(this.directory, { recursive: true });\n      await fs.chmod(this.directory, 0o700); // Owner only\n      this.initialized = true;\n    } catch {\n      // Directory might already exist\n      this.initialized = true;\n    }\n  }\n\n  /**\n   * Load the index file\n   */\n  private async loadIndex(): Promise<IndexFile> {\n    try {\n      const json = await fs.readFile(this.indexPath, 'utf8');\n      return JSON.parse(json) as IndexFile;\n    } catch {\n      return { connectors: {} };\n    }\n  }\n\n  /**\n   * Update the index file\n   */\n  private async updateIndex(\n    name: string,\n    action: 'add' | 'remove'\n  ): Promise<void> {\n    const index = await this.loadIndex();\n    const hash = this.hashName(name);\n\n    if (action === 'add') {\n      index.connectors[hash] = name;\n    } else {\n      delete index.connectors[hash];\n    }\n\n    const json = JSON.stringify(index, null, 2);\n    await fs.writeFile(this.indexPath, json, 'utf8');\n    await fs.chmod(this.indexPath, 0o600);\n  }\n}\n","/**\n * Observability infrastructure exports\n */\n\nexport { FrameworkLogger, logger } from './Logger.js';\nexport type { LogLevel, LoggerConfig, LogEntry } from './Logger.js';\n\nexport {\n  NoOpMetrics,\n  ConsoleMetrics,\n  InMemoryMetrics,\n  createMetricsCollector,\n  metrics,\n  setMetricsCollector,\n} from './Metrics.js';\nexport type { MetricsCollector, MetricTags, MetricsCollectorType } from './Metrics.js';\n","/**\n * Message builder utilities for constructing complex inputs\n */\n\nimport { InputItem, MessageRole } from '../domain/entities/Message.js';\nimport {\n  ContentType,\n  InputTextContent,\n  InputImageContent,\n} from '../domain/entities/Content.js';\n\nexport class MessageBuilder {\n  private messages: InputItem[] = [];\n\n  /**\n   * Add a user text message\n   */\n  addUserMessage(text: string): this {\n    this.messages.push({\n      type: 'message',\n      role: MessageRole.USER,\n      content: [\n        {\n          type: ContentType.INPUT_TEXT,\n          text,\n        },\n      ],\n    });\n    return this;\n  }\n\n  /**\n   * Add a user message with text and images\n   */\n  addUserMessageWithImages(text: string, imageUrls: string[]): this {\n    const content: (InputTextContent | InputImageContent)[] = [\n      {\n        type: ContentType.INPUT_TEXT,\n        text,\n      },\n    ];\n\n    // Add images\n    for (const url of imageUrls) {\n      content.push({\n        type: ContentType.INPUT_IMAGE_URL,\n        image_url: {\n          url,\n          detail: 'auto', // Can be 'auto', 'low', or 'high'\n        },\n      });\n    }\n\n    this.messages.push({\n      type: 'message',\n      role: MessageRole.USER,\n      content,\n    });\n\n    return this;\n  }\n\n  /**\n   * Add an assistant message (for conversation history)\n   */\n  addAssistantMessage(text: string): this {\n    this.messages.push({\n      type: 'message',\n      role: MessageRole.ASSISTANT,\n      content: [\n        {\n          type: ContentType.OUTPUT_TEXT,\n          text,\n          annotations: [],\n        },\n      ],\n    });\n    return this;\n  }\n\n  /**\n   * Add a system/developer message\n   */\n  addDeveloperMessage(text: string): this {\n    this.messages.push({\n      type: 'message',\n      role: MessageRole.DEVELOPER,\n      content: [\n        {\n          type: ContentType.INPUT_TEXT,\n          text,\n        },\n      ],\n    });\n    return this;\n  }\n\n  /**\n   * Build and return the messages array\n   */\n  build(): InputItem[] {\n    return this.messages;\n  }\n\n  /**\n   * Clear all messages\n   */\n  clear(): this {\n    this.messages = [];\n    return this;\n  }\n\n  /**\n   * Get the current message count\n   */\n  count(): number {\n    return this.messages.length;\n  }\n}\n\n/**\n * Helper function to create a simple text message\n */\nexport function createTextMessage(text: string, role: MessageRole = MessageRole.USER): InputItem {\n  return {\n    type: 'message',\n    role,\n    content: [\n      {\n        type: ContentType.INPUT_TEXT,\n        text,\n      },\n    ],\n  };\n}\n\n/**\n * Helper function to create a message with images\n */\nexport function createMessageWithImages(\n  text: string,\n  imageUrls: string[],\n  role: MessageRole = MessageRole.USER\n): InputItem {\n  const content: (InputTextContent | InputImageContent)[] = [\n    {\n      type: ContentType.INPUT_TEXT,\n      text,\n    },\n  ];\n\n  for (const url of imageUrls) {\n    content.push({\n      type: ContentType.INPUT_IMAGE_URL,\n      image_url: {\n        url,\n        detail: 'auto',\n      },\n    });\n  }\n\n  return {\n    type: 'message',\n    role,\n    content,\n  };\n}\n","/**\n * Clipboard image utilities\n * Reads images from clipboard (supports Mac, Linux, Windows)\n */\n\nimport { exec } from 'child_process';\nimport { promisify } from 'util';\nimport * as fs from 'fs';\nimport * as os from 'os';\nimport * as path from 'path';\n\nconst execAsync = promisify(exec);\n\n/**\n * Safely clean up a temp file, ignoring errors\n */\nfunction cleanupTempFile(filePath: string): void {\n  try {\n    if (fs.existsSync(filePath)) {\n      fs.unlinkSync(filePath);\n    }\n  } catch {\n    // Ignore cleanup errors - temp directory will eventually clean up\n  }\n}\n\nexport interface ClipboardImageResult {\n  success: boolean;\n  dataUri?: string;\n  error?: string;\n  format?: string;\n}\n\n/**\n * Read image from clipboard and convert to data URI\n */\nexport async function readClipboardImage(): Promise<ClipboardImageResult> {\n  const platform = os.platform();\n\n  try {\n    switch (platform) {\n      case 'darwin': // macOS\n        return await readClipboardImageMac();\n      case 'linux':\n        return await readClipboardImageLinux();\n      case 'win32':\n        return await readClipboardImageWindows();\n      default:\n        return {\n          success: false,\n          error: `Unsupported platform: ${platform}`,\n        };\n    }\n  } catch (error: any) {\n    return {\n      success: false,\n      error: error.message,\n    };\n  }\n}\n\n/**\n * Read clipboard image on macOS\n */\nasync function readClipboardImageMac(): Promise<ClipboardImageResult> {\n  const tempFile = path.join(os.tmpdir(), `clipboard-${Date.now()}.png`);\n\n  try {\n    // Try pngpaste first (brew install pngpaste)\n    try {\n      await execAsync(`pngpaste \"${tempFile}\"`);\n      return await convertFileToDataUri(tempFile);\n    } catch (pngpasteError) {\n      // pngpaste not installed, try osascript\n      const script = `\n        set theFile to (POSIX file \"${tempFile}\")\n        try\n          set theImage to the clipboard as class PNGf\n          set fileRef to open for access theFile with write permission\n          write theImage to fileRef\n          close access fileRef\n          return \"success\"\n        on error errMsg\n          try\n            close access theFile\n          end try\n          error errMsg\n        end try\n      `;\n\n      const { stdout } = await execAsync(`osascript -e '${script}'`);\n\n      if (stdout.includes('success') || fs.existsSync(tempFile)) {\n        return await convertFileToDataUri(tempFile);\n      }\n\n      return {\n        success: false,\n        error: 'No image found in clipboard. Try copying an image first (Cmd+C or screenshot with Cmd+Ctrl+Shift+4)',\n      };\n    }\n  } finally {\n    // Always clean up temp file\n    cleanupTempFile(tempFile);\n  }\n}\n\n/**\n * Read clipboard image on Linux\n */\nasync function readClipboardImageLinux(): Promise<ClipboardImageResult> {\n  const tempFile = path.join(os.tmpdir(), `clipboard-${Date.now()}.png`);\n\n  try {\n    // Try xclip\n    try {\n      await execAsync(`xclip -selection clipboard -t image/png -o > \"${tempFile}\"`);\n      if (fs.existsSync(tempFile) && fs.statSync(tempFile).size > 0) {\n        return await convertFileToDataUri(tempFile);\n      }\n    } catch {\n      // xclip not available or failed\n    }\n\n    // Try wl-paste (Wayland)\n    try {\n      await execAsync(`wl-paste -t image/png > \"${tempFile}\"`);\n      if (fs.existsSync(tempFile) && fs.statSync(tempFile).size > 0) {\n        return await convertFileToDataUri(tempFile);\n      }\n    } catch {\n      // wl-paste not available or failed\n    }\n\n    return {\n      success: false,\n      error: 'No image in clipboard. Install xclip (X11) or wl-clipboard (Wayland)',\n    };\n  } finally {\n    // Always clean up temp file\n    cleanupTempFile(tempFile);\n  }\n}\n\n/**\n * Read clipboard image on Windows\n */\nasync function readClipboardImageWindows(): Promise<ClipboardImageResult> {\n  const tempFile = path.join(os.tmpdir(), `clipboard-${Date.now()}.png`);\n\n  try {\n    // PowerShell script to save clipboard image\n    const psScript = `\n      Add-Type -AssemblyName System.Windows.Forms;\n      $clip = [System.Windows.Forms.Clipboard]::GetImage();\n      if ($clip -ne $null) {\n        $clip.Save('${tempFile.replace(/\\\\/g, '\\\\\\\\')}', [System.Drawing.Imaging.ImageFormat]::Png);\n        Write-Output 'success';\n      } else {\n        Write-Error 'No image in clipboard';\n      }\n    `;\n\n    await execAsync(`powershell -Command \"${psScript}\"`);\n\n    if (fs.existsSync(tempFile) && fs.statSync(tempFile).size > 0) {\n      return await convertFileToDataUri(tempFile);\n    }\n\n    return {\n      success: false,\n      error: 'No image found in clipboard',\n    };\n  } finally {\n    // Always clean up temp file\n    cleanupTempFile(tempFile);\n  }\n}\n\n/**\n * Convert image file to data URI\n * Note: Caller is responsible for temp file cleanup via finally block\n */\nasync function convertFileToDataUri(filePath: string): Promise<ClipboardImageResult> {\n  try {\n    const imageBuffer = fs.readFileSync(filePath);\n    const base64Image = imageBuffer.toString('base64');\n\n    // Detect format from file\n    const magic = imageBuffer.slice(0, 4).toString('hex');\n    let mimeType = 'image/png';\n\n    if (magic.startsWith('89504e47')) {\n      mimeType = 'image/png';\n    } else if (magic.startsWith('ffd8ff')) {\n      mimeType = 'image/jpeg';\n    } else if (magic.startsWith('47494638')) {\n      mimeType = 'image/gif';\n    } else if (magic.startsWith('52494646')) {\n      mimeType = 'image/webp';\n    }\n\n    const dataUri = `data:${mimeType};base64,${base64Image}`;\n\n    return {\n      success: true,\n      dataUri,\n      format: mimeType,\n    };\n  } catch (error: any) {\n    return {\n      success: false,\n      error: error.message,\n    };\n  }\n}\n\n/**\n * Check if clipboard contains an image (quick check)\n */\nexport async function hasClipboardImage(): Promise<boolean> {\n  const platform = os.platform();\n\n  try {\n    switch (platform) {\n      case 'darwin':\n        // Check if clipboard has image data\n        const { stdout } = await execAsync('osascript -e \"clipboard info\"');\n        return stdout.includes('class PNGf') || stdout.includes('public.png');\n\n      case 'linux':\n        // Try xclip\n        try {\n          await execAsync('xclip -selection clipboard -t TARGETS -o | grep -q image');\n          return true;\n        } catch {\n          return false;\n        }\n\n      case 'win32':\n        // PowerShell check\n        const psCheck = `\n          Add-Type -AssemblyName System.Windows.Forms;\n          if ([System.Windows.Forms.Clipboard]::GetImage() -ne $null) {\n            Write-Output 'true'\n          } else {\n            Write-Output 'false'\n          }\n        `;\n        const { stdout: result } = await execAsync(`powershell -Command \"${psCheck}\"`);\n        return result.trim() === 'true';\n\n      default:\n        return false;\n    }\n  } catch {\n    return false;\n  }\n}\n","/**\n * Pre-built tools for agents\n *\n * Import and use with your agents:\n *\n * ```typescript\n * import { tools } from '@oneringai/agents';\n *\n * const agent = Agent.create({\n *   connector: 'openai',\n *   model: 'gpt-4',\n *   tools: [\n *     // Filesystem tools\n *     tools.readFile,\n *     tools.writeFile,\n *     tools.editFile,\n *     tools.glob,\n *     tools.grep,\n *     tools.listDirectory,\n *     // Shell tools\n *     tools.bash,\n *     // Web tools\n *     tools.webFetch,\n *     tools.webSearch,\n *   ]\n * });\n * ```\n */\n\n// ============================================================================\n// Filesystem Tools\n// ============================================================================\n\nexport {\n  // Tools\n  readFile,\n  writeFile,\n  editFile,\n  glob,\n  grep,\n  listDirectory,\n  // Factory functions\n  createReadFileTool,\n  createWriteFileTool,\n  createEditFileTool,\n  createGlobTool,\n  createGrepTool,\n  createListDirectoryTool,\n  // Types and utilities\n  DEFAULT_FILESYSTEM_CONFIG,\n  validatePath,\n  isExcludedExtension,\n  expandTilde,\n} from './filesystem/index.js';\n\nexport type {\n  FilesystemToolConfig,\n  ReadFileResult,\n  WriteFileResult,\n  EditFileResult,\n  GlobResult,\n  GrepResult,\n  GrepMatch,\n} from './filesystem/index.js';\n\n// ============================================================================\n// Shell Tools\n// ============================================================================\n\nexport {\n  // Tools\n  bash,\n  // Factory functions\n  createBashTool,\n  // Utilities\n  getBackgroundOutput,\n  killBackgroundProcess,\n  // Config\n  DEFAULT_SHELL_CONFIG,\n  isBlockedCommand,\n} from './shell/index.js';\n\nexport type {\n  ShellToolConfig,\n  BashResult,\n} from './shell/index.js';\n\n// ============================================================================\n// JSON Tools\n// ============================================================================\n\nexport { jsonManipulator } from './json/jsonManipulator.js';\n\n// ============================================================================\n// Web Tools\n// ============================================================================\n\nexport { webFetch, webFetchJS, webSearch, webScrape } from './web/index.js';\n\n// Re-export search result type\nexport type { SearchResult } from './web/searchProviders/serper.js';\n\n// ============================================================================\n// Code Execution Tools\n// ============================================================================\n\nexport { executeJavaScript, createExecuteJavaScriptTool } from './code/index.js';\n\n// ============================================================================\n// Connector Tools (Vendor-Dependent Tools Framework)\n// ============================================================================\n\nexport {\n  ConnectorTools,\n  type ServiceToolFactory,\n  type GenericAPIToolOptions,\n  type GenericAPICallArgs,\n  type GenericAPICallResult,\n} from './connector/index.js';\n\n// ============================================================================\n// Convenience: All Developer Tools Bundle\n// ============================================================================\n\nimport { readFile } from './filesystem/index.js';\nimport { writeFile } from './filesystem/index.js';\nimport { editFile } from './filesystem/index.js';\nimport { glob } from './filesystem/index.js';\nimport { grep } from './filesystem/index.js';\nimport { listDirectory } from './filesystem/index.js';\nimport { bash } from './shell/index.js';\n\n/**\n * A bundle of all developer tools commonly used for coding tasks.\n * Includes: readFile, writeFile, editFile, glob, grep, listDirectory, bash\n *\n * @example\n * ```typescript\n * import { tools } from '@oneringai/agents';\n *\n * const agent = Agent.create({\n *   connector: 'openai',\n *   model: 'gpt-4',\n *   tools: tools.developerTools,\n * });\n * ```\n */\nexport const developerTools = [\n  readFile,\n  writeFile,\n  editFile,\n  glob,\n  grep,\n  listDirectory,\n  bash,\n];\n\n// ============================================================================\n// Tool Registry (Auto-Generated)\n// ============================================================================\n\nexport {\n  toolRegistry,\n  getAllBuiltInTools,\n  getToolRegistry,\n  getToolsByCategory,\n  getToolByName,\n  getToolsRequiringConnector,\n  getToolCategories,\n  type ToolCategory,\n  type ToolRegistryEntry,\n} from './registry.generated.js';\n","/**\n * Filesystem Tools - Shared Types\n *\n * Common types and configuration for filesystem operations.\n */\n\nimport { resolve, normalize, isAbsolute } from 'node:path';\nimport { homedir } from 'node:os';\n\n/**\n * Configuration for filesystem tools\n */\nexport interface FilesystemToolConfig {\n  /**\n   * Base working directory for all operations.\n   * All paths will be resolved relative to this directory.\n   * Defaults to process.cwd()\n   */\n  workingDirectory?: string;\n\n  /**\n   * Allowed directories for file operations.\n   * If specified, operations outside these directories will be blocked.\n   * Paths can be absolute or relative to workingDirectory.\n   */\n  allowedDirectories?: string[];\n\n  /**\n   * Blocked directories (e.g., node_modules, .git).\n   * Operations in these directories will be blocked.\n   */\n  blockedDirectories?: string[];\n\n  /**\n   * Maximum file size to read (in bytes).\n   * Default: 10MB\n   */\n  maxFileSize?: number;\n\n  /**\n   * Maximum number of results for glob/grep operations.\n   * Default: 1000\n   */\n  maxResults?: number;\n\n  /**\n   * Whether to follow symlinks.\n   * Default: false\n   */\n  followSymlinks?: boolean;\n\n  /**\n   * File extensions to exclude from search.\n   * Default: common binary extensions\n   */\n  excludeExtensions?: string[];\n}\n\n/**\n * Default configuration\n */\nexport const DEFAULT_FILESYSTEM_CONFIG: Required<FilesystemToolConfig> = {\n  workingDirectory: process.cwd(),\n  allowedDirectories: [],\n  blockedDirectories: ['node_modules', '.git', '.svn', '.hg', '__pycache__', '.cache'],\n  maxFileSize: 10 * 1024 * 1024, // 10MB\n  maxResults: 1000,\n  followSymlinks: false,\n  excludeExtensions: [\n    '.exe', '.dll', '.so', '.dylib', '.bin', '.obj', '.o', '.a',\n    '.zip', '.tar', '.gz', '.bz2', '.7z', '.rar',\n    '.png', '.jpg', '.jpeg', '.gif', '.bmp', '.ico', '.svg', '.webp',\n    '.mp3', '.mp4', '.wav', '.avi', '.mov', '.mkv',\n    '.pdf', '.doc', '.docx', '.xls', '.xlsx', '.ppt', '.pptx',\n    '.woff', '.woff2', '.ttf', '.eot', '.otf',\n  ],\n};\n\n/**\n * Result of a file read operation\n */\nexport interface ReadFileResult {\n  success: boolean;\n  content?: string;\n  lines?: number;\n  truncated?: boolean;\n  encoding?: string;\n  size?: number;\n  error?: string;\n  path?: string;\n}\n\n/**\n * Result of a file write operation\n */\nexport interface WriteFileResult {\n  success: boolean;\n  path?: string;\n  bytesWritten?: number;\n  created?: boolean;\n  error?: string;\n}\n\n/**\n * Result of a file edit operation\n */\nexport interface EditFileResult {\n  success: boolean;\n  path?: string;\n  replacements?: number;\n  error?: string;\n  diff?: string;\n}\n\n/**\n * Result of a glob operation\n */\nexport interface GlobResult {\n  success: boolean;\n  files?: string[];\n  count?: number;\n  truncated?: boolean;\n  error?: string;\n}\n\n/**\n * A single grep match\n */\nexport interface GrepMatch {\n  file: string;\n  line: number;\n  column?: number;\n  content: string;\n  context?: {\n    before: string[];\n    after: string[];\n  };\n}\n\n/**\n * Result of a grep operation\n */\nexport interface GrepResult {\n  success: boolean;\n  matches?: GrepMatch[];\n  filesSearched?: number;\n  filesMatched?: number;\n  totalMatches?: number;\n  truncated?: boolean;\n  error?: string;\n}\n\n/**\n * Validate and resolve a path within allowed boundaries\n */\nexport function validatePath(\n  inputPath: string,\n  config: FilesystemToolConfig = {}\n): { valid: boolean; resolvedPath: string; error?: string } {\n  const workingDir = config.workingDirectory || process.cwd();\n  const allowedDirs = config.allowedDirectories || [];\n  const blockedDirs = config.blockedDirectories || DEFAULT_FILESYSTEM_CONFIG.blockedDirectories;\n\n  // Expand tilde (~) to home directory\n  let expandedPath = inputPath;\n  if (inputPath.startsWith('~/')) {\n    expandedPath = resolve(homedir(), inputPath.slice(2));\n  } else if (inputPath === '~') {\n    expandedPath = homedir();\n  }\n\n  // Resolve the path\n  let resolvedPath: string;\n  if (isAbsolute(expandedPath)) {\n    resolvedPath = normalize(expandedPath);\n  } else {\n    resolvedPath = resolve(workingDir, expandedPath);\n  }\n\n  // Check blocked directories - check if any path segment matches a blocked directory name\n  const pathSegments = resolvedPath.split('/').filter(Boolean);\n  for (const blocked of blockedDirs) {\n    // If blocked is a simple name (no slashes), check path segments\n    if (!blocked.includes('/')) {\n      if (pathSegments.includes(blocked)) {\n        return {\n          valid: false,\n          resolvedPath,\n          error: `Path is in blocked directory: ${blocked}`,\n        };\n      }\n    } else {\n      // If blocked is a path, resolve it and check prefix\n      const blockedPath = isAbsolute(blocked) ? blocked : resolve(workingDir, blocked);\n      if (resolvedPath.startsWith(blockedPath + '/') || resolvedPath === blockedPath) {\n        return {\n          valid: false,\n          resolvedPath,\n          error: `Path is in blocked directory: ${blocked}`,\n        };\n      }\n    }\n  }\n\n  // Check allowed directories (if specified)\n  if (allowedDirs.length > 0) {\n    let isAllowed = false;\n    for (const allowed of allowedDirs) {\n      const allowedPath = isAbsolute(allowed) ? allowed : resolve(workingDir, allowed);\n      if (resolvedPath.startsWith(allowedPath + '/') || resolvedPath === allowedPath) {\n        isAllowed = true;\n        break;\n      }\n    }\n    if (!isAllowed) {\n      return {\n        valid: false,\n        resolvedPath,\n        error: `Path is outside allowed directories`,\n      };\n    }\n  }\n\n  return { valid: true, resolvedPath };\n}\n\n/**\n * Expand tilde (~) to the user's home directory\n */\nexport function expandTilde(inputPath: string): string {\n  if (inputPath.startsWith('~/')) {\n    return resolve(homedir(), inputPath.slice(2));\n  } else if (inputPath === '~') {\n    return homedir();\n  }\n  return inputPath;\n}\n\n/**\n * Check if a file extension should be excluded\n */\nexport function isExcludedExtension(\n  filePath: string,\n  excludeExtensions: string[] = DEFAULT_FILESYSTEM_CONFIG.excludeExtensions\n): boolean {\n  const ext = filePath.toLowerCase().substring(filePath.lastIndexOf('.'));\n  return excludeExtensions.includes(ext);\n}\n","/**\n * Read File Tool\n *\n * Reads content from files on the local filesystem.\n * Supports text files with optional line range selection.\n *\n * Features:\n * - Read entire files or specific line ranges\n * - Automatic encoding detection\n * - Line number prefixing for easy reference\n * - Size limits to prevent memory issues\n * - Path validation for security\n */\n\nimport { readFile as fsReadFile, stat } from 'node:fs/promises';\nimport { existsSync } from 'node:fs';\nimport type { ToolFunction } from '../../domain/entities/Tool.js';\nimport {\n  type FilesystemToolConfig,\n  type ReadFileResult,\n  DEFAULT_FILESYSTEM_CONFIG,\n  validatePath,\n} from './types.js';\n\n/**\n * Arguments for the read file tool\n */\nexport interface ReadFileArgs {\n  /** Absolute path to the file to read */\n  file_path: string;\n  /** Line number to start reading from (1-indexed). Only provide if the file is too large. */\n  offset?: number;\n  /** Number of lines to read. Only provide if the file is too large. */\n  limit?: number;\n}\n\n/**\n * Create a Read File tool with the given configuration\n */\nexport function createReadFileTool(config: FilesystemToolConfig = {}): ToolFunction<ReadFileArgs, ReadFileResult> {\n  const mergedConfig = { ...DEFAULT_FILESYSTEM_CONFIG, ...config };\n\n  return {\n    definition: {\n      type: 'function',\n      function: {\n        name: 'read_file',\n        description: `Read content from a file on the local filesystem.\n\nUSAGE:\n- The file_path parameter must be an absolute path, not a relative path\n- By default, reads up to 2000 lines starting from the beginning of the file\n- You can optionally specify a line offset and limit (especially handy for long files)\n- Any lines longer than 2000 characters will be truncated\n- Results are returned with line numbers starting at 1\n\nWHEN TO USE:\n- To read source code files before making edits\n- To understand file contents and structure\n- To read configuration files\n- To examine log files or data files\n\nIMPORTANT:\n- Always read a file before attempting to edit it\n- Use offset/limit for very large files to read in chunks\n- The tool will return an error if the file doesn't exist\n\nEXAMPLES:\n- Read entire file: { \"file_path\": \"/path/to/file.ts\" }\n- Read lines 100-200: { \"file_path\": \"/path/to/file.ts\", \"offset\": 100, \"limit\": 100 }`,\n        parameters: {\n          type: 'object',\n          properties: {\n            file_path: {\n              type: 'string',\n              description: 'The absolute path to the file to read',\n            },\n            offset: {\n              type: 'number',\n              description: 'Line number to start reading from (1-indexed). Only provide if the file is too large to read at once.',\n            },\n            limit: {\n              type: 'number',\n              description: 'Number of lines to read. Only provide if the file is too large to read at once.',\n            },\n          },\n          required: ['file_path'],\n        },\n      },\n    },\n\n    describeCall: (args: ReadFileArgs): string => {\n      if (args.offset && args.limit) {\n        return `${args.file_path} [lines ${args.offset}-${args.offset + args.limit}]`;\n      }\n      return args.file_path;\n    },\n\n    execute: async (args: ReadFileArgs): Promise<ReadFileResult> => {\n      const { file_path, offset = 1, limit = 2000 } = args;\n\n      // Validate path\n      const validation = validatePath(file_path, mergedConfig);\n      if (!validation.valid) {\n        return {\n          success: false,\n          error: validation.error,\n          path: file_path,\n        };\n      }\n\n      const resolvedPath = validation.resolvedPath;\n\n      // Check if file exists\n      if (!existsSync(resolvedPath)) {\n        return {\n          success: false,\n          error: `File not found: ${file_path}`,\n          path: file_path,\n        };\n      }\n\n      try {\n        // Check file size\n        const stats = await stat(resolvedPath);\n        if (!stats.isFile()) {\n          return {\n            success: false,\n            error: `Path is not a file: ${file_path}. Use list_directory to explore directories.`,\n            path: file_path,\n          };\n        }\n\n        if (stats.size > mergedConfig.maxFileSize) {\n          return {\n            success: false,\n            error: `File is too large (${(stats.size / 1024 / 1024).toFixed(2)}MB). Maximum size is ${(mergedConfig.maxFileSize / 1024 / 1024).toFixed(2)}MB. Use offset and limit to read in chunks.`,\n            path: file_path,\n            size: stats.size,\n          };\n        }\n\n        // Read file content\n        const content = await fsReadFile(resolvedPath, 'utf-8');\n        const allLines = content.split('\\n');\n        const totalLines = allLines.length;\n\n        // Apply offset and limit (offset is 1-indexed)\n        const startIndex = Math.max(0, offset - 1);\n        const endIndex = Math.min(totalLines, startIndex + limit);\n        const selectedLines = allLines.slice(startIndex, endIndex);\n\n        // Format with line numbers\n        const lineNumberWidth = String(endIndex).length;\n        const formattedLines = selectedLines.map((line, i) => {\n          const lineNum = startIndex + i + 1;\n          const paddedNum = String(lineNum).padStart(lineNumberWidth, ' ');\n          // Truncate very long lines\n          const truncatedLine = line.length > 2000 ? line.substring(0, 2000) + '...' : line;\n          return `${paddedNum}\\t${truncatedLine}`;\n        });\n\n        const truncated = endIndex < totalLines;\n        const result = formattedLines.join('\\n');\n\n        return {\n          success: true,\n          content: result,\n          lines: totalLines,\n          truncated,\n          encoding: 'utf-8',\n          size: stats.size,\n          path: file_path,\n        };\n      } catch (error) {\n        // Handle binary files or encoding issues\n        if (error instanceof Error && error.message.includes('encoding')) {\n          return {\n            success: false,\n            error: `File appears to be binary or uses an unsupported encoding: ${file_path}`,\n            path: file_path,\n          };\n        }\n\n        return {\n          success: false,\n          error: `Failed to read file: ${error instanceof Error ? error.message : String(error)}`,\n          path: file_path,\n        };\n      }\n    },\n  };\n}\n\n/**\n * Default Read File tool instance\n */\nexport const readFile = createReadFileTool();\n","/**\n * Write File Tool\n *\n * Writes content to files on the local filesystem.\n * Can create new files or overwrite existing ones.\n *\n * Features:\n * - Create new files with content\n * - Overwrite existing files (with safety checks)\n * - Automatic directory creation\n * - Path validation for security\n */\n\nimport { writeFile as fsWriteFile, mkdir } from 'node:fs/promises';\nimport { existsSync } from 'node:fs';\nimport { dirname } from 'node:path';\nimport type { ToolFunction } from '../../domain/entities/Tool.js';\nimport {\n  type FilesystemToolConfig,\n  type WriteFileResult,\n  DEFAULT_FILESYSTEM_CONFIG,\n  validatePath,\n} from './types.js';\n\n/**\n * Arguments for the write file tool\n */\nexport interface WriteFileArgs {\n  /** Absolute path to the file to write */\n  file_path: string;\n  /** Content to write to the file */\n  content: string;\n}\n\n/**\n * Create a Write File tool with the given configuration\n */\nexport function createWriteFileTool(config: FilesystemToolConfig = {}): ToolFunction<WriteFileArgs, WriteFileResult> {\n  const mergedConfig = { ...DEFAULT_FILESYSTEM_CONFIG, ...config };\n\n  return {\n    definition: {\n      type: 'function',\n      function: {\n        name: 'write_file',\n        description: `Write content to a file on the local filesystem.\n\nUSAGE:\n- This tool will overwrite the existing file if there is one at the provided path\n- If the file exists, you MUST use the read_file tool first to read its contents before writing\n- The file_path must be an absolute path, not a relative path\n- Parent directories will be created automatically if they don't exist\n\nWHEN TO USE:\n- To create new files\n- To completely replace file contents (after reading the original)\n- When the edit_file tool cannot handle the changes needed\n\nIMPORTANT:\n- ALWAYS prefer editing existing files over creating new ones\n- NEVER proactively create documentation files (*.md) or README files unless explicitly requested\n- If modifying an existing file, use edit_file instead for surgical changes\n- This tool will FAIL if you try to write to an existing file without reading it first\n\nEXAMPLES:\n- Create new file: { \"file_path\": \"/path/to/new-file.ts\", \"content\": \"export const x = 1;\" }\n- Rewrite file: { \"file_path\": \"/path/to/existing.ts\", \"content\": \"// new content...\" }`,\n        parameters: {\n          type: 'object',\n          properties: {\n            file_path: {\n              type: 'string',\n              description: 'The absolute path to the file to write (must be absolute, not relative)',\n            },\n            content: {\n              type: 'string',\n              description: 'The content to write to the file',\n            },\n          },\n          required: ['file_path', 'content'],\n        },\n      },\n    },\n\n    describeCall: (args: WriteFileArgs): string => {\n      const size = args.content?.length || 0;\n      if (size > 1000) {\n        return `${args.file_path} (${Math.round(size / 1024)}KB)`;\n      }\n      return args.file_path;\n    },\n\n    execute: async (args: WriteFileArgs): Promise<WriteFileResult> => {\n      const { file_path, content } = args;\n\n      // Validate path\n      const validation = validatePath(file_path, mergedConfig);\n      if (!validation.valid) {\n        return {\n          success: false,\n          error: validation.error,\n          path: file_path,\n        };\n      }\n\n      const resolvedPath = validation.resolvedPath;\n      const fileExists = existsSync(resolvedPath);\n\n      try {\n        // Ensure parent directory exists\n        const parentDir = dirname(resolvedPath);\n        if (!existsSync(parentDir)) {\n          await mkdir(parentDir, { recursive: true });\n        }\n\n        // Write the file\n        await fsWriteFile(resolvedPath, content, 'utf-8');\n\n        return {\n          success: true,\n          path: file_path,\n          bytesWritten: Buffer.byteLength(content, 'utf-8'),\n          created: !fileExists,\n        };\n      } catch (error) {\n        return {\n          success: false,\n          error: `Failed to write file: ${error instanceof Error ? error.message : String(error)}`,\n          path: file_path,\n        };\n      }\n    },\n  };\n}\n\n/**\n * Default Write File tool instance\n */\nexport const writeFile = createWriteFileTool();\n","/**\n * Edit File Tool\n *\n * Performs surgical edits to files using exact string replacement.\n * This is the preferred way to modify existing files.\n *\n * Features:\n * - Exact string matching for precise edits\n * - Preserves file formatting and indentation\n * - Supports replace_all for bulk changes\n * - Validates uniqueness of old_string\n * - Safe: only modifies what's specified\n */\n\nimport { readFile as fsReadFile, writeFile as fsWriteFile } from 'node:fs/promises';\nimport { existsSync } from 'node:fs';\nimport type { ToolFunction } from '../../domain/entities/Tool.js';\nimport {\n  type FilesystemToolConfig,\n  type EditFileResult,\n  DEFAULT_FILESYSTEM_CONFIG,\n  validatePath,\n} from './types.js';\n\n/**\n * Arguments for the edit file tool\n */\nexport interface EditFileArgs {\n  /** Absolute path to the file to edit */\n  file_path: string;\n  /** The exact text to find and replace */\n  old_string: string;\n  /** The text to replace it with (must be different from old_string) */\n  new_string: string;\n  /** Replace all occurrences (default: false, which requires old_string to be unique) */\n  replace_all?: boolean;\n}\n\n/**\n * Create an Edit File tool with the given configuration\n */\nexport function createEditFileTool(config: FilesystemToolConfig = {}): ToolFunction<EditFileArgs, EditFileResult> {\n  const mergedConfig = { ...DEFAULT_FILESYSTEM_CONFIG, ...config };\n\n  return {\n    definition: {\n      type: 'function',\n      function: {\n        name: 'edit_file',\n        description: `Perform exact string replacements in files.\n\nUSAGE:\n- You MUST use read_file at least once before editing any file\n- The old_string must match EXACTLY what's in the file, including all whitespace and indentation\n- When editing text from read_file output, preserve the exact indentation as it appears AFTER the line number prefix\n- The line number prefix format is: spaces + line number + tab. Everything after that tab is the actual file content\n- NEVER include any part of the line number prefix in old_string or new_string\n\nIMPORTANT RULES:\n- ALWAYS prefer editing existing files over writing new ones\n- The edit will FAIL if old_string is not found in the file\n- The edit will FAIL if old_string appears more than once (unless replace_all is true)\n- Use replace_all: true when you want to rename variables, update imports, etc.\n- old_string and new_string must be different\n\nMATCHING TIPS:\n- Include enough surrounding context to make old_string unique\n- Copy the exact whitespace from the file (spaces vs tabs matter!)\n- For indented code, include the full indentation in old_string\n\nEXAMPLES:\n- Simple edit:\n  { \"file_path\": \"/path/to/file.ts\", \"old_string\": \"const x = 1;\", \"new_string\": \"const x = 2;\" }\n\n- Edit with context for uniqueness:\n  { \"file_path\": \"/path/to/file.ts\",\n    \"old_string\": \"function foo() {\\\\n  return 1;\\\\n}\",\n    \"new_string\": \"function foo() {\\\\n  return 2;\\\\n}\" }\n\n- Replace all occurrences:\n  { \"file_path\": \"/path/to/file.ts\", \"old_string\": \"oldName\", \"new_string\": \"newName\", \"replace_all\": true }`,\n        parameters: {\n          type: 'object',\n          properties: {\n            file_path: {\n              type: 'string',\n              description: 'The absolute path to the file to modify',\n            },\n            old_string: {\n              type: 'string',\n              description: 'The exact text to find and replace',\n            },\n            new_string: {\n              type: 'string',\n              description: 'The text to replace it with (must be different from old_string)',\n            },\n            replace_all: {\n              type: 'boolean',\n              description: 'Replace all occurrences instead of requiring uniqueness (default: false)',\n            },\n          },\n          required: ['file_path', 'old_string', 'new_string'],\n        },\n      },\n    },\n\n    describeCall: (args: EditFileArgs): string => {\n      const mode = args.replace_all ? ' (replace all)' : '';\n      return `${args.file_path}${mode}`;\n    },\n\n    execute: async (args: EditFileArgs): Promise<EditFileResult> => {\n      const { file_path, old_string, new_string, replace_all = false } = args;\n\n      // Validate that old_string and new_string are different\n      if (old_string === new_string) {\n        return {\n          success: false,\n          error: 'old_string and new_string must be different',\n          path: file_path,\n        };\n      }\n\n      // Validate path\n      const validation = validatePath(file_path, mergedConfig);\n      if (!validation.valid) {\n        return {\n          success: false,\n          error: validation.error,\n          path: file_path,\n        };\n      }\n\n      const resolvedPath = validation.resolvedPath;\n\n      // Check if file exists\n      if (!existsSync(resolvedPath)) {\n        return {\n          success: false,\n          error: `File not found: ${file_path}`,\n          path: file_path,\n        };\n      }\n\n      try {\n        // Read current content\n        const content = await fsReadFile(resolvedPath, 'utf-8');\n\n        // Count occurrences\n        let occurrences = 0;\n        let searchIndex = 0;\n        while (true) {\n          const foundIndex = content.indexOf(old_string, searchIndex);\n          if (foundIndex === -1) break;\n          occurrences++;\n          searchIndex = foundIndex + 1;\n        }\n\n        // Validate occurrences\n        if (occurrences === 0) {\n          // Try to provide helpful feedback\n          const trimmedOld = old_string.trim();\n          const hasTrimmedMatch = content.includes(trimmedOld);\n\n          let errorMsg = `old_string not found in file. `;\n          if (hasTrimmedMatch && trimmedOld !== old_string) {\n            errorMsg += `A similar string was found but with different whitespace. Check your indentation matches exactly.`;\n          } else {\n            errorMsg += `Make sure you're copying the exact text from the file, including all whitespace.`;\n          }\n\n          return {\n            success: false,\n            error: errorMsg,\n            path: file_path,\n            replacements: 0,\n          };\n        }\n\n        if (occurrences > 1 && !replace_all) {\n          return {\n            success: false,\n            error: `old_string appears ${occurrences} times in the file. Either provide more context to make it unique, or set replace_all: true to replace all occurrences.`,\n            path: file_path,\n            replacements: 0,\n          };\n        }\n\n        // Perform replacement\n        let newContent: string;\n        if (replace_all) {\n          newContent = content.split(old_string).join(new_string);\n        } else {\n          newContent = content.replace(old_string, new_string);\n        }\n\n        // Write the modified content\n        await fsWriteFile(resolvedPath, newContent, 'utf-8');\n\n        // Generate simple diff preview\n        const diffPreview = generateDiffPreview(old_string, new_string);\n\n        return {\n          success: true,\n          path: file_path,\n          replacements: replace_all ? occurrences : 1,\n          diff: diffPreview,\n        };\n      } catch (error) {\n        return {\n          success: false,\n          error: `Failed to edit file: ${error instanceof Error ? error.message : String(error)}`,\n          path: file_path,\n        };\n      }\n    },\n  };\n}\n\n/**\n * Generate a simple diff preview\n */\nfunction generateDiffPreview(oldStr: string, newStr: string): string {\n  const oldLines = oldStr.split('\\n');\n  const newLines = newStr.split('\\n');\n\n  const diff: string[] = [];\n  const maxLines = Math.max(oldLines.length, newLines.length);\n\n  // Show first few lines of old and new\n  const previewLines = Math.min(maxLines, 5);\n\n  diff.push('--- old');\n  for (let i = 0; i < Math.min(oldLines.length, previewLines); i++) {\n    diff.push(`- ${oldLines[i]}`);\n  }\n  if (oldLines.length > previewLines) {\n    diff.push(`  ... (${oldLines.length - previewLines} more lines)`);\n  }\n\n  diff.push('+++ new');\n  for (let i = 0; i < Math.min(newLines.length, previewLines); i++) {\n    diff.push(`+ ${newLines[i]}`);\n  }\n  if (newLines.length > previewLines) {\n    diff.push(`  ... (${newLines.length - previewLines} more lines)`);\n  }\n\n  return diff.join('\\n');\n}\n\n/**\n * Default Edit File tool instance\n */\nexport const editFile = createEditFileTool();\n","/**\n * Glob Tool\n *\n * Fast file pattern matching for finding files by name patterns.\n * Supports standard glob patterns like **\\/*.ts, src/**\\/*.tsx, etc.\n *\n * Features:\n * - Standard glob pattern syntax\n * - Recursive directory traversal\n * - Results sorted by modification time\n * - Configurable result limits\n * - Excludes common non-code directories by default\n */\n\nimport { readdir, stat } from 'node:fs/promises';\nimport { existsSync } from 'node:fs';\nimport { join, relative } from 'node:path';\nimport type { ToolFunction } from '../../domain/entities/Tool.js';\nimport {\n  type FilesystemToolConfig,\n  type GlobResult,\n  DEFAULT_FILESYSTEM_CONFIG,\n  validatePath,\n} from './types.js';\n\n/**\n * Arguments for the glob tool\n */\nexport interface GlobArgs {\n  /** The glob pattern to match files against (e.g., \"**\\/*.ts\", \"src/**\\/*.tsx\") */\n  pattern: string;\n  /** The directory to search in. Defaults to current working directory. */\n  path?: string;\n}\n\n/**\n * Simple glob pattern matcher\n */\nfunction matchGlobPattern(pattern: string, filePath: string): boolean {\n  // Convert glob pattern to regex\n  let regexPattern = pattern\n    // Escape special regex characters except * and ?\n    .replace(/[.+^${}()|[\\]\\\\]/g, '\\\\$&')\n    // Convert ** to match any path\n    .replace(/\\*\\*/g, '{{GLOBSTAR}}')\n    // Convert * to match any characters except /\n    .replace(/\\*/g, '[^/]*')\n    // Convert ? to match single character\n    .replace(/\\?/g, '.')\n    // Restore **\n    .replace(/\\{\\{GLOBSTAR\\}\\}/g, '.*');\n\n  // Anchor the pattern\n  regexPattern = '^' + regexPattern + '$';\n\n  try {\n    const regex = new RegExp(regexPattern);\n    return regex.test(filePath);\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Recursively find files matching a pattern\n */\nasync function findFiles(\n  dir: string,\n  pattern: string,\n  baseDir: string,\n  config: Required<FilesystemToolConfig>,\n  results: { path: string; mtime: number }[] = [],\n  depth: number = 0\n): Promise<{ path: string; mtime: number }[]> {\n  // Prevent infinite recursion\n  if (depth > 50 || results.length >= config.maxResults) {\n    return results;\n  }\n\n  try {\n    const entries = await readdir(dir, { withFileTypes: true });\n\n    for (const entry of entries) {\n      if (results.length >= config.maxResults) break;\n\n      const fullPath = join(dir, entry.name);\n      const relativePath = relative(baseDir, fullPath);\n\n      // Check if directory is blocked\n      if (entry.isDirectory()) {\n        const isBlocked = config.blockedDirectories.some(\n          blocked => entry.name === blocked || relativePath.includes(`/${blocked}/`) || relativePath.startsWith(`${blocked}/`)\n        );\n        if (isBlocked) continue;\n\n        // Recurse into subdirectories\n        await findFiles(fullPath, pattern, baseDir, config, results, depth + 1);\n      } else if (entry.isFile()) {\n        // Check if file matches pattern\n        if (matchGlobPattern(pattern, relativePath)) {\n          try {\n            const stats = await stat(fullPath);\n            results.push({\n              path: relativePath,\n              mtime: stats.mtimeMs,\n            });\n          } catch {\n            // Skip files we can't stat\n          }\n        }\n      }\n    }\n  } catch {\n    // Skip directories we can't read\n  }\n\n  return results;\n}\n\n/**\n * Create a Glob tool with the given configuration\n */\nexport function createGlobTool(config: FilesystemToolConfig = {}): ToolFunction<GlobArgs, GlobResult> {\n  const mergedConfig = { ...DEFAULT_FILESYSTEM_CONFIG, ...config };\n\n  return {\n    definition: {\n      type: 'function',\n      function: {\n        name: 'glob',\n        description: `Fast file pattern matching tool that finds files by name patterns.\n\nUSAGE:\n- Supports glob patterns like \"**/*.js\", \"src/**/*.ts\", \"*.{ts,tsx}\"\n- Returns matching file paths sorted by modification time (newest first)\n- Use this tool when you need to find files by name patterns\n\nPATTERN SYNTAX:\n- * matches any characters except /\n- ** matches any characters including /\n- ? matches a single character\n- {a,b} matches either a or b\n\nEXAMPLES:\n- Find all TypeScript files: { \"pattern\": \"**/*.ts\" }\n- Find files in src folder: { \"pattern\": \"src/**/*.{ts,tsx}\" }\n- Find test files: { \"pattern\": \"**/*.test.ts\" }\n- Find specific file type in path: { \"pattern\": \"src/components/**/*.tsx\", \"path\": \"/project\" }\n\nWHEN TO USE:\n- To find files by extension or name pattern\n- To explore project structure\n- To find related files (tests, types, etc.)\n- Before using grep when you know the file pattern`,\n        parameters: {\n          type: 'object',\n          properties: {\n            pattern: {\n              type: 'string',\n              description: 'The glob pattern to match files against (e.g., \"**/*.ts\", \"src/**/*.tsx\")',\n            },\n            path: {\n              type: 'string',\n              description: 'The directory to search in. If not specified, uses the current working directory. IMPORTANT: Omit this field to use the default directory.',\n            },\n          },\n          required: ['pattern'],\n        },\n      },\n    },\n\n    describeCall: (args: GlobArgs): string => {\n      if (args.path) {\n        return `${args.pattern} in ${args.path}`;\n      }\n      return args.pattern;\n    },\n\n    execute: async (args: GlobArgs): Promise<GlobResult> => {\n      const { pattern, path } = args;\n\n      // Determine search directory\n      const searchDir = path || mergedConfig.workingDirectory;\n\n      // Validate path\n      const validation = validatePath(searchDir, {\n        ...mergedConfig,\n        blockedDirectories: [], // Allow searching from any valid directory\n      });\n      if (!validation.valid) {\n        return {\n          success: false,\n          error: validation.error,\n        };\n      }\n\n      const resolvedDir = validation.resolvedPath;\n\n      // Check if directory exists\n      if (!existsSync(resolvedDir)) {\n        return {\n          success: false,\n          error: `Directory not found: ${searchDir}`,\n        };\n      }\n\n      try {\n        // Find matching files\n        const results = await findFiles(resolvedDir, pattern, resolvedDir, mergedConfig);\n\n        // Sort by modification time (newest first)\n        results.sort((a, b) => b.mtime - a.mtime);\n\n        // Check if we hit the limit\n        const truncated = results.length >= mergedConfig.maxResults;\n\n        return {\n          success: true,\n          files: results.map(r => r.path),\n          count: results.length,\n          truncated,\n        };\n      } catch (error) {\n        return {\n          success: false,\n          error: `Glob search failed: ${error instanceof Error ? error.message : String(error)}`,\n        };\n      }\n    },\n  };\n}\n\n/**\n * Default Glob tool instance\n */\nexport const glob = createGlobTool();\n","/**\n * Grep Tool\n *\n * Powerful search tool for finding content within files.\n * Supports regex patterns, file filtering, and context lines.\n *\n * Features:\n * - Full regex syntax support\n * - File type filtering\n * - Context lines (before/after match)\n * - Multiple output modes\n * - Case-insensitive search option\n */\n\nimport { readFile } from 'node:fs/promises';\nimport { readdir, stat } from 'node:fs/promises';\nimport { existsSync } from 'node:fs';\nimport { join, relative, extname } from 'node:path';\nimport type { ToolFunction } from '../../domain/entities/Tool.js';\nimport {\n  type FilesystemToolConfig,\n  type GrepResult,\n  type GrepMatch,\n  DEFAULT_FILESYSTEM_CONFIG,\n  validatePath,\n  isExcludedExtension,\n} from './types.js';\n\n/**\n * Arguments for the grep tool\n */\nexport interface GrepArgs {\n  /** The regex pattern to search for in file contents */\n  pattern: string;\n  /** File or directory to search in. Defaults to current working directory. */\n  path?: string;\n  /** Glob pattern to filter files (e.g., \"*.ts\", \"*.{ts,tsx}\") */\n  glob?: string;\n  /** File type to search (e.g., \"ts\", \"js\", \"py\"). More efficient than glob for standard types. */\n  type?: string;\n  /** Output mode: \"content\" shows lines, \"files_with_matches\" shows only file paths, \"count\" shows match counts */\n  output_mode?: 'content' | 'files_with_matches' | 'count';\n  /** Case insensitive search */\n  case_insensitive?: boolean;\n  /** Number of context lines before match */\n  context_before?: number;\n  /** Number of context lines after match */\n  context_after?: number;\n  /** Limit output to first N results */\n  limit?: number;\n}\n\n/**\n * Map of common file types to extensions\n */\nconst FILE_TYPE_MAP: Record<string, string[]> = {\n  ts: ['.ts', '.tsx'],\n  js: ['.js', '.jsx', '.mjs', '.cjs'],\n  py: ['.py', '.pyi'],\n  java: ['.java'],\n  go: ['.go'],\n  rust: ['.rs'],\n  c: ['.c', '.h'],\n  cpp: ['.cpp', '.hpp', '.cc', '.hh', '.cxx', '.hxx'],\n  cs: ['.cs'],\n  rb: ['.rb'],\n  php: ['.php'],\n  swift: ['.swift'],\n  kotlin: ['.kt', '.kts'],\n  scala: ['.scala'],\n  html: ['.html', '.htm'],\n  css: ['.css', '.scss', '.sass', '.less'],\n  json: ['.json'],\n  yaml: ['.yaml', '.yml'],\n  xml: ['.xml'],\n  md: ['.md', '.markdown'],\n  sql: ['.sql'],\n  sh: ['.sh', '.bash', '.zsh'],\n};\n\n/**\n * Recursively find files to search\n */\nasync function findFilesToSearch(\n  dir: string,\n  baseDir: string,\n  config: Required<FilesystemToolConfig>,\n  globPattern?: string,\n  fileType?: string,\n  files: string[] = [],\n  depth: number = 0\n): Promise<string[]> {\n  if (depth > 50 || files.length >= config.maxResults * 10) {\n    return files;\n  }\n\n  try {\n    const entries = await readdir(dir, { withFileTypes: true });\n\n    for (const entry of entries) {\n      const fullPath = join(dir, entry.name);\n\n      if (entry.isDirectory()) {\n        // Check if directory is blocked\n        const isBlocked = config.blockedDirectories.some(\n          blocked => entry.name === blocked\n        );\n        if (isBlocked) continue;\n\n        await findFilesToSearch(fullPath, baseDir, config, globPattern, fileType, files, depth + 1);\n      } else if (entry.isFile()) {\n        // Skip binary/excluded files\n        if (isExcludedExtension(entry.name, config.excludeExtensions)) continue;\n\n        // Check file type filter\n        if (fileType) {\n          const extensions = FILE_TYPE_MAP[fileType.toLowerCase()];\n          if (extensions) {\n            const ext = extname(entry.name).toLowerCase();\n            if (!extensions.includes(ext)) continue;\n          }\n        }\n\n        // Check glob pattern (simple matching)\n        if (globPattern) {\n          const pattern = globPattern\n            .replace(/\\./g, '\\\\.')\n            .replace(/\\*/g, '.*')\n            .replace(/\\{([^}]+)\\}/g, (_, p) => `(${p.split(',').join('|')})`);\n          const regex = new RegExp(pattern + '$');\n          if (!regex.test(entry.name)) continue;\n        }\n\n        files.push(fullPath);\n      }\n    }\n  } catch {\n    // Skip directories we can't read\n  }\n\n  return files;\n}\n\n/**\n * Search a single file for matches\n */\nasync function searchFile(\n  filePath: string,\n  regex: RegExp,\n  contextBefore: number,\n  contextAfter: number\n): Promise<GrepMatch[]> {\n  const matches: GrepMatch[] = [];\n\n  try {\n    const content = await readFile(filePath, 'utf-8');\n    const lines = content.split('\\n');\n\n    for (let i = 0; i < lines.length; i++) {\n      const line = lines[i] ?? '';\n      regex.lastIndex = 0; // Reset regex state\n\n      if (regex.test(line)) {\n        const match: GrepMatch = {\n          file: filePath,\n          line: i + 1,\n          content: line.length > 500 ? line.substring(0, 500) + '...' : line,\n        };\n\n        // Add context if requested\n        if (contextBefore > 0 || contextAfter > 0) {\n          match.context = {\n            before: lines.slice(Math.max(0, i - contextBefore), i).map(l => l.length > 200 ? l.substring(0, 200) + '...' : l),\n            after: lines.slice(i + 1, Math.min(lines.length, i + 1 + contextAfter)).map(l => l.length > 200 ? l.substring(0, 200) + '...' : l),\n          };\n        }\n\n        matches.push(match);\n      }\n    }\n  } catch {\n    // Skip files we can't read (binary, permission issues, etc.)\n  }\n\n  return matches;\n}\n\n/**\n * Create a Grep tool with the given configuration\n */\nexport function createGrepTool(config: FilesystemToolConfig = {}): ToolFunction<GrepArgs, GrepResult> {\n  const mergedConfig = { ...DEFAULT_FILESYSTEM_CONFIG, ...config };\n\n  return {\n    definition: {\n      type: 'function',\n      function: {\n        name: 'grep',\n        description: `A powerful search tool for finding content within files.\n\nUSAGE:\n- Search for patterns using full regex syntax (e.g., \"log.*Error\", \"function\\\\s+\\\\w+\")\n- Filter files with glob parameter (e.g., \"*.js\", \"**/*.tsx\") or type parameter (e.g., \"js\", \"py\")\n- Output modes: \"content\" shows matching lines, \"files_with_matches\" shows only file paths, \"count\" shows match counts\n\nPATTERN SYNTAX:\n- Uses JavaScript regex syntax (not grep)\n- Literal braces need escaping (use \\\\{ and \\\\} to find { and })\n- Common patterns:\n  - \"TODO\" - literal text\n  - \"function\\\\s+\\\\w+\" - function declarations\n  - \"import.*from\" - import statements\n  - \"\\\\bclass\\\\b\" - word boundary matching\n\nOUTPUT MODES:\n- \"content\" - Shows matching lines with line numbers (default)\n- \"files_with_matches\" - Shows only file paths that contain matches\n- \"count\" - Shows match counts per file\n\nEXAMPLES:\n- Find TODO comments: { \"pattern\": \"TODO|FIXME\", \"type\": \"ts\" }\n- Find function calls: { \"pattern\": \"fetchUser\\\\(\", \"glob\": \"*.ts\" }\n- Find imports: { \"pattern\": \"import.*react\", \"case_insensitive\": true }\n- List files with errors: { \"pattern\": \"error\", \"output_mode\": \"files_with_matches\" }\n- Count matches: { \"pattern\": \"console\\\\.log\", \"output_mode\": \"count\" }\n\nWHEN TO USE:\n- To find where something is defined or used\n- To search for patterns across multiple files\n- To find all occurrences of a term\n- Before making bulk changes`,\n        parameters: {\n          type: 'object',\n          properties: {\n            pattern: {\n              type: 'string',\n              description: 'The regex pattern to search for in file contents',\n            },\n            path: {\n              type: 'string',\n              description: 'File or directory to search in. Defaults to current working directory.',\n            },\n            glob: {\n              type: 'string',\n              description: 'Glob pattern to filter files (e.g., \"*.js\", \"*.{ts,tsx}\")',\n            },\n            type: {\n              type: 'string',\n              description: 'File type to search (e.g., \"ts\", \"js\", \"py\", \"java\", \"go\"). More efficient than glob.',\n            },\n            output_mode: {\n              type: 'string',\n              enum: ['content', 'files_with_matches', 'count'],\n              description: 'Output mode: \"content\" shows lines, \"files_with_matches\" shows paths, \"count\" shows counts. Default: \"files_with_matches\"',\n            },\n            case_insensitive: {\n              type: 'boolean',\n              description: 'Case insensitive search (default: false)',\n            },\n            context_before: {\n              type: 'number',\n              description: 'Number of lines to show before each match (requires output_mode: \"content\")',\n            },\n            context_after: {\n              type: 'number',\n              description: 'Number of lines to show after each match (requires output_mode: \"content\")',\n            },\n            limit: {\n              type: 'number',\n              description: 'Limit output to first N results. Default: unlimited.',\n            },\n          },\n          required: ['pattern'],\n        },\n      },\n    },\n\n    describeCall: (args: GrepArgs): string => {\n      const parts = [`\"${args.pattern}\"`];\n      if (args.glob) parts.push(`in ${args.glob}`);\n      else if (args.type) parts.push(`in *.${args.type}`);\n      if (args.path) parts.push(`(${args.path})`);\n      return parts.join(' ');\n    },\n\n    execute: async (args: GrepArgs): Promise<GrepResult> => {\n      const {\n        pattern,\n        path,\n        glob: globPattern,\n        type: fileType,\n        output_mode = 'files_with_matches',\n        case_insensitive = false,\n        context_before = 0,\n        context_after = 0,\n        limit,\n      } = args;\n\n      // Determine search directory/file\n      const searchPath = path || mergedConfig.workingDirectory;\n\n      // Validate path\n      const validation = validatePath(searchPath, {\n        ...mergedConfig,\n        blockedDirectories: [], // Allow grep from any valid directory\n      });\n      if (!validation.valid) {\n        return {\n          success: false,\n          error: validation.error,\n        };\n      }\n\n      const resolvedPath = validation.resolvedPath;\n\n      // Check if path exists\n      if (!existsSync(resolvedPath)) {\n        return {\n          success: false,\n          error: `Path not found: ${searchPath}`,\n        };\n      }\n\n      // Create regex\n      let regex: RegExp;\n      try {\n        regex = new RegExp(pattern, case_insensitive ? 'gi' : 'g');\n      } catch (error) {\n        return {\n          success: false,\n          error: `Invalid regex pattern: ${error instanceof Error ? error.message : String(error)}`,\n        };\n      }\n\n      try {\n        // Find files to search\n        const stats = await stat(resolvedPath);\n        let filesToSearch: string[];\n\n        if (stats.isFile()) {\n          filesToSearch = [resolvedPath];\n        } else {\n          filesToSearch = await findFilesToSearch(\n            resolvedPath,\n            resolvedPath,\n            mergedConfig,\n            globPattern,\n            fileType\n          );\n        }\n\n        // Search files\n        const allMatches: GrepMatch[] = [];\n        const fileMatchCounts: Map<string, number> = new Map();\n        let filesMatched = 0;\n\n        for (const file of filesToSearch) {\n          if (limit && allMatches.length >= limit) break;\n\n          const matches = await searchFile(\n            file,\n            regex,\n            output_mode === 'content' ? context_before : 0,\n            output_mode === 'content' ? context_after : 0\n          );\n\n          if (matches.length > 0) {\n            filesMatched++;\n            const relativePath = relative(resolvedPath, file) || file;\n\n            // Update match data with relative paths\n            for (const match of matches) {\n              match.file = relativePath;\n            }\n\n            fileMatchCounts.set(relativePath, matches.length);\n\n            if (output_mode === 'content') {\n              const remaining = limit ? limit - allMatches.length : Infinity;\n              allMatches.push(...matches.slice(0, remaining));\n            } else {\n              // For files_with_matches and count, we just need to track files\n              const firstMatch = matches[0];\n              if (firstMatch) {\n                allMatches.push(firstMatch);\n              }\n            }\n          }\n        }\n\n        // Format output based on mode\n        let resultMatches: GrepMatch[];\n\n        switch (output_mode) {\n          case 'files_with_matches':\n            // Deduplicate to just file paths\n            const uniqueFiles = new Set(allMatches.map(m => m.file));\n            resultMatches = Array.from(uniqueFiles).map(file => ({\n              file,\n              line: 0,\n              content: '',\n            }));\n            break;\n\n          case 'count':\n            resultMatches = Array.from(fileMatchCounts.entries()).map(([file, count]) => ({\n              file,\n              line: count,\n              content: `${count} matches`,\n            }));\n            break;\n\n          case 'content':\n          default:\n            resultMatches = allMatches;\n        }\n\n        const totalMatches = Array.from(fileMatchCounts.values()).reduce((a, b) => a + b, 0);\n        const truncated = limit ? allMatches.length >= limit : totalMatches >= mergedConfig.maxResults;\n\n        return {\n          success: true,\n          matches: resultMatches,\n          filesSearched: filesToSearch.length,\n          filesMatched,\n          totalMatches,\n          truncated,\n        };\n      } catch (error) {\n        return {\n          success: false,\n          error: `Grep search failed: ${error instanceof Error ? error.message : String(error)}`,\n        };\n      }\n    },\n  };\n}\n\n/**\n * Default Grep tool instance\n */\nexport const grep = createGrepTool();\n","/**\n * List Directory Tool\n *\n * Lists contents of a directory on the local filesystem.\n * Shows files and directories with metadata.\n *\n * Features:\n * - Lists files and directories\n * - Shows file sizes and modification times\n * - Supports recursive listing\n * - Filters by type (files only, directories only)\n */\n\nimport { readdir, stat } from 'node:fs/promises';\nimport { existsSync } from 'node:fs';\nimport { join, relative } from 'node:path';\nimport type { ToolFunction } from '../../domain/entities/Tool.js';\nimport {\n  type FilesystemToolConfig,\n  DEFAULT_FILESYSTEM_CONFIG,\n  validatePath,\n} from './types.js';\n\n/**\n * Arguments for the list directory tool\n */\nexport interface ListDirectoryArgs {\n  /** Path to the directory to list */\n  path: string;\n  /** Whether to list recursively */\n  recursive?: boolean;\n  /** Filter: \"files\" for files only, \"directories\" for directories only */\n  filter?: 'files' | 'directories';\n  /** Maximum depth for recursive listing (default: 3) */\n  max_depth?: number;\n}\n\n/**\n * A single directory entry\n */\nexport interface DirectoryEntry {\n  name: string;\n  path: string;\n  type: 'file' | 'directory';\n  size?: number;\n  modified?: string;\n}\n\n/**\n * Result of a list directory operation\n */\nexport interface ListDirectoryResult {\n  success: boolean;\n  entries?: DirectoryEntry[];\n  count?: number;\n  truncated?: boolean;\n  error?: string;\n}\n\n/**\n * Recursively list directory contents\n */\nasync function listDir(\n  dir: string,\n  baseDir: string,\n  config: Required<FilesystemToolConfig>,\n  recursive: boolean,\n  filter?: 'files' | 'directories',\n  maxDepth: number = 3,\n  currentDepth: number = 0,\n  entries: DirectoryEntry[] = []\n): Promise<DirectoryEntry[]> {\n  if (currentDepth > maxDepth || entries.length >= config.maxResults) {\n    return entries;\n  }\n\n  try {\n    const dirEntries = await readdir(dir, { withFileTypes: true });\n\n    for (const entry of dirEntries) {\n      if (entries.length >= config.maxResults) break;\n\n      const fullPath = join(dir, entry.name);\n      const relativePath = relative(baseDir, fullPath);\n\n      // Check if directory is blocked\n      if (entry.isDirectory() && config.blockedDirectories.includes(entry.name)) {\n        continue;\n      }\n\n      const isFile = entry.isFile();\n      const isDir = entry.isDirectory();\n\n      // Apply filter\n      if (filter === 'files' && !isFile) {\n        if (isDir && recursive) {\n          await listDir(fullPath, baseDir, config, recursive, filter, maxDepth, currentDepth + 1, entries);\n        }\n        continue;\n      }\n      if (filter === 'directories' && !isDir) continue;\n\n      try {\n        const stats = await stat(fullPath);\n\n        const dirEntry: DirectoryEntry = {\n          name: entry.name,\n          path: relativePath,\n          type: isFile ? 'file' : 'directory',\n        };\n\n        if (isFile) {\n          dirEntry.size = stats.size;\n        }\n        dirEntry.modified = stats.mtime.toISOString();\n\n        entries.push(dirEntry);\n\n        // Recurse into directories\n        if (isDir && recursive) {\n          await listDir(fullPath, baseDir, config, recursive, filter, maxDepth, currentDepth + 1, entries);\n        }\n      } catch {\n        // Skip entries we can't stat\n      }\n    }\n  } catch {\n    // Skip directories we can't read\n  }\n\n  return entries;\n}\n\n/**\n * Create a List Directory tool with the given configuration\n */\nexport function createListDirectoryTool(config: FilesystemToolConfig = {}): ToolFunction<ListDirectoryArgs, ListDirectoryResult> {\n  const mergedConfig = { ...DEFAULT_FILESYSTEM_CONFIG, ...config };\n\n  return {\n    definition: {\n      type: 'function',\n      function: {\n        name: 'list_directory',\n        description: `List the contents of a directory on the local filesystem.\n\nUSAGE:\n- Shows files and directories in the specified path\n- Includes file sizes and modification times\n- Can list recursively with depth limit\n- Can filter to show only files or only directories\n\nWHEN TO USE:\n- To explore a project's structure\n- To see what files exist in a directory\n- To find files before using read_file or edit_file\n- As an alternative to glob when you want to see directory structure\n\nEXAMPLES:\n- List current directory: { \"path\": \".\" }\n- List specific directory: { \"path\": \"/path/to/project/src\" }\n- List recursively: { \"path\": \".\", \"recursive\": true, \"max_depth\": 2 }\n- List only files: { \"path\": \".\", \"filter\": \"files\" }\n- List only directories: { \"path\": \".\", \"filter\": \"directories\" }`,\n        parameters: {\n          type: 'object',\n          properties: {\n            path: {\n              type: 'string',\n              description: 'Path to the directory to list',\n            },\n            recursive: {\n              type: 'boolean',\n              description: 'Whether to list recursively (default: false)',\n            },\n            filter: {\n              type: 'string',\n              enum: ['files', 'directories'],\n              description: 'Filter to show only files or only directories',\n            },\n            max_depth: {\n              type: 'number',\n              description: 'Maximum depth for recursive listing (default: 3)',\n            },\n          },\n          required: ['path'],\n        },\n      },\n    },\n\n    describeCall: (args: ListDirectoryArgs): string => {\n      const flags: string[] = [];\n      if (args.recursive) flags.push('recursive');\n      if (args.filter) flags.push(args.filter);\n      if (flags.length > 0) {\n        return `${args.path} (${flags.join(', ')})`;\n      }\n      return args.path;\n    },\n\n    execute: async (args: ListDirectoryArgs): Promise<ListDirectoryResult> => {\n      const { path, recursive = false, filter, max_depth = 3 } = args;\n\n      // Validate path\n      const validation = validatePath(path, {\n        ...mergedConfig,\n        blockedDirectories: [], // Allow listing any valid directory\n      });\n      if (!validation.valid) {\n        return {\n          success: false,\n          error: validation.error,\n        };\n      }\n\n      const resolvedPath = validation.resolvedPath;\n\n      // Check if directory exists\n      if (!existsSync(resolvedPath)) {\n        return {\n          success: false,\n          error: `Directory not found: ${path}`,\n        };\n      }\n\n      try {\n        const stats = await stat(resolvedPath);\n        if (!stats.isDirectory()) {\n          return {\n            success: false,\n            error: `Path is not a directory: ${path}. Use read_file to read file contents.`,\n          };\n        }\n\n        // List directory contents\n        const entries = await listDir(\n          resolvedPath,\n          resolvedPath,\n          mergedConfig,\n          recursive,\n          filter,\n          max_depth\n        );\n\n        // Sort: directories first, then alphabetically\n        entries.sort((a, b) => {\n          if (a.type !== b.type) {\n            return a.type === 'directory' ? -1 : 1;\n          }\n          return a.name.localeCompare(b.name);\n        });\n\n        const truncated = entries.length >= mergedConfig.maxResults;\n\n        return {\n          success: true,\n          entries,\n          count: entries.length,\n          truncated,\n        };\n      } catch (error) {\n        return {\n          success: false,\n          error: `Failed to list directory: ${error instanceof Error ? error.message : String(error)}`,\n        };\n      }\n    },\n  };\n}\n\n/**\n * Default List Directory tool instance\n */\nexport const listDirectory = createListDirectoryTool();\n","/**\n * Shell Tools - Shared Types\n *\n * Common types and configuration for shell command execution.\n */\n\n/**\n * Configuration for shell tools\n */\nexport interface ShellToolConfig {\n  /**\n   * Working directory for command execution.\n   * Defaults to process.cwd()\n   */\n  workingDirectory?: string;\n\n  /**\n   * Default timeout for commands in milliseconds.\n   * Default: 120000 (2 minutes)\n   */\n  defaultTimeout?: number;\n\n  /**\n   * Maximum timeout allowed in milliseconds.\n   * Default: 600000 (10 minutes)\n   */\n  maxTimeout?: number;\n\n  /**\n   * Shell to use for command execution.\n   * Default: '/bin/bash' on Unix, 'cmd.exe' on Windows\n   */\n  shell?: string;\n\n  /**\n   * Environment variables to add to command execution.\n   */\n  env?: Record<string, string>;\n\n  /**\n   * Commands that are blocked from execution.\n   * Default: dangerous commands like rm -rf /\n   */\n  blockedCommands?: string[];\n\n  /**\n   * Patterns that if matched will block the command.\n   * Default: patterns that could cause data loss\n   */\n  blockedPatterns?: RegExp[];\n\n  /**\n   * Maximum output size in characters before truncation.\n   * Default: 100000 (100KB)\n   */\n  maxOutputSize?: number;\n\n  /**\n   * Whether to allow running commands in background.\n   * Default: true\n   */\n  allowBackground?: boolean;\n}\n\n/**\n * Default configuration\n */\nexport const DEFAULT_SHELL_CONFIG: Required<ShellToolConfig> = {\n  workingDirectory: process.cwd(),\n  defaultTimeout: 120000, // 2 minutes\n  maxTimeout: 600000, // 10 minutes\n  shell: process.platform === 'win32' ? 'cmd.exe' : '/bin/bash',\n  env: {},\n  blockedCommands: [\n    'rm -rf /',\n    'rm -rf /*',\n    'rm -rf ~',\n    'rm -rf ~/*',\n    'mkfs',\n    'dd if=/dev/zero',\n    ':(){:|:&};:', // Fork bomb\n  ],\n  blockedPatterns: [\n    /rm\\s+(-rf?|--recursive)\\s+\\/(?!\\S)/i, // rm -rf / variations\n    />\\s*\\/dev\\/sd[a-z]/i, // Writing to disk devices\n    /mkfs/i,\n    /dd\\s+.*of=\\/dev\\//i, // dd to devices\n  ],\n  maxOutputSize: 100000,\n  allowBackground: true,\n};\n\n/**\n * Result of a bash command execution\n */\nexport interface BashResult {\n  success: boolean;\n  stdout?: string;\n  stderr?: string;\n  exitCode?: number;\n  signal?: string;\n  duration?: number;\n  truncated?: boolean;\n  error?: string;\n  backgroundId?: string;\n}\n\n/**\n * Check if a command should be blocked\n */\nexport function isBlockedCommand(\n  command: string,\n  config: ShellToolConfig = {}\n): { blocked: boolean; reason?: string } {\n  const blockedCommands = config.blockedCommands || DEFAULT_SHELL_CONFIG.blockedCommands;\n  const blockedPatterns = config.blockedPatterns || DEFAULT_SHELL_CONFIG.blockedPatterns;\n\n  // Check exact matches\n  for (const blocked of blockedCommands) {\n    if (command.includes(blocked)) {\n      return { blocked: true, reason: `Command contains blocked sequence: \"${blocked}\"` };\n    }\n  }\n\n  // Check patterns\n  for (const pattern of blockedPatterns) {\n    if (pattern.test(command)) {\n      return { blocked: true, reason: `Command matches blocked pattern` };\n    }\n  }\n\n  return { blocked: false };\n}\n","/**\n * Bash Tool\n *\n * Executes shell commands with timeout and output handling.\n * Provides safe command execution with configurable restrictions.\n *\n * Features:\n * - Configurable timeouts\n * - Output truncation for large outputs\n * - Background execution support\n * - Blocked command patterns for safety\n * - Working directory persistence\n */\n\nimport { spawn } from 'node:child_process';\nimport type { ToolFunction } from '../../domain/entities/Tool.js';\nimport {\n  type ShellToolConfig,\n  type BashResult,\n  DEFAULT_SHELL_CONFIG,\n  isBlockedCommand,\n} from './types.js';\n\n/**\n * Arguments for the bash tool\n */\nexport interface BashArgs {\n  /** The command to execute */\n  command: string;\n  /** Optional timeout in milliseconds (up to 600000ms / 10 minutes) */\n  timeout?: number;\n  /** Description of what this command does (for clarity) */\n  description?: string;\n  /** Run the command in the background */\n  run_in_background?: boolean;\n}\n\n// Track background processes\nconst backgroundProcesses: Map<string, { process: ReturnType<typeof spawn>; output: string[] }> = new Map();\n\n/**\n * Generate a unique ID for background processes\n */\nfunction generateBackgroundId(): string {\n  return `bg_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n}\n\n/**\n * Create a Bash tool with the given configuration\n */\nexport function createBashTool(config: ShellToolConfig = {}): ToolFunction<BashArgs, BashResult> {\n  const mergedConfig = { ...DEFAULT_SHELL_CONFIG, ...config };\n\n  return {\n    definition: {\n      type: 'function',\n      function: {\n        name: 'bash',\n        description: `Execute shell commands with optional timeout.\n\nUSAGE:\n- Execute any shell command\n- Working directory persists between commands\n- Commands timeout after 2 minutes by default (configurable up to 10 minutes)\n- Large outputs (>100KB) will be truncated\n\nIMPORTANT: This tool is for terminal operations like git, npm, docker, etc.\nFor file operations, prefer dedicated tools:\n- Use read_file instead of cat/head/tail\n- Use edit_file instead of sed/awk\n- Use write_file instead of echo with redirection\n- Use glob instead of find\n- Use grep tool instead of grep command\n\nBEST PRACTICES:\n- Always quote file paths with spaces: cd \"/path with spaces\"\n- Use absolute paths when possible\n- Chain dependent commands with &&: git add . && git commit -m \"msg\"\n- Use ; only when you don't care if earlier commands fail\n- Avoid interactive commands (no -i flags)\n\nGIT SAFETY:\n- NEVER run destructive commands (push --force, reset --hard, clean -f) without explicit permission\n- NEVER update git config\n- NEVER skip hooks (--no-verify) without permission\n- Always create NEW commits rather than amending\n- Stage specific files rather than using \"git add -A\"\n\nEXAMPLES:\n- Run npm install: { \"command\": \"npm install\", \"description\": \"Install dependencies\" }\n- Check git status: { \"command\": \"git status\", \"description\": \"Show working tree status\" }\n- Run tests: { \"command\": \"npm test\", \"timeout\": 300000, \"description\": \"Run test suite\" }\n- Build project: { \"command\": \"npm run build\", \"description\": \"Build the project\" }`,\n        parameters: {\n          type: 'object',\n          properties: {\n            command: {\n              type: 'string',\n              description: 'The shell command to execute',\n            },\n            timeout: {\n              type: 'number',\n              description: 'Optional timeout in milliseconds (max 600000ms / 10 minutes)',\n            },\n            description: {\n              type: 'string',\n              description: 'Clear, concise description of what this command does',\n            },\n            run_in_background: {\n              type: 'boolean',\n              description: 'Run the command in the background. Returns immediately with a background ID.',\n            },\n          },\n          required: ['command'],\n        },\n      },\n    },\n\n    describeCall: (args: BashArgs): string => {\n      const cmd = args.command;\n      const maxLen = 60;\n      const prefix = args.run_in_background ? '[bg] ' : '';\n      if (cmd.length > maxLen - prefix.length) {\n        return prefix + cmd.slice(0, maxLen - prefix.length - 3) + '...';\n      }\n      return prefix + cmd;\n    },\n\n    execute: async (args: BashArgs): Promise<BashResult> => {\n      const {\n        command,\n        timeout = mergedConfig.defaultTimeout,\n        run_in_background = false,\n      } = args;\n\n      // Check for blocked commands\n      const blockCheck = isBlockedCommand(command, mergedConfig);\n      if (blockCheck.blocked) {\n        return {\n          success: false,\n          error: `Command blocked for safety: ${blockCheck.reason}`,\n        };\n      }\n\n      // Validate timeout\n      const effectiveTimeout = Math.min(timeout, mergedConfig.maxTimeout);\n\n      // Prepare environment\n      const env = {\n        ...process.env,\n        ...mergedConfig.env,\n      };\n\n      return new Promise((resolve) => {\n        const startTime = Date.now();\n\n        // Spawn the process\n        const childProcess = spawn(command, [], {\n          shell: mergedConfig.shell,\n          cwd: mergedConfig.workingDirectory,\n          env,\n          stdio: ['pipe', 'pipe', 'pipe'],\n        });\n\n        // Handle background execution\n        if (run_in_background && mergedConfig.allowBackground) {\n          const bgId = generateBackgroundId();\n          const output: string[] = [];\n\n          backgroundProcesses.set(bgId, { process: childProcess, output });\n\n          childProcess.stdout.on('data', (data) => {\n            output.push(data.toString());\n          });\n\n          childProcess.stderr.on('data', (data) => {\n            output.push(data.toString());\n          });\n\n          childProcess.on('close', () => {\n            // Keep output for a while after completion\n            setTimeout(() => {\n              backgroundProcesses.delete(bgId);\n            }, 300000); // 5 minutes\n          });\n\n          resolve({\n            success: true,\n            backgroundId: bgId,\n            stdout: `Command started in background with ID: ${bgId}`,\n          });\n          return;\n        }\n\n        let stdout = '';\n        let stderr = '';\n        let killed = false;\n\n        // Set up timeout\n        const timeoutId = setTimeout(() => {\n          killed = true;\n          childProcess.kill('SIGTERM');\n          setTimeout(() => {\n            if (!childProcess.killed) {\n              childProcess.kill('SIGKILL');\n            }\n          }, 5000);\n        }, effectiveTimeout);\n\n        // Collect stdout\n        childProcess.stdout.on('data', (data) => {\n          stdout += data.toString();\n          // Prevent memory issues with huge outputs\n          if (stdout.length > mergedConfig.maxOutputSize * 2) {\n            stdout = stdout.slice(-mergedConfig.maxOutputSize);\n          }\n        });\n\n        // Collect stderr\n        childProcess.stderr.on('data', (data) => {\n          stderr += data.toString();\n          if (stderr.length > mergedConfig.maxOutputSize * 2) {\n            stderr = stderr.slice(-mergedConfig.maxOutputSize);\n          }\n        });\n\n        // Handle process completion\n        childProcess.on('close', (code, signal) => {\n          clearTimeout(timeoutId);\n          const duration = Date.now() - startTime;\n\n          // Truncate output if needed\n          let truncated = false;\n          if (stdout.length > mergedConfig.maxOutputSize) {\n            stdout = stdout.slice(0, mergedConfig.maxOutputSize) + '\\n... (output truncated)';\n            truncated = true;\n          }\n          if (stderr.length > mergedConfig.maxOutputSize) {\n            stderr = stderr.slice(0, mergedConfig.maxOutputSize) + '\\n... (output truncated)';\n            truncated = true;\n          }\n\n          if (killed) {\n            resolve({\n              success: false,\n              stdout,\n              stderr,\n              exitCode: code ?? undefined,\n              signal: signal ?? undefined,\n              duration,\n              truncated,\n              error: `Command timed out after ${effectiveTimeout}ms`,\n            });\n          } else {\n            resolve({\n              success: code === 0,\n              stdout,\n              stderr,\n              exitCode: code ?? undefined,\n              signal: signal ?? undefined,\n              duration,\n              truncated,\n              error: code !== 0 ? `Command exited with code ${code}` : undefined,\n            });\n          }\n        });\n\n        // Handle spawn errors\n        childProcess.on('error', (error) => {\n          clearTimeout(timeoutId);\n          resolve({\n            success: false,\n            error: `Failed to execute command: ${error.message}`,\n            duration: Date.now() - startTime,\n          });\n        });\n      });\n    },\n  };\n}\n\n/**\n * Get output from a background process\n */\nexport function getBackgroundOutput(bgId: string): { found: boolean; output?: string; running?: boolean } {\n  const bg = backgroundProcesses.get(bgId);\n  if (!bg) {\n    return { found: false };\n  }\n\n  return {\n    found: true,\n    output: bg.output.join(''),\n    running: !bg.process.killed && bg.process.exitCode === null,\n  };\n}\n\n/**\n * Kill a background process\n */\nexport function killBackgroundProcess(bgId: string): boolean {\n  const bg = backgroundProcesses.get(bgId);\n  if (!bg) {\n    return false;\n  }\n\n  bg.process.kill('SIGTERM');\n  return true;\n}\n\n/**\n * Default Bash tool instance\n */\nexport const bash = createBashTool();\n","/**\n * Path utilities for dot notation path manipulation in JSON objects\n */\n\n/**\n * Parse dot notation path into array of keys\n *\n * Examples:\n *   'user.name'  ['user', 'name']\n *   'users.0.name'  ['users', '0', 'name']\n *   'settings.theme.colors.primary'  ['settings', 'theme', 'colors', 'primary']\n *   ''  []\n */\nexport function parsePath(path: string): string[] {\n  if (path === '' || path === '$') {\n    return [];\n  }\n\n  const keys = path.split('.');\n\n  // Filter out empty strings (from consecutive dots)\n  const filtered = keys.filter((p) => p.length > 0);\n\n  // Validate no consecutive dots\n  if (filtered.length !== keys.length) {\n    throw new Error(`Invalid path format: ${path} (consecutive dots not allowed)`);\n  }\n\n  return filtered;\n}\n\n/**\n * Get value at path in object\n *\n * Returns undefined if path doesn't exist\n */\nexport function getValueAtPath(obj: any, path: string): any {\n  const keys = parsePath(path);\n  let current = obj;\n\n  for (const key of keys) {\n    if (current === null || current === undefined) {\n      return undefined;\n    }\n\n    // Handle both object properties and array indices\n    current = current[key];\n  }\n\n  return current;\n}\n\n/**\n * Set value at path in object (mutates the object)\n *\n * Creates intermediate objects/arrays as needed\n *\n * @returns true if successful\n * @throws Error if path is invalid or root-level\n */\nexport function setValueAtPath(obj: any, path: string, value: any): boolean {\n  const keys = parsePath(path);\n\n  if (keys.length === 0) {\n    throw new Error('Cannot set root object - path must not be empty');\n  }\n\n  let current = obj;\n\n  // Navigate to parent of target\n  for (let i = 0; i < keys.length - 1; i++) {\n    const key = keys[i]!;\n\n    // Create intermediate objects/arrays if they don't exist\n    if (!(key in current) || current[key] === null || current[key] === undefined) {\n      // Check if next key is numeric (array index)\n      const nextKey = keys[i + 1];\n      const isArrayIndex = nextKey !== undefined && /^\\d+$/.test(nextKey);\n\n      current[key] = isArrayIndex ? [] : {};\n    }\n\n    current = current[key];\n\n    // Validate we can continue navigation\n    if (current === null || current === undefined) {\n      throw new Error(`Cannot navigate through null/undefined at path: ${keys.slice(0, i + 1).join('.')}`);\n    }\n  }\n\n  // Set the final value\n  const lastKey = keys[keys.length - 1]!;\n\n  // For arrays, handle numeric indices\n  if (Array.isArray(current)) {\n    const index = parseInt(lastKey);\n    if (isNaN(index)) {\n      throw new Error(`Array index must be numeric, got: ${lastKey}`);\n    }\n    // Allow appending beyond array length\n    current[index] = value;\n  } else {\n    current[lastKey] = value;\n  }\n\n  return true;\n}\n\n/**\n * Delete value at path in object (mutates the object)\n *\n * @returns true if deleted, false if path doesn't exist\n * @throws Error if path is invalid or root-level\n */\nexport function deleteAtPath(obj: any, path: string): boolean {\n  const keys = parsePath(path);\n\n  if (keys.length === 0) {\n    throw new Error('Cannot delete root object - path must not be empty');\n  }\n\n  let current = obj;\n\n  // Navigate to parent\n  for (let i = 0; i < keys.length - 1; i++) {\n    const key = keys[i]!;\n\n    if (!(key in current)) {\n      return false; // Path doesn't exist\n    }\n\n    current = current[key];\n\n    if (current === null || current === undefined) {\n      return false; // Can't navigate further\n    }\n  }\n\n  const lastKey = keys[keys.length - 1]!;\n\n  // Check if key exists\n  if (!(lastKey in current)) {\n    return false;\n  }\n\n  // Delete from array or object\n  if (Array.isArray(current)) {\n    const index = parseInt(lastKey);\n    if (isNaN(index) || index < 0 || index >= current.length) {\n      return false;\n    }\n    current.splice(index, 1);\n  } else {\n    delete current[lastKey];\n  }\n\n  return true;\n}\n\n/**\n * Check if path exists in object\n */\nexport function pathExists(obj: any, path: string): boolean {\n  try {\n    const value = getValueAtPath(obj, path);\n    return value !== undefined;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Validate path format\n *\n * @returns true if valid, throws Error with message if invalid\n */\nexport function validatePath(path: string): boolean {\n  // Empty path is valid (represents root)\n  if (path === '' || path === '$') {\n    return true;\n  }\n\n  // Check for invalid characters\n  if (path.includes('..')) {\n    throw new Error('Invalid path: consecutive dots not allowed');\n  }\n\n  if (path.startsWith('.') || path.endsWith('.')) {\n    throw new Error('Invalid path: cannot start or end with dot');\n  }\n\n  // Try to parse it\n  parsePath(path);\n\n  return true;\n}\n","/**\n * JSON Manipulation Tool\n *\n * Allows AI agents to manipulate JSON objects using dot notation paths.\n * Supports delete, add, and replace operations at any depth.\n */\n\nimport { ToolFunction } from '../../domain/entities/Tool.js';\nimport { setValueAtPath, deleteAtPath, pathExists } from './pathUtils.js';\n\ninterface JsonManipulateArgs {\n  operation: 'delete' | 'add' | 'replace';\n  path: string;\n  value?: any;\n  object: any;\n}\n\ninterface JsonManipulateResult {\n  success: boolean;\n  result: any | null;\n  message?: string;\n  error?: string;\n}\n\nexport const jsonManipulator: ToolFunction<JsonManipulateArgs, JsonManipulateResult> = {\n  definition: {\n    type: 'function',\n    function: {\n      name: 'json_manipulate',\n      description: `Manipulate JSON objects by deleting, adding, or replacing fields at any depth.\n\nIMPORTANT - PATH FORMAT (DOT NOTATION):\nUse dots to separate nested field names. Examples:\n Top-level field: \"name\"\n Nested field: \"user.email\"\n Array element: \"users.0.name\" (where 0 is the array index)\n Deep nesting: \"settings.theme.colors.primary\"\n For root operations: use empty string \"\"\n\nOPERATIONS:\n\n1. DELETE - Remove a field from the object\n    Removes the specified field and its value\n    Returns error if path doesn't exist\n    Example: operation=\"delete\", path=\"user.address.city\"\n    Result: The city field is removed from user.address\n\n2. ADD - Add a new field to the object\n    Creates intermediate objects/arrays if they don't exist\n    If field already exists, it will be overwritten\n    Example: operation=\"add\", path=\"user.phone\", value=\"+1234567890\"\n    Result: Creates user.phone field with the phone number\n\n3. REPLACE - Replace the value of an EXISTING field\n    Only works if the field already exists (use ADD for new fields)\n    Returns error if path doesn't exist\n    Example: operation=\"replace\", path=\"user.name\", value=\"Jane Doe\"\n    Result: Changes the existing user.name value\n\nARRAY OPERATIONS:\n Access array elements by index: \"users.0.name\" (first user's name)\n Add to array: \"users.2\" appends if index >= array length\n Delete from array: \"users.1\" removes element and shifts remaining items\n\nCOMPLETE EXAMPLES:\n\nExample 1 - Delete a field:\n  Input: { operation: \"delete\", path: \"user.email\", object: {user: {name: \"John\", email: \"j@ex.com\"}} }\n  Output: {user: {name: \"John\"}}\n\nExample 2 - Add nested field (auto-creates intermediate objects):\n  Input: { operation: \"add\", path: \"user.address.city\", value: \"Paris\", object: {user: {name: \"John\"}} }\n  Output: {user: {name: \"John\", address: {city: \"Paris\"}}}\n\nExample 3 - Replace value:\n  Input: { operation: \"replace\", path: \"settings.theme\", value: \"dark\", object: {settings: {theme: \"light\"}} }\n  Output: {settings: {theme: \"dark\"}}\n\nExample 4 - Array manipulation:\n  Input: { operation: \"replace\", path: \"users.0.active\", value: false, object: {users: [{name: \"Bob\", active: true}]} }\n  Output: {users: [{name: \"Bob\", active: false}]}\n\nThe tool returns a result object with:\n success: boolean (true if operation succeeded)\n result: the modified JSON object (or null if failed)\n message: success message (if succeeded)\n error: error description (if failed)`,\n\n      parameters: {\n        type: 'object',\n        properties: {\n          operation: {\n            type: 'string',\n            enum: ['delete', 'add', 'replace'],\n            description:\n              'The operation to perform. \"delete\" removes a field, \"add\" creates a new field (or overwrites existing), \"replace\" changes an existing field value.',\n          },\n          path: {\n            type: 'string',\n            description:\n              'Dot notation path to the field. Examples: \"name\", \"user.email\", \"users.0.name\", \"settings.theme.colors.primary\". Use empty string \"\" only for root-level operations.',\n          },\n          value: {\n            description:\n              'The value to add or replace. Can be any JSON-compatible type: string, number, boolean, object, array, or null. Required for add/replace operations, ignored for delete.',\n          },\n          object: {\n            type: 'object',\n            description:\n              'The JSON object to manipulate. The original object is not modified; a new modified copy is returned in the result.',\n          },\n        },\n        required: ['operation', 'path', 'object'],\n      },\n    },\n    blocking: true, // Always wait for result\n    timeout: 10000, // 10 seconds should be plenty for JSON operations\n  },\n\n  execute: async (args: JsonManipulateArgs): Promise<JsonManipulateResult> => {\n    try {\n      // Validate operation\n      if (!['delete', 'add', 'replace'].includes(args.operation)) {\n        return {\n          success: false,\n          result: null,\n          error: `Invalid operation: \"${args.operation}\". Must be \"delete\", \"add\", or \"replace\".`,\n        };\n      }\n\n      // Validate object is provided\n      if (!args.object || typeof args.object !== 'object') {\n        return {\n          success: false,\n          result: null,\n          error: 'Invalid object: must provide a valid JSON object',\n        };\n      }\n\n      // Clone object to avoid mutation (deep clone)\n      let clonedObject: any;\n      try {\n        clonedObject = JSON.parse(JSON.stringify(args.object));\n      } catch (error: any) {\n        return {\n          success: false,\n          result: null,\n          error: `Cannot clone object: ${error.message}. Object may contain circular references or non-JSON values.`,\n        };\n      }\n\n      // Perform operation\n      switch (args.operation) {\n        case 'delete': {\n          try {\n            const deleted = deleteAtPath(clonedObject, args.path);\n\n            if (!deleted) {\n              return {\n                success: false,\n                result: null,\n                error: `Path not found: \"${args.path}\". The field does not exist in the object.`,\n              };\n            }\n\n            return {\n              success: true,\n              result: clonedObject,\n              message: `Successfully deleted field at path: \"${args.path}\"`,\n            };\n          } catch (error: any) {\n            return {\n              success: false,\n              result: null,\n              error: `Delete operation failed: ${error.message}`,\n            };\n          }\n        }\n\n        case 'add': {\n          // Validate value is provided\n          if (args.value === undefined) {\n            return {\n              success: false,\n              result: null,\n              error: 'Add operation requires a \"value\" parameter',\n            };\n          }\n\n          try {\n            setValueAtPath(clonedObject, args.path, args.value);\n\n            return {\n              success: true,\n              result: clonedObject,\n              message: `Successfully added field at path: \"${args.path}\"`,\n            };\n          } catch (error: any) {\n            return {\n              success: false,\n              result: null,\n              error: `Add operation failed: ${error.message}`,\n            };\n          }\n        }\n\n        case 'replace': {\n          // Validate value is provided\n          if (args.value === undefined) {\n            return {\n              success: false,\n              result: null,\n              error: 'Replace operation requires a \"value\" parameter',\n            };\n          }\n\n          // Check if path exists (replace only works on existing paths)\n          if (!pathExists(clonedObject, args.path)) {\n            return {\n              success: false,\n              result: null,\n              error: `Path not found: \"${args.path}\". Use \"add\" operation to create new fields.`,\n            };\n          }\n\n          try {\n            setValueAtPath(clonedObject, args.path, args.value);\n\n            return {\n              success: true,\n              result: clonedObject,\n              message: `Successfully replaced value at path: \"${args.path}\"`,\n            };\n          } catch (error: any) {\n            return {\n              success: false,\n              result: null,\n              error: `Replace operation failed: ${error.message}`,\n            };\n          }\n        }\n\n        default:\n          return {\n            success: false,\n            result: null,\n            error: `Unknown operation: ${args.operation}`,\n          };\n      }\n    } catch (error: any) {\n      return {\n        success: false,\n        result: null,\n        error: `Unexpected error manipulating JSON: ${error.message}`,\n      };\n    }\n  },\n};\n","/**\n * Content quality detection for web scraping\n * Detects if content is valid, requires JavaScript, or has errors\n */\n\nimport type { CheerioAPI } from 'cheerio';\n\nexport interface QualityResult {\n  score: number; // 0-100\n  requiresJS: boolean;\n  suggestion?: string;\n  issues: string[];\n}\n\n/**\n * Detect content quality from HTML and extracted text\n */\nexport function detectContentQuality(\n  html: string,\n  text: string,\n  $: CheerioAPI\n): QualityResult {\n  const issues: string[] = [];\n  let score = 100;\n  let requiresJS = false;\n\n  // Check 1: Empty or very short content\n  if (text.length < 100) {\n    issues.push('Very little text content extracted');\n    score -= 40;\n    requiresJS = true;\n  }\n\n  // Check 2: Detect common error patterns\n  const errorPatterns = [\n    { pattern: /access denied/i, penalty: 50 },\n    { pattern: /403 forbidden/i, penalty: 50 },\n    { pattern: /404 not found/i, penalty: 50 },\n    { pattern: /page not found/i, penalty: 40 },\n    { pattern: /cloudflare/i, penalty: 30 },\n    { pattern: /please enable javascript/i, penalty: 40 },\n    { pattern: /requires javascript/i, penalty: 40 },\n    { pattern: /robot|bot detection/i, penalty: 30 },\n  ];\n\n  for (const { pattern, penalty } of errorPatterns) {\n    if (pattern.test(html) || pattern.test(text)) {\n      issues.push(`Error pattern detected: ${pattern.source}`);\n      score -= penalty;\n    }\n  }\n\n  // Check 3: Mostly script tags (code dumps)\n  const scriptCount = $('script').length;\n  const textLength = text.length;\n\n  if (scriptCount > 10 && textLength < 500) {\n    issues.push('Page is mostly JavaScript code (code dump)');\n    score -= 40;\n    requiresJS = true;\n  }\n\n  // Check 4: High script-to-content ratio\n  const scriptLength = $('script').text().length;\n  if (scriptLength > textLength * 2 && textLength < 1000) {\n    issues.push('High JavaScript-to-content ratio');\n    score -= 20;\n    requiresJS = true;\n  }\n\n  // Check 5: Common JS framework markers\n  const jsFrameworks = [\n    { pattern: /\\breact\\b/i, name: 'React' },\n    { pattern: /\\bvue\\b/i, name: 'Vue' },\n    { pattern: /\\bangular\\b/i, name: 'Angular' },\n    { pattern: /__NEXT_DATA__/i, name: 'Next.js' },\n    { pattern: /\\bwebpack\\b/i, name: 'Webpack' },\n    { pattern: /_app-.*\\.js/i, name: 'SPA' },\n  ];\n\n  for (const framework of jsFrameworks) {\n    if (framework.pattern.test(html)) {\n      issues.push(`${framework.name} framework detected`);\n      requiresJS = true;\n    }\n  }\n\n  // Check 6: Empty body with divs (typical SPA)\n  const bodyText = $('body').text().trim();\n  const divCount = $('div').length;\n\n  if (bodyText.length < 100 && divCount > 5) {\n    issues.push('Empty body with many divs (likely Single Page App)');\n    score -= 30;\n    requiresJS = true;\n  }\n\n  // Check 7: Noscript tag with meaningful content\n  const noscript = $('noscript').text();\n  if (noscript.length > 50) {\n    issues.push('Noscript tag present (site requires JavaScript)');\n    requiresJS = true;\n  }\n\n  // Check 8: Very few paragraphs/headings (typical of SPA skeleton)\n  const paragraphCount = $('p').length;\n  const headingCount = $('h1, h2, h3, h4, h5, h6').length;\n\n  if (paragraphCount < 3 && headingCount < 2 && textLength < 500) {\n    issues.push('Very few content elements (likely needs JavaScript)');\n    score -= 20;\n    requiresJS = true;\n  }\n\n  // Generate suggestion\n  let suggestion: string | undefined;\n  if (requiresJS && score < 50) {\n    suggestion =\n      'Content quality is low. This appears to be a JavaScript-rendered site. Use the web_fetch_js tool for better results.';\n  } else if (score < 30) {\n    suggestion = 'Content extraction failed or page has errors. Check the URL and try again.';\n  }\n\n  return {\n    score: Math.max(0, Math.min(100, score)),\n    requiresJS,\n    suggestion,\n    issues,\n  };\n}\n\n/**\n * Check if content looks like an error page\n */\nexport function isErrorPage(statusCode: number, html: string, text: string): boolean {\n  if (statusCode >= 400) return true;\n\n  const errorIndicators = [\n    /404|not found/i,\n    /403|forbidden|access denied/i,\n    /500|internal server error/i,\n    /503|service unavailable/i,\n  ];\n\n  for (const pattern of errorIndicators) {\n    if (pattern.test(html) || pattern.test(text)) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\n/**\n * Extract clean text content from HTML\n */\nexport function extractCleanText($: CheerioAPI): string {\n  // Remove unwanted elements\n  $('script, style, noscript, iframe, nav, footer, header, aside').remove();\n\n  // Remove common ad/tracking divs\n  $('[class*=\"ad-\"], [class*=\"advertisement\"], [id*=\"ad-\"]').remove();\n  $('[class*=\"cookie\"], [class*=\"gdpr\"]').remove();\n\n  // Get text from main content areas (prioritized)\n  const mainSelectors = [\n    'main',\n    'article',\n    '[role=\"main\"]',\n    '.content',\n    '#content',\n    '.post',\n    '.article',\n  ];\n\n  for (const selector of mainSelectors) {\n    const mainContent = $(selector).text().trim();\n    if (mainContent.length > 200) {\n      return mainContent;\n    }\n  }\n\n  // Fallback to body\n  return $('body').text().trim();\n}\n","/**\n * HTML to Markdown conversion utilities\n * Uses Readability for article extraction and Turndown for markdown conversion\n */\n\nimport TurndownService from 'turndown';\nimport { Readability } from '@mozilla/readability';\nimport type { Node as TurndownNode } from 'turndown';\n\n// Lazy-loaded jsdom to avoid bundling issues in Electron\nlet JSDOM: typeof import('jsdom').JSDOM | null = null;\n\nasync function getJSDOM(): Promise<typeof import('jsdom').JSDOM> {\n  if (!JSDOM) {\n    const jsdom = await import('jsdom');\n    JSDOM = jsdom.JSDOM;\n  }\n  return JSDOM;\n}\n\nexport interface MarkdownResult {\n  markdown: string;\n  title: string;\n  byline?: string;\n  excerpt?: string;\n  wasReadabilityUsed: boolean;\n  wasTruncated: boolean;\n}\n\n/**\n * Convert HTML to clean markdown\n *\n * Uses Readability to extract main article content (strips ads, nav, footer, etc.)\n * then converts to markdown with Turndown.\n *\n * @param html - Raw HTML string\n * @param url - URL of the page (used for resolving relative links)\n * @param maxLength - Maximum length of output markdown (default: 50000)\n * @returns MarkdownResult with cleaned content\n */\nexport async function htmlToMarkdown(\n  html: string,\n  url: string,\n  maxLength: number = 50000\n): Promise<MarkdownResult> {\n  // 1. Parse HTML with JSDOM (lazy-loaded)\n  const JSDOMClass = await getJSDOM();\n  const dom = new JSDOMClass(html, { url });\n  const document = dom.window.document;\n\n  let title = document.title || '';\n  let byline: string | undefined;\n  let excerpt: string | undefined;\n  let contentHtml = html;\n  let wasReadabilityUsed = false;\n\n  // 2. Try Readability for article extraction (strips ads, nav, footer, etc.)\n  try {\n    // Clone document for Readability (it modifies the DOM)\n    const clonedDoc = document.cloneNode(true) as typeof document;\n    const reader = new Readability(clonedDoc);\n    const article = reader.parse();\n\n    if (article && article.content && article.content.length > 100) {\n      contentHtml = article.content;\n      title = article.title || title;\n      byline = article.byline || undefined;\n      excerpt = article.excerpt || undefined;\n      wasReadabilityUsed = true;\n    }\n  } catch {\n    // Readability failed, use full HTML\n  }\n\n  // 3. Convert to Markdown with Turndown\n  const turndown = new TurndownService({\n    headingStyle: 'atx',\n    codeBlockStyle: 'fenced',\n    bulletListMarker: '-',\n    emDelimiter: '_',\n  });\n\n  // Remove script, style, nav, footer, aside, iframe tags\n  turndown.remove(['script', 'style', 'nav', 'footer', 'aside', 'iframe', 'noscript']);\n\n  // Custom rule for code blocks to preserve formatting\n  turndown.addRule('pre', {\n    filter: ['pre'],\n    replacement: (content: string, node: TurndownNode) => {\n      const element = node as unknown as Element;\n      const code = element.querySelector?.('code');\n      const lang = code?.className?.match(/language-(\\w+)/)?.[1] || '';\n      const text = code?.textContent || content;\n      return `\\n\\`\\`\\`${lang}\\n${text}\\n\\`\\`\\`\\n`;\n    },\n  });\n\n  // Convert to markdown\n  let markdown = turndown.turndown(contentHtml);\n\n  // 4. Clean up excessive whitespace\n  markdown = markdown\n    .replace(/\\n{3,}/g, '\\n\\n') // Max 2 consecutive newlines\n    .replace(/^\\s+|\\s+$/g, '') // Trim start/end\n    .replace(/[ \\t]+$/gm, ''); // Remove trailing spaces on lines\n\n  // 5. Truncate at paragraph boundary if needed\n  let wasTruncated = false;\n  if (markdown.length > maxLength) {\n    // Find last paragraph break before maxLength\n    const truncateAt = markdown.lastIndexOf('\\n\\n', maxLength);\n    if (truncateAt > maxLength * 0.5) {\n      markdown = markdown.slice(0, truncateAt) + '\\n\\n...[content truncated]';\n    } else {\n      // No good break point, just truncate\n      markdown = markdown.slice(0, maxLength) + '...[truncated]';\n    }\n    wasTruncated = true;\n  }\n\n  return {\n    markdown,\n    title,\n    byline,\n    excerpt,\n    wasReadabilityUsed,\n    wasTruncated,\n  };\n}\n\n/**\n * Quick check if HTML likely needs JavaScript rendering\n * (Useful for fallback decisions)\n */\nexport function likelyNeedsJavaScript(html: string): boolean {\n  const jsFrameworkPatterns = [\n    /__NEXT_DATA__/i,\n    /\\breact-root\\b/i,\n    /\\bng-app\\b/i,\n    /\\bdata-v-/i, // Vue scoped styles\n    /\\bapp-root\\b/i,\n    /\\bnuxt\\b/i,\n  ];\n\n  return jsFrameworkPatterns.some((pattern) => pattern.test(html));\n}\n","/**\n * Web Fetch Tool - Simple HTTP fetch with content quality detection\n */\n\nimport { load } from 'cheerio';\nimport { ToolFunction } from '../../domain/entities/Tool.js';\nimport { detectContentQuality } from './contentDetector.js';\nimport { htmlToMarkdown } from './htmlToMarkdown.js';\n\ninterface WebFetchArgs {\n  url: string;\n  userAgent?: string;\n  timeout?: number;\n}\n\ninterface WebFetchResult {\n  success: boolean;\n  url: string;\n  title: string;\n  content: string;\n  contentType: 'html' | 'json' | 'text' | 'error';\n  qualityScore: number;\n  requiresJS: boolean;\n  suggestedAction?: string;\n  issues?: string[];\n  error?: string;\n  // Markdown conversion metadata\n  excerpt?: string;\n  byline?: string;\n  wasReadabilityUsed?: boolean;\n  wasTruncated?: boolean;\n}\n\nexport const webFetch: ToolFunction<WebFetchArgs, WebFetchResult> = {\n  definition: {\n    type: 'function',\n    function: {\n      name: 'web_fetch',\n      description: `Fetch and extract text content from a web page URL.\n\nIMPORTANT: This tool performs a simple HTTP fetch and HTML parsing. It works well for:\n- Static websites (blogs, documentation, articles)\n- Server-rendered HTML pages\n- Content that doesn't require JavaScript\n\nLIMITATIONS:\n- Cannot execute JavaScript\n- May fail on React/Vue/Angular sites (will return low quality score)\n- May get blocked by bot protection\n- Cannot handle dynamic content loading\n\nQUALITY DETECTION:\nThe tool analyzes the fetched content and returns a quality score (0-100):\n- 80-100: Excellent quality, content extracted successfully\n- 50-79: Moderate quality, some content extracted\n- 0-49: Low quality, likely needs JavaScript or has errors\n\nIf the quality score is low or requiresJS is true, the tool will suggest using 'web_fetch_js' instead.\n\nRETURNS:\n{\n  success: boolean,\n  url: string,\n  title: string,\n  content: string,          // Clean markdown (converted from HTML via Readability + Turndown)\n  contentType: string,      // 'html' | 'json' | 'text' | 'error'\n  qualityScore: number,     // 0-100 (quality of extraction)\n  requiresJS: boolean,      // True if site likely needs JavaScript\n  suggestedAction: string,  // Suggestion if quality is low\n  issues: string[],         // List of detected issues\n  excerpt: string,          // Short summary excerpt (if extracted)\n  byline: string,           // Author info (if extracted)\n  wasTruncated: boolean,    // True if content was truncated\n  error: string             // Error message if failed\n}\n\nEXAMPLE:\nTo fetch a blog post:\n{\n  url: \"https://example.com/blog/article\"\n}\n\nWith custom user agent:\n{\n  url: \"https://example.com/page\",\n  userAgent: \"Mozilla/5.0 (Windows NT 10.0; Win64; x64)...\",\n  timeout: 15000\n}`,\n\n      parameters: {\n        type: 'object',\n        properties: {\n          url: {\n            type: 'string',\n            description: 'The URL to fetch. Must start with http:// or https://',\n          },\n          userAgent: {\n            type: 'string',\n            description: 'Optional custom user agent string. Default is a generic bot user agent.',\n          },\n          timeout: {\n            type: 'number',\n            description: 'Timeout in milliseconds (default: 10000)',\n          },\n        },\n        required: ['url'],\n      },\n    },\n    blocking: true,\n    timeout: 15000,\n  },\n\n  execute: async (args: WebFetchArgs): Promise<WebFetchResult> => {\n    try {\n      // Validate URL\n      try {\n        new URL(args.url);\n      } catch {\n        return {\n          success: false,\n          url: args.url,\n          title: '',\n          content: '',\n          contentType: 'error',\n          qualityScore: 0,\n          requiresJS: false,\n          error: 'Invalid URL format',\n        };\n      }\n\n      // Fetch with timeout\n      const controller = new AbortController();\n      const timeoutId = setTimeout(() => controller.abort(), args.timeout || 10000);\n\n      const response = await fetch(args.url, {\n        headers: {\n          'User-Agent':\n            args.userAgent ||\n            'Mozilla/5.0 (compatible; OneRingAI/1.0; +https://github.com/oneringai/agents)',\n          Accept: 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',\n          'Accept-Language': 'en-US,en;q=0.9',\n        },\n        signal: controller.signal,\n      });\n\n      clearTimeout(timeoutId);\n\n      // Check response status\n      if (!response.ok) {\n        return {\n          success: false,\n          url: args.url,\n          title: '',\n          content: '',\n          contentType: 'error',\n          qualityScore: 0,\n          requiresJS: false,\n          error: `HTTP ${response.status}: ${response.statusText}`,\n        };\n      }\n\n      // Get content type\n      const contentType = response.headers.get('content-type') || '';\n\n      // Handle JSON responses\n      if (contentType.includes('application/json')) {\n        const json = await response.json();\n        return {\n          success: true,\n          url: args.url,\n          title: 'JSON Response',\n          content: JSON.stringify(json, null, 2),\n          contentType: 'json',\n          qualityScore: 100,\n          requiresJS: false,\n        };\n      }\n\n      // Handle plain text\n      if (contentType.includes('text/plain')) {\n        const text = await response.text();\n        return {\n          success: true,\n          url: args.url,\n          title: 'Text Response',\n          content: text,\n          contentType: 'text',\n          qualityScore: 100,\n          requiresJS: false,\n        };\n      }\n\n      // Get HTML\n      const html = await response.text();\n\n      // Parse with cheerio for quality detection\n      const $ = load(html);\n\n      // Convert HTML to clean markdown\n      const mdResult = await htmlToMarkdown(html, args.url);\n\n      // Use markdown result title or fallback to cheerio extraction\n      const title = mdResult.title || $('title').text() || $('h1').first().text() || 'Untitled';\n\n      // Detect content quality (using markdown content for text analysis)\n      const quality = detectContentQuality(html, mdResult.markdown, $);\n\n      return {\n        success: true,\n        url: args.url,\n        title,\n        content: mdResult.markdown,\n        contentType: 'html',\n        qualityScore: quality.score,\n        requiresJS: quality.requiresJS,\n        suggestedAction: quality.suggestion,\n        issues: quality.issues,\n        excerpt: mdResult.excerpt,\n        byline: mdResult.byline,\n        wasReadabilityUsed: mdResult.wasReadabilityUsed,\n        wasTruncated: mdResult.wasTruncated,\n      };\n    } catch (error: any) {\n      // Handle abort errors specially\n      if (error.name === 'AbortError') {\n        return {\n          success: false,\n          url: args.url,\n          title: '',\n          content: '',\n          contentType: 'error',\n          qualityScore: 0,\n          requiresJS: false,\n          error: `Request timeout after ${args.timeout || 10000}ms`,\n        };\n      }\n\n      return {\n        success: false,\n        url: args.url,\n        title: '',\n        content: '',\n        contentType: 'error',\n        qualityScore: 0,\n        requiresJS: false,\n        error: (error as Error).message,\n      };\n    }\n  },\n};\n","/**\n * Web Fetch with JavaScript - Uses Puppeteer for JS-rendered sites\n * Optional tool - requires puppeteer to be installed\n */\n\nimport { ToolFunction } from '../../domain/entities/Tool.js';\nimport { htmlToMarkdown } from './htmlToMarkdown.js';\n\n// Lazy-load Puppeteer (optional dependency)\nlet puppeteerModule: any = null;\nlet browserInstance: any = null;\n\ninterface WebFetchJSArgs {\n  url: string;\n  waitForSelector?: string;\n  timeout?: number;\n  takeScreenshot?: boolean;\n}\n\ninterface WebFetchJSResult {\n  success: boolean;\n  url: string;\n  title: string;\n  content: string;\n  screenshot?: string;\n  loadTime: number;\n  error?: string;\n  suggestion?: string;\n  // Markdown conversion metadata\n  excerpt?: string;\n  byline?: string;\n  wasReadabilityUsed?: boolean;\n  wasTruncated?: boolean;\n}\n\n/**\n * Load Puppeteer dynamically (only when needed)\n */\nasync function loadPuppeteer(): Promise<any> {\n  if (!puppeteerModule) {\n    try {\n      puppeteerModule = await import('puppeteer');\n    } catch (error) {\n      throw new Error('Puppeteer not installed');\n    }\n  }\n  return puppeteerModule;\n}\n\n/**\n * Get or create browser instance (reuse for performance)\n */\nasync function getBrowser(): Promise<any> {\n  if (!browserInstance) {\n    const puppeteer = await loadPuppeteer();\n\n    browserInstance = await puppeteer.launch({\n      headless: true,\n      args: ['--no-sandbox', '--disable-setuid-sandbox', '--disable-dev-shm-usage'],\n    });\n\n    // Cleanup on process exit\n    process.on('exit', async () => {\n      if (browserInstance) {\n        await browserInstance.close();\n      }\n    });\n  }\n  return browserInstance;\n}\n\nexport const webFetchJS: ToolFunction<WebFetchJSArgs, WebFetchJSResult> = {\n  definition: {\n    type: 'function',\n    function: {\n      name: 'web_fetch_js',\n      description: `Fetch and extract content from JavaScript-rendered websites using a headless browser (Puppeteer).\n\nUSE THIS TOOL WHEN:\n- The web_fetch tool returned a low quality score (<50)\n- The web_fetch tool suggested using JavaScript rendering\n- You know the website is built with React/Vue/Angular/Next.js\n- Content loads dynamically via JavaScript\n- The page requires interaction (though this tool doesn't support interaction yet)\n\nHOW IT WORKS:\n- Launches a headless Chrome browser\n- Navigates to the URL\n- Waits for JavaScript to execute and content to load\n- Extracts the rendered HTML and text content\n- Optionally captures a screenshot\n\nCAPABILITIES:\n- Executes all JavaScript on the page\n- Waits for network to be idle (all resources loaded)\n- Can wait for specific CSS selectors to appear\n- Handles React, Vue, Angular, Next.js, and other SPAs\n- Returns content after full JavaScript execution\n\nLIMITATIONS:\n- Slower than web_fetch (typically 3-10 seconds vs <1 second)\n- Uses more system resources (runs a full browser)\n- May still fail on sites with aggressive bot detection\n- Requires puppeteer to be installed (npm install puppeteer)\n\nPERFORMANCE:\n- First call: Slower (launches browser ~1-2s)\n- Subsequent calls: Faster (reuses browser instance)\n\nRETURNS:\n{\n  success: boolean,\n  url: string,\n  title: string,\n  content: string,         // Clean markdown (converted via Readability + Turndown)\n  screenshot: string,      // Base64 PNG screenshot (if requested)\n  loadTime: number,        // Time taken in milliseconds\n  excerpt: string,         // Short summary excerpt (if extracted)\n  byline: string,          // Author info (if extracted)\n  wasTruncated: boolean,   // True if content was truncated\n  error: string           // Error message if failed\n}\n\nEXAMPLES:\nBasic usage:\n{\n  url: \"https://react-app.com/page\"\n}\n\nWait for specific content:\n{\n  url: \"https://app.com/dashboard\",\n  waitForSelector: \"#main-content\",  // Wait for this element\n  timeout: 20000\n}\n\nWith screenshot:\n{\n  url: \"https://site.com\",\n  takeScreenshot: true\n}`,\n\n      parameters: {\n        type: 'object',\n        properties: {\n          url: {\n            type: 'string',\n            description: 'The URL to fetch. Must start with http:// or https://',\n          },\n          waitForSelector: {\n            type: 'string',\n            description:\n              'Optional CSS selector to wait for before extracting content. Example: \"#main-content\" or \".article-body\"',\n          },\n          timeout: {\n            type: 'number',\n            description: 'Max wait time in milliseconds (default: 15000)',\n          },\n          takeScreenshot: {\n            type: 'boolean',\n            description:\n              'Whether to capture a screenshot of the page (default: false). Screenshot returned as base64 PNG.',\n          },\n        },\n        required: ['url'],\n      },\n    },\n    blocking: true,\n    timeout: 30000, // Allow extra time for browser operations\n  },\n\n  execute: async (args: WebFetchJSArgs): Promise<WebFetchJSResult> => {\n    let page: any = null;\n\n    try {\n      // Try to get browser (will throw if Puppeteer not installed)\n      const browser = await getBrowser();\n      page = await browser.newPage();\n\n      // Set viewport\n      await page.setViewport({ width: 1280, height: 800 });\n\n      // Set user agent\n      await page.setUserAgent(\n        'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36'\n      );\n\n      const startTime = Date.now();\n\n      // Navigate to URL\n      await page.goto(args.url, {\n        waitUntil: 'networkidle2', // Wait until network is mostly idle\n        timeout: args.timeout || 15000,\n      });\n\n      // Wait for selector if provided\n      if (args.waitForSelector) {\n        await page.waitForSelector(args.waitForSelector, {\n          timeout: args.timeout || 15000,\n        });\n      }\n\n      // Get HTML after JS execution\n      const html = await page.content();\n\n      // Get title from browser\n      const browserTitle = await page.title();\n\n      const loadTime = Date.now() - startTime;\n\n      // Take screenshot if requested\n      let screenshot: string | undefined;\n      if (args.takeScreenshot) {\n        const buffer = await page.screenshot({\n          type: 'png',\n          fullPage: false, // Just viewport\n        });\n        screenshot = buffer.toString('base64');\n      }\n\n      await page.close();\n\n      // Convert HTML to clean markdown\n      const mdResult = await htmlToMarkdown(html, args.url);\n\n      // Use browser title or markdown extraction\n      const title = browserTitle || mdResult.title || 'Untitled';\n\n      return {\n        success: true,\n        url: args.url,\n        title,\n        content: mdResult.markdown,\n        screenshot,\n        loadTime,\n        excerpt: mdResult.excerpt,\n        byline: mdResult.byline,\n        wasReadabilityUsed: mdResult.wasReadabilityUsed,\n        wasTruncated: mdResult.wasTruncated,\n      };\n    } catch (error: any) {\n      if (page) {\n        try {\n          await page.close();\n        } catch {\n          // Ignore close errors\n        }\n      }\n\n      // Check if it's a Puppeteer not installed error\n      if ((error as Error).message === 'Puppeteer not installed') {\n        return {\n          success: false,\n          url: args.url,\n          title: '',\n          content: '',\n          loadTime: 0,\n          error: 'Puppeteer is not installed',\n          suggestion:\n            'Install Puppeteer with: npm install puppeteer (note: downloads ~50MB Chrome binary)',\n        };\n      }\n\n      return {\n        success: false,\n        url: args.url,\n        title: '',\n        content: '',\n        loadTime: 0,\n        error: (error as Error).message,\n      };\n    }\n  },\n};\n","/**\n * Web Search Tool - Clean interface for LLM\n *\n * ARCHITECTURE:\n * - LLM sees simple interface: { query, numResults, country, language }\n * - Connector configuration is INTERNAL (auto-detected by serviceType)\n * - Uses shared findConnectorByServiceTypes() utility\n * - Fallback to environment variables if no connector configured\n *\n * Supports: Serper.dev, Brave, Tavily, RapidAPI\n */\n\nimport { ToolFunction } from '../../domain/entities/Tool.js';\nimport { SearchProvider } from '../../capabilities/search/index.js';\nimport { findConnectorByServiceTypes } from '../../capabilities/shared/index.js';\nimport type { SearchResult, SearchResponse } from '../../capabilities/search/index.js';\nimport { logger } from '../../infrastructure/observability/Logger.js';\n\n// Backward compatibility - import old providers for env var fallback\nimport { searchWithSerper } from './searchProviders/serper.js';\nimport { searchWithBrave } from './searchProviders/brave.js';\nimport { searchWithTavily } from './searchProviders/tavily.js';\n\nconst searchLogger = logger.child({ component: 'webSearch' });\n\n// ============ Internal Configuration (NOT exposed to LLM) ============\n\n/**\n * Service types this tool supports, in order of preference\n * Used for auto-detecting available connectors\n */\nconst SEARCH_SERVICE_TYPES = ['serper', 'brave-search', 'tavily', 'rapidapi-search'];\n\n// ============ Tool Interface (what LLM sees) ============\n\n/**\n * Arguments for web_search tool\n * CLEAN and SIMPLE - no connector details exposed\n */\ninterface WebSearchArgs {\n  /** Search query string */\n  query: string;\n  /** Number of results to return (default: 10) */\n  numResults?: number;\n  /** Country/region code (e.g., 'us', 'gb') */\n  country?: string;\n  /** Language code (e.g., 'en', 'fr') */\n  language?: string;\n}\n\ninterface WebSearchResult {\n  success: boolean;\n  query: string;\n  provider: string;\n  results: SearchResult[];\n  count: number;\n  error?: string;\n}\n\n// ============ Tool Definition ============\n\nexport const webSearch: ToolFunction<WebSearchArgs, WebSearchResult> = {\n  definition: {\n    type: 'function',\n    function: {\n      name: 'web_search',\n      description: `Search the web and get relevant results with snippets.\n\nRETURNS:\nAn array of search results, each containing:\n- title: Page title\n- url: Direct URL to the page\n- snippet: Short description/excerpt from the page\n- position: Search ranking position (1, 2, 3...)\n\nUSE CASES:\n- Find current information on any topic\n- Research multiple sources\n- Discover relevant websites\n- Find URLs to fetch with web_fetch tool\n\nWORKFLOW PATTERN:\n1. Use web_search to find relevant URLs\n2. Use web_fetch to get full content from top results\n3. Process and summarize the information\n\nEXAMPLE:\n{\n  \"query\": \"latest AI developments 2026\",\n  \"numResults\": 5\n}`,\n\n      parameters: {\n        type: 'object',\n        properties: {\n          query: {\n            type: 'string',\n            description: 'The search query string. Be specific for better results.',\n          },\n          numResults: {\n            type: 'number',\n            description: 'Number of results to return (default: 10, max: 100).',\n          },\n          country: {\n            type: 'string',\n            description: 'Country/region code for localized results (e.g., \"us\", \"gb\", \"de\")',\n          },\n          language: {\n            type: 'string',\n            description: 'Language code for results (e.g., \"en\", \"fr\", \"de\")',\n          },\n        },\n        required: ['query'],\n      },\n    },\n    blocking: true,\n    timeout: 15000,\n  },\n\n  execute: async (args: WebSearchArgs): Promise<WebSearchResult> => {\n    const numResults = args.numResults || 10;\n\n    // 1. Try to find a configured search connector (auto-detect by serviceType)\n    const connector = findConnectorByServiceTypes(SEARCH_SERVICE_TYPES);\n\n    if (connector) {\n      return await executeWithConnector(connector.name, args, numResults);\n    }\n\n    // 2. Fallback to environment variables\n    return await executeWithEnvVar(args, numResults);\n  },\n\n  describeCall: (args: WebSearchArgs) => `\"${args.query}\"${args.numResults ? ` (${args.numResults} results)` : ''}`,\n};\n\n// ============ Internal Execution Functions ============\n\n/**\n * Execute search using a configured Connector\n */\nasync function executeWithConnector(\n  connectorName: string,\n  args: WebSearchArgs,\n  numResults: number\n): Promise<WebSearchResult> {\n  searchLogger.debug({ connectorName }, 'Executing search with connector');\n\n  try {\n    const searchProvider = SearchProvider.create({ connector: connectorName });\n\n    const response: SearchResponse = await searchProvider.search(args.query, {\n      numResults,\n      country: args.country,\n      language: args.language,\n    });\n\n    if (response.success) {\n      searchLogger.debug({\n        provider: response.provider,\n        count: response.count,\n      }, 'Search completed successfully');\n    } else {\n      searchLogger.warn({\n        provider: response.provider,\n        error: response.error,\n      }, 'Search failed');\n    }\n\n    return {\n      success: response.success,\n      query: response.query,\n      provider: response.provider,\n      results: response.results,\n      count: response.count,\n      error: response.error,\n    };\n  } catch (error: any) {\n    searchLogger.error({ error: error.message, connectorName }, 'Search threw exception');\n    return {\n      success: false,\n      query: args.query,\n      provider: connectorName,\n      results: [],\n      count: 0,\n      error: error.message || 'Unknown error',\n    };\n  }\n}\n\n/**\n * Execute search using environment variables (backward compatibility)\n * Tries providers in order: Serper -> Brave -> Tavily\n */\nasync function executeWithEnvVar(\n  args: WebSearchArgs,\n  numResults: number\n): Promise<WebSearchResult> {\n  // Try each provider in order based on available API keys\n  const providers = [\n    { name: 'serper', key: process.env.SERPER_API_KEY, fn: searchWithSerper },\n    { name: 'brave', key: process.env.BRAVE_API_KEY, fn: searchWithBrave },\n    { name: 'tavily', key: process.env.TAVILY_API_KEY, fn: searchWithTavily },\n  ];\n\n  for (const provider of providers) {\n    if (provider.key) {\n      searchLogger.debug({ provider: provider.name }, 'Using environment variable fallback');\n\n      try {\n        const results = await provider.fn(args.query, numResults, provider.key);\n        return {\n          success: true,\n          query: args.query,\n          provider: provider.name,\n          results,\n          count: results.length,\n        };\n      } catch (error: any) {\n        searchLogger.warn({ provider: provider.name, error: error.message }, 'Provider failed, trying next');\n        // Continue to next provider\n      }\n    }\n  }\n\n  // No provider available\n  return {\n    success: false,\n    query: args.query,\n    provider: 'none',\n    results: [],\n    count: 0,\n    error: 'No search provider configured. Set up a search connector (serper, brave-search, tavily) or set SERPER_API_KEY, BRAVE_API_KEY, or TAVILY_API_KEY environment variable.',\n  };\n}\n","/**\n * Serper.dev search provider\n * Fast Google search results via API\n */\n\nexport interface SearchResult {\n  title: string;\n  url: string;\n  snippet: string;\n  position: number;\n}\n\nexport async function searchWithSerper(\n  query: string,\n  numResults: number,\n  apiKey: string\n): Promise<SearchResult[]> {\n  const response = await fetch('https://google.serper.dev/search', {\n    method: 'POST',\n    headers: {\n      'X-API-KEY': apiKey,\n      'Content-Type': 'application/json',\n    },\n    body: JSON.stringify({\n      q: query,\n      num: numResults,\n    }),\n  });\n\n  if (!response.ok) {\n    throw new Error(`Serper API error: ${response.status} ${response.statusText}`);\n  }\n\n  const data: any = await response.json();\n\n  if (!data.organic || !Array.isArray(data.organic)) {\n    throw new Error('Invalid response from Serper API');\n  }\n\n  return data.organic.slice(0, numResults).map((result: any, index: number) => ({\n    title: result.title || 'Untitled',\n    url: result.link || '',\n    snippet: result.snippet || '',\n    position: index + 1,\n  }));\n}\n","/**\n * Brave Search API provider\n * Independent search index (privacy-focused)\n */\n\nimport type { SearchResult } from './serper.js';\n\nexport async function searchWithBrave(\n  query: string,\n  numResults: number,\n  apiKey: string\n): Promise<SearchResult[]> {\n  const url = `https://api.search.brave.com/res/v1/web/search?q=${encodeURIComponent(query)}&count=${numResults}`;\n\n  const response = await fetch(url, {\n    headers: {\n      'X-Subscription-Token': apiKey,\n      Accept: 'application/json',\n    },\n  });\n\n  if (!response.ok) {\n    throw new Error(`Brave API error: ${response.status} ${response.statusText}`);\n  }\n\n  const data: any = await response.json();\n\n  if (!data.web?.results || !Array.isArray(data.web.results)) {\n    throw new Error('Invalid response from Brave API');\n  }\n\n  return data.web.results.slice(0, numResults).map((result: any, index: number) => ({\n    title: result.title || 'Untitled',\n    url: result.url || '',\n    snippet: result.description || '',\n    position: index + 1,\n  }));\n}\n","/**\n * Tavily AI Search provider\n * AI-optimized search results with summaries\n */\n\nimport type { SearchResult } from './serper.js';\n\nexport async function searchWithTavily(\n  query: string,\n  numResults: number,\n  apiKey: string\n): Promise<SearchResult[]> {\n  const response = await fetch('https://api.tavily.com/search', {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n    },\n    body: JSON.stringify({\n      api_key: apiKey,\n      query,\n      max_results: numResults,\n      search_depth: 'basic', // 'basic' or 'advanced'\n      include_answer: false,\n      include_raw_content: false,\n    }),\n  });\n\n  if (!response.ok) {\n    throw new Error(`Tavily API error: ${response.status} ${response.statusText}`);\n  }\n\n  const data: any = await response.json();\n\n  if (!data.results || !Array.isArray(data.results)) {\n    throw new Error('Invalid response from Tavily API');\n  }\n\n  return data.results.slice(0, numResults).map((result: any, index: number) => ({\n    title: result.title || 'Untitled',\n    url: result.url || '',\n    snippet: result.content || '',\n    position: index + 1,\n  }));\n}\n","/**\n * Web Scrape Tool - Clean interface for LLM\n *\n * ARCHITECTURE:\n * - LLM sees simple interface: { url, timeout, includeHtml, includeMarkdown, includeLinks, waitForSelector }\n * - Connector configuration is INTERNAL (auto-detected by serviceType)\n * - Uses shared findConnectorByServiceTypes() utility\n * - Automatic fallback chain: native fetch -> JS rendering -> external API\n *\n * Supports: ZenRows, Jina Reader, Firecrawl, ScrapingBee\n */\n\nimport { ToolFunction } from '../../domain/entities/Tool.js';\nimport { ScrapeProvider } from '../../capabilities/scrape/index.js';\nimport { findConnectorByServiceTypes } from '../../capabilities/shared/index.js';\nimport type { ScrapeOptions, ScrapeResponse, ScrapeResult } from '../../capabilities/scrape/index.js';\nimport { webFetch } from './webFetch.js';\nimport { webFetchJS } from './webFetchJS.js';\nimport { logger } from '../../infrastructure/observability/Logger.js';\n\nconst scrapeLogger = logger.child({ component: 'webScrape' });\n\n// ============ Internal Configuration (NOT exposed to LLM) ============\n\n/**\n * Service types this tool supports for external API fallback\n * Used for auto-detecting available connectors\n */\nconst SCRAPE_SERVICE_TYPES = ['zenrows', 'jina-reader', 'firecrawl', 'scrapingbee'];\n\n/**\n * Default minimum quality score to accept from native methods\n */\nconst DEFAULT_MIN_QUALITY = 50;\n\n// ============ Tool Interface (what LLM sees) ============\n\n/**\n * Arguments for web_scrape tool\n * CLEAN and SIMPLE - no connector/strategy details exposed\n */\ninterface WebScrapeArgs {\n  /** URL to scrape */\n  url: string;\n  /** Timeout in milliseconds (default: 30000) */\n  timeout?: number;\n  /** Whether to include raw HTML in response */\n  includeHtml?: boolean;\n  /** Whether to convert to markdown (if supported) */\n  includeMarkdown?: boolean;\n  /** Whether to extract links */\n  includeLinks?: boolean;\n  /** CSS selector to wait for (for JS-heavy sites) */\n  waitForSelector?: string;\n}\n\ninterface WebScrapeResult {\n  /** Whether scraping succeeded */\n  success: boolean;\n  /** URL that was scraped */\n  url: string;\n  /** Final URL after redirects */\n  finalUrl?: string;\n  /** Method used: 'native', 'js', or external provider name */\n  method: string;\n  /** Page title */\n  title: string;\n  /** Extracted text content */\n  content: string;\n  /** Raw HTML (if requested) */\n  html?: string;\n  /** Markdown version (if requested and supported) */\n  markdown?: string;\n  /** Extracted metadata */\n  metadata?: ScrapeResult['metadata'];\n  /** Extracted links (if requested) */\n  links?: ScrapeResult['links'];\n  /** Quality score (0-100) */\n  qualityScore?: number;\n  /** Time taken in milliseconds */\n  durationMs: number;\n  /** Methods attempted before success */\n  attemptedMethods: string[];\n  /** Error message if failed */\n  error?: string;\n}\n\n// ============ Tool Definition ============\n\nexport const webScrape: ToolFunction<WebScrapeArgs, WebScrapeResult> = {\n  definition: {\n    type: 'function',\n    function: {\n      name: 'web_scrape',\n      description: `Scrape any URL with automatic fallback - guaranteed to work on most sites.\n\nAutomatically tries multiple methods in sequence:\n1. Native fetch - Fast (~1s), works for blogs/docs/articles\n2. JS rendering - Handles React/Vue/Angular SPAs\n3. External API - Handles bot protection, CAPTCHAs (if configured)\n\nRETURNS:\n{\n  success: boolean,\n  url: string,\n  finalUrl: string,        // After redirects\n  method: string,          // 'native', 'js', or provider name\n  title: string,\n  content: string,         // Clean text\n  html: string,            // If requested\n  markdown: string,        // If requested\n  metadata: {...},         // Title, description, author, etc.\n  links: [{url, text}],    // If requested\n  qualityScore: number,    // 0-100\n  durationMs: number,\n  attemptedMethods: []     // Methods tried\n}\n\nEXAMPLES:\nBasic:\n{ \"url\": \"https://example.com/article\" }\n\nWith options:\n{\n  \"url\": \"https://example.com\",\n  \"includeMarkdown\": true,\n  \"includeLinks\": true\n}\n\nFor JS-heavy sites:\n{\n  \"url\": \"https://spa-app.com\",\n  \"waitForSelector\": \".main-content\"\n}`,\n\n      parameters: {\n        type: 'object',\n        properties: {\n          url: {\n            type: 'string',\n            description: 'URL to scrape. Must start with http:// or https://',\n          },\n          timeout: {\n            type: 'number',\n            description: 'Timeout in milliseconds (default: 30000)',\n          },\n          includeHtml: {\n            type: 'boolean',\n            description: 'Include raw HTML in response (default: false)',\n          },\n          includeMarkdown: {\n            type: 'boolean',\n            description: 'Include markdown conversion (default: false)',\n          },\n          includeLinks: {\n            type: 'boolean',\n            description: 'Extract and include links (default: false)',\n          },\n          waitForSelector: {\n            type: 'string',\n            description: 'CSS selector to wait for before scraping (for JS-heavy sites)',\n          },\n        },\n        required: ['url'],\n      },\n    },\n    blocking: true,\n    timeout: 60000,\n  },\n\n  execute: async (args: WebScrapeArgs): Promise<WebScrapeResult> => {\n    const startTime = Date.now();\n    const attemptedMethods: string[] = [];\n\n    // Validate URL\n    try {\n      new URL(args.url);\n    } catch {\n      return {\n        success: false,\n        url: args.url,\n        method: 'none',\n        title: '',\n        content: '',\n        durationMs: Date.now() - startTime,\n        attemptedMethods: [],\n        error: 'Invalid URL format',\n      };\n    }\n\n    // Automatic fallback chain: native -> JS -> API\n\n    // 1. Try native fetch first\n    const native = await tryNative(args, startTime, attemptedMethods);\n    if (native.success && (native.qualityScore ?? 0) >= DEFAULT_MIN_QUALITY) {\n      return native;\n    }\n\n    // 2. Try JS rendering\n    const js = await tryJS(args, startTime, attemptedMethods);\n    if (js.success && (js.qualityScore ?? 0) >= DEFAULT_MIN_QUALITY) {\n      return js;\n    }\n\n    // 3. Try external API if available\n    const connector = findConnectorByServiceTypes(SCRAPE_SERVICE_TYPES);\n    if (connector) {\n      const api = await tryAPI(connector.name, args, startTime, attemptedMethods);\n      if (api.success) return api;\n    }\n\n    // Return best result we got\n    if (js.success) return js;\n    if (native.success) return native;\n\n    return {\n      success: false,\n      url: args.url,\n      method: 'none',\n      title: '',\n      content: '',\n      durationMs: Date.now() - startTime,\n      attemptedMethods,\n      error: 'All scraping methods failed. Site may have bot protection.',\n    };\n  },\n\n  describeCall: (args: WebScrapeArgs) => args.url,\n};\n\n// ============ Internal Execution Functions ============\n\nasync function tryNative(\n  args: WebScrapeArgs,\n  startTime: number,\n  attemptedMethods: string[]\n): Promise<WebScrapeResult> {\n  attemptedMethods.push('native');\n  scrapeLogger.debug({ url: args.url }, 'Trying native fetch');\n\n  try {\n    const result = await webFetch.execute({\n      url: args.url,\n      timeout: args.timeout || 10000,\n    });\n\n    return {\n      success: result.success,\n      url: args.url,\n      finalUrl: args.url,\n      method: 'native',\n      title: result.title,\n      content: result.content,\n      // Note: raw HTML not available with native method (returns markdown instead)\n      markdown: args.includeMarkdown ? result.content : undefined,\n      qualityScore: result.qualityScore,\n      durationMs: Date.now() - startTime,\n      attemptedMethods,\n      error: result.error,\n    };\n  } catch (error: any) {\n    return {\n      success: false,\n      url: args.url,\n      method: 'native',\n      title: '',\n      content: '',\n      durationMs: Date.now() - startTime,\n      attemptedMethods,\n      error: error.message,\n    };\n  }\n}\n\nasync function tryJS(\n  args: WebScrapeArgs,\n  startTime: number,\n  attemptedMethods: string[]\n): Promise<WebScrapeResult> {\n  attemptedMethods.push('js');\n  scrapeLogger.debug({ url: args.url }, 'Trying JS rendering');\n\n  try {\n    const result = await webFetchJS.execute({\n      url: args.url,\n      timeout: args.timeout || 15000,\n      waitForSelector: args.waitForSelector,\n    });\n\n    return {\n      success: result.success,\n      url: args.url,\n      finalUrl: args.url,\n      method: 'js',\n      title: result.title,\n      content: result.content,\n      // Note: raw HTML not available with JS method (returns markdown instead)\n      markdown: args.includeMarkdown ? result.content : undefined,\n      qualityScore: result.success ? 80 : 0,\n      durationMs: Date.now() - startTime,\n      attemptedMethods,\n      error: result.error,\n    };\n  } catch (error: any) {\n    return {\n      success: false,\n      url: args.url,\n      method: 'js',\n      title: '',\n      content: '',\n      durationMs: Date.now() - startTime,\n      attemptedMethods,\n      error: error.message,\n    };\n  }\n}\n\nasync function tryAPI(\n  connectorName: string,\n  args: WebScrapeArgs,\n  startTime: number,\n  attemptedMethods: string[]\n): Promise<WebScrapeResult> {\n  attemptedMethods.push(`api:${connectorName}`);\n  scrapeLogger.debug({ url: args.url, connectorName }, 'Trying external API');\n\n  try {\n    const provider = ScrapeProvider.create({ connector: connectorName });\n\n    const options: ScrapeOptions = {\n      timeout: args.timeout,\n      waitForSelector: args.waitForSelector,\n      includeHtml: args.includeHtml,\n      includeMarkdown: args.includeMarkdown,\n      includeLinks: args.includeLinks,\n    };\n\n    const result: ScrapeResponse = await provider.scrape(args.url, options);\n\n    return {\n      success: result.success,\n      url: args.url,\n      finalUrl: result.finalUrl,\n      method: result.provider,\n      title: result.result?.title || '',\n      content: result.result?.content || '',\n      html: result.result?.html,\n      markdown: result.result?.markdown,\n      metadata: result.result?.metadata,\n      links: result.result?.links,\n      qualityScore: result.success ? 90 : 0,\n      durationMs: Date.now() - startTime,\n      attemptedMethods,\n      error: result.error,\n    };\n  } catch (error: any) {\n    return {\n      success: false,\n      url: args.url,\n      method: 'api',\n      title: '',\n      content: '',\n      durationMs: Date.now() - startTime,\n      attemptedMethods,\n      error: error.message,\n    };\n  }\n}\n","/**\n * JavaScript Execution Tool\n * Executes JavaScript in a sandboxed VM with connector integration\n * Connectors provide authenticated access to external APIs (GitHub, Microsoft, etc.)\n */\n\nimport * as vm from 'vm';\nimport { ToolFunction } from '../../domain/entities/Tool.js';\nimport { Connector } from '../../core/Connector.js';\nimport { authenticatedFetch } from '../../connectors/authenticatedFetch.js';\n\ninterface ExecuteJSArgs {\n  code: string;\n  input?: any;\n  timeout?: number;\n}\n\ninterface ExecuteJSResult {\n  success: boolean;\n  result: any;\n  logs: string[];\n  error?: string;\n  executionTime: number;\n}\n\n/**\n * Generate the tool description with current connectors\n */\nfunction generateDescription(): string {\n  const connectors = Connector.listAll();\n  const connectorList = connectors.length > 0\n    ? connectors\n        .map(c => `    \"${c.name}\": ${c.displayName}\\n     ${c.config.description || 'No description'}\\n     Base URL: ${c.baseURL}`)\n        .join('\\n\\n')\n    : '   No connectors registered yet. Register connectors with Connector.create().';\n\n  return `Execute JavaScript code in a secure sandbox with connector integration.\n\nIMPORTANT: This tool runs JavaScript code in a sandboxed environment with authenticated access to external APIs via connectors.\n\nAVAILABLE IN CONTEXT:\n\n1. INPUT/OUTPUT:\n   - input: any data passed to your code\n   - output: SET THIS variable to return your result\n\n2. AUTHENTICATED FETCH:\n   - authenticatedFetch(url, options, connector, userId?)\n      url: Full URL or path\n      options: Standard fetch options { method: 'GET'|'POST'|..., body: ..., headers: ... }\n      connector: Connector name (see below)\n      userId: (optional) User identifier for multi-user apps\n      Returns: Promise<Response>\n\n   REGISTERED CONNECTORS:\n${connectorList}\n\n3. STANDARD FETCH:\n   - fetch(url, options) - No authentication\n\n4. CONNECTOR REGISTRY:\n   - connectors.list() - List available connectors\n   - connectors.get(name) - Get connector details\n\n5. UTILITIES:\n   - console.log/error/warn\n   - Buffer, JSON, Math, Date\n   - setTimeout, setInterval, Promise\n\nCODE PATTERN:\nAlways wrap your code in an async IIFE:\n\n(async () => {\n  // Your code here\n\n  // Single-user mode (default)\n  const response = await authenticatedFetch(url, options, 'github');\n\n  // OR Multi-user mode (if your app has multiple users)\n  const response = await authenticatedFetch(url, options, 'github', userId);\n\n  const data = await response.json();\n  output = data;\n})();\n\nSECURITY:\n- 10 second timeout (configurable)\n- No file system access\n- No process/child_process\n- No require/import\n- Memory limited\n\nRETURNS:\n{\n  success: boolean,\n  result: any,\n  logs: string[],\n  error?: string,\n  executionTime: number\n}`;\n}\n\n/**\n * Create an execute_javascript tool with the current connector state\n * Use this factory when you need the tool to reflect currently registered connectors\n */\nexport function createExecuteJavaScriptTool(): ToolFunction<ExecuteJSArgs, ExecuteJSResult> {\n  return {\n    definition: {\n      type: 'function',\n      function: {\n        name: 'execute_javascript',\n        description: generateDescription(),\n        parameters: {\n          type: 'object',\n          properties: {\n            code: {\n              type: 'string',\n              description:\n                'JavaScript code to execute. MUST set the \"output\" variable. Wrap in async IIFE for async operations.',\n            },\n            input: {\n              description: 'Optional input data available as \"input\" variable in your code',\n            },\n            timeout: {\n              type: 'number',\n              description: 'Execution timeout in milliseconds (default: 10000, max: 30000)',\n            },\n          },\n          required: ['code'],\n        },\n      },\n      blocking: true,\n      timeout: 35000, // Tool timeout (slightly more than max code timeout)\n    },\n\n    execute: async (args: ExecuteJSArgs): Promise<ExecuteJSResult> => {\n      const logs: string[] = [];\n      const startTime = Date.now();\n\n      try {\n        // Validate timeout\n        const timeout = Math.min(args.timeout || 10000, 30000);\n\n        // Execute in VM\n        const result = await executeInVM(args.code, args.input, timeout, logs);\n\n        return {\n          success: true,\n          result,\n          logs,\n          executionTime: Date.now() - startTime,\n        };\n      } catch (error) {\n        return {\n          success: false,\n          result: null,\n          logs,\n          error: (error as Error).message,\n          executionTime: Date.now() - startTime,\n        };\n      }\n    },\n  };\n}\n\n/**\n * Default executeJavaScript tool\n * NOTE: The description is generated at module load time. If you register\n * connectors after importing this, use createExecuteJavaScriptTool() instead.\n */\nexport const executeJavaScript: ToolFunction<ExecuteJSArgs, ExecuteJSResult> = createExecuteJavaScriptTool();\n\n/**\n * Execute code in Node.js vm module\n */\nasync function executeInVM(\n  code: string,\n  input: any,\n  timeout: number,\n  logs: string[]\n): Promise<any> {\n  // Create sandbox context\n  const sandbox: any = {\n    // Input/output\n    input: input || {},\n    output: null,\n\n    // Console (captured)\n    console: {\n      log: (...args: any[]) => logs.push(args.map((a) => String(a)).join(' ')),\n      error: (...args: any[]) => logs.push('ERROR: ' + args.map((a) => String(a)).join(' ')),\n      warn: (...args: any[]) => logs.push('WARN: ' + args.map((a) => String(a)).join(' ')),\n    },\n\n    // Authenticated fetch\n    authenticatedFetch,\n\n    // Standard fetch\n    fetch: globalThis.fetch,\n\n    // Connector info\n    connectors: {\n      list: () => Connector.list(),\n      get: (name: string) => {\n        try {\n          const connector = Connector.get(name);\n          return {\n            displayName: connector.displayName,\n            description: connector.config.description || '',\n            baseURL: connector.baseURL,\n          };\n        } catch {\n          return null;\n        }\n      },\n    },\n\n    // Standard globals\n    Buffer,\n    JSON,\n    Math,\n    Date,\n    setTimeout,\n    setInterval,\n    clearTimeout,\n    clearInterval,\n    Promise,\n\n    // Array/Object\n    Array,\n    Object,\n    String,\n    Number,\n    Boolean,\n  };\n\n  // Create VM context\n  const context = vm.createContext(sandbox);\n\n  // Wrap user code in async IIFE if not already wrapped\n  const wrappedCode = code.trim().startsWith('(async')\n    ? code\n    : `\n    (async () => {\n      ${code}\n      return output;\n    })()\n  `;\n\n  // Compile and run\n  const script = new vm.Script(wrappedCode);\n  const resultPromise = script.runInContext(context, {\n    timeout,\n    displayErrors: true,\n  });\n\n  // Wait for completion\n  const result = await resultPromise;\n\n  // If result is undefined but output was set, use the output variable\n  return result !== undefined ? result : sandbox.output;\n}\n","/**\n * AUTO-GENERATED FILE - DO NOT EDIT MANUALLY\n *\n * Generated by: scripts/generate-tool-registry.ts\n * Generated at: 2026-01-31T18:22:51.974Z\n *\n * To regenerate: npm run generate:tools\n */\n\nimport type { ToolFunction } from '../domain/entities/Tool.js';\n\nimport { executeJavaScript } from './code/executeJavaScript.js';\nimport { editFile } from './filesystem/editFile.js';\nimport { glob } from './filesystem/glob.js';\nimport { grep } from './filesystem/grep.js';\nimport { listDirectory } from './filesystem/listDirectory.js';\nimport { readFile } from './filesystem/readFile.js';\nimport { writeFile } from './filesystem/writeFile.js';\nimport { jsonManipulator } from './json/jsonManipulator.js';\nimport { bash } from './shell/bash.js';\nimport { webFetch } from './web/webFetch.js';\nimport { webFetchJS } from './web/webFetchJS.js';\nimport { webScrape } from './web/webScrape.js';\nimport { webSearch } from './web/webSearch.js';\n\n/** Tool category for grouping */\nexport type ToolCategory = 'filesystem' | 'shell' | 'web' | 'code' | 'json' | 'connector' | 'other';\n\n/** Metadata for a tool in the registry */\nexport interface ToolRegistryEntry {\n  /** Tool name (matches definition.function.name) */\n  name: string;\n  /** Export variable name */\n  exportName: string;\n  /** Human-readable display name */\n  displayName: string;\n  /** Category for grouping */\n  category: ToolCategory;\n  /** Brief description */\n  description: string;\n  /** The actual tool function */\n  tool: ToolFunction;\n  /** Whether this tool is safe without explicit approval */\n  safeByDefault: boolean;\n  /** Whether this tool requires a connector */\n  requiresConnector?: boolean;\n  /** Supported connector service types (if requiresConnector) */\n  connectorServiceTypes?: string[];\n}\n\n/** Complete registry of all built-in tools */\nexport const toolRegistry: ToolRegistryEntry[] = [\n  {\n    name: 'execute_javascript',\n    exportName: 'executeJavaScript',\n    displayName: 'Execute Javascript',\n    category: 'code',\n    description: \"JavaScript code to execute. MUST set the \\\"output\\\" variable. Wrap in async IIFE for async operations.\",\n    tool: executeJavaScript,\n    safeByDefault: false,\n  },\n  {\n    name: 'edit_file',\n    exportName: 'editFile',\n    displayName: 'Edit File',\n    category: 'filesystem',\n    description: \"Perform exact string replacements in files.\",\n    tool: editFile,\n    safeByDefault: false,\n  },\n  {\n    name: 'glob',\n    exportName: 'glob',\n    displayName: 'Glob',\n    category: 'filesystem',\n    description: \"Fast file pattern matching tool that finds files by name patterns.\",\n    tool: glob,\n    safeByDefault: true,\n  },\n  {\n    name: 'grep',\n    exportName: 'grep',\n    displayName: 'Grep',\n    category: 'filesystem',\n    description: \"A powerful search tool for finding content within files.\",\n    tool: grep,\n    safeByDefault: true,\n  },\n  {\n    name: 'list_directory',\n    exportName: 'listDirectory',\n    displayName: 'List Directory',\n    category: 'filesystem',\n    description: \"List the contents of a directory on the local filesystem.\",\n    tool: listDirectory,\n    safeByDefault: true,\n  },\n  {\n    name: 'read_file',\n    exportName: 'readFile',\n    displayName: 'Read File',\n    category: 'filesystem',\n    description: \"Read content from a file on the local filesystem.\",\n    tool: readFile,\n    safeByDefault: true,\n  },\n  {\n    name: 'write_file',\n    exportName: 'writeFile',\n    displayName: 'Write File',\n    category: 'filesystem',\n    description: \"Write content to a file on the local filesystem.\",\n    tool: writeFile,\n    safeByDefault: false,\n  },\n  {\n    name: 'json_manipulate',\n    exportName: 'jsonManipulator',\n    displayName: 'Json Manipulate',\n    category: 'json',\n    description: \"Manipulate JSON objects by deleting, adding, or replacing fields at any depth.\",\n    tool: jsonManipulator,\n    safeByDefault: true,\n  },\n  {\n    name: 'bash',\n    exportName: 'bash',\n    displayName: 'Bash',\n    category: 'shell',\n    description: \"Execute shell commands with optional timeout.\",\n    tool: bash,\n    safeByDefault: false,\n  },\n  {\n    name: 'web_fetch',\n    exportName: 'webFetch',\n    displayName: 'Web Fetch',\n    category: 'web',\n    description: \"Fetch and extract text content from a web page URL.\",\n    tool: webFetch,\n    safeByDefault: true,\n  },\n  {\n    name: 'web_fetch_js',\n    exportName: 'webFetchJS',\n    displayName: 'Web Fetch Js',\n    category: 'web',\n    description: \"Fetch and extract content from JavaScript-rendered websites using a headless browser (Puppeteer).\",\n    tool: webFetchJS,\n    safeByDefault: true,\n  },\n  {\n    name: 'web_scrape',\n    exportName: 'webScrape',\n    displayName: 'Web Scrape',\n    category: 'web',\n    description: \"Scrape any URL with automatic fallback - guaranteed to work on most sites.\",\n    tool: webScrape,\n    safeByDefault: true,\n    requiresConnector: true,\n    connectorServiceTypes: [\"zenrows\"],\n  },\n  {\n    name: 'web_search',\n    exportName: 'webSearch',\n    displayName: 'Web Search',\n    category: 'web',\n    description: \"Search the web and get relevant results with snippets.\",\n    tool: webSearch,\n    safeByDefault: true,\n    requiresConnector: true,\n    connectorServiceTypes: [\"serper\",\"brave-search\",\"tavily\",\"rapidapi-websearch\"],\n  }\n];\n\n/** Get all built-in tools as ToolFunction array */\nexport function getAllBuiltInTools(): ToolFunction[] {\n  return toolRegistry.map((entry) => entry.tool);\n}\n\n/** Get full tool registry with metadata */\nexport function getToolRegistry(): ToolRegistryEntry[] {\n  return [...toolRegistry];\n}\n\n/** Get tools by category */\nexport function getToolsByCategory(category: ToolCategory): ToolRegistryEntry[] {\n  return toolRegistry.filter((entry) => entry.category === category);\n}\n\n/** Get tool by name */\nexport function getToolByName(name: string): ToolRegistryEntry | undefined {\n  return toolRegistry.find((entry) => entry.name === name);\n}\n\n/** Get tools that require connector configuration */\nexport function getToolsRequiringConnector(): ToolRegistryEntry[] {\n  return toolRegistry.filter((entry) => entry.requiresConnector);\n}\n\n/** Get all unique category names */\nexport function getToolCategories(): ToolCategory[] {\n  return [...new Set(toolRegistry.map((entry) => entry.category))];\n}\n","/**\n * Provider Config Agent\n *\n * AI-powered agent that helps users configure OAuth providers\n * Asks questions, guides setup, and generates JSON configuration\n */\n\nimport { Agent } from '../core/Agent.js';\nimport { MessageBuilder } from '../utils/messageBuilder.js';\nimport { InputItem } from '../domain/entities/Message.js';\nimport { ConnectorConfigResult } from '../domain/entities/Connector.js';\n\n/**\n * Built-in agent for generating OAuth provider configurations\n */\nexport class ProviderConfigAgent {\n  private agent: Agent | null = null;\n  private conversationHistory: InputItem[] = [];\n  private connectorName: string;\n\n  /**\n   * Create a provider config agent\n   * @param connectorName - Name of the connector to use (must be created first with Connector.create())\n   */\n  constructor(connectorName: string = 'openai') {\n    this.connectorName = connectorName;\n  }\n\n  /**\n   * Start interactive configuration session\n   * AI will ask questions and generate the connector config\n   *\n   * @param initialInput - Optional initial message (e.g., \"I want to connect to GitHub\")\n   * @returns Promise<string | ConnectorConfigResult> - Either next question or final config\n   */\n  async run(initialInput?: string): Promise<string | ConnectorConfigResult> {\n    // Create agent with specialized instructions\n    this.agent = Agent.create({\n      connector: this.connectorName,\n      model: this.getDefaultModel(),\n      instructions: this.getSystemInstructions(),\n      temperature: 0.1, // Very low temperature for consistent, focused behavior\n      maxIterations: 10,\n    });\n\n    const builder = new MessageBuilder();\n\n    // Add initial input or start prompt\n    const startMessage = initialInput || 'I want to configure an OAuth provider';\n    builder.addUserMessage(startMessage);\n\n    // Store in history\n    this.conversationHistory.push(...builder.build());\n\n    // Run conversation - instructions from agent config are always included\n    const response = await this.agent.run(this.conversationHistory);\n\n    // Store assistant response in history\n    this.conversationHistory.push(...response.output.filter(\n      (item): item is InputItem =>\n        item.type === 'message' || item.type === 'compaction'\n    ));\n\n    const responseText = response.output_text || '';\n\n    // Check if AI generated a config\n    if (responseText.includes('===CONFIG_START===')) {\n      return this.extractConfig(responseText);\n    }\n\n    // Otherwise, return the conversational response\n    return responseText;\n  }\n\n  /**\n   * Continue conversation (for multi-turn interaction)\n   *\n   * @param userMessage - User's response\n   * @returns Promise<string | ConnectorConfigResult> - Either next question or final config\n   */\n  async continue(userMessage: string): Promise<string | ConnectorConfigResult> {\n    if (!this.agent) {\n      throw new Error('Agent not initialized. Call run() first.');\n    }\n\n    const builder = new MessageBuilder();\n    builder.addUserMessage(userMessage);\n\n    // Update history with user message\n    this.conversationHistory.push(...builder.build());\n\n    // Run with full history\n    const response = await this.agent.run(this.conversationHistory);\n\n    // Store assistant response in history\n    this.conversationHistory.push(...response.output.filter(\n      (item): item is InputItem =>\n        item.type === 'message' || item.type === 'compaction'\n    ));\n\n    const responseText = response.output_text || '';\n\n    // Check if AI generated a config\n    if (responseText.includes('===CONFIG_START===')) {\n      return this.extractConfig(responseText);\n    }\n\n    // Otherwise, return the conversational response\n    return responseText;\n  }\n\n  /**\n   * Get system instructions for the agent\n   */\n  private getSystemInstructions(): string {\n    return `You are a friendly OAuth Setup Assistant. Your ONLY job is to help users connect their apps to third-party services like Microsoft, Google, GitHub, etc.\n\nYOU MUST NOT answer general questions. ONLY focus on helping set up API connections.\n\nYOUR PROCESS (use NON-TECHNICAL, FRIENDLY language):\n\n1. Ask which system they want to connect to (e.g., Microsoft, Google, GitHub, Salesforce, Slack)\n\n2. Ask about HOW they want to use it (use SIMPLE language):\n   - \"Will your users log in with their [Provider] accounts?\"  authorization_code\n   - \"Does your app need to access [Provider] without users logging in?\"  client_credentials\n   - \"Is this just an API key from [Provider]?\"  static_token\n\n3. Ask BUSINESS questions about what they want to do (then YOU figure out the technical scopes):\n\n   For Microsoft:\n   - \"Do you need to read user profiles?\"  User.Read\n   - \"Do you need to read emails?\"  Mail.Read\n   - \"Do you need to access calendar?\"  Calendars.Read\n   - \"Do you need to read/write SharePoint files?\"  Sites.Read.All or Sites.ReadWrite.All\n   - \"Do you need to access Teams?\"  Team.ReadBasic.All\n   - Combine multiple scopes if needed\n\n   For Google:\n   - \"Do you need to read emails?\"  https://www.googleapis.com/auth/gmail.readonly\n   - \"Do you need to access Google Drive?\"  https://www.googleapis.com/auth/drive\n   - \"Do you need calendar access?\"  https://www.googleapis.com/auth/calendar\n\n   For GitHub:\n   - \"Do you need to read user info?\"  user:email\n   - \"Do you need to access repositories?\"  repo\n   - \"Do you need to read organization data?\"  read:org\n\n   For Salesforce:\n   - \"Do you need full access?\"  full\n   - \"Do you need to access/manage data?\"  api\n   - \"Do you need refresh tokens?\"  refresh_token offline_access\n\n4. DO NOT ask about redirect URI - it will be configured in code (use \"http://localhost:3000/callback\" as default)\n\n5. Generate complete JSON configuration\n\nCRITICAL RULES:\n- Ask ONE simple question at a time\n- Use BUSINESS language, NOT technical OAuth terms\n- Ask \"What do you want to do?\" NOT \"What scopes do you need?\"\n- YOU translate business needs into technical scopes\n- Be friendly and conversational\n- Provide specific setup URLs (e.g., https://portal.azure.com for Microsoft, https://github.com/settings/developers for GitHub)\n- When you have all info, IMMEDIATELY output the config in this EXACT format:\n\n===CONFIG_START===\n{\n  \"name\": \"github\",\n  \"config\": {\n    \"displayName\": \"GitHub API\",\n    \"description\": \"Access GitHub repositories and user data\",\n    \"baseURL\": \"https://api.github.com\",\n    \"auth\": {\n      \"type\": \"oauth\",\n      \"flow\": \"authorization_code\",\n      \"clientId\": \"ENV:GITHUB_CLIENT_ID\",\n      \"clientSecret\": \"ENV:GITHUB_CLIENT_SECRET\",\n      \"authorizationUrl\": \"https://github.com/login/oauth/authorize\",\n      \"tokenUrl\": \"https://github.com/login/oauth/access_token\",\n      \"redirectUri\": \"http://localhost:3000/callback\",\n      \"scope\": \"user:email repo\"\n    }\n  },\n  \"setupInstructions\": \"1. Go to https://github.com/settings/developers\\\\n2. Create New OAuth App\\\\n3. Set Authorization callback URL\\\\n4. Copy Client ID and Client Secret\",\n  \"envVariables\": [\"GITHUB_CLIENT_ID\", \"GITHUB_CLIENT_SECRET\"],\n  \"setupUrl\": \"https://github.com/settings/developers\"\n}\n===CONFIG_END===\n\nUse \"ENV:VARIABLE_NAME\" for values that should come from environment variables.\n\nREMEMBER: Keep it conversational, ask one question at a time, and only output the config when you have all necessary information.`;\n  }\n\n  /**\n   * Extract configuration from AI response\n   */\n  private extractConfig(responseText: string): ConnectorConfigResult {\n    // Find config between markers\n    const configMatch = responseText.match(/===CONFIG_START===\\s*([\\s\\S]*?)\\s*===CONFIG_END===/);\n\n    if (!configMatch) {\n      throw new Error('No configuration found in response. The AI may need more information.');\n    }\n\n    try {\n      const configJson = configMatch[1]!.trim();\n      const config = JSON.parse(configJson);\n\n      return config as ConnectorConfigResult;\n    } catch (error) {\n      throw new Error(`Failed to parse configuration JSON: ${(error as Error).message}`);\n    }\n  }\n\n  /**\n   * Get default model\n   */\n  private getDefaultModel(): string {\n    // Use GPT-4.1 for best instruction following\n    return 'gpt-4.1';\n  }\n\n  /**\n   * Reset conversation\n   */\n  reset(): void {\n    this.conversationHistory = [];\n    this.agent = null;\n  }\n}\n","/**\n * ModeManager - Manages agent mode transitions\n *\n * Handles the state machine for UniversalAgent modes:\n * - interactive: Direct conversation, immediate tool execution\n * - planning: Creating and refining plans\n * - executing: Running through a plan\n *\n * Implements IDisposable for proper lifecycle management.\n */\n\nimport { EventEmitter } from 'eventemitter3';\nimport type { Plan } from '../../domain/entities/Task.js';\nimport type { AgentMode, ModeState, IntentAnalysis } from './types.js';\nimport type { IDisposable } from '../../domain/interfaces/IDisposable.js';\n\nexport interface ModeManagerEvents {\n  'mode:changed': { from: AgentMode; to: AgentMode; reason: string };\n  'mode:transition_blocked': { from: AgentMode; to: AgentMode; reason: string };\n}\n\nexport class ModeManager extends EventEmitter implements IDisposable {\n  private state: ModeState;\n  private transitionHistory: Array<{ from: AgentMode; to: AgentMode; at: Date; reason: string }> = [];\n  private _isDestroyed = false;\n\n  constructor(initialMode: AgentMode = 'interactive') {\n    super();\n    this.state = {\n      mode: initialMode,\n      enteredAt: new Date(),\n      reason: 'initial',\n    };\n  }\n\n  /**\n   * Returns true if destroy() has been called.\n   */\n  get isDestroyed(): boolean {\n    return this._isDestroyed;\n  }\n\n  /**\n   * Releases all resources held by this ModeManager.\n   * Removes all event listeners.\n   * Safe to call multiple times (idempotent).\n   */\n  destroy(): void {\n    if (this._isDestroyed) {\n      return;\n    }\n\n    this._isDestroyed = true;\n    this.transitionHistory = [];\n    this.removeAllListeners();\n  }\n\n  /**\n   * Get current mode\n   */\n  getMode(): AgentMode {\n    return this.state.mode;\n  }\n\n  /**\n   * Get full mode state\n   */\n  getState(): ModeState {\n    return { ...this.state };\n  }\n\n  /**\n   * Check if a transition is allowed\n   */\n  canTransition(to: AgentMode): boolean {\n    const from = this.state.mode;\n\n    // Define valid transitions\n    const validTransitions: Record<AgentMode, AgentMode[]> = {\n      'interactive': ['planning', 'executing'],\n      'planning': ['interactive', 'executing'],\n      'executing': ['interactive', 'planning'],\n    };\n\n    return validTransitions[from].includes(to);\n  }\n\n  /**\n   * Transition to a new mode\n   */\n  transition(to: AgentMode, reason: string): boolean {\n    const from = this.state.mode;\n\n    if (!this.canTransition(to)) {\n      this.emit('mode:transition_blocked', { from, to, reason });\n      return false;\n    }\n\n    // Record transition\n    this.transitionHistory.push({ from, to, at: new Date(), reason });\n\n    // Update state\n    this.state = {\n      mode: to,\n      enteredAt: new Date(),\n      reason,\n      // Clear mode-specific state on transition\n      pendingPlan: to === 'planning' ? this.state.pendingPlan : undefined,\n      planApproved: to === 'executing' ? true : undefined,\n      currentTaskIndex: to === 'executing' ? 0 : undefined,\n    };\n\n    this.emit('mode:changed', { from, to, reason });\n    return true;\n  }\n\n  /**\n   * Enter planning mode with a goal\n   */\n  enterPlanning(reason: string = 'user_request'): boolean {\n    return this.transition('planning', reason);\n  }\n\n  /**\n   * Enter executing mode (plan must be approved)\n   */\n  enterExecuting(_plan: Plan, reason: string = 'plan_approved'): boolean {\n    if (this.state.mode === 'planning' && !this.state.planApproved) {\n      // Auto-approve when transitioning from planning to executing\n      this.state.planApproved = true;\n    }\n\n    const success = this.transition('executing', reason);\n    if (success) {\n      this.state.currentTaskIndex = 0;\n    }\n    return success;\n  }\n\n  /**\n   * Return to interactive mode\n   */\n  returnToInteractive(reason: string = 'completed'): boolean {\n    return this.transition('interactive', reason);\n  }\n\n  /**\n   * Set pending plan (in planning mode)\n   */\n  setPendingPlan(plan: Plan): void {\n    this.state.pendingPlan = plan;\n    this.state.planApproved = false;\n  }\n\n  /**\n   * Get pending plan\n   */\n  getPendingPlan(): Plan | undefined {\n    return this.state.pendingPlan;\n  }\n\n  /**\n   * Approve the pending plan\n   */\n  approvePlan(): boolean {\n    if (this.state.mode !== 'planning' || !this.state.pendingPlan) {\n      return false;\n    }\n    this.state.planApproved = true;\n    return true;\n  }\n\n  /**\n   * Check if plan is approved\n   */\n  isPlanApproved(): boolean {\n    return this.state.planApproved ?? false;\n  }\n\n  /**\n   * Update current task index (in executing mode)\n   */\n  setCurrentTaskIndex(index: number): void {\n    if (this.state.mode === 'executing') {\n      this.state.currentTaskIndex = index;\n    }\n  }\n\n  /**\n   * Get current task index\n   */\n  getCurrentTaskIndex(): number {\n    return this.state.currentTaskIndex ?? 0;\n  }\n\n  /**\n   * Pause execution\n   */\n  pauseExecution(reason: string): void {\n    if (this.state.mode === 'executing') {\n      this.state.pausedAt = new Date();\n      this.state.pauseReason = reason;\n    }\n  }\n\n  /**\n   * Resume execution\n   */\n  resumeExecution(): void {\n    if (this.state.mode === 'executing') {\n      this.state.pausedAt = undefined;\n      this.state.pauseReason = undefined;\n    }\n  }\n\n  /**\n   * Check if paused\n   */\n  isPaused(): boolean {\n    return this.state.pausedAt !== undefined;\n  }\n\n  /**\n   * Get pause reason\n   */\n  getPauseReason(): string | undefined {\n    return this.state.pauseReason;\n  }\n\n  /**\n   * Determine recommended mode based on intent analysis\n   */\n  recommendMode(intent: IntentAnalysis, _currentPlan?: Plan): AgentMode | null {\n    const currentMode = this.state.mode;\n\n    switch (intent.type) {\n      case 'complex':\n        // Complex task  suggest planning\n        if (currentMode === 'interactive') {\n          return 'planning';\n        }\n        break;\n\n      case 'approval':\n        // User approved plan  suggest executing\n        if (currentMode === 'planning' && this.state.pendingPlan) {\n          return 'executing';\n        }\n        break;\n\n      case 'rejection':\n        // User rejected plan  stay in planning to refine\n        if (currentMode === 'planning') {\n          return 'planning';\n        }\n        break;\n\n      case 'plan_modify':\n        // Plan modification  enter planning if not already\n        if (currentMode === 'executing' || currentMode === 'interactive') {\n          return 'planning';\n        }\n        break;\n\n      case 'interrupt':\n        // Interrupt  return to interactive\n        return 'interactive';\n\n      case 'simple':\n      case 'question':\n        // Simple query during execution  handle inline, stay in current mode\n        if (currentMode === 'executing') {\n          return null; // Handle without mode change\n        }\n        return 'interactive';\n\n      case 'status_query':\n        // Status query  no mode change, just respond\n        return null;\n\n      case 'feedback':\n        // Feedback during execution  note and continue\n        return null;\n    }\n\n    return null; // No mode change recommended\n  }\n\n  /**\n   * Get transition history\n   */\n  getHistory(): Array<{ from: AgentMode; to: AgentMode; at: Date; reason: string }> {\n    return [...this.transitionHistory];\n  }\n\n  /**\n   * Clear transition history\n   */\n  clearHistory(): void {\n    this.transitionHistory = [];\n  }\n\n  /**\n   * Get time spent in current mode\n   */\n  getTimeInCurrentMode(): number {\n    return Date.now() - this.state.enteredAt.getTime();\n  }\n\n  /**\n   * Serialize state for session persistence\n   */\n  serialize(): {\n    mode: AgentMode;\n    enteredAt: string;\n    reason: string;\n    pendingPlan?: Plan;\n    planApproved?: boolean;\n    currentTaskIndex?: number;\n  } {\n    return {\n      mode: this.state.mode,\n      enteredAt: this.state.enteredAt.toISOString(),\n      reason: this.state.reason,\n      pendingPlan: this.state.pendingPlan,\n      planApproved: this.state.planApproved,\n      currentTaskIndex: this.state.currentTaskIndex,\n    };\n  }\n\n  /**\n   * Restore state from serialized data\n   */\n  restore(data: ReturnType<ModeManager['serialize']>): void {\n    this.state = {\n      mode: data.mode,\n      enteredAt: new Date(data.enteredAt),\n      reason: data.reason,\n      pendingPlan: data.pendingPlan,\n      planApproved: data.planApproved,\n      currentTaskIndex: data.currentTaskIndex,\n    };\n  }\n}\n","/**\n * Meta-tools for UniversalAgent\n *\n * These tools are used internally by the agent to signal mode transitions\n * and perform meta-operations like planning and progress reporting.\n */\n\nimport type { ToolFunction } from '../../domain/entities/Tool.js';\nimport type { StartPlanningArgs, ModifyPlanArgs, ReportProgressArgs, RequestApprovalArgs } from './types.js';\n\n/**\n * Tool for starting planning mode\n */\nexport const startPlanningTool: ToolFunction<StartPlanningArgs, { status: string }> = {\n  definition: {\n    type: 'function',\n    function: {\n      name: '_start_planning',\n      description: `Call this when the user's request is complex and requires a multi-step plan.\nUse for tasks that:\n- Require 3 or more distinct steps\n- Need multiple tools to be called in sequence\n- Have dependencies between actions\n- Would benefit from user review before execution\n\nDo NOT use for:\n- Simple questions\n- Single tool calls\n- Quick calculations\n- Direct information retrieval`,\n      parameters: {\n        type: 'object',\n        properties: {\n          goal: {\n            type: 'string',\n            description: 'The high-level goal to achieve',\n          },\n          reasoning: {\n            type: 'string',\n            description: 'Brief explanation of why planning is needed',\n          },\n        },\n        required: ['goal', 'reasoning'],\n      },\n    },\n  },\n  execute: async (args) => {\n    // This is handled internally by UniversalAgent\n    return { status: 'planning_started', goal: args.goal };\n  },\n};\n\n/**\n * Tool for modifying the current plan\n */\nexport const modifyPlanTool: ToolFunction<ModifyPlanArgs, { status: string }> = {\n  definition: {\n    type: 'function',\n    function: {\n      name: '_modify_plan',\n      description: `Call this when the user wants to change the current plan.\nActions:\n- add_task: Add a new task to the plan\n- remove_task: Remove a task from the plan\n- skip_task: Mark a task to be skipped\n- update_task: Modify task description or dependencies\n- reorder: Change task order`,\n      parameters: {\n        type: 'object',\n        properties: {\n          action: {\n            type: 'string',\n            enum: ['add_task', 'remove_task', 'skip_task', 'update_task', 'reorder'],\n            description: 'The type of modification',\n          },\n          taskName: {\n            type: 'string',\n            description: 'Name of the task (for remove/skip/update/reorder)',\n          },\n          details: {\n            type: 'string',\n            description: 'Details of the modification (new task description, updates, etc.)',\n          },\n          insertAfter: {\n            type: 'string',\n            description: 'For add_task/reorder: insert after this task name',\n          },\n        },\n        required: ['action', 'details'],\n      },\n    },\n  },\n  execute: async (args) => {\n    // This is handled internally by UniversalAgent\n    return { status: 'plan_modified', action: args.action };\n  },\n};\n\n/**\n * Tool for reporting current progress\n */\nexport const reportProgressTool: ToolFunction<ReportProgressArgs, { status: string; progress: unknown }> = {\n  definition: {\n    type: 'function',\n    function: {\n      name: '_report_progress',\n      description: 'Call this when the user asks about current progress, status, or what has been done.',\n      parameters: {\n        type: 'object',\n        properties: {},\n        required: [],\n      },\n    },\n  },\n  execute: async () => {\n    // This is handled internally by UniversalAgent\n    return { status: 'progress_reported', progress: null };\n  },\n};\n\n/**\n * Tool for requesting user approval\n */\nexport const requestApprovalTool: ToolFunction<RequestApprovalArgs, { status: string }> = {\n  definition: {\n    type: 'function',\n    function: {\n      name: '_request_approval',\n      description: 'Call this when you need user approval to proceed. Use after creating a plan or before destructive operations.',\n      parameters: {\n        type: 'object',\n        properties: {\n          message: {\n            type: 'string',\n            description: 'Optional message to show the user',\n          },\n        },\n        required: [],\n      },\n    },\n  },\n  execute: async (args) => {\n    // This is handled internally by UniversalAgent\n    return { status: 'approval_requested', message: args?.message };\n  },\n};\n\n/**\n * Get all meta-tools\n */\nexport function getMetaTools(): ToolFunction[] {\n  return [\n    startPlanningTool,\n    modifyPlanTool,\n    reportProgressTool,\n    requestApprovalTool,\n  ];\n}\n\n/**\n * Check if a tool name is a meta-tool\n */\nexport function isMetaTool(toolName: string): boolean {\n  return toolName.startsWith('_');\n}\n\n/**\n * Meta-tool names\n */\nexport const META_TOOL_NAMES = {\n  START_PLANNING: '_start_planning',\n  MODIFY_PLAN: '_modify_plan',\n  REPORT_PROGRESS: '_report_progress',\n  REQUEST_APPROVAL: '_request_approval',\n} as const;\n","/**\n * UniversalAgent - Unified agent combining interactive, planning, and task execution\n *\n * Extends BaseAgent to inherit:\n * - Connector resolution\n * - Tool manager initialization\n * - Permission manager initialization\n * - Session management\n * - Lifecycle/cleanup\n *\n * Features:\n * - Mode-fluid: Automatically switches between interactive, planning, and executing\n * - User intervention: Users can interrupt, modify plans, provide feedback\n * - Smart detection: Auto-detects complex tasks that need planning\n * - Session persistence: Save and resume conversations\n * - Dynamic tools: Enable/disable tools at runtime\n */\n\nimport { BaseAgent, BaseAgentConfig, BaseSessionConfig } from '../../core/BaseAgent.js';\nimport { Agent } from '../../core/Agent.js';\nimport { Plan, Task, createPlan, createTask, TaskInput } from '../../domain/entities/Task.js';\nimport { StreamEventType } from '../../domain/entities/StreamEvent.js';\nimport type { WorkingMemoryConfig } from '../../domain/entities/Memory.js';\n// InMemoryStorage no longer needed - memory is managed by inherited AgentContext\nimport { PlanningAgent } from '../taskAgent/PlanningAgent.js';\nimport { ModeManager } from './ModeManager.js';\nimport { getMetaTools, isMetaTool, META_TOOL_NAMES } from './metaTools.js';\n// AgentContext is inherited from BaseAgent, import only for type reference if needed\nimport type { AgentContextConfig } from '../../core/AgentContext.js';\nimport { PlanPlugin } from '../../core/context/plugins/PlanPlugin.js';\nimport { MemoryPlugin } from '../../core/context/plugins/MemoryPlugin.js';\nimport type { AgentPermissionsConfig } from '../../core/permissions/types.js';\nimport type {\n  UniversalResponse,\n  UniversalEvent,\n  AgentMode,\n  TaskProgress,\n  IntentAnalysis,\n  PlanChange,\n  ExecutionResult,\n} from './types.js';\n\n// NOTE: UniversalAgent now exposes AgentContext directly via the `context` getter.\n// No separate interface needed - AgentContext is the unified API.\n\n// ============================================================================\n// Configuration\n// ============================================================================\n\n/**\n * Session configuration for UniversalAgent - extends BaseSessionConfig\n */\nexport interface UniversalAgentSessionConfig extends BaseSessionConfig {\n  // UniversalAgent-specific session options can be added here\n}\n\n/**\n * Planning configuration\n */\nexport interface UniversalAgentPlanningConfig {\n  /** Whether planning is enabled (default: true) */\n  enabled?: boolean;\n  /** Whether to auto-detect complex tasks (default: true) */\n  autoDetect?: boolean;\n  /** Model to use for planning (defaults to agent model) */\n  model?: string;\n  /** Whether approval is required (default: true) */\n  requireApproval?: boolean;\n}\n\n/**\n * UniversalAgent configuration - extends BaseAgentConfig\n */\nexport interface UniversalAgentConfig extends BaseAgentConfig {\n  /** System instructions for the agent */\n  instructions?: string;\n\n  /** Temperature for generation */\n  temperature?: number;\n\n  /** Maximum iterations for tool calling loop */\n  maxIterations?: number;\n\n  /** Planning configuration */\n  planning?: UniversalAgentPlanningConfig;\n\n  /** Memory configuration */\n  memoryConfig?: WorkingMemoryConfig;\n\n  /** Session configuration - extends base type */\n  session?: UniversalAgentSessionConfig;\n\n  /** Permission configuration for tool execution approval */\n  permissions?: AgentPermissionsConfig;\n\n  /** AgentContext configuration (optional) */\n  context?: Partial<AgentContextConfig>;\n}\n\n// ============================================================================\n// Events\n// ============================================================================\n\nexport interface UniversalAgentEvents {\n  'mode:changed': { from: AgentMode; to: AgentMode; reason: string };\n  'plan:created': { plan: Plan };\n  'plan:modified': { plan: Plan; changes: PlanChange[] };\n  'plan:approved': { plan: Plan };\n  'task:started': { task: Task };\n  'task:completed': { task: Task; result: unknown };\n  'task:failed': { task: Task; error: string };\n  'execution:completed': { result: ExecutionResult };\n  'error': { error: Error; recoverable: boolean };\n  // Inherited from BaseAgentEvents\n  'session:saved': { sessionId: string };\n  'session:loaded': { sessionId: string };\n  destroyed: void;\n}\n\n// ============================================================================\n// UniversalAgent Class\n// ============================================================================\n\nexport class UniversalAgent extends BaseAgent<UniversalAgentConfig, UniversalAgentEvents> {\n  // Core components\n  private agent: Agent;                    // Interactive agent (with meta-tools)\n  private executionAgent?: Agent;           // Execution agent (without meta-tools) - created on demand\n  private modeManager: ModeManager;\n  private planningAgent?: PlanningAgent;\n\n  // Plugins for inherited AgentContext (from BaseAgent)\n  // Note: _agentContext is inherited from BaseAgent (single source of truth)\n  private _planPlugin: PlanPlugin;\n  private _memoryPlugin?: MemoryPlugin;\n\n  // Execution state\n  private currentPlan: Plan | null = null;\n  private executionHistory: Array<{ input: string; response: UniversalResponse; timestamp: Date }> = [];\n\n  // ============================================================================\n  // Static Factory\n  // ============================================================================\n\n  /**\n   * Create a new UniversalAgent\n   */\n  static create(config: UniversalAgentConfig): UniversalAgent {\n    return new UniversalAgent(config);\n  }\n\n  /**\n   * Resume an agent from a saved session\n   */\n  static async resume(\n    sessionId: string,\n    config: Omit<UniversalAgentConfig, 'session'> & { session: { storage: import('../../domain/interfaces/IContextStorage.js').IContextStorage } }\n  ): Promise<UniversalAgent> {\n    const agent = new UniversalAgent({\n      ...config,\n      session: {\n        ...config.session,\n        id: sessionId,\n      },\n    });\n\n    // Wait for session to load\n    await agent.ensureSessionLoaded();\n\n    // Restore currentPlan from modeManager after session loads\n    // (modeManager state is restored via plugin during session load)\n    const pendingPlan = agent.modeManager.getPendingPlan();\n    if (pendingPlan) {\n      agent.currentPlan = pendingPlan;\n    }\n\n    return agent;\n  }\n\n  // ============================================================================\n  // Constructor\n  // ============================================================================\n\n  private constructor(config: UniversalAgentConfig) {\n    // Call BaseAgent constructor - handles connector, tool manager (via AgentContext), permission manager init\n    super(config, 'UniversalAgent');\n\n    // Register meta-tools for mode transitions (user tools already registered by BaseAgent)\n    const metaTools = getMetaTools();\n    for (const tool of metaTools) {\n      this._agentContext.tools.register(tool, { namespace: '_meta' });\n    }\n\n    // Set system prompt on inherited AgentContext\n    this._agentContext.systemPrompt = this.buildInstructions(config.instructions);\n\n    // Create base agent for LLM calls (shares inherited AgentContext)\n    const allTools = this._agentContext.tools.getEnabled();\n    this.agent = Agent.create({\n      connector: config.connector,\n      model: config.model,\n      tools: allTools,\n      instructions: this.buildInstructions(config.instructions),\n      temperature: config.temperature,\n      maxIterations: config.maxIterations ?? 20,\n      permissions: config.permissions,\n      context: this._agentContext,  // Share inherited AgentContext\n    });\n\n    // Initialize mode manager\n    this.modeManager = new ModeManager('interactive');\n    this.modeManager.on('mode:changed', (data) => {\n      this.emit('mode:changed', data);\n    });\n\n    // Note: ModeManager state is persisted via getContextState()/restoreContextState() overrides,\n    // not as a plugin. ModeManager is agent-level state, not context (it doesn't contribute to LLM prompt).\n\n    // Initialize planning agent if planning is enabled\n    const planningEnabled = config.planning?.enabled !== false;\n    if (planningEnabled) {\n      this.planningAgent = PlanningAgent.create({\n        connector: config.connector,\n        model: config.planning?.model ?? config.model,\n        availableTools: this._agentContext.tools.getEnabled().filter(t => !isMetaTool(t.definition.function.name)),\n      });\n    }\n\n    // Create execution agent (without meta-tools) for task execution\n    this.executionAgent = this.createExecutionAgent();\n\n    // Register PlanPlugin with inherited AgentContext\n    this._planPlugin = new PlanPlugin();\n    this._agentContext.registerPlugin(this._planPlugin);\n\n    // Only create MemoryPlugin if memory feature is enabled\n    if (this._agentContext.memory) {\n      this._memoryPlugin = new MemoryPlugin(this._agentContext.memory);\n      this._agentContext.registerPlugin(this._memoryPlugin);\n    }\n\n    // Initialize session (from BaseAgent)\n    this.initializeSession(config.session);\n  }\n\n  // ============================================================================\n  // Abstract Method Implementations\n  // ============================================================================\n\n  protected getAgentType(): 'agent' | 'task-agent' | 'universal-agent' {\n    return 'universal-agent';\n  }\n\n  // ============================================================================\n  // Session State Overrides (Agent-Level State)\n  // ============================================================================\n\n  /**\n   * Override to include ModeManager state in agentState field.\n   * ModeManager is agent-level state, not a context plugin.\n   */\n  async getContextState(): Promise<import('../../core/AgentContext.js').SerializedAgentContextState> {\n    const state = await super.getContextState();\n    state.agentState = state.agentState || {};\n    state.agentState.modeManager = this.modeManager.serialize();\n    return state;\n  }\n\n  /**\n   * Override to restore ModeManager state from agentState field.\n   */\n  async restoreContextState(state: import('../../core/AgentContext.js').SerializedAgentContextState): Promise<void> {\n    await super.restoreContextState(state);\n    if (state.agentState?.modeManager) {\n      this.modeManager.restore(state.agentState.modeManager as ReturnType<ModeManager['serialize']>);\n    }\n  }\n\n  // ============================================================================\n  // Main API\n  // ============================================================================\n\n  /**\n   * Chat with the agent - the main entry point\n   */\n  async chat(input: string): Promise<UniversalResponse> {\n    if (this._isDestroyed) {\n      throw new Error('Agent has been destroyed');\n    }\n\n    // Analyze user intent\n    const intent = await this.analyzeIntent(input);\n\n    // Handle based on current mode and intent\n    let response: UniversalResponse;\n\n    switch (this.modeManager.getMode()) {\n      case 'interactive':\n        response = await this.handleInteractive(input, intent);\n        break;\n      case 'planning':\n        response = await this.handlePlanning(input, intent);\n        break;\n      case 'executing':\n        response = await this.handleExecuting(input, intent);\n        break;\n      default:\n        throw new Error(`Unknown mode: ${this.modeManager.getMode()}`);\n    }\n\n    // Record in history\n    this.executionHistory.push({\n      input,\n      response,\n      timestamp: new Date(),\n    });\n\n    // Auto-save session if enabled\n    if (this._config.session?.autoSave && this.hasSession()) {\n      await this.saveSession().catch(() => {\n        // Ignore auto-save errors\n      });\n    }\n\n    return response;\n  }\n\n  /**\n   * Stream chat response\n   */\n  async *stream(input: string): AsyncIterableIterator<UniversalEvent> {\n    if (this._isDestroyed) {\n      throw new Error('Agent has been destroyed');\n    }\n\n    // Analyze intent\n    const intent = await this.analyzeIntent(input);\n\n    // Check for mode transition\n    const recommendedMode = this.modeManager.recommendMode(intent, this.currentPlan ?? undefined);\n    if (recommendedMode && recommendedMode !== this.modeManager.getMode()) {\n      const from = this.modeManager.getMode();\n      this.modeManager.transition(recommendedMode, intent.type);\n      yield { type: 'mode:changed', from, to: recommendedMode, reason: intent.type };\n    }\n\n    // Stream based on mode\n    const mode = this.modeManager.getMode();\n\n    if (mode === 'interactive') {\n      yield* this.streamInteractive(input, intent);\n    } else if (mode === 'planning') {\n      yield* this.streamPlanning(input, intent);\n    } else if (mode === 'executing') {\n      yield* this.streamExecuting(intent);\n    }\n  }\n\n  // ============================================================================\n  // Mode Handlers\n  // ============================================================================\n\n  private async handleInteractive(input: string, intent: IntentAnalysis): Promise<UniversalResponse> {\n    // Add user input to conversation history\n    await this.addToConversationHistory('user', input);\n\n    // Check if we should switch to planning\n    const shouldPlan = this.shouldSwitchToPlanning(intent);\n\n    if (shouldPlan) {\n      this.modeManager.enterPlanning('complex_task_detected');\n      return this.handlePlanning(input, intent);\n    }\n\n    // Build input with conversation context\n    const contextualInput = await this.buildFullContext(input);\n\n    // Execute directly with agent\n    const response = await this.agent.run(contextualInput);\n\n    // Check if agent used _start_planning meta-tool\n    const planningToolCall = response.output.find(\n      (item: any) => item.type === 'tool_use' && item.name === META_TOOL_NAMES.START_PLANNING\n    );\n\n    if (planningToolCall) {\n      this.modeManager.enterPlanning('agent_requested');\n      const rawInput = (planningToolCall as any).input;\n      const args = typeof rawInput === 'string' ? JSON.parse(rawInput || '{}') : (rawInput || {});\n      return this.createPlan(args.goal, args.reasoning);\n    }\n\n    // Add assistant response to conversation history\n    const responseText = response.output_text ?? '';\n    await this.addToConversationHistory('assistant', responseText);\n\n    return {\n      text: responseText,\n      mode: 'interactive',\n      usage: response.usage ? {\n        inputTokens: response.usage.input_tokens,\n        outputTokens: response.usage.output_tokens,\n        totalTokens: response.usage.total_tokens,\n      } : undefined,\n    };\n  }\n\n  private async handlePlanning(input: string, intent: IntentAnalysis): Promise<UniversalResponse> {\n    // Check if user is approving the plan\n    if (intent.type === 'approval' && this.modeManager.getPendingPlan()) {\n      return this.approvePlan(intent.feedback);\n    }\n\n    // Check if user is rejecting/modifying\n    if (intent.type === 'rejection') {\n      return this.handlePlanRejection(input, intent);\n    }\n\n    if (intent.type === 'plan_modify' && intent.modification) {\n      return this.modifyPlan(intent.modification);\n    }\n\n    // Create new plan or refine existing\n    if (!this.modeManager.getPendingPlan()) {\n      return this.createPlan(input);\n    } else {\n      // Refine existing plan based on input\n      return this.refinePlan(input);\n    }\n  }\n\n  private async handleExecuting(input: string, intent: IntentAnalysis): Promise<UniversalResponse> {\n    // Handle interrupts\n    if (intent.type === 'interrupt') {\n      this.modeManager.pauseExecution('user_interrupt');\n      return {\n        text: 'Execution paused. What would you like to do?',\n        mode: 'executing',\n        taskProgress: this.getTaskProgress(),\n        needsUserAction: true,\n        userActionType: 'provide_input',\n      };\n    }\n\n    // Handle status queries inline\n    if (intent.type === 'status_query') {\n      return this.reportProgress();\n    }\n\n    // Handle plan modifications\n    if (intent.type === 'plan_modify' && intent.modification) {\n      // Pause, modify, resume\n      this.modeManager.pauseExecution('plan_modification');\n      const modifyResult = await this.modifyPlan(intent.modification);\n      this.modeManager.resumeExecution();\n      return modifyResult;\n    }\n\n    // Handle feedback - note it and continue\n    if (intent.type === 'feedback') {\n      // Only store feedback if memory feature is enabled\n      if (this._agentContext.memory) {\n        await this._agentContext.memory.store(\n          `user_feedback_${Date.now()}`,\n          'User feedback during execution',\n          input,\n          { scope: 'persistent' }\n        );\n      }\n      return {\n        text: \"Noted. I'll keep that in mind as I continue.\",\n        mode: 'executing',\n        taskProgress: this.getTaskProgress(),\n      };\n    }\n\n    // If paused, resume with this input\n    if (this.modeManager.isPaused()) {\n      this.modeManager.resumeExecution();\n      // Continue execution\n      return this.continueExecution();\n    }\n\n    // Otherwise, handle as inline question\n    const response = await this.agent.run(input);\n    return {\n      text: response.output_text ?? '',\n      mode: 'executing',\n      taskProgress: this.getTaskProgress(),\n    };\n  }\n\n  // ============================================================================\n  // Streaming Handlers\n  // ============================================================================\n\n  private async *streamInteractive(input: string, intent: IntentAnalysis): AsyncIterableIterator<UniversalEvent> {\n    // Add user input to conversation history\n    await this.addToConversationHistory('user', input);\n\n    // Check if we should switch to planning\n    if (this.shouldSwitchToPlanning(intent)) {\n      const from = this.modeManager.getMode();\n      this.modeManager.enterPlanning('complex_task_detected');\n      yield { type: 'mode:changed', from, to: 'planning', reason: 'complex_task_detected' };\n      yield* this.streamPlanning(input, intent);\n      return;\n    }\n\n    // Build input with conversation context\n    const contextualInput = await this.buildFullContext(input);\n\n    // Stream from agent - track if _start_planning was called\n    let fullText = '';\n    let planningToolArgs: { goal: string; reasoning?: string } | null = null;\n    let currentToolName = '';\n\n    for await (const event of this.agent.stream(contextualInput)) {\n      if (event.type === StreamEventType.OUTPUT_TEXT_DELTA) {\n        const delta = (event as any).delta || '';\n        fullText += delta;\n        yield { type: 'text:delta', delta };\n      } else if (event.type === StreamEventType.TOOL_EXECUTION_START) {\n        currentToolName = (event as any).tool_name || 'unknown';\n        const args = (event as any).arguments || null;\n        yield { type: 'tool:start', name: currentToolName, args };\n\n        // Capture _start_planning args\n        if (currentToolName === META_TOOL_NAMES.START_PLANNING && args) {\n          planningToolArgs = typeof args === 'string' ? JSON.parse(args) : args;\n        }\n      } else if (event.type === StreamEventType.TOOL_EXECUTION_DONE) {\n        yield { type: 'tool:complete', name: (event as any).tool_name || 'unknown', result: (event as any).result, durationMs: (event as any).execution_time_ms || 0 };\n      }\n    }\n\n    // Check if agent called _start_planning - if so, transition to planning mode\n    if (planningToolArgs) {\n      this.modeManager.enterPlanning('agent_requested');\n      yield { type: 'mode:changed', from: 'interactive', to: 'planning', reason: 'agent_requested' };\n\n      // Create the actual plan\n      const plan = await this.createPlanInternal(planningToolArgs.goal);\n      this.modeManager.setPendingPlan(plan);\n      this.currentPlan = plan;\n\n      yield { type: 'plan:created', plan };\n\n      if (this._config.planning?.requireApproval !== false) {\n        yield { type: 'plan:awaiting_approval', plan };\n        yield { type: 'needs:approval', plan };\n\n        const summary = this.formatPlanSummary(plan);\n        await this.addToConversationHistory('assistant', summary);\n\n        // Yield the plan summary as text so user sees it\n        yield { type: 'text:delta', delta: '\\n\\n' + summary };\n        yield { type: 'text:done', text: fullText + '\\n\\n' + summary };\n      }\n      return;\n    }\n\n    // Add assistant response to conversation history\n    await this.addToConversationHistory('assistant', fullText);\n\n    yield { type: 'text:done', text: fullText };\n  }\n\n  private async *streamPlanning(input: string, intent: IntentAnalysis): AsyncIterableIterator<UniversalEvent> {\n    // Add user input to conversation history (if not already added by streamInteractive)\n    if (intent.type !== 'approval') {\n      await this.addToConversationHistory('user', input);\n    }\n\n    if (intent.type === 'approval' && this.modeManager.getPendingPlan()) {\n      const plan = this.modeManager.getPendingPlan()!;\n      this.modeManager.approvePlan();\n      yield { type: 'plan:approved', plan };\n\n      // Add plan approval to history\n      await this.addToConversationHistory('assistant', `Plan approved. Starting execution of ${plan.tasks.length} tasks.`);\n\n      // Transition to executing\n      this.modeManager.enterExecuting(plan, 'plan_approved');\n      yield { type: 'mode:changed', from: 'planning', to: 'executing', reason: 'plan_approved' };\n\n      yield* this.streamExecution();\n      return;\n    }\n\n    // Create plan\n    yield { type: 'plan:analyzing', goal: input };\n\n    const plan = await this.createPlanInternal(input);\n    this.modeManager.setPendingPlan(plan);\n    this.currentPlan = plan;\n\n    yield { type: 'plan:created', plan };\n\n    if (this._config.planning?.requireApproval !== false) {\n      yield { type: 'plan:awaiting_approval', plan };\n      yield { type: 'needs:approval', plan };\n\n      const summary = this.formatPlanSummary(plan);\n\n      // Add plan to conversation history\n      await this.addToConversationHistory('assistant', summary);\n\n      yield { type: 'text:delta', delta: summary };\n      yield { type: 'text:done', text: summary };\n    }\n  }\n\n  private async *streamExecuting(intent: IntentAnalysis): AsyncIterableIterator<UniversalEvent> {\n    if (intent.type === 'status_query') {\n      const progress = this.getTaskProgress();\n      const text = this.formatProgress(progress);\n      yield { type: 'text:delta', delta: text };\n      yield { type: 'text:done', text };\n      return;\n    }\n\n    yield* this.streamExecution();\n  }\n\n  private async *streamExecution(): AsyncIterableIterator<UniversalEvent> {\n    if (!this.currentPlan) {\n      yield { type: 'error', error: 'No plan to execute', recoverable: false };\n      return;\n    }\n\n    // Ensure execution agent exists (without meta-tools)\n    if (!this.executionAgent) {\n      this.executionAgent = this.createExecutionAgent();\n    }\n\n    const tasks = this.currentPlan.tasks;\n    let completedTasks = 0;\n    let failedTasks = 0;\n\n    for (let i = 0; i < tasks.length; i++) {\n      const task = tasks[i];\n      if (!task) continue;\n\n      // Check if paused\n      if (this.modeManager.isPaused()) {\n        yield { type: 'execution:paused', reason: this.modeManager.getPauseReason() || 'unknown' };\n        return;\n      }\n\n      // Skip completed/failed tasks\n      if (task.status === 'completed' || task.status === 'failed' || task.status === 'skipped') {\n        if (task.status === 'completed') completedTasks++;\n        if (task.status === 'failed') failedTasks++;\n        continue;\n      }\n\n      // Start task\n      task.status = 'in_progress';\n      task.startedAt = Date.now();\n      task.attempts = (task.attempts || 0) + 1;\n      this.modeManager.setCurrentTaskIndex(i);\n\n      yield { type: 'task:started', task };\n\n      try {\n        // Build task prompt with context about the plan and completed tasks\n        const prompt = this.buildTaskPromptWithContext(task, i);\n        let taskResultText = '';\n\n        // Use execution agent (without meta-tools) instead of main agent\n        for await (const event of this.executionAgent.stream(prompt)) {\n          if (event.type === StreamEventType.OUTPUT_TEXT_DELTA) {\n            const delta = (event as any).delta || '';\n            taskResultText += delta;\n            yield { type: 'task:progress', task, status: delta };\n          } else if (event.type === StreamEventType.TOOL_EXECUTION_START) {\n            yield { type: 'tool:start', name: (event as any).tool_name || 'unknown', args: (event as any).arguments || null };\n          } else if (event.type === StreamEventType.TOOL_EXECUTION_DONE) {\n            yield { type: 'tool:complete', name: (event as any).tool_name || 'unknown', result: (event as any).result, durationMs: (event as any).execution_time_ms || 0 };\n          }\n        }\n\n        // Mark completed\n        task.status = 'completed';\n        task.completedAt = Date.now();\n        task.result = { success: true, output: taskResultText };\n        completedTasks++;\n\n        // Add task completion to conversation history\n        await this.addToConversationHistory('assistant', `Completed task \"${task.name}\": ${taskResultText.substring(0, 200)}${taskResultText.length > 200 ? '...' : ''}`);\n\n        yield { type: 'task:completed', task, result: taskResultText };\n\n      } catch (error) {\n        task.status = 'failed';\n        const errorMsg = error instanceof Error ? error.message : String(error);\n        task.result = { success: false, error: errorMsg };\n        failedTasks++;\n\n        // Add task failure to conversation history\n        await this.addToConversationHistory('assistant', `Task \"${task.name}\" failed: ${errorMsg}`);\n\n        yield { type: 'task:failed', task, error: errorMsg };\n      }\n    }\n\n    // All done\n    const result: ExecutionResult = {\n      status: failedTasks === 0 ? 'completed' : 'failed',\n      completedTasks,\n      totalTasks: tasks.length,\n      failedTasks,\n      skippedTasks: tasks.filter(t => t.status === 'skipped').length,\n    };\n\n    // Generate final response by gathering task results\n    const finalResponse = this.generateExecutionSummary(tasks);\n\n    // Yield text events so the user sees the final response\n    yield { type: 'text:delta', delta: '\\n' + finalResponse };\n    yield { type: 'text:done', text: finalResponse };\n\n    // Add final response to conversation history\n    await this.addToConversationHistory('assistant', finalResponse);\n\n    yield { type: 'execution:done', result };\n\n    // Return to interactive\n    this.modeManager.returnToInteractive('execution_completed');\n    yield { type: 'mode:changed', from: 'executing', to: 'interactive', reason: 'execution_completed' };\n\n    this.emit('execution:completed', { result });\n  }\n\n  /**\n   * Generate a user-facing summary from task execution results.\n   * Returns the output of the last successful task, or a status summary if all failed.\n   */\n  private generateExecutionSummary(tasks: Task[]): string {\n    // Find the last completed task with output (typically the final synthesis/summary task)\n    const completedTasks = tasks.filter(t => t.status === 'completed' && t.result?.output);\n\n    if (completedTasks.length > 0) {\n      // Return the last task's output - this is typically the final answer/summary\n      const lastTask = completedTasks[completedTasks.length - 1];\n      if (lastTask && lastTask.result?.output) {\n        // Convert output to string (it's typed as unknown)\n        const output = lastTask.result.output;\n        return typeof output === 'string' ? output : JSON.stringify(output, null, 2);\n      }\n    }\n\n    // If no completed tasks with output, check for failed tasks\n    const failedTasks = tasks.filter(t => t.status === 'failed');\n    if (failedTasks.length > 0) {\n      const errors = failedTasks.map(t => `- ${t.name}: ${t.result?.error || 'Unknown error'}`).join('\\n');\n      return `Plan execution encountered errors:\\n${errors}`;\n    }\n\n    // Fallback\n    return 'Plan execution completed but no output was generated.';\n  }\n\n  // ============================================================================\n  // Planning Helpers\n  // ============================================================================\n\n  private async createPlan(goal: string, _reasoning?: string): Promise<UniversalResponse> {\n    const plan = await this.createPlanInternal(goal);\n\n    this.modeManager.setPendingPlan(plan);\n    this.currentPlan = plan;\n\n    this.emit('plan:created', { plan });\n\n    const summary = this.formatPlanSummary(plan);\n    const requireApproval = this._config.planning?.requireApproval !== false;\n\n    return {\n      text: summary,\n      mode: 'planning',\n      plan,\n      planStatus: requireApproval ? 'pending_approval' : 'approved',\n      needsUserAction: requireApproval,\n      userActionType: requireApproval ? 'approve_plan' : undefined,\n    };\n  }\n\n  private async createPlanInternal(goal: string): Promise<Plan> {\n    if (this.planningAgent) {\n      const result = await this.planningAgent.generatePlan({ goal });\n      return createPlan({ goal, tasks: result.plan.tasks as TaskInput[] });\n    }\n\n    // Fallback: simple single-task plan\n    return createPlan({\n      goal,\n      tasks: [{ name: 'execute', description: goal }],\n    });\n  }\n\n  private async approvePlan(_feedback?: string): Promise<UniversalResponse> {\n    const plan = this.modeManager.getPendingPlan();\n    if (!plan) {\n      return {\n        text: 'No plan to approve.',\n        mode: this.modeManager.getMode(),\n      };\n    }\n\n    this.modeManager.approvePlan();\n    this.modeManager.enterExecuting(plan, 'user_approved');\n    this.currentPlan = plan;\n\n    this.emit('plan:approved', { plan });\n\n    // Start execution\n    return this.continueExecution();\n  }\n\n  private async handlePlanRejection(_input: string, intent: IntentAnalysis): Promise<UniversalResponse> {\n    if (intent.feedback) {\n      return this.refinePlan(intent.feedback);\n    }\n\n    return {\n      text: \"I understand you'd like to change the plan. What would you like me to modify?\",\n      mode: 'planning',\n      plan: this.modeManager.getPendingPlan(),\n      needsUserAction: true,\n      userActionType: 'provide_input',\n    };\n  }\n\n  private async refinePlan(feedback: string): Promise<UniversalResponse> {\n    const currentPlan = this.modeManager.getPendingPlan();\n    if (!currentPlan || !this.planningAgent) {\n      return this.createPlan(feedback);\n    }\n\n    const refined = await this.planningAgent.refinePlan(currentPlan, feedback);\n    this.modeManager.setPendingPlan(refined.plan);\n    this.currentPlan = refined.plan;\n\n    this.emit('plan:modified', { plan: refined.plan, changes: [] });\n\n    return {\n      text: this.formatPlanSummary(refined.plan),\n      mode: 'planning',\n      plan: refined.plan,\n      planStatus: 'pending_approval',\n      needsUserAction: true,\n      userActionType: 'approve_plan',\n    };\n  }\n\n  private async modifyPlan(modification: IntentAnalysis['modification']): Promise<UniversalResponse> {\n    if (!modification || !this.currentPlan) {\n      return {\n        text: 'No active plan to modify.',\n        mode: this.modeManager.getMode(),\n      };\n    }\n\n    const changes: PlanChange[] = [];\n\n    switch (modification.action) {\n      case 'add_task': {\n        const newTask = createTask({\n          name: `task_${this.currentPlan.tasks.length + 1}`,\n          description: modification.details ?? 'New task',\n        });\n        this.currentPlan.tasks.push(newTask);\n        changes.push({ type: 'task_added', taskId: newTask.id, taskName: newTask.name, details: modification.details });\n        break;\n      }\n\n      case 'remove_task': {\n        const idx = this.currentPlan.tasks.findIndex(t => t.name === modification.taskName);\n        if (idx >= 0) {\n          this.currentPlan.tasks.splice(idx, 1);\n          changes.push({ type: 'task_removed', taskName: modification.taskName });\n        }\n        break;\n      }\n\n      case 'skip_task': {\n        const task = this.currentPlan.tasks.find(t => t.name === modification.taskName);\n        if (task) {\n          task.status = 'skipped';\n          changes.push({ type: 'task_updated', taskId: task.id, taskName: task.name, details: 'Marked as skipped' });\n        }\n        break;\n      }\n\n      case 'update_task': {\n        const task = this.currentPlan.tasks.find(t => t.name === modification.taskName);\n        if (task && modification.details) {\n          task.description = modification.details;\n          changes.push({ type: 'task_updated', taskId: task.id, taskName: task.name, details: modification.details });\n        }\n        break;\n      }\n    }\n\n    this.currentPlan.lastUpdatedAt = Date.now();\n\n    this.emit('plan:modified', { plan: this.currentPlan, changes });\n\n    return {\n      text: `Plan updated: ${changes.map(c => c.details || c.type).join(', ')}`,\n      mode: this.modeManager.getMode(),\n      plan: this.currentPlan,\n    };\n  }\n\n  // ============================================================================\n  // Execution Helpers\n  // ============================================================================\n\n  private async continueExecution(): Promise<UniversalResponse> {\n    if (!this.currentPlan) {\n      return {\n        text: 'No plan to execute.',\n        mode: 'interactive',\n      };\n    }\n\n    const tasks = this.currentPlan.tasks;\n    const pendingTasks = tasks.filter(t => t.status === 'pending' || t.status === 'in_progress');\n\n    if (pendingTasks.length === 0) {\n      this.modeManager.returnToInteractive('all_tasks_completed');\n      return {\n        text: 'All tasks completed!',\n        mode: 'interactive',\n        taskProgress: this.getTaskProgress(),\n      };\n    }\n\n    // Execute next pending task\n    const nextTask = pendingTasks[0];\n    if (!nextTask) {\n      throw new Error('No pending task found');\n    }\n\n    nextTask.status = 'in_progress';\n    nextTask.startedAt = Date.now();\n    nextTask.attempts = (nextTask.attempts || 0) + 1;\n\n    this.emit('task:started', { task: nextTask });\n\n    try {\n      const prompt = this.buildTaskPrompt(nextTask);\n      const response = await this.agent.run(prompt);\n\n      nextTask.status = 'completed';\n      nextTask.completedAt = Date.now();\n      nextTask.result = { success: true, output: response.output_text };\n\n      this.emit('task:completed', { task: nextTask, result: response.output_text });\n\n      // Check if more tasks\n      const remaining = tasks.filter(t => t.status === 'pending');\n      if (remaining.length > 0) {\n        return {\n          text: `Completed: ${nextTask.name}\\n\\nContinuing to next task...`,\n          mode: 'executing',\n          taskProgress: this.getTaskProgress(),\n        };\n      } else {\n        this.modeManager.returnToInteractive('all_tasks_completed');\n        return {\n          text: `All tasks completed!\\n\\nFinal task result:\\n${response.output_text}`,\n          mode: 'interactive',\n          taskProgress: this.getTaskProgress(),\n        };\n      }\n    } catch (error) {\n      nextTask.status = 'failed';\n      const errorMsg = error instanceof Error ? error.message : String(error);\n      nextTask.result = { success: false, error: errorMsg };\n\n      this.emit('task:failed', { task: nextTask, error: errorMsg });\n\n      return {\n        text: `Task failed: ${errorMsg}`,\n        mode: 'executing',\n        taskProgress: this.getTaskProgress(),\n      };\n    }\n  }\n\n  private reportProgress(): UniversalResponse {\n    const progress = this.getTaskProgress();\n    return {\n      text: this.formatProgress(progress),\n      mode: this.modeManager.getMode(),\n      taskProgress: progress,\n    };\n  }\n\n  // ============================================================================\n  // Intent Analysis\n  // ============================================================================\n\n  private async analyzeIntent(input: string): Promise<IntentAnalysis> {\n    const lowerInput = input.toLowerCase().trim();\n\n    // Simple pattern matching for common intents\n    if (this.isApproval(lowerInput)) {\n      return { type: 'approval', confidence: 0.9 };\n    }\n\n    if (this.isRejection(lowerInput)) {\n      return { type: 'rejection', confidence: 0.9, feedback: input };\n    }\n\n    if (this.isStatusQuery(lowerInput)) {\n      return { type: 'status_query', confidence: 0.9 };\n    }\n\n    if (this.isInterrupt(lowerInput)) {\n      return { type: 'interrupt', confidence: 0.9 };\n    }\n\n    if (this.isPlanModification(lowerInput)) {\n      return {\n        type: 'plan_modify',\n        confidence: 0.8,\n        modification: this.parsePlanModification(input),\n      };\n    }\n\n    // Check complexity heuristics\n    const complexity = this.estimateComplexity(input);\n    if (complexity === 'high' || complexity === 'medium') {\n      return {\n        type: 'complex',\n        confidence: 0.7,\n        complexity,\n        estimatedSteps: this.estimateSteps(input),\n      };\n    }\n\n    return { type: 'simple', confidence: 0.8 };\n  }\n\n  private isApproval(input: string): boolean {\n    const approvalPatterns = [\n      /^(yes|yeah|yep|sure|ok|okay|go ahead|proceed|approve|looks good|lgtm|do it|start|execute|run it)$/i,\n      /^(that('s| is) (good|fine|great|perfect))$/i,\n      /^(please proceed|please continue|continue)$/i,\n    ];\n    return approvalPatterns.some(p => p.test(input));\n  }\n\n  private isRejection(input: string): boolean {\n    const rejectionPatterns = [\n      /^(no|nope|nah|stop|cancel|reject|don't|wait)$/i,\n      /^(that('s| is) (wrong|not right|incorrect))$/i,\n      /change|modify|different|instead/i,\n    ];\n    return rejectionPatterns.some(p => p.test(input));\n  }\n\n  private isStatusQuery(input: string): boolean {\n    const statusPatterns = [\n      /status|progress|where are (you|we)|what('s| is) (the )?(status|progress)/i,\n      /how('s| is) it going|what have you done|current state/i,\n      /which task|what task/i,\n    ];\n    return statusPatterns.some(p => p.test(input));\n  }\n\n  private isInterrupt(input: string): boolean {\n    const interruptPatterns = [\n      /^(stop|pause|wait|hold on|hold up)$/i,\n      /stop (what you're doing|execution|everything)/i,\n    ];\n    return interruptPatterns.some(p => p.test(input));\n  }\n\n  private isPlanModification(input: string): boolean {\n    const modPatterns = [\n      /add (a )?task|new task|also (do|add)|additionally/i,\n      /remove (the )?task|skip (the )?task|don't do/i,\n      /change (the )?order|reorder|do .* first|prioritize/i,\n      /update (the )?task|modify (the )?task/i,\n    ];\n    return modPatterns.some(p => p.test(input));\n  }\n\n  private parsePlanModification(input: string): IntentAnalysis['modification'] {\n    const lowerInput = input.toLowerCase();\n\n    if (/add|new|also|additionally/.test(lowerInput)) {\n      return { action: 'add_task', details: input };\n    }\n    if (/remove|skip|don't/.test(lowerInput)) {\n      return { action: 'skip_task', details: input };\n    }\n    if (/reorder|first|prioritize/.test(lowerInput)) {\n      return { action: 'reorder', details: input };\n    }\n    return { action: 'update_task', details: input };\n  }\n\n  /**\n   * Check if the input is a simple single-tool request that shouldn't trigger planning.\n   * These are common patterns like web searches, lookups, etc.\n   */\n  private isSingleToolRequest(input: string): boolean {\n    const lowerInput = input.toLowerCase();\n\n    // Patterns that indicate a simple tool call (not a multi-step task)\n    const singleToolPatterns = [\n      // Web search patterns\n      /^(search|google|look\\s*up|find)\\s+(the\\s+)?(web|internet|online)?\\s*(for|about)?\\s+/i,\n      /^(search|find|look\\s*up)\\s+/i,\n      /^what\\s+(is|are|was|were)\\s+/i,\n      /^who\\s+(is|are|was|were)\\s+/i,\n      /^where\\s+(is|are|was|were)\\s+/i,\n      /^when\\s+(did|was|were|is)\\s+/i,\n      /^how\\s+(do|does|did|to|much|many)\\s+/i,\n      // Web fetch patterns\n      /^(fetch|get|read|open|visit|go\\s+to)\\s+(the\\s+)?(url|page|website|site|link)/i,\n      /^(fetch|get|scrape)\\s+https?:\\/\\//i,\n      // Simple calculations/lookups\n      /^(calculate|compute|what\\s+is)\\s+\\d/i,\n      /^(tell\\s+me|show\\s+me|give\\s+me)\\s+(about|the)/i,\n      // Summary requests (still single action)\n      /^(summarize|summary\\s+of)\\s+/i,\n    ];\n\n    // Check if it matches any single-tool pattern\n    if (singleToolPatterns.some(p => p.test(lowerInput))) {\n      return true;\n    }\n\n    // Also check: if \"and\" is followed by result-presentation words, it's still single-action\n    // e.g., \"search for X and show me results\" = single action (search + display)\n    // vs \"search for X and then email the results\" = multi-action\n    const presentationSuffixes = /\\s+and\\s+(show|display|give|tell|present|list|summarize|provide)\\s+(me\\s+)?(the\\s+)?(results?|summary|findings?|answer|info|information)/i;\n    if (presentationSuffixes.test(lowerInput)) {\n      return true;\n    }\n\n    return false;\n  }\n\n  private estimateComplexity(input: string): 'low' | 'medium' | 'high' {\n    // First check: is this a simple single-tool request?\n    if (this.isSingleToolRequest(input)) {\n      return 'low';\n    }\n\n    const words = input.split(/\\s+/).length;\n    const lowerInput = input.toLowerCase();\n\n    // Check for multiple DISTINCT action verbs (not just the word \"and\")\n    const actionVerbs = ['search', 'find', 'create', 'build', 'write', 'send', 'email',\n                         'delete', 'update', 'fetch', 'scrape', 'download', 'upload',\n                         'install', 'deploy', 'configure', 'setup', 'migrate', 'refactor',\n                         'analyze', 'compare', 'merge', 'split', 'convert', 'transform'];\n    const foundVerbs = actionVerbs.filter(v => new RegExp(`\\\\b${v}\\\\b`, 'i').test(lowerInput));\n    const hasMultipleDistinctActions = foundVerbs.length >= 2;\n\n    // Complex keywords that suggest planning is needed\n    const hasComplexKeywords = /\\b(build|create|implement|design|develop|setup|configure|migrate|refactor|deploy|integrate)\\b/i.test(lowerInput);\n\n    // Sequential action keywords (stronger signal than just \"and\")\n    const hasSequentialKeywords = /\\b(then|after\\s+that|next|finally|first\\s+.+\\s+then|step\\s+\\d)\\b/i.test(lowerInput);\n\n    // High complexity: long input with complex keywords, or multiple distinct actions with sequences\n    if (words > 50 || (hasMultipleDistinctActions && hasSequentialKeywords)) {\n      return 'high';\n    }\n\n    // Medium complexity: multiple distinct actions, or complex keywords with some length\n    if (hasMultipleDistinctActions || (hasComplexKeywords && words > 15)) {\n      return 'medium';\n    }\n\n    // Default to low\n    return 'low';\n  }\n\n  private estimateSteps(input: string): number {\n    const andCount = (input.match(/\\band\\b/gi) || []).length;\n    const thenCount = (input.match(/\\bthen\\b/gi) || []).length;\n    return Math.max(2, andCount + thenCount + 1);\n  }\n\n  private shouldSwitchToPlanning(intent: IntentAnalysis): boolean {\n    if (this._config.planning?.enabled !== false && this._config.planning?.autoDetect !== false) {\n      return intent.type === 'complex' && (intent.complexity === 'high' || intent.complexity === 'medium');\n    }\n    return false;\n  }\n\n  // ============================================================================\n  // Execution Agent (without meta-tools)\n  // ============================================================================\n\n  /**\n   * Create a separate agent for task execution that doesn't have meta-tools.\n   * This prevents the agent from calling _start_planning during task execution.\n   * Shares AgentContext with parent UniversalAgent for history/memory continuity.\n   */\n  private createExecutionAgent(): Agent {\n    // Get user tools only (exclude meta-tools) from inherited _agentContext\n    const userTools = this._agentContext.tools.getEnabled().filter(t => !isMetaTool(t.definition.function.name));\n\n    return Agent.create({\n      connector: this._config.connector,\n      model: this._config.model,\n      tools: userTools,\n      instructions: this.buildExecutionInstructions(),\n      temperature: this._config.temperature,\n      maxIterations: this._config.maxIterations ?? 20,\n      permissions: this._config.permissions,\n      context: this._agentContext,  // Share context with execution agent for history/memory continuity\n    });\n  }\n\n  /**\n   * Build instructions for the execution agent (task-focused)\n   */\n  private buildExecutionInstructions(): string {\n    return `You are an AI assistant executing specific tasks. Focus on completing the assigned task using the available tools.\n\nGuidelines:\n- Execute the task described in the prompt\n- Use the appropriate tools to accomplish the task\n- Report results clearly and concisely\n- If you encounter errors, explain what went wrong\n\n${this._config.instructions ?? ''}`;\n  }\n\n  // ============================================================================\n  // Conversation History & Context (via AgentContext)\n  // ============================================================================\n\n  /**\n   * Add a message to conversation history (via AgentContext)\n   */\n  private async addToConversationHistory(role: 'user' | 'assistant', content: string): Promise<void> {\n    // Use async addMessage with capacity checking for potentially large content\n    await this._agentContext.addMessage(role, content);\n  }\n\n  /**\n   * Build full context for the agent (via AgentContext.prepare())\n   * Returns formatted context string ready for LLM\n   */\n  private async buildFullContext(currentInput: string): Promise<string> {\n    // Update plan in plugin before preparing context\n    if (this.currentPlan) {\n      this._planPlugin.setPlan(this.currentPlan);\n    }\n\n    // Set current input and prepare context\n    this._agentContext.setCurrentInput(currentInput);\n    const prepared = await this._agentContext.prepare();\n\n    // Format components into context string\n    const parts: string[] = [];\n    for (const component of prepared.components) {\n      if (component.content) {\n        const content = typeof component.content === 'string'\n          ? component.content\n          : JSON.stringify(component.content, null, 2);\n        parts.push(content);\n      }\n    }\n\n    return parts.join('\\n\\n');\n  }\n\n  // ============================================================================\n  // Helpers\n  // ============================================================================\n\n  private buildInstructions(userInstructions?: string): string {\n    const baseInstructions = `You are a versatile AI assistant that can handle both simple requests and complex multi-step tasks.\n\nFor simple requests:\n- Answer questions directly\n- Use tools when needed for immediate results\n\nFor complex requests:\n- Use the _start_planning tool to create a structured plan\n- Wait for user approval before executing\n\nYou have access to meta-tools:\n- _start_planning: Call when a task needs multiple steps\n- _modify_plan: Call when user wants to change the plan\n- _report_progress: Call when user asks about status\n- _request_approval: Call when you need user confirmation\n\nAlways be helpful, clear, and ask for clarification when needed.`;\n\n    return userInstructions\n      ? `${baseInstructions}\\n\\nAdditional instructions:\\n${userInstructions}`\n      : baseInstructions;\n  }\n\n  private buildTaskPrompt(task: Task): string {\n    let prompt = `Execute the following task:\\n\\nTask: ${task.name}\\nDescription: ${task.description}`;\n\n    if (task.expectedOutput) {\n      prompt += `\\nExpected Output: ${task.expectedOutput}`;\n    }\n\n    return prompt;\n  }\n\n  /**\n   * Build task prompt with full context (plan goal, completed tasks, etc.)\n   */\n  private buildTaskPromptWithContext(task: Task, taskIndex: number): string {\n    const parts: string[] = [];\n\n    // Add plan context\n    if (this.currentPlan) {\n      parts.push(`## Overall Goal\\n${this.currentPlan.goal}\\n`);\n\n      // Add results from completed tasks\n      const completedTasks = this.currentPlan.tasks.slice(0, taskIndex).filter(t => t.status === 'completed');\n      if (completedTasks.length > 0) {\n        parts.push(`## Previously Completed Tasks`);\n        for (const completed of completedTasks) {\n          const output = completed.result?.output\n            ? (typeof completed.result.output === 'string'\n              ? completed.result.output.substring(0, 300)\n              : JSON.stringify(completed.result.output).substring(0, 300))\n            : 'No output recorded';\n          parts.push(`- **${completed.name}**: ${completed.description}\\n  Result: ${output}`);\n        }\n        parts.push('');\n      }\n    }\n\n    // Add current task\n    parts.push(`## Current Task (${taskIndex + 1}/${this.currentPlan?.tasks.length || 1})`);\n    parts.push(`**Name**: ${task.name}`);\n    parts.push(`**Description**: ${task.description}`);\n    if (task.expectedOutput) {\n      parts.push(`**Expected Output**: ${task.expectedOutput}`);\n    }\n    parts.push('');\n    parts.push('Execute this task now using the available tools. Be thorough and report results clearly.');\n\n    return parts.join('\\n');\n  }\n\n  private formatPlanSummary(plan: Plan): string {\n    let summary = `I've created a plan to: ${plan.goal}\\n\\n`;\n    summary += `Tasks (${plan.tasks.length}):\\n`;\n\n    plan.tasks.forEach((task, i) => {\n      const deps = task.dependsOn?.length ? ` (depends on: ${task.dependsOn.join(', ')})` : '';\n      summary += `${i + 1}. ${task.name}: ${task.description}${deps}\\n`;\n    });\n\n    summary += '\\nWould you like me to proceed with this plan?';\n    return summary;\n  }\n\n  private formatProgress(progress: TaskProgress): string {\n    let text = `Progress: ${progress.completed}/${progress.total} tasks completed`;\n\n    if (progress.failed > 0) {\n      text += ` (${progress.failed} failed)`;\n    }\n    if (progress.skipped > 0) {\n      text += ` (${progress.skipped} skipped)`;\n    }\n\n    if (progress.current) {\n      text += `\\n\\nCurrently working on: ${progress.current.name}`;\n    }\n\n    return text;\n  }\n\n  private getTaskProgress(): TaskProgress {\n    if (!this.currentPlan) {\n      return { completed: 0, total: 0, failed: 0, skipped: 0 };\n    }\n\n    const tasks = this.currentPlan.tasks;\n    const currentIdx = this.modeManager.getCurrentTaskIndex();\n\n    return {\n      completed: tasks.filter(t => t.status === 'completed').length,\n      total: tasks.length,\n      current: tasks[currentIdx],\n      failed: tasks.filter(t => t.status === 'failed').length,\n      skipped: tasks.filter(t => t.status === 'skipped').length,\n    };\n  }\n\n  // ============================================================================\n  // Public Getters\n  // ============================================================================\n\n  getMode(): AgentMode {\n    return this.modeManager.getMode();\n  }\n\n  getPlan(): Plan | null {\n    return this.currentPlan;\n  }\n\n  getProgress(): TaskProgress | null {\n    if (this.modeManager.getMode() !== 'executing' || !this.currentPlan) {\n      return null;\n    }\n    return this.getTaskProgress();\n  }\n\n  /**\n   * Access to tool manager (alias for `tools` getter from BaseAgent)\n   * @deprecated Use `tools` instead for consistency with other agents\n   */\n  get toolManager() {\n    return this._agentContext.tools;  // Use inherited AgentContext.tools\n  }\n\n  // ============================================================================\n  // Unified Context Access\n  // ============================================================================\n\n  // Note: `context` getter is inherited from BaseAgent (returns _agentContext)\n  // The inherited getter returns the AgentContext which is always available after BaseAgent constructor\n\n  /**\n   * Check if context is available (always true since AgentContext is created by BaseAgent)\n   */\n  hasContext(): boolean {\n    return true;\n  }\n\n  // ============================================================================\n  // Runtime Configuration\n  // ============================================================================\n\n  setAutoApproval(value: boolean): void {\n    if (this._config.planning) {\n      this._config.planning.requireApproval = !value;\n    }\n  }\n\n  setPlanningEnabled(value: boolean): void {\n    if (this._config.planning) {\n      this._config.planning.enabled = value;\n    }\n  }\n\n  // ============================================================================\n  // Control\n  // ============================================================================\n\n  private _isPaused = false;\n\n  pause(): void {\n    this._isPaused = true;\n    if (this.modeManager.getMode() === 'executing') {\n      this.modeManager.pauseExecution('user_request');\n    }\n  }\n\n  resume(): void {\n    this._isPaused = false;\n    if (this.modeManager.isPaused()) {\n      this.modeManager.resumeExecution();\n    }\n  }\n\n  cancel(): void {\n    if (this.currentPlan) {\n      this.currentPlan.status = 'cancelled';\n    }\n    this.modeManager.returnToInteractive('cancelled');\n  }\n\n  isRunning(): boolean {\n    return this.modeManager.getMode() === 'executing' && !this.isPaused();\n  }\n\n  isPaused(): boolean {\n    return this._isPaused || this.modeManager.isPaused();\n  }\n\n  // ============================================================================\n  // Cleanup\n  // ============================================================================\n\n  destroy(): void {\n    if (this._isDestroyed) return;\n\n    this._logger.debug('UniversalAgent destroy started');\n\n    // Run cleanup callbacks (synchronously, matching Agent behavior)\n    for (const callback of this._cleanupCallbacks) {\n      try {\n        callback();\n      } catch (error) {\n        this._logger.error({ error: (error as Error).message }, 'Cleanup callback error');\n      }\n    }\n    this._cleanupCallbacks = [];\n\n    // Cleanup components\n    this.agent.destroy();\n    if (this.executionAgent) {\n      this.executionAgent.destroy();\n    }\n    this.modeManager.destroy();\n\n    // Note: AgentContext cleanup is handled by baseDestroy() in BaseAgent\n\n    // Call base destroy (handles session, AgentContext, permission manager cleanup)\n    this.baseDestroy();\n\n    this._logger.debug('UniversalAgent destroyed');\n  }\n}\n"]}