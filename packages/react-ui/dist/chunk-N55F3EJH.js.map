{"version":3,"sources":["../src/markdown/VegaChart.tsx"],"sourcesContent":["/**\n * Vega/Vega-Lite Chart Renderer\n * Renders Vega or Vega-Lite JSON specifications as interactive charts.\n *\n * Requires `react-vega` and `vega-lite` as optional peer dependencies.\n */\n\nimport React, { useEffect, useRef, useState, useMemo } from 'react';\nimport type { VegaChartProps } from './types';\n\nexport function VegaChart({\n  code,\n  isLite = true,\n  onError,\n}: VegaChartProps): React.ReactElement {\n  const containerRef = useRef<HTMLDivElement>(null);\n  const [containerWidth, setContainerWidth] = useState<number>(600);\n  const [parseError, setParseError] = useState<string | null>(null);\n  const [VegaLiteComp, setVegaLiteComp] = useState<React.ComponentType<{ spec: unknown; actions?: Record<string, boolean>; onError?: (error: Error) => void }> | null>(null);\n\n  // Dynamic import of react-vega (optional peer dep)\n  useEffect(() => {\n    import('react-vega')\n      .then((mod) => setVegaLiteComp(() => mod.VegaLite))\n      .catch(() => {\n        setParseError('react-vega is not installed. Install it to render Vega charts.');\n      });\n  }, []);\n\n  // Measure container width\n  useEffect(() => {\n    if (!containerRef.current) return;\n\n    const measure = () => {\n      if (containerRef.current) {\n        const width = containerRef.current.offsetWidth;\n        if (width > 0) {\n          setContainerWidth(Math.max(width - 32, 300));\n        }\n      }\n    };\n\n    const timeoutId = setTimeout(measure, 10);\n    const resizeObserver = new ResizeObserver(measure);\n    resizeObserver.observe(containerRef.current);\n\n    return () => {\n      clearTimeout(timeoutId);\n      resizeObserver.disconnect();\n    };\n  }, []);\n\n  // Parse spec\n  const spec = useMemo(() => {\n    try {\n      const parsed = JSON.parse(code);\n      if (!parsed.width) parsed.width = containerWidth;\n      if (!parsed.height && !parsed.encoding?.row && !parsed.encoding?.column) {\n        parsed.height = 300;\n      }\n      setParseError(null);\n      return parsed;\n    } catch (err) {\n      const errorMsg = err instanceof Error ? err.message : 'Failed to parse JSON';\n      setParseError(errorMsg);\n      if (onError) onError(new Error(errorMsg));\n      return null;\n    }\n  }, [code, containerWidth, onError]);\n\n  const handleVegaError = (error: Error) => {\n    console.error('Vega render error:', error);\n    setParseError(error.message);\n    if (onError) onError(error);\n  };\n\n  if (parseError) {\n    return (\n      <div className=\"vega-chart vega-chart--error\">\n        <span className=\"vega-chart__error-text\">Error: {parseError}</span>\n      </div>\n    );\n  }\n\n  return (\n    <div ref={containerRef} className=\"vega-chart\">\n      {spec && VegaLiteComp && (\n        <VegaLiteComp\n          spec={spec}\n          actions={{ export: true, source: false, compiled: false, editor: false }}\n          onError={handleVegaError}\n        />\n      )}\n    </div>\n  );\n}\n\nexport default VegaChart;\n"],"mappings":";AAOA,SAAgB,WAAW,QAAQ,UAAU,eAAe;AAuEtD,cACE,YADF;AApEC,SAAS,UAAU;AAAA,EACxB;AAAA,EACA,SAAS;AAAA,EACT;AACF,GAAuC;AACrC,QAAM,eAAe,OAAuB,IAAI;AAChD,QAAM,CAAC,gBAAgB,iBAAiB,IAAI,SAAiB,GAAG;AAChE,QAAM,CAAC,YAAY,aAAa,IAAI,SAAwB,IAAI;AAChE,QAAM,CAAC,cAAc,eAAe,IAAI,SAA6H,IAAI;AAGzK,YAAU,MAAM;AACd,WAAO,YAAY,EAChB,KAAK,CAAC,QAAQ,gBAAgB,MAAM,IAAI,QAAQ,CAAC,EACjD,MAAM,MAAM;AACX,oBAAc,gEAAgE;AAAA,IAChF,CAAC;AAAA,EACL,GAAG,CAAC,CAAC;AAGL,YAAU,MAAM;AACd,QAAI,CAAC,aAAa,QAAS;AAE3B,UAAM,UAAU,MAAM;AACpB,UAAI,aAAa,SAAS;AACxB,cAAM,QAAQ,aAAa,QAAQ;AACnC,YAAI,QAAQ,GAAG;AACb,4BAAkB,KAAK,IAAI,QAAQ,IAAI,GAAG,CAAC;AAAA,QAC7C;AAAA,MACF;AAAA,IACF;AAEA,UAAM,YAAY,WAAW,SAAS,EAAE;AACxC,UAAM,iBAAiB,IAAI,eAAe,OAAO;AACjD,mBAAe,QAAQ,aAAa,OAAO;AAE3C,WAAO,MAAM;AACX,mBAAa,SAAS;AACtB,qBAAe,WAAW;AAAA,IAC5B;AAAA,EACF,GAAG,CAAC,CAAC;AAGL,QAAM,OAAO,QAAQ,MAAM;AACzB,QAAI;AACF,YAAM,SAAS,KAAK,MAAM,IAAI;AAC9B,UAAI,CAAC,OAAO,MAAO,QAAO,QAAQ;AAClC,UAAI,CAAC,OAAO,UAAU,CAAC,OAAO,UAAU,OAAO,CAAC,OAAO,UAAU,QAAQ;AACvE,eAAO,SAAS;AAAA,MAClB;AACA,oBAAc,IAAI;AAClB,aAAO;AAAA,IACT,SAAS,KAAK;AACZ,YAAM,WAAW,eAAe,QAAQ,IAAI,UAAU;AACtD,oBAAc,QAAQ;AACtB,UAAI,QAAS,SAAQ,IAAI,MAAM,QAAQ,CAAC;AACxC,aAAO;AAAA,IACT;AAAA,EACF,GAAG,CAAC,MAAM,gBAAgB,OAAO,CAAC;AAElC,QAAM,kBAAkB,CAAC,UAAiB;AACxC,YAAQ,MAAM,sBAAsB,KAAK;AACzC,kBAAc,MAAM,OAAO;AAC3B,QAAI,QAAS,SAAQ,KAAK;AAAA,EAC5B;AAEA,MAAI,YAAY;AACd,WACE,oBAAC,SAAI,WAAU,gCACb,+BAAC,UAAK,WAAU,0BAAyB;AAAA;AAAA,MAAQ;AAAA,OAAW,GAC9D;AAAA,EAEJ;AAEA,SACE,oBAAC,SAAI,KAAK,cAAc,WAAU,cAC/B,kBAAQ,gBACP;AAAA,IAAC;AAAA;AAAA,MACC;AAAA,MACA,SAAS,EAAE,QAAQ,MAAM,QAAQ,OAAO,UAAU,OAAO,QAAQ,MAAM;AAAA,MACvE,SAAS;AAAA;AAAA,EACX,GAEJ;AAEJ;AAEA,IAAO,oBAAQ;","names":[]}