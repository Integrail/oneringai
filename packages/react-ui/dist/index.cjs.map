{"version":3,"sources":["../src/markdown/MermaidDiagram.tsx","../src/markdown/VegaChart.tsx","../src/markdown/MarkmapRenderer.tsx","../src/index.ts","../src/look-inside/LookInsidePanel.tsx","../src/look-inside/CollapsibleSection.tsx","../src/look-inside/utils.ts","../src/look-inside/sections/ContextWindowSection.tsx","../src/look-inside/sections/TokenBreakdownSection.tsx","../src/look-inside/sections/SystemPromptSection.tsx","../src/look-inside/sections/ToolsSection.tsx","../src/look-inside/sections/GenericPluginSection.tsx","../src/look-inside/plugins/WorkingMemoryRenderer.tsx","../src/look-inside/plugins/InContextMemoryRenderer.tsx","../src/look-inside/plugins/PersistentInstructionsRenderer.tsx","../src/look-inside/plugins/UserInfoRenderer.tsx","../src/look-inside/plugins/registry.ts","../src/look-inside/ViewContextContent.tsx","../src/markdown/MarkdownRenderer.tsx","../src/markdown/CodeBlock.tsx","../src/markdown/index.ts","../src/markdown/RenderErrorBoundary.tsx","../src/chat/MessageList.tsx","../src/chat/StreamingText.tsx","../src/chat/ThinkingBlock.tsx","../src/chat/ToolCallCard.tsx","../src/chat/ExecutionProgress.tsx","../src/chat/ChatControls.tsx","../src/chat/ExportMessage.tsx","../src/context-display/ContextDisplayPanel.tsx","../src/context-display/ContextEntryCard.tsx","../src/context-display/utils.ts","../src/context-display/useOrderPersistence.ts","../src/context-display/useDynamicUIChangeDetection.ts"],"sourcesContent":["/**\n * Mermaid Diagram Renderer\n * Renders mermaid diagram code into SVG.\n *\n * Requires `mermaid` as an optional peer dependency.\n */\n\nimport React, { useEffect, useRef, useState, useId } from 'react';\nimport type { MermaidDiagramProps } from './types';\n\nexport function MermaidDiagram({ code, onError }: MermaidDiagramProps): React.ReactElement {\n  const containerRef = useRef<HTMLDivElement>(null);\n  const [svg, setSvg] = useState<string | null>(null);\n  const [isRendering, setIsRendering] = useState(true);\n  const uniqueId = useId().replace(/:/g, '_');\n\n  useEffect(() => {\n    let mounted = true;\n\n    const renderDiagram = async () => {\n      if (!code.trim()) {\n        setIsRendering(false);\n        return;\n      }\n\n      try {\n        setIsRendering(true);\n\n        // Dynamic import — mermaid is an optional peer dep\n        const mermaid = (await import('mermaid')).default;\n\n        mermaid.initialize({\n          startOnLoad: false,\n          theme: 'default',\n          securityLevel: 'loose',\n          fontFamily: 'inherit',\n          flowchart: { useMaxWidth: true, htmlLabels: true, curve: 'basis' },\n          sequence: { useMaxWidth: true },\n          gantt: { useMaxWidth: true },\n        });\n\n        // Preprocess common issues\n        let processedCode = code.trim();\n        if (processedCode.startsWith('usecase')) {\n          processedCode = processedCode.replace(/^usecase/, 'flowchart TD');\n        }\n        processedCode = processedCode\n          .replace(/<br>/gi, '<br/>')\n          .replace(/\\s*<--\\s*/g, ' --> ');\n\n        const { svg: renderedSvg } = await mermaid.render(\n          `mermaid-${uniqueId}`,\n          processedCode,\n        );\n\n        if (mounted) {\n          setSvg(renderedSvg);\n          setIsRendering(false);\n        }\n      } catch (err) {\n        console.error('Mermaid render error:', err);\n        if (mounted) {\n          setIsRendering(false);\n          if (onError) {\n            onError(err instanceof Error ? err : new Error(String(err)));\n          }\n        }\n      }\n    };\n\n    renderDiagram();\n    return () => { mounted = false; };\n  }, [code, uniqueId, onError]);\n\n  if (isRendering) {\n    return (\n      <div className=\"mermaid-diagram mermaid-diagram--loading\">\n        <div className=\"rui-spinner\" role=\"status\">\n          <span className=\"rui-visually-hidden\">Rendering diagram...</span>\n        </div>\n      </div>\n    );\n  }\n\n  if (!svg) {\n    return (\n      <div className=\"mermaid-diagram mermaid-diagram--empty\">\n        <span>No diagram to render</span>\n      </div>\n    );\n  }\n\n  return (\n    <div\n      ref={containerRef}\n      className=\"mermaid-diagram\"\n      dangerouslySetInnerHTML={{ __html: svg }}\n    />\n  );\n}\n\nexport default MermaidDiagram;\n","/**\n * Vega/Vega-Lite Chart Renderer\n * Renders Vega or Vega-Lite JSON specifications as interactive charts.\n *\n * Requires `react-vega` and `vega-lite` as optional peer dependencies.\n */\n\nimport React, { useEffect, useRef, useState, useMemo } from 'react';\nimport type { VegaChartProps } from './types';\n\nexport function VegaChart({\n  code,\n  isLite = true,\n  onError,\n}: VegaChartProps): React.ReactElement {\n  const containerRef = useRef<HTMLDivElement>(null);\n  const [containerWidth, setContainerWidth] = useState<number>(600);\n  const [parseError, setParseError] = useState<string | null>(null);\n  const [VegaLiteComp, setVegaLiteComp] = useState<React.ComponentType<{ spec: unknown; actions?: Record<string, boolean>; onError?: (error: Error) => void }> | null>(null);\n\n  // Dynamic import of react-vega (optional peer dep)\n  useEffect(() => {\n    import('react-vega')\n      .then((mod) => setVegaLiteComp(() => mod.VegaLite))\n      .catch(() => {\n        setParseError('react-vega is not installed. Install it to render Vega charts.');\n      });\n  }, []);\n\n  // Measure container width\n  useEffect(() => {\n    if (!containerRef.current) return;\n\n    const measure = () => {\n      if (containerRef.current) {\n        const width = containerRef.current.offsetWidth;\n        if (width > 0) {\n          setContainerWidth(Math.max(width - 32, 300));\n        }\n      }\n    };\n\n    const timeoutId = setTimeout(measure, 10);\n    const resizeObserver = new ResizeObserver(measure);\n    resizeObserver.observe(containerRef.current);\n\n    return () => {\n      clearTimeout(timeoutId);\n      resizeObserver.disconnect();\n    };\n  }, []);\n\n  // Parse spec\n  const spec = useMemo(() => {\n    try {\n      const parsed = JSON.parse(code);\n      if (!parsed.width) parsed.width = containerWidth;\n      if (!parsed.height && !parsed.encoding?.row && !parsed.encoding?.column) {\n        parsed.height = 300;\n      }\n      setParseError(null);\n      return parsed;\n    } catch (err) {\n      const errorMsg = err instanceof Error ? err.message : 'Failed to parse JSON';\n      setParseError(errorMsg);\n      if (onError) onError(new Error(errorMsg));\n      return null;\n    }\n  }, [code, containerWidth, onError]);\n\n  const handleVegaError = (error: Error) => {\n    console.error('Vega render error:', error);\n    setParseError(error.message);\n    if (onError) onError(error);\n  };\n\n  if (parseError) {\n    return (\n      <div className=\"vega-chart vega-chart--error\">\n        <span className=\"vega-chart__error-text\">Error: {parseError}</span>\n      </div>\n    );\n  }\n\n  return (\n    <div ref={containerRef} className=\"vega-chart\">\n      {spec && VegaLiteComp && (\n        <VegaLiteComp\n          spec={spec}\n          actions={{ export: true, source: false, compiled: false, editor: false }}\n          onError={handleVegaError}\n        />\n      )}\n    </div>\n  );\n}\n\nexport default VegaChart;\n","/**\n * Markmap Mindmap Renderer\n * Renders markdown content as an interactive mindmap.\n *\n * Requires `markmap-lib` and `markmap-view` as optional peer dependencies.\n */\n\nimport React, { useEffect, useRef, useState, useCallback } from 'react';\nimport { ZoomIn, ZoomOut, Maximize2 } from 'lucide-react';\nimport type { MarkmapRendererProps } from './types';\n\nexport function MarkmapRenderer({\n  code,\n  onError,\n}: MarkmapRendererProps): React.ReactElement {\n  const svgRef = useRef<SVGSVGElement>(null);\n  const markmapRef = useRef<any>(null);\n  const [isRendered, setIsRendered] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  const calculateHeight = useCallback((content: string): number => {\n    const lines = content.split('\\n').filter((line) => line.trim());\n    const depth = Math.max(\n      ...lines.map((line) => {\n        const match = line.match(/^(\\s*)/);\n        return match ? Math.floor(match[1].length / 2) : 0;\n      }),\n    );\n    return Math.max(300, Math.min(600, 200 + lines.length * 20 + depth * 40));\n  }, []);\n\n  useEffect(() => {\n    let mounted = true;\n\n    const renderMarkmap = async () => {\n      if (!svgRef.current || !code.trim()) return;\n\n      try {\n        // Dynamic imports — optional peer deps\n        const { Transformer } = await import('markmap-lib');\n        const { Markmap, loadCSS, loadJS } = await import('markmap-view');\n\n        const transformer = new Transformer();\n        const { root, features } = transformer.transform(code);\n        const { styles, scripts } = transformer.getUsedAssets(features);\n        if (styles) loadCSS(styles);\n        if (scripts) await loadJS(scripts, { getMarkmap: () => ({ Markmap }) });\n\n        if (!mounted) return;\n\n        if (markmapRef.current) {\n          markmapRef.current.destroy();\n        }\n\n        markmapRef.current = Markmap.create(svgRef.current, {\n          duration: 300,\n          fitRatio: 0.85,\n          spacingHorizontal: 80,\n          spacingVertical: 20,\n          autoFit: true,\n          initialExpandLevel: 3,\n          color: (node: any) => {\n            const colors = ['#5B8FF9', '#5AD8A6', '#F6BD16', '#E86452', '#6DC8EC', '#945FB9'];\n            return colors[(node.state?.depth || 0) % colors.length];\n          },\n        });\n\n        markmapRef.current.setData(root);\n        markmapRef.current.fit();\n        setIsRendered(true);\n        setError(null);\n      } catch (err) {\n        console.error('Markmap render error:', err);\n        const errorMsg = err instanceof Error ? err.message : 'Failed to render mindmap';\n        setError(errorMsg);\n        if (onError) onError(err instanceof Error ? err : new Error(errorMsg));\n      }\n    };\n\n    renderMarkmap();\n\n    return () => {\n      mounted = false;\n      if (markmapRef.current) {\n        markmapRef.current.destroy();\n        markmapRef.current = null;\n      }\n    };\n  }, [code, onError]);\n\n  const handleZoomIn = useCallback(() => {\n    if (markmapRef.current) {\n      const svg = markmapRef.current.svg;\n      const transform = svg.node()?.getAttribute('transform') || '';\n      const scaleMatch = transform.match(/scale\\(([\\d.]+)\\)/);\n      const currentScale = scaleMatch ? parseFloat(scaleMatch[1]) : 1;\n      markmapRef.current.rescale(Math.min(currentScale * 1.2, 3));\n    }\n  }, []);\n\n  const handleZoomOut = useCallback(() => {\n    if (markmapRef.current) {\n      const svg = markmapRef.current.svg;\n      const transform = svg.node()?.getAttribute('transform') || '';\n      const scaleMatch = transform.match(/scale\\(([\\d.]+)\\)/);\n      const currentScale = scaleMatch ? parseFloat(scaleMatch[1]) : 1;\n      markmapRef.current.rescale(Math.max(currentScale / 1.2, 0.3));\n    }\n  }, []);\n\n  const handleFit = useCallback(() => {\n    if (markmapRef.current) {\n      markmapRef.current.fit();\n    }\n  }, []);\n\n  if (error) {\n    return (\n      <div className=\"markmap-renderer markmap-renderer--error\">\n        <span className=\"markmap-renderer__error-text\">Error: {error}</span>\n      </div>\n    );\n  }\n\n  const height = calculateHeight(code);\n\n  return (\n    <div className=\"markmap-renderer\">\n      <div className=\"markmap-renderer__controls\">\n        <button className=\"markmap-renderer__btn\" onClick={handleZoomIn} title=\"Zoom In\">\n          <ZoomIn size={14} />\n        </button>\n        <button className=\"markmap-renderer__btn\" onClick={handleZoomOut} title=\"Zoom Out\">\n          <ZoomOut size={14} />\n        </button>\n        <button className=\"markmap-renderer__btn\" onClick={handleFit} title=\"Fit to View\">\n          <Maximize2 size={14} />\n        </button>\n      </div>\n      <svg\n        ref={svgRef}\n        className=\"markmap-renderer__svg\"\n        style={{ width: '100%', height: `${height}px` }}\n      />\n      {!isRendered && (\n        <div className=\"markmap-renderer__loading\">\n          <div className=\"rui-spinner\" role=\"status\">\n            <span className=\"rui-visually-hidden\">Rendering mindmap...</span>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n\nexport default MarkmapRenderer;\n","/**\n * @everworker/react-ui — Shared React UI components for OneRingAI agent apps.\n *\n * CSS imports (in your app):\n *   import '@everworker/react-ui/styles';           // Look Inside panel\n *   import '@everworker/react-ui/styles/markdown';   // Markdown rendering\n *   import '@everworker/react-ui/styles/chat';       // Chat components\n *   import '@everworker/react-ui/styles/thinking';   // Thinking block\n */\n\n// Look Inside components\nexport * from './look-inside/index';\n\n// Markdown rendering components\nexport * from './markdown/index';\n\n// Chat UI components\nexport * from './chat/index';\n\n// Context Display components\nexport * from './context-display/index';\n","/**\n * LookInsidePanel — Main container that auto-renders plugin sections.\n *\n * Takes a serializable IContextSnapshot and renders all sections.\n * Plugin sections are auto-discovered from the snapshot — no hardcoding.\n */\n\nimport React, { useMemo, useState, useCallback, useRef } from 'react';\nimport type { LookInsidePanelProps, PluginRenderer, IPluginSnapshot } from './types';\nimport { CollapsibleSection } from './CollapsibleSection';\nimport { ContextWindowSection } from './sections/ContextWindowSection';\nimport { TokenBreakdownSection } from './sections/TokenBreakdownSection';\nimport { SystemPromptSection } from './sections/SystemPromptSection';\nimport { ToolsSection } from './sections/ToolsSection';\nimport { GenericPluginSection } from './sections/GenericPluginSection';\nimport { getPluginRenderer } from './plugins/registry';\n\nexport const LookInsidePanel: React.FC<LookInsidePanelProps> = ({\n  snapshot,\n  loading = false,\n  agentName,\n  headerActions,\n  onViewFullContext,\n  onForceCompaction,\n  className,\n  pluginRenderers,\n  defaultExpanded = ['context', 'tools'],\n  onMemoryEntryClick,\n  memoryEntryValues,\n  loadingMemoryKey,\n}) => {\n  // Manage expanded state here so it survives snapshot refreshes.\n  // Use a ref to only initialize from defaultExpanded once.\n  const initialized = useRef(false);\n  const [expandedSet, setExpandedSet] = useState<Set<string>>(() => new Set(defaultExpanded));\n  if (!initialized.current) {\n    initialized.current = true;\n  }\n\n  const toggleSection = useCallback((id: string) => {\n    setExpandedSet((prev) => {\n      const next = new Set(prev);\n      if (next.has(id)) next.delete(id);\n      else next.add(id);\n      return next;\n    });\n  }, []);\n\n  const isSectionExpanded = useCallback((id: string) => expandedSet.has(id), [expandedSet]);\n  // Merge app-provided renderers with built-in registry\n  const resolveRenderer = useMemo(() => {\n    return (pluginName: string): PluginRenderer | null => {\n      // App-level override first\n      if (pluginRenderers?.[pluginName]) return pluginRenderers[pluginName];\n      // Then built-in registry\n      return getPluginRenderer(pluginName);\n    };\n  }, [pluginRenderers]);\n\n  if (loading) {\n    return (\n      <div className={`look-inside-panel look-inside-loading ${className ?? ''}`}>\n        <div className=\"look-inside-spinner\">Loading...</div>\n      </div>\n    );\n  }\n\n  if (!snapshot || !snapshot.available) {\n    return (\n      <div className={`look-inside-panel look-inside-unavailable ${className ?? ''}`}>\n        <div className=\"look-inside-muted\">Context not available</div>\n      </div>\n    );\n  }\n\n  return (\n    <div className={`look-inside-panel ${className ?? ''}`}>\n      {/* Header */}\n      <div className=\"look-inside-header\">\n        <div className=\"look-inside-header-title\">\n          <span className=\"look-inside-title\">\n            {agentName ? `${agentName} — Look Inside` : 'Look Inside'}\n          </span>\n          <span className=\"look-inside-model-badge\">{snapshot.model}</span>\n        </div>\n        <div className=\"look-inside-header-actions\">\n          {onViewFullContext && (\n            <button\n              type=\"button\"\n              className=\"look-inside-btn look-inside-btn-secondary\"\n              onClick={onViewFullContext}\n            >\n              View Full Context\n            </button>\n          )}\n          {onForceCompaction && (\n            <button\n              type=\"button\"\n              className=\"look-inside-btn look-inside-btn-secondary\"\n              onClick={onForceCompaction}\n            >\n              Force Compaction\n            </button>\n          )}\n          {headerActions}\n        </div>\n      </div>\n\n      {/* Context Window */}\n      <CollapsibleSection\n        title=\"Context Window\"\n        id=\"context\"\n        onToggle={toggleSection}\n        expanded={isSectionExpanded('context')}\n        badge={`${snapshot.budget.utilizationPercent.toFixed(0)}%`}\n      >\n        <ContextWindowSection\n          budget={snapshot.budget}\n          messagesCount={snapshot.messagesCount}\n          toolCallsCount={snapshot.toolCallsCount}\n          strategy={snapshot.strategy}\n        />\n      </CollapsibleSection>\n\n      {/* Token Breakdown */}\n      <CollapsibleSection\n        title=\"Token Breakdown\"\n        id=\"tokens\"\n        onToggle={toggleSection}\n        expanded={isSectionExpanded('tokens')}\n      >\n        <TokenBreakdownSection budget={snapshot.budget} />\n      </CollapsibleSection>\n\n      {/* System Prompt */}\n      <CollapsibleSection\n        title=\"System Prompt\"\n        id=\"system-prompt\"\n        onToggle={toggleSection}\n        expanded={isSectionExpanded('system-prompt')}\n      >\n        <SystemPromptSection content={snapshot.systemPrompt} />\n      </CollapsibleSection>\n\n      {/* Plugin Sections (auto-discovered) */}\n      {snapshot.plugins.map((plugin: IPluginSnapshot) => {\n        const Renderer = resolveRenderer(plugin.name) ?? GenericPluginSection;\n        // Pass memory entry props to working_memory renderer\n        const extraProps = plugin.name === 'working_memory'\n          ? { onEntryClick: onMemoryEntryClick, entryValues: memoryEntryValues, loadingEntryKey: loadingMemoryKey }\n          : {};\n        return (\n          <CollapsibleSection\n            key={plugin.name}\n            title={plugin.displayName}\n            id={`plugin-${plugin.name}`}\n            onToggle={toggleSection}\n            expanded={isSectionExpanded(`plugin-${plugin.name}`)}\n            badge={plugin.tokenSize > 0 ? `${plugin.tokenSize} tok` : undefined}\n          >\n            <Renderer plugin={plugin} {...extraProps} />\n          </CollapsibleSection>\n        );\n      })}\n\n      {/* Tools */}\n      <CollapsibleSection\n        title=\"Tools\"\n        id=\"tools\"\n        onToggle={toggleSection}\n        expanded={isSectionExpanded('tools')}\n        badge={snapshot.tools.length}\n      >\n        <ToolsSection tools={snapshot.tools} />\n      </CollapsibleSection>\n    </div>\n  );\n};\n","/**\n * CollapsibleSection — Reusable expand/collapse wrapper.\n * Supports both uncontrolled (defaultExpanded) and controlled (expanded + onToggle) modes.\n */\n\nimport React, { useState, useCallback } from 'react';\nimport type { CollapsibleSectionProps } from './types';\n\nexport const CollapsibleSection: React.FC<CollapsibleSectionProps> = ({\n  title,\n  id,\n  defaultExpanded = false,\n  expanded: controlledExpanded,\n  onToggle,\n  badge,\n  icon,\n  children,\n  className,\n}) => {\n  // Uncontrolled fallback\n  const [internalExpanded, setInternalExpanded] = useState(defaultExpanded);\n\n  const isControlled = controlledExpanded !== undefined;\n  const expanded = isControlled ? controlledExpanded : internalExpanded;\n\n  const toggle = useCallback(() => {\n    if (onToggle) {\n      onToggle(id);\n    } else {\n      setInternalExpanded((prev) => !prev);\n    }\n  }, [id, onToggle]);\n\n  return (\n    <div\n      className={`look-inside-section ${expanded ? 'look-inside-section-expanded' : ''} ${className ?? ''}`}\n      data-section-id={id}\n    >\n      <button\n        type=\"button\"\n        className=\"look-inside-section-header\"\n        onClick={toggle}\n        aria-expanded={expanded}\n      >\n        <span className=\"look-inside-section-chevron\">\n          {expanded ? '▾' : '▸'}\n        </span>\n        {icon && <span className=\"look-inside-section-icon\">{icon}</span>}\n        <span className=\"look-inside-section-title\">{title}</span>\n        {badge !== undefined && badge !== null && (\n          <span className=\"look-inside-section-badge\">{badge}</span>\n        )}\n      </button>\n      {expanded && (\n        <div className=\"look-inside-section-content\">{children}</div>\n      )}\n    </div>\n  );\n};\n","/**\n * Utility functions for Look Inside components.\n */\n\n/**\n * Format bytes to a human-readable string.\n */\nexport function formatBytes(bytes: number): string {\n  if (bytes === 0) return '0 B';\n  const units = ['B', 'KB', 'MB', 'GB'];\n  const i = Math.floor(Math.log(bytes) / Math.log(1024));\n  const value = bytes / Math.pow(1024, i);\n  return `${value.toFixed(i > 0 ? 1 : 0)} ${units[i]}`;\n}\n\n/**\n * Format a number with comma separators.\n */\nexport function formatNumber(n: number): string {\n  return n.toLocaleString();\n}\n\n/**\n * Get a CSS color class name based on utilization percentage.\n */\nexport function getUtilizationColor(percent: number): string {\n  if (percent >= 90) return 'look-inside-utilization-critical';\n  if (percent >= 70) return 'look-inside-utilization-warning';\n  return 'look-inside-utilization-normal';\n}\n\n/**\n * Get a utilization label.\n */\nexport function getUtilizationLabel(percent: number): string {\n  if (percent >= 90) return 'Critical';\n  if (percent >= 70) return 'Warning';\n  return 'Normal';\n}\n\n/**\n * Truncate text with ellipsis.\n */\nexport function truncateText(text: string, maxLength: number): string {\n  if (text.length <= maxLength) return text;\n  return text.substring(0, maxLength - 3) + '...';\n}\n\n/**\n * Format a plugin name to display name.\n * e.g., 'working_memory' → 'Working Memory'\n */\nexport function formatPluginName(name: string): string {\n  return name\n    .split('_')\n    .map((word) => word.charAt(0).toUpperCase() + word.slice(1))\n    .join(' ');\n}\n\n/**\n * Format a timestamp to a relative or absolute string.\n */\nexport function formatTimestamp(ts: number): string {\n  const now = Date.now();\n  const diff = now - ts;\n\n  if (diff < 60000) return 'just now';\n  if (diff < 3600000) return `${Math.floor(diff / 60000)}m ago`;\n  if (diff < 86400000) return `${Math.floor(diff / 3600000)}h ago`;\n\n  return new Date(ts).toLocaleDateString();\n}\n","/**\n * ContextWindowSection — Progress bar + token stats.\n */\n\nimport React from 'react';\nimport type { ContextBudget } from '@everworker/oneringai';\nimport { formatNumber, getUtilizationColor, getUtilizationLabel } from '../utils';\n\ninterface ContextWindowSectionProps {\n  budget: ContextBudget;\n  messagesCount: number;\n  toolCallsCount: number;\n  strategy: string;\n}\n\nexport const ContextWindowSection: React.FC<ContextWindowSectionProps> = ({\n  budget,\n  messagesCount,\n  toolCallsCount,\n  strategy,\n}) => {\n  const colorClass = getUtilizationColor(budget.utilizationPercent);\n  const label = getUtilizationLabel(budget.utilizationPercent);\n  const pct = Math.min(budget.utilizationPercent, 100);\n\n  return (\n    <div className=\"look-inside-context-window\">\n      <div className=\"look-inside-progress-bar-container\">\n        <div\n          className={`look-inside-progress-bar ${colorClass}`}\n          style={{ width: `${pct}%` }}\n          role=\"progressbar\"\n          aria-valuenow={pct}\n          aria-valuemin={0}\n          aria-valuemax={100}\n        />\n      </div>\n      <div className=\"look-inside-context-stats\">\n        <span className={`look-inside-utilization-label ${colorClass}`}>\n          {pct.toFixed(1)}% — {label}\n        </span>\n        <span className=\"look-inside-context-stat\">\n          {formatNumber(budget.totalUsed)} / {formatNumber(budget.maxTokens)} tokens\n        </span>\n      </div>\n      <div className=\"look-inside-context-details\">\n        <div className=\"look-inside-stat-row\">\n          <span className=\"look-inside-stat-label\">Available</span>\n          <span className=\"look-inside-stat-value\">{formatNumber(budget.available)} tokens</span>\n        </div>\n        <div className=\"look-inside-stat-row\">\n          <span className=\"look-inside-stat-label\">Response Reserve</span>\n          <span className=\"look-inside-stat-value\">{formatNumber(budget.responseReserve)} tokens</span>\n        </div>\n        <div className=\"look-inside-stat-row\">\n          <span className=\"look-inside-stat-label\">Messages</span>\n          <span className=\"look-inside-stat-value\">{messagesCount}</span>\n        </div>\n        <div className=\"look-inside-stat-row\">\n          <span className=\"look-inside-stat-label\">Tool Calls</span>\n          <span className=\"look-inside-stat-value\">{toolCallsCount}</span>\n        </div>\n        <div className=\"look-inside-stat-row\">\n          <span className=\"look-inside-stat-label\">Strategy</span>\n          <span className=\"look-inside-stat-value\">{strategy}</span>\n        </div>\n      </div>\n    </div>\n  );\n};\n","/**\n * TokenBreakdownSection — Bar chart from budget.breakdown.\n */\n\nimport React from 'react';\nimport type { ContextBudget } from '@everworker/oneringai';\nimport { formatNumber } from '../utils';\n\ninterface TokenBreakdownSectionProps {\n  budget: ContextBudget;\n}\n\ninterface BreakdownItem {\n  name: string;\n  tokens: number;\n  percent: number;\n}\n\nexport const TokenBreakdownSection: React.FC<TokenBreakdownSectionProps> = ({\n  budget,\n}) => {\n  const { breakdown } = budget;\n  const total = budget.totalUsed || 1; // avoid divide by zero\n\n  const items: BreakdownItem[] = [\n    { name: 'System Prompt', tokens: breakdown.systemPrompt, percent: (breakdown.systemPrompt / total) * 100 },\n    { name: 'Persistent Instructions', tokens: breakdown.persistentInstructions, percent: (breakdown.persistentInstructions / total) * 100 },\n    { name: 'Plugin Instructions', tokens: breakdown.pluginInstructions, percent: (breakdown.pluginInstructions / total) * 100 },\n    ...Object.entries(breakdown.pluginContents).map(([name, tokens]) => ({\n      name: `Plugin: ${formatPluginLabel(name)}`,\n      tokens,\n      percent: (tokens / total) * 100,\n    })),\n    { name: 'Tools', tokens: breakdown.tools, percent: (breakdown.tools / total) * 100 },\n    { name: 'Conversation', tokens: breakdown.conversation, percent: (breakdown.conversation / total) * 100 },\n    { name: 'Current Input', tokens: breakdown.currentInput, percent: (breakdown.currentInput / total) * 100 },\n  ].filter((item) => item.tokens > 0);\n\n  return (\n    <div className=\"look-inside-token-breakdown\">\n      {items.map((item) => (\n        <div key={item.name} className=\"look-inside-breakdown-row\">\n          <div className=\"look-inside-breakdown-label\">\n            <span className=\"look-inside-breakdown-name\">{item.name}</span>\n            <span className=\"look-inside-breakdown-tokens\">\n              {formatNumber(item.tokens)} ({item.percent.toFixed(1)}%)\n            </span>\n          </div>\n          <div className=\"look-inside-breakdown-bar-container\">\n            <div\n              className=\"look-inside-breakdown-bar\"\n              style={{ width: `${Math.max(item.percent, 0.5)}%` }}\n            />\n          </div>\n        </div>\n      ))}\n    </div>\n  );\n};\n\nfunction formatPluginLabel(name: string): string {\n  return name\n    .split('_')\n    .map((w) => w.charAt(0).toUpperCase() + w.slice(1))\n    .join(' ');\n}\n","/**\n * SystemPromptSection — Code block display for system prompt.\n */\n\nimport React from 'react';\n\ninterface SystemPromptSectionProps {\n  content: string | null;\n}\n\nexport const SystemPromptSection: React.FC<SystemPromptSectionProps> = ({\n  content,\n}) => {\n  if (!content) {\n    return (\n      <div className=\"look-inside-system-prompt\">\n        <span className=\"look-inside-muted\">No system prompt configured</span>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"look-inside-system-prompt\">\n      <pre className=\"look-inside-code-block\">\n        <code>{content}</code>\n      </pre>\n    </div>\n  );\n};\n","/**\n * ToolsSection — Tool list with enabled/disabled badges and call counts.\n */\n\nimport React, { useState, useMemo } from 'react';\nimport type { IToolSnapshot } from '../types';\nimport { truncateText } from '../utils';\n\ninterface ToolsSectionProps {\n  tools: IToolSnapshot[];\n}\n\nexport const ToolsSection: React.FC<ToolsSectionProps> = ({ tools }) => {\n  const [filter, setFilter] = useState('');\n\n  const filtered = useMemo(() => {\n    if (!filter) return tools;\n    const lower = filter.toLowerCase();\n    return tools.filter(\n      (t) =>\n        t.name.toLowerCase().includes(lower) ||\n        t.description.toLowerCase().includes(lower) ||\n        (t.namespace && t.namespace.toLowerCase().includes(lower))\n    );\n  }, [tools, filter]);\n\n  const enabledCount = tools.filter((t) => t.enabled).length;\n\n  return (\n    <div className=\"look-inside-tools\">\n      <div className=\"look-inside-tools-header\">\n        <span className=\"look-inside-tools-count\">\n          {enabledCount} / {tools.length} enabled\n        </span>\n        {tools.length > 5 && (\n          <input\n            type=\"text\"\n            className=\"look-inside-tools-filter\"\n            placeholder=\"Filter tools...\"\n            value={filter}\n            onChange={(e) => setFilter(e.target.value)}\n          />\n        )}\n      </div>\n      <div className=\"look-inside-tools-list\">\n        {filtered.map((tool) => (\n          <div\n            key={tool.name}\n            className={`look-inside-tool-item ${!tool.enabled ? 'look-inside-tool-disabled' : ''}`}\n          >\n            <div className=\"look-inside-tool-name\">\n              <span className={`look-inside-tool-badge ${tool.enabled ? 'look-inside-badge-on' : 'look-inside-badge-off'}`}>\n                {tool.enabled ? 'ON' : 'OFF'}\n              </span>\n              <code>{tool.name}</code>\n              {tool.namespace && (\n                <span className=\"look-inside-tool-namespace\">{tool.namespace}</span>\n              )}\n            </div>\n            <div className=\"look-inside-tool-meta\">\n              <span className=\"look-inside-tool-desc\">\n                {truncateText(tool.description, 120)}\n              </span>\n              {tool.callCount > 0 && (\n                <span className=\"look-inside-tool-calls\">\n                  {tool.callCount} call{tool.callCount !== 1 ? 's' : ''}\n                </span>\n              )}\n            </div>\n          </div>\n        ))}\n        {filtered.length === 0 && (\n          <div className=\"look-inside-muted\">\n            {filter ? 'No tools match filter' : 'No tools registered'}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n","/**\n * GenericPluginSection — Fallback renderer for plugins without a custom renderer.\n * Shows formatted content (if available) or raw JSON contents.\n */\n\nimport React from 'react';\nimport type { PluginRendererProps } from '../types';\nimport { formatNumber } from '../utils';\n\nexport const GenericPluginSection: React.FC<PluginRendererProps> = ({\n  plugin,\n}) => {\n  return (\n    <div className=\"look-inside-generic-plugin\">\n      <div className=\"look-inside-plugin-meta\">\n        <span className=\"look-inside-stat-label\">Tokens</span>\n        <span className=\"look-inside-stat-value\">{formatNumber(plugin.tokenSize)}</span>\n        {plugin.compactable && (\n          <span className=\"look-inside-badge-compactable\">compactable</span>\n        )}\n      </div>\n      {plugin.formattedContent ? (\n        <pre className=\"look-inside-code-block\">\n          <code>{plugin.formattedContent}</code>\n        </pre>\n      ) : plugin.contents != null ? (\n        <pre className=\"look-inside-code-block\">\n          <code>{JSON.stringify(plugin.contents, null, 2)}</code>\n        </pre>\n      ) : (\n        <div className=\"look-inside-muted\">No content</div>\n      )}\n    </div>\n  );\n};\n","/**\n * WorkingMemoryRenderer — Displays working memory entries with key, scope, priority.\n * Supports optional click-to-expand for lazy value loading (e.g., via IPC in Hosea).\n */\n\nimport React from 'react';\nimport type { PluginRendererProps } from '../types';\nimport { formatBytes, formatTimestamp } from '../utils';\n\ninterface WorkingMemoryEntry {\n  key: string;\n  description: string;\n  scope: unknown;\n  basePriority?: string;\n  sizeBytes?: number;\n  tier?: string;\n  updatedAt?: number;\n}\n\ninterface WorkingMemoryContents {\n  entries: WorkingMemoryEntry[];\n}\n\nexport const WorkingMemoryRenderer: React.FC<PluginRendererProps> = ({\n  plugin,\n  onEntryClick,\n  entryValues,\n  loadingEntryKey,\n}) => {\n  // Handle both formats: array directly (from getAll()) or wrapped { entries }\n  const raw = plugin.contents;\n  const entries: WorkingMemoryEntry[] = Array.isArray(raw)\n    ? raw\n    : (raw as WorkingMemoryContents | null)?.entries ?? [];\n\n  if (entries.length === 0) {\n    return <div className=\"look-inside-muted\">No entries in working memory</div>;\n  }\n\n  const isClickable = !!onEntryClick;\n\n  return (\n    <div className=\"look-inside-working-memory\">\n      <div className=\"look-inside-entry-count\">\n        {entries.length} entr{entries.length === 1 ? 'y' : 'ies'}\n      </div>\n      <div className=\"look-inside-entry-list\">\n        {entries.map((entry) => {\n          const scope = typeof entry.scope === 'object'\n            ? JSON.stringify(entry.scope)\n            : String(entry.scope ?? 'session');\n\n          const isLoading = loadingEntryKey === entry.key;\n          const hasValue = entryValues?.has(entry.key) ?? false;\n          const isExpanded = hasValue || isLoading;\n\n          return (\n            <div\n              key={entry.key}\n              className={`look-inside-entry-item ${isClickable ? 'look-inside-entry-clickable' : ''} ${isExpanded ? 'look-inside-entry-expanded' : ''}`}\n              onClick={isClickable ? () => onEntryClick(entry.key) : undefined}\n              role={isClickable ? 'button' : undefined}\n              tabIndex={isClickable ? 0 : undefined}\n            >\n              <div className=\"look-inside-entry-header\">\n                <code className=\"look-inside-entry-key\">{entry.key}</code>\n                <span className={`look-inside-priority look-inside-priority-${entry.basePriority ?? 'normal'}`}>\n                  {entry.basePriority ?? 'normal'}\n                </span>\n              </div>\n              <div className=\"look-inside-entry-desc\">{entry.description}</div>\n              <div className=\"look-inside-entry-meta\">\n                <span>Scope: {scope}</span>\n                {entry.tier && <span>Tier: {entry.tier}</span>}\n                {entry.sizeBytes != null && (\n                  <span>Size: {formatBytes(entry.sizeBytes)}</span>\n                )}\n                {entry.updatedAt && (\n                  <span>{formatTimestamp(entry.updatedAt)}</span>\n                )}\n              </div>\n              {/* Expanded value (lazy-loaded) */}\n              {isLoading && (\n                <div className=\"look-inside-entry-loading\">Loading value...</div>\n              )}\n              {hasValue && !isLoading && (\n                <pre className=\"look-inside-code-block-sm\">\n                  {JSON.stringify(entryValues!.get(entry.key), null, 2)}\n                </pre>\n              )}\n            </div>\n          );\n        })}\n      </div>\n    </div>\n  );\n};\n","/**\n * InContextMemoryRenderer — Displays in-context memory entries with priority badges.\n */\n\nimport React from 'react';\nimport type { PluginRendererProps } from '../types';\nimport { formatTimestamp } from '../utils';\n\ninterface InContextEntry {\n  key: string;\n  description: string;\n  priority: string;\n  updatedAt: number;\n  value: unknown;\n}\n\nexport const InContextMemoryRenderer: React.FC<PluginRendererProps> = ({\n  plugin,\n}) => {\n  const entries = (plugin.contents as InContextEntry[] | null) ?? [];\n\n  if (entries.length === 0) {\n    return <div className=\"look-inside-muted\">No entries in context memory</div>;\n  }\n\n  return (\n    <div className=\"look-inside-in-context-memory\">\n      <div className=\"look-inside-entry-count\">\n        {entries.length} entr{entries.length === 1 ? 'y' : 'ies'}\n      </div>\n      <div className=\"look-inside-entry-list\">\n        {entries.map((entry) => (\n          <div key={entry.key} className=\"look-inside-entry-item\">\n            <div className=\"look-inside-entry-header\">\n              <code className=\"look-inside-entry-key\">{entry.key}</code>\n              <span className={`look-inside-priority look-inside-priority-${entry.priority}`}>\n                {entry.priority}\n              </span>\n            </div>\n            <div className=\"look-inside-entry-desc\">{entry.description}</div>\n            <div className=\"look-inside-entry-value\">\n              <pre className=\"look-inside-code-block-sm\">\n                <code>\n                  {typeof entry.value === 'string'\n                    ? entry.value\n                    : JSON.stringify(entry.value, null, 2)}\n                </code>\n              </pre>\n            </div>\n            <div className=\"look-inside-entry-meta\">\n              <span>{formatTimestamp(entry.updatedAt)}</span>\n            </div>\n          </div>\n        ))}\n      </div>\n    </div>\n  );\n};\n","/**\n * PersistentInstructionsRenderer — Displays persistent instruction entries.\n */\n\nimport React from 'react';\nimport type { PluginRendererProps } from '../types';\nimport { formatTimestamp } from '../utils';\n\ninterface InstructionEntry {\n  id: string;\n  content: string;\n  createdAt: number;\n  updatedAt: number;\n}\n\nexport const PersistentInstructionsRenderer: React.FC<PluginRendererProps> = ({\n  plugin,\n}) => {\n  const entries = (plugin.contents as InstructionEntry[] | null) ?? [];\n\n  if (entries.length === 0) {\n    return <div className=\"look-inside-muted\">No persistent instructions</div>;\n  }\n\n  return (\n    <div className=\"look-inside-persistent-instructions\">\n      <div className=\"look-inside-entry-count\">\n        {entries.length} instruction{entries.length !== 1 ? 's' : ''}\n      </div>\n      <div className=\"look-inside-entry-list\">\n        {entries.map((entry) => (\n          <div key={entry.id} className=\"look-inside-entry-item\">\n            <div className=\"look-inside-entry-header\">\n              <code className=\"look-inside-entry-key\">{entry.id}</code>\n              <span className=\"look-inside-entry-meta-inline\">\n                {formatTimestamp(entry.updatedAt)}\n              </span>\n            </div>\n            <pre className=\"look-inside-code-block-sm\">\n              <code>{entry.content}</code>\n            </pre>\n          </div>\n        ))}\n      </div>\n    </div>\n  );\n};\n","/**\n * UserInfoRenderer — Displays user info entries.\n */\n\nimport React from 'react';\nimport type { PluginRendererProps } from '../types';\nimport { formatTimestamp } from '../utils';\n\ninterface UserInfoEntry {\n  key: string;\n  value: unknown;\n  valueType: string;\n  description?: string;\n  updatedAt: number;\n}\n\nexport const UserInfoRenderer: React.FC<PluginRendererProps> = ({\n  plugin,\n}) => {\n  const entries = (plugin.contents as UserInfoEntry[] | null) ?? [];\n\n  if (entries.length === 0) {\n    return <div className=\"look-inside-muted\">No user info stored</div>;\n  }\n\n  return (\n    <div className=\"look-inside-user-info\">\n      <div className=\"look-inside-entry-count\">\n        {entries.length} entr{entries.length === 1 ? 'y' : 'ies'}\n      </div>\n      <div className=\"look-inside-entry-list\">\n        {entries.map((entry) => (\n          <div key={entry.key} className=\"look-inside-entry-item\">\n            <div className=\"look-inside-entry-header\">\n              <code className=\"look-inside-entry-key\">{entry.key}</code>\n              <span className=\"look-inside-entry-type\">{entry.valueType}</span>\n            </div>\n            {entry.description && (\n              <div className=\"look-inside-entry-desc\">{entry.description}</div>\n            )}\n            <div className=\"look-inside-entry-value\">\n              <pre className=\"look-inside-code-block-sm\">\n                <code>\n                  {typeof entry.value === 'string'\n                    ? entry.value\n                    : JSON.stringify(entry.value, null, 2)}\n                </code>\n              </pre>\n            </div>\n            <div className=\"look-inside-entry-meta\">\n              <span>{formatTimestamp(entry.updatedAt)}</span>\n            </div>\n          </div>\n        ))}\n      </div>\n    </div>\n  );\n};\n","/**\n * Plugin Renderer Registry — Maps plugin names to custom renderer components.\n *\n * Built-in renderers are registered by default. Apps can register\n * additional renderers for custom plugins.\n */\n\nimport type { PluginRenderer } from '../types';\nimport { WorkingMemoryRenderer } from './WorkingMemoryRenderer';\nimport { InContextMemoryRenderer } from './InContextMemoryRenderer';\nimport { PersistentInstructionsRenderer } from './PersistentInstructionsRenderer';\nimport { UserInfoRenderer } from './UserInfoRenderer';\n\nconst renderers = new Map<string, PluginRenderer>();\n\n// Register built-in renderers\nrenderers.set('working_memory', WorkingMemoryRenderer);\nrenderers.set('in_context_memory', InContextMemoryRenderer);\nrenderers.set('persistent_instructions', PersistentInstructionsRenderer);\nrenderers.set('user_info', UserInfoRenderer);\n\n/**\n * Register a custom plugin renderer.\n */\nexport function registerPluginRenderer(name: string, renderer: PluginRenderer): void {\n  renderers.set(name, renderer);\n}\n\n/**\n * Get the renderer for a plugin (or null for fallback to GenericPluginSection).\n */\nexport function getPluginRenderer(name: string): PluginRenderer | null {\n  return renderers.get(name) ?? null;\n}\n\n/**\n * Get all registered renderer names.\n */\nexport function getRegisteredPluginNames(): string[] {\n  return Array.from(renderers.keys());\n}\n","/**\n * ViewContextContent — \"View Full Context\" content (no modal wrapper).\n *\n * Renders the prepared context breakdown with named components,\n * token estimates, and a \"Copy All\" button. Apps provide their own modal.\n */\n\nimport React from 'react';\nimport type { ViewContextContentProps, IViewContextComponent } from './types';\nimport { formatNumber } from './utils';\n\nexport const ViewContextContent: React.FC<ViewContextContentProps> = ({\n  data,\n  loading = false,\n  error = null,\n  onCopyAll,\n  className,\n}) => {\n  if (loading) {\n    return (\n      <div className={`look-inside-view-context look-inside-loading ${className ?? ''}`}>\n        <div className=\"look-inside-spinner\">Preparing context...</div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className={`look-inside-view-context look-inside-error ${className ?? ''}`}>\n        <div className=\"look-inside-error-message\">{error}</div>\n      </div>\n    );\n  }\n\n  if (!data || !data.available) {\n    return (\n      <div className={`look-inside-view-context ${className ?? ''}`}>\n        <div className=\"look-inside-muted\">Context not available</div>\n      </div>\n    );\n  }\n\n  return (\n    <div className={`look-inside-view-context ${className ?? ''}`}>\n      <div className=\"look-inside-view-context-header\">\n        <span className=\"look-inside-view-context-total\">\n          Total: {formatNumber(data.totalTokens)} tokens\n          ({data.components.length} component{data.components.length !== 1 ? 's' : ''})\n        </span>\n        {onCopyAll && (\n          <button\n            type=\"button\"\n            className=\"look-inside-btn look-inside-btn-secondary\"\n            onClick={onCopyAll}\n          >\n            Copy All\n          </button>\n        )}\n      </div>\n      <div className=\"look-inside-view-context-components\">\n        {data.components.map((component: IViewContextComponent, index: number) => (\n          <div key={index} className=\"look-inside-view-context-component\">\n            <div className=\"look-inside-view-context-component-header\">\n              <span className=\"look-inside-view-context-component-name\">\n                {component.name}\n              </span>\n              <span className=\"look-inside-view-context-component-tokens\">\n                ~{formatNumber(component.tokenEstimate)} tokens\n              </span>\n            </div>\n            <pre className=\"look-inside-code-block\">\n              <code>{component.content}</code>\n            </pre>\n          </div>\n        ))}\n      </div>\n    </div>\n  );\n};\n","/**\n * Rich Markdown Renderer with support for:\n * - GitHub Flavored Markdown (tables, strikethrough, autolinks)\n * - Syntax-highlighted code blocks with special renderers\n * - LaTeX math (inline and block) with robust preprocessing\n * - Mermaid diagrams, Markmap mindmaps, Vega/Vega-Lite charts\n *\n * Merged from Hosea (streaming context, audio/video detection, clean structure)\n * and v25 (advanced math preprocessing, box-drawing table conversion, pipe escaping).\n */\n\nimport React, { useMemo, memo, createContext, useContext } from 'react';\nimport ReactMarkdown from 'react-markdown';\nimport remarkGfm from 'remark-gfm';\nimport remarkMath from 'remark-math';\nimport rehypeKatex from 'rehype-katex';\nimport type { Components } from 'react-markdown';\nimport type { MarkdownRendererProps } from './types';\n\nimport { CodeBlock } from './CodeBlock';\n\n// ---------------------------------------------------------------------------\n// Streaming context — allows nested CodeBlock to know if content is streaming\n// ---------------------------------------------------------------------------\n\ninterface MarkdownContextValue {\n  isStreaming: boolean;\n}\n\nconst MarkdownContext = createContext<MarkdownContextValue>({ isStreaming: false });\n\nexport const useMarkdownContext = () => useContext(MarkdownContext);\n\n// ---------------------------------------------------------------------------\n// Math preprocessing utilities (from v25 — more robust than Hosea's)\n// ---------------------------------------------------------------------------\n\n/**\n * Find the matching closing brace for an opening brace, handling nested braces.\n * Ignores escaped braces.\n */\nfunction findMatchingBrace(text: string, startIndex: number): number {\n  let depth = 0;\n  for (let i = startIndex; i < text.length; i++) {\n    if (i > 0 && text[i - 1] === '\\\\') {\n      let backslashCount = 0;\n      let j = i - 1;\n      while (j >= 0 && text[j] === '\\\\') { backslashCount++; j--; }\n      if (backslashCount % 2 === 1) continue;\n    }\n    if (text[i] === '{') depth++;\n    else if (text[i] === '}') { depth--; if (depth === 0) return i; }\n  }\n  return -1;\n}\n\n/**\n * Escape dollar signs inside text commands (like \\text{}, \\mathrm{}, etc.)\n * by converting $...$ to \\(...\\) to avoid nested dollar sign parsing issues.\n */\nfunction escapeDollarsInTextCommands(mathContent: string): string {\n  const textCommands = ['text', 'mathrm', 'mbox', 'textrm', 'textsf', 'texttt', 'textnormal', 'textsc'];\n  let result = mathContent;\n\n  for (const cmd of textCommands) {\n    const cmdPattern = `\\\\${cmd}{`;\n    let searchPos = 0;\n\n    while (true) {\n      const cmdStart = result.indexOf(cmdPattern, searchPos);\n      if (cmdStart === -1) break;\n\n      const braceStart = cmdStart + cmdPattern.length;\n      const braceEnd = findMatchingBrace(result, braceStart - 1);\n      if (braceEnd === -1) { searchPos = braceStart; continue; }\n\n      const textContent = result.substring(braceStart, braceEnd);\n      let escapedContent = '';\n      let i = 0;\n      while (i < textContent.length) {\n        if (textContent[i] === '$') {\n          if (i < textContent.length - 1 && textContent[i + 1] === '$') {\n            escapedContent += '$$';\n            i += 2;\n            continue;\n          }\n          const dollarStart = i;\n          i++;\n          const closingDollar = textContent.indexOf('$', i);\n          if (closingDollar !== -1 && (closingDollar === textContent.length - 1 || textContent[closingDollar + 1] !== '$')) {\n            const mathExpr = textContent.substring(dollarStart + 1, closingDollar);\n            escapedContent += `\\\\(${mathExpr}\\\\)`;\n            i = closingDollar + 1;\n          } else {\n            escapedContent += '$';\n            i++;\n          }\n        } else {\n          escapedContent += textContent[i];\n          i++;\n        }\n      }\n\n      if (escapedContent !== textContent) {\n        result = result.substring(0, braceStart) + escapedContent + result.substring(braceEnd);\n        searchPos = braceStart + escapedContent.length;\n      } else {\n        searchPos = braceEnd + 1;\n      }\n    }\n  }\n  return result;\n}\n\n/**\n * Detect ASCII box-drawing tables and convert them to GFM markdown pipe tables.\n */\nfunction convertBoxDrawingTables(text: string): string {\n  const lines = text.split('\\n');\n  const result: string[] = [];\n  const BOX_BORDER_CHARS = /[┌┐└┘├┤┬┴┼─╔╗╚╝╠╣╦╩╬═]/;\n  const BOX_DATA_CHAR = /[│║]/;\n  const isBoxLine = (line: string) => BOX_DATA_CHAR.test(line) || BOX_BORDER_CHARS.test(line);\n  const isBorderLine = (line: string) => {\n    const trimmed = line.trim();\n    return BOX_BORDER_CHARS.test(trimmed) && !BOX_DATA_CHAR.test(trimmed) && /^[┌┐└┘├┤┬┴┼─╔╗╚╝╠╣╦╩╬═\\s]+$/.test(trimmed);\n  };\n  const isDataLine = (line: string) => BOX_DATA_CHAR.test(line);\n  const extractCells = (line: string): string[] => {\n    const parts = line.split(/[│║]/);\n    return parts.length >= 3 ? parts.slice(1, -1).map((c) => c.trim()) : parts.map((c) => c.trim());\n  };\n\n  const convertBlock = (blockLines: string[]): string[] => {\n    const mergedRows: string[][] = [];\n    let currentGroup: string[][] = [];\n\n    const flushGroup = () => {\n      if (currentGroup.length === 0) return;\n      const colCount = currentGroup[0].length;\n      const merged: string[] = Array(colCount).fill('');\n      for (const cellRow of currentGroup) {\n        for (let c = 0; c < colCount && c < cellRow.length; c++) {\n          if (cellRow[c]) merged[c] = merged[c] ? `${merged[c]} ${cellRow[c]}` : cellRow[c];\n        }\n      }\n      mergedRows.push(merged);\n      currentGroup = [];\n    };\n\n    for (const line of blockLines) {\n      if (isBorderLine(line)) { flushGroup(); continue; }\n      if (isDataLine(line)) currentGroup.push(extractCells(line));\n    }\n    flushGroup();\n    if (mergedRows.length === 0) return blockLines;\n\n    const colCount = mergedRows[0].length;\n    const gfmLines: string[] = [];\n    gfmLines.push(`| ${mergedRows[0].map((c) => c || ' ').join(' | ')} |`);\n    gfmLines.push(`|${Array(colCount).fill('---').join('|')}|`);\n    for (let i = 1; i < mergedRows.length; i++) {\n      const row = mergedRows[i].slice(0, colCount);\n      while (row.length < colCount) row.push('');\n      gfmLines.push(`| ${row.join(' | ')} |`);\n    }\n    return gfmLines;\n  };\n\n  let i = 0;\n  while (i < lines.length) {\n    if (isBoxLine(lines[i])) {\n      const blockStart = i;\n      while (i < lines.length && isBoxLine(lines[i])) i++;\n      result.push(...convertBlock(lines.slice(blockStart, i)));\n    } else {\n      result.push(lines[i]);\n      i++;\n    }\n  }\n  return result.join('\\n');\n}\n\n/**\n * Full markdown preprocessing pipeline.\n * Handles math notation normalization, box-drawing tables, verb commands, pipe escaping.\n */\nfunction preprocessMarkdown(content: string): string {\n  if (!content || typeof content !== 'string') return '';\n\n  let processed = content;\n\n  // Extract code blocks to prevent preprocessing from modifying their content\n  const codeBlocks: Array<{ placeholder: string; content: string }> = [];\n  let codeBlockIndex = 0;\n  processed = processed.replace(/```[\\w]*\\n?[\\s\\S]*?```/g, (match) => {\n    const placeholder = `__CODE_BLOCK_PLACEHOLDER_${codeBlockIndex}__`;\n    codeBlocks.push({ placeholder, content: match });\n    codeBlockIndex++;\n    return placeholder;\n  });\n\n  // Convert ASCII box-drawing tables to GFM markdown tables\n  processed = convertBoxDrawingTables(processed);\n\n  // Normalize line endings\n  processed = processed.replace(/\\r\\n/g, '\\n');\n\n  // Convert \\verb|...|\n  processed = processed.replace(/\\\\verb\\|([^\\r\\n|]*?)\\|/g, (_match, body) => {\n    const escaped = String(body).replace(/\\\\/g, '\\\\\\\\').replace(/`/g, '\\\\`').replace(/\\$/g, '\\\\$');\n    return `\\`${escaped}\\``;\n  });\n\n  // Normalize $$...$$ blocks — ensure proper spacing\n  processed = processed.replace(/\\$\\$([\\s\\S]*?)\\$\\$/g, (match, mathContent) => {\n    const lines = match.split('\\n');\n    if (lines.length >= 3 && lines[0].trim() === '$$' && lines[lines.length - 1].trim() === '$$') {\n      return match; // Already properly formatted\n    }\n    if (!mathContent || typeof mathContent !== 'string') return match;\n    try {\n      const normalized = mathContent.trim().replace(/[ \\t]+/g, ' ').replace(/\\n\\s*\\n\\s*\\n+/g, '\\n\\n');\n      return `\\n\\n$$\\n${normalized}\\n$$\\n\\n`;\n    } catch {\n      return match;\n    }\n  });\n\n  // Convert block math \\[...\\] to $$...$$\n  processed = processed.replace(/\\\\\\[([\\s\\S]*?)\\\\\\]/g, (_match, mathContent) => {\n    if (!mathContent || typeof mathContent !== 'string') return _match;\n    try {\n      const normalized = mathContent.trim().replace(/\\s+/g, ' ');\n      return `\\n\\n$$\\n${normalized}\\n$$\\n\\n`;\n    } catch {\n      return _match;\n    }\n  });\n\n  // Convert inline math \\(...\\) to $...$\n  let inlineMathIndex = 0;\n  const inlineMathGroups: Array<{ start: number; end: number; parts: string[] }> = [];\n\n  while (true) {\n    const openPos = processed.indexOf('\\\\(', inlineMathIndex);\n    if (openPos === -1) break;\n    const closePos = processed.indexOf('\\\\)', openPos + 2);\n    if (closePos === -1) break;\n\n    const mathContent = processed.substring(openPos + 2, closePos).trim();\n    let normalized = escapeDollarsInTextCommands(mathContent);\n    if (normalized) {\n      inlineMathGroups.push({ start: openPos, end: closePos + 2, parts: [normalized] });\n    }\n    inlineMathIndex = closePos + 2;\n  }\n\n  inlineMathGroups.reverse().forEach(({ start, end, parts }) => {\n    const combined = parts.join(' ');\n    processed = `${processed.substring(0, start)}$${combined}$${processed.substring(end)}`;\n  });\n\n  // Restore code blocks\n  codeBlocks.forEach(({ placeholder, content }) => {\n    processed = processed.replace(placeholder, () => content);\n  });\n\n  return processed;\n}\n\n// ---------------------------------------------------------------------------\n// Markdown component overrides\n// ---------------------------------------------------------------------------\n\n// Audio/video extensions for media link detection (from Hosea)\nconst AUDIO_EXTENSIONS = ['.mp3', '.wav', '.ogg', '.aac', '.flac', '.opus', '.pcm', '.webm'];\nconst VIDEO_EXTENSIONS = ['.mp4', '.webm', '.mov'];\n\nfunction hasExtension(url: string, extensions: string[]): boolean {\n  const lower = url.toLowerCase().split('?')[0]!;\n  return extensions.some((ext) => lower.endsWith(ext));\n}\n\n/** Code component that reads streaming state from context */\nfunction CodeComponent({ className, children }: { className?: string; children?: React.ReactNode }) {\n  const { isStreaming } = useMarkdownContext();\n  const match = /language-(\\w+)/.exec(className || '');\n  const language = match ? match[1] : '';\n  const code = String(children).replace(/\\n$/, '');\n  const isInline = !match && !code.includes('\\n');\n\n  if (isInline) {\n    return <code className=\"inline-code\">{children}</code>;\n  }\n  return <CodeBlock language={language} code={code} isStreaming={isStreaming} />;\n}\n\nconst markdownComponents: Components = {\n  code: CodeComponent,\n\n  table({ children }) {\n    return (\n      <div className=\"table-responsive\">\n        <table className=\"markdown-table\">{children}</table>\n      </div>\n    );\n  },\n\n  a({ href, children, ...props }) {\n    if (href && hasExtension(href, AUDIO_EXTENSIONS)) {\n      return <audio controls className=\"markdown-audio\"><source src={href} /></audio>;\n    }\n    if (href && hasExtension(href, VIDEO_EXTENSIONS)) {\n      return <video controls className=\"markdown-video\"><source src={href} /></video>;\n    }\n    return <a href={href} target=\"_blank\" rel=\"noopener noreferrer\" {...props}>{children}</a>;\n  },\n\n  img({ src, alt, ...props }) {\n    if (src && hasExtension(src, AUDIO_EXTENSIONS)) {\n      return <audio controls className=\"markdown-audio\"><source src={src} /></audio>;\n    }\n    if (src && hasExtension(src, VIDEO_EXTENSIONS)) {\n      return <video controls className=\"markdown-video\"><source src={src} /></video>;\n    }\n    return <img src={src} alt={alt || ''} className=\"markdown-image\" loading=\"lazy\" {...props} />;\n  },\n\n  blockquote({ children }) {\n    return <blockquote className=\"markdown-blockquote\">{children}</blockquote>;\n  },\n\n  hr() { return <hr className=\"markdown-hr\" />; },\n\n  ul({ children }) { return <ul className=\"markdown-list\">{children}</ul>; },\n  ol({ children }) { return <ol className=\"markdown-list markdown-list--ordered\">{children}</ol>; },\n\n  h1({ children }) { return <h1 className=\"markdown-heading markdown-h1\">{children}</h1>; },\n  h2({ children }) { return <h2 className=\"markdown-heading markdown-h2\">{children}</h2>; },\n  h3({ children }) { return <h3 className=\"markdown-heading markdown-h3\">{children}</h3>; },\n  h4({ children }) { return <h4 className=\"markdown-heading markdown-h4\">{children}</h4>; },\n  h5({ children }) { return <h5 className=\"markdown-heading markdown-h5\">{children}</h5>; },\n  h6({ children }) { return <h6 className=\"markdown-heading markdown-h6\">{children}</h6>; },\n\n  p({ children }) { return <p className=\"markdown-paragraph\">{children}</p>; },\n};\n\n// ---------------------------------------------------------------------------\n// KaTeX configuration\n// ---------------------------------------------------------------------------\n\nconst KATEX_MACROS = {\n  '\\\\arcsinh': '\\\\operatorname{arcsinh}',\n  '\\\\arccosh': '\\\\operatorname{arccosh}',\n  '\\\\arctanh': '\\\\operatorname{arctanh}',\n  '\\\\arccoth': '\\\\operatorname{arccoth}',\n  '\\\\arcsech': '\\\\operatorname{arcsech}',\n  '\\\\arccsch': '\\\\operatorname{arccsch}',\n  '\\\\sgn': '\\\\operatorname{sgn}',\n};\n\n// ---------------------------------------------------------------------------\n// Main component\n// ---------------------------------------------------------------------------\n\nexport const MarkdownRenderer = memo(function MarkdownRenderer({\n  content,\n  children,\n  className = '',\n  isStreaming = false,\n}: MarkdownRendererProps): React.ReactElement {\n  const rawContent = content ?? children ?? '';\n\n  const processedContent = useMemo(() => {\n    try {\n      return preprocessMarkdown(rawContent);\n    } catch (error) {\n      console.error('Error preprocessing markdown:', error);\n      return rawContent;\n    }\n  }, [rawContent]);\n\n  const contextValue = useMemo(() => ({ isStreaming }), [isStreaming]);\n\n  return (\n    <MarkdownContext.Provider value={contextValue}>\n      <div className={`markdown-content ${className}`}>\n        <ReactMarkdown\n          remarkPlugins={[remarkGfm, remarkMath]}\n          rehypePlugins={[\n            [rehypeKatex, {\n              throwOnError: false,\n              strict: false,\n              trust: true,\n              macros: KATEX_MACROS,\n            }],\n          ]}\n          components={markdownComponents}\n        >\n          {processedContent}\n        </ReactMarkdown>\n      </div>\n    </MarkdownContext.Provider>\n  );\n});\n\nexport default MarkdownRenderer;\n","/**\n * Code Block Component with syntax highlighting and special renderers.\n *\n * Supports: standard code, mermaid diagrams, vega/vega-lite charts, markmap mindmaps.\n * Special blocks (vega, mermaid, markmap) only render after streaming completes\n * to avoid parse errors from incomplete JSON/syntax.\n *\n * Based on Hosea's CodeBlock (streaming-aware, lazy-loaded special renderers)\n * with Hosea's copy button UX.\n */\n\nimport React, { useState, useCallback, Suspense, lazy, useEffect } from 'react';\nimport { Prism as SyntaxHighlighter } from 'react-syntax-highlighter';\nimport { oneDark } from 'react-syntax-highlighter/dist/esm/styles/prism';\nimport { Copy, Check, AlertCircle, Loader } from 'lucide-react';\nimport type { CodeBlockProps } from './types';\n\n// Lazy load heavy components\nconst MermaidDiagram = lazy(() => import('./MermaidDiagram'));\nconst VegaChart = lazy(() => import('./VegaChart'));\nconst MarkmapRenderer = lazy(() => import('./MarkmapRenderer'));\n\n// Loading fallback for lazy-loaded components\nconst LoadingFallback = () => (\n  <div className=\"code-block__loading\">\n    <div className=\"rui-spinner\" role=\"status\">\n      <span className=\"rui-visually-hidden\">Loading...</span>\n    </div>\n    <span>Rendering...</span>\n  </div>\n);\n\n// Streaming preview for special blocks\nconst StreamingPreview = ({ language, code }: { language: string; code: string }) => (\n  <div className=\"code-block__streaming-preview\">\n    <div className=\"code-block__streaming-header\">\n      <Loader size={14} className=\"code-block__streaming-spinner\" />\n      <span>Receiving {language} content...</span>\n    </div>\n    <pre className=\"code-block__streaming-code\">{code}</pre>\n  </div>\n);\n\n// Error fallback\nconst ErrorFallback = ({ error, code }: { error: string; code: string }) => (\n  <div className=\"code-block__error\">\n    <div className=\"code-block__error-header\">\n      <AlertCircle size={16} />\n      <span>Rendering Error</span>\n    </div>\n    <p className=\"code-block__error-message\">{error}</p>\n    <pre className=\"code-block__error-code\">{code}</pre>\n  </div>\n);\n\nconst isSpecialBlock = (lang: string): boolean => {\n  const specialLangs = ['mermaid', 'vega', 'vega-lite', 'markmap', 'mindmap'];\n  return specialLangs.includes(lang.toLowerCase());\n};\n\nexport function CodeBlock({ language, code, isStreaming = false }: CodeBlockProps): React.ReactElement {\n  const [copied, setCopied] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [shouldRender, setShouldRender] = useState(!isStreaming);\n\n  const normalizedLang = language.toLowerCase();\n  const isSpecial = isSpecialBlock(normalizedLang);\n\n  // Reset error and trigger render when streaming completes\n  useEffect(() => {\n    if (!isStreaming && isSpecial) {\n      setError(null);\n      setShouldRender(true);\n    } else if (isStreaming && isSpecial) {\n      setShouldRender(false);\n    }\n  }, [isStreaming, isSpecial, code]);\n\n  const handleCopy = useCallback(async () => {\n    try {\n      await navigator.clipboard.writeText(code);\n      setCopied(true);\n      setTimeout(() => setCopied(false), 2000);\n    } catch (err) {\n      console.error('Failed to copy:', err);\n    }\n  }, [code]);\n\n  const handleError = useCallback((err: Error) => {\n    setError(err.message);\n  }, []);\n\n  // Special renderers — show preview while streaming\n  if (normalizedLang === 'mermaid') {\n    return (\n      <div className=\"code-block code-block--mermaid\">\n        <div className=\"code-block__header\">\n          <span className=\"code-block__language\">mermaid</span>\n          <button className=\"code-block__copy\" onClick={handleCopy} title=\"Copy code\">\n            {copied ? <Check size={14} /> : <Copy size={14} />}\n          </button>\n        </div>\n        {isStreaming || !shouldRender ? (\n          <StreamingPreview language=\"mermaid\" code={code} />\n        ) : error ? (\n          <ErrorFallback error={error} code={code} />\n        ) : (\n          <Suspense fallback={<LoadingFallback />}>\n            <MermaidDiagram code={code} onError={handleError} />\n          </Suspense>\n        )}\n      </div>\n    );\n  }\n\n  if (normalizedLang === 'vega' || normalizedLang === 'vega-lite') {\n    return (\n      <div className={`code-block code-block--${normalizedLang}`}>\n        <div className=\"code-block__header\">\n          <span className=\"code-block__language\">{normalizedLang}</span>\n          <button className=\"code-block__copy\" onClick={handleCopy} title=\"Copy code\">\n            {copied ? <Check size={14} /> : <Copy size={14} />}\n          </button>\n        </div>\n        {isStreaming || !shouldRender ? (\n          <StreamingPreview language={normalizedLang} code={code} />\n        ) : error ? (\n          <ErrorFallback error={error} code={code} />\n        ) : (\n          <Suspense fallback={<LoadingFallback />}>\n            <VegaChart code={code} isLite={normalizedLang === 'vega-lite'} onError={handleError} />\n          </Suspense>\n        )}\n      </div>\n    );\n  }\n\n  if (normalizedLang === 'markmap' || normalizedLang === 'mindmap') {\n    return (\n      <div className=\"code-block code-block--markmap\">\n        <div className=\"code-block__header\">\n          <span className=\"code-block__language\">mindmap</span>\n          <button className=\"code-block__copy\" onClick={handleCopy} title=\"Copy code\">\n            {copied ? <Check size={14} /> : <Copy size={14} />}\n          </button>\n        </div>\n        {isStreaming || !shouldRender ? (\n          <StreamingPreview language=\"markmap\" code={code} />\n        ) : error ? (\n          <ErrorFallback error={error} code={code} />\n        ) : (\n          <Suspense fallback={<LoadingFallback />}>\n            <MarkmapRenderer code={code} onError={handleError} />\n          </Suspense>\n        )}\n      </div>\n    );\n  }\n\n  // Standard code block with syntax highlighting\n  return (\n    <div className=\"code-block\">\n      <div className=\"code-block__header\">\n        <span className=\"code-block__language\">{language || 'text'}</span>\n        <button className=\"code-block__copy\" onClick={handleCopy} title=\"Copy code\">\n          {copied ? <Check size={14} /> : <Copy size={14} />}\n        </button>\n      </div>\n      <SyntaxHighlighter\n        style={oneDark}\n        language={normalizedLang || 'text'}\n        PreTag=\"div\"\n        className=\"code-block__content\"\n        showLineNumbers={code.split('\\n').length > 5}\n        wrapLines\n        customStyle={{\n          margin: 0,\n          borderRadius: '0 0 8px 8px',\n          fontSize: '13px',\n        }}\n      >\n        {code}\n      </SyntaxHighlighter>\n    </div>\n  );\n}\n\nexport default CodeBlock;\n","/**\n * Markdown rendering components.\n *\n * Usage:\n *   import { MarkdownRenderer, CodeBlock } from '@everworker/react-ui';\n *   import '@everworker/react-ui/styles/markdown';\n */\n\nexport { MarkdownRenderer, useMarkdownContext } from './MarkdownRenderer';\nexport { CodeBlock } from './CodeBlock';\nexport { MermaidDiagram } from './MermaidDiagram';\nexport { VegaChart } from './VegaChart';\nexport { MarkmapRenderer } from './MarkmapRenderer';\nexport { RenderErrorBoundary } from './RenderErrorBoundary';\n\nexport type {\n  MarkdownRendererProps,\n  CodeBlockProps,\n  MermaidDiagramProps,\n  VegaChartProps,\n  MarkmapRendererProps,\n  RenderErrorBoundaryProps,\n} from './types';\n","/**\n * Error boundary for safe rendering of markdown special blocks.\n * Catches rendering errors from KaTeX, Mermaid, Vega, Markmap, etc.\n * and shows a friendly fallback instead of crashing the entire UI.\n */\n\nimport React, { Component, ErrorInfo, ReactNode } from 'react';\n\ninterface Props {\n  children: ReactNode;\n  fallbackMessage?: string;\n  rendererType?: string;\n}\n\ninterface State {\n  hasError: boolean;\n  error?: Error;\n}\n\nexport class RenderErrorBoundary extends Component<Props, State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = { hasError: false };\n  }\n\n  static getDerivedStateFromError(error: Error): State {\n    return { hasError: true, error };\n  }\n\n  componentDidCatch(error: Error, _errorInfo: ErrorInfo) {\n    if (!this.isBenignError(error)) {\n      console.warn(\n        `Renderer error (${this.props.rendererType || 'unknown'}):`,\n        error.message,\n      );\n    }\n  }\n\n  private isBenignError(error: Error): boolean {\n    const benignPatterns = [\n      /translate\\(NaN,NaN\\)/,\n      /Expected number/,\n      /katex/i,\n      /vega/i,\n      /mermaid/i,\n      /markmap/i,\n    ];\n    return benignPatterns.some((pattern) => pattern.test(error.message));\n  }\n\n  render() {\n    if (this.state.hasError) {\n      const rendererType = this.props.rendererType || 'content';\n      const fallbackMessage = this.props.fallbackMessage || `Error rendering ${rendererType}`;\n\n      return (\n        <div className=\"render-error-boundary\">\n          <small>\n            <strong>{fallbackMessage}</strong>\n            <div className=\"render-error-boundary__detail\">\n              The content may contain formatting issues that prevent proper rendering.\n            </div>\n          </small>\n        </div>\n      );\n    }\n\n    return this.props.children;\n  }\n}\n\nexport default RenderErrorBoundary;\n","/**\n * MessageList — Displays a list of chat messages with rich rendering.\n *\n * Features:\n * - Markdown rendering with math, diagrams, charts, code highlighting\n * - Streaming text support with animated cursor\n * - ThinkingBlock for thinking-capable models\n * - Tool call display\n * - Copy message content\n * - Auto-scroll to bottom\n *\n * Merged from v25 (standalone component) + Hosea (smart auto-scroll).\n */\n\nimport React, { memo, useRef, useEffect, useState, useCallback } from 'react';\nimport { Copy, Check } from 'lucide-react';\nimport { MarkdownRenderer } from '../markdown/MarkdownRenderer';\nimport { RenderErrorBoundary } from '../markdown/RenderErrorBoundary';\nimport { StreamingText } from './StreamingText';\nimport { ThinkingBlock } from './ThinkingBlock';\nimport { ToolCallCard } from './ToolCallCard';\nimport type { IChatMessage, IMessageListProps } from './types';\n\n/**\n * Individual message component with hover controls\n */\nconst MessageWithControls: React.FC<{\n  message: IChatMessage;\n  index: number;\n  onCopyMessage?: (content: string) => void;\n}> = memo(({ message, index, onCopyMessage }) => {\n  const [isHovered, setIsHovered] = useState(false);\n  const [copied, setCopied] = useState(false);\n\n  const isUser = message.role === 'user';\n  const isSystem = message.role === 'system';\n  const isAssistant = message.role === 'assistant';\n\n  const handleCopy = useCallback(async () => {\n    try {\n      await navigator.clipboard.writeText(message.content);\n      setCopied(true);\n      setTimeout(() => setCopied(false), 2000);\n      onCopyMessage?.(message.content);\n    } catch (err) {\n      console.error('Failed to copy message:', err);\n    }\n  }, [message.content, onCopyMessage]);\n\n  if (isUser) {\n    return (\n      <div className=\"rui-message rui-message--user\">\n        <div className=\"rui-message__bubble\">{message.content}</div>\n      </div>\n    );\n  }\n\n  if (isSystem) {\n    return (\n      <div className=\"rui-message rui-message--system\">\n        <div className=\"rui-message__content\">\n          <small className=\"rui-message__system-text\">{message.content}</small>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div\n      className=\"rui-message rui-message--assistant\"\n      onMouseEnter={() => setIsHovered(true)}\n      onMouseLeave={() => setIsHovered(false)}\n    >\n      {/* Thinking block */}\n      {message.thinking && (\n        <ThinkingBlock\n          content={message.thinking}\n          isStreaming={message.isStreaming}\n        />\n      )}\n\n      {/* Tool calls */}\n      {message.toolCalls && message.toolCalls.length > 0 && (\n        <div className=\"rui-message__tool-calls\">\n          {message.toolCalls.map((tc) => (\n            <ToolCallCard key={tc.id} tool={tc} />\n          ))}\n        </div>\n      )}\n\n      {/* Error */}\n      {message.error && (\n        <div className=\"rui-message__error\">{message.error}</div>\n      )}\n\n      {/* Content */}\n      {message.content && (\n        <div className=\"rui-message__content\">\n          <RenderErrorBoundary\n            rendererType=\"markdown message\"\n            fallbackMessage=\"Error rendering message content\"\n          >\n            <MarkdownRenderer content={message.content} isStreaming={message.isStreaming} />\n          </RenderErrorBoundary>\n        </div>\n      )}\n\n      {/* Timestamp */}\n      {message.timestamp && (\n        <div className=\"rui-message__time\">\n          {new Date(message.timestamp).toLocaleTimeString()}\n        </div>\n      )}\n\n      {/* Hover controls */}\n      {isAssistant && isHovered && message.content && (\n        <div className=\"rui-message__controls\">\n          <button\n            className=\"rui-message__control-btn\"\n            onClick={handleCopy}\n            title=\"Copy markdown content\"\n          >\n            {copied ? <Check size={12} /> : <Copy size={12} />}\n          </button>\n        </div>\n      )}\n    </div>\n  );\n});\n\nMessageWithControls.displayName = 'MessageWithControls';\n\n/**\n * Main message list component.\n */\nexport const MessageList: React.FC<IMessageListProps> = memo(\n  ({\n    messages,\n    streamingText = '',\n    streamingThinking = '',\n    isStreaming = false,\n    autoScroll = true,\n    hideThinking = false,\n    className = '',\n    renderMessage,\n    onCopyMessage,\n  }) => {\n    const endRef = useRef<HTMLDivElement>(null);\n    const containerRef = useRef<HTMLDivElement>(null);\n\n    // Smart auto-scroll: only scroll when user is near the bottom\n    useEffect(() => {\n      if (!autoScroll || !containerRef.current) return;\n\n      const container = containerRef.current;\n      const isNearBottom = container.scrollHeight - container.scrollTop - container.clientHeight < 100;\n\n      if (isNearBottom && endRef.current) {\n        endRef.current.scrollIntoView({ behavior: 'smooth' });\n      }\n    }, [messages, streamingText, streamingThinking, autoScroll]);\n\n    return (\n      <div className={`rui-message-list ${className}`} ref={containerRef}>\n        {/* Existing messages */}\n        {messages.map((message, index) =>\n          renderMessage\n            ? renderMessage(message, index)\n            : (\n              <MessageWithControls\n                key={message.id || index}\n                message={message}\n                index={index}\n                onCopyMessage={onCopyMessage}\n              />\n            ),\n        )}\n\n        {/* Streaming thinking block */}\n        {streamingThinking && !hideThinking && (\n          <ThinkingBlock content={streamingThinking} isStreaming={isStreaming} />\n        )}\n\n        {/* Streaming response */}\n        {(streamingText || (isStreaming && !hideThinking && !streamingThinking)) && (\n          <div className=\"rui-message rui-message--assistant\">\n            <div className=\"rui-message__content\">\n              {streamingText ? (\n                <StreamingText\n                  text={streamingText}\n                  isStreaming={isStreaming}\n                  renderMarkdown\n                />\n              ) : (\n                isStreaming && (\n                  <span className=\"rui-message__thinking-dots\">Thinking</span>\n                )\n              )}\n            </div>\n          </div>\n        )}\n\n        {/* Scroll anchor */}\n        <div ref={endRef} />\n      </div>\n    );\n  },\n);\n\nMessageList.displayName = 'MessageList';\n\nexport default MessageList;\n","/**\n * StreamingText — Renders streaming text with a typing indicator.\n *\n * Displays text that accumulates in real-time during streaming,\n * with an animated cursor to indicate active streaming.\n */\n\nimport React, { memo } from 'react';\nimport { MarkdownRenderer } from '../markdown/MarkdownRenderer';\nimport type { IStreamingTextProps } from './types';\n\nexport const StreamingText: React.FC<IStreamingTextProps> = memo(\n  ({ text, isStreaming = false, renderMarkdown = true, className = '', showCursor = true }) => {\n    if (!text && !isStreaming) {\n      return null;\n    }\n\n    const cursorElement = isStreaming && showCursor && (\n      <span className=\"streaming-cursor\" aria-hidden=\"true\">|</span>\n    );\n\n    return (\n      <div className={`streaming-text ${className}`}>\n        {renderMarkdown ? (\n          <div className=\"streaming-text__markdown\">\n            <MarkdownRenderer content={text} isStreaming={isStreaming} />\n            {cursorElement}\n          </div>\n        ) : (\n          <div className=\"streaming-text__plain\">\n            {text}\n            {cursorElement}\n          </div>\n        )}\n      </div>\n    );\n  },\n);\n\nStreamingText.displayName = 'StreamingText';\n\nexport default StreamingText;\n","/**\n * ThinkingBlock — Collapsible display for LLM thinking/reasoning content.\n *\n * NEW component that surfaces the thinking text from thinking-capable models\n * (Claude with extended thinking, OpenAI with reasoning, etc.).\n *\n * - Collapsed: Shows \"Thinking...\" with chevron, animated dots while streaming\n * - Expanded: Grey-tinted scrollable block with the thinking text\n * - Uses CSS variables on `.thinking-block` for easy theming\n */\n\nimport React, { memo, useState, useCallback } from 'react';\nimport { ChevronDown, ChevronUp, Brain } from 'lucide-react';\nimport type { IThinkingBlockProps } from './types';\n\nexport const ThinkingBlock: React.FC<IThinkingBlockProps> = memo(\n  ({ content, isStreaming = false, defaultCollapsed = true, className = '' }) => {\n    const [collapsed, setCollapsed] = useState(defaultCollapsed);\n\n    const toggle = useCallback(() => setCollapsed((prev) => !prev), []);\n\n    if (!content && !isStreaming) {\n      return null;\n    }\n\n    return (\n      <div className={`thinking-block ${isStreaming ? 'thinking-block--streaming' : ''} ${className}`}>\n        <button className=\"thinking-block__header\" onClick={toggle}>\n          <Brain size={14} className=\"thinking-block__icon\" />\n          <span className=\"thinking-block__label\">\n            {isStreaming ? (\n              <span className=\"thinking-block__dots\">Thinking</span>\n            ) : (\n              'Thought process'\n            )}\n          </span>\n          <span className=\"thinking-block__chevron\">\n            {collapsed ? <ChevronDown size={14} /> : <ChevronUp size={14} />}\n          </span>\n        </button>\n\n        {!collapsed && (\n          <div className=\"thinking-block__content\">\n            <pre className=\"thinking-block__text\">{content}</pre>\n          </div>\n        )}\n      </div>\n    );\n  },\n);\n\nThinkingBlock.displayName = 'ThinkingBlock';\n\nexport default ThinkingBlock;\n","/**\n * ToolCallCard — Displays tool call information.\n *\n * Merged from:\n * - Hosea's ToolCallDisplay (category colors, icons, inline variant)\n * - v25's ToolCallCard (expandable details, args/result display)\n */\n\nimport React, { memo, useState, useCallback } from 'react';\nimport { Wrench, Check, AlertCircle, Loader, Clock, ChevronDown, ChevronUp } from 'lucide-react';\nimport type { IToolCallCardProps, IToolCallInfo } from './types';\n\n// Map tool names to categories and colors\nconst TOOL_CATEGORIES: Record<string, { category: string; color: string }> = {\n  read_file: { category: 'File', color: '#3b82f6' },\n  write_file: { category: 'File', color: '#3b82f6' },\n  edit_file: { category: 'File', color: '#3b82f6' },\n  glob: { category: 'File', color: '#3b82f6' },\n  grep: { category: 'File', color: '#3b82f6' },\n  list_directory: { category: 'File', color: '#3b82f6' },\n  bash: { category: 'Shell', color: '#10b981' },\n  web_search: { category: 'Web', color: '#8b5cf6' },\n  web_scrape: { category: 'Web', color: '#8b5cf6' },\n  web_fetch: { category: 'Web', color: '#8b5cf6' },\n  memory_store: { category: 'Memory', color: '#f59e0b' },\n  memory_retrieve: { category: 'Memory', color: '#f59e0b' },\n  memory_list: { category: 'Memory', color: '#f59e0b' },\n  memory_delete: { category: 'Memory', color: '#f59e0b' },\n  context_set: { category: 'Context', color: '#ec4899' },\n  context_get: { category: 'Context', color: '#ec4899' },\n  context_delete: { category: 'Context', color: '#ec4899' },\n  context_list: { category: 'Context', color: '#ec4899' },\n};\n\nfunction getToolInfo(name: string): { category: string; color: string } {\n  return TOOL_CATEGORIES[name] || { category: 'Tool', color: '#6b7280' };\n}\n\nfunction formatDuration(ms: number): string {\n  if (ms < 1000) return `${ms}ms`;\n  return `${(ms / 1000).toFixed(1)}s`;\n}\n\nfunction truncateString(str: string, maxLength: number): string {\n  if (str.length <= maxLength) return str;\n  return str.slice(0, maxLength - 3) + '...';\n}\n\nfunction formatJson(obj: unknown): string {\n  try { return JSON.stringify(obj, null, 2); }\n  catch { return String(obj); }\n}\n\nexport const ToolCallCard: React.FC<IToolCallCardProps> = memo(\n  ({ tool, expanded: initialExpanded = false, className = '' }) => {\n    const [expanded, setExpanded] = useState(initialExpanded);\n    const { name, description, status, durationMs, error, args, result } = tool;\n    const { category, color } = getToolInfo(name);\n\n    const hasDetails = args || result !== undefined || error;\n\n    const toggleExpand = useCallback(() => {\n      if (hasDetails) setExpanded((prev) => !prev);\n    }, [hasDetails]);\n\n    const statusIcon = {\n      pending: null,\n      running: <Loader size={14} className=\"tool-call__status-icon tool-call__status-icon--spin\" />,\n      complete: <Check size={14} className=\"tool-call__status-icon tool-call__status-icon--success\" />,\n      error: <AlertCircle size={14} className=\"tool-call__status-icon tool-call__status-icon--error\" />,\n    }[status];\n\n    return (\n      <div className={`tool-call tool-call--${status} ${className}`}>\n        <div\n          className=\"tool-call__header\"\n          onClick={toggleExpand}\n          style={{ cursor: hasDetails ? 'pointer' : 'default' }}\n        >\n          <div className=\"tool-call__icon\" style={{ backgroundColor: color }}>\n            <Wrench size={12} />\n          </div>\n          <span className=\"tool-call__category\" style={{ color }}>{category}</span>\n          <span className=\"tool-call__name\">{name}</span>\n\n          {description && (\n            <span className=\"tool-call__description\" title={description}>\n              {truncateString(description, 100)}\n            </span>\n          )}\n\n          <div className=\"tool-call__status\">\n            {statusIcon}\n            {status === 'complete' && durationMs !== undefined && (\n              <span className=\"tool-call__duration\">\n                <Clock size={12} />\n                {formatDuration(durationMs)}\n              </span>\n            )}\n          </div>\n\n          {error && <span className=\"tool-call__error-badge\">error</span>}\n\n          {hasDetails && (\n            <span className=\"tool-call__chevron\">\n              {expanded ? <ChevronUp size={14} /> : <ChevronDown size={14} />}\n            </span>\n          )}\n        </div>\n\n        {error && !expanded && (\n          <div className=\"tool-call__error\">{error}</div>\n        )}\n\n        {expanded && (\n          <div className=\"tool-call__details\">\n            {args && (\n              <div className=\"tool-call__detail-section\">\n                <span className=\"tool-call__detail-label\">Args:</span>\n                <pre className=\"tool-call__detail-pre\">{formatJson(args)}</pre>\n              </div>\n            )}\n            {status === 'complete' && result !== undefined && (\n              <div className=\"tool-call__detail-section\">\n                <span className=\"tool-call__detail-label\">Result:</span>\n                <pre className=\"tool-call__detail-pre\">{formatJson(result)}</pre>\n              </div>\n            )}\n            {error && (\n              <div className=\"tool-call__detail-section\">\n                <span className=\"tool-call__detail-label tool-call__detail-label--error\">Error:</span>\n                <span className=\"tool-call__error\">{error}</span>\n              </div>\n            )}\n          </div>\n        )}\n      </div>\n    );\n  },\n);\n\nToolCallCard.displayName = 'ToolCallCard';\n\n/**\n * Inline tool call display for embedding in message content.\n */\ninterface InlineToolCallProps {\n  name: string;\n  description: string;\n  status: 'pending' | 'running' | 'complete' | 'error';\n}\n\nexport function InlineToolCall({ name, description, status }: InlineToolCallProps): React.ReactElement {\n  const { category, color } = getToolInfo(name);\n\n  return (\n    <span className={`inline-tool-call inline-tool-call--${status}`}>\n      <span className=\"inline-tool-call__badge\" style={{ backgroundColor: color }}>\n        <Wrench size={10} />\n        <span className=\"inline-tool-call__category\">{category}</span>\n      </span>\n      <span className=\"inline-tool-call__name\">{name}</span>\n      {description && (\n        <span className=\"inline-tool-call__description\">\n          {truncateString(description, 50)}\n        </span>\n      )}\n      {status === 'running' && (\n        <Loader size={12} className=\"inline-tool-call__spinner\" />\n      )}\n    </span>\n  );\n}\n\nexport default ToolCallCard;\n","/**\n * ExecutionProgress — Inline progress indicator for agent execution.\n *\n * Shows dynamic header with running tool name or cycling status messages.\n * Collapsed by default, expandable to show full ToolCallCard list.\n *\n * From v25, adapted to use framework-agnostic CSS classes.\n */\n\nimport React, { memo, useEffect, useMemo, useRef, useState, useCallback } from 'react';\nimport { CheckCircle, Loader, ChevronDown, ChevronUp } from 'lucide-react';\nimport { ToolCallCard } from './ToolCallCard';\nimport type { IExecutionProgressProps, IToolCallInfo } from './types';\n\nconst CYCLING_INITIAL_MESSAGES = [\n  'Analyzing your request...',\n  'Consulting my expertise...',\n  'Processing information...',\n  'Considering the details...',\n  'Processing your request...',\n  'Analyzing the task...',\n  'Reviewing the information...',\n  'Thinking this through...',\n  'Gathering my thoughts...',\n  'Focusing on your question...',\n];\n\nconst CYCLING_PROCESSING_MESSAGES = [\n  'Thinking through the best approach...',\n  'Coordinating next steps...',\n  'Evaluating options...',\n  'Working on this...',\n  'Piecing this together...',\n  'Working through the details...',\n  'Evaluating next steps...',\n  'Ensuring accuracy...',\n  'Reviewing related items...',\n  'Verifying assumptions...',\n];\n\nconst getRandomInterval = () => Math.floor(Math.random() * 3000) + 2000;\n\nconst formatToolName = (name: string): string => {\n  let display = name.replace(/^(github-EW_|mcp_|v25_)/, '');\n  display = display.replace(/_/g, ' ');\n  return display;\n};\n\nconst getActiveDescription = (tools: IToolCallInfo[]): string | null => {\n  const running = tools.filter((t) => t.status === 'running');\n  if (running.length === 0) return null;\n  const latest = running[running.length - 1];\n  return latest.description || `Running ${formatToolName(latest.name)}`;\n};\n\nexport const ExecutionProgress: React.FC<IExecutionProgressProps> = memo(\n  ({ tools, activeCount, isComplete }) => {\n    const [expanded, setExpanded] = useState(false);\n    const [cyclingMessage, setCyclingMessage] = useState(CYCLING_INITIAL_MESSAGES[0]);\n    const timerRef = useRef<ReturnType<typeof setTimeout> | null>(null);\n\n    useEffect(() => {\n      if (timerRef.current) { clearTimeout(timerRef.current); timerRef.current = null; }\n      if (isComplete || activeCount > 0) return;\n\n      const interval = getRandomInterval();\n      timerRef.current = setTimeout(() => {\n        setCyclingMessage((prev) => {\n          const pool = tools.length > 0 ? CYCLING_PROCESSING_MESSAGES : CYCLING_INITIAL_MESSAGES;\n          const filtered = pool.filter((m) => m !== prev);\n          return filtered[Math.floor(Math.random() * filtered.length)];\n        });\n      }, interval);\n\n      return () => { if (timerRef.current) clearTimeout(timerRef.current); };\n    }, [cyclingMessage, isComplete, activeCount, tools.length]);\n\n    useEffect(() => {\n      if (tools.length > 0) {\n        setCyclingMessage((prev) => {\n          if (CYCLING_INITIAL_MESSAGES.includes(prev)) {\n            return CYCLING_PROCESSING_MESSAGES[Math.floor(Math.random() * CYCLING_PROCESSING_MESSAGES.length)];\n          }\n          return prev;\n        });\n      }\n    }, [tools.length > 0]);\n\n    const headerTitle = useMemo(() => {\n      if (isComplete) return tools.length === 0 ? 'Finished' : 'Work Summary';\n      const activeDesc = getActiveDescription(tools);\n      if (activeDesc) return activeDesc;\n      return cyclingMessage;\n    }, [isComplete, tools, cyclingMessage]);\n\n    const runningToolName = useMemo(() => {\n      const running = tools.filter((t) => t.status === 'running');\n      return running.length > 0 ? running[running.length - 1].name : null;\n    }, [tools]);\n\n    const toggleExpanded = useCallback(() => setExpanded((prev) => !prev), []);\n\n    const hasTools = tools.length > 0;\n\n    return (\n      <div className=\"execution-progress\">\n        <div\n          className=\"execution-progress__header\"\n          onClick={hasTools ? toggleExpanded : undefined}\n          style={{ cursor: hasTools ? 'pointer' : 'default' }}\n        >\n          {isComplete ? (\n            <CheckCircle size={16} className=\"execution-progress__icon execution-progress__icon--success\" />\n          ) : (\n            <Loader size={16} className=\"execution-progress__icon execution-progress__icon--spin\" />\n          )}\n\n          {!isComplete && runningToolName && (\n            <span className=\"execution-progress__tool-badge\">{runningToolName}</span>\n          )}\n\n          <span className=\"execution-progress__title\">{headerTitle}</span>\n\n          {!isComplete && tools.length > 1 && (\n            <span className=\"execution-progress__count\">({tools.length} tools)</span>\n          )}\n\n          {hasTools && (\n            <span className=\"execution-progress__chevron\">\n              {expanded ? <ChevronUp size={14} /> : <ChevronDown size={14} />}\n            </span>\n          )}\n        </div>\n\n        {expanded && hasTools && (\n          <div className=\"execution-progress__body\">\n            {tools.map((tool) => (\n              <ToolCallCard key={tool.id} tool={tool} />\n            ))}\n          </div>\n        )}\n      </div>\n    );\n  },\n);\n\nExecutionProgress.displayName = 'ExecutionProgress';\n\nexport default ExecutionProgress;\n","/**\n * ChatControls — Execution control buttons for chat.\n *\n * Provides pause/resume/cancel controls for agent execution.\n * Framework-agnostic: uses plain HTML buttons with CSS classes.\n */\n\nimport React, { memo } from 'react';\nimport { Pause, Play, XCircle, Loader } from 'lucide-react';\nimport type { IChatControlsProps } from './types';\n\nexport const ChatControls: React.FC<IChatControlsProps> = memo(\n  ({\n    isRunning = false,\n    isPaused = false,\n    hasError = false,\n    onPause,\n    onResume,\n    onCancel,\n    disabled = false,\n    className = '',\n    size,\n  }) => {\n    if (!isRunning && !isPaused) {\n      return null;\n    }\n\n    const sizeClass = size ? `chat-controls--${size}` : '';\n\n    return (\n      <div className={`chat-controls ${sizeClass} ${className}`}>\n        <div className=\"chat-controls__buttons\">\n          {isPaused ? (\n            <button\n              className=\"chat-controls__btn chat-controls__btn--resume\"\n              onClick={onResume}\n              disabled={disabled || !onResume}\n              title=\"Resume execution\"\n            >\n              <Play size={14} />\n              <span>Resume</span>\n            </button>\n          ) : (\n            <button\n              className=\"chat-controls__btn chat-controls__btn--pause\"\n              onClick={onPause}\n              disabled={disabled || !onPause || !isRunning}\n              title=\"Pause execution\"\n            >\n              <Pause size={14} />\n              <span>Pause</span>\n            </button>\n          )}\n\n          <button\n            className=\"chat-controls__btn chat-controls__btn--cancel\"\n            onClick={onCancel}\n            disabled={disabled || !onCancel}\n            title=\"Cancel execution\"\n          >\n            <XCircle size={14} />\n            <span>Cancel</span>\n          </button>\n        </div>\n\n        <div className=\"chat-controls__status\">\n          {isPaused ? (\n            <span className=\"chat-controls__status-text chat-controls__status-text--paused\">\n              <Pause size={14} /> Paused\n            </span>\n          ) : isRunning ? (\n            <span className=\"chat-controls__status-text chat-controls__status-text--running\">\n              <Loader size={14} className=\"chat-controls__spinner\" /> Running\n            </span>\n          ) : hasError ? (\n            <span className=\"chat-controls__status-text chat-controls__status-text--error\">Error</span>\n          ) : null}\n        </div>\n      </div>\n    );\n  },\n);\n\nChatControls.displayName = 'ChatControls';\n\nexport default ChatControls;\n","/**\n * ExportMessage — Export button with dropdown for PDF/DOCX export.\n *\n * The actual export logic is injectable via `onExport` prop so each app\n * can provide its own PDF/DOCX generation (v25 has corporate templates, Hosea may differ).\n * If no onExport is provided, the button is hidden.\n */\n\nimport React, { useState, useCallback, useRef, useEffect } from 'react';\nimport { Upload, Loader } from 'lucide-react';\nimport type { IExportMessageProps } from './types';\n\nexport const ExportMessage: React.FC<IExportMessageProps> = ({\n  messageElement,\n  markdownContent,\n  onExport,\n  className = '',\n  disabled = false,\n}) => {\n  const [isExporting, setIsExporting] = useState(false);\n  const [showMenu, setShowMenu] = useState(false);\n  const menuRef = useRef<HTMLDivElement>(null);\n\n  // Close menu on outside click\n  useEffect(() => {\n    if (!showMenu) return;\n    const handler = (e: MouseEvent) => {\n      if (menuRef.current && !menuRef.current.contains(e.target as Node)) {\n        setShowMenu(false);\n      }\n    };\n    document.addEventListener('mousedown', handler);\n    return () => document.removeEventListener('mousedown', handler);\n  }, [showMenu]);\n\n  const handleExport = useCallback(async (format: 'pdf' | 'docx') => {\n    if (!onExport) return;\n    try {\n      setIsExporting(true);\n      setShowMenu(false);\n      await onExport(format);\n    } catch (err) {\n      console.error(`${format.toUpperCase()} export failed:`, err);\n    } finally {\n      setIsExporting(false);\n    }\n  }, [onExport]);\n\n  if (!onExport) return null;\n\n  return (\n    <div className={`export-message ${className}`} ref={menuRef}>\n      <button\n        className=\"export-message__btn\"\n        onClick={() => setShowMenu(!showMenu)}\n        disabled={disabled || isExporting}\n        title=\"Export this message\"\n      >\n        {isExporting ? <Loader size={14} className=\"export-message__spinner\" /> : <Upload size={14} />}\n      </button>\n\n      {showMenu && (\n        <div className=\"export-message__menu\">\n          <button\n            className=\"export-message__menu-item\"\n            onClick={() => handleExport('pdf')}\n            disabled={isExporting}\n          >\n            Export as PDF\n          </button>\n          <button\n            className=\"export-message__menu-item\"\n            onClick={() => handleExport('docx')}\n            disabled={isExporting}\n          >\n            Export as DOCX\n          </button>\n        </div>\n      )}\n    </div>\n  );\n};\n\nExportMessage.displayName = 'ExportMessage';\n\nexport default ExportMessage;\n","import React, { useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport { Database, Minimize2, Upload, Loader2 } from 'lucide-react';\nimport type { InContextEntry } from '@everworker/oneringai';\nimport { ContextEntryCard } from './ContextEntryCard';\nimport { useOrderPersistence } from './useOrderPersistence';\nimport { formatValueForDisplay } from './utils';\nimport type { IContextDisplayPanelProps, ExportFormat } from './types';\n\nexport const ContextDisplayPanel: React.FC<IContextDisplayPanelProps> = ({\n  entries,\n  highlightKey,\n  title = 'Current Context',\n  storageKey = 'rui-context-order',\n  className,\n  enableDragAndDrop = true,\n  enableEditing = false,\n  enableExport = false,\n  onSaveEntry,\n  onExport,\n  onPinToggle,\n  pinnedKeys,\n  onMaximizedChange,\n  filterEntries,\n  entriesRef: externalEntriesRef,\n}) => {\n  const [collapsedKeys, setCollapsedKeys] = useState<Set<string>>(new Set());\n  const [maximizedKey, setMaximizedKey] = useState<string | null>(null);\n  const [pendingExportFormat, setPendingExportFormat] = useState<ExportFormat | null>(null);\n  const [draggedKey, setDraggedKey] = useState<string | null>(null);\n  const [dropTarget, setDropTarget] = useState<{ key: string; position: 'above' | 'below' } | null>(null);\n  const [exportDropdownOpen, setExportDropdownOpen] = useState(false);\n  const internalEntriesRef = useRef<HTMLDivElement>(null);\n  const dropdownRef = useRef<HTMLDivElement>(null);\n  const actualEntriesRef = externalEntriesRef || internalEntriesRef;\n\n  const pinnedSet = useMemo(() => new Set(pinnedKeys ?? []), [pinnedKeys]);\n\n  // Filter visible entries\n  const visibleEntries = useMemo(() => {\n    if (filterEntries) return filterEntries(entries);\n    return entries.filter((e) => e.showInUI);\n  }, [entries, filterEntries]);\n\n  // Order persistence (only used when drag-and-drop is enabled)\n  const { sortedEntries, orderedKeys, setOrderedKeys, saveCurrentOrder } =\n    useOrderPersistence(visibleEntries, storageKey);\n\n  const displayedEntries = enableDragAndDrop ? sortedEntries : visibleEntries;\n\n  // Scroll to highlighted entry\n  useEffect(() => {\n    if (!highlightKey) return;\n    requestAnimationFrame(() => {\n      const el = actualEntriesRef.current?.querySelector(\n        `[data-entry-key=\"${CSS.escape(highlightKey)}\"]`,\n      );\n      el?.scrollIntoView({ behavior: 'smooth', block: 'nearest' });\n    });\n  }, [highlightKey, actualEntriesRef]);\n\n  // Close export dropdown on outside click\n  useEffect(() => {\n    if (!exportDropdownOpen) return;\n    const handleClick = (e: MouseEvent) => {\n      if (dropdownRef.current && !dropdownRef.current.contains(e.target as Node)) {\n        setExportDropdownOpen(false);\n      }\n    };\n    document.addEventListener('mousedown', handleClick);\n    return () => document.removeEventListener('mousedown', handleClick);\n  }, [exportDropdownOpen]);\n\n  // Combined markdown for export (includes description and priority)\n  const combinedMarkdown = useMemo(\n    () =>\n      displayedEntries\n        .map((e) => {\n          const header = `## ${e.description || e.key}`;\n          const priority = e.priority ? ` \\`[${e.priority}]\\`` : '';\n          return `${header}${priority}\\n\\n${formatValueForDisplay(e.value)}`;\n        })\n        .join('\\n\\n---\\n\\n'),\n    [displayedEntries],\n  );\n\n  // Deferred export: waits for React re-render with force-expanded cards, then calls onExport\n  useEffect(() => {\n    if (!pendingExportFormat || !onExport) return;\n    const frameId = requestAnimationFrame(() => {\n      const doExport = async () => {\n        try {\n          await onExport(pendingExportFormat, {\n            element: actualEntriesRef.current,\n            markdownContent: combinedMarkdown,\n          });\n        } catch (err) {\n          console.error('Export failed:', err);\n        } finally {\n          setPendingExportFormat(null);\n        }\n      };\n      doExport();\n    });\n    return () => cancelAnimationFrame(frameId);\n  }, [pendingExportFormat, combinedMarkdown, onExport, actualEntriesRef]);\n\n  const handleCollapseToggle = useCallback((key: string) => {\n    setCollapsedKeys((prev) => {\n      const next = new Set(prev);\n      if (next.has(key)) next.delete(key);\n      else next.add(key);\n      return next;\n    });\n  }, []);\n\n  const handleMaximizeToggle = useCallback(\n    (key: string) => {\n      setMaximizedKey((prev) => {\n        const next = prev === key ? null : key;\n        onMaximizedChange?.(next !== null);\n        return next;\n      });\n    },\n    [onMaximizedChange],\n  );\n\n  // Drag-and-drop handlers\n  const handleDragStart = useCallback((key: string, e: React.DragEvent) => {\n    setDraggedKey(key);\n    e.dataTransfer.effectAllowed = 'move';\n    e.dataTransfer.setData('text/plain', key);\n  }, []);\n\n  const handleDragOver = useCallback((key: string, e: React.DragEvent) => {\n    e.preventDefault();\n    e.dataTransfer.dropEffect = 'move';\n    const rect = (e.currentTarget as HTMLElement).getBoundingClientRect();\n    const midY = rect.top + rect.height / 2;\n    setDropTarget({ key, position: e.clientY < midY ? 'above' : 'below' });\n  }, []);\n\n  const handleDragLeave = useCallback(() => {\n    setDropTarget(null);\n  }, []);\n\n  const handleDrop = useCallback(\n    (targetKey: string, e: React.DragEvent) => {\n      e.preventDefault();\n      const sourceKey = e.dataTransfer.getData('text/plain');\n      if (!sourceKey || sourceKey === targetKey) {\n        setDraggedKey(null);\n        setDropTarget(null);\n        return;\n      }\n\n      const rect = (e.currentTarget as HTMLElement).getBoundingClientRect();\n      const insertAfter = e.clientY >= rect.top + rect.height / 2;\n\n      setOrderedKeys((prev) => {\n        const next = prev.filter((k) => k !== sourceKey);\n        const targetIdx = next.indexOf(targetKey);\n        if (targetIdx === -1) return prev;\n        const insertIdx = insertAfter ? targetIdx + 1 : targetIdx;\n        next.splice(insertIdx, 0, sourceKey);\n        saveCurrentOrder(next);\n        return next;\n      });\n\n      setDraggedKey(null);\n      setDropTarget(null);\n    },\n    [setOrderedKeys, saveCurrentOrder],\n  );\n\n  const handleDragEnd = useCallback(() => {\n    setDraggedKey(null);\n    setDropTarget(null);\n  }, []);\n\n  if (visibleEntries.length === 0) return null;\n\n  const isExporting = !!pendingExportFormat;\n  const isMaximized = maximizedKey !== null;\n\n  // Show ALL entries when exporting (ignore maximizedKey filter)\n  const entriesToRender = isExporting\n    ? displayedEntries\n    : isMaximized\n      ? displayedEntries.filter((e) => e.key === maximizedKey)\n      : displayedEntries;\n\n  const panelClasses = [\n    'cdp-panel',\n    isMaximized && !isExporting ? 'cdp-panel--maximized' : '',\n    className ?? '',\n  ].filter(Boolean).join(' ');\n\n  return (\n    <div className={panelClasses}>\n      {/* Header — hidden during export */}\n      {!isExporting && (\n        <div className=\"cdp-header\">\n          <Database size={14} className=\"cdp-header__icon\" />\n          <span className=\"cdp-header__title\">{title}</span>\n          <span className=\"cdp-header__count\">{visibleEntries.length}</span>\n\n          {enableExport && onExport && (\n            <div className=\"cdp-export\" ref={dropdownRef}>\n              <button\n                className=\"cdp-action-btn cdp-export__trigger\"\n                onClick={() => setExportDropdownOpen((prev) => !prev)}\n                disabled={isExporting}\n                title={pendingExportFormat ? `Exporting to ${String(pendingExportFormat).toUpperCase()}...` : 'Export'}\n              >\n                {isExporting ? (\n                  <Loader2 size={14} className=\"cdp-spinner\" />\n                ) : (\n                  <Upload size={14} />\n                )}\n              </button>\n              {exportDropdownOpen && (\n                <div className=\"cdp-export__menu\" role=\"menu\">\n                  <button\n                    className=\"cdp-export__item\"\n                    role=\"menuitem\"\n                    onClick={() => {\n                      setPendingExportFormat('pdf');\n                      setExportDropdownOpen(false);\n                    }}\n                  >\n                    Export as PDF\n                  </button>\n                  <button\n                    className=\"cdp-export__item\"\n                    role=\"menuitem\"\n                    onClick={() => {\n                      setPendingExportFormat('docx');\n                      setExportDropdownOpen(false);\n                    }}\n                  >\n                    Export as DOCX\n                  </button>\n                </div>\n              )}\n            </div>\n          )}\n\n          {isMaximized && (\n            <button\n              className=\"cdp-header__exit-maximize\"\n              onClick={() => {\n                setMaximizedKey(null);\n                onMaximizedChange?.(false);\n              }}\n              title=\"Exit full view\"\n            >\n              <Minimize2 size={12} />\n              <span>Exit</span>\n            </button>\n          )}\n        </div>\n      )}\n\n      {/* Entries */}\n      <div\n        ref={actualEntriesRef as React.RefObject<HTMLDivElement>}\n        className=\"cdp-entries\"\n        role=\"list\"\n        aria-label=\"Context entries\"\n      >\n        {entriesToRender.map((entry) => (\n          <ContextEntryCard\n            key={entry.key}\n            entry={entry}\n            isCollapsed={isExporting ? false : collapsedKeys.has(entry.key)}\n            isMaximized={isExporting ? false : maximizedKey === entry.key}\n            isHighlighted={highlightKey === entry.key}\n            forceExpanded={isExporting}\n            enableDragAndDrop={enableDragAndDrop && !isExporting && !isMaximized}\n            isDragging={draggedKey === entry.key}\n            dropPosition={dropTarget?.key === entry.key ? dropTarget.position : null}\n            enableEditing={enableEditing && !isExporting}\n            onSaveEntry={onSaveEntry}\n            isPinned={pinnedSet.has(entry.key)}\n            onPinToggle={onPinToggle}\n            onCollapseToggle={handleCollapseToggle}\n            onMaximizeToggle={handleMaximizeToggle}\n            onDragStart={handleDragStart}\n            onDragOver={handleDragOver}\n            onDragLeave={handleDragLeave}\n            onDrop={handleDrop}\n            onDragEnd={handleDragEnd}\n          />\n        ))}\n      </div>\n    </div>\n  );\n};\n","import React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport {\n  ChevronDown,\n  ChevronRight,\n  Maximize2,\n  Minimize2,\n  GripVertical,\n  Pencil,\n  Check,\n  Pin,\n  PinOff,\n  Loader2,\n} from 'lucide-react';\nimport { MarkdownRenderer } from '../markdown/MarkdownRenderer';\nimport { formatValueForDisplay, PRIORITY_CLASSES } from './utils';\nimport type { InContextEntry } from '@everworker/oneringai';\n\nconst MIN_TEXTAREA_ROWS = 6;\n\ninterface IContextEntryCardProps {\n  entry: InContextEntry;\n  isCollapsed: boolean;\n  isMaximized: boolean;\n  isHighlighted: boolean;\n  forceExpanded: boolean;\n\n  // Drag-and-drop\n  enableDragAndDrop: boolean;\n  isDragging: boolean;\n  dropPosition: 'above' | 'below' | null;\n  onDragStart: (key: string, e: React.DragEvent) => void;\n  onDragOver: (key: string, e: React.DragEvent) => void;\n  onDragLeave: () => void;\n  onDrop: (key: string, e: React.DragEvent) => void;\n  onDragEnd: () => void;\n\n  // Editing\n  enableEditing: boolean;\n  onSaveEntry?: (key: string, newValue: string) => Promise<void>;\n\n  // Pin\n  isPinned?: boolean;\n  onPinToggle?: (key: string, pinned: boolean) => void;\n\n  // Actions\n  onCollapseToggle: (key: string) => void;\n  onMaximizeToggle: (key: string) => void;\n}\n\nexport const ContextEntryCard: React.FC<IContextEntryCardProps> = ({\n  entry,\n  isCollapsed,\n  isMaximized,\n  isHighlighted,\n  forceExpanded,\n  enableDragAndDrop,\n  isDragging,\n  dropPosition,\n  onDragStart,\n  onDragOver,\n  onDragLeave,\n  onDrop,\n  onDragEnd,\n  enableEditing,\n  onSaveEntry,\n  isPinned,\n  onPinToggle,\n  onCollapseToggle,\n  onMaximizeToggle,\n}) => {\n  const displayValue = useMemo(() => formatValueForDisplay(entry.value), [entry.value]);\n  const [isEditing, setIsEditing] = useState(false);\n  const [editValue, setEditValue] = useState(displayValue);\n  const [isSaving, setIsSaving] = useState(false);\n\n  useEffect(() => {\n    setEditValue(displayValue);\n  }, [displayValue]);\n\n  const hasChanges = editValue !== displayValue;\n  const isDragDisabled = !enableDragAndDrop || forceExpanded || isMaximized;\n\n  const handleSave = useCallback(async () => {\n    if (!onSaveEntry || !hasChanges) return;\n    setIsSaving(true);\n    try {\n      await onSaveEntry(entry.key, editValue);\n      setIsEditing(false);\n    } catch (err: unknown) {\n      const message = err instanceof Error ? err.message : String(err);\n      console.error('[ContextEntryCard] Save failed:', message);\n    } finally {\n      setIsSaving(false);\n    }\n  }, [onSaveEntry, entry.key, editValue, hasChanges]);\n\n  const handleEditToggle = useCallback(() => {\n    if (isEditing && hasChanges) {\n      setEditValue(displayValue);\n    }\n    setIsEditing((prev) => !prev);\n  }, [isEditing, hasChanges, displayValue]);\n\n  const handleKeyDown = useCallback(\n    (e: React.KeyboardEvent) => {\n      if (e.key === 'Enter' || e.key === ' ') {\n        e.preventDefault();\n        onCollapseToggle(entry.key);\n      }\n    },\n    [entry.key, onCollapseToggle],\n  );\n\n  const cardClasses = [\n    'cdp-card',\n    isHighlighted && !forceExpanded ? 'cdp-card--highlight' : '',\n    isMaximized && !forceExpanded ? 'cdp-card--maximized' : '',\n    isCollapsed ? 'cdp-card--collapsed' : '',\n    isPinned ? 'cdp-card--pinned' : '',\n    forceExpanded ? 'cdp-card--export' : '',\n    isDragging ? 'cdp-card--dragging' : '',\n    dropPosition === 'above' ? 'cdp-card--drop-above' : '',\n    dropPosition === 'below' ? 'cdp-card--drop-below' : '',\n  ].filter(Boolean).join(' ');\n\n  return (\n    <div\n      data-entry-key={entry.key}\n      className={cardClasses}\n      role=\"listitem\"\n      draggable={!isDragDisabled}\n      onDragStart={(e) => !isDragDisabled && onDragStart(entry.key, e)}\n      onDragOver={(e) => !isDragDisabled && onDragOver(entry.key, e)}\n      onDragLeave={!isDragDisabled ? onDragLeave : undefined}\n      onDrop={(e) => !isDragDisabled && onDrop(entry.key, e)}\n      onDragEnd={!isDragDisabled ? onDragEnd : undefined}\n    >\n      {/* Header — hidden during export */}\n      {!forceExpanded && (\n        <div\n          className=\"cdp-card__header\"\n          role=\"button\"\n          tabIndex={0}\n          aria-expanded={!isCollapsed}\n          onClick={() => onCollapseToggle(entry.key)}\n          onKeyDown={handleKeyDown}\n        >\n          <div className=\"cdp-card__title\">\n            {!isDragDisabled && (\n              <span\n                className=\"cdp-drag-handle\"\n                onClick={(e) => e.stopPropagation()}\n                title=\"Drag to reorder\"\n              >\n                <GripVertical size={12} />\n              </span>\n            )}\n            <span className=\"cdp-card__collapse-icon\">\n              {isCollapsed ? <ChevronRight size={12} /> : <ChevronDown size={12} />}\n            </span>\n            <span\n              className=\"cdp-card__key\"\n              title={`${entry.key}${entry.priority ? ` [${entry.priority}]` : ''}`}\n            >\n              {entry.description || entry.key}\n            </span>\n            {entry.priority && (\n              <span className={`cdp-priority ${PRIORITY_CLASSES[entry.priority] || ''}`}>\n                {entry.priority}\n              </span>\n            )}\n          </div>\n          <div\n            className=\"cdp-card__actions\"\n            role=\"toolbar\"\n            aria-label=\"Entry actions\"\n            onClick={(e) => e.stopPropagation()}\n          >\n            {isEditing && hasChanges && (\n              <button\n                className=\"cdp-action-btn cdp-action-btn--save\"\n                onClick={handleSave}\n                disabled={isSaving}\n                title=\"Save changes\"\n              >\n                {isSaving ? (\n                  <Loader2 size={14} className=\"cdp-spinner\" />\n                ) : (\n                  <Check size={14} />\n                )}\n              </button>\n            )}\n            {enableEditing && !forceExpanded && (\n              <button\n                className={`cdp-action-btn ${isEditing ? 'cdp-action-btn--active' : ''}`}\n                onClick={handleEditToggle}\n                title={isEditing ? 'Exit edit mode' : 'Edit raw markdown'}\n              >\n                <Pencil size={14} />\n              </button>\n            )}\n            <button\n              className={`cdp-action-btn ${isMaximized ? 'cdp-action-btn--active' : ''}`}\n              onClick={() => onMaximizeToggle(entry.key)}\n              title={isMaximized ? 'Exit full view' : 'Full view'}\n            >\n              {isMaximized ? <Minimize2 size={14} /> : <Maximize2 size={14} />}\n            </button>\n            {onPinToggle && (\n              <button\n                className={`cdp-action-btn ${isPinned ? 'cdp-action-btn--active' : ''}`}\n                onClick={() => onPinToggle(entry.key, !isPinned)}\n                title={isPinned ? 'Unpin (stop always showing)' : 'Pin (always show this entry)'}\n              >\n                {isPinned ? <Pin size={14} /> : <PinOff size={14} />}\n              </button>\n            )}\n          </div>\n        </div>\n      )}\n\n      {/* Body — markdown value or edit textarea */}\n      {!isCollapsed && (\n        <div className=\"cdp-card__body\">\n          {isEditing ? (\n            <textarea\n              className=\"cdp-edit-textarea\"\n              value={editValue}\n              onChange={(e) => setEditValue(e.target.value)}\n              rows={Math.max(MIN_TEXTAREA_ROWS, editValue.split('\\n').length + 1)}\n              disabled={isSaving}\n              aria-label={`Edit ${entry.key}`}\n            />\n          ) : (\n            <div className=\"cdp-card__markdown\">\n              <MarkdownRenderer content={displayValue} />\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n};\n","const MAX_JSON_LENGTH = 50_000;\n\n/**\n * Format a value for markdown display.\n * - Strings are rendered as markdown directly.\n * - Objects/arrays are shown as JSON code blocks (truncated if too large).\n * - Primitives are shown as inline text.\n * - Handles circular references and non-serializable values gracefully.\n */\nexport function formatValueForDisplay(value: unknown): string {\n  if (typeof value === 'string') return value;\n  if (value === null || value === undefined) return String(value);\n  if (typeof value === 'number' || typeof value === 'boolean') return String(value);\n  if (value instanceof Date) return value.toISOString();\n  try {\n    const json = JSON.stringify(value, null, 2);\n    if (json.length > MAX_JSON_LENGTH) {\n      return '```json\\n' + json.slice(0, MAX_JSON_LENGTH) + '\\n... (truncated)\\n```';\n    }\n    return '```json\\n' + json + '\\n```';\n  } catch {\n    return '`[Object — cannot serialize]`';\n  }\n}\n\n/** CSS class suffixes for priority badge styling */\nexport const PRIORITY_CLASSES: Record<string, string> = {\n  low: 'cdp-priority--low',\n  normal: 'cdp-priority--normal',\n  high: 'cdp-priority--high',\n  critical: 'cdp-priority--critical',\n};\n","import { useEffect, useMemo, useState } from 'react';\nimport type { InContextEntry } from '@everworker/oneringai';\n\nconst DEFAULT_STORAGE_KEY = 'rui-context-order';\n\n/** Load saved order from localStorage. */\nfunction loadSavedOrder(storageKey: string): string[] {\n  try {\n    const raw = localStorage.getItem(storageKey);\n    if (raw) {\n      const parsed = JSON.parse(raw);\n      if (Array.isArray(parsed)) return parsed;\n    }\n  } catch {\n    /* ignore corrupt data */\n  }\n  return [];\n}\n\n/** Save order to localStorage. */\nfunction saveOrder(storageKey: string, keys: string[]): void {\n  try {\n    localStorage.setItem(storageKey, JSON.stringify(keys));\n  } catch {\n    /* quota exceeded, ignore */\n  }\n}\n\n/**\n * Reconcile saved order with current visible entries.\n * Keeps order for existing keys, appends new keys at the end, removes stale keys.\n */\nfunction reconcileOrder(savedOrder: string[], currentKeys: string[]): string[] {\n  const currentSet = new Set(currentKeys);\n  const result: string[] = [];\n  const seen = new Set<string>();\n\n  for (const key of savedOrder) {\n    if (currentSet.has(key) && !seen.has(key)) {\n      result.push(key);\n      seen.add(key);\n    }\n  }\n\n  for (const key of currentKeys) {\n    if (!seen.has(key)) {\n      result.push(key);\n    }\n  }\n\n  return result;\n}\n\nexport interface UseOrderPersistenceResult {\n  sortedEntries: InContextEntry[];\n  orderedKeys: string[];\n  setOrderedKeys: React.Dispatch<React.SetStateAction<string[]>>;\n  saveCurrentOrder: (keys: string[]) => void;\n}\n\n/**\n * Hook for persisting drag-and-drop order to localStorage.\n * Returns sorted entries respecting persisted order.\n */\nexport function useOrderPersistence(\n  visibleEntries: InContextEntry[],\n  storageKey: string = DEFAULT_STORAGE_KEY,\n): UseOrderPersistenceResult {\n  const [orderedKeys, setOrderedKeys] = useState<string[]>(() => loadSavedOrder(storageKey));\n\n  // Pure computation: reconcile and sort\n  const { sortedEntries, reconciledOrder } = useMemo(() => {\n    const currentKeys = visibleEntries.map((e) => e.key);\n    const reconciled = reconcileOrder(orderedKeys, currentKeys);\n    const entryMap = new Map(visibleEntries.map((e) => [e.key, e]));\n    const sorted = reconciled\n      .map((key) => entryMap.get(key))\n      .filter((e): e is InContextEntry => e !== undefined);\n    return { sortedEntries: sorted, reconciledOrder: reconciled };\n  }, [visibleEntries, orderedKeys]);\n\n  // Side-effect: sync state when reconciliation detects order changes\n  useEffect(() => {\n    if (\n      reconciledOrder.length !== orderedKeys.length ||\n      reconciledOrder.some((k, i) => k !== orderedKeys[i])\n    ) {\n      setOrderedKeys(reconciledOrder);\n      saveOrder(storageKey, reconciledOrder);\n    }\n  }, [reconciledOrder, orderedKeys, storageKey]);\n\n  const saveCurrentOrder = (keys: string[]) => {\n    setOrderedKeys(keys);\n    saveOrder(storageKey, keys);\n  };\n\n  return { sortedEntries, orderedKeys, setOrderedKeys, saveCurrentOrder };\n}\n","import { useEffect, useRef, useState } from 'react';\nimport type { InContextEntry } from '@everworker/oneringai';\n\nconst HIGHLIGHT_DURATION_MS = 1500;\n\n/**\n * Hook to detect new/updated visible entries in the Dynamic UI.\n * Must be used in an always-mounted parent component (NOT inside ContextDisplayPanel,\n * which may be conditionally rendered based on active tab).\n *\n * Returns the key of the most recently changed entry (auto-clears after timeout).\n */\nexport function useDynamicUIChangeDetection(\n  entries: InContextEntry[],\n  onEntryChanged?: (key: string) => void,\n): string | null {\n  const prevEntriesRef = useRef<Map<string, number>>(new Map());\n  const [highlightKey, setHighlightKey] = useState<string | null>(null);\n  const timeoutRef = useRef<ReturnType<typeof setTimeout> | null>(null);\n\n  useEffect(() => {\n    const visible = entries.filter((e) => e.showInUI);\n    const prev = prevEntriesRef.current;\n    let changedKey: string | null = null;\n\n    for (const entry of visible) {\n      const prevUpdatedAt = prev.get(entry.key);\n      if (prevUpdatedAt === undefined || prevUpdatedAt !== entry.updatedAt) {\n        changedKey = entry.key;\n        break;\n      }\n    }\n\n    // Update tracking map\n    const next = new Map<string, number>();\n    for (const entry of visible) {\n      next.set(entry.key, entry.updatedAt);\n    }\n    prevEntriesRef.current = next;\n\n    if (changedKey) {\n      onEntryChanged?.(changedKey);\n      setHighlightKey(changedKey);\n      if (timeoutRef.current) clearTimeout(timeoutRef.current);\n      timeoutRef.current = setTimeout(() => setHighlightKey(null), HIGHLIGHT_DURATION_MS);\n    }\n  }, [entries, onEntryChanged]);\n\n  // Cleanup on unmount\n  useEffect(() => {\n    return () => {\n      if (timeoutRef.current) clearTimeout(timeoutRef.current);\n    };\n  }, []);\n\n  return highlightKey;\n}\n"],"mappings":"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","names":["import_react","import_jsx_runtime","import_react","import_jsx_runtime","import_react","import_jsx_runtime","import_react","import_jsx_runtime","import_jsx_runtime","import_jsx_runtime","import_react","import_jsx_runtime","import_jsx_runtime","import_jsx_runtime","import_jsx_runtime","import_jsx_runtime","import_jsx_runtime","import_jsx_runtime","import_jsx_runtime","import_react","import_react","import_lucide_react","import_jsx_runtime","MermaidDiagram","VegaChart","MarkmapRenderer","SyntaxHighlighter","import_jsx_runtime","colCount","i","content","MarkdownRenderer","ReactMarkdown","remarkGfm","remarkMath","rehypeKatex","import_react","import_jsx_runtime","import_react","import_lucide_react","import_react","import_jsx_runtime","import_react","import_lucide_react","import_jsx_runtime","import_react","import_lucide_react","import_jsx_runtime","import_jsx_runtime","import_react","import_lucide_react","import_jsx_runtime","import_react","import_lucide_react","import_jsx_runtime","import_react","import_lucide_react","import_jsx_runtime","import_react","import_lucide_react","import_react","import_lucide_react","import_jsx_runtime","import_react","import_jsx_runtime","import_react"]}